/*! For license information please see dnlz7.32.63ff7fbe.chunk.js.LICENSE.txt */
(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[32],{14785:(Y,c,h)=>{"use strict";var C=h(14791),E=h(14799),N=h(14807);h.g.__TYPEDARRAY_POOL||(h.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var Q="undefined"!==typeof Uint8ClampedArray,b=h.g.__TYPEDARRAY_POOL;b.UINT8C||(b.UINT8C=E([32,0])),b.BUFFER||(b.BUFFER=E([32,0]));var H=b.DATA,w=b.BUFFER;function W(Y){if(Y){var c=Y.length||Y.byteLength,h=C.log2(c);H[h].push(Y)}}function q(Y){Y=C.nextPow2(Y);var c=C.log2(Y),h=H[c];return h.length>0?h.pop():new ArrayBuffer(Y)}function k(Y){return new Uint8Array(q(Y),0,Y)}function M(Y){return new Uint16Array(q(2*Y),0,Y)}function p(Y){return new Uint32Array(q(4*Y),0,Y)}function P(Y){return new Int8Array(q(Y),0,Y)}function y(Y){return new Int16Array(q(2*Y),0,Y)}function d(Y){return new Int32Array(q(4*Y),0,Y)}function D(Y){return new Float32Array(q(4*Y),0,Y)}function T(Y){return new Float64Array(q(8*Y),0,Y)}function e(Y){return Q?new Uint8ClampedArray(q(Y),0,Y):k(Y)}function r(Y){return new DataView(q(Y),0,Y)}c.free=function(Y){if(N(Y))w[C.log2(Y.length)].push(Y);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Y)&&(Y=Y.buffer),!Y)return;var c=Y.length||Y.byteLength,h=0|C.log2(c);H[h].push(Y)}},c.freeUint8=c.freeUint16=c.freeUint32=c.freeInt8=c.freeInt16=c.freeInt32=c.freeFloat32=c.freeFloat=c.freeFloat64=c.freeDouble=c.freeUint8Clamped=c.freeDataView=function(Y){W(Y.buffer)},c.freeArrayBuffer=W,c.freeBuffer=function(Y){w[C.log2(Y.length)].push(Y)},c.malloc=function(Y,c){if(void 0===c||"arraybuffer"===c)return q(Y);switch(c){case"uint8":return k(Y);case"uint16":return M(Y);case"uint32":return p(Y);case"int8":return P(Y);case"int16":return y(Y);case"int32":return d(Y);case"float":case"float32":return D(Y);case"double":case"float64":return T(Y);case"uint8_clamped":return e(Y);case"buffer":throw"Buffer not supported";case"data":case"dataview":return r(Y);default:return null}return null},c.mallocArrayBuffer=q,c.mallocUint8=k,c.mallocUint16=M,c.mallocUint32=p,c.mallocInt8=P,c.mallocInt16=y,c.mallocInt32=d,c.mallocFloat32=c.mallocFloat=D,c.mallocFloat64=c.mallocDouble=T,c.mallocUint8Clamped=e,c.mallocDataView=r,c.clearCache=function(){for(var Y=0;Y<32;++Y)b.UINT8[Y].length=0,b.UINT16[Y].length=0,b.UINT32[Y].length=0,b.INT8[Y].length=0,b.INT16[Y].length=0,b.INT32[Y].length=0,b.FLOAT[Y].length=0,b.DOUBLE[Y].length=0,b.UINT8C[Y].length=0,H[Y].length=0,w[Y].length=0}},14891:(Y,c,h)=>{Y.exports=E;var C=h(13698);function E(Y,c){if(!(this instanceof E))return new E(Y,c);var h=C.create();C.add(h,Y,c),this.base=C.min(C.create(),Y,h),this.zq=C.clone(c),this.max=C.max(C.create(),Y,h),this.mag=C.length(this.zq)}var N=E.prototype;N.width=function(){return this.zq[0]},N.height=function(){return this.zq[1]},N.depth=function(){return this.zq[2]},N.x0=function(){return this.base[0]},N.y0=function(){return this.base[1]},N.z0=function(){return this.base[2]},N.x1=function(){return this.max[0]},N.y1=function(){return this.max[1]},N.z1=function(){return this.max[2]},N.translate=function(Y){return C.add(this.max,this.max,Y),C.add(this.base,this.base,Y),this},N.setPosition=function(Y){return C.add(this.max,Y,this.zq),C.j(this.base,Y),this},N.expand=function(Y){var c=C.create(),h=C.create();return C.max(c,Y.max,this.max),C.min(h,Y.base,this.base),C.Hh(c,c,h),new E(h,c)},N.intersects=function(Y){return!(Y.base[0]>this.max[0])&&(!(Y.base[1]>this.max[1])&&(!(Y.base[2]>this.max[2])&&(!(Y.max[0]<this.base[0])&&(!(Y.max[1]<this.base[1])&&!(Y.max[2]<this.base[2])))))},N.touches=function(Y){var c=this.union(Y);return null!==c&&(0==c.width()||0==c.height()||0==c.depth())},N.union=function(Y){if(!this.intersects(Y))return null;var c=Math.max(Y.base[0],this.base[0]),h=Math.max(Y.base[1],this.base[1]),C=Math.max(Y.base[2],this.base[2]);return new E([c,h,C],[Math.min(Y.max[0],this.max[0])-c,Math.min(Y.max[1],this.max[1])-h,Math.min(Y.max[2],this.max[2])-C])}},14791:(Y,c)=>{"use strict";function h(Y){var c=32;return(Y&=-Y)&&c--,65535&Y&&(c-=16),16711935&Y&&(c-=8),252645135&Y&&(c-=4),858993459&Y&&(c-=2),1431655765&Y&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(Y){return(Y>0)-(Y<0)},c.abs=function(Y){var c=Y>>31;return(Y^c)-c},c.min=function(Y,c){return c^(Y^c)&-(Y<c)},c.max=function(Y,c){return Y^(Y^c)&-(Y<c)},c.isPow2=function(Y){return!(Y&Y-1)&&!!Y},c.log2=function(Y){var c,h;return c=(Y>65535)<<4,c|=h=((Y>>>=c)>255)<<3,c|=h=((Y>>>=h)>15)<<2,(c|=h=((Y>>>=h)>3)<<1)|(Y>>>=h)>>1},c.log10=function(Y){return Y>=1e9?9:Y>=1e8?8:Y>=1e7?7:Y>=1e6?6:Y>=1e5?5:Y>=1e4?4:Y>=1e3?3:Y>=100?2:Y>=10?1:0},c.popCount=function(Y){return 16843009*((Y=(858993459&(Y-=Y>>>1&1431655765))+(Y>>>2&858993459))+(Y>>>4)&252645135)>>>24},c.countTrailingZeros=h,c.nextPow2=function(Y){return Y+=0===Y,--Y,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)+1},c.prevPow2=function(Y){return Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)-(Y>>>1)},c.parity=function(Y){return Y^=Y>>>16,Y^=Y>>>8,Y^=Y>>>4,27030>>>(Y&=15)&1};var C=new Array(256);!function(Y){for(var c=0;c<256;++c){var h=c,C=c,E=7;for(h>>>=1;h;h>>>=1)C<<=1,C|=1&h,--E;Y[c]=C<<E&255}}(C),c.reverse=function(Y){return C[255&Y]<<24|C[Y>>>8&255]<<16|C[Y>>>16&255]<<8|C[Y>>>24&255]},c.interleave2=function(Y,c){return(Y=1431655765&((Y=858993459&((Y=252645135&((Y=16711935&((Y&=65535)|Y<<8))|Y<<4))|Y<<2))|Y<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(Y,c){return(Y=65535&((Y=16711935&((Y=252645135&((Y=858993459&((Y=Y>>>c&1431655765)|Y>>>1))|Y>>>2))|Y>>>4))|Y>>>16))<<16>>16},c.interleave3=function(Y,c,h){return Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2),(Y|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},c.deinterleave3=function(Y,c){return(Y=1023&((Y=4278190335&((Y=251719695&((Y=3272356035&((Y=Y>>>c&1227133513)|Y>>>2))|Y>>>4))|Y>>>8))|Y>>>16))<<22>>22},c.nextCombination=function(Y){var c=Y|Y-1;return c+1|(~c&-~c)-1>>>h(Y)+1}},14780:(Y,c,h)=>{"use strict";Y.exports=function(Y,c,h){switch(arguments.length){case 1:return C=[],w(E=Y,E,W,!0),C;case 2:return"function"===typeof c?w(Y,Y,c,!0):function(Y,c){return C=[],w(Y,c,W,!1),C}(Y,c);case 3:return w(Y,c,h,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var C,E=h(14785),N=h(14816),Q=h(14825);function b(Y,c){for(var h=0;h<Y;++h)if(!(c[h]<=c[h+Y]))return!0;return!1}function H(Y,c,h,C){for(var E=0,N=0,Q=0,H=Y.length;Q<H;++Q){var w=Y[Q];if(!b(c,w)){for(var W=0;W<2*c;++W)h[E++]=w[W];C[N++]=Q}}return N}function w(Y,c,h,C){var b=Y.length,w=c.length;if(!(b<=0||w<=0)){var W=Y[0].length>>>1;if(!(W<=0)){var q,k=E.mallocDouble(2*W*b),M=E.mallocInt32(b);if((b=H(Y,W,k,M))>0){if(1===W&&C)N.init(b),q=N.sweepComplete(W,h,0,b,k,M,0,b,k,M);else{var p=E.mallocDouble(2*W*w),P=E.mallocInt32(w);(w=H(c,W,p,P))>0&&(N.init(b+w),q=1===W?N.sweepBipartite(W,h,0,b,k,M,0,w,p,P):Q(W,h,C,b,k,M,w,p,P),E.free(p),E.free(P))}E.free(k),E.free(M)}return q}}}function W(Y,c){C.push([Y,c])}},14831:(Y,c)=>{"use strict";var h="d",C="ax",E="fp",N="es",Q="rs",b="re",H="rb",w="bs",W="be",q="bb",k=[h,C,"vv",Q,b,H,"ri",w,W,q,"bi"];function M(Y){var c="bruteForce"+(Y?"Full":"Partial"),C=[],Q=k.slice();Y||Q.splice(3,0,E);var b=["function "+c+"("+Q.join()+"){"];function H(c,E){var Q=function(Y,c,C){var E="bruteForce"+(Y?"Red":"Blue")+(c?"Flip":"")+(C?"Full":""),Q=["function ",E,"(",k.join(),"){","var ",N,"=2*",h,";"],b="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",H="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(C?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Y?Q.push(b,"Q",":",H):Q.push(H,"Q",":",b),C?Q.push("if(y1<x0||x1<y0)continue;"):c?Q.push("if(y0<=x0||x1<y0)continue;"):Q.push("if(y0<x0||x1<y0)continue;"),Q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),c?Q.push("yi,xi"):Q.push("xi,yi"),Q.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:Q.join("")}}(c,E,Y);C.push(Q.code),b.push("return "+Q.name+"("+k.join()+");")}b.push("if(re-rs>be-bs){"),Y?(H(!0,!1),b.push("}else{"),H(!1,!1)):(b.push("if(fp){"),H(!0,!0),b.push("}else{"),H(!0,!1),b.push("}}else{if(fp){"),H(!1,!0),b.push("}else{"),H(!1,!1),b.push("}")),b.push("}}return "+c);var w=C.join("")+b.join("");return new Function(w)()}c.partial=M(!1),c.full=M(!0)},14825:(Y,c,h)=>{"use strict";Y.exports=function(Y,c,h,N,W,I,s,x,A){!function(Y,c){var h=8*E.log2(c+1)*(Y+1)|0,N=E.nextPow2(e*h);X.length<N&&(C.free(X),X=C.mallocInt32(N));var Q=E.nextPow2(r*h);Z.length<Q&&(C.free(Z),Z=C.mallocDouble(Q))}(Y,N+s);var V,U=0,l=2*Y;a(U++,0,0,N,0,s,h?16:0,-1/0,1/0),h||a(U++,0,0,s,0,N,1,-1/0,1/0);for(;U>0;){var n=(U-=1)*e,v=X[n],g=X[n+1],z=X[n+2],O=X[n+3],o=X[n+4],f=X[n+5],L=U*r,u=Z[L],i=Z[L+1],R=1&f,B=!!(16&f),t=W,F=I,J=x,j=A;if(R&&(t=x,F=A,J=W,j=I),!(2&f&&g>=(z=y(Y,v,g,z,t,F,i)))&&!(4&f&&(g=d(Y,v,g,z,t,F,u))>=z)){var S=z-g,mY=o-O;if(B){if(Y*S*(S+mY)<M){if(void 0!==(V=H.scanComplete(Y,v,c,g,z,t,F,O,o,J,j)))return V;continue}}else{if(Y*Math.min(S,mY)<q){if(void 0!==(V=Q(Y,v,c,R,g,z,t,F,O,o,J,j)))return V;continue}if(Y*S*mY<k){if(void 0!==(V=H.scanBipartite(Y,v,c,R,g,z,t,F,O,o,J,j)))return V;continue}}var YY=p(Y,v,g,z,t,F,u,i);if(g<YY)if(Y*(YY-g)<q){if(void 0!==(V=b(Y,v+1,c,g,YY,t,F,O,o,J,j)))return V}else if(v===Y-2){if(void 0!==(V=R?H.sweepBipartite(Y,c,O,o,J,j,g,YY,t,F):H.sweepBipartite(Y,c,g,YY,t,F,O,o,J,j)))return V}else a(U++,v+1,g,YY,O,o,R,-1/0,1/0),a(U++,v+1,O,o,g,YY,1^R,-1/0,1/0);if(YY<z){var cY=w(Y,v,O,o,J,j),hY=J[l*cY+v],CY=P(Y,v,cY,o,J,j,hY);if(CY<o&&a(U++,v,YY,z,CY,o,(4|R)+(B?16:0),hY,i),O<cY&&a(U++,v,YY,z,O,cY,(2|R)+(B?16:0),u,hY),cY+1===CY){if(void 0!==(V=B?K(Y,v,c,YY,z,t,F,cY,J,j[cY]):G(Y,v,c,R,YY,z,t,F,cY,J,j[cY])))return V}else if(cY<CY){var EY;if(B){if(YY<(EY=D(Y,v,YY,z,t,F,hY))){var NY=P(Y,v,YY,EY,t,F,hY);if(v===Y-2){if(YY<NY&&void 0!==(V=H.sweepComplete(Y,c,YY,NY,t,F,cY,CY,J,j)))return V;if(NY<EY&&void 0!==(V=H.sweepBipartite(Y,c,NY,EY,t,F,cY,CY,J,j)))return V}else YY<NY&&a(U++,v+1,YY,NY,cY,CY,16,-1/0,1/0),NY<EY&&(a(U++,v+1,NY,EY,cY,CY,0,-1/0,1/0),a(U++,v+1,cY,CY,NY,EY,1,-1/0,1/0))}}else YY<(EY=R?T(Y,v,YY,z,t,F,hY):D(Y,v,YY,z,t,F,hY))&&(v===Y-2?V=R?H.sweepBipartite(Y,c,cY,CY,J,j,YY,EY,t,F):H.sweepBipartite(Y,c,YY,EY,t,F,cY,CY,J,j):(a(U++,v+1,YY,EY,cY,CY,R,-1/0,1/0),a(U++,v+1,cY,CY,YY,EY,1^R,-1/0,1/0)))}}}}};var C=h(14785),E=h(14791),N=h(14831),Q=N.partial,b=N.full,H=h(14816),w=h(14834),W=h(14842),q=128,k=1<<22,M=1<<22,p=W("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),P=W("lo===p0",["p0"]),y=W("lo<p0",["p0"]),d=W("hi<=p0",["p0"]),D=W("lo<=p0&&p0<=hi",["p0"]),T=W("lo<p0&&p0<=hi",["p0"]),e=6,r=2,X=C.mallocInt32(1024),Z=C.mallocDouble(1024);function a(Y,c,h,C,E,N,Q,b,H){var w=e*Y;X[w]=c,X[w+1]=h,X[w+2]=C,X[w+3]=E,X[w+4]=N,X[w+5]=Q;var W=r*Y;Z[W]=b,Z[W+1]=H}function G(Y,c,h,C,E,N,Q,b,H,w,W){var q=2*Y,k=H*q,M=w[k+c];Y:for(var p=E,P=E*q;p<N;++p,P+=q){var y=Q[P+c],d=Q[P+c+Y];if(!(M<y||d<M)&&(!C||M!==y)){for(var D,T=b[p],e=c+1;e<Y;++e){y=Q[P+e],d=Q[P+e+Y];var r=w[k+e],X=w[k+e+Y];if(d<r||X<y)continue Y}if(void 0!==(D=C?h(W,T):h(T,W)))return D}}}function K(Y,c,h,C,E,N,Q,b,H,w){var W=2*Y,q=b*W,k=H[q+c];Y:for(var M=C,p=C*W;M<E;++M,p+=W){var P=Q[M];if(P!==w){var y=N[p+c],d=N[p+c+Y];if(!(k<y||d<k)){for(var D=c+1;D<Y;++D){y=N[p+D],d=N[p+D+Y];var T=H[q+D],e=H[q+D+Y];if(d<T||e<y)continue Y}var r=h(P,w);if(void 0!==r)return r}}}}},14834:(Y,c,h)=>{"use strict";Y.exports=function(Y,c,h,Q,b,H){if(Q<=h+1)return h;var w=h,W=Q,q=Q+h>>>1,k=2*Y,M=q,p=b[k*q+c];for(;w<W;){if(W-w<E){N(Y,c,w,W,b,H),p=b[k*q+c];break}var P=W-w,y=Math.random()*P+w|0,d=b[k*y+c],D=Math.random()*P+w|0,T=b[k*D+c],e=Math.random()*P+w|0,r=b[k*e+c];d<=T?r>=T?(M=D,p=T):d>=r?(M=y,p=d):(M=e,p=r):T>=r?(M=D,p=T):r>=d?(M=y,p=d):(M=e,p=r);for(var X=k*(W-1),Z=k*M,a=0;a<k;++a,++X,++Z){var G=b[X];b[X]=b[Z],b[Z]=G}var K=H[W-1];H[W-1]=H[M],H[M]=K;for(X=k*(W-1),Z=k*(M=C(Y,c,w,W-1,b,H,p)),a=0;a<k;++a,++X,++Z){G=b[X];b[X]=b[Z],b[Z]=G}K=H[W-1];if(H[W-1]=H[M],H[M]=K,q<M){for(W=M-1;w<W&&b[k*(W-1)+c]===p;)W-=1;W+=1}else{if(!(M<q))break;for(w=M+1;w<W&&b[k*w+c]===p;)w+=1}}return C(Y,c,h,q,b,H,b[k*q+c])};var C=h(14842)("lo<p0",["p0"]),E=8;function N(Y,c,h,C,E,N){for(var Q=2*Y,b=Q*(h+1)+c,H=h+1;H<C;++H,b+=Q)for(var w=E[b],W=H,q=Q*(H-1);W>h&&E[q+c]>w;--W,q-=Q){for(var k=q,M=q+Q,p=0;p<Q;++p,++k,++M){var P=E[k];E[k]=E[M],E[M]=P}var y=N[W];N[W]=N[W-1],N[W-1]=y}}},14842:Y=>{"use strict";Y.exports=function(Y,h){var C="abcdef".split("").concat(h),E=[];Y.indexOf("lo")>=0&&E.push("lo=e[k+n]");Y.indexOf("hi")>=0&&E.push("hi=e[k+o]");return C.push(c.replace("_",E.join()).replace("$",Y)),Function.apply(void 0,C)};var c="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14822:Y=>{"use strict";Y.exports=function(Y,C){C<=4*c?h(0,C-1,Y):w(0,C-1,Y)};var c=32;function h(Y,c,h){for(var C=2*(Y+1),E=Y+1;E<=c;++E){for(var N=h[C++],Q=h[C++],b=E,H=C-2;b-- >Y;){var w=h[H-2],W=h[H-1];if(w<N)break;if(w===N&&W<Q)break;h[H]=w,h[H+1]=W,H-=2}h[H]=N,h[H+1]=Q}}function C(Y,c,h){c*=2;var C=h[Y*=2],E=h[Y+1];h[Y]=h[c],h[Y+1]=h[c+1],h[c]=C,h[c+1]=E}function E(Y,c,h){c*=2,h[Y*=2]=h[c],h[Y+1]=h[c+1]}function N(Y,c,h,C){c*=2,h*=2;var E=C[Y*=2],N=C[Y+1];C[Y]=C[c],C[Y+1]=C[c+1],C[c]=C[h],C[c+1]=C[h+1],C[h]=E,C[h+1]=N}function Q(Y,c,h,C,E){c*=2,E[Y*=2]=E[c],E[c]=h,E[Y+1]=E[c+1],E[c+1]=C}function b(Y,c,h){c*=2;var C=h[Y*=2],E=h[c];return!(C<E)&&(C!==E||h[Y+1]>h[c+1])}function H(Y,c,h,C){var E=C[Y*=2];return E<c||E===c&&C[Y+1]<h}function w(Y,W,q){var k=(W-Y+1)/6|0,M=Y+k,p=W-k,P=Y+W>>1,y=P-k,d=P+k,D=M,T=y,e=P,r=d,X=p,Z=Y+1,a=W-1,G=0;b(D,T,q)&&(G=D,D=T,T=G),b(r,X,q)&&(G=r,r=X,X=G),b(D,e,q)&&(G=D,D=e,e=G),b(T,e,q)&&(G=T,T=e,e=G),b(D,r,q)&&(G=D,D=r,r=G),b(e,r,q)&&(G=e,e=r,r=G),b(T,X,q)&&(G=T,T=X,X=G),b(T,e,q)&&(G=T,T=e,e=G),b(r,X,q)&&(G=r,r=X,X=G);for(var K=q[2*T],I=q[2*T+1],s=q[2*r],x=q[2*r+1],A=2*D,V=2*e,U=2*X,l=2*M,n=2*P,v=2*p,g=0;g<2;++g){var z=q[A+g],O=q[V+g],o=q[U+g];q[l+g]=z,q[n+g]=O,q[v+g]=o}E(y,Y,q),E(d,W,q);for(var f=Z;f<=a;++f)if(H(f,K,I,q))f!==Z&&C(f,Z,q),++Z;else if(!H(f,s,x,q))for(;;){if(H(a,s,x,q)){H(a,K,I,q)?(N(f,Z,a,q),++Z,--a):(C(f,a,q),--a);break}if(--a<f)break}Q(Y,Z-1,K,I,q),Q(W,a+1,s,x,q),Z-2-Y<=c?h(Y,Z-2,q):w(Y,Z-2,q),W-(a+2)<=c?h(a+2,W,q):w(a+2,W,q),a-Z<=c?h(Z,a,q):w(Z,a,q)}},14816:(Y,c,h)=>{"use strict";Y.exports={init:function(Y){var c=E.nextPow2(Y);H.length<c&&(C.free(H),H=C.mallocInt32(c));w.length<c&&(C.free(w),w=C.mallocInt32(c));W.length<c&&(C.free(W),W=C.mallocInt32(c));q.length<c&&(C.free(q),q=C.mallocInt32(c));k.length<c&&(C.free(k),k=C.mallocInt32(c));M.length<c&&(C.free(M),M=C.mallocInt32(c));var h=8*c;p.length<h&&(C.free(p),p=C.mallocDouble(h))},sweepBipartite:function(Y,c,h,C,E,b,k,M,d,D){for(var T=0,e=2*Y,r=Y-1,X=e-1,Z=h;Z<C;++Z){var a=b[Z],G=e*Z;p[T++]=E[G+r],p[T++]=-(a+1),p[T++]=E[G+X],p[T++]=a}for(Z=k;Z<M;++Z){a=D[Z]+Q;var K=e*Z;p[T++]=d[K+r],p[T++]=-a,p[T++]=d[K+X],p[T++]=a}var I=T>>>1;N(p,I);var s=0,x=0;for(Z=0;Z<I;++Z){var A=0|p[2*Z+1];if(A>=Q)P(W,q,x--,A=A-Q|0);else if(A>=0)P(H,w,s--,A);else if(A<=-Q){A=-A-Q|0;for(var V=0;V<s;++V){if(void 0!==(U=c(H[V],A)))return U}y(W,q,x++,A)}else{A=-A-1|0;for(V=0;V<x;++V){var U;if(void 0!==(U=c(A,W[V])))return U}y(H,w,s++,A)}}},sweepComplete:function(Y,c,h,C,E,Q,b,d,D,T){for(var e=0,r=2*Y,X=Y-1,Z=r-1,a=h;a<C;++a){var G=Q[a]+1<<1,K=r*a;p[e++]=E[K+X],p[e++]=-G,p[e++]=E[K+Z],p[e++]=G}for(a=b;a<d;++a){G=T[a]+1<<1;var I=r*a;p[e++]=D[I+X],p[e++]=1|-G,p[e++]=D[I+Z],p[e++]=1|G}var s=e>>>1;N(p,s);var x=0,A=0,V=0;for(a=0;a<s;++a){var U=0|p[2*a+1],l=1&U;if(a<s-1&&U>>1===p[2*a+3]>>1&&(l=2,a+=1),U<0){for(var n=-(U>>1)-1,v=0;v<V;++v){if(void 0!==(g=c(k[v],n)))return g}if(0!==l)for(v=0;v<x;++v){if(void 0!==(g=c(H[v],n)))return g}if(1!==l)for(v=0;v<A;++v){var g;if(void 0!==(g=c(W[v],n)))return g}0===l?y(H,w,x++,n):1===l?y(W,q,A++,n):2===l&&y(k,M,V++,n)}else{n=(U>>1)-1;0===l?P(H,w,x--,n):1===l?P(W,q,A--,n):2===l&&P(k,M,V--,n)}}},scanBipartite:function(Y,c,h,C,E,b,W,q,k,M,d,D){var T=0,e=2*Y,r=c,X=c+Y,Z=1,a=1;C?a=Q:Z=Q;for(var G=E;G<b;++G){var K=G+Z,I=e*G;p[T++]=W[I+r],p[T++]=-K,p[T++]=W[I+X],p[T++]=K}for(G=k;G<M;++G){K=G+a;var s=e*G;p[T++]=d[s+r],p[T++]=-K}var x=T>>>1;N(p,x);var A=0;for(G=0;G<x;++G){var V=0|p[2*G+1];if(V<0){var U=!1;if((K=-V)>=Q?(U=!C,K-=Q):(U=!!C,K-=1),U)y(H,w,A++,K);else{var l=D[K],n=e*K,v=d[n+c+1],g=d[n+c+1+Y];Y:for(var z=0;z<A;++z){var O=H[z],o=e*O;if(!(g<W[o+c+1]||W[o+c+1+Y]<v)){for(var f=c+2;f<Y;++f)if(d[n+f+Y]<W[o+f]||W[o+f+Y]<d[n+f])continue Y;var L,u=q[O];if(void 0!==(L=C?h(l,u):h(u,l)))return L}}}}else P(H,w,A--,V-Z)}},scanComplete:function(Y,c,h,C,E,b,w,W,q,k,M){for(var P=0,y=2*Y,d=c,D=c+Y,T=C;T<E;++T){var e=T+Q,r=y*T;p[P++]=b[r+d],p[P++]=-e,p[P++]=b[r+D],p[P++]=e}for(T=W;T<q;++T){e=T+1;var X=y*T;p[P++]=k[X+d],p[P++]=-e}var Z=P>>>1;N(p,Z);var a=0;for(T=0;T<Z;++T){var G=0|p[2*T+1];if(G<0){if((e=-G)>=Q)H[a++]=e-Q;else{var K=M[e-=1],I=y*e,s=k[I+c+1],x=k[I+c+1+Y];Y:for(var A=0;A<a;++A){var V=H[A],U=w[V];if(U===K)break;var l=y*V;if(!(x<b[l+c+1]||b[l+c+1+Y]<s)){for(var n=c+2;n<Y;++n)if(k[I+n+Y]<b[l+n]||b[l+n+Y]<k[I+n])continue Y;var v=h(U,K);if(void 0!==v)return v}}}}else{for(e=G-Q,A=a-1;A>=0;--A)if(H[A]===e){for(n=A+1;n<a;++n)H[n-1]=H[n];break}--a}}}};var C=h(14785),E=h(14791),N=h(14822),Q=1<<28,b=1024,H=C.mallocInt32(b),w=C.mallocInt32(b),W=C.mallocInt32(b),q=C.mallocInt32(b),k=C.mallocInt32(b),M=C.mallocInt32(b),p=C.mallocDouble(8192);function P(Y,c,h,C){var E=c[C],N=Y[h-1];Y[E]=N,c[N]=E}function y(Y,c,h,C){Y[h]=C,c[C]=h}},14799:Y=>{"use strict";function c(Y,h,C){var E=0|Y[C];if(E<=0)return[];var N,Q=new Array(E);if(C===Y.length-1)for(N=0;N<E;++N)Q[N]=h;else for(N=0;N<E;++N)Q[N]=c(Y,h,C+1);return Q}Y.exports=function(Y,h){switch("undefined"===typeof h&&(h=0),typeof Y){case"number":if(Y>0)return function(Y,c){var h,C;for(h=new Array(Y),C=0;C<Y;++C)h[C]=c;return h}(0|Y,h);break;case"object":if("number"===typeof Y.length)return c(Y,h,0)}return[]}},14740:(Y,c,h)=>{Y.exports=function(){var Y=this;this.components={},this.comps=this.components;var c=this.components,h=1,E={},N=[],Q=[],b={timeout:!1,removals:[],multiComps:[]};function H(Y,h){var C=c[h],N=E[h],Q=N.hash[Y];Q&&(N.remove(Y),C.Nc&&(C.multi?(Q.forEach((c=>{c&&C.Nc(Y,c)})),Q.length=0):C.Nc(Y,Q)),b.removals.push(N),w())}function w(){b.timeout||(b.timeout=!0,setTimeout(W,1))}function W(){b.timeout=!1,q()}function q(){b.multiComps.length&&function(Y){for(var c=0;c<Y.length;c++){var{entID:h,data:C}=Y[c],E=C.hash[h];if(E){for(var N=0;N<E.length;N++)E[N]||(E.splice(N,1),N--);0===E.length&&(C.remove(h),b.removals.push(C))}}Y.length=0}(b.multiComps),b.removals.length&&function(Y){for(var c=0;c<Y.length;c++){Y[c].flush()}Y.length=0}(b.removals)}this.cM=E,this._systems=N,this._renderSystems=Q,this.UW=function(c){var C=h++;return Array.isArray(c)&&c.forEach((c=>Y.aW(C,c))),C},this.deleteEntity=function(c){return Object.keys(E).forEach((Y=>{E[Y].hash[c]&&H(c,Y)})),Y},this.Ek=function(Y){if(!Y)throw new Error("Missing component definition");var h=Y.name;if(!h)throw new Error("Component definition must have a name property.");if("string"!==typeof h)throw new Error("Component name must be a string.");if(""===h)throw new Error("Component name must be a non-empty string.");if(E[h])throw new Error(`Component ${h} already exists.`);var b={};return b.name=h,b.multi=!!Y.multi,b.order=isNaN(Y.order)?99:Y.order,b.stateConstructor=Y.stateConstructor||null,b.state=Y.state||{},b.Ub=Y.Ub||null,b.Nc=Y.Nc||null,b.system=Y.system||null,b.Kw=Y.Kw||null,c[h]=b,E[h]=new C,E[h]._pendingMultiCleanup=!1,E[h]._multiCleanupIDs=b.multi?[]:null,b.system&&(N.push(h),N.sort(((Y,h)=>c[Y].order-c[h].order))),b.Kw&&(Q.push(h),Q.sort(((Y,h)=>c[Y].order-c[h].order))),h},this.overwriteComponent=function(Y,h){var C=c[Y];if(!C)throw new Error(`Unknown component: ${Y}`);if(!h)throw new Error("Missing component definition");if(C.name!==h.name)throw new Error("Overwriting component must use the same name property.");var b={};b.name=Y,b.multi=!!h.multi,b.order=isNaN(h.order)?99:h.order,b.state=h.state||{},b.Ub=h.Ub||null,b.Nc=h.Nc||null,b.system=h.system||null,b.Kw=h.Kw||null,c[Y]=b,E[Y]._pendingMultiCleanup=!1,E[Y]._multiCleanupIDs=b.multi?[]:null;var H=N.indexOf(Y);b.system&&H<0&&N.push(Y),!b.system&&H>=0&&N.splice(H,1),N.sort(((Y,h)=>c[Y].order-c[h].order));var w=Q.indexOf(Y);b.Kw&&w<0&&Q.push(Y),!b.Kw&&w>=0&&Q.splice(w,1),Q.sort(((Y,h)=>c[Y].order-c[h].order));var W=b.state;return this.Xq(Y).forEach((Y=>{for(var c in W)c in Y||(Y[c]=W[c]);b.Ub&&b.Ub(Y.aw,Y)})),Y},this.deleteComponent=function(h){var C=E[h];if(!C)throw new Error(`Unknown component: ${h}`);C.flush(),C.list.forEach((Y=>{Y&&H(Y.aw||Y[0].aw,h)}));var b=N.indexOf(h),w=Q.indexOf(h);return b>-1&&N.splice(b,1),w>-1&&Q.splice(w,1),E[h].dispose(),delete E[h],delete c[h],Y},this.aW=function(Y,h,C){var N,Q=c[h],b=E[h];if(!b)throw new Error(`Unknown component: ${h}.`);if(b.hash[Y]&&!Q.multi)throw new Error(`Entity ${Y} already has component: ${h}.`);if(Q.stateConstructor){if(!(N=new Q.stateConstructor).hasOwnProperty("aw"))throw new Error(`Component ${Q.name} stateConstructor type does not have property __id`)}else N=Object.assign({},{aw:Y},Q.state,C);if(N.aw=Y,Q.multi){var H=b.hash[Y];H||(H=[],b.add(Y,H)),H.push(N)}else b.add(Y,N);return Q.Ub&&Q.Ub(Y,N),this},this.vW=function(Y,c){var h=E[c];if(!h)throw new Error(`Unknown component: ${c}.`);return!!h.hash[Y]},this.sW=function(c,h){if(!E[h])throw new Error(`Unknown component: ${h}.`);return H(c,h),Y},this.getState=function(Y,c){var h=E[c];if(!h)throw new Error(`Unknown component: ${c}.`);return h.hash[Y]},this.Xq=function(Y){var c=E[Y];if(!c)throw new Error(`Unknown component: ${Y}.`);return q(),c.list},this.Rp=function(Y){if(!E[Y])throw new Error(`Unknown component: ${Y}.`);var c=E[Y].hash;return Y=>c[Y]},this.Fp=function(Y){if(!E[Y])throw new Error(`Unknown component: ${Y}.`);var c=E[Y].hash;return Y=>!!c[Y]},this.rw=function(h){q();for(var C=0;C<N.length;C++){var Q=N[C],b=c[Q],H=E[Q];b.system(h,H.list),q()}return Y},this.render=function(h){q();for(var C=0;C<Q.length;C++){var N=Q[C],b=c[N],H=E[N];b.Kw(h,H.list),q()}return Y},this.removeMultiComponent=function(h,C,N){var Q=c[C],H=E[C];if(!H)throw new Error(`Unknown component: ${C}.`);if(!Q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Y,c,h,C){var E=h.hash[Y];if(E){var N=E[C];N&&(E[C]=null,c.Nc&&c.Nc(Y,N),b.multiComps.push({entID:Y,data:h}),w())}}(h,Q,H,N),Y}};var C=h(14747)},14747:Y=>{function c(Y,c){var h=Y._map[c];if(delete Y.hash[c],delete Y._map[c],h===Y.list.length-1)Y.list.pop();else{var C=Y.list.pop();if(Y.list[h]=C,null===C||null===C[0]){var E=Y.list.length;for(var N in Y._map)if(Y._map[N]===E)return void(Y._map[N]=h)}else{var Q=C.aw||C[0].aw;Y._map[Q]=h}}}Y.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Y,c){if("number"===typeof this._map[Y]){var h=this._map[Y];this.hash[Y]=c,this.list[h]=c}else this._map[Y]=this.list.length,this.hash[Y]=c,this.list.push(c)}remove(Y){var c=this._map[Y];this.hash[Y]=null,this.list[c]=null,this._pendingRemovals.push(Y)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Y=0;Y<this._pendingRemovals.length;Y++){var h=this._pendingRemovals[Y];null===this.hash[h]&&c(this,h)}this._pendingRemovals.length=0}}},14698:Y=>{"use strict";var c,h="object"===typeof Reflect?Reflect:null,C=function(Y,c,h){return Function.prototype.apply.call(Y,c,h)};c=h&&"function"===typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(Y){return Object.getOwnPropertyNames(Y).concat(Object.getOwnPropertySymbols(Y))}:function(Y){return Object.getOwnPropertyNames(Y)};var E=Number.isNaN||function(Y){return Y!==Y};function N(){N.init.call(this)}Y.exports=N,Y.exports.once=function(Y,c){return new Promise((function(h,C){function E(h){Y.removeListener(c,N),C(h)}function N(){"function"===typeof Y.removeListener&&Y.removeListener("error",E),h([].slice.call(arguments))}P(Y,c,N,{once:!0}),"error"!==c&&function(Y,c,h){"function"===typeof Y.on&&P(Y,"error",c,h)}(Y,E,{once:!0})}))},N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var Q=10;function b(Y){if("function"!==typeof Y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Y)}function H(Y){return void 0===Y._maxListeners?N.defaultMaxListeners:Y._maxListeners}function w(Y,c,h,C){var E,N,Q,w;if(b(h),void 0===(N=Y._events)?(N=Y._events=Object.create(null),Y._eventsCount=0):(void 0!==N.newListener&&(Y.emit("newListener",c,h.listener?h.listener:h),N=Y._events),Q=N[c]),void 0===Q)Q=N[c]=h,++Y._eventsCount;else if("function"===typeof Q?Q=N[c]=C?[h,Q]:[Q,h]:C?Q.unshift(h):Q.push(h),(E=H(Y))>0&&Q.length>E&&!Q.warned){Q.warned=!0;var W=new Error("Possible EventEmitter memory leak detected. "+Q.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");W.name="MaxListenersExceededWarning",W.Cc=Y,W.type=c,W.count=Q.length,w=W,console&&console.warn&&console.warn(w)}return Y}function W(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function q(Y,c,h){var C={fired:!1,wrapFn:void 0,target:Y,type:c,listener:h},E=W.bind(C);return E.listener=h,C.wrapFn=E,E}function k(Y,c,h){var C=Y._events;if(void 0===C)return[];var E=C[c];return void 0===E?[]:"function"===typeof E?h?[E.listener||E]:[E]:h?function(Y){for(var c=new Array(Y.length),h=0;h<c.length;++h)c[h]=Y[h].listener||Y[h];return c}(E):p(E,E.length)}function M(Y){var c=this._events;if(void 0!==c){var h=c[Y];if("function"===typeof h)return 1;if(void 0!==h)return h.length}return 0}function p(Y,c){for(var h=new Array(c),C=0;C<c;++C)h[C]=Y[C];return h}function P(Y,c,h,C){if("function"===typeof Y.on)C.once?Y.once(c,h):Y.on(c,h);else{if("function"!==typeof Y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Y);Y.addEventListener(c,(function E(N){C.once&&Y.removeEventListener(c,E),h(N)}))}}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return Q},set:function(Y){if("number"!==typeof Y||Y<0||E(Y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Y+".");Q=Y}}),N.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(Y){if("number"!==typeof Y||Y<0||E(Y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Y+".");return this._maxListeners=Y,this},N.prototype.getMaxListeners=function(){return H(this)},N.prototype.emit=function(Y){for(var c=[],h=1;h<arguments.length;h++)c.push(arguments[h]);var E="error"===Y,N=this._events;if(void 0!==N)E=E&&void 0===N.error;else if(!E)return!1;if(E){var Q;if(c.length>0&&(Q=c[0]),Q instanceof Error)throw Q;var b=new Error("Unhandled error."+(Q?" ("+Q.message+")":""));throw b.context=Q,b}var H=N[Y];if(void 0===H)return!1;if("function"===typeof H)C(H,this,c);else{var w=H.length,W=p(H,w);for(h=0;h<w;++h)C(W[h],this,c)}return!0},N.prototype.addListener=function(Y,c){return w(this,Y,c,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(Y,c){return w(this,Y,c,!0)},N.prototype.once=function(Y,c){return b(c),this.on(Y,q(this,Y,c)),this},N.prototype.prependOnceListener=function(Y,c){return b(c),this.prependListener(Y,q(this,Y,c)),this},N.prototype.removeListener=function(Y,c){var h,C,E,N,Q;if(b(c),void 0===(C=this._events))return this;if(void 0===(h=C[Y]))return this;if(h===c||h.listener===c)0===--this._eventsCount?this._events=Object.create(null):(delete C[Y],C.removeListener&&this.emit("removeListener",Y,h.listener||c));else if("function"!==typeof h){for(E=-1,N=h.length-1;N>=0;N--)if(h[N]===c||h[N].listener===c){Q=h[N].listener,E=N;break}if(E<0)return this;0===E?h.shift():function(Y,c){for(;c+1<Y.length;c++)Y[c]=Y[c+1];Y.pop()}(h,E),1===h.length&&(C[Y]=h[0]),void 0!==C.removeListener&&this.emit("removeListener",Y,Q||c)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.Ec=function(Y){var c,h,C;if(void 0===(h=this._events))return this;if(void 0===h.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==h[Y]&&(0===--this._eventsCount?this._events=Object.create(null):delete h[Y]),this;if(0===arguments.length){var E,N=Object.keys(h);for(C=0;C<N.length;++C)"removeListener"!==(E=N[C])&&this.Ec(E);return this.Ec("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(c=h[Y]))this.removeListener(Y,c);else if(void 0!==c)for(C=c.length-1;C>=0;C--)this.removeListener(Y,c[C]);return this},N.prototype.listeners=function(Y){return k(this,Y,!0)},N.prototype.rawListeners=function(Y){return k(this,Y,!1)},N.listenerCount=function(Y,c){return"function"===typeof Y.listenerCount?Y.listenerCount(c):M.call(Y,c)},N.prototype.listenerCount=M,N.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},15167:Y=>{"use strict";Y.exports=function(Y,c,h,C,E,N){var Q=+c[0],b=+c[1],H=+c[2],w=+h[0],W=+h[1],q=+h[2],k=Math.sqrt(w*w+W*W+q*q);if(0===k)throw new Error("Can't raycast along a zero vector");return function(Y,c,h,C,E,N,Q,b,H,w){for(var W=0,q=Math.floor,k=0|q(c),M=0|q(h),p=0|q(C),P=E>0?1:-1,y=N>0?1:-1,d=Q>0?1:-1,D=Math.abs(1/E),T=Math.abs(1/N),e=Math.abs(1/Q),r=D<1/0?D*(P>0?k+1-c:c-k):1/0,X=T<1/0?T*(y>0?M+1-h:h-M):1/0,Z=e<1/0?e*(d>0?p+1-C:C-p):1/0,a=-1;W<=b;){var G=Y(k,M,p);if(G)return H&&(H[0]=c+W*E,H[1]=h+W*N,H[2]=C+W*Q),w&&(w[0]=w[1]=w[2]=0,0===a&&(w[0]=-P),1===a&&(w[1]=-y),2===a&&(w[2]=-d)),G;r<X?r<Z?(k+=P,W=r,r+=D,a=0):(p+=d,W=Z,Z+=e,a=2):X<Z?(M+=y,W=X,X+=T,a=1):(p+=d,W=Z,Z+=e,a=2)}return H&&(H[0]=c+W*E,H[1]=h+W*N,H[2]=C+W*Q),w&&(w[0]=w[1]=w[2]=0),0}(Y,Q,b,H,w/=k,W/=k,q/=k,C="undefined"===typeof C?64:+C,E,N)}},15206:(Y,c,h)=>{"use strict";h.d(c,{d:()=>N});var C=h(14698);function E(){this.iM=!1,this.stopPropagation=!1,this.RM=!1,this.disabled=!1}class N{constructor(Y,c){this.version="0.7.0";var h=Object.assign({},new E,c||{});this.element=Y||document,this.iM=!!h.iM,this.stopPropagation=!!h.stopPropagation,this.RM=!!h.RM,this.disabled=!!h.disabled,this.filterEvents=(Y,c)=>!0,this.down=new C.EventEmitter,this.up=new C.EventEmitter,this.state={},this.dq={dx:0,dy:0,lp:0,yq:0,np:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?b(this):document.addEventListener("DOMContentLoaded",(Y=>{b(this)}),{once:!0})}bind(Y){for(var c=arguments.length,h=new Array(c>1?c-1:0),C=1;C<c;C++)h[C-1]=arguments[C];h.forEach((c=>{var h=this._keyBindmap[c]||[];h.includes(Y)||(h.push(Y),this._keyBindmap[c]=h)})),this.state[Y]=!!this.state[Y],this.pressCount[Y]=this.pressCount[Y]||0,this.releaseCount[Y]=this.releaseCount[Y]||0}unbind(Y){for(var c in this._keyBindmap){var h=this._keyBindmap[c],C=h.indexOf(Y);C>-1&&h.splice(C,1)}}getBindings(){var Y={};for(var c in this._keyBindmap){this._keyBindmap[c].forEach((h=>{Y[h]=Y[h]||[],Y[h].push(c)}))}return Y}rw(){Q(this.dq),Q(this.pressCount),Q(this.releaseCount)}}function Q(Y){for(var c in Y)Y[c]=0}function b(Y){window.addEventListener("keydown",p.bind(null,Y,!0),!1),window.addEventListener("keyup",p.bind(null,Y,!1),!1);var c={passive:!0};Y.element.addEventListener("touchstart",q.bind(void 0,Y),{passive:!1}),Y.element.addEventListener("touchend",M.bind(void 0,Y),c),Y.element.addEventListener("mousedown",P.bind(null,Y,!0),c),window.document.addEventListener("mouseup",P.bind(null,Y,!1),c),Y.element.addEventListener("touchmove",y.bind(null,Y),c),Y.element.addEventListener("mousemove",y.bind(null,Y),c),window.PointerEvent,Y.element.addEventListener("wheel",d.bind(null,Y),c),Y.element.addEventListener("contextmenu",D.bind(null,Y),!1),window.addEventListener("blur",T.bind(null,Y),!1)}var H=0,w=0,W=null;function q(Y,c){c.preventDefault(),k(c)}function k(Y){let c=!1;for(let h=0;h<Y.touches.length;++h)if(Y.touches[h].identifier===W){c=!0;break}if(!c){const c=Y.changedTouches[0];H=c.clientX,w=c.clientY,W=c.identifier}}function M(Y,c){for(var h=c.changedTouches,C=0;C<h.length;++C)h[C].identifier===W&&(W=null)}function p(Y,c,h){e(h.code,c,Y,h)}function P(Y,c,h){if("pointerId"in h)if(c){if(null!==Y._touches.currID)return;Y._touches.currID=h.pointerId}else{if(Y._touches.currID!==h.pointerId)return;Y._touches.currID=null}return e("Mouse"+("button"in h?h.button+1:1),c,Y,h),!1}function y(Y,c){var h=c.movementX||c.mozMovementX||0,C=c.movementY||c.mozMovementY||0;if(c.touches&&0===(h|C)){var E=function(Y){k(Y);for(let c=0;c<Y.changedTouches.length;++c)if(Y.changedTouches[c].identifier==W){const h=Y.changedTouches[c],C=[h.clientX-H,h.clientY-w];return H=h.clientX,w=h.clientY,C}return console.error(`Did not find touch id ${W}`),[0,0]}(c);h=E[0],C=E[1]}Y.dq.dx+=h,Y.dq.dy+=C}function d(Y,c){var h=1;switch(c.deltaMode){case 0:h=1;break;case 1:h=12;break;case 2:h=Y.element.clientHeight||window.innerHeight}Y.dq.lp+=(c.deltaX||0)*h,Y.dq.yq+=(c.deltaY||0)*h,Y.dq.np+=(c.deltaZ||0)*h}function D(Y,c){if(!Y.RM)return c.preventDefault(),!1}function T(Y){for(var c in Y._keyStates)Y._keyStates[c]&&(/^Mouse\d/.test(c)||e(c,!1,Y,{code:c,note:"hxmuoaj34gv",preventDefault:()=>{},stopPropagation:()=>{}}))}function e(Y,c,h,C){var E=h._keyBindmap[Y];E&&(r(h._keyStates[Y],c)&&(h._keyStates[Y]=c,E.forEach((Y=>{(!h.filterEvents||h.filterEvents(C,Y))&&function(Y,c,h,C){var E=c?h.pressCount:h.releaseCount;E[Y]=(E[Y]||0)+1;var N=h._bindPressCount[Y]||0;(N+=c?1:-1)<0&&(N=0);h._bindPressCount[Y]=N;var Q=h.state[Y];if(r(Q,N)){h.state[Y]=N>0;var b=c?h.down:h.up;h.disabled||b.emit(Y,C)}}(Y,c,h,C)}))),"button"in C||(h.iM&&!C.defaultPrevented&&C.preventDefault(),h.stopPropagation&&C.stopPropagation()))}function r(Y,c){return Y?!c:c}},13758:Y=>{Y.exports=function(Y,c,h){return Y[0]=c[0]+h[0],Y[1]=c[1]+h[1],Y[2]=c[2]+h[2],Y}},13721:(Y,c,h)=>{Y.exports=function(Y,c){var h=C(Y[0],Y[1],Y[2]),Q=C(c[0],c[1],c[2]);E(h,h),E(Q,Q);var b=N(h,Q);return b>1?0:Math.acos(b)};var C=h(13723),E=h(13728),N=h(13731)},13819:Y=>{Y.exports=function(Y,c){return Y[0]=Math.ceil(c[0]),Y[1]=Math.ceil(c[1]),Y[2]=Math.ceil(c[2]),Y}},13713:Y=>{Y.exports=function(Y){var c=new Float32Array(3);return c[0]=Y[0],c[1]=Y[1],c[2]=Y[2],c}},13739:Y=>{Y.exports=function(Y,c){return Y[0]=c[0],Y[1]=c[1],Y[2]=c[2],Y}},13708:Y=>{Y.exports=function(){var Y=new Float32Array(3);return Y[0]=0,Y[1]=0,Y[2]=0,Y}},13892:Y=>{Y.exports=function(Y,c,h){var C=c[0],E=c[1],N=c[2],Q=h[0],b=h[1],H=h[2];return Y[0]=E*H-N*b,Y[1]=N*Q-C*H,Y[2]=C*b-E*Q,Y}},13846:(Y,c,h)=>{Y.exports=h(13842)},13842:Y=>{Y.exports=function(Y,c){var h=c[0]-Y[0],C=c[1]-Y[1],E=c[2]-Y[2];return Math.sqrt(h*h+C*C+E*E)}},13795:(Y,c,h)=>{Y.exports=h(13792)},13792:Y=>{Y.exports=function(Y,c,h){return Y[0]=c[0]/h[0],Y[1]=c[1]/h[1],Y[2]=c[2]/h[2],Y}},13731:Y=>{Y.exports=function(Y,c){return Y[0]*c[0]+Y[1]*c[1]+Y[2]*c[2]}},13704:Y=>{Y.exports=1e-6},13750:(Y,c,h)=>{Y.exports=function(Y,c){var h=Y[0],E=Y[1],N=Y[2],Q=c[0],b=c[1],H=c[2];return Math.abs(h-Q)<=C*Math.max(1,Math.abs(h),Math.abs(Q))&&Math.abs(E-b)<=C*Math.max(1,Math.abs(E),Math.abs(b))&&Math.abs(N-H)<=C*Math.max(1,Math.abs(N),Math.abs(H))};var C=h(13704)},13752:Y=>{Y.exports=function(Y,c){return Y[0]===c[0]&&Y[1]===c[1]&&Y[2]===c[2]}},13812:Y=>{Y.exports=function(Y,c){return Y[0]=Math.floor(c[0]),Y[1]=Math.floor(c[1]),Y[2]=Math.floor(c[2]),Y}},13935:(Y,c,h)=>{Y.exports=function(Y,c,h,E,N,Q){var b,H;c||(c=3);h||(h=0);H=E?Math.min(E*c+h,Y.length):Y.length;for(b=h;b<H;b+=c)C[0]=Y[b],C[1]=Y[b+1],C[2]=Y[b+2],N(C,C,Q),Y[b]=C[0],Y[b+1]=C[1],Y[b+2]=C[2];return Y};var C=h(13708)()},13723:Y=>{Y.exports=function(Y,c,h){var C=new Float32Array(3);return C[0]=Y,C[1]=c,C[2]=h,C}},13698:(Y,c,h)=>{Y.exports={EPSILON:h(13704),create:h(13708),clone:h(13713),angle:h(13721),kw:h(13723),j:h(13739),set:h(13742),equals:h(13750),exactEquals:h(13752),add:h(13758),Hh:h(13765),sub:h(13771),multiply:h(13779),mul:h(13784),divide:h(13792),div:h(13795),min:h(13798),max:h(13804),floor:h(13812),ceil:h(13819),round:h(13822),scale:h(13827),Mw:h(13835),distance:h(13842),k:h(13846),squaredDistance:h(13848),sqrDist:h(13852),length:h(13857),len:h(13866),squaredLength:h(13869),pw:h(13874),negate:h(13878),inverse:h(13886),normalize:h(13728),dot:h(13731),cross:h(13892),Cw:h(13896),random:h(13900),transformMat4:h(13905),transformMat3:h(13914),transformQuat:h(13917),Pw:h(13923),yw:h(13927),dw:h(13929),forEach:h(13935)}},13886:Y=>{Y.exports=function(Y,c){return Y[0]=1/c[0],Y[1]=1/c[1],Y[2]=1/c[2],Y}},13866:(Y,c,h)=>{Y.exports=h(13857)},13857:Y=>{Y.exports=function(Y){var c=Y[0],h=Y[1],C=Y[2];return Math.sqrt(c*c+h*h+C*C)}},13896:Y=>{Y.exports=function(Y,c,h,C){var E=c[0],N=c[1],Q=c[2];return Y[0]=E+C*(h[0]-E),Y[1]=N+C*(h[1]-N),Y[2]=Q+C*(h[2]-Q),Y}},13804:Y=>{Y.exports=function(Y,c,h){return Y[0]=Math.max(c[0],h[0]),Y[1]=Math.max(c[1],h[1]),Y[2]=Math.max(c[2],h[2]),Y}},13798:Y=>{Y.exports=function(Y,c,h){return Y[0]=Math.min(c[0],h[0]),Y[1]=Math.min(c[1],h[1]),Y[2]=Math.min(c[2],h[2]),Y}},13784:(Y,c,h)=>{Y.exports=h(13779)},13779:Y=>{Y.exports=function(Y,c,h){return Y[0]=c[0]*h[0],Y[1]=c[1]*h[1],Y[2]=c[2]*h[2],Y}},13878:Y=>{Y.exports=function(Y,c){return Y[0]=-c[0],Y[1]=-c[1],Y[2]=-c[2],Y}},13728:Y=>{Y.exports=function(Y,c){var h=c[0],C=c[1],E=c[2],N=h*h+C*C+E*E;N>0&&(N=1/Math.sqrt(N),Y[0]=c[0]*N,Y[1]=c[1]*N,Y[2]=c[2]*N);return Y}},13900:Y=>{Y.exports=function(Y,c){c=c||1;var h=2*Math.random()*Math.PI,C=2*Math.random()-1,E=Math.sqrt(1-C*C)*c;return Y[0]=Math.cos(h)*E,Y[1]=Math.sin(h)*E,Y[2]=C*c,Y}},13923:Y=>{Y.exports=function(Y,c,h,C){var E=h[1],N=h[2],Q=c[1]-E,b=c[2]-N,H=Math.sin(C),w=Math.cos(C);return Y[0]=c[0],Y[1]=E+Q*w-b*H,Y[2]=N+Q*H+b*w,Y}},13927:Y=>{Y.exports=function(Y,c,h,C){var E=h[0],N=h[2],Q=c[0]-E,b=c[2]-N,H=Math.sin(C),w=Math.cos(C);return Y[0]=E+b*H+Q*w,Y[1]=c[1],Y[2]=N+b*w-Q*H,Y}},13929:Y=>{Y.exports=function(Y,c,h,C){var E=h[0],N=h[1],Q=c[0]-E,b=c[1]-N,H=Math.sin(C),w=Math.cos(C);return Y[0]=E+Q*w-b*H,Y[1]=N+Q*H+b*w,Y[2]=c[2],Y}},13822:Y=>{Y.exports=function(Y,c){return Y[0]=Math.round(c[0]),Y[1]=Math.round(c[1]),Y[2]=Math.round(c[2]),Y}},13827:Y=>{Y.exports=function(Y,c,h){return Y[0]=c[0]*h,Y[1]=c[1]*h,Y[2]=c[2]*h,Y}},13835:Y=>{Y.exports=function(Y,c,h,C){return Y[0]=c[0]+h[0]*C,Y[1]=c[1]+h[1]*C,Y[2]=c[2]+h[2]*C,Y}},13742:Y=>{Y.exports=function(Y,c,h,C){return Y[0]=c,Y[1]=h,Y[2]=C,Y}},13852:(Y,c,h)=>{Y.exports=h(13848)},13874:(Y,c,h)=>{Y.exports=h(13869)},13848:Y=>{Y.exports=function(Y,c){var h=c[0]-Y[0],C=c[1]-Y[1],E=c[2]-Y[2];return h*h+C*C+E*E}},13869:Y=>{Y.exports=function(Y){var c=Y[0],h=Y[1],C=Y[2];return c*c+h*h+C*C}},13771:(Y,c,h)=>{Y.exports=h(13765)},13765:Y=>{Y.exports=function(Y,c,h){return Y[0]=c[0]-h[0],Y[1]=c[1]-h[1],Y[2]=c[2]-h[2],Y}},13914:Y=>{Y.exports=function(Y,c,h){var C=c[0],E=c[1],N=c[2];return Y[0]=C*h[0]+E*h[3]+N*h[6],Y[1]=C*h[1]+E*h[4]+N*h[7],Y[2]=C*h[2]+E*h[5]+N*h[8],Y}},13905:Y=>{Y.exports=function(Y,c,h){var C=c[0],E=c[1],N=c[2],Q=h[3]*C+h[7]*E+h[11]*N+h[15];return Q=Q||1,Y[0]=(h[0]*C+h[4]*E+h[8]*N+h[12])/Q,Y[1]=(h[1]*C+h[5]*E+h[9]*N+h[13])/Q,Y[2]=(h[2]*C+h[6]*E+h[10]*N+h[14])/Q,Y}},13917:Y=>{Y.exports=function(Y,c,h){var C=c[0],E=c[1],N=c[2],Q=h[0],b=h[1],H=h[2],w=h[3],W=w*C+b*N-H*E,q=w*E+H*C-Q*N,k=w*N+Q*E-b*C,M=-Q*C-b*E-H*N;return Y[0]=W*w+M*-Q+q*-H-k*-b,Y[1]=q*w+M*-b+k*-Q-W*-H,Y[2]=k*w+M*-H+W*-b-q*-Q,Y}},14724:Y=>{"use strict";Y.exports=function(Y){for(var c=new Array(Y),h=0;h<Y;++h)c[h]=h;return c}},14807:Y=>{Y.exports=function(Y){return null!=Y&&null!=Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}},15176:(Y,c,h)=>{"use strict";h.d(c,{e:()=>C});class C{constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ak=!1,this.Gk=!1,this.Xk=30,this.Zk=0,this.lk=!1,this.fullscreen=!1,this.Ik=function(Y){},this.sk=function(){},this.Vk=function(){},this.Qc=function(){},this.xk=function(Y){},this.onFullscreenChanged=function(Y){},w((()=>{!function(Y,c){Y._nowObject=performance||Date,Y._lastTick=0,Y._renderAccum=0,Y._rt=0,Y._frameCB=b.bind(null,Y),requestAnimationFrame(Y._frameCB),c>0&&(Y._intervalCB=Q.bind(null,Y),Y._interval=setInterval(Y._intervalCB,Math.max(c,1e3/Y.Xk/2)))}(this,c),function(Y,c){if(!c)return;var h=!1,C=!1;document.addEventListener("pointerlockchange",(C=>{h=document.pointerLockElement===c,Y.xk(h)})),document.addEventListener("fullscreenchange",(h=>{C=document.fullscreenElement===c,Y.onFullscreenChanged(C)})),Object.defineProperty(Y,"lk",{get:()=>h,set:Y=>{Y&&!h?H(c):h&&!Y&&function(Y){Y.exitPointerLock&&Y.exitPointerLock()}(document)}}),Object.defineProperty(Y,"fullscreen",{get:()=>C,set:Y=>{Y&&!C?c.requestFullscreen():C&&!Y&&document.exitFullscreen()}}),c.addEventListener("click",(E=>{Y.ak&&!h&&H(c),Y.Gk&&!C&&c.requestFullscreen()}));var E=()=>Y.Qc();if(window.ResizeObserver){new ResizeObserver(E).observe(c)}else window.addEventListener("resize",E)}(this,Y),this.Vk()}))}}var E=3,N=20;function Q(Y){for(var c=1e3/Y.Xk,h=Y._nowObject.now()+N,C=0;Y._nowObject.now()>=Y._lastTick+c&&Y._nowObject.now()<h&&++C<=E;)Y.Ik(c),Y._lastTick+=c;var Q=5*(c+5),b=Y._nowObject.now();if(b-Y._lastTick>Q)for(;b>=Y._lastTick+c;)Y._lastTick+=c}function b(Y){requestAnimationFrame(Y._frameCB),Q(Y);var c=Y._nowObject.now(),h=c-Y._rt;if(Y._rt=c,Y.Zk>0){Y._renderAccum+=h;var C=1e3/Y.Zk;if(Y._renderAccum<C)return;Y._renderAccum=Math.min(Y._renderAccum-C,C)}var E=1e3/Y.Xk,N=(c-Y._lastTick)/E;Y.sk(h,N,E)}function H(Y){Y.requestPointerLock&&Y.requestPointerLock()}var w=Y=>{if("loading"===document.readyState){var c=()=>{document.removeEventListener("readystatechange",c),Y()};document.addEventListener("readystatechange",c)}else setTimeout(Y,1)}},14716:(Y,c,h)=>{var C=h(14724),E=h(14727),N="undefined"!==typeof Float64Array;function Q(Y,c){return Y[0]-c[0]}function b(){var Y,c=this.stride,h=new Array(c.length);for(Y=0;Y<h.length;++Y)h[Y]=[Math.abs(c[Y]),Y];h.sort(Q);var C=new Array(h.length);for(Y=0;Y<C.length;++Y)C[Y]=h[Y][1];return C}function H(Y,c){var h=["View",c,"d",Y].join("");c<0&&(h="View_Nil"+Y);var E="generic"===Y;if(-1===c){var N="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+Y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(N)()}if(0===c){N="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+Y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",N)(w[Y][0])}N=["'use strict'"];var Q=C(c),H=Q.map((function(Y){return"i"+Y})),W="this.offset+"+Q.map((function(Y){return"this.stride["+Y+"]*i"+Y})).join("+"),q=Q.map((function(Y){return"b"+Y})).join(","),k=Q.map((function(Y){return"c"+Y})).join(",");N.push("function "+h+"(a,"+q+","+k+",d){this.data=a","this.shape=["+q+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+Y+"'","proto.dimension="+c),N.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+Q.map((function(Y){return"this.shape["+Y+"]"})).join("*"),"}})"),1===c?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),c<4?(N.push("function "+h+"_order(){"),2===c?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+h+"_set("+H.join(",")+",v){"),E?N.push("return this.data.set("+W+",v)}"):N.push("return this.data["+W+"]=v}"),N.push("proto.get=function "+h+"_get("+H.join(",")+"){"),E?N.push("return this.data.get("+W+")}"):N.push("return this.data["+W+"]}"),N.push("proto.index=function "+h+"_index(",H.join(),"){return "+W+"}"),N.push("proto.hi=function "+h+"_hi("+H.join(",")+"){return new "+h+"(this.data,"+Q.map((function(Y){return["(typeof i",Y,"!=='number'||i",Y,"<0)?this.shape[",Y,"]:i",Y,"|0"].join("")})).join(",")+","+Q.map((function(Y){return"this.stride["+Y+"]"})).join(",")+",this.offset)}");var M=Q.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})),p=Q.map((function(Y){return"c"+Y+"=this.stride["+Y+"]"}));N.push("proto.lo=function "+h+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+M.join(",")+","+p.join(","));for(var P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");N.push("return new "+h+"(this.data,"+Q.map((function(Y){return"a"+Y})).join(",")+","+Q.map((function(Y){return"c"+Y})).join(",")+",b)}"),N.push("proto.step=function "+h+"_step("+H.join(",")+"){var "+Q.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})).join(",")+","+Q.map((function(Y){return"b"+Y+"=this.stride["+Y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");N.push("return new "+h+"(this.data,"+Q.map((function(Y){return"a"+Y})).join(",")+","+Q.map((function(Y){return"b"+Y})).join(",")+",c)}");var y=new Array(c),d=new Array(c);for(P=0;P<c;++P)y[P]="a[i"+P+"]",d[P]="b[i"+P+"]";N.push("proto.transpose=function "+h+"_transpose("+H+"){"+H.map((function(Y,c){return Y+"=("+Y+"===undefined?"+c+":"+Y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+y.join(",")+","+d.join(",")+",this.offset)}"),N.push("proto.pick=function "+h+"_pick("+H+"){var a=[],b=[],c=this.offset");for(P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+Q.map((function(Y){return"shape["+Y+"]"})).join(",")+","+Q.map((function(Y){return"stride["+Y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(w[Y],b)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Y.exports=function(Y,c,h,C){if(void 0===Y)return(0,w.array[0])([]);"number"===typeof Y&&(Y=[Y]),void 0===c&&(c=[Y.length]);var Q=c.length;if(void 0===h){h=new Array(Q);for(var b=Q-1,W=1;b>=0;--b)h[b]=W,W*=c[b]}if(void 0===C){C=0;for(b=0;b<Q;++b)h[b]<0&&(C-=(c[b]-1)*h[b])}for(var q=function(Y){if(E(Y))return"buffer";if(N)switch(Object.prototype.toString.call(Y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Y)?"array":"generic"}(Y),k=w[q];k.length<=Q+1;)k.push(H(q,k.length-1));return(0,k[Q+1])(Y,c,h,C)}},14727:Y=>{function c(Y){return!!Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}Y.exports=function(Y){return null!=Y&&(c(Y)||function(Y){return"function"===typeof Y.readFloatLE&&"function"===typeof Y.slice&&c(Y.slice(0,0))}(Y)||!!Y._isBuffer)}},14895:Y=>{"use strict";var c=[],h=[],C=[],E=[],N=[],Q=[],b=[],H=[],w=[],W=[],q=[],k=[];Y.exports=function(Y,M,p,P,y,d){for(var D=b,T=w,e=W,r=k,X=0;X<3;X++)D[X]=+p[X],e[X]=+M.max[X],T[X]=+M.base[X];d||(d=1e-10);var Z=function(Y,b,w,W,k,M){var p=c,P=h,y=C,d=E,D=N,T=Q,e=H,r=Math.floor,X=0,Z=0,a=0,G=0,K=0;if(I(),0===a)return 0;for(G=A();Z<=a;){if(s(G)&&x())return X;G=A()}for(X+=a,K=0;K<3;K++)W[K]+=w[K],k[K]+=w[K];return X;function I(){if(Z=0,0!==(a=Math.sqrt(w[0]*w[0]+w[1]*w[1]+w[2]*w[2])))for(var Y=0;Y<3;Y++){var c=w[Y]>=0;d[Y]=c?1:-1;var h=c?k[Y]:W[Y];p[Y]=c?W[Y]:k[Y],P[Y]=V(h,d[Y]),y[Y]=U(p[Y],d[Y]),e[Y]=w[Y]/a,D[Y]=Math.abs(1/e[Y]);var C=c?P[Y]+1-h:h-P[Y];T[Y]=D[Y]<1/0?D[Y]*C:1/0}}function s(c){for(var h=d[0],C=0===c?P[0]:y[0],E=P[0]+h,N=d[1],Q=1===c?P[1]:y[1],b=P[1]+N,H=d[2],w=2===c?P[2]:y[2],W=P[2]+H,q=C;q!=E;q+=h)for(var k=Q;k!=b;k+=N)for(var M=w;M!=W;M+=H)if(Y(q,k,M))return!0;return!1}function x(){X+=Z;var Y=d[G],c=Z/a,h=q;for(K=0;K<3;K++){var C=w[K]*c;W[K]+=C,k[K]+=C,h[K]=w[K]-C}if(Y>0?k[G]=Math.round(k[G]):W[G]=Math.round(W[G]),b(X,G,Y,h))return!0;for(K=0;K<3;K++)w[K]=h[K];return I(),0===a}function A(){var Y=T[0]<T[1]?T[0]<T[2]?0:2:T[1]<T[2]?1:2,c=T[Y]-Z;for(Z=T[Y],P[Y]+=d[Y],T[Y]+=D[Y],K=0;K<3;K++)p[K]+=c*e[K],y[K]=U(p[K],d[K]);return Y}function V(Y,c){return r(Y-c*M)}function U(Y,c){return r(Y+c*M)}}(Y,P,D,T,e,d);if(!y){for(X=0;X<3;X++)r[X]=p[X]>0?e[X]-M.max[X]:T[X]-M.base[X];M.translate(r)}return Z}},15209:(Y,c,h)=>{"use strict";h.d(c,{c:()=>q});var C=h(14891),E=h(13698);class N{constructor(Y,c,h,N,Q,b,H){this.rq=new C(Y.base,Y.zq),this.ME=c,this.friction=h,this.restitution=N,this.JH=Q,this.CP=b,this.jH=!!H,this.gq=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.LP=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.oW=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(Y){E.j(this.rq.base,Y.rq.base),E.j(this.rq.zq,Y.rq.zq),E.j(this.rq.max,Y.rq.max),this.rq.mag=Y.rq.mag,this.ME=Y.ME,this.friction=Y.friction,this.restitution=Y.restitution,this.JH=Y.JH,this.CP=Y.CP,this.jH=Y.jH,this.gq=Y.gq,this.fluidDrag=Y.fluidDrag,this.LP=Y.LP,this.preventFallOffEdge=Y.preventFallOffEdge,this.rolledBackLastTick=Y.rolledBackLastTick,E.j(this.oW,Y.oW),E.j(this.resting,Y.resting),this.inFluid=Y.inFluid,this._ratioInFluid=Y._ratioInFluid,E.j(this._forces,Y._forces),E.j(this._impulses,Y._impulses),this._sleepFrameCount=Y._sleepFrameCount}setPosition(Y){Q(Y),E.Hh(Y,Y,this.rq.base),this.rq.translate(Y),this.fW()}bc(){return E.clone(this.rq.base)}applyForce(Y){Q(Y),E.add(this._forces,this._forces,Y),this.fW()}applyImpulse(Y){Q(Y),E.add(this._impulses,this._impulses,Y),this.fW()}fW(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Q=Y=>{};var b=h(14891),H=h(13698),w=h(14895);function W(){this.gq=.1,this.fluidDrag=.4,this.hw=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function q(Y,c,h){Y=Object.assign(new W,Y),this.gravity=Y.gravity||[0,-10,0],this.gq=Y.gq||.1,this.hw=Y.hw||2,this.fluidDrag=Y.fluidDrag||.4,this.minBounceImpulse=Y.minBounceImpulse,this.bodies=[],this.Zp=Y.Zp,this.testSolid=c,this.testFluid=h}q.prototype.WP=function(Y,c,h,C,E,Q){Y=Y||new b([0,0,0],[1,1,1]),"undefined"==typeof c&&(c=1),"undefined"==typeof h&&(h=1),"undefined"==typeof C&&(C=0),"undefined"==typeof E&&(E=1);var H=new N(Y,c,h,C,E,Q);return this.bodies.push(H),H},q.prototype.qP=function(Y){var c=this.bodies.indexOf(Y);c<0||(this.bodies.splice(c,1),Y.rq=Y.CP=null)};var k=H.create(),M=H.create(),p=H.create(),P=H.create(),y=H.create(),d=H.create(),D=H.create(),T=new b([0,0,0],[1,1,1]),e=new N(T,1,1,0,1,(()=>{}),!1);function r(Y,c,h){return c=h,c*=1-(1-Y.ratioInFluid)**2}q.prototype.rw=function(Y){Y/=1e3;var c=z(0,H.squaredLength(this.gravity));this.bodies.forEach((h=>function(Y,c,h,C){H.j(y,c.resting),Y.Zp&&e.loadFromCopy(c);if(c.ME<=0)return H.set(c.oW,0,0,0),H.set(c._forces,0,0,0),void H.set(c._impulses,0,0,0);var E=C||0===c.JH;if(function(Y,c,h,C){if(c._sleepFrameCount>0)return!1;if(C)return!0;var E=!1,N=.5*h*h*c.JH;return H.scale(g,Y.gravity,N),w(Y.testSolid,c.rq,g,(function(){return E=!0,!0}),!0),E}(Y,c,h,E))return;c._sleepFrameCount--,function(Y,c){var h=c.rq,C=Math.floor(h.base[0]),E=Math.floor(h.base[2]),N=Math.floor(h.base[1]),Q=Math.floor(h.max[1]);if(!Y.testFluid(C,N,E))return c.inFluid=!1,void(c.ratioInFluid=0);var b=1,w=N+1;for(;w<=Q&&Y.testFluid(C,w,E);)b++,w++;var W=(N+b-h.base[1])/h.zq[1];W>1&&(W=1);var q=h.zq[0]*h.zq[1]*h.zq[2]*W,k=Z;H.scale(k,Y.gravity,-Y.hw*q*c.JH),c.applyForce(k),c.inFluid=!0,c.ratioInFluid=W}(Y,c),o(c._forces),o(c._impulses),o(c.oW),o(c.resting),H.scale(k,c._forces,1/c.ME),H.Mw(k,k,Y.gravity,c.JH),H.scale(M,c._impulses,1/c.ME),H.Mw(M,M,k,h),H.add(c.oW,c.oW,M),c.friction&&(a(Y,0,c,M,h),a(Y,1,c,M,h),a(Y,2,c,M,h));var N=c.fluidDrag>=0?c.fluidDrag:Y.fluidDrag,Q=c.gq>=0?c.gq:Y.gq,b=Q,W=Q;c.inFluid&&(b=r(c,b,c.fluidDragHoriz>=0?c.fluidDragHoriz:N),W=r(c,W,c.fluidDragVert>=0?c.fluidDragVert:N));b=Math.max(1-b*h/c.ME,0),W=Math.max(1-W*h/c.ME,0),H.set(X,b,W,b),H.multiply(c.oW,c.oW,X),H.scale(p,c.oW,h),H.set(c._forces,0,0,0),H.set(c._impulses,0,0,0),c.jH&&O(I,c.rq);H.j(d,p),H.set(D,0,0,0),c.preventFallOffEdge&&function(Y,c,h,C){if(!c.resting[1]||h[1]>0)return;var E=l;O(E,c.rq);for(var N=0;N<3;N+=2){H.set(U,0,0,0),U[N]=h[N];var Q=!0;(Q=(Q=(Q=(Q=Q&&!v(Y,E.base[0]+U[0]+1e-5,E.base[1],E.base[2]+U[2]+1e-5))&&!v(Y,E.max[0]+U[0]-1e-5,E.base[1],E.base[2]+U[2]+1e-5))&&!v(Y,E.base[0]+U[0]+1e-5,E.base[1],E.max[2]+U[2]-1e-5))&&!v(Y,E.max[0]+U[0]-1e-5,E.base[1],E.max[2]+U[2]-1e-5))?(C[N]=h[N]>0?1:-1,h[N]=0):0===N&&(H.set(n,h[0],0,0),K(Y,E,n,C,c.slideOnCollision))}}(Y,c,p,D);K(Y,c.rq,p,c.resting,c.slideOnCollision),c.jH&&function(Y,c,h,C){if(c.resting[1]>=0&&!c.inFluid)return;var E=0!==c.resting[0],N=0!==c.resting[2];if(!E&&!N)return;var Q=Math.abs(C[0]/C[2]),b=4;if(!E&&Q>b)return;if(!N&&Q<1/b)return;H.add(x,h.base,C);var W=Y.testSolid;w(W,h,C,(function(Y,c,h,C){if(1!==c)return!0;C[c]=0}));var q=h.base[1],k=c.inFluid?1.951:1.001,M=Math.floor(q+k)-q;H.set(A,0,M,0);var p=!1;if(w(W,h,A,(function(Y,c,h,C){return p=!0,!0})),p)return;H.Hh(V,x,h.base),V[1]=0,K(Y,h,V,s,!0);var P=z(h.base[0],x[0]),y=z(h.base[2],x[2]);if(E&&!P&&(!y||!N))return;if(N&&(!P||!E)&&!y)return;var d=!0;if(d=d&&!v(Y,h.base[0]+1e-5,h.base[1],h.base[2]+1e-5),d=d&&!v(Y,h.max[0]-1e-5,h.base[1],h.base[2]+1e-5),d=d&&!v(Y,h.base[0]+1e-5,h.base[1],h.max[2]-1e-5),d=d&&!v(Y,h.max[0]-1e-5,h.base[1],h.max[2]-1e-5),d)return;O(c.rq,h),c.resting[0]=s[0],c.resting[2]=s[2],c.LP&&c.LP()}(Y,c,I,d);for(var q=0;q<3;++q)c.resting[q]=c.resting[q]||D[q],P[q]=0,c.resting[q]&&(y[q]||(P[q]=-c.oW[q]),c.oW[q]=0);var T=H.length(P);T>.001&&(H.scale(P,P,c.ME),c.CP&&c.CP(P),c.restitution>0&&T>Y.minBounceImpulse&&(H.scale(P,P,c.restitution),c.applyImpulse(P)));var G=H.squaredLength(c.oW);G>1e-5&&c.fW();Y.Zp&&Y.Zp(c)?(c.loadFromCopy(e),c.rolledBackLastTick=!0):c.rolledBackLastTick=!1}(this,h,Y,c)))};var X=H.create([0,0,0]);var Z=H.create();function a(Y,c,h,C,E){var N=h.resting[c],Q=C[c];if(!h.alwaysApplyHorizFriction||1!==c){if(0===N)return;if(N*Q<=0)return}H.j(G,h.oW),G[c]=0;var b=H.length(G);if(!z(b,0)){var w=Math.abs(h.friction*Y.gravity[c]*E),W=b>w?(b-w)/b:0;h.oW[(c+1)%3]*=W,h.oW[(c+2)%3]*=W}}var G=H.create();function K(Y,c,h,C,E){return H.set(C,0,0,0),w(Y.testSolid,c,h,(function(Y,c,h,N){C[c]=h,N[c]=0,E||(N[0]=0,N[1]=0,N[2]=0)}))}var I=new b([],[]),s=H.create(),x=H.create(),A=H.create(),V=H.create();var U=H.create(),l=new b([],[]),n=H.create();function v(Y,c,h,C){return Y.testSolid(Math.floor(c),Math.floor(h-1),Math.floor(C))}var g=H.create();function z(Y,c){return Math.abs(Y-c)<1e-5}function O(Y,c){for(var h=0;h<3;h++)Y.base[h]=c.base[h],Y.max[h]=c.max[h],Y.zq[h]=c.zq[h]}var o=function(Y){}},13574:function(Y,c){!function(Y){"use strict";var c=function(Y,h){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,c){Y.__proto__=c}||function(Y,c){for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(Y[h]=c[h])},c(Y,h)};function h(Y,h){if("function"!==typeof h&&null!==h)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function C(){this.constructor=Y}c(Y,h),Y.prototype=null===h?Object.create(h):(C.prototype=h.prototype,new C)}function C(Y,c,h,C){var E,N=arguments.length,Q=N<3?c:null===C?C=Object.getOwnPropertyDescriptor(c,h):C;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Q=Reflect.decorate(Y,c,h,C);else for(var b=Y.length-1;b>=0;b--)(E=Y[b])&&(Q=(N<3?E(Q):N>3?E(c,h,Q):E(c,h))||Q);return N>3&&Q&&Object.defineProperty(c,h,Q),Q}function E(Y,c,h){if(h||2===arguments.length)for(var C,E=0,N=c.length;E<N;E++)!C&&E in c||(C||(C=Array.prototype.slice.call(c,0,E)),C[E]=c[E]);return Y.concat(C||Array.prototype.slice.call(c))}var N,Q=255,b=213;Y.OPERATION=void 0,(N=Y.OPERATION||(Y.OPERATION={}))[N.ADD=128]="ADD",N[N.REPLACE=0]="REPLACE",N[N.DELETE=64]="DELETE",N[N.DELETE_AND_ADD=192]="DELETE_AND_ADD",N[N.TOUCH=1]="TOUCH",N[N.CLEAR=10]="CLEAR";var H=function(){function c(Y,c,h){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Y,this.setParent(c,h)}return c.prototype.setParent=function(Y,c,h){var C=this;if(this.indexes||(this.indexes=this.ref instanceof VY?this.ref._definition.indexes:{}),this.parent=Y,this.parentIndex=h,c)if(this.root=c,this.ref instanceof VY){var E=this.ref._definition;for(var N in E.schema){var Q=this.ref[N];if(Q&&Q.$changes){var b=E.indexes[N];Q.$changes.setParent(this.ref,c,b)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Y,c){if(Y instanceof VY){var h=Y.$changes,E=C.ref.$changes.indexes[c];h.setParent(C.ref,C.root,E)}}))},c.prototype.operation=function(Y){this.changes.set(--this.currentCustomOperation,Y)},c.prototype.change=function(c,h){void 0===h&&(h=Y.OPERATION.ADD);var C="number"===typeof c?c:this.indexes[c];this.assertValidIndex(C,c);var E=this.changes.get(C);E&&E.op!==Y.OPERATION.DELETE&&E.op!==Y.OPERATION.TOUCH||this.changes.set(C,{op:E&&E.op===Y.OPERATION.DELETE?Y.OPERATION.DELETE_AND_ADD:h,index:C}),this.allChanges.add(C),this.changed=!0,this.touchParents()},c.prototype.touch=function(c){var h="number"===typeof c?c:this.indexes[c];this.assertValidIndex(h,c),this.changes.has(h)||this.changes.set(h,{op:Y.OPERATION.TOUCH,index:h}),this.allChanges.add(h),this.touchParents()},c.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},c.prototype.getType=function(Y){if(this.ref._definition)return(c=this.ref._definition).schema[c.fieldsByIndex[Y]];var c,h=(c=this.parent._definition).schema[c.fieldsByIndex[this.parentIndex]];return Object.values(h)[0]},c.prototype.getChildrenFilter=function(){var Y=this.parent._definition.childFilters;return Y&&Y[this.parentIndex]},c.prototype.getValue=function(Y){return this.ref.getByIndex(Y)},c.prototype.delete=function(c){var h="number"===typeof c?c:this.indexes[c];if(void 0!==h){var C=this.getValue(h);this.changes.set(h,{op:Y.OPERATION.DELETE,index:h}),this.allChanges.delete(h),delete this.caches[h],C&&C.$changes&&(C.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(c," (").concat(h,")"))},c.prototype.discard=function(c,h){var C=this;void 0===c&&(c=!1),void 0===h&&(h=!1),this.ref instanceof VY||this.changes.forEach((function(c){if(c.op===Y.OPERATION.DELETE){var h=C.ref.getIndex(c.index);delete C.indexes[h]}})),this.changes.clear(),this.changed=c,h&&this.allChanges.clear(),this.currentCustomOperation=0},c.prototype.discardAll=function(){var Y=this;this.changes.forEach((function(c){var h=Y.getValue(c.index);h&&h.$changes&&h.$changes.discardAll()})),this.discard()},c.prototype.cache=function(Y,c){this.caches[Y]=c},c.prototype.clone=function(){return new c(this.ref,this.parent,this.root)},c.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},c.prototype.assertValidIndex=function(Y,c){if(void 0===Y)throw new Error('ChangeTree: missing index for field "'.concat(c,'"'))},c}();function w(Y,c,h,C){return Y[c]||(Y[c]=[]),Y[c].push(h),null===C||void 0===C||C.forEach((function(Y,c){return h(Y,c)})),function(){return q(Y[c],Y[c].indexOf(h))}}function W(c){var h=this,C="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,N){c.push({refId:h.$changes.refId,op:Y.OPERATION.DELETE,field:N,value:void 0,previousValue:E}),C&&h.$changes.root.removeRef(E.$changes.refId)}))}function q(Y,c){if(-1===c||c>=Y.length)return!1;for(var h=Y.length-1,C=c;C<h;C++)Y[C]=Y[C+1];return Y.length=h,!0}var k=function(Y,c){var h=Y.toString(),C=c.toString();return h<C?-1:h>C?1:0};function M(Y){return Y.$proxy=!0,Y=new Proxy(Y,{get:function(Y,c){return"symbol"===typeof c||isNaN(c)?Y[c]:Y.at(c)},set:function(Y,c,h){if("symbol"===typeof c||isNaN(c))Y[c]=h;else{var C=Array.from(Y.$items.keys()),E=parseInt(C[c]||c);void 0===h||null===h?Y.deleteAt(E):Y.setAt(E,h)}return!0},deleteProperty:function(Y,c){return"number"===typeof c?Y.deleteAt(c):delete Y[c],!0}})}var p=function(){function c(){for(var Y=[],c=0;c<arguments.length;c++)Y[c]=arguments[c];this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Y)}return c.prototype.Ub=function(c,h){return void 0===h&&(h=!0),w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,c,h?this.$items:void 0)},c.prototype.Nc=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,c)},c.is=function(Y){return Array.isArray(Y)||void 0!==Y.array},Object.defineProperty(c.prototype,"length",{get:function(){return this.$items.size},set:function(Y){0===Y?this.clear():this.splice(Y,this.length-Y)},enumerable:!1,configurable:!0}),c.prototype.push=function(){for(var Y,c=this,h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];return h.forEach((function(h){Y=c.$refId++,c.setAt(Y,h)})),Y},c.prototype.pop=function(){var Y=Array.from(this.$indexes.values()).pop();if(void 0!==Y){this.$changes.delete(Y),this.$indexes.delete(Y);var c=this.$items.get(Y);return this.$items.delete(Y),c}},c.prototype.at=function(Y){var c=Array.from(this.$items.keys())[Y];return this.$items.get(c)},c.prototype.setAt=function(c,h){var C,E;if(void 0!==h&&null!==h){if(this.$items.get(c)!==h){void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,c);var N=null!==(E=null===(C=this.$changes.indexes[c])||void 0===C?void 0:C.op)&&void 0!==E?E:Y.OPERATION.ADD;this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,h),this.$changes.change(c,N)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},c.prototype.deleteAt=function(Y){var c=Array.from(this.$items.keys())[Y];return void 0!==c&&this.$deleteAt(c)},c.prototype.$deleteAt=function(Y){return this.$changes.delete(Y),this.$indexes.delete(Y),this.$items.delete(Y)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&W.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.concat=function(){for(var Y,h=[],C=0;C<arguments.length;C++)h[C]=arguments[C];return new(c.bind.apply(c,E([void 0],(Y=Array.from(this.$items.values())).concat.apply(Y,h),!1)))},c.prototype.join=function(Y){return Array.from(this.$items.values()).join(Y)},c.prototype.reverse=function(){var Y=this,c=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(h,C){Y.setAt(c[C],h)})),this},c.prototype.shift=function(){var Y=Array.from(this.$items.keys()).shift();if(void 0!==Y){var c=this.$items.get(Y);return this.$deleteAt(Y),c}},c.prototype.slice=function(Y,h){var C=new c;return C.push.apply(C,Array.from(this.$items.values()).slice(Y,h)),C},c.prototype.sort=function(Y){var c=this;void 0===Y&&(Y=k);var h=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Y).forEach((function(Y,C){c.setAt(h[C],Y)})),this},c.prototype.splice=function(Y,c){void 0===c&&(c=this.length-Y);for(var h=Array.from(this.$items.keys()),C=[],E=Y;E<Y+c;E++)C.push(this.$items.get(h[E])),this.$deleteAt(h[E]);return C},c.prototype.unshift=function(){for(var Y=this,c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];var C=this.length,E=c.length,N=Array.from(this.$items.values());return c.forEach((function(c,h){Y.setAt(h,c)})),N.forEach((function(c,h){Y.setAt(E+h,c)})),C+E},c.prototype.indexOf=function(Y,c){return Array.from(this.$items.values()).indexOf(Y,c)},c.prototype.lastIndexOf=function(Y,c){return void 0===c&&(c=this.length-1),Array.from(this.$items.values()).lastIndexOf(Y,c)},c.prototype.every=function(Y,c){return Array.from(this.$items.values()).every(Y,c)},c.prototype.some=function(Y,c){return Array.from(this.$items.values()).some(Y,c)},c.prototype.forEach=function(Y,c){Array.from(this.$items.values()).forEach(Y,c)},c.prototype.map=function(Y,c){return Array.from(this.$items.values()).map(Y,c)},c.prototype.filter=function(Y,c){return Array.from(this.$items.values()).filter(Y,c)},c.prototype.reduce=function(Y,c){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},c.prototype.reduceRight=function(Y,c){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},c.prototype.find=function(Y,c){return Array.from(this.$items.values()).find(Y,c)},c.prototype.findIndex=function(Y,c){return Array.from(this.$items.values()).findIndex(Y,c)},c.prototype.fill=function(Y,c,h){throw new Error("ArraySchema#fill() not implemented")},c.prototype.copyWithin=function(Y,c,h){throw new Error("ArraySchema#copyWithin() not implemented")},c.prototype.toString=function(){return this.$items.toString()},c.prototype.toLocaleString=function(){return this.$items.toLocaleString()},c.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},c.prototype.includes=function(Y,c){return Array.from(this.$items.values()).includes(Y,c)},c.prototype.flatMap=function(Y,c){throw new Error("ArraySchema#flatMap() is not supported.")},c.prototype.flat=function(Y){throw new Error("ArraySchema#flat() is not supported.")},c.prototype.findLast=function(){var Y=Array.from(this.$items.values());return Y.findLast.apply(Y,arguments)},c.prototype.findLastIndex=function(){var Y=Array.from(this.$items.values());return Y.findLastIndex.apply(Y,arguments)},c.prototype.setIndex=function(Y,c){this.$indexes.set(Y,c)},c.prototype.getIndex=function(Y){return this.$indexes.get(Y)},c.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},c.prototype.deleteByIndex=function(Y){var c=this.$indexes.get(Y);this.$items.delete(c),this.$indexes.delete(Y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){return this.toArray().map((function(Y){return"function"===typeof Y.toJSON?Y.toJSON():Y}))},c.prototype.clone=function(Y){return Y?new(c.bind.apply(c,E([void 0],Array.from(this.$items.values()),!1))):new(c.bind.apply(c,E([void 0],this.map((function(Y){return Y.$changes?Y.clone():Y})),!1)))},c}();function P(Y){return Y.$proxy=!0,Y=new Proxy(Y,{get:function(Y,c){return"symbol"!==typeof c&&"undefined"===typeof Y[c]?Y.get(c):Y[c]},set:function(Y,c,h){return"symbol"!==typeof c&&-1===c.indexOf("$")&&"Ub"!==c&&"Nc"!==c&&"onChange"!==c?Y.set(c,h):Y[c]=h,!0},deleteProperty:function(Y,c){return Y.delete(c),!0}})}var y=function(){function c(Y){var h=this;if(this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y)if(Y instanceof Map||Y instanceof c)Y.forEach((function(Y,c){return h.set(c,Y)}));else for(var C in Y)this.set(C,Y[C])}return c.prototype.Ub=function(c,h){return void 0===h&&(h=!0),w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,c,h?this.$items:void 0)},c.prototype.Nc=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,c)},c.is=function(Y){return void 0!==Y.map},c.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(c,Symbol.species,{get:function(){return c},enumerable:!1,configurable:!0}),c.prototype.set=function(c,h){if(void 0===h||null===h)throw new Error("MapSchema#set('".concat(c,"', ").concat(h,"): trying to set ").concat(h," value on '").concat(c,"'."));c=c.toString();var C="undefined"!==typeof this.$changes.indexes[c],E=C?this.$changes.indexes[c]:this.$refId++,N=C?Y.OPERATION.REPLACE:Y.OPERATION.ADD,Q=void 0!==h.$changes;if(Q&&h.$changes.setParent(this,this.$changes.root,E),C){if(!Q&&this.$items.get(c)===h)return;Q&&this.$items.get(c)!==h&&(N=Y.OPERATION.ADD)}else this.$changes.indexes[c]=E,this.$indexes.set(E,c);return this.$items.set(c,h),this.$changes.change(c,N),this},c.prototype.get=function(Y){return this.$items.get(Y)},c.prototype.delete=function(Y){return this.$changes.delete(Y),this.$items.delete(Y)},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&W.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Y){return this.$items.has(Y)},c.prototype.forEach=function(Y){this.$items.forEach(Y)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.keys=function(){return this.$items.keys()},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Y,c){this.$indexes.set(Y,c)},c.prototype.getIndex=function(Y){return this.$indexes.get(Y)},c.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},c.prototype.deleteByIndex=function(Y){var c=this.$indexes.get(Y);this.$items.delete(c),this.$indexes.delete(Y)},c.prototype.toJSON=function(){var Y={};return this.forEach((function(c,h){Y[h]="function"===typeof c.toJSON?c.toJSON():c})),Y},c.prototype.clone=function(Y){var h;return Y?h=Object.assign(new c,this):(h=new c,this.forEach((function(Y,c){Y.$changes?h.set(c,Y.clone()):h.set(c,Y)}))),h},c}(),d={};function D(Y,c){d[Y]=c}function T(Y){return d[Y]}var e=function(){function Y(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Y.create=function(c){var h=new Y;return h.schema=Object.assign({},c&&c.schema||{}),h.indexes=Object.assign({},c&&c.indexes||{}),h.fieldsByIndex=Object.assign({},c&&c.fieldsByIndex||{}),h.descriptors=Object.assign({},c&&c.descriptors||{}),h.deprecated=Object.assign({},c&&c.deprecated||{}),h},Y.prototype.addField=function(Y,c){var h=this.getNextFieldIndex();this.fieldsByIndex[h]=Y,this.indexes[Y]=h,this.schema[Y]=Array.isArray(c)?{array:c[0]}:c},Y.prototype.hasField=function(Y){return void 0!==this.indexes[Y]},Y.prototype.addFilter=function(Y,c){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Y]]=c,this.indexesWithFilters.push(this.indexes[Y]),!0},Y.prototype.addChildrenFilter=function(Y,c){var h=this.indexes[Y],C=this.schema[Y];if(T(Object.keys(C)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[h]=c,!0;console.warn("@filterChildren: field '".concat(Y,"' can't have children. Ignoring filter."))},Y.prototype.getChildrenFilter=function(Y){return this.childFilters&&this.childFilters[this.indexes[Y]]},Y.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Y}();function r(Y){return Y._context&&Y._context.useFilters}var X=function(){function Y(){this.types={},this.schemas=new Map,this.useFilters=!1}return Y.prototype.has=function(Y){return this.schemas.has(Y)},Y.prototype.get=function(Y){return this.types[Y]},Y.prototype.add=function(Y,c){void 0===c&&(c=this.schemas.size),Y._definition=e.create(Y._definition),Y._typeid=c,this.types[c]=Y,this.schemas.set(Y,c)},Y.create=function(c){return void 0===c&&(c={}),function(h){return c.context||(c.context=new Y),a(h,c)}},Y}(),Z=new X;function a(Y,c){return void 0===c&&(c={}),function(h,C){var N=c.context||Z,Q=h.constructor;if(Q._context=N,!Y)throw new Error("".concat(Q.name,': @type() reference provided for "').concat(C,"\" is undefined. Make sure you don't have any circular dependencies."));N.has(Q)||N.add(Q);var b=Q._definition;if(b.addField(C,Y),b.descriptors[C]){if(b.deprecated[C])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(C,"' definition on '").concat(Q.name,"'.\nCheck @type() annotation"))}catch(d){var H=d.stack.split("\n")[4].trim();throw new Error("".concat(d.message," ").concat(H))}}var w=p.is(Y),W=!w&&y.is(Y);if("string"!==typeof Y&&!VY.is(Y)){var q=Object.values(Y)[0];"string"===typeof q||N.has(q)||N.add(q)}if(c.manual)b.descriptors[C]={enumerable:!0,configurable:!0,writable:!0};else{var k="_".concat(C);b.descriptors[k]={enumerable:!1,configurable:!1,writable:!0},b.descriptors[C]={get:function(){return this[k]},set:function(Y){Y!==this[k]&&(void 0!==Y&&null!==Y?(!w||Y instanceof p||(Y=new(p.bind.apply(p,E([void 0],Y,!1)))),!W||Y instanceof y||(Y=new y(Y)),void 0===Y.$proxy&&(W?Y=P(Y):w&&(Y=M(Y))),this.$changes.change(C),Y.$changes&&Y.$changes.setParent(this,this.$changes.root,this._definition.indexes[C])):this[k]&&this.$changes.delete(C),this[k]=Y)},enumerable:!0,configurable:!0}}}}function G(Y){return function(c,h){var C=c.constructor;C._definition.addFilter(h,Y)&&(C._context.useFilters=!0)}}function K(Y){return function(c,h){var C=c.constructor;C._definition.addChildrenFilter(h,Y)&&(C._context.useFilters=!0)}}function I(Y){return void 0===Y&&(Y=!0),function(c,h){var C=c.constructor._definition;C.deprecated[h]=!0,Y&&(C.descriptors[h]={get:function(){throw new Error("".concat(h," is deprecated."))},set:function(Y){},enumerable:!1,configurable:!0})}}function s(Y,c,h){for(var C in void 0===h&&(h={}),h.context||(h.context=Y._context||h.context||Z),c)a(c[C],h)(Y.prototype,C);return Y}function x(Y){for(var c=0,h=0,C=0,E=Y.length;C<E;C++)(c=Y.charCodeAt(C))<128?h+=1:c<2048?h+=2:c<55296||c>=57344?h+=3:(C++,h+=4);return h}function A(Y,c,h){for(var C=0,E=0,N=h.length;E<N;E++)(C=h.charCodeAt(E))<128?Y[c++]=C:C<2048?(Y[c++]=192|C>>6,Y[c++]=128|63&C):C<55296||C>=57344?(Y[c++]=224|C>>12,Y[c++]=128|C>>6&63,Y[c++]=128|63&C):(E++,C=65536+((1023&C)<<10|1023&h.charCodeAt(E)),Y[c++]=240|C>>18,Y[c++]=128|C>>12&63,Y[c++]=128|C>>6&63,Y[c++]=128|63&C)}function V(Y,c){Y.push(255&c)}function U(Y,c){Y.push(255&c)}function l(Y,c){Y.push(255&c),Y.push(c>>8&255)}function n(Y,c){Y.push(255&c),Y.push(c>>8&255)}function v(Y,c){Y.push(255&c),Y.push(c>>8&255),Y.push(c>>16&255),Y.push(c>>24&255)}function g(Y,c){var h=c>>24,C=c>>16,E=c>>8,N=c;Y.push(255&N),Y.push(255&E),Y.push(255&C),Y.push(255&h)}function z(Y,c){var h=Math.floor(c/Math.pow(2,32));g(Y,c>>>0),g(Y,h)}function O(Y,c){var h=c/Math.pow(2,32)|0;g(Y,c>>>0),g(Y,h)}function o(Y,c){R(Y,c)}function f(Y,c){B(Y,c)}var L=new Int32Array(2),u=new Float32Array(L.buffer),i=new Float64Array(L.buffer);function R(Y,c){u[0]=c,v(Y,L[0])}function B(Y,c){i[0]=c,v(Y,L[0]),v(Y,L[1])}function t(Y,c){return U(Y,c?1:0)}function F(Y,c){c||(c="");var h=x(c),C=0;if(h<32)Y.push(160|h),C=1;else if(h<256)Y.push(217),U(Y,h),C=2;else if(h<65536)Y.push(218),n(Y,h),C=3;else{if(!(h<4294967296))throw new Error("String too long");Y.push(219),g(Y,h),C=5}return A(Y,Y.length,c),C+h}function J(Y,c){return isNaN(c)?J(Y,0):isFinite(c)?c!==(0|c)?(Y.push(203),B(Y,c),9):c>=0?c<128?(U(Y,c),1):c<256?(Y.push(204),U(Y,c),2):c<65536?(Y.push(205),n(Y,c),3):c<4294967296?(Y.push(206),g(Y,c),5):(Y.push(207),O(Y,c),9):c>=-32?(Y.push(224|c+32),1):c>=-128?(Y.push(208),V(Y,c),2):c>=-32768?(Y.push(209),l(Y,c),3):c>=-2147483648?(Y.push(210),v(Y,c),5):(Y.push(211),z(Y,c),9):J(Y,c>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var j=Object.freeze({__proto__:null,utf8Write:A,int8:V,uint8:U,int16:l,uint16:n,int32:v,uint32:g,int64:z,uint64:O,float32:o,float64:f,writeFloat32:R,writeFloat64:B,boolean:t,string:F,number:J});function S(Y,c,h){for(var C="",E=0,N=c,Q=c+h;N<Q;N++){var b=Y[N];0!==(128&b)?192!==(224&b)?224!==(240&b)?240!==(248&b)?console.error("Invalid byte "+b.toString(16)):(E=(7&b)<<18|(63&Y[++N])<<12|(63&Y[++N])<<6|63&Y[++N])>=65536?(E-=65536,C+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):C+=String.fromCharCode(E):C+=String.fromCharCode((15&b)<<12|(63&Y[++N])<<6|63&Y[++N]):C+=String.fromCharCode((31&b)<<6|63&Y[++N]):C+=String.fromCharCode(b)}return C}function mY(Y,c){return YY(Y,c)<<24>>24}function YY(Y,c){return Y[c.offset++]}function cY(Y,c){return hY(Y,c)<<16>>16}function hY(Y,c){return Y[c.offset++]|Y[c.offset++]<<8}function CY(Y,c){return Y[c.offset++]|Y[c.offset++]<<8|Y[c.offset++]<<16|Y[c.offset++]<<24}function EY(Y,c){return CY(Y,c)>>>0}function NY(Y,c){return kY(Y,c)}function QY(Y,c){return MY(Y,c)}function bY(Y,c){var h=EY(Y,c);return CY(Y,c)*Math.pow(2,32)+h}function HY(Y,c){var h=EY(Y,c);return EY(Y,c)*Math.pow(2,32)+h}var wY=new Int32Array(2),WY=new Float32Array(wY.buffer),qY=new Float64Array(wY.buffer);function kY(Y,c){return wY[0]=CY(Y,c),WY[0]}function MY(Y,c){return wY[0]=CY(Y,c),wY[1]=CY(Y,c),qY[0]}function pY(Y,c){return YY(Y,c)>0}function PY(Y,c){var h,C=Y[c.offset++];C<192?h=31&C:217===C?h=YY(Y,c):218===C?h=hY(Y,c):219===C&&(h=EY(Y,c));var E=S(Y,c.offset,h);return c.offset+=h,E}function yY(Y,c){var h=Y[c.offset];return h<192&&h>160||217===h||218===h||219===h}function dY(Y,c){var h=Y[c.offset++];return h<128?h:202===h?kY(Y,c):203===h?MY(Y,c):204===h?YY(Y,c):205===h?hY(Y,c):206===h?EY(Y,c):207===h?HY(Y,c):208===h?mY(Y,c):209===h?cY(Y,c):210===h?CY(Y,c):211===h?bY(Y,c):h>223?-1*(255-h+1):void 0}function DY(Y,c){var h=Y[c.offset];return h<128||h>=202&&h<=211}function TY(Y,c){return Y[c.offset]<160}function eY(Y,c){return Y[c.offset-1]===Q&&(Y[c.offset]<128||Y[c.offset]>=202&&Y[c.offset]<=211)}var rY=Object.freeze({__proto__:null,int8:mY,uint8:YY,int16:cY,uint16:hY,int32:CY,uint32:EY,float32:NY,float64:QY,int64:bY,uint64:HY,readFloat32:kY,readFloat64:MY,boolean:pY,string:PY,stringCheck:yY,number:dY,numberCheck:DY,arrayCheck:TY,switchStructureCheck:eY}),XY=function(){function c(Y){var c=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y&&Y.forEach((function(Y){return c.add(Y)}))}return c.prototype.Ub=function(c,h){return void 0===h&&(h=!0),w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,c,h?this.$items:void 0)},c.prototype.Nc=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,c)},c.is=function(Y){return void 0!==Y.collection},c.prototype.add=function(Y){var c=this.$refId++;return void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,c),this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,Y),this.$changes.change(c),c},c.prototype.at=function(Y){var c=Array.from(this.$items.keys())[Y];return this.$items.get(c)},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(Y){for(var c,h,C=this.$items.entries();(h=C.next())&&!h.done;)if(Y===h.value[1]){c=h.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&W.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Y){return Array.from(this.$items.values()).some((function(c){return c===Y}))},c.prototype.forEach=function(Y){var c=this;this.$items.forEach((function(h,C,E){return Y(h,C,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Y,c){this.$indexes.set(Y,c)},c.prototype.getIndex=function(Y){return this.$indexes.get(Y)},c.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},c.prototype.deleteByIndex=function(Y){var c=this.$indexes.get(Y);this.$items.delete(c),this.$indexes.delete(Y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var Y=[];return this.forEach((function(c,h){Y.push("function"===typeof c.toJSON?c.toJSON():c)})),Y},c.prototype.clone=function(Y){var h;return Y?h=Object.assign(new c,this):(h=new c,this.forEach((function(Y){Y.$changes?h.add(Y.clone()):h.add(Y)}))),h},c}(),ZY=function(){function c(Y){var c=this;this.$changes=new H(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Y&&Y.forEach((function(Y){return c.add(Y)}))}return c.prototype.Ub=function(c,h){return void 0===h&&(h=!0),w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.ADD,c,h?this.$items:void 0)},c.prototype.Nc=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,c)},c.prototype.onChange=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,c)},c.is=function(Y){return void 0!==Y.set},c.prototype.add=function(c){var h,C;if(this.has(c))return!1;var E=this.$refId++;void 0!==c.$changes&&c.$changes.setParent(this,this.$changes.root,E);var N=null!==(C=null===(h=this.$changes.indexes[E])||void 0===h?void 0:h.op)&&void 0!==C?C:Y.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,c),this.$changes.change(E,N),E},c.prototype.entries=function(){return this.$items.entries()},c.prototype.delete=function(Y){for(var c,h,C=this.$items.entries();(h=C.next())&&!h.done;)if(Y===h.value[1]){c=h.value[0];break}return void 0!==c&&(this.$changes.delete(c),this.$indexes.delete(c),this.$items.delete(c))},c.prototype.clear=function(c){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),c&&W.call(this,c),this.$items.clear(),this.$changes.operation({index:0,op:Y.OPERATION.CLEAR}),this.$changes.touchParents()},c.prototype.has=function(Y){for(var c,h=this.$items.values(),C=!1;(c=h.next())&&!c.done;)if(Y===c.value){C=!0;break}return C},c.prototype.forEach=function(Y){var c=this;this.$items.forEach((function(h,C,E){return Y(h,C,c)}))},c.prototype.values=function(){return this.$items.values()},Object.defineProperty(c.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),c.prototype.setIndex=function(Y,c){this.$indexes.set(Y,c)},c.prototype.getIndex=function(Y){return this.$indexes.get(Y)},c.prototype.getByIndex=function(Y){return this.$items.get(this.$indexes.get(Y))},c.prototype.deleteByIndex=function(Y){var c=this.$indexes.get(Y);this.$items.delete(c),this.$indexes.delete(Y)},c.prototype.toArray=function(){return Array.from(this.$items.values())},c.prototype.toJSON=function(){var Y=[];return this.forEach((function(c,h){Y.push("function"===typeof c.toJSON?c.toJSON():c)})),Y},c.prototype.clone=function(Y){var h;return Y?h=Object.assign(new c,this):(h=new c,this.forEach((function(Y){Y.$changes?h.add(Y.clone()):h.add(Y)}))),h},c}(),aY=function(){function Y(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Y.prototype.addRefId=function(Y){this.refIds.has(Y)||(this.refIds.add(Y),this.containerIndexes.set(Y,new Set))},Y.get=function(c){return void 0===c.$filterState&&(c.$filterState=new Y),c.$filterState},Y}(),GY=function(){function Y(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Y.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Y.prototype.addRef=function(Y,c,h){void 0===h&&(h=!0),this.refs.set(Y,c),h&&(this.refCounts[Y]=(this.refCounts[Y]||0)+1)},Y.prototype.removeRef=function(Y){this.refCounts[Y]=this.refCounts[Y]-1,this.deletedRefs.add(Y)},Y.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Y.prototype.garbageCollectDeletedRefs=function(){var Y=this;this.deletedRefs.forEach((function(c){if(!(Y.refCounts[c]>0)){var h=Y.refs.get(c);if(h instanceof VY)for(var C in h._definition.schema)"string"!==typeof h._definition.schema[C]&&h[C]&&h[C].$changes&&Y.removeRef(h[C].$changes.refId);else{var E=h.$changes.parent._definition,N=E.schema[E.fieldsByIndex[h.$changes.parentIndex]];"function"===typeof Object.values(N)[0]&&Array.from(h.values()).forEach((function(c){return Y.removeRef(c.$changes.refId)}))}Y.refs.delete(c),delete Y.refCounts[c]}})),this.deletedRefs.clear()},Y}(),KY=function(Y){function c(){return null!==Y&&Y.apply(this,arguments)||this}return h(c,Y),c}(Error);function IY(Y,c,h,C){var E,N=!1;switch(c){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(Y)&&console.log('trying to encode "NaN" in '.concat(h.constructor.name,"#").concat(C));break;case"string":E="string",N=!0;break;case"boolean":return}if(typeof Y!==E&&(!N||N&&null!==Y)){var Q="'".concat(JSON.stringify(Y),"'").concat(Y&&Y.constructor&&" (".concat(Y.constructor.name,")")||"");throw new KY("a '".concat(E,"' was expected, but ").concat(Q," was provided in ").concat(h.constructor.name,"#").concat(C))}}function sY(Y,c,h,C){if(!(Y instanceof c))throw new KY("a '".concat(c.name,"' was expected, but '").concat(Y.constructor.name,"' was provided in ").concat(h.constructor.name,"#").concat(C))}function xY(Y,c,h,C,E){IY(h,Y,C,E);var N=j[Y];if(!N)throw new KY("a '".concat(Y,"' was expected, but ").concat(h," was provided in ").concat(C.constructor.name,"#").concat(E));N(c,h)}function AY(Y,c,h){return rY[Y](c,h)}var VY=function(){function c(){for(var Y=[],c=0;c<arguments.length;c++)Y[c]=arguments[c];Object.defineProperties(this,{$changes:{value:new H(this,void 0,new GY),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var h=this._definition.descriptors;h&&Object.defineProperties(this,h),Y[0]&&this.assign(Y[0])}return c.onError=function(Y){console.error(Y)},c.is=function(Y){return Y._definition&&void 0!==Y._definition.schema},c.prototype.onChange=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.REPLACE,c)},c.prototype.Nc=function(c){return w(this.$callbacks||(this.$callbacks=[]),Y.OPERATION.DELETE,c)},c.prototype.assign=function(Y){return Object.assign(this,Y),this},Object.defineProperty(c.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),c.prototype.setDirty=function(Y,c){this.$changes.change(Y,c)},c.prototype.listen=function(Y,c,h){var C=this;return void 0===h&&(h=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Y]||(this.$callbacks[Y]=[]),this.$callbacks[Y].push(c),h&&void 0!==this[Y]&&c(this[Y],void 0),function(){return q(C.$callbacks[Y],C.$callbacks[Y].indexOf(c))}},c.prototype.decode=function(h,C,E){var N;void 0===C&&(C={offset:0}),void 0===E&&(E=this);var b=[],H=this.$changes.root,w=h.length,W=0;for(H.refs.set(W,this);C.offset<w;){var q=h[C.offset++];if(q!=Q){var k=E.$changes,M=void 0!==E._definition,P=M?q>>6<<6:q;if(P!==Y.OPERATION.CLEAR){var d=M?q%(P||255):dY(h,C),D=M?E._definition.fieldsByIndex[d]:"",e=k.getType(d),r=void 0,X=void 0,Z=void 0;if(M?X=E["_".concat(D)]:(X=E.getByIndex(d),(P&Y.OPERATION.ADD)===Y.OPERATION.ADD?(Z=E instanceof y?PY(h,C):d,E.setIndex(d,Z)):Z=E.getIndex(d)),(P&Y.OPERATION.DELETE)===Y.OPERATION.DELETE&&(P!==Y.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(d),X&&X.$changes&&H.removeRef(X.$changes.refId),r=null),void 0!==D){if(P===Y.OPERATION.DELETE);else if(c.is(e)){var a=dY(h,C);if(r=H.refs.get(a),P!==Y.OPERATION.REPLACE){var G=this.getSchemaType(h,C,e);r||((r=this.createTypeInstance(G)).$changes.refId=a,X&&(r.$callbacks=X.$callbacks,X.$changes.refId&&a!==X.$changes.refId&&H.removeRef(X.$changes.refId))),H.addRef(a,r,r!==X)}}else if("string"===typeof e)r=AY(e,h,C);else{var K=T(Object.keys(e)[0]),I=dY(h,C),s=H.refs.has(I)?X||H.refs.get(I):new K.constructor;if((r=s.clone(!0)).$changes.refId=I,X&&(r.$callbacks=X.$callbacks,X.$changes.refId&&I!==X.$changes.refId)){H.removeRef(X.$changes.refId);for(var x=X.entries(),A=void 0;(A=x.next())&&!A.done;){var V=(N=A.value)[0],U=N[1];b.push({refId:I,op:Y.OPERATION.DELETE,field:V,value:void 0,previousValue:U})}}H.addRef(I,r,s!==X)}if(null!==r&&void 0!==r)if(r.$changes&&r.$changes.setParent(k.ref,k.root,d),E instanceof c)E[D]=r;else if(E instanceof y)V=Z,E.$items.set(V,r),E.$changes.allChanges.add(d);else if(E instanceof p)E.setAt(d,r);else if(E instanceof XY){var l=E.add(r);E.setIndex(d,l)}else E instanceof ZY&&!1!==(l=E.add(r))&&E.setIndex(d,l);X!==r&&b.push({refId:W,op:P,field:D,dynamicIndex:Z,value:r,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var n={offset:C.offset};C.offset<w&&(!eY(h,C)||(n.offset=C.offset+1,!H.refs.has(dY(h,n))));)C.offset++}}else E.clear(b)}else{W=dY(h,C);var v=H.refs.get(W);if(!v)throw new Error('"refId" not found: '.concat(W));E=v}}return this._triggerChanges(b),H.garbageCollectDeletedRefs(),b},c.prototype.encode=function(h,C,E){void 0===h&&(h=!1),void 0===C&&(C=[]),void 0===E&&(E=!1);for(var N=this.$changes,b=new WeakSet,H=[N],w=1,W=0;W<w;W++){var q=H[W],k=q.ref,M=k instanceof c;q.ensureRefId(),b.add(q),q!==N&&(q.changed||h)&&(U(C,Q),J(C,q.refId));for(var p=h?Array.from(q.allChanges):Array.from(q.changes.values()),P=0,d=p.length;P<d;P++){var D=h?{op:Y.OPERATION.ADD,index:p[P]}:p[P],e=D.index,r=M?k._definition.fieldsByIndex&&k._definition.fieldsByIndex[e]:e,X=C.length;if(D.op!==Y.OPERATION.TOUCH)if(M)U(C,e|D.op);else{if(U(C,D.op),D.op===Y.OPERATION.CLEAR)continue;J(C,e)}if(M||(D.op&Y.OPERATION.ADD)!=Y.OPERATION.ADD||k instanceof y&&F(C,q.ref.$indexes.get(e)),D.op!==Y.OPERATION.DELETE){var Z=q.getType(e),a=q.getValue(e);if(a&&a.$changes&&!b.has(a.$changes)&&(H.push(a.$changes),a.$changes.ensureRefId(),w++),D.op!==Y.OPERATION.TOUCH){if(c.is(Z))sY(a,Z,k,r),J(C,a.$changes.refId),(D.op&Y.OPERATION.ADD)===Y.OPERATION.ADD&&this.tryEncodeTypeId(C,Z,a.constructor);else if("string"===typeof Z)xY(Z,C,a,k,r);else{var G=T(Object.keys(Z)[0]);sY(k["_".concat(r)],G.constructor,k,r),J(C,a.$changes.refId)}E&&q.cache(e,C.slice(X))}}}h||E||q.discard()}return C},c.prototype.encodeAll=function(Y){return this.encode(!0,[],Y)},c.prototype.applyFilters=function(h,C){var E,N;void 0===C&&(C=!1);for(var b=this,H=new Set,w=aY.get(h),W=[this.$changes],q=1,k=[],M=function(M){var p=W[M];if(H.has(p.refId))return"continue";var P=p.ref,d=P instanceof c;U(k,Q),J(k,p.refId);var D=w.refIds.has(p),T=C||!D;w.addRefId(p);var e=w.containerIndexes.get(p),r=T?Array.from(p.allChanges):Array.from(p.changes.values());!C&&d&&P._definition.indexesWithFilters&&P._definition.indexesWithFilters.forEach((function(c){!e.has(c)&&p.allChanges.has(c)&&(T?r.push(c):r.push({op:Y.OPERATION.ADD,index:c}))}));for(var X=0,Z=r.length;X<Z;X++){var a=T?{op:Y.OPERATION.ADD,index:r[X]}:r[X];if(a.op!==Y.OPERATION.CLEAR){var G=a.index;if(a.op!==Y.OPERATION.DELETE){var K=p.getValue(G),I=p.getType(G);if(d){if((s=P._definition.filters&&P._definition.filters[G])&&!s.call(P,h,K,b)){K&&K.$changes&&H.add(K.$changes.refId);continue}}else{var s,x=p.parent;if((s=p.getChildrenFilter())&&!s.call(x,h,P.$indexes.get(G),K,b)){K&&K.$changes&&H.add(K.$changes.refId);continue}}if(K.$changes&&(W.push(K.$changes),q++),a.op!==Y.OPERATION.TOUCH)if(a.op===Y.OPERATION.ADD||d)k.push.apply(k,null!==(E=p.caches[G])&&void 0!==E?E:[]),e.add(G);else if(e.has(G))k.push.apply(k,null!==(N=p.caches[G])&&void 0!==N?N:[]);else{if(e.add(G),U(k,Y.OPERATION.ADD),J(k,G),P instanceof y){var A=p.ref.$indexes.get(G);F(k,A)}K.$changes?J(k,K.$changes.refId):j[I](k,K)}else K.$changes&&!d&&(U(k,Y.OPERATION.ADD),J(k,G),P instanceof y&&(A=p.ref.$indexes.get(G),F(k,A)),J(k,K.$changes.refId))}else d?U(k,a.op|G):(U(k,a.op),J(k,G))}else U(k,a.op)}},p=0;p<q;p++)M(p);return k},c.prototype.clone=function(){var Y,c=new this.constructor,h=this._definition.schema;for(var C in h)"object"===typeof this[C]&&"function"===typeof(null===(Y=this[C])||void 0===Y?void 0:Y.clone)?c[C]=this[C].clone():c[C]=this[C];return c},c.prototype.toJSON=function(){var Y=this._definition.schema,c=this._definition.deprecated,h={};for(var C in Y)c[C]||null===this[C]||"undefined"===typeof this[C]||(h[C]="function"===typeof this[C].toJSON?this[C].toJSON():this["_".concat(C)]);return h},c.prototype.discardAllChanges=function(){this.$changes.discardAll()},c.prototype.getByIndex=function(Y){return this[this._definition.fieldsByIndex[Y]]},c.prototype.deleteByIndex=function(Y){this[this._definition.fieldsByIndex[Y]]=void 0},c.prototype.tryEncodeTypeId=function(Y,c,h){c._typeid!==h._typeid&&(U(Y,b),J(Y,h._typeid))},c.prototype.getSchemaType=function(Y,c,h){var C;return Y[c.offset]===b&&(c.offset++,C=this.constructor._context.get(dY(Y,c))),C||h},c.prototype.createTypeInstance=function(Y){var c=new Y;return c.$changes.root=this.$changes.root,c},c.prototype._triggerChanges=function(h){for(var C,E,N,Q,b,H,w,W,q,k=new Set,M=this.$changes.root.refs,p=function(p){var P=h[p],y=P.refId,d=M.get(y),D=d.$callbacks;if((P.op&Y.OPERATION.DELETE)===Y.OPERATION.DELETE&&P.previousValue instanceof c&&(null===(E=null===(C=P.previousValue.$callbacks)||void 0===C?void 0:C[Y.OPERATION.DELETE])||void 0===E||E.forEach((function(Y){return Y()}))),!D)return"continue";if(d instanceof c){if(!k.has(y))try{null===(N=null===D||void 0===D?void 0:D[Y.OPERATION.REPLACE])||void 0===N||N.forEach((function(Y){return Y()}))}catch(T){c.onError(T)}try{D.hasOwnProperty(P.field)&&(null===(Q=D[P.field])||void 0===Q||Q.forEach((function(Y){return Y(P.value,P.previousValue)})))}catch(T){c.onError(T)}}else P.op===Y.OPERATION.ADD&&void 0===P.previousValue?null===(b=D[Y.OPERATION.ADD])||void 0===b||b.forEach((function(Y){var c;return Y(P.value,null!==(c=P.dynamicIndex)&&void 0!==c?c:P.field)})):P.op===Y.OPERATION.DELETE?void 0!==P.previousValue&&(null===(H=D[Y.OPERATION.DELETE])||void 0===H||H.forEach((function(Y){var c;return Y(P.previousValue,null!==(c=P.dynamicIndex)&&void 0!==c?c:P.field)}))):P.op===Y.OPERATION.DELETE_AND_ADD&&(void 0!==P.previousValue&&(null===(w=D[Y.OPERATION.DELETE])||void 0===w||w.forEach((function(Y){var c;return Y(P.previousValue,null!==(c=P.dynamicIndex)&&void 0!==c?c:P.field)}))),null===(W=D[Y.OPERATION.ADD])||void 0===W||W.forEach((function(Y){var c;return Y(P.value,null!==(c=P.dynamicIndex)&&void 0!==c?c:P.field)}))),P.value!==P.previousValue&&(null===(q=D[Y.OPERATION.REPLACE])||void 0===q||q.forEach((function(Y){var c;return Y(P.value,null!==(c=P.dynamicIndex)&&void 0!==c?c:P.field)})));k.add(y)},P=0;P<h.length;P++)p(P)},c._definition=e.create(),c}();function UY(Y){for(var c=[Y.$changes],h=1,C={},E=C,N=function(Y){var h=c[Y];h.changes.forEach((function(Y){var c=h.ref,C=Y.index,N=c._definition?c._definition.fieldsByIndex[C]:c.$indexes.get(C);E[N]=h.getValue(C)}))},Q=0;Q<h;Q++)N(Q);return C}var lY={context:new X},nY=function(Y){function c(){return null!==Y&&Y.apply(this,arguments)||this}return h(c,Y),C([a("string",lY)],c.prototype,"name",void 0),C([a("string",lY)],c.prototype,"type",void 0),C([a("number",lY)],c.prototype,"referencedType",void 0),c}(VY),vY=function(Y){function c(){var c=null!==Y&&Y.apply(this,arguments)||this;return c.fields=new p,c}return h(c,Y),C([a("number",lY)],c.prototype,"id",void 0),C([a([nY],lY)],c.prototype,"fields",void 0),c}(VY),gY=function(Y){function c(){var c=null!==Y&&Y.apply(this,arguments)||this;return c.types=new p,c}return h(c,Y),c.encode=function(Y){var h=Y.constructor,C=new c;C.rootType=h._typeid;var E=function(Y,c){for(var h in c){var E=new nY;E.name=h;var N=void 0;if("string"===typeof c[h])N=c[h];else{var Q=c[h],b=void 0;VY.is(Q)?(N="ref",b=c[h]):"string"===typeof Q[N=Object.keys(Q)[0]]?N+=":"+Q[N]:b=Q[N],E.referencedType=b?b._typeid:-1}E.type=N,Y.fields.push(E)}C.types.push(Y)},N=h._context.types;for(var Q in N){var b=new vY;b.id=Number(Q),E(b,N[Q]._definition.schema)}return C.encodeAll()},c.decode=function(Y,C){var E=new X,N=new c;N.decode(Y,C);var Q=N.types.reduce((function(Y,c){var C=function(Y){function c(){return null!==Y&&Y.apply(this,arguments)||this}return h(c,Y),c}(VY),N=c.id;return Y[N]=C,E.add(C,N),Y}),{});N.types.forEach((function(Y){var c=Q[Y.id];Y.fields.forEach((function(Y){var h;if(void 0!==Y.referencedType){var C=Y.type,N=Q[Y.referencedType];if(!N){var b=Y.type.split(":");C=b[0],N=b[1]}"ref"===C?a(N,{context:E})(c.prototype,Y.name):a(((h={})[C]=N,h),{context:E})(c.prototype,Y.name)}else a(Y.type,{context:E})(c.prototype,Y.name)}))}));var b=Q[N.rootType],H=new b;for(var w in b._definition.schema){var W=b._definition.schema[w];"string"!==typeof W&&(H[w]="function"===typeof W?new W:new(T(Object.keys(W)[0]).constructor))}return H},C([a([vY],lY)],c.prototype,"types",void 0),C([a("number",lY)],c.prototype,"rootType",void 0),c}(VY);D("map",{constructor:y}),D("array",{constructor:p}),D("set",{constructor:ZY}),D("collection",{constructor:XY}),Y.ArraySchema=p,Y.CollectionSchema=XY,Y.Context=X,Y.MapSchema=y,Y.Reflection=gY,Y.ReflectionField=nY,Y.ReflectionType=vY,Y.Schema=VY,Y.SchemaDefinition=e,Y.SetSchema=ZY,Y.decode=rY,Y.defineTypes=s,Y.deprecated=I,Y.dumpChanges=UY,Y.encode=j,Y.filter=G,Y.filterChildren=K,Y.hasFilter=r,Y.registerType=D,Y.type=a,Object.defineProperty(Y,"__esModule",{value:!0})}(c)},15049:function(Y,c,h){var C,E,N;function Q(){const Y=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(Q=function(){return Y})()}function b(Y,c){const h=Q();return(b=function(Y,c){return h[Y-=212]})(Y,c)}Y=h.nmd(Y),function(Y){const c=b,h=Y();for(;;)try{if(368192===parseInt(c(328))/1+parseInt(c(379))/2*(-parseInt(c(226))/3)+parseInt(c(348))/4*(parseInt(c(264))/5)+parseInt(c(224))/6*(-parseInt(c(223))/7)+-parseInt(c(345))/8*(parseInt(c(325))/9)+-parseInt(c(215))/10+-parseInt(c(275))/11*(-parseInt(c(383))/12))break;h.push(h.shift())}catch(C){h.push(h.shift())}}(Q),function(Q,H){const w=b;w(262)==typeof c&&"object"==w(262)?Y[w(337)]=H():"function"==w(237)&&h.amdD[w(400)]?(E=[],void 0===(N="function"===typeof(C=H)?C.apply(c,E):C)||(Y.exports=N)):w(262)==typeof c?c[w(277)]=H():Q[w(277)]=H()}(this,(()=>(()=>{var Y={646:function(Y){Y[b(337)]=function(){"use strict";function Y(Y){const c=b;for(var h=1;h<arguments[c(302)];h++){var C=arguments[h];for(var E in C)Y[E]=C[E]}return Y}return function c(h,C){const E=b;function N(c,E,N){const Q=b;if(Q(363)!=typeof document){"number"==typeof(N=Y({},C,N))[Q(278)]&&(N[Q(278)]=new Date(Date[Q(235)]()+864e5*N[Q(278)])),N[Q(278)]&&(N[Q(278)]=N[Q(278)][Q(351)]()),c=encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[Q(320)](/[()]/g,escape);var H="";for(var w in N)N[w]&&(H+="; "+w,!0!==N[w]&&(H+="="+N[w][Q(335)](";")[0]));return document[Q(295)]=c+"="+h[Q(349)](E,c)+H}}return Object[E(260)]({set:N,get:function(Y){const c=b;if(c(363)!=typeof document&&(!arguments[c(302)]||Y)){for(var C=document.cookie?document[c(295)][c(335)]("; "):[],E={},N=0;N<C[c(302)];N++){var Q=C[N][c(335)]("="),H=Q[c(396)](1)[c(323)]("=");try{var w=decodeURIComponent(Q[0]);if(E[w]=h[c(366)](H,w),Y===w)break}catch(W){}}return Y?E[Y]:E}},remove:function(c,h){N(c,"",Y({},h,{expires:-1}))},withAttributes:function(h){return c(this[E(359)],Y({},this.attributes,h))},withConverter:function(h){const C=E;return c(Y({},this[C(359)],h),this[C(398)])}},{attributes:{value:Object[E(315)](C)},converter:{value:Object.freeze(h)}})}({read:function(Y){const c=b;return'"'===Y[0]&&(Y=Y[c(396)](1,-1)),Y.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(Y){const c=b;return encodeURIComponent(Y)[c(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(382)]=void 0;const E=h(284);class N{static[C(218)](){const Y=C;console[Y(395)](Y(212)),window.addEventListener(Y(297),N[Y(258)])}static onBeforeUnload(){const Y=C;E[Y(313)][Y(236)]()}}c[C(382)]=N},719:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,"__esModule",{value:!0}),c[C(290)]=void 0;const E=h(284),N=h(878);c[C(290)]=class{static[C(307)](Y,c,h){const N=C;E.ByteBrewCore[N(307)](Y,c,h)}static[C(339)](){const Y=C;return E[Y(313)][Y(393)]}static[C(239)](Y,c){const h=C;void 0===c?E.ByteBrewCore[h(239)](Y):h(240)==typeof c?E.ByteBrewCore[h(247)](Y,c):h(270)==typeof c?E[h(313)][h(243)](Y,c):h(262)==typeof c&&E[h(313)][h(286)](Y,c)}static loadRemoteConfigs(Y){const c=C;N.RemoteConfigHandler[c(282)](Y)}static[C(233)](Y,c){const h=C;return N[h(272)][h(233)](Y,c)}static[C(369)](){const Y=C;return N[Y(272)][Y(369)]()}static[C(391)](){const Y=C;E[Y(313)][Y(391)]()}static[C(384)](){const Y=C;E[Y(313)][Y(384)]()}static[C(213)](){return E.ByteBrewCore.userID}}},441:function(Y,c,h){"use strict";const C=b;var E=this&&this[C(329)]||function(Y){return Y&&Y[C(220)]?Y:{default:Y}};Object[C(228)](c,C(220),{value:!0}),c[C(397)]=void 0;const N=E(h(646)),Q=h(429);class H{static[C(332)](){const Y=C,c=N[Y(334)][Y(311)](H[Y(231)]);return c?{userID:c,isNewUser:!1,hasSuccessfullyInitialized:H[Y(394)]()}:{userID:H.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[C(230)](){const Y=C,c=(0,Q.v4)();return N.default[Y(242)](H[Y(231)],c,{expires:365}),c}static setTrackingSettingsCookie(Y){const c=C,h=c(Y?248:367);N[c(334)].set(H[c(225)],h,{expires:365})}static[C(314)](){const Y=C,c=N[Y(334)][Y(311)](H.trackingSettingsIDCookieKey);return!c||"true"===c}static[C(356)](){return H.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const Y=C,c=N.default[Y(311)](H[Y(231)]);c&&N.default[Y(242)](H.userHasInitializedSuccessfullyCookieKey,c,{expires:365})}static[C(330)](){const Y=C,c=N[Y(334)][Y(311)](H[Y(326)]),h=N[Y(334)][Y(311)](H[Y(231)]);return!(!c||!h)&&c===h}static hasUserInitialized(){return H[C(330)]()}}c.ByteBrewCookieManager=H,H.userIDCookieKey=C(361),H.trackingSettingsIDCookieKey=C(357),H[C(326)]="bb_u_h_init"},284:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(313)]=void 0;const E=h(441),N=h(797),Q=h(334),H=h(429),w=h(147);class W{static[C(246)](){const Y=C;let c=navigator[Y(281)][Y(335)]("-");return c.length<2?"??":c[c.length-1]||"??"}static[C(307)](Y,c,h){const N=C;if(W[N(393)])return;if(console[N(395)]("ByteBrew: Starting Initialization"),!Y||!c)return void console.log(N(256));if(W[N(221)]=E[N(397)][N(356)](),!W.trackingEnabled)return void console[N(395)](N(362));W[N(399)]=Y,W[N(249)]=c,W[N(336)]=h,W.sessionID=(0,H.v4)(),W.sessionKey="",W[N(300)]=w[N(305)],W.language=navigator[N(281)],W[N(385)]=W[N(246)]();const b=E[N(397)][N(332)]();W[N(308)]=b[N(308)],b.isNewUser||!b[N(293)]?W.createNewUserEvent():W[N(344)](),W[N(331)]=new Date,Q[N(382)][N(218)]()}static reinitializeByteBrew(){const Y=C;console[Y(395)](Y(306)),W.initializeByteBrew(W[Y(399)],W[Y(249)],W[Y(336)])}static[C(387)](Y){const c=C;W[c(214)]=Y,W[c(393)]=!0,W.hasBeenInitializedWhilePageOpen=!0,E[c(397)][c(296)](),console[c(395)](c(386))}static[C(301)](){const Y=C;W[Y(303)]&&(console.log(Y(341)),this[Y(217)]())}static[C(372)](){return W[C(393)]&&W.trackingEnabled}static getScreenResolution(){return window[C(227)]+"x"+window.innerHeight}static[C(241)](){const Y=C;return{game_id:W[Y(399)],user_id:W[Y(308)],session_id:W[Y(318)],session_key:W.sessionKey,platform:W.platform}}static[C(244)](){const Y=C;return Object[Y(219)](Object[Y(219)]({},W[Y(241)]()),{version_number:W[Y(336)],sdk_version:W[Y(300)],deviceScreenSize:W[Y(280)](),tracking_enabled:W[Y(221)]})}static[C(283)](Y,c){const h=C;N.ByteBrewWebRequestor[h(380)](Y,c).then((Y=>{const c=h;if(Y&&Y.ok){const h=Y.headers.get(c(354));h?W.onInitializationSuccessful(h):console[c(395)](c(381))}else console[c(395)](c(232)+(Y?Y[c(259)]:"No Response"))}))}static createUserEvent(){const Y=C;if(!W[Y(221)])return;console.log(Y(353));let c={eventType:"game_open",userLocale:W[Y(281)]};const h=Object[Y(219)](Object[Y(219)]({},W[Y(244)]()),{category:Y(269),geo:W[Y(385)],externalData:c});W[Y(283)](N.ByteBrewWebRequestor[Y(238)],h)}static[C(285)](){const Y=C;if(!W[Y(221)])return;console[Y(395)](Y(352));let c={eventType:Y(309),userLocale:W[Y(281)]};const h=Object.assign(Object.assign({},W.getFullEventObject()),{category:Y(269),geo:W[Y(385)],externalData:c});W[Y(283)](N[Y(265)][Y(238)],h)}static endCurrentSession(){const Y=C;if(!W[Y(372)]())return;W[Y(393)]=!1,console.log(Y(350));const c=new Date;let h={sessionLength:Math[Y(287)]((c[Y(253)]()-W[Y(331)].getTime())/1e3)[Y(251)]()};const E=Object[Y(219)](Object[Y(219)]({},W[Y(244)]()),{category:Y(401),externalData:h});N.ByteBrewWebRequestor[Y(380)](N[Y(265)][Y(238)],E)}static[C(252)](Y){const c=C;let h="";if(!Y)return h;for(const[C,E]of Object.entries(Y))h+=C+"="+E+";";return h[c(302)]>0&&(h=h[c(396)](0,-1)),h}static[C(368)](Y,c){const h=C;if(!W.canSendData())return;console[h(395)](h(374)+Y);let E={eventType:Y};c&&(E=Object.assign(Object[h(219)]({},E),{value:"object"==typeof c?W[h(252)](c):c[h(251)]()}));const Q=Object[h(219)](Object[h(219)]({},W[h(244)]()),{category:"custom",externalData:E});N.ByteBrewWebRequestor[h(380)](N[h(265)][h(238)],Q)[h(378)]((Y=>{const c=h;Y&&Y.ok?console.log(c(274)):console[c(395)](c(294)+(Y?Y.status:c(267)))}))}static[C(239)](Y){W[C(368)](Y,null)}static[C(247)](Y,c){W.sendCustomEvent(Y,c)}static newCustomEventWithNumber(Y,c){W.sendCustomEvent(Y,c)}static[C(286)](Y,c){W[C(368)](Y,c)}static[C(391)](){const Y=C;console[Y(395)]("ByteBrew: Restarting Tracking"),W[Y(221)]=!0,E[Y(397)][Y(360)](!0),W[Y(217)]()}static[C(384)](){const Y=C;console[Y(395)](Y(257)),W[Y(221)]=!1,E.ByteBrewCookieManager[Y(360)](!1)}}c[C(313)]=W,W[C(393)]=!1,W[C(303)]=!1,W[C(261)]="Web"},797:function(Y,c,h){"use strict";const C=b;var E=this&&this[C(342)]||function(Y,c,h,C){return new(h||(h=Promise))((function(E,N){const Q=b;function H(Y){try{W(C.next(Y))}catch(c){N(c)}}function w(Y){try{W(C.throw(Y))}catch(c){N(c)}}function W(Y){const c=b;var C;Y.done?E(Y.value):(C=Y[c(234)],C instanceof h?C:new h((function(Y){Y(C)})))[c(378)](H,w)}W((C=C[Q(222)](Y,c||[]))[Q(255)]())}))};Object[C(228)](c,C(220),{value:!0}),c[C(265)]=void 0;const N=h(284);class Q{static sendBasicRequest(Y,c){return E(this,void 0,void 0,(function*(){const h=b;try{const C={method:"POST",mode:h(358),headers:{Accept:h(304),"Content-Type":h(289),"sdk-key":N[h(313)][h(249)]},body:JSON.stringify(c),keepalive:!0};return yield Q[h(298)](Y,C)}catch(C){console[h(284)](C)}}))}static[C(343)](Y){return E(this,void 0,void 0,(function*(){const c=b;try{const h={method:c(392),mode:"cors",headers:{Accept:c(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":N[c(313)][c(249)],user_id:N[c(313)][c(308)]}};return yield Q[c(298)](Y,h)}catch(h){console[c(284)](h)}}))}static[C(298)](Y,c){return E(this,void 0,void 0,(function*(){const h=b;try{const C=yield fetch(Y,c);return C.ok||console[h(284)]("Request failed with status "+C[h(259)]),C}catch(C){console[h(284)](C)}}))}}c.ByteBrewWebRequestor=Q,Q[C(238)]=C(390),Q[C(268)]=C(389)},878:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,C(220),{value:!0}),c[C(272)]=void 0;const E=h(284),N=h(797);class Q{static[C(292)](Y){Q.remoteConfigs=Y}static hasRemoteConfigsBeenSet(){return!!Q[C(216)]}static loadRemoteConfigs(Y){const c=C;N[c(265)][c(343)](N[c(265)][c(268)]+E[c(313)].appID)[c(378)]((h=>{const C=c;h&&h.ok?h[C(371)]()[C(378)]((c=>{const h=C;let E=null;try{E=new Map(Object[h(370)](JSON[h(250)](c))),console[h(395)](h(266))}catch(N){E=null,console[h(284)](h(388))}finally{Q[h(292)](E),E&&Y(E)}})):h?console.error(C(322)+(h?h[C(259)]:C(267))+" "+(h?h.statusText:"")):console[C(284)](C(279))}))}static[C(233)](Y,c){const h=C;return Q[h(369)]()&&Q.remoteConfigs[h(364)](Y)?Q[h(216)][h(311)](Y):c}}c[C(272)]=Q,Q[C(216)]=null},429:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,C(220),{value:!0}),Object[C(228)](c,C(319),{enumerable:!0,get:function(){return w[C(334)]}}),Object[C(228)](c,C(250),{enumerable:!0,get:function(){return M.default}}),Object[C(228)](c,C(333),{enumerable:!0,get:function(){return k[C(334)]}}),Object.defineProperty(c,"v1",{enumerable:!0,get:function(){return E[C(334)]}}),Object[C(228)](c,"v3",{enumerable:!0,get:function(){return N[C(334)]}}),Object[C(228)](c,"v4",{enumerable:!0,get:function(){return Q[C(334)]}}),Object[C(228)](c,"v5",{enumerable:!0,get:function(){return H[C(334)]}}),Object.defineProperty(c,C(310),{enumerable:!0,get:function(){return q[C(334)]}}),Object[C(228)](c,"version",{enumerable:!0,get:function(){return W[C(334)]}});var E=p(h(990)),N=p(h(237)),Q=p(h(355)),H=p(h(764)),w=p(h(314)),W=p(h(464)),q=p(h(435)),k=p(h(8)),M=p(h(222));function p(Y){return Y&&Y[C(220)]?Y:{default:Y}}},163:(Y,c)=>{"use strict";const h=b;function C(Y){return 14+(Y+64>>>9<<4)+1}function E(Y,c){const h=(65535&Y)+(65535&c);return(Y>>16)+(c>>16)+(h>>16)<<16|65535&h}function N(Y,c,h,C,N,Q){return E((b=E(E(c,Y),E(C,Q)))<<(H=N)|b>>>32-H,h);var b,H}function Q(Y,c,h,C,E,Q,b){return N(c&h|~c&C,Y,c,E,Q,b)}function H(Y,c,h,C,E,Q,b){return N(c&C|h&~C,Y,c,E,Q,b)}function w(Y,c,h,C,E,Q,b){return N(c^h^C,Y,c,E,Q,b)}function W(Y,c,h,C,E,Q,b){return N(h^(c|~C),Y,c,E,Q,b)}Object.defineProperty(c,h(220),{value:!0}),c[h(334)]=void 0;c.default=function(Y){const c=h;if(c(240)==typeof Y){const h=unescape(encodeURIComponent(Y));Y=new Uint8Array(h[c(302)]);for(let C=0;C<h[c(302)];++C)Y[C]=h[c(312)](C)}return function(Y){const h=c,C=[],E=32*Y.length,N=h(276);for(let c=0;c<E;c+=8){const E=Y[c>>5]>>>c%32&255,Q=parseInt(N[h(376)](E>>>4&15)+N[h(376)](15&E),16);C[h(288)](Q)}return C}(function(Y,h){const N=c;Y[h>>5]|=128<<h%32,Y[C(h)-1]=h;let b=1732584193,q=-271733879,k=-1732584194,M=271733878;for(let c=0;c<Y[N(302)];c+=16){const h=b,C=q,N=k,p=M;b=Q(b,q,k,M,Y[c],7,-680876936),M=Q(M,b,q,k,Y[c+1],12,-389564586),k=Q(k,M,b,q,Y[c+2],17,606105819),q=Q(q,k,M,b,Y[c+3],22,-1044525330),b=Q(b,q,k,M,Y[c+4],7,-176418897),M=Q(M,b,q,k,Y[c+5],12,1200080426),k=Q(k,M,b,q,Y[c+6],17,-1473231341),q=Q(q,k,M,b,Y[c+7],22,-45705983),b=Q(b,q,k,M,Y[c+8],7,1770035416),M=Q(M,b,q,k,Y[c+9],12,-1958414417),k=Q(k,M,b,q,Y[c+10],17,-42063),q=Q(q,k,M,b,Y[c+11],22,-1990404162),b=Q(b,q,k,M,Y[c+12],7,1804603682),M=Q(M,b,q,k,Y[c+13],12,-40341101),k=Q(k,M,b,q,Y[c+14],17,-1502002290),q=Q(q,k,M,b,Y[c+15],22,1236535329),b=H(b,q,k,M,Y[c+1],5,-165796510),M=H(M,b,q,k,Y[c+6],9,-1069501632),k=H(k,M,b,q,Y[c+11],14,643717713),q=H(q,k,M,b,Y[c],20,-373897302),b=H(b,q,k,M,Y[c+5],5,-701558691),M=H(M,b,q,k,Y[c+10],9,38016083),k=H(k,M,b,q,Y[c+15],14,-660478335),q=H(q,k,M,b,Y[c+4],20,-405537848),b=H(b,q,k,M,Y[c+9],5,568446438),M=H(M,b,q,k,Y[c+14],9,-1019803690),k=H(k,M,b,q,Y[c+3],14,-187363961),q=H(q,k,M,b,Y[c+8],20,1163531501),b=H(b,q,k,M,Y[c+13],5,-1444681467),M=H(M,b,q,k,Y[c+2],9,-51403784),k=H(k,M,b,q,Y[c+7],14,1735328473),q=H(q,k,M,b,Y[c+12],20,-1926607734),b=w(b,q,k,M,Y[c+5],4,-378558),M=w(M,b,q,k,Y[c+8],11,-2022574463),k=w(k,M,b,q,Y[c+11],16,1839030562),q=w(q,k,M,b,Y[c+14],23,-35309556),b=w(b,q,k,M,Y[c+1],4,-1530992060),M=w(M,b,q,k,Y[c+4],11,1272893353),k=w(k,M,b,q,Y[c+7],16,-155497632),q=w(q,k,M,b,Y[c+10],23,-1094730640),b=w(b,q,k,M,Y[c+13],4,681279174),M=w(M,b,q,k,Y[c],11,-358537222),k=w(k,M,b,q,Y[c+3],16,-722521979),q=w(q,k,M,b,Y[c+6],23,76029189),b=w(b,q,k,M,Y[c+9],4,-640364487),M=w(M,b,q,k,Y[c+12],11,-421815835),k=w(k,M,b,q,Y[c+15],16,530742520),q=w(q,k,M,b,Y[c+2],23,-995338651),b=W(b,q,k,M,Y[c],6,-198630844),M=W(M,b,q,k,Y[c+7],10,1126891415),k=W(k,M,b,q,Y[c+14],15,-1416354905),q=W(q,k,M,b,Y[c+5],21,-57434055),b=W(b,q,k,M,Y[c+12],6,1700485571),M=W(M,b,q,k,Y[c+3],10,-1894986606),k=W(k,M,b,q,Y[c+10],15,-1051523),q=W(q,k,M,b,Y[c+1],21,-2054922799),b=W(b,q,k,M,Y[c+8],6,1873313359),M=W(M,b,q,k,Y[c+15],10,-30611744),k=W(k,M,b,q,Y[c+6],15,-1560198380),q=W(q,k,M,b,Y[c+13],21,1309151649),b=W(b,q,k,M,Y[c+4],6,-145523070),M=W(M,b,q,k,Y[c+11],10,-1120210379),k=W(k,M,b,q,Y[c+2],15,718787259),q=W(q,k,M,b,Y[c+9],21,-343485551),b=E(b,h),q=E(q,C),k=E(k,N),M=E(M,p)}return[b,q,k,M]}(function(Y){const h=c;if(0===Y[h(302)])return[];const E=8*Y[h(302)],N=new Uint32Array(C(E));for(let c=0;c<E;c+=8)N[c>>5]|=(255&Y[c/8])<<c%32;return N}(Y),8*Y[c(302)]))}},790:(Y,c)=>{"use strict";const h=b;Object[h(228)](c,h(220),{value:!0}),c[h(334)]=void 0;var C={randomUUID:h(363)!=typeof crypto&&crypto[h(273)]&&crypto[h(273)][h(229)](crypto)};c.default=C},314:(Y,c)=>{"use strict";const h=b;Object[h(228)](c,"__esModule",{value:!0}),c.default=void 0,c[h(334)]="00000000-0000-0000-0000-000000000000"},222:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,C(220),{value:!0}),c[C(334)]=void 0;var E,N=(E=h(435))&&E.__esModule?E:{default:E};c[C(334)]=function(Y){const c=C;if(!(0,N.default)(Y))throw TypeError(c(271));let h;const E=new Uint8Array(16);return E[0]=(h=parseInt(Y[c(396)](0,8),16))>>>24,E[1]=h>>>16&255,E[2]=h>>>8&255,E[3]=255&h,E[4]=(h=parseInt(Y[c(396)](9,13),16))>>>8,E[5]=255&h,E[6]=(h=parseInt(Y[c(396)](14,18),16))>>>8,E[7]=255&h,E[8]=(h=parseInt(Y[c(396)](19,23),16))>>>8,E[9]=255&h,E[10]=(h=parseInt(Y[c(396)](24,36),16))/1099511627776&255,E[11]=h/4294967296&255,E[12]=h>>>24&255,E[13]=h>>>16&255,E[14]=h>>>8&255,E[15]=255&h,E}},58:(Y,c)=>{"use strict";const h=b;Object[h(228)](c,"__esModule",{value:!0}),c[h(334)]=void 0,c[h(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(Y,c)=>{"use strict";const h=b;let C;Object[h(228)](c,"__esModule",{value:!0}),c[h(334)]=function(){const Y=h;if(!C&&(C="undefined"!=typeof crypto&&crypto[Y(254)]&&crypto.getRandomValues.bind(crypto),!C))throw new Error(Y(299));return C(E)};const E=new Uint8Array(16)},757:(Y,c)=>{"use strict";const h=b;function C(Y,c,h,C){switch(Y){case 0:return c&h^~c&C;case 1:case 3:return c^h^C;case 2:return c&h^c&C^h&C}}function E(Y,c){return Y<<c|Y>>>32-c}Object.defineProperty(c,h(220),{value:!0}),c[h(334)]=void 0;c[h(334)]=function(Y){const c=h,N=[1518500249,1859775393,2400959708,3395469782],Q=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof Y){const h=unescape(encodeURIComponent(Y));Y=[];for(let C=0;C<h[c(302)];++C)Y[c(288)](h.charCodeAt(C))}else Array[c(338)](Y)||(Y=Array[c(340)][c(396)].call(Y));Y[c(288)](128);const b=Y[c(302)]/4+2,H=Math[c(375)](b/16),w=new Array(H);for(let h=0;h<H;++h){const c=new Uint32Array(16);for(let C=0;C<16;++C)c[C]=Y[64*h+4*C]<<24|Y[64*h+4*C+1]<<16|Y[64*h+4*C+2]<<8|Y[64*h+4*C+3];w[h]=c}w[H-1][14]=8*(Y[c(302)]-1)/Math.pow(2,32),w[H-1][14]=Math.floor(w[H-1][14]),w[H-1][15]=8*(Y.length-1)&4294967295;for(let h=0;h<H;++h){const Y=new Uint32Array(80);for(let c=0;c<16;++c)Y[c]=w[h][c];for(let c=16;c<80;++c)Y[c]=E(Y[c-3]^Y[c-8]^Y[c-14]^Y[c-16],1);let b=Q[0],H=Q[1],W=Q[2],q=Q[3],k=Q[4];for(let h=0;h<80;++h){const Q=Math[c(365)](h/20),w=E(b,5)+C(Q,H,W,q)+k+N[Q]+Y[h]>>>0;k=q,q=W,W=E(H,30)>>>0,H=b,b=w}Q[0]=Q[0]+b>>>0,Q[1]=Q[1]+H>>>0,Q[2]=Q[2]+W>>>0,Q[3]=Q[3]+q>>>0,Q[4]=Q[4]+k>>>0}return[Q[0]>>24&255,Q[0]>>16&255,Q[0]>>8&255,255&Q[0],Q[1]>>24&255,Q[1]>>16&255,Q[1]>>8&255,255&Q[1],Q[2]>>24&255,Q[2]>>16&255,Q[2]>>8&255,255&Q[2],Q[3]>>24&255,Q[3]>>16&255,Q[3]>>8&255,255&Q[3],Q[4]>>24&255,Q[4]>>16&255,Q[4]>>8&255,255&Q[4]]}},8:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(334)]=void 0,c[C(263)]=H;var E,N=(E=h(435))&&E[C(220)]?E:{default:E};const Q=[];for(let b=0;b<256;++b)Q[C(288)]((b+256)[C(251)](16)[C(396)](1));function H(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=C;return(Q[Y[c+0]]+Q[Y[c+1]]+Q[Y[c+2]]+Q[Y[c+3]]+"-"+Q[Y[c+4]]+Q[Y[c+5]]+"-"+Q[Y[c+6]]+Q[Y[c+7]]+"-"+Q[Y[c+8]]+Q[Y[c+9]]+"-"+Q[Y[c+10]]+Q[Y[c+11]]+Q[Y[c+12]]+Q[Y[c+13]]+Q[Y[c+14]]+Q[Y[c+15]])[h(317)]()}c[C(334)]=function(Y){const c=C,h=H(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,N.default)(h))throw TypeError(c(321));return h}},990:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,"__esModule",{value:!0}),c[C(334)]=void 0;var E,N=(E=h(319))&&E[C(220)]?E:{default:E},Q=h(8);let H,w,W=0,q=0;c[C(334)]=function(Y,c,h){const E=C;let b=c&&h||0;const k=c||new Array(16);let M=(Y=Y||{}).node||H,p=void 0!==Y[E(324)]?Y[E(324)]:w;if(null==M||null==p){const c=Y[E(347)]||(Y[E(355)]||N[E(334)])();null==M&&(M=H=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==p&&(p=w=16383&(c[6]<<8|c[7]))}let P=void 0!==Y[E(327)]?Y.msecs:Date.now(),y=void 0!==Y[E(316)]?Y.nsecs:q+1;const d=P-W+(y-q)/1e4;if(d<0&&void 0===Y[E(324)]&&(p=p+1&16383),(d<0||P>W)&&void 0===Y[E(316)]&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");W=P,q=y,w=p,P+=122192928e5;const D=(1e4*(268435455&P)+y)%4294967296;k[b++]=D>>>24&255,k[b++]=D>>>16&255,k[b++]=D>>>8&255,k[b++]=255&D;const T=P/4294967296*1e4&268435455;k[b++]=T>>>8&255,k[b++]=255&T,k[b++]=T>>>24&15|16,k[b++]=T>>>16&255,k[b++]=p>>>8|128,k[b++]=255&p;for(let C=0;C<6;++C)k[b+C]=M[C];return c||(0,Q[E(263)])(k)}},237:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(334)]=void 0;var E=Q(h(925)),N=Q(h(163));function Q(Y){return Y&&Y[C(220)]?Y:{default:Y}}var H=(0,E.default)("v3",48,N[C(334)]);c[C(334)]=H},925:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(291)]=c.DNS=void 0,c[C(334)]=function(Y,c,h){const E=C;function W(Y,C,E,H){const w=b;var W;if(w(240)==typeof Y&&(Y=function(Y){const c=w;Y=unescape(encodeURIComponent(Y));const h=[];for(let C=0;C<Y.length;++C)h[c(288)](Y.charCodeAt(C));return h}(Y)),w(240)==typeof C&&(C=(0,Q[w(334)])(C)),16!==(null===(W=C)||void 0===W?void 0:W[w(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let q=new Uint8Array(16+Y[w(302)]);if(q.set(C),q[w(242)](Y,C[w(302)]),q=h(q),q[6]=15&q[6]|c,q[8]=63&q[8]|128,E){H=H||0;for(let Y=0;Y<16;++Y)E[H+Y]=q[Y];return E}return(0,N.unsafeStringify)(q)}try{W.name=Y}catch(q){}return W[E(245)]=H,W[E(291)]=w,W};var E,N=h(8),Q=(E=h(222))&&E[C(220)]?E:{default:E};const H="6ba7b810-9dad-11d1-80b4-00c04fd430c8";c.DNS=H;const w="6ba7b811-9dad-11d1-80b4-00c04fd430c8";c.URL=w},355:(Y,c,h)=>{"use strict";const C=b;Object.defineProperty(c,"__esModule",{value:!0}),c[C(334)]=void 0;var E=H(h(790)),N=H(h(319)),Q=h(8);function H(Y){return Y&&Y.__esModule?Y:{default:Y}}c[C(334)]=function(Y,c,h){const b=C;if(E[b(334)][b(273)]&&!c&&!Y)return E.default[b(273)]();const H=(Y=Y||{}).random||(Y[b(355)]||N.default)();if(H[6]=15&H[6]|64,H[8]=63&H[8]|128,c){h=h||0;for(let Y=0;Y<16;++Y)c[h+Y]=H[Y];return c}return(0,Q.unsafeStringify)(H)}},764:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,"__esModule",{value:!0}),c[C(334)]=void 0;var E=Q(h(925)),N=Q(h(757));function Q(Y){return Y&&Y[C(220)]?Y:{default:Y}}var H=(0,E[C(334)])("v5",80,N.default);c.default=H},435:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(334)]=void 0;var E,N=(E=h(58))&&E.__esModule?E:{default:E};c[C(334)]=function(Y){const c=C;return c(240)==typeof Y&&N[c(334)][c(346)](Y)}},464:(Y,c,h)=>{"use strict";const C=b;Object[C(228)](c,C(220),{value:!0}),c[C(334)]=void 0;var E,N=(E=h(435))&&E[C(220)]?E:{default:E};c[C(334)]=function(Y){const c=C;if(!(0,N[c(334)])(Y))throw TypeError(c(271));return parseInt(Y[c(396)](14,15),16)}},147:Y=>{"use strict";const c=b;Y[c(337)]=JSON[c(250)](c(373))}},c={};function h(C){const E=b;var N=c[C];if(void 0!==N)return N[E(337)];var Q=c[C]={exports:{}};return Y[C][E(377)](Q[E(337)],Q,Q[E(337)],h),Q.exports}var C={};return(()=>{"use strict";const Y=b;var c=C;Object[Y(228)](c,"__esModule",{value:!0}),c.ByteBrew=void 0;var E=h(719);Object[Y(228)](c,Y(290),{enumerable:!0,get:function(){return E[Y(290)]}})})(),C})()))},15070:Y=>{"use strict";Y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15064:(Y,c,h)=>{var C=h(15070),E=h(15076),N=Object.hasOwnProperty,Q=Object.create(null);for(var b in C)N.call(C,b)&&(Q[C[b]]=b);var H=Y.exports={to:{},get:{}};function w(Y,c,h){return Math.min(Math.max(c,Y),h)}function W(Y){var c=Math.round(Y).toString(16).toUpperCase();return c.length<2?"0"+c:c}H.get=function(Y){var c,h;switch(Y.substring(0,3).toLowerCase()){case"hsl":c=H.get.hsl(Y),h="hsl";break;case"hwb":c=H.get.hwb(Y),h="hwb";break;default:c=H.get.rgb(Y),h="rgb"}return c?{model:h,value:c}:null},H.get.rgb=function(Y){if(!Y)return null;var c,h,E,Q=[0,0,0,1];if(c=Y.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=c[2],c=c[1],h=0;h<3;h++){var b=2*h;Q[h]=parseInt(c.slice(b,b+2),16)}E&&(Q[3]=parseInt(E,16)/255)}else if(c=Y.match(/^#([a-f0-9]{3,4})$/i)){for(E=(c=c[1])[3],h=0;h<3;h++)Q[h]=parseInt(c[h]+c[h],16);E&&(Q[3]=parseInt(E+E,16)/255)}else if(c=Y.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(h=0;h<3;h++)Q[h]=parseInt(c[h+1],0);c[4]&&(c[5]?Q[3]=.01*parseFloat(c[4]):Q[3]=parseFloat(c[4]))}else{if(!(c=Y.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(c=Y.match(/^(\w+)$/))?"transparent"===c[1]?[0,0,0,0]:N.call(C,c[1])?((Q=C[c[1]])[3]=1,Q):null:null;for(h=0;h<3;h++)Q[h]=Math.round(2.55*parseFloat(c[h+1]));c[4]&&(c[5]?Q[3]=.01*parseFloat(c[4]):Q[3]=parseFloat(c[4]))}for(h=0;h<3;h++)Q[h]=w(Q[h],0,255);return Q[3]=w(Q[3],0,1),Q},H.get.hsl=function(Y){if(!Y)return null;var c=Y.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var h=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,w(parseFloat(c[2]),0,100),w(parseFloat(c[3]),0,100),w(isNaN(h)?1:h,0,1)]}return null},H.get.hwb=function(Y){if(!Y)return null;var c=Y.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(c){var h=parseFloat(c[4]);return[(parseFloat(c[1])%360+360)%360,w(parseFloat(c[2]),0,100),w(parseFloat(c[3]),0,100),w(isNaN(h)?1:h,0,1)]}return null},H.to.hex=function(){var Y=E(arguments);return"#"+W(Y[0])+W(Y[1])+W(Y[2])+(Y[3]<1?W(Math.round(255*Y[3])):"")},H.to.rgb=function(){var Y=E(arguments);return Y.length<4||1===Y[3]?"rgb("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+")":"rgba("+Math.round(Y[0])+", "+Math.round(Y[1])+", "+Math.round(Y[2])+", "+Y[3]+")"},H.to.rgb.percent=function(){var Y=E(arguments),c=Math.round(Y[0]/255*100),h=Math.round(Y[1]/255*100),C=Math.round(Y[2]/255*100);return Y.length<4||1===Y[3]?"rgb("+c+"%, "+h+"%, "+C+"%)":"rgba("+c+"%, "+h+"%, "+C+"%, "+Y[3]+")"},H.to.hsl=function(){var Y=E(arguments);return Y.length<4||1===Y[3]?"hsl("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%)":"hsla("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%, "+Y[3]+")"},H.to.hwb=function(){var Y=E(arguments),c="";return Y.length>=4&&1!==Y[3]&&(c=", "+Y[3]),"hwb("+Y[0]+", "+Y[1]+"%, "+Y[2]+"%"+c+")"},H.to.keyword=function(Y){return Q[Y.slice(0,3)]}},15058:(Y,c,h)=>{const C=h(15064),E=h(15088),N=["keyword","gray","hex"],Q={};for(const M of Object.keys(E))Q[[...E[M].labels].sort().join("")]=M;const b={};function H(Y,c){if(!(this instanceof H))return new H(Y,c);if(c&&c in N&&(c=null),c&&!(c in E))throw new Error("Unknown model: "+c);let h,w;if(null==Y)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Y instanceof H)this.model=Y.model,this.color=[...Y.color],this.valpha=Y.valpha;else if("string"===typeof Y){const c=C.get(Y);if(null===c)throw new Error("Unable to parse color from string: "+Y);this.model=c.model,w=E[this.model].channels,this.color=c.value.slice(0,w),this.valpha="number"===typeof c.value[w]?c.value[w]:1}else if(Y.length>0){this.model=c||"rgb",w=E[this.model].channels;const h=Array.prototype.slice.call(Y,0,w);this.color=k(h,w),this.valpha="number"===typeof Y[w]?Y[w]:1}else if("number"===typeof Y)this.model="rgb",this.color=[Y>>16&255,Y>>8&255,255&Y],this.valpha=1;else{this.valpha=1;const c=Object.keys(Y);"alpha"in Y&&(c.splice(c.indexOf("alpha"),1),this.valpha="number"===typeof Y.alpha?Y.alpha:0);const C=c.sort().join("");if(!(C in Q))throw new Error("Unable to parse color from object: "+JSON.stringify(Y));this.model=Q[C];const{labels:N}=E[this.model],b=[];for(h=0;h<N.length;h++)b.push(Y[N[h]]);this.color=k(b)}if(b[this.model])for(w=E[this.model].channels,h=0;h<w;h++){const Y=b[this.model][h];Y&&(this.color[h]=Y(this.color[h]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}H.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Y){let c=this.model in C.to?this:this.rgb();c=c.round("number"===typeof Y?Y:1);const h=1===c.valpha?c.color:[...c.color,this.valpha];return C.to[c.model](h)},percentString(Y){const c=this.rgb().round("number"===typeof Y?Y:1),h=1===c.valpha?c.color:[...c.color,this.valpha];return C.to.rgb.percent(h)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Y={},{channels:c}=E[this.model],{labels:h}=E[this.model];for(let C=0;C<c;C++)Y[h[C]]=this.color[C];return 1!==this.valpha&&(Y.alpha=this.valpha),Y},unitArray(){const Y=this.rgb().color;return Y[0]/=255,Y[1]/=255,Y[2]/=255,1!==this.valpha&&Y.push(this.valpha),Y},unitObject(){const Y=this.rgb().object();return Y.r/=255,Y.g/=255,Y.b/=255,1!==this.valpha&&(Y.alpha=this.valpha),Y},round(Y){return Y=Math.max(Y||0,0),new H([...this.color.map(w(Y)),this.valpha],this.model)},alpha(Y){return void 0!==Y?new H([...this.color,Math.max(0,Math.min(1,Y))],this.model):this.valpha},red:W("rgb",0,q(255)),green:W("rgb",1,q(255)),blue:W("rgb",2,q(255)),hue:W(["hsl","hsv","hsl","hwb","hcg"],0,(Y=>(Y%360+360)%360)),saturationl:W("hsl",1,q(100)),lightness:W("hsl",2,q(100)),saturationv:W("hsv",1,q(100)),value:W("hsv",2,q(100)),chroma:W("hcg",1,q(100)),gray:W("hcg",2,q(100)),white:W("hwb",1,q(100)),wblack:W("hwb",2,q(100)),cyan:W("cmyk",0,q(100)),magenta:W("cmyk",1,q(100)),yellow:W("cmyk",2,q(100)),black:W("cmyk",3,q(100)),x:W("xyz",0,q(95.047)),y:W("xyz",1,q(100)),z:W("xyz",2,q(108.833)),l:W("lab",0,q(100)),a:W("lab",1),b:W("lab",2),keyword(Y){return void 0!==Y?new H(Y):E[this.model].keyword(this.color)},hex(Y){return void 0!==Y?new H(Y):C.to.hex(this.rgb().round().color)},hexa(Y){if(void 0!==Y)return new H(Y);const c=this.rgb().round().color;let h=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===h.length&&(h="0"+h),C.to.hex(c)+h},rgbNumber(){const Y=this.rgb().color;return(255&Y[0])<<16|(255&Y[1])<<8|255&Y[2]},luminosity(){const Y=this.rgb().color,c=[];for(const[h,C]of Y.entries()){const Y=C/255;c[h]=Y<=.04045?Y/12.92:((Y+.055)/1.055)**2.4}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast(Y){const c=this.luminosity(),h=Y.luminosity();return c>h?(c+.05)/(h+.05):(h+.05)/(c+.05)},level(Y){const c=this.contrast(Y);return c>=7?"AAA":c>=4.5?"AA":""},isDark(){const Y=this.rgb().color;return(2126*Y[0]+7152*Y[1]+722*Y[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Y=this.rgb();for(let c=0;c<3;c++)Y.color[c]=255-Y.color[c];return Y},lighten(Y){const c=this.hsl();return c.color[2]+=c.color[2]*Y,c},darken(Y){const c=this.hsl();return c.color[2]-=c.color[2]*Y,c},saturate(Y){const c=this.hsl();return c.color[1]+=c.color[1]*Y,c},desaturate(Y){const c=this.hsl();return c.color[1]-=c.color[1]*Y,c},whiten(Y){const c=this.hwb();return c.color[1]+=c.color[1]*Y,c},blacken(Y){const c=this.hwb();return c.color[2]+=c.color[2]*Y,c},grayscale(){const Y=this.rgb().color,c=.3*Y[0]+.59*Y[1]+.11*Y[2];return H.rgb(c,c,c)},fade(Y){return this.alpha(this.valpha-this.valpha*Y)},opaquer(Y){return this.alpha(this.valpha+this.valpha*Y)},rotate(Y){const c=this.hsl();let h=c.color[0];return h=(h+Y)%360,h=h<0?360+h:h,c.color[0]=h,c},mix(Y,c){if(!Y||!Y.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Y);const h=Y.rgb(),C=this.rgb(),E=void 0===c?.5:c,N=2*E-1,Q=h.alpha()-C.alpha(),b=((N*Q===-1?N:(N+Q)/(1+N*Q))+1)/2,w=1-b;return H.rgb(b*h.red()+w*C.red(),b*h.green()+w*C.green(),b*h.blue()+w*C.blue(),h.alpha()*E+C.alpha()*(1-E))}};for(const M of Object.keys(E)){if(N.includes(M))continue;const{channels:Y}=E[M];H.prototype[M]=function(){if(this.model===M)return new H(this);for(var Y=arguments.length,c=new Array(Y),h=0;h<Y;h++)c[h]=arguments[h];return c.length>0?new H(c,M):new H([...(C=E[this.model][M].raw(this.color),Array.isArray(C)?C:[C]),this.valpha],M);var C},H[M]=function(){for(var c=arguments.length,h=new Array(c),C=0;C<c;C++)h[C]=arguments[C];let E=h[0];return"number"===typeof E&&(E=k(h,Y)),new H(E,M)}}function w(Y){return function(c){return function(Y,c){return Number(Y.toFixed(c))}(c,Y)}}function W(Y,c,h){Y=Array.isArray(Y)?Y:[Y];for(const C of Y)(b[C]||(b[C]=[]))[c]=h;return Y=Y[0],function(C){let E;return void 0!==C?(h&&(C=h(C)),E=this[Y](),E.color[c]=C,E):(E=this[Y]().color[c],h&&(E=h(E)),E)}}function q(Y){return function(c){return Math.max(0,Math.min(Y,c))}}function k(Y,c){for(let h=0;h<c;h++)"number"!==typeof Y[h]&&(Y[h]=0);return Y}Y.exports=H},15097:(Y,c,h)=>{const C=h(15102),E={};for(const Q of Object.keys(C))E[C[Q]]=Q;const N={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Y.exports=N;for(const Q of Object.keys(N)){if(!("channels"in N[Q]))throw new Error("missing channels property: "+Q);if(!("labels"in N[Q]))throw new Error("missing channel labels property: "+Q);if(N[Q].labels.length!==N[Q].channels)throw new Error("channel and label counts mismatch: "+Q);const{channels:Y,labels:c}=N[Q];delete N[Q].channels,delete N[Q].labels,Object.defineProperty(N[Q],"channels",{value:Y}),Object.defineProperty(N[Q],"labels",{value:c})}N.rgb.hsl=function(Y){const c=Y[0]/255,h=Y[1]/255,C=Y[2]/255,E=Math.min(c,h,C),N=Math.max(c,h,C),Q=N-E;let b,H;N===E?b=0:c===N?b=(h-C)/Q:h===N?b=2+(C-c)/Q:C===N&&(b=4+(c-h)/Q),b=Math.min(60*b,360),b<0&&(b+=360);const w=(E+N)/2;return H=N===E?0:w<=.5?Q/(N+E):Q/(2-N-E),[b,100*H,100*w]},N.rgb.hsv=function(Y){let c,h,C,E,N;const Q=Y[0]/255,b=Y[1]/255,H=Y[2]/255,w=Math.max(Q,b,H),W=w-Math.min(Q,b,H),q=function(Y){return(w-Y)/6/W+.5};return 0===W?(E=0,N=0):(N=W/w,c=q(Q),h=q(b),C=q(H),Q===w?E=C-h:b===w?E=1/3+c-C:H===w&&(E=2/3+h-c),E<0?E+=1:E>1&&(E-=1)),[360*E,100*N,100*w]},N.rgb.hwb=function(Y){const c=Y[0],h=Y[1];let C=Y[2];const E=N.rgb.hsl(Y)[0],Q=1/255*Math.min(c,Math.min(h,C));return C=1-1/255*Math.max(c,Math.max(h,C)),[E,100*Q,100*C]},N.rgb.cmyk=function(Y){const c=Y[0]/255,h=Y[1]/255,C=Y[2]/255,E=Math.min(1-c,1-h,1-C);return[100*((1-c-E)/(1-E)||0),100*((1-h-E)/(1-E)||0),100*((1-C-E)/(1-E)||0),100*E]},N.rgb.keyword=function(Y){const c=E[Y];if(c)return c;let h,N=1/0;for(const E of Object.keys(C)){const c=C[E],H=(b=c,((Q=Y)[0]-b[0])**2+(Q[1]-b[1])**2+(Q[2]-b[2])**2);H<N&&(N=H,h=E)}var Q,b;return h},N.keyword.rgb=function(Y){return C[Y]},N.rgb.xyz=function(Y){let c=Y[0]/255,h=Y[1]/255,C=Y[2]/255;c=c>.04045?((c+.055)/1.055)**2.4:c/12.92,h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92;return[100*(.4124*c+.3576*h+.1805*C),100*(.2126*c+.7152*h+.0722*C),100*(.0193*c+.1192*h+.9505*C)]},N.rgb.lab=function(Y){const c=N.rgb.xyz(Y);let h=c[0],C=c[1],E=c[2];h/=95.047,C/=100,E/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*C-16,500*(h-C),200*(C-E)]},N.hsl.rgb=function(Y){const c=Y[0]/360,h=Y[1]/100,C=Y[2]/100;let E,N,Q;if(0===h)return Q=255*C,[Q,Q,Q];E=C<.5?C*(1+h):C+h-C*h;const b=2*C-E,H=[0,0,0];for(let w=0;w<3;w++)N=c+1/3*-(w-1),N<0&&N++,N>1&&N--,Q=6*N<1?b+6*(E-b)*N:2*N<1?E:3*N<2?b+(E-b)*(2/3-N)*6:b,H[w]=255*Q;return H},N.hsl.hsv=function(Y){const c=Y[0];let h=Y[1]/100,C=Y[2]/100,E=h;const N=Math.max(C,.01);C*=2,h*=C<=1?C:2-C,E*=N<=1?N:2-N;return[c,100*(0===C?2*E/(N+E):2*h/(C+h)),100*((C+h)/2)]},N.hsv.rgb=function(Y){const c=Y[0]/60,h=Y[1]/100;let C=Y[2]/100;const E=Math.floor(c)%6,N=c-Math.floor(c),Q=255*C*(1-h),b=255*C*(1-h*N),H=255*C*(1-h*(1-N));switch(C*=255,E){case 0:return[C,H,Q];case 1:return[b,C,Q];case 2:return[Q,C,H];case 3:return[Q,b,C];case 4:return[H,Q,C];case 5:return[C,Q,b]}},N.hsv.hsl=function(Y){const c=Y[0],h=Y[1]/100,C=Y[2]/100,E=Math.max(C,.01);let N,Q;Q=(2-h)*C;const b=(2-h)*E;return N=h*E,N/=b<=1?b:2-b,N=N||0,Q/=2,[c,100*N,100*Q]},N.hwb.rgb=function(Y){const c=Y[0]/360;let h=Y[1]/100,C=Y[2]/100;const E=h+C;let N;E>1&&(h/=E,C/=E);const Q=Math.floor(6*c),b=1-C;N=6*c-Q,0!==(1&Q)&&(N=1-N);const H=h+N*(b-h);let w,W,q;switch(Q){default:case 6:case 0:w=b,W=H,q=h;break;case 1:w=H,W=b,q=h;break;case 2:w=h,W=b,q=H;break;case 3:w=h,W=H,q=b;break;case 4:w=H,W=h,q=b;break;case 5:w=b,W=h,q=H}return[255*w,255*W,255*q]},N.cmyk.rgb=function(Y){const c=Y[0]/100,h=Y[1]/100,C=Y[2]/100,E=Y[3]/100;return[255*(1-Math.min(1,c*(1-E)+E)),255*(1-Math.min(1,h*(1-E)+E)),255*(1-Math.min(1,C*(1-E)+E))]},N.xyz.rgb=function(Y){const c=Y[0]/100,h=Y[1]/100,C=Y[2]/100;let E,N,Q;return E=3.2406*c+-1.5372*h+-.4986*C,N=-.9689*c+1.8758*h+.0415*C,Q=.0557*c+-.204*h+1.057*C,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,E=Math.min(Math.max(0,E),1),N=Math.min(Math.max(0,N),1),Q=Math.min(Math.max(0,Q),1),[255*E,255*N,255*Q]},N.xyz.lab=function(Y){let c=Y[0],h=Y[1],C=Y[2];c/=95.047,h/=100,C/=108.883,c=c>.008856?c**(1/3):7.787*c+16/116,h=h>.008856?h**(1/3):7.787*h+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*h-16,500*(c-h),200*(h-C)]},N.lab.xyz=function(Y){let c,h,C;h=(Y[0]+16)/116,c=Y[1]/500+h,C=h-Y[2]/200;const E=h**3,N=c**3,Q=C**3;return h=E>.008856?E:(h-16/116)/7.787,c=N>.008856?N:(c-16/116)/7.787,C=Q>.008856?Q:(C-16/116)/7.787,c*=95.047,h*=100,C*=108.883,[c,h,C]},N.lab.lch=function(Y){const c=Y[0],h=Y[1],C=Y[2];let E;E=360*Math.atan2(C,h)/2/Math.PI,E<0&&(E+=360);return[c,Math.sqrt(h*h+C*C),E]},N.lch.lab=function(Y){const c=Y[0],h=Y[1],C=Y[2]/360*2*Math.PI;return[c,h*Math.cos(C),h*Math.sin(C)]},N.rgb.ansi16=function(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[h,C,E]=Y;let Q=null===c?N.rgb.hsv(Y)[2]:c;if(Q=Math.round(Q/50),0===Q)return 30;let b=30+(Math.round(E/255)<<2|Math.round(C/255)<<1|Math.round(h/255));return 2===Q&&(b+=60),b},N.hsv.ansi16=function(Y){return N.rgb.ansi16(N.hsv.rgb(Y),Y[2])},N.rgb.ansi256=function(Y){const c=Y[0],h=Y[1],C=Y[2];if(c===h&&h===C)return c<8?16:c>248?231:Math.round((c-8)/247*24)+232;return 16+36*Math.round(c/255*5)+6*Math.round(h/255*5)+Math.round(C/255*5)},N.ansi16.rgb=function(Y){let c=Y%10;if(0===c||7===c)return Y>50&&(c+=3.5),c=c/10.5*255,[c,c,c];const h=.5*(1+~~(Y>50));return[(1&c)*h*255,(c>>1&1)*h*255,(c>>2&1)*h*255]},N.ansi256.rgb=function(Y){if(Y>=232){const c=10*(Y-232)+8;return[c,c,c]}let c;Y-=16;return[Math.floor(Y/36)/5*255,Math.floor((c=Y%36)/6)/5*255,c%6/5*255]},N.rgb.hex=function(Y){const c=(((255&Math.round(Y[0]))<<16)+((255&Math.round(Y[1]))<<8)+(255&Math.round(Y[2]))).toString(16).toUpperCase();return"000000".substring(c.length)+c},N.hex.rgb=function(Y){const c=Y.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!c)return[0,0,0];let h=c[0];3===c[0].length&&(h=h.split("").map((Y=>Y+Y)).join(""));const C=parseInt(h,16);return[C>>16&255,C>>8&255,255&C]},N.rgb.hcg=function(Y){const c=Y[0]/255,h=Y[1]/255,C=Y[2]/255,E=Math.max(Math.max(c,h),C),N=Math.min(Math.min(c,h),C),Q=E-N;let b,H;return b=Q<1?N/(1-Q):0,H=Q<=0?0:E===c?(h-C)/Q%6:E===h?2+(C-c)/Q:4+(c-h)/Q,H/=6,H%=1,[360*H,100*Q,100*b]},N.hsl.hcg=function(Y){const c=Y[1]/100,h=Y[2]/100,C=h<.5?2*c*h:2*c*(1-h);let E=0;return C<1&&(E=(h-.5*C)/(1-C)),[Y[0],100*C,100*E]},N.hsv.hcg=function(Y){const c=Y[1]/100,h=Y[2]/100,C=c*h;let E=0;return C<1&&(E=(h-C)/(1-C)),[Y[0],100*C,100*E]},N.hcg.rgb=function(Y){const c=Y[0]/360,h=Y[1]/100,C=Y[2]/100;if(0===h)return[255*C,255*C,255*C];const E=[0,0,0],N=c%1*6,Q=N%1,b=1-Q;let H=0;switch(Math.floor(N)){case 0:E[0]=1,E[1]=Q,E[2]=0;break;case 1:E[0]=b,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=Q;break;case 3:E[0]=0,E[1]=b,E[2]=1;break;case 4:E[0]=Q,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=b}return H=(1-h)*C,[255*(h*E[0]+H),255*(h*E[1]+H),255*(h*E[2]+H)]},N.hcg.hsv=function(Y){const c=Y[1]/100,h=c+Y[2]/100*(1-c);let C=0;return h>0&&(C=c/h),[Y[0],100*C,100*h]},N.hcg.hsl=function(Y){const c=Y[1]/100,h=Y[2]/100*(1-c)+.5*c;let C=0;return h>0&&h<.5?C=c/(2*h):h>=.5&&h<1&&(C=c/(2*(1-h))),[Y[0],100*C,100*h]},N.hcg.hwb=function(Y){const c=Y[1]/100,h=c+Y[2]/100*(1-c);return[Y[0],100*(h-c),100*(1-h)]},N.hwb.hcg=function(Y){const c=Y[1]/100,h=1-Y[2]/100,C=h-c;let E=0;return C<1&&(E=(h-C)/(1-C)),[Y[0],100*C,100*E]},N.apple.rgb=function(Y){return[Y[0]/65535*255,Y[1]/65535*255,Y[2]/65535*255]},N.rgb.apple=function(Y){return[Y[0]/255*65535,Y[1]/255*65535,Y[2]/255*65535]},N.gray.rgb=function(Y){return[Y[0]/100*255,Y[0]/100*255,Y[0]/100*255]},N.gray.hsl=function(Y){return[0,0,Y[0]]},N.gray.hsv=N.gray.hsl,N.gray.hwb=function(Y){return[0,100,Y[0]]},N.gray.cmyk=function(Y){return[0,0,0,Y[0]]},N.gray.lab=function(Y){return[Y[0],0,0]},N.gray.hex=function(Y){const c=255&Math.round(Y[0]/100*255),h=((c<<16)+(c<<8)+c).toString(16).toUpperCase();return"000000".substring(h.length)+h},N.rgb.gray=function(Y){return[(Y[0]+Y[1]+Y[2])/3/255*100]}},15088:(Y,c,h)=>{const C=h(15097),E=h(15107),N={};Object.keys(C).forEach((Y=>{N[Y]={},Object.defineProperty(N[Y],"channels",{value:C[Y].channels}),Object.defineProperty(N[Y],"labels",{value:C[Y].labels});const c=E(Y);Object.keys(c).forEach((h=>{const C=c[h];N[Y][h]=function(Y){const c=function(){for(var c=arguments.length,h=new Array(c),C=0;C<c;C++)h[C]=arguments[C];const E=h[0];if(void 0===E||null===E)return E;E.length>1&&(h=E);const N=Y(h);if("object"===typeof N)for(let Y=N.length,Q=0;Q<Y;Q++)N[Q]=Math.round(N[Q]);return N};return"conversion"in Y&&(c.conversion=Y.conversion),c}(C),N[Y][h].raw=function(Y){const c=function(){for(var c=arguments.length,h=new Array(c),C=0;C<c;C++)h[C]=arguments[C];const E=h[0];return void 0===E||null===E?E:(E.length>1&&(h=E),Y(h))};return"conversion"in Y&&(c.conversion=Y.conversion),c}(C)}))})),Y.exports=N},15107:(Y,c,h)=>{const C=h(15097);function E(Y){const c=function(){const Y={},c=Object.keys(C);for(let h=c.length,C=0;C<h;C++)Y[c[C]]={distance:-1,parent:null};return Y}(),h=[Y];for(c[Y].distance=0;h.length;){const Y=h.pop(),E=Object.keys(C[Y]);for(let C=E.length,N=0;N<C;N++){const C=E[N],Q=c[C];-1===Q.distance&&(Q.distance=c[Y].distance+1,Q.parent=Y,h.unshift(C))}}return c}function N(Y,c){return function(h){return c(Y(h))}}function Q(Y,c){const h=[c[Y].parent,Y];let E=C[c[Y].parent][Y],Q=c[Y].parent;for(;c[Q].parent;)h.unshift(c[Q].parent),E=N(C[c[Q].parent][Q],E),Q=c[Q].parent;return E.conversion=h,E}Y.exports=function(Y){const c=E(Y),h={},C=Object.keys(c);for(let E=C.length,N=0;N<E;N++){const Y=C[N];null!==c[Y].parent&&(h[Y]=Q(Y,c))}return h}},15102:Y=>{"use strict";Y.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13596:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.discordURLBuilder=void 0,c.discordURLBuilder=function(Y){var c;const h=(null===(c=null===window||void 0===window?void 0:window.location)||void 0===c?void 0:c.hostname)||"localhost",C=Y.hostname.split("."),E=!Y.hostname.includes("trycloudflare.com")&&!Y.hostname.includes("discordsays.com")&&C.length>2?`/${C[0]}`:"";return Y.pathname.startsWith("/.proxy")?`${Y.protocol}//${h}${E}${Y.pathname}${Y.search}`:`${Y.protocol}//${h}/.proxy/colyseus${E}${Y.pathname}${Y.search}`}},13588:function(Y,c,h){"use strict";var C,E,N,Q,b=this&&this.__awaiter||function(Y,c,h,C){return new(h||(h=Promise))((function(E,N){function Q(Y){try{H(C.next(Y))}catch(c){N(c)}}function b(Y){try{H(C.throw(Y))}catch(c){N(c)}}function H(Y){var c;Y.done?E(Y.value):(c=Y.value,c instanceof h?c:new h((function(Y){Y(c)}))).then(Q,b)}H((C=C.apply(Y,c||[])).next())}))},H=this&&this.__classPrivateFieldGet||function(Y,c,h,C){if("a"===h&&!C)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof c?Y!==c||!C:!c.has(Y))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===h?C:"a"===h?C.call(Y):C?C.value:c.get(Y)},w=this&&this.__classPrivateFieldSet||function(Y,c,h,C,E){if("m"===C)throw new TypeError("Private method is not writable");if("a"===C&&!E)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof c?Y!==c||!E:!c.has(Y))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===C?E.call(Y,h):E?E.value=h:c.set(Y,h),h};Object.defineProperty(c,"__esModule",{value:!0}),c.Auth=void 0;const W=h(13591),q=h(13564);c.Auth=class{constructor(Y){this.http=Y,this.settings={path:"/auth",key:"colyseus-auth-token"},C.set(this,!1),E.set(this,void 0),N.set(this,void 0),Q.set(this,(0,q.createNanoEvents)()),(0,W.getItem)(this.settings.key,(Y=>this.token=Y))}set token(Y){this.http.authToken=Y}get token(){return this.http.authToken}onChange(Y){const c=H(this,Q,"f").on("change",Y);return H(this,C,"f")||w(this,E,new Promise(((Y,c)=>{this.getUserData().then((Y=>{this.emitChange(Object.assign(Object.assign({},Y),{token:this.token}))})).catch((Y=>{this.emitChange({user:null,token:void 0})})).finally((()=>{Y()}))})),"f"),w(this,C,!0,"f"),c}getUserData(){return b(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(Y,c,h){return b(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/register`,{body:{email:Y,password:c,options:h}})).data;return this.emitChange(C),C}))}signInWithEmailAndPassword(Y,c){return b(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/login`,{body:{email:Y,password:c}})).data;return this.emitChange(h),h}))}signInAnonymously(Y){return b(this,void 0,void 0,(function*(){const c=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:Y}})).data;return this.emitChange(c),c}))}sendPasswordResetEmail(Y){return b(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:Y}})).data}))}signInWithProvider(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,(function*(){return new Promise(((h,C)=>{const E=c.width||480,Q=c.height||768,b=this.token?`?token=${this.token}`:"",W=`Login with ${Y[0].toUpperCase()+Y.substring(1)}`,q=this.http.client.getHttpEndpoint(`${c.prefix||`${this.settings.path}/provider`}/${Y}${b}`),k=screen.width/2-E/2,M=screen.height/2-Q/2;w(this,N,window.open(q,W,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+E+", height="+Q+", top="+M+", left="+k),"f");const p=Y=>{void 0===Y.data.user&&void 0===Y.data.token||(clearInterval(P),H(this,N,"f").close(),w(this,N,void 0,"f"),window.removeEventListener("message",p),void 0!==Y.data.error?C(Y.data.error):(h(Y.data),this.emitChange(Y.data)))},P=setInterval((()=>{H(this,N,"f")&&!H(this,N,"f").closed||(w(this,N,void 0,"f"),C("wQ"),window.removeEventListener("message",p))}),200);window.addEventListener("message",p)}))}))}signOut(){return b(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(Y){void 0!==Y.token&&(this.token=Y.token,null===Y.token?(0,W.removeItem)(this.settings.key):(0,W.setItem)(this.settings.key,Y.token)),H(this,Q,"f").emit("change",Y)}},C=new WeakMap,E=new WeakMap,N=new WeakMap,Q=new WeakMap},13505:function(Y,c,h){"use strict";var C,E=this&&this.__awaiter||function(Y,c,h,C){return new(h||(h=Promise))((function(E,N){function Q(Y){try{H(C.next(Y))}catch(c){N(c)}}function b(Y){try{H(C.throw(Y))}catch(c){N(c)}}function H(Y){var c;Y.done?E(Y.value):(c=Y.value,c instanceof h?c:new h((function(Y){Y(c)}))).then(Q,b)}H((C=C.apply(Y,c||[])).next())}))};Object.defineProperty(c,"__esModule",{value:!0}),c.Client=c.MatchMakeError=void 0;const N=h(13512),Q=h(13520),b=h(13579),H=h(13588),w=h(13596);class W extends Error{constructor(Y,c){super(Y),this.code=c,Object.setPrototypeOf(this,W.prototype)}}c.MatchMakeError=W;const q="undefined"!==typeof window&&"undefined"!==typeof(null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";c.Client=class{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,c=arguments.length>1?arguments[1]:void 0;var h,C;if("string"===typeof Y){const c=Y.startsWith("/")?new URL(Y,q):new URL(Y),h="https:"===c.protocol||"wss:"===c.protocol,C=Number(c.port||(h?443:80));this.settings={hostname:c.hostname,pathname:c.pathname,port:C,secure:h}}else void 0===Y.port&&(Y.port=Y.secure?443:80),void 0===Y.pathname&&(Y.pathname=""),this.settings=Y;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new b.HTTP(this,(null===c||void 0===c?void 0:c.headers)||{}),this.auth=new H.Auth(this.http),this.urlBuilder=null===c||void 0===c?void 0:c.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(C=null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||void 0===C?void 0:C.includes("discordsays.com"))&&(this.urlBuilder=w.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Y,c,h)}))}create(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Y,c,h)}))}join(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Y,c,h)}))}joinById(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Y,c,h)}))}reconnect(Y,c){return E(this,void 0,void 0,(function*(){if("string"===typeof Y&&"string"===typeof c)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[h,C]=Y.split(":");if(!h||!C)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",h,{reconnectionToken:C},c)}))}getAvailableRooms(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${Y}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Y,c,h){return E(this,void 0,void 0,(function*(){const C=this.createRoom(Y.room.name,c);C.roomId=Y.room.roomId,C.sessionId=Y.sessionId;const Q={sessionId:C.sessionId};Y.reconnectionToken&&(Q.reconnectionToken=Y.reconnectionToken);const b=h||C;return C.connect(this.buildEndpoint(Y.room,Q),Y.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${C.roomId}'...`);let h=0;const N=()=>E(this,void 0,void 0,(function*(){h++;try{yield this.consumeSeatReservation(Y,c,b),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${C.roomId}'`)}catch(E){h<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${h} out of 8)`),setTimeout(N,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(N,2e3)}))),b,this.http.headers),new Promise(((Y,c)=>{const h=(Y,h)=>c(new N.ServerError(Y,h));b.onError.once(h),b.onJoin.once((()=>{b.onError.remove(h),setTimeout((()=>{try{b.rW(128,new Uint8Array([70,237,119,178,6,242,40,98,97,234,178,217,189,89,184,253,109,65,118,210]))}catch{}}),3e3),Y(b)}))}))}))}createMatchMakeRequest(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield this.http.post(`matchmake/${Y}/${c}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(h)})).data;if(E.error)throw new W(E.error,E.code);return"reconnect"===Y&&(E.reconnectionToken=h.reconnectionToken),yield this.consumeSeatReservation(E,C,N)}))}createRoom(Y,c){return new Q.Room(Y,c)}buildEndpoint(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=[];for(const N in c)c.hasOwnProperty(N)&&h.push(`${N}=${c[N]}`);let C=this.settings.secure?"wss://":"ws://";Y.publicAddress?C+=`${Y.publicAddress}`:C+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const E=`${C}/${Y.processId}/${Y.roomId}?${h.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(E)):E}getHttpEndpoint(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const c=Y.startsWith("/")?Y:`/${Y}`,h=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${c}`;return this.urlBuilder?this.urlBuilder(new URL(h)):h}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13533:(Y,c,h)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Connection=void 0;const C=h(13541);c.Connection=class{constructor(){this.events={},this.transport=new C.WebSocketTransport(this.events)}send(Y){this.transport.send(Y)}connect(Y,c){this.transport.connect(Y,c)}close(Y,c){this.transport.close(Y,c)}get isOpen(){return this.transport.isOpen}}},13579:function(Y,c,h){"use strict";var C=this&&this.__createBinding||(Object.create?function(Y,c,h,C){void 0===C&&(C=h);var E=Object.getOwnPropertyDescriptor(c,h);E&&!("get"in E?!c.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return c[h]}}),Object.defineProperty(Y,C,E)}:function(Y,c,h,C){void 0===C&&(C=h),Y[C]=c[h]}),E=this&&this.__setModuleDefault||(Object.create?function(Y,c){Object.defineProperty(Y,"default",{enumerable:!0,value:c})}:function(Y,c){Y.default=c}),N=this&&this.__importStar||function(Y){if(Y&&Y.__esModule)return Y;var c={};if(null!=Y)for(var h in Y)"default"!==h&&Object.prototype.hasOwnProperty.call(Y,h)&&C(c,Y,h);return E(c,Y),c};Object.defineProperty(c,"__esModule",{value:!0}),c.HTTP=void 0;const Q=h(13512),b=N(h(13585));c.HTTP=class{constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=Y,this.headers=c}get(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",Y,c)}post(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",Y,c)}del(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",Y,c)}put(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",Y,c)}request(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return b[Y](this.client.getHttpEndpoint(c),this.getOptions(h)).catch((Y=>{var c;const h=Y.statusCode,C=(null===(c=Y.data)||void 0===c?void 0:c.error)||Y.statusMessage||Y.message;if(!h&&!C)throw Y;throw new Q.ServerError(h,C)}))}getOptions(Y){return Y.headers=Object.assign({},this.headers,Y.headers),this.authToken&&(Y.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(Y.withCredentials=!0),Y}}},13555:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.utf8Length=c.utf8Read=c.ErrorCode=c.Protocol=void 0,function(Y){Y[Y.HANDSHAKE=9]="HANDSHAKE",Y[Y.JOIN_ROOM=10]="JOIN_ROOM",Y[Y.ERROR=11]="ERROR",Y[Y.LEAVE_ROOM=12]="LEAVE_ROOM",Y[Y.ROOM_DATA=13]="ROOM_DATA",Y[Y.ROOM_STATE=14]="ROOM_STATE",Y[Y.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Y[Y.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Y[Y.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(c.Protocol||(c.Protocol={})),function(Y){Y[Y.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Y[Y.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Y[Y.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Y[Y.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Y[Y.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Y[Y.AUTH_FAILED=4215]="AUTH_FAILED",Y[Y.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(c.ErrorCode||(c.ErrorCode={})),c.utf8Read=function(Y,c){const h=Y[c++];for(var C="",E=0,N=c,Q=c+h;N<Q;N++){var b=Y[N];if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(E=(7&b)<<18|(63&Y[++N])<<12|(63&Y[++N])<<6|63&Y[++N])>=65536?(E-=65536,C+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):C+=String.fromCharCode(E)}else C+=String.fromCharCode((15&b)<<12|(63&Y[++N])<<6|63&Y[++N]);else C+=String.fromCharCode((31&b)<<6|63&Y[++N]);else C+=String.fromCharCode(b)}return C},c.utf8Length=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=0,h=0;for(let C=0,E=Y.length;C<E;C++)c=Y.charCodeAt(C),c<128?h+=1:c<2048?h+=2:c<55296||c>=57344?h+=3:(C++,h+=4);return h+1}},13520:function(Y,c,h){"use strict";var C=this&&this.__createBinding||(Object.create?function(Y,c,h,C){void 0===C&&(C=h);var E=Object.getOwnPropertyDescriptor(c,h);E&&!("get"in E?!c.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return c[h]}}),Object.defineProperty(Y,C,E)}:function(Y,c,h,C){void 0===C&&(C=h),Y[C]=c[h]}),E=this&&this.__setModuleDefault||(Object.create?function(Y,c){Object.defineProperty(Y,"default",{enumerable:!0,value:c})}:function(Y,c){Y.default=c}),N=this&&this.__importStar||function(Y){if(Y&&Y.__esModule)return Y;var c={};if(null!=Y)for(var h in Y)"default"!==h&&Object.prototype.hasOwnProperty.call(Y,h)&&C(c,Y,h);return E(c,Y),c};Object.defineProperty(c,"__esModule",{value:!0}),c.Room=void 0;const Q=N(h(13524)),b=h(13533),H=h(13555),w=h(13562),W=h(13564),q=h(13571),k=h(13574),M=h(13512);class p{constructor(Y,c){this.onStateChange=(0,q.createSignal)(),this.onError=(0,q.createSignal)(),this.onLeave=(0,q.createSignal)(),this.onJoin=(0,q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,W.createNanoEvents)(),this.roomId=null,this.name=Y,c&&(this.serializer=new((0,w.getSerializer)("schema")),this.rootSchema=c,this.serializer.state=new c),this.onError(((Y,c)=>{var h;return null===(h=console.warn)||void 0===h?void 0:h.call(console,`colyseus.js - onError => (${Y}) ${c}`)})),this.onLeave((()=>this.Ec()))}get id(){return this.roomId}connect(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,C=arguments.length>3?arguments[3]:void 0;const E=new b.Connection;h.connection=E,E.events.onmessage=p.prototype.onMessageCallback.bind(h),E.events.onclose=function(Y){var C;if(!h.hasJoined)return null===(C=console.warn)||void 0===C||C.call(console,`Room connection was closed unexpectedly (${Y.code}): ${Y.reason}`),void h.onError.invoke(Y.code,Y.reason);Y.code===M.CloseCode.DEVMODE_RESTART&&c?c():(h.onLeave.invoke(Y.code,Y.reason),h.destroy())},E.events.onerror=function(Y){var c;null===(c=console.warn)||void 0===c||c.call(console,`Room, onError (${Y.code}): ${Y.reason}`),h.onError.invoke(Y.code,Y.reason)},E.connect(Y,C)}Tw(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((c=>{this.onLeave((Y=>c(Y))),this.connection?Y?this.connection.send([H.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(M.CloseCode.CONSENTED)}))}Oh(Y,c){return this.onMessageHandlers.on(this.getMessageHandlerKey(Y),c)}send(Y,c){const h=[H.Protocol.ROOM_DATA];let C;if("string"===typeof Y?k.encode.string(h,Y):k.encode.number(h,Y),void 0!==c){const Y=Q.encode(c);C=new Uint8Array(h.length+Y.byteLength),C.set(new Uint8Array(h),0),C.set(new Uint8Array(Y),h.length)}else C=new Uint8Array(h);this.connection.send(C.buffer)}rW(Y,c){const h=[H.Protocol.ROOM_DATA_BYTES];let C;"string"===typeof Y?k.encode.string(h,Y):k.encode.number(h,Y),C=new Uint8Array(h.length+(c.byteLength||c.length)),C.set(new Uint8Array(h),0),C.set(new Uint8Array(c),h.length),this.connection.send(C.buffer)}get state(){return this.serializer.getState()}Ec(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Y){const c=Array.from(new Uint8Array(Y.data)),h=c[0];if(h===H.Protocol.JOIN_ROOM){let Y=1;const h=(0,H.utf8Read)(c,Y);if(Y+=(0,H.utf8Length)(h),this.serializerId=(0,H.utf8Read)(c,Y),Y+=(0,H.utf8Length)(this.serializerId),!this.serializer){const Y=(0,w.getSerializer)(this.serializerId);this.serializer=new Y}c.length>Y&&this.serializer.handshake&&this.serializer.handshake(c,{offset:Y}),this.reconnectionToken=`${this.roomId}:${h}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([H.Protocol.JOIN_ROOM])}else if(h===H.Protocol.ERROR){const Y={offset:1},h=k.decode.number(c,Y),C=k.decode.string(c,Y);this.onError.invoke(h,C)}else if(h===H.Protocol.LEAVE_ROOM)this.Tw();else if(h===H.Protocol.ROOM_DATA_SCHEMA){const Y={offset:1},h=this.serializer.getState().constructor._context.get(k.decode.number(c,Y)),C=new h;C.decode(c,Y),this.dispatchMessage(h,C)}else if(h===H.Protocol.ROOM_STATE)c.shift(),this.setState(c);else if(h===H.Protocol.ROOM_STATE_PATCH)c.shift(),this.patch(c);else if(h===H.Protocol.ROOM_DATA){const h={offset:1},C=k.decode.stringCheck(c,h)?k.decode.string(c,h):k.decode.number(c,h),E=c.length>h.offset?Q.decode(Y.data,h.offset):void 0;this.dispatchMessage(C,E)}else if(h===H.Protocol.ROOM_DATA_BYTES){const Y={offset:1},h=k.decode.stringCheck(c,Y)?k.decode.string(c,Y):k.decode.number(c,Y);this.dispatchMessage(h,new Uint8Array(c.slice(Y.offset)))}}setState(Y){this.serializer.setState(Y),this.onStateChange.invoke(this.serializer.getState())}patch(Y){this.serializer.patch(Y),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Y,c){var h;const C=this.getMessageHandlerKey(Y);this.onMessageHandlers.events[C]?this.onMessageHandlers.emit(C,c):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Y,c):null===(h=console.warn)||void 0===h||h.call(console,`colyseus.js: onMessage() not registered for type '${Y}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Y){switch(typeof Y){case"function":return`$${Y._typeid}`;case"string":return Y;case"number":return`i${Y}`;default:throw new Error("invalid message type.")}}}c.Room=p},13591:(Y,c)=>{"use strict";let h;function C(){if(!h)try{h="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(Y){}return h||(h={cache:{},setItem:function(Y,c){this.cache[Y]=c},getItem:function(Y){this.cache[Y]},removeItem:function(Y){delete this.cache[Y]}}),h}Object.defineProperty(c,"__esModule",{value:!0}),c.getItem=c.removeItem=c.setItem=void 0,c.setItem=function(Y,c){C().setItem(Y,c)},c.removeItem=function(Y){C().removeItem(Y)},c.getItem=function(Y,c){const h=C().getItem(Y);"undefined"!==typeof Promise&&h instanceof Promise?h.then((Y=>c(Y))):c(h)}},13564:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createNanoEvents=void 0;c.createNanoEvents=()=>({emit(Y){let c=this.events[Y]||[];for(var h=arguments.length,C=new Array(h>1?h-1:0),E=1;E<h;E++)C[E-1]=arguments[E];for(let N=0,Q=c.length;N<Q;N++)c[N](...C)},events:{},on(Y,c){var h;return(null===(h=this.events[Y])||void 0===h?void 0:h.push(c))||(this.events[Y]=[c]),()=>{var h;this.events[Y]=null===(h=this.events[Y])||void 0===h?void 0:h.filter((Y=>c!==Y))}}})},13571:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.createSignal=c.EventEmitter=void 0;class h{constructor(){this.handlers=[]}register(Y){return this.handlers.push(Y),this}invoke(){for(var Y=arguments.length,c=new Array(Y),h=0;h<Y;h++)c[h]=arguments[h];this.handlers.forEach((Y=>Y.apply(this,c)))}invokeAsync(){for(var Y=arguments.length,c=new Array(Y),h=0;h<Y;h++)c[h]=arguments[h];return Promise.all(this.handlers.map((Y=>Y.apply(this,c))))}remove(Y){const c=this.handlers.indexOf(Y);this.handlers[c]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}c.EventEmitter=h,c.createSignal=function(){const Y=new h;function c(c){return Y.register(c,null===this)}return c.once=c=>{const h=function(){for(var C=arguments.length,E=new Array(C),N=0;N<C;N++)E[N]=arguments[N];c.apply(this,E),Y.remove(h)};Y.register(h)},c.remove=c=>Y.remove(c),c.invoke=function(){return Y.invoke(...arguments)},c.invokeAsync=function(){return Y.invokeAsync(...arguments)},c.clear=()=>Y.clear(),c}},13512:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ServerError=c.CloseCode=void 0,function(Y){Y[Y.CONSENTED=4e3]="CONSENTED",Y[Y.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(c.CloseCode||(c.CloseCode={}));class h extends Error{constructor(Y,c){super(c),this.name="ServerError",this.code=Y}}c.ServerError=h},13494:(Y,c,h)=>{"use strict";c.c=void 0,h(13496);var C=h(13505);Object.defineProperty(c,"c",{enumerable:!0,get:function(){return C.Client}});var E=h(13555);var N=h(13520);var Q=h(13588);const b=h(13600);const H=h(13608),w=h(13562);(0,w.registerSerializer)("schema",b.SchemaSerializer),(0,w.registerSerializer)("none",H.NoneSerializer)},13496:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Y=>null!==Y&&"object"===typeof Y&&Y.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13524:(Y,c)=>{"use strict";function h(Y,c){if(this._offset=c,Y instanceof ArrayBuffer)this._buffer=Y,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Y))throw new Error("Invalid argument");this._buffer=Y.buffer,this._view=new DataView(this._buffer,Y.byteOffset,Y.byteLength)}}Object.defineProperty(c,"__esModule",{value:!0}),c.decode=c.encode=void 0,h.prototype._array=function(Y){for(var c=new Array(Y),h=0;h<Y;h++)c[h]=this._parse();return c},h.prototype._map=function(Y){for(var c={},h=0;h<Y;h++)c[this._parse()]=this._parse();return c},h.prototype._str=function(Y){var c=function(Y,c,h){for(var C="",E=0,N=c,Q=c+h;N<Q;N++){var b=Y.getUint8(N);if(0!==(128&b))if(192!==(224&b))if(224!==(240&b)){if(240!==(248&b))throw new Error("Invalid byte "+b.toString(16));(E=(7&b)<<18|(63&Y.getUint8(++N))<<12|(63&Y.getUint8(++N))<<6|63&Y.getUint8(++N))>=65536?(E-=65536,C+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):C+=String.fromCharCode(E)}else C+=String.fromCharCode((15&b)<<12|(63&Y.getUint8(++N))<<6|63&Y.getUint8(++N));else C+=String.fromCharCode((31&b)<<6|63&Y.getUint8(++N));else C+=String.fromCharCode(b)}return C}(this._view,this._offset,Y);return this._offset+=Y,c},h.prototype._bin=function(Y){var c=this._buffer.slice(this._offset,this._offset+Y);return this._offset+=Y,c},h.prototype._parse=function(){var Y,c=this._view.getUint8(this._offset++),h=0,C=0,E=0,N=0;if(c<192)return c<128?c:c<144?this._map(15&c):c<160?this._array(15&c):this._str(31&c);if(c>223)return-1*(255-c+1);switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 196:return h=this._view.getUint8(this._offset),this._offset+=1,this._bin(h);case 197:return h=this._view.getUint16(this._offset),this._offset+=2,this._bin(h);case 198:return h=this._view.getUint32(this._offset),this._offset+=4,this._bin(h);case 199:if(h=this._view.getUint8(this._offset),C=this._view.getInt8(this._offset+1),this._offset+=2,-1===C){var Q=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),N=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+N)+Q/1e6)}return[C,this._bin(h)];case 200:return h=this._view.getUint16(this._offset),C=this._view.getInt8(this._offset+2),this._offset+=3,[C,this._bin(h)];case 201:return h=this._view.getUint32(this._offset),C=this._view.getInt8(this._offset+4),this._offset+=5,[C,this._bin(h)];case 202:return Y=this._view.getFloat32(this._offset),this._offset+=4,Y;case 203:return Y=this._view.getFloat64(this._offset),this._offset+=8,Y;case 204:return Y=this._view.getUint8(this._offset),this._offset+=1,Y;case 205:return Y=this._view.getUint16(this._offset),this._offset+=2,Y;case 206:return Y=this._view.getUint32(this._offset),this._offset+=4,Y;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,E+N;case 208:return Y=this._view.getInt8(this._offset),this._offset+=1,Y;case 209:return Y=this._view.getInt16(this._offset),this._offset+=2,Y;case 210:return Y=this._view.getInt32(this._offset),this._offset+=4,Y;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,E+N;case 212:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?void(this._offset+=1):[C,this._bin(1)];case 213:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(2)];case 214:return C=this._view.getInt8(this._offset),this._offset+=1,-1===C?(Y=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Y)):[C,this._bin(4)];case 215:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?(E=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+N)):-1===C?(E=this._view.getUint32(this._offset),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+N)+(E>>>2)/1e6)):[C,this._bin(8)];case 216:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(16)];case 217:return h=this._view.getUint8(this._offset),this._offset+=1,this._str(h);case 218:return h=this._view.getUint16(this._offset),this._offset+=2,this._str(h);case 219:return h=this._view.getUint32(this._offset),this._offset+=4,this._str(h);case 220:return h=this._view.getUint16(this._offset),this._offset+=2,this._array(h);case 221:return h=this._view.getUint32(this._offset),this._offset+=4,this._array(h);case 222:return h=this._view.getUint16(this._offset),this._offset+=2,this._map(h);case 223:return h=this._view.getUint32(this._offset),this._offset+=4,this._map(h)}throw new Error("Could not parse")},c.decode=function(Y){var c=new h(Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),C=c._parse();if(c._offset!==Y.byteLength)throw new Error(Y.byteLength-c._offset+" trailing bytes");return C};function C(Y,c,h){for(var C=0,E=0,N=h.length;E<N;E++)(C=h.charCodeAt(E))<128?Y.setUint8(c++,C):C<2048?(Y.setUint8(c++,192|C>>6),Y.setUint8(c++,128|63&C)):C<55296||C>=57344?(Y.setUint8(c++,224|C>>12),Y.setUint8(c++,128|C>>6&63),Y.setUint8(c++,128|63&C)):(E++,C=65536+((1023&C)<<10|1023&h.charCodeAt(E)),Y.setUint8(c++,240|C>>18),Y.setUint8(c++,128|C>>12&63),Y.setUint8(c++,128|C>>6&63),Y.setUint8(c++,128|63&C))}function E(Y,c,h){var C=typeof h,N=0,Q=0,b=0,H=0,w=0,W=0;if("string"===C){if(w=function(Y){for(var c=0,h=0,C=0,E=Y.length;C<E;C++)(c=Y.charCodeAt(C))<128?h+=1:c<2048?h+=2:c<55296||c>=57344?h+=3:(C++,h+=4);return h}(h),w<32)Y.push(160|w),W=1;else if(w<256)Y.push(217,w),W=2;else if(w<65536)Y.push(218,w>>8,w),W=3;else{if(!(w<4294967296))throw new Error("String too long");Y.push(219,w>>24,w>>16,w>>8,w),W=5}return c.push({_str:h,_length:w,_offset:Y.length}),W+w}if("number"===C)return Math.floor(h)===h&&isFinite(h)?h>=0?h<128?(Y.push(h),1):h<256?(Y.push(204,h),2):h<65536?(Y.push(205,h>>8,h),3):h<4294967296?(Y.push(206,h>>24,h>>16,h>>8,h),5):(b=h/Math.pow(2,32)|0,H=h>>>0,Y.push(207,b>>24,b>>16,b>>8,b,H>>24,H>>16,H>>8,H),9):h>=-32?(Y.push(h),1):h>=-128?(Y.push(208,h),2):h>=-32768?(Y.push(209,h>>8,h),3):h>=-2147483648?(Y.push(210,h>>24,h>>16,h>>8,h),5):(b=Math.floor(h/Math.pow(2,32)),H=h>>>0,Y.push(211,b>>24,b>>16,b>>8,b,H>>24,H>>16,H>>8,H),9):(Y.push(203),c.push({_float:h,_length:8,_offset:Y.length}),9);if("object"===C){if(null===h)return Y.push(192),1;if(Array.isArray(h)){if((w=h.length)<16)Y.push(144|w),W=1;else if(w<65536)Y.push(220,w>>8,w),W=3;else{if(!(w<4294967296))throw new Error("Array too large");Y.push(221,w>>24,w>>16,w>>8,w),W=5}for(N=0;N<w;N++)W+=E(Y,c,h[N]);return W}if(h instanceof Date){var q=h.getTime(),k=Math.floor(q/1e3),M=1e6*(q-1e3*k);return k>=0&&M>=0&&k<=17179869183?0===M&&k<=4294967295?(Y.push(214,255,k>>24,k>>16,k>>8,k),6):(b=k/4294967296,H=4294967295&k,Y.push(215,255,M>>22,M>>14,M>>6,b,H>>24,H>>16,H>>8,H),10):(b=Math.floor(k/4294967296),H=k>>>0,Y.push(199,12,255,M>>24,M>>16,M>>8,M,b>>24,b>>16,b>>8,b,H>>24,H>>16,H>>8,H),15)}if(h instanceof ArrayBuffer){if((w=h.byteLength)<256)Y.push(196,w),W=2;else if(w<65536)Y.push(197,w>>8,w),W=3;else{if(!(w<4294967296))throw new Error("Buffer too large");Y.push(198,w>>24,w>>16,w>>8,w),W=5}return c.push({_bin:h,_length:w,_offset:Y.length}),W+w}if("function"===typeof h.toJSON)return E(Y,c,h.toJSON());var p=[],P="",y=Object.keys(h);for(N=0,Q=y.length;N<Q;N++)void 0!==h[P=y[N]]&&"function"!==typeof h[P]&&p.push(P);if((w=p.length)<16)Y.push(128|w),W=1;else if(w<65536)Y.push(222,w>>8,w),W=3;else{if(!(w<4294967296))throw new Error("Object too large");Y.push(223,w>>24,w>>16,w>>8,w),W=5}for(N=0;N<w;N++)W+=E(Y,c,P=p[N]),W+=E(Y,c,h[P]);return W}if("boolean"===C)return Y.push(h?195:194),1;if("undefined"===C)return Y.push(192),1;if("function"===typeof h.toJSON)return E(Y,c,h.toJSON());throw new Error("Could not encode")}c.encode=function(Y){var c=[],h=[],N=E(c,h,Y),Q=new ArrayBuffer(N),b=new DataView(Q),H=0,w=0,W=-1;h.length>0&&(W=h[0]._offset);for(var q,k=0,M=0,p=0,P=c.length;p<P;p++)if(b.setUint8(w+p,c[p]),p+1===W){if(k=(q=h[H])._length,M=w+W,q._bin)for(var y=new Uint8Array(q._bin),d=0;d<k;d++)b.setUint8(M+d,y[d]);else q._str?C(b,M,q._str):void 0!==q._float&&b.setFloat64(M,q._float);w+=k,h[++H]&&(W=h[H]._offset)}return Q}},13608:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NoneSerializer=void 0;c.NoneSerializer=class{setState(Y){}getState(){return null}patch(Y){}teardown(){}handshake(Y){}}},13600:(Y,c,h)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.SchemaSerializer=void 0;const C=h(13574);c.SchemaSerializer=class{setState(Y){return this.state.decode(Y)}getState(){return this.state}patch(Y){return this.state.decode(Y)}teardown(){var Y,c;null===(c=null===(Y=this.state)||void 0===Y?void 0:Y.$changes)||void 0===c||c.root.clearRefs()}handshake(Y,c){if(this.state){(new C.Reflection).decode(Y,c)}else this.state=C.Reflection.decode(Y,c)}}},13562:(Y,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getSerializer=c.registerSerializer=void 0;const h={};c.registerSerializer=function(Y,c){h[Y]=c},c.getSerializer=function(Y){const c=h[Y];if(!c)throw new Error("missing serializer: "+Y);return c}},13541:function(Y,c,h){"use strict";var C=this&&this.__importDefault||function(Y){return Y&&Y.__esModule?Y:{default:Y}};Object.defineProperty(c,"__esModule",{value:!0}),c.WebSocketTransport=void 0;const E=C(h(13550)),N=globalThis.WebSocket||E.default;c.WebSocketTransport=class{constructor(Y){this.events=Y}send(Y){Y instanceof ArrayBuffer?this.ws.send(Y):Array.isArray(Y)&&this.ws.send(new Uint8Array(Y).buffer)}connect(Y,c){try{this.ws=new N(Y,{headers:c,protocols:this.protocols})}catch(h){this.ws=new N(Y,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Y,c){this.ws.close(Y,c)}get isOpen(){return this.ws.readyState===N.OPEN}}},13550:Y=>{"use strict";Y.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14937:Y=>{"use strict";Y.exports=function(Y){for(var c=new Array(Y),h=0;h<Y;++h)c[h]=h;return c}},14939:Y=>{function c(Y){return!!Y.constructor&&"function"===typeof Y.constructor.isBuffer&&Y.constructor.isBuffer(Y)}Y.exports=function(Y){return null!=Y&&(c(Y)||function(Y){return"function"===typeof Y.readFloatLE&&"function"===typeof Y.slice&&c(Y.slice(0,0))}(Y)||!!Y._isBuffer)}},14935:(Y,c,h)=>{var C=h(14937),E=h(14939),N="undefined"!==typeof Float64Array;function Q(Y,c){return Y[0]-c[0]}function b(){var Y,c=this.stride,h=new Array(c.length);for(Y=0;Y<h.length;++Y)h[Y]=[Math.abs(c[Y]),Y];h.sort(Q);var C=new Array(h.length);for(Y=0;Y<C.length;++Y)C[Y]=h[Y][1];return C}function H(Y,c){var h=["View",c,"d",Y].join("");c<0&&(h="View_Nil"+Y);var E="generic"===Y;if(-1===c){var N="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+Y+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}";return new Function(N)()}if(0===c){N="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+Y+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}";return new Function("TrivialArray",N)(w[Y][0])}N=["'use strict'"];var Q=C(c),H=Q.map((function(Y){return"i"+Y})),W="this.offset+"+Q.map((function(Y){return"this.stride["+Y+"]*i"+Y})).join("+"),q=Q.map((function(Y){return"b"+Y})).join(","),k=Q.map((function(Y){return"c"+Y})).join(",");N.push("function "+h+"(a,"+q+","+k+",d){this.data=a","this.shape=["+q+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+Y+"'","proto.dimension="+c),N.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+Q.map((function(Y){return"this.shape["+Y+"]"})).join("*"),"}})"),1===c?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),c<4?(N.push("function "+h+"_order(){"),2===c?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+h+"_set("+H.join(",")+",v){"),E?N.push("return this.data.set("+W+",v)}"):N.push("return this.data["+W+"]=v}"),N.push("proto.get=function "+h+"_get("+H.join(",")+"){"),E?N.push("return this.data.get("+W+")}"):N.push("return this.data["+W+"]}"),N.push("proto.index=function "+h+"_index(",H.join(),"){return "+W+"}"),N.push("proto.hi=function "+h+"_hi("+H.join(",")+"){return new "+h+"(this.data,"+Q.map((function(Y){return["(typeof i",Y,"!=='number'||i",Y,"<0)?this.shape[",Y,"]:i",Y,"|0"].join("")})).join(",")+","+Q.map((function(Y){return"this.stride["+Y+"]"})).join(",")+",this.offset)}");var M=Q.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})),p=Q.map((function(Y){return"c"+Y+"=this.stride["+Y+"]"}));N.push("proto.lo=function "+h+"_lo("+H.join(",")+"){var b=this.offset,d=0,"+M.join(",")+","+p.join(","));for(var P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");N.push("return new "+h+"(this.data,"+Q.map((function(Y){return"a"+Y})).join(",")+","+Q.map((function(Y){return"c"+Y})).join(",")+",b)}"),N.push("proto.step=function "+h+"_step("+H.join(",")+"){var "+Q.map((function(Y){return"a"+Y+"=this.shape["+Y+"]"})).join(",")+","+Q.map((function(Y){return"b"+Y+"=this.stride["+Y+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");N.push("return new "+h+"(this.data,"+Q.map((function(Y){return"a"+Y})).join(",")+","+Q.map((function(Y){return"b"+Y})).join(",")+",c)}");var y=new Array(c),d=new Array(c);for(P=0;P<c;++P)y[P]="a[i"+P+"]",d[P]="b[i"+P+"]";N.push("proto.transpose=function "+h+"_transpose("+H+"){"+H.map((function(Y,c){return Y+"=("+Y+"===undefined?"+c+":"+Y+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+y.join(",")+","+d.join(",")+",this.offset)}"),N.push("proto.pick=function "+h+"_pick("+H+"){var a=[],b=[],c=this.offset");for(P=0;P<c;++P)N.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+Q.map((function(Y){return"shape["+Y+"]"})).join(",")+","+Q.map((function(Y){return"stride["+Y+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(w[Y],b)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Y.exports=function(Y,c,h,C){if(void 0===Y)return(0,w.array[0])([]);"number"===typeof Y&&(Y=[Y]),void 0===c&&(c=[Y.length]);var Q=c.length;if(void 0===h){h=new Array(Q);for(var b=Q-1,W=1;b>=0;--b)h[b]=W,W*=c[b]}if(void 0===C){C=0;for(b=0;b<Q;++b)h[b]<0&&(C-=(c[b]-1)*h[b])}for(var q=function(Y){if(E(Y))return"buffer";if(N)switch(Object.prototype.toString.call(Y)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Y)?"array":"generic"}(Y),k=w[q];k.length<=Q+1;)k.push(H(q,k.length-1));return(0,k[Q+1])(Y,c,h,C)}},14907:Y=>{var c;self,c=()=>(()=>{"use strict";var Y={d:(c,h)=>{for(var C in h)Y.o(h,C)&&!Y.o(c,C)&&Object.defineProperty(c,C,{enumerable:!0,get:h[C]})},o:(Y,c)=>Object.prototype.hasOwnProperty.call(Y,c)},c={};Y.d(c,{default:()=>U});var h,C=function(Y,c){var h=c.x-Y.x,C=c.y-Y.y;return Math.sqrt(h*h+C*C)},E=function(Y){return Y*(Math.PI/180)},N=new Map,Q=function(Y){N.has(Y)&&clearTimeout(N.get(Y)),N.set(Y,setTimeout(Y,100))},b=function(Y,c,h){for(var C,E=c.split(/[ ,]+/g),N=0;N<E.length;N+=1)C=E[N],Y.addEventListener?Y.addEventListener(C,h,!1):Y.attachEvent&&Y.attachEvent(C,h)},H=function(Y,c,h){for(var C,E=c.split(/[ ,]+/g),N=0;N<E.length;N+=1)C=E[N],Y.removeEventListener?Y.removeEventListener(C,h):Y.detachEvent&&Y.detachEvent(C,h)},w=function(Y){return Y.preventDefault(),Y.type.match(/^touch/)?Y.changedTouches:Y},W=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},q=function(Y,c){c.top||c.right||c.bottom||c.left?(Y.style.top=c.top,Y.style.right=c.right,Y.style.bottom=c.bottom,Y.style.left=c.left):(Y.style.left=c.x+"px",Y.style.top=c.y+"px")},k=function(Y,c,h){var C=M(Y);for(var E in C)if(C.hasOwnProperty(E))if("string"==typeof c)C[E]=c+" "+h;else{for(var N="",Q=0,b=c.length;Q<b;Q+=1)N+=c[Q]+" "+h+", ";C[E]=N.slice(0,-2)}return C},M=function(Y){var c={};return c[Y]="",["webkit","Moz","o"].forEach((function(h){c[h+Y.charAt(0).toUpperCase()+Y.slice(1)]=""})),c},p=function(Y,c){for(var h in c)c.hasOwnProperty(h)&&(Y[h]=c[h]);return Y},P=function(Y,c){if(Y.length)for(var h=0,C=Y.length;h<C;h+=1)c(Y[h]);else c(Y)},y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,d=window.matchMedia("(any-hover: none)").matches,D=!!("ontouchstart"in window),T=!!window.PointerEvent,e=!!window.MSPointerEvent,r={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},Z={};function a(){}y&&!d?h=r:T?h={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:e?h={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:D?(h=r,Z=X):h=X,a.prototype.on=function(Y,c){var h,C=this,E=Y.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var N=0;N<E.length;N+=1)h=E[N],C._handlers_[h]=C._handlers_[h]||[],C._handlers_[h].push(c);return C},a.prototype.off=function(Y,c){var h=this;return h._handlers_=h._handlers_||{},void 0===Y?h._handlers_={}:void 0===c?h._handlers_[Y]=null:h._handlers_[Y]&&h._handlers_[Y].indexOf(c)>=0&&h._handlers_[Y].splice(h._handlers_[Y].indexOf(c),1),h},a.prototype.trigger=function(Y,c){var h,C=this,E=Y.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var N=0;N<E.length;N+=1)h=E[N],C._handlers_[h]&&C._handlers_[h].length&&C._handlers_[h].forEach((function(Y){Y.call(C,{type:h,target:C},c)}))},a.prototype.config=function(Y){var c=this;c.options=c.defaults||{},Y&&(c.options=function(Y,c){var h={};for(var C in Y)Y.hasOwnProperty(C)&&c.hasOwnProperty(C)?h[C]=c[C]:Y.hasOwnProperty(C)&&(h[C]=Y[C]);return h}(c.options,Y))},a.prototype.bindEvt=function(Y,c){var C=this;return C._domHandlers_=C._domHandlers_||{},C._domHandlers_[c]=function(){"function"==typeof C["on"+c]?C["on"+c].apply(C,arguments):console.warn('[WARNING] : Missing "on'+c+'" handler.')},b(Y,h[c],C._domHandlers_[c]),Z[c]&&b(Y,Z[c],C._domHandlers_[c]),C},a.prototype.unbindEvt=function(Y,c){var C=this;return C._domHandlers_=C._domHandlers_||{},H(Y,h[c],C._domHandlers_[c]),Z[c]&&H(Y,Z[c],C._domHandlers_[c]),delete C._domHandlers_[c],this};const G=a;function K(Y,c){return this.identifier=c.identifier,this.position=c.position,this.frontPosition=c.frontPosition,this.collection=Y,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(c),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=K.id,K.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}K.prototype=new G,K.constructor=K,K.id=0,K.prototype.buildEl=function(Y){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},K.prototype.stylize=function(){if(this.options.dataOnly)return this;var Y=this.options.fadeTime+"ms",c=function(){var Y=M("borderRadius");for(var c in Y)Y.hasOwnProperty(c)&&(Y[c]="50%");return Y}(),h=k("transition","opacity",Y),C={};return C.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},C.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},C.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},p(C.el,h),"circle"===this.options.shape&&p(C.back,c),p(C.front,c),this.applyStyles(C),this},K.prototype.applyStyles=function(Y){for(var c in this.ui)if(this.ui.hasOwnProperty(c))for(var h in Y[c])this.ui[c].style[h]=Y[c][h];return this},K.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},K.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},K.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},K.prototype.show=function(Y){var c=this;return c.options.dataOnly||(clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.addToDom(),c.restCallback(),setTimeout((function(){c.ui.el.style.opacity=1}),0),c.showTimeout=setTimeout((function(){c.trigger("shown",c.instance),"function"==typeof Y&&Y.call(this)}),c.options.fadeTime)),c},K.prototype.hide=function(Y){var c=this;if(c.options.dataOnly)return c;if(c.ui.el.style.opacity=c.options.restOpacity,clearTimeout(c.removeTimeout),clearTimeout(c.showTimeout),clearTimeout(c.restTimeout),c.removeTimeout=setTimeout((function(){var h="dynamic"===c.options.mode?"none":"block";c.ui.el.style.display=h,"function"==typeof Y&&Y.call(c),c.trigger("hidden",c.instance)}),c.options.fadeTime),c.options.restJoystick){var h=c.options.restJoystick,C={};C.x=!0===h||!1!==h.x?0:c.instance.frontPosition.x,C.y=!0===h||!1!==h.y?0:c.instance.frontPosition.y,c.setPosition(Y,C)}return c},K.prototype.setPosition=function(Y,c){var h=this;h.frontPosition={x:c.x,y:c.y};var C=h.options.fadeTime+"ms",E={};E.front=k("transition",["transform"],C);var N={front:{}};N.front={transform:"translate("+h.frontPosition.x+"px,"+h.frontPosition.y+"px)"},h.applyStyles(E),h.applyStyles(N),h.restTimeout=setTimeout((function(){"function"==typeof Y&&Y.call(h),h.restCallback()}),h.options.fadeTime)},K.prototype.restCallback=function(){var Y=this,c={};c.front=k("transition","none",""),Y.applyStyles(c),Y.trigger("rested",Y.instance)},K.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},K.prototype.computeDirection=function(Y){var c,h,C,E=Y.angle.radian,N=Math.PI/4,Q=Math.PI/2;if(E>N&&E<3*N&&!Y.lockX?c="up":E>-N&&E<=N&&!Y.lockY?c="left":E>3*-N&&E<=-N&&!Y.lockX?c="down":Y.lockY||(c="right"),Y.lockY||(h=E>-Q&&E<Q?"left":"right"),Y.lockX||(C=E>0?"up":"down"),Y.force>this.options.threshold){var b,H={};for(b in this.direction)this.direction.hasOwnProperty(b)&&(H[b]=this.direction[b]);var w={};for(b in this.direction={x:h,y:C,angle:c},Y.direction=this.direction,H)H[b]===this.direction[b]&&(w[b]=!0);if(w.x&&w.y&&w.angle)return Y;w.x&&w.y||this.trigger("plain",Y),w.x||this.trigger("plain:"+h,Y),w.y||this.trigger("plain:"+C,Y),w.angle||this.trigger("dir dir:"+c,Y)}else this.resetDirection();return Y};const I=K;function s(Y,c){var h=this;h.nipples=[],h.idles=[],h.actives=[],h.ids=[],h.pressureIntervals={},h.manager=Y,h.id=s.id,s.id+=1,h.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},h.config(c),"static"!==h.options.mode&&"semi"!==h.options.mode||(h.options.multitouch=!1),h.options.multitouch||(h.options.maxNumberOfNipples=1);var C=getComputedStyle(h.options.zone.parentElement);return C&&"flex"===C.display&&(h.parentIsFlex=!0),h.updateBox(),h.prepareNipples(),h.BM(),h.begin(),h.nipples}s.prototype=new G,s.constructor=s,s.id=0,s.prototype.prepareNipples=function(){var Y=this,c=Y.nipples;c.on=Y.on.bind(Y),c.off=Y.off.bind(Y),c.options=Y.options,c.destroy=Y.destroy.bind(Y),c.ids=Y.ids,c.id=Y.id,c.processOnMove=Y.processOnMove.bind(Y),c.processOnEnd=Y.processOnEnd.bind(Y),c.get=function(Y){if(void 0===Y)return c[0];for(var h=0,C=c.length;h<C;h+=1)if(c[h].identifier===Y)return c[h];return!1}},s.prototype.BM=function(){var Y=this;Y.bindEvt(Y.options.zone,"start"),Y.options.zone.style.touchAction="none",Y.options.zone.style.msTouchAction="none"},s.prototype.begin=function(){var Y=this,c=Y.options;if("static"===c.mode){var h=Y.createNipple(c.position,Y.manager.getIdentifier());h.add(),Y.idles.push(h)}},s.prototype.createNipple=function(Y,c){var h=this,C=h.manager.scroll,E={},N=h.options,Q=h.parentIsFlex?C.x:C.x+h.box.left,b=h.parentIsFlex?C.y:C.y+h.box.top;if(Y.x&&Y.y)E={x:Y.x-Q,y:Y.y-b};else if(Y.top||Y.right||Y.bottom||Y.left){var H=document.createElement("DIV");H.style.display="hidden",H.style.top=Y.top,H.style.right=Y.right,H.style.bottom=Y.bottom,H.style.left=Y.left,H.style.position="absolute",N.zone.appendChild(H);var w=H.getBoundingClientRect();N.zone.removeChild(H),E=Y,Y={x:w.left+C.x,y:w.top+C.y}}var W=new I(h,{color:N.color,size:N.size,threshold:N.threshold,fadeTime:N.fadeTime,dataOnly:N.dataOnly,restJoystick:N.restJoystick,restOpacity:N.restOpacity,mode:N.mode,identifier:c,position:Y,zone:N.zone,frontPosition:{x:0,y:0},shape:N.shape});return N.dataOnly||(q(W.ui.el,E),q(W.ui.front,W.frontPosition)),h.nipples.push(W),h.trigger("added "+W.identifier+":added",W),h.manager.trigger("added "+W.identifier+":added",W),h.bindNipple(W),W},s.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},s.prototype.bindNipple=function(Y){var c,h=this,C=function(Y,C){c=Y.type+" "+C.id+":"+Y.type,h.trigger(c,C)};Y.on("destroyed",h.onDestroyed.bind(h)),Y.on("shown hidden rested dir plain",C),Y.on("dir:up dir:right dir:down dir:left",C),Y.on("plain:up plain:right plain:down plain:left",C)},s.prototype.pressureFn=function(Y,c,h){var C=this,E=0;clearInterval(C.pressureIntervals[h]),C.pressureIntervals[h]=setInterval(function(){var h=Y.force||Y.pressure||Y.webkitForce||0;h!==E&&(c.trigger("pressure",h),C.trigger("pressure "+c.identifier+":pressure",h),E=h)}.bind(C),100)},s.prototype.onstart=function(Y){var c=this,h=c.options,C=Y;return Y=w(Y),c.updateBox(),P(Y,(function(E){c.actives.length<h.maxNumberOfNipples?c.processOnStart(E):C.type.match(/^touch/)&&(Object.keys(c.manager.ids).forEach((function(h){if(Object.values(C.touches).findIndex((function(Y){return Y.identifier===h}))<0){var E=[Y[0]];E.identifier=h,c.processOnEnd(E)}})),c.actives.length<h.maxNumberOfNipples&&c.processOnStart(E))})),c.manager.bindDocument(),!1},s.prototype.processOnStart=function(Y){var c,h=this,E=h.options,N=h.manager.getIdentifier(Y),Q=Y.force||Y.pressure||Y.webkitForce||0,b={x:Y.pageX,y:Y.pageY},H=h.getOrCreate(N,b);H.identifier!==N&&h.manager.removeIdentifier(H.identifier),H.identifier=N;var w=function(c){c.trigger("start",c),h.trigger("start "+c.id+":start",c),c.show(),Q>0&&h.pressureFn(Y,c,c.identifier),h.processOnMove(Y)};if((c=h.idles.indexOf(H))>=0&&h.idles.splice(c,1),h.actives.push(H),h.ids.push(H.identifier),"semi"!==E.mode)w(H);else{if(!(C(b,H.position)<=E.catchDistance))return H.destroy(),void h.processOnStart(Y);w(H)}return H},s.prototype.getOrCreate=function(Y,c){var h,C=this,E=C.options;return/(semi|static)/.test(E.mode)?(h=C.idles[0])?(C.idles.splice(0,1),h):"semi"===E.mode?C.createNipple(c,Y):(console.warn("Coudln't find the needed nipple."),!1):h=C.createNipple(c,Y)},s.prototype.processOnMove=function(Y){var c=this,h=c.options,N=c.manager.getIdentifier(Y),Q=c.nipples.get(N),b=c.manager.scroll;if(function(Y){return isNaN(Y.buttons)?0!==Y.pressure:0!==Y.buttons}(Y)){if(!Q)return console.error("Found zombie joystick with ID "+N),void c.manager.removeIdentifier(N);if(h.dynamicPage){var H=Q.el.getBoundingClientRect();Q.position={x:b.x+H.left,y:b.y+H.top}}Q.identifier=N;var w=Q.options.size/2,W={x:Y.pageX,y:Y.pageY};h.lockX&&(W.y=Q.position.y),h.lockY&&(W.x=Q.position.x);var q,k,M,p,P,y,d,D,T,e,r=C(W,Q.position),X=(q=W,M=(k=Q.position).x-q.x,p=k.y-q.y,function(Y){return Y*(180/Math.PI)}(Math.atan2(p,M))),Z=E(X),a=r/w,G={distance:r,position:W};if("circle"===Q.options.shape?(P=Math.min(r,w),d=Q.position,D=P,e={x:0,y:0},T=E(T=X),e.x=d.x-D*Math.cos(T),e.y=d.y-D*Math.sin(T),y=e):(y=function(Y,c,h){return{x:Math.min(Math.max(Y.x,c.x-h),c.x+h),y:Math.min(Math.max(Y.y,c.y-h),c.y+h)}}(W,Q.position,w),P=C(y,Q.position)),h.follow){if(r>w){var K=W.x-y.x,I=W.y-y.y;Q.position.x+=K,Q.position.y+=I,Q.el.style.top=Q.position.y-(c.box.top+b.y)+"px",Q.el.style.left=Q.position.x-(c.box.left+b.x)+"px",r=C(W,Q.position)}}else W=y,r=P;var s=W.x-Q.position.x,x=W.y-Q.position.y;Q.frontPosition={x:s,y:x},h.dataOnly||(Q.ui.front.style.transform="translate("+s+"px,"+x+"px)");var A={identifier:Q.identifier,position:W,force:a,pressure:Y.force||Y.pressure||Y.webkitForce||0,distance:r,angle:{radian:Z,degree:X},vector:{x:s/w,y:-x/w},raw:G,instance:Q,lockX:h.lockX,lockY:h.lockY};(A=Q.computeDirection(A)).angle={radian:E(180-X),degree:180-X},Q.trigger("move",A),c.trigger("move "+Q.id+":move",A)}else this.processOnEnd(Y)},s.prototype.processOnEnd=function(Y){var c=this,h=c.options,C=c.manager.getIdentifier(Y),E=c.nipples.get(C),N=c.manager.removeIdentifier(E.identifier);E&&(h.dataOnly||E.hide((function(){"dynamic"===h.mode&&(E.trigger("removed",E),c.trigger("removed "+E.id+":removed",E),c.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(c.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),c.trigger("end "+E.id+":end",E),c.ids.indexOf(E.identifier)>=0&&c.ids.splice(c.ids.indexOf(E.identifier),1),c.actives.indexOf(E)>=0&&c.actives.splice(c.actives.indexOf(E),1),/(semi|static)/.test(h.mode)?c.idles.push(E):c.nipples.indexOf(E)>=0&&c.nipples.splice(c.nipples.indexOf(E),1),c.manager.unbindDocument(),/(semi|static)/.test(h.mode)&&(c.manager.ids[N.id]=N.identifier))},s.prototype.onDestroyed=function(Y,c){var h=this;h.nipples.indexOf(c)>=0&&h.nipples.splice(h.nipples.indexOf(c),1),h.actives.indexOf(c)>=0&&h.actives.splice(h.actives.indexOf(c),1),h.idles.indexOf(c)>=0&&h.idles.splice(h.idles.indexOf(c),1),h.ids.indexOf(c.identifier)>=0&&h.ids.splice(h.ids.indexOf(c.identifier),1),h.manager.removeIdentifier(c.identifier),h.manager.unbindDocument()},s.prototype.destroy=function(){var Y=this;for(var c in Y.unbindEvt(Y.options.zone,"start"),Y.nipples.forEach((function(Y){Y.destroy()})),Y.pressureIntervals)Y.pressureIntervals.hasOwnProperty(c)&&clearInterval(Y.pressureIntervals[c]);Y.trigger("destroyed",Y.nipples),Y.manager.unbindDocument(),Y.off()};const x=s;function A(Y){var c=this;c.ids={},c.index=0,c.collections=[],c.scroll=W(),c.config(Y),c.prepareCollections();var h=function(){var Y;c.collections.forEach((function(h){h.forEach((function(h){Y=h.el.getBoundingClientRect(),h.position={x:c.scroll.x+Y.left,y:c.scroll.y+Y.top}}))}))};b(window,"resize",(function(){Q(h)}));var C=function(){c.scroll=W()};return b(window,"scroll",(function(){Q(C)})),c.collections}A.prototype=new G,A.constructor=A,A.prototype.prepareCollections=function(){var Y=this;Y.collections.create=Y.create.bind(Y),Y.collections.on=Y.on.bind(Y),Y.collections.off=Y.off.bind(Y),Y.collections.destroy=Y.destroy.bind(Y),Y.collections.get=function(c){var h;return Y.collections.every((function(Y){return!(h=Y.get(c))})),h}},A.prototype.create=function(Y){return this.createCollection(Y)},A.prototype.createCollection=function(Y){var c=this,h=new x(c,Y);return c.bindCollection(h),c.collections.push(h),h},A.prototype.bindCollection=function(Y){var c,h=this,C=function(Y,C){c=Y.type+" "+C.id+":"+Y.type,h.trigger(c,C)};Y.on("destroyed",h.onDestroyed.bind(h)),Y.on("shown hidden rested dir plain",C),Y.on("dir:up dir:right dir:down dir:left",C),Y.on("plain:up plain:right plain:down plain:left",C)},A.prototype.bindDocument=function(){var Y=this;Y.binded||(Y.bindEvt(document,"move").bindEvt(document,"end"),Y.binded=!0)},A.prototype.unbindDocument=function(Y){var c=this;Object.keys(c.ids).length&&!0!==Y||(c.unbindEvt(document,"move").unbindEvt(document,"end"),c.binded=!1)},A.prototype.getIdentifier=function(Y){var c;return Y?void 0===(c=void 0===Y.identifier?Y.pointerId:Y.identifier)&&(c=this.latest||0):c=this.index,void 0===this.ids[c]&&(this.ids[c]=this.index,this.index+=1),this.latest=c,this.ids[c]},A.prototype.removeIdentifier=function(Y){var c={};for(var h in this.ids)if(this.ids[h]===Y){c.id=h,c.identifier=this.ids[h],delete this.ids[h];break}return c},A.prototype.onmove=function(Y){return this.onAny("move",Y),!1},A.prototype.onend=function(Y){return this.onAny("end",Y),!1},A.prototype.oncancel=function(Y){return this.onAny("end",Y),!1},A.prototype.onAny=function(Y,c){var h,C=this,E="processOn"+Y.charAt(0).toUpperCase()+Y.slice(1);c=w(c);var N=function(Y,c,h){h.ids.indexOf(c)>=0&&(h[E](Y),Y._found_=!0)};return P(c,(function(Y){h=C.getIdentifier(Y),P(C.collections,N.bind(null,Y,h)),Y._found_||C.removeIdentifier(h)})),!1},A.prototype.destroy=function(){var Y=this;Y.unbindDocument(!0),Y.ids={},Y.index=0,Y.collections.forEach((function(Y){Y.destroy()})),Y.off()},A.prototype.onDestroyed=function(Y,c){var h=this;if(h.collections.indexOf(c)<0)return!1;h.collections.splice(h.collections.indexOf(c),1)};var V=new A;const U={create:function(Y){return V.create(Y)},factory:V};return c.default})(),Y.exports=c()},14954:(Y,c,h)=>{"use strict";const{Deflate:C,deflate:E,deflateRaw:N,gzip:Q}=h(14963),{Inflate:b,inflate:H,inflateRaw:w,ungzip:W}=h(15016),q=h(14997);Y.exports.Deflate=C,Y.exports.deflate=E,Y.exports.deflateRaw=N,Y.exports.gzip=Q,Y.exports.Inflate=b,Y.exports.inflate=H,Y.exports.inflateRaw=w,Y.exports.ungzip=W,Y.exports.constants=q},14963:(Y,c,h)=>{"use strict";const C=h(14965),E=h(15e3),N=h(15003),Q=h(14992),b=h(15007),H=Object.prototype.toString,{Z_NO_FLUSH:w,Z_SYNC_FLUSH:W,Z_FULL_FLUSH:q,Z_FINISH:k,Z_OK:M,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:P,Z_DEFAULT_STRATEGY:y,Z_DEFLATED:d}=h(14997);function D(Y){this.options=E.assign({level:P,method:d,zY:16384,windowBits:15,memLevel:8,strategy:y},Y||{});let c=this.options;c.raw&&c.windowBits>0?c.windowBits=-c.windowBits:c.gzip&&c.windowBits>0&&c.windowBits<16&&(c.windowBits+=16),this.err=0,this.mh="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let h=C.deflateInit2(this.strm,c.level,c.method,c.windowBits,c.memLevel,c.strategy);if(h!==M)throw new Error(Q[h]);if(c.header&&C.deflateSetHeader(this.strm,c.header),c.dictionary){let Y;if(Y="string"===typeof c.dictionary?N.string2buf(c.dictionary):"[object ArrayBuffer]"===H.call(c.dictionary)?new Uint8Array(c.dictionary):c.dictionary,h=C.deflateSetDictionary(this.strm,Y),h!==M)throw new Error(Q[h]);this._dict_set=!0}}function T(Y,c){const h=new D(c);if(h.push(Y,!0),h.err)throw h.mh||Q[h.err];return h.result}D.prototype.push=function(Y,c){const h=this.strm,E=this.options.zY;let Q,b;if(this.ended)return!1;for(b=c===~~c?c:!0===c?k:w,"string"===typeof Y?h.input=N.string2buf(Y):"[object ArrayBuffer]"===H.call(Y)?h.input=new Uint8Array(Y):h.input=Y,h.next_in=0,h.avail_in=h.input.length;;)if(0===h.avail_out&&(h.output=new Uint8Array(E),h.next_out=0,h.avail_out=E),(b===W||b===q)&&h.avail_out<=6)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else{if(Q=C.deflate(h,b),Q===p)return h.next_out>0&&this.onData(h.output.subarray(0,h.next_out)),Q=C.deflateEnd(this.strm),this.onEnd(Q),this.ended=!0,Q===M;if(0!==h.avail_out){if(b>0&&h.next_out>0)this.onData(h.output.subarray(0,h.next_out)),h.avail_out=0;else if(0===h.avail_in)break}else this.onData(h.output)}return!0},D.prototype.onData=function(Y){this.chunks.push(Y)},D.prototype.onEnd=function(Y){Y===M&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=Y,this.mh=this.strm.mh},Y.exports.Deflate=D,Y.exports.deflate=T,Y.exports.deflateRaw=function(Y,c){return(c=c||{}).raw=!0,T(Y,c)},Y.exports.gzip=function(Y,c){return(c=c||{}).gzip=!0,T(Y,c)},Y.exports.constants=h(14997)},15016:(Y,c,h)=>{"use strict";const C=h(15022),E=h(15e3),N=h(15003),Q=h(14992),b=h(15007),H=h(15043),w=Object.prototype.toString,{Z_NO_FLUSH:W,Z_FINISH:q,Z_OK:k,Z_STREAM_END:M,Z_NEED_DICT:p,Z_STREAM_ERROR:P,Z_DATA_ERROR:y,Z_MEM_ERROR:d}=h(14997);function D(Y){this.options=E.assign({zY:65536,windowBits:15,to:""},Y||{});const c=this.options;c.raw&&c.windowBits>=0&&c.windowBits<16&&(c.windowBits=-c.windowBits,0===c.windowBits&&(c.windowBits=-15)),!(c.windowBits>=0&&c.windowBits<16)||Y&&Y.windowBits||(c.windowBits+=32),c.windowBits>15&&c.windowBits<48&&0===(15&c.windowBits)&&(c.windowBits|=15),this.err=0,this.mh="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;let h=C.inflateInit2(this.strm,c.windowBits);if(h!==k)throw new Error(Q[h]);if(this.header=new H,C.inflateGetHeader(this.strm,this.header),c.dictionary&&("string"===typeof c.dictionary?c.dictionary=N.string2buf(c.dictionary):"[object ArrayBuffer]"===w.call(c.dictionary)&&(c.dictionary=new Uint8Array(c.dictionary)),c.raw&&(h=C.inflateSetDictionary(this.strm,c.dictionary),h!==k)))throw new Error(Q[h])}function T(Y,c){const h=new D(c);if(h.push(Y),h.err)throw h.mh||Q[h.err];return h.result}D.prototype.push=function(Y,c){const h=this.strm,E=this.options.zY,Q=this.options.dictionary;let b,H,D;if(this.ended)return!1;for(H=c===~~c?c:!0===c?q:W,"[object ArrayBuffer]"===w.call(Y)?h.input=new Uint8Array(Y):h.input=Y,h.next_in=0,h.avail_in=h.input.length;;){for(0===h.avail_out&&(h.output=new Uint8Array(E),h.next_out=0,h.avail_out=E),b=C.inflate(h,H),b===p&&Q&&(b=C.inflateSetDictionary(h,Q),b===k?b=C.inflate(h,H):b===y&&(b=p));h.avail_in>0&&b===M&&h.state.wrap>0&&0!==Y[h.next_in];)C.inflateReset(h),b=C.inflate(h,H);switch(b){case P:case y:case p:case d:return this.onEnd(b),this.ended=!0,!1}if(D=h.avail_out,h.next_out&&(0===h.avail_out||b===M))if("string"===this.options.to){let Y=N.utf8border(h.output,h.next_out),c=h.next_out-Y,C=N.buf2string(h.output,Y);h.next_out=c,h.avail_out=E-c,c&&h.output.set(h.output.subarray(Y,Y+c),0),this.onData(C)}else this.onData(h.output.length===h.next_out?h.output:h.output.subarray(0,h.next_out));if(b!==k||0!==D){if(b===M)return b=C.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,!0;if(0===h.avail_in)break}}return!0},D.prototype.onData=function(Y){this.chunks.push(Y)},D.prototype.onEnd=function(Y){Y===k&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=Y,this.mh=this.strm.mh},Y.exports.Inflate=D,Y.exports.inflate=T,Y.exports.inflateRaw=function(Y,c){return(c=c||{}).raw=!0,T(Y,c)},Y.exports.ungzip=T,Y.exports.constants=h(14997)},15e3:Y=>{"use strict";const c=(Y,c)=>Object.prototype.hasOwnProperty.call(Y,c);Y.exports.assign=function(Y){const h=Array.prototype.slice.call(arguments,1);for(;h.length;){const C=h.shift();if(C){if("object"!==typeof C)throw new TypeError(C+"must be non-object");for(const h in C)c(C,h)&&(Y[h]=C[h])}}return Y},Y.exports.flattenChunks=Y=>{let c=0;for(let C=0,E=Y.length;C<E;C++)c+=Y[C].length;const h=new Uint8Array(c);for(let C=0,E=0,N=Y.length;C<N;C++){let c=Y[C];h.set(c,E),E+=c.length}return h}},15003:Y=>{"use strict";let c=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(C){c=!1}const h=new Uint8Array(256);for(let E=0;E<256;E++)h[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;h[254]=h[254]=1,Y.exports.string2buf=Y=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Y);let c,h,C,E,N,Q=Y.length,b=0;for(E=0;E<Q;E++)h=Y.charCodeAt(E),55296===(64512&h)&&E+1<Q&&(C=Y.charCodeAt(E+1),56320===(64512&C)&&(h=65536+(h-55296<<10)+(C-56320),E++)),b+=h<128?1:h<2048?2:h<65536?3:4;for(c=new Uint8Array(b),N=0,E=0;N<b;E++)h=Y.charCodeAt(E),55296===(64512&h)&&E+1<Q&&(C=Y.charCodeAt(E+1),56320===(64512&C)&&(h=65536+(h-55296<<10)+(C-56320),E++)),h<128?c[N++]=h:h<2048?(c[N++]=192|h>>>6,c[N++]=128|63&h):h<65536?(c[N++]=224|h>>>12,c[N++]=128|h>>>6&63,c[N++]=128|63&h):(c[N++]=240|h>>>18,c[N++]=128|h>>>12&63,c[N++]=128|h>>>6&63,c[N++]=128|63&h);return c};Y.exports.buf2string=(Y,C)=>{const E=C||Y.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Y.subarray(0,C));let N,Q;const b=new Array(2*E);for(Q=0,N=0;N<E;){let c=Y[N++];if(c<128){b[Q++]=c;continue}let C=h[c];if(C>4)b[Q++]=65533,N+=C-1;else{for(c&=2===C?31:3===C?15:7;C>1&&N<E;)c=c<<6|63&Y[N++],C--;C>1?b[Q++]=65533:c<65536?b[Q++]=c:(c-=65536,b[Q++]=55296|c>>10&1023,b[Q++]=56320|1023&c)}}return((Y,h)=>{if(h<65534&&Y.subarray&&c)return String.fromCharCode.apply(null,Y.length===h?Y:Y.subarray(0,h));let C="";for(let c=0;c<h;c++)C+=String.fromCharCode(Y[c]);return C})(b,Q)},Y.exports.utf8border=(Y,c)=>{(c=c||Y.length)>Y.length&&(c=Y.length);let C=c-1;for(;C>=0&&128===(192&Y[C]);)C--;return C<0||0===C?c:C+h[Y[C]]>c?C:c}},14980:Y=>{"use strict";Y.exports=(Y,c,h,C)=>{let E=65535&Y,N=Y>>>16&65535,Q=0;for(;0!==h;){Q=h>2e3?2e3:h,h-=Q;do{E=E+c[C++]|0,N=N+E|0}while(--Q);E%=65521,N%=65521}return E|N<<16}},14997:Y=>{"use strict";Y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14988:Y=>{"use strict";const c=new Uint32Array((()=>{let Y,c=[];for(var h=0;h<256;h++){Y=h;for(var C=0;C<8;C++)Y=1&Y?3988292384^Y>>>1:Y>>>1;c[h]=Y}return c})());Y.exports=(Y,h,C,E)=>{const N=c,Q=E+C;Y^=-1;for(let c=E;c<Q;c++)Y=Y>>>8^N[255&(Y^h[c])];return~Y}},14965:(Y,c,h)=>{"use strict";const{_tr_init:C,_tr_stored_block:E,_tr_flush_block:N,_tr_tally:Q,_tr_align:b}=h(14973),H=h(14980),w=h(14988),W=h(14992),{Z_NO_FLUSH:q,Z_PARTIAL_FLUSH:k,Z_FULL_FLUSH:M,Z_FINISH:p,Z_BLOCK:P,Z_OK:y,Z_STREAM_END:d,Z_STREAM_ERROR:D,Z_DATA_ERROR:T,Z_BUF_ERROR:e,Z_DEFAULT_COMPRESSION:r,Z_FILTERED:X,Z_HUFFMAN_ONLY:Z,Z_RLE:a,Z_FIXED:G,Z_DEFAULT_STRATEGY:K,Z_UNKNOWN:I,Z_DEFLATED:s}=h(14997),x=258,A=262,V=103,U=113,l=666,n=(Y,c)=>(Y.mh=W[c],c),v=Y=>(Y<<1)-(Y>4?9:0),g=Y=>{let c=Y.length;for(;--c>=0;)Y[c]=0};let z=(Y,c,h)=>(c<<Y.hash_shift^h)&Y.hash_mask;const O=Y=>{const c=Y.state;let h=c.pending;h>Y.avail_out&&(h=Y.avail_out),0!==h&&(Y.output.set(c.pending_buf.subarray(c.pending_out,c.pending_out+h),Y.next_out),Y.next_out+=h,c.pending_out+=h,Y.total_out+=h,Y.avail_out-=h,c.pending-=h,0===c.pending&&(c.pending_out=0))},o=(Y,c)=>{N(Y,Y.block_start>=0?Y.block_start:-1,Y.strstart-Y.block_start,c),Y.block_start=Y.strstart,O(Y.strm)},f=(Y,c)=>{Y.pending_buf[Y.pending++]=c},L=(Y,c)=>{Y.pending_buf[Y.pending++]=c>>>8&255,Y.pending_buf[Y.pending++]=255&c},u=(Y,c,h,C)=>{let E=Y.avail_in;return E>C&&(E=C),0===E?0:(Y.avail_in-=E,c.set(Y.input.subarray(Y.next_in,Y.next_in+E),h),1===Y.state.wrap?Y.adler=H(Y.adler,c,E,h):2===Y.state.wrap&&(Y.adler=w(Y.adler,c,E,h)),Y.next_in+=E,Y.total_in+=E,E)},i=(Y,c)=>{let h,C,E=Y.max_chain_length,N=Y.strstart,Q=Y.prev_length,b=Y.nice_match;const H=Y.strstart>Y.w_size-A?Y.strstart-(Y.w_size-A):0,w=Y.window,W=Y.w_mask,q=Y.prev,k=Y.strstart+x;let M=w[N+Q-1],p=w[N+Q];Y.prev_length>=Y.good_match&&(E>>=2),b>Y.lookahead&&(b=Y.lookahead);do{if(h=c,w[h+Q]===p&&w[h+Q-1]===M&&w[h]===w[N]&&w[++h]===w[N+1]){N+=2,h++;do{}while(w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&w[++N]===w[++h]&&N<k);if(C=x-(k-N),N=k-x,C>Q){if(Y.match_start=c,Q=C,C>=b)break;M=w[N+Q-1],p=w[N+Q]}}}while((c=q[c&W])>H&&0!==--E);return Q<=Y.lookahead?Q:Y.lookahead},R=Y=>{const c=Y.w_size;let h,C,E,N,Q;do{if(N=Y.window_size-Y.lookahead-Y.strstart,Y.strstart>=c+(c-A)){Y.window.set(Y.window.subarray(c,c+c),0),Y.match_start-=c,Y.strstart-=c,Y.block_start-=c,C=Y.hash_size,h=C;do{E=Y.head[--h],Y.head[h]=E>=c?E-c:0}while(--C);C=c,h=C;do{E=Y.prev[--h],Y.prev[h]=E>=c?E-c:0}while(--C);N+=c}if(0===Y.strm.avail_in)break;if(C=u(Y.strm,Y.window,Y.strstart+Y.lookahead,N),Y.lookahead+=C,Y.lookahead+Y.insert>=3)for(Q=Y.strstart-Y.insert,Y.ins_h=Y.window[Q],Y.ins_h=z(Y,Y.ins_h,Y.window[Q+1]);Y.insert&&(Y.ins_h=z(Y,Y.ins_h,Y.window[Q+3-1]),Y.prev[Q&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Q,Q++,Y.insert--,!(Y.lookahead+Y.insert<3)););}while(Y.lookahead<A&&0!==Y.strm.avail_in)},B=(Y,c)=>{let h,C;for(;;){if(Y.lookahead<A){if(R(Y),Y.lookahead<A&&c===q)return 1;if(0===Y.lookahead)break}if(h=0,Y.lookahead>=3&&(Y.ins_h=z(Y,Y.ins_h,Y.window[Y.strstart+3-1]),h=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),0!==h&&Y.strstart-h<=Y.w_size-A&&(Y.match_length=i(Y,h)),Y.match_length>=3)if(C=Q(Y,Y.strstart-Y.match_start,Y.match_length-3),Y.lookahead-=Y.match_length,Y.match_length<=Y.max_lazy_match&&Y.lookahead>=3){Y.match_length--;do{Y.strstart++,Y.ins_h=z(Y,Y.ins_h,Y.window[Y.strstart+3-1]),h=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart}while(0!==--Y.match_length);Y.strstart++}else Y.strstart+=Y.match_length,Y.match_length=0,Y.ins_h=Y.window[Y.strstart],Y.ins_h=z(Y,Y.ins_h,Y.window[Y.strstart+1]);else C=Q(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++;if(C&&(o(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=Y.strstart<2?Y.strstart:2,c===p?(o(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(o(Y,!1),0===Y.strm.avail_out)?1:2},t=(Y,c)=>{let h,C,E;for(;;){if(Y.lookahead<A){if(R(Y),Y.lookahead<A&&c===q)return 1;if(0===Y.lookahead)break}if(h=0,Y.lookahead>=3&&(Y.ins_h=z(Y,Y.ins_h,Y.window[Y.strstart+3-1]),h=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart),Y.prev_length=Y.match_length,Y.prev_match=Y.match_start,Y.match_length=2,0!==h&&Y.prev_length<Y.max_lazy_match&&Y.strstart-h<=Y.w_size-A&&(Y.match_length=i(Y,h),Y.match_length<=5&&(Y.strategy===X||3===Y.match_length&&Y.strstart-Y.match_start>4096)&&(Y.match_length=2)),Y.prev_length>=3&&Y.match_length<=Y.prev_length){E=Y.strstart+Y.lookahead-3,C=Q(Y,Y.strstart-1-Y.prev_match,Y.prev_length-3),Y.lookahead-=Y.prev_length-1,Y.prev_length-=2;do{++Y.strstart<=E&&(Y.ins_h=z(Y,Y.ins_h,Y.window[Y.strstart+3-1]),h=Y.prev[Y.strstart&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=Y.strstart)}while(0!==--Y.prev_length);if(Y.match_available=0,Y.match_length=2,Y.strstart++,C&&(o(Y,!1),0===Y.strm.avail_out))return 1}else if(Y.match_available){if(C=Q(Y,0,Y.window[Y.strstart-1]),C&&o(Y,!1),Y.strstart++,Y.lookahead--,0===Y.strm.avail_out)return 1}else Y.match_available=1,Y.strstart++,Y.lookahead--}return Y.match_available&&(C=Q(Y,0,Y.window[Y.strstart-1]),Y.match_available=0),Y.insert=Y.strstart<2?Y.strstart:2,c===p?(o(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(o(Y,!1),0===Y.strm.avail_out)?1:2};function F(Y,c,h,C,E){this.good_length=Y,this.max_lazy=c,this.nice_length=h,this.max_chain=C,this.func=E}const J=[new F(0,0,0,0,((Y,c)=>{let h=65535;for(h>Y.pending_buf_size-5&&(h=Y.pending_buf_size-5);;){if(Y.lookahead<=1){if(R(Y),0===Y.lookahead&&c===q)return 1;if(0===Y.lookahead)break}Y.strstart+=Y.lookahead,Y.lookahead=0;const C=Y.block_start+h;if((0===Y.strstart||Y.strstart>=C)&&(Y.lookahead=Y.strstart-C,Y.strstart=C,o(Y,!1),0===Y.strm.avail_out))return 1;if(Y.strstart-Y.block_start>=Y.w_size-A&&(o(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,c===p?(o(Y,!0),0===Y.strm.avail_out?3:4):(Y.strstart>Y.block_start&&(o(Y,!1),Y.strm.avail_out),1)})),new F(4,4,8,4,B),new F(4,5,16,8,B),new F(4,6,32,32,B),new F(4,4,16,16,t),new F(8,16,32,32,t),new F(8,16,128,128,t),new F(8,32,128,256,t),new F(32,128,258,1024,t),new F(32,258,258,4096,t)];function j(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=s,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const S=Y=>{if(!Y||!Y.state)return n(Y,D);Y.total_in=Y.total_out=0,Y.data_type=I;const c=Y.state;return c.pending=0,c.pending_out=0,c.wrap<0&&(c.wrap=-c.wrap),c.status=c.wrap?42:U,Y.adler=2===c.wrap?0:1,c.last_flush=q,C(c),y},mY=Y=>{const c=S(Y);var h;return c===y&&((h=Y.state).window_size=2*h.w_size,g(h.head),h.max_lazy_match=J[h.level].max_lazy,h.good_match=J[h.level].good_length,h.nice_match=J[h.level].nice_length,h.max_chain_length=J[h.level].max_chain,h.strstart=0,h.block_start=0,h.lookahead=0,h.insert=0,h.match_length=h.prev_length=2,h.match_available=0,h.ins_h=0),c},YY=(Y,c,h,C,E,N)=>{if(!Y)return D;let Q=1;if(c===r&&(c=6),C<0?(Q=0,C=-C):C>15&&(Q=2,C-=16),E<1||E>9||h!==s||C<8||C>15||c<0||c>9||N<0||N>G)return n(Y,D);8===C&&(C=9);const b=new j;return Y.state=b,b.strm=Y,b.wrap=Q,b.gzhead=null,b.w_bits=C,b.w_size=1<<b.w_bits,b.w_mask=b.w_size-1,b.hash_bits=E+7,b.hash_size=1<<b.hash_bits,b.hash_mask=b.hash_size-1,b.hash_shift=~~((b.hash_bits+3-1)/3),b.window=new Uint8Array(2*b.w_size),b.head=new Uint16Array(b.hash_size),b.prev=new Uint16Array(b.w_size),b.lit_bufsize=1<<E+6,b.pending_buf_size=4*b.lit_bufsize,b.pending_buf=new Uint8Array(b.pending_buf_size),b.d_buf=1*b.lit_bufsize,b.l_buf=3*b.lit_bufsize,b.level=c,b.strategy=N,b.method=h,mY(Y)};Y.exports.deflateInit=(Y,c)=>YY(Y,c,s,15,8,K),Y.exports.deflateInit2=YY,Y.exports.deflateReset=mY,Y.exports.deflateResetKeep=S,Y.exports.deflateSetHeader=(Y,c)=>Y&&Y.state?2!==Y.state.wrap?D:(Y.state.gzhead=c,y):D,Y.exports.deflate=(Y,c)=>{let h,C;if(!Y||!Y.state||c>P||c<0)return Y?n(Y,D):D;const N=Y.state;if(!Y.output||!Y.input&&0!==Y.avail_in||N.status===l&&c!==p)return n(Y,0===Y.avail_out?e:D);N.strm=Y;const H=N.last_flush;if(N.last_flush=c,42===N.status)if(2===N.wrap)Y.adler=0,f(N,31),f(N,139),f(N,8),N.gzhead?(f(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),f(N,255&N.gzhead.time),f(N,N.gzhead.time>>8&255),f(N,N.gzhead.time>>16&255),f(N,N.gzhead.time>>24&255),f(N,9===N.level?2:N.strategy>=Z||N.level<2?4:0),f(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(f(N,255&N.gzhead.extra.length),f(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(Y.adler=w(Y.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(f(N,0),f(N,0),f(N,0),f(N,0),f(N,0),f(N,9===N.level?2:N.strategy>=Z||N.level<2?4:0),f(N,3),N.status=U);else{let c=s+(N.w_bits-8<<4)<<8,h=-1;h=N.strategy>=Z||N.level<2?0:N.level<6?1:6===N.level?2:3,c|=h<<6,0!==N.strstart&&(c|=32),c+=31-c%31,N.status=U,L(N,c),0!==N.strstart&&(L(N,Y.adler>>>16),L(N,65535&Y.adler)),Y.adler=1}if(69===N.status)if(N.gzhead.extra){for(h=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),O(Y),h=N.pending,N.pending!==N.pending_buf_size));)f(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(73===N.status)if(N.gzhead.name){h=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),O(Y),h=N.pending,N.pending===N.pending_buf_size)){C=1;break}C=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,f(N,C)}while(0!==C);N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),0===C&&(N.gzindex=0,N.status=91)}else N.status=91;if(91===N.status)if(N.gzhead.comment){h=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),O(Y),h=N.pending,N.pending===N.pending_buf_size)){C=1;break}C=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,f(N,C)}while(0!==C);N.gzhead.hcrc&&N.pending>h&&(Y.adler=w(Y.adler,N.pending_buf,N.pending-h,h)),0===C&&(N.status=V)}else N.status=V;if(N.status===V&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&O(Y),N.pending+2<=N.pending_buf_size&&(f(N,255&Y.adler),f(N,Y.adler>>8&255),Y.adler=0,N.status=U)):N.status=U),0!==N.pending){if(O(Y),0===Y.avail_out)return N.last_flush=-1,y}else if(0===Y.avail_in&&v(c)<=v(H)&&c!==p)return n(Y,e);if(N.status===l&&0!==Y.avail_in)return n(Y,e);if(0!==Y.avail_in||0!==N.lookahead||c!==q&&N.status!==l){let h=N.strategy===Z?((Y,c)=>{let h;for(;;){if(0===Y.lookahead&&(R(Y),0===Y.lookahead)){if(c===q)return 1;break}if(Y.match_length=0,h=Q(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,h&&(o(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,c===p?(o(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(o(Y,!1),0===Y.strm.avail_out)?1:2})(N,c):N.strategy===a?((Y,c)=>{let h,C,E,N;const b=Y.window;for(;;){if(Y.lookahead<=x){if(R(Y),Y.lookahead<=x&&c===q)return 1;if(0===Y.lookahead)break}if(Y.match_length=0,Y.lookahead>=3&&Y.strstart>0&&(E=Y.strstart-1,C=b[E],C===b[++E]&&C===b[++E]&&C===b[++E])){N=Y.strstart+x;do{}while(C===b[++E]&&C===b[++E]&&C===b[++E]&&C===b[++E]&&C===b[++E]&&C===b[++E]&&C===b[++E]&&C===b[++E]&&E<N);Y.match_length=x-(N-E),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=3?(h=Q(Y,1,Y.match_length-3),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(h=Q(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),h&&(o(Y,!1),0===Y.strm.avail_out))return 1}return Y.insert=0,c===p?(o(Y,!0),0===Y.strm.avail_out?3:4):Y.last_lit&&(o(Y,!1),0===Y.strm.avail_out)?1:2})(N,c):J[N.level].func(N,c);if(3!==h&&4!==h||(N.status=l),1===h||3===h)return 0===Y.avail_out&&(N.last_flush=-1),y;if(2===h&&(c===k?b(N):c!==P&&(E(N,0,0,!1),c===M&&(g(N.head),0===N.lookahead&&(N.strstart=0,N.block_start=0,N.insert=0))),O(Y),0===Y.avail_out))return N.last_flush=-1,y}return c!==p?y:N.wrap<=0?d:(2===N.wrap?(f(N,255&Y.adler),f(N,Y.adler>>8&255),f(N,Y.adler>>16&255),f(N,Y.adler>>24&255),f(N,255&Y.total_in),f(N,Y.total_in>>8&255),f(N,Y.total_in>>16&255),f(N,Y.total_in>>24&255)):(L(N,Y.adler>>>16),L(N,65535&Y.adler)),O(Y),N.wrap>0&&(N.wrap=-N.wrap),0!==N.pending?y:d)},Y.exports.deflateEnd=Y=>{if(!Y||!Y.state)return D;const c=Y.state.status;return 42!==c&&69!==c&&73!==c&&91!==c&&c!==V&&c!==U&&c!==l?n(Y,D):(Y.state=null,c===U?n(Y,T):y)},Y.exports.deflateSetDictionary=(Y,c)=>{let h=c.length;if(!Y||!Y.state)return D;const C=Y.state,E=C.wrap;if(2===E||1===E&&42!==C.status||C.lookahead)return D;if(1===E&&(Y.adler=H(Y.adler,c,h,0)),C.wrap=0,h>=C.w_size){0===E&&(g(C.head),C.strstart=0,C.block_start=0,C.insert=0);let Y=new Uint8Array(C.w_size);Y.set(c.subarray(h-C.w_size,h),0),c=Y,h=C.w_size}const N=Y.avail_in,Q=Y.next_in,b=Y.input;for(Y.avail_in=h,Y.next_in=0,Y.input=c,R(C);C.lookahead>=3;){let Y=C.strstart,c=C.lookahead-2;do{C.ins_h=z(C,C.ins_h,C.window[Y+3-1]),C.prev[Y&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=Y,Y++}while(--c);C.strstart=Y,C.lookahead=2,R(C)}return C.strstart+=C.lookahead,C.block_start=C.strstart,C.insert=C.lookahead,C.lookahead=0,C.match_length=C.prev_length=2,C.match_available=0,Y.next_in=Q,Y.input=b,Y.avail_in=N,C.wrap=E,y},Y.exports.deflateInfo="pako deflate (from Nodeca project)"},15043:Y=>{"use strict";Y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},15028:Y=>{"use strict";Y.exports=function(Y,c){let h,C,E,N,Q,b,H,w,W,q,k,M,p,P,y,d,D,T,e,r,X,Z,a,G;const K=Y.state;h=Y.next_in,a=Y.input,C=h+(Y.avail_in-5),E=Y.next_out,G=Y.output,N=E-(c-Y.avail_out),Q=E+(Y.avail_out-257),b=K.dmax,H=K.wsize,w=K.whave,W=K.wnext,q=K.window,k=K.hold,M=K.bits,p=K.lencode,P=K.distcode,y=(1<<K.lenbits)-1,d=(1<<K.distbits)-1;Y:do{M<15&&(k+=a[h++]<<M,M+=8,k+=a[h++]<<M,M+=8),D=p[k&y];c:for(;;){if(T=D>>>24,k>>>=T,M-=T,T=D>>>16&255,0===T)G[E++]=65535&D;else{if(!(16&T)){if(0===(64&T)){D=p[(65535&D)+(k&(1<<T)-1)];continue c}if(32&T){K.mode=12;break Y}Y.mh="invalid literal/length code",K.mode=30;break Y}e=65535&D,T&=15,T&&(M<T&&(k+=a[h++]<<M,M+=8),e+=k&(1<<T)-1,k>>>=T,M-=T),M<15&&(k+=a[h++]<<M,M+=8,k+=a[h++]<<M,M+=8),D=P[k&d];h:for(;;){if(T=D>>>24,k>>>=T,M-=T,T=D>>>16&255,!(16&T)){if(0===(64&T)){D=P[(65535&D)+(k&(1<<T)-1)];continue h}Y.mh="invalid distance code",K.mode=30;break Y}if(r=65535&D,T&=15,M<T&&(k+=a[h++]<<M,M+=8,M<T&&(k+=a[h++]<<M,M+=8)),r+=k&(1<<T)-1,r>b){Y.mh="invalid distance too far back",K.mode=30;break Y}if(k>>>=T,M-=T,T=E-N,r>T){if(T=r-T,T>w&&K.sane){Y.mh="invalid distance too far back",K.mode=30;break Y}if(X=0,Z=q,0===W){if(X+=H-T,T<e){e-=T;do{G[E++]=q[X++]}while(--T);X=E-r,Z=G}}else if(W<T){if(X+=H+W-T,T-=W,T<e){e-=T;do{G[E++]=q[X++]}while(--T);if(X=0,W<e){T=W,e-=T;do{G[E++]=q[X++]}while(--T);X=E-r,Z=G}}}else if(X+=W-T,T<e){e-=T;do{G[E++]=q[X++]}while(--T);X=E-r,Z=G}for(;e>2;)G[E++]=Z[X++],G[E++]=Z[X++],G[E++]=Z[X++],e-=3;e&&(G[E++]=Z[X++],e>1&&(G[E++]=Z[X++]))}else{X=E-r;do{G[E++]=G[X++],G[E++]=G[X++],G[E++]=G[X++],e-=3}while(e>2);e&&(G[E++]=G[X++],e>1&&(G[E++]=G[X++]))}break}}break}}while(h<C&&E<Q);e=M>>3,h-=e,M-=e<<3,k&=(1<<M)-1,Y.next_in=h,Y.next_out=E,Y.avail_in=h<C?C-h+5:5-(h-C),Y.avail_out=E<Q?Q-E+257:257-(E-Q),K.hold=k,K.bits=M}},15022:(Y,c,h)=>{"use strict";const C=h(14980),E=h(14988),N=h(15028),Q=h(15035),{Z_FINISH:b,Z_BLOCK:H,Z_TREES:w,Z_OK:W,Z_STREAM_END:q,Z_NEED_DICT:k,Z_STREAM_ERROR:M,Z_DATA_ERROR:p,Z_MEM_ERROR:P,Z_BUF_ERROR:y,Z_DEFLATED:d}=h(14997),D=12,T=30,e=Y=>(Y>>>24&255)+(Y>>>8&65280)+((65280&Y)<<8)+((255&Y)<<24);function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=Y=>{if(!Y||!Y.state)return M;const c=Y.state;return Y.total_in=Y.total_out=c.total=0,Y.mh="",c.wrap&&(Y.adler=1&c.wrap),c.mode=1,c.last=0,c.havedict=0,c.dmax=32768,c.head=null,c.hold=0,c.bits=0,c.lencode=c.lendyn=new Int32Array(852),c.distcode=c.distdyn=new Int32Array(592),c.sane=1,c.back=-1,W},Z=Y=>{if(!Y||!Y.state)return M;const c=Y.state;return c.wsize=0,c.whave=0,c.wnext=0,X(Y)},a=(Y,c)=>{let h;if(!Y||!Y.state)return M;const C=Y.state;return c<0?(h=0,c=-c):(h=1+(c>>4),c<48&&(c&=15)),c&&(c<8||c>15)?M:(null!==C.window&&C.wbits!==c&&(C.window=null),C.wrap=h,C.wbits=c,Z(Y))},G=(Y,c)=>{if(!Y)return M;const h=new r;Y.state=h,h.window=null;const C=a(Y,c);return C!==W&&(Y.state=null),C};let K,I,s=!0;const x=Y=>{if(s){K=new Int32Array(512),I=new Int32Array(32);let c=0;for(;c<144;)Y.lens[c++]=8;for(;c<256;)Y.lens[c++]=9;for(;c<280;)Y.lens[c++]=7;for(;c<288;)Y.lens[c++]=8;for(Q(1,Y.lens,0,288,K,0,Y.work,{bits:9}),c=0;c<32;)Y.lens[c++]=5;Q(2,Y.lens,0,32,I,0,Y.work,{bits:5}),s=!1}Y.lencode=K,Y.lenbits=9,Y.distcode=I,Y.distbits=5},A=(Y,c,h,C)=>{let E;const N=Y.state;return null===N.window&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new Uint8Array(N.wsize)),C>=N.wsize?(N.window.set(c.subarray(h-N.wsize,h),0),N.wnext=0,N.whave=N.wsize):(E=N.wsize-N.wnext,E>C&&(E=C),N.window.set(c.subarray(h-C,h-C+E),N.wnext),(C-=E)?(N.window.set(c.subarray(h-C,h),0),N.wnext=C,N.whave=N.wsize):(N.wnext+=E,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=E))),0};Y.exports.inflateReset=Z,Y.exports.inflateReset2=a,Y.exports.inflateResetKeep=X,Y.exports.inflateInit=Y=>G(Y,15),Y.exports.inflateInit2=G,Y.exports.inflate=(Y,c)=>{let h,r,X,Z,a,G,K,I,s,V,U,l,n,v,g,z,O,o,f,L,u,i,R=0;const B=new Uint8Array(4);let t,F;const J=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Y||!Y.state||!Y.output||!Y.input&&0!==Y.avail_in)return M;h=Y.state,h.mode===D&&(h.mode=13),a=Y.next_out,X=Y.output,K=Y.avail_out,Z=Y.next_in,r=Y.input,G=Y.avail_in,I=h.hold,s=h.bits,V=G,U=K,i=W;Y:for(;;)switch(h.mode){case 1:if(0===h.wrap){h.mode=13;break}for(;s<16;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(2&h.wrap&&35615===I){h.check=0,B[0]=255&I,B[1]=I>>>8&255,h.check=E(h.check,B,2,0),I=0,s=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&I)<<8)+(I>>8))%31){Y.mh="incorrect header check",h.mode=T;break}if((15&I)!==d){Y.mh="unknown compression method",h.mode=T;break}if(I>>>=4,s-=4,u=8+(15&I),0===h.wbits)h.wbits=u;else if(u>h.wbits){Y.mh="invalid window size",h.mode=T;break}h.dmax=1<<h.wbits,Y.adler=h.check=1,h.mode=512&I?10:D,I=0,s=0;break;case 2:for(;s<16;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(h.flags=I,(255&h.flags)!==d){Y.mh="unknown compression method",h.mode=T;break}if(57344&h.flags){Y.mh="unknown header flags set",h.mode=T;break}h.head&&(h.head.text=I>>8&1),512&h.flags&&(B[0]=255&I,B[1]=I>>>8&255,h.check=E(h.check,B,2,0)),I=0,s=0,h.mode=3;case 3:for(;s<32;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.head&&(h.head.time=I),512&h.flags&&(B[0]=255&I,B[1]=I>>>8&255,B[2]=I>>>16&255,B[3]=I>>>24&255,h.check=E(h.check,B,4,0)),I=0,s=0,h.mode=4;case 4:for(;s<16;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.head&&(h.head.xflags=255&I,h.head.os=I>>8),512&h.flags&&(B[0]=255&I,B[1]=I>>>8&255,h.check=E(h.check,B,2,0)),I=0,s=0,h.mode=5;case 5:if(1024&h.flags){for(;s<16;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.length=I,h.head&&(h.head.extra_len=I),512&h.flags&&(B[0]=255&I,B[1]=I>>>8&255,h.check=E(h.check,B,2,0)),I=0,s=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(l=h.length,l>G&&(l=G),l&&(h.head&&(u=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Uint8Array(h.head.extra_len)),h.head.extra.set(r.subarray(Z,Z+l),u)),512&h.flags&&(h.check=E(h.check,r,l,Z)),G-=l,Z+=l,h.length-=l),h.length))break Y;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(0===G)break Y;l=0;do{u=r[Z+l++],h.head&&u&&h.length<65536&&(h.head.name+=String.fromCharCode(u))}while(u&&l<G);if(512&h.flags&&(h.check=E(h.check,r,l,Z)),G-=l,Z+=l,u)break Y}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(0===G)break Y;l=0;do{u=r[Z+l++],h.head&&u&&h.length<65536&&(h.head.comment+=String.fromCharCode(u))}while(u&&l<G);if(512&h.flags&&(h.check=E(h.check,r,l,Z)),G-=l,Z+=l,u)break Y}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;s<16;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(I!==(65535&h.check)){Y.mh="header crc mismatch",h.mode=T;break}I=0,s=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),Y.adler=h.check=0,h.mode=D;break;case 10:for(;s<32;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}Y.adler=h.check=e(I),I=0,s=0,h.mode=11;case 11:if(0===h.havedict)return Y.next_out=a,Y.avail_out=K,Y.next_in=Z,Y.avail_in=G,h.hold=I,h.bits=s,k;Y.adler=h.check=1,h.mode=D;case D:if(c===H||c===w)break Y;case 13:if(h.last){I>>>=7&s,s-=7&s,h.mode=27;break}for(;s<3;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}switch(h.last=1&I,I>>>=1,s-=1,3&I){case 0:h.mode=14;break;case 1:if(x(h),h.mode=20,c===w){I>>>=2,s-=2;break Y}break;case 2:h.mode=17;break;case 3:Y.mh="invalid block type",h.mode=T}I>>>=2,s-=2;break;case 14:for(I>>>=7&s,s-=7&s;s<32;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if((65535&I)!==(I>>>16^65535)){Y.mh="invalid stored block lengths",h.mode=T;break}if(h.length=65535&I,I=0,s=0,h.mode=15,c===w)break Y;case 15:h.mode=16;case 16:if(l=h.length,l){if(l>G&&(l=G),l>K&&(l=K),0===l)break Y;X.set(r.subarray(Z,Z+l),a),G-=l,Z+=l,K-=l,a+=l,h.length-=l;break}h.mode=D;break;case 17:for(;s<14;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(h.nlen=257+(31&I),I>>>=5,s-=5,h.ndist=1+(31&I),I>>>=5,s-=5,h.ncode=4+(15&I),I>>>=4,s-=4,h.nlen>286||h.ndist>30){Y.mh="too many length or distance symbols",h.mode=T;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;s<3;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.lens[J[h.have++]]=7&I,I>>>=3,s-=3}for(;h.have<19;)h.lens[J[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,t={bits:h.lenbits},i=Q(0,h.lens,0,19,h.lencode,0,h.work,t),h.lenbits=t.bits,i){Y.mh="invalid code lengths set",h.mode=T;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;R=h.lencode[I&(1<<h.lenbits)-1],g=R>>>24,z=R>>>16&255,O=65535&R,!(g<=s);){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(O<16)I>>>=g,s-=g,h.lens[h.have++]=O;else{if(16===O){for(F=g+2;s<F;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(I>>>=g,s-=g,0===h.have){Y.mh="invalid bit length repeat",h.mode=T;break}u=h.lens[h.have-1],l=3+(3&I),I>>>=2,s-=2}else if(17===O){for(F=g+3;s<F;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}I>>>=g,s-=g,u=0,l=3+(7&I),I>>>=3,s-=3}else{for(F=g+7;s<F;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}I>>>=g,s-=g,u=0,l=11+(127&I),I>>>=7,s-=7}if(h.have+l>h.nlen+h.ndist){Y.mh="invalid bit length repeat",h.mode=T;break}for(;l--;)h.lens[h.have++]=u}}if(h.mode===T)break;if(0===h.lens[256]){Y.mh="invalid code -- missing end-of-block",h.mode=T;break}if(h.lenbits=9,t={bits:h.lenbits},i=Q(1,h.lens,0,h.nlen,h.lencode,0,h.work,t),h.lenbits=t.bits,i){Y.mh="invalid literal/lengths set",h.mode=T;break}if(h.distbits=6,h.distcode=h.distdyn,t={bits:h.distbits},i=Q(2,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,t),h.distbits=t.bits,i){Y.mh="invalid distances set",h.mode=T;break}if(h.mode=20,c===w)break Y;case 20:h.mode=21;case 21:if(G>=6&&K>=258){Y.next_out=a,Y.avail_out=K,Y.next_in=Z,Y.avail_in=G,h.hold=I,h.bits=s,N(Y,U),a=Y.next_out,X=Y.output,K=Y.avail_out,Z=Y.next_in,r=Y.input,G=Y.avail_in,I=h.hold,s=h.bits,h.mode===D&&(h.back=-1);break}for(h.back=0;R=h.lencode[I&(1<<h.lenbits)-1],g=R>>>24,z=R>>>16&255,O=65535&R,!(g<=s);){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(z&&0===(240&z)){for(o=g,f=z,L=O;R=h.lencode[L+((I&(1<<o+f)-1)>>o)],g=R>>>24,z=R>>>16&255,O=65535&R,!(o+g<=s);){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}I>>>=o,s-=o,h.back+=o}if(I>>>=g,s-=g,h.back+=g,h.length=O,0===z){h.mode=26;break}if(32&z){h.back=-1,h.mode=D;break}if(64&z){Y.mh="invalid literal/length code",h.mode=T;break}h.extra=15&z,h.mode=22;case 22:if(h.extra){for(F=h.extra;s<F;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.length+=I&(1<<h.extra)-1,I>>>=h.extra,s-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;R=h.distcode[I&(1<<h.distbits)-1],g=R>>>24,z=R>>>16&255,O=65535&R,!(g<=s);){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(0===(240&z)){for(o=g,f=z,L=O;R=h.distcode[L+((I&(1<<o+f)-1)>>o)],g=R>>>24,z=R>>>16&255,O=65535&R,!(o+g<=s);){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}I>>>=o,s-=o,h.back+=o}if(I>>>=g,s-=g,h.back+=g,64&z){Y.mh="invalid distance code",h.mode=T;break}h.offset=O,h.extra=15&z,h.mode=24;case 24:if(h.extra){for(F=h.extra;s<F;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}h.offset+=I&(1<<h.extra)-1,I>>>=h.extra,s-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){Y.mh="invalid distance too far back",h.mode=T;break}h.mode=25;case 25:if(0===K)break Y;if(l=U-K,h.offset>l){if(l=h.offset-l,l>h.whave&&h.sane){Y.mh="invalid distance too far back",h.mode=T;break}l>h.wnext?(l-=h.wnext,n=h.wsize-l):n=h.wnext-l,l>h.length&&(l=h.length),v=h.window}else v=X,n=a-h.offset,l=h.length;l>K&&(l=K),K-=l,h.length-=l;do{X[a++]=v[n++]}while(--l);0===h.length&&(h.mode=21);break;case 26:if(0===K)break Y;X[a++]=h.length,K--,h.mode=21;break;case 27:if(h.wrap){for(;s<32;){if(0===G)break Y;G--,I|=r[Z++]<<s,s+=8}if(U-=K,Y.total_out+=U,h.total+=U,U&&(Y.adler=h.check=h.flags?E(h.check,X,U,a-U):C(h.check,X,U,a-U)),U=K,(h.flags?I:e(I))!==h.check){Y.mh="incorrect data check",h.mode=T;break}I=0,s=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;s<32;){if(0===G)break Y;G--,I+=r[Z++]<<s,s+=8}if(I!==(4294967295&h.total)){Y.mh="incorrect length check",h.mode=T;break}I=0,s=0}h.mode=29;case 29:i=q;break Y;case T:i=p;break Y;case 31:return P;default:return M}return Y.next_out=a,Y.avail_out=K,Y.next_in=Z,Y.avail_in=G,h.hold=I,h.bits=s,(h.wsize||U!==Y.avail_out&&h.mode<T&&(h.mode<27||c!==b))&&A(Y,Y.output,Y.next_out,U-Y.avail_out)?(h.mode=31,P):(V-=Y.avail_in,U-=Y.avail_out,Y.total_in+=V,Y.total_out+=U,h.total+=U,h.wrap&&U&&(Y.adler=h.check=h.flags?E(h.check,X,U,Y.next_out-U):C(h.check,X,U,Y.next_out-U)),Y.data_type=h.bits+(h.last?64:0)+(h.mode===D?128:0)+(20===h.mode||15===h.mode?256:0),(0===V&&0===U||c===b)&&i===W&&(i=y),i)},Y.exports.inflateEnd=Y=>{if(!Y||!Y.state)return M;let c=Y.state;return c.window&&(c.window=null),Y.state=null,W},Y.exports.inflateGetHeader=(Y,c)=>{if(!Y||!Y.state)return M;const h=Y.state;return 0===(2&h.wrap)?M:(h.head=c,c.done=!1,W)},Y.exports.inflateSetDictionary=(Y,c)=>{const h=c.length;let E,N,Q;return Y&&Y.state?(E=Y.state,0!==E.wrap&&11!==E.mode?M:11===E.mode&&(N=1,N=C(N,c,h,0),N!==E.check)?p:(Q=A(Y,c,h,h),Q?(E.mode=31,P):(E.havedict=1,W))):M},Y.exports.inflateInfo="pako inflate (from Nodeca project)"},15035:Y=>{"use strict";const c=15,h=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),C=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),N=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Y.exports=(Y,Q,b,H,w,W,q,k)=>{const M=k.bits;let p,P,y,d,D,T,e=0,r=0,X=0,Z=0,a=0,G=0,K=0,I=0,s=0,x=0,A=null,V=0;const U=new Uint16Array(16),l=new Uint16Array(16);let n,v,g,z=null,O=0;for(e=0;e<=c;e++)U[e]=0;for(r=0;r<H;r++)U[Q[b+r]]++;for(a=M,Z=c;Z>=1&&0===U[Z];Z--);if(a>Z&&(a=Z),0===Z)return w[W++]=20971520,w[W++]=20971520,k.bits=1,0;for(X=1;X<Z&&0===U[X];X++);for(a<X&&(a=X),I=1,e=1;e<=c;e++)if(I<<=1,I-=U[e],I<0)return-1;if(I>0&&(0===Y||1!==Z))return-1;for(l[1]=0,e=1;e<c;e++)l[e+1]=l[e]+U[e];for(r=0;r<H;r++)0!==Q[b+r]&&(q[l[Q[b+r]]++]=r);if(0===Y?(A=z=q,T=19):1===Y?(A=h,V-=257,z=C,O-=257,T=256):(A=E,z=N,T=-1),x=0,r=0,e=X,D=W,G=a,K=0,y=-1,s=1<<a,d=s-1,1===Y&&s>852||2===Y&&s>592)return 1;for(;;){n=e-K,q[r]<T?(v=0,g=q[r]):q[r]>T?(v=z[O+q[r]],g=A[V+q[r]]):(v=96,g=0),p=1<<e-K,P=1<<G,X=P;do{P-=p,w[D+(x>>K)+P]=n<<24|v<<16|g}while(0!==P);for(p=1<<e-1;x&p;)p>>=1;if(0!==p?(x&=p-1,x+=p):x=0,r++,0===--U[e]){if(e===Z)break;e=Q[b+q[r]]}if(e>a&&(x&d)!==y){for(0===K&&(K=a),D+=X,G=e-K,I=1<<G;G+K<Z&&(I-=U[G+K],!(I<=0));)G++,I<<=1;if(s+=1<<G,1===Y&&s>852||2===Y&&s>592)return 1;y=x&d,w[y]=a<<24|G<<16|D-W}}return 0!==x&&(w[D+x]=e-K<<24|64<<16),k.bits=a,0}},14992:Y=>{"use strict";Y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14973:Y=>{"use strict";function c(Y){let c=Y.length;for(;--c>=0;)Y[c]=0}const h=256,C=286,E=30,N=15,Q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),b=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),H=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),W=new Array(576);c(W);const q=new Array(60);c(q);const k=new Array(512);c(k);const M=new Array(256);c(M);const p=new Array(29);c(p);const P=new Array(E);function y(Y,c,h,C,E){this.static_tree=Y,this.extra_bits=c,this.extra_base=h,this.elems=C,this.max_length=E,this.has_stree=Y&&Y.length}let d,D,T;function e(Y,c){this.dyn_tree=Y,this.max_code=0,this.stat_desc=c}c(P);const r=Y=>Y<256?k[Y]:k[256+(Y>>>7)],X=(Y,c)=>{Y.pending_buf[Y.pending++]=255&c,Y.pending_buf[Y.pending++]=c>>>8&255},Z=(Y,c,h)=>{Y.bi_valid>16-h?(Y.bi_buf|=c<<Y.bi_valid&65535,X(Y,Y.bi_buf),Y.bi_buf=c>>16-Y.bi_valid,Y.bi_valid+=h-16):(Y.bi_buf|=c<<Y.bi_valid&65535,Y.bi_valid+=h)},a=(Y,c,h)=>{Z(Y,h[2*c],h[2*c+1])},G=(Y,c)=>{let h=0;do{h|=1&Y,Y>>>=1,h<<=1}while(--c>0);return h>>>1},K=(Y,c,h)=>{const C=new Array(16);let E,Q,b=0;for(E=1;E<=N;E++)C[E]=b=b+h[E-1]<<1;for(Q=0;Q<=c;Q++){let c=Y[2*Q+1];0!==c&&(Y[2*Q]=G(C[c]++,c))}},I=Y=>{let c;for(c=0;c<C;c++)Y.dyn_ltree[2*c]=0;for(c=0;c<E;c++)Y.dyn_dtree[2*c]=0;for(c=0;c<19;c++)Y.bl_tree[2*c]=0;Y.dyn_ltree[512]=1,Y.opt_len=Y.static_len=0,Y.last_lit=Y.matches=0},s=Y=>{Y.bi_valid>8?X(Y,Y.bi_buf):Y.bi_valid>0&&(Y.pending_buf[Y.pending++]=Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0},x=(Y,c,h,C)=>{const E=2*c,N=2*h;return Y[E]<Y[N]||Y[E]===Y[N]&&C[c]<=C[h]},A=(Y,c,h)=>{const C=Y.heap[h];let E=h<<1;for(;E<=Y.heap_len&&(E<Y.heap_len&&x(c,Y.heap[E+1],Y.heap[E],Y.depth)&&E++,!x(c,C,Y.heap[E],Y.depth));)Y.heap[h]=Y.heap[E],h=E,E<<=1;Y.heap[h]=C},V=(Y,c,C)=>{let E,N,H,w,W=0;if(0!==Y.last_lit)do{E=Y.pending_buf[Y.d_buf+2*W]<<8|Y.pending_buf[Y.d_buf+2*W+1],N=Y.pending_buf[Y.l_buf+W],W++,0===E?a(Y,N,c):(H=M[N],a(Y,H+h+1,c),w=Q[H],0!==w&&(N-=p[H],Z(Y,N,w)),E--,H=r(E),a(Y,H,C),w=b[H],0!==w&&(E-=P[H],Z(Y,E,w)))}while(W<Y.last_lit);a(Y,256,c)},U=(Y,c)=>{const h=c.dyn_tree,C=c.stat_desc.static_tree,E=c.stat_desc.has_stree,Q=c.stat_desc.elems;let b,H,w,W=-1;for(Y.heap_len=0,Y.heap_max=573,b=0;b<Q;b++)0!==h[2*b]?(Y.heap[++Y.heap_len]=W=b,Y.depth[b]=0):h[2*b+1]=0;for(;Y.heap_len<2;)w=Y.heap[++Y.heap_len]=W<2?++W:0,h[2*w]=1,Y.depth[w]=0,Y.opt_len--,E&&(Y.static_len-=C[2*w+1]);for(c.max_code=W,b=Y.heap_len>>1;b>=1;b--)A(Y,h,b);w=Q;do{b=Y.heap[1],Y.heap[1]=Y.heap[Y.heap_len--],A(Y,h,1),H=Y.heap[1],Y.heap[--Y.heap_max]=b,Y.heap[--Y.heap_max]=H,h[2*w]=h[2*b]+h[2*H],Y.depth[w]=(Y.depth[b]>=Y.depth[H]?Y.depth[b]:Y.depth[H])+1,h[2*b+1]=h[2*H+1]=w,Y.heap[1]=w++,A(Y,h,1)}while(Y.heap_len>=2);Y.heap[--Y.heap_max]=Y.heap[1],((Y,c)=>{const h=c.dyn_tree,C=c.max_code,E=c.stat_desc.static_tree,Q=c.stat_desc.has_stree,b=c.stat_desc.extra_bits,H=c.stat_desc.extra_base,w=c.stat_desc.max_length;let W,q,k,M,p,P,y=0;for(M=0;M<=N;M++)Y.bl_count[M]=0;for(h[2*Y.heap[Y.heap_max]+1]=0,W=Y.heap_max+1;W<573;W++)q=Y.heap[W],M=h[2*h[2*q+1]+1]+1,M>w&&(M=w,y++),h[2*q+1]=M,q>C||(Y.bl_count[M]++,p=0,q>=H&&(p=b[q-H]),P=h[2*q],Y.opt_len+=P*(M+p),Q&&(Y.static_len+=P*(E[2*q+1]+p)));if(0!==y){do{for(M=w-1;0===Y.bl_count[M];)M--;Y.bl_count[M]--,Y.bl_count[M+1]+=2,Y.bl_count[w]--,y-=2}while(y>0);for(M=w;0!==M;M--)for(q=Y.bl_count[M];0!==q;)k=Y.heap[--W],k>C||(h[2*k+1]!==M&&(Y.opt_len+=(M-h[2*k+1])*h[2*k],h[2*k+1]=M),q--)}})(Y,c),K(h,W,Y.bl_count)},l=(Y,c,h)=>{let C,E,N=-1,Q=c[1],b=0,H=7,w=4;for(0===Q&&(H=138,w=3),c[2*(h+1)+1]=65535,C=0;C<=h;C++)E=Q,Q=c[2*(C+1)+1],++b<H&&E===Q||(b<w?Y.bl_tree[2*E]+=b:0!==E?(E!==N&&Y.bl_tree[2*E]++,Y.bl_tree[32]++):b<=10?Y.bl_tree[34]++:Y.bl_tree[36]++,b=0,N=E,0===Q?(H=138,w=3):E===Q?(H=6,w=3):(H=7,w=4))},n=(Y,c,h)=>{let C,E,N=-1,Q=c[1],b=0,H=7,w=4;for(0===Q&&(H=138,w=3),C=0;C<=h;C++)if(E=Q,Q=c[2*(C+1)+1],!(++b<H&&E===Q)){if(b<w)do{a(Y,E,Y.bl_tree)}while(0!==--b);else 0!==E?(E!==N&&(a(Y,E,Y.bl_tree),b--),a(Y,16,Y.bl_tree),Z(Y,b-3,2)):b<=10?(a(Y,17,Y.bl_tree),Z(Y,b-3,3)):(a(Y,18,Y.bl_tree),Z(Y,b-11,7));b=0,N=E,0===Q?(H=138,w=3):E===Q?(H=6,w=3):(H=7,w=4)}};let v=!1;const g=(Y,c,h,C)=>{Z(Y,0+(C?1:0),3),((Y,c,h,C)=>{s(Y),C&&(X(Y,h),X(Y,~h)),Y.pending_buf.set(Y.window.subarray(c,c+h),Y.pending),Y.pending+=h})(Y,c,h,!0)};Y.exports._tr_init=Y=>{v||((()=>{let Y,c,h,w,e;const r=new Array(16);for(h=0,w=0;w<28;w++)for(p[w]=h,Y=0;Y<1<<Q[w];Y++)M[h++]=w;for(M[h-1]=w,e=0,w=0;w<16;w++)for(P[w]=e,Y=0;Y<1<<b[w];Y++)k[e++]=w;for(e>>=7;w<E;w++)for(P[w]=e<<7,Y=0;Y<1<<b[w]-7;Y++)k[256+e++]=w;for(c=0;c<=N;c++)r[c]=0;for(Y=0;Y<=143;)W[2*Y+1]=8,Y++,r[8]++;for(;Y<=255;)W[2*Y+1]=9,Y++,r[9]++;for(;Y<=279;)W[2*Y+1]=7,Y++,r[7]++;for(;Y<=287;)W[2*Y+1]=8,Y++,r[8]++;for(K(W,287,r),Y=0;Y<E;Y++)q[2*Y+1]=5,q[2*Y]=G(Y,5);d=new y(W,Q,257,C,N),D=new y(q,b,0,E,N),T=new y(new Array(0),H,0,19,7)})(),v=!0),Y.l_desc=new e(Y.dyn_ltree,d),Y.d_desc=new e(Y.dyn_dtree,D),Y.bl_desc=new e(Y.bl_tree,T),Y.bi_buf=0,Y.bi_valid=0,I(Y)},Y.exports._tr_stored_block=g,Y.exports._tr_flush_block=(Y,c,C,E)=>{let N,Q,b=0;Y.level>0?(2===Y.strm.data_type&&(Y.strm.data_type=(Y=>{let c,C=4093624447;for(c=0;c<=31;c++,C>>>=1)if(1&C&&0!==Y.dyn_ltree[2*c])return 0;if(0!==Y.dyn_ltree[18]||0!==Y.dyn_ltree[20]||0!==Y.dyn_ltree[26])return 1;for(c=32;c<h;c++)if(0!==Y.dyn_ltree[2*c])return 1;return 0})(Y)),U(Y,Y.l_desc),U(Y,Y.d_desc),b=(Y=>{let c;for(l(Y,Y.dyn_ltree,Y.l_desc.max_code),l(Y,Y.dyn_dtree,Y.d_desc.max_code),U(Y,Y.bl_desc),c=18;c>=3&&0===Y.bl_tree[2*w[c]+1];c--);return Y.opt_len+=3*(c+1)+5+5+4,c})(Y),N=Y.opt_len+3+7>>>3,Q=Y.static_len+3+7>>>3,Q<=N&&(N=Q)):N=Q=C+5,C+4<=N&&-1!==c?g(Y,c,C,E):4===Y.strategy||Q===N?(Z(Y,2+(E?1:0),3),V(Y,W,q)):(Z(Y,4+(E?1:0),3),((Y,c,h,C)=>{let E;for(Z(Y,c-257,5),Z(Y,h-1,5),Z(Y,C-4,4),E=0;E<C;E++)Z(Y,Y.bl_tree[2*w[E]+1],3);n(Y,Y.dyn_ltree,c-1),n(Y,Y.dyn_dtree,h-1)})(Y,Y.l_desc.max_code+1,Y.d_desc.max_code+1,b+1),V(Y,Y.dyn_ltree,Y.dyn_dtree)),I(Y),E&&s(Y)},Y.exports._tr_tally=(Y,c,C)=>(Y.pending_buf[Y.d_buf+2*Y.last_lit]=c>>>8&255,Y.pending_buf[Y.d_buf+2*Y.last_lit+1]=255&c,Y.pending_buf[Y.l_buf+Y.last_lit]=255&C,Y.last_lit++,0===c?Y.dyn_ltree[2*C]++:(Y.matches++,c--,Y.dyn_ltree[2*(M[C]+h+1)]++,Y.dyn_dtree[2*r(c)]++),Y.last_lit===Y.lit_bufsize-1),Y.exports._tr_align=Y=>{Z(Y,2,3),a(Y,256,W),(Y=>{16===Y.bi_valid?(X(Y,Y.bi_buf),Y.bi_buf=0,Y.bi_valid=0):Y.bi_valid>=8&&(Y.pending_buf[Y.pending++]=255&Y.bi_buf,Y.bi_buf>>=8,Y.bi_valid-=8)})(Y)}},15007:Y=>{"use strict";Y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.mh="",this.state=null,this.data_type=2,this.adler=0}},13686:Y=>{function c(Y,c,h){for(var C=Y.length,E=-1/0,N=1/0,Q=0;Q<C;Q++){var b=(h[0][Q]-Y[Q])/c[Q],H=(h[1][Q]-Y[Q])/c[Q];if(b>H){var w=b;b=H,H=w}if(H<E||b>N)return 1/0;b>E&&(E=b),H<N&&(N=H)}return E>N?1/0:E}Y.exports=function(Y,h,C,E){var N=c(h,C,E);if(N===1/0)Y=null;else{Y=Y||[];for(var Q=0;Q<h.length;Q++)Y[Q]=h[Q]+C[Q]*N}return Y},Y.exports.distance=c},15133:(Y,c,h)=>{"use strict";h.d(c,{c:()=>Q});var C=h(34);const E=C.useLayoutEffect;const N=function(Y){var c=(0,C.useRef)(Y);return E((function(){c.current=Y})),c};var Q=function(Y){var c=N(Y);(0,C.xc)((function(){var Y=function(Y){var h;if(null!=c.current&&(h=c.current(Y)),Y.defaultPrevented&&(Y.returnValue=""),"string"===typeof h)return Y.returnValue=h,h};return window.addEventListener("beforeunload",Y),function(){window.removeEventListener("beforeunload",Y)}}),[])}},15076:(Y,c,h)=>{"use strict";var C=h(15080),E=Array.prototype.concat,N=Array.prototype.slice,Q=Y.exports=function(Y){for(var c=[],h=0,Q=Y.length;h<Q;h++){var b=Y[h];C(b)?c=E.call(c,N.call(b)):c.push(b)}return c};Q.wrap=function(Y){return function(){return Y(Q(arguments))}}},15080:Y=>{Y.exports=function(Y){return!(!Y||"string"===typeof Y)&&(Y instanceof Array||Array.isArray(Y)||Y.length>=0&&(Y.splice instanceof Function||Object.getOwnPropertyDescriptor(Y,Y.length-1)&&"String"!==Y.constructor.name))}},14929:(Y,c,h)=>{var C=h(14931);function E(Y){for(var c,h,E=0,N=Y.length,Q=0;Q<Y.length;){for(c=Y[Q],h=0;Q<N&&Y[Q]===c;)++Q,++h;E+=C.log2(h)/7|0,E+=C.log2(c>>>0)/7|0,E+=2}return E}c.size=E,c.encode=function(Y,c){c||(c=new Uint8Array(E(Y)));for(var h,C,N=0,Q=c.length,b=0;b<Y.length;){for(h=Y[b],C=0;b<Y.length&&Y[b]===h;)++b,++C;for(;N<Q&&C>=128;)c[N++]=128+(127&C),C>>>=7;if(N>=Q)throw new Error("RLE buffer overflow");for(c[N++]=C,h>>>=0;N<Q&&h>=128;)c[N++]=128+(127&h),h>>>=7;if(N>=Q)throw new Error("RLE buffer overflow");c[N++]=h}return c},c.decode=function(Y,c){for(var h,C,E,N,Q=c.length,b=Y.length,H=0,w=0;w<b;){for(h=0,C=0;w<b&&Y[w]>=128;)h+=(127&Y[w++])<<C,C+=7;if(h+=Y[w++]<<C,w>=b)throw new Error("RLE buffer underrun");if(H+h>Q)throw new Error("Chunk buffer overflow");for(E=0,C=0;w<b&&Y[w]>=128;)E+=(127&Y[w++])<<C,C+=7;if(w>=b)throw new Error("RLE buffer underrun");for(E+=Y[w++]<<C,N=0;N<h;++N)c[H++]=E}return c}},14931:(Y,c)=>{"use strict";function h(Y){var c=32;return(Y&=-Y)&&c--,65535&Y&&(c-=16),16711935&Y&&(c-=8),252645135&Y&&(c-=4),858993459&Y&&(c-=2),1431655765&Y&&(c-=1),c}c.INT_BITS=32,c.INT_MAX=2147483647,c.INT_MIN=-1<<31,c.sign=function(Y){return(Y>0)-(Y<0)},c.abs=function(Y){var c=Y>>31;return(Y^c)-c},c.min=function(Y,c){return c^(Y^c)&-(Y<c)},c.max=function(Y,c){return Y^(Y^c)&-(Y<c)},c.isPow2=function(Y){return!(Y&Y-1)&&!!Y},c.log2=function(Y){var c,h;return c=(Y>65535)<<4,c|=h=((Y>>>=c)>255)<<3,c|=h=((Y>>>=h)>15)<<2,(c|=h=((Y>>>=h)>3)<<1)|(Y>>>=h)>>1},c.log10=function(Y){return Y>=1e9?9:Y>=1e8?8:Y>=1e7?7:Y>=1e6?6:Y>=1e5?5:Y>=1e4?4:Y>=1e3?3:Y>=100?2:Y>=10?1:0},c.popCount=function(Y){return 16843009*((Y=(858993459&(Y-=Y>>>1&1431655765))+(Y>>>2&858993459))+(Y>>>4)&252645135)>>>24},c.countTrailingZeros=h,c.nextPow2=function(Y){return Y+=0===Y,--Y,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)+1},c.prevPow2=function(Y){return Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,(Y|=Y>>>16)-(Y>>>1)},c.parity=function(Y){return Y^=Y>>>16,Y^=Y>>>8,Y^=Y>>>4,27030>>>(Y&=15)&1};var C=new Array(256);!function(Y){for(var c=0;c<256;++c){var h=c,C=c,E=7;for(h>>>=1;h;h>>>=1)C<<=1,C|=1&h,--E;Y[c]=C<<E&255}}(C),c.reverse=function(Y){return C[255&Y]<<24|C[Y>>>8&255]<<16|C[Y>>>16&255]<<8|C[Y>>>24&255]},c.interleave2=function(Y,c){return(Y=1431655765&((Y=858993459&((Y=252645135&((Y=16711935&((Y&=65535)|Y<<8))|Y<<4))|Y<<2))|Y<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c&=65535)|c<<8))|c<<4))|c<<2))|c<<1))<<1},c.deinterleave2=function(Y,c){return(Y=65535&((Y=16711935&((Y=252645135&((Y=858993459&((Y=Y>>>c&1431655765)|Y>>>1))|Y>>>2))|Y>>>4))|Y>>>16))<<16>>16},c.interleave3=function(Y,c,h){return Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2),(Y|=(c=1227133513&((c=3272356035&((c=251719695&((c=4278190335&((c&=1023)|c<<16))|c<<8))|c<<4))|c<<2))<<1)|(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<2},c.deinterleave3=function(Y,c){return(Y=1023&((Y=4278190335&((Y=251719695&((Y=3272356035&((Y=Y>>>c&1227133513)|Y>>>2))|Y>>>4))|Y>>>8))|Y>>>16))<<22>>22},c.nextCombination=function(Y){var c=Y|Y-1;return c+1|(~c&-~c)-1>>>h(Y)+1}},14952:Y=>{"use strict";Y.exports=function(Y,c,h,C){var E=self||window;try{try{var N;try{N=new E.Blob([Y])}catch(w){(N=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(Y),N=N.getBlob()}var Q=E.URL||E.webkitURL,b=Q.createObjectURL(N),H=new E[c](b,h);return Q.revokeObjectURL(b),H}catch(w){return new E[c]("data:application/javascript,".concat(encodeURIComponent(Y)),h)}}catch(w){if(!C)throw Error("Inline worker is not supported");return new E[c](C,h)}}},13672:(Y,c,h)=>{"use strict";function C(Y,c,h,C,E){var N={};return Object.keys(C).forEach((function(Y){N[Y]=C[Y]})),N.enumerable=!!N.enumerable,N.configurable=!!N.configurable,("value"in N||N.initializer)&&(N.writable=!0),N=h.slice().reverse().reduce((function(h,C){return C(Y,c,h)||h}),N),E&&void 0!==N.initializer&&(N.value=N.initializer?N.initializer.call(E):void 0,N.initializer=void 0),void 0===N.initializer&&(Object.defineProperty(Y,c,N),N=null),N}h.d(c,{e:()=>C})},13670:(Y,c,h)=>{"use strict";function C(Y,c,h,C){h&&Object.defineProperty(Y,c,{enumerable:h.enumerable,configurable:h.configurable,writable:h.writable,value:h.initializer?h.initializer.call(C):void 0})}h.d(c,{e:()=>C})},15122:(Y,c,h)=>{"use strict";h.d(c,{d:()=>Q,g:()=>q,h:()=>b,l:()=>N,n:()=>H,r:()=>E,v:()=>w,x:()=>W});var C=h(13083);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(Y){const c=Math.min(Math.max(Y,0),2);this._easingMode=c}getEasingMode(){return this._easingMode}easeInCore(Y){throw new Error("You must implement this method")}ease(Y){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(Y);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Y)}return Y>=.5?.5*(1-this.easeInCore(2*(1-Y)))+.5:.5*this.easeInCore(2*Y)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class N extends E{easeInCore(Y){return Y=Math.max(0,Math.min(1,Y)),1-Math.sqrt(1-Y*Y)}}class Q extends E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Y}easeInCore(Y){const c=Math.max(0,this.amplitude);return Math.pow(Y,3)-Y*c*Math.sin(3.141592653589793*Y)}}class b extends E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Y,this.bounciness=c}easeInCore(Y){const c=Math.max(0,this.bounces);let h=this.bounciness;h<=1&&(h=1.001);const C=Math.pow(h,c),E=1-h,N=(1-C)/E+.5*C,Q=Y*N,b=Math.log(-Q*(1-h)+1)/Math.log(h),H=Math.floor(b),w=H+1,W=(1-Math.pow(h,H))/(E*N),q=.5*(W+(1-Math.pow(h,w))/(E*N)),k=Y-q,M=q-W;return-Math.pow(1/h,c-H)/(M*M)*(k-M)*(k+M)}}class H extends E{easeInCore(Y){return Y*Y*Y}}class w extends E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Y,this.springiness=c}easeInCore(Y){let c;const h=Math.max(0,this.oscillations),C=Math.max(0,this.springiness);return c=0==C?Y:(Math.exp(C*Y)-1)/(Math.exp(C)-1),c*Math.sin((6.283185307179586*h+1.5707963267948966)*Y)}}class W extends E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Y}easeInCore(Y){return this.exponent<=0?Y:(Math.exp(this.exponent*Y)-1)/(Math.exp(this.exponent)-1)}}class q extends E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Y,this.y1=c,this.x2=h,this.y2=C}easeInCore(Y){return C.b.Interpolate(Y,this.x1,this.y1,this.x2,this.y2)}}},14382:(Y,c,h)=>{"use strict";h.d(c,{d:()=>Q});var C=h(12869),E=h(12877),N=h(13294);class Q extends N.c{get _matrix(){return this._compose(),this.Hp}set _matrix(Y){(Y.updateFlag!==this.Hp.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Hp.N(Y),this._markAsDirtyAndDecompose())}constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Y,c.ZY(),!1),this.name=Y,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=c,this.Hp=(null===E||void 0===E?void 0:E.clone())??C.Matrix.Identity(),this._restMatrix=N??this.Hp.clone(),this._bindMatrix=Q??this.Hp.clone(),this._index=b,this._absoluteMatrix=new C.Matrix,this._absoluteBindMatrix=new C.Matrix,this._absoluteInverseBindMatrix=new C.Matrix,this._finalMatrix=new C.Matrix,c.bones.push(this),this.setParent(h,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Y){this.setParent(Y)}setParent(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Y){if(this.parent){const Y=this.parent.children.indexOf(this);-1!==Y&&this.parent.children.splice(Y,1)}this._parentNode=Y,this.parent&&this.parent.children.push(this),c&&this._updateAbsoluteBindMatrices(),this.xq()}}getLocalMatrix(){return this._compose(),this.Hp}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Y){this._restMatrix.N(Y)}setRestPose(Y){this.setRestMatrix(Y)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Y){this.Gc(Y)}setBindPose(Y){this.setBindMatrix(Y)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Y=C.TmpVectors.bh[0],c=C.TmpVectors.Quaternion[0],h=C.TmpVectors.bh[1];this.getRestMatrix().decompose(Y,c,h),this._linkedTransformNode.position.N(h),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??C.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.N(c),this._linkedTransformNode.lc.N(Y)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Y){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Y,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Uw}set position(Y){this._decompose(),this.Uw.N(Y),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Y){this.setRotation(Y)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Y){this.setRotationQuaternion(Y)}get lc(){return this.getScale()}set lc(Y){this.setScale(Y)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=C.bh.Zero(),this._localRotation=C.Quaternion.Zero(),this.Uw=C.bh.Zero()),this.Hp.decompose(this._localScaling,this._localRotation,this.Uw))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,C.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Uw,this.Hp)):this._needToCompose=!1)}Gc(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.N(Y),c&&this._updateAbsoluteBindMatrices(),h?this._matrix=Y:this.xq()}_updateAbsoluteBindMatrices(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Y||(Y=this._bindMatrix),this.parent?Y.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.N(Y),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),c)for(let h=0;h<this.children.length;h++)this.children[h]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}xq(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.xq(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.xq(),this._needToDecompose=!0}_updatePosition(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this.getLocalMatrix();if(0==c)E?(N.addAtIndex(12,Y.x),N.addAtIndex(13,Y.y),N.addAtIndex(14,Y.z)):N.setTranslationFromFloats(Y.x,Y.y,Y.z);else{let c=null;h&&(c=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const b=Q._TmpMats[0],H=Q._TmpVecs[0];this.parent?h&&c?(b.N(this.parent.getAbsoluteMatrix()),b.multiplyToRef(c,b)):b.N(this.parent.getAbsoluteMatrix()):C.Matrix.IdentityToRef(b),E&&b.setTranslationFromFloats(0,0,0),b.invert(),C.bh.TransformCoordinatesToRef(Y,b,H),E?(N.addAtIndex(12,H.x),N.addAtIndex(13,H.y),N.addAtIndex(14,H.z)):N.setTranslationFromFloats(H.x,H.y,H.z)}this._markAsDirtyAndDecompose()}translate(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(Y,c,h,!0)}setPosition(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this._updatePosition(Y,c,h,!1)}setAbsolutePosition(Y,c){this.setPosition(Y,1,c)}scale(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getLocalMatrix(),b=Q._TmpMats[0];C.Matrix.ScalingToRef(Y,c,h,b),b.multiplyToRef(N,N),b.invert();for(const C of this.children){const E=C.getLocalMatrix();E.multiplyToRef(b,E),E.multiplyAtIndex(12,Y),E.multiplyAtIndex(13,c),E.multiplyAtIndex(14,h),C._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const C of this.children)C.scale(Y,c,h,E)}setScale(Y){this._decompose(),this._localScaling.N(Y),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Y){this._decompose(),Y.N(this._localScaling)}setYawPitchRoll(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0;if(0===E){const b=Q._TmpQuat;return C.Quaternion.RotationYawPitchRollToRef(Y,c,h,b),void this.setRotationQuaternion(b,E,N)}const b=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(b,N))return;const H=Q._TmpMats[1];C.Matrix.RotationYawPitchRollToRef(Y,c,h,H),b.multiplyToRef(H,H),this._rotateWithMatrix(H,E,N)}rotate(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const N=Q._TmpMats[0];N.setTranslationFromFloats(0,0,0),C.Matrix.RotationAxisToRef(Y,c,N),this._rotateWithMatrix(N,h,E)}setAxisAngle(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===h){const N=Q._TmpQuat;return C.Quaternion.RotationAxisToRef(Y,c,N),void this.setRotationQuaternion(N,h,E)}const N=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,E))return;const b=Q._TmpMats[1];C.Matrix.RotationAxisToRef(Y,c,b),N.multiplyToRef(b,b),this._rotateWithMatrix(b,h,E)}setRotation(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Y.y,Y.x,Y.z,c,h)}setRotationQuaternion(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===c)return this._decompose(),this._localRotation.N(Y),void this._markAsDirtyAndCompose();const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,h))return;const N=Q._TmpMats[1];C.Matrix.FromQuaternionToRef(Y,N),E.multiplyToRef(N,N),this._rotateWithMatrix(N,c,h)}setRotationMatrix(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;if(0===c){const E=Q._TmpQuat;return C.Quaternion.FromRotationMatrixToRef(Y,E),void this.setRotationQuaternion(E,c,h)}const E=Q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,h))return;const N=Q._TmpMats[1];N.N(Y),E.multiplyToRef(Y,N),this._rotateWithMatrix(N,c,h)}_rotateWithMatrix(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const C=this.getLocalMatrix(),E=C.m[12],N=C.m[13],b=C.m[14],H=this.getParent(),w=Q._TmpMats[3],W=Q._TmpMats[4];H&&1==c?(h?(w.N(h.getWorldMatrix()),H.getAbsoluteMatrix().multiplyToRef(w,w)):w.N(H.getAbsoluteMatrix()),W.N(w),W.invert(),C.multiplyToRef(w,C),C.multiplyToRef(Y,C),C.multiplyToRef(W,C)):1==c&&h?(w.N(h.getWorldMatrix()),W.N(w),W.invert(),C.multiplyToRef(w,C),C.multiplyToRef(Y,C),C.multiplyToRef(W,C)):C.multiplyToRef(Y,C),C.setTranslationFromFloats(E,N,b),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Y,c){const h=Q._TmpMats[2];return Y.N(this.getAbsoluteMatrix()),c?(Y.multiplyToRef(c.getWorldMatrix(),Y),C.Matrix.ScalingToRef(c.lc.x,c.lc.y,c.lc.z,h)):C.Matrix.IdentityToRef(h),Y.invert(),!isNaN(Y.m[0])&&(h.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyToRef(h,Y),!0)}bc(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.bh.Zero();return this.getPositionToRef(Y,c,h),h}getPositionToRef(){let Y=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Y=this.getLocalMatrix();c.x=Y.m[12],c.y=Y.m[13],c.z=Y.m[14]}else{let h=null;Y&&(h=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let C=Q._TmpMats[0];Y&&h?(C.N(this.getAbsoluteMatrix()),C.multiplyToRef(h,C)):C=this.getAbsoluteMatrix(),c.x=C.m[12],c.y=C.m[13],c.z=C.m[14]}}getAbsolutePosition(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=C.bh.Zero();return this.getPositionToRef(1,Y,c),c}getAbsolutePositionToRef(Y,c){this.getPositionToRef(1,Y,c)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Hp.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.N(this.Hp);const Y=this._skeleton.getPoseMatrix();Y&&this._absoluteMatrix.multiplyToRef(Y,this._absoluteMatrix)}const Y=this.children,c=Y.length;for(let h=0;h<c;h++)Y[h].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}wW(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.bh.Zero();return this.getDirectionToRef(Y,c,h),h}getDirectionToRef(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,E=null;c&&(E=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=Q._TmpMats[0];N.N(this.getAbsoluteMatrix()),c&&E&&N.multiplyToRef(E,N),C.bh.TransformNormalToRef(Y,N,h),h.normalize()}getRotation(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.bh.Zero();return this.getRotationToRef(Y,c,h),h}getRotationToRef(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;const C=Q._TmpQuat;this.getRotationQuaternionToRef(Y,c,C),C.toEulerAnglesToRef(h)}getRotationQuaternion(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.Quaternion.Identity();return this.getRotationQuaternionToRef(Y,c,h),h}getRotationQuaternionToRef(){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),c.N(this._localRotation);else{const h=Q._TmpMats[0],C=this.getAbsoluteMatrix();Y?C.multiplyToRef(Y.getWorldMatrix(),h):h.N(C),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.decompose(void 0,c,void 0)}}getRotationMatrix(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0;const h=C.Matrix.Identity();return this.getRotationMatrixToRef(Y,c,h),h}getRotationMatrixToRef(){let Y=arguments.length>1?arguments[1]:void 0,c=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(c);else{const h=Q._TmpMats[0],C=this.getAbsoluteMatrix();Y?C.multiplyToRef(Y.getWorldMatrix(),h):h.N(C),h.multiplyAtIndex(0,this._scalingDeterminant),h.multiplyAtIndex(1,this._scalingDeterminant),h.multiplyAtIndex(2,this._scalingDeterminant),h.getRotationMatrixToRef(c)}}getAbsolutePositionFromLocal(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.bh.Zero();return this.getAbsolutePositionFromLocalToRef(Y,c,h),h}getAbsolutePositionFromLocalToRef(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,E=null;c&&(E=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=Q._TmpMats[0];N.N(this.getAbsoluteMatrix()),c&&E&&N.multiplyToRef(E,N),C.bh.TransformCoordinatesToRef(Y,N,h)}getLocalPositionFromAbsolute(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=C.bh.Zero();return this.getLocalPositionFromAbsoluteToRef(Y,c,h),h}getLocalPositionFromAbsoluteToRef(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0,E=null;c&&(E=c.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=Q._TmpMats[0];N.N(this.getAbsoluteMatrix()),c&&E&&N.multiplyToRef(E,N),N.invert(),C.bh.TransformCoordinatesToRef(Y,N,h)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Y=this._skeleton.bones.indexOf(this);if(-1!==Y&&this._skeleton.bones.splice(Y,1),this._parentNode&&this._parentNode.children){const Y=this._parentNode.children,c=Y.indexOf(this);-1!==c&&Y.splice(c,1)}super.dispose()}}Q._TmpVecs=(0,E.b)(2,C.bh.Zero),Q._TmpQuat=C.Quaternion.Identity(),Q._TmpMats=(0,E.b)(5,C.Matrix.Identity)},15116:(Y,c,h)=>{"use strict";h.d(c,{e:()=>U});var C=h(12853),E=h(12859),N=h(12690),Q=h(12869),b=h(12883),H=h(13294),w=h(13321),W=h(13149),q=h(12709),k=h(12874);class M{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Y){this._zoomStopsAnimation=Y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Y){this._idleRotationSpeed=Y}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Y){this._idleRotationWaitTime=Y}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Y){this._idleRotationSpinupTime=Y}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Y){this._attachedCamera=Y;const c=this._attachedCamera.ZY();this._onPrePointerObservableObserver=c.onPrePointerObservable.add((Y=>{Y.type!==W.c.POINTERDOWN?Y.type===W.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Y=q.d.Now;let c=0;null!=this._lastFrameTime&&(c=Y-this._lastFrameTime),this._lastFrameTime=Y,this._applyUserInteraction();const h=Y-this._lastInteractionTime-this._idleRotationWaitTime,C=Math.max(Math.min(h/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*C,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(c/1e3))}))}detach(){if(!this._attachedCamera)return;const Y=this._attachedCamera.ZY();this._onPrePointerObservableObserver&&Y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Y){this._lastInteractionTime=Y??q.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<k.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Y=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Y=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Y:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=q.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var p=h(15122),P=h(13395);class y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Y){if(this._autoTransitionRange===Y)return;this._autoTransitionRange=Y;const c=this._attachedCamera;c&&(Y?this._onMeshTargetChangedObserver=c.onMeshTargetChangedObservable.add((Y=>{if(Y&&(Y.Kc(!0),Y.getBoundingInfo)){const c=Y.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*c,this.upperRadiusTransitionRange=.05*c}})):this._onMeshTargetChangedObserver&&c.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Y){this._attachedCamera=Y,this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Y){return!!this._attachedCamera&&(this._attachedCamera.radius===Y&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Y){if(!this._attachedCamera)return;this._radiusBounceTransition||(y.EasingFunction.setEasingMode(y.EasingMode),this._radiusBounceTransition=P.d.CreateAnimation("radius",P.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const c=P.d.TransitionTo("radius",this._attachedCamera.radius+Y,this._attachedCamera,this._attachedCamera.ZY(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));c&&this._animatables.push(c)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}y.EasingFunction=new p.d(.3),y.EasingMode=p.r.EASINGMODE_EASEOUT;class d{constructor(){this.onTargetFramingAnimationEndObservable=new N.c,this._mode=d.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Y){this._mode=Y}get mode(){return this._mode}set radiusScale(Y){this._radiusScale=Y}get radiusScale(){return this._radiusScale}set positionScale(Y){this._positionScale=Y}get positionScale(){return this._positionScale}set defaultElevation(Y){this._defaultElevation=Y}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Y){this._elevationReturnTime=Y}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Y){this._elevationReturnWaitTime=Y}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Y){this._zoomStopsAnimation=Y}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Y){this._framingTime=Y}get framingTime(){return this._framingTime}init(){}attach(Y){this._attachedCamera=Y;const c=this._attachedCamera.ZY();d.EasingFunction.setEasingMode(d.EasingMode),this._onPrePointerObservableObserver=c.onPrePointerObservable.add((Y=>{Y.type!==W.c.POINTERDOWN?Y.type===W.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Y.onMeshTargetChangedObservable.add((Y=>{Y&&Y.getBoundingInfo&&this.zoomOnMesh(Y,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Y.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Y=this._attachedCamera.ZY();this._onPrePointerObservableObserver&&Y.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.Kc(!0);const C=Y.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(C.minimumWorld,C.maximumWorld,c,h)}zoomOnMeshHierarchy(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y.Kc(!0);const C=Y.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(C.min,C.max,c,h)}zoomOnMeshesHierarchy(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new Q.bh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new Q.bh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let N=0;N<Y.length;N++){const c=Y[N].getHierarchyBoundingVectors(!0);Q.bh.CheckExtends(c.min,C,E),Q.bh.CheckExtends(c.max,C,E)}this.zoomOnBoundingInfo(C,E,c,h)}zoomOnBoundingInfo(Y,c){let h,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const N=Y.y,b=N+(c.y-N)*this._positionScale,H=c.Hh(Y).scale(.5);if(!isFinite(b))return!1;if(C)h=new Q.bh(0,b,0);else{const c=Y.add(H);h=new Q.bh(c.x,b,c.z)}this._vectorTransition||(this._vectorTransition=P.d.CreateAnimation("target",P.d.ANIMATIONTYPE_VECTOR3,60,d.EasingFunction)),this._betaIsAnimating=!0;let w=P.d.TransitionTo("target",h,this._attachedCamera,this._attachedCamera.ZY(),60,this._vectorTransition,this._framingTime);w&&this._animatables.push(w);let W=0;if(this._mode===d.FitFrustumSidesMode){const h=this._calculateLowerRadiusFromModelBoundingSphere(Y,c);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=H.length()+this._attachedCamera.ac),W=h}else this._mode===d.IgnoreBoundsSizeMode&&(W=this._calculateLowerRadiusFromModelBoundingSphere(Y,c),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ac));if(this.autoCorrectCameraLimitsAndSensibility){const h=c.Hh(Y).length();this._attachedCamera.panningSensibility=5e3/h,this._attachedCamera.wheelPrecision=100/W}return this._radiusTransition||(this._radiusTransition=P.d.CreateAnimation("radius",P.d.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),w=P.d.TransitionTo("radius",W,this._attachedCamera,this._attachedCamera.ZY(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),w&&this._animatables.push(w),!0}_calculateLowerRadiusFromModelBoundingSphere(Y,c){const h=this._attachedCamera;if(!h)return 0;let C=h._calculateLowerRadiusFromModelBoundingSphere(Y,c,this._radiusScale);return h.lowerRadiusLimit&&this._mode===d.IgnoreBoundsSizeMode&&(C=C<h.lowerRadiusLimit?h.lowerRadiusLimit:C),h.upperRadiusLimit&&(C=C>h.upperRadiusLimit?h.upperRadiusLimit:C),C}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Y=q.d.Now-this._lastInteractionTime,c=.5*Math.PI-this._defaultElevation,h=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>h&&Y>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=P.d.CreateAnimation("beta",P.d.ANIMATIONTYPE_FLOAT,60,d.EasingFunction));const Y=P.d.TransitionTo("beta",c,this._attachedCamera,this._attachedCamera.ZY(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Y&&this._animatables.push(Y)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=q.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}d.EasingFunction=new p.x,d.EasingMode=p.r.EASINGMODE_EASEINOUT,d.IgnoreBoundsSizeMode=0,d.FitFrustumSidesMode=1;var D=h(13329),T=h(13354),e=h(14378),r=h(12687);class X{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),h=c.getInputElement();let C=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=N=>{var Q,b;const H=N.event,w="touch"===H.pointerType;if(N.type!==W.c.POINTERMOVE&&-1===this.buttons.indexOf(H.button))return;const q=H.target;if(this._altKey=H.altKey,this._ctrlKey=H.ctrlKey,this._metaKey=H.metaKey,this._shiftKey=H.shiftKey,this._buttonsPressed=H.buttons,c.isPointerLock){const Y=H.movementX,c=H.movementY;this.onTouch(null,Y,c),this._pointA=null,this._pointB=null}else{if(N.type!==W.c.POINTERDOWN&&N.type!==W.c.POINTERDOUBLETAP&&w&&(null===(Q=this._pointA)||void 0===Q?void 0:Q.pointerId)!==H.pointerId&&(null===(b=this._pointB)||void 0===b?void 0:b.pointerId)!==H.pointerId)return;if(N.type!==W.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!w)if(N.type===W.c.POINTERDOUBLETAP)this.onDoubleTap(H.pointerType);else if(N.type!==W.c.POINTERUP||this._currentMousePointerIdDown!==H.pointerId&&!w){if(N.type===W.c.POINTERMOVE)if(Y||H.preventDefault(),this._pointA&&null===this._pointB){const Y=H.clientX-this._pointA.x,c=H.clientY-this._pointA.y;this._pointA.x=H.clientX,this._pointA.y=H.clientY,this.onTouch(this._pointA,Y,c)}else if(this._pointA&&this._pointB){const Y=this._pointA.pointerId===H.pointerId?this._pointA:this._pointB;Y.x=H.clientX,Y.y=H.clientY;const c=this._pointA.x-this._pointB.x,h=this._pointA.y-this._pointB.y,Q=c*c+h*h,b={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:H.pointerId,type:N.type};this.onMultiTouch(this._pointA,this._pointB,C,Q,E,b),E=b,C=Q}}else{try{null===q||void 0===q||q.releasePointerCapture(H.pointerId)}catch(k){}w||(this._pointB=null),c._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==H.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==H.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==C||E)&&(this.onMultiTouch(this._pointA,this._pointB,C,0,E,null),C=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(H),Y||H.preventDefault()}else{try{null===q||void 0===q||q.setPointerCapture(H.pointerId)}catch(k){}if(null===this._pointA)this._pointA={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType};else{if(null!==this._pointB)return;this._pointB={x:H.clientX,y:H.clientY,pointerId:H.pointerId,type:H.pointerType}}-1!==this._currentMousePointerIdDown||w||(this._currentMousePointerIdDown=H.pointerId),this.onButtonDown(H),Y||(H.preventDefault(),h&&h.focus())}}},this._observer=this.camera.ZY()._inputManager._addCameraPointerObserver(this._pointerInput,W.c.POINTERDOWN|W.c.POINTERUP|W.c.POINTERMOVE|W.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,C=0,E=null,this.onLostFocus()},this._contextMenuBind=Y=>this.onContextMenu(Y),h&&h.addEventListener("contextmenu",this._contextMenuBind,!1);const N=this.camera.ZY().getEngine().getHostWindow();N&&r.Tools.RegisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}DM(){if(this._onLostFocus){const Y=this.camera.ZY().getEngine().getHostWindow();Y&&r.Tools.UnregisterTopRootEvents(Y,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.ZY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Y=this.camera.ZY().getEngine().getInputElement();Y&&Y.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Y){}onTouch(Y,c,h){}onMultiTouch(Y,c,h,C,E,N){}onContextMenu(Y){Y.preventDefault()}onButtonDown(Y){}onButtonUp(Y){}onLostFocus(){}}(0,C.b)([(0,E.N)()],X.prototype,"buttons",void 0);class Z extends X{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Y,c){if(0!==this.panningSensibility&&Y&&c){const h=c.x-Y.x,C=c.y-Y.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility}}_computePinchZoom(Y,c){const h=this.camera.radius||Z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=h*Math.sqrt(Y)/Math.sqrt(c):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(c-Y)*h*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(c-Y)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Y,c,h){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-c/this.panningSensibility,this.camera.inertialPanningY+=h/this.panningSensibility):(this.camera.inertialAlphaOffset-=c/this.angularSensibilityX,this.camera.inertialBetaOffset-=h/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Y,c,h,C,E,N){0===h&&null===E||0===C&&null===N||(this.multiTouchPanAndZoom?(this._computePinchZoom(h,C),this._computeMultiTouchPanning(E,N)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(C)-Math.sqrt(h))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(h,C),this._isPinching=!0):this._computeMultiTouchPanning(E,N)):this.multiTouchPanning?this._computeMultiTouchPanning(E,N):this.pinchZoom&&this._computePinchZoom(h,C))}onButtonDown(Y){this._isPanClick=Y.button===this.camera._panningMouseButton}onButtonUp(Y){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Z.MinimumRadiusForPinch=.001,(0,C.b)([(0,E.N)()],Z.prototype,"buttons",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"angularSensibilityX",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"angularSensibilityY",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"pinchPrecision",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"pinchDeltaPercentage",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"useNaturalPinchZoom",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"pinchZoom",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"panningSensibility",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"multiTouchPanning",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"multiTouchPanAndZoom",void 0),e.c.ArcRotateCameraPointersInput=Z;var a=h(13152);class G{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ZY(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const h=c.event;if(!h.metaKey)if(c.type===a.c.KEYDOWN){if(this._ctrlPressed=h.ctrlKey,this._altPressed=h.altKey,-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),h.preventDefault&&(Y||h.preventDefault())}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysReset.indexOf(h.keyCode)){const c=this._keys.indexOf(h.keyCode);c>=0&&this._keys.splice(c,1),h.preventDefault&&(Y||h.preventDefault())}})))}DM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Y=this.camera;for(let c=0;c<this._keys.length;c++){const h=this._keys[c];-1!==this.keysLeft.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningX-=1/this.panningSensibility:Y.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Y.inertialRadiusOffset+=1/this.zoomingSensibility:Y.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningX+=1/this.panningSensibility:Y.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(h)?this._ctrlPressed&&this.camera._useCtrlForPanning?Y.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Y.inertialRadiusOffset-=1/this.zoomingSensibility:Y.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(h)&&Y.useInputToRestoreState&&Y.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,C.b)([(0,E.N)()],G.prototype,"keysUp",void 0),(0,C.b)([(0,E.N)()],G.prototype,"keysDown",void 0),(0,C.b)([(0,E.N)()],G.prototype,"keysLeft",void 0),(0,C.b)([(0,E.N)()],G.prototype,"keysRight",void 0),(0,C.b)([(0,E.N)()],G.prototype,"keysReset",void 0),(0,C.b)([(0,E.N)()],G.prototype,"panningSensibility",void 0),(0,C.b)([(0,E.N)()],G.prototype,"zoomingSensibility",void 0),(0,C.b)([(0,E.N)()],G.prototype,"useAltToZoom",void 0),(0,C.b)([(0,E.N)()],G.prototype,"angularSpeed",void 0),e.c.ArcRotateCameraKeyboardMoveInput=G;var K=h(12926),I=h(13159);class s{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Q.bh(0,0,0),this._globalOffset=new Q.bh(0,0,0),this._inertialPanning=Q.bh.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Y,c){let h=0;const C=.01*Y*this.wheelDeltaPercentage*c;return h=Y>0?C/(1+this.wheelDeltaPercentage):C*(1+this.wheelDeltaPercentage),h}attachControl(Y){Y=r.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==W.c.POINTERWHEEL)return;const h=c.event;let C=0;const E=h.deltaMode===I.e.DOM_DELTA_LINE?40:1,N=-h.deltaY*E;if(this.customComputeDeltaFromMouseWheel)C=this.customComputeDeltaFromMouseWheel(N,this,h);else if(this.wheelDeltaPercentage){if(C=this._computeDeltaFromMouseWheelLegacyEvent(N,this.camera.radius),C>0){let Y=this.camera.radius,c=this.camera.inertialRadiusOffset+C;for(let h=0;h<20&&!(Y<=c)&&!(Math.abs(c*this.camera.inertia)<.001);h++)Y-=c,c*=this.camera.inertia;Y=(0,b.Clamp)(Y,0,Number.MAX_VALUE),C=this._computeDeltaFromMouseWheelLegacyEvent(N,Y)}}else C=N/(40*this.wheelPrecision);C&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(C)):this.camera.inertialRadiusOffset+=C),h.preventDefault&&(Y||h.preventDefault())},this._observer=this.camera.ZY()._inputManager._addCameraPointerObserver(this._wheel,W.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.nc(0)}DM(){this._observer&&(this.camera.ZY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Y=this.camera;0+Y.inertialAlphaOffset+Y.inertialBetaOffset+Y.inertialRadiusOffset&&(this._updateHitPlane(),Y.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Y.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Y=this.camera,c=Y.target.Hh(Y.position);this._hitPlane=K.c.FromPositionAndNormal(Y.target,c)}_getPosition(){const Y=this.camera,c=Y.ZY(),h=c.createPickingRay(c.pointerX,c.pointerY,Q.Matrix.Identity(),Y,!1);0===Y.targetScreenOffset.x&&0===Y.targetScreenOffset.y||(this._viewOffset.set(Y.targetScreenOffset.x,Y.targetScreenOffset.y,0),Y.getViewMatrix().invertToRef(Y._cameraTransformMatrix),this._globalOffset=Q.bh.TransformNormal(this._viewOffset,Y._cameraTransformMatrix),h.origin.addInPlace(this._globalOffset));let C=0;return this._hitPlane&&(C=h.intersectsPlane(this._hitPlane)??0),h.origin.addInPlace(h.direction.scaleInPlace(C))}_zoomToMouse(Y){const c=this.camera,h=1-c.inertia;if(c.lowerRadiusLimit){const C=c.lowerRadiusLimit??0;c.radius-(c.inertialRadiusOffset+Y)/h<C&&(Y=(c.radius-C)*h-c.inertialRadiusOffset)}if(c.upperRadiusLimit){const C=c.upperRadiusLimit??0;c.radius-(c.inertialRadiusOffset+Y)/h>C&&(Y=(c.radius-C)*h-c.inertialRadiusOffset)}const C=Y/h/c.radius,E=this._getPosition(),N=Q.TmpVectors.bh[6];E.subtractToRef(c.target,N),N.scaleInPlace(C),N.scaleInPlace(h),this._inertialPanning.addInPlace(N),c.inertialRadiusOffset+=Y}_zeroIfClose(Y){Math.abs(Y.x)<k.d&&(Y.x=0),Math.abs(Y.y)<k.d&&(Y.y=0),Math.abs(Y.z)<k.d&&(Y.z=0)}}(0,C.b)([(0,E.N)()],s.prototype,"wheelPrecision",void 0),(0,C.b)([(0,E.N)()],s.prototype,"zoomToMouseLocation",void 0),(0,C.b)([(0,E.N)()],s.prototype,"wheelDeltaPercentage",void 0),e.c.ArcRotateCameraMouseWheelInput=s;class x extends e.e{constructor(Y){super(Y)}addMouseWheel(){return this.add(new s),this}addPointers(){return this.add(new Z),this}addKeyboard(){return this.add(new G),this}}var A=h(12825);function V(Y,c){return isNaN(Y)?c:Y}H.c.AddNodeConstructor("ArcRotateCamera",((Y,c)=>()=>new U(Y,0,0,1,Q.bh.Zero(),c)));class U extends T.d{get target(){return this._target}set target(Y){this.setTarget(Y)}get targetHost(){return this._targetHost}set targetHost(Y){Y&&this.setTarget(Y)}getTarget(){return this.target}get position(){return this._position}set position(Y){this.setPosition(Y)}set upVector(Y){this._upToYMatrix||(this._yToUpMatrix=new Q.Matrix,this._upToYMatrix=new Q.Matrix,this._upVector=Q.bh.Zero()),Y.normalize(),this._upVector.N(Y),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Q.Matrix.RotationAlignToRef(Q.bh.UpReadOnly,this._upVector,this._yToUpMatrix),Q.Matrix.RotationAlignToRef(this._upVector,Q.bh.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Y=this.inputs.attached.pointers;return Y?Y.angularSensibilityX:0}set angularSensibilityX(Y){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityX=Y)}get angularSensibilityY(){const Y=this.inputs.attached.pointers;return Y?Y.angularSensibilityY:0}set angularSensibilityY(Y){const c=this.inputs.attached.pointers;c&&(c.angularSensibilityY=Y)}get pinchPrecision(){const Y=this.inputs.attached.pointers;return Y?Y.pinchPrecision:0}set pinchPrecision(Y){const c=this.inputs.attached.pointers;c&&(c.pinchPrecision=Y)}get pinchDeltaPercentage(){const Y=this.inputs.attached.pointers;return Y?Y.pinchDeltaPercentage:0}set pinchDeltaPercentage(Y){const c=this.inputs.attached.pointers;c&&(c.pinchDeltaPercentage=Y)}get useNaturalPinchZoom(){const Y=this.inputs.attached.pointers;return!!Y&&Y.useNaturalPinchZoom}set useNaturalPinchZoom(Y){const c=this.inputs.attached.pointers;c&&(c.useNaturalPinchZoom=Y)}get panningSensibility(){const Y=this.inputs.attached.pointers;return Y?Y.panningSensibility:0}set panningSensibility(Y){const c=this.inputs.attached.pointers;c&&(c.panningSensibility=Y)}get keysUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUp:[]}set keysUp(Y){const c=this.inputs.attached.keyboard;c&&(c.keysUp=Y)}get keysDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDown:[]}set keysDown(Y){const c=this.inputs.attached.keyboard;c&&(c.keysDown=Y)}get keysLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysLeft:[]}set keysLeft(Y){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=Y)}get keysRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRight:[]}set keysRight(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRight=Y)}get wheelPrecision(){const Y=this.inputs.attached.mousewheel;return Y?Y.wheelPrecision:0}set wheelPrecision(Y){const c=this.inputs.attached.mousewheel;c&&(c.wheelPrecision=Y)}get zoomToMouseLocation(){const Y=this.inputs.attached.mousewheel;return!!Y&&Y.zoomToMouseLocation}set zoomToMouseLocation(Y){const c=this.inputs.attached.mousewheel;c&&(c.zoomToMouseLocation=Y)}get wheelDeltaPercentage(){const Y=this.inputs.attached.mousewheel;return Y?Y.wheelDeltaPercentage:0}set wheelDeltaPercentage(Y){const c=this.inputs.attached.mousewheel;c&&(c.wheelDeltaPercentage=Y)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Y){Y!==this.useBouncingBehavior&&(Y?(this._bouncingBehavior=new y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Y){Y!==this.useFramingBehavior&&(Y?(this._framingBehavior=new d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Y){Y!==this.useAutoRotationBehavior&&(Y?(this._autoRotationBehavior=new M,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Y,c,h,C,E,b){var H;let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Y,Q.bh.Zero(),b,w),H=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Q.bh.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Q.Matrix,this.panningAxis=new Q.bh(1,1,0),this._transformedDirection=new Q.bh,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new N.c,this.checkCollisions=!1,this.collisionRadius=new Q.bh(.5,.5,.5),this._previousPosition=Q.bh.Zero(),this._collisionVelocity=Q.bh.Zero(),this._newPosition=Q.bh.Zero(),this._computationVector=Q.bh.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Q.bh(NaN,NaN,NaN),this._goalTargetScreenOffset=new Q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h?(H.setPosition(c),H.CP&&H.CP(h)):H._previousPosition.N(H._position);const C=Math.cos(H.alpha),E=Math.sin(H.alpha),N=Math.cos(H.beta);let Q=Math.sin(H.beta);0===Q&&(Q=1e-4);const b=H._getTargetPosition();H._computationVector.Vc(H.radius*C*Q,H.radius*N,H.radius*E*Q),b.addToRef(H._computationVector,H._newPosition),H._position.N(H._newPosition);let w=H.upVector;H.allowUpsideDown&&H.beta<0&&(w=w.clone(),w=w.negate()),H._computeViewMatrix(H._position,b,w),H._viewMatrix.addAtIndex(12,H.targetScreenOffset.x),H._viewMatrix.addAtIndex(13,H.targetScreenOffset.y),H._collisionTriggered=!1},this._target=Q.bh.Zero(),E&&this.setTarget(E),this.alpha=c,this.beta=h,this.radius=C,this.getViewMatrix(),this.inputs=new x(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Q.bh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Q.Vector2.Zero()}_updateCache(Y){Y||super._updateCache(),this._cache._target.N(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.N(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Y=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Y.addToRef(this._targetBoundingCenter,this._target):this._target.N(Y)}const Y=this._getLockedTargetPosition();return Y||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>k.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,N=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=N?this._currentInterpolationFactor=N:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=V(Y,this._goalAlpha),this._goalBeta=V(c,this._goalBeta),this._goalRadius=V(h,this._goalRadius),this._goalTarget.set(V(C.x,this._goalTarget.x),V(C.y,this._goalTarget.y),V(C.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(V(E.x,this._goalTargetScreenOffset.x),V(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,b.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,b.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,b.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,b.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Y,c){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;c=r.Tools.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=h,this._panningMouseButton=C,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(c),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}DM(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Y=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Y=!0;const c=this.invertRotation?-1:1,h=this._calculateHandednessMultiplier();let C=this.inertialAlphaOffset*h;this.beta<0&&(C*=-1),this.alpha+=C*c,this.beta+=this.inertialBetaOffset*c,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<k.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<k.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*k.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Y=!0;const c=new Q.bh(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),c.multiplyInPlace(this.panningAxis),Q.bh.TransformNormalToRef(c,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Y=this.upVector,c=Q.bh.CrossToRef(this._transformedDirection,Y,this._transformedDirection);Q.bh.CrossToRef(Y,c,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Q.bh.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.N(this._transformedDirection)}else{if(this.parent){const Y=Q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Y),Y.transposeToRef(Y),Q.bh.TransformCoordinatesToRef(this._transformedDirection,Y,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*k.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*k.d&&(this.inertialPanningY=0)}if(Y)this.stopInterpolation();else if(this._isInterpolating){let Y=!1;const c=this._scene.getEngine().getDeltaTime()/1e3,h=1-Math.pow(2,-c/this._currentInterpolationFactor),C=V(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const c=Q.TmpVectors.bh[0].set(V(this._goalTarget.x,this._target.x),V(this._goalTarget.y,this._target.y),V(this._goalTarget.z,this._target.z));Q.bh.LerpToRef(this.target,c,h,this._target),10*Q.bh.Distance(this.target,c)/C<k.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.N(c),this.setTarget(this.target,!1,!0,!0)):Y=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const c=Q.Quaternion.RotationAlphaBetaGammaToRef(V(this._goalAlpha,this.alpha),V(this._goalBeta,this.beta),0,Q.TmpVectors.Quaternion[0]),C=Q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Q.TmpVectors.Quaternion[1]),E=Q.Quaternion.SlerpToRef(C,c,h,Q.TmpVectors.Quaternion[2]);E.normalize();const N=E.toAlphaBetaGammaToRef(Q.TmpVectors.bh[0]);if(this.alpha=N.x,this.beta=N.y,E.isApprox(c,k.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Y=c.toAlphaBetaGammaToRef(Q.TmpVectors.bh[0]);this.alpha=Y.x,this.beta=Y.y}else Y=!0}if(isNaN(this._goalRadius)||(this.radius+=(C-this.radius)*h,Math.abs(C/this.radius-1)<k.d?(this._goalRadius=NaN,this.radius=C):Y=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const c=Q.TmpVectors.Vector2[0].set(V(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),V(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Q.Vector2.LerpToRef(this.targetScreenOffset,c,h,this.targetScreenOffset),Q.Vector2.Distance(this.targetScreenOffset,c)<k.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.N(c)):Y=!0}this._isInterpolating=Y}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.bh.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Y=this.alpha;var c,h;this.alpha=function(Y){let c=Math.PI/2;return 0===Y.x&&0===Y.z||(c=Math.acos(Y.x/Math.sqrt(Math.pow(Y.x,2)+Math.pow(Y.z,2)))),Y.z<0&&(c=2*Math.PI-c),c}(this._computationVector),this.beta=(c=this._computationVector.y,h=this.radius,Math.acos(c/h));const C=Math.round((Y-this.alpha)/(2*Math.PI));this.alpha+=2*C*Math.PI,this._checkLimits()}setPosition(Y){this._position.equals(Y)||(this._position.N(Y),this.rebuildAnglesAndRadius())}setTarget(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(C=this.overrideCloneAlphaBetaRadius??C,Y.Kc)c&&Y.getBoundingInfo?this._targetBoundingCenter=Y.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Y.Kc(),this._targetHost=Y,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const c=Y,C=this._getTargetPosition();if(C&&!h&&C.equals(c))return;this._targetHost=null,this._target=c,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}C||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Y=Math.cos(this.alpha),c=Math.sin(this.alpha),h=Math.cos(this.beta);let C=Math.sin(this.beta);0===C&&(C=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.Vc(this.radius*Y*C,this.radius*h,this.radius*c*C),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Q.bh.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.ZY().collisionsEnabled&&this.checkCollisions){const Y=this.ZY().collisionCoordinator;this._collider||(this._collider=Y.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Y.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.N(this._newPosition);let Y=this.upVector;this.allowUpsideDown&&C<0&&(Y=Y.negate()),this._computeViewMatrix(this._position,E,Y),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.N(E),this._viewMatrix}zoomOn(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Y=Y||this.ZY().meshes;const h=w.e.MinMax(Y);let C=this._calculateLowerRadiusFromModelBoundingSphere(h.min,h.max);if(C=Math.max(Math.min(C,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=C*this.zoomOnFactor,this.mode===D.b.ORTHOGRAPHIC_CAMERA){const Y=this.ZY().getEngine().getAspectRatio(this),c=C*this.zoomOnFactor/2;this.orthoLeft=-c*Y,this.orthoRight=c*Y,this.orthoBottom=-c,this.orthoTop=c}this.focusOn({min:h.min,max:h.max,distance:C},c)}focusOn(Y){let c,h,C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Y.min){const C=Y||this.ZY().meshes;c=w.e.MinMax(C),h=Q.bh.Distance(c.min,c.max)}else{c=Y,h=Y.distance}this._target=w.e.Center(c),C||(this.maxZ=2*h)}createRigCamera(Y,c){let h=0;switch(this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:h=this._cameraRigParams.stereoHalfAngle*(0===c?1:-1);break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:h=this._cameraRigParams.stereoHalfAngle*(0===c?-1:1)}const C=new U(Y,this.alpha+h,this.beta,this.radius,this._target,this.ZY());return C._cameraRigParams={},C.isRigCamera=!0,C.rigParent=this,C.upVector=this.upVector,C.mode=this.mode,C.orthoLeft=this.orthoLeft,C.orthoRight=this.orthoRight,C.orthoBottom=this.orthoBottom,C.orthoTop=this.orthoTop,C}_updateRigCameras(){const Y=this._rigCameras[0],c=this._rigCameras[1];switch(Y.beta=c.beta=this.beta,this.cameraRigMode){case D.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.b.RIG_MODE_VR:Y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case D.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const C=Q.bh.Distance(Y,c),E=this.ZY().getEngine().getAspectRatio(this),N=Math.tan(this.fov/2),b=N*E,H=.5*C*h,w=H*Math.sqrt(1+1/(b*b)),W=H*Math.sqrt(1+1/(N*N));return Math.max(w,W)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,C.b)([(0,E.N)()],U.prototype,"alpha",void 0),(0,C.b)([(0,E.N)()],U.prototype,"beta",void 0),(0,C.b)([(0,E.N)()],U.prototype,"radius",void 0),(0,C.b)([(0,E.N)()],U.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,C.b)([(0,E.M)("target")],U.prototype,"_target",void 0),(0,C.b)([(0,E.A)("targetHost")],U.prototype,"_targetHost",void 0),(0,C.b)([(0,E.N)()],U.prototype,"inertialAlphaOffset",void 0),(0,C.b)([(0,E.N)()],U.prototype,"inertialBetaOffset",void 0),(0,C.b)([(0,E.N)()],U.prototype,"inertialRadiusOffset",void 0),(0,C.b)([(0,E.N)()],U.prototype,"lowerAlphaLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"upperAlphaLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"lowerBetaLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"upperBetaLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"lowerRadiusLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"upperRadiusLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"lowerTargetYLimit",void 0),(0,C.b)([(0,E.N)()],U.prototype,"inertialPanningX",void 0),(0,C.b)([(0,E.N)()],U.prototype,"inertialPanningY",void 0),(0,C.b)([(0,E.N)()],U.prototype,"pinchToPanMaxDistance",void 0),(0,C.b)([(0,E.N)()],U.prototype,"panningDistanceLimit",void 0),(0,C.b)([(0,E.M)()],U.prototype,"panningOriginTarget",void 0),(0,C.b)([(0,E.N)()],U.prototype,"panningInertia",void 0),(0,C.b)([(0,E.N)()],U.prototype,"zoomToMouseLocation",null),(0,C.b)([(0,E.N)()],U.prototype,"zoomOnFactor",void 0),(0,C.b)([(0,E.J)()],U.prototype,"targetScreenOffset",void 0),(0,C.b)([(0,E.N)()],U.prototype,"allowUpsideDown",void 0),(0,C.b)([(0,E.N)()],U.prototype,"useInputToRestoreState",void 0),(0,C.b)([(0,E.N)()],U.prototype,"restoreStateInterpolationFactor",void 0),(0,A.e)("BABYLON.ArcRotateCamera",U)},14378:(Y,c,h)=>{"use strict";h.d(c,{c:()=>Q,e:()=>b});var C=h(12700),E=h(12906),N=h(13329),Q={};class b{constructor(Y){this.attachedToElement=!1,this.attached={},this.camera=Y,this.checkInputs=()=>{}}add(Y){const c=Y.getSimpleName();this.attached[c]?C.e.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=Y,Y.camera=this.camera,Y.checkInputs&&(this.checkInputs=this._addCheckInputs(Y.checkInputs.bind(Y))),this.attachedToElement&&Y.attachControl(this.noPreventDefault))}remove(Y){for(const c in this.attached){const h=this.attached[c];if(h===Y)return h.DM(),h.camera=null,delete this.attached[c],void this.rebuildInputCheck()}}removeByType(Y){for(const c in this.attached){const h=this.attached[c];h.getClassName()===Y&&(h.DM(),h.camera=null,delete this.attached[c],this.rebuildInputCheck())}}_addCheckInputs(Y){const c=this.checkInputs;return()=>{c(),Y()}}attachInput(Y){this.attachedToElement&&Y.attachControl(this.noPreventDefault)}attachElement(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Y=!N.b.ForceAttachControlToAlwaysPreventDefault&&Y,this.attachedToElement=!0,this.noPreventDefault=Y;for(const c in this.attached)this.attached[c].attachControl(Y)}}detachElement(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const c in this.attached)this.attached[c].DM(),Y&&(this.attached[c].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Y in this.attached){const c=this.attached[Y];c.checkInputs&&(this.checkInputs=this._addCheckInputs(c.checkInputs.bind(c)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Y){const c={};for(const h in this.attached){const Y=this.attached[h],C=E.d.Serialize(Y);c[Y.getClassName()]=C}Y.inputsmgr=c}parse(Y){const c=Y.inputsmgr;if(c){this.clear();for(const Y in c){const h=Q[Y];if(h){const C=c[Y],N=E.d.Parse((()=>new h),C,null);this.add(N)}}}else for(const h in this.attached){const c=Q[this.attached[h].getClassName()];if(c){const C=E.d.Parse((()=>new c),Y,null);this.remove(this.attached[h]),this.add(C)}}}}},14369:(Y,c,h)=>{"use strict";h.d(c,{b:()=>X});var C=h(12853),E=h(12859),N=h(12869),Q=h(13354),b=h(14378),H=h(13152),w=h(12687);class W{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Y){Y=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.ZY(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((c=>{const h=c.event;if(!h.metaKey)if(c.type===H.c.KEYDOWN){if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){-1===this._keys.indexOf(h.keyCode)&&this._keys.push(h.keyCode),Y||h.preventDefault()}}else if(-1!==this.keysUp.indexOf(h.keyCode)||-1!==this.keysDown.indexOf(h.keyCode)||-1!==this.keysLeft.indexOf(h.keyCode)||-1!==this.keysRight.indexOf(h.keyCode)||-1!==this.keysUpward.indexOf(h.keyCode)||-1!==this.keysDownward.indexOf(h.keyCode)||-1!==this.keysRotateLeft.indexOf(h.keyCode)||-1!==this.keysRotateRight.indexOf(h.keyCode)||-1!==this.keysRotateUp.indexOf(h.keyCode)||-1!==this.keysRotateDown.indexOf(h.keyCode)){const c=this._keys.indexOf(h.keyCode);c>=0&&this._keys.splice(c,1),Y||h.preventDefault()}})))}DM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Y=this.camera;for(let c=0;c<this._keys.length;c++){const h=this._keys[c],C=Y._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(h)?Y._localDirection.Vc(-C,0,0):-1!==this.keysUp.indexOf(h)?Y._localDirection.Vc(0,0,C):-1!==this.keysRight.indexOf(h)?Y._localDirection.Vc(C,0,0):-1!==this.keysDown.indexOf(h)?Y._localDirection.Vc(0,0,-C):-1!==this.keysUpward.indexOf(h)?Y._localDirection.Vc(0,C,0):-1!==this.keysDownward.indexOf(h)?Y._localDirection.Vc(0,-C,0):-1!==this.keysRotateLeft.indexOf(h)?(Y._localDirection.Vc(0,0,0),Y.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(h)?(Y._localDirection.Vc(0,0,0),Y.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(h)?(Y._localDirection.Vc(0,0,0),Y.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(h)&&(Y._localDirection.Vc(0,0,0),Y.cameraRotation.x+=this._getLocalRotation()),Y.ZY().useRightHandedSystem&&(Y._localDirection.z*=-1),Y.getViewMatrix().invertToRef(Y._cameraTransformMatrix),N.bh.TransformNormalToRef(Y._localDirection,Y._cameraTransformMatrix,Y._transformedDirection),Y.cameraDirection.addInPlace(Y._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Y=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Y}}(0,C.b)([(0,E.N)()],W.prototype,"keysUp",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysUpward",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysDown",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysDownward",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysLeft",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysRight",void 0),(0,C.b)([(0,E.N)()],W.prototype,"rotationSpeed",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysRotateLeft",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysRotateRight",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysRotateUp",void 0),(0,C.b)([(0,E.N)()],W.prototype,"keysRotateDown",void 0),b.c.FreeCameraKeyboardMoveInput=W;var q=h(12690),k=h(13149);class M{constructor(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Y,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new q.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Y){Y=w.Tools.BackCompatCameraNoPreventDefault(arguments);const c=this.camera.getEngine(),h=c.getInputElement();this._pointerInput||(this._pointerInput=C=>{const E=C.event,N="touch"===E.pointerType;if(!this.touchEnabled&&N)return;if(C.type!==k.c.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const Q=E.target;if(C.type===k.c.POINTERDOWN){if(N&&-1!==this._activePointerId||!N&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===Q||void 0===Q||Q.setPointerCapture(E.pointerId)}catch(b){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},Y||(E.preventDefault(),h&&h.focus()),c.isPointerLock&&this._onMouseMove&&this._onMouseMove(C.event)}else if(C.type===k.c.POINTERUP){if(N&&this._activePointerId!==E.pointerId||!N&&this._currentActiveButton!==E.button)return;try{null===Q||void 0===Q||Q.releasePointerCapture(E.pointerId)}catch(b){}this._currentActiveButton=-1,this._previousPosition=null,Y||E.preventDefault(),this._activePointerId=-1}else if(C.type===k.c.POINTERMOVE&&(this._activePointerId===E.pointerId||!N))if(c.isPointerLock&&this._onMouseMove)this._onMouseMove(C.event);else if(this._previousPosition){const c=this.camera._calculateHandednessMultiplier(),h=(E.clientX-this._previousPosition.x)*c,C=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=h/this.angularSensibility,this.camera.cameraRotation.x+=C/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:h,offsetY:C}),this._previousPosition={x:E.clientX,y:E.clientY},Y||E.preventDefault()}}),this._onMouseMove=h=>{if(!c.isPointerLock)return;const C=this.camera._calculateHandednessMultiplier(),E=h.movementX*C;this.camera.cameraRotation.y+=E/this.angularSensibility;const N=h.movementY;this.camera.cameraRotation.x+=N/this.angularSensibility,this._previousPosition=null,Y||h.preventDefault()},this._observer=this.camera.ZY()._inputManager._addCameraPointerObserver(this._pointerInput,k.c.POINTERDOWN|k.c.POINTERUP|k.c.POINTERMOVE),h&&(this._contextMenuBind=Y=>this.onContextMenu(Y),h.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Y){Y.preventDefault()}DM(){if(this._observer){if(this.camera.ZY()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Y=this.camera.getEngine().getInputElement();Y&&Y.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,C.b)([(0,E.N)()],M.prototype,"buttons",void 0),(0,C.b)([(0,E.N)()],M.prototype,"angularSensibility",void 0),b.c.FreeCameraMouseInput=M;var p,P=h(13159);class y{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new q.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Y){Y=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=c=>{if(c.type!==k.c.POINTERWHEEL)return;const h=c.event,C=h.deltaMode===P.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*C*h.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*C*h.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*C*h.deltaZ/this._normalize,h.preventDefault&&(Y||h.preventDefault())},this._observer=this.camera.ZY()._inputManager._addCameraPointerObserver(this._wheel,k.c.POINTERWHEEL)}DM(){this._observer&&(this.camera.ZY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,C.b)([(0,E.N)()],y.prototype,"wheelPrecisionX",void 0),(0,C.b)([(0,E.N)()],y.prototype,"wheelPrecisionY",void 0),(0,C.b)([(0,E.N)()],y.prototype,"wheelPrecisionZ",void 0),function(Y){Y[Y.MoveRelative=0]="MoveRelative",Y[Y.RotateRelative=1]="RotateRelative",Y[Y.MoveScene=2]="MoveScene"}(p||(p={}));class d extends y{constructor(){super(...arguments),this._moveRelative=N.bh.Zero(),this._rotateRelative=N.bh.Zero(),this._moveScene=N.bh.Zero(),this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Y){null===Y&&this._wheelXAction!==p.MoveRelative||(this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=Y)}get wheelXMoveRelative(){return this._wheelXAction!==p.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Y){null===Y&&this._wheelYAction!==p.MoveRelative||(this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=Y)}get wheelYMoveRelative(){return this._wheelYAction!==p.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Y){null===Y&&this._wheelZAction!==p.MoveRelative||(this._wheelZAction=p.MoveRelative,this._wheelZActionCoordinate=Y)}get wheelZMoveRelative(){return this._wheelZAction!==p.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Y){null===Y&&this._wheelXAction!==p.RotateRelative||(this._wheelXAction=p.RotateRelative,this._wheelXActionCoordinate=Y)}get wheelXRotateRelative(){return this._wheelXAction!==p.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Y){null===Y&&this._wheelYAction!==p.RotateRelative||(this._wheelYAction=p.RotateRelative,this._wheelYActionCoordinate=Y)}get wheelYRotateRelative(){return this._wheelYAction!==p.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Y){null===Y&&this._wheelZAction!==p.RotateRelative||(this._wheelZAction=p.RotateRelative,this._wheelZActionCoordinate=Y)}get wheelZRotateRelative(){return this._wheelZAction!==p.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Y){null===Y&&this._wheelXAction!==p.MoveScene||(this._wheelXAction=p.MoveScene,this._wheelXActionCoordinate=Y)}get wheelXMoveScene(){return this._wheelXAction!==p.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Y){null===Y&&this._wheelYAction!==p.MoveScene||(this._wheelYAction=p.MoveScene,this._wheelYActionCoordinate=Y)}get wheelYMoveScene(){return this._wheelYAction!==p.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Y){null===Y&&this._wheelZAction!==p.MoveScene||(this._wheelZAction=p.MoveScene,this._wheelZActionCoordinate=Y)}get wheelZMoveScene(){return this._wheelZAction!==p.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.nc(0),this._rotateRelative.nc(0),this._moveScene.nc(0),this._updateCamera(),this.camera.ZY().useRightHandedSystem&&(this._moveRelative.z*=-1);const Y=N.Matrix.Zero();this.camera.getViewMatrix().invertToRef(Y);const c=N.bh.Zero();N.bh.TransformNormalToRef(this._moveRelative,Y,c),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(c),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Y,c,h){if(0===Y)return;if(null===c||null===h)return;let C=null;switch(c){case p.MoveRelative:C=this._moveRelative;break;case p.RotateRelative:C=this._rotateRelative;break;case p.MoveScene:C=this._moveScene}switch(h){case 0:C.set(Y,0,0);break;case 1:C.set(0,Y,0);break;case 2:C.set(0,0,Y)}}}(0,C.b)([(0,E.N)()],d.prototype,"wheelXMoveRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelYMoveRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelZMoveRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelXRotateRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelYRotateRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelZRotateRelative",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelXMoveScene",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelYMoveScene",null),(0,C.b)([(0,E.N)()],d.prototype,"wheelZMoveScene",null),b.c.FreeCameraMouseWheelInput=d;class D{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Y,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=w.Tools.IsSafari()}attachControl(Y){Y=w.Tools.BackCompatCameraNoPreventDefault(arguments);let c=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=h=>{const C=h.event,E="mouse"===C.pointerType||this._isSafari&&"undefined"===typeof C.pointerType;if(this.allowMouse||!E)if(h.type===k.c.POINTERDOWN){if(Y||C.preventDefault(),this._pointerPressed.push(C.pointerId),1!==this._pointerPressed.length)return;c={x:C.clientX,y:C.clientY}}else if(h.type===k.c.POINTERUP){Y||C.preventDefault();const h=this._pointerPressed.indexOf(C.pointerId);if(-1===h)return;if(this._pointerPressed.splice(h,1),0!=h)return;c=null,this._offsetX=null,this._offsetY=null}else if(h.type===k.c.POINTERMOVE){if(Y||C.preventDefault(),!c)return;if(0!=this._pointerPressed.indexOf(C.pointerId))return;this._offsetX=C.clientX-c.x,this._offsetY=-(C.clientY-c.y)}}),this._observer=this.camera.ZY()._inputManager._addCameraPointerObserver(this._pointerInput,k.c.POINTERDOWN|k.c.POINTERUP|k.c.POINTERMOVE),this._onLostFocus){const Y=this.camera.getEngine().getInputElement();Y&&Y.addEventListener("blur",this._onLostFocus)}}DM(){if(this._pointerInput){if(this._observer&&(this.camera.ZY()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Y=this.camera.getEngine().getInputElement();Y&&Y.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Y=this.camera,c=Y._calculateHandednessMultiplier();Y.cameraRotation.y=c*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Y.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const c=Y._computeLocalCameraSpeed(),h=new N.bh(0,0,0!==this.touchMoveSensibility?c*this._offsetY/this.touchMoveSensibility:0);N.Matrix.RotationYawPitchRollToRef(Y.rotation.y,Y.rotation.x,0,Y._cameraRotationMatrix),Y.cameraDirection.addInPlace(N.bh.TransformCoordinates(h,Y._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,C.b)([(0,E.N)()],D.prototype,"touchAngularSensibility",void 0),(0,C.b)([(0,E.N)()],D.prototype,"touchMoveSensibility",void 0),b.c.FreeCameraTouchInput=D;class T extends b.e{constructor(Y){super(Y),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new W),this}addMouse(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new M(Y),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new d,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new D),this}clear(){super.clear(),this._mouseInput=null}}var e=h(12825),r=h(12761);class X extends Q.d{get angularSensibility(){const Y=this.inputs.attached.mouse;return Y?Y.angularSensibility:0}set angularSensibility(Y){const c=this.inputs.attached.mouse;c&&(c.angularSensibility=Y)}get keysUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUp:[]}set keysUp(Y){const c=this.inputs.attached.keyboard;c&&(c.keysUp=Y)}get keysUpward(){const Y=this.inputs.attached.keyboard;return Y?Y.keysUpward:[]}set keysUpward(Y){const c=this.inputs.attached.keyboard;c&&(c.keysUpward=Y)}get keysDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDown:[]}set keysDown(Y){const c=this.inputs.attached.keyboard;c&&(c.keysDown=Y)}get keysDownward(){const Y=this.inputs.attached.keyboard;return Y?Y.keysDownward:[]}set keysDownward(Y){const c=this.inputs.attached.keyboard;c&&(c.keysDownward=Y)}get keysLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysLeft:[]}set keysLeft(Y){const c=this.inputs.attached.keyboard;c&&(c.keysLeft=Y)}get keysRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRight:[]}set keysRight(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRight=Y)}get keysRotateLeft(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateLeft:[]}set keysRotateLeft(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateLeft=Y)}get keysRotateRight(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateRight:[]}set keysRotateRight(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateRight=Y)}get keysRotateUp(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateUp:[]}set keysRotateUp(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateUp=Y)}get keysRotateDown(){const Y=this.inputs.attached.keyboard;return Y?Y.keysRotateDown:[]}set keysRotateDown(Y){const c=this.inputs.attached.keyboard;c&&(c.keysRotateDown=Y)}constructor(Y,c,h){var C;super(Y,c,h,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),C=this,this.ellipsoid=new N.bh(.5,1,.5),this.ellipsoidOffset=new N.bh(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=N.bh.Zero(),this._diffPosition=N.bh.Zero(),this._newPosition=N.bh.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C._newPosition.N(c),C._newPosition.subtractToRef(C._oldPosition,C._diffPosition),C._diffPosition.length()>r.c.CollisionsEpsilon&&(C.position.addToRef(C._diffPosition,C._deferredPositionUpdate),C._deferOnly?C._deferredUpdated=!0:C.position.N(C._deferredPositionUpdate),C.CP&&h&&C.CP(h))},this.inputs=new T(this),this.inputs.addKeyboard().addMouse()}attachControl(Y,c){c=w.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(c)}DM(){this.inputs.detachElement(),this.cameraDirection=new N.bh(0,0,0),this.cameraRotation=new N.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Y){this._collisionMask=isNaN(Y)?-1:Y}_collideWithWorld(Y){let c;c=this.parent?N.bh.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const h=this.ZY().collisionCoordinator;this._collider||(this._collider=h.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let C=Y;this.applyGravity&&(C=Y.add(this.ZY().gravity)),h.getNewPosition(this._oldPosition,C,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=N.bh.Zero(),this._transformedDirection=N.bh.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Y){this._needMoveForGravity=Y}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.ZY().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Bc"}}(0,C.b)([(0,E.M)()],X.prototype,"ellipsoid",void 0),(0,C.b)([(0,E.M)()],X.prototype,"ellipsoidOffset",void 0),(0,C.b)([(0,E.N)()],X.prototype,"checkCollisions",void 0),(0,C.b)([(0,E.N)()],X.prototype,"applyGravity",void 0),(0,e.e)("BABYLON.FreeCamera",X)},15185:(Y,c,h)=>{"use strict";h.d(c,{d:()=>N});var C=h(12975),E=h(15188);class N{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=h,this.gk=[],this._maxBlockCapacity=c||64,this._selectionContent=new C.e(1024),this._creationFunc=Y}update(Y,c,h){E.b._CreateBlocks(Y,c,h,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}iq(Y){for(let c=0;c<this.Ck.length;c++){this.Ck[c].addEntry(Y)}}uq(Y){for(let c=0;c<this.Ck.length;c++){this.Ck[c].removeEntry(Y)}}select(Y,c){this._selectionContent.reset();for(let h=0;h<this.Ck.length;h++){this.Ck[h].select(Y,this._selectionContent,c)}return c?this._selectionContent.concat(this.gk):this._selectionContent.concatWithNoDuplicate(this.gk),this._selectionContent}intersects(Y,c,h){this._selectionContent.reset();for(let C=0;C<this.Ck.length;C++){this.Ck[C].intersects(Y,c,this._selectionContent,h)}return h?this._selectionContent.concat(this.gk):this._selectionContent.concatWithNoDuplicate(this.gk),this._selectionContent}intersectsRay(Y){this._selectionContent.reset();for(let c=0;c<this.Ck.length;c++){this.Ck[c].intersectsRay(Y,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.gk),this._selectionContent}}N.CreationFuncForMeshes=(Y,c)=>{const h=Y.getBoundingInfo();!Y.isBlocked&&h.boundingBox.intersectsMinMax(c.uk,c.ik)&&c.entries.push(Y)},N.CreationFuncForSubMeshes=(Y,c)=>{Y.getBoundingInfo().boundingBox.intersectsMinMax(c.uk,c.ik)&&c.entries.push(Y)}},15188:(Y,c,h)=>{"use strict";h.d(c,{b:()=>N});var C=h(12869),E=h(13219);class N{constructor(Y,c,h,C,E,N){this.entries=[],this.Rk=new Array,this._capacity=h,this._depth=C,this._maxDepth=E,this._creationFunc=N,this._minPoint=Y,this._maxPoint=c,this.Rk.push(Y.clone()),this.Rk.push(c.clone()),this.Rk.push(Y.clone()),this.Rk[2].x=c.x,this.Rk.push(Y.clone()),this.Rk[3].y=c.y,this.Rk.push(Y.clone()),this.Rk[4].z=c.z,this.Rk.push(c.clone()),this.Rk[5].z=Y.z,this.Rk.push(c.clone()),this.Rk[6].x=Y.x,this.Rk.push(c.clone()),this.Rk[7].y=Y.y}get ZC(){return this._capacity}get uk(){return this._minPoint}get ik(){return this._maxPoint}addEntry(Y){if(this.Ck)for(let c=0;c<this.Ck.length;c++){this.Ck[c].addEntry(Y)}else this._creationFunc(Y,this),this.entries.length>this.ZC&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Y){if(this.Ck){for(let c=0;c<this.Ck.length;c++){this.Ck[c].removeEntry(Y)}return}const c=this.entries.indexOf(Y);c>-1&&this.entries.splice(c,1)}addEntries(Y){for(let c=0;c<Y.length;c++){const h=Y[c];this.addEntry(h)}}select(Y,c,h){if(E.b.IsInFrustum(this.Rk,Y)){if(this.Ck){for(let C=0;C<this.Ck.length;C++){this.Ck[C].select(Y,c,h)}return}h?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}}intersects(Y,c,h,C){if(E.b.IntersectsSphere(this._minPoint,this._maxPoint,Y,c)){if(this.Ck){for(let E=0;E<this.Ck.length;E++){this.Ck[E].intersects(Y,c,h,C)}return}C?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersectsRay(Y,c){if(Y.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Ck){for(let h=0;h<this.Ck.length;h++){this.Ck[h].intersectsRay(Y,c)}return}c.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){N._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Y,c,h,E,Q,b,H,w){H.Ck=new Array;const W=new C.bh((c.x-Y.x)/2,(c.y-Y.y)/2,(c.z-Y.z)/2);for(let C=0;C<2;C++)for(let c=0;c<2;c++)for(let q=0;q<2;q++){const k=Y.add(W.multiplyByFloats(C,c,q)),M=Y.add(W.multiplyByFloats(C+1,c+1,q+1)),p=new N(k,M,E,Q+1,b,w);p.addEntries(h),H.Ck.push(p)}}}},15197:(Y,c,h)=>{"use strict";h.d(c,{d:()=>W});var C=h(13110),E=h(12869),N=h(13303),Q=h(14122),b=h(13142),H=h(15185),w=h(12722);C.e.prototype.createOrUpdateSelectionOctree=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,h=this._getComponent(b.c.NAME_OCTREE);h||(h=new W(this),this.wc(h)),this.nk||(this.nk=new H.d(H.d.CreationFuncForMeshes,Y,c));const C=this.getWorldExtends();return this.nk.update(C.min,C.max,this.meshes),this.nk},Object.defineProperty(C.e.prototype,"selectionOctree",{get:function(){return this.nk},enumerable:!0,configurable:!0}),N.c.prototype.createOrUpdateSubmeshesOctree=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const h=this.ZY();let C=h._getComponent(b.c.NAME_OCTREE);C||(C=new W(h),h.wc(C)),this._submeshesOctree||(this._submeshesOctree=new H.d(H.d.CreationFuncForSubMeshes,Y,c)),this.Kc(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.rc),this._submeshesOctree};class W{constructor(Y){this.name=b.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Q.b(E.bh.Zero(),new E.bh(1,1,1)),(Y=Y||w.d.LastCreatedScene)&&(this.wh=Y,this.wh.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.wh.getActiveSubMeshCandidates=Y=>this.getActiveSubMeshCandidates(Y),this.wh.getCollidingSubMeshCandidates=(Y,c)=>this.getCollidingSubMeshCandidates(Y,c),this.wh.getIntersectingSubMeshCandidates=(Y,c)=>this.getIntersectingSubMeshCandidates(Y,c))}register(){this.wh.onMeshRemovedObservable.add((Y=>{const c=this.wh.selectionOctree;if(void 0!==c&&null!==c){const h=c.gk.indexOf(Y);-1!==h&&c.gk.splice(h,1)}})),this.wh.onMeshImportedObservable.add((Y=>{const c=this.wh.selectionOctree;void 0!==c&&null!==c&&c.iq(Y)}))}getActiveMeshCandidates(){var Y;return(null===(Y=this.wh.nk)||void 0===Y?void 0:Y.select(this.wh.frustumPlanes))||this.wh._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Y){if(Y._submeshesOctree&&Y.useOctreeForRenderingSelection){return Y._submeshesOctree.select(this.wh.frustumPlanes)}return this.wh._getDefaultSubMeshCandidates(Y)}getIntersectingSubMeshCandidates(Y,c){if(Y._submeshesOctree&&Y.useOctreeForPicking){Q.b.TransformToRef(c,Y.getWorldMatrix(),this._tempRay);return Y._submeshesOctree.intersectsRay(this._tempRay)}return this.wh._getDefaultSubMeshCandidates(Y)}getCollidingSubMeshCandidates(Y,c){if(Y._submeshesOctree&&Y.useOctreeForCollisions){const h=c._velocityWorldLength+Math.max(c._radius.x,c._radius.y,c._radius.z);return Y._submeshesOctree.intersects(c._basePointWorld,h)}return this.wh._getDefaultSubMeshCandidates(Y)}rebuild(){}dispose(){}}},14122:(Y,c,h)=>{"use strict";h.d(c,{b:()=>M});var C=h(13110),E=h(13329),N=h(12874),Q=h(12869),b=h(12877),H=h(13208),w=h(13133),W=h(12722),q=h(13166);const k={internalPickerForMesh:void 0};class M{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.d;this.origin=Y,this.direction=c,this.length=h,this.epsilon=C}clone(){return new M(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=M._TmpVector3[0].Vc(Y.x-h,Y.y-h,Y.z-h),E=M._TmpVector3[1].Vc(c.x+h,c.y+h,c.z+h);let N,Q,b,H,w=0,W=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<C.x||this.origin.x>E.x)return!1}else if(N=1/this.direction.x,Q=(C.x-this.origin.x)*N,b=(E.x-this.origin.x)*N,b===-1/0&&(b=1/0),Q>b&&(H=Q,Q=b,b=H),w=Math.max(Q,w),W=Math.min(b,W),w>W)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<C.y||this.origin.y>E.y)return!1}else if(N=1/this.direction.y,Q=(C.y-this.origin.y)*N,b=(E.y-this.origin.y)*N,b===-1/0&&(b=1/0),Q>b&&(H=Q,Q=b,b=H),w=Math.max(Q,w),W=Math.min(b,W),w>W)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<C.z||this.origin.z>E.z)return!1}else if(N=1/this.direction.z,Q=(C.z-this.origin.z)*N,b=(E.z-this.origin.z)*N,b===-1/0&&(b=1/0),Q>b&&(H=Q,Q=b,b=H),w=Math.max(Q,w),W=Math.min(b,W),w>W)return!1;return!0}intersectsBox(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Y.minimum,Y.maximum,c)}intersectsSphere(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=Y.center.x-this.origin.x,C=Y.center.y-this.origin.y,E=Y.center.z-this.origin.z,N=h*h+C*C+E*E,Q=Y.radius+c,b=Q*Q;if(N<=b)return!0;const H=h*this.direction.x+C*this.direction.y+E*this.direction.z;if(H<0)return!1;return N-H*H<=b}intersectsTriangle(Y,c,h){const C=M._TmpVector3[0],E=M._TmpVector3[1],N=M._TmpVector3[2],b=M._TmpVector3[3],w=M._TmpVector3[4];c.subtractToRef(Y,C),h.subtractToRef(Y,E),Q.bh.CrossToRef(this.direction,E,N);const W=Q.bh.Dot(C,N);if(0===W)return null;const q=1/W;this.origin.subtractToRef(Y,b);const k=Q.bh.Dot(b,N)*q;if(k<-this.epsilon||k>1+this.epsilon)return null;Q.bh.CrossToRef(b,C,w);const p=Q.bh.Dot(this.direction,w)*q;if(p<-this.epsilon||k+p>1+this.epsilon)return null;const P=Q.bh.Dot(E,w)*q;return P>this.length?null:new H.d(1-k-p,k,P)}intersectsPlane(Y){let c;const h=Q.bh.Dot(Y.normal,this.direction);if(Math.abs(h)<9.99999997475243e-7)return null;{const C=Q.bh.Dot(Y.normal,this.origin);return c=(-Y.d-C)/h,c<0?c<-9.99999997475243e-7?null:0:c}}intersectsAxis(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Y){case"y":{const Y=(this.origin.y-c)/this.direction.y;return Y>0?null:new Q.bh(this.origin.x+this.direction.x*-Y,c,this.origin.z+this.direction.z*-Y)}case"x":{const Y=(this.origin.x-c)/this.direction.x;return Y>0?null:new Q.bh(c,this.origin.y+this.direction.y*-Y,this.origin.z+this.direction.z*-Y)}case"z":{const Y=(this.origin.z-c)/this.direction.z;return Y>0?null:new Q.bh(this.origin.x+this.direction.x*-Y,this.origin.y+this.direction.y*-Y,c)}default:return null}}intersectsMesh(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const b=Q.TmpVectors.Matrix[0];return Y.getWorldMatrix().invertToRef(b),this._tmpRay?M.TransformToRef(this,b,this._tmpRay):this._tmpRay=M.Transform(this,b),Y.intersects(this._tmpRay,c,h,C,E,N)}intersectsMeshes(Y,c,h){h?h.length=0:h=[];for(let C=0;C<Y.length;C++){const E=this.intersectsMesh(Y[C],c);E.hit&&h.push(E)}return h.sort(this._comparePickingInfo),h}_comparePickingInfo(Y,c){return Y.distance<c.distance?-1:Y.distance>c.distance?1:0}intersectionSegment(Y,c,h){const C=this.origin,E=Q.TmpVectors.bh[0],N=Q.TmpVectors.bh[1],b=Q.TmpVectors.bh[2],H=Q.TmpVectors.bh[3];c.subtractToRef(Y,E),this.direction.scaleToRef(M._Rayl,b),C.addToRef(b,N),Y.subtractToRef(C,H);const w=Q.bh.Dot(E,E),W=Q.bh.Dot(E,b),q=Q.bh.Dot(b,b),k=Q.bh.Dot(E,H),p=Q.bh.Dot(b,H),P=w*q-W*W;let y,d,D=P,T=P;P<M._Smallnum?(y=0,D=1,d=p,T=q):(y=W*p-q*k,d=w*p-W*k,y<0?(y=0,d=p,T=q):y>D&&(y=D,d=p+W,T=q)),d<0?(d=0,-k<0?y=0:-k>w?y=D:(y=-k,D=w)):d>T&&(d=T,-k+W<0?y=0:-k+W>w?y=D:(y=-k+W,D=w));const e=Math.abs(y)<M._Smallnum?0:y/D,r=Math.abs(d)<M._Smallnum?0:d/T,X=Q.TmpVectors.bh[4];b.scaleToRef(r,X);const Z=Q.TmpVectors.bh[5];E.scaleToRef(e,Z),Z.addInPlace(H);const a=Q.TmpVectors.bh[6];Z.subtractToRef(X,a);return r>0&&r<=this.length&&a.lengthSquared()<h*h?Z.length():-1}update(Y,c,h,C,E,N,b){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){M._RayDistant||(M._RayDistant=M.Zero()),M._RayDistant.unprojectRayToRef(Y,c,h,C,Q.Matrix.IdentityReadOnly,N,b);const H=Q.TmpVectors.Matrix[0];E.invertToRef(H),M.TransformToRef(M._RayDistant,H,this)}else this.unprojectRayToRef(Y,c,h,C,E,N,b);return this}static Zero(){return new M(Q.bh.Zero(),Q.bh.Zero())}static CreateNew(Y,c,h,C,E,N,Q){return M.Zero().update(Y,c,h,C,E,N,Q)}static CreateNewFromTo(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.Matrix.IdentityReadOnly;const C=new M(new Q.bh(0,0,0),new Q.bh(0,0,0));return M.CreateFromToToRef(Y,c,C,h)}static CreateFromToToRef(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.Matrix.IdentityReadOnly;h.origin.N(Y);const E=c.subtractToRef(Y,h.direction),N=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return h.length=N,h.direction.normalize(),M.TransformToRef(h,C,h)}static Transform(Y,c){const h=new M(new Q.bh(0,0,0),new Q.bh(0,0,0));return M.TransformToRef(Y,c,h),h}static TransformToRef(Y,c,h){Q.bh.TransformCoordinatesToRef(Y.origin,c,h.origin),Q.bh.TransformNormalToRef(Y.direction,c,h.direction),h.length=Y.length,h.epsilon=Y.epsilon;const C=h.direction,E=C.length();if(0!==E&&1!==E){const Y=1/E;C.x*=Y,C.y*=Y,C.z*=Y,h.length*=E}return h}unprojectRayToRef(Y,c,h,C,E,N,b){const H=Q.TmpVectors.Matrix[0];E.multiplyToRef(N,H),H.multiplyToRef(b,H),H.invert();const w=W.d.LastCreatedEngine,q=Q.TmpVectors.bh[0];q.x=Y/h*2-1,q.y=-(c/C*2-1),q.z=null!==w&&void 0!==w&&w.o?1:null!==w&&void 0!==w&&w.isNDCHalfZRange?0:-1;const k=Q.TmpVectors.bh[1].Vc(q.x,q.y,1-1e-8),M=Q.TmpVectors.bh[2],p=Q.TmpVectors.bh[3];Q.bh._UnprojectFromInvertedMatrixToRef(q,H,M),Q.bh._UnprojectFromInvertedMatrixToRef(k,H,p),this.origin.N(M),p.subtractToRef(M,this.direction),this.direction.normalize()}}function p(Y,c,h,C,E){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Q=M.Zero();return P(Y,c,h,C,Q,E,N),Q}function P(Y,c,h,C,E,N){let b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const w=Y.getEngine();if(!N&&!(N=Y.activeCamera))return Y;const W=N.viewport,q=w.getRenderHeight(),{x:k,y:M,width:p,height:P}=W.toGlobal(w.getRenderWidth(),q),y=1/w.getHardwareScalingLevel();return c=c*y-k,h=h*y-(q-M-P),E.update(c,h,p,P,C||Q.Matrix.IdentityReadOnly,b?Q.Matrix.IdentityReadOnly:N.getViewMatrix(),N.getProjectionMatrix(),H),Y}function y(Y,c,h,C,E){if(!w.c)return Y;const N=Y.getEngine();if(!E&&!(E=Y.activeCamera))throw new Error("Active camera not set");const b=E.viewport,H=N.getRenderHeight(),{x:W,y:q,width:k,height:M}=b.toGlobal(N.getRenderWidth(),H),p=Q.Matrix.Identity(),P=1/N.getHardwareScalingLevel();return c=c*P-W,h=h*P-(H-q-M),C.update(c,h,k,M,p,p,E.getProjectionMatrix()),Y}function d(Y,c,h,C,E,N,Q,b){const H=c(C,h.enableDistantPicking),w=h.intersects(H,E,Q,N,C,b);return w&&w.hit?!E&&null!=Y&&w.distance>=Y.distance?null:w:null}function D(Y,c,h,C,E,N){let b=null;const H=!!(Y.activeCameras&&Y.activeCameras.length>1&&Y.cameraToUseForPointers!==Y.activeCamera),W=Y.cameraToUseForPointers||Y.activeCamera,q=k.internalPickerForMesh||d;for(let w=0;w<Y.meshes.length;w++){const k=Y.meshes[w];if(h){if(!h(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.KW)continue;const M=H&&k.isWorldMatrixCameraDependent(),p=k.Kc(M,W);if(k.hasThinInstances&&k.bq){const Y=q(b,c,k,p,!0,!0,N);if(Y){if(E)return Y;const H=Q.TmpVectors.Matrix[1],w=k.thinInstanceGetWorldMatrices();for(let Y=0;Y<w.length;Y++){if(h&&!h(k,Y))continue;w[Y].multiplyToRef(p,H);const Q=q(b,c,k,H,C,E,N,!0);if(Q&&(b=Q,b.thinInstanceIndex=Y,C))return b}}}else{const Y=q(b,c,k,p,C,E,N);if(Y&&(b=Y,C))return b}}return b||new w.c}function T(Y,c,h,C){if(!w.c)return null;const E=[],N=!!(Y.activeCameras&&Y.activeCameras.length>1&&Y.cameraToUseForPointers!==Y.activeCamera),b=Y.cameraToUseForPointers||Y.activeCamera,H=k.internalPickerForMesh||d;for(let w=0;w<Y.meshes.length;w++){const W=Y.meshes[w];if(h){if(!h(W,-1))continue}else if(!W.isEnabled()||!W.isVisible||!W.KW)continue;const q=N&&W.isWorldMatrixCameraDependent(),k=W.Kc(q,b);if(W.hasThinInstances&&W.bq){if(H(null,c,W,k,!0,!0,C)){const Y=Q.TmpVectors.Matrix[1],N=W.thinInstanceGetWorldMatrices();for(let Q=0;Q<N.length;Q++){if(h&&!h(W,Q))continue;N[Q].multiplyToRef(k,Y);const b=H(null,c,W,Y,!1,!1,C,!0);b&&(b.thinInstanceIndex=Q,E.push(b))}}}else{const Y=H(null,c,W,k,!1,!1,C);Y&&E.push(Y)}}return E}function e(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,C=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;C||(C=Y.getWorldMatrix()),c.length=h,E?c.origin.N(E):c.origin.N(Y.position);const N=Q.TmpVectors.bh[2];N.set(0,0,Y._scene.useRightHandedSystem?-1:1);const b=Q.TmpVectors.bh[3];return Q.bh.TransformNormalToRef(N,C,b),Q.bh.NormalizeToRef(b,c.direction),c}var r,X;M._TmpVector3=(0,b.b)(6,Q.bh.Zero),M._RayDistant=M.Zero(),M._Smallnum=1e-8,M._Rayl=1e9,r=C.e,(X=E.b)&&(X.prototype.getForwardRay=function(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,c=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;return e(this,new M(Q.bh.Zero(),Q.bh.Zero(),Y),Y,c,h)},X.prototype.getForwardRayToRef=function(Y){return e(this,Y,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),r&&(q.b._IsPickingAvailable=!0,r.prototype.createPickingRay=function(Y,c,h,C){return p(this,Y,c,h,C,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),C.e.prototype.createPickingRayToRef=function(Y,c,h,C,E){return P(this,Y,c,h,C,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},C.e.prototype.createPickingRayInCameraSpace=function(Y,c,h){return function(Y,c,h,C){const E=M.Zero();return y(Y,c,h,E,C),E}(this,Y,c,h)},C.e.prototype.createPickingRayInCameraSpaceToRef=function(Y,c,h,C){return y(this,Y,c,h,C)},C.e.prototype.pickWithBoundingInfo=function(Y,c,h,C,E){return function(Y,c,h,C,E,N){if(!w.c)return null;const b=D(Y,(C=>(Y._tempPickingRay||(Y._tempPickingRay=M.Zero()),P(Y,c,h,C,Y._tempPickingRay,N||null),Y._tempPickingRay)),C,E,!0);return b&&(b.ray=p(Y,c,h,Q.Matrix.Identity(),N||null)),b}(this,Y,c,h,C,E)},C.e.prototype.KC=function(Y,c,h,C,E,N){return function(Y,c,h,C,E,N,b){const H=D(Y,((C,E)=>(Y._tempPickingRay||(Y._tempPickingRay=M.Zero()),P(Y,c,h,C,Y._tempPickingRay,N||null,!1,E),Y._tempPickingRay)),C,E,!1,b);return H&&(H.ray=p(Y,c,h,Q.Matrix.Identity(),N||null)),H}(this,Y,c,h,C,E,N)},C.e.prototype.pickWithRay=function(Y,c,h,C){return function(Y,c,h,C,E){const N=D(Y,(h=>(Y._pickWithRayInverseMatrix||(Y._pickWithRayInverseMatrix=Q.Matrix.Identity()),h.invertToRef(Y._pickWithRayInverseMatrix),Y._cachedRayForTransform||(Y._cachedRayForTransform=M.Zero()),M.TransformToRef(c,Y._pickWithRayInverseMatrix,Y._cachedRayForTransform),Y._cachedRayForTransform)),h,C,!1,E);return N&&(N.ray=c),N}(this,Y,c,h,C)},C.e.prototype.multiPick=function(Y,c,h,C,E){return function(Y,c,h,C,E,N){return T(Y,(C=>p(Y,c,h,C,E||null)),C,N)}(this,Y,c,h,C,E)},C.e.prototype.multiPickWithRay=function(Y,c,h){return function(Y,c,h,C){return T(Y,(h=>(Y._pickWithRayInverseMatrix||(Y._pickWithRayInverseMatrix=Q.Matrix.Identity()),h.invertToRef(Y._pickWithRayInverseMatrix),Y._cachedRayForTransform||(Y._cachedRayForTransform=M.Zero()),M.TransformToRef(c,Y._pickWithRayInverseMatrix,Y._cachedRayForTransform),Y._cachedRayForTransform)),h,C)}(this,Y,c,h)}},14427:(Y,c,h)=>{"use strict";var C=h(12805),E=h(12700),N=h(12728),Q=h(12832),b=h(12761),H=h(12817);b.c.prototype._partialLoadFile=function(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Y,(Y=>{h[c]=Y,h._internalCount++,6===h._internalCount&&C(h)}),void 0,void 0,!0,((Y,c)=>{E&&Y&&E(Y.status+" "+Y.statusText,c)}))},b.c.prototype._cascadeLoadFiles=function(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let N=0;N<6;N++)this._partialLoadFile(h[N],N,E,c,C)},b.c.prototype._cascadeLoadImgs=function(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5?arguments[5]:void 0;const Q=[];Q._internalCount=0;for(let b=0;b<6;b++)this._partialLoadImg(C[b],b,Q,Y,c,h,E,N)},b.c.prototype._partialLoadImg=function(Y,c,h,C,E,b){let H=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0;const W=(0,Q.e)();(0,N.u)(Y,(Y=>{h[c]=Y,h._internalCount++,C&&C.removePendingData(W),6===h._internalCount&&b&&b(E,h)}),((Y,c)=>{C&&C.removePendingData(W),H&&H(Y,c)}),C?C.offlineProvider:null,w),C&&C.addPendingData(W)},b.c.prototype.createCubeTextureBase=function(Y,c,h,N){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,y=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,d=arguments.length>14&&void 0!==arguments[14]&&arguments[14],D=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const T=p||new C.c(this,7);T.isCube=!0,T.url=Y,T.generateMipMaps=!N,T._lodGenerationScale=k,T._lodGenerationOffset=M,T._useSRGBBuffer=!!d&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!N),T!==p&&(T.label=Y.substring(0,60)),this._doNotHandleContextLost||(T._extension=W,T._files=h,T._buffer=D);const e=Y;this._transformTextureUrl&&!p&&(Y=this._transformTextureUrl(Y));const r=W??function(Y){const c=Y.split("?")[0],h=c.lastIndexOf(".");return h>-1?c.substring(h).toLowerCase():""}(Y),X=(0,H.b)(r),Z=(Y,c)=>{T.dispose(),b?b(Y,c):Y&&E.e.Warn(Y)},a=(C,b)=>{Y===e?C&&Z(C.status+" "+C.statusText,b):(E.e.Warn(`Failed to load ${Y}, falling back to the ${e}`),this.createCubeTextureBase(e,c,h,!!N,Q,Z,w,W,q,k,M,T,P,y,d,D))};if(X)X.then((C=>{const E=Y=>{P&&P(T,Y),C.loadCubeData(Y,T,q,Q,((Y,c)=>{Z(Y,c)}))};D?E(D):h&&6===h.length?C.supportCascades?this._cascadeLoadFiles(c,(Y=>E(Y.map((Y=>new Uint8Array(Y))))),h,Z):Z("Textures type does not support cascades."):this._loadFile(Y,(Y=>E(new Uint8Array(Y))),void 0,void 0,!0,a)}));else{if(!h||0===h.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(c,T,((Y,c)=>{y&&y(Y,c)}),h,Z)}return this._internalTexturesCache.push(T),T}},15199:(Y,c,h)=>{"use strict";h(12700);var C=h(13006);h(12805),h(12954),h(12799),h(13057),h(13019);C.c},14450:(Y,c,h)=>{"use strict";h.d(c,{c:()=>E});var C=h(12825);class E{constructor(Y){this.value=this._toInt(Y)}_toInt(Y){return 0|Y}add(Y){return new E(this.value+Y.value)}Hh(Y){return new E(this.value-Y.value)}multiply(Y){return new E(Math.imul(this.value,Y.value))}divide(Y){return new E(this.value/Y.value)}getClassName(){return E.ClassName}equals(Y){return this.value===Y.value}static FromValue(Y){return new E(Y)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,C.e)("FlowGraphInteger",E)},14463:(Y,c,h)=>{"use strict";h.d(c,{c:()=>E,d:()=>N});var C=h(12869);class E{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.yc=Y}get m(){return this.yc}transformVector(Y){return this.transformVectorToRef(Y,new C.Vector2)}transformVectorToRef(Y,c){return c.x=Y.x*this.yc[0]+Y.y*this.yc[1],c.y=Y.x*this.yc[2]+Y.y*this.yc[3],c}Xc(){return this.toArray()}toArray(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<4;c++)Y[c]=this.yc[c];return Y}IC(Y){for(let c=0;c<4;c++)this.yc[c]=Y[c];return this}multiplyToRef(Y,c){const h=Y.yc,C=this.yc,E=c.yc;return E[0]=h[0]*C[0]+h[1]*C[2],E[1]=h[0]*C[1]+h[1]*C[3],E[2]=h[2]*C[0]+h[3]*C[2],E[3]=h[2]*C[1]+h[3]*C[3],c}multiply(Y){return this.multiplyToRef(Y,new E)}divideToRef(Y,c){const h=this.yc,C=Y.yc,E=c.yc;return E[0]=h[0]/C[0],E[1]=h[1]/C[1],E[2]=h[2]/C[2],E[3]=h[3]/C[3],c}divide(Y){return this.divideToRef(Y,new E)}addToRef(Y,c){const h=this.yc,C=Y.m,E=c.m;return E[0]=h[0]+C[0],E[1]=h[1]+C[1],E[2]=h[2]+C[2],E[3]=h[3]+C[3],c}add(Y){return this.addToRef(Y,new E)}subtractToRef(Y,c){const h=this.yc,C=Y.m,E=c.m;return E[0]=h[0]-C[0],E[1]=h[1]-C[1],E[2]=h[2]-C[2],E[3]=h[3]-C[3],c}Hh(Y){return this.subtractToRef(Y,new E)}transpose(){const Y=this.yc;return new E([Y[0],Y[2],Y[1],Y[3]])}determinant(){const Y=this.yc;return Y[0]*Y[3]-Y[1]*Y[2]}inverse(){const Y=this.determinant();if(0===Y)throw new Error("Matrix is not invertible");const c=this.yc,h=1/Y;return new E([c[3]*h,-c[1]*h,-c[2]*h,c[0]*h])}equals(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.yc,C=Y.m;return 0===c?h[0]===C[0]&&h[1]===C[1]&&h[2]===C[2]&&h[3]===C[3]:Math.abs(h[0]-C[0])<c&&Math.abs(h[1]-C[1])<c&&Math.abs(h[2]-C[2])<c&&Math.abs(h[3]-C[3])<c}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.yc.join(", ")})`}}class N{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.yc=Y}get m(){return this.yc}transformVector(Y){return this.transformVectorToRef(Y,new C.bh)}transformVectorToRef(Y,c){const h=this.yc;return c.x=Y.x*h[0]+Y.y*h[1]+Y.z*h[2],c.y=Y.x*h[3]+Y.y*h[4]+Y.z*h[5],c.z=Y.x*h[6]+Y.y*h[7]+Y.z*h[8],c}multiplyToRef(Y,c){const h=Y.yc,C=this.yc,E=c.m;return E[0]=h[0]*C[0]+h[1]*C[3]+h[2]*C[6],E[1]=h[0]*C[1]+h[1]*C[4]+h[2]*C[7],E[2]=h[0]*C[2]+h[1]*C[5]+h[2]*C[8],E[3]=h[3]*C[0]+h[4]*C[3]+h[5]*C[6],E[4]=h[3]*C[1]+h[4]*C[4]+h[5]*C[7],E[5]=h[3]*C[2]+h[4]*C[5]+h[5]*C[8],E[6]=h[6]*C[0]+h[7]*C[3]+h[8]*C[6],E[7]=h[6]*C[1]+h[7]*C[4]+h[8]*C[7],E[8]=h[6]*C[2]+h[7]*C[5]+h[8]*C[8],c}multiply(Y){return this.multiplyToRef(Y,new N)}divideToRef(Y,c){const h=this.yc,C=Y.m,E=c.m;return E[0]=h[0]/C[0],E[1]=h[1]/C[1],E[2]=h[2]/C[2],E[3]=h[3]/C[3],E[4]=h[4]/C[4],E[5]=h[5]/C[5],E[6]=h[6]/C[6],E[7]=h[7]/C[7],E[8]=h[8]/C[8],c}divide(Y){return this.divideToRef(Y,new N)}addToRef(Y,c){const h=this.yc,C=Y.m,E=c.m;return E[0]=h[0]+C[0],E[1]=h[1]+C[1],E[2]=h[2]+C[2],E[3]=h[3]+C[3],E[4]=h[4]+C[4],E[5]=h[5]+C[5],E[6]=h[6]+C[6],E[7]=h[7]+C[7],E[8]=h[8]+C[8],c}add(Y){return this.addToRef(Y,new N)}subtractToRef(Y,c){const h=this.yc,C=Y.m,E=c.m;return E[0]=h[0]-C[0],E[1]=h[1]-C[1],E[2]=h[2]-C[2],E[3]=h[3]-C[3],E[4]=h[4]-C[4],E[5]=h[5]-C[5],E[6]=h[6]-C[6],E[7]=h[7]-C[7],E[8]=h[8]-C[8],c}Hh(Y){return this.subtractToRef(Y,new N)}toArray(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let c=0;c<9;c++)Y[c]=this.yc[c];return Y}Xc(){return this.toArray()}IC(Y){for(let c=0;c<9;c++)this.yc[c]=Y[c];return this}transpose(){const Y=this.yc;return new N([Y[0],Y[3],Y[6],Y[1],Y[4],Y[7],Y[2],Y[5],Y[8]])}determinant(){const Y=this.yc;return Y[0]*(Y[4]*Y[8]-Y[5]*Y[7])-Y[1]*(Y[3]*Y[8]-Y[5]*Y[6])+Y[2]*(Y[3]*Y[7]-Y[4]*Y[6])}inverse(){const Y=this.determinant();if(0===Y)throw new Error("Matrix is not invertible");const c=this.yc,h=1/Y;return new N([(c[4]*c[8]-c[5]*c[7])*h,(c[2]*c[7]-c[1]*c[8])*h,(c[1]*c[5]-c[2]*c[4])*h,(c[5]*c[6]-c[3]*c[8])*h,(c[0]*c[8]-c[2]*c[6])*h,(c[2]*c[3]-c[0]*c[5])*h,(c[3]*c[7]-c[4]*c[6])*h,(c[1]*c[6]-c[0]*c[7])*h,(c[0]*c[4]-c[1]*c[3])*h])}equals(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const h=this.yc,C=Y.m;return 0===c?h[0]===C[0]&&h[1]===C[1]&&h[2]===C[2]&&h[3]===C[3]&&h[4]===C[4]&&h[5]===C[5]&&h[6]===C[6]&&h[7]===C[7]&&h[8]===C[8]:Math.abs(h[0]-C[0])<c&&Math.abs(h[1]-C[1])<c&&Math.abs(h[2]-C[2])<c&&Math.abs(h[3]-C[3])<c&&Math.abs(h[4]-C[4])<c&&Math.abs(h[5]-C[5])<c&&Math.abs(h[6]-C[6])<c&&Math.abs(h[7]-C[7])<c&&Math.abs(h[8]-C[8])<c}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.yc.join(", ")})`}}},14469:(Y,c,h)=>{"use strict";var C;function E(Y,c,h,C){switch(c){case"Animation":return C?Y.animations.find((Y=>Y.uniqueId===h))??null:Y.animations[h]??null;case"AnimationGroup":return C?Y.animationGroups.find((Y=>Y.uniqueId===h))??null:Y.animationGroups[h]??null;case"Mesh":return C?Y.meshes.find((Y=>Y.uniqueId===h))??null:Y.meshes[h]??null;case"Material":return C?Y.materials.find((Y=>Y.uniqueId===h))??null:Y.materials[h]??null;case"mk":return C?Y.cameras.find((Y=>Y.uniqueId===h))??null:Y.cameras[h]??null;case"Light":return C?Y.lights.find((Y=>Y.uniqueId===h))??null:Y.lights[h]??null;default:return null}}h.d(c,{e:()=>E}),function(Y){Y.Animation="Animation",Y.AnimationGroup="AnimationGroup",Y.Mesh="Mesh",Y.Material="Material",Y.mk="mk",Y.Light="Light"}(C||(C={}))},14499:(Y,c,h)=>{"use strict";h.d(c,{d:()=>E});var C=h(14506);class E extends C.c{constructor(Y,c){if(super(Y),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),c)for(const h of c)this._eventsSignalOutputs[h]=this._registerSignalOutput(h+"Event")}_executeOnTick(Y){}_startPendingTasks(Y){Y._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Y),this._resetAfterCanceled(Y)),this._preparePendingTasks(Y),Y._addPendingBlock(this),this.out._activateSignal(Y),Y._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Y){Y._deleteExecutionVariable(this,"_initialized"),Y._removePendingBlock(this)}}},14482:(Y,c,h)=>{"use strict";h.d(c,{b:()=>w});var C=h(12832),E=h(12825),N=h(14485),Q=h(12690),b=h(14445);class H extends N.c{constructor(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.defaultValue,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Y,c,h),this.richType=C,this._defaultValue=E,this._optional=N,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Q.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Y){this._isDisabled!==Y&&(this._isDisabled=Y,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Y,c){c._getConnectionValue(this)!==Y&&(c._setConnectionValue(this,Y),this.onValueChangedObservable.notifyObservers(Y))}resetToDefaultValue(Y){Y._setConnectionValue(this,this._defaultValue)}connectTo(Y){this._isDisabled||super.connectTo(Y)}_getValueOrDefault(Y){const c=Y._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(c):c}getValue(Y){if(1===this.connectionType){Y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Y);const c=this._getValueOrDefault(Y);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}const c=this.isConnected()?this._connectedPoint[0].getValue(Y):this._getValueOrDefault(Y);return this._lastValue=c,this.richType.typeTransformer?this.richType.typeTransformer(c):c}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Y),Y.richType={},this.richType.serialize(Y.richType),Y.optional=this._optional,(0,b.h)("defaultValue",this._defaultValue,Y)}}(0,E.e)("FlowGraphDataConnection",H);class w{constructor(Y){var c;this.config=Y,this.uniqueId=(0,C.e)(),this.name=(null===(c=this.config)||void 0===c?void 0:c.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Y){}registerDataInput(Y,c,h){const C=new H(Y,0,this,c,h);return this.dataInputs.push(C),C}registerDataOutput(Y,c,h){const C=new H(Y,1,this,c,h);return this.dataOutputs.push(C),C}getDataInput(Y){return this.dataInputs.find((c=>c.name===Y))}getDataOutput(Y){return this.dataOutputs.find((c=>c.name===Y))}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.h;if(Y.uniqueId=this.uniqueId,Y.config={},this.config){const h=this.config,C=Object.keys(h);for(const E of C)c(E,h[E],Y.config)}Y.dataInputs=[],Y.dataOutputs=[],Y.className=this.getClassName();for(const h of this.dataInputs){const c={};h.serialize(c),Y.dataInputs.push(c)}for(const h of this.dataOutputs){const c={};h.serialize(c),Y.dataOutputs.push(c)}}deserialize(Y){}_log(Y,c,h){var C;null===(C=Y.logger)||void 0===C||C.addLogItem({action:c,sC:h,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14485:(Y,c,h)=>{"use strict";h.d(c,{c:()=>N});var C,E=h(12832);!function(Y){Y[Y.Input=0]="Input",Y[Y.Output=1]="Output"}(C||(C={}));class N{constructor(Y,c,h){this._ownerBlock=h,this._connectedPoint=[],this.uniqueId=(0,E.e)(),this.connectedPointIds=[],this.name=Y,this._connectionType=c}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Y){if(this._connectionType===Y._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Y._isSingularConnection()&&Y._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Y),Y._connectedPoint.push(this)}disconnectFrom(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const h=this._connectedPoint.indexOf(Y),C=Y._connectedPoint.indexOf(this);-1!==h&&-1!==C&&(c&&this._connectedPoint.splice(h,1),Y._connectedPoint.splice(C,1))}disconnectFromAll(){for(const Y of this._connectedPoint)this.disconnectFrom(Y,!1);this._connectedPoint.length=0}dispose(){for(const Y of this._connectedPoint)this.disconnectFrom(Y)}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Y.uniqueId=this.uniqueId,Y.name=this.name,Y._connectionType=this._connectionType,Y.connectedPointIds=[],Y.className=this.getClassName();for(const c of this._connectedPoint)Y.connectedPointIds.push(c.uniqueId)}getClassName(){return"FGConnection"}deserialize(Y){this.uniqueId=Y.uniqueId,this.name=Y.name,this._connectionType=Y._connectionType,this.connectedPointIds=Y.connectedPointIds}}},14440:(Y,c,h)=>{"use strict";h.d(c,{d:()=>T});var C,E=h(12690),N=h(12853),Q=h(12859),b=h(12832),H=h(14445),w=h(14469),W=h(12700);!function(Y){Y.ExecuteBlock="ExecuteBlock",Y.ExecuteEvent="ExecuteEvent",Y.TriggerConnection="TriggerConnection",Y.ContextVariableSet="ContextVariableSet",Y.GlobalVariableSet="GlobalVariableSet",Y.GlobalVariableDelete="GlobalVariableDelete",Y.GlobalVariableGet="GlobalVariableGet",Y.AddConnection="AddConnection",Y.GetConnectionValue="GetConnectionValue",Y.SetConnectionValue="SetConnectionValue",Y.ActivateSignal="ActivateSignal",Y.ContextVariableGet="ContextVariableGet"}(C||(C={}));class q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Y){if(Y.time||(Y.time=Date.now()),this.log.push(Y),this.logToConsole){var c;const h=null===(c=Y.sC)||void 0===c?void 0:c.value;"object"===typeof h&&h.getClassName?W.e.Log(`[FGLog] ${Y.className}:${Y.uniqueId.split("-")[0]} ${Y.action} - ${JSON.stringify(h.getClassName())}: ${h.toString()}`):W.e.Log(`[FGLog] ${Y.className}:${Y.uniqueId.split("-")[0]} ${Y.action} - ${JSON.stringify(Y.sC)}`)}}getItemsOfType(Y){return this.log.filter((c=>c.action===Y))}}class k{get enableLogging(){return this._enableLogging}set enableLogging(Y){this._enableLogging!==Y&&(this._enableLogging=Y,this._enableLogging?(this.logger=new q,this.logger.logToConsole=!0):this.logger=null)}constructor(Y){this.uniqueId=(0,b.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Y,this.assetsContext=Y.assetsContext??Y.wh}hasVariable(Y){return Y in this._userVariables}setVariable(Y,c){var h;this._userVariables[Y]=c,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",sC:{name:Y,value:c}})}getAsset(Y,c){return(0,w.e)(this.assetsContext,Y,c)}getVariable(Y){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",sC:{name:Y,value:this._userVariables[Y]}}),this._userVariables[Y]}get userVariables(){return this._userVariables}ZY(){return this._configuration.wh}_getUniqueIdPrefixedName(Y,c){return`${Y.uniqueId}_${c}`}_getGlobalContextVariable(Y,c){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",sC:{name:Y,defaultValue:c,possibleValue:this._globalContextVariables[Y]}}),this._hasGlobalContextVariable(Y)?this._globalContextVariables[Y]:c}_setGlobalContextVariable(Y,c){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",sC:{name:Y,value:c}}),this._globalContextVariables[Y]=c}_deleteGlobalContextVariable(Y){var c;null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",sC:{name:Y}}),delete this._globalContextVariables[Y]}_hasGlobalContextVariable(Y){return Y in this._globalContextVariables}_setExecutionVariable(Y,c,h){this._executionVariables[this._getUniqueIdPrefixedName(Y,c)]=h}_getExecutionVariable(Y,c,h){return this._hasExecutionVariable(Y,c)?this._executionVariables[this._getUniqueIdPrefixedName(Y,c)]:h}_deleteExecutionVariable(Y,c){delete this._executionVariables[this._getUniqueIdPrefixedName(Y,c)]}_hasExecutionVariable(Y,c){return this._getUniqueIdPrefixedName(Y,c)in this._executionVariables}_hasConnectionValue(Y){return Y.uniqueId in this._connectionValues}_setConnectionValue(Y,c){var h;this._connectionValues[Y.uniqueId]=c,null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",sC:{connectionPointId:Y.uniqueId,value:c}})}_setConnectionValueByKey(Y,c){this._connectionValues[Y]=c}_getConnectionValue(Y){var c;return null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",sC:{connectionPointId:Y.uniqueId,value:this._connectionValues[Y.uniqueId]}}),this._connectionValues[Y.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Y){this._pendingBlocks.includes(Y)||(this._pendingBlocks.push(Y),this._pendingBlocks.sort(((Y,c)=>Y.priority-c.priority)))}_removePendingBlock(Y){const c=this._pendingBlocks.indexOf(Y);-1!==c&&this._pendingBlocks.splice(c,1)}_clearPendingBlocks(){for(const Y of this._pendingBlocks)Y._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Y){var c;this.onNodeExecutedObservable.notifyObservers(Y),null===(c=this.logger)||void 0===c||c.addLogItem({time:Date.now(),className:Y.getClassName(),uniqueId:Y.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Y){this._setGlobalContextVariable("timeSinceStart",Y.timeSinceStart),this._setGlobalContextVariable("deltaTime",Y.deltaTime);for(const h of this._pendingBlocks){var c;null===(c=h._executeOnTick)||void 0===c||c.call(h,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.h;Y.uniqueId=this.uniqueId,Y._userVariables={};for(const C in this._userVariables)c(C,this._userVariables[C],Y._userVariables);Y._connectionValues={};for(const C in this._connectionValues)c(C,this._connectionValues[C],Y._connectionValues);var h;this.assetsContext!==this.ZY()&&(Y._assetsContext={meshes:this.assetsContext.meshes.map((Y=>Y.id)),materials:this.assetsContext.materials.map((Y=>Y.id)),textures:this.assetsContext.textures.map((Y=>Y.name)),animations:this.assetsContext.animations.map((Y=>Y.name)),lights:this.assetsContext.lights.map((Y=>Y.id)),cameras:this.assetsContext.cameras.map((Y=>Y.id)),Tp:null===(h=this.assetsContext.Tp)||void 0===h?void 0:h.map((Y=>Y.name)),skeletons:this.assetsContext.skeletons.map((Y=>Y.id)),OM:this.assetsContext.OM.map((Y=>Y.name)),geometries:this.assetsContext.geometries.map((Y=>Y.id)),multiMaterials:this.assetsContext.multiMaterials.map((Y=>Y.id)),transformNodes:this.assetsContext.transformNodes.map((Y=>Y.id))})}getClassName(){return"FlowGraphContext"}}(0,N.b)([(0,Q.N)()],k.prototype,"uniqueId",void 0);var M=h(14473),p=h(13149);class P{constructor(Y){this.onEventTriggeredObservable=new E.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Y,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Mc.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Y=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",sC:{timeSinceStart:this._startingTime,deltaTime:Y}}),this._startingTime+=Y})),this._meshPickedObserver=this._scene.onPointerObservable.add((Y=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",sC:Y})}),p.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Y=>{const c=Y.pointerId,h=Y.mesh,C=this._pointerUnderMeshState[c];!C&&h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sC:{pointerId:c,mesh:h}}):C&&!h?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sC:{pointerId:c,mesh:C}}):C&&h&&C!==h&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",sC:{pointerId:c,mesh:C,over:h}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",sC:{pointerId:c,mesh:h,out:C}})),this._pointerUnderMeshState[c]=h}),p.c.POINTERMOVE)}dispose(){var Y,c,h,C,E;null===(Y=this._sceneDisposeObserver)||void 0===Y||Y.remove(),null===(c=this._sceneReadyObserver)||void 0===c||c.remove(),null===(h=this._sceneOnBeforeRenderObserver)||void 0===h||h.remove(),null===(C=this._meshPickedObserver)||void 0===C||C.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var y,d=h(14493);!function(Y){Y[Y.Stopped=0]="Stopped",Y[Y.Started=1]="Started"}(y||(y={}));class D{get state(){return this._state}set state(Y){this._state=Y,this.onStateChangedObservable.notifyObservers(Y)}constructor(Y){this.onStateChangedObservable=new E.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Y.wh,this._sceneEventCoordinator=new P(this._scene),this._coordinator=Y.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Y=>{for(const c of this._executionContexts){const h=this._getContextualOrder(Y.type,c);for(const C of h)if(!C._executeEvent(c,Y.sC))break}switch(Y.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const c of this._executionContexts)c._notifyOnTick(Y.sC);break;case"SceneDispose":this.dispose()}}))}createContext(){const Y=new k({wh:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Y),Y}getContext(Y){return this._executionContexts[Y]}addEventBlock(Y){if("PointerOver"!==Y.type&&"PointerOut"!==Y.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Y.type&&this._eventBlocks[Y.type].push(Y),1===this.state)for(const c of this._executionContexts)Y._startPendingTasks(c);else this.onStateChangedObservable.addOnce((c=>{if(1===c)for(const h of this._executionContexts)Y._startPendingTasks(h)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Y=>{1===Y&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Y of this._executionContexts)for(const c in this._eventBlocks){const h=this._getContextualOrder(c,Y);for(const c of h)c._startPendingTasks(Y)}}_getContextualOrder(Y,c){const h=this._eventBlocks[Y].sort(((Y,c)=>c.initPriority-Y.initPriority));if("MeshPick"===Y){const Y=[];for(const C of h){const E=C.asset.getValue(c);let N=0;for(;N<h.length;N++){const Y=h[N].asset.getValue(c);if(E&&Y&&(0,d.l)(E,Y))break}Y.splice(N,0,C)}return Y}return h}dispose(){var Y;if(0!==this.state){this.state=0;for(const Y of this._executionContexts)Y._clearPendingBlocks();this._executionContexts.length=0;for(const Y in this._eventBlocks)this._eventBlocks[Y].length=0;null===(Y=this._eventObserver)||void 0===Y||Y.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Y){const c=[],h=new Set;for(const C in this._eventBlocks)for(const Y of this._eventBlocks[C])c.push(Y),h.add(Y.uniqueId);for(;c.length>0;){const C=c.pop();Y(C);for(const Y of C.dataInputs)for(const C of Y._connectedPoint)h.has(C._ownerBlock.uniqueId)||(c.push(C._ownerBlock),h.add(C._ownerBlock.uniqueId));if(C instanceof M.e)for(const Y of C.signalOutputs)for(const C of Y._connectedPoint)h.has(C._ownerBlock.uniqueId)||(c.push(C._ownerBlock),h.add(C._ownerBlock.uniqueId))}}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;Y.allBlocks=[],this.visitAllBlocks((c=>{const h={};c.serialize(h),Y.allBlocks.push(h)})),Y.executionContexts=[];for(const h of this._executionContexts){const C={};h.serialize(C,c),Y.executionContexts.push(C)}}}class T{constructor(Y){this.config=Y,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.wh.Mc.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.wh.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Y=this._executeOnNextFrame.slice(0);if(Y.length)for(const c of Y){this.notifyCustomEvent(c.id,c.data,!1);const Y=this._executeOnNextFrame.findIndex((Y=>Y.uniqueId===c.uniqueId));-1!==Y&&this._executeOnNextFrame.splice(Y,1)}}));(T.SceneCoordinators.get(this.config.wh)??[]).push(this)}createGraph(){const Y=new D({wh:this.config.wh,coordinator:this});return this._flowGraphs.push(Y),Y}removeGraph(Y){const c=this._flowGraphs.indexOf(Y);-1!==c&&(Y.dispose(),this._flowGraphs.splice(c,1))}start(){for(const Y of this._flowGraphs)Y.start()}dispose(){var Y,c;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(Y=this._disposeObserver)||void 0===Y||Y.remove(),null===(c=this._onBeforeRenderObserver)||void 0===c||c.remove();const h=T.SceneCoordinators.get(this.config.wh)??[],C=h.indexOf(this);-1!==C&&h.splice(C,1)}serialize(Y,c){Y._flowGraphs=[];for(const h of this._flowGraphs){const C={};h.serialize(C,c),Y._flowGraphs.push(C)}Y.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Y){let c=this._customEventsMap.get(Y);return c||(c=new E.c,this._customEventsMap.set(Y,c)),c}notifyCustomEvent(Y,c){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Y,data:c,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Y)){const c=this._eventExecutionCounter.get(Y);if(this._eventExecutionCounter.set(Y,c+1),c>=T.MaxEventTypeExecutionPerFrame)return void(c===T.MaxEventTypeExecutionPerFrame&&W.e.Warn(`FlowGraphCoordinator: Too many executions of event "${Y}".`))}else this._eventExecutionCounter.set(Y,1);const h=this._customEventsMap.get(Y);h&&h.notifyObservers(c)}}T.MaxEventsPerType=30,T.MaxEventTypeExecutionPerFrame=30,T.SceneCoordinators=new Map},14496:(Y,c,h)=>{"use strict";h.d(c,{c:()=>E});var C=h(14499);class E extends C.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Y){Y._notifyExecuteNode(this),this.done._activateSignal(Y)}}},14473:(Y,c,h)=>{"use strict";h.d(c,{e:()=>b});var C=h(14482),E=h(14485),N=h(12825);class Q extends E.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Y){super.connectTo(Y),this._connectedPoint.sort(((Y,c)=>c.priority-Y.priority))}_activateSignal(Y){var c;if(null===(c=Y.logger)||void 0===c||c.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,sC:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Y._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Y,this),Y._increaseExecutionId();else for(const h of this._connectedPoint)h._activateSignal(Y)}}(0,N.e)("FlowGraphSignalConnection",Q);class b extends C.b{constructor(Y){super(Y),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Y){const c=new Q(Y,0,this);return this.signalInputs.push(c),c}_registerSignalOutput(Y){const c=new Q(Y,1,this);return this.signalOutputs.push(c),c}_unregisterSignalInput(Y){const c=this.signalInputs.findIndex((c=>c.name===Y));-1!==c&&(this.signalInputs[c].dispose(),this.signalInputs.splice(c,1))}_unregisterSignalOutput(Y){const c=this.signalOutputs.findIndex((c=>c.name===Y));-1!==c&&(this.signalOutputs[c].dispose(),this.signalOutputs.splice(c,1))}_reportError(Y,c){this.error.sC="string"===typeof c?new Error(c):c,this.error._activateSignal(Y)}getSignalInput(Y){return this.signalInputs.find((c=>c.name===Y))}getSignalOutput(Y){return this.signalOutputs.find((c=>c.name===Y))}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Y),Y.signalInputs=[],Y.signalOutputs=[];for(const c of this.signalInputs){const h={};c.serialize(h),Y.signalInputs.push(h)}for(const c of this.signalOutputs){const h={};c.serialize(h),Y.signalOutputs.push(h)}}deserialize(Y){for(let c=0;c<Y.signalInputs.length;c++){const h=this.getSignalInput(Y.signalInputs[c].name);if(!h)throw new Error("Could not find signal input with name "+Y.signalInputs[c].name+" in block "+Y.className);h.deserialize(Y.signalInputs[c])}for(let c=0;c<Y.signalOutputs.length;c++){const h=this.getSignalOutput(Y.signalOutputs[c].name);if(!h)throw new Error("Could not find signal output with name "+Y.signalOutputs[c].name+" in block "+Y.className);h.deserialize(Y.signalOutputs[c])}}getClassName(){return"FlowGraphExecutionBlock"}}},14506:(Y,c,h)=>{"use strict";h.d(c,{c:()=>E});var C=h(14473);class E extends C.e{constructor(Y){super(Y),this.out=this._registerSignalOutput("out")}}},14459:(Y,c,h)=>{"use strict";h.d(c,{C:()=>G,G:()=>K,H:()=>a,L:()=>Z,c:()=>w,d:()=>k,h:()=>X,i:()=>y,j:()=>d,k:()=>D,n:()=>q,r:()=>r,t:()=>W,v:()=>M,x:()=>p,z:()=>P});var C,E=h(12869),N=h(12920),Q=h(14450),b=h(14463);!function(Y){Y.Any="any",Y.String="string",Y.Number="number",Y.Boolean="boolean",Y.Object="object",Y.Integer="FlowGraphInteger",Y.Vector2="Vector2",Y.bh="bh",Y.Vector4="Vector4",Y.Quaternion="Quaternion",Y.Matrix="Matrix",Y.Matrix2D="Matrix2D",Y.Matrix3D="Matrix3D",Y.ph="ph",Y.vc="vc"}(C||(C={}));class H{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Y,this.defaultValue=c,this.animationType=h}serialize(Y){Y.typeName=this.typeName,Y.defaultValue=this.defaultValue}}const w=new H("any",void 0),W=new H("string",""),q=new H("number",0,0),k=new H("boolean",!1),M=new H("Vector2",E.Vector2.Zero(),5),p=new H("bh",E.bh.Zero(),1),P=new H("Vector4",E.Vector4.Zero()),y=new H("Matrix",E.Matrix.Identity(),3),d=new H("Matrix2D",new b.c),D=new H("Matrix3D",new b.d),T=new H("ph",N.ph.Black(),4),e=new H("vc",new N.vc(0,0,0,0),7),r=new H("Quaternion",E.Quaternion.Identity(),2);r.typeTransformer=Y=>{if(Y.getClassName){if("Vector4"===Y.getClassName())return E.Quaternion.dh(Y.Xc());if("bh"===Y.getClassName())return E.Quaternion.FromEulerVector(Y);if("Matrix"===Y.getClassName())return E.Quaternion.FromRotationMatrix(Y)}return Y};const X=new H("FlowGraphInteger",new Q.c(0),0);function Z(Y){const c=Y;switch(typeof Y){case"string":return W;case"number":return q;case"boolean":return k;case"object":if(c.getClassName)switch(c.getClassName()){case"Vector2":return M;case"bh":return p;case"Vector4":return P;case"Matrix":return y;case"ph":return T;case"vc":return e;case"Quaternion":return r;case"FlowGraphInteger":return X;case"Matrix2D":return d;case"Matrix3D":return D}return w;default:return w}}function a(Y){switch(Y){case"string":return W;case"number":return q;case"boolean":return k;case"Vector2":return M;case"bh":return p;case"Vector4":return P;case"Matrix":return y;case"ph":return T;case"vc":return e;case"Quaternion":return r;case"FlowGraphInteger":return X;case"Matrix2D":return d;case"Matrix3D":return D;default:return w}}function G(Y){switch(Y){case"number":default:return 0;case"Vector2":return 5;case"bh":return 1;case"Matrix":return 3;case"ph":return 4;case"vc":return 7;case"Quaternion":return 2}}function K(Y){switch(Y){case 0:return q;case 5:return M;case 1:return p;case 3:return y;case 4:return T;case 7:return e;case 2:return r;default:return w}}},14445:(Y,c,h)=>{"use strict";h.d(c,{e:()=>W,h:()=>w,k:()=>q});var C=h(12920),E=h(12869),N=h(14450),Q=h(14459),b=h(14463);function H(Y){return"Vector2"===Y||"bh"===Y||"Vector4"===Y||"Quaternion"===Y||"ph"===Y||"vc"===Y}function w(Y,c,h){var C;const E=(null===c||void 0===c||null===(C=c.getClassName)||void 0===C?void 0:C.call(c))??"";if(H(E)||function(Y){return"Matrix"===Y||"Matrix2D"===Y||"Matrix3D"===Y}(E))h[Y]={value:c.Xc(),className:E};else if("FlowGraphInteger"===E)h[Y]={value:c.value,className:E};else if(E&&(c.id||c.name))h[Y]={id:c.id,name:c.name,className:E};else{if("object"===typeof c)throw new Error(`Could not serialize value ${c}`);h[Y]=c}}function W(Y,c,h,w){const q=c[Y];let k;const M=(null===q||void 0===q?void 0:q.type)??(null===q||void 0===q?void 0:q.className);if(function(Y){return"Mesh"===Y||"AbstractMesh"===Y||"GroundMesh"===Y||"InstanceMesh"===Y||"LinesMesh"===Y||"GoldbergMesh"===Y||"GreasedLineMesh"===Y||"TrailMesh"===Y}(M)){let Y=w.meshes.filter((Y=>q.id?Y.id===q.id:Y.name===q.name));0===Y.length&&(Y=w.transformNodes.filter((Y=>q.id?Y.id===q.id:Y.name===q.name))),k=q.uniqueId?Y.find((Y=>Y.uniqueId===q.uniqueId)):Y[0]}else if(H(M))k=function(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Y)return E.Vector2.dh(c);if("bh"===Y)return h&&(c[2]*=-1),E.bh.dh(c);if("Vector4"===Y)return E.Vector4.dh(c);if("Quaternion"===Y)return h&&(c[2]*=-1,c[3]*=-1),E.Quaternion.dh(c);if("ph"===Y)return new C.ph(c[0],c[1],c[2]);if("vc"===Y)return new C.vc(c[0],c[1],c[2],c[3]);throw new Error(`Unknown vector class name ${Y}`)}(M,q.value);else if(function(Y){return"AnimationGroup"===Y}(M)){const Y=w.animationGroups.filter((Y=>Y.name===q.name));k=1===Y.length?Y[0]:Y.find((Y=>Y.uniqueId===q.uniqueId))}else k="Matrix"===M?E.Matrix.dh(q.value):"Matrix2D"===M?new b.c(q.value):"Matrix3D"===M?new b.d(q.value):"FlowGraphInteger"===M?N.c.FromValue(q.value):"number"===M||"string"===M||"boolean"===M?q.value[0]:q&&void 0!==q.value?q.value:Array.isArray(q)?q.reduce(((Y,c)=>c.eventData?(Y[c.id]={type:(0,Q.H)(c.type)},"undefined"!==typeof c.value&&(Y[c.id].value=W("value",c,h,w)),Y):Y),{}):q;return k}function q(Y){return"FlowGraphJsonPointerParserBlock"===Y}},14493:(Y,c,h)=>{"use strict";function C(Y,c){return!(!Y.parent||Y.parent!==c&&!C(Y.parent,c))}function E(Y){if(Y.getClassName)return Y.getClassName()}function N(Y,c){return Y===c&&("Vector2"===Y||"bh"===Y||"Vector4"===Y||"Quaternion"===Y)}function Q(Y,c){return Y===c&&("Matrix"===Y||"Matrix2D"===Y||"Matrix3D"===Y)}function b(Y,c){return"FlowGraphInteger"===Y&&"FlowGraphInteger"===c}function H(Y,c){const h="number"===typeof Y||"number"===typeof(null===Y||void 0===Y?void 0:Y.value);return h&&!c?!isNaN(w(Y)):h}function w(Y){return"number"===typeof Y?Y:Y.value}h.d(c,{b:()=>b,c:()=>Q,d:()=>N,h:()=>E,l:()=>C,m:()=>w,q:()=>H})},14945:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{SceneInstrumentation:()=>N});var C=h(12687),E=h(13091);class N{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Y){Y!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Y,Y?(this._onBeforeActiveMeshesEvaluationObserver=this.wh.onBeforeActiveMeshesEvaluationObservable.add((()=>{C.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.wh.onAfterActiveMeshesEvaluationObservable.add((()=>{C.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.wh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Y){Y!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Y,Y?(this._onBeforeRenderTargetsRenderObserver=this.wh.onBeforeRenderTargetsRenderObservable.add((()=>{C.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.wh.onAfterRenderTargetsRenderObservable.add((()=>{C.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.wh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Y){Y!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Y,Y?(this._onBeforeParticlesRenderingObserver=this.wh.onBeforeParticlesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.wh.onAfterParticlesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.wh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Y){Y!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Y,this.wh.spriteManagers&&(Y?(this._onBeforeSpritesRenderingObserver=this.wh.onBeforeSpritesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.wh.onAfterSpritesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.wh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.wh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Y){Y!==this._capturePhysicsTime&&this.wh.onBeforePhysicsObservable&&(this._capturePhysicsTime=Y,Y?(this._onBeforePhysicsObserver=this.wh.onBeforePhysicsObservable.add((()=>{C.Tools.StartPerformanceCounter("tc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.wh.onAfterPhysicsObservable.add((()=>{C.Tools.EndPerformanceCounter("tc"),this._physicsTime.endMonitoring()}))):(this.wh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.wh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Y){Y!==this._captureAnimationsTime&&(this._captureAnimationsTime=Y,Y?this._onAfterAnimationsObserver=this.wh.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.wh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Y){this._captureFrameTime=Y}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Y){this._captureInterFrameTime=Y}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Y){Y!==this._captureRenderTime&&(this._captureRenderTime=Y,Y?(this._onBeforeDrawPhaseObserver=this.wh.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),C.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.wh.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter("Main render")}))):(this.wh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Y){Y!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Y,Y?(this._onBeforeCameraRenderObserver=this.wh.onBeforeCameraRenderObservable.add((Y=>{this._cameraRenderTime.beginMonitoring(),C.Tools.StartPerformanceCounter(`Rendering camera ${Y.name}`)})),this._onAfterCameraRenderObserver=this.wh.onAfterCameraRenderObservable.add((Y=>{this._cameraRenderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter(`Rendering camera ${Y.name}`)}))):(this.wh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.wh.getEngine()._drawCalls}constructor(Y){this.wh=Y,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.b,this._captureFrameTime=!1,this._frameTime=new E.b,this._captureRenderTime=!1,this._renderTime=new E.b,this._captureInterFrameTime=!1,this._interFrameTime=new E.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.b,this._capturePhysicsTime=!1,this._physicsTime=new E.b,this._captureAnimationsTime=!1,this._animationsTime=new E.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Y.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(C.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.wh.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Y.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(C.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.kc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.kc(),this._captureParticlesRenderTime&&this._particlesRenderTime.kc(),this._captureSpritesRenderTime&&this._spritesRenderTime.kc(),this._captureRenderTime&&this._renderTime.kc(),this._captureCameraRenderTime&&this._cameraRenderTime.kc()}))}dispose(){this._disposed||(this.wh.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.wh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.wh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.wh.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.wh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.wh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.wh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.wh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.wh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.wh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.wh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.wh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.wh=null,this._disposed=!0)}}},14437:(Y,c,h)=>{"use strict";h.d(c,{c:()=>W});var C=h(12853),E=h(12859),N=h(12869),Q=h(13294),b=h(13422),H=h(13484),w=h(12825);Q.c.AddNodeConstructor("Light_Type_1",((Y,c)=>()=>new W(Y,N.bh.Zero(),c)));class W extends H.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Y){this._shadowFrustumSize=Y,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Y){this._shadowOrthoScale=Y,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Y){this._orthoLeft=Y}get orthoRight(){return this._orthoRight}set orthoRight(Y){this._orthoRight=Y}get orthoTop(){return this._orthoTop}set orthoTop(Y){this._orthoTop=Y}get orthoBottom(){return this._orthoBottom}set orthoBottom(Y){this._orthoBottom=Y}constructor(Y,c,h){super(Y,h),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}getClassName(){return"Fc"}getTypeID(){return b.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Y,c,h){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Y):this._setDefaultAutoExtendShadowProjectionMatrix(Y,c,h)}_setDefaultFixedFrustumShadowProjectionMatrix(Y){const c=this.ZY().activeCamera;c&&N.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:c.ac,void 0!==this.shadowMaxZ?this.shadowMaxZ:c.maxZ,Y,this.ZY().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Y,c,h){const C=this.ZY().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Y=N.bh.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let C=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let Q=0;Q<h.length;Q++){const b=h[Q];if(!b)continue;const H=b.getBoundingInfo().boundingBox;for(let h=0;h<H.vectorsWorld.length;h++)N.bh.TransformCoordinatesToRef(H.vectorsWorld[h],c,Y),Y.x<this._orthoLeft&&(this._orthoLeft=Y.x),Y.y<this._orthoBottom&&(this._orthoBottom=Y.y),Y.x>this._orthoRight&&(this._orthoRight=Y.x),Y.y>this._orthoTop&&(this._orthoTop=Y.y),this.autoCalcShadowZBounds&&(Y.z<C&&(C=Y.z),Y.z>E&&(E=Y.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=C,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,Q=this._orthoTop-this._orthoBottom,b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.ac)||0,H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)||1e4,w=this.ZY().getEngine().o;N.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-Q*this.shadowOrthoScale,this._orthoTop+Q*this.shadowOrthoScale,w?H:b,w?b:H,Y,this.ZY().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Y,c){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,c),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,c),this)}transferToNodeMaterialEffect(Y,c){return this.computeTransformedInformation()?(Y.setFloat3(c,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Y.setFloat3(c,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Y){const c=this._scene.getEngine();return!c.o&&c.isNDCHalfZRange?0:1}getDepthMaxZ(Y){const c=this._scene.getEngine();return c.o&&c.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Y,c){Y["DIRLIGHT"+c]=!0}}(0,C.b)([(0,E.N)()],W.prototype,"shadowFrustumSize",null),(0,C.b)([(0,E.N)()],W.prototype,"shadowOrthoScale",null),(0,C.b)([(0,E.N)()],W.prototype,"autoUpdateExtends",void 0),(0,C.b)([(0,E.N)()],W.prototype,"autoCalcShadowZBounds",void 0),(0,C.b)([(0,E.N)("orthoLeft")],W.prototype,"_orthoLeft",void 0),(0,C.b)([(0,E.N)("orthoRight")],W.prototype,"_orthoRight",void 0),(0,C.b)([(0,E.N)("orthoTop")],W.prototype,"_orthoTop",void 0),(0,C.b)([(0,E.N)("orthoBottom")],W.prototype,"_orthoBottom",void 0),(0,w.e)("BABYLON.DirectionalLight",W)},15124:(Y,c,h)=>{"use strict";h.d(c,{e:()=>W});var C=h(12853),E=h(12859),N=h(12869),Q=h(12920),b=h(13294),H=h(13422),w=h(12825);b.c.AddNodeConstructor("Light_Type_3",((Y,c)=>()=>new W(Y,N.bh.Zero(),c)));class W extends H.e{constructor(Y,c,h){super(Y,h),this.groundColor=new Q.ph(0,0,0),this.direction=c||N.bh.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Jc"}setDirectionToTarget(Y){return this.direction=N.bh.Normalize(Y.Hh(N.bh.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Y,c){const h=N.bh.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",h.x,h.y,h.z,0,c),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Oc),c),this}transferToNodeMaterialEffect(Y,c){const h=N.bh.Normalize(this.direction);return Y.setFloat3(c,h.x,h.y,h.z),this}Kc(){return this._worldMatrix||(this._worldMatrix=N.Matrix.Identity()),this._worldMatrix}getTypeID(){return H.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Y,c){Y["HEMILIGHT"+c]=!0}}(0,C.b)([(0,E.k)()],W.prototype,"groundColor",void 0),(0,C.b)([(0,E.M)()],W.prototype,"direction",void 0),(0,w.e)("BABYLON.HemisphericLight",W)},14409:(Y,c,h)=>{"use strict";h.d(c,{e:()=>q});var C=h(12853),E=h(12859),N=h(12869),Q=h(13294),b=h(13422),H=h(13484),w=h(12848),W=h(12825);Q.c.AddNodeConstructor("Light_Type_2",((Y,c)=>()=>new q(Y,N.bh.Zero(),N.bh.Zero(),0,0,c)));class q extends H.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Y){this._iesProfileTexture!==Y&&(this._iesProfileTexture=Y,this._iesProfileTexture&&q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Y){this._angle=Y,this._cosHalfAngle=Math.cos(.5*Y),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Y){this._innerAngle=Y,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Y){this._shadowAngleScale=Y,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Y){this._projectionTextureLightNear=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Y){this._projectionTextureLightFar=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Y){this._projectionTextureUpDirection=Y,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Y){this._projectionTexture!==Y&&(this._projectionTexture=Y,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Y){return void 0!==Y.onGeneratedObservable}static _IsTexture(Y){return void 0!==Y.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Y){this._projectionTextureProjectionLightMatrix=Y,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Y,c,h,C,E,Q){super(Y,Q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=N.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.bh.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.bh.Zero(),this._projectionTextureViewLightMatrix=N.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=N.Matrix.Zero(),this._projectionTextureScalingMatrix=N.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=c,this.direction=h,this.angle=C,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return b.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(Y){super._setDirection(Y),this._projectionTextureViewLightDirty=!0}_setPosition(Y){super._setPosition(Y),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Y,c,h){const C=this.ZY().activeCamera;if(!C)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,Q=void 0!==this.shadowMinZ?this.shadowMinZ:C.ac,b=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,H=this.ZY().getEngine().o;N.Matrix.PerspectiveFovLHToRef(E,1,H?b:Q,H?Q:b,Y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,H)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Y=this.projectionTextureLightFar,c=this.projectionTextureLightNear,h=Y/(Y-c),C=-h*c,E=1/Math.tan(this._angle/2);N.Matrix.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,h,1,0,0,C,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof w.d){const Y=this._projectionTexture.uScale/2,c=this._projectionTexture.vScale/2;N.Matrix.FromValuesToRef(Y,0,0,0,0,c,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Y,c){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Y.setMatrix("textureProjectionMatrix"+c,this._projectionTextureMatrix),Y.setTexture("projectionLightTexture"+c,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Y.setTexture("iesLightTexture"+c,this._iesProfileTexture),this}transferToEffect(Y,c){let h;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,c),h=N.bh.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,c),h=N.bh.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",h.x,h.y,h.z,this._cosHalfAngle,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,c),this}transferToNodeMaterialEffect(Y,c){let h;return h=this.computeTransformedInformation()?N.bh.Normalize(this.transformedDirection):N.bh.Normalize(this.direction),this.ZY().useRightHandedSystem?Y.setFloat3(c,-h.x,-h.y,-h.z):Y.setFloat3(c,h.x,h.y,h.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Y){const c=this._scene.getEngine(),h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Y||void 0===Y?void 0:Y.ac)??0;return c.o&&c.isNDCHalfZRange?h:this._scene.getEngine().isNDCHalfZRange?0:h}getDepthMaxZ(Y){const c=this._scene.getEngine(),h=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Y||void 0===Y?void 0:Y.maxZ)??1e4;return c.o&&c.isNDCHalfZRange?0:h}prepareLightSpecificDefines(Y,c){Y["SPOTLIGHT"+c]=!0,Y["PROJECTEDLIGHTTEXTURE"+c]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Y["IESLIGHTTEXTURE"+c]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,C.b)([(0,E.N)()],q.prototype,"angle",null),(0,C.b)([(0,E.N)()],q.prototype,"innerAngle",null),(0,C.b)([(0,E.N)()],q.prototype,"shadowAngleScale",null),(0,C.b)([(0,E.N)()],q.prototype,"exponent",void 0),(0,C.b)([(0,E.N)()],q.prototype,"projectionTextureLightNear",null),(0,C.b)([(0,E.N)()],q.prototype,"projectionTextureLightFar",null),(0,C.b)([(0,E.N)()],q.prototype,"projectionTextureUpDirection",null),(0,C.b)([(0,E.G)("projectedLightTexture")],q.prototype,"_projectionTexture",void 0),(0,W.e)("BABYLON.SpotLight",q)},14109:(Y,c,h)=>{"use strict";h.d(c,{e:()=>Q,i:()=>N,l:()=>b});const C={},E={};function N(Y,c){C[Y]=c}function Q(Y,c){E[Y]=c}function b(Y){return E[Y]?E[Y]:null}},14022:(Y,c,h)=>{"use strict";h.d(c,{b:()=>Z,c:()=>n});var C,E=h(12687),N=h(12690),Q=h(13110),b=h(12722),H=h(12700),w=h(13337),W=h(12728),q=h(12733),k=h(12832),M=h(12761),p=h(12719);!function(Y){Y[Y.Clean=0]="Clean",Y[Y.Stop=1]="Stop",Y[Y.Sync=2]="Sync",Y[Y.NoSync=3]="NoSync"}(C||(C={}));const P=new N.c,y={};let d=!1;function D(){return y[".babylon"]}function T(Y,c){const h=y[Y];return h||(H.e.Warn("Unable to find a plugin to load "+Y+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),c?D():void 0)}function e(Y,c,h){let C="Unable to load from "+(Y.rawData?"binary data":Y.url);return c?C+=`: ${c}`:h&&(C+=`: ${h}`),C}async function r(Y,c,h,C,E,N,Q,b,H){var w;const q="data:"===(k=Y.url).substring(0,5)?k.substring(5):null;var k;if(Y.rawData&&!Q)throw"When using ArrayBufferView to load data the file extension must be provided.";const d=q||Q?"":function(Y){const c=Y.indexOf("?");-1!==c&&(Y=Y.substring(0,c));const h=Y.lastIndexOf(".");return Y.substring(h,Y.length).toLowerCase()}(Y.url);let e=Q?T(Q,!0):q?function(Y){for(const c in y){const h=y[c].plugin;if(h.canDirectLoad&&h.canDirectLoad(Y))return y[c]}return D()}(Y.url):T(d,!1);if(!e&&d){if(Y.url&&!Y.url.startsWith("blob:")){const c=await async function(Y,c){const h=c.method||"GET";return await new Promise(((C,E)=>{const N=new p.c;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const Y={};if(c.responseHeaders)for(const h of c.responseHeaders)Y[h]=N.getResponseHeader(h)||"";C({response:N.response,headerValues:Y})}else E(`Unable to fetch data from ${Y}. Error code: ${N.status}`)})),N.open(h,Y),N.send()}))}(Y.url,{method:"HEAD",responseHeaders:["Content-Type"]}),h=c.headerValues?c.headerValues["Content-Type"]:"";h&&(e=function(Y){for(const c in y){const h=y[c];if(h.mimeType===Y)return h}}(h))}e||(e=D())}if(!e)throw new Error(`No plugin or fallback for ${Q??Y.url}`);if(!1===(null===H||void 0===H||null===(w=H[e.plugin.name])||void 0===w?void 0:w.enabled))throw new Error(`The '${e.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Y.rawData&&!e.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Y=>{if(e.plugin.createPlugin){const c=e.plugin.createPlugin(H??{});return c instanceof Promise?(c.then(Y).catch((Y=>{E("Error instantiating plugin.",Y)})),null):(Y(c),c)}return Y(e.plugin),e.plugin})((H=>{var w;if(!H)throw`The loader plugin corresponding to the '${Q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(P.notifyObservers(H),q&&(H.canDirectLoad&&H.canDirectLoad(Y.url)||!(0,W.m)(Y.url))){if(H.directLoad){const Y=H.directLoad(c,q);Y instanceof Promise?Y.then((Y=>{h(H,Y)})).catch((Y=>{E("Error in directLoad of _loadData: "+Y,Y)})):h(H,Y)}else h(H,q);return}const k=e.isBinary,p=(Y,C)=>{c.q?E("Scene has been disposed"):h(H,Y,C)};let y=null,d=!1;null===(w=H.Mc)||void 0===w||w.add((()=>{d=!0,y&&(y.abort(),y=null),N()}));const D=()=>{if(d)return;const h=(Y,c)=>{E(null===Y||void 0===Y?void 0:Y.statusText,c)};if(!H.loadFile&&Y.rawData)throw"Plugin does not support loading ArrayBufferView.";y=H.loadFile?H.loadFile(c,Y.rawData||Y.file||Y.url,Y.rootUrl,p,C,k,h,b):c._loadFile(Y.file||Y.url,p,C,!0,k,h)},T=c.getEngine();let r=T.enableOfflineSupport;if(r){let h=!1;for(const C of c.disableOfflineSupportExceptionRules)if(C.test(Y.url)){h=!0;break}r=!h}r&&M.c.OfflineProviderFactory?c.offlineProvider=M.c.OfflineProviderFactory(Y.url,D,T.disableManifestCheck):D()}))}function X(Y,c){let h,C,N=null,Q=null;if(c)if(c.name)h=`file:${c.name}`,C=c.name,N=c;else if(ArrayBuffer.isView(c))h="",C=(0,k.e)(),Q=c;else if(c.startsWith("data:"))h=c,C="";else if(Y){const N=c;if("/"===N.substring(0,1))return E.Tools.Error("Wrong sceneFilename parameter"),null;h=Y+N,C=N}else h=c,C=E.Tools.GetFilename(c),Y=E.Tools.GetFolderPath(c);else h=Y,C=E.Tools.GetFilename(Y),Y=E.Tools.GetFolderPath(Y);return{url:h,rootUrl:Y,name:C,file:N,rawData:Q}}function Z(Y){if("string"===typeof Y.extensions){const c=Y.extensions;y[c.toLowerCase()]={plugin:Y,isBinary:!1}}else{const c=Y.extensions,h=Object.keys(c);for(const C of h)y[C.toLowerCase()]={plugin:Y,isBinary:c[C].isBinary,mimeType:c[C].mimeType}}}async function a(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.d.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!C)return H.e.Error("No scene available to import mesh to"),null;const M=X(c,h);if(!M)return null;const p={};C.addPendingData(p);const P=()=>{C.removePendingData(p)},y=(Y,c)=>{const h=e(M,Y,c);Q?Q(C,h,new q.h(h,q.g.SceneLoaderError,c)):H.e.Error(h),P()},d=N?Y=>{try{N(Y)}catch(c){y("Error in onProgress callback: "+c,c)}}:void 0,D=(Y,c,h,N,Q,b,H,w)=>{if(C.importedMeshesFiles.push(M.url),E)try{E(Y,c,h,N,Q,b,H,w)}catch(W){y("Error in onSuccess callback: "+W,W)}C.removePendingData(p)};return await r(M,C,((c,h,E)=>{if(c.rewriteRootURL&&(M.rootUrl=c.rewriteRootURL(M.rootUrl,E)),c.importMesh){const E=[],N=[],Q=[];if(!c.importMesh(Y,C,h,M.rootUrl,E,N,Q,y))return;C.loadingPluginName=c.name,D(E,N,Q,[],[],[],[],[])}else{c.importMeshAsync(Y,C,h,M.rootUrl,d,M.name).then((Y=>{C.loadingPluginName=c.name,D(Y.meshes,Y.OM,Y.skeletons,Y.animationGroups,Y.transformNodes,Y.geometries,Y.lights,Y.spriteManagers)})).catch((Y=>{y(Y.message,Y)}))}}),d,y,P,w,W,k)}async function G(Y,c,h,C,E,N,Q,b){return await new Promise(((H,w)=>{try{a(Y,c,h,C,((Y,c,h,C,E,N,Q,b)=>{H({meshes:Y,OM:c,skeletons:h,animationGroups:C,transformNodes:E,geometries:N,lights:Q,spriteManagers:b})}),E,((Y,c,h)=>{w(h||new Error(c))}),N,Q,b).catch(w)}catch(q){w(q)}}))}async function K(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedEngine,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,H=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};h?await s(Y,c,new Q.e(h),C,N,H,w,W,q):E.Tools.Error("No engine available")}async function I(Y,c,h,C,E,N,Q){return await new Promise(((b,H)=>{K(Y,c,h,(Y=>{b(Y)}),C,((Y,c,h)=>{H(h||new Error(c))}),E,N,Q)}))}async function s(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return H.e.Error("No scene available to append to"),null;const M=X(Y,c);if(!M)return null;const p={};h.addPendingData(p);const P=()=>{h.removePendingData(p)};w.d.ShowLoadingScreen&&!d&&(d=!0,h.getEngine().displayLoadingUI(),h.executeWhenReady((()=>{h.getEngine().hideLoadingUI(),d=!1})));const y=(Y,c)=>{const C=e(M,Y,c);N?N(h,C,new q.h(C,q.g.SceneLoaderError,c)):H.e.Error(C),P()},D=E?Y=>{try{E(Y)}catch(c){y("Error in onProgress callback",c)}}:void 0,T=()=>{if(C)try{C(h)}catch(Y){y("Error in onSuccess callback",Y)}h.removePendingData(p)};return await r(M,h,((Y,c)=>{if(Y.load){if(!Y.load(h,c,M.rootUrl,y))return;h.loadingPluginName=Y.name,T()}else{Y.loadAsync(h,c,M.rootUrl,D,M.name).then((()=>{h.loadingPluginName=Y.name,T()})).catch((Y=>{y(Y.message,Y)}))}}),D,y,P,Q,W,k)}async function x(Y,c,h,C,E,N,Q){return await new Promise(((b,H)=>{try{s(Y,c,h,(Y=>{b(Y)}),C,((Y,c,h)=>{H(h||new Error(c))}),E,N,Q).catch(H)}catch(q){H(q)}}))}async function A(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!h)return H.e.Error("No scene available to load asset container to"),null;const k=X(Y,c);if(!k)return null;const M={};h.addPendingData(M);const p=()=>{h.removePendingData(M)},P=(Y,c)=>{const C=e(k,Y,c);N?N(h,C,new q.h(C,q.g.SceneLoaderError,c)):H.e.Error(C),p()},y=E?Y=>{try{E(Y)}catch(c){P("Error in onProgress callback",c)}}:void 0,d=Y=>{if(C)try{C(Y)}catch(c){P("Error in onSuccess callback",c)}h.removePendingData(M)};return await r(k,h,((Y,c)=>{if(Y.loadAssetContainer){const C=Y.loadAssetContainer(h,c,k.rootUrl,P);if(!C)return;C.populateRootNodes(),h.loadingPluginName=Y.name,d(C)}else if(Y.loadAssetContainerAsync){Y.loadAssetContainerAsync(h,c,k.rootUrl,y,k.name).then((c=>{c.populateRootNodes(),h.loadingPluginName=Y.name,d(c)})).catch((Y=>{P(Y.message,Y)}))}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),y,P,p,Q,w,W)}async function V(Y,c,h,C,E,N,Q){return await new Promise(((b,H)=>{try{A(Y,c,h,(Y=>{b(Y)}),C,((Y,c,h)=>{H(h||new Error(c))}),E,N,Q).catch(H)}catch(q){H(q)}}))}async function U(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.d.LastCreatedScene,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!h)return void H.e.Error("No scene available to load animations to");if(C){for(const C of h.animatables)C.reset();h.stopAllAnimations();const Y=h.animationGroups.slice();for(const h of Y)h.dispose();const c=h.getNodes();for(const h of c)h.animations&&(h.animations=[])}else switch(E){case 0:const Y=h.animationGroups.slice();for(const c of Y)c.dispose();break;case 1:for(const c of h.animationGroups)c.stop();break;case 2:for(const c of h.animationGroups)c.reset(),c.restart();break;case 3:break;default:return void H.e.Error("Unknown animation group loading mode value '"+E+"'")}const p=h.animatables.length;await A(Y,c,h,(Y=>{Y.mergeAnimationsTo(h,h.animatables.slice(p),N),Y.dispose(),h.onAnimationFileImportedObservable.notifyObservers(h),Q&&Q(h)}),w,W,q,k,M)}async function l(Y,c,h,C,E,N,Q,b,H,w){return await new Promise(((W,k)=>{try{U(Y,c,h,C,E,N,(Y=>{W(Y)}),Q,((Y,c,h)=>{k(h||new Error(c))}),b,H,w).catch(k)}catch(q){k(q)}}))}class n{static get ForceFullSceneLoadingForIncremental(){return w.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Y){w.d.ForceFullSceneLoadingForIncremental=Y}static get ShowLoadingScreen(){return w.d.ShowLoadingScreen}static set ShowLoadingScreen(Y){w.d.ShowLoadingScreen=Y}static get loggingLevel(){return w.d.loggingLevel}static set loggingLevel(Y){w.d.loggingLevel=Y}static get CleanBoneMatrixWeights(){return w.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Y){w.d.CleanBoneMatrixWeights=Y}static GetDefaultPlugin(){return D()}static GetPluginForExtension(Y){var c;return null===(c=T(Y,!0))||void 0===c?void 0:c.plugin}static IsPluginForExtensionAvailable(Y){return function(Y){return!!y[Y]}(Y)}static RegisterPlugin(Y){Z(Y)}static ImportMesh(Y,c,h,C,E,N,Q,H,w){a(Y,c,h,C,E,N,Q,H,w).catch((Y=>null===Q||void 0===Q?void 0:Q(b.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async ImportMeshAsync(Y,c,h,C,E,N,Q){return await G(Y,c,h,C,E,N,Q)}static Load(Y,c,h,C,E,N,Q,H){K(Y,c,h,C,E,N,Q,H).catch((Y=>null===N||void 0===N?void 0:N(b.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async LoadAsync(Y,c,h,C,E,N){return await I(Y,c,h,C,E,N)}static Append(Y,c,h,C,E,N,Q,H){s(Y,c,h,C,E,N,Q,H).catch((Y=>null===N||void 0===N?void 0:N(h??b.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async AppendAsync(Y,c,h,C,E,N){return await x(Y,c,h,C,E,N)}static LoadAssetContainer(Y,c,h,C,E,N,Q,H){A(Y,c,h,C,E,N,Q,H).catch((Y=>null===N||void 0===N?void 0:N(h??b.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async LoadAssetContainerAsync(Y,c,h,C,E,N){return await V(Y,c,h,C,E,N)}static ImportAnimations(Y,c,h,C,E,N,Q,H,w,W,q){U(Y,c,h,C,E,N,Q,H,w,W,q).catch((Y=>null===w||void 0===w?void 0:w(h??b.d.LastCreatedScene,null===Y||void 0===Y?void 0:Y.message,Y)))}static async ImportAnimationsAsync(Y,c,h,C,E,N,Q,b,H,w,W){return await l(Y,c,h,C,E,N,b,w,W)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=P},14419:(Y,c,h)=>{"use strict";h.d(c,{b:()=>k});var C=h(12853),E=h(12859),N=h(12687),Q=h(12869),b=h(12890),H=h(12848),w=h(12825),W=h(12690),q=h(12906);h(14427);class k extends b.c{set boundingBoxSize(Y){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Y))return;this._boundingBoxSize=Y;const c=this.ZY();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Y){this._rotationY=Y,this.setReflectionTextureMatrix(Q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Y,c,h){let C="";for(const E of Y)C+=E;return new k(C,c,null,h,Y)}static CreateFromPrefilteredData(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=c.useDelayedTextureLoading;c.useDelayedTextureLoading=!1;const N=new k(Y,c,null,!1,null,null,null,void 0,!0,h,C);return c.useDelayedTextureLoading=E,N}constructor(Y,c){var h;let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13?arguments[13]:void 0,D=arguments.length>14?arguments[14]:void 0;super(c),this.onLoadObservable=new W.c,this.boundingBoxPosition=Q.bh.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Q.Matrix,this._buffer=null,this.name=Y,this.url=Y,this._noMipmap=E,this.Zc=!1,this.isCube=!0,this._textureMatrix=Q.Matrix.Identity(),this.coordinatesMode=H.d.CUBIC_MODE;let T=null,e=null;null===C||Array.isArray(C)?(this._noMipmap=E,this._format=q,this._createPolynomials=p,T=C,this._loaderOptions=d,this._useSRGBBuffer=D,this._lodScale=P,this._lodOffset=y):(T=C.extensions??null,this._noMipmap=C.noMipmap??!1,N=C.files??null,e=C.buffer??null,this._format=C.format??5,k=C.prefiltered??!1,M=C.forcedExtension??null,this._createPolynomials=C.createPolynomials??!1,this._lodScale=C.lodScale??.8,this._lodOffset=C.lodOffset??0,this._loaderOptions=C.loaderOptions,this._useSRGBBuffer=C.useSRGBBuffer,b=C.J??null,w=C.onError??null),(Y||N)&&this.updateURL(Y,M,b,k,w,T,null===(h=this.ZY())||void 0===h?void 0:h.useDelayedTextureLoading,N,e)}getClassName(){return"CubeTexture"}updateURL(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Y),this.url=Y,c&&(this._forcedExtension=c);const w=Y.lastIndexOf("."),W=c||(w>-1?Y.substring(w).toLowerCase():""),q=0===W.indexOf(".dds"),k=0===W.indexOf(".env"),M=0===W.indexOf(".basis");if(k?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=C,C&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),b)this._files=b;else if(M||k||q||N||(N=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,N){for(let c=0;c<N.length;c++)this._files.push(Y+N[c]);this._extensions=N}this._buffer=H,Q?(this.delayLoadState=4,this._delayedOnLoad=h,this._delayedOnError=E):this._loadTexture(h,E)}delayLoad(Y){4===this.delayLoadState&&(Y&&(this._forcedExtension=Y),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Y){var c,h;if(Y.updateFlag===this._textureMatrix.updateFlag)return;Y.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(h=this.ZY())||void 0===h||h.markAllMaterialsAsDirty(1,(Y=>-1!==Y.getActiveTextures().indexOf(this))));if(this._textureMatrix=Y,null===(c=this.ZY())||void 0===c||!c.useRightHandedSystem)return;const C=Q.TmpVectors.bh[0],E=Q.TmpVectors.Quaternion[0],N=Q.TmpVectors.bh[1];this._textureMatrix.decompose(C,E,N),E.z*=-1,E.w*=-1,Q.Matrix.ComposeToRef(C,E,N,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Y;return null!==(Y=this.ZY())&&void 0!==Y&&Y.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this.ZY(),C=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var c;(this.onLoadObservable.notifyObservers(this),C)&&(C.dispose(),null===(c=this.ZY())||void 0===c||c.markAllMaterialsAsDirty(1));Y&&Y()},Q=(Y,h)=>{this._loadingError=!0,this._errorObject={message:Y,exception:h},c&&c(Y,h),H.d.OnTextureLoadErrorObservable.notifyObservers(this)};var b;this._texture?this._texture.isReady?N.Tools.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,h,this._lodScale,this._lodOffset,Y,Q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,h,this._files,this._noMipmap,Y,Q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(b=this._texture)||void 0===b||b.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Y,c,h){const C=q.d.Parse((()=>{let C=!1;return Y.prefiltered&&(C=Y.prefiltered),new k(h+(Y.url??Y.name),c,Y.extensions,!1,Y.files||null,null,null,void 0,C,Y.forcedExtension)}),Y,c);if(Y.boundingBoxPosition&&(C.boundingBoxPosition=Q.bh.dh(Y.boundingBoxPosition)),Y.boundingBoxSize&&(C.boundingBoxSize=Q.bh.dh(Y.boundingBoxSize)),Y.animations)for(let E=0;E<Y.animations.length;E++){const c=Y.animations[E],h=(0,w.d)("BABYLON.Animation");h&&C.animations.push(h.Parse(c))}return C}clone(){let Y=0;const c=q.d.Clone((()=>{const c=new k(this.url,this.ZY()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Y=c.uniqueId,c}),this);return c.uniqueId=Y,c}}(0,C.b)([(0,E.N)()],k.prototype,"url",void 0),(0,C.b)([(0,E.M)()],k.prototype,"boundingBoxPosition",void 0),(0,C.b)([(0,E.M)()],k.prototype,"boundingBoxSize",null),(0,C.b)([(0,E.N)("rotationY")],k.prototype,"rotationY",null),(0,C.b)([(0,E.N)("files")],k.prototype,"_files",void 0),(0,C.b)([(0,E.N)("forcedExtension")],k.prototype,"_forcedExtension",void 0),(0,C.b)([(0,E.N)("extensions")],k.prototype,"_extensions",void 0),(0,C.b)([(0,E.y)("textureMatrix")],k.prototype,"_textureMatrix",void 0),(0,C.b)([(0,E.y)("textureMatrixRefraction")],k.prototype,"_textureMatrixRefraction",void 0),H.d._CubeTextureParser=k.Parse,(0,w.e)("BABYLON.CubeTexture",k)},15135:(Y,c,h)=>{"use strict";h.d(c,{d:()=>H});var C=h(12700),E=h(12848),N=h(12836),Q=h(13010),b=h(12805);Q.ThinEngine.prototype.createDynamicTexture=function(Y,c,h,C){const E=new b.c(this,4);return E.baseWidth=Y,E.baseHeight=c,h&&(Y=this.needPOTTextures?(0,N.f)(Y,this._caps.maxTextureSize):Y,c=this.needPOTTextures?(0,N.f)(c,this._caps.maxTextureSize):c),E.width=Y,E.height=c,E.isReady=!1,E.generateMipMaps=h,E.samplingMode=C,this.updateTextureSamplingMode(C,E),this._internalTexturesCache.push(E),E},Q.ThinEngine.prototype.updateDynamicTexture=function(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Y)return;const Q=this._gl,b=Q.TEXTURE_2D,H=this._bindTextureDirectly(b,Y,!0,N);this._unpackFlipY(void 0===h?Y.invertY:h),C&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const w=this._getWebGLTextureType(Y.type),W=this._getInternalFormat(E||Y.format),q=this._getRGBABufferInternalSizedFormat(Y.type,W);Q.texImage2D(b,0,q,W,w,c),Y.generateMipMaps&&Q.generateMipmap(b),H||this._bindTextureDirectly(b,null),C&&Q.pixelStorei(Q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(Y.format=E),Y._dynamicTextureSource=c,Y._premulAlpha=C,Y.invertY=h||!1,Y.isReady=!0};class H extends E.d{constructor(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,b=arguments.length>6?arguments[6]:void 0;const H=!h||h._isScene;super(null,H?h:null===h||void 0===h?void 0:h.wh,H?!C:h,b,N,void 0,void 0,void 0,void 0,Q),this.name=Y,this.wrapU=E.d.CLAMP_ADDRESSMODE,this.wrapV=E.d.CLAMP_ADDRESSMODE,this._generateMipMaps=C;const w=this._getEngine();if(!w)return;if(c.getContext)this._canvas=c,this._ownCanvas=!1,this._texture=w.createDynamicTexture(this._canvas.width,this._canvas.height,C,N);else{this._canvas=w.createCanvas(1,1),this._ownCanvas=!0;const Y=c;Y.width||0===Y.width?this._texture=w.createDynamicTexture(Y.width,Y.height,C,N):this._texture=w.createDynamicTexture(c,c,C,N)}const W=this.getSize();this._canvas.width!==W.width&&(this._canvas.width=W.width),this._canvas.height!==W.height&&(this._canvas.height=W.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Y){this._canvas.width=Y.width,this._canvas.height=Y.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Y.width,Y.height,this._generateMipMaps,this.samplingMode)}scale(Y){const c=this.getSize();c.width*=Y,c.height*=Y,this._recreate(c)}scaleTo(Y,c){const h=this.getSize();h.width=Y,h.height=c,this._recreate(h)}getContext(){return this._context}clear(Y){const c=this.getSize();Y&&(this._context.fillStyle=Y),this._context.clearRect(0,0,c.width,c.height)}update(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Y||Y,c,this._format||void 0,void 0,h)}drawText(Y,c,h,C,E,N,Q){let b=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const H=this.getSize();if(N&&(this._context.fillStyle=N,this._context.fillRect(0,0,H.width,H.height)),this._context.font=C,null===c||void 0===c){const h=this._context.measureText(Y);c=(H.width-h.width)/2}if(null===h||void 0===h){const Y=parseInt(C.replace(/\D/g,""));h=H.height/2+Y/3.65}this._context.fillStyle=E||"",this._context.fillText(Y,c,h),b&&this.update(Q)}dispose(){var Y,c;(super.dispose(),this._ownCanvas)&&(null===(Y=this._canvas)||void 0===Y||null===(c=Y.remove)||void 0===c||c.call(Y));this._canvas=null,this._context=null}clone(){const Y=this.ZY();if(!Y)return this;const c=this.getSize(),h=new H(this.name,c,Y,this._generateMipMaps);return h.Zc=this.Zc,h.level=this.level,h.wrapU=this.wrapU,h.wrapV=this.wrapV,h}serialize(){const Y=this.ZY();Y&&!Y.isReady()&&C.e.Warn("The scene must be ready before serializing the dynamic texture");const c=super.serialize();return H._IsCanvasElement(this._canvas)&&(c.base64String=this._canvas.toDataURL()),c.invertY=this._invertY,c.samplingMode=this.samplingMode,c}static _IsCanvasElement(Y){return void 0!==Y.toDataURL}_rebuild(){this.update()}}},14327:(Y,c,h)=>{"use strict";h.d(c,{c:()=>E});var C=h(12848);class E extends C.d{get depth(){return this._depth}constructor(Y,c,h,E,N,Q){let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:C.d.TRILINEAR_SAMPLINGMODE,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,q=arguments.length>10?arguments[10]:void 0;super(null,Q,!b,H),this.format=N,this._texture=Q.getEngine().createRawTexture2DArray(Y,c,h,E,N,b,H,w,null,W,q),this._depth=E,this.is2DArray=!0}update(Y){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Y,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Y,c,h,C,N){return new E(Y,c,h,C,5,N,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14131:(Y,c,h)=>{"use strict";h.d(c,{b:()=>b,f:()=>H,g:()=>N,k:()=>Q});var C=h(12883),E=h(12869);function N(Y,c){return`{X: ${Y.x.toFixed(c)} Y: ${Y.y.toFixed(c)}}`}function Q(Y,c){return`{X: ${Y._x.toFixed(c)} Y: ${Y._y.toFixed(c)} Z: ${Y._z.toFixed(c)}}`}function b(Y,c){return 2*Math.acos((0,C.Clamp)(E.Quaternion.Dot(Y,c)))}function H(Y,c){const h=new E.Quaternion;return function(Y,c,h){const N=E.bh.Cross(Y,c),Q=Math.acos((0,C.Clamp)(E.bh.Dot(Y,c),-1,1));E.Quaternion.RotationAxisToRef(N,Q,h)}(Y,c,h),h}},13967:(Y,c,h)=>{"use strict";h.d(c,{c:()=>w});var C=h(12869),E=h(12920),N=h(13321),Q=h(13305),b=h(12934);h(13974);function H(Y){let c=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],N=[];let H=[];const w=Y.width||Y.size||1,W=Y.height||Y.size||1,q=Y.depth||Y.size||1,k=Y.wrap||!1;let M=void 0===Y.topBaseAt?1:Y.topBaseAt,p=void 0===Y.bottomBaseAt?0:Y.bottomBaseAt;M=(M+4)%4,p=(p+4)%4;let P=[2,0,3,1][M],y=[2,0,1,3][p],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(k){c=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],h=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const C=[17,18,19,16],E=[22,23,20,21];for(;P>0;)Y.unshift(Y.pop()),C.unshift(C.pop()),P--;for(;y>0;)h.unshift(h.pop()),E.unshift(E.pop()),y--;Y=Y.flat(),h=h.flat(),d=d.concat(Y).concat(h),c.push(C[0],C[2],C[3],C[0],C[1],C[2]),c.push(E[0],E[2],E[3],E[0],E[1],E[2])}const D=[w/2,W/2,q/2];H=d.reduce(((Y,c,h)=>Y.concat(c*D[h%3])),[]);const T=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,e=Y.faceUV||new Array(6),r=Y.faceColors,X=[];for(let Q=0;Q<6;Q++)void 0===e[Q]&&(e[Q]=new C.Vector4(0,0,1,1)),r&&void 0===r[Q]&&(r[Q]=new E.vc(1,1,1,1));for(let C=0;C<6;C++)if(N.push(e[C].z,b.d?1-e[C].w:e[C].w),N.push(e[C].x,b.d?1-e[C].w:e[C].w),N.push(e[C].x,b.d?1-e[C].y:e[C].y),N.push(e[C].z,b.d?1-e[C].y:e[C].y),r)for(let Y=0;Y<4;Y++)X.push(r[C].r,r[C].g,r[C].b,r[C].a);Q.b._ComputeSides(T,H,c,h,N,Y.frontUVs,Y.backUVs);const Z=new Q.b;if(Z.indices=c,Z.GY=H,Z.KY=h,Z.sY=N,r){const Y=T===Q.b.DOUBLESIDE?X.concat(X):X;Z.IY=Y}return Z}function w(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new N.e(Y,h);c.sideOrientation=N.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return H(c).AY(C,c.updatable),C}Q.b.CreateBox=H,N.e.CreateBox=function(Y,c){return w(Y,{size:c,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14115:(Y,c,h)=>{"use strict";h.d(c,{e:()=>b});var C=h(13321),E=h(13305),N=h(12934);function Q(Y){const c=[],h=[],C=[],Q=[],b=Y.radius||.5,H=Y.tessellation||64,w=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,W=0===Y.sideOrientation?0:Y.sideOrientation||E.b.DEFAULTSIDE;c.push(0,0,0),Q.push(.5,.5);const q=2*Math.PI*w,k=1===w?q/H:q/(H-1);let M=0;for(let E=0;E<H;E++){const Y=Math.cos(M),h=Math.sin(M),C=(Y+1)/2,E=(1-h)/2;c.push(b*Y,b*h,0),Q.push(C,N.d?1-E:E),M+=k}1===w&&(c.push(c[3],c[4],c[5]),Q.push(Q[2],N.d?1-Q[3]:Q[3]));const p=c.length/3;for(let E=1;E<p-1;E++)h.push(E+1,0,E);E.b.ComputeNormals(c,h,C),E.b._ComputeSides(W,c,h,C,Q,Y.frontUVs,Y.backUVs);const P=new E.b;return P.indices=h,P.GY=c,P.KY=C,P.sY=Q,P}function b(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new C.e(Y,h);c.sideOrientation=C.e._GetDefaultSideOrientation(c.sideOrientation),E._originalBuilderSideOrientation=c.sideOrientation;return Q(c).AY(E,c.updatable),E}E.b.CreateDisc=Q,C.e.CreateDisc=function(Y,c,h){return b(Y,{radius:c,tessellation:h,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13974:(Y,c,h)=>{"use strict";h.d(c,{f:()=>y,c:()=>D,h:()=>d});var C=h(12869),E=h(12920),N=h(13321),Q=h(13305),b=h(12951);N.e._GroundMeshParser=(Y,c)=>H.Parse(Y,c);class H extends N.e{constructor(Y,c){super(Y,c),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Y,this._subdivisionsY=Y,this.subdivide(Y);const h=this;h.createOrUpdateSubmeshesOctree&&h.createOrUpdateSubmeshesOctree(c)}getHeightAtCoordinates(Y,c){const h=this.getWorldMatrix(),E=C.TmpVectors.Matrix[5];h.invertToRef(E);const N=C.TmpVectors.bh[8];if(C.bh.TransformCoordinatesFromFloatsToRef(Y,0,c,E,N),Y=N.x,c=N.z,Y<this._minX||Y>=this._maxX||c<=this._minZ||c>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Q=this._getFacetAt(Y,c),b=-(Q.x*Y+Q.z*c+Q.w)/Q.y;return C.bh.TransformCoordinatesFromFloatsToRef(0,b,0,h,N),N.y}getNormalAtCoordinates(Y,c){const h=new C.bh(0,1,0);return this.getNormalAtCoordinatesToRef(Y,c,h),h}getNormalAtCoordinatesToRef(Y,c,h){const E=this.getWorldMatrix(),N=C.TmpVectors.Matrix[5];E.invertToRef(N);const Q=C.TmpVectors.bh[8];if(C.bh.TransformCoordinatesFromFloatsToRef(Y,0,c,N,Q),Y=Q.x,c=Q.z,Y<this._minX||Y>this._maxX||c<this._minZ||c>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const b=this._getFacetAt(Y,c);return C.bh.TransformNormalFromFloatsToRef(b.x,b.y,b.z,E,h),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Y,c){const h=Math.floor((Y+this._maxX)*this._subdivisionsX/this._width),C=Math.floor(-(c+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[C*this._subdivisionsX+h];let N;return N=c<E.slope.x*Y+E.slope.y?E.facet1:E.facet2,N}_initHeightQuads(){const Y=this._subdivisionsX,c=this._subdivisionsY;this._heightQuads=[];for(let h=0;h<c;h++)for(let c=0;c<Y;c++){const E={slope:C.Vector2.Zero(),facet1:new C.Vector4(0,0,0,0),facet2:new C.Vector4(0,0,0,0)};this._heightQuads[h*Y+c]=E}return this}_computeHeightQuads(){const Y=this.getVerticesData(b.f.PositionKind);if(!Y)return this;const c=C.TmpVectors.bh[3],h=C.TmpVectors.bh[2],E=C.TmpVectors.bh[1],N=C.TmpVectors.bh[0],Q=C.TmpVectors.bh[4],H=C.TmpVectors.bh[5],w=C.TmpVectors.bh[6],W=C.TmpVectors.bh[7],q=C.TmpVectors.bh[8];let k=0,M=0,p=0,P=0,y=0,d=0,D=0;const T=this._subdivisionsX,e=this._subdivisionsY;for(let b=0;b<e;b++)for(let e=0;e<T;e++){k=3*e,M=b*(T+1)*3,p=(b+1)*(T+1)*3,c.x=Y[M+k],c.y=Y[M+k+1],c.z=Y[M+k+2],h.x=Y[M+k+3],h.y=Y[M+k+4],h.z=Y[M+k+5],E.x=Y[p+k],E.y=Y[p+k+1],E.z=Y[p+k+2],N.x=Y[p+k+3],N.y=Y[p+k+4],N.z=Y[p+k+5],P=(N.z-c.z)/(N.x-c.x),y=c.z-P*c.x,h.subtractToRef(c,Q),E.subtractToRef(c,H),N.subtractToRef(c,w),C.bh.CrossToRef(w,H,W),C.bh.CrossToRef(Q,w,q),W.normalize(),q.normalize(),d=-(W.x*c.x+W.y*c.y+W.z*c.z),D=-(q.x*h.x+q.y*h.y+q.z*h.z);const r=this._heightQuads[b*T+e];r.slope.Vc(P,y),r.facet1.Vc(W.x,W.y,W.z,d),r.facet2.Vc(q.x,q.y,q.z,D)}return this}serialize(Y){super.serialize(Y),Y.subdivisionsX=this._subdivisionsX,Y.subdivisionsY=this._subdivisionsY,Y.minX=this._minX,Y.maxX=this._maxX,Y.ac=this._minZ,Y.maxZ=this._maxZ,Y.width=this._width,Y.height=this._height}static Parse(Y,c){const h=new H(Y.name,c);return h._subdivisionsX=Y.subdivisionsX||1,h._subdivisionsY=Y.subdivisionsY||1,h._minX=Y.minX,h._maxX=Y.maxX,h._minZ=Y.ac,h._maxZ=Y.maxZ,h._width=Y.width,h._height=Y.height,h}}var w=h(12687),W=h(12722),q=h(12874),k=h(12934);function M(Y){const c=[],h=[],E=[],N=[];let b,H;const w=Y.width||Y.size||1,W=Y.height||Y.size||1,q=0|(Y.subdivisionsX||Y.subdivisions||1),M=0|(Y.subdivisionsY||Y.subdivisions||1);for(b=0;b<=M;b++)for(H=0;H<=q;H++){const Y=new C.bh(H*w/q-w/2,0,(M-b)*W/M-W/2),c=new C.bh(0,1,0);h.push(Y.x,Y.y,Y.z),E.push(c.x,c.y,c.z),N.push(H/q,k.d?b/M:1-b/M)}for(b=0;b<M;b++)for(H=0;H<q;H++)c.push(H+1+(b+1)*(q+1)),c.push(H+1+b*(q+1)),c.push(H+b*(q+1)),c.push(H+(b+1)*(q+1)),c.push(H+1+(b+1)*(q+1)),c.push(H+b*(q+1));const p=new Q.b;return p.indices=c,p.GY=h,p.KY=E,p.sY=N,p}function p(Y){const c=void 0!==Y.xmin&&null!==Y.xmin?Y.xmin:-1,h=void 0!==Y.zmin&&null!==Y.zmin?Y.zmin:-1,E=void 0!==Y.xmax&&null!==Y.xmax?Y.xmax:1,N=void 0!==Y.zmax&&null!==Y.zmax?Y.zmax:1,b=Y.subdivisions||{w:1,h:1},H=Y.precision||{w:1,h:1},w=[],W=[],q=[],k=[];let M,p,P,y;b.h=b.h<1?1:b.h,b.w=b.w<1?1:b.w,H.w=H.w<1?1:H.w,H.h=H.h<1?1:H.h;const d=(E-c)/b.w,D=(N-h)/b.h;function T(Y,c,h,E){const N=W.length/3,Q=H.w+1;for(M=0;M<H.h;M++)for(p=0;p<H.w;p++){const Y=[N+p+M*Q,N+(p+1)+M*Q,N+(p+1)+(M+1)*Q,N+p+(M+1)*Q];w.push(Y[1]),w.push(Y[2]),w.push(Y[3]),w.push(Y[0]),w.push(Y[1]),w.push(Y[3])}const b=C.bh.Zero(),P=new C.bh(0,1,0);for(M=0;M<=H.h;M++)for(b.z=M*(E-c)/H.h+c,p=0;p<=H.w;p++)b.x=p*(h-Y)/H.w+Y,b.y=0,W.push(b.x,b.y,b.z),q.push(P.x,P.y,P.z),k.push(p/H.w,M/H.h)}for(P=0;P<b.h;P++)for(y=0;y<b.w;y++)T(c+y*d,h+P*D,c+(y+1)*d,h+(P+1)*D);const e=new Q.b;return e.indices=w,e.GY=W,e.KY=q,e.sY=k,e}function P(Y){const c=[],h=[],N=[],b=[];let H,w;const W=Y.colorFilter||new E.ph(.3,.59,.11),k=Y.alphaFilter||0;let M=!1;if(Y.minHeight>Y.maxHeight){M=!0;const c=Y.maxHeight;Y.maxHeight=Y.minHeight,Y.minHeight=c}for(H=0;H<=Y.subdivisions;H++)for(w=0;w<=Y.subdivisions;w++){const c=new C.bh(w*Y.width/Y.subdivisions-Y.width/2,0,(Y.subdivisions-H)*Y.height/Y.subdivisions-Y.height/2),E=4*(((c.x+Y.width/2)/Y.width*(Y.bufferWidth-1)|0)+((1-(c.z+Y.height/2)/Y.height)*(Y.bufferHeight-1)|0)*Y.bufferWidth);let Q=Y.buffer[E]/255,p=Y.buffer[E+1]/255,P=Y.buffer[E+2]/255;const y=Y.buffer[E+3]/255;M&&(Q=1-Q,p=1-p,P=1-P);const d=Q*W.r+p*W.g+P*W.b;c.y=y>=k?Y.minHeight+(Y.maxHeight-Y.minHeight)*d:Y.minHeight-q.d,Y.heightBuffer&&(Y.heightBuffer[H*(Y.subdivisions+1)+w]=c.y),h.push(c.x,c.y,c.z),N.push(0,0,0),b.push(w/Y.subdivisions,1-H/Y.subdivisions)}for(H=0;H<Y.subdivisions;H++)for(w=0;w<Y.subdivisions;w++){const C=w+1+(H+1)*(Y.subdivisions+1),E=w+1+H*(Y.subdivisions+1),N=w+H*(Y.subdivisions+1),Q=w+(H+1)*(Y.subdivisions+1),b=h[3*C+1]>=Y.minHeight,W=h[3*E+1]>=Y.minHeight,q=h[3*N+1]>=Y.minHeight;b&&W&&q&&(c.push(C),c.push(E),c.push(N));h[3*Q+1]>=Y.minHeight&&b&&q&&(c.push(Q),c.push(C),c.push(N))}Q.b.ComputeNormals(h,c,N);const p=new Q.b;return p.indices=c,p.GY=h,p.KY=N,p.sY=b,p}function y(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const h=new H(Y,arguments.length>2?arguments[2]:void 0);h._setReady(!1),h._subdivisionsX=c.subdivisionsX||c.subdivisions||1,h._subdivisionsY=c.subdivisionsY||c.subdivisions||1,h._width=c.width||1,h._height=c.height||1,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ;return M(c).AY(h,c.updatable),h._setReady(!0),h}function d(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new N.e(Y,h);return p(c).AY(C,c.updatable),C}function D(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=h.width||10,Q=h.height||10,b=h.subdivisions||1,q=h.minHeight||0,k=h.maxHeight||1,M=h.colorFilter||new E.ph(.3,.59,.11),p=h.alphaFilter||0,y=h.updatable,d=h.onReady;C=C||W.d.LastCreatedScene;const D=new H(Y,C);let T;D._subdivisionsX=b,D._subdivisionsY=b,D._width=N,D._height=Q,D._maxX=D._width/2,D._maxZ=D._height/2,D._minX=-D._maxX,D._minZ=-D._maxZ,D._setReady(!1),h.passHeightBufferInCallback&&(T=new Float32Array((b+1)*(b+1)));const e=(Y,c,h)=>{P({width:N,height:Q,subdivisions:b,minHeight:q,maxHeight:k,colorFilter:M,buffer:Y,bufferWidth:c,bufferHeight:h,alphaFilter:p,heightBuffer:T}).AY(D,y),d&&d(D,T),D._setReady(!0)};if("string"===typeof c){const Y=Y=>{var c;const h=Y.width,E=Y.height;if(C.q)return;const N=null===(c=C)||void 0===c?void 0:c.getEngine().resizeImageBitmap(Y,h,E);e(N,h,E)};w.Tools.LoadImage(c,Y,h.onError?h.onError:()=>{},C.offlineProvider)}else e(c.data,c.width,c.height);return D}Q.b.CreateGround=M,Q.b.CreateTiledGround=p,Q.b.CreateGroundFromHeightMap=P,N.e.CreateGround=(Y,c,h,C,E,N)=>y(Y,{width:c,height:h,subdivisions:C,updatable:N},E),N.e.CreateTiledGround=(Y,c,h,C,E,N,Q,b,H)=>d(Y,{xmin:c,zmin:h,xmax:C,zmax:E,subdivisions:N,precision:Q,updatable:H},b),N.e.CreateGroundFromHeightMap=(Y,c,h,C,E,N,Q,b,H,w,W)=>D(Y,c,{width:h,height:C,subdivisions:E,minHeight:N,maxHeight:Q,updatable:H,onReady:w,alphaFilter:W},b)},14663:(Y,c,h)=>{"use strict";h.d(c,{c:()=>M,d:()=>q,e:()=>k});var C=h(12869),E=h(13321),N=h(13305),Q=h(13428),b=h(12951),H=h(12700);function w(Y){const c=[],h=[],C=Y.lines,E=Y.IY,Q=[];let b=0;for(let N=0;N<C.length;N++){const Y=C[N];for(let C=0;C<Y.length;C++){const{x:H,y:w,z:W}=Y[C];if(h.push(H,w,W),E){const Y=E[N],{r:c,g:h,b:b,a:H}=Y[C];Q.push(c,h,b,H)}C>0&&(c.push(b-1),c.push(b)),b++}}const H=new N.b;return H.indices=c,H.GY=h,E&&(H.IY=Q),H}function W(Y){const c=Y.dashSize||3,h=Y.gapSize||1,E=Y.dashNb||200,Q=Y.points,b=[],H=[],w=C.bh.Zero();let W=0,q=0,k=0,M=0,p=0,P=0,y=0;for(y=0;y<Q.length-1;y++)Q[y+1].subtractToRef(Q[y],w),W+=w.length();for(k=W/E,M=c*k/(c+h),y=0;y<Q.length-1;y++){Q[y+1].subtractToRef(Q[y],w),q=Math.floor(w.length()/k),w.normalize();for(let Y=0;Y<q;Y++)p=k*Y,b.push(Q[y].x+p*w.x,Q[y].y+p*w.y,Q[y].z+p*w.z),b.push(Q[y].x+(p+M)*w.x,Q[y].y+(p+M)*w.y,Q[y].z+(p+M)*w.z),H.push(P,P+1),P+=2}const d=new N.b;return d.GY=b,d.indices=H,d}function q(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=c.instance,E=c.lines,N=c.IY;if(C){const Y=C.getVerticesData(b.f.PositionKind);let c,h;N&&(c=C.getVerticesData(b.f.ColorKind));let Q=0,H=0;for(let C=0;C<E.length;C++){const b=E[C];for(let E=0;E<b.length;E++)Y[Q]=b[E].x,Y[Q+1]=b[E].y,Y[Q+2]=b[E].z,N&&c&&(h=N[C],c[H]=h[E].r,c[H+1]=h[E].g,c[H+2]=h[E].b,c[H+3]=h[E].a,H+=4),Q+=3}return C.updateVerticesData(b.f.PositionKind,Y,!1,!1),N&&c&&C.updateVerticesData(b.f.ColorKind,c,!1,!1),C.refreshBoundingInfo(),C}const H=!!N,W=new Q.e(Y,h,null,void 0,void 0,H,c.useVertexAlpha,c.material);return w(c).AY(W,c.updatable),W}function k(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=c.IY?[c.IY]:null;return q(Y,{lines:[c.points],updatable:c.updatable,instance:c.instance,IY:C,useVertexAlpha:c.useVertexAlpha,material:c.material},h)}function M(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.points,b=c.instance,w=c.gapSize||1,q=c.dashSize||3;if(b){const Y=Y=>{const c=C.bh.Zero(),h=Y.length/6;let E=0,Q=0,H=0,w=0,W=0,q=0,k=0,M=0;for(k=0;k<N.length-1;k++)N[k+1].subtractToRef(N[k],c),E+=c.length();H=E/h;const p=b._creationDataStorage.dashSize;for(w=p*H/(p+b._creationDataStorage.gapSize),k=0;k<N.length-1;k++)for(N[k+1].subtractToRef(N[k],c),Q=Math.floor(c.length()/H),c.normalize(),M=0;M<Q&&q<Y.length;)W=H*M,Y[q]=N[k].x+W*c.x,Y[q+1]=N[k].y+W*c.y,Y[q+2]=N[k].z+W*c.z,Y[q+3]=N[k].x+(W+w)*c.x,Y[q+4]=N[k].y+(W+w)*c.y,Y[q+5]=N[k].z+(W+w)*c.z,q+=6,M++;for(;q<Y.length;)Y[q]=N[k].x,Y[q+1]=N[k].y,Y[q+2]=N[k].z,q+=3};return(c.dashNb||c.dashSize||c.gapSize||c.useVertexAlpha||c.material)&&H.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),b.updateMeshPositions(Y,!1),b}const k=new Q.e(Y,h,null,void 0,void 0,void 0,c.useVertexAlpha,c.material);return W(c).AY(k,c.updatable),k._creationDataStorage=new E.g,k._creationDataStorage.dashSize=q,k._creationDataStorage.gapSize=w,k}N.b.CreateLineSystem=w,N.b.CreateDashedLines=W,E.e.Qq=function(Y,c){return k(Y,{points:c,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.e.CreateDashedLines=function(Y,c,h,C,E){return M(Y,{points:c,dashSize:h,gapSize:C,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14026:(Y,c,h)=>{"use strict";h.d(c,{e:()=>b,i:()=>H});var C=h(13321),E=h(13305),N=h(12934);function Q(Y){const c=[],h=[],C=[],Q=[],b=void 0!==Y.width?Y.width:void 0!==Y.size?Y.size:1,H=void 0!==Y.height?Y.height:void 0!==Y.size?Y.size:1,w=0===Y.sideOrientation?0:Y.sideOrientation||E.b.DEFAULTSIDE,W=b/2,q=H/2;h.push(-W,-q,0),C.push(0,0,-1),Q.push(0,N.d?1:0),h.push(W,-q,0),C.push(0,0,-1),Q.push(1,N.d?1:0),h.push(W,q,0),C.push(0,0,-1),Q.push(1,N.d?0:1),h.push(-W,q,0),C.push(0,0,-1),Q.push(0,N.d?0:1),c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),E.b._ComputeSides(w,h,c,C,Q,Y.frontUVs,Y.backUVs);const k=new E.b;return k.indices=c,k.GY=h,k.KY=C,k.sY=Q,k}function b(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new C.e(Y,h);c.sideOrientation=C.e._GetDefaultSideOrientation(c.sideOrientation),E._originalBuilderSideOrientation=c.sideOrientation;return Q(c).AY(E,c.updatable),c.sourcePlane&&(E.translate(c.sourcePlane.normal,-c.sourcePlane.d),E.setDirection(c.sourcePlane.normal.scale(-1))),E}const H={wq:b};E.b.wq=Q,C.e.wq=(Y,c,h,C,E)=>b(Y,{size:c,width:c,height:c,sideOrientation:E,updatable:C},h)},14107:(Y,c,h)=>{"use strict";h.d(c,{b:()=>H});var C=h(12869),E=h(13321),N=h(13305),Q=h(12934);function b(Y){const c=0|(Y.segments||32),h=Y.diameterX||Y.diameter||1,E=Y.diameterY||Y.diameter||1,b=Y.diameterZ||Y.diameter||1,H=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,w=Y.slice&&Y.slice<=0?1:Y.slice||1,W=0===Y.sideOrientation?0:Y.sideOrientation||N.b.DEFAULTSIDE,q=!!Y.dedupTopBottomIndices,k=new C.bh(h/2,E/2,b/2),M=2+c,p=2*M,P=[],y=[],d=[],D=[];for(let N=0;N<=M;N++){const Y=N/M,c=Y*Math.PI*w;for(let h=0;h<=p;h++){const E=h/p,N=E*Math.PI*2*H,b=C.Matrix.RotationZ(-c),w=C.Matrix.RotationY(N),W=C.bh.TransformCoordinates(C.bh.Up(),b),q=C.bh.TransformCoordinates(W,w),M=q.multiply(k),P=q.divide(k).normalize();y.push(M.x,M.y,M.z),d.push(P.x,P.y,P.z),D.push(E,Q.d?1-Y:Y)}if(N>0){const Y=y.length/3;for(let c=Y-2*(p+1);c+p+2<Y;c++)q?(N>1&&(P.push(c),P.push(c+1),P.push(c+p+1)),(N<M||w<1)&&(P.push(c+p+1),P.push(c+1),P.push(c+p+2))):(P.push(c),P.push(c+1),P.push(c+p+1),P.push(c+p+1),P.push(c+1),P.push(c+p+2))}}N.b._ComputeSides(W,y,P,d,D,Y.frontUVs,Y.backUVs);const T=new N.b;return T.indices=P,T.GY=y,T.KY=d,T.sY=D,T}function H(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return b(c).AY(C,c.updatable),C}N.b.CreateSphere=b,E.e.CreateSphere=(Y,c,h,C,E,N)=>H(Y,{segments:c,diameterX:h,diameterY:h,diameterZ:h,sideOrientation:N,updatable:E},C)},15150:(Y,c,h)=>{"use strict";h.d(c,{c:()=>b});var C=h(13451),E=h(14431),N=h(13473),Q=h(13305);class b{static get Configuration(){return{get decoder(){return E.e.DefaultConfiguration},set decoder(Y){E.e.DefaultConfiguration=Y}}}static set Configuration(Y){E.e.DefaultConfiguration=Y.decoder}static get DecoderAvailable(){return(0,C.l)(E.e.DefaultConfiguration)}static get Default(){return b._Default??(b._Default=new b),b._Default}static ResetDefault(Y){b._Default&&(Y||b._Default.dispose(),b._Default=null)}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultNumWorkers;const c="number"===typeof Y?{...E.e.DefaultConfiguration,numWorkers:Y}:{...E.e.DefaultConfiguration,...Y};this._decoder=new E.e(c)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Y,c,h){return this._decoder.decodeMeshToMeshDataAsync(Y,c,h)}async decodeMeshToGeometryAsync(Y,c,h,C){return await this._decoder.decodeMeshToGeometryAsync(Y,c,h,C)}async _decodeMeshToGeometryForGltfAsync(Y,c,h,C,E,N){return await this._decoder._decodeMeshToGeometryForGltfAsync(Y,c,h,C,E,N)}async decodeMeshAsync(Y,c){const h=await this._decoder.decodeMeshToMeshDataAsync(Y,c),C=new Q.b;h.indices&&(C.indices=h.indices);for(const E of h.attributes){const Y=N.b.GetFloatData(E.data,E.size,N.b.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,h.totalVertices);C.set(Y,E.kind)}return C}}b.DefaultNumWorkers=(0,C.h)(),b._Default=null},14431:(Y,c,h)=>{"use strict";h.d(c,{e:()=>w});var C=h(13451),E=h(12687),N=h(13333),Q=h(13473),b=h(12700),H=h(13464);class w extends C.e{static get DefaultAvailable(){return(0,C.l)(w.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(Y){w._Default&&(Y||w._Default.dispose(),w._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Y,c){return{module:await(c||DracoDecoderModule)({wasmBinary:Y})}}_getWorkerContent(){return`${H.c}(${H.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultConfiguration)}decodeMeshToMeshDataAsync(Y,c,h){const C=Y instanceof ArrayBuffer?new Int8Array(Y):new Int8Array(Y.buffer,Y.byteOffset,Y.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Y=>await new Promise(((E,N)=>{Y.push(((Y,Q)=>{let H=null;const w=[],W=c=>{Y.removeEventListener("error",W),Y.removeEventListener("message",q),N(c),Q()},q=c=>{const C=c.data;switch(C.id){case"indices":H=C.data;break;case"attribute":w.push({kind:C.kind,data:C.data,size:C.size,byteOffset:C.byteOffset,byteStride:C.byteStride,normalized:(N=C.kind,k=C.normalized,h&&void 0!==h[N]?(k!==h[N]&&b.e.Warn(`Normalized flag from Draco data (${k}) does not match normalized flag from glTF accessor (${h[N]}). Using flag from glTF accessor.`),h[N]):k)});break;case"decodeMeshDone":Y.removeEventListener("error",W),Y.removeEventListener("message",q),E({indices:H,attributes:w,totalVertices:C.totalVertices}),Q()}var N,k};Y.addEventListener("error",W),Y.addEventListener("message",q);const k=C.slice();Y.postMessage({id:"decodeMesh",dataView:k,attributes:c},[k.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Y=>{let h=null;const E=[],N=(0,H.c)(Y.module,C,c,(Y=>{h=Y}),((Y,c,h,C,N,Q)=>{E.push({kind:Y,data:c,size:h,byteOffset:C,byteStride:N,normalized:Q})}));return{indices:h,attributes:E,totalVertices:N}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Y,c,h,C){const E=await this.decodeMeshToMeshDataAsync(h,C),b=new N.e(Y,c);E.indices&&b.setIndices(E.indices);for(const N of E.attributes)b.setVerticesBuffer(new Q.b(c.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),E.totalVertices);return b}async _decodeMeshToGeometryForGltfAsync(Y,c,h,C,E,b){const H=await this.decodeMeshToMeshDataAsync(h,C,E),w=new N.e(Y,c);b&&(w._boundingInfo=b,w.useBoundingInfoFromGeometry=!0),H.indices&&w.setIndices(H.indices);for(const N of H.attributes)w.setVerticesBuffer(new Q.b(c.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),H.totalVertices);return w}}w.DefaultConfiguration={wasmUrl:`${E.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},w._Default=null},14658:(Y,c,h)=>{"use strict";h.d(c,{c:()=>bY});var C=h(12869),E=h(13321),N=h(12951),Q=h(13305),b=h(12934);function H(Y){let c=Y.pathArray;const h=Y.closeArray||!1,C=Y.closePath||!1,E=Y.invertUV||!1,H=Math.floor(c[0].length/2);let w=Y.offset||H;w=w>H?H:Math.floor(w);const W=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,q=Y.sY,k=Y.IY,M=[],p=[],P=[],y=[],d=[],D=[],T=[],e=[];let r;const X=[],Z=[];let a,G,K;if(c.length<2){const Y=[],h=[];for(G=0;G<c[0].length-w;G++)Y.push(c[0][G]),h.push(c[0][G+w]);c=[Y,h]}let I=0;const s=C?1:0,x=h?1:0;let A,V,U,l,n,v;for(r=c[0].length,a=0;a<c.length+x;a++){for(T[a]=0,d[a]=[0],A=a===c.length?c[0]:c[a],V=A.length,r=r<V?r:V,K=0;K<V;)M.push(A[K].x,A[K].y,A[K].z),K>0&&(U=A[K].Hh(A[K-1]).length(),l=U+T[a],d[a].push(l),T[a]=l),K++;C&&(K--,M.push(A[0].x,A[0].y,A[0].z),U=A[K].Hh(A[0]).length(),l=U+T[a],d[a].push(l),T[a]=l),X[a]=V+s,Z[a]=I,I+=V+s}let g,z,O=null,o=null;for(G=0;G<r+s;G++)for(e[G]=0,D[G]=[0],a=0;a<c.length-1+x;a++)n=c[a],v=a===c.length-1?c[0]:c[a+1],G===r?(O=n[0],o=v[0]):(O=n[G],o=v[G]),U=o.Hh(O).length(),l=U+e[G],D[G].push(l),e[G]=l;if(q)for(a=0;a<q.length;a++)y.push(q[a].x,b.d?1-q[a].y:q[a].y);else for(a=0;a<c.length+x;a++)for(G=0;G<r+s;G++)g=0!=T[a]?d[a][G]/T[a]:0,z=0!=e[G]?D[G][a]/e[G]:0,E?y.push(z,g):y.push(g,b.d?1-z:z);a=0;let f=0,L=X[a]-1,u=X[a+1]-1,i=L<u?L:u,R=Z[1]-Z[0];const B=X.length-1;for(;f<=i&&a<B;)p.push(f,f+R,f+1),p.push(f+R+1,f+1,f+R),f+=1,f===i&&(a++,R=Z[a+1]-Z[a],L=X[a]-1,u=X[a+1]-1,f=Z[a],i=L<u?L+f:u+f);if(Q.b.ComputeNormals(M,p,P),C){let Y=0,h=0;for(a=0;a<c.length;a++){Y=3*Z[a],h=a+1<c.length?3*(Z[a+1]-1):P.length-3,P[Y]=.5*(P[Y]+P[h]),P[Y+1]=.5*(P[Y+1]+P[h+1]),P[Y+2]=.5*(P[Y+2]+P[h+2]);const C=Math.sqrt(P[Y]*P[Y]+P[Y+1]*P[Y+1]+P[Y+2]*P[Y+2]);P[Y]/=C,P[Y+1]/=C,P[Y+2]/=C,P[h]=P[Y],P[h+1]=P[Y+1],P[h+2]=P[Y+2]}}if(h){let Y=3*Z[0],h=3*Z[c.length];for(G=0;G<r+s;G++){P[Y]=.5*(P[Y]+P[h]),P[Y+1]=.5*(P[Y+1]+P[h+1]),P[Y+2]=.5*(P[Y+2]+P[h+2]);const c=Math.sqrt(P[Y]*P[Y]+P[Y+1]*P[Y+1]+P[Y+2]*P[Y+2]);P[Y]/=c,P[Y+1]/=c,P[Y+2]/=c,P[h]=P[Y],P[h+1]=P[Y+1],P[h+2]=P[Y+2],Y+=3,h+=3}}Q.b._ComputeSides(W,M,p,P,y,Y.frontUVs,Y.backUVs);let t=null;if(k){t=new Float32Array(4*k.length);for(let Y=0;Y<k.length;Y++)t[4*Y]=k[Y].r,t[4*Y+1]=k[Y].g,t[4*Y+2]=k[Y].b,t[4*Y+3]=k[Y].a}const F=new Q.b,J=new Float32Array(M),j=new Float32Array(P),S=new Float32Array(y);return F.indices=p,F.GY=J,F.KY=j,F.sY=S,t&&F.set(t,N.f.ColorKind),C&&(F._idx=Z),F}function w(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=c.pathArray,W=c.closeArray,q=c.closePath,k=E.e._GetDefaultSideOrientation(c.sideOrientation),M=c.instance,p=c.updatable;if(M){const Y=C.TmpVectors.bh[0].nc(Number.MAX_VALUE),h=C.TmpVectors.bh[1].nc(-Number.MAX_VALUE),H=c=>{let C=w[0].length;const N=M;let Q=0;const b=N._originalBuilderSideOrientation===E.e.DOUBLESIDE?2:1;for(let E=1;E<=b;++E)for(let b=0;b<w.length;++b){const E=w[b],H=E.length;C=C<H?C:H;for(let N=0;N<C;++N){const C=E[N];c[Q]=C.x,c[Q+1]=C.y,c[Q+2]=C.z,Y.minimizeInPlaceFromFloats(C.x,C.y,C.z),h.maximizeInPlaceFromFloats(C.x,C.y,C.z),Q+=3}if(N._creationDataStorage&&N._creationDataStorage.closePath){const Y=E[0];c[Q]=Y.x,c[Q+1]=Y.y,c[Q+2]=Y.z,Q+=3}}},W=M.getVerticesData(N.f.PositionKind);if(H(W),M.hasBoundingInfo?M.getBoundingInfo().reConstruct(Y,h,M._worldMatrix):M.buildBoundingInfo(Y,h,M._worldMatrix),M.updateVerticesData(N.f.PositionKind,W,!1,!1),c.IY){const Y=M.getVerticesData(N.f.ColorKind);for(let h=0,C=0;h<c.IY.length;h++,C+=4){const E=c.IY[h];Y[C]=E.r,Y[C+1]=E.g,Y[C+2]=E.b,Y[C+3]=E.a}M.updateVerticesData(N.f.ColorKind,Y,!1,!1)}if(c.sY){const Y=M.getVerticesData(N.f.UVKind);for(let h=0;h<c.sY.length;h++)Y[2*h]=c.sY[h].x,Y[2*h+1]=b.d?1-c.sY[h].y:c.sY[h].y;M.updateVerticesData(N.f.UVKind,Y,!1,!1)}if(!M.areNormalsFrozen||M.isFacetDataEnabled){const Y=M.sc(),c=M.getVerticesData(N.f.NormalKind),h=M.isFacetDataEnabled?M.getFacetDataParameters():null;if(Q.b.ComputeNormals(W,Y,c,h),M._creationDataStorage&&M._creationDataStorage.closePath){let Y=0,h=0;for(let C=0;C<w.length;C++)Y=3*M._creationDataStorage.idx[C],h=C+1<w.length?3*(M._creationDataStorage.idx[C+1]-1):c.length-3,c[Y]=.5*(c[Y]+c[h]),c[Y+1]=.5*(c[Y+1]+c[h+1]),c[Y+2]=.5*(c[Y+2]+c[h+2]),c[h]=c[Y],c[h+1]=c[Y+1],c[h+2]=c[Y+2]}M.areNormalsFrozen||M.updateVerticesData(N.f.NormalKind,c,!1,!1)}return M}{const C=new E.e(Y,h);C._originalBuilderSideOrientation=k,C._creationDataStorage=new E.g;const N=H(c);return q&&(C._creationDataStorage.idx=N._idx),C._creationDataStorage.closePath=q,C._creationDataStorage.closeArray=W,N.AY(C,p),C}}Q.b.CreateRibbon=H,E.e.CreateRibbon=function(Y,c){return w(Y,{pathArray:c,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var W=h(14115),q=h(13967),k=h(12920);function M(Y){const c=Y.pattern||E.e.NO_FLIP,h=Y.tileWidth||Y.tileSize||1,C=Y.tileHeight||Y.tileSize||1,N=Y.alignHorizontal||0,b=Y.alignVertical||0,H=Y.width||Y.size||1,w=Math.floor(H/h);let W=H-w*h;const q=Y.height||Y.size||1,k=Math.floor(q/C);let M=q-k*C;const p=h*w/2,P=C*k/2;let y=0,d=0,D=0,T=0,e=0,r=0;if(W>0||M>0){switch(D=-p,T=-P,e=p,r=P,N){case E.e.CENTER:W/=2,D-=W,e+=W;break;case E.e.LEFT:e+=W,y=-W/2;break;case E.e.RIGHT:D-=W,y=W/2}switch(b){case E.e.CENTER:M/=2,T-=M,r+=M;break;case E.e.BOTTOM:r+=M,d=-M/2;break;case E.e.TOP:T-=M,d=M/2}}const X=[],Z=[],a=[];a[0]=[0,0,1,0,1,1,0,1],a[1]=[0,0,1,0,1,1,0,1],c!==E.e.ROTATE_TILE&&c!==E.e.ROTATE_ROW||(a[1]=[1,1,0,1,0,0,1,0]),c!==E.e.FLIP_TILE&&c!==E.e.FLIP_ROW||(a[1]=[1,0,0,0,0,1,1,1]),c!==E.e.FLIP_N_ROTATE_TILE&&c!==E.e.FLIP_N_ROTATE_ROW||(a[1]=[0,1,1,1,1,0,0,0]);let G=[];const K=[],I=[];let s=0;for(let Q=0;Q<k;Q++)for(let Y=0;Y<w;Y++)X.push(Y*h-p+y,Q*C-P+d,0),X.push((Y+1)*h-p+y,Q*C-P+d,0),X.push((Y+1)*h-p+y,(Q+1)*C-P+d,0),X.push(Y*h-p+y,(Q+1)*C-P+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),G=c===E.e.FLIP_TILE||c===E.e.ROTATE_TILE||c===E.e.FLIP_N_ROTATE_TILE?G.concat(a[(Y%2+Q%2)%2]):c===E.e.FLIP_ROW||c===E.e.ROTATE_ROW||c===E.e.FLIP_N_ROTATE_ROW?G.concat(a[Q%2]):G.concat(a[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),s+=4;if(W>0||M>0){const Y=M>0&&(b===E.e.CENTER||b===E.e.TOP),Q=M>0&&(b===E.e.CENTER||b===E.e.BOTTOM),H=W>0&&(N===E.e.CENTER||N===E.e.RIGHT),q=W>0&&(N===E.e.CENTER||N===E.e.LEFT);let a,x,A,V,U=[];if(Y&&H&&(X.push(D+y,T+d,0),X.push(-p+y,T+d,0),X.push(-p+y,T+M+d,0),X.push(D+y,T+M+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=1-W/h,x=1-M/C,A=1,V=1,U=[a,x,A,x,A,V,a,V],c===E.e.ROTATE_ROW&&(U=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),c===E.e.FLIP_ROW&&(U=[1-a,x,1-A,x,1-A,V,1-a,V]),c===E.e.FLIP_N_ROTATE_ROW&&(U=[a,1-x,A,1-x,A,1-V,a,1-V]),G=G.concat(U),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&q&&(X.push(p+y,T+d,0),X.push(e+y,T+d,0),X.push(e+y,T+M+d,0),X.push(p+y,T+M+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=0,x=1-M/C,A=W/h,V=1,U=[a,x,A,x,A,V,a,V],(c===E.e.ROTATE_ROW||c===E.e.ROTATE_TILE&&w%2===0)&&(U=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),(c===E.e.FLIP_ROW||c===E.e.FLIP_TILE&&w%2===0)&&(U=[1-a,x,1-A,x,1-A,V,1-a,V]),(c===E.e.FLIP_N_ROTATE_ROW||c===E.e.FLIP_N_ROTATE_TILE&&w%2===0)&&(U=[a,1-x,A,1-x,A,1-V,a,1-V]),G=G.concat(U),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&H&&(X.push(D+y,P+d,0),X.push(-p+y,P+d,0),X.push(-p+y,r+d,0),X.push(D+y,r+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=1-W/h,x=0,A=1,V=M/C,U=[a,x,A,x,A,V,a,V],(c===E.e.ROTATE_ROW&&k%2===1||c===E.e.ROTATE_TILE&&k%1===0)&&(U=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),(c===E.e.FLIP_ROW&&k%2===1||c===E.e.FLIP_TILE&&k%2===0)&&(U=[1-a,x,1-A,x,1-A,V,1-a,V]),(c===E.e.FLIP_N_ROTATE_ROW&&k%2===1||c===E.e.FLIP_N_ROTATE_TILE&&k%2===0)&&(U=[a,1-x,A,1-x,A,1-V,a,1-V]),G=G.concat(U),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Q&&q&&(X.push(p+y,P+d,0),X.push(e+y,P+d,0),X.push(e+y,r+d,0),X.push(p+y,r+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,a=0,x=0,A=W/h,V=M/C,U=[a,x,A,x,A,V,a,V],(c===E.e.ROTATE_ROW&&k%2===1||c===E.e.ROTATE_TILE&&(k+w)%2===1)&&(U=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),(c===E.e.FLIP_ROW&&k%2===1||c===E.e.FLIP_TILE&&(k+w)%2===1)&&(U=[1-a,x,1-A,x,1-A,V,1-a,V]),(c===E.e.FLIP_N_ROTATE_ROW&&k%2===1||c===E.e.FLIP_N_ROTATE_TILE&&(k+w)%2===1)&&(U=[a,1-x,A,1-x,A,1-V,a,1-V]),G=G.concat(U),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y){const Y=[];a=0,x=1-M/C,A=1,V=1,Y[0]=[a,x,A,x,A,V,a,V],Y[1]=[a,x,A,x,A,V,a,V],c!==E.e.ROTATE_TILE&&c!==E.e.ROTATE_ROW||(Y[1]=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),c!==E.e.FLIP_TILE&&c!==E.e.FLIP_ROW||(Y[1]=[1-a,x,1-A,x,1-A,V,1-a,V]),c!==E.e.FLIP_N_ROTATE_TILE&&c!==E.e.FLIP_N_ROTATE_ROW||(Y[1]=[a,1-x,A,1-x,A,1-V,a,1-V]);for(let C=0;C<w;C++)X.push(C*h-p+y,T+d,0),X.push((C+1)*h-p+y,T+d,0),X.push((C+1)*h-p+y,T+M+d,0),X.push(C*h-p+y,T+M+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,G=c===E.e.FLIP_TILE||c===E.e.ROTATE_TILE||c===E.e.FLIP_N_ROTATE_TILE?G.concat(Y[(C+1)%2]):c===E.e.FLIP_ROW||c===E.e.ROTATE_ROW||c===E.e.FLIP_N_ROTATE_ROW?G.concat(Y[1]):G.concat(Y[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const Y=[];a=0,x=0,A=1,V=M/C,Y[0]=[a,x,A,x,A,V,a,V],Y[1]=[a,x,A,x,A,V,a,V],c!==E.e.ROTATE_TILE&&c!==E.e.ROTATE_ROW||(Y[1]=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),c!==E.e.FLIP_TILE&&c!==E.e.FLIP_ROW||(Y[1]=[1-a,x,1-A,x,1-A,V,1-a,V]),c!==E.e.FLIP_N_ROTATE_TILE&&c!==E.e.FLIP_N_ROTATE_ROW||(Y[1]=[a,1-x,A,1-x,A,1-V,a,1-V]);for(let C=0;C<w;C++)X.push(C*h-p+y,r-M+d,0),X.push((C+1)*h-p+y,r-M+d,0),X.push((C+1)*h-p+y,r+d,0),X.push(C*h-p+y,r+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,G=c===E.e.FLIP_TILE||c===E.e.ROTATE_TILE||c===E.e.FLIP_N_ROTATE_TILE?G.concat(Y[(C+k)%2]):c===E.e.FLIP_ROW||c===E.e.ROTATE_ROW||c===E.e.FLIP_N_ROTATE_ROW?G.concat(Y[k%2]):G.concat(Y[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(H){const Y=[];a=1-W/h,x=0,A=1,V=1,Y[0]=[a,x,A,x,A,V,a,V],Y[1]=[a,x,A,x,A,V,a,V],c!==E.e.ROTATE_TILE&&c!==E.e.ROTATE_ROW||(Y[1]=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),c!==E.e.FLIP_TILE&&c!==E.e.FLIP_ROW||(Y[1]=[1-a,x,1-A,x,1-A,V,1-a,V]),c!==E.e.FLIP_N_ROTATE_TILE&&c!==E.e.FLIP_N_ROTATE_ROW||(Y[1]=[a,1-x,A,1-x,A,1-V,a,1-V]);for(let h=0;h<k;h++)X.push(D+y,h*C-P+d,0),X.push(D+W+y,h*C-P+d,0),X.push(D+W+y,(h+1)*C-P+d,0),X.push(D+y,(h+1)*C-P+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,G=c===E.e.FLIP_TILE||c===E.e.ROTATE_TILE||c===E.e.FLIP_N_ROTATE_TILE?G.concat(Y[(h+1)%2]):c===E.e.FLIP_ROW||c===E.e.ROTATE_ROW||c===E.e.FLIP_N_ROTATE_ROW?G.concat(Y[h%2]):G.concat(Y[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const Y=[];a=0,x=0,A=W/C,V=1,Y[0]=[a,x,A,x,A,V,a,V],Y[1]=[a,x,A,x,A,V,a,V],c!==E.e.ROTATE_TILE&&c!==E.e.ROTATE_ROW||(Y[1]=[1-a,1-x,1-A,1-x,1-A,1-V,1-a,1-V]),c!==E.e.FLIP_TILE&&c!==E.e.FLIP_ROW||(Y[1]=[1-a,x,1-A,x,1-A,V,1-a,V]),c!==E.e.FLIP_N_ROTATE_TILE&&c!==E.e.FLIP_N_ROTATE_ROW||(Y[1]=[a,1-x,A,1-x,A,1-V,a,1-V]);for(let h=0;h<k;h++)X.push(e-W+y,h*C-P+d,0),X.push(e+y,h*C-P+d,0),X.push(e+y,(h+1)*C-P+d,0),X.push(e-W+y,(h+1)*C-P+d,0),I.push(s,s+1,s+3,s+1,s+2,s+3),s+=4,G=c===E.e.FLIP_TILE||c===E.e.ROTATE_TILE||c===E.e.FLIP_N_ROTATE_TILE?G.concat(Y[(h+w)%2]):c===E.e.FLIP_ROW||c===E.e.ROTATE_ROW||c===E.e.FLIP_N_ROTATE_ROW?G.concat(Y[h%2]):G.concat(Y[0]),K.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Z.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const x=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE;Q.b._ComputeSides(x,X,I,Z,G,Y.frontUVs,Y.backUVs);const A=new Q.b;A.indices=I,A.GY=X,A.KY=Z,A.sY=G;const V=x===Q.b.DOUBLESIDE?K.concat(K):K;return A.IY=V,A}function p(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return M(c).AY(C,c.updatable),C}function P(Y){const c=Y.faceUV||new Array(6),h=Y.faceColors,N=Y.pattern||E.e.NO_FLIP,H=Y.width||Y.size||1,w=Y.height||Y.size||1,W=Y.depth||Y.size||1,q=Y.tileWidth||Y.tileSize||1,p=Y.tileHeight||Y.tileSize||1,P=Y.alignHorizontal||0,y=Y.alignVertical||0,d=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===c[E]&&(c[E]=new C.Vector4(0,0,1,1)),h&&void 0===h[E]&&(h[E]=new k.vc(1,1,1,1));const D=H/2,T=w/2,e=W/2,r=[];for(let C=0;C<2;C++)r[C]=M({pattern:N,tileWidth:q,tileHeight:p,width:H,height:w,alignVertical:y,alignHorizontal:P,sideOrientation:d});for(let C=2;C<4;C++)r[C]=M({pattern:N,tileWidth:q,tileHeight:p,width:W,height:w,alignVertical:y,alignHorizontal:P,sideOrientation:d});let X=y;y===E.e.BOTTOM?X=E.e.TOP:y===E.e.TOP&&(X=E.e.BOTTOM);for(let C=4;C<6;C++)r[C]=M({pattern:N,tileWidth:q,tileHeight:p,width:H,height:W,alignVertical:X,alignHorizontal:P,sideOrientation:d});let Z=[],a=[],G=[],K=[];const I=[],s=[],x=[],A=[];let V=0,U=0;for(let E=0;E<6;E++){const Y=r[E].GY.length;s[E]=[],x[E]=[];for(let c=0;c<Y/3;c++)s[E].push(new C.bh(r[E].GY[3*c],r[E].GY[3*c+1],r[E].GY[3*c+2])),x[E].push(new C.bh(r[E].KY[3*c],r[E].KY[3*c+1],r[E].KY[3*c+2]));V=r[E].sY.length,A[E]=[];for(let h=0;h<V;h+=2)A[E][h]=c[E].x+(c[E].z-c[E].x)*r[E].sY[h],A[E][h+1]=c[E].y+(c[E].w-c[E].y)*r[E].sY[h+1],b.d&&(A[E][h+1]=1-A[E][h+1]);if(G=G.concat(A[E]),K=K.concat(r[E].indices.map((Y=>Y+U))),U+=s[E].length,h)for(let c=0;c<4;c++)I.push(h[E].r,h[E].g,h[E].b,h[E].a)}const l=new C.bh(0,0,e),n=C.Matrix.RotationY(Math.PI);Z=s[0].map((Y=>C.bh.TransformNormal(Y,n).add(l))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]),a=x[0].map((Y=>C.bh.TransformNormal(Y,n))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]),Z=Z.concat(s[1].map((Y=>Y.Hh(l))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),a=a.concat(x[1].map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]));const v=new C.bh(D,0,0),g=C.Matrix.RotationY(-Math.PI/2);Z=Z.concat(s[2].map((Y=>C.bh.TransformNormal(Y,g).add(v))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),a=a.concat(x[2].map((Y=>C.bh.TransformNormal(Y,g))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]));const z=C.Matrix.RotationY(Math.PI/2);Z=Z.concat(s[3].map((Y=>C.bh.TransformNormal(Y,z).Hh(v))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),a=a.concat(x[3].map((Y=>C.bh.TransformNormal(Y,z))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]));const O=new C.bh(0,T,0),o=C.Matrix.RotationX(Math.PI/2);Z=Z.concat(s[4].map((Y=>C.bh.TransformNormal(Y,o).add(O))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),a=a.concat(x[4].map((Y=>C.bh.TransformNormal(Y,o))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[]));const f=C.Matrix.RotationX(-Math.PI/2);Z=Z.concat(s[5].map((Y=>C.bh.TransformNormal(Y,f).Hh(O))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),a=a.concat(x[5].map((Y=>C.bh.TransformNormal(Y,f))).map((Y=>[Y.x,Y.y,Y.z])).reduce(((Y,c)=>Y.concat(c)),[])),Q.b._ComputeSides(d,Z,K,a,G);const L=new Q.b;if(L.indices=K,L.GY=Z,L.KY=a,L.sY=G,h){const Y=d===Q.b.DOUBLESIDE?I.concat(I):I;L.IY=Y}return L}function y(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return P(c).AY(C,c.updatable),C}Q.b.CreateTiledPlane=M;Q.b.CreateTiledBox=P;var d=h(14107),D=h(13110),T=h(13074);function e(Y){const c=Y.height||2;let h=0===Y.diameterTop?0:Y.diameterTop||Y.diameter||1,N=0===Y.diameterBottom?0:Y.diameterBottom||Y.diameter||1;h=h||1e-5,N=N||1e-5;const H=0|(Y.tessellation||24),w=0|(Y.subdivisions||1),W=!!Y.hasRings,q=!!Y.enclose,M=0===Y.cap?0:Y.cap||E.e.CAP_ALL,p=Y.arc&&(Y.arc<=0||Y.arc>1)?1:Y.arc||1,P=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,y=Y.faceUV||new Array(3),d=Y.faceColors,D=2+(1+(1!==p&&q?2:0))*(W?w:1);let e;for(e=0;e<D;e++)d&&void 0===d[e]&&(d[e]=new k.vc(1,1,1,1));for(e=0;e<D;e++)y&&void 0===y[e]&&(y[e]=new C.Vector4(0,0,1,1));const r=[],X=[],Z=[],a=[],G=[],K=2*Math.PI*p/H;let I,s,x;const A=(N-h)/2/c,V=C.bh.Zero(),U=C.bh.Zero(),l=C.bh.Zero(),n=C.bh.Zero(),v=C.bh.Zero(),g=T.e.Y;let z,O,o,f=1,L=1,u=0,i=0;for(z=0;z<=w;z++)for(s=z/w,x=(s*(h-N)+N)/2,f=W&&0!==z&&z!==w?2:1,o=0;o<f;o++){for(W&&(L+=o),q&&(L+=2*o),O=0;O<=H;O++)I=O*K,V.x=Math.cos(-I)*x,V.y=-c/2+s*c,V.z=Math.sin(-I)*x,0===h&&z===w?(U.x=Z[Z.length-3*(H+1)],U.y=Z[Z.length-3*(H+1)+1],U.z=Z[Z.length-3*(H+1)+2]):(U.x=V.x,U.z=V.z,U.y=Math.sqrt(U.x*U.x+U.z*U.z)*A,U.normalize()),0===O&&(l.N(V),n.N(U)),X.push(V.x,V.y,V.z),Z.push(U.x,U.y,U.z),i=W?u!==L?y[L].y:y[L].w:y[L].y+(y[L].w-y[L].y)*s,a.push(y[L].x+(y[L].z-y[L].x)*O/H,b.d?1-i:i),d&&G.push(d[L].r,d[L].g,d[L].b,d[L].a);1!==p&&q&&(X.push(V.x,V.y,V.z),X.push(0,V.y,0),X.push(0,V.y,0),X.push(l.x,l.y,l.z),C.bh.CrossToRef(g,U,v),v.normalize(),Z.push(v.x,v.y,v.z,v.x,v.y,v.z),C.bh.CrossToRef(n,g,v),v.normalize(),Z.push(v.x,v.y,v.z,v.x,v.y,v.z),i=W?u!==L?y[L+1].y:y[L+1].w:y[L+1].y+(y[L+1].w-y[L+1].y)*s,a.push(y[L+1].x,b.d?1-i:i),a.push(y[L+1].z,b.d?1-i:i),i=W?u!==L?y[L+2].y:y[L+2].w:y[L+2].y+(y[L+2].w-y[L+2].y)*s,a.push(y[L+2].x,b.d?1-i:i),a.push(y[L+2].z,b.d?1-i:i),d&&(G.push(d[L+1].r,d[L+1].g,d[L+1].b,d[L+1].a),G.push(d[L+1].r,d[L+1].g,d[L+1].b,d[L+1].a),G.push(d[L+2].r,d[L+2].g,d[L+2].b,d[L+2].a),G.push(d[L+2].r,d[L+2].g,d[L+2].b,d[L+2].a))),u!==L&&(u=L)}const R=1!==p&&q?H+4:H;for(z=0,L=0;L<w;L++){let Y=0,c=0,h=0,C=0;for(O=0;O<H;O++)Y=z*(R+1)+O,c=(z+1)*(R+1)+O,h=z*(R+1)+(O+1),C=(z+1)*(R+1)+(O+1),r.push(Y,c,h),r.push(C,h,c);1!==p&&q&&(r.push(Y+2,c+2,h+2),r.push(C+2,h+2,c+2),r.push(Y+4,c+4,h+4),r.push(C+4,h+4,c+4)),z=W?z+2:z+1}const B=Y=>{const E=Y?h/2:N/2;if(0===E)return;let Q,w,W;const q=Y?y[D-1]:y[0];let k=null;d&&(k=Y?d[D-1]:d[0]);const M=X.length/3,P=Y?c/2:-c/2,T=new C.bh(0,P,0);X.push(T.x,T.y,T.z),Z.push(0,Y?1:-1,0);const e=q.y+.5*(q.w-q.y);a.push(q.x+.5*(q.z-q.x),b.d?1-e:e),k&&G.push(k.r,k.g,k.b,k.a);const K=new C.Vector2(.5,.5);for(W=0;W<=H;W++){Q=2*Math.PI*W*p/H;const c=Math.cos(-Q),h=Math.sin(-Q);w=new C.bh(c*E,P,h*E);const N=new C.Vector2(c*K.x+.5,h*K.y+.5);X.push(w.x,w.y,w.z),Z.push(0,Y?1:-1,0);const M=q.y+(q.w-q.y)*N.y;a.push(q.x+(q.z-q.x)*N.x,b.d?1-M:M),k&&G.push(k.r,k.g,k.b,k.a)}for(W=0;W<H;W++)Y?(r.push(M),r.push(M+(W+2)),r.push(M+(W+1))):(r.push(M),r.push(M+(W+1)),r.push(M+(W+2)))};M!==E.e.CAP_START&&M!==E.e.CAP_ALL||B(!1),M!==E.e.CAP_END&&M!==E.e.CAP_ALL||B(!0),Q.b._ComputeSides(P,X,r,Z,a,Y.frontUVs,Y.backUVs);const t=new Q.b;return t.indices=r,t.GY=X,t.KY=Z,t.sY=a,d&&(t.IY=G),t}function r(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return e(c).AY(C,c.updatable),C}function X(Y){const c=[],h=[],E=[],N=[],H=Y.diameter||1,w=Y.thickness||.5,W=0|(Y.tessellation||16),q=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,k=W+1;for(let Q=0;Q<=W;Q++){const Y=Q/W,q=Q*Math.PI*2/W-Math.PI/2,M=C.Matrix.Translation(H/2,0,0).multiply(C.Matrix.RotationY(q));for(let H=0;H<=W;H++){const q=1-H/W,p=H*Math.PI*2/W+Math.PI,P=Math.cos(p),y=Math.sin(p);let d=new C.bh(P,y,0),D=d.scale(w/2);const T=new C.Vector2(Y,q);D=C.bh.TransformCoordinates(D,M),d=C.bh.TransformNormal(d,M),h.push(D.x,D.y,D.z),E.push(d.x,d.y,d.z),N.push(T.x,b.d?1-T.y:T.y);const e=(Q+1)%k,r=(H+1)%k;c.push(Q*k+H),c.push(Q*k+r),c.push(e*k+H),c.push(Q*k+r),c.push(e*k+r),c.push(e*k+H)}}Q.b._ComputeSides(q,h,c,E,N,Y.frontUVs,Y.backUVs);const M=new Q.b;return M.indices=c,M.GY=h,M.KY=E,M.sY=N,M}function Z(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return X(c).AY(C,c.updatable),C}Q.b.CreateCylinder=e,E.e.CreateCylinder=(Y,c,h,C,N,Q,b,H,w)=>{void 0!==b&&b instanceof D.e||(void 0!==b&&(w=H||E.e.DEFAULTSIDE,H=b),b=Q,Q=1);return r(Y,{height:c,diameterTop:h,diameterBottom:C,tessellation:N,subdivisions:Q,sideOrientation:w,updatable:H},b)};function a(Y){const c=[],h=[],E=[],N=[],H=Y.radius||2,w=Y.tube||.5,W=Y.radialSegments||32,q=Y.tubularSegments||32,k=Y.p||2,M=Y.q||3,p=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,P=Y=>{const c=Math.cos(Y),h=Math.sin(Y),E=M/k*Y,N=Math.cos(E),Q=H*(2+N)*.5*c,b=H*(2+N)*h*.5,w=H*Math.sin(E)*.5;return new C.bh(Q,b,w)};let y,d;for(y=0;y<=W;y++){const Y=y%W/W*2*k*Math.PI,c=P(Y),E=P(Y+.01),Q=E.Hh(c);let H=E.add(c);const M=C.bh.Cross(Q,H);for(H=C.bh.Cross(M,Q),M.normalize(),H.normalize(),d=0;d<q;d++){const Y=d%q/q*2*Math.PI,C=-w*Math.cos(Y),E=w*Math.sin(Y);h.push(c.x+C*H.x+E*M.x),h.push(c.y+C*H.y+E*M.y),h.push(c.z+C*H.z+E*M.z),N.push(y/W),N.push(b.d?1-d/q:d/q)}}for(y=0;y<W;y++)for(d=0;d<q;d++){const Y=(d+1)%q,h=y*q+d,C=(y+1)*q+d,E=(y+1)*q+Y,N=y*q+Y;c.push(N),c.push(C),c.push(h),c.push(N),c.push(E),c.push(C)}Q.b.ComputeNormals(h,c,E),Q.b._ComputeSides(p,h,c,E,N,Y.frontUVs,Y.backUVs);const D=new Q.b;return D.indices=c,D.GY=h,D.KY=E,D.sY=N,D}function G(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return a(c).AY(C,c.updatable),C}Q.b.CreateTorus=X,E.e.CreateTorus=(Y,c,h,C,E,N,Q)=>Z(Y,{diameter:c,thickness:h,tessellation:C,sideOrientation:Q,updatable:N},E);Q.b.CreateTorusKnot=a,E.e.CreateTorusKnot=(Y,c,h,C,E,N,Q,b,H,w)=>G(Y,{radius:c,tube:h,radialSegments:C,tubularSegments:E,p:N,q:Q,sideOrientation:w,updatable:H},b);var K=h(14663),I=h(13442),s=h(13083);function x(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=c.path,N=c.shape,Q=c.scale||1,b=c.rotation||0,H=0===c.cap?0:c.cap||E.e.NO_CAP,w=c.updatable,W=E.e._GetDefaultSideOrientation(c.sideOrientation),q=c.instance||null,k=c.invertUV||!1,M=c.closeShape||!1,p=c.closePath||!1,P=c.capFunction||null;return V(Y,N,C,Q,b,null,null,p,M,H,!1,h,!!w,W,q,k,c.frontUVs||null,c.backUVs||null,c.firstNormal||null,!!c.adjustFrame,P)}function A(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=c.path,N=c.shape,Q=c.scaleFunction||(()=>1),b=c.rotationFunction||(()=>0),H=c.closePath||c.ribbonCloseArray||!1,w=c.closeShape||c.ribbonClosePath||!1,W=0===c.cap?0:c.cap||E.e.NO_CAP,q=c.updatable,k=c.firstNormal||null,M=c.adjustFrame||!1,p=E.e._GetDefaultSideOrientation(c.sideOrientation),P=c.instance,y=c.invertUV||!1,d=c.capFunction||null;return V(Y,N,C,null,null,Q,b,H,w,W,!0,h,!!q,p,P||null,y,c.frontUVs||null,c.backUVs||null,k,M,d||null)}function V(Y,c,h,N,Q,b,H,W,q,k,M,p,P,y,d,D,T,e,r,X,Z){const a=(Y,c,h,N,Q,b,H,w,W,q,k)=>{const M=h.getTangents(),p=h.getNormals(),P=h.getBinormals(),y=h.getDistances();if(k)for(let E=0;E<M.length;E++)if(0==M[E].x&&0==M[E].y&&0==M[E].z&&M[E].N(M[E-1]),0==p[E].x&&0==p[E].y&&0==p[E].z&&p[E].N(p[E-1]),0==P[E].x&&0==P[E].y&&0==P[E].z&&P[E].N(P[E-1]),E>0){let Y=M[E-1];C.bh.Dot(Y,M[E])<0&&M[E].scaleInPlace(-1),Y=p[E-1],C.bh.Dot(Y,p[E])<0&&p[E].scaleInPlace(-1),Y=P[E-1],C.bh.Dot(Y,P[E])<0&&P[E].scaleInPlace(-1)}let d=0;const D=q&&w?w:()=>null!==b?b:0,T=q&&H?H:()=>null!==Q?Q:1;let e=W===E.e.NO_CAP||W===E.e.CAP_END?0:2;const r=C.TmpVectors.Matrix[0];for(let E=0;E<c.length;E++){const h=[],Q=D(E,y[E]),b=T(E,y[E]);C.Matrix.RotationAxisToRef(M[E],d,r);for(let N=0;N<Y.length;N++){const Q=M[E].scale(Y[N].z).add(p[E].scale(Y[N].x)).add(P[E].scale(Y[N].y)),H=C.bh.Zero();C.bh.TransformCoordinatesToRef(Q,r,H),H.scaleInPlace(b).addInPlace(c[E]),h[N]=H}N[e]=h,d+=Q,e++}const X=Z||(Y=>{const c=Array(),h=C.bh.Zero();let E;for(E=0;E<Y.length;E++)h.addInPlace(Y[E]);for(h.scaleInPlace(1/Y.length),E=0;E<Y.length;E++)c.push(h);return c});switch(W){case E.e.NO_CAP:break;case E.e.CAP_START:N[0]=X(N[2]),N[1]=N[2];break;case E.e.CAP_END:N[e]=N[e-1],N[e+1]=X(N[e-1]);break;case E.e.CAP_ALL:N[0]=X(N[2]),N[1]=N[2],N[e]=N[e-1],N[e+1]=X(N[e-1])}return N};let G,K;if(d){const Y=d._creationDataStorage;return G=r?Y.path3D.update(h,r):Y.path3D.update(h),K=a(c,h,Y.path3D,Y.pathArray,N,Q,b,H,Y.cap,M,X),d=w("",{pathArray:K,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:d},p||void 0)}G=r?new s.k(h,r):new s.k(h);K=a(c,h,G,new Array,N,Q,b,H,k=k<0||k>3?0:k,M,X);const I=w(Y,{pathArray:K,closeArray:W,closePath:q,updatable:P,sideOrientation:y,invertUV:D,frontUVs:T||void 0,backUVs:e||void 0},p);return I._creationDataStorage.pathArray=K,I._creationDataStorage.path3D=G,I._creationDataStorage.cap=k,I}function U(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.arc?c.arc<=0||c.arc>1?1:c.arc:1,Q=void 0===c.closed||c.closed,b=c.shape,H=c.radius||1,W=c.tessellation||64,q=c.clip||0,k=c.updatable,M=E.e._GetDefaultSideOrientation(c.sideOrientation),p=c.cap||E.e.NO_CAP,P=2*Math.PI,y=[],d=c.invertUV||!1;let D=0,T=0;const e=P/W*N;let r,X;for(D=0;D<=W-q;D++){for(X=[],p!=E.e.CAP_START&&p!=E.e.CAP_ALL||(X.push(new C.bh(0,b[0].y,0)),X.push(new C.bh(Math.cos(D*e)*b[0].x*H,b[0].y,Math.sin(D*e)*b[0].x*H))),T=0;T<b.length;T++)r=new C.bh(Math.cos(D*e)*b[T].x*H,b[T].y,Math.sin(D*e)*b[T].x*H),X.push(r);p!=E.e.CAP_END&&p!=E.e.CAP_ALL||(X.push(new C.bh(Math.cos(D*e)*b[b.length-1].x*H,b[b.length-1].y,Math.sin(D*e)*b[b.length-1].x*H)),X.push(new C.bh(0,b[b.length-1].y,0))),y.push(X)}return w(Y,{pathArray:y,closeArray:Q,sideOrientation:M,updatable:k,invertUV:d,frontUVs:c.frontUVs,backUVs:c.backUVs},h)}E.e.ExtrudeShape=function(Y,c,h,C,N,Q){let b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0,W=arguments.length>9?arguments[9]:void 0;return x(Y,{shape:c,path:h,scale:C,rotation:N,cap:0===Q?0:Q||E.e.NO_CAP,sideOrientation:w,instance:W,updatable:H},b)},E.e.ExtrudeShapeCustom=(Y,c,h,C,N,Q,b,H,w,W,q,k)=>A(Y,{shape:c,path:h,scaleFunction:C,rotationFunction:N,ribbonCloseArray:Q,ribbonClosePath:b,cap:0===H?0:H||E.e.NO_CAP,sideOrientation:q,instance:k,updatable:W},w);E.e.CreateLathe=(Y,c,h,C,E,N,Q)=>U(Y,{shape:c,radius:h,tessellation:C,sideOrientation:Q,updatable:N},E);var l=h(14026),n=h(13974);function v(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.path;let Q=c.instance,b=1;void 0!==c.radius?b=c.radius:Q&&(b=Q._creationDataStorage.radius);const H=c.tessellation||64,W=c.radiusFunction||null;let q=c.cap||E.e.NO_CAP;const k=c.invertUV||!1,M=c.updatable,p=E.e._GetDefaultSideOrientation(c.sideOrientation);c.arc=c.arc&&(c.arc<=0||c.arc>1)?1:c.arc||1;const P=(Y,c,h,N,Q,b,H,w)=>{const W=c.getTangents(),q=c.getNormals(),k=c.getDistances(),M=2*Math.PI/Q*w,p=b||(()=>N);let P,y,d,D;const T=C.TmpVectors.Matrix[0];let e=H===E.e.NO_CAP||H===E.e.CAP_END?0:2;for(let E=0;E<Y.length;E++){y=p(E,k[E]),P=Array(),d=q[E];for(let c=0;c<Q;c++)C.Matrix.RotationAxisToRef(W[E],M*c,T),D=P[c]?P[c]:C.bh.Zero(),C.bh.TransformCoordinatesToRef(d,T,D),D.scaleInPlace(y).addInPlace(Y[E]),P[c]=D;h[e]=P,e++}const r=(c,h)=>{const C=Array();for(let E=0;E<c;E++)C.push(Y[h]);return C};switch(H){case E.e.NO_CAP:break;case E.e.CAP_START:h[0]=r(Q,0),h[1]=h[2].slice(0);break;case E.e.CAP_END:h[e]=h[e-1].slice(0),h[e+1]=r(Q,Y.length-1);break;case E.e.CAP_ALL:h[0]=r(Q,0),h[1]=h[2].slice(0),h[e]=h[e-1].slice(0),h[e+1]=r(Q,Y.length-1)}return h};let y,d;if(Q){const Y=Q._creationDataStorage,h=c.arc||Y.arc;return y=Y.path3D.update(N),d=P(N,y,Y.pathArray,b,Y.tessellation,W,Y.cap,h),Q=w("",{pathArray:d,instance:Q}),Y.path3D=y,Y.pathArray=d,Y.arc=h,Y.radius=b,Q}y=new s.k(N);q=q<0||q>3?0:q,d=P(N,y,new Array,b,H,W,q,c.arc);const D=w(Y,{pathArray:d,closePath:!0,closeArray:!1,updatable:M,sideOrientation:p,invertUV:k,frontUVs:c.frontUVs,backUVs:c.backUVs},h);return D._creationDataStorage.pathArray=d,D._creationDataStorage.path3D=y,D._creationDataStorage.tessellation=H,D._creationDataStorage.cap=q,D._creationDataStorage.arc=c.arc,D._creationDataStorage.radius=b,D}function g(Y){const c=[];c[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},c[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},c[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},c[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},c[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},c[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},c[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},c[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},c[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},c[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},c[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},c[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},c[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},c[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},c[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const h=Y.type&&(Y.type<0||Y.type>=c.length)?0:Y.type||0,E=Y.size,N=Y.sizeX||E||1,H=Y.sizeY||E||1,w=Y.sizeZ||E||1,W=Y.custom||c[h],q=W.face.length,M=Y.faceUV||new Array(q),p=Y.faceColors,P=void 0===Y.flat||Y.flat,y=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,d=[],D=[],T=[],e=[],r=[];let X=0,Z=0;const a=[];let G,K,I,s,x,A,V=0,U=0;if(P)for(U=0;U<q;U++)p&&void 0===p[U]&&(p[U]=new k.vc(1,1,1,1)),M&&void 0===M[U]&&(M[U]=new C.Vector4(0,0,1,1));if(P)for(U=0;U<q;U++){const Y=W.face[U].length;for(I=2*Math.PI/Y,s=.5*Math.tan(I/2),x=.5,V=0;V<Y;V++)d.push(W.vertex[W.face[U][V]][0]*N,W.vertex[W.face[U][V]][1]*H,W.vertex[W.face[U][V]][2]*w),a.push(X),X++,G=M[U].x+(M[U].z-M[U].x)*(.5+s),K=M[U].y+(M[U].w-M[U].y)*(x-.5),e.push(G,b.d?1-K:K),A=s*Math.cos(I)-x*Math.sin(I),x=s*Math.sin(I)+x*Math.cos(I),s=A,p&&r.push(p[U].r,p[U].g,p[U].b,p[U].a);for(V=0;V<Y-2;V++)D.push(a[0+Z],a[V+2+Z],a[V+1+Z]);Z+=Y}else{for(V=0;V<W.vertex.length;V++)d.push(W.vertex[V][0]*N,W.vertex[V][1]*H,W.vertex[V][2]*w),e.push(0,b.d?1:0);for(U=0;U<q;U++)for(V=0;V<W.face[U].length-2;V++)D.push(W.face[U][0],W.face[U][V+2],W.face[U][V+1])}Q.b.ComputeNormals(d,D,T),Q.b._ComputeSides(y,d,D,T,e,Y.frontUVs,Y.backUVs);const l=new Q.b;return l.GY=d,l.indices=D,l.KY=T,l.sY=e,p&&P&&(l.IY=r),l}function z(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return g(c).AY(C,c.updatable),C}E.e.CreateTube=(Y,c,h,C,E,N,Q,b,H,w)=>v(Y,{path:c,radius:h,tessellation:C,radiusFunction:E,arc:1,cap:N,updatable:b,sideOrientation:H,instance:w},Q);function O(Y){const c=Y.sideOrientation||Q.b.DEFAULTSIDE,h=Y.radius||1,E=void 0===Y.flat||Y.flat,N=0|(Y.subdivisions||4),H=Y.radiusX||h,w=Y.radiusY||h,W=Y.radiusZ||h,q=(1+Math.sqrt(5))/2,k=[-1,q,-0,1,q,0,-1,-q,0,1,-q,0,0,-1,-q,0,1,-q,0,-1,q,0,1,q,q,0,1,q,0,-1,-q,0,1,-q,0,-1],M=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],d=[],D=[],T=[],e=[];let r=0;const X=new Array(3),Z=new Array(3);let a;for(a=0;a<3;a++)X[a]=C.bh.Zero(),Z[a]=C.Vector2.Zero();for(let Q=0;Q<20;Q++){for(a=0;a<3;a++){const Y=M[3*Q+a];X[a].Vc(k[3*p[Y]],k[3*p[Y]+1],k[3*p[Y]+2]),X[a].normalize(),Z[a].Vc(.134765625*P[2*Y]+.05859375+-.0390625*y[Q],.2333984375*P[2*Y+1]+.025390625+.01953125*y[Q])}const Y=(Y,c,h,Q)=>{const q=C.bh.Lerp(X[0],X[2],c/N),k=C.bh.Lerp(X[1],X[2],c/N),M=N===c?X[2]:C.bh.Lerp(q,k,Y/(N-c));let p;if(M.normalize(),E){const Y=C.bh.Lerp(X[0],X[2],Q/N),c=C.bh.Lerp(X[1],X[2],Q/N);p=C.bh.Lerp(Y,c,h/(N-Q))}else p=new C.bh(M.x,M.y,M.z);p.x/=H,p.y/=w,p.z/=W,p.normalize();const P=C.Vector2.Lerp(Z[0],Z[2],c/N),y=C.Vector2.Lerp(Z[1],Z[2],c/N),a=N===c?Z[2]:C.Vector2.Lerp(P,y,Y/(N-c));D.push(M.x*H,M.y*w,M.z*W),T.push(p.x,p.y,p.z),e.push(a.x,b.d?1-a.y:a.y),d.push(r),r++};for(let c=0;c<N;c++)for(let h=0;h+c<N;h++)Y(h,c,h+1/3,c+1/3),Y(h+1,c,h+1/3,c+1/3),Y(h,c+1,h+1/3,c+1/3),h+c+1<N&&(Y(h+1,c,h+2/3,c+2/3),Y(h+1,c+1,h+2/3,c+2/3),Y(h,c+1,h+2/3,c+2/3))}Q.b._ComputeSides(c,D,d,T,e,Y.frontUVs,Y.backUVs);const G=new Q.b;return G.indices=d,G.GY=D,G.KY=T,G.sY=e,G}function o(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new E.e(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),C._originalBuilderSideOrientation=c.sideOrientation;return O(c).AY(C,c.updatable),C}Q.b.CreatePolyhedron=g,E.e.CreatePolyhedron=(Y,c,h)=>z(Y,c,h);Q.b.CreateIcoSphere=O,E.e.CreateIcoSphere=(Y,c,h)=>o(Y,c,h);var f=h(12883);const L=new C.bh(1,0,0),u=new C.bh(-1,0,0),i=new C.bh(0,1,0),R=new C.bh(0,-1,0),B=new C.bh(0,0,1),t=new C.bh(0,0,-1);class F{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.bh.Zero(),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.bh.Up(),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Vector2.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Y,this.normal=c,this.uv=h,this.vertexIdx=E,this.vertexIdxForBones=N,this.localPositionOverride=Q,this.localNormalOverride=b,this.matrixIndicesOverride=H,this.matrixWeightsOverride=w}clone(){var Y,c,h,C;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Y=this.localPositionOverride)||void 0===Y?void 0:Y.slice(),null===(c=this.localNormalOverride)||void 0===c?void 0:c.slice(),null===(h=this.matrixIndicesOverride)||void 0===h?void 0:h.slice(),null===(C=this.matrixWeightsOverride)||void 0===C?void 0:C.slice())}}function J(Y,c,h){var H,w,W,q,k;const M=!!c.skeleton,p=!(null===(H=c.morphTargetManager)||void 0===H||!H.numTargets),P=h.localMode||M,y=c.sc(),d=M||p?c.Xw(!0,!0):c.getVerticesData(N.f.PositionKind),D=M||p?c.getNormalsData(!0,!0):c.getVerticesData(N.f.NormalKind),T=P?M?c.getVerticesData(N.f.PositionKind):d:null,e=P?M?c.getVerticesData(N.f.NormalKind):D:null,r=c.getVerticesData(N.f.UVKind),X=M?c.getVerticesData(N.f.MatricesIndicesKind):null,Z=M?c.getVerticesData(N.f.MatricesWeightsKind):null,a=M?c.getVerticesData(N.f.MatricesIndicesExtraKind):null,G=M?c.getVerticesData(N.f.MatricesWeightsExtraKind):null,K=h.position||C.bh.Zero();let I=h.normal||C.bh.Up();const s=h.size||C.bh.One(),x=h.angle||0;if(!I){const Y=new C.bh(0,0,1),h=c.ZY().activeCamera,E=C.bh.TransformCoordinates(Y,h.getWorldMatrix());I=h.globalPosition.Hh(E)}const A=-Math.atan2(I.z,I.x)-Math.PI/2,V=Math.sqrt(I.x*I.x+I.z*I.z),U=Math.atan2(I.y,V),l=new Q.b;l.indices=[],l.GY=[],l.KY=[],l.sY=[],l.matricesIndices=M?[]:null,l.matricesWeights=M?[]:null,l.matricesIndicesExtra=a?[]:null,l.matricesWeightsExtra=G?[]:null;let n=0;const v=(Y,c)=>{const E=new F;if(!y||!d||!D)return E;const N=y[Y];if(E.vertexIdx=3*N,E.vertexIdxForBones=4*N,E.position=new C.bh(d[3*N],d[3*N+1],d[3*N+2]),C.bh.TransformCoordinatesToRef(E.position,c,E.position),E.normal=new C.bh(D[3*N],D[3*N+1],D[3*N+2]),C.bh.TransformNormalToRef(E.normal,c,E.normal),h.captureUVS&&r){const Y=r[2*N+1];E.uv=new C.Vector2(r[2*N],b.d?1-Y:Y)}return E},g=[0,0,0,0],z=(Y,c)=>{if(0===Y.length)return Y;const h=.5*Math.abs(C.bh.Dot(s,c)),E=(Y,c,h,C)=>{for(let E=0;E<C;++E)if(Y[h+E]===c)return h+E;return-1},N=(Y,N)=>{const Q=C.bh.GetClipFactor(Y.position,N.position,c,h);let b=g,H=g;if(X&&Z){const c=Y.matrixIndicesOverride?0:Y.vertexIdxForBones,h=Y.matrixIndicesOverride??X,C=Y.matrixWeightsOverride??Z,w=N.matrixIndicesOverride?0:N.vertexIdxForBones,W=N.matrixIndicesOverride??X,q=N.matrixWeightsOverride??Z;b=[0,0,0,0],H=[0,0,0,0];let k=0;for(let Y=0;Y<4;++Y)if(C[c+Y]>0){const N=E(W,h[c+Y],w,4);b[k]=h[c+Y],H[k]=(0,f.Lerp)(C[c+Y],N>=0?q[N]:0,Q),k++}for(let Y=0;Y<4&&k<4;++Y){const C=W[w+Y];-1===E(h,C,c,4)&&(b[k]=C,H[k]=(0,f.Lerp)(0,q[w+Y],Q),k++)}const M=H[0]+H[1]+H[2]+H[3];H[0]/=M,H[1]/=M,H[2]/=M,H[3]/=M}const w=Y.localPositionOverride?Y.localPositionOverride[0]:(null===T||void 0===T?void 0:T[Y.vertexIdx])??0,W=Y.localPositionOverride?Y.localPositionOverride[1]:(null===T||void 0===T?void 0:T[Y.vertexIdx+1])??0,q=Y.localPositionOverride?Y.localPositionOverride[2]:(null===T||void 0===T?void 0:T[Y.vertexIdx+2])??0,k=N.localPositionOverride?N.localPositionOverride[0]:(null===T||void 0===T?void 0:T[N.vertexIdx])??0,M=N.localPositionOverride?N.localPositionOverride[1]:(null===T||void 0===T?void 0:T[N.vertexIdx+1])??0,p=N.localPositionOverride?N.localPositionOverride[2]:(null===T||void 0===T?void 0:T[N.vertexIdx+2])??0,P=Y.localNormalOverride?Y.localNormalOverride[0]:(null===e||void 0===e?void 0:e[Y.vertexIdx])??0,y=Y.localNormalOverride?Y.localNormalOverride[1]:(null===e||void 0===e?void 0:e[Y.vertexIdx+1])??0,d=Y.localNormalOverride?Y.localNormalOverride[2]:(null===e||void 0===e?void 0:e[Y.vertexIdx+2])??0,D=P+((N.localNormalOverride?N.localNormalOverride[0]:(null===e||void 0===e?void 0:e[N.vertexIdx])??0)-P)*Q,r=y+((N.localNormalOverride?N.localNormalOverride[1]:(null===e||void 0===e?void 0:e[N.vertexIdx+1])??0)-y)*Q,a=d+((N.localNormalOverride?N.localNormalOverride[2]:(null===e||void 0===e?void 0:e[N.vertexIdx+2])??0)-d)*Q,G=Math.sqrt(D*D+r*r+a*a);return new F(C.bh.Lerp(Y.position,N.position,Q),C.bh.Lerp(Y.normal,N.normal,Q).normalize(),C.Vector2.Lerp(Y.uv,N.uv,Q),-1,-1,T?[w+(k-w)*Q,W+(M-W)*Q,q+(p-q)*Q]:null,e?[D/G,r/G,a/G]:null,b,H)};let Q=null;Y.length>3&&(Q=[]);for(let b=0;b<Y.length;b+=3){let E=0,H=null,w=null,W=null,q=null;const k=C.bh.Dot(Y[b].position,c)-h>0,M=C.bh.Dot(Y[b+1].position,c)-h>0,p=C.bh.Dot(Y[b+2].position,c)-h>0;switch(E=(k?1:0)+(M?1:0)+(p?1:0),E){case 0:Y.length>3?(Q.push(Y[b]),Q.push(Y[b+1]),Q.push(Y[b+2])):Q=Y;break;case 1:if(Q=Q??new Array,k&&(H=Y[b+1],w=Y[b+2],W=N(Y[b],H),q=N(Y[b],w)),M){H=Y[b],w=Y[b+2],W=N(Y[b+1],H),q=N(Y[b+1],w),Q.push(W),Q.push(w.clone()),Q.push(H.clone()),Q.push(w.clone()),Q.push(W.clone()),Q.push(q);break}p&&(H=Y[b],w=Y[b+1],W=N(Y[b+2],H),q=N(Y[b+2],w)),H&&w&&W&&q&&(Q.push(H.clone()),Q.push(w.clone()),Q.push(W),Q.push(q),Q.push(W.clone()),Q.push(w.clone()));break;case 2:Q=Q??new Array,k||(H=Y[b].clone(),w=N(H,Y[b+1]),W=N(H,Y[b+2]),Q.push(H),Q.push(w),Q.push(W)),M||(H=Y[b+1].clone(),w=N(H,Y[b+2]),W=N(H,Y[b]),Q.push(H),Q.push(w),Q.push(W)),p||(H=Y[b+2].clone(),w=N(H,Y[b]),W=N(H,Y[b+1]),Q.push(H),Q.push(w),Q.push(W))}}return Q},O=c instanceof E.e?c:null,o=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,J=(null===O||void 0===O?void 0:O.zc)||1,j=C.TmpVectors.Matrix[0];j.N(C.Matrix.IdentityReadOnly);for(let E=0;E<J;++E){if(null!==O&&void 0!==O&&O.hasThinInstances&&o){const Y=16*E;j.setRowFromFloats(0,o[Y+0],o[Y+1],o[Y+2],o[Y+3]),j.setRowFromFloats(1,o[Y+4],o[Y+5],o[Y+6],o[Y+7]),j.setRowFromFloats(2,o[Y+8],o[Y+9],o[Y+10],o[Y+11]),j.setRowFromFloats(3,o[Y+12],o[Y+13],o[Y+14],o[Y+15])}const Y=C.Matrix.RotationYawPitchRoll(A,U,x).multiply(C.Matrix.Translation(K.x,K.y,K.z)),N=C.Matrix.Invert(Y),Q=c.getWorldMatrix(),H=j.multiply(Q).multiply(N),w=new Array(3);for(let c=0;c<y.length;c+=3){let Y=w;if(Y[0]=v(c,H),Y[1]=v(c+1,H),Y[2]=v(c+2,H),!(h.cullBackFaces&&-Y[0].normal.z<=0&&-Y[1].normal.z<=0&&-Y[2].normal.z<=0)&&(Y=z(Y,L),Y&&(Y=z(Y,u),Y&&(Y=z(Y,i),Y&&(Y=z(Y,R),Y&&(Y=z(Y,B),Y&&(Y=z(Y,t),Y)))))))for(let c=0;c<Y.length;c++){const C=Y[c];if(l.indices.push(n),P?(C.localPositionOverride?(l.GY[3*n]=C.localPositionOverride[0],l.GY[3*n+1]=C.localPositionOverride[1],l.GY[3*n+2]=C.localPositionOverride[2]):T&&(l.GY[3*n]=T[C.vertexIdx],l.GY[3*n+1]=T[C.vertexIdx+1],l.GY[3*n+2]=T[C.vertexIdx+2]),C.localNormalOverride?(l.KY[3*n]=C.localNormalOverride[0],l.KY[3*n+1]=C.localNormalOverride[1],l.KY[3*n+2]=C.localNormalOverride[2]):e&&(l.KY[3*n]=e[C.vertexIdx],l.KY[3*n+1]=e[C.vertexIdx+1],l.KY[3*n+2]=e[C.vertexIdx+2])):(C.position.toArray(l.GY,3*n),C.normal.toArray(l.KY,3*n)),l.matricesIndices&&l.matricesWeights&&(C.matrixIndicesOverride?(l.matricesIndices[4*n]=C.matrixIndicesOverride[0],l.matricesIndices[4*n+1]=C.matrixIndicesOverride[1],l.matricesIndices[4*n+2]=C.matrixIndicesOverride[2],l.matricesIndices[4*n+3]=C.matrixIndicesOverride[3]):(X&&(l.matricesIndices[4*n]=X[C.vertexIdxForBones],l.matricesIndices[4*n+1]=X[C.vertexIdxForBones+1],l.matricesIndices[4*n+2]=X[C.vertexIdxForBones+2],l.matricesIndices[4*n+3]=X[C.vertexIdxForBones+3]),a&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*n]=a[C.vertexIdxForBones],l.matricesIndicesExtra[4*n+1]=a[C.vertexIdxForBones+1],l.matricesIndicesExtra[4*n+2]=a[C.vertexIdxForBones+2],l.matricesIndicesExtra[4*n+3]=a[C.vertexIdxForBones+3])),C.matrixWeightsOverride?(l.matricesWeights[4*n]=C.matrixWeightsOverride[0],l.matricesWeights[4*n+1]=C.matrixWeightsOverride[1],l.matricesWeights[4*n+2]=C.matrixWeightsOverride[2],l.matricesWeights[4*n+3]=C.matrixWeightsOverride[3]):(Z&&(l.matricesWeights[4*n]=Z[C.vertexIdxForBones],l.matricesWeights[4*n+1]=Z[C.vertexIdxForBones+1],l.matricesWeights[4*n+2]=Z[C.vertexIdxForBones+2],l.matricesWeights[4*n+3]=Z[C.vertexIdxForBones+3]),G&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*n]=G[C.vertexIdxForBones],l.matricesWeightsExtra[4*n+1]=G[C.vertexIdxForBones+1],l.matricesWeightsExtra[4*n+2]=G[C.vertexIdxForBones+2],l.matricesWeightsExtra[4*n+3]=G[C.vertexIdxForBones+3]))),h.captureUVS)C.uv.toArray(l.sY,2*n);else{l.sY.push(.5+C.position.x/s.x);const Y=.5+C.position.y/s.y;l.sY.push(b.d?1-Y:Y)}n++}}}0===l.indices.length&&(l.indices=null),0===l.GY.length&&(l.GY=null),0===l.KY.length&&(l.KY=null),0===l.sY.length&&(l.sY=null),0===(null===(w=l.matricesIndices)||void 0===w?void 0:w.length)&&(l.matricesIndices=null),0===(null===(W=l.matricesWeights)||void 0===W?void 0:W.length)&&(l.matricesWeights=null),0===(null===(q=l.matricesIndicesExtra)||void 0===q?void 0:q.length)&&(l.matricesIndicesExtra=null),0===(null===(k=l.matricesWeightsExtra)||void 0===k?void 0:k.length)&&(l.matricesWeightsExtra=null);const S=new E.e(Y,c.ZY());return l.AY(S),P?(S.skeleton=c.skeleton,S.parent=c):(S.position=K.clone(),S.rotation=new C.bh(U,A,x)),S.Kc(!0),S.refreshBoundingInfo(!0,!0),S}function j(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const c=0|Math.max(Y.subdivisions?Y.subdivisions:2,1),h=0|Math.max(Y.tessellation?Y.tessellation:16,3),E=Math.max(Y.height?Y.height:1,0),N=Math.max(Y.radius?Y.radius:.25,0),H=0|Math.max(Y.capSubdivisions?Y.capSubdivisions:6,1),w=h,W=c,q=Math.max(Y.radiusTop?Y.radiusTop:N,0),k=Math.max(Y.radiusBottom?Y.radiusBottom:N,0),M=E-(q+k),p=2*Math.PI,P=Math.max(Y.topCapSubdivisions?Y.topCapSubdivisions:H,1),y=Math.max(Y.bottomCapSubdivisions?Y.bottomCapSubdivisions:H,1),d=Math.acos((k-q)/E);let D=[];const T=[],e=[],r=[];let X=0;const Z=[],a=.5*M,G=.5*Math.PI;let K,I;const s=C.bh.Zero(),x=C.bh.Zero(),A=Math.cos(d),V=Math.sin(d),U=new C.Vector2(q*V,a+q*A).Hh(new C.Vector2(k*V,k*A-a)).length(),l=q*d+U+k*(G-d);let n=0;for(I=0;I<=P;I++){const Y=[],c=G-d*(I/P);n+=q*d/P;const h=Math.cos(c),C=Math.sin(c),E=h*q;for(K=0;K<=w;K++){const c=K/w,N=c*p+0,Q=Math.sin(N),H=Math.cos(N);x.x=E*Q,x.y=a+C*q,x.z=E*H,T.push(x.x,x.y,x.z),s.set(h*Q,C,h*H),e.push(s.x,s.y,s.z),r.push(c,b.d?n/l:1-n/l),Y.push(X),X++}Z.push(Y)}const v=E-q-k+A*q-A*k,g=V*(k-q)/v;for(I=1;I<=W;I++){const Y=[];n+=U/W;const c=V*(I*(k-q)/W+q);for(K=0;K<=w;K++){const h=K/w,C=h*p+0,E=Math.sin(C),N=Math.cos(C);x.x=c*E,x.y=a+A*q-I*v/W,x.z=c*N,T.push(x.x,x.y,x.z),s.set(E,g,N).normalize(),e.push(s.x,s.y,s.z),r.push(h,b.d?n/l:1-n/l),Y.push(X),X++}Z.push(Y)}for(I=1;I<=y;I++){const Y=[],c=G-d-(Math.PI-d)*(I/y);n+=k*d/y;const h=Math.cos(c),C=Math.sin(c),E=h*k;for(K=0;K<=w;K++){const c=K/w,N=c*p+0,Q=Math.sin(N),H=Math.cos(N);x.x=E*Q,x.y=C*k-a,x.z=E*H,T.push(x.x,x.y,x.z),s.set(h*Q,C,h*H),e.push(s.x,s.y,s.z),r.push(c,b.d?n/l:1-n/l),Y.push(X),X++}Z.push(Y)}for(K=0;K<w;K++)for(I=0;I<P+W+y;I++){const Y=Z[I][K],c=Z[I+1][K],h=Z[I+1][K+1],C=Z[I][K+1];D.push(Y),D.push(c),D.push(C),D.push(c),D.push(h),D.push(C)}if(D=D.reverse(),Y.orientation&&!Y.orientation.equals(C.bh.Up())){const c=new C.Matrix;Y.orientation.clone().scale(.5*Math.PI).cross(C.bh.Up()).toQuaternion().toRotationMatrix(c);const h=C.bh.Zero();for(let Y=0;Y<T.length;Y+=3)h.set(T[Y],T[Y+1],T[Y+2]),C.bh.TransformCoordinatesToRef(h.clone(),c,h),T[Y]=h.x,T[Y+1]=h.y,T[Y+2]=h.z}const z=new Q.b;return z.GY=T,z.KY=e,z.sY=r,z.indices=D,z}function S(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:C.bh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new E.e(Y,h);return j(c).AY(N,c.updatable),N}E.e.CreateDecal=(Y,c,h,C,E,N)=>J(Y,c,{position:h,normal:C,size:E,angle:N});E.e.CreateCapsule=(Y,c,h)=>S(Y,c,h),Q.b.CreateCapsule=j;var mY=h(12700),YY=h(12874);class cY{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Y,this.y=c,Y!==Math.floor(Y)&&(Y=Math.floor(Y),mY.e.Warn("x is not an integer, floor(x) used")),c!==Math.floor(c)&&(c=Math.floor(c),mY.e.Warn("y is not an integer, floor(y) used"))}clone(){return new cY(this.x,this.y)}rotate60About(Y){const c=this.x;return this.x=Y.x+Y.y-this.y,this.y=c+this.y-Y.x,this}rotateNeg60About(Y){const c=this.x;return this.x=c+this.y-Y.y,this.y=Y.x+Y.y-c,this}rotate120(Y,c){Y!==Math.floor(Y)&&(Y=Math.floor(Y),mY.e.Warn("m not an integer only floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),mY.e.Warn("n not an integer only floor(n) used"));const h=this.x;return this.x=Y-h-this.y,this.y=c+h,this}rotateNeg120(Y,c){Y!==Math.floor(Y)&&(Y=Math.floor(Y),mY.e.Warn("m is not an integer, floor(m) used")),c!==Math.floor(c)&&(c=Math.floor(c),mY.e.Warn("n is not an integer,   floor(n) used"));const h=this.x;return this.x=this.y-c,this.y=Y+c-h-this.y,this}toCartesianOrigin(Y,c){const h=C.bh.Zero();return h.x=Y.x+2*this.x*c+this.y*c,h.y=Y.y+Math.sqrt(3)*this.y*c,h}static Zero(){return new cY(0,0)}}class hY{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new CY("icosahedron","Regular",[[0,YY.h,-1],[-YY.h,1,0],[-1,0,-YY.h],[1,0,-YY.h],[YY.h,1,0],[0,YY.h,1],[-1,0,YY.h],[-YY.h,-1,0],[0,-YY.h,-1],[YY.h,-1,0],[1,0,YY.h],[0,-YY.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Y=12;const c={},h=this.m,C=this.n;let E,N,Q,b,H,w=h,W=1,q=0;0!==C&&(w=(0,f.HighestCommonFactor)(h,C)),W=h/w,q=C/w;const k=cY.Zero(),M=new cY(h,C),p=new cY(-C,h+C),P=cY.Zero(),y=cY.Zero(),d=cY.Zero();let D,T,e,r,X=[];const Z=[],a=this.vertByDist,G=(h,C,E,N)=>{D=h+"|"+E,T=C+"|"+N,D in c||T in c?D in c&&!(T in c)?c[T]=c[D]:T in c&&!(D in c)&&(c[D]=c[T]):(c[D]=Y,c[T]=Y,Y++),a[E][0]>2?Z[c[D]]=[-a[E][0],a[E][1],c[D]]:Z[c[D]]=[X[a[E][0]],a[E][1],c[D]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let K=0;K<20;K++){if(X=this.IDATA.face[K],Q=X[2],b=X[1],H=X[0],e=k.x+"|"+k.y,D=K+"|"+e,D in c||(c[D]=Q,Z[Q]=[X[a[e][0]],a[e][1]]),e=M.x+"|"+M.y,D=K+"|"+e,D in c||(c[D]=b,Z[b]=[X[a[e][0]],a[e][1]]),e=p.x+"|"+p.y,D=K+"|"+e,D in c||(c[D]=H,Z[H]=[X[a[e][0]],a[e][1]]),E=this.IDATA.edgematch[K][0],N=this.IDATA.edgematch[K][1],"B"===N)for(let Y=1;Y<w;Y++)y.x=h-Y*(W+q),y.y=C+Y*W,d.x=-Y*q,d.y=Y*(W+q),e=y.x+"|"+y.y,r=d.x+"|"+d.y,G(K,E,e,r);if("O"===N)for(let Y=1;Y<w;Y++)d.x=-Y*q,d.y=Y*(W+q),P.x=Y*W,P.y=Y*q,e=d.x+"|"+d.y,r=P.x+"|"+P.y,G(K,E,e,r);if(E=this.IDATA.edgematch[K][2],N=this.IDATA.edgematch[K][3],N&&"A"===N)for(let Y=1;Y<w;Y++)P.x=Y*W,P.y=Y*q,y.x=h-(w-Y)*(W+q),y.y=C+(w-Y)*W,e=P.x+"|"+P.y,r=y.x+"|"+y.y,G(K,E,e,r);for(let h=0;h<this.vertices.length;h++)e=this.vertices[h].x+"|"+this.vertices[h].y,D=K+"|"+e,D in c||(c[D]=Y++,a[e][0]>2?Z[c[D]]=[-a[e][0],a[e][1],c[D]]:Z[c[D]]=[X[a[e][0]],a[e][1],c[D]])}this.closestTo=Z,this.vecToidx=c}calcCoeffs(){const Y=this.m,c=this.n,h=Math.sqrt(3)/3,C=Y*Y+c*c+Y*c;this.coau=(Y+c)/C,this.cobu=-c/C,this.coav=-h*(Y-c)/C,this.cobv=h*(2*Y+c)/C}createInnerFacets(){const Y=this.m,c=this.n;for(let h=0;h<c+Y+1;h++)for(let Y=this.min[h];Y<this.max[h]+1;Y++)Y<this.max[h]&&Y<this.max[h+1]+1&&this.innerFacets.push(["|"+Y+"|"+h,"|"+Y+"|"+(h+1),"|"+(Y+1)+"|"+h]),h>0&&Y<this.max[h-1]&&Y+1<this.max[h]+1&&this.innerFacets.push(["|"+Y+"|"+h,"|"+(Y+1)+"|"+h,"|"+(Y+1)+"|"+(h-1)])}edgeVecsABOB(){const Y=this.m,c=this.n,h=new cY(-c,Y+c);for(let C=1;C<Y+c;C++){const Y=new cY(this.min[C],C),c=new cY(this.min[C-1],C-1),E=new cY(this.min[C+1],C+1),N=Y.clone(),Q=c.clone(),b=E.clone();N.rotate60About(h),Q.rotate60About(h),b.rotate60About(h);const H=new cY(this.max[N.y],N.y),w=new cY(this.max[N.y-1],N.y-1),W=new cY(this.max[N.y-1]-1,N.y-1);N.x===H.x&&N.y===H.y||(N.x!==w.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,w,W]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,W,H])):N.y===b.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Y,c,w]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Y,w,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Y,c,w]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Y,w,H])))}}mapABOBtoOBOA(){const Y=new cY(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const h=[];for(let C=0;C<3;C++)Y.x=this.isoVecsABOB[c][C].x,Y.y=this.isoVecsABOB[c][C].y,0===this.vertexTypes[c][C]&&Y.rotateNeg120(this.m,this.n),h.push(Y.clone());this.isoVecsOBOA.push(h)}}mapABOBtoBAOA(){const Y=new cY(0,0);for(let c=0;c<this.isoVecsABOB.length;c++){const h=[];for(let C=0;C<3;C++)Y.x=this.isoVecsABOB[c][C].x,Y.y=this.isoVecsABOB[c][C].y,1===this.vertexTypes[c][C]&&Y.rotate120(this.m,this.n),h.push(Y.clone());this.isoVecsBAOA.push(h)}}MapToFace(Y,c){const h=this.IDATA.face[Y],E=h[2],N=h[1],Q=h[0],b=C.bh.dh(this.IDATA.vertex[E]),H=C.bh.dh(this.IDATA.vertex[N]),w=C.bh.dh(this.IDATA.vertex[Q]),W=H.Hh(b),q=w.Hh(b),k=W.scale(this.coau).add(q.scale(this.cobu)),M=W.scale(this.coav).add(q.scale(this.cobv)),p=[];let P,y=C.TmpVectors.bh[0];for(let C=0;C<this.cartesian.length;C++)y=k.scale(this.cartesian[C].x).add(M.scale(this.cartesian[C].y)).add(b),p[C]=[y.x,y.y,y.z],P=Y+"|"+this.vertices[C].x+"|"+this.vertices[C].y,c.vertex[this.vecToidx[P]]=[y.x,y.y,y.z]}build(Y,c){const h=[],C=cY.Zero(),E=new cY(Y,c),N=new cY(-c,Y+c);h.push(C,E,N);for(let e=c;e<Y+1;e++)for(let c=0;c<Y+1-e;c++)h.push(new cY(c,e));if(c>0){const C=(0,f.HighestCommonFactor)(Y,c),E=Y/C,N=c/C;for(let b=1;b<C;b++)h.push(new cY(b*E,b*N)),h.push(new cY(-b*N,b*(E+N))),h.push(new cY(Y-b*(E+N),c+b*E));const Q=Y/c;for(let b=1;b<c;b++)for(let C=0;C<b*Q;C++)h.push(new cY(C,b)),h.push(new cY(C,b).rotate120(Y,c)),h.push(new cY(C,b).rotateNeg120(Y,c))}h.sort(((Y,c)=>Y.x-c.x)),h.sort(((Y,c)=>Y.y-c.y));const Q=new Array(Y+c+1),b=new Array(Y+c+1);for(let e=0;e<Q.length;e++)Q[e]=1/0,b[e]=-1/0;let H=0,w=0;const W=h.length;for(let e=0;e<W;e++)w=h[e].x,H=h[e].y,Q[H]=Math.min(w,Q[H]),b[H]=Math.max(w,b[H]);const q=(h,C)=>{const E=h.clone();return"A"===C&&E.rotateNeg120(Y,c),"B"===C&&E.rotate120(Y,c),E.x<0?E.y:E.x+E.y},k=[],M=[],p=[],P=[],y={},d=[];let D=-1,T=-1;for(let e=0;e<W;e++)k[e]=h[e].toCartesianOrigin(new cY(0,0),.5),M[e]=q(h[e],"O"),p[e]=q(h[e],"A"),P[e]=q(h[e],"B"),M[e]===p[e]&&p[e]===P[e]?(D=3,T=M[e]):M[e]===p[e]?(D=4,T=M[e]):p[e]===P[e]?(D=5,T=p[e]):P[e]===M[e]&&(D=6,T=M[e]),M[e]<p[e]&&M[e]<P[e]&&(D=2,T=M[e]),p[e]<M[e]&&p[e]<P[e]&&(D=1,T=p[e]),P[e]<p[e]&&P[e]<M[e]&&(D=0,T=P[e]),d.push([D,T,h[e].x,h[e].y]);d.sort(((Y,c)=>Y[2]-c[2])),d.sort(((Y,c)=>Y[3]-c[3])),d.sort(((Y,c)=>Y[1]-c[1])),d.sort(((Y,c)=>Y[0]-c[0]));for(let e=0;e<d.length;e++)y[d[e][2]+"|"+d[e][3]]=[d[e][0],d[e][1],e];return this.m=Y,this.n=c,this.vertices=h,this.vertByDist=y,this.cartesian=k,this.min=Q,this.max=b,this}}class CY{constructor(Y,c,h,C){this.name=Y,this.category=c,this.vertex=h,this.face=C}}class EY extends CY{innerToData(Y,c){for(let h=0;h<c.innerFacets.length;h++)this.face.push(c.innerFacets[h].map((h=>c.vecToidx[Y+h])))}mapABOBtoDATA(Y,c){const h=c.IDATA.edgematch[Y][0];for(let C=0;C<c.isoVecsABOB.length;C++){const E=[];for(let N=0;N<3;N++)0===c.vertexTypes[C][N]?E.push(Y+"|"+c.isoVecsABOB[C][N].x+"|"+c.isoVecsABOB[C][N].y):E.push(h+"|"+c.isoVecsABOB[C][N].x+"|"+c.isoVecsABOB[C][N].y);this.face.push([c.vecToidx[E[0]],c.vecToidx[E[1]],c.vecToidx[E[2]]])}}mapOBOAtoDATA(Y,c){const h=c.IDATA.edgematch[Y][0];for(let C=0;C<c.isoVecsOBOA.length;C++){const E=[];for(let N=0;N<3;N++)1===c.vertexTypes[C][N]?E.push(Y+"|"+c.isoVecsOBOA[C][N].x+"|"+c.isoVecsOBOA[C][N].y):E.push(h+"|"+c.isoVecsOBOA[C][N].x+"|"+c.isoVecsOBOA[C][N].y);this.face.push([c.vecToidx[E[0]],c.vecToidx[E[1]],c.vecToidx[E[2]]])}}mapBAOAtoDATA(Y,c){const h=c.IDATA.edgematch[Y][2];for(let C=0;C<c.isoVecsBAOA.length;C++){const E=[];for(let N=0;N<3;N++)1===c.vertexTypes[C][N]?E.push(Y+"|"+c.isoVecsBAOA[C][N].x+"|"+c.isoVecsBAOA[C][N].y):E.push(h+"|"+c.isoVecsBAOA[C][N].x+"|"+c.isoVecsBAOA[C][N].y);this.face.push([c.vecToidx[E[0]],c.vecToidx[E[1]],c.vecToidx[E[2]]])}}orderData(Y){const c=[];for(let N=0;N<13;N++)c[N]=[];const h=Y.closestTo;for(let N=0;N<h.length;N++)h[N][0]>-1?h[N][1]>0&&c[h[N][0]].push([N,h[N][1]]):c[12].push([N,h[N][0]]);const C=[];for(let N=0;N<12;N++)C[N]=N;let E=12;for(let N=0;N<12;N++){c[N].sort(((Y,c)=>Y[1]-c[1]));for(let Y=0;Y<c[N].length;Y++)C[c[N][Y][0]]=E++}for(let N=0;N<c[12].length;N++)C[c[12][N][0]]=E++;for(let N=0;N<this.vertex.length;N++)this.vertex[N].push(C[N]);this.vertex.sort(((Y,c)=>Y[3]-c[3]));for(let N=0;N<this.vertex.length;N++)this.vertex[N].pop();for(let N=0;N<this.face.length;N++)for(let Y=0;Y<this.face[N].length;Y++)this.face[N][Y]=C[this.face[N][Y]];this.sharedNodes=c[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Y,c){const h=[],C=[];let E=c.pop();C.push(E);let N=this.face[E].indexOf(Y);N=(N+2)%3;let Q=this.face[E][N];h.push(Q);let b=0;for(;c.length>0;)E=c[b],this.face[E].indexOf(Q)>-1?(N=(this.face[E].indexOf(Q)+1)%3,Q=this.face[E][N],h.push(Q),C.push(E),c.splice(b,1),b=0):b++;return this.adjacentFaces.push(h),C}toGoldbergPolyhedronData(){const Y=new CY("GeoDual","Goldberg",[],[]);Y.name="GD dual";const c=this.vertex.length,h=new Array(c);for(let H=0;H<c;H++)h[H]=[];for(let H=0;H<this.face.length;H++)for(let Y=0;Y<3;Y++)h[this.face[H][Y]].push(H);let C=0,E=0,N=0,Q=[],b=[];this.adjacentFaces=[];for(let H=0;H<h.length;H++){Y.face[H]=this.setOrder(H,h[H].concat([]));for(const c of h[H]){C=0,E=0,N=0,Q=this.face[c];for(let Y=0;Y<3;Y++)b=this.vertex[Q[Y]],C+=b[0],E+=b[1],N+=b[2];Y.vertex[c]=[C/3,E/3,N/3]}}return Y}static BuildGeodesicData(Y){const c=new EY("Geodesic-m-n","Geodesic",[[0,YY.h,-1],[-YY.h,1,0],[-1,0,-YY.h],[1,0,-YY.h],[YY.h,1,0],[0,YY.h,1],[-1,0,YY.h],[-YY.h,-1,0],[0,-YY.h,-1],[YY.h,-1,0],[1,0,YY.h],[0,-YY.h,1]],[]);Y.setIndices(),Y.calcCoeffs(),Y.createInnerFacets(),Y.edgeVecsABOB(),Y.mapABOBtoOBOA(),Y.mapABOBtoBAOA();for(let h=0;h<Y.IDATA.face.length;h++)Y.MapToFace(h,c),c.innerToData(h,Y),"B"===Y.IDATA.edgematch[h][1]&&c.mapABOBtoDATA(h,Y),"O"===Y.IDATA.edgematch[h][1]&&c.mapOBOAtoDATA(h,Y),"A"===Y.IDATA.edgematch[h][3]&&c.mapBAOAtoDATA(h,Y);c.orderData(Y);return c.vertex=c.vertex.map((function(Y){const c=Y[0],h=Y[1],C=Y[2],E=Math.sqrt(c*c+h*h+C*C);return Y[0]*=1/E,Y[1]*=1/E,Y[2]*=1/E,Y})),c}}E.e._GoldbergMeshParser=(Y,c)=>NY.Parse(Y,c);class NY extends E.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Y,c){return void 0===c?(Y>this.goldbergData.nbUnsharedFaces-1&&(mY.e.Warn("Maximum number of unshared faces used"),Y=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Y):(Y>11&&(mY.e.Warn("Last pole used"),Y=11),c>this.goldbergData.nbFacesAtPole-1&&(mY.e.Warn("Maximum number of faces at a pole used"),c=this.goldbergData.nbFacesAtPole-1),12+Y*this.goldbergData.nbFacesAtPole+c)}_changeGoldbergFaceColors(Y){for(let h=0;h<Y.length;h++){const c=Y[h][0],C=Y[h][1],E=Y[h][2];for(let Y=c;Y<C+1;Y++)this.goldbergData.faceColors[Y]=E}const c=[];for(let h=0;h<12;h++)for(let Y=0;Y<5;Y++)c.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);for(let h=12;h<this.goldbergData.faceColors.length;h++)for(let Y=0;Y<6;Y++)c.push(this.goldbergData.faceColors[h].r,this.goldbergData.faceColors[h].g,this.goldbergData.faceColors[h].b,this.goldbergData.faceColors[h].a);return c}setGoldbergFaceColors(Y){const c=this._changeGoldbergFaceColors(Y);this.nY(N.f.ColorKind,c)}updateGoldbergFaceColors(Y){const c=this._changeGoldbergFaceColors(Y);this.updateVerticesData(N.f.ColorKind,c)}_changeGoldbergFaceUVs(Y){const c=this.getVerticesData(N.f.UVKind);for(let h=0;h<Y.length;h++){const C=Y[h][0],E=Y[h][1],N=Y[h][2],Q=Y[h][3],b=Y[h][4],H=[],w=[];let W,q;for(let Y=0;Y<5;Y++)W=N.x+Q*Math.cos(b+Y*Math.PI/2.5),q=N.y+Q*Math.sin(b+Y*Math.PI/2.5),W<0&&(W=0),W>1&&(W=1),H.push(W,q);for(let Y=0;Y<6;Y++)W=N.x+Q*Math.cos(b+Y*Math.PI/3),q=N.y+Q*Math.sin(b+Y*Math.PI/3),W<0&&(W=0),W>1&&(W=1),w.push(W,q);for(let Y=C;Y<Math.min(12,E+1);Y++)for(let h=0;h<5;h++)c[10*Y+2*h]=H[2*h],c[10*Y+2*h+1]=H[2*h+1];for(let Y=Math.max(12,C);Y<E+1;Y++)for(let h=0;h<6;h++)c[12*Y-24+2*h]=w[2*h],c[12*Y-23+2*h]=w[2*h+1]}return c}setGoldbergFaceUVs(Y){const c=this._changeGoldbergFaceUVs(Y);this.nY(N.f.UVKind,c)}updateGoldbergFaceUVs(Y){const c=this._changeGoldbergFaceUVs(Y);this.updateVerticesData(N.f.UVKind,c)}placeOnGoldbergFaceAt(Y,c,h){const E=C.bh.RotationFromAxis(this.goldbergData.faceXaxis[c],this.goldbergData.faceYaxis[c],this.goldbergData.faceZaxis[c]);Y.rotation=E,Y.position=this.goldbergData.faceCenters[c].add(this.goldbergData.faceXaxis[c].scale(h.x)).add(this.goldbergData.faceYaxis[c].scale(h.y)).add(this.goldbergData.faceZaxis[c].scale(h.z))}serialize(Y){super.serialize(Y),Y.type="GoldbergMesh";const c={};if(c.adjacentFaces=this.goldbergData.adjacentFaces,c.nbSharedFaces=this.goldbergData.nbSharedFaces,c.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,c.nbFaces=this.goldbergData.nbFaces,c.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){c.faceColors=[];for(const Y of this.goldbergData.faceColors)c.faceColors.push(Y.Xc())}if(this.goldbergData.faceCenters){c.faceCenters=[];for(const Y of this.goldbergData.faceCenters)c.faceCenters.push(Y.Xc())}if(this.goldbergData.faceZaxis){c.faceZaxis=[];for(const Y of this.goldbergData.faceZaxis)c.faceZaxis.push(Y.Xc())}if(this.goldbergData.faceYaxis){c.faceYaxis=[];for(const Y of this.goldbergData.faceYaxis)c.faceYaxis.push(Y.Xc())}if(this.goldbergData.faceXaxis){c.faceXaxis=[];for(const Y of this.goldbergData.faceXaxis)c.faceXaxis.push(Y.Xc())}Y.goldbergData=c}static Parse(Y,c){const h=Y.goldbergData;h.faceColors=h.faceColors.map((Y=>k.vc.dh(Y))),h.faceCenters=h.faceCenters.map((Y=>C.bh.dh(Y))),h.faceZaxis=h.faceZaxis.map((Y=>C.bh.dh(Y))),h.faceXaxis=h.faceXaxis.map((Y=>C.bh.dh(Y))),h.faceYaxis=h.faceYaxis.map((Y=>C.bh.dh(Y)));const E=new NY(Y.name,c);return E.goldbergData=h,E}}var QY=h(13435);const bY={CreateBox:q.c,CreateTiledBox:y,CreateSphere:d.b,CreateDisc:W.e,CreateIcoSphere:o,CreateRibbon:w,CreateCylinder:r,CreateTorus:Z,CreateTorusKnot:G,CreateLineSystem:K.d,Qq:K.e,CreateDashedLines:K.c,ExtrudeShape:x,ExtrudeShapeCustom:A,CreateLathe:U,CreateTiledPlane:p,wq:l.e,CreateGround:n.f,CreateTiledGround:n.h,CreateGroundFromHeightMap:n.c,CreatePolygon:I.c,ExtrudePolygon:I.e,CreateTube:v,CreatePolyhedron:z,CreateGeodesic:function(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=c.m||1;C!==Math.floor(C)&&(C=Math.floor(C),mY.e.Warn("m not an integer only floor(m) used"));let E=c.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),mY.e.Warn("n not an integer only floor(n) used")),E>C){const Y=E;E=C,C=Y,mY.e.Warn("n > m therefore m and n swapped")}const N=new hY;return N.build(C,E),z(Y,{custom:EY.BuildGeodesicData(N),size:c.size,sizeX:c.sizeX,sizeY:c.sizeY,sizeZ:c.sizeZ,faceUV:c.faceUV,faceColors:c.faceColors,flat:c.flat,updatable:c.updatable,sideOrientation:c.sideOrientation,frontUVs:c.frontUVs,backUVs:c.backUVs},h)},CreateGoldberg:function(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=c.size,H=c.sizeX||N||1,w=c.sizeY||N||1,W=c.sizeZ||N||1;let q=c.m||1;q!==Math.floor(q)&&(q=Math.floor(q),mY.e.Warn("m not an integer only floor(m) used"));let M=c.n||0;if(M!==Math.floor(M)&&(M=Math.floor(M),mY.e.Warn("n not an integer only floor(n) used")),M>q){const Y=M;M=q,q=Y,mY.e.Warn("n > m therefore m and n swapped")}const p=new hY;p.build(q,M);const P=EY.BuildGeodesicData(p),y=P.toGoldbergPolyhedronData(),d=new NY(Y,h);c.sideOrientation=E.e._GetDefaultSideOrientation(c.sideOrientation),d._originalBuilderSideOrientation=c.sideOrientation;(function(Y,c){const h=Y.size,E=Y.sizeX||h||1,N=Y.sizeY||h||1,H=Y.sizeZ||h||1,w=0===Y.sideOrientation?0:Y.sideOrientation||Q.b.DEFAULTSIDE,W=[],q=[],k=[],M=[];let p=1/0,P=-1/0,y=1/0,d=-1/0;for(let C=0;C<c.vertex.length;C++)p=Math.min(p,c.vertex[C][0]*E),P=Math.max(P,c.vertex[C][0]*E),y=Math.min(y,c.vertex[C][1]*N),d=Math.max(d,c.vertex[C][1]*N);let D=0;for(let Q=0;Q<c.face.length;Q++){const Y=c.face[Q],h=C.bh.dh(c.vertex[Y[0]]),w=C.bh.dh(c.vertex[Y[2]]),T=C.bh.dh(c.vertex[Y[1]]),e=w.Hh(h),r=T.Hh(h),X=C.bh.Cross(r,e).normalize();for(let C=0;C<Y.length;C++){k.push(X.x,X.y,X.z);const h=c.vertex[Y[C]];W.push(h[0]*E,h[1]*N,h[2]*H);const Q=(h[1]*N-y)/(d-y);M.push((h[0]*E-p)/(P-p),b.d?1-Q:Q)}for(let c=0;c<Y.length-2;c++)q.push(D,D+c+2,D+c+1);D+=Y.length}Q.b._ComputeSides(w,W,q,k,M);const T=new Q.b;return T.GY=W,T.indices=q,T.KY=k,T.sY=M,T})(c,y).AY(d,c.updatable),d.goldbergData.nbSharedFaces=P.sharedNodes,d.goldbergData.nbUnsharedFaces=P.poleNodes,d.goldbergData.adjacentFaces=P.adjacentFaces,d.goldbergData.nbFaces=d.goldbergData.nbSharedFaces+d.goldbergData.nbUnsharedFaces,d.goldbergData.nbFacesAtPole=(d.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<P.vertex.length;E++)d.goldbergData.faceCenters.push(C.bh.dh(P.vertex[E])),d.goldbergData.faceCenters[E].x*=H,d.goldbergData.faceCenters[E].y*=w,d.goldbergData.faceCenters[E].z*=W,d.goldbergData.faceColors.push(new k.vc(1,1,1,1));for(let E=0;E<y.face.length;E++){const Y=y.face[E],c=C.bh.dh(y.vertex[Y[0]]),h=C.bh.dh(y.vertex[Y[2]]),N=C.bh.dh(y.vertex[Y[1]]),Q=h.Hh(c),b=N.Hh(c),H=C.bh.Cross(b,Q).normalize(),w=C.bh.Cross(b,H).normalize();d.goldbergData.faceXaxis.push(b.normalize()),d.goldbergData.faceYaxis.push(H),d.goldbergData.faceZaxis.push(w)}return d},CreateDecal:J,CreateCapsule:S,CreateText:QY.c}},14044:(Y,c,h)=>{"use strict";h.d(c,{c:()=>bc});var C=h(12869),E=h(13265);class N extends E.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Q=h(12920),b=(h(13050),h(12825));class H{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Y){this._targetStopDuration!==Y&&(this._targetStopDuration=Y)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Y){this._noiseTexture!==Y&&(this._noiseTexture=Y,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Y){this._animationSheetEnabled!==Y&&(this._animationSheetEnabled=Y)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Y){this._isAnimationSheetEnabled!=Y&&(this._isAnimationSheetEnabled=Y,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Y){this._useLogarithmicDepth=Y&&this.ZY().getEngine().getCaps().fragmentDepthSupported}ZY(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Y){switch(Y){case H.BLENDMODE_MULTIPLYADD:return;case H.BLENDMODE_ADD:Y=1;break;case H.BLENDMODE_ONEONE:Y=6;break;case H.BLENDMODE_STANDARD:Y=2;break;case H.BLENDMODE_MULTIPLY:Y=4;break;case H.BLENDMODE_SUBTRACT:Y=3}this._engine.setAlphaMode(Y)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:C.bh.Zero()}set direction1(Y){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Y)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:C.bh.Zero()}set direction2(Y){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Y)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:C.bh.Zero()}set minEmitBox(Y){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Y)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:C.bh.Zero()}set maxEmitBox(Y){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Y)}get billboardMode(){return this._billboardMode}set billboardMode(Y){this._billboardMode!==Y&&(this._billboardMode=Y,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Y){this._isBillboardBased!==Y&&(this._isBillboardBased=Y,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Y){this._attachImageProcessingConfiguration(Y)}_attachImageProcessingConfiguration(Y){Y!==this._imageProcessingConfiguration&&(!Y&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Y)}_reset(){}_removeGradientAndTexture(Y,c,h){if(!c)return this;let C=0;for(const E of c){if(E.gradient===Y){c.splice(C,1);break}C++}return h&&h.dispose(),this}constructor(Y){this.animations=[],this.renderingGroupId=0,this.Cc=C.bh.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new C.bh(10,10,10),this.onAnimationEnd=null,this.blendMode=H.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new C.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Cq=new C.bh(0,0,0),this._useLogarithmicDepth=!1,this.gravity=C.bh.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Q.vc(1,1,1,1),this.color2=new Q.vc(1,1,1,1),this.colorDead=new Q.vc(0,0,0,1),this.textureMask=new Q.vc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new N,this.id=Y,this.name=Y}createPointEmitter(Y,c){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new C.bh(0,1,0),arguments.length>2&&void 0!==arguments[2]||new C.bh(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new C.bh(0,1,0),arguments.length>4&&void 0!==arguments[4]||new C.bh(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new C.bh(0,1,0),arguments.length>3&&void 0!==arguments[3]||new C.bh(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Y,c,h,C){throw new Error("Method not implemented.")}}H.BLENDMODE_ONEONE=0,H.BLENDMODE_STANDARD=1,H.BLENDMODE_ADD=2,H.BLENDMODE_MULTIPLY=3,H.BLENDMODE_MULTIPLYADD=4,H.BLENDMODE_SUBTRACT=-1,(0,b.e)("BABYLON.BaseParticleSystem",H);var w=h(12883),W=h(12707);class q{constructor(){this.direction1=new C.bh(0,1,0),this.direction2=new C.bh(0,1,0),this.minEmitBox=new C.bh(-.5,-.5,-.5),this.maxEmitBox=new C.bh(.5,.5,.5)}startDirectionFunction(Y,c,h,E){const N=(0,w.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),b=(0,w.RandomRange)(this.direction1.z,this.direction2.z);if(E)return c.x=N,c.y=Q,void(c.z=b);C.bh.TransformNormalFromFloatsToRef(N,Q,b,Y,c)}startPositionFunction(Y,c,h,E){const N=(0,w.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Q=(0,w.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),b=(0,w.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return c.x=N,c.y=Q,void(c.z=b);C.bh.TransformCoordinatesFromFloatsToRef(N,Q,b,Y,c)}clone(){const Y=new q;return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2),Y.setVector3("minEmitBox",this.minEmitBox),Y.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3),Y.addUniform("minEmitBox",3),Y.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.direction1=this.direction1.Xc(),Y.direction2=this.direction2.Xc(),Y.minEmitBox=this.minEmitBox.Xc(),Y.maxEmitBox=this.maxEmitBox.Xc(),Y}parse(Y){C.bh.FromArrayToRef(Y.direction1,0,this.direction1),C.bh.FromArrayToRef(Y.direction2,0,this.direction2),C.bh.FromArrayToRef(Y.minEmitBox,0,this.minEmitBox),C.bh.FromArrayToRef(Y.maxEmitBox,0,this.maxEmitBox)}}class k{get radius(){return this._radius}set radius(Y){this._radius=Y,this._buildHeight()}get angle(){return this._angle}set angle(Y){this._angle=Y,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=h,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=c,this.radius=Y}startDirectionFunction(Y,c,h,E){E?C.TmpVectors.bh[0].N(h.Uw).normalize():h.position.subtractToRef(Y.getTranslation(),C.TmpVectors.bh[0]).normalize();const N=(0,w.RandomRange)(0,this.directionRandomizer),Q=(0,w.RandomRange)(0,this.directionRandomizer),b=(0,w.RandomRange)(0,this.directionRandomizer);c.x=C.TmpVectors.bh[0].x+N,c.y=C.TmpVectors.bh[0].y+Q,c.z=C.TmpVectors.bh[0].z+b,c.normalize()}startPositionFunction(Y,c,h,E){const N=(0,w.RandomRange)(0,2*Math.PI);let Q;this.emitFromSpawnPointOnly?Q=1e-4:(Q=(0,w.RandomRange)(0,this.heightRange),Q=1-Q*Q);let b=this._radius-(0,w.RandomRange)(0,this._radius*this.radiusRange);b*=Q;const H=b*Math.sin(N),W=b*Math.cos(N),q=Q*this._height;if(E)return c.x=H,c.y=q,void(c.z=W);C.bh.TransformCoordinatesFromFloatsToRef(H,q,W,Y,c)}clone(){const Y=new k(this._radius,this._angle,this.directionRandomizer);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat2("radius",this._radius,this.radiusRange),Y.setFloat("coneAngle",this._angle),Y.setFloat2("height",this._height,this.heightRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",2),Y.addUniform("coneAngle",1),Y.addUniform("height",2),Y.addUniform("directionRandomizer",1)}getEffectDefines(){let Y="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Y+="\n#define CONEEMITTERSPAWNPOINT"),Y}getClassName(){return"ConeParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this._radius,Y.angle=this._angle,Y.directionRandomizer=this.directionRandomizer,Y.radiusRange=this.radiusRange,Y.heightRange=this.heightRange,Y.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Y}parse(Y){this.radius=Y.radius,this.angle=Y.angle,this.directionRandomizer=Y.directionRandomizer,this.radiusRange=void 0!==Y.radiusRange?Y.radiusRange:1,this.heightRange=void 0!==Y.radiusRange?Y.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Y.emitFromSpawnPointOnly&&Y.emitFromSpawnPointOnly}}class M extends k{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0);super(Y,c),this.direction1=h,this.direction2=E}startDirectionFunction(Y,c){const h=(0,w.RandomRange)(this.direction1.x,this.direction2.x),E=(0,w.RandomRange)(this.direction1.y,this.direction2.y),N=(0,w.RandomRange)(this.direction1.z,this.direction2.z);C.bh.TransformNormalFromFloatsToRef(h,E,N,Y,c)}clone(){const Y=new M(this.radius,this.angle,this.direction1,this.direction2);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.Xc(),Y.direction2=this.direction2.Xc(),Y}parse(Y){super.parse(Y),this.direction1.N(Y.direction1),this.direction2.N(Y.direction2)}}class p{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Y,this.height=c,this.radiusRange=h,this.directionRandomizer=E,this._tempVector=C.bh.Zero()}startDirectionFunction(Y,c,h,E,N){h.position.subtractToRef(Y.getTranslation(),this._tempVector),this._tempVector.normalize(),C.bh.TransformNormalToRef(this._tempVector,N,this._tempVector);const Q=(0,w.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let b=Math.atan2(this._tempVector.x,this._tempVector.z);b+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Q,this._tempVector.x=Math.sin(b),this._tempVector.z=Math.cos(b),this._tempVector.normalize(),E?c.N(this._tempVector):C.bh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Y,c)}startPositionFunction(Y,c,h,E){const N=(0,w.RandomRange)(-this.height/2,this.height/2),Q=(0,w.RandomRange)(0,2*Math.PI),b=(0,w.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),H=Math.sqrt(b)*this.radius,W=H*Math.cos(Q),q=H*Math.sin(Q);E?c.Vc(W,N,q):C.bh.TransformCoordinatesFromFloatsToRef(W,N,q,Y,c)}clone(){const Y=new p(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("height",this.height),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("height",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.height=this.height,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.height=Y.height,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class P extends p{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.bh(0,1,0);super(Y,c,h),this.direction1=E,this.direction2=N}startDirectionFunction(Y,c,h,E){const N=(0,w.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),b=(0,w.RandomRange)(this.direction1.z,this.direction2.z);E?c.Vc(N,Q,b):C.bh.TransformNormalFromFloatsToRef(N,Q,b,Y,c)}clone(){const Y=new P(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("height",this.height),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("height",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.Xc(),Y.direction2=this.direction2.Xc(),Y}parse(Y){super.parse(Y),C.bh.FromArrayToRef(Y.direction1,0,this.direction1),C.bh.FromArrayToRef(Y.direction2,0,this.direction2)}}class y{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Y,this.radiusRange=c,this.directionRandomizer=h}startDirectionFunction(Y,c,h,E){const N=h.position.Hh(Y.getTranslation()).normalize(),Q=(0,w.RandomRange)(0,this.directionRandomizer),b=(0,w.RandomRange)(0,this.directionRandomizer),H=(0,w.RandomRange)(0,this.directionRandomizer);N.x+=Q,N.y+=b,N.z+=H,N.normalize(),E?c.N(N):C.bh.TransformNormalFromFloatsToRef(N.x,N.y,N.z,Y,c)}startPositionFunction(Y,c,h,E){const N=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),Q=(0,w.RandomRange)(0,1),b=(0,w.RandomRange)(0,2*Math.PI),H=Math.acos(2*Q-1),W=N*Math.cos(b)*Math.sin(H),q=N*Math.cos(H),k=N*Math.sin(b)*Math.sin(H);E?c.Vc(W,Math.abs(q),k):C.bh.TransformCoordinatesFromFloatsToRef(W,Math.abs(q),k,Y,c)}clone(){const Y=new y(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class d{constructor(){this.direction1=new C.bh(0,1,0),this.direction2=new C.bh(0,1,0)}startDirectionFunction(Y,c,h,E){const N=(0,w.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),b=(0,w.RandomRange)(this.direction1.z,this.direction2.z);E?c.Vc(N,Q,b):C.bh.TransformNormalFromFloatsToRef(N,Q,b,Y,c)}startPositionFunction(Y,c,h,E){E?c.Vc(0,0,0):C.bh.TransformCoordinatesFromFloatsToRef(0,0,0,Y,c)}clone(){const Y=new d;return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.direction1=this.direction1.Xc(),Y.direction2=this.direction2.Xc(),Y}parse(Y){C.bh.FromArrayToRef(Y.direction1,0,this.direction1),C.bh.FromArrayToRef(Y.direction2,0,this.direction2)}}class D{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Y,this.radiusRange=c,this.directionRandomizer=h}startDirectionFunction(Y,c,h,E){const N=h.position.Hh(Y.getTranslation()).normalize(),Q=(0,w.RandomRange)(0,this.directionRandomizer),b=(0,w.RandomRange)(0,this.directionRandomizer),H=(0,w.RandomRange)(0,this.directionRandomizer);N.x+=Q,N.y+=b,N.z+=H,N.normalize(),E?c.N(N):C.bh.TransformNormalFromFloatsToRef(N.x,N.y,N.z,Y,c)}startPositionFunction(Y,c,h,E){const N=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),Q=(0,w.RandomRange)(0,1),b=(0,w.RandomRange)(0,2*Math.PI),H=Math.acos(2*Q-1),W=N*Math.cos(b)*Math.sin(H),q=N*Math.cos(H),k=N*Math.sin(b)*Math.sin(H);E?c.Vc(W,q,k):C.bh.TransformCoordinatesFromFloatsToRef(W,q,k,Y,c)}clone(){const Y=new D(this.radius,this.directionRandomizer);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.radius=this.radius,Y.radiusRange=this.radiusRange,Y.directionRandomizer=this.directionRandomizer,Y}parse(Y){this.radius=Y.radius,this.radiusRange=Y.radiusRange,this.directionRandomizer=Y.directionRandomizer}}class T extends D{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.bh(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0);super(Y),this.direction1=c,this.direction2=h}startDirectionFunction(Y,c){const h=(0,w.RandomRange)(this.direction1.x,this.direction2.x),E=(0,w.RandomRange)(this.direction1.y,this.direction2.y),N=(0,w.RandomRange)(this.direction1.z,this.direction2.z);C.bh.TransformNormalFromFloatsToRef(h,E,N,Y,c)}clone(){const Y=new T(this.radius,this.direction1,this.direction2);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setFloat("radius",this.radius),Y.setFloat("radiusRange",this.radiusRange),Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("radius",1),Y.addUniform("radiusRange",1),Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Y=super.serialize();return Y.direction1=this.direction1.Xc(),Y.direction2=this.direction2.Xc(),Y}parse(Y){super.parse(Y),this.direction1.N(Y.direction1),this.direction2.N(Y.direction2)}}class e{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Y,c,h,E){const N=C.TmpVectors.bh[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,h,N);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,h,N);const Y=C.TmpVectors.bh[1];N.subtractToRef(h.position,Y),Y.scaleToRef(1/h.lifeTime,N)}else N.set(0,0,0);E?c.N(N):C.bh.TransformNormalToRef(N,Y,c)}startPositionFunction(Y,c,h,E){const N=C.TmpVectors.bh[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,h,N):N.set(0,0,0),E?c.N(N):C.bh.TransformCoordinatesToRef(N,Y,c)}clone(){const Y=new e;return W.b.DeepCopy(this,Y),Y}applyToShader(Y){}buildUniformLayout(Y){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Y={};return Y.type=this.getClassName(),Y.particlePositionGenerator=this.particlePositionGenerator,Y.particleDestinationGenerator=this.particleDestinationGenerator,Y}parse(Y){Y.particlePositionGenerator&&(this.particlePositionGenerator=Y.particlePositionGenerator),Y.particleDestinationGenerator&&(this.particleDestinationGenerator=Y.particleDestinationGenerator)}}var r=h(12951);class X{get mesh(){return this._mesh}set mesh(Y){this._mesh!==Y&&(this._mesh=Y,Y?(this._indices=Y.sc(),this._positions=Y.getVerticesData(r.f.PositionKind),this._normals=Y.getVerticesData(r.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=C.bh.Zero(),this._mesh=null,this.direction1=new C.bh(0,1,0),this.direction2=new C.bh(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Y}startDirectionFunction(Y,c,h,E){if(this.useMeshNormalsForDirection&&this._normals)return void C.bh.TransformNormalToRef(this._storedNormal,Y,c);const N=(0,w.RandomRange)(this.direction1.x,this.direction2.x),Q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),b=(0,w.RandomRange)(this.direction1.z,this.direction2.z);E?c.Vc(N,Q,b):C.bh.TransformNormalFromFloatsToRef(N,Q,b,Y,c)}startPositionFunction(Y,c,h,E){if(!this._indices||!this._positions)return;const N=3*(Math.random()*(this._indices.length/3)|0),Q=Math.random(),b=Math.random()*(1-Q),H=1-Q-b,w=this._indices[N],W=this._indices[N+1],q=this._indices[N+2],k=C.TmpVectors.bh[0],M=C.TmpVectors.bh[1],p=C.TmpVectors.bh[2],P=C.TmpVectors.bh[3];C.bh.FromArrayToRef(this._positions,3*w,k),C.bh.FromArrayToRef(this._positions,3*W,M),C.bh.FromArrayToRef(this._positions,3*q,p),P.x=Q*k.x+b*M.x+H*p.x,P.y=Q*k.y+b*M.y+H*p.y,P.z=Q*k.z+b*M.z+H*p.z,E?c.Vc(P.x,P.y,P.z):C.bh.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,Y,c),this.useMeshNormalsForDirection&&this._normals&&(C.bh.FromArrayToRef(this._normals,3*w,k),C.bh.FromArrayToRef(this._normals,3*W,M),C.bh.FromArrayToRef(this._normals,3*q,p),this._storedNormal.x=Q*k.x+b*M.x+H*p.x,this._storedNormal.y=Q*k.y+b*M.y+H*p.y,this._storedNormal.z=Q*k.z+b*M.z+H*p.z)}clone(){const Y=new X(this.mesh);return W.b.DeepCopy(this,Y),Y}applyToShader(Y){Y.setVector3("direction1",this.direction1),Y.setVector3("direction2",this.direction2)}buildUniformLayout(Y){Y.addUniform("direction1",3),Y.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Y;const c={};return c.type=this.getClassName(),c.direction1=this.direction1.Xc(),c.direction2=this.direction2.Xc(),c.meshId=null===(Y=this.mesh)||void 0===Y?void 0:Y.id,c.useMeshNormalsForDirection=this.useMeshNormalsForDirection,c}parse(Y,c){C.bh.FromArrayToRef(Y.direction1,0,this.direction1),C.bh.FromArrayToRef(Y.direction2,0,this.direction2),Y.meshId&&c&&(this.mesh=c.getLastMeshById(Y.meshId)),this.useMeshNormalsForDirection=Y.useMeshNormalsForDirection}}class Z{_isUbo(Y){return void 0!==Y.addUniform}constructor(Y){this._isUbo(Y)?(this.setMatrix3x3=Y.updateMatrix3x3.bind(Y),this.setMatrix2x2=Y.updateMatrix2x2.bind(Y),this.setFloat=Y.updateFloat.bind(Y),this.setFloat2=Y.updateFloat2.bind(Y),this.setFloat3=Y.updateFloat3.bind(Y),this.setFloat4=Y.updateFloat4.bind(Y),this.setFloatArray=Y.updateFloatArray.bind(Y),this.setArray=Y.updateArray.bind(Y),this.setIntArray=Y.updateIntArray.bind(Y),this.setMatrix=Y.Gc.bind(Y),this.setMatrices=Y.updateMatrices.bind(Y),this.setVector3=Y.updateVector3.bind(Y),this.setVector4=Y.updateVector4.bind(Y),this.setColor3=Y.updateColor3.bind(Y),this.setColor4=Y.updateColor4.bind(Y),this.setDirectColor4=Y.updateDirectColor4.bind(Y),this.setInt=Y.updateInt.bind(Y),this.setInt2=Y.updateInt2.bind(Y),this.setInt3=Y.updateInt3.bind(Y),this.setInt4=Y.updateInt4.bind(Y)):(this.setMatrix3x3=Y.setMatrix3x3.bind(Y),this.setMatrix2x2=Y.setMatrix2x2.bind(Y),this.setFloat=Y.setFloat.bind(Y),this.setFloat2=Y.setFloat2.bind(Y),this.setFloat3=Y.setFloat3.bind(Y),this.setFloat4=Y.setFloat4.bind(Y),this.setFloatArray=Y.setFloatArray.bind(Y),this.setArray=Y.setArray.bind(Y),this.setIntArray=Y.setIntArray.bind(Y),this.setMatrix=Y.setMatrix.bind(Y),this.setMatrices=Y.setMatrices.bind(Y),this.setVector3=Y.setVector3.bind(Y),this.setVector4=Y.setVector4.bind(Y),this.setColor3=Y.setColor3.bind(Y),this.setColor4=Y.setColor4.bind(Y),this.setDirectColor4=Y.setDirectColor4.bind(Y),this.setInt=Y.setInt.bind(Y),this.setInt2=Y.setInt2.bind(Y),this.setInt3=Y.setInt3.bind(Y),this.setInt4=Y.setInt4.bind(Y))}}var a=h(12779);const G="gpuUpdateParticlesPixelShader",K="#version 300 es\nvoid main() {discard;}\n";a.b.ShadersStore[G]||(a.b.ShadersStore[G]=K);const I="gpuUpdateParticlesVertexShader",s="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";a.b.ShadersStore[I]||(a.b.ShadersStore[I]=s);(0,b.e)("BABYLON.WebGL2ParticleSystem",class{constructor(Y,c){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Y,this._engine=c,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Y;return(null===(Y=this._updateEffect)||void 0===Y?void 0:Y.isReady())??!1}createUpdateBuffer(Y){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof e&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Y,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Z(this._updateEffect)}createVertexBuffers(Y,c){this._updateVAO.push(this._createUpdateVAO(Y)),this._renderVAO.push(this._engine.recordVertexArrayObject(c,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=c}createParticleBuffer(Y){return Y}bindDrawBuffers(Y,c,h){h?this._engine.bindBuffers(this._renderVertexBuffers,h,c):this._engine.bindVertexArrayObject(this._renderVAO[Y],null)}preUpdateParticleBuffer(){const Y=this._engine;if(this._engine.enableEffect(this._updateEffect),!Y.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Y,c,h){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Y],null);const C=this._engine;C.bindTransformFeedbackBuffer(c.getBuffer()),C.setRasterizerState(!1),C.beginTransformFeedback(!0),C.drawArraysType(3,0,h),C.endTransformFeedback(),C.setRasterizerState(!0),C.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Y=0;Y<this._updateVAO.length;Y++)this._engine.releaseVertexArrayObject(this._updateVAO[Y]);this._updateVAO.length=0;for(let Y=0;Y<this._renderVAO.length;Y++)this._engine.releaseVertexArrayObject(this._renderVAO[Y]);this._renderVAO.length=0}_createUpdateVAO(Y){const c={};c.position=Y.createVertexBuffer("position",0,3);let h=3;c.age=Y.createVertexBuffer("age",h,1),h+=1,c.size=Y.createVertexBuffer("size",h,3),h+=3,c.life=Y.createVertexBuffer("life",h,1),h+=1,c.seed=Y.createVertexBuffer("seed",h,4),h+=4,c.direction=Y.createVertexBuffer("direction",h,3),h+=3,this._parent.particleEmitterType instanceof e&&(c.initialPosition=Y.createVertexBuffer("initialPosition",h,3),h+=3),this._parent._colorGradientsTexture||(c.color=Y.createVertexBuffer("color",h,4),h+=4),this._parent._isBillboardBased||(c.initialDirection=Y.createVertexBuffer("initialDirection",h,3),h+=3),this._parent.noiseTexture&&(c.noiseCoordinates1=Y.createVertexBuffer("noiseCoordinates1",h,3),h+=3,c.noiseCoordinates2=Y.createVertexBuffer("noiseCoordinates2",h,3),h+=3),this._parent._angularSpeedGradientsTexture?(c.angle=Y.createVertexBuffer("angle",h,1),h+=1):(c.angle=Y.createVertexBuffer("angle",h,2),h+=2),this._parent._isAnimationSheetEnabled&&(c.cellIndex=Y.createVertexBuffer("cellIndex",h,1),h+=1,this._parent.spriteRandomStartCell&&(c.cellStartOffset=Y.createVertexBuffer("cellStartOffset",h,1),h+=1));const C=this._engine.recordVertexArrayObject(c,null,this._updateEffect);return this._engine.bindArrayBuffer(null),C}});class x{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,C=arguments.length>3?arguments[3]:void 0;this._engine=Y,this._label=C,this._engine._storageBuffers.push(this),this._create(c,h)}_create(Y,c){this._bufferSize=Y,this._creationFlags=c,this._buffer=this._engine.createStorageBuffer(Y,c,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Y,c,h){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Y,c,h)}async read(Y,c,h,C){return await this._engine.readFromStorageBuffer(this._buffer,Y,c,h,C)}dispose(){const Y=this._engine._storageBuffers,c=Y.indexOf(this);-1!==c&&(Y[c]=Y[Y.length-1],Y.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var A=h(12853),V=h(12859),U=h(12906),l=h(12848),n=h(13170),v=h(12700),g=h(12812),z=h(13091);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new z.b}_addDuration(Y,c){Y<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Y?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(c,!1),this._gpuTimeInFrameId=Y):this.counter.addCount(c,!1))}}var o=h(12756);class f{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Y,this._engine=c,this.uniqueId=n.c.UniqueId,c.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?C.bindingsMapping?(this._context=c.createComputeContext(),this._shaderPath=h,this._options={bindingsMapping:{},defines:[],...C}):v.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):v.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Y,c){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=this._bindings[Y];this._bindings[Y]={type:h?0:4,object:c,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!C||C.object!==c||C.type!==this._bindings[Y].type)}setStorageTexture(Y,c){const h=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==c),this._bindings[Y]={type:1,object:c,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setExternalTexture(Y,c){const h=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==c),this._bindings[Y]={type:6,object:c,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setVideoTexture(Y,c){return!!c.externalTexture&&(this.setExternalTexture(Y,c.externalTexture),!0)}setUniformBuffer(Y,c){const h=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==c),this._bindings[Y]={type:f._BufferIsDataBuffer(c)?7:2,object:c,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setStorageBuffer(Y,c){const h=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!h||h.object!==c),this._bindings[Y]={type:f._BufferIsDataBuffer(c)?7:3,object:c,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}setTextureSampler(Y,c){const h=this._bindings[Y];this._contextIsDirty||(this._contextIsDirty=!h||!c.compareSampler(h.object)),this._bindings[Y]={type:5,object:c,indexInGroupEntries:null===h||void 0===h?void 0:h.indexInGroupEntries}}isReady(){let Y=this._effect;for(const E in this._bindings){const Y=this._bindings[E],c=Y.type,h=Y.object;switch(c){case 0:case 4:case 1:if(!h.isReady())return!1;break;case 6:if(!h.isReady())return!1;break}}const c=[],h=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)c.push(this._options.defines[E]);const C=c.join("\n");return this._cachedDefines!==C&&(this._cachedDefines=C,Y=this._engine.createComputeEffect(h,{defines:C,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Y),!!Y.isReady()}dispatch(Y,c,h){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Y,c,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const h=f._BufferIsDataBuffer(Y)?Y:Y.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,h,c,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const c in this._bindings){const h=this._bindings[c];if(!this._options.bindingsMapping[c])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+c+"'");switch(h.type){case 0:{const C=this._samplers[c],E=h.object;var Y;if(!C||!E._texture||!C.compareSampler(E._texture))this._samplers[c]=(new g.e).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(Y=E._texture)||void 0===Y?void 0:Y._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Y=h.object;Y.getBuffer()!==h.buffer&&(h.buffer=Y.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,o.f)((()=>this.dispatch(Y,c,h)),E,void 0,C)}))}serialize(){const Y=U.d.Serialize(this);Y.options=this._options,Y.shaderPath=this._shaderPath,Y.BM={},Y.textures={};for(const c in this._bindings){const h=this._bindings[c],C=h.object;switch(h.type){case 0:case 4:case 1:{const E=C.serialize();E&&(Y.textures[c]=E,Y.BM[c]={type:h.type});break}}}return Y}static Parse(Y,c,h){const C=U.d.Parse((()=>new f(Y.name,c.getEngine(),Y.shaderPath,Y.options)),Y,c,h);for(const E in Y.textures){const N=Y.BM[E],Q=l.d.Parse(Y.textures[E],c,h);0===N.type?C.setTexture(E,Q):4===N.type?C.setTexture(E,Q,!1):C.setStorageTexture(E,Q)}return C}static _BufferIsDataBuffer(Y){return void 0!==Y.underlyingResource}}(0,A.b)([(0,V.N)()],f.prototype,"name",void 0),(0,A.b)([(0,V.N)()],f.prototype,"fastMode",void 0),(0,b.e)("BABYLON.ComputeShader",f);var L=h(13126);const u="gpuUpdateParticlesComputeShader",i="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";a.b.ShadersStoreWGSL[u]||(a.b.ShadersStoreWGSL[u]=i);(0,b.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(Y,c){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Y,this._engine=c}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Y;return(null===(Y=this._updateComputeShader)||void 0===Y?void 0:Y.isReady())??!1}createUpdateBuffer(Y){var c;const h={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(h.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(h.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(h.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(h.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(h.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(h.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(h.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new f("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:h,defines:Y.split("\n")}),null===(c=this._simParamsComputeShader)||void 0===c||c.dispose(),this._simParamsComputeShader=new L.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Z(this._simParamsComputeShader)}createVertexBuffers(Y,c){this._renderVertexBuffers.push(c)}createParticleBuffer(Y){const c=new x(this._engine,4*Y.length,11,"ComputeShaderParticleSystemBuffer");return c.update(Y),this._bufferComputeShader.push(c),c.getBuffer()}bindDrawBuffers(Y,c,h){this._engine.bindBuffers(this._renderVertexBuffers[Y],h,c)}preUpdateParticleBuffer(){}updateParticleBuffer(Y,c,h){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Y]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Y]),this._updateComputeShader.dispatch(Math.ceil(h/64))}releaseBuffers(){var Y;for(let c=0;c<this._bufferComputeShader.length;++c)this._bufferComputeShader[c].dispose();this._bufferComputeShader.length=0,null===(Y=this._simParamsComputeShader)||void 0===Y||Y.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class R{constructor(Y,c,h){this.gradient=Y,this.color1=c,this.color2=h}getColorToRef(Y){this.color2?Q.vc.LerpToRef(this.color1,this.color2,Math.random(),Y):Y.N(this.color1)}}class B{constructor(Y,c){this.gradient=Y,this.color=c}}class t{constructor(Y,c,h){this.gradient=Y,this.factor1=c,this.factor2=h}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(Y,c,h){if(c[0].gradient>Y)return void h(c[0],c[0],1);for(let E=0;E<c.length-1;E++){const C=c[E],N=c[E+1];if(Y>=C.gradient&&Y<=N.gradient){return void h(C,N,(Y-C.gradient)/(N.gradient-C.gradient))}}const C=c.length-1;h(c[C],c[C],1)}}var J=h(12690),j=h(13346),S=h(12722);class mY{constructor(Y){this.particleSystem=Y,this.position=C.bh.Zero(),this.direction=C.bh.Zero(),this.color=new Q.vc(0,0,0,0),this.colorStep=new Q.vc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new C.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Q.vc(0,0,0,0),this._currentColor2=new Q.vc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=mY._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Y=this.age,c=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===c?(c=1,Y=this._randomCellOffset):Y+=this._randomCellOffset);const h=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let C;C=this._initialSpriteCellLoop?(0,w.Clamp)(Y*c%this.lifeTime/this.lifeTime):(0,w.Clamp)(Y*c/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+C*h|0}_inheritParticleInfoToSubEmitter(Y){if(Y.particleSystem.Cc.position){const c=Y.particleSystem.Cc;if(c.position.N(this.position),Y.inheritDirection){const Y=C.TmpVectors.bh[0];this.direction.normalizeToRef(Y),c.setDirection(Y,0,Math.PI/2)}}else{Y.particleSystem.Cc.N(this.position)}this.direction.scaleToRef(Y.inheritedVelocityAmount/2,C.TmpVectors.bh[0]),Y.particleSystem._inheritedVelocityOffset.N(C.TmpVectors.bh[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Y of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Y)}_reset(){this.age=0,this.id=mY._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Y){Y.position.N(this.position),this._initialDirection?Y._initialDirection?Y._initialDirection.N(this._initialDirection):Y._initialDirection=this._initialDirection.clone():Y._initialDirection=null,Y.direction.N(this.direction),this.Uw&&(Y.Uw?Y.Uw.N(this.Uw):Y.Uw=this.Uw.clone()),Y.color.N(this.color),Y.colorStep.N(this.colorStep),Y.lifeTime=this.lifeTime,Y.age=this.age,Y._randomCellOffset=this._randomCellOffset,Y.size=this.size,Y.scale.N(this.scale),Y.angle=this.angle,Y.angularSpeed=this.angularSpeed,Y.particleSystem=this.particleSystem,Y.cellIndex=this.cellIndex,Y.id=this.id,Y._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Y._currentColorGradient=this._currentColorGradient,Y._currentColor1.N(this._currentColor1),Y._currentColor2.N(this._currentColor2)),this._currentSizeGradient&&(Y._currentSizeGradient=this._currentSizeGradient,Y._currentSize1=this._currentSize1,Y._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Y._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Y._currentAngularSpeed1=this._currentAngularSpeed1,Y._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Y._currentVelocityGradient=this._currentVelocityGradient,Y._currentVelocity1=this._currentVelocity1,Y._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Y._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Y._currentLimitVelocity1=this._currentLimitVelocity1,Y._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Y._currentDragGradient=this._currentDragGradient,Y._currentDrag1=this._currentDrag1,Y._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Y._initialStartSpriteCellId=this._initialStartSpriteCellId,Y._initialEndSpriteCellId=this._initialEndSpriteCellId,Y._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Y.remapData&&this.remapData?Y.remapData.N(this.remapData):Y.remapData=new C.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(Y._randomNoiseCoordinates1?(Y._randomNoiseCoordinates1.N(this._randomNoiseCoordinates1),Y._randomNoiseCoordinates2.N(this._randomNoiseCoordinates2)):(Y._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Y._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}mY._Count=0;var YY=h(12999),cY=(h(13042),h(13245)),hY=h(13240),CY=h(13124);function EY(Y,c){const h=(0,w.RandomRange)(0,1);Q.vc.LerpToRef(c.color1,c.color2,h,Y.color),c.colorDead.subtractToRef(Y.color,c._colorDiff),c._colorDiff.scaleToRef(1/Y.lifeTime,Y.colorStep)}function NY(Y,c){Y._currentColorGradient=c._colorGradients[0],Y._currentColorGradient.getColorToRef(Y.color),Y._currentColor1.N(Y.color),c._colorGradients.length>1?c._colorGradients[1].getColorToRef(Y._currentColor2):Y._currentColor2.N(Y.color)}function QY(Y,c){const h=c._colorGradients;F.GetCurrentGradient(c._ratio,h,((c,h,C)=>{c!==Y._currentColorGradient&&(Y._currentColor1.N(Y._currentColor2),h.getColorToRef(Y._currentColor2),Y._currentColorGradient=c),Q.vc.LerpToRef(Y._currentColor1,Y._currentColor2,C,Y.color)}))}function bY(Y,c){Y.colorStep.scaleToRef(c._scaledUpdateSpeed,c._scaledColorStep),Y.color.addInPlace(c._scaledColorStep),Y.color.a<0&&(Y.color.a=0)}function HY(Y,c){F.GetCurrentGradient(c._ratio,c._angularSpeedGradients,((c,h,C)=>{c!==Y._currentAngularSpeedGradient&&(Y._currentAngularSpeed1=Y._currentAngularSpeed2,Y._currentAngularSpeed2=h.getFactor(),Y._currentAngularSpeedGradient=c),Y.angularSpeed=(0,w.Lerp)(Y._currentAngularSpeed1,Y._currentAngularSpeed2,C)}))}function wY(Y,c){Y.angle+=Y.angularSpeed*c._scaledUpdateSpeed}function WY(Y,c){c.particleEmitterType.startDirectionFunction(c._emitterWorldMatrix,Y.direction,Y,c.isLocal,c._emitterInverseWorldMatrix)}function qY(Y,c){c.startDirectionFunction(c._emitterWorldMatrix,Y.direction,Y,c.isLocal)}function kY(Y,c){Y._currentVelocityGradient=c._velocityGradients[0],Y._currentVelocity1=Y._currentVelocityGradient.getFactor(),c._velocityGradients.length>1?Y._currentVelocity2=c._velocityGradients[1].getFactor():Y._currentVelocity2=Y._currentVelocity1}function MY(Y,c){Y._currentLimitVelocityGradient=c._limitVelocityGradients[0],Y._currentLimitVelocity1=Y._currentLimitVelocityGradient.getFactor(),c._limitVelocityGradients.length>1?Y._currentLimitVelocity2=c._limitVelocityGradients[1].getFactor():Y._currentLimitVelocity2=Y._currentLimitVelocity1}function pY(Y,c){F.GetCurrentGradient(c._ratio,c._velocityGradients,((h,C,E)=>{h!==Y._currentVelocityGradient&&(Y._currentVelocity1=Y._currentVelocity2,Y._currentVelocity2=C.getFactor(),Y._currentVelocityGradient=h),c._directionScale*=(0,w.Lerp)(Y._currentVelocity1,Y._currentVelocity2,E)}))}function PY(Y,c){F.GetCurrentGradient(c._ratio,c._limitVelocityGradients,((h,C,E)=>{h!==Y._currentLimitVelocityGradient&&(Y._currentLimitVelocity1=Y._currentLimitVelocity2,Y._currentLimitVelocity2=C.getFactor(),Y._currentLimitVelocityGradient=h);const N=(0,w.Lerp)(Y._currentLimitVelocity1,Y._currentLimitVelocity2,E);Y.direction.length()>N&&Y.direction.scaleInPlace(c.limitVelocityDamping)}))}function yY(Y,c){Y.direction.scaleToRef(c._directionScale,c._scaledDirection)}function dY(Y,c){c.particleEmitterType.startPositionFunction(c._emitterWorldMatrix,Y.position,Y,c.isLocal)}function DY(Y,c){c.startPositionFunction(c._emitterWorldMatrix,Y.position,Y,c.isLocal)}function TY(Y,c){Y.Uw?Y.Uw.N(Y.position):Y.Uw=Y.position.clone(),C.bh.TransformCoordinatesToRef(Y.Uw,c._emitterWorldMatrix,Y.position)}function eY(Y,c){c.isLocal&&Y.Uw?(Y.Uw.addInPlace(c._scaledDirection),C.bh.TransformCoordinatesToRef(Y.Uw,c._emitterWorldMatrix,Y.position)):Y.position.addInPlace(c._scaledDirection)}function rY(Y,c){Y._currentDragGradient=c._dragGradients[0],Y._currentDrag1=Y._currentDragGradient.getFactor(),c._dragGradients.length>1?Y._currentDrag2=c._dragGradients[1].getFactor():Y._currentDrag2=Y._currentDrag1}function XY(Y,c){F.GetCurrentGradient(c._ratio,c._dragGradients,((h,C,E)=>{h!==Y._currentDragGradient&&(Y._currentDrag1=Y._currentDrag2,Y._currentDrag2=C.getFactor(),Y._currentDragGradient=h);const N=(0,w.Lerp)(Y._currentDrag1,Y._currentDrag2,E);c._scaledDirection.scaleInPlace(1-N)}))}function ZY(Y,c){Y._randomNoiseCoordinates1?(Y._randomNoiseCoordinates1.Vc(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2.Vc(Math.random(),Math.random(),Math.random())):(Y._randomNoiseCoordinates1=new C.bh(Math.random(),Math.random(),Math.random()),Y._randomNoiseCoordinates2=new C.bh(Math.random(),Math.random(),Math.random()))}function aY(Y,c){const h=c._noiseTextureData,E=c._noiseTextureSize;if(h&&E&&Y._randomNoiseCoordinates1){const N=c._fetchR(Y._randomNoiseCoordinates1.x,Y._randomNoiseCoordinates1.y,E.width,E.height,h),Q=c._fetchR(Y._randomNoiseCoordinates1.z,Y._randomNoiseCoordinates2.x,E.width,E.height,h),b=c._fetchR(Y._randomNoiseCoordinates2.y,Y._randomNoiseCoordinates2.z,E.width,E.height,h),H=C.TmpVectors.bh[0],w=C.TmpVectors.bh[1];H.Vc((2*N-1)*c.noiseStrength.x,(2*Q-1)*c.noiseStrength.y,(2*b-1)*c.noiseStrength.z),H.scaleToRef(c._tempScaledUpdateSpeed,w),Y.direction.addInPlace(w)}}function GY(Y,c){c.gravity.scaleToRef(c._tempScaledUpdateSpeed,c._scaledGravity),Y.direction.addInPlace(c._scaledGravity)}function KY(Y,c){Y.size=(0,w.RandomRange)(c.minSize,c.maxSize),Y.scale.Vc((0,w.RandomRange)(c.minScaleX,c.maxScaleX),(0,w.RandomRange)(c.minScaleY,c.maxScaleY))}function IY(Y,c){Y._currentSizeGradient=c._sizeGradients[0],Y._currentSize1=Y._currentSizeGradient.getFactor(),Y.size=Y._currentSize1,c._sizeGradients.length>1?Y._currentSize2=c._sizeGradients[1].getFactor():Y._currentSize2=Y._currentSize1,Y.scale.Vc((0,w.RandomRange)(c.minScaleX,c.maxScaleX),(0,w.RandomRange)(c.minScaleY,c.maxScaleY))}function sY(Y,c){const h=c._actualFrame/c.targetStopDuration;F.GetCurrentGradient(h,c._startSizeGradients,((h,C,E)=>{h!==c._currentStartSizeGradient&&(c._currentStartSize1=c._currentStartSize2,c._currentStartSize2=C.getFactor(),c._currentStartSizeGradient=h);const N=(0,w.Lerp)(c._currentStartSize1,c._currentStartSize2,E);Y.scale.scaleInPlace(N)}))}function xY(Y,c){F.GetCurrentGradient(c._ratio,c._sizeGradients,((c,h,C)=>{c!==Y._currentSizeGradient&&(Y._currentSize1=Y._currentSize2,Y._currentSize2=h.getFactor(),Y._currentSizeGradient=c),Y.size=(0,w.Lerp)(Y._currentSize1,Y._currentSize2,C)}))}function AY(Y,c){Y.remapData=new C.Vector4(0,1,0,1)}function VY(Y,c){c._colorRemapGradients&&c._colorRemapGradients.length>0&&F.GetCurrentGradient(c._ratio,c._colorRemapGradients,((c,h,C)=>{const E=(0,w.Lerp)(c.factor1,h.factor1,C),N=(0,w.Lerp)(c.factor2,h.factor2,C);Y.remapData.x=E,Y.remapData.y=N-E})),c._alphaRemapGradients&&c._alphaRemapGradients.length>0&&F.GetCurrentGradient(c._ratio,c._alphaRemapGradients,((c,h,C)=>{const E=(0,w.Lerp)(c.factor1,h.factor1,C),N=(0,w.Lerp)(c.factor2,h.factor2,C);Y.remapData.z=E,Y.remapData.w=N-E}))}function UY(Y,c){const h=(0,w.Clamp)(c._actualFrame/c.targetStopDuration);F.GetCurrentGradient(h,c._lifeTimeGradients,((c,C)=>{const E=c,N=C,Q=E.getFactor(),b=N.getFactor(),H=(h-E.gradient)/(N.gradient-E.gradient);Y.lifeTime=(0,w.Lerp)(Q,b,H)})),c._emitPower=(0,w.RandomRange)(c.minEmitPower,c.maxEmitPower)}function lY(Y,c){Y.lifeTime=(0,w.RandomRange)(c.minLifeTime,c.maxLifeTime),c._emitPower=(0,w.RandomRange)(c.minEmitPower,c.maxEmitPower)}function nY(Y,c){0===c._emitPower?(Y._initialDirection?Y._initialDirection.N(Y.direction):Y._initialDirection=Y.direction.clone(),Y.direction.set(0,0,0)):(Y._initialDirection=null,Y.direction.scaleInPlace(c._emitPower)),Y.direction.addInPlace(c._inheritedVelocityOffset)}function vY(Y,c){Y.angularSpeed=(0,w.RandomRange)(c.minAngularSpeed,c.maxAngularSpeed),Y.angle=(0,w.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function gY(Y,c){Y._currentAngularSpeedGradient=c._angularSpeedGradients[0],Y.angularSpeed=Y._currentAngularSpeedGradient.getFactor(),Y._currentAngularSpeed1=Y.angularSpeed,c._angularSpeedGradients.length>1?Y._currentAngularSpeed2=c._angularSpeedGradients[1].getFactor():Y._currentAngularSpeed2=Y._currentAngularSpeed1,Y.angle=(0,w.RandomRange)(c.minInitialRotation,c.maxInitialRotation)}function zY(Y,c){Y._initialStartSpriteCellId=c.startSpriteCellID,Y._initialEndSpriteCellId=c.endSpriteCellID,Y._initialSpriteCellLoop=c.spriteCellLoop}function OY(Y,c){Y.previousItem=c.previousItem,Y.nextItem=c,c.previousItem&&(c.previousItem.nextItem=Y),c.previousItem=Y}function oY(Y,c){Y.previousItem=c,Y.nextItem=c.nextItem,c.nextItem&&(c.nextItem.previousItem=Y),c.nextItem=Y}function fY(Y,c){let h=c;for(;h.nextItem;)h=h.nextItem;Y.previousItem=h,Y.nextItem=h.nextItem,h.nextItem=Y}function LY(Y){Y.previousItem&&(Y.previousItem.nextItem=Y.nextItem),Y.nextItem&&(Y.nextItem.previousItem=Y.previousItem)}class uY extends H{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Y){this._startDirectionFunction!==Y&&(this._startDirectionFunction=Y,this._directionProcessing.process=Y?qY:WY)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Y){this._startPositionFunction!==Y&&(this._startPositionFunction=Y,this._positionCreation.process=Y?DY:dY)}set onDispose(Y){this._onDisposeObserver&&this.Mc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Mc.add(Y)}get q(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Y){this._useRampGradients!==Y&&(this._useRampGradients=Y,this._resetEffect(),Y?(this._rampCreation={process:AY,previousItem:null,nextItem:null},oY(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:VY,previousItem:null,nextItem:null},oY(this._remapGradientProcessing,this._gravityProcessing)):(LY(this._rampCreation),LY(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Y){this._isLocal!==Y&&(this._isLocal=Y,Y?(this._isLocalCreation={process:TY,previousItem:null,nextItem:null},oY(this._isLocalCreation,this._positionCreation)):LY(this._isLocalCreation))}get particles(){return this.fM}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Y){this._animationSheetEnabled!==Y&&(this._animationSheetEnabled=Y,Y?(this._sheetCreation={process:zY,previousItem:null,nextItem:null},oY(this._sheetCreation,this._colorCreation)):LY(this._sheetCreation),this._reset())}getActiveCount(){return this.fM.length}getClassName(){return"Lc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Y;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Y=this._customWrappers[c])||void 0===Y?void 0:Y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Y]??this._customWrappers[0]}setCustomEffect(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new YY.e(this._engine),this._customWrappers[c].effect=Y,this._customWrappers[c].drawContext&&(this._customWrappers[c].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new J.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Y){if(this.noiseTexture!==Y){if(this._noiseTexture=Y,!Y)return LY(this._noiseCreation),void LY(this._noiseProcessing);this._noiseCreation={process:ZY,previousItem:null,nextItem:null},oY(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:aY,previousItem:null,nextItem:null},oY(this._noiseProcessing,this._positionProcessing)}}constructor(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Y),this._emitterInverseWorldMatrix=C.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new C.bh,this.Mc=new J.c,this.onStoppedObservable=new J.c,this.onStartedObservable=new J.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.fM=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Q.vc(0,0,0,0),this._colorDiff=new Q.vc(0,0,0,0),this._scaledDirection=C.bh.Zero(),this._scaledGravity=C.bh.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Y=>{},this.recycleParticle=Y=>{const c=this.fM.pop();c!==Y&&c.copyTo(Y),this._stockParticles.push(c)},this._createParticle=()=>{let Y;return 0!==this._stockParticles.length?(Y=this._stockParticles.pop(),Y._reset()):Y=new mY(this),this._prepareParticle(Y),Y},this.paused=!1,this._shadersLoaded=!1,this._capacity=c,this._epsilon=b,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||S.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.OM.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:lY,previousItem:null,nextItem:null},this._positionCreation={process:dY,previousItem:null,nextItem:null},oY(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:WY,previousItem:null,nextItem:null},oY(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:nY,previousItem:null,nextItem:null},oY(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:KY,previousItem:null,nextItem:null},oY(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:vY,previousItem:null,nextItem:null},oY(this._angleCreation,this._sizeCreation),this._colorCreation={process:EY,previousItem:null,nextItem:null},oY(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,H||(this._colorProcessing={process:bY,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:wY,previousItem:null,nextItem:null},oY(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:yY,previousItem:null,nextItem:null},oY(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:eY,previousItem:null,nextItem:null},oY(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:GY,previousItem:null,nextItem:null},oY(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=N,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new YY.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new q,this.updateFunction=Y=>{var c;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(c=this.noiseTexture.getContent())||void 0===c||c.then((Y=>{this._noiseTextureData=Y})));const h=Y===this.fM;for(let C=0;C<Y.length;C++){const c=Y[C];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=c.age;if(c.age+=this._tempScaledUpdateSpeed,c.age>c.lifeTime){const Y=c.age-E,h=c.lifeTime-E;this._tempScaledUpdateSpeed=h*this._tempScaledUpdateSpeed/Y,c.age=c.lifeTime}this._ratio=c.age/c.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let N=this._updateQueueStart;for(;N;)N.process(c,this),N=N.nextItem;if(this._isAnimationSheetEnabled&&!H&&c.updateCellIndex(),c._inheritParticleInfoToSubEmitters(),c.age>=c.lifeTime){if(this._emitFromParticle(c),c._attachedSubEmitters){for(const Y of c._attachedSubEmitters)Y.particleSystem.disposeOnStop=!0,Y.particleSystem.stop();c._attachedSubEmitters=null}this.recycleParticle(c),h&&C--}else;}}}serialize(Y){throw new Error("Method not implemented.")}clone(Y,c){throw new Error("Method not implemented.")}_addFactorGradient(Y,c,h,C){const E=new t(c,h,C);Y.push(E),Y.sort(((Y,c)=>Y.gradient<c.gradient?-1:Y.gradient>c.gradient?1:0))}_removeFactorGradient(Y,c){if(!Y)return;let h=0;for(const C of Y){if(C.gradient===c){Y.splice(h,1);break}h++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=UY:this._lifeTimeCreation.process=lY}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:sY,previousItem:null,nextItem:null},oY(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(LY(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Y){this.targetStopDuration!==Y&&(this._targetStopDuration=Y,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Y,c,h){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Y,c,h),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Y){return this._removeFactorGradient(this._lifeTimeGradients,Y),this._syncLifeTimeCreation(),this}addSizeGradient(Y,c,h){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=IY,this._sizeGradientProcessing={process:xY,previousItem:null,nextItem:null},OY(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Y,c,h),this}removeSizeGradient(Y){var c;return this._removeFactorGradient(this._sizeGradients,Y),0===(null===(c=this._sizeGradients)||void 0===c?void 0:c.length)&&(LY(this._sizeGradientProcessing),this._sizeCreation.process=KY),this}addColorRemapGradient(Y,c,h){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Y,c,h),this}removeColorRemapGradient(Y){return this._removeFactorGradient(this._colorRemapGradients,Y),this}addAlphaRemapGradient(Y,c,h){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Y,c,h),this}removeAlphaRemapGradient(Y){return this._removeFactorGradient(this._alphaRemapGradients,Y),this}addAngularSpeedGradient(Y,c,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=gY,this._angularSpeedGradientProcessing={process:HY,previousItem:null,nextItem:null},OY(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Y,c,h),this}removeAngularSpeedGradient(Y){var c;return this._removeFactorGradient(this._angularSpeedGradients,Y),0===(null===(c=this._angularSpeedGradients)||void 0===c?void 0:c.length)&&(this._angleCreation.process=vY,LY(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Y,c,h){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:kY,previousItem:null,nextItem:null},oY(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:pY,previousItem:null,nextItem:null},OY(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Y,c,h),this}removeVelocityGradient(Y){var c;return this._removeFactorGradient(this._velocityGradients,Y),0===(null===(c=this._velocityGradients)||void 0===c?void 0:c.length)&&(LY(this._velocityCreation),LY(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Y,c,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:MY,previousItem:null,nextItem:null},oY(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:PY,previousItem:null,nextItem:null},oY(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Y,c,h),this}removeLimitVelocityGradient(Y){var c;return this._removeFactorGradient(this._limitVelocityGradients,Y),0===(null===(c=this._limitVelocityGradients)||void 0===c?void 0:c.length)&&(LY(this._limitVelocityCreation),LY(this._limitVelocityGradientProcessing)),this}addDragGradient(Y,c,h){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:rY,previousItem:null,nextItem:null},OY(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:XY,previousItem:null,nextItem:null},OY(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Y,c,h),this}removeDragGradient(Y){var c;return this._removeFactorGradient(this._dragGradients,Y),0===(null===(c=this._dragGradients)||void 0===c?void 0:c.length)&&(LY(this._dragCreation),LY(this._dragGradientProcessing)),this}addEmitRateGradient(Y,c,h){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Y,c,h),this}removeEmitRateGradient(Y){return this._removeFactorGradient(this._emitRateGradients,Y),this}addStartSizeGradient(Y,c,h){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Y,c,h),this._syncStartSizeCreation(),this}removeStartSizeGradient(Y){return this._removeFactorGradient(this._startSizeGradients,Y),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Y=new Uint8Array(4*this._rawTextureWidth),c=Q.TmpColors.ph[0];for(let h=0;h<this._rawTextureWidth;h++){const C=h/this._rawTextureWidth;F.GetCurrentGradient(C,this._rampGradients,((C,E,N)=>{Q.ph.LerpToRef(C.color,E.color,N,c),Y[4*h]=255*c.r,Y[4*h+1]=255*c.g,Y[4*h+2]=255*c.b,Y[4*h+3]=255}))}this._rampGradientsTexture=j.b.CreateRGBATexture(Y,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Y,c)=>Y.gradient<c.gradient?-1:Y.gradient>c.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Y,c){this._rampGradients||(this._rampGradients=[]);const h=new B(Y,c);return this._rampGradients.push(h),this._syncRampGradientTexture(),this}removeRampGradient(Y){return this._removeGradientAndTexture(Y,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Y,c,h){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=NY,this._colorProcessing.process=QY);const C=new R(Y,c,h);return this._colorGradients.push(C),this._colorGradients.sort(((Y,c)=>Y.gradient<c.gradient?-1:Y.gradient>c.gradient?1:0)),this}removeColorGradient(Y){if(!this._colorGradients)return this;let c=0;for(const h of this._colorGradients){if(h.gradient===Y){this._colorGradients.splice(c,1);break}c++}return 0===this._colorGradients.length&&(this._colorCreation.process=EY,this._colorProcessing.process=bY),this}resetDrawCache(){if(this._drawWrappers){for(const Y of this._drawWrappers)if(Y)for(const c of Y)null===c||void 0===c||c.dispose();this._drawWrappers=[]}}_fetchR(Y,c,h,C,E){return E[4*(((Y=.5*Math.abs(Y)+.5)*h%h|0)+((c=.5*Math.abs(c)+.5)*C%C|0)*h)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Y=this._engine,c=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*c),this._vertexBuffer=new r.d(Y,this._vertexData,!0,c);let h=0;const C=this._vertexBuffer.createVertexBuffer(r.f.PositionKind,h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.f.PositionKind]=C,h+=3;const E=this._vertexBuffer.createVertexBuffer(r.f.ColorKind,h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[r.f.ColorKind]=E,h+=4;const N=this._vertexBuffer.createVertexBuffer("angle",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=N,h+=1;const Q=this._vertexBuffer.createVertexBuffer("size",h,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Q,h+=2,this._isAnimationSheetEnabled){const Y=this._vertexBuffer.createVertexBuffer("cellIndex",h,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Y,h+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Y=this._vertexBuffer.createVertexBuffer("direction",h,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Y,h+=3}if(this._useRampGradients){const Y=this._vertexBuffer.createVertexBuffer("remapData",h,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Y,h+=4}let b;if(this._useInstancing){const c=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new r.d(Y,c,!1,2),b=this._spriteBuffer.createVertexBuffer("offset",0,2)}else b=this._vertexBuffer.createVertexBuffer("offset",h,2,this._vertexBufferSize,this._useInstancing),h+=2;this._vertexBuffers.offset=b,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Y=[],c=[];let h=0;for(let C=0;C<this._capacity;C++)Y.push(h),Y.push(h+1),Y.push(h+2),Y.push(h),Y.push(h+2),Y.push(h+3),c.push(h,h+1,h+1,h+2,h+2,h+3,h+3,h,h,h+3),h+=4;this._indexBuffer=this._engine.createIndexBuffer(Y),this._linesIndexBuffer=this._engine.createIndexBuffer(c)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Y)setTimeout((()=>{this.start(0)}),Y);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var c;-1!==(null===(c=this.Cc)||void 0===c?void 0:c.getClassName().indexOf("Mesh"))&&this.Cc.Kc(!0);const Y=this.noiseTexture;if(Y&&Y.onGeneratedObservable)Y.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let c=0;c<this.preWarmCycles;c++)this.animate(!0),Y.render()}))}));else for(let c=0;c<this.preWarmCycles;c++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Y))}_postStop(Y){}reset(){this._stockParticles.length=0,this.fM.length=0}_appendParticleVertex(Y,c,h,E){let N=Y*this._vertexBufferSize;if(this._vertexData[N++]=c.position.x+this.Cq.x,this._vertexData[N++]=c.position.y+this.Cq.y,this._vertexData[N++]=c.position.z+this.Cq.z,this._vertexData[N++]=c.color.r,this._vertexData[N++]=c.color.g,this._vertexData[N++]=c.color.b,this._vertexData[N++]=c.color.a,this._vertexData[N++]=c.angle,this._vertexData[N++]=c.scale.x*c.size,this._vertexData[N++]=c.scale.y*c.size,this._isAnimationSheetEnabled&&(this._vertexData[N++]=c.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[N++]=c.direction.x,this._vertexData[N++]=c.direction.y,this._vertexData[N++]=c.direction.z);else if(c._initialDirection){let Y=c._initialDirection;this.isLocal&&(C.bh.TransformNormalToRef(Y,this._emitterWorldMatrix,C.TmpVectors.bh[0]),Y=C.TmpVectors.bh[0]),0===Y.x&&0===Y.z&&(Y.x=.001),this._vertexData[N++]=Y.x,this._vertexData[N++]=Y.y,this._vertexData[N++]=Y.z}else{let Y=c.direction;this.isLocal&&(C.bh.TransformNormalToRef(Y,this._emitterWorldMatrix,C.TmpVectors.bh[0]),Y=C.TmpVectors.bh[0]),0===Y.x&&0===Y.z&&(Y.x=.001),this._vertexData[N++]=Y.x,this._vertexData[N++]=Y.y,this._vertexData[N++]=Y.z}this._useRampGradients&&c.remapData&&(this._vertexData[N++]=c.remapData.x,this._vertexData[N++]=c.remapData.y,this._vertexData[N++]=c.remapData.z,this._vertexData[N++]=c.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===h?h=this._epsilon:1===h&&(h=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[N++]=h,this._vertexData[N++]=E)}_prepareParticle(Y){}_createNewOnes(Y){let c;for(let h=0;h<Y&&this.fM.length!==this._capacity;h++){c=this._createParticle(),this.fM.push(c);let Y=this._createQueueStart;for(;Y;)Y.process(c,this),Y=Y.nextItem;c._inheritParticleInfoToSubEmitters()}}_update(Y){if(this._alive=this.fM.length>0,this.Cc.position){const Y=this.Cc;this._emitterWorldMatrix=Y.getWorldMatrix()}else{const Y=this.Cc;this._emitterWorldMatrix=C.Matrix.Translation(Y.x,Y.y,Y.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.fM),this._createNewOnes(Y)}static _GetAttributeNamesOrOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=[r.f.PositionKind,r.f.ColorKind,"angle","offset","size"];return Y&&C.push("cellIndex"),c||C.push("direction"),h&&C.push("remapData"),C}static _GetEffectCreationOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,cY.b)(C),Y&&C.push("particlesInfos"),c&&C.push("logarithmicDepthConstant"),h&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(Y,c){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cY.g)(this,this._scene,Y),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Y.push("#define FOG")),this._isAnimationSheetEnabled&&Y.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Y.push("#define LOGARITHMICDEPTH"),c===H.BLENDMODE_MULTIPLY&&Y.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Y.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Y.push("#define BILLBOARD"),this.billboardMode){case 2:Y.push("#define BILLBOARDY");break;case 8:case 9:Y.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Y.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Y.push("#define BILLBOARDMODE_ALL")}h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Y.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Y,c,h){c.push(...uY._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Y.push(...uY._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,CY.d)(Y,this._imageProcessingConfigurationDefines),(0,CY.b)(h,this._imageProcessingConfigurationDefines))}_getWrapper(Y){const c=this._getCustomDrawWrapper(Y);if(null!==c&&void 0!==c&&c.effect)return c;const h=[];this.fillDefines(h,Y);const C=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[C];E||(E=this._drawWrappers[C]=[]);let N=E[Y];N||(N=new YY.e(this._engine),N.drawContext&&(N.drawContext.useInstancing=this._useInstancing),E[Y]=N);const Q=h.join("\n");if(N.defines!==Q){const Y=[],c=[],h=[];this.fillUniformsAttributesAndSamplerNames(c,Y,h),N.setEffect(this._engine.createEffect("particles",Y,c,h,Q,void 0,void 0,void 0,void 0,this._shaderLanguage),Q)}return N}animate(){var Y;let c,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!h&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(h?this.preWarmStepOffset:(null===(Y=this._scene)||void 0===Y?void 0:Y.getAnimationRatio())||1),this.manualEmitCount>-1)c=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Y=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const c=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(c,this._emitRateGradients,((c,h,C)=>{c!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=h.getFactor(),this._currentEmitRateGradient=c),Y=(0,w.Lerp)(this._currentEmitRate1,this._currentEmitRate2,C)}))}c=Y*this._scaledUpdateSpeed|0,this._newPartsExcess+=Y*this._scaledUpdateSpeed-c}if(this._newPartsExcess>1&&(c+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?c=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(c),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!h){let Y=0;for(let c=0;c<this.fM.length;c++){const h=this.fM[c];this._appendParticleVertices(Y,h),Y+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.fM.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Y,c){this._appendParticleVertex(Y++,c,0,0),this._useInstancing||(this._appendParticleVertex(Y++,c,1,0),this._appendParticleVertex(Y++,c,1,1),this._appendParticleVertex(Y++,c,0,1))}rebuild(){var Y;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Y=this._spriteBuffer)||void 0===Y||Y._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!uY.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(h.bind(h,14223)),Promise.resolve().then(h.bind(h,14167))])):await Promise.all([Promise.resolve().then(h.bind(h,14153)),Promise.resolve().then(h.bind(h,14140))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Cc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==H.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(H.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(H.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Y){const c=this._getWrapper(Y),h=c.effect,E=this._engine;E.enableEffect(c);const N=this.defaultViewMatrix??this._scene.getViewMatrix();if(h.setTexture("diffuseSampler",this.particleTexture),h.setMatrix("view",N),h.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Y=this.particleTexture.getBaseSize();h.setFloat3("particlesInfos",this.spriteCellWidth/Y.width,this.spriteCellHeight/Y.height,this.spriteCellWidth/Y.width)}if(h.setVector2("translationPivot",this.translationPivot),h.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Y=this._scene.activeCamera;h.setVector3("eyePosition",Y.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),h.setTexture("rampSampler",this._rampGradientsTexture));const Q=h.defines;var b,H,w,W,q,k;(this._scene&&((0,cY.c)(h,this,this._scene),this.applyFog&&(0,hY.f)(this._scene,void 0,h)),Q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(N.invertToRef(C.TmpVectors.Matrix[0]),h.setMatrix("invView",C.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,h):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,h)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBuffer:this._indexBuffer,h):E.bindBuffers(this._vertexBuffers,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:null,h);(this.useLogarithmicDepth&&this._scene&&(0,hY.n)(Q,h,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(h),this._setEngineBasedOnBlendMode(Y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(h),this._useInstancing)?null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?E.drawElementsType(6,0,10,this.fM.length):E.drawArraysType(7,0,4,this.fM.length):null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?E.drawElementsType(1,0,10*this.fM.length):E.drawElementsType(0,0,6*this.fM.length);return this.fM.length}render(){if(!this.isReady()||!this.fM.length)return 0;const Y=this._engine;Y.setState&&(Y.setState(!1),this.forceDepthWrite&&Y.setDepthWrite(!0));let c=0;return c=this.blendMode===H.BLENDMODE_MULTIPLYADD?this._render(H.BLENDMODE_MULTIPLY)+this._render(H.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),c}_onDispose(){}dispose(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(c,h),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Y=this._scene.OM.indexOf(this);Y>-1&&this._scene.OM.splice(Y,1),this._scene._activeParticleSystems.dispose()}this.Mc.notifyObservers(this),this.Mc.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}uY.ForceGLSL=!1;var iY,RY=h(12715);!function(Y){Y[Y.ATTACHED=0]="ATTACHED",Y[Y.END=1]="END"}(iY||(iY={}));class BY{constructor(Y){if(this.particleSystem=Y,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Y.Cc||!Y.Cc.dispose){const c=(0,b.d)("BABYLON.AbstractMesh");Y.Cc=new c("SubemitterSystemEmitter",Y.ZY()),Y._disposeEmitterOnDispose=!0}}clone(){let Y=this.particleSystem.Cc;if(Y){if(Y instanceof C.bh)Y=Y.clone();else if(-1!==Y.getClassName().indexOf("Mesh")){Y=new((0,b.d)("BABYLON.Mesh"))("",Y.ZY()),Y.isVisible=!1}}else Y=new C.bh;const c=new BY(this.particleSystem.clone(this.particleSystem.name,Y));return c.particleSystem.name+="Clone",c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem._disposeEmitterOnDispose=!0,c.particleSystem.disposeOnStop=!0,c}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return c.type=this.type,c.inheritDirection=this.inheritDirection,c.inheritedVelocityAmount=this.inheritedVelocityAmount,c.particleSystem=this.particleSystem.serialize(Y),c}static _ParseParticleSystem(Y,c,h){throw(0,RY.c)("ParseParticle")}static Parse(Y,c,h){const C=Y.particleSystem,E=new BY(BY._ParseParticleSystem(C,c,h,!0));return E.type=Y.type,E.inheritDirection=Y.inheritDirection,E.inheritedVelocityAmount=Y.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var tY=h(12761);function FY(Y,c){const h=new d;return h.direction1=Y,h.direction2=c,h}function JY(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jY(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function SY(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.bh(0,1,0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0);return new T(Y,c,h)}function mc(){return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Yc(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.bh(0,1,0);return new P(Y,c,h,E,N)}function cc(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new k(Y,c)}function hc(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0);return new M(Y,c,h,E)}const Cc=C.bh.Zero(),Ec=C.bh.Zero(),Nc=C.bh.Zero();class Qc{constructor(){this.strength=0,this.position=C.bh.Zero()}_processParticle(Y,c){this.position.subtractToRef(Y.position,Cc);const h=Cc.lengthSquared()+1;Cc.normalize().scaleToRef(this.strength/h,Ec),Ec.scaleToRef(c._tempScaledUpdateSpeed,Nc),Y.direction.addInPlace(Nc)}serialize(){return{position:this.position.Xc(),strength:this.strength}}}class bc extends uY{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Y=>{if(!this._subEmitters||0===this._subEmitters.length)return;const c=Math.floor(Math.random()*this._subEmitters.length);for(const h of this._subEmitters[c])if(1===h.type){const c=h.clone();Y._inheritParticleInfoToSubEmitter(c),c.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(c.particleSystem),c.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Y,c){const h=FY(Y,c);return this.particleEmitterType=h,h}get flowMap(){return this._flowMap}set flowMap(Y){this._flowMap!==Y&&(this._flowMap=Y,this._flowMapUpdate&&(LY(this._flowMapUpdate),this._flowMapUpdate=null),Y&&(this._flowMapUpdate={process:Y=>{var c;const h=null===(c=this.ZY())||void 0===c?void 0:c.getTransformMatrix();this._flowMap._processParticle(Y,this.flowMapStrength*this._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null},oY(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Y){this._attractors.push(Y),1===this._attractors.length&&(this._attractorUpdate={process:Y=>{for(const c of this._attractors)c._processParticle(Y,this)},previousItem:null,nextItem:null},oY(this._attractorUpdate,this._directionProcessing))}removeAttractor(Y){const c=this._attractors.indexOf(Y);-1!==c&&this._attractors.splice(c,1),0===this._attractors.length&&LY(this._attractorUpdate)}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Y)}createHemisphericEmitter(){const Y=JY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createSphereEmitter(){const Y=jY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createDirectedSphereEmitter(){const Y=SY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.bh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createCylinderEmitter(){const Y=mc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Y,Y}createDirectedCylinderEmitter(){const Y=Yc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createConeEmitter(){const Y=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Y,Y}createDirectedConeEmitter(){const Y=hc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createBoxEmitter(Y,c,h,C){const E=new q;return this.particleEmitterType=E,this.direction1=Y,this.direction2=c,this.minEmitBox=h,this.maxEmitBox=C,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Y of this.subEmitters)Y instanceof bc?this._subEmitters.push([new BY(Y)]):Y instanceof BY?this._subEmitters.push([Y]):Y instanceof Array&&this._subEmitters.push(Y)}_stopSubEmitters(){if(this.activeSubSystems){for(const Y of this.activeSubSystems)Y.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Y=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Y&&this._rootParticleSystem.activeSubSystems.splice(Y,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Y){Y&&this._stopSubEmitters()}_prepareParticle(Y){if(this._subEmitters&&this._subEmitters.length>0){const c=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Y._attachedSubEmitters=[];for(const h of c)if(0===h.type){const c=h.clone();Y._attachedSubEmitters.push(c),c.particleSystem.start()}}}_onDispose(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Y&&this.particles)for(const h of this.particles)if(h._attachedSubEmitters)for(let Y=h._attachedSubEmitters.length-1;Y>=0;Y-=1)h._attachedSubEmitters[Y].dispose();if(c&&this.activeSubSystems)for(let h=this.activeSubSystems.length-1;h>=0;h-=1)this.activeSubSystems[h].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Y=0;Y<this._subEmitters.length;Y++)for(const c of this._subEmitters[Y])c.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Cc&&this.Cc.dispose&&this.Cc.dispose(!0)}static _Parse(Y,c,h,E){let N;N=h instanceof tY.c?null:h;const H=(0,b.d)("BABYLON.Texture");if(H&&N&&(Y.texture?c.particleTexture=H.Parse(Y.texture,N,E):Y.textureName&&(c.particleTexture=new H(E+Y.textureName,N,!1,void 0===Y.invertY||Y.invertY),c.particleTexture.name=Y.textureName)),Y.emitterId||0===Y.emitterId||void 0!==Y.Cc?Y.emitterId&&N?c.Cc=N.getLastMeshById(Y.emitterId):c.Cc=C.bh.dh(Y.Cc):c.Cc=C.bh.Zero(),c.isLocal=!!Y.isLocal,void 0!==Y.renderingGroupId&&(c.renderingGroupId=Y.renderingGroupId),void 0!==Y.isBillboardBased&&(c.isBillboardBased=Y.isBillboardBased),void 0!==Y.billboardMode&&(c.billboardMode=Y.billboardMode),void 0!==Y.useLogarithmicDepth&&(c.useLogarithmicDepth=Y.useLogarithmicDepth),Y.animations){for(let h=0;h<Y.animations.length;h++){const C=Y.animations[h],E=(0,b.d)("BABYLON.Animation");E&&c.animations.push(E.Parse(C))}c.beginAnimationOnStart=Y.beginAnimationOnStart,c.beginAnimationFrom=Y.beginAnimationFrom,c.beginAnimationTo=Y.beginAnimationTo,c.beginAnimationLoop=Y.beginAnimationLoop}if(Y.autoAnimate&&N&&N.beginAnimation(c,Y.autoAnimateFrom,Y.autoAnimateTo,Y.autoAnimateLoop,Y.autoAnimateSpeed||1),c.startDelay=0|Y.startDelay,c.minAngularSpeed=Y.minAngularSpeed,c.maxAngularSpeed=Y.maxAngularSpeed,c.minSize=Y.minSize,c.maxSize=Y.maxSize,Y.minScaleX&&(c.minScaleX=Y.minScaleX,c.maxScaleX=Y.maxScaleX,c.minScaleY=Y.minScaleY,c.maxScaleY=Y.maxScaleY),void 0!==Y.preWarmCycles&&(c.preWarmCycles=Y.preWarmCycles,c.preWarmStepOffset=Y.preWarmStepOffset),void 0!==Y.minInitialRotation&&(c.minInitialRotation=Y.minInitialRotation,c.maxInitialRotation=Y.maxInitialRotation),c.minLifeTime=Y.minLifeTime,c.maxLifeTime=Y.maxLifeTime,c.minEmitPower=Y.minEmitPower,c.maxEmitPower=Y.maxEmitPower,c.emitRate=Y.emitRate,c.gravity=C.bh.dh(Y.gravity),Y.noiseStrength&&(c.noiseStrength=C.bh.dh(Y.noiseStrength)),c.color1=Q.vc.dh(Y.color1),c.color2=Q.vc.dh(Y.color2),c.colorDead=Q.vc.dh(Y.colorDead),c.updateSpeed=Y.updateSpeed,c.targetStopDuration=Y.targetStopDuration,c.blendMode=Y.blendMode,Y.colorGradients)for(const C of Y.colorGradients)c.addColorGradient(C.gradient,Q.vc.dh(C.color1),C.color2?Q.vc.dh(C.color2):void 0);if(Y.rampGradients){for(const h of Y.rampGradients)c.addRampGradient(h.gradient,Q.ph.dh(h.color));c.useRampGradients=Y.useRampGradients}if(Y.colorRemapGradients)for(const C of Y.colorRemapGradients)c.addColorRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.alphaRemapGradients)for(const C of Y.alphaRemapGradients)c.addAlphaRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.sizeGradients)for(const C of Y.sizeGradients)c.addSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.angularSpeedGradients)for(const C of Y.angularSpeedGradients)c.addAngularSpeedGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.velocityGradients)for(const C of Y.velocityGradients)c.addVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.dragGradients)for(const C of Y.dragGradients)c.addDragGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.emitRateGradients)for(const C of Y.emitRateGradients)c.addEmitRateGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.startSizeGradients)for(const C of Y.startSizeGradients)c.addStartSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.lifeTimeGradients)for(const C of Y.lifeTimeGradients)c.addLifeTimeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(Y.limitVelocityGradients){for(const h of Y.limitVelocityGradients)c.addLimitVelocityGradient(h.gradient,void 0!==h.factor1?h.factor1:h.factor,h.factor2);c.limitVelocityDamping=Y.limitVelocityDamping}if(Y.noiseTexture&&N){const h=(0,b.d)("BABYLON.ProceduralTexture");c.noiseTexture=h.Parse(Y.noiseTexture,N,E)}let w;if(Y.particleEmitterType){switch(Y.particleEmitterType.type){case"SphereParticleEmitter":w=new D;break;case"SphereDirectedParticleEmitter":w=new T;break;case"ConeEmitter":case"ConeParticleEmitter":w=new k;break;case"ConeDirectedParticleEmitter":w=new M;break;case"CylinderParticleEmitter":w=new p;break;case"CylinderDirectedParticleEmitter":w=new P;break;case"HemisphericParticleEmitter":w=new y;break;case"PointParticleEmitter":w=new d;break;case"MeshParticleEmitter":w=new X;break;case"CustomParticleEmitter":w=new e;break;default:w=new q}w.parse(Y.particleEmitterType,N)}else w=new q,w.parse(Y,N);c.particleEmitterType=w,c.startSpriteCellID=Y.startSpriteCellID,c.endSpriteCellID=Y.endSpriteCellID,c.spriteCellLoop=Y.spriteCellLoop??!0,c.spriteCellWidth=Y.spriteCellWidth,c.spriteCellHeight=Y.spriteCellHeight,c.spriteCellChangeSpeed=Y.spriteCellChangeSpeed,c.spriteRandomStartCell=Y.spriteRandomStartCell,c.disposeOnStop=Y.disposeOnStop??!1,c.manualEmitCount=Y.manualEmitCount??-1}static Parse(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const b=Y.name;let H,w,W=null,q=null;if(c instanceof tY.c?H=c:(w=c,H=w.getEngine()),Y.customShader&&H.createEffectForParticles){q=Y.customShader;const c=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";W=H.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,c)}const k=new bc(b,N||Y.ZC,c,W,Y.isAnimationSheetEnabled);if(k.customShader=q,k._rootUrl=h,Y.id&&(k.id=Y.id),Y.subEmitters){k.subEmitters=[];for(const C of Y.subEmitters){const Y=[];for(const E of C)Y.push(BY.Parse(E,c,h));k.subEmitters.push(Y)}}if(Y.attractors)for(const Q of Y.attractors){const Y=new Qc;Y.position=C.bh.dh(Q.position),Y.strength=Q.strength,k.addAttractor(Y)}return bc._Parse(Y,k,c,h),Y.textureMask&&(k.textureMask=Q.vc.dh(Y.textureMask)),Y.Cq&&(k.Cq=C.bh.dh(Y.Cq)),Y.preventAutoStart&&(k.preventAutoStart=Y.preventAutoStart),E||k.preventAutoStart||k.start(),k}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};if(bc._Serialize(c,this,Y),c.textureMask=this.textureMask.Xc(),c.customShader=this.customShader,c.preventAutoStart=this.preventAutoStart,c.Cq=this.Cq.Xc(),this.subEmitters){c.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const h of this._subEmitters){const C=[];for(const c of h)C.push(c.serialize(Y));c.subEmitters.push(C)}}if(this._attractors&&this._attractors.length){c.attractors=[];for(const Y of this._attractors)c.attractors.push(Y.serialize())}return c}static _Serialize(Y,c,h){if(Y.name=c.name,Y.id=c.id,Y.ZC=c.getCapacity(),Y.disposeOnStop=c.disposeOnStop,Y.manualEmitCount=c.manualEmitCount,c.Cc.position){const h=c.Cc;Y.emitterId=h.id}else{const h=c.Cc;Y.Cc=h.Xc()}c.particleEmitterType&&(Y.particleEmitterType=c.particleEmitterType.serialize()),c.particleTexture&&(h?Y.texture=c.particleTexture.serialize():(Y.textureName=c.particleTexture.name,Y.invertY=!!c.particleTexture._invertY)),Y.isLocal=c.isLocal,U.d.AppendSerializedAnimations(c,Y),Y.beginAnimationOnStart=c.beginAnimationOnStart,Y.beginAnimationFrom=c.beginAnimationFrom,Y.beginAnimationTo=c.beginAnimationTo,Y.beginAnimationLoop=c.beginAnimationLoop,Y.startDelay=c.startDelay,Y.renderingGroupId=c.renderingGroupId,Y.isBillboardBased=c.isBillboardBased,Y.billboardMode=c.billboardMode,Y.minAngularSpeed=c.minAngularSpeed,Y.maxAngularSpeed=c.maxAngularSpeed,Y.minSize=c.minSize,Y.maxSize=c.maxSize,Y.minScaleX=c.minScaleX,Y.maxScaleX=c.maxScaleX,Y.minScaleY=c.minScaleY,Y.maxScaleY=c.maxScaleY,Y.minEmitPower=c.minEmitPower,Y.maxEmitPower=c.maxEmitPower,Y.minLifeTime=c.minLifeTime,Y.maxLifeTime=c.maxLifeTime,Y.emitRate=c.emitRate,Y.gravity=c.gravity.Xc(),Y.noiseStrength=c.noiseStrength.Xc(),Y.color1=c.color1.Xc(),Y.color2=c.color2.Xc(),Y.colorDead=c.colorDead.Xc(),Y.updateSpeed=c.updateSpeed,Y.targetStopDuration=c.targetStopDuration,Y.blendMode=c.blendMode,Y.preWarmCycles=c.preWarmCycles,Y.preWarmStepOffset=c.preWarmStepOffset,Y.minInitialRotation=c.minInitialRotation,Y.maxInitialRotation=c.maxInitialRotation,Y.startSpriteCellID=c.startSpriteCellID,Y.spriteCellLoop=c.spriteCellLoop,Y.endSpriteCellID=c.endSpriteCellID,Y.spriteCellChangeSpeed=c.spriteCellChangeSpeed,Y.spriteCellWidth=c.spriteCellWidth,Y.spriteCellHeight=c.spriteCellHeight,Y.spriteRandomStartCell=c.spriteRandomStartCell,Y.isAnimationSheetEnabled=c.isAnimationSheetEnabled,Y.useLogarithmicDepth=c.useLogarithmicDepth;const C=c.getColorGradients();if(C){Y.colorGradients=[];for(const c of C){const h={gradient:c.gradient,color1:c.color1.Xc()};c.color2?h.color2=c.color2.Xc():h.color2=c.color1.Xc(),Y.colorGradients.push(h)}}const E=c.getRampGradients();if(E){Y.rampGradients=[];for(const c of E){const h={gradient:c.gradient,color:c.color.Xc()};Y.rampGradients.push(h)}Y.useRampGradients=c.useRampGradients}const N=c.getColorRemapGradients();if(N){Y.colorRemapGradients=[];for(const c of N){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.colorRemapGradients.push(h)}}const Q=c.getAlphaRemapGradients();if(Q){Y.alphaRemapGradients=[];for(const c of Q){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.alphaRemapGradients.push(h)}}const b=c.getSizeGradients();if(b){Y.sizeGradients=[];for(const c of b){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.sizeGradients.push(h)}}const H=c.getAngularSpeedGradients();if(H){Y.angularSpeedGradients=[];for(const c of H){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.angularSpeedGradients.push(h)}}const w=c.getVelocityGradients();if(w){Y.velocityGradients=[];for(const c of w){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.velocityGradients.push(h)}}const W=c.getDragGradients();if(W){Y.dragGradients=[];for(const c of W){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.dragGradients.push(h)}}const q=c.getEmitRateGradients();if(q){Y.emitRateGradients=[];for(const c of q){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.emitRateGradients.push(h)}}const k=c.getStartSizeGradients();if(k){Y.startSizeGradients=[];for(const c of k){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.startSizeGradients.push(h)}}const M=c.getLifeTimeGradients();if(M){Y.lifeTimeGradients=[];for(const c of M){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.lifeTimeGradients.push(h)}}const p=c.getLimitVelocityGradients();if(p){Y.limitVelocityGradients=[];for(const c of p){const h={gradient:c.gradient,factor1:c.factor1};void 0!==c.factor2?h.factor2=c.factor2:h.factor2=c.factor1,Y.limitVelocityGradients.push(h)}Y.limitVelocityDamping=c.limitVelocityDamping}c.noiseTexture&&(Y.noiseTexture=c.noiseTexture.serialize())}clone(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let E=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){E=this.customShader;const Y=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",c=N.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,Y);C[0]?C[0].effect=c:this.setCustomEffect(c,0)}const Q=this.serialize(h),b=bc.Parse(Q,this._scene||this._engine,this._rootUrl);return b.name=Y,b.customShader=E,b._customWrappers=C,void 0===c&&(c=this.Cc),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.Cc=c,this.preventAutoStart||b.start(),b}}bc.BILLBOARDMODE_Y=2,bc.BILLBOARDMODE_ALL=7,bc.BILLBOARDMODE_STRETCHED=8,bc.BILLBOARDMODE_STRETCHED_LOCAL=9,BY._ParseParticleSystem=bc.Parse;var Hc=h(13113),wc=h(13110),Wc=h(13006);Wc.c.prototype.createTransformFeedback=function(){const Y=this._gl.createTransformFeedback();if(!Y)throw new Error("Unable to create Transform Feedback");return Y},Wc.c.prototype.deleteTransformFeedback=function(Y){this._gl.deleteTransformFeedback(Y)},Wc.c.prototype.bindTransformFeedback=function(Y){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Y)},Wc.c.prototype.beginTransformFeedback=function(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Y?this._gl.POINTS:this._gl.TRIANGLES)},Wc.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Wc.c.prototype.setTranformFeedbackVaryings=function(Y,c){this._gl.transformFeedbackVaryings(Y,c,this._gl.INTERLEAVED_ATTRIBS)},Wc.c.prototype.bindTransformFeedbackBuffer=function(Y){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Y?Y.underlyingResource:null)},Wc.c.prototype.readTransformFeedbackBuffer=function(Y){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Y)};const qc="clipPlaneFragmentDeclaration2",kc="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";a.b.IncludesShadersStore[qc]||(a.b.IncludesShadersStore[qc]=kc);h(14046),h(14051),h(14059),h(14061),h(14069),h(14075),h(14077),h(14082);const Mc="gpuRenderParticlesPixelShader",pc="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";a.b.ShadersStore[Mc]||(a.b.ShadersStore[Mc]=pc);const Pc="clipPlaneVertexDeclaration2",yc="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";a.b.IncludesShadersStore[Pc]||(a.b.IncludesShadersStore[Pc]=yc);h(14086),h(14089),h(14095),h(14103);const dc="gpuRenderParticlesVertexShader",Dc="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";a.b.ShadersStore[dc]||(a.b.ShadersStore[dc]=Dc);class Tc extends H{static get IsSupported(){if(!S.d.LastCreatedEngine)return!1;const Y=S.d.LastCreatedEngine.getCaps();return Y.supportTransformFeedbacks||Y.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Y){this._maxActiveParticleCount=Math.min(Y,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Y){this.maxActiveParticleCount=Y}createPointEmitter(Y,c){const h=FY(Y,c);return this.particleEmitterType=h,h}createHemisphericEmitter(){const Y=JY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createSphereEmitter(){const Y=jY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Y,Y}createDirectedSphereEmitter(){const Y=SY(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.bh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createCylinderEmitter(){const Y=mc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Y,Y}createDirectedCylinderEmitter(){const Y=Yc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createConeEmitter(){const Y=cc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Y,Y}createDirectedConeEmitter(){const Y=hc(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.bh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.bh(0,1,0));return this.particleEmitterType=Y,Y}createBoxEmitter(Y,c,h,C){const E=new q;return this.particleEmitterType=E,this.direction1=Y,this.direction2=c,this.minEmitBox=h,this.maxEmitBox=C,E}get flowMap(){return this._flowMap}set flowMap(Y){this._flowMap!==Y&&(this._flowMap=Y)}isReady(){if(!this.Cc||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==bc.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(bc.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(bc.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Y?setTimeout((()=>{this.start(0)}),Y):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Y;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Y=this._customWrappers[c])||void 0===Y?void 0:Y.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Y]??this._customWrappers[0]}setCustomEffect(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[c]=new YY.e(this._engine),this._customWrappers[c].effect=Y}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new J.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Y,c,h){return super._removeGradientAndTexture(Y,c,h),this._releaseBuffers(),this}addColorGradient(Y,c){this._colorGradients||(this._colorGradients=[]);const h=new R(Y,c);return this._colorGradients.push(h),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Y&&this._colorGradients.sort(((Y,c)=>Y.gradient<c.gradient?-1:Y.gradient>c.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Y){return this._removeGradientAndTexture(Y,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const c in this._drawWrappers){var Y;null===(Y=this._drawWrappers[c].drawContext)||void 0===Y||Y.reset()}}_addFactorGradient(Y,c,h){const C=new t(c,h);Y.push(C),this._releaseBuffers()}addSizeGradient(Y,c){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Y,c),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Y){return this._removeGradientAndTexture(Y,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Y,c){if(!Y)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Y.sort(((Y,c)=>Y.gradient<c.gradient?-1:Y.gradient>c.gradient?1:0));const h=this;h[c]&&(h[c].dispose(),h[c]=null)}addAngularSpeedGradient(Y,c){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Y,c),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Y){return this._removeGradientAndTexture(Y,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Y,c){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Y,c),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Y){return this._removeGradientAndTexture(Y,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Y,c){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Y,c),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Y){return this._removeGradientAndTexture(Y,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Y,c){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Y,c),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Y){return this._removeGradientAndTexture(Y,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Y){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Y),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Mc=new J.c,this.onStoppedObservable=new J.c,this.onStartedObservable=new J.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,h&&"Scene"!==h.getClassName()?(this._engine=h,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=h||S.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.OM.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,b.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,b.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,b.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new YY.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new YY.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(c=c??{}).randomTextureSize||delete c.randomTextureSize;const Q={ZC:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...c},H=c;isFinite(H)&&(Q.ZC=H),this._capacity=Q.ZC,this._maxActiveParticleCount=Q.ZC,this._currentActiveCount=0,this._isAnimationSheetEnabled=N,this.particleEmitterType=new q;const w=Math.min(this._engine.getCaps().maxTextureSize,Q.randomTextureSize);let W=[];for(let C=0;C<w;++C)W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random());this._randomTexture=new j.b(new Float32Array(W),w,1,5,h,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,W=[];for(let C=0;C<w;++C)W.push(Math.random()),W.push(Math.random()),W.push(Math.random()),W.push(Math.random());this._randomTexture2=new j.b(new Float32Array(W),w,1,5,h,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=w}_reset(){this._releaseBuffers()}_createVertexBuffers(Y,c,h){const C={};C.position=c.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;C.age=c.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,C.size=c.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,C.life=c.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===bc.BILLBOARDMODE_STRETCHED&&(C.direction=c.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof e&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(C.color=c.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(C.initialDirection=c.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(C.noiseCoordinates1=c.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),C.noiseCoordinates2=c.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),C.angle=c.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(C.cellIndex=c.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(C.cellStartOffset=c.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),C.offset=h.createVertexBuffer("offset",0,2),C.uv=h.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(C),this._platform.createVertexBuffers(Y,C),this.resetDrawCache()}_initialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Y)return;const c=this._engine,h=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof e&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof e,N=C.TmpVectors.bh[0];let Q=0;for(let C=0;C<this._capacity;C++)if(h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(C,null,N),h.push(N.x),h.push(N.y),h.push(N.z)):(h.push(0),h.push(0),h.push(0)),this._platform.alignDataInBuffer&&h.push(0),Q+=16,E&&(this.particleEmitterType.particlePositionGenerator(C,null,N),h.push(N.x),h.push(N.y),h.push(N.z),this._platform.alignDataInBuffer&&h.push(0),Q+=4),this._colorGradientsTexture||(h.push(0),h.push(0),h.push(0),h.push(0),Q+=4),this.isBillboardBased||(h.push(0),h.push(0),h.push(0),this._platform.alignDataInBuffer&&h.push(0),Q+=4),this.noiseTexture&&(h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),this._platform.alignDataInBuffer&&h.push(0),Q+=8),h.push(0),Q+=1,this._angularSpeedGradientsTexture||(h.push(0),Q+=1),this._isAnimationSheetEnabled&&(h.push(0),Q+=1,this.spriteRandomStartCell&&(h.push(0),Q+=1)),this._platform.alignDataInBuffer){let Y=3-(Q+3&3);for(Q+=Y;Y-- >0;)h.push(0)}const b=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),H=this._platform.createParticleBuffer(h),w=this._platform.createParticleBuffer(h);this._buffer0=new r.d(c,H,!1,this._attributesStrideSize),this._buffer1=new r.d(c,w,!1,this._attributesStrideSize),this._spriteBuffer=new r.d(c,b,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Y=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Y+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Y+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Y+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Y+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Y+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Y+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Y+="\n#define DRAGGRADIENTS"),this._flowMap&&(Y+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Y+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Y+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Y+="\n#define NOISE"),this.isLocal&&(Y+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Y||(this._cachedUpdateDefines=Y,this._updateBuffer=this._platform.createUpdateBuffer(Y)),this._platform.isUpdateBufferReady()}_getWrapper(Y){const c=this._getCustomDrawWrapper(Y);if(null!==c&&void 0!==c&&c.effect)return c;const h=[];this.fillDefines(h,Y);let C=this._drawWrappers[Y];C||(C=new YY.e(this._engine),C.drawContext&&(C.drawContext.useInstancing=!0),this._drawWrappers[Y]=C);const E=h.join("\n");if(C.defines!==E){const Y=[],c=[],h=[];this.fillUniformsAttributesAndSamplerNames(c,Y,h),C.setEffect(this._engine.createEffect("gpuRenderParticles",Y,c,h,E),E)}return C}static _GetAttributeNamesOrOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[r.f.PositionKind,"age","life","size","angle"];return Y||E.push(r.f.ColorKind),c&&E.push("cellIndex"),h||E.push("initialDirection"),C&&E.push("direction"),E.push("offset",r.f.UVKind),E}static _GetEffectCreationOptions(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["emitterWM","Cq","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,cY.b)(C),Y&&C.push("sheetInfos"),c&&C.push("logarithmicDepthConstant"),h&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,cY.g)(this,this._scene,Y),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==wc.e.FOGMODE_NONE&&Y.push("#define FOG")),c===bc.BLENDMODE_MULTIPLY&&Y.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Y.push("#define LOCAL"),this.useLogarithmicDepth&&Y.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Y.push("#define BILLBOARD"),this.billboardMode){case bc.BILLBOARDMODE_Y:Y.push("#define BILLBOARDY");break;case bc.BILLBOARDMODE_STRETCHED:Y.push("#define BILLBOARDSTRETCHED");break;case bc.BILLBOARDMODE_ALL:Y.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Y.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Y.push("#define ANIMATESHEET"),h&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Y.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Y,c,h){c.push(...Tc._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===bc.BILLBOARDMODE_STRETCHED)),Y.push(...Tc._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),h.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Hc.c.PrepareUniforms(Y,this._imageProcessingConfigurationDefines),Hc.c.PrepareSamplers(h,this._imageProcessingConfigurationDefines))}animate(){var Y;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(c?this.preWarmStepOffset:(null===(Y=this._scene)||void 0===Y?void 0:Y.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Y,c){const h=this[c];if(!Y||!Y.length||h)return;const C=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const c=E/this._rawTextureWidth;F.GetCurrentGradient(c,Y,((Y,c,h)=>{C[E]=(0,w.Lerp)(Y.factor1,c.factor1,h)}))}this[c]=j.b.CreateRTexture(C,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[c].name=c.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Y=new Uint8Array(4*this._rawTextureWidth),c=Q.TmpColors.vc[0];for(let h=0;h<this._rawTextureWidth;h++){const C=h/this._rawTextureWidth;F.GetCurrentGradient(C,this._colorGradients,((C,E,N)=>{Q.vc.LerpToRef(C.color1,E.color1,N,c),Y[4*h]=255*c.r,Y[4*h+1]=255*c.g,Y[4*h+2]=255*c.b,Y[4*h+3]=255*c.a}))}this._colorGradientsTexture=j.b.CreateRGBATexture(Y,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Y,c){var h,E,N,Q;const b=this._getWrapper(Y),H=b.effect;this._engine.enableEffect(b);const w=(null===(h=this._scene)||void 0===h?void 0:h.getViewMatrix())||C.Matrix.IdentityReadOnly;if(H.setMatrix("view",w),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),H.setTexture("diffuseSampler",this.particleTexture),H.setVector2("translationPivot",this.translationPivot),H.setVector3("Cq",this.Cq),this.isLocal&&H.setMatrix("emitterWM",c),this._colorGradientsTexture?H.setTexture("colorGradientSampler",this._colorGradientsTexture):H.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Y=this.particleTexture.getBaseSize();H.setFloat3("sheetInfos",this.spriteCellWidth/Y.width,this.spriteCellHeight/Y.height,Y.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Y=this._scene.activeCamera;H.setVector3("eyePosition",Y.globalPosition)}const W=H.defines;if(this._scene&&((0,cY.c)(H,this,this._scene),this.applyFog&&(0,hY.f)(this._scene,void 0,H)),W.indexOf("#define BILLBOARDMODE_ALL")>=0){const Y=w.clone();Y.invert(),H.setMatrix("invView",Y)}return this.useLogarithmicDepth&&this._scene&&(0,hY.n)(W,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(Y),this._platform.bindDrawBuffers(this._targetIndex,H,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Y){if(!this.Cc||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Y)if(this.Cc.position){Y=this.Cc.getWorldMatrix()}else{const c=this.Cc;Y=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(c.x,c.y,c.z,Y)}const c=this._engine,h=c.getDepthWrite();if(c.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Y=this.ZY();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Y.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Y),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,c.setDepthWrite(h)}render(){let Y,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!c&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Y=0;Y<this.preWarmCycles;Y++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Y=0|this._accumulatedCount;this._accumulatedCount-=Y,this._currentActiveCount+=Y}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Cc.position){Y=this.Cc.getWorldMatrix()}else{const c=this.Cc;Y=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(c.x,c.y,c.z,Y)}const E=this._engine;this.updateInAnimate||this._update(Y);let N=0;return c||h||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),N=this.blendMode===bc.BLENDMODE_MULTIPLYADD?this._render(bc.BLENDMODE_MULTIPLY,Y)+this._render(bc.BLENDMODE_ADD,Y):this._render(this.blendMode,Y),this._engine.setAlphaMode(0)),N}rebuild(){const Y=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Y,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Y()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const c in this._drawWrappers){this._drawWrappers[c].dispose()}if(this._drawWrappers={},this._scene){const Y=this._scene.OM.indexOf(this);Y>-1&&this._scene.OM.splice(Y,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let c=0;c<this._renderVertexBuffers.length;++c){const Y=this._renderVertexBuffers[c];for(const c in Y)Y[c].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Y&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Y&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Mc.notifyObservers(this),this.Mc.clear()}clone(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let E=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){E=this.customShader;const Y=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";C[0]=N.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,Y,void 0,void 0,void 0,this)}const Q=this.serialize(h),b=Tc.Parse(Q,this._scene||this._engine,this._rootUrl);return b.name=Y,b.customShader=E,b._customWrappers=C,void 0===c&&(c=this.Cc),this.noiseTexture&&(b.noiseTexture=this.noiseTexture.clone()),b.Cc=c,b}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={};return bc._Serialize(c,this,Y),c.activeParticleCount=this.activeParticleCount,c.randomTextureSize=this._randomTextureSize,c.customShader=this.customShader,c}static Parse(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const N=Y.name;let Q,b;c instanceof tY.c?Q=c:(b=c,Q=b.getEngine());const H=new Tc(N,{ZC:E||Y.ZC,randomTextureSize:Y.randomTextureSize},c,null,Y.isAnimationSheetEnabled);if(H._rootUrl=h,Y.customShader&&Q.createEffectForParticles){const c=Y.customShader,h=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",C=Q.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,h,void 0,void 0,void 0,H);H.setCustomEffect(C,0),H.customShader=c}return Y.id&&(H.id=Y.id),Y.activeParticleCount&&(H.activeParticleCount=Y.activeParticleCount),bc._Parse(Y,H,c,h),Y.preventAutoStart&&(H.preventAutoStart=Y.preventAutoStart),C||H.preventAutoStart||H.start(),H}}var ec=h(12687),rc=h(14107),Xc=h(13254);class Zc{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Y){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const c of this.systems)c.Cc=Y;this._emitterNode=Y}setEmitterAsSphere(Y,c,h){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Y,renderingGroupId:c};const C=(0,rc.b)("emitterSphere",{diameter:Y.diameter,segments:Y.segments},h);C.renderingGroupId=c;const E=new Xc.kh("emitterSphereMaterial",h);E.emissiveColor=Y.color,C.material=E;for(const N of this.systems)N.Cc=C;this._emitterNode=C}start(Y){for(const c of this.systems)Y&&(c.Cc=Y),c.start()}dispose(){for(const Y of this.systems)Y.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c={systems:[]};for(const h of this.systems)c.systems.push(h.serialize(Y));return this._emitterNode&&(c.Cc=this._emitterCreationOptions),c}static Parse(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;const E=new Zc,N=this.BaseAssetsUrl+"/textures/";c=c||S.d.LastCreatedScene;for(const Q of Y.systems)E.systems.push(h?Tc.Parse(Q,c,N,!0,C):bc.Parse(Q,c,N,!0,C));if(Y.Cc){const h=Y.Cc.options;if("Sphere"===Y.Cc.kind)E.setEmitterAsSphere({diameter:h.diameter,segments:h.segments,color:Q.ph.dh(h.color)},Y.Cc.renderingGroupId,c)}return E}}Zc.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ac=h(12719);class Gc{static CreateDefault(Y){let c,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,C=arguments.length>2?arguments[2]:void 0;c=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Tc("default system",{ZC:h},C):new bc("default system",h,C),c.Cc=Y;const E=ec.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return c.particleTexture=new l.d(E,c.ZY()),c.createConeEmitter(.1,Math.PI/4),c.color1=new Q.vc(1,1,1,1),c.color2=new Q.vc(1,1,1,1),c.colorDead=new Q.vc(1,1,1,0),c.minSize=.1,c.maxSize=.1,c.minEmitPower=2,c.maxEmitPower=2,c.updateSpeed=1/60,c.emitRate=30,c}static CreateAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;c||(c=S.d.LastCreatedScene);const E={};return c.addPendingData(E),new Promise(((N,Q)=>{if(h&&!Tc.IsSupported)return c.removePendingData(E),Q("Particle system with GPU is not supported.");ec.Tools.LoadFile(`${Gc.BaseAssetsUrl}/systems/${Y}.json`,(Y=>{c.removePendingData(E);const Q=JSON.parse(Y.toString());return N(Zc.Parse(Q,c,h,C))}),void 0,void 0,void 0,(()=>(c.removePendingData(E),Q(`An error occurred with the creation of your particle system. Check if your type '${Y}' exists.`))))}))}static ExportSet(Y){const c=new Zc;for(const h of Y)c.systems.push(h);return c}static ParseFromFileAsync(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",N=arguments.length>5?arguments[5]:void 0;return new Promise(((Q,b)=>{const H=new ac.c;H.addEventListener("readystatechange",(()=>{if(4==H.readyState)if(200==H.status){const c=JSON.parse(H.responseText);let b;b=C?Tc.Parse(c,h,E,!1,N):bc.Parse(c,h,E,!1,N),Y&&(b.name=Y),Q(b)}else b("Unable to load the particle system")})),H.open("GET",c),H.send()}))}static ParseFromSnippetAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Y){const Y=this.CreateDefault(null);return Y.start(),Promise.resolve(Y)}return new Promise(((N,Q)=>{const b=new ac.c;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const Q=JSON.parse(JSON.parse(b.responseText).jsonPayload),H=JSON.parse(Q.particleSystem);let w;w=h?Tc.Parse(H,c,C,!1,E):bc.Parse(H,c,C,!1,E),w.snippetId=Y,N(w)}else Q("Unable to load the snippet "+Y)})),b.open("GET",this.SnippetUrl+"/"+Y.replace(/#/g,"/")),b.send()}))}}Gc.BaseAssetsUrl=Zc.BaseAssetsUrl,Gc.SnippetUrl="https://snippet.babylonjs.com",Gc.CreateFromSnippetAsync=Gc.ParseFromSnippetAsync;var Kc=h(13321),Ic=h(13142),sc=h(14109);(0,sc.i)(Ic.c.NAME_PARTICLESYSTEM,((Y,c,h,C)=>{const E=(0,sc.l)(Ic.c.NAME_PARTICLESYSTEM);if(E&&void 0!==Y.OM&&null!==Y.OM)for(let N=0,Q=Y.OM.length;N<Q;N++){const Q=Y.OM[N];h.OM.push(E(Q,c,C))}})),(0,sc.e)(Ic.c.NAME_PARTICLESYSTEM,((Y,c,h)=>{if(Y.activeParticleCount){return Tc.Parse(Y,c,h)}return bc.Parse(Y,c,h)})),tY.c.prototype.createEffectForParticles=function(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,H=arguments.length>7?arguments[7]:void 0,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,W=arguments.length>9?arguments[9]:void 0,q=[],k=[];const M=[];return H?H.fillUniformsAttributesAndSamplerNames(k,q,M):(q=bc._GetAttributeNamesOrOptions(),k=bc._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==H&&void 0!==H&&H.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===C.indexOf("diffuseSampler")&&C.push("diffuseSampler"),this.createEffect({vertex:W??(null===H||void 0===H?void 0:H.vertexShaderName)??"particles",fragmentElement:Y},q,k.concat(c),M.concat(C),E,N,Q,b,void 0,w,(async()=>{0===w?await Promise.resolve().then(h.bind(h,14153)):await Promise.resolve().then(h.bind(h,14223))}))},Kc.e.prototype.getEmittedParticleSystems=function(){const Y=[];for(let c=0;c<this.ZY().OM.length;c++){const h=this.ZY().OM[c];h.Cc===this&&Y.push(h)}return Y},Kc.e.prototype.getHierarchyEmittedParticleSystems=function(){const Y=[],c=this.getDescendants();c.push(this);for(let h=0;h<this.ZY().OM.length;h++){const C=this.ZY().OM[h],E=C.Cc;E.position&&-1!==c.indexOf(E)&&Y.push(C)}return Y};h(13212),h(13226),h(13303);h(13305),h(14115),h(13074),h(13199),h(13341);h(13071);var xc;h(14122),h(12890);!function(Y){Y[Y.Color=2]="Color",Y[Y.UV=1]="UV",Y[Y.Random=0]="Random",Y[Y.Stated=3]="Stated"}(xc||(xc={}));var Ac=h(13102);const Vc=new C.bh(0,0,0),Uc=new C.bh(0,0,0),lc=new C.bh(0,0,0);class nc{constructor(Y,c,h){this.width=Y,this.height=c,this.data=h}processFlowable(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;if(!h)return;h instanceof C.Matrix?C.bh.TransformCoordinatesToRef(Y.position,h,lc):(lc.x=h.x,lc.y=h.y,lc.z=h.z);const E=.5*lc.x+.5,N=1-(.5*lc.y+.5),Q=Math.floor(E*this.width),b=Math.floor(N*this.height);if(Q<0||Q>=this.width||b<0||b>=this.height)return;const H=4*(b*this.width+Q),w=this.data[H]/255*2-1,W=this.data[H+1]/255*2-1,q=this.data[H+2]/255*2-1,k=this.data[H+3]/255;Vc.set(w,W,q),Vc.scaleToRef(c*k,Uc),Y.direction.addInPlace(Uc)}_processParticle(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,h=arguments.length>2?arguments[2]:void 0;this.processFlowable(Y,c,h)}static async FromUrlAsync(Y){return await new Promise(((c,h)=>{const C=document.createElement("canvas"),E=C.getContext("2d");let N=null;const Q=new Image;Q.crossOrigin="anonymous",Q.src=Y,Q.onerror=c=>{h(new Error(`Failed to load image: ${Y} : ${c}`))},Q.onload=()=>{C.width=Q.width,C.height=Q.height,E.drawImage(Q,0,0),N=E.getImageData(0,0,C.width,C.height),c(new nc(C.width,C.height,N.data))}}))}static async ExtractFromTextureAsync(Y){return await new Promise(((c,h)=>{if(!Y.isReady())return void Y.onLoadObservable.addOnce((async()=>{try{const h=await this.ExtractFromTextureAsync(Y);c(h)}catch(C){h(C)}}));const C=Y.getSize();Ac.j.GetTextureDataAsync(Y,C.width,C.height).then((Y=>{c(new nc(C.width,C.height,new Uint8ClampedArray(Y)))})).catch(h)}))}}var vc,gc,zc,Oc,oc,fc,Lc,uc,ic;!function(Y){Y[Y.Int=1]="Int",Y[Y.Float=2]="Float",Y[Y.Vector2=4]="Vector2",Y[Y.bh=8]="bh",Y[Y.Matrix=16]="Matrix",Y[Y.Particle=32]="Particle",Y[Y.Texture=64]="Texture",Y[Y.vc=128]="vc",Y[Y.FloatGradient=256]="FloatGradient",Y[Y.Vector2Gradient=512]="Vector2Gradient",Y[Y.Vector3Gradient=1024]="Vector3Gradient",Y[Y.Color4Gradient=2048]="Color4Gradient",Y[Y.System=4096]="System",Y[Y.AutoDetect=8192]="AutoDetect",Y[Y.BasedOnInput=16384]="BasedOnInput",Y[Y.Undefined=32768]="Undefined",Y[Y.All=65535]="All"}(vc||(vc={})),function(Y){Y[Y.Compatible=0]="Compatible",Y[Y.TypeIncompatible=1]="TypeIncompatible",Y[Y.HierarchyIssue=2]="HierarchyIssue"}(gc||(gc={})),function(Y){Y[Y.Input=0]="Input",Y[Y.Output=1]="Output"}(zc||(zc={}));class Rc{get direction(){return this._direction}get type(){if(this._type===vc.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===vc.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Y){this._type=Y}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Y=>Y.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Y,c,h){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=vc.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new J.c,this.onDisconnectionObservable=new J.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=c,this.name=Y,this._direction=h}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Y){var c;return this.isConnected?null!==(c=this._connectedPoint)&&void 0!==c&&c._storedFunction?this._connectedPoint._storedFunction(Y):this._connectedPoint._storedValue:this.value}canConnectTo(Y){return 0===this.checkCompatibilityState(Y)}checkCompatibilityState(Y){const c=this._ownerBlock,h=Y.ownerBlock;if(this.type!==Y.type&&Y.innerType!==vc.AutoDetect)return Y.acceptedConnectionPointTypes&&-1!==Y.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Y.excludedConnectionPointTypes&&-1!==Y.excludedConnectionPointTypes.indexOf(this.type))return 1;let C=h,E=c;return 0===this.direction&&(C=c,E=h),C.isAnAncestorOf(E)?2:0}connectTo(Y){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Y))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Y.ownerBlock.name}".${Y.name}`;return this._endpoints.push(Y),Y._connectedPoint=this,this.onConnectionObservable.notifyObservers(Y),Y.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Y){const c=this._endpoints.indexOf(Y);return-1===c||(this._endpoints.splice(c,1),Y._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Y),Y.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Y){let c=1;for(;c<vc.All;)Y&c||this.excludedConnectionPointTypes.push(c),c<<=1}serialize(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c={};return c.name=this.name,c.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Xc?(c.valueType="BABYLON."+this.value.getClassName(),c.value=this.value.Xc()):(c.valueType="number",c.value=this.value)),Y&&this.connectedPoint&&(c.inputName=this.name,c.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,c.targetConnectionName=this.connectedPoint.name,c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(c.isExposedOnFrame=!0,c.exposedPortPosition=this.exposedPortPosition),c}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Bc{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Y){this._name=Y}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Y){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new J.c,this.Mc=new J.c,this.onInputChangedObservable=new J.c,this.visibleOnFrame=!1,this._name=Y,this.uniqueId=n.c.UniqueId}_inputRename(Y){return Y}_outputRename(Y){return Y}isAnAncestorOf(Y){for(const c of this._outputs)if(c.hasEndpoints)for(const h of c.endpoints){if(h.ownerBlock===Y)return!0;if(h.ownerBlock.isAnAncestorOf(Y))return!0}return!1}isAnAncestorOfType(Y){if(this.getClassName()===Y)return!0;for(const c of this._outputs)if(c.hasEndpoints)for(const h of c.endpoints)if(h.ownerBlock.isAnAncestorOfType(Y))return!0;return!1}getInputByName(Y){const c=this._inputs.filter((c=>c.name===Y));return c.length?c[0]:null}_linkConnectionTypes(Y,c){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[c]._acceptedConnectionPointType=this._inputs[Y]:(this._inputs[Y]._linkedConnectionSource=this._inputs[c],this._inputs[Y]._isMainLinkSource=!0),this._inputs[c]._linkedConnectionSource=this._inputs[Y]}registerInput(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const Q=new Rc(Y,this,0);return Q.type=c,Q.isOptional=h,Q.defaultValue=C,Q.value=C,Q.valueMin=E,Q.valueMax=N,this._inputs.push(Q),this.onInputChangedObservable.notifyObservers(Q),this}registerOutput(Y,c,h){return(h=h??new Rc(Y,this,1)).type=c,this._outputs.push(h),this}_build(Y){}_customBuildStep(Y){}build(Y){if(this._buildId===Y.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Y=>Y.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Y.buildId;for(const c of this._inputs){if(!c.connectedPoint){c.isOptional||Y.notConnectedNonOptionalInputs.push(c);continue}const h=c.connectedPoint.ownerBlock;h&&h!==this&&!h.isSystem&&h.build(Y)}return this._customBuildStep(Y),Y.verbose&&v.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Y),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Y={};Y.customType="BABYLON."+this.getClassName(),Y.id=this.uniqueId,Y.name=this.name,Y.visibleOnFrame=this.visibleOnFrame,Y.inputs=[],Y.outputs=[];for(const c of this.inputs)Y.inputs.push(c.serialize());for(const c of this.outputs)Y.outputs.push(c.serialize(!1));return Y}_deserialize(Y){this._name=Y.name,this.comments=Y.comments,this.visibleOnFrame=!!Y.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Y)}_deserializePortDisplayNamesAndExposedOnFrame(Y){const c=Y.inputs,h=Y.outputs;if(c)for(const C of c){const Y=this.inputs.find((Y=>Y.name===C.name));if(!Y)return;if(C.displayName&&(Y.displayName=C.displayName),C.isExposedOnFrame&&(Y.isExposedOnFrame=C.isExposedOnFrame,Y.exposedPortPosition=C.exposedPortPosition),void 0!==C.value&&null!==C.value)if("number"===C.valueType)Y.value=C.value;else{const c=(0,b.d)(C.valueType);c&&(Y.value=c.dh(C.value))}}if(h)for(let C=0;C<h.length;C++){const Y=h[C];Y.displayName&&(this.outputs[C].displayName=Y.displayName),Y.isExposedOnFrame&&(this.outputs[C].isExposedOnFrame=Y.isExposedOnFrame,this.outputs[C].exposedPortPosition=Y.exposedPortPosition)}}clone(){const Y=this.serialize(),c=(0,b.d)(Y.customType);if(c){const h=new c;return h._deserialize(Y),h}return null}dispose(){this.Mc.notifyObservers(this),this.Mc.clear();for(const Y of this.inputs)Y.dispose();for(const Y of this.outputs)Y.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function tc(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",C=arguments.length>3?arguments[3]:void 0;return(E,N)=>{let Q=E._propStore;Q||(Q=[],E._propStore=Q),Q.push({propertyName:N,displayName:Y,type:c,groupName:h,options:C??{},className:E.getClassName()})}}(0,A.b)([(0,V.N)("comment")],Bc.prototype,"comments",void 0),function(Y){Y[Y.Boolean=0]="Boolean",Y[Y.Float=1]="Float",Y[Y.Int=2]="Int",Y[Y.Vector2=3]="Vector2",Y[Y.List=4]="List",Y[Y.vc=5]="vc",Y[Y.SamplingMode=6]="SamplingMode",Y[Y.TextureFormat=7]="TextureFormat",Y[Y.TextureType=8]="TextureType"}(Oc||(Oc={})),function(Y){Y[Y.None=0]="None",Y[Y.Position=1]="Position",Y[Y.Direction=2]="Direction",Y[Y.Age=3]="Age",Y[Y.Lifetime=4]="Lifetime",Y[Y.Color=5]="Color",Y[Y.ScaledDirection=6]="ScaledDirection",Y[Y.Scale=7]="Scale",Y[Y.AgeGradient=8]="AgeGradient",Y[Y.Angle=9]="Angle",Y[Y.SpriteCellIndex=16]="SpriteCellIndex",Y[Y.SpriteCellStart=17]="SpriteCellStart",Y[Y.SpriteCellEnd=18]="SpriteCellEnd"}(oc||(oc={})),function(Y){Y[Y.None=0]="None",Y[Y.Time=1]="Time",Y[Y.Delta=2]="Delta",Y[Y.Emitter=3]="Emitter"}(fc||(fc={}));class Fc{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Y="";for(const c of this.notConnectedNonOptionalInputs)Y+=`input ${c.name} from block ${c.ownerBlock.name}[${c.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Y)throw"Build of Node Particle System Set failed:\n"+Y}adapt(Y,c){const h=Y.getConnectedValue(this)||0;if(Y.type===c)return h;switch(c){case vc.Vector2:return new C.Vector2(h,h);case vc.bh:return new C.bh(h,h,h);case vc.vc:return new Q.vc(h,h,h,h)}return null}getContextualValue(Y){if(!this.particleContext||!this.systemContext)return null;switch(Y){case oc.Position:return this.particleContext.position;case oc.Direction:return this.particleContext.direction;case oc.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case oc.Color:return this.particleContext.color;case oc.Age:return this.particleContext.age;case oc.Lifetime:return this.particleContext.lifeTime;case oc.Angle:return this.particleContext.angle;case oc.Scale:return this.particleContext.scale;case oc.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case oc.SpriteCellEnd:return this.systemContext.endSpriteCellID;case oc.SpriteCellIndex:return this.particleContext.cellIndex;case oc.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Cc.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Cc.absolutePosition:this.systemContext.Cc:null}getSystemValue(Y){if(!this.particleContext||!this.systemContext)return null;switch(Y){case fc.Time:return this.systemContext._actualFrame;case fc.Delta:return this.systemContext._scaledUpdateSpeed;case fc.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Cc.absolutePosition}return this.systemContext.Cc}return null}}function Jc(Y,c,h){const C=new Fc;C.wh=c;const E=Y.createSystem(C);return E.canStart=()=>!0,E.Cc=h.clone(),E.disposeOnStop=!0,E.start(),E}class jc extends Bc{constructor(Y){super(Y),this.blendMode=H.BLENDMODE_ONEONE,this.ZC=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",vc.Particle),this.registerInput("texture",vc.Texture),this.registerInput("onStart",vc.System,!0),this.registerInput("onEnd",vc.System,!0),this.registerOutput("system",vc.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Y){Y.ZC=this.ZC,Y.buildId=this._buildId++,this.build(Y);const c=this.particle.getConnectedValue(Y);return c.particleTexture=this.texture.getConnectedValue(Y),c.emitRate=this.emitRate,c.blendMode=this.blendMode,c.name=this.name,c._nodeGenerated=!0,c._targetStopDuration=this.targetStopDuration,c.startDelay=this.startDelay,this.system._storedValue=this,c.canStart=()=>!this.doNoStart,c.onStartedObservable.add((h=>{const C=this.onStart.getConnectedValue(Y);C&&h.onStartedObservable.addOnce((()=>{Y.systemContext=c;const h=Jc(C,Y.wh,Y.emitterPosition);this.Mc.addOnce((()=>{h.dispose()}))}));const E=this.onEnd.getConnectedValue(Y);E&&h.onStoppedObservable.addOnce((()=>{Y.systemContext=c;const h=Jc(E,Y.wh,Y.emitterPosition);this.Mc.addOnce((()=>{h.dispose()}))}))})),this.Mc.addOnce((()=>{c.dispose()})),c}serialize(){const Y=super.serialize();return Y.ZC=this.ZC,Y.emitRate=this.emitRate,Y.blendMode=this.blendMode,Y.doNoStart=this.doNoStart,Y.targetStopDuration=this.targetStopDuration,Y.startDelay=this.startDelay,Y}_deserialize(Y){super._deserialize(Y),this.ZC=Y.ZC,this.emitRate=Y.emitRate,this.doNoStart=!!Y.doNoStart,void 0!==Y.blendMode&&(this.blendMode=Y.blendMode),void 0!==Y.targetStopDuration&&(this.targetStopDuration=Y.targetStopDuration),void 0!==Y.startDelay&&(this.startDelay=Y.startDelay)}}(0,A.b)([tc("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:H.BLENDMODE_ONEONE},{label:"Standard",value:H.BLENDMODE_STANDARD},{label:"Add",value:H.BLENDMODE_ADD},{label:"Multiply",value:H.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:H.BLENDMODE_MULTIPLYADD}]})],jc.prototype,"blendMode",void 0),(0,A.b)([tc("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],jc.prototype,"ZC",void 0),(0,A.b)([tc("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jc.prototype,"emitRate",void 0),(0,A.b)([tc("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jc.prototype,"targetStopDuration",void 0),(0,A.b)([tc("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jc.prototype,"startDelay",void 0),(0,A.b)([tc("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],jc.prototype,"doNoStart",void 0),(0,b.e)("BABYLON.SystemBlock",jc);class Sc extends Bc{get type(){if(this._type===vc.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=vc.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=vc.Vector2,this._type;case"bh":return this._type=vc.bh,this._type;case"vc":return this._type=vc.vc,this._type;case"Matrix":return this._type=vc.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===oc.None&&this._systemSource!==fc.None}get systemSource(){return this._systemSource}set systemSource(Y){if(this._systemSource=Y,Y!==fc.None){switch(this._contextualSource=oc.None,this._type=vc.Float,Y){case fc.Time:case fc.Delta:this._type=vc.Float;break;case fc.Emitter:this._type=vc.bh}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==oc.None}get contextualValue(){return this._contextualSource}set contextualValue(Y){if(this._contextualSource=Y,Y!==oc.None){switch(this._systemSource=fc.None,Y){case oc.Scale:this._type=vc.Vector2;break;case oc.Position:case oc.Direction:case oc.ScaledDirection:this._type=vc.bh;break;case oc.Color:this._type=vc.vc;break;case oc.Age:case oc.Lifetime:case oc.Angle:case oc.AgeGradient:this._type=vc.Float;break;case oc.SpriteCellEnd:case oc.SpriteCellStart:case oc.SpriteCellIndex:this._type=vc.Int}this.output&&(this.output.type=this._type)}}constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vc.AutoDetect;super(Y),this._type=vc.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new J.c,this._systemSource=fc.None,this._contextualSource=oc.None,this._type=c,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",c)}get value(){return this._storedValue}set value(Y){this.type===vc.Float&&this.min!==this.max&&(Y=Math.max(this.min,Y),Y=Math.min(this.max,Y)),this._storedValue=Y,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Y){this._valueCallback=Y}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case vc.Int:case vc.Float:this.value=0;break;case vc.Vector2:this.value=C.Vector2.Zero();break;case vc.bh:this.value=C.bh.Zero();break;case vc.vc:this.value=new Q.vc(1,1,1,1);break;case vc.Matrix:this.value=C.Matrix.Identity()}}_build(Y){super._build(Y),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Y=>Y.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Y=>Y.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Y=super.serialize();return Y.type=this.type,Y.contextualValue=this.contextualValue,Y.systemSource=this.systemSource,Y.min=this.min,Y.max=this.max,Y.groupInInspector=this.groupInInspector,Y.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Xc?(Y.valueType="BABYLON."+this._storedValue.getClassName(),Y.value=this._storedValue.Xc()):(Y.valueType="number",Y.value=this._storedValue)),Y}_deserialize(Y){if(super._deserialize(Y),this._type=Y.type,this.contextualValue=Y.contextualValue,this.systemSource=Y.systemSource||fc.None,this.min=Y.min||0,this.max=Y.max||0,this.groupInInspector=Y.groupInInspector||"",void 0!==Y.displayInInspector&&(this.displayInInspector=Y.displayInInspector),Y.valueType)if("number"===Y.valueType)this._storedValue=Y.value;else{const c=(0,b.d)(Y.valueType);c&&(this._storedValue=c.dh(Y.value))}}}(0,b.e)("BABYLON.ParticleInputBlock",Sc);class mh extends Bc{get url(){return this._url}set url(Y){this._url!==Y&&(this._cachedData=null,this._url=Y,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Y){this._textureDataUrl!==Y&&(this._cachedData=null,this._textureDataUrl=Y,this._url="",this._sourceTexture=null)}set sourceTexture(Y){this._sourceTexture!==Y&&(this._cachedData=null,this._sourceTexture=Y,this._url="",this._textureDataUrl="")}constructor(Y){super(Y),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",vc.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Y=this.texture._storedValue;return await new Promise(((c,h)=>{if(!Y.isReady())return void Y.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),c(this._cachedData)}catch(Y){h(Y)}}));const C=Y.getSize();Ac.j.GetTextureDataAsync(Y,C.width,C.height).then((h=>{this._cachedData={width:C.width,height:C.height,data:new Uint8ClampedArray(h)},Y.dispose(),c(this._cachedData)})).catch(h)}))}_build(Y){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.d(this._textureDataUrl,Y.wh):this.texture._storedValue=new l.d(this._url,Y.wh):this.texture._storedValue=null}serialize(){const Y=super.serialize();return Y.url=this.url,Y.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Y.textureDataUrl=this.textureDataUrl),Y}_deserialize(Y){super._deserialize(Y),this.url=Y.url,this.serializedCachedData=!!Y.serializedCachedData,Y.textureDataUrl&&(this.textureDataUrl=Y.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,b.e)("BABYLON.ParticleTextureSourceBlock",mh);class Yh extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("position",vc.bh),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.position.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.position.N(this.position.getConnectedValue(Y))},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}}(0,b.e)("BABYLON.UpdatePositionBlock",Yh),function(Y){Y[Y.Add=0]="Add",Y[Y.Subtract=1]="Subtract",Y[Y.Multiply=2]="Multiply",Y[Y.Divide=3]="Divide",Y[Y.Max=4]="Max",Y[Y.Min=5]="Min"}(Lc||(Lc={}));class ch extends Bc{constructor(Y){super(Y),this.operation=Lc.Add,this.registerInput("left",vc.AutoDetect),this.registerInput("right",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this.output._typeConnectionSource=this.left;const c=[vc.Matrix,vc.Particle,vc.Texture,vc.System,vc.FloatGradient,vc.Color4Gradient,vc.Vector2Gradient,vc.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...c),this.right.excludedConnectionPointTypes.push(...c),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Y){let c;const h=this.left,E=this.right;if(!h.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=h.type===vc.Float||h.type===vc.Int,b=E.type===vc.Float||E.type===vc.Int,H=N&&b;switch(this.operation){case Lc.Add:c=H?Y=>h.getConnectedValue(Y)+E.getConnectedValue(Y):N?Y=>Y.adapt(h,E.type).add(E.getConnectedValue(Y)):Y=>h.getConnectedValue(Y).add(Y.adapt(E,h.type));break;case Lc.Subtract:c=H?Y=>h.getConnectedValue(Y)-E.getConnectedValue(Y):N?Y=>Y.adapt(h,E.type).Hh(E.getConnectedValue(Y)):Y=>h.getConnectedValue(Y).Hh(Y.adapt(E,h.type));break;case Lc.Multiply:c=H?Y=>h.getConnectedValue(Y)*E.getConnectedValue(Y):N?Y=>Y.adapt(h,E.type).multiply(E.getConnectedValue(Y)):Y=>h.getConnectedValue(Y).multiply(Y.adapt(E,h.type));break;case Lc.Divide:c=H?Y=>h.getConnectedValue(Y)/E.getConnectedValue(Y):N?Y=>Y.adapt(h,E.type).divide(E.getConnectedValue(Y)):Y=>h.getConnectedValue(Y).divide(Y.adapt(E,h.type));break;case Lc.Min:if(H)c=Y=>Math.min(h.getConnectedValue(Y),E.getConnectedValue(Y));else{const[Y,b]=N?[E,h]:[h,E];switch(Y.type){case vc.Vector2:c=c=>C.Vector2.Minimize(Y.getConnectedValue(c),c.adapt(b,Y.type));break;case vc.bh:c=c=>C.bh.Minimize(Y.getConnectedValue(c),c.adapt(b,Y.type));break;case vc.vc:c=c=>{const h=Y.getConnectedValue(c),{r:C,g:E,b:N,a:H}=c.adapt(b,Y.type);return new Q.vc(Math.min(h.r,C),Math.min(h.g,E),Math.min(h.b,N),Math.min(h.a,H))}}}break;case Lc.Max:if(!H){const[Y,b]=N?[E,h]:[h,E];switch(Y.type){case vc.Vector2:c=c=>C.Vector2.Maximize(Y.getConnectedValue(c),c.adapt(b,Y.type));break;case vc.bh:c=c=>C.bh.Maximize(Y.getConnectedValue(c),c.adapt(b,Y.type));break;case vc.vc:c=c=>{const h=Y.getConnectedValue(c),{r:C,g:E,b:N,a:H}=c.adapt(b,Y.type);return new Q.vc(Math.max(h.r,C),Math.min(h.g,E),Math.min(h.b,N),Math.min(h.a,H))}}break}c=Y=>Math.max(h.getConnectedValue(Y),E.getConnectedValue(Y))}this.output._storedFunction=Y=>h.type===vc.Int?0|c(Y):c(Y)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===vc.Int||this.left.type===vc.Float&&this.right.type!==vc.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Y,c]of[[this.left,this.right],[this.right,this.left]])Y.acceptedConnectionPointTypes=[vc.Int,vc.Float],c.isConnected&&(Y.acceptedConnectionPointTypes.push(c.type),c.type!==vc.Int&&c.type!==vc.Float||Y.acceptedConnectionPointTypes.push(vc.Vector2,vc.bh,vc.vc))}dispose(){super.dispose();for(const Y of this._connectionObservers)Y.remove();this._connectionObservers.length=0}serialize(){const Y=super.serialize();return Y.operation=this.operation,Y}_deserialize(Y){super._deserialize(Y),this.operation=Y.operation}}(0,A.b)([tc("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Lc.Add},{label:"Subtract",value:Lc.Subtract},{label:"Multiply",value:Lc.Multiply},{label:"Divide",value:Lc.Divide},{label:"Max",value:Lc.Max},{label:"Min",value:Lc.Min}]})],ch.prototype,"operation",void 0),(0,b.e)("BABYLON.ParticleMathBlock",ch);class hh extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("direction1",vc.bh,!0,new C.bh(0,1,0)),this.registerInput("direction2",vc.bh,!0,new C.bh(0,1,0)),this.registerInput("minEmitBox",vc.bh,!0,new C.bh(-.5,-.5,-.5)),this.registerInput("maxEmitBox",vc.bh,!0,new C.bh(.5,.5,.5)),this.registerOutput("output",vc.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Y){const c=this.particle.getConnectedValue(Y);c._directionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.direction1.getConnectedValue(Y),N=this.direction2.getConnectedValue(Y),Q=(0,w.RandomRange)(E.x,N.x),b=(0,w.RandomRange)(E.y,N.y),H=(0,w.RandomRange)(E.z,N.z);Y.isEmitterTransformNode?C.bh.TransformNormalFromFloatsToRef(Q,b,H,Y.emitterWorldMatrix,h.direction):h.direction.Vc(Q,b,H)},c._positionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.minEmitBox.getConnectedValue(Y),N=this.maxEmitBox.getConnectedValue(Y),Q=(0,w.RandomRange)(E.x,N.x),b=(0,w.RandomRange)(E.y,N.y),H=(0,w.RandomRange)(E.z,N.z);Y.isEmitterTransformNode?C.bh.TransformCoordinatesFromFloatsToRef(Q,b,H,Y.emitterWorldMatrix,h.position):(h.position.Vc(Q,b,H),h.position.addInPlace(Y.emitterPosition))},this.output._storedValue=c}}(0,b.e)("BABYLON.BoxShapeBlock",hh);class Ch extends Bc{constructor(Y){super(Y),this.registerInput("emitPower",vc.Float,!0,1),this.registerInput("lifeTime",vc.Float,!0,1),this.registerInput("color",vc.vc,!0,new Q.vc(1,1,1,1)),this.registerInput("scale",vc.Vector2,!0,new C.Vector2(1,1)),this.registerInput("angle",vc.Float,!0,0),this.registerOutput("particle",vc.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Y){const c=new bc(this.name,Y.ZC,Y.wh,null,!1,void 0,!0);c.particleEmitterType=new d,c._lifeTimeCreation.process=(c,h)=>{Y.particleContext=c,c.lifeTime=this.lifeTime.getConnectedValue(Y),h._emitPower=this.emitPower.getConnectedValue(Y)},c._colorCreation.process=c=>{Y.particleContext=c,c.color.N(this.color.getConnectedValue(Y))},c._sizeCreation.process=c=>{Y.particleContext=c,c.size=1,c.scale.N(this.scale.getConnectedValue(Y))},c._angleCreation.process=c=>{Y.particleContext=c,c.angle=this.angle.getConnectedValue(Y)},this.particle._storedValue=c}}(0,b.e)("BABYLON.CreateParticleBlock",Ch);class Eh{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Y=[];for(const c of this.attachedBlocks)c.isInput&&Y.push(c);return Y}constructor(Y){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new J.c,this.name=Y}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Y)&&this.attachedBlocks.push(Y);for(const h of Y.inputs){const C=h.connectedPoint;if(C){const h=C.ownerBlock;h!==Y&&this._initializeBlock(h,c)}}}async buildAsync(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((h=>{const C=new Zc;for(const Y of this._systemBlocks)this._initializeBlock(Y);for(const E of this.systemBlocks){const h=new Fc;h.buildId=this._buildId++,h.wh=Y,h.verbose=c;const N=E.createSystem(h);h.emitErrors(),C.systems.push(N)}this.onBuildObservable.notifyObservers(this),h(C)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Y=new jc("Particle system"),c=new Yh("Update position");c.output.connectTo(Y.particle);const h=new Sc("Position");h.contextualValue=oc.Position;const C=new Sc("Scaled direction");C.contextualValue=oc.ScaledDirection;const E=new ch("Add");E.operation=Lc.Add,h.output.connectTo(E.left),C.output.connectTo(E.right),E.output.connectTo(c.position);const N=new Ch("Create particle"),Q=new hh("Box shape");N.particle.connectTo(Q.particle),Q.output.connectTo(c.particle);const b=new mh("Texture");b.texture.connectTo(Y.texture),b.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Y)}removeBlock(Y){const c=this.attachedBlocks.indexOf(Y);if(c>-1&&this.attachedBlocks.splice(c,1),Y.isSystem){const c=this._systemBlocks.indexOf(Y);c>-1&&this._systemBlocks.splice(c,1)}}parseSerializedObject(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];c||this.clear();const h={};for(const C of Y.Ck){const Y=(0,b.d)(C.customType);if(Y){const c=new Y;c._deserialize(C),h[C.id]=c,this.attachedBlocks.push(c),c.isSystem&&this._systemBlocks.push(c)}}for(const C of this.attachedBlocks)if(C.isTeleportOut){const Y=C,c=Y._tempEntryPointUniqueId;if(c){const C=h[c];C&&C.attachToEndpoint(Y)}}for(let C=0;C<Y.Ck.length;C++){const E=Y.Ck[C],N=h[E.id];N&&(N.inputs.length&&E.inputs.some((Y=>Y.targetConnectionName))&&!c||this._restoreConnections(N,Y,h))}if(Y.locations||Y.editorData&&Y.editorData.locations){const C=Y.locations||Y.editorData.locations;for(const Y of C)h[Y.hN]&&(Y.hN=h[Y.hN].uniqueId);c&&this.editorData&&this.editorData.locations&&C.concat(this.editorData.locations),Y.locations?this.editorData={locations:C}:(this.editorData=Y.editorData,this.editorData.locations=C);const E=[];for(const Y in h)E[Y]=h[Y].uniqueId;this.editorData.map=E}this.comment=Y.comment}_restoreConnections(Y,c,h){for(const C of Y.outputs)for(const E of c.Ck){const N=h[E.id];if(N)for(const Q of E.inputs)if(h[Q.targetBlockId]!==Y||Q.targetConnectionName!==C.name);else{const Y=N.getInputByName(Q.inputName);if(!Y||Y.isConnected)continue;C.connectTo(Y,!0),this._restoreConnections(N,c,h)}}}serialize(Y){const c=Y?{}:U.d.Serialize(this);c.editorData=JSON.parse(JSON.stringify(this.editorData));let h=[];Y?h=Y:c.customType="BABYLON.NodeParticleSystemSet",c.Ck=[];for(const C of h)c.Ck.push(C.serialize());if(!Y)for(const C of this.attachedBlocks)-1===h.indexOf(C)&&c.Ck.push(C.serialize());return c}dispose(){for(const Y of this.attachedBlocks)Y.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Y){const c=new Eh(Y);return c.setToDefault(),c}static Parse(Y){const c=U.d.Parse((()=>new Eh(Y.name)),Y,null);return c.parseSerializedObject(Y),c}static ParseFromSnippetAsync(Y,c){return"_BLANK"===Y?Promise.resolve(Eh.CreateDefault("blank")):new Promise(((h,C)=>{const E=new ac.c;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const Q=JSON.parse(JSON.parse(E.responseText).jsonPayload),b=JSON.parse(Q.nodeParticle);c||(c=U.d.Parse((()=>new Eh(Y)),b,null)),c.parseSerializedObject(b),c.snippetId=Y;try{h(c)}catch(N){C(N)}}else C("Unable to load the snippet "+Y)})),E.open("GET",this.SnippetUrl+"/"+Y.replace(/#/g,"/")),E.send()}))}}Eh.EditorURL=`${ec.Tools._DefaultCdnUrl}/v${tY.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Eh.SnippetUrl="https://snippet.babylonjs.com",(0,A.b)([(0,V.N)()],Eh.prototype,"name",void 0),(0,A.b)([(0,V.N)("comment")],Eh.prototype,"comment",void 0),function(Y){Y[Y.None=0]="None",Y[Y.PerParticle=1]="PerParticle",Y[Y.PerSystem=2]="PerSystem"}(uc||(uc={}));class Nh extends Bc{constructor(Y){super(Y),this._currentLockId=-2,this.lockMode=uc.PerParticle,this.registerInput("min",vc.AutoDetect,!0,0),this.registerInput("max",vc.AutoDetect,!0,1),this.registerOutput("output",vc.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vc.Float|vc.Int|vc.Vector2|vc.bh|vc.vc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(vc.Float|vc.Int|vc.Vector2|vc.bh|vc.vc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=vc.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Y=null;switch(this._currentLockId=-2,this.min.type){case vc.AutoDetect:case vc.Int:case vc.Float:Y=Y=>{const c=this.min.getConnectedValue(Y)||0,h=this.max.getConnectedValue(Y)||1;return c+Math.random()*(h-c)};break;case vc.Vector2:Y=Y=>{const c=this.min.getConnectedValue(Y)||C.Vector2.Zero(),h=this.max.getConnectedValue(Y)||C.Vector2.One();return new C.Vector2(c.x+Math.random()*(h.x-c.x),c.y+Math.random()*(h.y-c.y))};break;case vc.bh:Y=Y=>{const c=this.min.getConnectedValue(Y)||C.bh.Zero(),h=this.max.getConnectedValue(Y)||C.bh.One();return new C.bh(c.x+Math.random()*(h.x-c.x),c.y+Math.random()*(h.y-c.y),c.z+Math.random()*(h.z-c.z))};break;case vc.vc:Y=Y=>{const c=this.min.getConnectedValue(Y)||new Q.vc(0,0,0,0),h=this.max.getConnectedValue(Y)||new Q.vc(1,1,1,1);return new Q.vc(c.x+Math.random()*(h.x-c.x),c.y+Math.random()*(h.y-c.y),c.z+Math.random()*(h.z-c.z),c.w+Math.random()*(h.w-c.w))}}this.output._storedFunction=c=>{var h;let C=0;switch(this.lockMode){case uc.PerParticle:C=(null===(h=c.particleContext)||void 0===h?void 0:h.id)||-1;break;case uc.PerSystem:C=c.buildId||0}return this._currentLockId!==C&&(this.lockMode!==uc.None&&(this._currentLockId=C),this.output._storedValue=Y(c)),this.output._storedValue}}serialize(){const Y=super.serialize();return Y.lockMode=this.lockMode,Y}_deserialize(Y){super._deserialize(Y),this.lockMode=Y.lockMode}}(0,A.b)([tc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:uc.None},{label:"Per particle",value:uc.PerParticle},{label:"Per system",value:uc.PerSystem}]})],Nh.prototype,"lockMode",void 0),(0,b.e)("BABYLON.ParticleRandomBlock",Nh);class Qh extends Bc{constructor(Y){super(Y),this._currentLockId=-2,this.lockMode=uc.PerParticle,this.registerInput("min",vc.AutoDetect),this.registerInput("max",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const c=[vc.Matrix,vc.Particle,vc.Texture,vc.System,vc.FloatGradient,vc.Color4Gradient,vc.Vector2Gradient,vc.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...c),this.max.excludedConnectionPointTypes.push(...c)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Y=null;switch(this._currentLockId=-2,this.min.type){case vc.Float:case vc.Int:Y=Y=>{const c=this.min.getConnectedValue(Y),h=this.max.getConnectedValue(Y);return Math.random()*(h-c)+c};break;case vc.Vector2:Y=Y=>{const c=this.min.getConnectedValue(Y),h=this.max.getConnectedValue(Y);return new C.Vector2(Math.random()*(h.x-c.x)+c.x,Math.random()*(h.y-c.y)+c.y)};break;case vc.bh:Y=Y=>{const c=this.min.getConnectedValue(Y),h=this.max.getConnectedValue(Y);return new C.bh(Math.random()*(h.x-c.x)+c.x,Math.random()*(h.y-c.y)+c.y,Math.random()*(h.z-c.z)+c.z)};break;case vc.vc:Y=Y=>{const c=this.min.getConnectedValue(Y),h=this.max.getConnectedValue(Y);return new Q.vc(Math.random()*(h.r-c.r)+c.r,Math.random()*(h.g-c.g)+c.g,Math.random()*(h.b-c.b)+c.b,Math.random()*(h.a-c.a)+c.a)}}this.output._storedFunction=c=>{var h;let C=0;switch(this.lockMode){case uc.PerParticle:C=(null===(h=c.particleContext)||void 0===h?void 0:h.id)||-1;break;case uc.PerSystem:C=c.buildId||0}return this._currentLockId!==C&&(this.lockMode!==uc.None&&(this._currentLockId=C),this.output._storedValue=Y(c)),this.output._storedValue}}serialize(){const Y=super.serialize();return Y.lockMode=this.lockMode,Y}_deserialize(Y){super._deserialize(Y),void 0!==Y.lockMode&&(this.lockMode=Y.lockMode)}}(0,A.b)([tc("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:uc.None},{label:"Per particle",value:uc.PerParticle},{label:"Per system",value:uc.PerSystem}]})],Qh.prototype,"lockMode",void 0),(0,b.e)("BABYLON.RandomRangeBlock",Qh);(0,b.e)("BABYLON.ParticleLerpBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("left",vc.AutoDetect),this.registerInput("right",vc.AutoDetect),this.registerInput("gradient",vc.Float,!0,0,0,1),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vc.Float|vc.Int|vc.Vector2|vc.bh|vc.vc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Y=(Y,c,h)=>(1-Y)*c+Y*h;this.output._storedFunction=c=>{const h=this.left.getConnectedValue(c),E=this.right.getConnectedValue(c),N=this.gradient.getConnectedValue(c);switch(this.left.type){case vc.Int:case vc.Float:return Y(N,h,E);case vc.Vector2:return new C.Vector2(Y(N,h.x,E.x),Y(N,h.y,E.y));case vc.bh:return new C.bh(Y(N,h.x,E.x),Y(N,h.y,E.y),Y(N,h.z,E.z));case vc.vc:return new Q.vc(Y(N,h.r,E.r),Y(N,h.g,E.g),Y(N,h.b,E.b),Y(N,h.a,E.a))}return 0}}});(0,b.e)("BABYLON.UpdateDirectionBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("direction",vc.bh),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.direction.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.direction.N(this.direction.getConnectedValue(Y))},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateColorBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("color",vc.vc),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.color.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.color.N(this.color.getConnectedValue(Y))},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateScaleBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("scale",vc.Vector2),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.scale.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.scale.N(this.scale.getConnectedValue(Y))},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}});(0,b.e)("BABYLON.UpdateAngleBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("angle",vc.Float),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.angle.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.angle=this.angle.getConnectedValue(Y)},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}});(0,b.e)("BABYLON.BasicPositionUpdateBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Y){const c=this.particle.getConnectedValue(Y),h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.direction.scaleToRef(c._directionScale,c._scaledDirection),h.position.addInPlace(c._scaledDirection)},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h,this.output._storedValue=c}});(0,b.e)("BABYLON.BasicSpriteUpdateBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Y){const c=this.particle.getConnectedValue(Y),h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.updateCellIndex()},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h,this.output._storedValue=c}});(0,b.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("cellIndex",vc.Int),this.registerOutput("output",vc.Particle),this.cellIndex.acceptedConnectionPointTypes=[vc.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Y){const c=this.particle.getConnectedValue(Y);if(this.output._storedValue=c,!this.cellIndex.isConnected)return;const h={process:h=>{Y.particleContext=h,Y.systemContext=c,h.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Y))},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h}});class bh extends Bc{constructor(Y){super(Y),this.strength=1,this.registerInput("particle",vc.Particle),this.registerInput("flowMap",vc.Texture),this.registerOutput("output",vc.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Y){var c;const h=this.particle.getConnectedValue(Y),C=Y.wh;let E;(null===(c=this.flowMap.connectedPoint)||void 0===c?void 0:c.ownerBlock).extractTextureContentAsync().then((Y=>{Y&&(E=new nc(Y.width,Y.height,Y.data))}));const N={process:Y=>{const c=C.getTransformMatrix();E&&E._processParticle(Y,this.strength*h._tempScaledUpdateSpeed,c)},previousItem:null,nextItem:null};h._updateQueueStart?fY(N,h._updateQueueStart):h._updateQueueStart=N,this.output._storedValue=h}serialize(){const Y=super.serialize();return Y.strength=this.strength,Y}_deserialize(Y){super._deserialize(Y),this.strength=Y.strength}}(0,A.b)([tc("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bh.prototype,"strength",void 0),(0,b.e)("BABYLON.UpdateFlowMapBlock",bh);(0,b.e)("BABYLON.SphereShapeBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("input",vc.Particle),this.registerInput("radius",vc.Float,!0,1),this.registerInput("radiusRange",vc.Float,!0,1,0,1),this.registerInput("directionRandomizer",vc.Float,!0,0,0,1),this.registerOutput("output",vc.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Y){const c=this.input.getConnectedValue(Y);c._directionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.directionRandomizer.getConnectedValue(Y),N=h.position.Hh(Y.emitterPosition).normalize(),Q=(0,w.RandomRange)(0,E),b=(0,w.RandomRange)(0,E),H=(0,w.RandomRange)(0,E);N.x+=Q,N.y+=b,N.z+=H,N.normalize(),Y.isEmitterTransformNode?C.bh.TransformNormalFromFloatsToRef(Q,b,H,Y.emitterWorldMatrix,h.direction):h.direction.Vc(Q,b,H)},c._positionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.radius.getConnectedValue(Y),N=this.radiusRange.getConnectedValue(Y),Q=E-(0,w.RandomRange)(0,E*N),b=(0,w.RandomRange)(0,1),H=(0,w.RandomRange)(0,2*Math.PI),W=Math.acos(2*b-1),q=Q*Math.cos(H)*Math.sin(W),k=Q*Math.cos(W),M=Q*Math.sin(H)*Math.sin(W);Y.isEmitterTransformNode?C.bh.TransformCoordinatesFromFloatsToRef(q,k,M,Y.emitterWorldMatrix,h.position):(h.position.Vc(q,k,M),h.position.addInPlace(Y.emitterPosition))},this.output._storedValue=c}});(0,b.e)("BABYLON.PointShapeBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("direction1",vc.bh,!0,new C.bh(0,1,0)),this.registerInput("direction2",vc.bh,!0,new C.bh(0,1,0)),this.registerOutput("output",vc.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){const c=this.particle.getConnectedValue(Y);c._directionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.direction1.getConnectedValue(Y),N=this.direction2.getConnectedValue(Y),Q=(0,w.RandomRange)(E.x,N.x),b=(0,w.RandomRange)(E.y,N.y),H=(0,w.RandomRange)(E.z,N.z);Y.isEmitterTransformNode?C.bh.TransformNormalFromFloatsToRef(Q,b,H,Y.emitterWorldMatrix,h.direction):h.direction.Vc(Q,b,H)},c._positionCreation.process=h=>{Y.systemContext=c,Y.isEmitterTransformNode?C.bh.TransformCoordinatesFromFloatsToRef(0,0,0,Y.emitterWorldMatrix,h.position):h.position.N(Y.emitterPosition)},this.output._storedValue=c}});(0,b.e)("BABYLON.CustomShapeBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("particle",vc.Particle),this.registerInput("position",vc.bh,!0,new C.bh(0,0,0)),this.registerInput("direction",vc.bh,!0,new C.bh(0,1,0)),this.registerOutput("output",vc.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){const c=this.particle.getConnectedValue(Y);c._directionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.direction.getConnectedValue(Y);Y.isEmitterTransformNode?C.bh.TransformNormalToRef(E,Y.emitterWorldMatrix,h.direction):h.direction.N(E)},c._positionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.position.getConnectedValue(Y);Y.isEmitterTransformNode?C.bh.TransformCoordinatesToRef(E,Y.emitterWorldMatrix,h.position):(h.position.N(E),h.position.addInPlace(Y.emitterPosition))},this.output._storedValue=c}});(0,b.e)("BABYLON.CylinderShapeBlock",class extends Bc{constructor(Y){super(Y),this._tempVector=C.bh.Zero(),this.registerInput("particle",vc.Particle),this.registerInput("radius",vc.Float,!0,1),this.registerInput("height",vc.Float,!0,1,0),this.registerInput("radiusRange",vc.Float,!0,1,0,1),this.registerInput("directionRandomizer",vc.Float,!0,0,0,1),this.registerOutput("output",vc.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Y){const c=this.particle.getConnectedValue(Y);c._directionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.directionRandomizer.getConnectedValue(Y);h.position.subtractToRef(Y.emitterPosition,this._tempVector),this._tempVector.normalize(),Y.isEmitterTransformNode&&C.bh.TransformNormalToRef(this._tempVector,Y.emitterInverseWorldMatrix,this._tempVector);const N=(0,w.RandomRange)(-E/2,E/2);let Q=Math.atan2(this._tempVector.x,this._tempVector.z);Q+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=N,this._tempVector.x=Math.sin(Q),this._tempVector.z=Math.cos(Q),this._tempVector.normalize(),Y.isEmitterTransformNode?C.bh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Y.emitterWorldMatrix,h.direction):h.direction.N(this._tempVector)},c._positionCreation.process=h=>{Y.particleContext=h,Y.systemContext=c;const E=this.height.getConnectedValue(Y),N=this.radiusRange.getConnectedValue(Y),Q=this.radius.getConnectedValue(Y),b=(0,w.RandomRange)(-E/2,E/2),H=(0,w.RandomRange)(0,2*Math.PI),W=(0,w.RandomRange)((1-N)*(1-N),1),q=Math.sqrt(W)*Q,k=q*Math.cos(H),M=q*Math.sin(H);Y.isEmitterTransformNode?C.bh.TransformCoordinatesFromFloatsToRef(k,b,M,Y.emitterWorldMatrix,h.position):(h.position.Vc(k,b,M),h.position.addInPlace(Y.emitterPosition))},this.output._storedValue=c}});class Hh extends Bc{constructor(Y){super(Y),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",vc.Particle),this.registerOutput("output",vc.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);const c=this.particle.getConnectedValue(Y);c._isAnimationSheetEnabled=!0,c.spriteCellWidth=this.width,c.spriteCellHeight=this.height,c.startSpriteCellID=this.start,c.endSpriteCellID=this.end,c.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=c}serialize(){const Y=super.serialize();return Y.width=this.width,Y.height=this.height,Y.start=this.start,Y.end=this.end,Y.randomStartCell=this.randomStartCell,Y}_deserialize(Y){super._deserialize(Y),this.width=Y.width,this.height=Y.height,this.start=Y.start,this.end=Y.end,this.randomStartCell=Y.randomStartCell}}(0,A.b)([tc("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"start",void 0),(0,A.b)([tc("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"end",void 0),(0,A.b)([tc("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"width",void 0),(0,A.b)([tc("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hh.prototype,"height",void 0),(0,A.b)([tc("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Hh.prototype,"loop",void 0),(0,A.b)([tc("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Hh.prototype,"randomStartCell",void 0),(0,b.e)("BABYLON.SetupSpriteSheetBlock",Hh);class wh extends Bc{constructor(Y){super(Y),this.reference=0,this.registerInput("value",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Y=>{switch(Y){case vc.Float:return vc.FloatGradient;case vc.Vector2:return vc.Vector2Gradient;case vc.bh:return vc.Vector3Gradient;case vc.vc:return vc.Color4Gradient}return Y},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vc.Float|vc.Vector2|vc.bh|vc.vc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Y=>null}serialize(){const Y=super.serialize();return Y.reference=this.reference,Y}_deserialize(Y){super._deserialize(Y),this.reference=Y.reference}}(0,A.b)([tc("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],wh.prototype,"reference",void 0),(0,b.e)("BABYLON.ParticleGradientValueBlock",wh);(0,b.e)("BABYLON.ParticleGradientBlock",class extends Bc{constructor(Y){super(Y),this._entryCount=1,this.registerInput("gradient",vc.Float,!0,1,0,1),this.registerInput("value0",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Y=>{switch(Y){case vc.FloatGradient:return vc.Float;case vc.Vector2Gradient:return vc.Vector2;case vc.Vector3Gradient:return vc.bh;case vc.Color4Gradient:return vc.vc}return Y},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(vc.FloatGradient|vc.Vector2Gradient|vc.Vector3Gradient|vc.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Y){this._inputs[Y].onConnectionObservable.add((()=>{this._entryCount>Y||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),vc.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Y=[];for(let h=1;h<this._inputs.length;h++){var c;if(this._inputs[h].isConnected)Y.push(null===(c=this._inputs[h].connectedPoint)||void 0===c?void 0:c.ownerBlock)}Y.sort(((Y,c)=>Y.reference-c.reference)),this.output._storedFunction=c=>{const h=this.gradient.getConnectedValue(c);if(1===Y.length)return Y[0].value.getConnectedValue(c);let E=null;for(let N=Y.length-1;N>=0;N--){const b=Y[N];if(b.reference<=h){const Y=b.value.getConnectedValue(c);if(E){const N=E.value.getConnectedValue(c),H=E.reference,W=b.reference,q=Math.max(0,Math.min(1,(h-W)/(H-W)));switch(this.output.type){case vc.Float:return(0,w.Lerp)(Y,N,q);case vc.Vector2:return C.Vector2.Lerp(Y,N,q);case vc.bh:return C.bh.Lerp(Y,N,q);case vc.vc:return Q.vc.Lerp(Y,N,q)}}return Y}E=b}return 0}}});(0,b.e)("BABYLON.ParticleConverterBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("color ",vc.vc,!0),this.registerInput("xyz ",vc.bh,!0),this.registerInput("xy ",vc.Vector2,!0),this.registerInput("zw ",vc.Vector2,!0),this.registerInput("x ",vc.Float,!0),this.registerInput("y ",vc.Float,!0),this.registerInput("z ",vc.Float,!0),this.registerInput("w ",vc.Float,!0),this.registerOutput("color",vc.vc),this.registerOutput("xyz",vc.bh),this.registerOutput("xy",vc.Vector2),this.registerOutput("zw",vc.Vector2),this.registerOutput("x",vc.Float),this.registerOutput("y",vc.Float),this.registerOutput("z",vc.Float),this.registerOutput("w",vc.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Y){return"color "===Y?"colorIn":"xyz "===Y?"xyzIn":"xy "===Y?"xyIn":"zw "===Y?"zwIn":"x "===Y?"xIn":"y "===Y?"yIn":"z "===Y?"zIn":"w "===Y?"wIn":Y}_outputRename(Y){switch(Y){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Y}}_build(Y){super._build(Y);const c=this.xIn,h=this.yIn,E=this.zIn,N=this.wIn,b=this.xyIn,H=this.zwIn,w=this.xyzIn,W=this.colorIn,q=this.colorOut,k=this.xyzOut,M=this.xyOut,p=this.zwOut,P=this.xOut,y=this.yOut,d=this.zOut,D=this.wOut,T=Y=>{if(W.isConnected)return W.getConnectedValue(Y);let C=0,q=0,k=0,M=0;if(c.isConnected&&(C=c.getConnectedValue(Y)),h.isConnected&&(q=h.getConnectedValue(Y)),E.isConnected&&(k=E.getConnectedValue(Y)),N.isConnected&&(M=N.getConnectedValue(Y)),b.isConnected){const c=b.getConnectedValue(Y);c&&(C=c.x,q=c.y)}if(H.isConnected){const c=H.getConnectedValue(Y);c&&(k=c.x,M=c.y)}if(w.isConnected){const c=w.getConnectedValue(Y);c&&(C=c.x,q=c.y,k=c.z)}return new Q.vc(C,q,k,M)};q._storedFunction=Y=>T(Y),k._storedFunction=Y=>{const c=T(Y);return new C.bh(c.r,c.g,c.b)},M._storedFunction=Y=>{const c=T(Y);return new C.Vector2(c.r,c.g)},p._storedFunction=Y=>{const c=T(Y);return new C.Vector2(c.b,c.a)},P._storedFunction=Y=>T(Y).r,y._storedFunction=Y=>T(Y).g,d._storedFunction=Y=>T(Y).b,D._storedFunction=Y=>T(Y).a}}),function(Y){Y[Y.Cos=0]="Cos",Y[Y.Sin=1]="Sin",Y[Y.Abs=2]="Abs",Y[Y.Exp=3]="Exp",Y[Y.Exp2=4]="Exp2",Y[Y.Round=5]="Round",Y[Y.Floor=6]="Floor",Y[Y.Ceiling=7]="Ceiling",Y[Y.Sqrt=8]="Sqrt",Y[Y.Log=9]="Log",Y[Y.Tan=10]="Tan",Y[Y.ArcTan=11]="ArcTan",Y[Y.ArcCos=12]="ArcCos",Y[Y.ArcSin=13]="ArcSin",Y[Y.Sign=14]="Sign",Y[Y.Negate=15]="Negate",Y[Y.OneMinus=16]="OneMinus",Y[Y.Reciprocal=17]="Reciprocal",Y[Y.ToDegrees=18]="ToDegrees",Y[Y.ToRadians=19]="ToRadians",Y[Y.Fract=20]="Fract"}(ic||(ic={}));class Wh extends Bc{constructor(Y){super(Y),this.operation=ic.Cos,this.registerInput("input",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(vc.Float|vc.Int|vc.Vector2|vc.bh|vc.vc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);let c=null;switch(this.operation){case ic.Cos:c=Y=>Math.cos(Y);break;case ic.Sin:c=Y=>Math.sin(Y);break;case ic.Abs:c=Y=>Math.abs(Y);break;case ic.Exp:c=Y=>Math.exp(Y);break;case ic.Exp2:c=Y=>Math.pow(2,Y);break;case ic.Round:c=Y=>Math.round(Y);break;case ic.Floor:c=Y=>Math.floor(Y);break;case ic.Ceiling:c=Y=>Math.ceil(Y);break;case ic.Sqrt:c=Y=>Math.sqrt(Y);break;case ic.Log:c=Y=>Math.log(Y);break;case ic.Tan:c=Y=>Math.tan(Y);break;case ic.ArcTan:c=Y=>Math.atan(Y);break;case ic.ArcCos:c=Y=>Math.acos(Y);break;case ic.ArcSin:c=Y=>Math.asin(Y);break;case ic.Sign:c=Y=>Math.sign(Y);break;case ic.Negate:c=Y=>-Y;break;case ic.OneMinus:c=Y=>1-Y;break;case ic.Reciprocal:c=Y=>1/Y;break;case ic.ToRadians:c=Y=>Y*Math.PI/180;break;case ic.ToDegrees:c=Y=>180*Y/Math.PI;break;case ic.Fract:c=Y=>Y>=0?Y-Math.floor(Y):Y-Math.ceil(Y)}if(!c)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case vc.Int:case vc.Float:this.output._storedFunction=Y=>{const h=this.input.getConnectedValue(Y);return c(h)};break;case vc.Vector2:this.output._storedFunction=Y=>{const h=this.input.getConnectedValue(Y);return new C.Vector2(c(h.x),c(h.y))};break;case vc.bh:this.output._storedFunction=Y=>{const h=this.input.getConnectedValue(Y);return new C.bh(c(h.x),c(h.y),c(h.z))};break;case vc.vc:this.output._storedFunction=Y=>{const h=this.input.getConnectedValue(Y);return new Q.vc(c(h.r),c(h.g),c(h.b),c(h.a))}}return this}serialize(){const Y=super.serialize();return Y.operation=this.operation,Y}_deserialize(Y){super._deserialize(Y),this.operation=Y.operation}}(0,A.b)([tc("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ic.Cos},{label:"Sin",value:ic.Sin},{label:"Abs",value:ic.Abs},{label:"Exp",value:ic.Exp},{label:"Exp2",value:ic.Exp2},{label:"Round",value:ic.Round},{label:"Floor",value:ic.Floor},{label:"Ceiling",value:ic.Ceiling},{label:"Sqrt",value:ic.Sqrt},{label:"Log",value:ic.Log},{label:"Tan",value:ic.Tan},{label:"ArcTan",value:ic.ArcTan},{label:"ArcCos",value:ic.ArcCos},{label:"ArcSin",value:ic.ArcSin},{label:"Sign",value:ic.Sign},{label:"Negate",value:ic.Negate},{label:"OneMinus",value:ic.OneMinus},{label:"Reciprocal",value:ic.Reciprocal},{label:"ToDegrees",value:ic.ToDegrees},{label:"ToRadians",value:ic.ToRadians},{label:"Fract",value:ic.Fract}]})],Wh.prototype,"operation",void 0),(0,b.e)("BABYLON.ParticleTrigonometryBlock",Wh);var qh,kh=h(14131);class Mh extends Bc{constructor(Y){super(Y),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(vc.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(vc.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(vc.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(vc.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(vc.System),this._inputs[0].excludedConnectionPointTypes.push(vc.Particle),this._inputs[0].excludedConnectionPointTypes.push(vc.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const c=Y=>{const c=this.input.getConnectedValue(Y);if(this.log.length>=this.stackSize)return c;if(null===c||void 0===c)return this.log.push(["null",""]),c;switch(this.input.type){case vc.Vector2:this.log.push([(0,kh.g)(c,4),c.toString()]);break;case vc.bh:this.log.push([(0,kh.k)(c,4),c.toString()]);break;case vc.vc:this.log.push([`{R: ${c.r.toFixed(4)} G: ${c.g.toFixed(4)} B: ${c.b.toFixed(4)} A: ${c.a.toFixed(4)}}`,c.toString()]);break;default:this.log.push([c.toString(),c.toString()])}return c};this.output.isConnected?this.output._storedFunction=c:this.output._storedValue=c(Y)}serialize(){const Y=super.serialize();return Y.stackSize=this.stackSize,Y}_deserialize(Y){super._deserialize(Y),this.stackSize=Y.stackSize}}(0,A.b)([tc("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Mh.prototype,"stackSize",void 0),(0,b.e)("BABYLON.ParticleDebugBlock",Mh);(0,b.e)("BABYLON.ParticleElbowBlock",class extends Bc{constructor(Y){super(Y),this.registerInput("input",vc.AutoDetect),this.registerOutput("output",vc.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Y){super._build(Y);const c=this._outputs[0],h=this._inputs[0];c._storedFunction=Y=>h.getConnectedValue(Y)}});(0,b.e)("BABYLON.ParticleTeleportInBlock",class extends Bc{get endpoints(){return this._endpoints}constructor(Y){super(Y),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",vc.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Y){if(this.getClassName()===Y)return!0;for(const c of this.endpoints)if(c.isAnAncestorOfType(Y))return!0;return!1}isAnAncestorOf(Y){for(const c of this.endpoints){if(c===Y)return!0;if(c.isAnAncestorOf(Y))return!0}return!1}attachToEndpoint(Y){Y.detach(),this._endpoints.push(Y),Y._entryPoint=this,Y._outputs[0]._typeConnectionSource=this._inputs[0],Y._tempEntryPointUniqueId=null,Y.name="> "+this.name}detachFromEndpoint(Y){const c=this._endpoints.indexOf(Y);-1!==c&&(this._endpoints.splice(c,1),Y._outputs[0]._typeConnectionSource=null,Y._entryPoint=null)}_build(){for(const Y of this._endpoints)Y.output._storedFunction=Y=>this.input.getConnectedValue(Y)}});(0,b.e)("BABYLON.ParticleTeleportOutBlock",class extends Bc{constructor(Y){super(Y),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",vc.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Y){this.entryPoint&&this.entryPoint.build(Y)}clone(){const Y=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Y),Y}serialize(){var Y;const c=super.serialize();return c.entryPoint=(null===(Y=this.entryPoint)||void 0===Y?void 0:Y.uniqueId)??"",c}_deserialize(Y){super._deserialize(Y),this._tempEntryPointUniqueId=Y.entryPoint}}),function(Y){Y[Y.Equal=0]="Equal",Y[Y.NotEqual=1]="NotEqual",Y[Y.LessThan=2]="LessThan",Y[Y.GreaterThan=3]="GreaterThan",Y[Y.LessOrEqual=4]="LessOrEqual",Y[Y.GreaterOrEqual=5]="GreaterOrEqual",Y[Y.Xor=6]="Xor",Y[Y.Or=7]="Or",Y[Y.And=8]="And"}(qh||(qh={}));class ph extends Bc{constructor(Y){super(Y),this.test=qh.Equal,this.epsilon=0,this.registerInput("left",vc.Float),this.registerInput("right",vc.Float,!0,0),this.registerInput("ifTrue",vc.AutoDetect,!0,1),this.registerInput("ifFalse",vc.AutoDetect,!0,0),this.registerOutput("output",vc.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=vc.Float,this._inputs[0].acceptedConnectionPointTypes.push(vc.Int),this._inputs[1].acceptedConnectionPointTypes.push(vc.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Y=Y=>{const c=this.left.getConnectedValue(Y),h=this.right.getConnectedValue(Y);let C=!1;switch(this.test){case qh.Equal:C=(0,w.WithinEpsilon)(c,h,this.epsilon);break;case qh.NotEqual:C=!(0,w.WithinEpsilon)(c,h,this.epsilon);break;case qh.LessThan:C=c<h+this.epsilon;break;case qh.GreaterThan:C=c>h-this.epsilon;break;case qh.LessOrEqual:C=c<=h+this.epsilon;break;case qh.GreaterOrEqual:C=c>=h-this.epsilon;break;case qh.Xor:C=!!c&&!h||!c&&!!h;break;case qh.Or:C=!!c||!!h;break;case qh.And:C=!!c&&!!h}return C};this.output._storedFunction=c=>Y(c)?this.ifTrue.getConnectedValue(c):this.ifFalse.getConnectedValue(c)}serialize(){const Y=super.serialize();return Y.test=this.test,Y.epsilon=this.epsilon,Y}_deserialize(Y){super._deserialize(Y),this.test=Y.test,void 0!==Y.epsilon&&(this.epsilon=Y.epsilon)}}(0,A.b)([tc("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:qh.Equal},{label:"NotEqual",value:qh.NotEqual},{label:"LessThan",value:qh.LessThan},{label:"GreaterThan",value:qh.GreaterThan},{label:"LessOrEqual",value:qh.LessOrEqual},{label:"GreaterOrEqual",value:qh.GreaterOrEqual},{label:"Xor",value:qh.Xor},{label:"Or",value:qh.Or},{label:"And",value:qh.And}]})],ph.prototype,"test",void 0),(0,A.b)([tc("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ph.prototype,"epsilon",void 0),(0,b.e)("BABYLON.ParticleConditionBlock",ph);class Ph extends Bc{constructor(Y){super(Y),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",vc.Particle),this.registerInput("condition",vc.Float,!0,0),this.registerInput("system",vc.System),this.registerOutput("output",vc.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Y){this._triggerCount=0;const c=this.input.getConnectedValue(Y),h={process:h=>{if(Y.particleContext=h,Y.systemContext=c,0!==this.condition.getConnectedValue(Y)&&(0===this.limit||this._triggerCount<this.limit)){const C=(new Date).getTime();if(this._previousOne&&C-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=C;const E=this.system.getConnectedValue(Y);if(E){const C=Jc(E,Y.wh,h.position);C.Mc.addOnce((()=>{this._triggerCount--})),c.Mc.addOnce((()=>{C.dispose()}))}}},previousItem:null,nextItem:null};c._updateQueueStart?fY(h,c._updateQueueStart):c._updateQueueStart=h,this.output._storedValue=c}serialize(){const Y=super.serialize();return Y.limit=this.limit,Y.delay=this.delay,Y}_deserialize(Y){super._deserialize(Y),void 0!==Y.limit&&(this.limit=Y.limit),void 0!==Y.delay&&(this.delay=Y.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,A.b)([tc("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ph.prototype,"limit",void 0),(0,A.b)([tc("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Ph.prototype,"delay",void 0),(0,b.e)("BABYLON.ParticleTriggerBlock",Ph);h(14140),h(14153),h(14167),h(14223)},14200:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14169:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14237:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14226:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14214:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14195:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14239:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogVertex",N="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14230:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14184:(Y,c,h)=>{"use strict";var C=h(12779);const E="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14172:(Y,c,h)=>{"use strict";var C=h(12779);const E="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14191:(Y,c,h)=>{"use strict";var C=h(12779);const E="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14179:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14206:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14245:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";C.b.IncludesShadersStoreWGSL[E]||(C.b.IncludesShadersStoreWGSL[E]=N)},14167:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{particlesPixelShaderWGSL:()=>Q});var C=h(12779);h(14169),h(14172),h(14179),h(14184),h(14191),h(14195),h(14200),h(14206),h(14214);const E="particlesPixelShader",N="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.b.ShadersStoreWGSL[E]||(C.b.ShadersStoreWGSL[E]=N);const Q={name:E,shader:N}},14223:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{particlesVertexShaderWGSL:()=>Q});var C=h(12779);h(14226),h(14230),h(14179),h(14237),h(14239),h(14245);const E="particlesVertexShader",N="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.b.ShadersStoreWGSL[E]||(C.b.ShadersStoreWGSL[E]=N);const Q={name:E,shader:N}},14075:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14147:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14089:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14158:(Y,c,h)=>{"use strict";var C=h(12779);const E="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14082:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14069:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14095:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14086:(Y,c,h)=>{"use strict";var C=h(12779);const E="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14059:(Y,c,h)=>{"use strict";var C=h(12779);const E="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14046:(Y,c,h)=>{"use strict";var C=h(12779);const E="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14061:(Y,c,h)=>{"use strict";var C=h(12779);const E="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14051:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14077:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14103:(Y,c,h)=>{"use strict";var C=h(12779);const E="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";C.b.IncludesShadersStore[E]||(C.b.IncludesShadersStore[E]=N)},14140:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{particlesPixelShader:()=>Q});var C=h(12779);h(14147),h(14046),h(14051),h(14059),h(14061),h(14069),h(14075),h(14077),h(14082);const E="particlesPixelShader",N="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.b.ShadersStore[E]||(C.b.ShadersStore[E]=N);const Q={name:E,shader:N}},14153:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{particlesVertexShader:()=>Q});var C=h(12779);h(14158),h(14086),h(14051),h(14089),h(14095),h(14103);const E="particlesVertexShader",N="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.b.ShadersStore[E]||(C.b.ShadersStore[E]=N);const Q={name:E,shader:N}},14512:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{FlowGraphGLTFDataProvider:()=>N});var C=h(14482),E=h(14459);class N extends C.b{constructor(Y){var c,h;super();const C=Y.glTF,N=(null===(c=C.animations)||void 0===c?void 0:c.map((Y=>Y._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.c,N);const Q=(null===(h=C.nodes)||void 0===h?void 0:h.map((Y=>Y._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.c,Q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14402:(Y,c,h)=>{"use strict";h.d(c,{e:()=>y,g:()=>p,k:()=>M,o:()=>P});var C=h(12869),E=h(13349),N=h(12920),Q=h(14409);const b=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class H{constructor(Y,c){this._gltf=Y,this._infoTree=c}convert(Y){let c,h=this._gltf,C=this._infoTree;if(!Y.startsWith("/"))throw new Error("Path must start with a /");const E=Y.split("/");if(E.shift(),E[E.length-1].includes(".length")){const Y=E[E.length-1].split(".");E.pop(),E.push(...Y)}let N=!1;for(const H of E){const E="length"===H;if(E&&!C.__array__)throw new Error(`Path ${Y} is invalid`);if(C.__ignoreObjectTree__&&(N=!0),C.__array__&&!E)C=C.__array__;else if(C=C[H],!C)throw new Error(`Path ${Y} is invalid`);if(!N)if(void 0===h){if(!b.find((c=>c.regex.test(Y))))throw new Error(`Path ${Y} is invalid`)}else if(!E){var Q;h=null===(Q=h)||void 0===Q?void 0:Q[H]}(C.__target__||E)&&(c=h)}return{object:c,info:C}}}function w(Y,c,h,C){const E=W(Y,c);return C?E[h][C]:E[h]}function W(Y,c,h){var C,N;return null===(C=Y._data)||void 0===C||null===(N=C[(null===h||void 0===h?void 0:h.fillMode)??E.e.MATERIAL_TriangleFillMode])||void 0===N?void 0:N.babylonMaterial}function q(Y,c){return{offset:{componentsCount:2,type:"Vector2",get:(h,E,N)=>{const Q=w(h,N,Y,c);return new C.Vector2(null===Q||void 0===Q?void 0:Q.uOffset,null===Q||void 0===Q?void 0:Q.vOffset)},getTarget:W,set:(h,C,E,N)=>{const Q=w(C,N,Y,c);Q.uOffset=h.x,Q.vOffset=h.y},getPropertyName:[()=>`${Y}${c?"."+c:""}.uOffset`,()=>`${Y}${c?"."+c:""}.vOffset`]},rotation:{type:"number",get:(h,C,E)=>{var N;return null===(N=w(h,E,Y,c))||void 0===N?void 0:N.wAng},getTarget:W,set:(h,C,E,N)=>w(C,N,Y,c).wAng=h,getPropertyName:[()=>`${Y}${c?"."+c:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(h,E,N)=>{const Q=w(h,N,Y,c);return new C.Vector2(null===Q||void 0===Q?void 0:Q.uScale,null===Q||void 0===Q?void 0:Q.vScale)},getTarget:W,set:(h,C,E,N)=>{const Q=w(C,N,Y,c);Q.uScale=h.x,Q.vScale=h.y},getPropertyName:[()=>`${Y}${c?"."+c:""}.uScale`,()=>`${Y}${c?"."+c:""}.vScale`]}}}const k={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Y=>{var c,h;return new C.Vector2((null===(c=Y._babylonCamera)||void 0===c?void 0:c.orthoLeft)??0,(null===(h=Y._babylonCamera)||void 0===h?void 0:h.orthoRight)??0)},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.orthoLeft=Y.x,c._babylonCamera.orthoRight=Y.y)},getTarget:Y=>Y,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Y=>{var c,h;return new C.Vector2((null===(c=Y._babylonCamera)||void 0===c?void 0:c.orthoBottom)??0,(null===(h=Y._babylonCamera)||void 0===h?void 0:h.orthoTop)??0)},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.orthoBottom=Y.x,c._babylonCamera.orthoTop=Y.y)},getTarget:Y=>Y,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.maxZ},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=Y)},getTarget:Y=>Y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.ac},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.ac=Y)},getTarget:Y=>Y,getPropertyName:[()=>"ac"]}},perspective:{aspectRatio:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.getEngine().getAspectRatio(Y._babylonCamera)},getTarget:Y=>Y,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.fov},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.fov=Y)},getTarget:Y=>Y,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.maxZ},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.maxZ=Y)},getTarget:Y=>Y,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Y=>{var c;return null===(c=Y._babylonCamera)||void 0===c?void 0:c.ac},set:(Y,c)=>{c._babylonCamera&&(c._babylonCamera.ac=Y)},getTarget:Y=>Y,getPropertyName:[()=>"ac"]}}}},nodes:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"bh",get:Y=>{var c;return null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.position},set:(Y,c)=>{var h;return null===(h=c._babylonTransformNode)||void 0===h?void 0:h.position.N(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Y=>{var c;return null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.rotationQuaternion},set:(Y,c)=>{var h,C;return null===(h=c._babylonTransformNode)||void 0===h||null===(C=h.rotationQuaternion)||void 0===C?void 0:C.N(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"bh",get:Y=>{var c;return null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.lc},set:(Y,c)=>{var h;return null===(h=c._babylonTransformNode)||void 0===h?void 0:h.lc.N(Y)},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"lc"]},weights:{length:{type:"number",get:Y=>Y._numMorphTargets,getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Y,c)=>{var h,C;return void 0!==c?null===(h=Y._primitiveBabylonMeshes)||void 0===h||null===(C=h[0].morphTargetManager)||void 0===C?void 0:C.getTarget(c).influence:void 0},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Y,c)=>[0],getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Y=>{var c,h,E;return C.Matrix.Compose(null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.lc,null===(h=Y._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion,null===(E=Y._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:Y=>Y._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Y=>{var c,h,E,N;const Q=C.Matrix.Identity();let b=Y.parent;for(;b&&b.parent;)b=b.parent;const H=(null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.position._isDirty)||(null===(h=Y._babylonTransformNode)||void 0===h||null===(E=h.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(N=Y._babylonTransformNode)||void 0===N?void 0:N.lc._isDirty);if(b){var w;const c=null===(w=b._babylonTransformNode)||void 0===w?void 0:w.Kc(!0).invert();var W,q;if(c)null===(W=Y._babylonTransformNode)||void 0===W||null===(q=W.Kc(H))||void 0===q||q.multiplyToRef(c,Q)}else Y._babylonTransformNode&&Q.N(Y._babylonTransformNode.Kc(H));return Q},getTarget:Y=>Y._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Y=>{var c,h;return null===(c=Y._babylonTransformNode)||void 0===c||null===(h=c.getChildren((Y=>Y instanceof Q.e),!0)[0])||void 0===h?void 0:h.Oc},getTarget:Y=>{var c;return null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.getChildren((Y=>Y instanceof Q.e),!0)[0]},set:(Y,c)=>{if(c._babylonTransformNode){const h=c._babylonTransformNode.getChildren((Y=>Y instanceof Q.e),!0)[0];h&&(h.Oc=Y)}}},color:{type:"ph",get:Y=>{var c,h;return null===(c=Y._babylonTransformNode)||void 0===c||null===(h=c.getChildren((Y=>Y instanceof Q.e),!0)[0])||void 0===h?void 0:h.oc},getTarget:Y=>{var c;return null===(c=Y._babylonTransformNode)||void 0===c?void 0:c.getChildren((Y=>Y instanceof Q.e),!0)[0]},set:(Y,c)=>{if(c._babylonTransformNode){const h=c._babylonTransformNode.getChildren((Y=>Y instanceof Q.e),!0)[0];h&&(h.oc=Y)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"ph",get:(Y,c,h)=>W(Y,c,h).emissiveColor,set:(Y,c,h,C)=>W(c,h,C).emissiveColor.N(Y),getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Y,c,h)=>{var C;return null===(C=w(Y,h,"bumpTexture"))||void 0===C?void 0:C.level},set:(Y,c,h,C)=>{const E=w(c,C,"bumpTexture");E&&(E.level=Y)},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Y,c,h)=>W(Y,c,h).ambientTextureStrength,set:(Y,c,h,C)=>{const E=W(c,h,C);E&&(E.ambientTextureStrength=Y)},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"vc",get:(Y,c,h)=>{const C=W(Y,c,h);return N.vc.FromColor3(C.albedoColor,C.alpha)},set:(Y,c,h,C)=>{const E=W(c,h,C);E.albedoColor.set(Y.r,Y.g,Y.b),E.alpha=Y.a},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:q("albedoTexture")}},metallicFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).metallic,set:(Y,c,h,C)=>{const E=W(c,h,C);E&&(E.metallic=Y)},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).roughness,set:(Y,c,h,C)=>{const E=W(c,h,C);E&&(E.roughness=Y)},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Y,c,h)=>W(Y,c,h).anisotropy.Oc,set:(Y,c,h,C)=>{W(c,h,C).anisotropy.Oc=Y},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Y,c,h)=>W(Y,c,h).anisotropy.angle,set:(Y,c,h,C)=>{W(c,h,C).anisotropy.angle=Y},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).clearCoat.Oc,set:(Y,c,h,C)=>{W(c,h,C).clearCoat.Oc=Y},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).clearCoat.roughness,set:(Y,c,h,C)=>{W(c,h,C).clearCoat.roughness=Y},getTarget:(Y,c,h)=>W(Y,c,h),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Y,c,h)=>{var C;return null===(C=W(Y,c,h).clearCoat.bumpTexture)||void 0===C?void 0:C.level},getTarget:W,set:(Y,c,h,C)=>W(c,h,C).clearCoat.bumpTexture.level=Y},extensions:{KHR_texture_transform:q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Y,c,h)=>W(Y,c,h).subSurface.dispersion,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.dispersion=Y}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Y,c,h)=>W(Y,c,h).emissiveIntensity,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).emissiveIntensity=Y}},KHR_materials_ior:{ior:{type:"number",get:(Y,c,h)=>W(Y,c,h).indexOfRefraction,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).indexOfRefraction=Y}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).iridescence.Oc,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).iridescence.Oc=Y},iridescenceIor:{type:"number",get:(Y,c,h)=>W(Y,c,h).iridescence.indexOfRefraction,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).iridescence.indexOfRefraction=Y},iridescenceTexture:{extensions:{KHR_texture_transform:q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Y,c,h)=>W(Y,c,h).iridescence.maximumThickness,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).iridescence.maximumThickness=Y},iridescenceThicknessMinimum:{type:"number",get:(Y,c,h)=>W(Y,c,h).iridescence.minimumThickness,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).iridescence.minimumThickness=Y},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"ph",get:(Y,c,h)=>W(Y,c,h).sheen.color,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).sheen.color.N(Y)},sheenColorTexture:{extensions:{KHR_texture_transform:q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).sheen.Oc,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).sheen.Oc=Y},sheenRoughnessTexture:{extensions:{KHR_texture_transform:q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).metallicF0Factor,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).metallicF0Factor=Y,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"ph",get:(Y,c,h)=>W(Y,c,h).metallicReflectanceColor,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).metallicReflectanceColor.N(Y),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).subSurface.refractionIntensity,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.refractionIntensity=Y,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).subSurface.translucencyIntensity,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.translucencyIntensity=Y},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"ph",get:(Y,c,h)=>W(Y,c,h).subSurface.translucencyColor,getTarget:W,set:(Y,c,h,C)=>{var E;return Y&&(null===(E=W(c,h,C).subSurface.translucencyColor)||void 0===E?void 0:E.N(Y))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"ph",get:(Y,c,h)=>W(Y,c,h).subSurface.tintColor,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.tintColor.N(Y)},attenuationDistance:{type:"number",get:(Y,c,h)=>W(Y,c,h).subSurface.tintColorAtDistance,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.tintColorAtDistance=Y},thicknessFactor:{type:"number",get:(Y,c,h)=>W(Y,c,h).subSurface.maximumThickness,getTarget:W,set:(Y,c,h,C)=>W(c,h,C).subSurface.maximumThickness=Y},thicknessTexture:{extensions:{KHR_texture_transform:q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonLight)),getPropertyName:[Y=>"length"]},__array__:{__target__:!0,color:{type:"ph",get:Y=>{var c;return null===(c=Y._babylonLight)||void 0===c?void 0:c.oc},set:(Y,c)=>{var h;return null===(h=c._babylonLight)||void 0===h?void 0:h.oc.N(Y)},getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"diffuse"]},Oc:{type:"number",get:Y=>{var c;return null===(c=Y._babylonLight)||void 0===c?void 0:c.Oc},set:(Y,c)=>c._babylonLight?c._babylonLight.Oc=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"intensity"]},range:{type:"number",get:Y=>{var c;return null===(c=Y._babylonLight)||void 0===c?void 0:c.range},set:(Y,c)=>c._babylonLight?c._babylonLight.range=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"range"]},spot:{innerConeAngle:{type:"number",get:Y=>{var c;return null===(c=Y._babylonLight)||void 0===c?void 0:c.innerAngle},set:(Y,c)=>c._babylonLight?c._babylonLight.innerAngle=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Y=>{var c;return null===(c=Y._babylonLight)||void 0===c?void 0:c.angle},set:(Y,c)=>c._babylonLight?c._babylonLight.angle=Y:void 0,getTarget:Y=>Y._babylonLight,getPropertyName:[Y=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonLight)),getPropertyName:[Y=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonTexture)),getPropertyName:[Y=>"length"]},__array__:{__target__:!0,Oc:{type:"number",get:Y=>{var c;return null===(c=Y._babylonTexture)||void 0===c?void 0:c.level},set:(Y,c)=>{c._babylonTexture&&(c._babylonTexture.level=Y)},getTarget:Y=>Y._babylonTexture},rotation:{type:"Quaternion",get:Y=>{var c;return Y._babylonTexture&&C.Quaternion.FromRotationMatrix(null===(c=Y._babylonTexture)||void 0===c?void 0:c.getReflectionTextureMatrix())},set:(Y,c)=>{var h;c._babylonTexture&&(null!==(h=c._babylonTexture.ZY())&&void 0!==h&&h.useRightHandedSystem||(Y=C.Quaternion.Inverse(Y)),C.Matrix.FromQuaternionToRef(Y,c._babylonTexture.getReflectionTextureMatrix()))},getTarget:Y=>Y._babylonTexture}}}}},animations:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>Y._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Y=>Y.length,getTarget:Y=>Y.map((Y=>{var c;return null===(c=Y.primitives[0]._instanceData)||void 0===c?void 0:c.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function M(Y){return new H(Y,k)}function p(Y){const c=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let h=k;for(const C of c)C&&(h=h[C]);if(h&&h.type&&h.get)return h}function P(Y,c){const h=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let C=k;for(const E of h)E&&(C=C[E]);C&&C.type&&C.get&&(C.interpolation=c)}function y(Y,c){const h=Y.split("/").map((Y=>Y.replace(/{}/g,"__array__")));let C=k;for(const E of h)if(E){if(!C[E]){if("?"===E){C.__ignoreObjectTree__=!0;continue}C[E]={},"__array__"===E&&(C[E].__target__=!0)}C=C[E]}Object.assign(C,c)}},14413:(Y,c,h)=>{"use strict";h.r(c),h.d(c,{AnimationPropertyInfo:()=>w,TransformNodeAnimationPropertyInfo:()=>W,WeightAnimationPropertyInfo:()=>q,getQuaternion:()=>b,getVector3:()=>Q,getWeights:()=>H});var C=h(13395),E=h(12869),N=h(14402);function Q(Y,c,h,C){return E.bh.dh(c,h).scaleInPlace(C)}function b(Y,c,h,C){return E.Quaternion.dh(c,h).scaleInPlace(C)}function H(Y,c,h,C){const E=new Array(Y._numMorphTargets);for(let N=0;N<E.length;N++)E[N]=c[h++]*C;return E}class w{constructor(Y,c,h,C){this.type=Y,this.name=c,this.getValue=h,this.getStride=C}_buildAnimation(Y,c,h){const E=new C.d(Y,this.name,c,this.type);return E.setKeys(h),E}}class W extends w{buildAnimations(Y,c,h,C){const E=[];return E.push({babylonAnimatable:Y._babylonTransformNode,babylonAnimation:this._buildAnimation(c,h,C)}),E}}class q extends w{buildAnimations(Y,c,h,E){const N=[];if(Y._numMorphTargets)for(let Q=0;Q<Y._numMorphTargets;Q++){const b=new C.d(`${c}_${Q}`,this.name,h,this.type);if(b.setKeys(E.map((Y=>({frame:Y.frame,inTangent:Y.inTangent?Y.inTangent[Q]:void 0,value:Y.value[Q],outTangent:Y.outTangent?Y.outTangent[Q]:void 0,interpolation:Y.interpolation})))),Y._primitiveBabylonMeshes)for(const c of Y._primitiveBabylonMeshes)if(c.morphTargetManager){const Y=c.morphTargetManager.getTarget(Q),h=b.clone();Y.animations.push(h),N.push({babylonAnimatable:Y,babylonAnimation:h})}}return N}}(0,N.o)("/nodes/{}/translation",[new W(C.d.ANIMATIONTYPE_VECTOR3,"position",Q,(()=>3))]),(0,N.o)("/nodes/{}/rotation",[new W(C.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",b,(()=>4))]),(0,N.o)("/nodes/{}/scale",[new W(C.d.ANIMATIONTYPE_VECTOR3,"lc",Q,(()=>3))]),(0,N.o)("/nodes/{}/weights",[new q(C.d.ANIMATIONTYPE_FLOAT,"influence",H,(Y=>Y._numMorphTargets))])},14365:(Y,c,h)=>{"use strict";class C{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Y,c)=>{this._resolve=Y,this._reject=c}))}}var E=h(12869),N=h(12920),Q=h(12687),b=h(13329),H=h(14369),w=h(14382),W=h(12690),q=h(13346),k=h(13395),M=h(13404),p=h(12722),P=h(12700),y=h(12707);class d{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Y){this._useTextureToStoreBoneMatrices=Y,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Y){this._animationPropertiesOverride=Y}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Y,c,h){this.name=Y,this.id=c,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new W.c,this.bones=[],this._scene=h||p.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const C=this._scene.getEngine().getCaps();this._canUseTextureForBones=C.textureFloat&&C.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Y=>!Y.getParent()))}getTransformMatrices(Y){if(this.needInitialSkinMatrix){if(!Y)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Y._bonesTransformMatrices||this.prepare(!0),Y._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Y){return this.needInitialSkinMatrix&&Y._transformMatrixTexture?Y._transformMatrixTexture:this._transformMatrixTexture}ZY(){return this._scene}toString(Y){let c=`Name: ${this.name}, nBones: ${this.bones.length}`;if(c+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Y){c+=", Ranges: {";let Y=!0;for(const h in this._ranges)Y&&(c+=", ",Y=!1),c+=h;c+="}"}return c}getBoneIndexByName(Y){for(let c=0,h=this.bones.length;c<h;c++)if(this.bones[c].name===Y)return c;return-1}createAnimationRange(Y,c,h){if(!this._ranges[Y]){this._ranges[Y]=new M.c(Y,c,h);for(let C=0,E=this.bones.length;C<E;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].createRange(Y,c,h)}}deleteAnimationRange(Y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let h=0,C=this.bones.length;h<C;h++)this.bones[h].animations[0]&&this.bones[h].animations[0].deleteRange(Y,c);this._ranges[Y]=null}getAnimationRange(Y){return this._ranges[Y]||null}getAnimationRanges(){const Y=[];let c;for(c in this._ranges)Y.push(this._ranges[c]);return Y}copyAnimationRange(Y,c){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[c]||!Y.getAnimationRange(c))return!1;let C=!0;const E=this._getHighestAnimationFrame()+1,N={},Q=Y.bones;let b,H;for(H=0,b=Q.length;H<b;H++)N[Q[H].name]=Q[H];this.bones.length!==Q.length&&(P.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Q.length}`),C=!1);const w=h&&this.dimensionsAtRest&&Y.dimensionsAtRest?this.dimensionsAtRest.divide(Y.dimensionsAtRest):null;for(H=0,b=this.bones.length;H<b;H++){const Y=this.bones[H].name,Q=N[Y];Q?C=C&&this.bones[H].copyAnimationRange(Q,c,E,h,w):(P.e.Warn("copyAnimationRange: not same rig, missing source bone "+Y),C=!1)}const W=Y.getAnimationRange(c);return W&&(this._ranges[c]=new M.c(c,W.from+E,W.to+E)),C}returnToRest(){for(const Y of this.bones)-1!==Y._index&&Y.returnToRest()}_getHighestAnimationFrame(){let Y=0;for(let c=0,h=this.bones.length;c<h;c++)if(this.bones[c].animations[0]){const h=this.bones[c].animations[0].getHighestFrame();Y<h&&(Y=h)}return Y}beginAnimation(Y,c,h,C){const E=this.getAnimationRange(Y);return E?this._scene.beginAnimation(this,E.from,E.to,c,h,C):null}static MakeAnimationAdditive(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0;const C=Y.getAnimationRange(h);if(!C)return null;const E=Y._scene.getAllAnimatablesByTarget(Y);let N=null;for(let b=0;b<E.length;b++){const Y=E[b];if(Y.fromFrame===(null===C||void 0===C?void 0:C.from)&&Y.toFrame===(null===C||void 0===C?void 0:C.to)){N=Y;break}}const Q=Y.getAnimatables();for(let b=0;b<Q.length;b++){const Y=Q[b].animations;if(Y)for(let C=0;C<Y.length;C++)k.d.MakeAnimationAdditive(Y[C],c,h)}return N&&(N.isAdditive=!0),Y}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Y){this._meshesWithPoseMatrix.push(Y)}_unregisterMeshWithPoseMatrix(Y){const c=this._meshesWithPoseMatrix.indexOf(Y);c>-1&&this._meshesWithPoseMatrix.splice(c,1)}_computeTransformMatrices(Y,c){this.onBeforeComputeObservable.notifyObservers(this);for(let h=0;h<this.bones.length;h++){const C=this.bones[h];C._childUpdateId++;const E=C.getParent();if(E?C.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),C.getFinalMatrix()):c?C.getLocalMatrix().multiplyToRef(c,C.getFinalMatrix()):C.getFinalMatrix().N(C.getLocalMatrix()),-1!==C._index){const c=null===C._index?h:C._index;C.getAbsoluteInverseBindMatrix().multiplyToArray(C.getFinalMatrix(),Y,16*c)}}this._identity.copyToArray(Y,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Y=this.ZY().getRenderId();if(this._currentRenderId===Y)return;this._currentRenderId=Y}if(this._numBonesWithLinkedTransformNode>0)for(const Y of this.bones)if(Y._linkedTransformNode){const c=Y._linkedTransformNode;Y.position=c.position,c.rotationQuaternion?Y.rotationQuaternion=c.rotationQuaternion:Y.rotation=c.rotation,Y.lc=c.lc}if(this.needInitialSkinMatrix)for(const Y of this._meshesWithPoseMatrix){const c=Y.getPoseMatrix();let h=this._isDirty;if(Y._bonesTransformMatrices&&Y._bonesTransformMatrices.length===16*(this.bones.length+1)||(Y._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),h=!0),h){if(this._synchronizedWithMesh!==Y){this._synchronizedWithMesh=Y;for(const Y of this.bones)if(!Y.getParent()){Y.getBindMatrix().multiplyToRef(c,E.TmpVectors.Matrix[1]),Y._updateAbsoluteBindMatrices(E.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const c=4*(this.bones.length+1);Y._transformMatrixTexture&&Y._transformMatrixTexture.getSize().width===c||(Y._transformMatrixTexture&&Y._transformMatrixTexture.dispose(),Y._transformMatrixTexture=q.b.CreateRGBATexture(Y._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Y._bonesTransformMatrices,c),this.isUsingTextureForMatrices&&Y._transformMatrixTexture&&Y._transformMatrixTexture.update(Y._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=q.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Y=0;Y<this.bones.length;Y++)this._animatables.push(this.bones[Y])}return this._animatables}clone(Y,c){const h=new d(Y,c||Y,this._scene);h.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){const Y=this.bones[C];let c=null;const E=Y.getParent();if(E){const Y=this.bones.indexOf(E);c=h.bones[Y]}const N=new w.d(Y.name,h,c,Y.getBindMatrix().clone(),Y.getRestMatrix().clone());N._index=Y._index,Y._linkedTransformNode&&N.linkTransformNode(Y._linkedTransformNode),y.b.DeepCopy(Y.animations,N.animations)}if(this._ranges){h._ranges={};for(const Y in this._ranges){const c=this._ranges[Y];c&&(h._ranges[Y]=c.clone())}}return this._isDirty=!0,h.prepare(!0),h}enableBlending(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const c of this.bones)for(const h of c.animations)h.enableBlending=!0,h.blendingSpeed=Y}dispose(){if(this._meshesWithPoseMatrix.length=0,this.ZY().stopAnimation(this),this.ZY().removeSkeleton(this),this._parentContainer){const Y=this._parentContainer.skeletons.indexOf(this);Y>-1&&this._parentContainer.skeletons.splice(Y,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Y={};Y.name=this.name,Y.id=this.id,this.dimensionsAtRest&&(Y.dimensionsAtRest=this.dimensionsAtRest.Xc()),Y.bones=[],Y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let h=0;h<this.bones.length;h++){var c;const C=this.bones[h],E=C.getParent(),N={parentBoneIndex:E?this.bones.indexOf(E):-1,index:C.getIndex(),name:C.name,id:C.id,matrix:C.getBindMatrix().Xc(),rest:C.getRestMatrix().Xc(),linkedTransformNodeId:null===(c=C.getTransformNode())||void 0===c?void 0:c.id};Y.bones.push(N),C.length&&(N.length=C.length),C.metadata&&(N.metadata=C.metadata),C.animations&&C.animations.length>0&&(N.animation=C.animations[0].serialize()),Y.ranges=[];for(const c in this._ranges){const h=this._ranges[c];if(!h)continue;const C={};C.name=c,C.from=h.from,C.to=h.to,Y.ranges.push(C)}}return Y}static Parse(Y,c){const h=new d(Y.name,Y.id,c);let C;for(Y.dimensionsAtRest&&(h.dimensionsAtRest=E.bh.dh(Y.dimensionsAtRest)),h.needInitialSkinMatrix=Y.needInitialSkinMatrix,C=0;C<Y.bones.length;C++){const c=Y.bones[C],N=Y.bones[C].index;let Q=null;c.parentBoneIndex>-1&&(Q=h.bones[c.parentBoneIndex]);const b=c.rest?E.Matrix.dh(c.rest):null,H=new w.d(c.name,h,Q,E.Matrix.dh(c.matrix),b,null,N);void 0!==c.id&&null!==c.id&&(H.id=c.id),c.length&&(H.length=c.length),c.metadata&&(H.metadata=c.metadata),c.animation&&H.animations.push(k.d.Parse(c.animation)),void 0!==c.linkedTransformNodeId&&null!==c.linkedTransformNodeId&&(h._hasWaitingData=!0,H._waitingTransformNodeId=c.linkedTransformNodeId)}if(Y.ranges)for(C=0;C<Y.ranges.length;C++){const c=Y.ranges[C];h.createAnimationRange(c.name,c.from,c.to)}return h}computeAbsoluteMatrices(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Y)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Y)}getPoseMatrix(){let Y=null;return this._meshesWithPoseMatrix.length>0&&(Y=this._meshesWithPoseMatrix[0].getPoseMatrix()),Y}sortBones(){const Y=[],c=new Array(this.bones.length);for(let h=0;h<this.bones.length;h++)this._sortBones(h,Y,c);this.bones=Y}_sortBones(Y,c,h){if(h[Y])return;h[Y]=!0;const C=this.bones[Y];if(!C)return;void 0===C._index&&(C._index=Y);const E=C.getParent();E&&this._sortBones(this.bones.indexOf(E),c,h),c.push(C)}setCurrentPoseAsRest(){for(const Y of this.bones)Y.setCurrentPoseAsRest()}}var D=h(13193),T=h(13356),e=h(12848),r=h(13289),X=h(12951),Z=h(13333),a=h(13303),G=h(13321),K=h(13413),I=h(12975),s=h(14327);class x{set areUpdatesFrozen(Y){Y?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new I.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Y||(Y=p.d.LastCreatedScene),this._scene=Y,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Y=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Y.canUseGLVertexID&&Y.textureFloat&&Y.maxVertexTextureImageUnits>0&&Y.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return x.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?x.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Y){this._numMaxInfluencers!==Y&&(this._numMaxInfluencers=Y,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Y){this._useTextureToStoreTargets!==Y&&(this._useTextureToStoreTargets=Y,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Y;return x.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Y=this._scene)&&void 0!==Y&&Y.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Y){return this._activeTargets.data[Y]}getTarget(Y){return this._targets[Y]}getTargetByName(Y){for(const c of this._targets)if(c.name===Y)return c;return null}addTarget(Y){this._targets.push(Y),this._targetInfluenceChangedObservers.push(Y.onInfluenceChanged.add((Y=>{this.areUpdatesFrozen&&Y&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Y)}))),this._targetDataLayoutChangedObservers.push(Y._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Y){const c=this._targets.indexOf(Y);c>=0&&(this._targets.splice(c,1),Y.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(c,1)[0]),Y._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(c,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Y)}_bind(Y){Y.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Y.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Y.setTexture("morphTargets",this._targetStoreTexture),Y.setInt("morphTargetCount",this.numInfluencers)}clone(){const Y=new x(this._scene);for(const c of this._targets)Y.addTarget(c.clone());return Y.enablePositionMorphing=this.enablePositionMorphing,Y.enableNormalMorphing=this.enableNormalMorphing,Y.enableTangentMorphing=this.enableTangentMorphing,Y.enableUVMorphing=this.enableUVMorphing,Y.enableUV2Morphing=this.enableUV2Morphing,Y.enableColorMorphing=this.enableColorMorphing,Y}serialize(){const Y={};Y.id=this.uniqueId,Y.targets=[];for(const c of this._targets)Y.targets.push(c.serialize());return Y}_syncActiveTargets(){let Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const c=!!this._targetStoreTexture,h=this.isUsingTextureForTargets;(this._mustSynchronize||c!==h)&&(this._mustSynchronize=!1,this.synchronize());let C=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const N of this._targets)if(E++,0!==N.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=x.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(N),this._morphTargetTextureIndices[C]=E,this._tempInfluences[C++]=N.influence}this._morphTargetTextureIndices.length!==C&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,C)),this._influences&&this._influences.length===C||(this._influences=new Float32Array(C));for(let N=0;N<C;N++)this._influences[N]=this._tempInfluences[N];if(Y&&this._scene)for(const N of this._scene.meshes)N.morphTargetManager===this&&(h?N._markSubMeshesAsAttributesDirty():N._syncGeometryWithMorphTargetManager())}synchronize(){var Y;if(!this._scene||this.areUpdatesFrozen)return;const c=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Y=this._targetStoreTexture)||void 0===Y||Y.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>c.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const h of this._targets){this._supportsPositions=this._supportsPositions&&h.hasPositions,this._supportsNormals=this._supportsNormals&&h.hasNormals,this._supportsTangents=this._supportsTangents&&h.hasTangents,this._supportsUVs=this._supportsUVs&&h.hasUVs,this._supportsUV2s=this._supportsUV2s&&h.hasUV2s,this._supportsColors=this._supportsColors&&h.hasColors;const Y=h.vertexCount;if(0===this._vertexCount)this._vertexCount=Y;else if(this._vertexCount!==Y)return void P.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${h.name}": ${Y}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Y=c.getCaps().maxTextureSize;this._textureWidth>Y&&(this._textureHeight=Math.ceil(this._textureWidth/Y),this._textureWidth=Y);const h=this._targets.length,C=new Float32Array(h*this._textureWidth*this._textureHeight*4);let E=0;for(let c=0;c<h;c++){const Y=this._targets[c],h=Y.getPositions(),N=Y.getNormals(),Q=Y.getUVs(),b=Y.getTangents(),H=Y.getUV2s(),w=Y.getColors();E=c*this._textureWidth*this._textureHeight*4;for(let c=0;c<this._vertexCount;c++)this._supportsPositions&&h&&(C[E]=h[3*c],C[E+1]=h[3*c+1],C[E+2]=h[3*c+2],E+=4),this._supportsNormals&&N&&(C[E]=N[3*c],C[E+1]=N[3*c+1],C[E+2]=N[3*c+2],E+=4),this._supportsUVs&&Q&&(C[E]=Q[2*c],C[E+1]=Q[2*c+1],E+=4),this._supportsTangents&&b&&(C[E]=b[3*c],C[E+1]=b[3*c+1],C[E+2]=b[3*c+2],E+=4),this._supportsUV2s&&H&&(C[E]=H[2*c],C[E+1]=H[2*c+1],E+=4),this._supportsColors&&w&&(C[E]=w[4*c],C[E+1]=w[4*c+1],C[E+2]=w[4*c+2],C[E+3]=w[4*c+3],E+=4)}this._targetStoreTexture=s.c.CreateRGBATexture(C,this._textureWidth,this._textureHeight,h,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const h of this._scene.meshes)h.morphTargetManager===this&&h._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Y=this._parentContainer.morphTargetManagers.indexOf(this);Y>-1&&this._parentContainer.morphTargetManagers.splice(Y,1),this._parentContainer=null}for(const Y of this._targets)this._scene.stopAnimation(Y)}}static Parse(Y,c){const h=new x(c);for(const C of Y.targets)h.addTarget(K.d.Parse(C,c));return h}}x.EnableTextureStorage=!0,x.MaxActiveMorphTargetsInVertexAttributeMode=8,x.ConstantTargetCountForTextureMode=0;var A=h(14391),V=h(12728),U=h(13212);const l=new Map,n=l;function v(Y,c,h){g(Y)&&P.e.Warn(`Extension with the name '${Y}' already exists`),l.set(Y,{isGLTFExtension:c,factory:h})}function g(Y){return l.delete(Y)}var z=h(14402),O=h(13481),o=h(12961);class f{static Get(Y,c,h){if(!c||void 0==h||!c[h])throw new Error(`${Y}: Failed to find index (${h})`);return c[h]}static TryGet(Y,c){return Y&&void 0!=c&&Y[c]?Y[c]:null}static Assign(Y){if(Y)for(let c=0;c<Y.length;c++)Y[c].index=c}}function L(Y){if(Y.min&&Y.max){const c=Y.min,h=Y.max,C=E.TmpVectors.bh[0].Vc(c[0],c[1],c[2]),N=E.TmpVectors.bh[1].Vc(h[0],h[1],h[2]);if(Y.normalized&&5126!==Y.componentType){let c=1;switch(Y.componentType){case 5120:c=127;break;case 5121:c=255;break;case 5122:c=32767;break;case 5123:c=65535}const h=1/c;C.scaleInPlace(h),N.scaleInPlace(h)}return new U.d(C,N)}return null}class u{static RegisterExtension(Y,c){v(Y,!1,c)}static UnregisterExtension(Y){return g(Y)}get Dc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Y){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Y}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Y=>Y.dispose&&Y.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Y,c,h,C,E,N){let Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=c,this._assetContainer=h,this._loadData(C);let N=null;if(Y){const c={};if(this._gltf.nodes)for(const Y of this._gltf.nodes)Y.name&&(c[Y.name]=Y.index);N=(Y instanceof Array?Y:[Y]).map((Y=>{const h=c[Y];if(void 0===h)throw new Error(`Failed to find node '${Y}'`);return h}))}return await this._loadAsync(E,Q,N,(()=>({meshes:this._getMeshes(),OM:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Y,this._loadData(c),await this._loadAsync(h,E,null,(()=>{}))}async _loadAsync(Y,c,h,C){return await Promise.resolve().then((async()=>{this._rootUrl=Y,this._uniqueRootUrl=!Y.startsWith("file:")&&c?Y:`${Y}${Date.now()}/`,this._fileName=c,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${A.h[A.h.LOADING]} => ${A.h[A.h.READY]}`,N=`${A.h[A.h.LOADING]} => ${A.h[A.h.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(N),this._parent._setState(A.h.LOADING),this._extensionsOnLoading();const b=new Array;if(!this.parent.loadOnlyMaterials)if(h)b.push(this.loadSceneAsync("/nodes",{nodes:h,index:-1}));else if(void 0!=this._gltf.wh||this._gltf.scenes&&this._gltf.scenes[0]){const Y=f.Get("/scene",this._gltf.scenes,this._gltf.wh||0);b.push(this.loadSceneAsync(`/scenes/${Y.index}`,Y))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Y=0;Y<this._gltf.materials.length;++Y){const c=this._gltf.materials[Y],h="/materials/"+Y,C=D.d.TriangleFillMode;b.push(this._loadMaterialAsync(h,c,null,C,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&b.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&b.push(this._compileShadowGeneratorsAsync());const H=Promise.all(b).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Aw(!0);for(const Y of this._babylonScene.materials){const c=Y;void 0!==c.maxSimultaneousLights&&(c.maxSimultaneousLights=Math.max(c.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(A.h.READY),this._skipStartAnimationStep||this._startAnimations(),C()}));return await H.then((Y=>(this._parent._endPerformanceCounter(E),Q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(N),this._parent._setState(A.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Y=>{this._parent.onErrorObservable.notifyObservers(Y),this._parent.onErrorObservable.clear(),this.dispose()}))})),Y)))})).catch((Y=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Y),this._parent.onErrorObservable.clear(),this.dispose()),Y}))}_loadData(Y){if(this._gltf=Y.json,this._setupData(),Y.bin){const c=this._gltf.buffers;if(c&&c[0]&&!c[0].uri){const h=c[0];(h.byteLength<Y.bin.byteLength-3||h.byteLength>Y.bin.byteLength)&&P.e.Warn(`Binary buffer length (${h.byteLength}) from JSON does not match chunk length (${Y.bin.byteLength})`),this._bin=Y.bin}else P.e.Warn("Unexpected BIN chunk")}}_setupData(){if(f.Assign(this._gltf.accessors),f.Assign(this._gltf.animations),f.Assign(this._gltf.buffers),f.Assign(this._gltf.bufferViews),f.Assign(this._gltf.cameras),f.Assign(this._gltf.images),f.Assign(this._gltf.materials),f.Assign(this._gltf.meshes),f.Assign(this._gltf.nodes),f.Assign(this._gltf.samplers),f.Assign(this._gltf.scenes),f.Assign(this._gltf.skins),f.Assign(this._gltf.textures),this._gltf.nodes){const Y={};for(const h of this._gltf.nodes)if(h.children)for(const c of h.children)Y[c]=h.index;const c=this._createRootNode();for(const h of this._gltf.nodes){const C=Y[h.index];h.parent=void 0===C?c:this._gltf.nodes[C]}}}async _loadExtensionsAsync(){const Y=[];if(n.forEach(((c,h)=>{var C;!1===(null===(C=this.parent.extensionOptions[h])||void 0===C?void 0:C.enabled)?c.isGLTFExtension&&this.isExtensionUsed(h)&&P.e.Warn(`Extension ${h} is used but has been explicitly disabled.`):c.isGLTFExtension&&!this.isExtensionUsed(h)||Y.push((async()=>{const Y=await c.factory(this);return Y.name!==h&&P.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Y.name} !== ${h}`),this._parent.onExtensionLoadedObservable.notifyObservers(Y),Y})())})),this._extensions.push(...await Promise.all(Y)),this._extensions.sort(((Y,c)=>(Y.order||Number.MAX_VALUE)-(c.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const h of this._gltf.extensionsRequired){if(!this._extensions.some((Y=>Y.name===h&&Y.enabled))){var c;if(!1===(null===(c=this.parent.extensionOptions[h])||void 0===c?void 0:c.enabled))throw new Error(`Required extension ${h} is disabled`);throw new Error(`Required extension ${h} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new G.e("__root__",this._babylonScene);this._rootBabylonMesh=Y,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Aw(!1);const c={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case A.g.AUTO:this._babylonScene.useRightHandedSystem||(c.rotation=[0,1,0,0],c.scale=[1,1,-1],u._LoadTransform(c,this._rootBabylonMesh));break;case A.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Y),c}loadSceneAsync(Y,c){const h=this._extensionsLoadSceneAsync(Y,c);if(h)return h;const C=new Array;if(this.logOpen(`${Y} ${c.name||""}`),c.nodes)for(const E of c.nodes){const c=f.Get(`${Y}/nodes/${E}`,this._gltf.nodes,E);C.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(Y=>{Y.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return C.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(C).then((()=>{}))}_forEachPrimitive(Y,c){if(Y._primitiveBabylonMeshes)for(const h of Y._primitiveBabylonMeshes)c(h)}_getGeometries(){const Y=[],c=this._gltf.nodes;if(c)for(const h of c)this._forEachPrimitive(h,(c=>{const h=c.Ic;h&&-1===Y.indexOf(h)&&Y.push(h)}));return Y}_getMeshes(){const Y=[];this._rootBabylonMesh instanceof a.c&&Y.push(this._rootBabylonMesh);const c=this._gltf.nodes;if(c)for(const h of c)this._forEachPrimitive(h,(c=>{Y.push(c)}));return Y}_getTransformNodes(){const Y=[],c=this._gltf.nodes;if(c)for(const h of c)h._babylonTransformNode&&"Rc"===h._babylonTransformNode.getClassName()&&Y.push(h._babylonTransformNode),h._babylonTransformNodeForSkin&&Y.push(h._babylonTransformNodeForSkin);return Y}_getSkeletons(){const Y=[],c=this._gltf.skins;if(c)for(const h of c)h._data&&Y.push(h._data.babylonSkeleton);return Y}_getAnimationGroups(){const Y=[],c=this._gltf.animations;if(c)for(const h of c)h._babylonAnimationGroup&&Y.push(h._babylonAnimationGroup);return Y}_startAnimations(){switch(this._parent.animationStartMode){case A.f.NONE:break;case A.f.FIRST:{const Y=this._getAnimationGroups();0!==Y.length&&Y[0].start(!0);break}case A.f.ALL:{const Y=this._getAnimationGroups();for(const c of Y)c.start(!0);break}default:return void P.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadNodeAsync(Y,c,h);if(C)return C;if(c._babylonTransformNode)throw new Error(`${Y}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${Y} ${c.name||""}`);const N=C=>{if(u.AddPointerMetadata(C,Y),u._LoadTransform(c,C),void 0!=c.camera){const h=f.Get(`${Y}/camera`,this._gltf.cameras,c.camera);E.push(this.loadCameraAsync(`/cameras/${h.index}`,h,(Y=>{Y.parent=C,this._babylonScene.useRightHandedSystem||(C.lc.x=-1)})))}if(c.children)for(const h of c.children){const c=f.Get(`${Y}/children/${h}`,this._gltf.nodes,h);E.push(this.loadNodeAsync(`/nodes/${c.index}`,c,(Y=>{Y.parent=C})))}h(C)},Q=void 0!=c.mesh,b=this._parent.loadSkins&&void 0!=c.skin;if(!Q||b){const Y=c.name||`node${c.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new r.e(Y,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==c.mesh?c._babylonTransformNode=h:c._babylonTransformNodeForSkin=h,N(h)}if(Q)if(b){const h=f.Get(`${Y}/mesh`,this._gltf.meshes,c.mesh);E.push(this._loadMeshAsync(`/meshes/${h.index}`,c,h,(h=>{const C=c._babylonTransformNodeForSkin;h.metadata=(0,O.c)(C.metadata,h.metadata||{});const N=f.Get(`${Y}/skin`,this._gltf.skins,c.skin);E.push(this._loadSkinAsync(`/skins/${N.index}`,c,N,(Y=>{this._forEachPrimitive(c,(c=>{c.skeleton=Y})),this._postSceneLoadActions.push((()=>{if(void 0!=N.skeleton){const Y=f.Get(`/skins/${N.index}/skeleton`,this._gltf.nodes,N.skeleton).parent;c.index===Y.index?h.parent=C.parent:h.parent=Y._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:C,skinnedNode:h})}))})))})))}else{const h=f.Get(`${Y}/mesh`,this._gltf.meshes,c.mesh);E.push(this._loadMeshAsync(`/meshes/${h.index}`,c,h,N))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(c,(Y=>{const c=Y;!c.isAnInstance&&c.Ic&&c.Ic.useBoundingInfoFromGeometry?Y.UY():Y.refreshBoundingInfo(!0,!0)})),c._babylonTransformNode)))}_loadMeshAsync(Y,c,h,C){const E=h.primitives;if(!E||!E.length)throw new Error(`${Y}: Primitives are missing`);void 0==E[0].index&&f.Assign(E);const N=new Array;this.logOpen(`${Y} ${h.name||""}`);const Q=c.name||`node${c.index}`;if(1===E.length){const C=h.primitives[0];N.push(this._loadMeshPrimitiveAsync(`${Y}/primitives/${C.index}`,Q,c,h,C,(Y=>{c._babylonTransformNode=Y,c._primitiveBabylonMeshes=[Y]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,c._babylonTransformNode=new r.e(Q,this._babylonScene),c._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._primitiveBabylonMeshes=[];for(const C of E)N.push(this._loadMeshPrimitiveAsync(`${Y}/primitives/${C.index}`,`${Q}_primitive${C.index}`,c,h,C,(Y=>{Y.parent=c._babylonTransformNode,c._primitiveBabylonMeshes.push(Y)})))}return C(c._babylonTransformNode),this.logClose(),Promise.all(N).then((()=>c._babylonTransformNode))}_loadMeshPrimitiveAsync(Y,c,h,C,E,N){const Q=this._extensionsLoadMeshPrimitiveAsync(Y,c,h,C,E,N);if(Q)return Q;this.logOpen(`${Y}`);const b=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==h.skin&&!C.primitives[0].targets;let H,w;if(b&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,H=E._instanceData.babylonSourceMesh.createInstance(c),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w=E._instanceData.promise;else{const N=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new G.e(c,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.sideOrientation=this._babylonScene.useRightHandedSystem?D.d.CounterClockWiseSideOrientation:D.d.ClockWiseSideOrientation,this._createMorphTargets(Y,h,C,E,Q),N.push(this._loadVertexDataAsync(Y,E,Q).then((async c=>await this._loadMorphTargetsAsync(Y,E,Q,c).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,c.AY(Q),c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const W=u._GetDrawMode(Y,E.mode);if(void 0==E.material){let Y=this._defaultBabylonMaterialData[W];Y||(Y=this._createDefaultMaterial("__GLTFLoader._default",W),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this._defaultBabylonMaterialData[W]=Y),Q.material=Y}else if(!this.parent.skipMaterials){const c=f.Get(`${Y}/material`,this._gltf.materials,E.material);N.push(this._loadMaterialAsync(`/materials/${c.index}`,c,Q,W,(Y=>{Q.material=Y})))}w=Promise.all(N),b&&(E._instanceData={babylonSourceMesh:Q,promise:w}),H=Q}return u.AddPointerMetadata(H,Y),this._parent.onMeshLoadedObservable.notifyObservers(H),N(H),this.logClose(),w.then((()=>H))}_loadVertexDataAsync(Y,c,h){const C=this._extensionsLoadVertexDataAsync(Y,c,h);if(C)return C;const E=c.attributes;if(!E)throw new Error(`${Y}: Attributes are missing`);const N=new Array,Q=new Z.e(h.name,this._babylonScene);if(void 0==c.indices)h.isUnIndexed=!0;else{const h=f.Get(`${Y}/indices`,this._gltf.accessors,c.indices);N.push(this._loadIndicesAccessorAsync(`/accessors/${h.index}`,h).then((Y=>{Q.setIndices(Y)})))}const b=(c,C,b)=>{if(void 0==E[c])return;h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(C)&&h._delayInfo.push(C);const H=f.Get(`${Y}/attributes/${c}`,this._gltf.accessors,E[c]);N.push(this._loadVertexAccessorAsync(`/accessors/${H.index}`,H,C).then((Y=>{if(Y.getKind()===X.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!h.skeleton){const Y=L(H);Y&&(Q._boundingInfo=Y,Q.useBoundingInfoFromGeometry=!0)}Q.setVerticesBuffer(Y,H.count)}))),C==X.f.MatricesIndicesExtraKind&&(h.numBoneInfluencers=8),b&&b(H)};return b("POSITION",X.f.PositionKind),b("NORMAL",X.f.NormalKind),b("TANGENT",X.f.TangentKind),b("TEXCOORD_0",X.f.UVKind),b("TEXCOORD_1",X.f.UV2Kind),b("TEXCOORD_2",X.f.UV3Kind),b("TEXCOORD_3",X.f.UV4Kind),b("TEXCOORD_4",X.f.UV5Kind),b("TEXCOORD_5",X.f.UV6Kind),b("JOINTS_0",X.f.MatricesIndicesKind),b("WEIGHTS_0",X.f.MatricesWeightsKind),b("JOINTS_1",X.f.MatricesIndicesExtraKind),b("WEIGHTS_1",X.f.MatricesWeightsExtraKind),b("COLOR_0",X.f.ColorKind,(Y=>{"VEC4"===Y.type&&(h.hasVertexAlpha=!0)})),Promise.all(N).then((()=>Q))}_createMorphTargets(Y,c,h,C,E){if(!C.targets||!this._parent.loadMorphTargets)return;if(void 0==c._numMorphTargets)c._numMorphTargets=C.targets.length;else if(C.targets.length!==c._numMorphTargets)throw new Error(`${Y}: Primitives do not have the same number of targets`);const N=h.extras?h.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new x(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let Q=0;Q<C.targets.length;Q++){const Y=c.weights?c.weights[Q]:h.weights?h.weights[Q]:0,C=N?N[Q]:`morphTarget${Q}`;E.morphTargetManager.addTarget(new K.d(C,Y,E.ZY()))}}_loadMorphTargetsAsync(Y,c,h,C){if(!c.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,N=h.morphTargetManager;for(let Q=0;Q<N.numTargets;Q++){const h=N.getTarget(Q);E.push(this._loadMorphTargetVertexDataAsync(`${Y}/targets/${Q}`,C,c.targets[Q],h))}return Promise.all(E).then((()=>{N.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Y,c,h,C){const E=new Array,N=(C,N,Q)=>{if(void 0==h[C])return;const b=c.getVertexBuffer(N);if(!b)return;const H=f.Get(`${Y}/${C}`,this._gltf.accessors,h[C]);E.push(this._loadFloatAccessorAsync(`/accessors/${H.index}`,H).then((Y=>{Q(b,Y)})))};return N("POSITION",X.f.PositionKind,((Y,c)=>{const h=new Float32Array(c.length);Y.forEach(c.length,((Y,C)=>{h[C]=c[C]+Y})),C.setPositions(h)})),N("NORMAL",X.f.NormalKind,((Y,c)=>{const h=new Float32Array(c.length);Y.forEach(h.length,((Y,C)=>{h[C]=c[C]+Y})),C.setNormals(h)})),N("TANGENT",X.f.TangentKind,((Y,c)=>{const h=new Float32Array(c.length/3*4);let E=0;Y.forEach(c.length/3*4,((Y,C)=>{(C+1)%4!==0&&(h[E]=c[E]+Y,E++)})),C.setTangents(h)})),N("TEXCOORD_0",X.f.UVKind,((Y,c)=>{const h=new Float32Array(c.length);Y.forEach(c.length,((Y,C)=>{h[C]=c[C]+Y})),C.setUVs(h)})),N("TEXCOORD_1",X.f.UV2Kind,((Y,c)=>{const h=new Float32Array(c.length);Y.forEach(c.length,((Y,C)=>{h[C]=c[C]+Y})),C.setUV2s(h)})),N("COLOR_0",X.f.ColorKind,((c,h)=>{let E=null;const N=c.getSize();if(3===N){E=new Float32Array(h.length/3*4),c.forEach(h.length,((Y,c)=>{const C=Math.floor(c/3),N=c%3;E[4*C+N]=h[3*C+N]+Y}));for(let Y=0;Y<h.length/3;++Y)E[4*Y+3]=1}else{if(4!==N)throw new Error(`${Y}: Invalid number of components (${N}) for COLOR_0 attribute`);E=new Float32Array(h.length),c.forEach(h.length,((Y,c)=>{E[c]=h[c]+Y}))}C.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(Y,c){if(void 0!=Y.skin)return;let h=E.bh.Zero(),C=E.Quaternion.Identity(),N=E.bh.One();if(Y.matrix){E.Matrix.dh(Y.matrix).decompose(N,C,h)}else Y.translation&&(h=E.bh.dh(Y.translation)),Y.rotation&&(C=E.Quaternion.dh(Y.rotation)),Y.scale&&(N=E.bh.dh(Y.scale));c.position=h,c.rotationQuaternion=C,c.lc=N}_loadSkinAsync(Y,c,h,C){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(Y,c,h);if(E)return E;if(h._data)return C(h._data.babylonSkeleton),h._data.promise;const N=`skeleton${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new d(h.name||N,N,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Y,h,Q);const b=this._loadSkinInverseBindMatricesDataAsync(Y,h).then((Y=>{this._updateBoneMatrices(Q,Y)}));return h._data={babylonSkeleton:Q,promise:b},C(Q),b}_loadBones(Y,c,h){if(void 0==c.skeleton||this._parent.alwaysComputeSkeletonRootNode){const h=this._findSkeletonRootNode(`${Y}/joints`,c.joints);if(h)if(void 0===c.skeleton)c.skeleton=h.index;else{const C=(Y,c)=>{for(;c.parent;c=c.parent)if(c.parent===Y)return!0;return!1},E=f.Get(`${Y}/skeleton`,this._gltf.nodes,c.skeleton);E===h||C(E,h)||(P.e.Warn(`${Y}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),c.skeleton=h.index)}else P.e.Warn(`${Y}: Failed to find common root`)}const C={};for(const E of c.joints){const N=f.Get(`${Y}/joints/${E}`,this._gltf.nodes,E);this._loadBone(N,c,h,C)}}_findSkeletonRootNode(Y,c){if(0===c.length)return null;const h={};for(const E of c){const c=[];let C=f.Get(`${Y}/${E}`,this._gltf.nodes,E);for(;-1!==C.index;)c.unshift(C),C=C.parent;h[E]=c}let C=null;for(let E=0;;++E){let Y=h[c[0]];if(E>=Y.length)return C;const N=Y[E];for(let Q=1;Q<c.length;++Q)if(Y=h[c[Q]],E>=Y.length||N!==Y[E])return C;C=N}}_loadBone(Y,c,h,C){Y._isJoint=!0;let E=C[Y.index];if(E)return E;let N=null;Y.index!==c.skeleton&&(Y.parent&&-1!==Y.parent.index?N=this._loadBone(Y.parent,c,h,C):void 0!==c.skeleton&&P.e.Warn(`/skins/${c.index}/skeleton: Skeleton node is not a common root`));const Q=c.joints.indexOf(Y.index);return E=new w.d(Y.name||`joint${Y.index}`,h,N,this._getNodeMatrix(Y),null,null,Q),C[Y.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(Y._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(Y,c){if(void 0==c.inverseBindMatrices)return Promise.resolve(null);const h=f.Get(`${Y}/inverseBindMatrices`,this._gltf.accessors,c.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${h.index}`,h)}_updateBoneMatrices(Y,c){for(const h of Y.bones){const Y=E.Matrix.Identity(),C=h._index;c&&-1!==C&&(E.Matrix.FromArrayToRef(c,16*C,Y),Y.invertToRef(Y));const N=h.getParent();N&&Y.multiplyToRef(N.getAbsoluteInverseBindMatrix(),Y),h.Gc(Y,!1,!1),h._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Y){return Y.matrix?E.Matrix.dh(Y.matrix):E.Matrix.Compose(Y.scale?E.bh.dh(Y.scale):E.bh.One(),Y.rotation?E.Quaternion.dh(Y.rotation):E.Quaternion.Identity(),Y.translation?E.bh.dh(Y.translation):E.bh.Zero())}loadCameraAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadCameraAsync(Y,c,h);if(C)return C;const N=new Array;this.logOpen(`${Y} ${c.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new H.b(c.name||`camera${c.index}`,E.bh.Zero(),this._babylonScene,!1);switch(Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonCamera=Q,Q.setTarget(new E.bh(0,0,-1)),c.type){case"perspective":{const h=c.perspective;if(!h)throw new Error(`${Y}: Camera perspective properties are missing`);Q.fov=h.yfov,Q.ac=h.znear,Q.maxZ=h.zfar||0;break}case"orthographic":if(!c.orthographic)throw new Error(`${Y}: Camera orthographic properties are missing`);Q.mode=b.b.ORTHOGRAPHIC_CAMERA,Q.orthoLeft=-c.orthographic.xmag,Q.orthoRight=c.orthographic.xmag,Q.orthoBottom=-c.orthographic.ymag,Q.orthoTop=c.orthographic.ymag,Q.ac=c.orthographic.znear,Q.maxZ=c.orthographic.zfar;break;default:throw new Error(`${Y}: Invalid camera type (${c.type})`)}return u.AddPointerMetadata(Q,Y),this._parent.onCameraLoadedObservable.notifyObservers(Q),h(Q),this.logClose(),Promise.all(N).then((()=>Q))}_loadAnimationsAsync(){const Y=this._gltf.animations;if(!Y)return Promise.resolve();const c=new Array;for(let h=0;h<Y.length;h++){const C=Y[h];c.push(this.loadAnimationAsync(`/animations/${C.index}`,C).then((Y=>{0===Y.targetedAnimations.length&&Y.dispose()})))}return Promise.all(c).then((()=>{}))}loadAnimationAsync(Y,c){const C=this._extensionsLoadAnimationAsync(Y,c);return C||h.e(78).then(h.bind(h,16150)).then((h=>{let{AnimationGroup:C}=h;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new C(c.name||`animation${c.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c._babylonAnimationGroup=E;const N=new Array;f.Assign(c.channels),f.Assign(c.samplers);for(const Q of c.channels)N.push(this._loadAnimationChannelAsync(`${Y}/channels/${Q.index}`,Y,c,Q,((Y,c)=>{Y.animations=Y.animations||[],Y.animations.push(c),E.addTargetedAnimation(c,Y)})));return Promise.all(N).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(Y,c,C,E,N){const Q=this._extensionsLoadAnimationChannelAsync(Y,c,C,E,N);if(Q)return await Q;if(void 0==E.target.node)return await Promise.resolve();const b=f.Get(`${Y}/target/node`,this._gltf.nodes,E.target.node),H=E.target.path,w="weights"===H;if(w&&!b._numMorphTargets||!w&&!b._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!w&&!b._isJoint)return await Promise.resolve();let W;switch(await Promise.resolve().then(h.bind(h,14413)),H){case"translation":var q;W=null===(q=(0,z.g)("/nodes/{}/translation"))||void 0===q?void 0:q.interpolation;break;case"rotation":var k;W=null===(k=(0,z.g)("/nodes/{}/rotation"))||void 0===k?void 0:k.interpolation;break;case"scale":var M;W=null===(M=(0,z.g)("/nodes/{}/scale"))||void 0===M?void 0:M.interpolation;break;case"weights":var p;W=null===(p=(0,z.g)("/nodes/{}/weights"))||void 0===p?void 0:p.interpolation;break;default:throw new Error(`${Y}/target/path: Invalid value (${E.target.path})`)}if(!W)throw new Error(`${Y}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const P={object:b,info:W};return await this._loadAnimationChannelFromTargetInfoAsync(Y,c,C,E,P,N)}_loadAnimationChannelFromTargetInfoAsync(Y,c,h,C,E,N){const Q=this.parent.targetFps,b=1/Q,H=f.Get(`${Y}/sampler`,h.samplers,C.sampler);return this._loadAnimationSamplerAsync(`${c}/samplers/${C.sampler}`,H).then((Y=>{let c=0;const H=E.object,w=E.info;for(const E of w){const w=E.getStride(H),W=Y.input,q=Y.output,k=new Array(W.length);let M=0;switch(Y.interpolation){case"STEP":for(let Y=0;Y<W.length;Y++){const c=E.getValue(H,q,M,1);M+=w,k[Y]={frame:W[Y]*Q,value:c,interpolation:1}}break;case"CUBICSPLINE":for(let Y=0;Y<W.length;Y++){const c=E.getValue(H,q,M,b);M+=w;const h=E.getValue(H,q,M,1);M+=w;const C=E.getValue(H,q,M,b);M+=w,k[Y]={frame:W[Y]*Q,inTangent:c,value:h,outTangent:C}}break;case"LINEAR":for(let Y=0;Y<W.length;Y++){const c=E.getValue(H,q,M,1);M+=w,k[Y]={frame:W[Y]*Q,value:c}}}if(M>0){const Y=`${h.name||`animation${h.index}`}_channel${C.index}_${c}`,b=E.buildAnimations(H,Y,Q,k);for(const h of b)c++,N(h.babylonAnimatable,h.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Y,c){if(c._data)return c._data;const h=c.interpolation||"LINEAR";switch(h){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Y}/interpolation: Invalid value (${c.interpolation})`)}const C=f.Get(`${Y}/input`,this._gltf.accessors,c.input),E=f.Get(`${Y}/output`,this._gltf.accessors,c.output);return c._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${C.index}`,C),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((Y=>{let[c,C]=Y;return{input:c,interpolation:h,output:C}})),c._data}loadBufferAsync(Y,c,h,C){const E=this._extensionsLoadBufferAsync(Y,c,h,C);if(E)return E;if(!c._data)if(c.uri)c._data=this.loadUriAsync(`${Y}/uri`,c,c.uri);else{if(!this._bin)throw new Error(`${Y}: Uri is missing or the binary glTF is missing its binary chunk`);c._data=this._bin.readAsync(0,c.byteLength)}return c._data.then((c=>{try{return new Uint8Array(c.buffer,c.byteOffset+h,C)}catch(E){throw new Error(`${Y}: ${E.message}`)}}))}loadBufferViewAsync(Y,c){const h=this._extensionsLoadBufferViewAsync(Y,c);if(h)return h;if(c._data)return c._data;const C=f.Get(`${Y}/buffer`,this._gltf.buffers,c.buffer);return c._data=this.loadBufferAsync(`/buffers/${C.index}`,C,c.byteOffset||0,c.byteLength),c._data}_loadAccessorAsync(Y,c,h){if(c._data)return c._data;const C=u._GetNumComponents(Y,c.type),E=C*X.f.GetTypeByteLength(c.componentType),N=C*c.count;if(void 0==c.bufferView)c._data=Promise.resolve(new h(N));else{const Q=f.Get(`${Y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((b=>{if(5126!==c.componentType||c.normalized||Q.byteStride&&Q.byteStride!==E){const Y=new h(N);return X.f.ForEach(b,c.byteOffset||0,Q.byteStride||E,C,c.componentType,Y.length,c.normalized||!1,((c,h)=>{Y[h]=c})),Y}return u._GetTypedArray(Y,c.componentType,b,c.byteOffset,N)}))}if(c.sparse){const N=c.sparse;c._data=c._data.then((Q=>{const b=Q,H=f.Get(`${Y}/sparse/indices/bufferView`,this._gltf.bufferViews,N.indices.bufferView),w=f.Get(`${Y}/sparse/values/bufferView`,this._gltf.bufferViews,N.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${H.index}`,H),this.loadBufferViewAsync(`/bufferViews/${w.index}`,w)]).then((Q=>{let[H,w]=Q;const W=u._GetTypedArray(`${Y}/sparse/indices`,N.indices.componentType,H,N.indices.byteOffset,N.count),q=C*N.count;let k;if(5126!==c.componentType||c.normalized){const Q=u._GetTypedArray(`${Y}/sparse/values`,c.componentType,w,N.values.byteOffset,q);k=new h(q),X.f.ForEach(Q,0,E,C,c.componentType,k.length,c.normalized||!1,((Y,c)=>{k[c]=Y}))}else k=u._GetTypedArray(`${Y}/sparse/values`,c.componentType,w,N.values.byteOffset,q);let M=0;for(let Y=0;Y<W.length;Y++){let c=W[Y]*C;for(let Y=0;Y<C;Y++)b[c++]=k[M++]}return b}))}))}return c._data}_loadFloatAccessorAsync(Y,c){return this._loadAccessorAsync(Y,c,Float32Array)}_loadIndicesAccessorAsync(Y,c){if("SCALAR"!==c.type)throw new Error(`${Y}/type: Invalid value ${c.type}`);if(5121!==c.componentType&&5123!==c.componentType&&5125!==c.componentType)throw new Error(`${Y}/componentType: Invalid value ${c.componentType}`);if(c._data)return c._data;if(c.sparse){const h=u._GetTypedArrayConstructor(`${Y}/componentType`,c.componentType);c._data=this._loadAccessorAsync(Y,c,h)}else{const h=f.Get(`${Y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((h=>u._GetTypedArray(Y,c.componentType,h,c.byteOffset,c.count)))}return c._data}_loadVertexBufferViewAsync(Y){if(Y._babylonBuffer)return Y._babylonBuffer;const c=this._babylonScene.getEngine();return Y._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((Y=>new X.d(c,Y,!1))),Y._babylonBuffer}_loadVertexAccessorAsync(Y,c,h){var C;if(null!==(C=c._babylonVertexBuffer)&&void 0!==C&&C[h])return c._babylonVertexBuffer[h];c._babylonVertexBuffer||(c._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(c.sparse||void 0==c.bufferView)c._babylonVertexBuffer[h]=this._loadFloatAccessorAsync(Y,c).then((Y=>new X.f(E,Y,h,!1)));else{const C=f.Get(`${Y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._babylonVertexBuffer[h]=this._loadVertexBufferViewAsync(C).then((N=>{const Q=u._GetNumComponents(Y,c.type);return new X.f(E,N,h,!1,void 0,C.byteStride,void 0,c.byteOffset,Q,c.componentType,c.normalized,!0,void 0,!0)}))}return c._babylonVertexBuffer[h]}_loadMaterialMetallicRoughnessPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return c&&(c.baseColorFactor?(h.albedoColor=N.ph.dh(c.baseColorFactor),h.alpha=c.baseColorFactor[3]):h.albedoColor=N.ph.White(),h.metallic=void 0==c.metallicFactor?1:c.metallicFactor,h.roughness=void 0==c.roughnessFactor?1:c.roughnessFactor,c.baseColorTexture&&C.push(this.loadTextureInfoAsync(`${Y}/baseColorTexture`,c.baseColorTexture,(Y=>{Y.name=`${h.name} (Base Color)`,h.albedoTexture=Y}))),c.metallicRoughnessTexture&&(c.metallicRoughnessTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${Y}/metallicRoughnessTexture`,c.metallicRoughnessTexture,(Y=>{Y.name=`${h.name} (Metallic Roughness)`,h.metallicTexture=Y}))),h.useMetallnessFromMetallicTextureBlue=!0,h.useRoughnessFromMetallicTextureGreen=!0,h.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(C).then((()=>{}))}_loadMaterialAsync(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const N=this._extensionsLoadMaterialAsync(Y,c,h,C,E);if(N)return N;c._data=c._data||{};let Q=c._data[C];if(!Q){this.logOpen(`${Y} ${c.name||""}`);const h=this.createMaterial(Y,c,C);Q={babylonMaterial:h,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Y,c,h)},c._data[C]=Q,u.AddPointerMetadata(h,Y),this._parent.onMaterialLoadedObservable.notifyObservers(h),this.logClose()}return h&&(Q.babylonMeshes.push(h),h.Mc.addOnce((()=>{const Y=Q.babylonMeshes.indexOf(h);-1!==Y&&Q.babylonMeshes.splice(Y,1)}))),E(Q.babylonMaterial),Q.promise.then((()=>Q.babylonMaterial))}_createDefaultMaterial(Y,c){this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new T.d(Y,this._babylonScene);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.fillMode=c,h.enableSpecularAntiAliasing=!0,h.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,h.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,h.transparencyMode=T.d.PBRMATERIAL_OPAQUE,h.metallic=1,h.roughness=1,h}createMaterial(Y,c,h){const C=this._extensionsCreateMaterial(Y,c,h);if(C)return C;const E=c.name||`material${c.index}`;return this._createDefaultMaterial(E,h)}loadMaterialPropertiesAsync(Y,c,h){const C=this._extensionsLoadMaterialPropertiesAsync(Y,c,h);if(C)return C;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(Y,c,h)),c.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Y}/pbrMetallicRoughness`,c.pbrMetallicRoughness,h)),this.loadMaterialAlphaProperties(Y,c,h),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.emissiveColor=c.emissiveFactor?N.ph.dh(c.emissiveFactor):new N.ph(0,0,0),c.doubleSided&&(h.Ac=!1,h.twoSidedLighting=!0),c.normalTexture&&(c.normalTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${Y}/normalTexture`,c.normalTexture,(Y=>{Y.name=`${h.name} (Normal)`,h.bumpTexture=Y}))),h.invertNormalMapX=!this._babylonScene.useRightHandedSystem,h.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=c.normalTexture.scale&&h.bumpTexture&&(h.bumpTexture.level=c.normalTexture.scale),h.forceIrradianceInFragment=!0),c.occlusionTexture&&(c.occlusionTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${Y}/occlusionTexture`,c.occlusionTexture,(Y=>{Y.name=`${h.name} (Occlusion)`,h.ambientTexture=Y}))),h.useAmbientInGrayScale=!0,void 0!=c.occlusionTexture.strength&&(h.ambientTextureStrength=c.occlusionTexture.strength)),c.emissiveTexture&&C.push(this.loadTextureInfoAsync(`${Y}/emissiveTexture`,c.emissiveTexture,(Y=>{Y.name=`${h.name} (Emissive)`,h.emissiveTexture=Y}))),Promise.all(C).then((()=>{}))}loadMaterialAlphaProperties(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);switch(c.alphaMode||"OPAQUE"){case"OPAQUE":h.transparencyMode=T.d.PBRMATERIAL_OPAQUE,h.alpha=1;break;case"MASK":h.transparencyMode=T.d.PBRMATERIAL_ALPHATEST,h.alphaCutOff=void 0==c.alphaCutoff?.5:c.alphaCutoff,h.albedoTexture&&(h.albedoTexture.Zc=!0);break;case"BLEND":h.transparencyMode=T.d.PBRMATERIAL_ALPHABLEND,h.albedoTexture&&(h.albedoTexture.Zc=!0,h.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Y}/alphaMode: Invalid value (${c.alphaMode})`)}}loadTextureInfoAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureInfoAsync(Y,c,h);if(C)return C;if(this.logOpen(`${Y}`),c.texCoord>=6)throw new Error(`${Y}/texCoord: Invalid value (${c.texCoord})`);const E=f.Get(`${Y}/index`,this._gltf.textures,c.index);E._textureInfo=c;const N=this._loadTextureAsync(`/textures/${c.index}`,E,(C=>{C.coordinatesIndex=c.texCoord||0,u.AddPointerMetadata(C,Y),this._parent.onTextureLoadedObservable.notifyObservers(C),h(C)}));return this.logClose(),N}_loadTextureAsync(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureAsync(Y,c,h);if(C)return C;this.logOpen(`${Y} ${c.name||""}`);const E=void 0==c.sampler?u.DefaultSampler:f.Get(`${Y}/sampler`,this._gltf.samplers,c.sampler),N=f.Get(`${Y}/source`,this._gltf.images,c.source),Q=this._createTextureAsync(Y,E,N,h,void 0,!c._textureInfo.nonColorData);return this.logClose(),Q}_createTextureAsync(Y,c,h){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},N=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const b=this._loadSampler(`/samplers/${c.index}`,c),H=new Array,w=new C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W={noMipmap:b.noMipMaps,invertY:!1,samplingMode:b.samplingMode,J:()=>{this._disposed||w.resolve()},onError:(c,h)=>{this._disposed||w.reject(new Error(`${Y}: ${h&&h.message?h.message:c||"Failed to load texture"}`))},mimeType:h.mimeType??(0,V.i)(h.uri??""),loaderOptions:N,useSRGBBuffer:!!Q&&this._parent.useSRGBBuffers},q=new e.d(null,this._babylonScene,W);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.push(w.promise),H.push(this.loadImageAsync(`/images/${h.index}`,h).then((Y=>{const c=h.uri||`${this._fileName}#image${h.index}`,C=`data:${this._uniqueRootUrl}${c}`;q.updateURL(C,Y);const E=q.getInternalTexture();E&&(E.label=h.name)}))),q.wrapU=b.wrapU,q.wrapV=b.wrapV,E(q),this._parent.useGltfTextureNames&&(q.name=h.name||h.uri||`image${h.index}`),Promise.all(H).then((()=>q))}_loadSampler(Y,c){return c._data||(c._data={noMipMaps:9728===c.minFilter||9729===c.minFilter,samplingMode:u._GetTextureSamplingMode(Y,c),wrapU:u._GetTextureWrapMode(`${Y}/wrapS`,c.wrapS),wrapV:u._GetTextureWrapMode(`${Y}/wrapT`,c.wrapT)}),c._data}loadImageAsync(Y,c){if(!c._data){if(this.logOpen(`${Y} ${c.name||""}`),c.uri)c._data=this.loadUriAsync(`${Y}/uri`,c,c.uri);else{const h=f.Get(`${Y}/bufferView`,this._gltf.bufferViews,c.bufferView);c._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}this.logClose()}return c._data}loadUriAsync(Y,c,h){const C=this._extensionsLoadUriAsync(Y,c,h);if(C)return C;if(!u._ValidateUri(h))throw new Error(`${Y}: '${h}' is invalid`);if((0,V.m)(h)){const c=new Uint8Array((0,V.c)(h));return this.log(`${Y}: Decoded ${h.substring(0,64)}... (${c.length} bytes)`),Promise.resolve(c)}return this.log(`${Y}: Loading ${h}`),this._parent.preprocessUrlAsync(this._rootUrl+h).then((c=>new Promise(((C,E)=>{this._parent._loadFile(this._babylonScene,c,(c=>{this._disposed||(this.log(`${Y}: Loaded ${h} (${c.byteLength} bytes)`),C(new Uint8Array(c)))}),!0,(c=>{E(new V.p(`${Y}: Failed to load '${h}'${c?": "+c.status+" "+c.statusText:""}`,c))}))}))))}static AddPointerMetadata(Y,c){Y.metadata=Y.metadata||{};const h=Y._internalMetadata=Y._internalMetadata||{},C=h.Dc=h.Dc||{};(C.pointers=C.pointers||[]).push(c)}static _GetTextureWrapMode(Y,c){switch(c=void 0==c?10497:c){case 33071:return e.d.CLAMP_ADDRESSMODE;case 33648:return e.d.MIRROR_ADDRESSMODE;case 10497:return e.d.WRAP_ADDRESSMODE;default:return P.e.Warn(`${Y}: Invalid value (${c})`),e.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Y,c){const h=void 0==c.magFilter?9729:c.magFilter,C=void 0==c.minFilter?9987:c.minFilter;if(9729===h)switch(C){case 9728:return e.d.LINEAR_NEAREST;case 9729:return e.d.LINEAR_LINEAR;case 9984:return e.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return e.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return e.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return e.d.LINEAR_LINEAR_MIPLINEAR;default:return P.e.Warn(`${Y}/minFilter: Invalid value (${C})`),e.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==h&&P.e.Warn(`${Y}/magFilter: Invalid value (${h})`),C){case 9728:return e.d.NEAREST_NEAREST;case 9729:return e.d.NEAREST_LINEAR;case 9984:return e.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return e.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return e.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return e.d.NEAREST_LINEAR_MIPLINEAR;default:return P.e.Warn(`${Y}/minFilter: Invalid value (${C})`),e.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Y,c){try{return(0,o.p)(c)}catch(h){throw new Error(`${Y}: ${h.message}`)}}static _GetTypedArray(Y,c,h,C,E){const N=h.buffer;C=h.byteOffset+(C||0);const Q=u._GetTypedArrayConstructor(`${Y}/componentType`,c),b=X.f.GetTypeByteLength(c);return C%b!==0?(P.e.Warn(`${Y}: Copying buffer as byte offset (${C}) is not a multiple of component type byte length (${b})`),new Q(N.slice(C,C+E*b),0)):new Q(N,C,E)}static _GetNumComponents(Y,c){switch(c){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Y}: Invalid type (${c})`)}static _ValidateUri(Y){return Q.Tools.IsBase64(Y)||-1===Y.indexOf("..")}static _GetDrawMode(Y,c){switch(void 0==c&&(c=4),c){case 0:return D.d.PointListDrawMode;case 1:return D.d.LineListDrawMode;case 2:return D.d.LineLoopDrawMode;case 3:return D.d.LineStripDrawMode;case 4:return D.d.TriangleFillMode;case 5:return D.d.TriangleStripDrawMode;case 6:return D.d.TriangleFanDrawMode}throw new Error(`${Y}: Invalid mesh primitive mode (${c})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Y=new Array;if(this._gltf.materials)for(const c of this._gltf.materials)if(c._data)for(const h in c._data){const C=c._data[h];for(const c of C.babylonMeshes){c.Kc(!0);const h=C.babylonMaterial;Y.push(h.forceCompilationAsync(c)),Y.push(h.forceCompilationAsync(c,{useInstances:!0})),this._parent.useClipPlane&&(Y.push(h.forceCompilationAsync(c,{clipPlane:!0})),Y.push(h.forceCompilationAsync(c,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Y).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Y=new Array,c=this._babylonScene.lights;for(const h of c){const c=h.getShadowGenerator();c&&Y.push(c.forceCompilationAsync())}return Promise.all(Y).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Y){for(const c of this._extensions)c.enabled&&Y(c)}_applyExtensions(Y,c,h){for(const C of this._extensions)if(C.enabled){const E=`${C.name}.${c}`,N=Y;N._activeLoaderExtensionFunctions=N._activeLoaderExtensionFunctions||{};const Q=N._activeLoaderExtensionFunctions;if(!Q[E]){Q[E]=!0;try{const Y=h(C);if(Y)return Y}finally{delete Q[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Y=>Y.onLoading&&Y.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Y=>Y.onReady&&Y.onReady()))}_extensionsLoadSceneAsync(Y,c){return this._applyExtensions(c,"loadScene",(h=>h.loadSceneAsync&&h.loadSceneAsync(Y,c)))}_extensionsLoadNodeAsync(Y,c,h){return this._applyExtensions(c,"loadNode",(C=>C.loadNodeAsync&&C.loadNodeAsync(Y,c,h)))}_extensionsLoadCameraAsync(Y,c,h){return this._applyExtensions(c,"loadCamera",(C=>C.loadCameraAsync&&C.loadCameraAsync(Y,c,h)))}_extensionsLoadVertexDataAsync(Y,c,h){return this._applyExtensions(c,"loadVertexData",(C=>C._loadVertexDataAsync&&C._loadVertexDataAsync(Y,c,h)))}_extensionsLoadMeshPrimitiveAsync(Y,c,h,C,E,N){return this._applyExtensions(E,"loadMeshPrimitive",(Q=>Q._loadMeshPrimitiveAsync&&Q._loadMeshPrimitiveAsync(Y,c,h,C,E,N)))}_extensionsLoadMaterialAsync(Y,c,h,C,E){return this._applyExtensions(c,"loadMaterial",(N=>N._loadMaterialAsync&&N._loadMaterialAsync(Y,c,h,C,E)))}_extensionsCreateMaterial(Y,c,h){return this._applyExtensions(c,"createMaterial",(C=>C.createMaterial&&C.createMaterial(Y,c,h)))}_extensionsLoadMaterialPropertiesAsync(Y,c,h){return this._applyExtensions(c,"loadMaterialProperties",(C=>C.loadMaterialPropertiesAsync&&C.loadMaterialPropertiesAsync(Y,c,h)))}_extensionsLoadTextureInfoAsync(Y,c,h){return this._applyExtensions(c,"loadTextureInfo",(C=>C.loadTextureInfoAsync&&C.loadTextureInfoAsync(Y,c,h)))}_extensionsLoadTextureAsync(Y,c,h){return this._applyExtensions(c,"loadTexture",(C=>C._loadTextureAsync&&C._loadTextureAsync(Y,c,h)))}_extensionsLoadAnimationAsync(Y,c){return this._applyExtensions(c,"loadAnimation",(h=>h.loadAnimationAsync&&h.loadAnimationAsync(Y,c)))}_extensionsLoadAnimationChannelAsync(Y,c,h,C,E){return this._applyExtensions(h,"loadAnimationChannel",(N=>N._loadAnimationChannelAsync&&N._loadAnimationChannelAsync(Y,c,h,C,E)))}_extensionsLoadSkinAsync(Y,c,h){return this._applyExtensions(h,"loadSkin",(C=>C._loadSkinAsync&&C._loadSkinAsync(Y,c,h)))}_extensionsLoadUriAsync(Y,c,h){return this._applyExtensions(c,"loadUri",(C=>C._loadUriAsync&&C._loadUriAsync(Y,c,h)))}_extensionsLoadBufferViewAsync(Y,c){return this._applyExtensions(c,"loadBufferView",(h=>h.loadBufferViewAsync&&h.loadBufferViewAsync(Y,c)))}_extensionsLoadBufferAsync(Y,c,h,C){return this._applyExtensions(c,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(Y,c,h,C)))}static LoadExtensionAsync(Y,c,h,C){if(!c.extensions)return null;const E=c.extensions[h];return E?C(`${Y}/extensions/${h}`,E):null}static LoadExtraAsync(Y,c,h,C){if(!c.extras)return null;const E=c.extras[h];return E?C(`${Y}/extras/${h}`,E):null}isExtensionUsed(Y){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Y)}logOpen(Y){this._parent._logOpen(Y)}logClose(){this._parent._logClose()}log(Y){this._parent._log(Y)}startPerformanceCounter(Y){this._parent._startPerformanceCounter(Y)}endPerformanceCounter(Y){this._parent._endPerformanceCounter(Y)}}u.DefaultSampler={index:-1},A.c._CreateGLTF2Loader=Y=>new u(Y);var i=h(14413),R=h(13068),B=h(12906),t=h(14415),F=h(14419);class J extends F.b{constructor(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Y),this._texture=Y.getEngine().createRawCubeTexture(c,h,C,E,N,Q,b,H)}update(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Y,c,h,C,E)}updateRGBDAsync(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,t.h)(this._texture,Y,c,h,C).then((()=>{}))}clone(){return B.d.Clone((()=>{const Y=this.ZY(),c=this._texture,h=new J(Y,c._bufferViewArray,c.width,c.format,c.type,c.generateMipMaps,c.invertY,c.samplingMode,c._compression);return 13===c.source&&h.updateRGBDAsync(c._bufferViewArrayArray,c._sphericalPolynomial,c._lodGenerationScale,c._lodGenerationOffset),h}),this)}}const j="EXT_lights_image_based";class S{constructor(Y){this.name=j,this._loader=Y,this.enabled=this._loader.isExtensionUsed(j)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Dc.extensions;if(Y&&Y[this.name]){const c=Y[this.name];this._lights=c.lights}}loadSceneAsync(Y,c){return u.LoadExtensionAsync(Y,c,this.name,(async(h,C)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(Y,c)),this._loader.logOpen(`${h}`);const N=f.Get(`${h}/light`,this._lights,C.Hc);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${C.Hc}`,N).then((Y=>{this._loader.babylonScene.environmentTexture=Y}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(Y,c){if(!c._loaded){const h=new Array;this._loader.logOpen(`${Y}`);const C=new Array(c.specularImages.length);for(let E=0;E<c.specularImages.length;E++){const N=c.specularImages[E];C[E]=new Array(N.length);for(let c=0;c<N.length;c++){const Q=`${Y}/specularImages/${E}/${c}`;this._loader.logOpen(`${Q}`);const b=N[c],H=f.Get(Q,this._loader.Dc.images,b);h.push(this._loader.loadImageAsync(`/images/${b}`,H).then((Y=>{C[E][c]=Y}))),this._loader.logClose()}}this._loader.logClose(),c._loaded=Promise.all(h).then((async()=>{const h=new J(this._loader.babylonScene,null,c.specularImageSize);if(h.name=c.name||"environment",c._babylonTexture=h,void 0!=c.Oc&&(h.level=c.Oc),c.rotation){let Y=E.Quaternion.dh(c.rotation);this._loader.babylonScene.useRightHandedSystem||(Y=E.Quaternion.Inverse(Y)),E.Matrix.FromQuaternionToRef(Y,h.getReflectionTextureMatrix())}if(!c.irradianceCoefficients)throw new Error(`${Y}: Irradiance coefficients are missing`);const N=R.e.dh(c.irradianceCoefficients);N.scaleInPlace(c.Oc),N.convertIrradianceToLambertianRadiance();const Q=R.f.FromHarmonics(N),b=(C.length-1)/Math.log2(c.specularImageSize);return await h.updateRGBDAsync(C,Q,b)}))}return c._loaded.then((()=>c._babylonTexture))}}g(j),v(j,!0,(Y=>new S(Y)));h(13446);const mY="EXT_mesh_gpu_instancing";class YY{constructor(Y){this.name=mY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(mY)}dispose(){this._loader=null}loadNodeAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(Y,C)=>{this._loader._disableInstancedMesh++;const N=this._loader.loadNodeAsync(`/nodes/${c.index}`,c,h);if(this._loader._disableInstancedMesh--,!c._primitiveBabylonMeshes)return await N;const Q=new Array;let b=0;const H=c=>{if(void 0==C.attributes[c])return void Q.push(Promise.resolve(null));const h=f.Get(`${Y}/attributes/${c}`,this._loader.Dc.accessors,C.attributes[c]);if(Q.push(this._loader._loadFloatAccessorAsync(`/accessors/${h.bufferView}`,h)),0===b)b=h.count;else if(b!==h.count)throw new Error(`${Y}/attributes: Instance buffer accessors do not have the same count.`)};return H("TRANSLATION"),H("ROTATION"),H("SCALE"),await N.then((async Y=>{const[h,C,N]=await Promise.all(Q),H=new Float32Array(16*b);E.TmpVectors.bh[0].Vc(0,0,0),E.TmpVectors.Quaternion[0].Vc(0,0,0,1),E.TmpVectors.bh[1].Vc(1,1,1);for(let c=0;c<b;++c)h&&E.bh.FromArrayToRef(h,3*c,E.TmpVectors.bh[0]),C&&E.Quaternion.FromArrayToRef(C,4*c,E.TmpVectors.Quaternion[0]),N&&E.bh.FromArrayToRef(N,3*c,E.TmpVectors.bh[1]),E.Matrix.ComposeToRef(E.TmpVectors.bh[1],E.TmpVectors.Quaternion[0],E.TmpVectors.bh[0],E.TmpVectors.Matrix[0]),E.TmpVectors.Matrix[0].copyToArray(H,16*c);for(const E of c._primitiveBabylonMeshes)E.NM("matrix",H,16,!0);return Y}))}))}}g(mY),v(mY,!0,(Y=>new YY(Y)));let cY=0,hY=null;class CY{static get Default(){return CY._Default||(CY._Default=new CY),CY._Default}constructor(){const Y=CY.Configuration.decoder;this._decoderModulePromise=Q.Tools.LoadBabylonScriptAsync(Y.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Y,c,h,C,E){await this._decoderModulePromise,0===cY&&(MeshoptDecoder.useWorkers(1),cY=1);const N=await MeshoptDecoder.decodeGltfBufferAsync(c,h,Y,C,E);return null!==hY&&clearTimeout(hY),hY=setTimeout((()=>{MeshoptDecoder.useWorkers(0),cY=0,hY=null}),1e3),N}}CY.Configuration={decoder:{url:`${Q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},CY._Default=null;const EY="EXT_meshopt_compression";class NY{constructor(Y){this.name=EY,this.enabled=Y.isExtensionUsed(EY),this._loader=Y}dispose(){this._loader=null}loadBufferViewAsync(Y,c){return u.LoadExtensionAsync(Y,c,this.name,(async(h,C)=>{const E=c;if(E._meshOptData)return await E._meshOptData;const N=f.Get(`${Y}/buffer`,this._loader.Dc.buffers,C.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${N.index}`,N,C.byteOffset||0,C.byteLength).then((async Y=>await CY.Default.decodeGltfBufferAsync(Y,C.count,C.byteStride,C.mode,C.filter))),await E._meshOptData}))}}g(EY),v(EY,!0,(Y=>new NY(Y)));const QY="EXT_texture_webp";class bY{constructor(Y){this.name=QY,this._loader=Y,this.enabled=Y.isExtensionUsed(QY)}dispose(){this._loader=null}_loadTextureAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=void 0==c.sampler?u.DefaultSampler:f.Get(`${Y}/sampler`,this._loader.Dc.samplers,c.sampler),Q=f.Get(`${C}/source`,this._loader.Dc.images,E.source);return await this._loader._createTextureAsync(Y,N,Q,(Y=>{h(Y)}),void 0,!c._textureInfo.nonColorData)}))}}g(QY),v(QY,!0,(Y=>new bY(Y)));const HY="EXT_texture_avif";class wY{constructor(Y){this.name=HY,this._loader=Y,this.enabled=Y.isExtensionUsed(HY)}dispose(){this._loader=null}_loadTextureAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=void 0==c.sampler?u.DefaultSampler:f.Get(`${Y}/sampler`,this._loader.Dc.samplers,c.sampler),Q=f.Get(`${C}/source`,this._loader.Dc.images,E.source);return await this._loader._createTextureAsync(Y,N,Q,(Y=>{h(Y)}),void 0,!c._textureInfo.nonColorData)}))}}g(HY),v(HY,!0,(Y=>new wY(Y)));var WY=h(14409),qY=h(13422);const kY="EXT_lights_ies";class MY{constructor(Y){this.name=kY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(kY)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Dc.extensions;if(Y&&Y[this.name]){const c=Y[this.name];this._lights=c.lights,f.Assign(this._lights)}}loadNodeAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,Q)=>{let b,H;this._loader._allMaterialsDirtyRequired=!0;const w=await this._loader.loadNodeAsync(Y,c,(Y=>{H=f.Get(C,this._lights,Q.Hc);const c=H.name||Y.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,b=new WY.e(c,E.bh.Zero(),E.bh.Backward(),0,1,this._loader.babylonScene),b.angle=Math.PI/2,b.innerAngle=0,b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,H._babylonLight=b,b.falloffType=qY.e.FALLOFF_GLTF,b.oc=Q.color?N.ph.dh(Q.color):N.ph.White(),b.Oc=Q.multiplier||1,b.range=Number.MAX_VALUE,b.parent=Y,this._loader._babylonLights.push(b),u.AddPointerMetadata(b,C),h(Y)}));let W;if(H.uri)W=await this._loader.loadUriAsync(Y,H,H.uri);else{const c=f.Get(`${Y}/bufferView`,this._loader.Dc.bufferViews,H.bufferView);W=await this._loader.loadBufferViewAsync(`/bufferViews/${c.index}`,c)}return b.iesProfileTexture=new e.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,W,!0,void 0,void 0,void 0,void 0,".ies"),w}))}}g(kY),v(kY,!0,(Y=>new MY(Y)));var pY=h(14431);const PY="KHR_draco_mesh_compression";class yY{constructor(Y){this.name=PY,this.useNormalizedFlagFromAccessor=!0,this._loader=Y,this.enabled=pY.e.DefaultAvailable&&this._loader.isExtensionUsed(PY)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{if(void 0!=c.mode&&4!==c.mode&&5!==c.mode)throw new Error(`${Y}: Unsupported mode ${c.mode}`);const N={},Q={},b=(Y,C)=>{const b=E.attributes[Y];if(void 0!=b&&(h._delayInfo=h._delayInfo||[],-1===h._delayInfo.indexOf(C)&&h._delayInfo.push(C),N[C]=b,this.useNormalizedFlagFromAccessor)){const h=f.TryGet(this._loader.Dc.accessors,c.attributes[Y]);h&&(Q[C]=h.normalized||!1)}};b("POSITION",X.f.PositionKind),b("NORMAL",X.f.NormalKind),b("TANGENT",X.f.TangentKind),b("TEXCOORD_0",X.f.UVKind),b("TEXCOORD_1",X.f.UV2Kind),b("TEXCOORD_2",X.f.UV3Kind),b("TEXCOORD_3",X.f.UV4Kind),b("TEXCOORD_4",X.f.UV5Kind),b("TEXCOORD_5",X.f.UV6Kind),b("JOINTS_0",X.f.MatricesIndicesKind),b("WEIGHTS_0",X.f.MatricesWeightsKind),b("COLOR_0",X.f.ColorKind);const H=f.Get(C,this._loader.Dc.bufferViews,E.bufferView);return H._dracoBabylonGeometry||(H._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((async C=>{const E=this.dracoDecoder||pY.e.Default,b=f.TryGet(this._loader.Dc.accessors,c.attributes.POSITION),H=this._loader.parent.alwaysComputeBoundingBox||h.skeleton||!b?null:L(b);return await E._decodeMeshToGeometryForGltfAsync(h.name,this._loader.babylonScene,C,N,Q,H).catch((c=>{throw new Error(`${Y}: ${c.message}`)}))}))),await H._dracoBabylonGeometry}))}}g(PY),v(PY,!0,(Y=>new yY(Y)));var dY=h(14437),DY=h(12853),TY=h(12859),eY=h(13294),rY=h(13484),XY=h(12825);eY.c.AddNodeConstructor("Light_Type_0",((Y,c)=>()=>new ZY(Y,E.bh.Zero(),c)));class ZY extends rY.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(Y){this._shadowAngle=Y,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Y){const c=this.needCube();if(this._direction=Y,this.needCube()!==c&&this._shadowGenerators){const Y=this._shadowGenerators.values();for(let c=Y.next();!0!==c.done;c=Y.next()){c.value.recreateShadowMap()}}}constructor(Y,c,h){super(Y,h),this._shadowAngle=Math.PI/2,this.position=c}getClassName(){return"PointLight"}getTypeID(){return qY.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Y){if(this.direction)return super.getShadowDirection(Y);switch(Y){case 0:return new E.bh(1,0,0);case 1:return new E.bh(-1,0,0);case 2:return new E.bh(0,-1,0);case 3:return new E.bh(0,1,0);case 4:return new E.bh(0,0,1);case 5:return new E.bh(0,0,-1)}return E.bh.Zero()}_setDefaultShadowProjectionMatrix(Y,c,h){const C=this.ZY().activeCamera;if(!C)return;const N=void 0!==this.shadowMinZ?this.shadowMinZ:C.ac,Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,b=this.ZY().getEngine().o;E.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,b?Q:N,b?N:Q,Y,!0,this._scene.getEngine().isNDCHalfZRange,void 0,b)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Y,c){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,c):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,c),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,c),this}transferToNodeMaterialEffect(Y,c){return this.computeTransformedInformation()?Y.setFloat3(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Y.setFloat3(c,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Y,c){Y["POINTLIGHT"+c]=!0}}(0,DY.b)([(0,TY.N)()],ZY.prototype,"shadowAngle",null),(0,XY.e)("BABYLON.PointLight",ZY);const aY="KHR_lights_punctual";class GY{constructor(Y){this.name=aY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(aY)}dispose(){this._loader=null,delete this._lights}onLoading(){const Y=this._loader.Dc.extensions;if(Y&&Y[this.name]){const c=Y[this.name];this._lights=c.lights,f.Assign(this._lights)}}loadNodeAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,Q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Y,c,(Y=>{let c;const b=f.Get(C,this._lights,Q.Hc),H=b.name||Y.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,b.type){case"directional":{const Y=new dY.c(H,E.bh.Backward(),this._loader.babylonScene);Y.position.nc(0),c=Y;break}case"point":c=new ZY(H,E.bh.Zero(),this._loader.babylonScene);break;case"spot":{const Y=new WY.e(H,E.bh.Zero(),E.bh.Backward(),0,1,this._loader.babylonScene);Y.angle=2*(b.spot&&b.spot.outerConeAngle||Math.PI/4),Y.innerAngle=2*(b.spot&&b.spot.innerConeAngle||0),c=Y;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${C}: Invalid light type (${b.type})`)}c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,b._babylonLight=c,c.falloffType=qY.e.FALLOFF_GLTF,c.oc=b.color?N.ph.dh(b.color):N.ph.White(),c.Oc=void 0==b.Oc?1:b.Oc,c.range=void 0==b.range?Number.MAX_VALUE:b.range,c.parent=Y,this._loader._babylonLights.push(c),u.AddPointerMetadata(c,C),h(Y)})))))}}g(aY),v(aY,!0,(Y=>new GY(Y)));const KY="KHR_materials_pbrSpecularGlossiness";class IY{constructor(Y){this.name=KY,this.order=200,this._loader=Y,this.enabled=this._loader.isExtensionUsed(KY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialBasePropertiesAsync(Y,c,h)),N.push(this._loadSpecularGlossinessPropertiesAsync(C,E,h)),this._loader.loadMaterialAlphaProperties(Y,c,h),await Promise.all(N).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.metallic=null,h.roughness=null,c.diffuseFactor?(h.albedoColor=N.ph.dh(c.diffuseFactor),h.alpha=c.diffuseFactor[3]):h.albedoColor=N.ph.White(),h.reflectivityColor=c.specularFactor?N.ph.dh(c.specularFactor):N.ph.White(),h.microSurface=void 0==c.glossinessFactor?1:c.glossinessFactor,c.diffuseTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTexture`,c.diffuseTexture,(Y=>{Y.name=`${h.name} (Diffuse)`,h.albedoTexture=Y}))),c.specularGlossinessTexture&&(C.push(this._loader.loadTextureInfoAsync(`${Y}/specularGlossinessTexture`,c.specularGlossinessTexture,(Y=>{Y.name=`${h.name} (Specular Glossiness)`,h.reflectivityTexture=Y,h.reflectivityTexture.Zc=!0}))),h.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(C).then((()=>{}))}}g(KY),v(KY,!0,(Y=>new IY(Y)));const sY="KHR_materials_unlit";class xY{constructor(Y){this.name=sY,this.order=210,this._loader=Y,this.enabled=this._loader.isExtensionUsed(sY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async()=>await this._loadUnlitPropertiesAsync(Y,c,h)))}_loadUnlitPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;h.unlit=!0;const E=c.pbrMetallicRoughness;return E&&(E.baseColorFactor?(h.albedoColor=N.ph.dh(E.baseColorFactor),h.alpha=E.baseColorFactor[3]):h.albedoColor=N.ph.White(),E.baseColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/baseColorTexture`,E.baseColorTexture,(Y=>{Y.name=`${h.name} (Base Color)`,h.albedoTexture=Y})))),c.doubleSided&&(h.Ac=!1,h.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Y,c,h),Promise.all(C).then((()=>{}))}}g(sY),v(sY,!0,(Y=>new xY(Y)));const AY="KHR_materials_clearcoat";class VY{constructor(Y){this.name=AY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(AY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadClearCoatPropertiesAsync(C,E,h)),await Promise.all(N)}))}_loadClearCoatPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.clearCoat.isEnabled=!0,h.clearCoat.useRoughnessFromMainTexture=!1,h.clearCoat.remapF0OnInterfaceChange=!1,void 0!=c.clearcoatFactor?h.clearCoat.Oc=c.clearcoatFactor:h.clearCoat.Oc=0,c.clearcoatTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatTexture`,c.clearcoatTexture,(Y=>{Y.name=`${h.name} (ClearCoat)`,h.clearCoat.texture=Y}))),void 0!=c.clearcoatRoughnessFactor?h.clearCoat.roughness=c.clearcoatRoughnessFactor:h.clearCoat.roughness=0,c.clearcoatRoughnessTexture&&(c.clearcoatRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatRoughnessTexture`,c.clearcoatRoughnessTexture,(Y=>{Y.name=`${h.name} (ClearCoat Roughness)`,h.clearCoat.textureRoughness=Y})))),c.clearcoatNormalTexture&&(c.clearcoatNormalTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${Y}/clearcoatNormalTexture`,c.clearcoatNormalTexture,(Y=>{Y.name=`${h.name} (ClearCoat Normal)`,h.clearCoat.bumpTexture=Y}))),h.invertNormalMapX=!h.ZY().useRightHandedSystem,h.invertNormalMapY=h.ZY().useRightHandedSystem,void 0!=c.clearcoatNormalTexture.scale&&(h.clearCoat.bumpTexture.level=c.clearcoatNormalTexture.scale)),Promise.all(C).then((()=>{}))}}g(AY),v(AY,!0,(Y=>new VY(Y)));const UY="KHR_materials_iridescence";class lY{constructor(Y){this.name=UY,this.order=195,this._loader=Y,this.enabled=this._loader.isExtensionUsed(UY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadIridescencePropertiesAsync(C,E,h)),await Promise.all(N).then((()=>{}))}))}_loadIridescencePropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.iridescence.isEnabled=!0,h.iridescence.Oc=c.iridescenceFactor??0,h.iridescence.indexOfRefraction=c.iridescenceIor??c.iridescenceIOR??1.3,h.iridescence.minimumThickness=c.iridescenceThicknessMinimum??100,h.iridescence.maximumThickness=c.iridescenceThicknessMaximum??400,c.iridescenceTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/iridescenceTexture`,c.iridescenceTexture,(Y=>{Y.name=`${h.name} (Iridescence)`,h.iridescence.texture=Y}))),c.iridescenceThicknessTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/iridescenceThicknessTexture`,c.iridescenceThicknessTexture,(Y=>{Y.name=`${h.name} (Iridescence Thickness)`,h.iridescence.thicknessTexture=Y}))),Promise.all(C).then((()=>{}))}}g(UY),v(UY,!0,(Y=>new lY(Y)));const nY="KHR_materials_anisotropy";class vY{constructor(Y){this.name=nY,this.order=195,this._loader=Y,this.enabled=this._loader.isExtensionUsed(nY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadIridescencePropertiesAsync(C,E,h)),await Promise.all(N)}))}async _loadIridescencePropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;h.anisotropy.isEnabled=!0,h.anisotropy.Oc=c.anisotropyStrength??0,h.anisotropy.angle=c.anisotropyRotation??0,c.anisotropyTexture&&(c.anisotropyTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${Y}/anisotropyTexture`,c.anisotropyTexture,(Y=>{Y.name=`${h.name} (Anisotropy Intensity)`,h.anisotropy.texture=Y})))),await Promise.all(C)}}g(nY),v(nY,!0,(Y=>new vY(Y)));const gY="KHR_materials_emissive_strength";class zY{constructor(Y){this.name=gY,this.order=170,this._loader=Y,this.enabled=this._loader.isExtensionUsed(gY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>await this._loader.loadMaterialPropertiesAsync(Y,c,h).then((()=>{this._loadEmissiveProperties(C,E,h)}))))}_loadEmissiveProperties(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);void 0!==c.emissiveStrength&&(h.emissiveIntensity=c.emissiveStrength)}}g(gY),v(gY,!0,(Y=>new zY(Y)));const OY="KHR_materials_sheen";class oY{constructor(Y){this.name=OY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(OY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadSheenPropertiesAsync(C,E,h)),await Promise.all(N).then((()=>{}))}))}_loadSheenPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.sheen.isEnabled=!0,h.sheen.Oc=1,void 0!=c.sheenColorFactor?h.sheen.color=N.ph.dh(c.sheenColorFactor):h.sheen.color=N.ph.Black(),c.sheenColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/sheenColorTexture`,c.sheenColorTexture,(Y=>{Y.name=`${h.name} (Sheen Color)`,h.sheen.texture=Y}))),void 0!==c.sheenRoughnessFactor?h.sheen.roughness=c.sheenRoughnessFactor:h.sheen.roughness=0,c.sheenRoughnessTexture&&(c.sheenRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${Y}/sheenRoughnessTexture`,c.sheenRoughnessTexture,(Y=>{Y.name=`${h.name} (Sheen Roughness)`,h.sheen.textureRoughness=Y})))),h.sheen.albedoScaling=!0,h.sheen.useRoughnessFromMainTexture=!1,Promise.all(C).then((()=>{}))}}g(OY),v(OY,!0,(Y=>new oY(Y)));var fY=h(13349);const LY="KHR_materials_specular";class uY{constructor(Y){this.name=LY,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(LY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;if(N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadSpecularPropertiesAsync(C,E,h)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&h instanceof T.d){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(h.brdf.dielectricSpecularModel=fY.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,h.brdf.conductorSpecularModel=fY.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(N).then((()=>{}))}))}_loadSpecularPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return void 0!==c.specularFactor&&(h.metallicF0Factor=c.specularFactor),void 0!==c.specularColorFactor&&(h.metallicReflectanceColor=N.ph.dh(c.specularColorFactor)),c.specularTexture&&(c.specularTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${Y}/specularTexture`,c.specularTexture,(Y=>{Y.name=`${h.name} (Specular)`,h.metallicReflectanceTexture=Y,h.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),c.specularColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/specularColorTexture`,c.specularColorTexture,(Y=>{Y.name=`${h.name} (Specular Color)`,h.reflectanceTexture=Y}))),Promise.all(C).then((()=>{}))}}g(LY),v(LY,!0,(Y=>new uY(Y)));const iY="KHR_materials_ior";class RY{constructor(Y){this.name=iY,this.order=180,this._loader=Y,this.enabled=this._loader.isExtensionUsed(iY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadIorPropertiesAsync(C,E,h)),await Promise.all(N).then((()=>{}))}))}_loadIorPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);return void 0!==c.ior?h.indexOfRefraction=c.ior:h.indexOfRefraction=RY._DEFAULT_IOR,Promise.resolve()}}RY._DEFAULT_IOR=1.5,g(iY),v(iY,!0,(Y=>new RY(Y)));const BY="KHR_materials_variants";class tY{constructor(Y){this.name=BY,this._loader=Y,this.enabled=this._loader.isExtensionUsed(BY)}dispose(){this._loader=null}static GetAvailableVariants(Y){const c=this._GetExtensionMetadata(Y);return c?Object.keys(c.variants):[]}getAvailableVariants(Y){return tY.GetAvailableVariants(Y)}static SelectVariant(Y,c){const h=this._GetExtensionMetadata(Y);if(!h)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${BY} extension`);const C=Y=>{const c=h.variants[Y];if(c)for(const h of c)h.mesh.material=h.material};if(c instanceof Array)for(const E of c)C(E);else C(c);h.lastSelected=c}selectVariant(Y,c){tY.SelectVariant(Y,c)}static Reset(Y){const c=this._GetExtensionMetadata(Y);if(!c)throw new Error(`Cannot reset on a glTF mesh that does not have the ${BY} extension`);for(const h of c.original)h.mesh.material=h.material;c.lastSelected=null}reset(Y){tY.Reset(Y)}static GetLastSelectedVariant(Y){const c=this._GetExtensionMetadata(Y);if(!c)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${BY} extension`);return c.lastSelected}getLastSelectedVariant(Y){return tY.GetLastSelectedVariant(Y)}static _GetExtensionMetadata(Y){var c,h;return(null===Y||void 0===Y||null===(c=Y._internalMetadata)||void 0===c||null===(h=c.Dc)||void 0===h?void 0:h[BY])||null}onLoading(){const Y=this._loader.Dc.extensions;if(Y&&Y[this.name]){const c=Y[this.name];this._variants=c.variants}}onReady(){const Y=this._loader.rootBabylonMesh;if(Y){var c;const h=this._loader.parent.extensionOptions[BY];null!==h&&void 0!==h&&h.defaultVariant&&tY.SelectVariant(Y,h.defaultVariant),null===h||void 0===h||null===(c=h.onLoaded)||void 0===c||c.call(h,{get variants(){return tY.GetAvailableVariants(Y)},get selectedVariant(){const c=tY.GetLastSelectedVariant(Y);return c?Array.isArray(c)?c[0]:c:tY.GetAvailableVariants(Y)[0]},set selectedVariant(c){tY.SelectVariant(Y,c)}})}}_loadMeshPrimitiveAsync(Y,c,h,C,E,N){return u.LoadExtensionAsync(Y,E,this.name,(async(Q,b)=>{const H=new Array;return H.push(this._loader._loadMeshPrimitiveAsync(Y,c,h,C,E,(c=>{if(N(c),c instanceof G.e){const h=u._GetDrawMode(Y,E.mode),C=this._loader.rootBabylonMesh,N=C?C._internalMetadata=C._internalMetadata||{}:{},w=N.Dc=N.Dc||{},W=w[BY]=w[BY]||{lastSelected:null,original:[],variants:{}};W.original.push({mesh:c,material:c.material});for(let Y=0;Y<b.mappings.length;++Y){const E=b.mappings[Y],N=f.Get(`${Q}/mappings/${Y}/material`,this._loader.Dc.materials,E.material);H.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,N,c,h,(Y=>{for(let h=0;h<E.variants.length;++h){const N=E.variants[h],Q=f.Get(`/extensions/${BY}/variants/${N}`,this._variants,N);W.variants[Q.name]=W.variants[Q.name]||[],W.variants[Q.name].push({mesh:c,material:Y}),c.onClonedObservable.add((Y=>{const h=Y;let E=null,N=h;do{if(N=N.parent,!N)return;E=tY._GetExtensionMetadata(N)}while(null===E);if(C&&E===tY._GetExtensionMetadata(C)){N._internalMetadata={};for(const Y in C._internalMetadata)N._internalMetadata[Y]=C._internalMetadata[Y];N._internalMetadata.Dc=[];for(const Y in C._internalMetadata.Dc)N._internalMetadata.Dc[Y]=C._internalMetadata.Dc[Y];N._internalMetadata.Dc[BY]={lastSelected:null,original:[],variants:{}};for(const Y of E.original)N._internalMetadata.Dc[BY].original.push({mesh:Y.mesh,material:Y.material});for(const Y in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,Y)){N._internalMetadata.Dc[BY].variants[Y]=[];for(const c of E.variants[Y])N._internalMetadata.Dc[BY].variants[Y].push({mesh:c.mesh,material:c.material})}E=N._internalMetadata.Dc[BY]}for(const C of E.original)C.mesh===c&&(C.mesh=h);for(const C of E.variants[Q.name])C.mesh===c&&(C.mesh=h)}))}})))}}}))),await Promise.all(H).then((Y=>{let[c]=Y;return c}))}))}}g(BY),v(BY,!0,(Y=>new tY(Y)));var FY=h(12938);class JY{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:fY.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Y,c){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...JY._GetDefaultOptions(),...Y},this._scene=c,this._scene._transmissionHelper=this,this.onErrorObservable=new W.c,this._scene.Mc.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Y){if(!Object.keys(Y).filter((c=>this._options[c]!==Y[c])).length)return;const c={...this._options,...Y},h=this._options;this._options=c,c.renderSize===h.renderSize&&c.renderTargetTextureType===h.renderTargetTextureType&&c.generateMipmaps===h.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=c.samples,this._opaqueRenderTarget.lodGenerationScale=c.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=c.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Y){return!!Y&&!!(Y instanceof T.d&&Y.subSurface.isRefractionEnabled)}_addMesh(Y){this._materialObservers[Y.uniqueId]=Y.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(Y.material)?(Y.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Y)&&this._transparentMeshesCache.push(Y)):-1===this._opaqueMeshesCache.indexOf(Y)&&this._opaqueMeshesCache.push(Y)}))}_removeMesh(Y){Y.onMaterialChangedObservable.remove(this._materialObservers[Y.uniqueId]),delete this._materialObservers[Y.uniqueId];let c=this._transparentMeshesCache.indexOf(Y);-1!==c&&this._transparentMeshesCache.splice(c,1),c=this._opaqueMeshesCache.indexOf(Y),-1!==c&&this._opaqueMeshesCache.splice(c,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Y){const c=this._transparentMeshesCache.indexOf(Y),h=this._opaqueMeshesCache.indexOf(Y);this._shouldRenderAsTransmission(Y.material)?(Y.material instanceof T.d&&(Y.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==h?(this._opaqueMeshesCache.splice(h,1),this._transparentMeshesCache.push(Y)):-1===c&&this._transparentMeshesCache.push(Y)):-1!==c?(this._transparentMeshesCache.splice(c,1),this._opaqueMeshesCache.push(Y)):-1===h&&this._opaqueMeshesCache.push(Y)}_isRenderTargetValid(){var Y;return null!==(null===(Y=this._opaqueRenderTarget)||void 0===Y?void 0:Y.getInternalTexture())}_setupRenderTargets(){var Y;let c;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new FY.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Y=this._options.clearColor)||void 0===Y?void 0:Y.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Y=>{c=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Y.clearColor.N(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Y.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=c}));for(const h of this._transparentMeshesCache)this._shouldRenderAsTransmission(h.material)&&(h.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const jY="KHR_materials_transmission";class SY{constructor(Y){this.name=jY,this.order=175,this._loader=Y,this.enabled=this._loader.isExtensionUsed(jY),this.enabled&&(Y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadTransparentPropertiesAsync(C,c,h,E)),await Promise.all(N).then((()=>{}))}))}_loadTransparentPropertiesAsync(Y,c,h,C){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const E=h;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===C.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var N;E.subSurface.refractionIntensity=C.transmissionFactor;const Y=E.ZY();if(E.subSurface.refractionIntensity&&!Y._transmissionHelper)new JY({},E.ZY());else if(E.subSurface.refractionIntensity&&(null===(N=Y._transmissionHelper)||void 0===N||!N._isRenderTargetValid())){var Q;null===(Q=Y._transmissionHelper)||void 0===Q||Q._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,C.transmissionTexture?(C.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Y}/transmissionTexture`,C.transmissionTexture,void 0).then((Y=>{Y.name=`${h.name} (Transmission)`,E.subSurface.refractionIntensityTexture=Y,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}g(jY),v(jY,!0,(Y=>new SY(Y)));const mc="KHR_materials_diffuse_transmission";class Yc{constructor(Y){this.name=mc,this.order=174,this._loader=Y,this.enabled=this._loader.isExtensionUsed(mc),this.enabled&&(Y.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadTranslucentPropertiesAsync(C,c,h,E)),await Promise.all(N).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Y,c,h,C){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const E=h;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===C.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=C.diffuseTransmissionFactor;const Q=new Array;return E.subSurface.useGltfStyleTextures=!0,C.diffuseTransmissionTexture&&(C.diffuseTransmissionTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTransmissionTexture`,C.diffuseTransmissionTexture).then((Y=>{Y.name=`${h.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=Y})))),void 0!==C.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=N.ph.dh(C.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=N.ph.White(),C.diffuseTransmissionColorTexture&&Q.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseTransmissionColorTexture`,C.diffuseTransmissionColorTexture).then((Y=>{Y.name=`${h.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=Y}))),Promise.all(Q).then((()=>{}))}}g(mc),v(mc,!0,(Y=>new Yc(Y)));const cc="KHR_materials_volume";class hc{constructor(Y){this.name=cc,this.order=173,this._loader=Y,this.enabled=this._loader.isExtensionUsed(cc),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadVolumePropertiesAsync(C,c,h,E)),await Promise.all(N).then((()=>{}))}))}_loadVolumePropertiesAsync(Y,c,h,C){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);if(!h.subSurface.isRefractionEnabled&&!h.subSurface.isTranslucencyEnabled||!C.thicknessFactor)return Promise.resolve();h.subSurface.volumeIndexOfRefraction=h.indexOfRefraction;const E=void 0!==C.attenuationDistance?C.attenuationDistance:Number.MAX_VALUE;return h.subSurface.tintColorAtDistance=E,void 0!==C.attenuationColor&&3==C.attenuationColor.length&&h.subSurface.tintColor.Vc(C.attenuationColor[0],C.attenuationColor[1],C.attenuationColor[2]),h.subSurface.minimumThickness=0,h.subSurface.maximumThickness=C.thicknessFactor,h.subSurface.useThicknessAsDepth=!0,C.thicknessTexture?(C.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Y}/thicknessTexture`,C.thicknessTexture).then((Y=>{Y.name=`${h.name} (Thickness)`,h.subSurface.thicknessTexture=Y,h.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}g(cc),v(cc,!0,(Y=>new hc(Y)));const Cc="KHR_materials_dispersion";class Ec{constructor(Y){this.name=Cc,this.order=174,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Cc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadDispersionPropertiesAsync(C,c,h,E)),await Promise.all(N).then((()=>{}))}))}_loadDispersionPropertiesAsync(Y,c,h,C){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);return h.subSurface.isRefractionEnabled&&C.dispersion?(h.subSurface.isDispersionEnabled=!0,h.subSurface.dispersion=C.dispersion,Promise.resolve()):Promise.resolve()}}g(Cc),v(Cc,!0,(Y=>new Ec(Y)));const Nc="EXT_materials_diffuse_roughness";class Qc{constructor(Y){this.name=Nc,this.order=190,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Nc)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(Y,c,h)),N.push(this._loadDiffuseRoughnessPropertiesAsync(C,E,h)),await Promise.all(N).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Y,c,h){if(!(h instanceof T.d))throw new Error(`${Y}: Material type not supported`);const C=new Array;return h.brdf.baseDiffuseModel=fY.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=c.diffuseRoughnessFactor?h.baseDiffuseRoughness=c.diffuseRoughnessFactor:h.baseDiffuseRoughness=0,c.diffuseRoughnessTexture&&C.push(this._loader.loadTextureInfoAsync(`${Y}/diffuseRoughnessTexture`,c.diffuseRoughnessTexture,(Y=>{Y.name=`${h.name} (Diffuse Roughness)`,h.baseDiffuseRoughnessTexture=Y}))),Promise.all(C).then((()=>{}))}}g(Nc),v(Nc,!0,(Y=>new Qc(Y)));const bc="KHR_mesh_quantization";class Hc{constructor(Y){this.name=bc,this.enabled=Y.isExtensionUsed(bc)}dispose(){}}g(bc),v(bc,!0,(Y=>new Hc(Y)));const wc="KHR_texture_basisu";class Wc{constructor(Y){this.name=wc,this._loader=Y,this.enabled=Y.isExtensionUsed(wc)}dispose(){this._loader=null}_loadTextureAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>{const N=void 0==c.sampler?u.DefaultSampler:f.Get(`${Y}/sampler`,this._loader.Dc.samplers,c.sampler),Q=f.Get(`${C}/source`,this._loader.Dc.images,E.source);return await this._loader._createTextureAsync(Y,N,Q,(Y=>{h(Y)}),c._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!c._textureInfo.nonColorData)}))}}g(wc),v(wc,!0,(Y=>new Wc(Y)));const qc="KHR_texture_transform";class kc{constructor(Y){this.name=qc,this._loader=Y,this.enabled=this._loader.isExtensionUsed(qc)}dispose(){this._loader=null}loadTextureInfoAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(C,E)=>await this._loader.loadTextureInfoAsync(Y,c,(Y=>{if(!(Y instanceof e.d))throw new Error(`${C}: Texture type not supported`);E.offset&&(Y.uOffset=E.offset[0],Y.vOffset=E.offset[1]),Y.uRotationCenter=0,Y.vRotationCenter=0,E.rotation&&(Y.wAng=-E.rotation),E.scale&&(Y.uScale=E.scale[0],Y.vScale=E.scale[1]),void 0!=E.texCoord&&(Y.coordinatesIndex=E.texCoord),h(Y)}))))}}g(qc),v(qc,!0,(Y=>new kc(Y)));const Mc="KHR_xmp_json_ld";class pc{constructor(Y){this.name=Mc,this.order=100,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Mc)}dispose(){this._loader=null}onLoading(){var Y,c,h;if(null===this._loader.rootBabylonMesh)return;const C=null===(Y=this._loader.Dc.extensions)||void 0===Y?void 0:Y.KHR_xmp_json_ld,E=null===(c=this._loader.Dc.asset)||void 0===c||null===(h=c.extensions)||void 0===h?void 0:h.KHR_xmp_json_ld;if(C&&E){const Y=+E.packet;C.packets&&Y<C.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=C.packets[Y])}}}function Pc(Y,c,h,C){return N.ph.dh(c,h).scale(C)}function yc(Y,c,h,C){return c[h]*C}function dc(Y,c,h,C){return-c[h]*C}function Dc(Y,c,h,C){return c[h+1]*C}function Tc(Y,c,h,C){return c[h]*C*2}function ec(Y){return{scale:[new Xc(k.d.ANIMATIONTYPE_FLOAT,`${Y}.uScale`,yc,(()=>2)),new Xc(k.d.ANIMATIONTYPE_FLOAT,`${Y}.vScale`,Dc,(()=>2))],offset:[new Xc(k.d.ANIMATIONTYPE_FLOAT,`${Y}.uOffset`,yc,(()=>2)),new Xc(k.d.ANIMATIONTYPE_FLOAT,`${Y}.vOffset`,Dc,(()=>2))],rotation:[new Xc(k.d.ANIMATIONTYPE_FLOAT,`${Y}.wAng`,dc,(()=>1))]}}g(Mc),v(Mc,!0,(Y=>new pc(Y)));class rc extends i.AnimationPropertyInfo{buildAnimations(Y,c,h,C){return[{babylonAnimatable:Y._babylonCamera,babylonAnimation:this._buildAnimation(c,h,C)}]}}class Xc extends i.AnimationPropertyInfo{buildAnimations(Y,c,h,C){const E=[];for(const N in Y._data)E.push({babylonAnimatable:Y._data[N].babylonMaterial,babylonAnimation:this._buildAnimation(c,h,C)});return E}}class Zc extends i.AnimationPropertyInfo{buildAnimations(Y,c,h,C){return[{babylonAnimatable:Y._babylonLight,babylonAnimation:this._buildAnimation(c,h,C)}]}}(0,z.o)("/cameras/{}/orthographic/xmag",[new rc(k.d.ANIMATIONTYPE_FLOAT,"orthoLeft",dc,(()=>1)),new rc(k.d.ANIMATIONTYPE_FLOAT,"orthoRight",Dc,(()=>1))]),(0,z.o)("/cameras/{}/orthographic/ymag",[new rc(k.d.ANIMATIONTYPE_FLOAT,"orthoBottom",dc,(()=>1)),new rc(k.d.ANIMATIONTYPE_FLOAT,"orthoTop",Dc,(()=>1))]),(0,z.o)("/cameras/{}/orthographic/zfar",[new rc(k.d.ANIMATIONTYPE_FLOAT,"maxZ",yc,(()=>1))]),(0,z.o)("/cameras/{}/orthographic/znear",[new rc(k.d.ANIMATIONTYPE_FLOAT,"ac",yc,(()=>1))]),(0,z.o)("/cameras/{}/perspective/yfov",[new rc(k.d.ANIMATIONTYPE_FLOAT,"fov",yc,(()=>1))]),(0,z.o)("/cameras/{}/perspective/zfar",[new rc(k.d.ANIMATIONTYPE_FLOAT,"maxZ",yc,(()=>1))]),(0,z.o)("/cameras/{}/perspective/znear",[new rc(k.d.ANIMATIONTYPE_FLOAT,"ac",yc,(()=>1))]),(0,z.o)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"albedoColor",Pc,(()=>4)),new Xc(k.d.ANIMATIONTYPE_FLOAT,"alpha",(function(Y,c,h,C){return c[h+3]*C}),(()=>4))]),(0,z.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"metallic",yc,(()=>1))]),(0,z.o)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"roughness",yc,(()=>1))]);const ac=ec("albedoTexture");(0,z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",ac.scale),(0,z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",ac.offset),(0,z.o)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",ac.rotation);const Gc=ec("metallicTexture");(0,z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Gc.scale),(0,z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Gc.offset),(0,z.o)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Gc.rotation),(0,z.o)("/materials/{}/emissiveFactor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Pc,(()=>3))]);const Kc=ec("bumpTexture");(0,z.o)("/materials/{}/normalTexture/scale",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",yc,(()=>1))]),(0,z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Kc.scale),(0,z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Kc.offset),(0,z.o)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Kc.rotation),(0,z.o)("/materials/{}/occlusionTexture/strength",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",yc,(()=>1))]);const Ic=ec("ambientTexture");(0,z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Ic.scale),(0,z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Ic.offset),(0,z.o)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Ic.rotation);const sc=ec("emissiveTexture");(0,z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",sc.scale),(0,z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",sc.offset),(0,z.o)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",sc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",yc,(()=>1))]);const xc=ec("anisotropy.texture");(0,z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",xc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",xc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",xc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",yc,(()=>1))]);const Ac=ec("clearCoat.texture");(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ac.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ac.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ac.rotation);const Vc=ec("clearCoat.bumpTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Vc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Vc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Vc.rotation);const Uc=ec("clearCoat.textureRoughness");(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Uc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Uc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Uc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_ior/ior",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",yc,(()=>1))]);const lc=ec("iridescence.texture");(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",lc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",lc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",lc.rotation);const nc=ec("iridescence.thicknessTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",nc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",nc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",nc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"sheen.color",Pc,(()=>3))]),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",yc,(()=>1))]);const vc=ec("sheen.texture");(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",vc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",vc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",vc.rotation);const gc=ec("sheen.textureRoughness");(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",gc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",gc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",gc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Pc,(()=>3))]);const zc=ec("metallicReflectanceTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",zc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",zc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",zc.rotation);const Oc=ec("reflectanceTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Oc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Oc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Oc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",yc,(()=>1))]);const oc=ec("subSurface.refractionIntensityTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",oc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",oc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",oc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Pc,(()=>3))]),(0,z.o)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",yc,(()=>1))]),(0,z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",yc,(()=>1))]);const fc=ec("subSurface.thicknessTexture");(0,z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",fc.scale),(0,z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",fc.offset),(0,z.o)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",fc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Xc(k.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",yc,(()=>1))]);const Lc=ec("subSurface.translucencyIntensityTexture");(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Lc.scale),(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Lc.offset),(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Lc.rotation),(0,z.o)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Xc(k.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Pc,(()=>3))]);const uc=ec("subSurface.translucencyColorTexture");(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",uc.scale),(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",uc.offset),(0,z.o)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",uc.rotation),(0,z.o)("/extensions/KHR_lights_punctual/lights/{}/color",[new Zc(k.d.ANIMATIONTYPE_COLOR3,"diffuse",Pc,(()=>3))]),(0,z.o)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Zc(k.d.ANIMATIONTYPE_FLOAT,"intensity",yc,(()=>1))]),(0,z.o)("/extensions/KHR_lights_punctual/lights/{}/range",[new Zc(k.d.ANIMATIONTYPE_FLOAT,"range",yc,(()=>1))]),(0,z.o)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Zc(k.d.ANIMATIONTYPE_FLOAT,"innerAngle",Tc,(()=>1))]),(0,z.o)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Zc(k.d.ANIMATIONTYPE_FLOAT,"angle",Tc,(()=>1))]),(0,z.o)("/nodes/{}/extensions/EXT_lights_ies/color",[new Zc(k.d.ANIMATIONTYPE_COLOR3,"diffuse",Pc,(()=>3))]),(0,z.o)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Zc(k.d.ANIMATIONTYPE_FLOAT,"intensity",yc,(()=>1))]);const ic="KHR_animation_pointer";class Rc{constructor(Y){this.name=ic,this._loader=Y,this._pathToObjectConverter=(0,z.k)(this._loader.Dc)}get enabled(){return this._loader.isExtensionUsed(ic)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Y,c,h,C,E){var N;const Q=null===(N=C.target.extensions)||void 0===N?void 0:N.KHR_animation_pointer;if(!Q||!this._pathToObjectConverter)return null;"pointer"!==C.target.path&&P.e.Warn(`${Y}/target/path: Value (${C.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=C.target.node&&P.e.Warn(`${Y}/target/node: Value (${C.target.node}) must not be present when using the ${this.name} extension`);const b=`${Y}/extensions/${this.name}`,H=Q.pointer;if(!H)throw new Error(`${b}: Pointer is missing`);try{const N=this._pathToObjectConverter.convert(H);if(!N.info.interpolation)throw new Error(`${b}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Y,c,h,C,{object:N.object,info:N.info.interpolation},E)}catch(w){return P.e.Warn(`${b}/pointer: Invalid pointer (${H}) skipped`),null}}}g(ic),v(ic,!0,(Y=>new Rc(Y)));class Bc{constructor(Y,c,h){this.frame=Y,this.action=c,this.onlyOnce=h,this.isDone=!1}_clone(){return new Bc(this.frame,this.action,this.onlyOnce)}}var tc=h(12715),Fc=h(12761),Jc=h(12756);class jc{get loop(){return this._loop}set loop(Y){Y!==this._loop&&(this._loop=Y,this.updateOptions({loop:Y}))}get currentTime(){var Y;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.audioContext&&(this.isPlaying||this.isPaused)){const Y=this.isPaused?0:Fc.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Y}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Y){if(Y==this._spatialSound)return;const c=this.isPlaying;this.pause(),Y?(this._spatialSound=Y,this._updateSpatialParameters()):this._disableSpatialSound(),c&&this.play()}constructor(Y,c,h){var C;let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new W.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.bh.Zero(),this._localDirection=new E.bh(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Y,h=h||p.d.LastCreatedScene)if(this._scene=h,jc._SceneComponentInitialization(h),this._readyToPlayCallback=N,this._customAttenuationFunction=(Y,c,h,C,E)=>c<h?Y*(1-c/h):0,b&&(this.autoplay=b.autoplay||!1,this._loop=b.loop||!1,void 0!==b.volume&&(this._volume=b.volume),this._spatialSound=b.spatialSound??!1,this.maxDistance=b.maxDistance??100,this.useCustomAttenuation=b.useCustomAttenuation??!1,this.rolloffFactor=b.rolloffFactor||1,this.refDistance=b.refDistance||1,this.distanceModel=b.distanceModel||"linear",this._playbackRate=b.playbackRate||1,this._streaming=b.streaming??!1,this._length=b.length,this._offset=b.offset),null!==(C=Fc.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&Fc.c.audioEngine.audioContext){this._soundGain=Fc.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Y=!0;if(c)try{"string"===typeof c?(this._urlType="String",this._url=c):c instanceof ArrayBuffer?this._urlType="ArrayBuffer":c instanceof HTMLMediaElement?this._urlType="MediaElement":c instanceof MediaStream?this._urlType="MediaStream":c instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(c)&&(this._urlType="Array");let h=[],C=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fc.c.audioEngine.audioContext.createMediaElementSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fc.c.audioEngine.audioContext.createMediaStreamSource(c),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":c.byteLength>0&&(C=!0,this._soundLoaded(c));break;case"AudioBuffer":this._audioBufferLoaded(c);break;case"String":h.push(c);case"Array":0===h.length&&(h=c);for(let Y=0;Y<h.length;Y++){const c=h[Y];if(C=b&&b.skipCodecCheck||-1!==c.indexOf(".mp3",c.length-4)&&Fc.c.audioEngine.isMP3supported||-1!==c.indexOf(".ogg",c.length-4)&&Fc.c.audioEngine.isOGGsupported||-1!==c.indexOf(".wav",c.length-4)||-1!==c.indexOf(".m4a",c.length-4)||-1!==c.indexOf(".mp4",c.length-4)||-1!==c.indexOf("blob:"),C){this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Q.Tools.SetCorsBehavior(c,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(c,(Y=>{this._soundLoaded(Y)}),void 0,!0,!0,(Y=>{Y&&P.e.Error("XHR "+Y.status+" error on: "+c+"."),P.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Y=!1}Y?C||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):P.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(H){P.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Fc.c.audioEngine&&!Fc.c.audioEngine.WarnedWebAudioUnsupported&&(P.e.Error("Web Audio is not supported by your browser."),Fc.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Y;null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Y){var c;null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.audioContext&&(this._audioBuffer=Y,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Y){var c;null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.audioContext&&Fc.c.audioEngine.audioContext.decodeAudioData(Y,(Y=>{this._audioBufferLoaded(Y)}),(Y=>{P.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+Y)}))}setAudioBuffer(Y){var c;null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&(this._audioBuffer=Y,this._isReadyToPlay=!0)}updateOptions(Y){Y&&(this.loop=Y.loop??this.loop,this.maxDistance=Y.maxDistance??this.maxDistance,this.useCustomAttenuation=Y.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Y.rolloffFactor??this.rolloffFactor,this.refDistance=Y.refDistance??this.refDistance,this.distanceModel=Y.distanceModel??this.distanceModel,this._playbackRate=Y.playbackRate??this._playbackRate,this._length=Y.length??void 0,this.spatialSound=Y.spatialSound??this._spatialSound,this._setOffset(Y.offset??void 0),this.setVolume(Y.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Y;null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&Fc.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Fc.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Y;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Y=this._soundPanner)||void 0===Y||Y.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Y;null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Y){var c;null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Y),this._isOutputConnected=!0)}setDirectionalCone(Y,c,h){c<Y?P.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Y,this._coneOuterAngle=c,this._coneOuterGain=h,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Y){if(Y!=this._coneInnerAngle){var c;if(this._coneOuterAngle<Y)return void P.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Y,null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Y){if(Y!=this._coneOuterAngle){var c;if(Y<this._coneInnerAngle)return void P.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Y,null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Y){var c;Y.equals(this._position)||(this._position.N(Y),null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Y){var c;this._localDirection=Y,null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Y=this._connectedTransformNode.getWorldMatrix(),c=E.bh.TransformNormal(this._localDirection,Y);c.normalize(),this._soundPanner.orientationX.value=c.x,this._soundPanner.orientationY.value=c.y,this._soundPanner.orientationZ.value=c.z}updateDistanceFromListener(){var Y;if(null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Y=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Hh(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Y,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Y){this._customAttenuationFunction=Y}play(Y,c,h){var C;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(C=Fc.c.audioEngine)&&void 0!==C&&C.audioContext)try{var E,N;this._clearTimeoutsAndObservers();let C=Y?(null===(E=Fc.c.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+Y:null===(N=Fc.c.audioEngine)||void 0===N?void 0:N.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Fc.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Y=()=>{var h;if(null!==(h=Fc.c.audioEngine)&&void 0!==h&&h.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=c??0;const h=this._htmlAudioElement.play();void 0!==h&&h.catch((()=>{var c,h;(null===(c=Fc.c.audioEngine)||void 0===c||c.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(h=Fc.c.audioEngine)||void 0===h?void 0:h.onAudioUnlockedObservable.addOnce((()=>{Y()})))}))}else{var C;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(C=Fc.c.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{Y()}))}};Y()}}else{var Q;const E=()=>{var E;if(null!==(E=Fc.c.audioEngine)&&void 0!==E&&E.audioContext){var N;if(h=h||this._length,void 0!==c&&this._setOffset(c),this._soundSource){const Y=this._soundSource;Y.onended=()=>{Y.disconnect()}}if(this._soundSource=null===(N=Fc.c.audioEngine)||void 0===N?void 0:N.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==c&&(this._soundSource.loopStart=c),void 0!==h&&(this._soundSource.loopEnd=(0|c)+h),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},C=Y?(null===(Q=Fc.c.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime)+Y:Fc.c.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(C,E,this.loop?void 0:h)}}};"suspended"===(null===(Q=Fc.c.audioEngine)||void 0===Q?void 0:Q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Y;"suspended"===(null===(Y=Fc.c.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?(Fc.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Fc.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=C,this.isPlaying=!0,this.isPaused=!1}catch(b){P.e.Error("Error while trying to play audio: "+this.name+", "+b.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Y){var c;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1}else if(null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.audioContext&&this._soundSource){const c=Y?Fc.c.audioEngine.audioContext.currentTime+Y:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(c)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var c;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(c=this._streamingSource)||void 0===c||c.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Fc.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Y,c){var h;null!==(h=Fc.c.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._soundGain&&(c&&Fc.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Fc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Fc.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Y,Fc.c.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=Y),this._volume=Y}setPlaybackRate(Y){this._playbackRate=Y,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Y){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Y,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Y=>this._onRegisterAfterWorldMatrixUpdate(Y),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Y){var c;if(Y.getBoundingInfo){const c=Y.getBoundingInfo();this.setPosition(c.boundingSphere.centerWorld)}else this.setPosition(Y.absolutePosition);null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Y=()=>{(0,Jc.f)((()=>this._isReadyToPlay),(()=>{h._audioBuffer=this.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play(0,this._offset,this._length)}),void 0,300)},c={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},h=new jc(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,c);return this.useCustomAttenuation&&h.setAttenuationFunction(this._customAttenuationFunction),h.setPosition(this._position),h.setPlaybackRate(this._playbackRate),Y(),h}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Y={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Y.connectedMeshId=this._connectedTransformNode.id),Y.position=this._position.Xc(),Y.refDistance=this.refDistance,Y.distanceModel=this.distanceModel,Y.isDirectional=this._isDirectional,Y.localDirectionToMesh=this._localDirection.Xc(),Y.coneInnerAngle=this._coneInnerAngle,Y.coneOuterAngle=this._coneOuterAngle,Y.coneOuterGain=this._coneOuterGain),Y}static Parse(Y,c,h,C){const N=Y.name;let Q;Q=Y.url?h+Y.url:h+N;const b={autoplay:Y.autoplay,loop:Y.loop,volume:Y.volume,spatialSound:Y.spatialSound,maxDistance:Y.maxDistance,rolloffFactor:Y.rolloffFactor,refDistance:Y.refDistance,distanceModel:Y.distanceModel,playbackRate:Y.playbackRate};let H;if(C){const Y=()=>{(0,Jc.f)((()=>C._isReadyToPlay),(()=>{H._audioBuffer=C.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,H._offset,H._length)}),void 0,300)};H=new jc(N,new ArrayBuffer(0),c,null,b),Y()}else H=new jc(N,Q,c,(()=>{c.removePendingData(H)}),b),c.addPendingData(H);if(Y.position){const c=E.bh.dh(Y.position);H.setPosition(c)}if(Y.isDirectional&&(H.setDirectionalCone(Y.coneInnerAngle||360,Y.coneOuterAngle||360,Y.coneOuterGain||0),Y.localDirectionToMesh)){const c=E.bh.dh(Y.localDirectionToMesh);H.setLocalDirectionToMesh(c)}if(Y.connectedMeshId){const h=c.getMeshById(Y.connectedMeshId);h&&H.attachToMesh(h)}return Y.metadata&&(H.metadata=Y.metadata),H}_setOffset(Y){this._offset!==Y&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Y)}_clearTimeoutsAndObservers(){var Y;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Y=Fc.c.audioEngine)||void 0===Y||Y.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}jc._SceneComponentInitialization=Y=>{throw(0,tc.c)("AudioSceneComponent")},(0,XY.e)("BABYLON.Sound",jc);class Sc{constructor(Y,c,h){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],c.length!==h.length)throw new Error("Sounds length does not equal weights length");this.loop=Y,this._weights=h;let C=0;for(const N of h)C+=N;const E=C>0?1/C:0;for(let N=0;N<this._weights.length;N++)this._weights[N]*=E;this._sounds=c;for(const N of this._sounds)N.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Y){if(Y!==this._coneInnerAngle){if(this._coneOuterAngle<Y)return void P.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Y;for(const c of this._sounds)c.directionalConeInnerAngle=Y}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Y){if(Y!==this._coneOuterAngle){if(Y<this._coneInnerAngle)return void P.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Y;for(const c of this._sounds)c.directionalConeOuterAngle=Y}}get volume(){return this._volume}set volume(Y){if(Y!==this._volume)for(const c of this._sounds)c.setVolume(Y)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Y){if(!this.isPaused){this.stop();const Y=Math.random();let c=0;for(let h=0;h<this._weights.length;h++)if(c+=this._weights[h],Y<=c){this._currentIndex=h;break}}const c=this._sounds[this._currentIndex??0];c.isReady()?c.play(0,this.isPaused?void 0:Y):c.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mh{constructor(Y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Y=Y||p.d.LastCreatedScene)&&(this._scene=Y,this.soundCollection=[],this._options=c,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Y;null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&Fc.c.audioEngine.audioContext&&(this._outputAudioNode=Fc.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Fc.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Fc.c.audioEngine&&Fc.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Y){var c;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&Y.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Y.soundTrackId&&(-1===Y.soundTrackId?this._scene.mainSoundTrack.removeSound(Y):this._scene.soundTracks&&this._scene.soundTracks[Y.soundTrackId].removeSound(Y)),this.soundCollection.push(Y),Y.soundTrackId=this.id}removeSound(Y){const c=this.soundCollection.indexOf(Y);-1!==c&&this.soundCollection.splice(c,1)}setVolume(Y){var c;null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Y)}switchPanningModelToHRTF(){var Y;if(null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Y;if(null!==(Y=Fc.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio)for(let c=0;c<this.soundCollection.length;c++)this.soundCollection[c].switchPanningModelToEqualPower()}connectToAnalyser(Y){var c;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Y,null!==(c=Fc.c.audioEngine)&&void 0!==c&&c.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Fc.c.audioEngine.masterGain))}}var Yh=h(13142),ch=h(13110),hh=h(12693);Fc.c.AudioEngineFactory=(Y,c,h)=>new Ch(Y,c,h);class Ch{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new W.c,this.onAudioLockedObservable=new W.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,hh.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const C=document.createElement("audio");this._hostElement=Y,this._audioContext=c,this._audioDestination=h;try{C&&C.canPlayType&&(C.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||C.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{C&&C.canPlayType&&C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var Y,c;if("running"===(null===(Y=this._audioContext)||void 0===Y?void 0:Y.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(c=this._audioContext)||void 0===c||c.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{P.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Y;null===(Y=this._audioContext)||void 0===Y||Y.addEventListener("statechange",(()=>{var Y;this.unlocked&&"running"!==(null===(Y=this._audioContext)||void 0===Y?void 0:Y.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Y;return null!==(Y=this._audioContext)&&void 0!==Y&&Y.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Y){this.canUseWebAudio=!1,P.e.Error("Web Audio: "+Y.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Y){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Y=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",c=document.createElement("style");c.appendChild(document.createTextNode(Y)),document.getElementsByTagName("head")[0].appendChild(c),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Y;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Y=this._audioContext)||void 0===Y||Y.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Y){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Y)}connectToAnalyser(Y){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Y,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Eh=h(12709);(0,h(14109).i)(Yh.c.NAME_AUDIO,((Y,c,h,C)=>{let E,N=[];if(h.Tp=h.Tp||[],void 0!==Y.Tp&&null!==Y.Tp)for(let b=0,H=Y.Tp.length;b<H;b++){var Q;const H=Y.Tp[b];null!==(Q=Fc.c.audioEngine)&&void 0!==Q&&Q.canUseWebAudio?(H.url||(H.url=H.name),N[H.url]?h.Tp.push(jc.Parse(H,c,C,N[H.url])):(E=jc.Parse(H,c,C),N[H.url]=E,h.Tp.push(E))):h.Tp.push(new jc(H.name,null,c))}N=[]})),Object.defineProperty(ch.e.prototype,"mainSoundTrack",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),this._mainSoundTrack||(this._mainSoundTrack=new mh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),ch.e.prototype.getSoundByName=function(Y){let c;for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===Y)return this.mainSoundTrack.soundCollection[c];if(this.soundTracks)for(let h=0;h<this.soundTracks.length;h++)for(c=0;c<this.soundTracks[h].soundCollection.length;c++)if(this.soundTracks[h].soundCollection[c].name===Y)return this.soundTracks[h].soundCollection[c];return null},Object.defineProperty(ch.e.prototype,"audioEnabled",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),Y.audioEnabled},set:function(Y){let c=this._getComponent(Yh.c.NAME_AUDIO);c||(c=new Nh(this),this.wc(c)),Y?c.enableAudio():c.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(ch.e.prototype,"headphone",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),Y.headphone},set:function(Y){let c=this._getComponent(Yh.c.NAME_AUDIO);c||(c=new Nh(this),this.wc(c)),Y?c.switchAudioModeForHeadphones():c.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(ch.e.prototype,"audioListenerPositionProvider",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),Y.audioListenerPositionProvider},set:function(Y){let c=this._getComponent(Yh.c.NAME_AUDIO);if(c||(c=new Nh(this),this.wc(c)),Y&&"function"!==typeof Y)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");c.audioListenerPositionProvider=Y},enumerable:!0,configurable:!0}),Object.defineProperty(ch.e.prototype,"audioListenerRotationProvider",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),Y.audioListenerRotationProvider},set:function(Y){let c=this._getComponent(Yh.c.NAME_AUDIO);if(c||(c=new Nh(this),this.wc(c)),Y&&"function"!==typeof Y)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");c.audioListenerRotationProvider=Y},enumerable:!0,configurable:!0}),Object.defineProperty(ch.e.prototype,"audioPositioningRefreshRate",{get:function(){let Y=this._getComponent(Yh.c.NAME_AUDIO);return Y||(Y=new Nh(this),this.wc(Y)),Y.audioPositioningRefreshRate},set:function(Y){let c=this._getComponent(Yh.c.NAME_AUDIO);c||(c=new Nh(this),this.wc(c)),c.audioPositioningRefreshRate=Y},enumerable:!0,configurable:!0});class Nh{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Y){this.name=Yh.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.bh,this._cachedCameraPosition=new E.bh,this._lastCheck=0,this._invertMatrixTemp=new E.Matrix,this._cameraDirectionTemp=new E.bh,(Y=Y||p.d.LastCreatedScene)&&(this.wh=Y,Y.soundTracks=[],Y.Tp=[])}register(){this.wh._afterRenderStage.registerStep(Yh.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Y){if(Y.Tp=[],this.wh.soundTracks)for(let c=0;c<this.wh.soundTracks.length;c++){const h=this.wh.soundTracks[c];for(let c=0;c<h.soundCollection.length;c++)Y.Tp.push(h.soundCollection[c].serialize())}}addFromContainer(Y){if(Y.Tp)for(const c of Y.Tp)c.play(),c.autoplay=!0,this.wh.mainSoundTrack.addSound(c)}removeFromContainer(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Y.Tp)for(const h of Y.Tp)h.stop(),h.autoplay=!1,this.wh.mainSoundTrack.removeSound(h),c&&h.dispose()}dispose(){const Y=this.wh;if(Y._mainSoundTrack&&Y.mainSoundTrack.dispose(),Y.soundTracks)for(let c=0;c<Y.soundTracks.length;c++)Y.soundTracks[c].dispose()}disableAudio(){const Y=this.wh;let c;for(this._audioEnabled=!1,Fc.c.audioEngine&&Fc.c.audioEngine.audioContext&&Fc.c.audioEngine.audioContext.suspend(),c=0;c<Y.mainSoundTrack.soundCollection.length;c++)Y.mainSoundTrack.soundCollection[c].pause();if(Y.soundTracks)for(c=0;c<Y.soundTracks.length;c++)for(let h=0;h<Y.soundTracks[c].soundCollection.length;h++)Y.soundTracks[c].soundCollection[h].pause()}enableAudio(){const Y=this.wh;let c;for(this._audioEnabled=!0,Fc.c.audioEngine&&Fc.c.audioEngine.audioContext&&Fc.c.audioEngine.audioContext.resume(),c=0;c<Y.mainSoundTrack.soundCollection.length;c++)Y.mainSoundTrack.soundCollection[c].isPaused&&Y.mainSoundTrack.soundCollection[c].play();if(Y.soundTracks)for(c=0;c<Y.soundTracks.length;c++)for(let h=0;h<Y.soundTracks[c].soundCollection.length;h++)Y.soundTracks[c].soundCollection[h].isPaused&&Y.soundTracks[c].soundCollection[h].play()}switchAudioModeForHeadphones(){const Y=this.wh;if(this._headphone=!0,Y.mainSoundTrack.switchPanningModelToHRTF(),Y.soundTracks)for(let c=0;c<Y.soundTracks.length;c++)Y.soundTracks[c].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Y=this.wh;if(this._headphone=!1,Y.mainSoundTrack.switchPanningModelToEqualPower(),Y.soundTracks)for(let c=0;c<Y.soundTracks.length;c++)Y.soundTracks[c].switchPanningModelToEqualPower()}_afterRender(){const Y=Eh.d.Now;if(this._lastCheck&&Y-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Y;const c=this.wh;if(!this._audioEnabled||!c._mainSoundTrack||!c.soundTracks||0===c._mainSoundTrack.soundCollection.length&&1===c.soundTracks.length)return;const h=Fc.c.audioEngine;if(h&&h.audioContext){let Y,C=c.activeCamera;if(c.activeCameras&&c.activeCameras.length>0&&(C=c.activeCameras[0]),this.audioListenerPositionProvider){const Y=this.audioListenerPositionProvider();h.audioContext.listener.setPosition(Y.x||0,Y.y||0,Y.z||0)}else C?this._cachedCameraPosition.equals(C.globalPosition)||(this._cachedCameraPosition.N(C.globalPosition),h.audioContext.listener.setPosition(C.globalPosition.x,C.globalPosition.y,C.globalPosition.z)):h.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Y=this.audioListenerRotationProvider();h.audioContext.listener.setOrientation(Y.x||0,Y.y||0,Y.z||0,0,1,0)}else C?(C.rigCameras&&C.rigCameras.length>0&&(C=C.rigCameras[0]),C.getViewMatrix().invertToRef(this._invertMatrixTemp),E.bh.TransformNormalToRef(Nh._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.N(this._cameraDirectionTemp),h.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):h.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Y=0;Y<c.mainSoundTrack.soundCollection.length;Y++){const h=c.mainSoundTrack.soundCollection[Y];h.useCustomAttenuation&&h.updateDistanceFromListener()}if(c.soundTracks)for(Y=0;Y<c.soundTracks.length;Y++)for(let h=0;h<c.soundTracks[Y].soundCollection.length;h++){const C=c.soundTracks[Y].soundCollection[h];C.useCustomAttenuation&&C.updateDistanceFromListener()}}}}Nh._CameraDirection=new E.bh(0,0,-1),jc._SceneComponentInitialization=Y=>{let c=Y._getComponent(Yh.c.NAME_AUDIO);c||(c=new Nh(Y),Y.wc(c))};const Qh="MSFT_audio_emitter";class bh{constructor(Y){this.name=Qh,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Qh)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Y=this._loader.Dc.extensions;if(Y&&Y[this.name]){const c=Y[this.name];this._clips=c.clips,this._emitters=c.emitters,f.Assign(this._clips),f.Assign(this._emitters)}}loadSceneAsync(Y,c){return u.LoadExtensionAsync(Y,c,this.name,(async(h,C)=>{const E=new Array;E.push(this._loader.loadSceneAsync(Y,c));for(const Y of C.emitters){const c=f.Get(`${h}/emitters`,this._emitters,Y);if(void 0!=c.refDistance||void 0!=c.maxDistance||void 0!=c.rolloffFactor||void 0!=c.distanceModel||void 0!=c.innerAngle||void 0!=c.outerAngle)throw new Error(`${h}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${h}/emitters/${c.index}`,c))}await Promise.all(E)}))}loadNodeAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(Y,C)=>{const N=new Array,b=await this._loader.loadNodeAsync(Y,c,(c=>{for(const h of C.emitters){const C=f.Get(`${Y}/emitters`,this._emitters,h);N.push(this._loadEmitterAsync(`${Y}/emitters/${C.index}`,C).then((()=>{for(const Y of C._babylonSounds)Y.attachToMesh(c),void 0==C.innerAngle&&void 0==C.outerAngle||(Y.setLocalDirectionToMesh(E.bh.Forward()),Y.setDirectionalCone(2*Q.Tools.ToDegrees(void 0==C.innerAngle?Math.PI:C.innerAngle),2*Q.Tools.ToDegrees(void 0==C.outerAngle?Math.PI:C.outerAngle),0))})))}h(c)}));return await Promise.all(N),b}))}loadAnimationAsync(Y,c){return u.LoadExtensionAsync(Y,c,this.name,(async(h,C)=>{const E=await this._loader.loadAnimationAsync(Y,c),N=new Array;f.Assign(C.events);for(const Q of C.events)N.push(this._loadAnimationEventAsync(`${h}/events/${Q.index}`,Y,c,Q,E));return await Promise.all(N),E}))}_loadClipAsync(Y,c){if(c._objectURL)return c._objectURL;let h;if(c.uri)h=this._loader.loadUriAsync(Y,c,c.uri);else{const C=f.Get(`${Y}/bufferView`,this._loader.Dc.bufferViews,c.bufferView);h=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}return c._objectURL=h.then((Y=>URL.createObjectURL(new Blob([Y],{type:c.mimeType})))),c._objectURL}_loadEmitterAsync(Y,c){if(c._babylonSounds=c._babylonSounds||[],!c._babylonData){const Y=new Array,h=c.name||`emitter${c.index}`,C={loop:!1,autoplay:!1,volume:void 0==c.volume?1:c.volume};for(let N=0;N<c.clips.length;N++){const E=`/extensions/${this.name}/clips`,Q=f.Get(E,this._clips,c.clips[N].clip);Y.push(this._loadClipAsync(`${E}/${c.clips[N].clip}`,Q).then((Y=>{const E=c._babylonSounds[N]=new jc(h,Y,this._loader.babylonScene,null,C);E.refDistance=c.refDistance||1,E.maxDistance=c.maxDistance||256,E.rolloffFactor=c.rolloffFactor||1,E.distanceModel=c.distanceModel||"exponential"})))}const E=Promise.all(Y).then((()=>{const Y=c.clips.map((Y=>Y.weight||1)),h=new Sc(c.loop||!1,c._babylonSounds,Y);c.innerAngle&&(h.directionalConeInnerAngle=2*Q.Tools.ToDegrees(c.innerAngle)),c.outerAngle&&(h.directionalConeOuterAngle=2*Q.Tools.ToDegrees(c.outerAngle)),c.volume&&(h.volume=c.volume),c._babylonData.sound=h}));c._babylonData={loaded:E}}return c._babylonData.loaded}_getEventAction(Y,c,h,C,E){switch(h){case"play":return Y=>{const h=(E||0)+(Y-C);c.play(h)};case"stop":return()=>{c.stop()};case"pause":return()=>{c.pause()};default:throw new Error(`${Y}: Unsupported action ${h}`)}}_loadAnimationEventAsync(Y,c,h,C,E){if(0==E.targetedAnimations.length)return Promise.resolve();const N=E.targetedAnimations[0],Q=C.Cc,b=f.Get(`/extensions/${this.name}/emitters`,this._emitters,Q);return this._loadEmitterAsync(Y,b).then((()=>{const c=b._babylonData.sound;if(c){const h=new Bc(C.time,this._getEventAction(Y,c,C.action,C.time,C.startOffset));N.animation.addEvent(h),E.onAnimationGroupEndObservable.add((()=>{c.stop()})),E.onAnimationGroupPauseObservable.add((()=>{c.pause()}))}}))}}g(Qh),v(Qh,!0,(Y=>new bh(Y)));const Hh="MSFT_lod";class wh{constructor(Y){var c;this.name=Hh,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new W.c,this.onMaterialLODsLoadedObservable=new W.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Y,this.maxLODsToLoad=(null===(c=this._loader.parent.extensionOptions[Hh])||void 0===c?void 0:c.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Hh)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Y=0;Y<this._nodePromiseLODs.length;Y++){const c=Promise.all(this._nodePromiseLODs[Y]).then((()=>{0!==Y&&(this._loader.endPerformanceCounter(`Node LOD ${Y}`),this._loader.log(`Loaded node LOD ${Y}`)),this.onNodeLODsLoadedObservable.notifyObservers(Y),Y!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Y+1}`),this._loadBufferLOD(this._nodeBufferLODs,Y+1),this._nodeSignalLODs[Y]&&this._nodeSignalLODs[Y].resolve())}));this._loader._completePromises.push(c)}for(let Y=0;Y<this._materialPromiseLODs.length;Y++){const c=Promise.all(this._materialPromiseLODs[Y]).then((()=>{0!==Y&&(this._loader.endPerformanceCounter(`Material LOD ${Y}`),this._loader.log(`Loaded material LOD ${Y}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Y),Y!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Y+1}`),this._loadBufferLOD(this._materialBufferLODs,Y+1),this._materialSignalLODs[Y]&&this._materialSignalLODs[Y].resolve())}));this._loader._completePromises.push(c)}}loadSceneAsync(Y,c){const h=this._loader.loadSceneAsync(Y,c);return this._loadBufferLOD(this._bufferLODs,0),h}loadNodeAsync(Y,c,h){return u.LoadExtensionAsync(Y,c,this.name,(async(Y,E)=>{let N;const Q=this._getLODs(Y,c,this._loader.Dc.nodes,E.ids);this._loader.logOpen(`${Y}`);for(let c=0;c<Q.length;c++){const Y=Q[c];0!==c&&(this._nodeIndexLOD=c,this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new C);const E=Y=>{h(Y),Y.Aw(!1)},b=this._loader.loadNodeAsync(`/nodes/${Y.index}`,Y,E).then((Y=>{if(0!==c){const Y=Q[c-1];Y._babylonTransformNode&&(this._disposeTransformNode(Y._babylonTransformNode),delete Y._babylonTransformNode)}return Y.Aw(!0),Y}));this._nodePromiseLODs[c]=this._nodePromiseLODs[c]||[],0===c?N=b:(this._nodeIndexLOD=null,this._nodePromiseLODs[c].push(b))}return this._loader.logClose(),await N}))}_loadMaterialAsync(Y,c,h,C,E){return this._nodeIndexLOD?null:u.LoadExtensionAsync(Y,c,this.name,(async(Y,N)=>{let Q;const b=this._getLODs(Y,c,this._loader.Dc.materials,N.ids);this._loader.logOpen(`${Y}`);for(let c=0;c<b.length;c++){const Y=b[c];0!==c&&(this._materialIndexLOD=c);const N=this._loader._loadMaterialAsync(`/materials/${Y.index}`,Y,h,C,(Y=>{0===c&&E(Y)})).then((Y=>{if(0!==c){E(Y);const h=b[c-1]._data;h[C]&&(this._disposeMaterials([h[C].babylonMaterial]),delete h[C])}return Y}));this._materialPromiseLODs[c]=this._materialPromiseLODs[c]||[],0===c?Q=N:(this._materialIndexLOD=null,this._materialPromiseLODs[c].push(N))}return this._loader.logClose(),await Q}))}_loadUriAsync(Y,c,h){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new C,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Y,c,h)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new C,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(Y,c,h)))}return null}loadBufferAsync(Y,c,h,E){if(this._loader.parent.useRangeRequests&&!c.uri){if(!this._loader.bin)throw new Error(`${Y}: Uri is missing or the binary glTF is missing its binary chunk`);const c=async(Y,c)=>{const N=h,Q=N+E-1;let b=Y[c];return b?(b.start=Math.min(b.start,N),b.end=Math.max(b.end,Q)):(b={start:N,end:Q,loaded:new C},Y[c]=b),await b.loaded.promise.then((Y=>new Uint8Array(Y.buffer,Y.byteOffset+h-b.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?c(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?c(this._materialBufferLODs,this._materialIndexLOD):c(this._bufferLODs,0)}return null}_loadBufferLOD(Y,c){const h=Y[c];h&&(this._loader.log(`Loading buffer range [${h.start}-${h.end}]`),this._loader.bin.readAsync(h.start,h.end-h.start+1).then((Y=>{h.loaded.resolve(Y)}),(Y=>{h.loaded.reject(Y)})))}_getLODs(Y,c,h,C){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let N=C.length-1;N>=0;N--)if(E.push(f.Get(`${Y}/ids/${C[N]}`,h,C[N])),E.length===this.maxLODsToLoad)return E;return E.push(c),E}_disposeTransformNode(Y){const c=[],h=Y.material;h&&c.push(h);for(const E of Y.getChildMeshes())E.material&&c.push(E.material);Y.dispose();const C=c.filter((Y=>this._loader.babylonScene.meshes.every((c=>c.material!=Y))));this._disposeMaterials(C)}_disposeMaterials(Y){const c={};for(const h of Y){for(const Y of h.getActiveTextures())c[Y.uniqueId]=Y;h.dispose()}for(const h in c)for(const Y of this._loader.babylonScene.materials)Y.hasTexture(c[h])&&delete c[h];for(const h in c)c[h].dispose()}}g(Hh),v(Hh,!0,(Y=>new wh(Y)));const Wh="MSFT_minecraftMesh";class qh{constructor(Y){this.name=Wh,this._loader=Y,this.enabled=this._loader.isExtensionUsed(Wh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtraAsync(Y,c,this.name,(async(C,E)=>{if(E){if(!(h instanceof T.d))throw new Error(`${C}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(Y,c,h);return h.needAlphaBlending()&&(h.forceDepthWrite=!0,h.separateCullingPass=!0),h.Ac=h.forceDepthWrite,h.twoSidedLighting=!0,await E}}))}}g(Wh),v(Wh,!0,(Y=>new qh(Y)));const kh="MSFT_sRGBFactors";class Mh{constructor(Y){this.name=kh,this._loader=Y,this.enabled=this._loader.isExtensionUsed(kh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Y,c,h){return u.LoadExtraAsync(Y,c,this.name,(async(C,E)=>{if(E){if(!(h instanceof T.d))throw new Error(`${C}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(Y,c,h),N=h.ZY().getEngine().useExactSrgbConversions;return h.albedoTexture||h.albedoColor.toLinearSpaceToRef(h.albedoColor,N),h.reflectivityTexture||h.reflectivityColor.toLinearSpaceToRef(h.reflectivityColor,N),await E}}))}}g(kh),v(kh,!0,(Y=>new Mh(Y)));var ph=h(14440);const Ph={};var yh=h(14496),dh=h(14473),Dh=h(14445),Th=h(14459);function eh(Y,c){for(const h of Y)for(const Y of h.dataOutputs)if(Y.uniqueId===c)return Y;throw new Error("Could not find data out connection with unique id "+c)}function rh(Y,c){for(const h of Y)if(h instanceof dh.e)for(const Y of h.signalInputs)if(Y.uniqueId===c)return Y;throw new Error("Could not find signal in connection with unique id "+c)}async function Xh(Y,c){const C=await Promise.all(Y.allBlocks.map((async Y=>{const c=function(Y){switch(Y){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([h.e(78),h.e(79)]).then(h.bind(h,16155))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await h.e(80).then(h.bind(h,16160))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await h.e(81).then(h.bind(h,16162))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await h.e(82).then(h.bind(h,16166))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await h.e(83).then(h.bind(h,16168))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await h.e(84).then(h.bind(h,16172))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await h.e(85).then(h.bind(h,16181))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await h.e(86).then(h.bind(h,16185))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await h.e(87).then(h.bind(h,16187))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await h.e(95).then(h.bind(h,16217))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await h.e(96).then(h.bind(h,16224))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await h.e(97).then(h.bind(h,16227))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await h.e(98).then(h.bind(h,16235))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await h.e(99).then(h.bind(h,16237))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await h.e(100).then(h.bind(h,16241))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await h.e(101).then(h.bind(h,16248))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await h.e(102).then(h.bind(h,16254))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await h.e(103).then(h.bind(h,16262))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await h.e(104).then(h.bind(h,16266))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await h.e(105).then(h.bind(h,16270))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await h.e(106).then(h.bind(h,16275))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await h.e(107).then(h.bind(h,16277))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await h.e(108).then(h.bind(h,16282))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await h.e(109).then(h.bind(h,16285))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await h.e(110).then(h.bind(h,16293))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await h.e(111).then(h.bind(h,16295))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await h.e(112).then(h.bind(h,16304))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await h.e(113).then(h.bind(h,16312))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await h.e(92).then(h.bind(h,16319))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await h.e(114).then(h.bind(h,16327))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await h.e(115).then(h.bind(h,16332))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await h.e(116).then(h.bind(h,16339))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await h.e(93).then(h.bind(h,16341))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await h.e(88).then(h.bind(h,16189))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await h.e(94).then(h.bind(h,16350))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await h.e(89).then(h.bind(h,16206))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await h.e(90).then(h.bind(h,16211))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await h.e(91).then(h.bind(h,16353))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await h.e(117).then(h.bind(h,16360))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await h.e(118).then(h.bind(h,16364))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await h.e(119).then(h.bind(h,16370))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await h.e(120).then(h.bind(h,16375))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await h.e(121).then(h.bind(h,16380))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await h.e(122).then(h.bind(h,16383))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await h.e(123).then(h.bind(h,16387))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await h.e(124).then(h.bind(h,16392))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await h.e(125).then(h.bind(h,16394))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await h.e(126).then(h.bind(h,16398))).FlowGraphDataSwitchBlock;default:if(Ph[Y])return Ph[Y];throw new Error(`Unknown block name ${Y}`)}}(Y.className);return await c()})));return function(Y,c,h){const C=c.coordinator.createGraph(),E=[],N=c.valueParseFunction??Dh.e;for(let Q=0;Q<Y.allBlocks.length;Q++){const b=ah(Y.allBlocks[Q],{wh:c.coordinator.config.wh,pathConverter:c.pathConverter,assetsContainer:c.coordinator.config.wh,valueParseFunction:N},h[Q]);E.push(b),b instanceof yh.c&&C.addEventBlock(b)}for(const Q of E){for(const Y of Q.dataInputs)for(const c of Y.connectedPointIds){const h=eh(E,c);Y.connectTo(h)}if(Q instanceof dh.e)for(const Y of Q.signalOutputs)for(const c of Y.connectedPointIds){const h=rh(E,c);Y.connectTo(h)}}for(const Q of Y.executionContexts)Zh(Q,{graph:C,valueParseFunction:N},Y.rightHanded);return C}(Y,c,C)}function Zh(Y,c,h){const C=c.graph.createContext();Y.enableLogging&&(C.enableLogging=!0),C.treatDataAsRightHanded=h||!1;const E=c.valueParseFunction??Dh.e;C.uniqueId=Y.uniqueId;const N=C.ZY();if(Y._assetsContext){var Q,b,H,w,W,q,k,M,p,P;const c=Y._assetsContext,h={meshes:null===(Q=c.meshes)||void 0===Q?void 0:Q.map((Y=>N.getMeshById(Y))),lights:null===(b=c.lights)||void 0===b?void 0:b.map((Y=>N.getLightByName(Y))),cameras:null===(H=c.cameras)||void 0===H?void 0:H.map((Y=>N.getCameraByName(Y))),materials:null===(w=c.materials)||void 0===w?void 0:w.map((Y=>N.getMaterialById(Y))),textures:null===(W=c.textures)||void 0===W?void 0:W.map((Y=>N.getTextureByName(Y))),animations:null===(q=c.animations)||void 0===q?void 0:q.map((Y=>N.animations.find((c=>c.name===Y)))),skeletons:null===(k=c.skeletons)||void 0===k?void 0:k.map((Y=>N.getSkeletonByName(Y))),OM:null===(M=c.OM)||void 0===M?void 0:M.map((Y=>N.getParticleSystemById(Y))),animationGroups:null===(p=c.animationGroups)||void 0===p?void 0:p.map((Y=>N.getAnimationGroupByName(Y))),transformNodes:null===(P=c.transformNodes)||void 0===P?void 0:P.map((Y=>N.getTransformNodeById(Y))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Tp:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};C.assetsContext=h}for(const y in Y._userVariables){const c=E(y,Y._userVariables,C.assetsContext,N);C.userVariables[y]=c}for(const y in Y._connectionValues){const c=E(y,Y._connectionValues,C.assetsContext,N);C._setConnectionValueByKey(y,c)}return C}function ah(Y,c,h){const C={},E=c.valueParseFunction??Dh.e;if(Y.config)for(const Q in Y.config)C[Q]=E(Q,Y.config,c.assetsContainer||c.wh,c.wh);if((0,Dh.k)(Y.className)){if(!c.pathConverter)throw new Error("Path converter is required for this block");C.pathConverter=c.pathConverter}const N=new h(C);N.uniqueId=Y.uniqueId;for(let Q=0;Q<Y.dataInputs.length;Q++){const c=N.getDataInput(Y.dataInputs[Q].name);if(!c)throw new Error("Could not find data input with name "+Y.dataInputs[Q].name+" in block "+Y.className);c.deserialize(Y.dataInputs[Q])}for(let Q=0;Q<Y.dataOutputs.length;Q++){const c=N.getDataOutput(Y.dataOutputs[Q].name);if(!c)throw new Error("Could not find data output with name "+Y.dataOutputs[Q].name+" in block "+Y.className);c.deserialize(Y.dataOutputs[Q])}return N.metadata=Y.metadata,N.deserialize&&N.deserialize(Y),N}function Gh(Y){const[c,h]=Y.split(":");return Kh({op:c,extension:h})}function Kh(Y){var c;let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=Y.extension?null===(c=sh[Y.extension])||void 0===c?void 0:c[Y.op]:xh[Y.op];if(!C&&(P.e.Warn(`No mapping found for operation ${Y.op} and extension ${Y.extension||"KHR_interactivity"}`),h)){const c={},h={flows:{}};if(Y.inputValueSockets){c.values={};for(const h in Y.inputValueSockets)c.values[h]={name:h}}return Y.outputValueSockets&&(h.values={},Object.keys(Y.outputValueSockets).forEach((Y=>{h.values[Y]={name:Y}}))),{Ck:[],inputs:c,outputs:h}}return C}function Ih(Y,c,h){sh[c]||(sh[c]={}),sh[c][Y]=h}const sh={BABYLON:{"flow/log":{Ck:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},xh={"event/onStart":{Ck:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Ck:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Ck:["FlowGraphSendCustomEventBlock"],extraProcessor(Y,c,h,C,E){if("event/send"!==c.op||!Y.configuration||1!==Object.keys(Y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=Y.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const Q=C.arrays.events[N],b=E[0];return b.config||(b.config={}),b.config.eventId=Q.eventId,b.config.eventData=Q.eventData,E}},"event/receive":{Ck:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Y,c){var h;if(!Y.configuration)return P.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const C=Y.configuration.event;if(!C)return P.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=C.value[0];if("number"!==typeof E)return P.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(h=c.events)||void 0===h?void 0:h[E])?{valid:!0}:(P.e.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(Y,c,h,C,E){if("event/receive"!==c.op||!Y.configuration||1!==Object.keys(Y.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=Y.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const Q=C.arrays.events[N],b=E[0];return b.config||(b.config={}),b.config.eventId=Q.eventId,b.config.eventData=Q.eventData,E}},"math/e":Ah("FlowGraphEBlock"),"math/pi":Ah("FlowGraphPIBlock"),"math/inf":Ah("FlowGraphInfBlock"),"math/nan":Ah("FlowGraphNaNBlock"),"math/abs":Ah("FlowGraphAbsBlock"),"math/sign":Ah("FlowGraphSignBlock"),"math/trunc":Ah("FlowGraphTruncBlock"),"math/floor":Ah("FlowGraphFloorBlock"),"math/ceil":Ah("FlowGraphCeilBlock"),"math/round":{Ck:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E){var N;return(N=E[0]).config||(N.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":Ah("FlowGraphFractBlock"),"math/neg":Ah("FlowGraphNegationBlock"),"math/add":Ah("FlowGraphAddBlock",["a","b"],!0),"math/sub":Ah("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Ck:["FlowGraphMultiplyBlock"],extraProcessor(Y,c,h,C,E){var N;(N=E[0]).config||(N.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let Q=-1;return Object.keys(Y.values||{}).find((c=>{var h;return void 0!==(null===(h=Y.values)||void 0===h?void 0:h[c].type)&&(Q=Y.values[c].type,!0)})),-1!==Q&&(E[0].config.type=C.arrays.types[Q].flowGraphType),E},validation:Y=>Y.values?Vh(Y):{valid:!0}},"math/div":Ah("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Ah("FlowGraphModuloBlock",["a","b"]),"math/min":Ah("FlowGraphMinBlock",["a","b"]),"math/max":Ah("FlowGraphMaxBlock",["a","b"]),"math/clamp":Ah("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Ah("FlowGraphSaturateBlock"),"math/mix":Ah("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Ah("FlowGraphEqualityBlock",["a","b"]),"math/lt":Ah("FlowGraphLessThanBlock",["a","b"]),"math/le":Ah("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Ah("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Ah("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Ah("FlowGraphIsNaNBlock"),"math/isinf":Ah("FlowGraphIsInfBlock"),"math/select":{Ck:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Ck:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Ah("FlowGraphSinBlock"),"math/cos":Ah("FlowGraphCosBlock"),"math/tan":Ah("FlowGraphTanBlock"),"math/asin":Ah("FlowGraphASinBlock"),"math/acos":Ah("FlowGraphACosBlock"),"math/atan":Ah("FlowGraphATanBlock"),"math/atan2":Ah("FlowGraphATan2Block",["a","b"]),"math/sinh":Ah("FlowGraphSinhBlock"),"math/cosh":Ah("FlowGraphCoshBlock"),"math/tanh":Ah("FlowGraphTanhBlock"),"math/asinh":Ah("FlowGraphASinhBlock"),"math/acosh":Ah("FlowGraphACoshBlock"),"math/atanh":Ah("FlowGraphATanhBlock"),"math/exp":Ah("FlowGraphExponentialBlock"),"math/log":Ah("FlowGraphLogBlock"),"math/log2":Ah("FlowGraphLog2Block"),"math/log10":Ah("FlowGraphLog10Block"),"math/sqrt":Ah("FlowGraphSquareRootBlock"),"math/cbrt":Ah("FlowGraphCubeRootBlock"),"math/pow":Ah("FlowGraphPowerBlock",["a","b"]),"math/length":Ah("FlowGraphLengthBlock"),"math/normalize":Ah("FlowGraphNormalizeBlock"),"math/dot":Ah("FlowGraphDotBlock",["a","b"]),"math/cross":Ah("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Ah("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Ah("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Ck:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Ck:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Ck:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Ck:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Ck:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Ck:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Ck:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Ah("FlowGraphTransposeBlock"),"math/determinant":Ah("FlowGraphDeterminantBlock"),"math/inverse":Ah("FlowGraphInvertMatrixBlock"),"math/matmul":Ah("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Ck:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"lc",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E,N){const Q=E[0].dataInputs.find((Y=>"rotationQuaternion"===Y.name));if(!Q)throw new Error("Rotation quaternion input not found");return N._connectionValues[Q.uniqueId]&&(N._connectionValues[Q.uniqueId].type="Quaternion"),E}},"math/matDecompose":{Ck:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"lc"}}}},"math/quatConjugate":Ah("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Ck:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E){var N;return(N=E[0]).config||(N.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":Ah("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Ck:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Ah("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Ah("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Ck:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E){var N;return(N=E[0]).config||(N.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{Ck:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Ck:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E){var N;return(N=E[0]).config||(N.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{Ck:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Ck:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E){var N;return(N=E[0]).config||(N.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{Ck:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Ck:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E,N){var Q,b;(b=E[0]).config||(b.config={});const H=E[0].dataInputs[0];return E[0].config.valueType=(null===(Q=N._connectionValues[H.uniqueId])||void 0===Q?void 0:Q.type)??"FlowGraphInteger",E}},"math/and":{Ck:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E,N){var Q,b,H;(H=E[0]).config||(H.config={});const w=E[0].dataInputs[0],W=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=N._connectionValues[w.uniqueId])||void 0===Q?void 0:Q.type)??(null===(b=N._connectionValues[W.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",E}},"math/or":{Ck:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E,N){var Q,b,H;(H=E[0]).config||(H.config={});const w=E[0].dataInputs[0],W=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=N._connectionValues[w.uniqueId])||void 0===Q?void 0:Q.type)??(null===(b=N._connectionValues[W.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",E}},"math/xor":{Ck:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,c,h,C,E,N){var Q,b,H;(H=E[0]).config||(H.config={});const w=E[0].dataInputs[0],W=E[0].dataInputs[1];return E[0].config.valueType=(null===(Q=N._connectionValues[w.uniqueId])||void 0===Q?void 0:Q.type)??(null===(b=N._connectionValues[W.uniqueId])||void 0===b?void 0:b.type)??"FlowGraphInteger",E}},"math/asr":Ah("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Ah("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Ah("FlowGraphLeadingZerosBlock"),"math/ctz":Ah("FlowGraphTrailingZerosBlock"),"math/popcnt":Ah("FlowGraphOneBitsCounterBlock"),"math/rad":Ah("FlowGraphDegToRadBlock"),"math/deg":Ah("FlowGraphRadToDegBlock"),"type/boolToInt":Ah("FlowGraphBooleanToInt"),"type/boolToFloat":Ah("FlowGraphBooleanToFloat"),"type/intToBool":Ah("FlowGraphIntToBoolean"),"type/intToFloat":Ah("FlowGraphIntToFloat"),"type/floatToInt":Ah("FlowGraphFloatToInt"),"type/floatToBool":Ah("FlowGraphFloatToBoolean"),"flow/sequence":{Ck:["FlowGraphSequenceBlock"],extraProcessor(Y,c,h,C,E){const N=E[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(Y.flows||[]).length,N.signalOutputs.forEach(((Y,c)=>{Y.name="out_"+c})),E}},"flow/branch":{Ck:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Ck:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Y){if(Y.configuration&&Y.configuration.cases){const c=Y.configuration.cases.value;if(!c.every((Y=>"number"===typeof Y&&/^-?\d+$/.test(Y.toString()))))return P.e.Warn("Switch cases should be integers. Using empty array instead."),Y.configuration.cases.value=[],{valid:!0};const h=new Set(c);Y.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(Y,c,h,C,E){if("flow/switch"!==c.op||!Y.flows||0===Object.keys(Y.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((Y=>{"default"!==Y.name&&(Y.name="out_"+Y.name)})),E}},"flow/while":{Ck:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Ck:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Y,c,h,C,E){const N=E[0];return N.config||(N.config={}),N.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{Ck:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Ck:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Y,c,h,C,E){if("flow/multiGate"!==c.op||!Y.flows||0===Object.keys(Y.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const N=E[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(Y.flows).length,N.signalOutputs.forEach(((Y,c)=>{Y.name="out_"+c})),E}},"flow/waitAll":{Ck:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Y){var c,h;return"number"!==typeof(null===(c=Y.configuration)||void 0===c||null===(h=c.inputFlows)||void 0===h?void 0:h.value[0])&&(Y.configuration=Y.configuration||{inputFlows:{value:[0]}},Y.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Ck:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Ck:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Ck:["FlowGraphCancelDelayBlock"]},"variable/get":{Ck:["FlowGraphGetVariableBlock"],validation(Y){var c,h;return null!==(c=Y.configuration)&&void 0!==c&&null!==(h=c.variable)&&void 0!==h&&h.value?{valid:!0}:(P.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Y,c)=>[c.getVariableName(Y[0])]}}},"variable/set":{Ck:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Y,c)=>[c.getVariableName(Y[0])]}}},"variable/setMultiple":{Ck:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Y,c)=>[Y[0].map((Y=>c.getVariableName(Y)))]}},extraProcessor:(Y,c,h,C,E)=>(E[0].dataInputs.forEach((Y=>{Y.name=C.getVariableName(+Y.name)})),E)},"variable/interpolate":{Ck:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Y,c)=>[c.getVariableName(Y[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Y=>!0===Y[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",lC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",lC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",lC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",lC:"FlowGraphPlayAnimationBlock"},out:{name:"out",lC:"FlowGraphPlayAnimationBlock"},done:{name:"done",lC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Y,c,h,C,E){var N,Q,b;const H=E[0],w=null===(N=Y.configuration)||void 0===N?void 0:N.variable.value[0];if("number"!==typeof w)throw P.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const W=C.arrays.staticVariables[w];"undefined"===typeof H.config.animationType.value&&(C.arrays.staticVariables,H.config.animationType.value=(0,Th.C)(W.type));const q=E[4];return q.config||(q.config={}),(Q=q.config).variable||(Q.variable={}),q.config.variable.value=C.getVariableName(w),(b=E[3]).config||(b.config={}),E}},"pointer/get":{Ck:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",lC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",lC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,c,h,C,E)=>(E.forEach((Y=>{"FlowGraphJsonPointerParserBlock"===Y.className&&(Y.config||(Y.config={}),Y.config.outputValue=!0)})),E)},"pointer/set":{Ck:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",lC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",lC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,c,h,C,E)=>(E.forEach((Y=>{"FlowGraphJsonPointerParserBlock"===Y.className&&(Y.config||(Y.config={}),Y.config.outputValue=!0)})),E)},"pointer/interpolate":{Ck:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",lC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",lC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",lC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",lC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",lC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",lC:"FlowGraphPlayAnimationBlock"},out:{name:"out",lC:"FlowGraphPlayAnimationBlock"},done:{name:"done",lC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Y,c,h,C,E)=>(E.forEach((c=>{"FlowGraphJsonPointerParserBlock"===c.className?(c.config||(c.config={}),c.config.outputValue=!0):"FlowGraphInterpolationBlock"===c.className&&(c.config||(c.config={}),Object.keys(Y.values||[]).forEach((h=>{var E;const N=null===(E=Y.values)||void 0===E?void 0:E[h];if("value"===h&&N){const Y=N.type;void 0!==Y&&(c.config.animationType=C.arrays.types[Y].flowGraphType)}})))})),E)},"animation/start":{Ck:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",lC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Y,c)=>[Y[0]*c._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Y,c)=>[Y[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){const b=E[E.length-1];return b.config||(b.config={}),b.config.glTF=Q,E}},"animation/stop":{Ck:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",lC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){const b=E[E.length-1];return b.config||(b.config={}),b.config.glTF=Q,E}},"animation/stopAt":{Ck:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",lC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Y,c)=>[Y[0]*c._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){const b=E[E.length-1];return b.config||(b.config={}),b.config.glTF=Q,E}},"math/switch":{Ck:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Y){if(Y.configuration&&Y.configuration.cases){const c=Y.configuration.cases.value;if(!c.every((Y=>"number"===typeof Y&&/^-?\d+$/.test(Y.toString()))))return P.e.Warn("Switch cases should be integers. Using empty array instead."),Y.configuration.cases.value=[],{valid:!0};const h=new Set(c);Y.configuration.cases.value=Array.from(h)}return{valid:!0}},extraProcessor(Y,c,h,C,E){const N=E[0];return N.dataInputs.forEach((Y=>{"default"!==Y.name&&"case"!==Y.name&&(Y.name="in_"+Y.name)})),N.config||(N.config={}),N.config.treatCasesAsIntegers=!0,E}},"debug/log":{Ck:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Ah(Y){let c=arguments.length>2?arguments[2]:void 0;return{Ck:[Y],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Y,c)=>(Y[c]={name:c},Y)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Y,h,C,E,N){var Q;if(c){(Q=N[0]).config||(Q.config={}),N[0].config.preventIntegerFloatArithmetic=!0;let c=-1;Object.keys(Y.values||{}).find((h=>{var C;return void 0!==(null===(C=Y.values)||void 0===C?void 0:C[h].type)&&(c=Y.values[h].type,!0)})),-1!==c&&(N[0].config.type=E.arrays.types[c].flowGraphType)}return N},validation:Y=>c?Vh(Y):{valid:!0}}}function Vh(Y){if(Y.values){const c=Object.keys(Y.values).map((c=>Y.values[c].type)).filter((Y=>void 0!==Y));if(!c.every((Y=>Y===c[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}xh["math/compose"]=xh["math/matCompose"],xh["math/decompose"]=xh["math/matDecompose"];var Uh=h(12832);const lh={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"bh",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class nh{constructor(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Y,this._gltf=c,this._animationTargetFps=h,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Y of this._interactivityGraph.types)this._types.push(lh[Y.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Y of this._interactivityGraph.declarations){const c=Kh(Y);if(!c)throw P.e.Error(["No mapping found for declaration",Y]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:c,fullOperationName:Y.extension?Y.op+":"+Y.extension:Y.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Y of this._interactivityGraph.variables){const c=this._parseVariable(Y);this._staticVariables.push(c)}}_parseVariable(Y,c){const h=this._types[Y.type];if(!h)throw P.e.Error(["No type found for variable",Y]),new Error("Error parsing variables");if(Y.value&&Y.value.length!==h.length)throw P.e.Error(["Invalid value length for variable",Y,h]),new Error("Error parsing variables");const C=Y.value||[];if(!C.length)switch(h.flowGraphType){case"boolean":C.push(!1);break;case"FlowGraphInteger":C.push(0);break;case"number":C.push(NaN);break;case"Vector2":C.push(NaN,NaN);break;case"bh":C.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":C.fill(NaN,0,4);break;case"Matrix":C.fill(NaN,0,16);break;case"Matrix3D":C.fill(NaN,0,9)}return"number"===h.elementType&&"string"===typeof C[0]&&(C[0]=parseFloat(C[0])),{type:h.flowGraphType,value:c?c(C,this):C}}_parseEvents(){if(this._interactivityGraph.events)for(const Y of this._interactivityGraph.events){const c={eventId:Y.id||"internalEvent_"+this._internalEventsCounter++};Y.values&&(c.eventData=Object.keys(Y.values).map((c=>{var h;const C=null===(h=Y.values)||void 0===h?void 0:h[c];if(!C)throw P.e.Error(["No value found for event key",c]),new Error("Error parsing events");const E=this._types[C.type];if(!E)throw P.e.Error(["No type found for event value",C]),new Error("Error parsing events");const N="undefined"!==typeof C.value?this._parseVariable(C):void 0;return{id:c,type:E.flowGraphType,eventData:!0,value:N}}))),this._events.push(c)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const c of this._interactivityGraph.nodes){if("number"!==typeof c.declaration)throw P.e.Error(["No declaration found for node",c]),new Error("Error parsing nodes");const h=this._mappings[c.declaration];if(!h)throw P.e.Error(["No mapping found for node",c]),new Error("Error parsing nodes");if(h.flowGraphMapping.validation){const C=h.flowGraphMapping.validation(c,this._interactivityGraph,this._gltf);var Y;if(!C.valid)throw new Error(`Error validating interactivity node ${null===(Y=this._interactivityGraph.declarations)||void 0===Y?void 0:Y[c.declaration].op} - ${C.error}`)}const C=[];for(const Y of h.flowGraphMapping.Ck){const E=this._getEmptyBlock(Y,h.fullOperationName);this._parseNodeConfiguration(c,E,h.flowGraphMapping,Y),C.push(E)}this._nodes.push({Ck:C,fullOperationName:h.fullOperationName})}}_getEmptyBlock(Y,c){return{uniqueId:(0,Uh.e)(),className:Y,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:c,metadata:{}}}_parseNodeConfiguration(Y,c,h,C){const E=c.config;if(Y.configuration){const c=Object.keys(Y.configuration);for(const b of c){var N,Q;const c=null===(N=Y.configuration)||void 0===N?void 0:N[b];if(!c)throw P.e.Error(["No value found for node configuration",b]),new Error("Error parsing node configuration");const H=null===(Q=h.configuration)||void 0===Q?void 0:Q[b];if(H&&H.lC?H.lC===C:0===h.Ck.indexOf(C)){const Y=(null===H||void 0===H?void 0:H.name)||b;c&&"undefined"!==typeof c.value||"undefined"===typeof(null===H||void 0===H?void 0:H.defaultValue)?c.value.length>=0?E[Y]={value:1===c.value.length?c.value[0]:c.value}:P.e.Warn(["Invalid value for node configuration",c]):E[Y]={value:H.defaultValue},H&&H.dataTransformer&&(E[Y].value=H.dataTransformer([E[Y].value],this)[0])}}}}_parseNodeConnections(Y){for(let X=0;X<this._nodes.length;X++){var c;const Z=null===(c=this._interactivityGraph.nodes)||void 0===c?void 0:c[X];if(!Z)throw P.e.Error(["No node found for interactivity node",this._nodes[X]]),new Error("Error parsing node connections");const a=this._nodes[X],G=this._mappings[Z.declaration];if(!G)throw P.e.Error(["No mapping found for node",Z]),new Error("Error parsing node connections");const K=Z.flows||{},I=Object.keys(K).sort();for(const Y of I){var h,C,E,N;const c=K[Y],w=null===(h=G.flowGraphMapping.outputs)||void 0===h||null===(C=h.flows)||void 0===C?void 0:C[Y],W=(null===w||void 0===w?void 0:w.name)||Y,q=this._createNewSocketConnection(W,!0);(w&&w.lC&&a.Ck.find((Y=>Y.className===w.lC))||a.Ck[0]).signalOutputs.push(q);const k=c.node,M=this._nodes[k];if(!M)throw P.e.Error(["No node found for input node id",k]),new Error("Error parsing node connections");const p=Gh(M.fullOperationName);if(!p)throw P.e.Error(["No mapping found for input node",M]),new Error("Error parsing node connections");let y=null===(E=p.inputs)||void 0===E||null===(N=E.flows)||void 0===N?void 0:N[c.socket||"in"],d=!1;if(!y)for(const Y in null===(Q=p.inputs)||void 0===Q?void 0:Q.flows){var Q,b,H;if(Y.startsWith("[")&&Y.endsWith("]"))d=!0,y=null===(b=p.inputs)||void 0===b||null===(H=b.flows)||void 0===H?void 0:H[Y]}const D=y?d?y.name.replace("$1",c.socket||""):y.name:c.socket||"in",T=y&&y.lC&&M.Ck.find((Y=>Y.className===y.lC))||M.Ck[0];let e=T.signalInputs.find((Y=>Y.name===D));e||(e=this._createNewSocketConnection(D),T.signalInputs.push(e)),e.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(e.uniqueId)}const s=Z.values||{},x=Object.keys(s);for(const c of x){var w,W;const h=s[c];let C=null===(w=G.flowGraphMapping.inputs)||void 0===w||null===(W=w.values)||void 0===W?void 0:W[c],E=!1;if(!C)for(const Y in null===(q=G.flowGraphMapping.inputs)||void 0===q?void 0:q.values){var q,k,M;if(Y.startsWith("[")&&Y.endsWith("]"))E=!0,C=null===(k=G.flowGraphMapping.inputs)||void 0===k||null===(M=k.values)||void 0===M?void 0:M[Y]}const N=C?E?C.name.replace("$1",c):C.name:c,Q=this._createNewSocketConnection(N);if((C&&C.lC&&a.Ck.find((Y=>Y.className===C.lC))||a.Ck[0]).dataInputs.push(Q),void 0!==h.value){const c=this._parseVariable(h,C&&C.dataTransformer);Y._connectionValues[Q.uniqueId]=c}else{if("undefined"===typeof h.node)throw P.e.Error(["Invalid value for value connection",h]),new Error("Error parsing node connections");{var p,y,d;const Y=h.node,c=h.socket||"value",C=this._nodes[Y];if(!C)throw P.e.Error(["No node found for output socket reference",h]),new Error("Error parsing node connections");const E=Gh(C.fullOperationName);if(!E)throw P.e.Error(["No mapping found for output socket reference",h]),new Error("Error parsing node connections");let N=null===(p=E.outputs)||void 0===p||null===(y=p.values)||void 0===y?void 0:y[c],b=!1;if(!N)for(const h in null===(D=E.outputs)||void 0===D?void 0:D.values){var D,T,e;if(h.startsWith("[")&&h.endsWith("]"))b=!0,N=null===(T=E.outputs)||void 0===T||null===(e=T.values)||void 0===e?void 0:e[h]}const H=N?b?N.name.replace("$1",c):null===(d=N)||void 0===d?void 0:d.name:c,w=N&&N.lC&&C.Ck.find((Y=>Y.className===N.lC))||C.Ck[0];let W=w.dataOutputs.find((Y=>Y.name===H));W||(W=this._createNewSocketConnection(H,!0),w.dataOutputs.push(W)),Q.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(Q.uniqueId)}}}if(G.flowGraphMapping.interBlockConnectors)for(const Y of G.flowGraphMapping.interBlockConnectors){const c=Y.input,h=Y.output,C=Y.isVariable;this._connectFlowGraphNodes(c,h,a.Ck[Y.inputBlockIndex],a.Ck[Y.outputBlockIndex],C)}if(G.flowGraphMapping.extraProcessor){var r;const c=null===(r=this._interactivityGraph.declarations)||void 0===r?void 0:r[Z.declaration];if(!c)throw P.e.Error(["No declaration found for extra processor",Z]),new Error("Error parsing node connections");a.Ck=G.flowGraphMapping.extraProcessor(Z,c,G.flowGraphMapping,this,a.Ck,Y,this._gltf)}}}_createNewSocketConnection(Y,c){return{uniqueId:(0,Uh.e)(),name:Y,_connectionType:c?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Y,c,h,C,E){const N=E?h.dataInputs:h.signalInputs,Q=E?C.dataOutputs:C.signalOutputs,b=N.find((c=>c.name===Y))||this._createNewSocketConnection(Y),H=Q.find((Y=>Y.name===c))||this._createNewSocketConnection(c,!0);N.find((c=>c.name===Y))||N.push(b),Q.find((Y=>Y.name===c))||Q.push(H),b.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(b.uniqueId)}getVariableName(Y){return"staticVariable_"+Y}serializeToFlowGraph(){const Y={uniqueId:(0,Uh.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Y);for(let c=0;c<this._staticVariables.length;c++){const h=this._staticVariables[c];Y._userVariables[this.getVariableName(c)]=h}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Y,c)=>Y.concat(c.Ck)),[]),executionContexts:[Y]}}}const vh="KHR_interactivity";class gh{constructor(Y){this._loader=Y,this.name=vh,this.enabled=this._loader.isExtensionUsed(vh),this._pathConverter=(0,z.k)(this._loader.Dc),Y._skipStartAnimationStep=!0;const c=Y.babylonScene;c&&function(Y){(0,z.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Y.activeCamera)return new E.Quaternion(NaN,NaN,NaN,NaN);const c=E.Quaternion.FromRotationMatrix(Y.activeCamera.getWorldMatrix()).normalize();return Y.useRightHandedSystem||(c.w*=-1,c.x*=-1),c},type:"Quaternion",getTarget:()=>Y.activeCamera}),(0,z.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Y.activeCamera)return new E.bh(NaN,NaN,NaN);const c=Y.activeCamera.getWorldMatrix().getTranslation();return Y.useRightHandedSystem||(c.x*=-1),c},type:"bh",getTarget:()=>Y.activeCamera}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Y=>{var c;return(null===(c=Y._babylonAnimationGroup)||void 0===c?void 0:c.isPlaying)??!1},type:"boolean",getTarget:Y=>Y._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Y=>{var c;return((null===(c=Y._babylonAnimationGroup)||void 0===c?void 0:c.from)??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Y=>{var c;return((null===(c=Y._babylonAnimationGroup)||void 0===c?void 0:c.to)??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Y=>{var c;return((null===(c=Y._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup}),(0,z.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Y=>{var c;return((null===(c=Y._babylonAnimationGroup)||void 0===c?void 0:c.getCurrentFrame())??0)/60},type:"number",getTarget:Y=>Y._babylonAnimationGroup})}(c)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Y;if(!this._loader.babylonScene||!this._pathConverter)return;const c=this._loader.babylonScene,h=null===(Y=this._loader.Dc.extensions)||void 0===Y?void 0:Y.KHR_interactivity;if(!h)return;const C=new ph.d({wh:c});C.dispatchEventsSynchronously=!1;const E=h.graphs.map((Y=>new nh(Y,this._loader.Dc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async Y=>await Xh(Y,{coordinator:C,pathConverter:this._pathConverter})))),C.start()}}var zh;zh=async()=>(await Promise.resolve().then(h.bind(h,14512))).FlowGraphGLTFDataProvider,Ph[`${vh}/${"FlowGraphGLTFDataProvider"}`]=zh,g(vh),v(vh,!0,(Y=>new gh(Y)));const Oh="KHR_node_visibility";(0,z.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Y=>{const c=Y._babylonTransformNode;return!c||void 0===c.isVisible||c.isVisible},set:(Y,c)=>{var h,C;null===(h=c._primitiveBabylonMeshes)||void 0===h||h.forEach((Y=>{Y.inheritVisibility=!0})),c._babylonTransformNode&&(c._babylonTransformNode.isVisible=Y),null===(C=c._primitiveBabylonMeshes)||void 0===C||C.forEach((c=>{c.isVisible=Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class oh{constructor(Y){this.name=Oh,this._loader=Y,this.enabled=Y.isExtensionUsed(Oh)}async onReady(){var Y;null===(Y=this._loader.Dc.nodes)||void 0===Y||Y.forEach((Y=>{var c,h,C,E;(null===(c=Y._primitiveBabylonMeshes)||void 0===c||c.forEach((Y=>{Y.inheritVisibility=!0})),null!==(h=Y.extensions)&&void 0!==h&&h.KHR_node_visibility)&&(!1===(null===(C=Y.extensions)||void 0===C?void 0:C.KHR_node_visibility.visible)&&(Y._babylonTransformNode&&(Y._babylonTransformNode.isVisible=!1),null===(E=Y._primitiveBabylonMeshes)||void 0===E||E.forEach((Y=>{Y.isVisible=!1}))))}))}dispose(){this._loader=null}}g(Oh),v(Oh,!0,(Y=>new oh(Y)));const fh="KHR_node_selectability";Ih("event/onSelect",fh,{Ck:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",lC:"FlowGraphGetVariableBlock",dataTransformer:Y=>["pickedMesh_"+Y[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",lC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){var b,H,w,W,q,k;const M=E[E.length-1];M.config=M.config||{},M.config.glTF=Q;const p=null===(b=Y.configuration)||void 0===b||null===(H=b.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const P="pickedMesh_"+p;return E[1].config.variable=P,N._userVariables[P]={className:"Mesh",id:null===Q||void 0===Q||null===(w=Q.nodes)||void 0===w||null===(W=w[p]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Q||void 0===Q||null===(q=Q.nodes)||void 0===q||null===(k=q[p]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},E}}),(0,z.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Y=>{const c=Y._babylonTransformNode;return!c||void 0===c.KW||c.KW},set:(Y,c)=>{var h;null===(h=c._primitiveBabylonMeshes)||void 0===h||h.forEach((c=>{c.KW=Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"KW"],type:"boolean"});class Lh{constructor(Y){this.name=fh,this._loader=Y,this.enabled=Y.isExtensionUsed(fh)}async onReady(){var Y;null===(Y=this._loader.Dc.nodes)||void 0===Y||Y.forEach((Y=>{var c,h,C;null!==(c=Y.extensions)&&void 0!==c&&c.KHR_node_selectability&&!1===(null===(h=Y.extensions)||void 0===h?void 0:h.KHR_node_selectability.selectable)&&(null===(C=Y._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((Y=>{Y.KW=!1})))}))}dispose(){this._loader=null}}g(fh),v(fh,!0,(Y=>new Lh(Y)));const uh="KHR_node_hoverability",ih="targetMeshPointerOver_";Ih("event/onHoverIn",uh,{Ck:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",lC:"FlowGraphGetVariableBlock",dataTransformer:Y=>[ih+Y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",lC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){var b,H,w,W,q,k;const M=E[E.length-1];M.config=M.config||{},M.config.glTF=Q;const p=null===(b=Y.configuration)||void 0===b||null===(H=b.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const P=ih+p;return E[1].config.variable=P,N._userVariables[P]={className:"Mesh",id:null===Q||void 0===Q||null===(w=Q.nodes)||void 0===w||null===(W=w[p]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Q||void 0===Q||null===(q=Q.nodes)||void 0===q||null===(k=q[p]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},E}});const Rh="targetMeshPointerOut_";Ih("event/onHoverOut",uh,{Ck:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",lC:"FlowGraphGetVariableBlock",dataTransformer:Y=>[Rh+Y[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",lC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Y,c,h,C,E,N,Q){var b,H,w,W,q,k;const M=E[E.length-1];M.config=M.config||{},M.config.glTF=Q;const p=null===(b=Y.configuration)||void 0===b||null===(H=b.nodeIndex)||void 0===H?void 0:H.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const P=Rh+p;return E[1].config.variable=P,N._userVariables[P]={className:"Mesh",id:null===Q||void 0===Q||null===(w=Q.nodes)||void 0===w||null===(W=w[p]._babylonTransformNode)||void 0===W?void 0:W.id,uniqueId:null===Q||void 0===Q||null===(q=Q.nodes)||void 0===q||null===(k=q[p]._babylonTransformNode)||void 0===k?void 0:k.uniqueId},E}}),(0,z.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Y=>{const c=Y._babylonTransformNode;return!c||void 0===c.pointerOverDisableMeshTesting||c.pointerOverDisableMeshTesting},set:(Y,c)=>{var h;null===(h=c._primitiveBabylonMeshes)||void 0===h||h.forEach((c=>{c.pointerOverDisableMeshTesting=!Y}))},getTarget:Y=>Y._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Bh{constructor(Y){this.name=uh,this._loader=Y,this.enabled=Y.isExtensionUsed(uh)}async onReady(){var Y;null===(Y=this._loader.Dc.nodes)||void 0===Y||Y.forEach((Y=>{var c,h,C;null!==(c=Y.extensions)&&void 0!==c&&c.KHR_node_hoverability&&!1===(null===(h=Y.extensions)||void 0===h?void 0:h.KHR_node_hoverability.hoverable)&&(null===(C=Y._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((Y=>{Y.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}g(uh),v(uh,!0,(Y=>new Bh(Y)));const th="ExtrasAsMetadata";class Fh{_assignExtras(Y,c){if(c.extras&&Object.keys(c.extras).length>0){const h=Y.metadata=Y.metadata||{};(h.Dc=h.Dc||{}).extras=c.extras}}constructor(Y){this.name=th,this.enabled=!0,this._loader=Y}dispose(){this._loader=null}loadNodeAsync(Y,c,h){return this._loader.loadNodeAsync(Y,c,(Y=>{this._assignExtras(Y,c),h(Y)}))}loadCameraAsync(Y,c,h){return this._loader.loadCameraAsync(Y,c,(Y=>{this._assignExtras(Y,c),h(Y)}))}createMaterial(Y,c,h){const C=this._loader.createMaterial(Y,c,h);return this._assignExtras(C,c),C}}g(th),v(th,!1,(Y=>new Fh(Y)));h(14512)},14391:(Y,c,h)=>{"use strict";h.d(c,{c:()=>V,f:()=>G,g:()=>a,h:()=>K});var C=h(12690),E=h(12687),N=h(14022),Q=h(13321),b=h(13289),H=h(13303),w=h(12700),W=h(12722),q=h(13319),k=h(13422),M=h(13329),p=h(12914);class P{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.OM=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Tp=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Y){this._environmentTexture=Y}getNodes(){let Y=[];Y=Y.concat(this.meshes),Y=Y.concat(this.lights),Y=Y.concat(this.cameras),Y=Y.concat(this.transformNodes);for(const c of this.skeletons)Y=Y.concat(c.bones);return Y}}class y extends P{}class d{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Y=this.rootNodes;for(const C of Y)C.dispose();Y.length=0;const c=this.skeletons;for(const C of c)C.dispose();c.length=0;const h=this.animationGroups;for(const C of h)C.dispose();h.length=0}}class D extends P{constructor(Y){super(),this._wasAddedToScene=!1,(Y=Y||W.d.LastCreatedScene)&&(this.wh=Y,this.proceduralTextures=[],Y.Mc.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Y.getEngine().onContextRestoredObservable.add((()=>{for(const Y of this.geometries)Y._rebuild();for(const Y of this.meshes)Y._rebuild();for(const Y of this.OM)Y.rebuild();for(const Y of this.textures)Y._rebuild()})))}_topologicalSort(Y){const c=new Map;for(const Q of Y)c.set(Q.uniqueId,Q);const h={dependsOn:new Map,dependedBy:new Map};for(const Q of Y){const Y=Q.uniqueId;h.dependsOn.set(Y,new Set),h.dependedBy.set(Y,new Set)}for(const Q of Y){const Y=Q.uniqueId,C=h.dependsOn.get(Y);if(Q instanceof q.d){const E=Q.sourceMesh;c.has(E.uniqueId)&&(C.add(E.uniqueId),h.dependedBy.get(E.uniqueId).add(Y))}const E=h.dependedBy.get(Y);for(const N of Q.getDescendants()){const C=N.uniqueId;if(c.has(C)){E.add(C);h.dependsOn.get(C).add(Y)}}}const C=[],E=[];for(const Q of Y){const Y=Q.uniqueId;0===h.dependsOn.get(Y).size&&(E.push(Q),c.delete(Y))}const N=E;for(;N.length>0;){const Y=N.shift();C.push(Y);const E=h.dependedBy.get(Y.uniqueId);for(const C of Array.from(E.values())){const E=h.dependsOn.get(C);E.delete(Y.uniqueId),0===E.size&&c.get(C)&&(N.push(c.get(C)),c.delete(C))}}return c.size>0&&(w.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),c.forEach((Y=>{w.e.Error(Y.name)}))),C}_addNodeAndDescendantsToList(Y,c,h,C){if(h&&(!C||C(h))&&!c.has(h.uniqueId)){Y.push(h),c.add(h.uniqueId);for(const E of h.getDescendants(!0))this._addNodeAndDescendantsToList(Y,c,E,C)}}_isNodeInContainer(Y){return Y instanceof H.c&&-1!==this.meshes.indexOf(Y)||(Y instanceof b.e&&-1!==this.transformNodes.indexOf(Y)||(Y instanceof k.e&&-1!==this.lights.indexOf(Y)||Y instanceof M.b&&-1!==this.cameras.indexOf(Y)))}_isValidHierarchy(){for(const Y of this.meshes)if(Y.parent&&!this._isNodeInContainer(Y.parent))return w.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.transformNodes)if(Y.parent&&!this._isNodeInContainer(Y.parent))return w.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.lights)if(Y.parent&&!this._isNodeInContainer(Y.parent))return w.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;for(const Y of this.cameras)if(Y.parent&&!this._isNodeInContainer(Y.parent))return w.e.Warn(`Node ${Y.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Y){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],h=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const C={},N={},b=new d,H=[],w=[],W={doNotInstantiate:!0,...h},q=[],k=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(q,k,E,W.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(q,k,E,W.predicate);const M=this._topologicalSort(q),p=(h,E)=>{if(((c,h)=>{if(C[c.uniqueId]=h.uniqueId,N[h.uniqueId]=h,Y&&(h.name=Y(c.name)),h instanceof Q.e){const Y=h;if(Y.morphTargetManager){const h=c.morphTargetManager;Y.morphTargetManager=h.clone();for(let c=0;c<h.numTargets;c++){const E=h.getTarget(c),Q=Y.morphTargetManager.getTarget(c);C[E.uniqueId]=Q.uniqueId,N[Q.uniqueId]=Q}}}})(h,E),h.parent){const Y=C[h.parent.uniqueId],c=N[Y];E.parent=c||h.parent}if(E.position&&h.position&&E.position.N(h.position),E.rotationQuaternion&&h.rotationQuaternion&&E.rotationQuaternion.N(h.rotationQuaternion),E.rotation&&h.rotation&&E.rotation.N(h.rotation),E.lc&&h.lc&&E.lc.N(h.lc),E.material){const Q=E;if(Q.material)if(c){const c=h.material;if(-1===w.indexOf(c)){let h=c.clone(Y?Y(c.name):"Clone of "+c.name);if(w.push(c),C[c.uniqueId]=h.uniqueId,N[h.uniqueId]=h,"MultiMaterial"===c.getClassName()){const E=c;for(const c of E.gc)c&&(h=c.clone(Y?Y(c.name):"Clone of "+c.name),w.push(c),C[c.uniqueId]=h.uniqueId,N[h.uniqueId]=h);E.gc=E.gc.map((Y=>Y&&N[C[Y.uniqueId]]))}}"InstancedMesh"!==Q.getClassName()&&(Q.material=N[C[c.uniqueId]])}else"MultiMaterial"===Q.material.getClassName()?-1===this.wh.multiMaterials.indexOf(Q.material)&&this.wh.addMultiMaterial(Q.material):-1===this.wh.materials.indexOf(Q.material)&&this.wh.addMaterial(Q.material)}null===E.parent&&b.rootNodes.push(E)};for(const E of M)if("InstancedMesh"===E.getClassName()){const Y=E,c=Y.sourceMesh,h=C[c.uniqueId];p(Y,("number"===typeof h?N[h]:c).createInstance(Y.name))}else{let Y=!0;"Rc"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?Y=!1:W.doNotInstantiate&&(Y="function"===typeof W.doNotInstantiate?!W.doNotInstantiate(E):!W.doNotInstantiate);const c=Y?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!c)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);p(E,c)}for(const E of this.skeletons){if(W.predicate&&!W.predicate(E))continue;const c=E.clone(Y?Y(E.name):"Clone of "+E.name);for(const Y of this.meshes)if(Y.skeleton===E&&!Y.isAnInstance){const h=N[C[Y.uniqueId]];if(!h||h.isAnInstance)continue;if(h.skeleton=c,-1!==H.indexOf(c))continue;H.push(c);for(const Y of c.bones)Y._linkedTransformNode&&(Y._linkedTransformNode=N[C[Y._linkedTransformNode.uniqueId]])}b.skeletons.push(c)}for(const E of this.animationGroups){if(W.predicate&&!W.predicate(E))continue;const c=E.clone(Y?Y(E.name):"Clone of "+E.name,(Y=>N[C[Y.uniqueId]]||Y));b.animationGroups.push(c)}return b}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.wh.environmentTexture=this.environmentTexture);for(const Y of this.wh._serializableComponents)Y.addFromContainer(this);this.wh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const c=[];for(const h of this.cameras)Y&&!Y(h)||(this.wh.addCamera(h),c.push(h));for(const h of this.lights)Y&&!Y(h)||(this.wh.addLight(h),c.push(h));for(const h of this.meshes)Y&&!Y(h)||(this.wh.iq(h),c.push(h));for(const h of this.skeletons)Y&&!Y(h)||this.wh.addSkeleton(h);for(const h of this.animations)Y&&!Y(h)||this.wh.addAnimation(h);for(const h of this.animationGroups)Y&&!Y(h)||this.wh.addAnimationGroup(h);for(const h of this.multiMaterials)Y&&!Y(h)||this.wh.addMultiMaterial(h);for(const h of this.materials)Y&&!Y(h)||this.wh.addMaterial(h);for(const h of this.morphTargetManagers)Y&&!Y(h)||this.wh.addMorphTargetManager(h);for(const h of this.geometries)Y&&!Y(h)||this.wh.addGeometry(h);for(const h of this.transformNodes)Y&&!Y(h)||(this.wh.addTransformNode(h),c.push(h));for(const h of this.actionManagers)Y&&!Y(h)||this.wh.addActionManager(h);for(const h of this.textures)Y&&!Y(h)||this.wh.addTexture(h);for(const h of this.reflectionProbes)Y&&!Y(h)||this.wh.addReflectionProbe(h);for(const h of c)h.parent&&-1===this.wh.getNodes().indexOf(h.parent)&&(h.setParent?h.setParent(null):h.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.wh.environmentTexture&&(this.wh.environmentTexture=null);for(const Y of this.wh._serializableComponents)Y.removeFromContainer(this)}removeFromScene(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const c of this.cameras)Y&&!Y(c)||this.wh.removeCamera(c);for(const c of this.lights)Y&&!Y(c)||this.wh.removeLight(c);for(const c of this.meshes)Y&&!Y(c)||this.wh.uq(c,!0);for(const c of this.skeletons)Y&&!Y(c)||this.wh.removeSkeleton(c);for(const c of this.animations)Y&&!Y(c)||this.wh.removeAnimation(c);for(const c of this.animationGroups)Y&&!Y(c)||this.wh.removeAnimationGroup(c);for(const c of this.multiMaterials)Y&&!Y(c)||this.wh.removeMultiMaterial(c);for(const c of this.materials)Y&&!Y(c)||this.wh.removeMaterial(c);for(const c of this.morphTargetManagers)Y&&!Y(c)||this.wh.removeMorphTargetManager(c);for(const c of this.geometries)Y&&!Y(c)||this.wh.removeGeometry(c);for(const c of this.transformNodes)Y&&!Y(c)||this.wh.removeTransformNode(c);for(const c of this.actionManagers)Y&&!Y(c)||this.wh.removeActionManager(c);for(const c of this.textures)Y&&!Y(c)||this.wh.removeTexture(c);for(const c of this.reflectionProbes)Y&&!Y(c)||this.wh.removeReflectionProbe(c)}dispose(){const Y=this.cameras.slice(0);for(const M of Y)M.dispose();this.cameras.length=0;const c=this.lights.slice(0);for(const M of c)M.dispose();this.lights.length=0;const h=this.meshes.slice(0);for(const M of h)M.dispose();this.meshes.length=0;const C=this.skeletons.slice(0);for(const M of C)M.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const M of E)M.dispose();this.animationGroups.length=0;const N=this.multiMaterials.slice(0);for(const M of N)M.dispose();this.multiMaterials.length=0;const Q=this.materials.slice(0);for(const M of Q)M.dispose();this.materials.length=0;const b=this.geometries.slice(0);for(const M of b)M.dispose();this.geometries.length=0;const H=this.transformNodes.slice(0);for(const M of H)M.dispose();this.transformNodes.length=0;const w=this.actionManagers.slice(0);for(const M of w)M.dispose();this.actionManagers.length=0;const W=this.textures.slice(0);for(const M of W)M.dispose();this.textures.length=0;const q=this.reflectionProbes.slice(0);for(const M of q)M.dispose();this.reflectionProbes.length=0;const k=this.morphTargetManagers.slice(0);for(const M of k)M.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const M of this.wh._serializableComponents)M.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.wh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Y,c,h){if(Y&&c)for(const C of Y){let Y=!0;if(h)for(const c of h)if(C===c){Y=!1;break}Y&&(c.push(C),C._parentContainer=this)}}moveAllFromScene(Y){this._wasAddedToScene=!1,void 0===Y&&(Y=new y);for(const c in this)Object.prototype.hasOwnProperty.call(this,c)&&(this[c]=this[c]||("_environmentTexture"===c?null:[]),this._moveAssets(this.wh[c],this[c],Y[c]));this.environmentTexture=this.wh.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Y=new Q.e("assetContainerRootMesh",this.wh);for(const c of this.meshes)c.parent||Y.addChild(c);return this.meshes.unshift(Y),Y}mergeAnimationsTo(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.d.LastCreatedScene,c=arguments.length>1?arguments[1]:void 0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Y)return w.e.Error("No scene available to merge animations to"),[];const C=h||(c=>{let h=null;const C=c.animations.length?c.animations[0].targetProperty:"",E=c.name.split(".").join("").split("_primitive")[0];switch(C){case"position":case"rotationQuaternion":h=Y.getTransformNodeByName(c.name)||Y.getTransformNodeByName(E);break;case"influence":h=Y.getMorphTargetByName(c.name)||Y.getMorphTargetByName(E);break;default:h=Y.getNodeByName(c.name)||Y.getNodeByName(E)}return h}),E=this.getNodes();for(const b of E){const Y=C(b);if(null!==Y){for(const c of b.animations){const h=Y.animations.filter((Y=>Y.targetProperty===c.targetProperty));for(const c of h){const h=Y.animations.indexOf(c,0);h>-1&&Y.animations.splice(h,1)}}Y.animations=Y.animations.concat(b.animations)}}const N=[],Q=this.animationGroups.slice();for(const b of Q){N.push(b.clone(b.name,C));for(const Y of b.animatables)Y.stop()}for(const b of c){const c=C(b.target);c&&(Y.beginAnimation(c,b.fromFrame,b.toFrame,b.loopAnimation,b.speedRatio,b.onAnimationEnd?b.onAnimationEnd:void 0,void 0,!0,void 0,b.onAnimationLoop?b.onAnimationLoop:void 0),Y.stopAnimation(b.target))}return N}populateRootNodes(){this.rootNodes.length=0;for(const Y of this.meshes)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.transformNodes)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.lights)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y);for(const Y of this.cameras)Y.parent||-1!==this.rootNodes.indexOf(Y)||this.rootNodes.push(Y)}addAllAssetsToContainer(Y){if(!Y)return;const c=[],h=new Set;for(c.push(Y);c.length>0;){const Y=c.pop();if(Y instanceof Q.e?(Y.Ic&&-1===this.geometries.indexOf(Y.Ic)&&this.geometries.push(Y.Ic),this.meshes.push(Y)):Y instanceof q.d?this.meshes.push(Y):Y instanceof b.e?this.transformNodes.push(Y):Y instanceof k.e?this.lights.push(Y):Y instanceof M.b&&this.cameras.push(Y),Y instanceof H.c){if(Y.material&&-1===this.materials.indexOf(Y.material)){this.materials.push(Y.material);for(const c of Y.material.getActiveTextures())-1===this.textures.indexOf(c)&&this.textures.push(c)}Y.skeleton&&-1===this.skeletons.indexOf(Y.skeleton)&&this.skeletons.push(Y.skeleton),Y.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Y.morphTargetManager)&&this.morphTargetManagers.push(Y.morphTargetManager)}for(const C of Y.getChildren())h.has(C)||c.push(C);h.add(Y)}this.populateRootNodes()}_getByTags(Y,c,h){if(void 0===c)return Y;const C=[];for(const E in Y){const N=Y[E];p.d&&p.d.MatchesQuery(N,c)&&(!h||h(N))&&C.push(N)}return C}getMeshesByTags(Y,c){return this._getByTags(this.meshes,Y,c)}getCamerasByTags(Y,c){return this._getByTags(this.cameras,Y,c)}getLightsByTags(Y,c){return this._getByTags(this.lights,Y,c)}getMaterialsByTags(Y,c){return this._getByTags(this.materials,Y,c).concat(this._getByTags(this.multiMaterials,Y,c))}getTransformNodesByTags(Y,c){return this._getByTags(this.transformNodes,Y,c)}}var T=h(12740);class e{constructor(Y){this.byteOffset=0,this.buffer=Y}async loadAsync(Y){const c=await this.buffer.readAsync(this.byteOffset,Y);this._dataView=new DataView(c.buffer,c.byteOffset,c.byteLength),this._dataByteOffset=0}readUint32(){const Y=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Y}readUint8Array(Y){const c=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Y);return this._dataByteOffset+=Y,this.byteOffset+=Y,c}readString(Y){return(0,T.g)(this.readUint8Array(Y))}skipBytes(Y){this._dataByteOffset+=Y,this.byteOffset+=Y}}var r=h(14399);const X="Z2xURg",Z={name:"Dc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Y=>-1!==Y.indexOf("asset")&&-1!==Y.indexOf("version")||Y.startsWith("data:base64,"+X)||Y.startsWith("data:;base64,"+X)||Y.startsWith("data:application/octet-stream;base64,"+X)||Y.startsWith("data:model/gltf-binary;base64,"+X)};var a,G,K,I=h(12728),s=h(12733);function x(Y,c,h){try{return Promise.resolve(new Uint8Array(Y,c,h))}catch(C){return Promise.reject(C)}}!function(Y){Y[Y.AUTO=0]="AUTO",Y[Y.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(a||(a={})),function(Y){Y[Y.NONE=0]="NONE",Y[Y.FIRST=1]="FIRST",Y[Y.ALL=2]="ALL"}(G||(G={})),function(Y){Y[Y.LOADING=0]="LOADING",Y[Y.READY=1]="READY",Y[Y.COMPLETE=2]="COMPLETE"}(K||(K={}));class A{constructor(){this.coordinateSystemMode=a.AUTO,this.animationStartMode=G.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Y=>Promise.resolve(Y),this.extensionOptions={}}N(Y){Y&&(this.onParsed=Y.onParsed,this.coordinateSystemMode=Y.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Y.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Y.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Y.loadSkins??this.loadSkins,this.loadMorphTargets=Y.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Y.compileMaterials??this.compileMaterials,this.useClipPlane=Y.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Y.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Y.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Y.useRangeRequests??this.useRangeRequests,this.createInstances=Y.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Y.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Y.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Y.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Y.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Y.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Y.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Y.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Y.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Y.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Y.customRootNode,this.onMeshLoaded=Y.onMeshLoaded,this.onSkinLoaded=Y.onSkinLoaded,this.onTextureLoaded=Y.onTextureLoaded,this.onMaterialLoaded=Y.onMaterialLoaded,this.onCameraLoaded=Y.onCameraLoaded,this.extensionOptions=Y.extensionOptions??this.extensionOptions)}}class V extends A{constructor(Y){super(),this.onParsedObservable=new C.c,this.onMeshLoadedObservable=new C.c,this.onSkinLoadedObservable=new C.c,this.onTextureLoadedObservable=new C.c,this.onMaterialLoadedObservable=new C.c,this.onCameraLoadedObservable=new C.c,this.onCompleteObservable=new C.c,this.onErrorObservable=new C.c,this.Mc=new C.c,this.onExtensionLoadedObservable=new C.c,this.validate=!1,this.onValidatedObservable=new C.c,this._loader=null,this._state=null,this._requests=new Array,this.name=Z.name,this.extensions=Z.extensions,this.onLoaderStateChangedObservable=new C.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.N(Y)}set onParsed(Y){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Y&&(this._onParsedObserver=this.onParsedObservable.add(Y))}set onMeshLoaded(Y){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Y&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Y))}set onSkinLoaded(Y){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Y&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((c=>Y(c.node,c.skinnedNode))))}set onTextureLoaded(Y){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Y&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Y))}set onMaterialLoaded(Y){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Y&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Y))}set onCameraLoaded(Y){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Y&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Y))}set onComplete(Y){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Y)}set onError(Y){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Y)}set onDispose(Y){this._onDisposeObserver&&this.Mc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Mc.add(Y)}set onExtensionLoaded(Y){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Y)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Y){this._loggingEnabled!==Y&&(this._loggingEnabled=Y,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Y){this._capturePerformanceCounters!==Y&&(this._capturePerformanceCounters=Y,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Y){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Y)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Y of this._requests)Y.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Y=>Promise.resolve(Y),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Mc.notifyObservers(void 0),this.Mc.clear()}loadFile(Y,c,h,N,Q,b,H,W){if(ArrayBuffer.isView(c))return this._loadBinary(Y,c,h,N,H,W),null;this._progressCallback=Q;const q=c.name||E.Tools.GetFilename(c);if(b){if(this.useRangeRequests){this.validate&&w.e.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new C.c},E={readAsync:(h,C)=>new Promise(((E,N)=>{this._loadFile(Y,c,(Y=>{E(new Uint8Array(Y))}),!0,(Y=>{N(Y)}),(Y=>{Y.setRequestHeader("Range",`bytes=${h}-${h+C-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new e(E)).then((Y=>{h.onCompleteObservable.notifyObservers(h),N(Y)}),H?Y=>H(void 0,Y):void 0),h}return this._loadFile(Y,c,(c=>{this._validate(Y,new Uint8Array(c,0,c.byteLength),h,q),this._unpackBinaryAsync(new e({readAsync:(Y,h)=>x(c,Y,h),byteLength:c.byteLength})).then((Y=>{N(Y)}),H?Y=>H(void 0,Y):void 0)}),!0,H)}return this._loadFile(Y,c,(c=>{try{this._validate(Y,c,h,q),N({json:this._parseJson(c)})}catch{H&&H()}}),!1,H)}_loadBinary(Y,c,h,C,E,N){this._validate(Y,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),h,N),this._unpackBinaryAsync(new e({readAsync:(Y,h)=>function(Y,c,h){try{if(c<0||c>=Y.byteLength)throw new RangeError("Offset is out of range.");if(c+h>Y.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Y.buffer,Y.byteOffset+c,h))}catch(C){return Promise.reject(C)}}(c,Y,h),byteLength:c.byteLength})).then((Y=>{C(Y)}),E?Y=>E(void 0,Y):void 0)}importMeshAsync(Y,c,h,C,E,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(h),this._loader.importMeshAsync(Y,c,null,h,C,E,N))))}loadAsync(Y,c,h,C,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(c),this._loader.loadAsync(Y,c,h,C,E))))}loadAssetContainerAsync(Y,c,h,C,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(c),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(c);const N=new D(Y),Q=[];this.onMaterialLoadedObservable.add((Y=>{Q.push(Y)}));const b=[];this.onTextureLoadedObservable.add((Y=>{b.push(Y)}));const H=[];this.onCameraLoadedObservable.add((Y=>{H.push(Y)}));const w=[];return this.onMeshLoadedObservable.add((Y=>{Y.morphTargetManager&&w.push(Y.morphTargetManager)})),this._loader.importMeshAsync(null,Y,N,c,h,C,E).then((Y=>(Array.prototype.push.apply(N.geometries,Y.geometries),Array.prototype.push.apply(N.meshes,Y.meshes),Array.prototype.push.apply(N.OM,Y.OM),Array.prototype.push.apply(N.skeletons,Y.skeletons),Array.prototype.push.apply(N.animationGroups,Y.animationGroups),Array.prototype.push.apply(N.materials,Q),Array.prototype.push.apply(N.textures,b),Array.prototype.push.apply(N.lights,Y.lights),Array.prototype.push.apply(N.transformNodes,Y.transformNodes),Array.prototype.push.apply(N.cameras,H),Array.prototype.push.apply(N.morphTargetManagers,w),N)))}))}canDirectLoad(Y){return Z.canDirectLoad(Y)}directLoad(Y,c){if(c.startsWith("base64,"+X)||c.startsWith(";base64,"+X)||c.startsWith("application/octet-stream;base64,"+X)||c.startsWith("model/gltf-binary;base64,"+X)){const h=(0,I.c)(c);return this._validate(Y,new Uint8Array(h,0,h.byteLength)),this._unpackBinaryAsync(new e({readAsync:(Y,c)=>x(h,Y,c),byteLength:h.byteLength}))}return this._validate(Y,c),Promise.resolve({json:this._parseJson(c)})}createPlugin(Y){return new V(Y[Z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Y,c)=>{this.onCompleteObservable.addOnce((()=>{Y()})),this.onErrorObservable.addOnce((Y=>{c(Y)}))}))}_setState(Y){this._state!==Y&&(this._state=Y,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(K[this._state]))}_loadFile(Y,c,h,C,E,N){const Q=Y._loadFile(c,h,(Y=>{this._onProgress(Y,Q)}),!0,C,E,N);return Q.onCompleteObservable.add((()=>{Q._lengthComputable=!0,Q._total=Q._loaded})),this._requests.push(Q),Q}_onProgress(Y,c){if(!this._progressCallback)return;c._lengthComputable=Y.lengthComputable,c._loaded=Y.loaded,c._total=Y.total;let h=!0,C=0,E=0;for(const N of this._requests){if(void 0===N._lengthComputable||void 0===N._loaded||void 0===N._total)return;h=h&&N._lengthComputable,C+=N._loaded,E+=N._total}this._progressCallback({lengthComputable:h,loaded:C,total:h?E:0})}_validate(Y,c){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),r.b.ValidateAsync(c,h,C,(c=>this.preprocessUrlAsync(h+c).then((c=>Y._loadFileAsync(c,void 0,!0,!0).then((Y=>new Uint8Array(Y,0,Y.byteLength))))))).then((Y=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Y),this.onValidatedObservable.clear()}),(Y=>{this._endPerformanceCounter("Validate JSON"),E.Tools.Warn(`Failed to validate: ${Y.message}`),this.onValidatedObservable.clear()})))}_getLoader(Y){const c=Y.json.asset||{};this._log(`Asset version: ${c.version}`),c.minVersion&&this._log(`Asset minimum version: ${c.minVersion}`),c.generator&&this._log(`Asset generator: ${c.generator}`);const h=V._parseVersion(c.version);if(!h)throw new Error("Invalid version: "+c.version);if(void 0!==c.minVersion){const Y=V._parseVersion(c.minVersion);if(!Y)throw new Error("Invalid minimum version: "+c.minVersion);if(V._compareVersion(Y,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+c.minVersion)}const C={1:V._CreateGLTF1Loader,2:V._CreateGLTF2Loader}[h.major];if(!C)throw new Error("Unsupported version: "+c.version);return C(this)}_parseJson(Y){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Y.length}`);const c=JSON.parse(Y);return this._endPerformanceCounter("Parse JSON"),c}_unpackBinaryAsync(Y){return this._startPerformanceCounter("Unpack Binary"),Y.loadAsync(20).then((()=>{const c=Y.readUint32();if(1179937895!==c)throw new s.h("Unexpected magic: "+c,s.g.GLTFLoaderUnexpectedMagicError);const h=Y.readUint32();this.loggingEnabled&&this._log(`Binary version: ${h}`);const C=Y.readUint32();let E;switch(this.useRangeRequests||C===Y.buffer.byteLength||w.e.Warn(`Length in header does not match actual data length: ${C} != ${Y.buffer.byteLength}`),h){case 1:E=this._unpackBinaryV1Async(Y,C);break;case 2:E=this._unpackBinaryV2Async(Y,C);break;default:throw new Error("Unsupported version: "+h)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(Y,c){const h=Y.readUint32(),C=Y.readUint32();if(0!==C)throw new Error(`Unexpected content format: ${C}`);const E=c-Y.byteOffset,N={json:this._parseJson(Y.readString(h)),bin:null};if(0!==E){const c=Y.byteOffset;N.bin={readAsync:(h,C)=>Y.buffer.readAsync(c+h,C),byteLength:E}}return Promise.resolve(N)}_unpackBinaryV2Async(Y,c){const h=1313821514,C=5130562,E=Y.readUint32();if(Y.readUint32()!==h)throw new Error("First chunk format is not JSON");return Y.byteOffset+E===c?Y.loadAsync(E).then((()=>({json:this._parseJson(Y.readString(E)),bin:null}))):Y.loadAsync(E+8).then((()=>{const N={json:this._parseJson(Y.readString(E)),bin:null},Q=()=>{const E=Y.readUint32();switch(Y.readUint32()){case h:throw new Error("Unexpected JSON chunk");case C:{const c=Y.byteOffset;N.bin={readAsync:(h,C)=>Y.buffer.readAsync(c+h,C),byteLength:E},Y.skipBytes(E);break}default:Y.skipBytes(E)}return Y.byteOffset!==c?Y.loadAsync(8).then(Q):Promise.resolve(N)};return Q()}))}static _parseVersion(Y){if("1.0"===Y||"1.0.1"===Y)return{major:1,minor:0};const c=(Y+"").match(/^(\d+)\.(\d+)/);return c?{major:parseInt(c[1]),minor:parseInt(c[2])}:null}static _compareVersion(Y,c){return Y.major>c.major?1:Y.major<c.major?-1:Y.minor>c.minor?1:Y.minor<c.minor?-1:0}_logOpen(Y){this._log(Y),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Y){const c=V._logSpaces.substring(0,2*this._logIndentLevel);w.e.Log(`${c}${Y}`)}_logDisabled(Y){}_startPerformanceCounterEnabled(Y){E.Tools.StartPerformanceCounter(Y)}_startPerformanceCounterDisabled(Y){}_endPerformanceCounterEnabled(Y){E.Tools.EndPerformanceCounter(Y)}_endPerformanceCounterDisabled(Y){}}V.IncrementalLoading=!0,V.HomogeneousCoordinates=!1,V._logSpaces="                                ",(0,N.b)(new V)},14399:(Y,c,h)=>{"use strict";h.d(c,{b:()=>Q});var C=h(12687);function E(Y,c,h,C){const E={externalResourceFunction:C};return h&&(E.uri="file:"===c?h:c+h),ArrayBuffer.isView(Y)?GLTFValidator.validateBytes(Y,E):GLTFValidator.validateString(Y,E)}function N(){const Y=[];onmessage=c=>{const h=c.data;switch(h.id){case"init":importScripts(h.url);break;case"validate":E(h.data,h.rootUrl,h.fileName,(c=>new Promise(((h,C)=>{const E=Y.length;Y.push({resolve:h,reject:C}),postMessage({id:"getExternalResource",index:E,uri:c})})))).then((Y=>{postMessage({id:"validate.resolve",value:Y})}),(Y=>{postMessage({id:"validate.reject",reason:Y})}));break;case"getExternalResource.resolve":Y[h.index].resolve(h.value);break;case"getExternalResource.reject":Y[h.index].reject(h.reason)}}}class Q{static ValidateAsync(Y,c,h,Q){return"function"===typeof Worker?new Promise(((b,H)=>{const w=`${E}(${N})()`,W=URL.createObjectURL(new Blob([w],{type:"application/javascript"})),q=new Worker(W),k=Y=>{q.removeEventListener("error",k),q.removeEventListener("message",M),H(Y)},M=Y=>{const c=Y.data;switch(c.id){case"getExternalResource":Q(c.uri).then((Y=>{q.postMessage({id:"getExternalResource.resolve",index:c.index,value:Y},[Y.buffer])}),(Y=>{q.postMessage({id:"getExternalResource.reject",index:c.index,reason:Y})}));break;case"validate.resolve":q.removeEventListener("error",k),q.removeEventListener("message",M),b(c.value),q.terminate();break;case"validate.reject":q.removeEventListener("error",k),q.removeEventListener("message",M),H(c.reason),q.terminate()}};if(q.addEventListener("error",k),q.addEventListener("message",M),q.postMessage({id:"init",url:C.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Y)){const C=Y.slice();q.postMessage({id:"validate",data:C,rootUrl:c,fileName:h},[C.buffer])}else q.postMessage({id:"validate",data:Y,rootUrl:c,fileName:h})})):(this._LoadScriptPromise||(this._LoadScriptPromise=C.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(Y,c,h,Q))))}}Q.Configuration={url:`${C.Tools._DefaultCdnUrl}/gltf_validator.js`}},15143:(Y,c,h)=>{"use strict";h.d(c,{c:()=>Z});var C=h(12853),E=h(12859),N=h(12906),Q=h(12869),b=h(13265),H=h(13189),w=h(12951),W=h(13110),q=h(12825),k=h(12779);h(14147),h(14051),h(14069),h(14059),h(14075),h(14077),h(14082);const M="imageProcessingCompatibility",p="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";k.b.IncludesShadersStore[M]||(k.b.IncludesShadersStore[M]=p);const P="skyPixelShader",y="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";k.b.ShadersStore[P]||(k.b.ShadersStore[P]=y);h(14158),h(14086),h(14089),h(14103),h(14095);const d="skyVertexShader",D="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";k.b.ShadersStore[d]||(k.b.ShadersStore[d]=D);var T=h(13182),e=h(13245),r=h(13240);class X extends b.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Z extends H.d{constructor(Y,c){super(Y,c),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Q.bh(0,100,0),this.useSunPosition=!1,this.cameraOffset=Q.bh.Zero(),this.up=Q.bh.Up(),this.dithering=!1,this._cameraPosition=Q.bh.Zero(),this._skyOrientation=new Q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Y,c){const h=c._drawWrapper;if(this.isFrozen&&h.effect&&h._wasPreviouslyReady)return!0;c.materialDefines||(c.materialDefines=new X);const C=c.materialDefines,E=this.ZY();if(this._isReadyForSubMesh(c))return!0;if((0,r.$)(Y,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,C),(0,r.Q)(Y,C,!0,!1),C.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&C.markAsMiscDirty(),C.DITHER!==this.dithering&&C.markAsMiscDirty(),C.isDirty){C.markAsProcessed(),E.resetCachedMaterial();const Y=new T.c;C.FOG&&Y.addFallback(1,"FOG"),C.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,C.DITHER=this.dithering;const h=[w.f.PositionKind];C.VERTEXCOLOR&&h.push(w.f.ColorKind);const N="sky",Q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,e.b)(Q);const b=C.toString();c.setEffect(E.getEngine().createEffect(N,h,Q,[],b,Y,this.onCompiled,this.onError),C,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(C._renderId=E.getRenderId(),h._wasPreviouslyReady=!0,!0)}bindForSubMesh(Y,c,h){const C=this.ZY(),E=h.materialDefines;if(!E)return;const N=h.effect;if(!N)return;this._activeEffect=N,this.bindOnlyWorldMatrix(Y),this._activeEffect.setMatrix("viewProjection",C.getTransformMatrix()),this._mustRebind(C,N,h)&&((0,e.c)(N,this,C),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,r.n)(E,N,C)),C.fogEnabled&&c.applyFog&&C.fogMode!==W.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",C.getViewMatrix()),(0,r.f)(C,c,this._activeEffect);const b=C.activeCamera;if(b){const Y=b.getWorldMatrix();this._cameraPosition.x=Y.m[12],this._cameraPosition.y=Y.m[13],this._cameraPosition.z=Y.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Y=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c)*Math.cos(Y),this.sunPosition.y=this.distance*Math.sin(-Y),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(Y),Q.Quaternion.FromUnitVectorsToRef(Q.bh.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(c,this._activeEffect,h)}getAnimatables(){return[]}dispose(Y){super.dispose(Y)}clone(Y){return N.d.Clone((()=>new Z(Y,this.ZY())),this)}serialize(){const Y=super.serialize();return Y.customType="BABYLON.SkyMaterial",Y}getClassName(){return"SkyMaterial"}static Parse(Y,c,h){return N.d.Parse((()=>new Z(Y.name,c)),Y,c,h)}}(0,C.b)([(0,E.N)()],Z.prototype,"luminance",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"turbidity",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"rayleigh",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"mieCoefficient",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"mieDirectionalG",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"distance",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"inclination",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"azimuth",void 0),(0,C.b)([(0,E.M)()],Z.prototype,"sunPosition",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"useSunPosition",void 0),(0,C.b)([(0,E.M)()],Z.prototype,"cameraOffset",void 0),(0,C.b)([(0,E.M)()],Z.prototype,"up",void 0),(0,C.b)([(0,E.N)()],Z.prototype,"dithering",void 0),(0,q.e)("BABYLON.SkyMaterial",Z)},13585:(Y,c,h)=>{"use strict";function C(Y,c){c.headers=Y.headers||{},c.statusMessage=Y.statusText,c.statusCode=Y.status,c.data=Y.response}function E(Y,c,h){return new Promise((function(E,N){h=h||{};var Q,b,H,w=new XMLHttpRequest,W=h.body,q=h.headers||{};for(Q in h.timeout&&(w.timeout=h.timeout),w.ontimeout=w.onerror=function(Y){Y.timeout="timeout"==Y.type,N(Y)},w.open(Y,c.href||c),w.onload=function(){for(H=w.getAllResponseHeaders().trim().split(/[\r\n]+/),C(w,w);b=H.shift();)b=b.split(": "),w.headers[b.shift().toLowerCase()]=b.join(": ");if((b=w.headers["content-type"])&&~b.indexOf("application/json"))try{w.data=JSON.parse(w.data,h.reviver)}catch(Y){return C(w,Y),N(Y)}(w.status>=400?N:E)(w)},typeof FormData<"u"&&W instanceof FormData||W&&"object"==typeof W&&(q["content-type"]="application/json",W=JSON.stringify(W)),w.withCredentials=!!h.withCredentials,q)w.setRequestHeader(Q,q[Q]);w.send(W)}))}h.r(c),h.d(c,{del:()=>H,get:()=>N,patch:()=>b,post:()=>Q,put:()=>w,send:()=>E});var N=E.bind(E,"GET"),Q=E.bind(E,"POST"),b=E.bind(E,"PATCH"),H=E.bind(E,"DELETE"),w=E.bind(E,"PUT")},15255:(Y,c,h)=>{"use strict";h.d(c,{c:()=>q});const C=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,N=1/3,Q=1/6,b=(Math.sqrt(5)-1)/4,H=(5-Math.sqrt(5))/20,w=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),W=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const q=class{constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const c="function"==typeof Y?Y:function(Y){let c=0,h=0,C=0,E=1;const N=function(){let Y=4022871197;return function(c){c=c.toString();for(let h=0;h<c.length;h++){Y+=c.charCodeAt(h);let C=.02519603282416938*Y;Y=C>>>0,C-=Y,C*=Y,Y=C>>>0,C-=Y,Y+=4294967296*C}return 2.3283064365386963e-10*(Y>>>0)}}();c=N(" "),h=N(" "),C=N(" "),c-=N(Y),c<0&&(c+=1);h-=N(Y),h<0&&(h+=1);C-=N(Y),C<0&&(C+=1);return function(){const Y=2091639*c+2.3283064365386963e-10*E;return c=h,h=C,C=Y-(E=0|Y)}}(Y);this.p=function(Y){const c=new Uint8Array(256);for(let h=0;h<256;h++)c[h]=h;for(let h=0;h<255;h++){const C=h+~~(Y()*(256-h)),E=c[h];c[h]=c[C],c[C]=E}return c}(c),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let h=0;h<512;h++)this.perm[h]=this.p[255&h],this.permMod12[h]=this.perm[h]%12}noise2D(Y,c){const h=this.permMod12,N=this.perm;let Q=0,b=0,H=0;const W=(Y+c)*C,q=Math.floor(Y+W),k=Math.floor(c+W),M=(q+k)*E,p=Y-(q-M),P=c-(k-M);let y,d;p>P?(y=1,d=0):(y=0,d=1);const D=p-y+E,T=P-d+E,e=p-1+2*E,r=P-1+2*E,X=255&q,Z=255&k;let a=.5-p*p-P*P;if(a>=0){const Y=3*h[X+N[Z]];a*=a,Q=a*a*(w[Y]*p+w[Y+1]*P)}let G=.5-D*D-T*T;if(G>=0){const Y=3*h[X+y+N[Z+d]];G*=G,b=G*G*(w[Y]*D+w[Y+1]*T)}let K=.5-e*e-r*r;if(K>=0){const Y=3*h[X+1+N[Z+1]];K*=K,H=K*K*(w[Y]*e+w[Y+1]*r)}return 70*(Q+b+H)}noise3D(Y,c,h){const C=this.permMod12,E=this.perm;let b,H,W,q;const k=(Y+c+h)*N,M=Math.floor(Y+k),p=Math.floor(c+k),P=Math.floor(h+k),y=(M+p+P)*Q,d=Y-(M-y),D=c-(p-y),T=h-(P-y);let e,r,X,Z,a,G;d>=D?D>=T?(e=1,r=0,X=0,Z=1,a=1,G=0):d>=T?(e=1,r=0,X=0,Z=1,a=0,G=1):(e=0,r=0,X=1,Z=1,a=0,G=1):D<T?(e=0,r=0,X=1,Z=0,a=1,G=1):d<T?(e=0,r=1,X=0,Z=0,a=1,G=1):(e=0,r=1,X=0,Z=1,a=1,G=0);const K=d-e+Q,I=D-r+Q,s=T-X+Q,x=d-Z+2*Q,A=D-a+2*Q,V=T-G+2*Q,U=d-1+.5,l=D-1+.5,n=T-1+.5,v=255&M,g=255&p,z=255&P;let O=.6-d*d-D*D-T*T;if(O<0)b=0;else{const Y=3*C[v+E[g+E[z]]];O*=O,b=O*O*(w[Y]*d+w[Y+1]*D+w[Y+2]*T)}let o=.6-K*K-I*I-s*s;if(o<0)H=0;else{const Y=3*C[v+e+E[g+r+E[z+X]]];o*=o,H=o*o*(w[Y]*K+w[Y+1]*I+w[Y+2]*s)}let f=.6-x*x-A*A-V*V;if(f<0)W=0;else{const Y=3*C[v+Z+E[g+a+E[z+G]]];f*=f,W=f*f*(w[Y]*x+w[Y+1]*A+w[Y+2]*V)}let L=.6-U*U-l*l-n*n;if(L<0)q=0;else{const Y=3*C[v+1+E[g+1+E[z+1]]];L*=L,q=L*L*(w[Y]*U+w[Y+1]*l+w[Y+2]*n)}return 32*(b+H+W+q)}noise4D(Y,c,h,C){const E=this.perm;let N,Q,w,q,k;const M=(Y+c+h+C)*b,p=Math.floor(Y+M),P=Math.floor(c+M),y=Math.floor(h+M),d=Math.floor(C+M),D=(p+P+y+d)*H,T=Y-(p-D),e=c-(P-D),r=h-(y-D),X=C-(d-D);let Z=0,a=0,G=0,K=0;T>e?Z++:a++,T>r?Z++:G++,T>X?Z++:K++,e>r?a++:G++,e>X?a++:K++,r>X?G++:K++;const I=Z>=3?1:0,s=a>=3?1:0,x=G>=3?1:0,A=K>=3?1:0,V=Z>=2?1:0,U=a>=2?1:0,l=G>=2?1:0,n=K>=2?1:0,v=Z>=1?1:0,g=a>=1?1:0,z=G>=1?1:0,O=K>=1?1:0,o=T-I+H,f=e-s+H,L=r-x+H,u=X-A+H,i=T-V+2*H,R=e-U+2*H,B=r-l+2*H,t=X-n+2*H,F=T-v+3*H,J=e-g+3*H,j=r-z+3*H,S=X-O+3*H,mY=T-1+4*H,YY=e-1+4*H,cY=r-1+4*H,hY=X-1+4*H,CY=255&p,EY=255&P,NY=255&y,QY=255&d;let bY=.6-T*T-e*e-r*r-X*X;if(bY<0)N=0;else{const Y=E[CY+E[EY+E[NY+E[QY]]]]%32*4;bY*=bY,N=bY*bY*(W[Y]*T+W[Y+1]*e+W[Y+2]*r+W[Y+3]*X)}let HY=.6-o*o-f*f-L*L-u*u;if(HY<0)Q=0;else{const Y=E[CY+I+E[EY+s+E[NY+x+E[QY+A]]]]%32*4;HY*=HY,Q=HY*HY*(W[Y]*o+W[Y+1]*f+W[Y+2]*L+W[Y+3]*u)}let wY=.6-i*i-R*R-B*B-t*t;if(wY<0)w=0;else{const Y=E[CY+V+E[EY+U+E[NY+l+E[QY+n]]]]%32*4;wY*=wY,w=wY*wY*(W[Y]*i+W[Y+1]*R+W[Y+2]*B+W[Y+3]*t)}let WY=.6-F*F-J*J-j*j-S*S;if(WY<0)q=0;else{const Y=E[CY+v+E[EY+g+E[NY+z+E[QY+O]]]]%32*4;WY*=WY,q=WY*WY*(W[Y]*F+W[Y+1]*J+W[Y+2]*j+W[Y+3]*S)}let qY=.6-mY*mY-YY*YY-cY*cY-hY*hY;if(qY<0)k=0;else{const Y=E[CY+1+E[EY+1+E[NY+1+E[QY+1]]]]%32*4;qY*=qY,k=qY*qY*(W[Y]*mY+W[Y+1]*YY+W[Y+2]*cY+W[Y+3]*hY)}return 27*(N+Q+w+q+k)}}}}]);