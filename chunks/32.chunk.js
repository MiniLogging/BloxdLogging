/*! For license information please see caswr.32.b4a44068.chunk.js.LICENSE.txt */
(self.r00gjvkwa6=self.r00gjvkwa6||[]).push([[32],{13295:(H,O,S)=>{"use strict";var t=S(13298),q=S(13305),p=S(13311);S.g.__TYPEDARRAY_POOL||(S.g.__TYPEDARRAY_POOL={UINT8:q([32,0]),UINT16:q([32,0]),UINT32:q([32,0]),INT8:q([32,0]),INT16:q([32,0]),INT32:q([32,0]),FLOAT:q([32,0]),DOUBLE:q([32,0]),DATA:q([32,0]),UINT8C:q([32,0]),BUFFER:q([32,0])});var G="undefined"!==typeof Uint8ClampedArray,U=S.g.__TYPEDARRAY_POOL;U.UINT8C||(U.UINT8C=q([32,0])),U.BUFFER||(U.BUFFER=q([32,0]));var V=U.DATA,w=U.BUFFER;function o(H){if(H){var O=H.length||H.byteLength,S=t.log2(O);V[S].push(H)}}function h(H){H=t.nextPow2(H);var O=t.log2(H),S=V[O];return S.length>0?S.pop():new ArrayBuffer(H)}function a(H){return new Uint8Array(h(H),0,H)}function j(H){return new Uint16Array(h(2*H),0,H)}function e(H){return new Uint32Array(h(4*H),0,H)}function X(H){return new Int8Array(h(H),0,H)}function E(H){return new Int16Array(h(2*H),0,H)}function y(H){return new Int32Array(h(4*H),0,H)}function T(H){return new Float32Array(h(4*H),0,H)}function K(H){return new Float64Array(h(8*H),0,H)}function b(H){return G?new Uint8ClampedArray(h(H),0,H):a(H)}function D(H){return new DataView(h(H),0,H)}O.free=function(H){if(p(H))w[t.log2(H.length)].push(H);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(H)&&(H=H.buffer),!H)return;var O=H.length||H.byteLength,S=0|t.log2(O);V[S].push(H)}},O.freeUint8=O.freeUint16=O.freeUint32=O.freeInt8=O.freeInt16=O.freeInt32=O.freeFloat32=O.freeFloat=O.freeFloat64=O.freeDouble=O.freeUint8Clamped=O.freeDataView=function(H){o(H.buffer)},O.freeArrayBuffer=o,O.freeBuffer=function(H){w[t.log2(H.length)].push(H)},O.malloc=function(H,O){if(void 0===O||"arraybuffer"===O)return h(H);switch(O){case"uint8":return a(H);case"uint16":return j(H);case"uint32":return e(H);case"int8":return X(H);case"int16":return E(H);case"int32":return y(H);case"float":case"float32":return T(H);case"double":case"float64":return K(H);case"uint8_clamped":return b(H);case"buffer":throw"Buffer not supported";case"data":case"dataview":return D(H);default:return null}return null},O.mallocArrayBuffer=h,O.mallocUint8=a,O.mallocUint16=j,O.mallocUint32=e,O.mallocInt8=X,O.mallocInt16=E,O.mallocInt32=y,O.mallocFloat32=O.mallocFloat=T,O.mallocFloat64=O.mallocDouble=K,O.mallocUint8Clamped=b,O.mallocDataView=D,O.clearCache=function(){for(var H=0;H<32;++H)U.UINT8[H].length=0,U.UINT16[H].length=0,U.UINT32[H].length=0,U.INT8[H].length=0,U.INT16[H].length=0,U.INT32[H].length=0,U.FLOAT[H].length=0,U.DOUBLE[H].length=0,U.UINT8C[H].length=0,V[H].length=0,w[H].length=0}},13389:(H,O,S)=>{H.exports=q;var t=S(12120);function q(H,O){if(!(this instanceof q))return new q(H,O);var S=t.create();t.add(S,H,O),this.base=t.min(t.create(),H,S),this.Bw=t.clone(O),this.max=t.max(t.create(),H,S),this.mag=t.length(this.Bw)}var p=q.prototype;p.width=function(){return this.Bw[0]},p.height=function(){return this.Bw[1]},p.depth=function(){return this.Bw[2]},p.x0=function(){return this.base[0]},p.y0=function(){return this.base[1]},p.z0=function(){return this.base[2]},p.x1=function(){return this.max[0]},p.y1=function(){return this.max[1]},p.z1=function(){return this.max[2]},p.translate=function(H){return t.add(this.max,this.max,H),t.add(this.base,this.base,H),this},p.setPosition=function(H){return t.add(this.max,H,this.Bw),t.i(this.base,H),this},p.expand=function(H){var O=t.create(),S=t.create();return t.max(O,H.max,this.max),t.min(S,H.base,this.base),t.XO(O,O,S),new q(S,O)},p.intersects=function(H){return!(H.base[0]>this.max[0])&&(!(H.base[1]>this.max[1])&&(!(H.base[2]>this.max[2])&&(!(H.max[0]<this.base[0])&&(!(H.max[1]<this.base[1])&&!(H.max[2]<this.base[2])))))},p.touches=function(H){var O=this.union(H);return null!==O&&(0==O.width()||0==O.height()||0==O.depth())},p.union=function(H){if(!this.intersects(H))return null;var O=Math.max(H.base[0],this.base[0]),S=Math.max(H.base[1],this.base[1]),t=Math.max(H.base[2],this.base[2]);return new q([O,S,t],[Math.min(H.max[0],this.max[0])-O,Math.min(H.max[1],this.max[1])-S,Math.min(H.max[2],this.max[2])-t])}},13298:(H,O)=>{"use strict";function S(H){var O=32;return(H&=-H)&&O--,65535&H&&(O-=16),16711935&H&&(O-=8),252645135&H&&(O-=4),858993459&H&&(O-=2),1431655765&H&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(H){return(H>0)-(H<0)},O.abs=function(H){var O=H>>31;return(H^O)-O},O.min=function(H,O){return O^(H^O)&-(H<O)},O.max=function(H,O){return H^(H^O)&-(H<O)},O.isPow2=function(H){return!(H&H-1)&&!!H},O.log2=function(H){var O,S;return O=(H>65535)<<4,O|=S=((H>>>=O)>255)<<3,O|=S=((H>>>=S)>15)<<2,(O|=S=((H>>>=S)>3)<<1)|(H>>>=S)>>1},O.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},O.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},O.countTrailingZeros=S,O.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},O.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},O.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var t=new Array(256);!function(H){for(var O=0;O<256;++O){var S=O,t=O,q=7;for(S>>>=1;S;S>>>=1)t<<=1,t|=1&S,--q;H[O]=t<<q&255}}(t),O.reverse=function(H){return t[255&H]<<24|t[H>>>8&255]<<16|t[H>>>16&255]<<8|t[H>>>24&255]},O.interleave2=function(H,O){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(H,O){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>O&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},O.interleave3=function(H,O,S){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<2},O.deinterleave3=function(H,O){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>O&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},O.nextCombination=function(H){var O=H|H-1;return O+1|(~O&-~O)-1>>>S(H)+1}},13287:(H,O,S)=>{"use strict";H.exports=function(H,O,S){switch(arguments.length){case 1:return t=[],w(q=H,q,o,!0),t;case 2:return"function"===typeof O?w(H,H,O,!0):function(H,O){return t=[],w(H,O,o,!1),t}(H,O);case 3:return w(H,O,S,!1);default:throw new Error("box-intersect: Invalid arguments")}var q};var t,q=S(13295),p=S(13314),G=S(13327);function U(H,O){for(var S=0;S<H;++S)if(!(O[S]<=O[S+H]))return!0;return!1}function V(H,O,S,t){for(var q=0,p=0,G=0,V=H.length;G<V;++G){var w=H[G];if(!U(O,w)){for(var o=0;o<2*O;++o)S[q++]=w[o];t[p++]=G}}return p}function w(H,O,S,t){var U=H.length,w=O.length;if(!(U<=0||w<=0)){var o=H[0].length>>>1;if(!(o<=0)){var h,a=q.mallocDouble(2*o*U),j=q.mallocInt32(U);if((U=V(H,o,a,j))>0){if(1===o&&t)p.init(U),h=p.sweepComplete(o,S,0,U,a,j,0,U,a,j);else{var e=q.mallocDouble(2*o*w),X=q.mallocInt32(w);(w=V(O,o,e,X))>0&&(p.init(U+w),h=1===o?p.sweepBipartite(o,S,0,U,a,j,0,w,e,X):G(o,S,t,U,a,j,w,e,X),q.free(e),q.free(X))}q.free(a),q.free(j)}return h}}}function o(H,O){t.push([H,O])}},13334:(H,O)=>{"use strict";var S="d",t="ax",q="fp",p="es",G="rs",U="re",V="rb",w="bs",o="be",h="bb",a=[S,t,"vv",G,U,V,"ri",w,o,h,"bi"];function j(H){var O="bruteForce"+(H?"Full":"Partial"),t=[],G=a.slice();H||G.splice(3,0,q);var U=["function "+O+"("+G.join()+"){"];function V(O,q){var G=function(H,O,t){var q="bruteForce"+(H?"Red":"Blue")+(O?"Flip":"")+(t?"Full":""),G=["function ",q,"(",a.join(),"){","var ",p,"=2*",S,";"],U="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",V="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(t?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return H?G.push(U,"Q",":",V):G.push(V,"Q",":",U),t?G.push("if(y1<x0||x1<y0)continue;"):O?G.push("if(y0<=x0||x1<y0)continue;"):G.push("if(y0<x0||x1<y0)continue;"),G.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),O?G.push("yi,xi"):G.push("xi,yi"),G.push(");if(rv!==void 0)return rv;}}}"),{name:q,code:G.join("")}}(O,q,H);t.push(G.code),U.push("return "+G.name+"("+a.join()+");")}U.push("if(re-rs>be-bs){"),H?(V(!0,!1),U.push("}else{"),V(!1,!1)):(U.push("if(fp){"),V(!0,!0),U.push("}else{"),V(!0,!1),U.push("}}else{if(fp){"),V(!1,!0),U.push("}else{"),V(!1,!1),U.push("}")),U.push("}}return "+O);var w=t.join("")+U.join("");return new Function(w)()}O.partial=j(!1),O.full=j(!0)},13327:(H,O,S)=>{"use strict";H.exports=function(H,O,S,p,o,z,m,r,W){!function(H,O){var S=8*q.log2(O+1)*(H+1)|0,p=q.nextPow2(b*S);F.length<p&&(t.free(F),F=t.mallocInt32(p));var G=q.nextPow2(D*S);Y.length<G&&(t.free(Y),Y=t.mallocDouble(G))}(H,p+m);var g,N=0,x=2*H;l(N++,0,0,p,0,m,S?16:0,-1/0,1/0),S||l(N++,0,0,m,0,p,1,-1/0,1/0);for(;N>0;){var k=(N-=1)*b,A=F[k],u=F[k+1],J=F[k+2],P=F[k+3],f=F[k+4],c=F[k+5],R=N*D,B=Y[R],Z=Y[R+1],I=1&c,s=!!(16&c),i=o,M=z,C=r,n=W;if(I&&(i=r,M=W,C=o,n=z),!(2&c&&u>=(J=E(H,A,u,J,i,M,Z)))&&!(4&c&&(u=y(H,A,u,J,i,M,B))>=J)){var Q=J-u,L=f-P;if(s){if(H*Q*(Q+L)<j){if(void 0!==(g=V.scanComplete(H,A,O,u,J,i,M,P,f,C,n)))return g;continue}}else{if(H*Math.min(Q,L)<h){if(void 0!==(g=G(H,A,O,I,u,J,i,M,P,f,C,n)))return g;continue}if(H*Q*L<a){if(void 0!==(g=V.scanBipartite(H,A,O,I,u,J,i,M,P,f,C,n)))return g;continue}}var HH=e(H,A,u,J,i,M,B,Z);if(u<HH)if(H*(HH-u)<h){if(void 0!==(g=U(H,A+1,O,u,HH,i,M,P,f,C,n)))return g}else if(A===H-2){if(void 0!==(g=I?V.sweepBipartite(H,O,P,f,C,n,u,HH,i,M):V.sweepBipartite(H,O,u,HH,i,M,P,f,C,n)))return g}else l(N++,A+1,u,HH,P,f,I,-1/0,1/0),l(N++,A+1,P,f,u,HH,1^I,-1/0,1/0);if(HH<J){var OH=w(H,A,P,f,C,n),SH=C[x*OH+A],tH=X(H,A,OH,f,C,n,SH);if(tH<f&&l(N++,A,HH,J,tH,f,(4|I)+(s?16:0),SH,Z),P<OH&&l(N++,A,HH,J,P,OH,(2|I)+(s?16:0),B,SH),OH+1===tH){if(void 0!==(g=s?v(H,A,O,HH,J,i,M,OH,C,n[OH]):d(H,A,O,I,HH,J,i,M,OH,C,n[OH])))return g}else if(OH<tH){var qH;if(s){if(HH<(qH=T(H,A,HH,J,i,M,SH))){var pH=X(H,A,HH,qH,i,M,SH);if(A===H-2){if(HH<pH&&void 0!==(g=V.sweepComplete(H,O,HH,pH,i,M,OH,tH,C,n)))return g;if(pH<qH&&void 0!==(g=V.sweepBipartite(H,O,pH,qH,i,M,OH,tH,C,n)))return g}else HH<pH&&l(N++,A+1,HH,pH,OH,tH,16,-1/0,1/0),pH<qH&&(l(N++,A+1,pH,qH,OH,tH,0,-1/0,1/0),l(N++,A+1,OH,tH,pH,qH,1,-1/0,1/0))}}else HH<(qH=I?K(H,A,HH,J,i,M,SH):T(H,A,HH,J,i,M,SH))&&(A===H-2?g=I?V.sweepBipartite(H,O,OH,tH,C,n,HH,qH,i,M):V.sweepBipartite(H,O,HH,qH,i,M,OH,tH,C,n):(l(N++,A+1,HH,qH,OH,tH,I,-1/0,1/0),l(N++,A+1,OH,tH,HH,qH,1^I,-1/0,1/0)))}}}}};var t=S(13295),q=S(13298),p=S(13334),G=p.partial,U=p.full,V=S(13314),w=S(13339),o=S(13346),h=128,a=1<<22,j=1<<22,e=o("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),X=o("lo===p0",["p0"]),E=o("lo<p0",["p0"]),y=o("hi<=p0",["p0"]),T=o("lo<=p0&&p0<=hi",["p0"]),K=o("lo<p0&&p0<=hi",["p0"]),b=6,D=2,F=t.mallocInt32(1024),Y=t.mallocDouble(1024);function l(H,O,S,t,q,p,G,U,V){var w=b*H;F[w]=O,F[w+1]=S,F[w+2]=t,F[w+3]=q,F[w+4]=p,F[w+5]=G;var o=D*H;Y[o]=U,Y[o+1]=V}function d(H,O,S,t,q,p,G,U,V,w,o){var h=2*H,a=V*h,j=w[a+O];H:for(var e=q,X=q*h;e<p;++e,X+=h){var E=G[X+O],y=G[X+O+H];if(!(j<E||y<j)&&(!t||j!==E)){for(var T,K=U[e],b=O+1;b<H;++b){E=G[X+b],y=G[X+b+H];var D=w[a+b],F=w[a+b+H];if(y<D||F<E)continue H}if(void 0!==(T=t?S(o,K):S(K,o)))return T}}}function v(H,O,S,t,q,p,G,U,V,w){var o=2*H,h=U*o,a=V[h+O];H:for(var j=t,e=t*o;j<q;++j,e+=o){var X=G[j];if(X!==w){var E=p[e+O],y=p[e+O+H];if(!(a<E||y<a)){for(var T=O+1;T<H;++T){E=p[e+T],y=p[e+T+H];var K=V[h+T],b=V[h+T+H];if(y<K||b<E)continue H}var D=S(X,w);if(void 0!==D)return D}}}}},13339:(H,O,S)=>{"use strict";H.exports=function(H,O,S,G,U,V){if(G<=S+1)return S;var w=S,o=G,h=G+S>>>1,a=2*H,j=h,e=U[a*h+O];for(;w<o;){if(o-w<q){p(H,O,w,o,U,V),e=U[a*h+O];break}var X=o-w,E=Math.random()*X+w|0,y=U[a*E+O],T=Math.random()*X+w|0,K=U[a*T+O],b=Math.random()*X+w|0,D=U[a*b+O];y<=K?D>=K?(j=T,e=K):y>=D?(j=E,e=y):(j=b,e=D):K>=D?(j=T,e=K):D>=y?(j=E,e=y):(j=b,e=D);for(var F=a*(o-1),Y=a*j,l=0;l<a;++l,++F,++Y){var d=U[F];U[F]=U[Y],U[Y]=d}var v=V[o-1];V[o-1]=V[j],V[j]=v;for(F=a*(o-1),Y=a*(j=t(H,O,w,o-1,U,V,e)),l=0;l<a;++l,++F,++Y){d=U[F];U[F]=U[Y],U[Y]=d}v=V[o-1];if(V[o-1]=V[j],V[j]=v,h<j){for(o=j-1;w<o&&U[a*(o-1)+O]===e;)o-=1;o+=1}else{if(!(j<h))break;for(w=j+1;w<o&&U[a*w+O]===e;)w+=1}}return t(H,O,S,h,U,V,U[a*h+O])};var t=S(13346)("lo<p0",["p0"]),q=8;function p(H,O,S,t,q,p){for(var G=2*H,U=G*(S+1)+O,V=S+1;V<t;++V,U+=G)for(var w=q[U],o=V,h=G*(V-1);o>S&&q[h+O]>w;--o,h-=G){for(var a=h,j=h+G,e=0;e<G;++e,++a,++j){var X=q[a];q[a]=q[j],q[j]=X}var E=p[o];p[o]=p[o-1],p[o-1]=E}}},13346:H=>{"use strict";H.exports=function(H,S){var t="abcdef".split("").concat(S),q=[];H.indexOf("lo")>=0&&q.push("lo=e[k+n]");H.indexOf("hi")>=0&&q.push("hi=e[k+o]");return t.push(O.replace("_",q.join()).replace("$",H)),Function.apply(void 0,t)};var O="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13322:H=>{"use strict";H.exports=function(H,t){t<=4*O?S(0,t-1,H):w(0,t-1,H)};var O=32;function S(H,O,S){for(var t=2*(H+1),q=H+1;q<=O;++q){for(var p=S[t++],G=S[t++],U=q,V=t-2;U-- >H;){var w=S[V-2],o=S[V-1];if(w<p)break;if(w===p&&o<G)break;S[V]=w,S[V+1]=o,V-=2}S[V]=p,S[V+1]=G}}function t(H,O,S){O*=2;var t=S[H*=2],q=S[H+1];S[H]=S[O],S[H+1]=S[O+1],S[O]=t,S[O+1]=q}function q(H,O,S){O*=2,S[H*=2]=S[O],S[H+1]=S[O+1]}function p(H,O,S,t){O*=2,S*=2;var q=t[H*=2],p=t[H+1];t[H]=t[O],t[H+1]=t[O+1],t[O]=t[S],t[O+1]=t[S+1],t[S]=q,t[S+1]=p}function G(H,O,S,t,q){O*=2,q[H*=2]=q[O],q[O]=S,q[H+1]=q[O+1],q[O+1]=t}function U(H,O,S){O*=2;var t=S[H*=2],q=S[O];return!(t<q)&&(t!==q||S[H+1]>S[O+1])}function V(H,O,S,t){var q=t[H*=2];return q<O||q===O&&t[H+1]<S}function w(H,o,h){var a=(o-H+1)/6|0,j=H+a,e=o-a,X=H+o>>1,E=X-a,y=X+a,T=j,K=E,b=X,D=y,F=e,Y=H+1,l=o-1,d=0;U(T,K,h)&&(d=T,T=K,K=d),U(D,F,h)&&(d=D,D=F,F=d),U(T,b,h)&&(d=T,T=b,b=d),U(K,b,h)&&(d=K,K=b,b=d),U(T,D,h)&&(d=T,T=D,D=d),U(b,D,h)&&(d=b,b=D,D=d),U(K,F,h)&&(d=K,K=F,F=d),U(K,b,h)&&(d=K,K=b,b=d),U(D,F,h)&&(d=D,D=F,F=d);for(var v=h[2*K],z=h[2*K+1],m=h[2*D],r=h[2*D+1],W=2*T,g=2*b,N=2*F,x=2*j,k=2*X,A=2*e,u=0;u<2;++u){var J=h[W+u],P=h[g+u],f=h[N+u];h[x+u]=J,h[k+u]=P,h[A+u]=f}q(E,H,h),q(y,o,h);for(var c=Y;c<=l;++c)if(V(c,v,z,h))c!==Y&&t(c,Y,h),++Y;else if(!V(c,m,r,h))for(;;){if(V(l,m,r,h)){V(l,v,z,h)?(p(c,Y,l,h),++Y,--l):(t(c,l,h),--l);break}if(--l<c)break}G(H,Y-1,v,z,h),G(o,l+1,m,r,h),Y-2-H<=O?S(H,Y-2,h):w(H,Y-2,h),o-(l+2)<=O?S(l+2,o,h):w(l+2,o,h),l-Y<=O?S(Y,l,h):w(Y,l,h)}},13314:(H,O,S)=>{"use strict";H.exports={init:function(H){var O=q.nextPow2(H);V.length<O&&(t.free(V),V=t.mallocInt32(O));w.length<O&&(t.free(w),w=t.mallocInt32(O));o.length<O&&(t.free(o),o=t.mallocInt32(O));h.length<O&&(t.free(h),h=t.mallocInt32(O));a.length<O&&(t.free(a),a=t.mallocInt32(O));j.length<O&&(t.free(j),j=t.mallocInt32(O));var S=8*O;e.length<S&&(t.free(e),e=t.mallocDouble(S))},sweepBipartite:function(H,O,S,t,q,U,a,j,y,T){for(var K=0,b=2*H,D=H-1,F=b-1,Y=S;Y<t;++Y){var l=U[Y],d=b*Y;e[K++]=q[d+D],e[K++]=-(l+1),e[K++]=q[d+F],e[K++]=l}for(Y=a;Y<j;++Y){l=T[Y]+G;var v=b*Y;e[K++]=y[v+D],e[K++]=-l,e[K++]=y[v+F],e[K++]=l}var z=K>>>1;p(e,z);var m=0,r=0;for(Y=0;Y<z;++Y){var W=0|e[2*Y+1];if(W>=G)X(o,h,r--,W=W-G|0);else if(W>=0)X(V,w,m--,W);else if(W<=-G){W=-W-G|0;for(var g=0;g<m;++g){if(void 0!==(N=O(V[g],W)))return N}E(o,h,r++,W)}else{W=-W-1|0;for(g=0;g<r;++g){var N;if(void 0!==(N=O(W,o[g])))return N}E(V,w,m++,W)}}},sweepComplete:function(H,O,S,t,q,G,U,y,T,K){for(var b=0,D=2*H,F=H-1,Y=D-1,l=S;l<t;++l){var d=G[l]+1<<1,v=D*l;e[b++]=q[v+F],e[b++]=-d,e[b++]=q[v+Y],e[b++]=d}for(l=U;l<y;++l){d=K[l]+1<<1;var z=D*l;e[b++]=T[z+F],e[b++]=1|-d,e[b++]=T[z+Y],e[b++]=1|d}var m=b>>>1;p(e,m);var r=0,W=0,g=0;for(l=0;l<m;++l){var N=0|e[2*l+1],x=1&N;if(l<m-1&&N>>1===e[2*l+3]>>1&&(x=2,l+=1),N<0){for(var k=-(N>>1)-1,A=0;A<g;++A){if(void 0!==(u=O(a[A],k)))return u}if(0!==x)for(A=0;A<r;++A){if(void 0!==(u=O(V[A],k)))return u}if(1!==x)for(A=0;A<W;++A){var u;if(void 0!==(u=O(o[A],k)))return u}0===x?E(V,w,r++,k):1===x?E(o,h,W++,k):2===x&&E(a,j,g++,k)}else{k=(N>>1)-1;0===x?X(V,w,r--,k):1===x?X(o,h,W--,k):2===x&&X(a,j,g--,k)}}},scanBipartite:function(H,O,S,t,q,U,o,h,a,j,y,T){var K=0,b=2*H,D=O,F=O+H,Y=1,l=1;t?l=G:Y=G;for(var d=q;d<U;++d){var v=d+Y,z=b*d;e[K++]=o[z+D],e[K++]=-v,e[K++]=o[z+F],e[K++]=v}for(d=a;d<j;++d){v=d+l;var m=b*d;e[K++]=y[m+D],e[K++]=-v}var r=K>>>1;p(e,r);var W=0;for(d=0;d<r;++d){var g=0|e[2*d+1];if(g<0){var N=!1;if((v=-g)>=G?(N=!t,v-=G):(N=!!t,v-=1),N)E(V,w,W++,v);else{var x=T[v],k=b*v,A=y[k+O+1],u=y[k+O+1+H];H:for(var J=0;J<W;++J){var P=V[J],f=b*P;if(!(u<o[f+O+1]||o[f+O+1+H]<A)){for(var c=O+2;c<H;++c)if(y[k+c+H]<o[f+c]||o[f+c+H]<y[k+c])continue H;var R,B=h[P];if(void 0!==(R=t?S(x,B):S(B,x)))return R}}}}else X(V,w,W--,g-Y)}},scanComplete:function(H,O,S,t,q,U,w,o,h,a,j){for(var X=0,E=2*H,y=O,T=O+H,K=t;K<q;++K){var b=K+G,D=E*K;e[X++]=U[D+y],e[X++]=-b,e[X++]=U[D+T],e[X++]=b}for(K=o;K<h;++K){b=K+1;var F=E*K;e[X++]=a[F+y],e[X++]=-b}var Y=X>>>1;p(e,Y);var l=0;for(K=0;K<Y;++K){var d=0|e[2*K+1];if(d<0){if((b=-d)>=G)V[l++]=b-G;else{var v=j[b-=1],z=E*b,m=a[z+O+1],r=a[z+O+1+H];H:for(var W=0;W<l;++W){var g=V[W],N=w[g];if(N===v)break;var x=E*g;if(!(r<U[x+O+1]||U[x+O+1+H]<m)){for(var k=O+2;k<H;++k)if(a[z+k+H]<U[x+k]||U[x+k+H]<a[z+k])continue H;var A=S(N,v);if(void 0!==A)return A}}}}else{for(b=d-G,W=l-1;W>=0;--W)if(V[W]===b){for(k=W+1;k<l;++k)V[k-1]=V[k];break}--l}}}};var t=S(13295),q=S(13298),p=S(13322),G=1<<28,U=1024,V=t.mallocInt32(U),w=t.mallocInt32(U),o=t.mallocInt32(U),h=t.mallocInt32(U),a=t.mallocInt32(U),j=t.mallocInt32(U),e=t.mallocDouble(8192);function X(H,O,S,t){var q=O[t],p=H[S-1];H[q]=p,O[p]=q}function E(H,O,S,t){H[S]=t,O[t]=S}},13305:H=>{"use strict";function O(H,S,t){var q=0|H[t];if(q<=0)return[];var p,G=new Array(q);if(t===H.length-1)for(p=0;p<q;++p)G[p]=S;else for(p=0;p<q;++p)G[p]=O(H,S,t+1);return G}H.exports=function(H,S){switch("undefined"===typeof S&&(S=0),typeof H){case"number":if(H>0)return function(H,O){var S,t;for(S=new Array(H),t=0;t<H;++t)S[t]=O;return S}(0|H,S);break;case"object":if("number"===typeof H.length)return O(H,S,0)}return[]}},13261:(H,O,S)=>{H.exports=function(){var H=this;this.components={},this.comps=this.components;var O=this.components,S=1,q={},p=[],G=[],U={timeout:!1,removals:[],multiComps:[]};function V(H,S){var t=O[S],p=q[S],G=p.hash[H];G&&(p.remove(H),t.lt&&(t.multi?(G.forEach((O=>{O&&t.lt(H,O)})),G.length=0):t.lt(H,G)),U.removals.push(p),w())}function w(){U.timeout||(U.timeout=!0,setTimeout(o,1))}function o(){U.timeout=!1,h()}function h(){U.multiComps.length&&function(H){for(var O=0;O<H.length;O++){var{entID:S,data:t}=H[O],q=t.hash[S];if(q){for(var p=0;p<q.length;p++)q[p]||(q.splice(p,1),p--);0===q.length&&(t.remove(S),U.removals.push(t))}}H.length=0}(U.multiComps),U.removals.length&&function(H){for(var O=0;O<H.length;O++){H[O].flush()}H.length=0}(U.removals)}this.jh=q,this._systems=p,this._renderSystems=G,this.sw=function(O){var t=S++;return Array.isArray(O)&&O.forEach((O=>H.mV(t,O))),t},this.deleteEntity=function(O){return Object.keys(q).forEach((H=>{q[H].hash[O]&&V(O,H)})),H},this.wo=function(H){if(!H)throw new Error("Missing component definition");var S=H.name;if(!S)throw new Error("Component definition must have a name property.");if("string"!==typeof S)throw new Error("Component name must be a string.");if(""===S)throw new Error("Component name must be a non-empty string.");if(q[S])throw new Error(`Component ${S} already exists.`);var U={};return U.name=S,U.multi=!!H.multi,U.order=isNaN(H.order)?99:H.order,U.stateConstructor=H.stateConstructor||null,U.state=H.state||{},U.vU=H.vU||null,U.lt=H.lt||null,U.system=H.system||null,U.NU=H.NU||null,O[S]=U,q[S]=new t,q[S]._pendingMultiCleanup=!1,q[S]._multiCleanupIDs=U.multi?[]:null,U.system&&(p.push(S),p.sort(((H,S)=>O[H].order-O[S].order))),U.NU&&(G.push(S),G.sort(((H,S)=>O[H].order-O[S].order))),S},this.overwriteComponent=function(H,S){var t=O[H];if(!t)throw new Error(`Unknown component: ${H}`);if(!S)throw new Error("Missing component definition");if(t.name!==S.name)throw new Error("Overwriting component must use the same name property.");var U={};U.name=H,U.multi=!!S.multi,U.order=isNaN(S.order)?99:S.order,U.state=S.state||{},U.vU=S.vU||null,U.lt=S.lt||null,U.system=S.system||null,U.NU=S.NU||null,O[H]=U,q[H]._pendingMultiCleanup=!1,q[H]._multiCleanupIDs=U.multi?[]:null;var V=p.indexOf(H);U.system&&V<0&&p.push(H),!U.system&&V>=0&&p.splice(V,1),p.sort(((H,S)=>O[H].order-O[S].order));var w=G.indexOf(H);U.NU&&w<0&&G.push(H),!U.NU&&w>=0&&G.splice(w,1),G.sort(((H,S)=>O[H].order-O[S].order));var o=U.state;return this.zw(H).forEach((H=>{for(var O in o)O in H||(H[O]=o[O]);U.vU&&U.vU(H.WU,H)})),H},this.deleteComponent=function(S){var t=q[S];if(!t)throw new Error(`Unknown component: ${S}`);t.flush(),t.list.forEach((H=>{H&&V(H.WU||H[0].WU,S)}));var U=p.indexOf(S),w=G.indexOf(S);return U>-1&&p.splice(U,1),w>-1&&G.splice(w,1),q[S].dispose(),delete q[S],delete O[S],H},this.mV=function(H,S,t){var p,G=O[S],U=q[S];if(!U)throw new Error(`Unknown component: ${S}.`);if(U.hash[H]&&!G.multi)throw new Error(`Entity ${H} already has component: ${S}.`);if(G.stateConstructor){if(!(p=new G.stateConstructor).hasOwnProperty("WU"))throw new Error(`Component ${G.name} stateConstructor type does not have property __id`)}else p=Object.assign({},{WU:H},G.state,t);if(p.WU=H,G.multi){var V=U.hash[H];V||(V=[],U.add(H,V)),V.push(p)}else U.add(H,p);return G.vU&&G.vU(H,p),this},this.PV=function(H,O){var S=q[O];if(!S)throw new Error(`Unknown component: ${O}.`);return!!S.hash[H]},this.NV=function(O,S){if(!q[S])throw new Error(`Unknown component: ${S}.`);return V(O,S),H},this.getState=function(H,O){var S=q[O];if(!S)throw new Error(`Unknown component: ${O}.`);return S.hash[H]},this.zw=function(H){var O=q[H];if(!O)throw new Error(`Unknown component: ${H}.`);return h(),O.list},this.yj=function(H){if(!q[H])throw new Error(`Unknown component: ${H}.`);var O=q[H].hash;return H=>O[H]},this.bj=function(H){if(!q[H])throw new Error(`Unknown component: ${H}.`);var O=q[H].hash;return H=>!!O[H]},this.LG=function(S){h();for(var t=0;t<p.length;t++){var G=p[t],U=O[G],V=q[G];U.system(S,V.list),h()}return H},this.render=function(S){h();for(var t=0;t<G.length;t++){var p=G[t],U=O[p],V=q[p];U.NU(S,V.list),h()}return H},this.removeMultiComponent=function(S,t,p){var G=O[t],V=q[t];if(!V)throw new Error(`Unknown component: ${t}.`);if(!G.multi)throw new Error("removeMultiComponent called on non-multi component");return function(H,O,S,t){var q=S.hash[H];if(q){var p=q[t];p&&(q[t]=null,O.lt&&O.lt(H,p),U.multiComps.push({entID:H,data:S}),w())}}(S,G,V,p),H}};var t=S(13267)},13267:H=>{function O(H,O){var S=H._map[O];if(delete H.hash[O],delete H._map[O],S===H.list.length-1)H.list.pop();else{var t=H.list.pop();if(H.list[S]=t,null===t||null===t[0]){var q=H.list.length;for(var p in H._map)if(H._map[p]===q)return void(H._map[p]=S)}else{var G=t.WU||t[0].WU;H._map[G]=S}}}H.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(H,O){if("number"===typeof this._map[H]){var S=this._map[H];this.hash[H]=O,this.list[S]=O}else this._map[H]=this.list.length,this.hash[H]=O,this.list.push(O)}remove(H){var O=this._map[H];this.hash[H]=null,this.list[O]=null,this._pendingRemovals.push(H)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var H=0;H<this._pendingRemovals.length;H++){var S=this._pendingRemovals[H];null===this.hash[S]&&O(this,S)}this._pendingRemovals.length=0}}},13222:H=>{"use strict";var O,S="object"===typeof Reflect?Reflect:null,t=function(H,O,S){return Function.prototype.apply.call(H,O,S)};O=S&&"function"===typeof S.ownKeys?S.ownKeys:Object.getOwnPropertySymbols?function(H){return Object.getOwnPropertyNames(H).concat(Object.getOwnPropertySymbols(H))}:function(H){return Object.getOwnPropertyNames(H)};var q=Number.isNaN||function(H){return H!==H};function p(){p.init.call(this)}H.exports=p,H.exports.once=function(H,O){return new Promise((function(S,t){function q(S){H.removeListener(O,p),t(S)}function p(){"function"===typeof H.removeListener&&H.removeListener("error",q),S([].slice.call(arguments))}X(H,O,p,{once:!0}),"error"!==O&&function(H,O,S){"function"===typeof H.on&&X(H,"error",O,S)}(H,q,{once:!0})}))},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var G=10;function U(H){if("function"!==typeof H)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof H)}function V(H){return void 0===H._maxListeners?p.defaultMaxListeners:H._maxListeners}function w(H,O,S,t){var q,p,G,w;if(U(S),void 0===(p=H._events)?(p=H._events=Object.create(null),H._eventsCount=0):(void 0!==p.newListener&&(H.emit("newListener",O,S.listener?S.listener:S),p=H._events),G=p[O]),void 0===G)G=p[O]=S,++H._eventsCount;else if("function"===typeof G?G=p[O]=t?[S,G]:[G,S]:t?G.unshift(S):G.push(S),(q=V(H))>0&&G.length>q&&!G.warned){G.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+String(O)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.tO=H,o.type=O,o.count=G.length,w=o,console&&console.warn&&console.warn(w)}return H}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(H,O,S){var t={fired:!1,wrapFn:void 0,target:H,type:O,listener:S},q=o.bind(t);return q.listener=S,t.wrapFn=q,q}function a(H,O,S){var t=H._events;if(void 0===t)return[];var q=t[O];return void 0===q?[]:"function"===typeof q?S?[q.listener||q]:[q]:S?function(H){for(var O=new Array(H.length),S=0;S<O.length;++S)O[S]=H[S].listener||H[S];return O}(q):e(q,q.length)}function j(H){var O=this._events;if(void 0!==O){var S=O[H];if("function"===typeof S)return 1;if(void 0!==S)return S.length}return 0}function e(H,O){for(var S=new Array(O),t=0;t<O;++t)S[t]=H[t];return S}function X(H,O,S,t){if("function"===typeof H.on)t.once?H.once(O,S):H.on(O,S);else{if("function"!==typeof H.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof H);H.addEventListener(O,(function q(p){t.once&&H.removeEventListener(O,q),S(p)}))}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(H){if("number"!==typeof H||H<0||q(H))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+H+".");G=H}}),p.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(H){if("number"!==typeof H||H<0||q(H))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+H+".");return this._maxListeners=H,this},p.prototype.getMaxListeners=function(){return V(this)},p.prototype.emit=function(H){for(var O=[],S=1;S<arguments.length;S++)O.push(arguments[S]);var q="error"===H,p=this._events;if(void 0!==p)q=q&&void 0===p.error;else if(!q)return!1;if(q){var G;if(O.length>0&&(G=O[0]),G instanceof Error)throw G;var U=new Error("Unhandled error."+(G?" ("+G.message+")":""));throw U.context=G,U}var V=p[H];if(void 0===V)return!1;if("function"===typeof V)t(V,this,O);else{var w=V.length,o=e(V,w);for(S=0;S<w;++S)t(o[S],this,O)}return!0},p.prototype.addListener=function(H,O){return w(this,H,O,!1)},p.prototype.on=p.prototype.addListener,p.prototype.prependListener=function(H,O){return w(this,H,O,!0)},p.prototype.once=function(H,O){return U(O),this.on(H,h(this,H,O)),this},p.prototype.prependOnceListener=function(H,O){return U(O),this.prependListener(H,h(this,H,O)),this},p.prototype.removeListener=function(H,O){var S,t,q,p,G;if(U(O),void 0===(t=this._events))return this;if(void 0===(S=t[H]))return this;if(S===O||S.listener===O)0===--this._eventsCount?this._events=Object.create(null):(delete t[H],t.removeListener&&this.emit("removeListener",H,S.listener||O));else if("function"!==typeof S){for(q=-1,p=S.length-1;p>=0;p--)if(S[p]===O||S[p].listener===O){G=S[p].listener,q=p;break}if(q<0)return this;0===q?S.shift():function(H,O){for(;O+1<H.length;O++)H[O]=H[O+1];H.pop()}(S,q),1===S.length&&(t[H]=S[0]),void 0!==t.removeListener&&this.emit("removeListener",H,G||O)}return this},p.prototype.off=p.prototype.removeListener,p.prototype.qO=function(H){var O,S,t;if(void 0===(S=this._events))return this;if(void 0===S.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==S[H]&&(0===--this._eventsCount?this._events=Object.create(null):delete S[H]),this;if(0===arguments.length){var q,p=Object.keys(S);for(t=0;t<p.length;++t)"removeListener"!==(q=p[t])&&this.qO(q);return this.qO("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(O=S[H]))this.removeListener(H,O);else if(void 0!==O)for(t=O.length-1;t>=0;t--)this.removeListener(H,O[t]);return this},p.prototype.listeners=function(H){return a(this,H,!0)},p.prototype.rawListeners=function(H){return a(this,H,!1)},p.listenerCount=function(H,O){return"function"===typeof H.listenerCount?H.listenerCount(O):j.call(H,O)},p.prototype.listenerCount=j,p.prototype.eventNames=function(){return this._eventsCount>0?O(this._events):[]}},13516:H=>{"use strict";H.exports=function(H,O,S,t,q,p){var G=+O[0],U=+O[1],V=+O[2],w=+S[0],o=+S[1],h=+S[2],a=Math.sqrt(w*w+o*o+h*h);if(0===a)throw new Error("Can't raycast along a zero vector");return function(H,O,S,t,q,p,G,U,V,w){for(var o=0,h=Math.floor,a=0|h(O),j=0|h(S),e=0|h(t),X=q>0?1:-1,E=p>0?1:-1,y=G>0?1:-1,T=Math.abs(1/q),K=Math.abs(1/p),b=Math.abs(1/G),D=T<1/0?T*(X>0?a+1-O:O-a):1/0,F=K<1/0?K*(E>0?j+1-S:S-j):1/0,Y=b<1/0?b*(y>0?e+1-t:t-e):1/0,l=-1;o<=U;){var d=H(a,j,e);if(d)return V&&(V[0]=O+o*q,V[1]=S+o*p,V[2]=t+o*G),w&&(w[0]=w[1]=w[2]=0,0===l&&(w[0]=-X),1===l&&(w[1]=-E),2===l&&(w[2]=-y)),d;D<F?D<Y?(a+=X,o=D,D+=T,l=0):(e+=y,o=Y,Y+=b,l=2):F<Y?(j+=E,o=F,F+=K,l=1):(e+=y,o=Y,Y+=b,l=2)}return V&&(V[0]=O+o*q,V[1]=S+o*p,V[2]=t+o*G),w&&(w[0]=w[1]=w[2]=0),0}(H,G,U,V,w/=a,o/=a,h/=a,t="undefined"===typeof t?64:+t,q,p)}},13554:(H,O,S)=>{"use strict";S.d(O,{e:()=>p});var t=S(13222);function q(){this.Ea=!1,this.stopPropagation=!1,this.Ta=!1,this.disabled=!1}class p{constructor(H,O){this.version="0.7.0";var S=Object.assign({},new q,O||{});this.element=H||document,this.Ea=!!S.Ea,this.stopPropagation=!!S.stopPropagation,this.Ta=!!S.Ta,this.disabled=!!S.disabled,this.filterEvents=(H,O)=>!0,this.down=new t.EventEmitter,this.up=new t.EventEmitter,this.state={},this.bw={dx:0,dy:0,Vj:0,Kw:0,wj:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?U(this):document.addEventListener("DOMContentLoaded",(H=>{U(this)}),{once:!0})}bind(H){for(var O=arguments.length,S=new Array(O>1?O-1:0),t=1;t<O;t++)S[t-1]=arguments[t];S.forEach((O=>{var S=this._keyBindmap[O]||[];S.includes(H)||(S.push(H),this._keyBindmap[O]=S)})),this.state[H]=!!this.state[H],this.pressCount[H]=this.pressCount[H]||0,this.releaseCount[H]=this.releaseCount[H]||0}unbind(H){for(var O in this._keyBindmap){var S=this._keyBindmap[O],t=S.indexOf(H);t>-1&&S.splice(t,1)}}getBindings(){var H={};for(var O in this._keyBindmap){this._keyBindmap[O].forEach((S=>{H[S]=H[S]||[],H[S].push(O)}))}return H}LG(){G(this.bw),G(this.pressCount),G(this.releaseCount)}}function G(H){for(var O in H)H[O]=0}function U(H){window.addEventListener("keydown",e.bind(null,H,!0),!1),window.addEventListener("keyup",e.bind(null,H,!1),!1);var O={passive:!0};H.element.addEventListener("touchstart",h.bind(void 0,H),{passive:!1}),H.element.addEventListener("touchend",j.bind(void 0,H),O),H.element.addEventListener("mousedown",X.bind(null,H,!0),O),window.document.addEventListener("mouseup",X.bind(null,H,!1),O),H.element.addEventListener("touchmove",E.bind(null,H),O),H.element.addEventListener("mousemove",E.bind(null,H),O),window.PointerEvent,H.element.addEventListener("wheel",y.bind(null,H),O),H.element.addEventListener("contextmenu",T.bind(null,H),!1),window.addEventListener("blur",K.bind(null,H),!1)}var V=0,w=0,o=null;function h(H,O){O.preventDefault(),a(O)}function a(H){let O=!1;for(let S=0;S<H.touches.length;++S)if(H.touches[S].identifier===o){O=!0;break}if(!O){const O=H.changedTouches[0];V=O.clientX,w=O.clientY,o=O.identifier}}function j(H,O){for(var S=O.changedTouches,t=0;t<S.length;++t)S[t].identifier===o&&(o=null)}function e(H,O,S){b(S.code,O,H,S)}function X(H,O,S){if("pointerId"in S)if(O){if(null!==H._touches.currID)return;H._touches.currID=S.pointerId}else{if(H._touches.currID!==S.pointerId)return;H._touches.currID=null}return b("Mouse"+("button"in S?S.button+1:1),O,H,S),!1}function E(H,O){var S=O.movementX||O.mozMovementX||0,t=O.movementY||O.mozMovementY||0;if(O.touches&&0===(S|t)){var q=function(H){a(H);for(let O=0;O<H.changedTouches.length;++O)if(H.changedTouches[O].identifier==o){const S=H.changedTouches[O],t=[S.clientX-V,S.clientY-w];return V=S.clientX,w=S.clientY,t}return console.error(`Did not find touch id ${o}`),[0,0]}(O);S=q[0],t=q[1]}H.bw.dx+=S,H.bw.dy+=t}function y(H,O){var S=1;switch(O.deltaMode){case 0:S=1;break;case 1:S=12;break;case 2:S=H.element.clientHeight||window.innerHeight}H.bw.Vj+=(O.deltaX||0)*S,H.bw.Kw+=(O.deltaY||0)*S,H.bw.wj+=(O.deltaZ||0)*S}function T(H,O){if(!H.Ta)return O.preventDefault(),!1}function K(H){for(var O in H._keyStates)H._keyStates[O]&&(/^Mouse\d/.test(O)||b(O,!1,H,{code:O,note:"1p1c7mi236q",preventDefault:()=>{},stopPropagation:()=>{}}))}function b(H,O,S,t){var q=S._keyBindmap[H];q&&(D(S._keyStates[H],O)&&(S._keyStates[H]=O,q.forEach((H=>{(!S.filterEvents||S.filterEvents(t,H))&&function(H,O,S,t){var q=O?S.pressCount:S.releaseCount;q[H]=(q[H]||0)+1;var p=S._bindPressCount[H]||0;(p+=O?1:-1)<0&&(p=0);S._bindPressCount[H]=p;var G=S.state[H];if(D(G,p)){S.state[H]=p>0;var U=O?S.down:S.up;S.disabled||U.emit(H,t)}}(H,O,S,t)}))),"button"in t||(S.Ea&&!t.defaultPrevented&&t.preventDefault(),S.stopPropagation&&t.stopPropagation()))}function D(H,O){return H?!O:O}},12176:H=>{H.exports=function(H,O,S){return H[0]=O[0]+S[0],H[1]=O[1]+S[1],H[2]=O[2]+S[2],H}},12135:(H,O,S)=>{H.exports=function(H,O){var S=t(H[0],H[1],H[2]),G=t(O[0],O[1],O[2]);q(S,S),q(G,G);var U=p(S,G);return U>1?0:Math.acos(U)};var t=S(12141),q=S(12143),p=S(12146)},12231:H=>{H.exports=function(H,O){return H[0]=Math.ceil(O[0]),H[1]=Math.ceil(O[1]),H[2]=Math.ceil(O[2]),H}},12133:H=>{H.exports=function(H){var O=new Float32Array(3);return O[0]=H[0],O[1]=H[1],O[2]=H[2],O}},12149:H=>{H.exports=function(H,O){return H[0]=O[0],H[1]=O[1],H[2]=O[2],H}},12131:H=>{H.exports=function(){var H=new Float32Array(3);return H[0]=0,H[1]=0,H[2]=0,H}},12310:H=>{H.exports=function(H,O,S){var t=O[0],q=O[1],p=O[2],G=S[0],U=S[1],V=S[2];return H[0]=q*V-p*U,H[1]=p*G-t*V,H[2]=t*U-q*G,H}},12260:(H,O,S)=>{H.exports=S(12256)},12256:H=>{H.exports=function(H,O){var S=O[0]-H[0],t=O[1]-H[1],q=O[2]-H[2];return Math.sqrt(S*S+t*t+q*q)}},12213:(H,O,S)=>{H.exports=S(12207)},12207:H=>{H.exports=function(H,O,S){return H[0]=O[0]/S[0],H[1]=O[1]/S[1],H[2]=O[2]/S[2],H}},12146:H=>{H.exports=function(H,O){return H[0]*O[0]+H[1]*O[1]+H[2]*O[2]}},12123:H=>{H.exports=1e-6},12162:(H,O,S)=>{H.exports=function(H,O){var S=H[0],q=H[1],p=H[2],G=O[0],U=O[1],V=O[2];return Math.abs(S-G)<=t*Math.max(1,Math.abs(S),Math.abs(G))&&Math.abs(q-U)<=t*Math.max(1,Math.abs(q),Math.abs(U))&&Math.abs(p-V)<=t*Math.max(1,Math.abs(p),Math.abs(V))};var t=S(12123)},12169:H=>{H.exports=function(H,O){return H[0]===O[0]&&H[1]===O[1]&&H[2]===O[2]}},12226:H=>{H.exports=function(H,O){return H[0]=Math.floor(O[0]),H[1]=Math.floor(O[1]),H[2]=Math.floor(O[2]),H}},12367:(H,O,S)=>{H.exports=function(H,O,S,q,p,G){var U,V;O||(O=3);S||(S=0);V=q?Math.min(q*O+S,H.length):H.length;for(U=S;U<V;U+=O)t[0]=H[U],t[1]=H[U+1],t[2]=H[U+2],p(t,t,G),H[U]=t[0],H[U+1]=t[1],H[U+2]=t[2];return H};var t=S(12131)()},12141:H=>{H.exports=function(H,O,S){var t=new Float32Array(3);return t[0]=H,t[1]=O,t[2]=S,t}},12120:(H,O,S)=>{H.exports={EPSILON:S(12123),create:S(12131),clone:S(12133),angle:S(12135),BG:S(12141),i:S(12149),set:S(12156),equals:S(12162),exactEquals:S(12169),add:S(12176),XO:S(12181),sub:S(12186),multiply:S(12194),mul:S(12199),divide:S(12207),div:S(12213),min:S(12216),max:S(12218),floor:S(12226),ceil:S(12231),round:S(12236),scale:S(12239),ZG:S(12248),distance:S(12256),j:S(12260),squaredDistance:S(12266),sqrDist:S(12271),length:S(12273),len:S(12280),squaredLength:S(12284),IG:S(12291),negate:S(12297),inverse:S(12304),normalize:S(12143),dot:S(12146),cross:S(12310),PG:S(12315),random:S(12323),transformMat4:S(12326),transformMat3:S(12334),transformQuat:S(12342),sG:S(12348),iG:S(12354),MG:S(12361),forEach:S(12367)}},12304:H=>{H.exports=function(H,O){return H[0]=1/O[0],H[1]=1/O[1],H[2]=1/O[2],H}},12280:(H,O,S)=>{H.exports=S(12273)},12273:H=>{H.exports=function(H){var O=H[0],S=H[1],t=H[2];return Math.sqrt(O*O+S*S+t*t)}},12315:H=>{H.exports=function(H,O,S,t){var q=O[0],p=O[1],G=O[2];return H[0]=q+t*(S[0]-q),H[1]=p+t*(S[1]-p),H[2]=G+t*(S[2]-G),H}},12218:H=>{H.exports=function(H,O,S){return H[0]=Math.max(O[0],S[0]),H[1]=Math.max(O[1],S[1]),H[2]=Math.max(O[2],S[2]),H}},12216:H=>{H.exports=function(H,O,S){return H[0]=Math.min(O[0],S[0]),H[1]=Math.min(O[1],S[1]),H[2]=Math.min(O[2],S[2]),H}},12199:(H,O,S)=>{H.exports=S(12194)},12194:H=>{H.exports=function(H,O,S){return H[0]=O[0]*S[0],H[1]=O[1]*S[1],H[2]=O[2]*S[2],H}},12297:H=>{H.exports=function(H,O){return H[0]=-O[0],H[1]=-O[1],H[2]=-O[2],H}},12143:H=>{H.exports=function(H,O){var S=O[0],t=O[1],q=O[2],p=S*S+t*t+q*q;p>0&&(p=1/Math.sqrt(p),H[0]=O[0]*p,H[1]=O[1]*p,H[2]=O[2]*p);return H}},12323:H=>{H.exports=function(H,O){O=O||1;var S=2*Math.random()*Math.PI,t=2*Math.random()-1,q=Math.sqrt(1-t*t)*O;return H[0]=Math.cos(S)*q,H[1]=Math.sin(S)*q,H[2]=t*O,H}},12348:H=>{H.exports=function(H,O,S,t){var q=S[1],p=S[2],G=O[1]-q,U=O[2]-p,V=Math.sin(t),w=Math.cos(t);return H[0]=O[0],H[1]=q+G*w-U*V,H[2]=p+G*V+U*w,H}},12354:H=>{H.exports=function(H,O,S,t){var q=S[0],p=S[2],G=O[0]-q,U=O[2]-p,V=Math.sin(t),w=Math.cos(t);return H[0]=q+U*V+G*w,H[1]=O[1],H[2]=p+U*w-G*V,H}},12361:H=>{H.exports=function(H,O,S,t){var q=S[0],p=S[1],G=O[0]-q,U=O[1]-p,V=Math.sin(t),w=Math.cos(t);return H[0]=q+G*w-U*V,H[1]=p+G*V+U*w,H[2]=O[2],H}},12236:H=>{H.exports=function(H,O){return H[0]=Math.round(O[0]),H[1]=Math.round(O[1]),H[2]=Math.round(O[2]),H}},12239:H=>{H.exports=function(H,O,S){return H[0]=O[0]*S,H[1]=O[1]*S,H[2]=O[2]*S,H}},12248:H=>{H.exports=function(H,O,S,t){return H[0]=O[0]+S[0]*t,H[1]=O[1]+S[1]*t,H[2]=O[2]+S[2]*t,H}},12156:H=>{H.exports=function(H,O,S,t){return H[0]=O,H[1]=S,H[2]=t,H}},12271:(H,O,S)=>{H.exports=S(12266)},12291:(H,O,S)=>{H.exports=S(12284)},12266:H=>{H.exports=function(H,O){var S=O[0]-H[0],t=O[1]-H[1],q=O[2]-H[2];return S*S+t*t+q*q}},12284:H=>{H.exports=function(H){var O=H[0],S=H[1],t=H[2];return O*O+S*S+t*t}},12186:(H,O,S)=>{H.exports=S(12181)},12181:H=>{H.exports=function(H,O,S){return H[0]=O[0]-S[0],H[1]=O[1]-S[1],H[2]=O[2]-S[2],H}},12334:H=>{H.exports=function(H,O,S){var t=O[0],q=O[1],p=O[2];return H[0]=t*S[0]+q*S[3]+p*S[6],H[1]=t*S[1]+q*S[4]+p*S[7],H[2]=t*S[2]+q*S[5]+p*S[8],H}},12326:H=>{H.exports=function(H,O,S){var t=O[0],q=O[1],p=O[2],G=S[3]*t+S[7]*q+S[11]*p+S[15];return G=G||1,H[0]=(S[0]*t+S[4]*q+S[8]*p+S[12])/G,H[1]=(S[1]*t+S[5]*q+S[9]*p+S[13])/G,H[2]=(S[2]*t+S[6]*q+S[10]*p+S[14])/G,H}},12342:H=>{H.exports=function(H,O,S){var t=O[0],q=O[1],p=O[2],G=S[0],U=S[1],V=S[2],w=S[3],o=w*t+U*p-V*q,h=w*q+V*t-G*p,a=w*p+G*q-U*t,j=-G*t-U*q-V*p;return H[0]=o*w+j*-G+h*-V-a*-U,H[1]=h*w+j*-U+a*-G-o*-V,H[2]=a*w+j*-V+o*-U-h*-G,H}},13242:H=>{"use strict";H.exports=function(H){for(var O=new Array(H),S=0;S<H;++S)O[S]=S;return O}},13311:H=>{H.exports=function(H){return null!=H&&null!=H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}},13524:(H,O,S)=>{"use strict";S.d(O,{b:()=>t});class t{constructor(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Wo=!1,this.No=!1,this.mo=30,this.ro=0,this.co=!1,this.fullscreen=!1,this.ko=function(H){},this.Ao=function(){},this.Po=function(){},this.gt=function(){},this.uo=function(H){},this.onFullscreenChanged=function(H){},w((()=>{!function(H,O){H._nowObject=performance||Date,H._lastTick=0,H._renderAccum=0,H._rt=0,H._frameCB=U.bind(null,H),requestAnimationFrame(H._frameCB),O>0&&(H._intervalCB=G.bind(null,H),H._interval=setInterval(H._intervalCB,Math.max(O,1e3/H.mo/2)))}(this,O),function(H,O){if(!O)return;var S=!1,t=!1;document.addEventListener("pointerlockchange",(t=>{S=document.pointerLockElement===O,H.uo(S)})),document.addEventListener("fullscreenchange",(S=>{t=document.fullscreenElement===O,H.onFullscreenChanged(t)})),Object.defineProperty(H,"co",{get:()=>S,set:H=>{H&&!S?V(O):S&&!H&&function(H){H.exitPointerLock&&H.exitPointerLock()}(document)}}),Object.defineProperty(H,"fullscreen",{get:()=>t,set:H=>{H&&!t?O.requestFullscreen():t&&!H&&document.exitFullscreen()}}),O.addEventListener("click",(q=>{H.Wo&&!S&&V(O),H.No&&!t&&O.requestFullscreen()}));var q=()=>H.gt();if(window.ResizeObserver){new ResizeObserver(q).observe(O)}else window.addEventListener("resize",q)}(this,H),this.Po()}))}}var q=3,p=20;function G(H){for(var O=1e3/H.mo,S=H._nowObject.now()+p,t=0;H._nowObject.now()>=H._lastTick+O&&H._nowObject.now()<S&&++t<=q;)H.ko(O),H._lastTick+=O;var G=5*(O+5),U=H._nowObject.now();if(U-H._lastTick>G)for(;U>=H._lastTick+O;)H._lastTick+=O}function U(H){requestAnimationFrame(H._frameCB),G(H);var O=H._nowObject.now(),S=O-H._rt;if(H._rt=O,H.ro>0){H._renderAccum+=S;var t=1e3/H.ro;if(H._renderAccum<t)return;H._renderAccum=Math.min(H._renderAccum-t,t)}var q=1e3/H.mo,p=(O-H._lastTick)/q;H.Ao(S,p,q)}function V(H){H.requestPointerLock&&H.requestPointerLock()}var w=H=>{if("loading"===document.readyState){var O=()=>{document.removeEventListener("readystatechange",O),H()};document.addEventListener("readystatechange",O)}else setTimeout(H,1)}},13234:(H,O,S)=>{var t=S(13242),q=S(13246),p="undefined"!==typeof Float64Array;function G(H,O){return H[0]-O[0]}function U(){var H,O=this.stride,S=new Array(O.length);for(H=0;H<S.length;++H)S[H]=[Math.abs(O[H]),H];S.sort(G);var t=new Array(S.length);for(H=0;H<t.length;++H)t[H]=S[H][1];return t}function V(H,O){var S=["View",O,"d",H].join("");O<0&&(S="View_Nil"+H);var q="generic"===H;if(-1===O){var p="function "+S+"(a){this.data=a;};var proto="+S+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+S+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+S+"(a){return new "+S+"(a);}";return new Function(p)()}if(0===O){p="function "+S+"(a,d) {this.data = a;this.offset = d};var proto="+S+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+S+"_copy() {return new "+S+"(this.data,this.offset)};proto.pick=function "+S+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+S+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+S+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+S+"(a,b,c,d){return new "+S+"(a,d)}";return new Function("TrivialArray",p)(w[H][0])}p=["'use strict'"];var G=t(O),V=G.map((function(H){return"i"+H})),o="this.offset+"+G.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),h=G.map((function(H){return"b"+H})).join(","),a=G.map((function(H){return"c"+H})).join(",");p.push("function "+S+"(a,"+h+","+a+",d){this.data=a","this.shape=["+h+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+S+".prototype","proto.dtype='"+H+"'","proto.dimension="+O),p.push("Object.defineProperty(proto,'size',{get:function "+S+"_size(){return "+G.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===O?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),O<4?(p.push("function "+S+"_order(){"),2===O?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+S+"_set("+V.join(",")+",v){"),q?p.push("return this.data.set("+o+",v)}"):p.push("return this.data["+o+"]=v}"),p.push("proto.get=function "+S+"_get("+V.join(",")+"){"),q?p.push("return this.data.get("+o+")}"):p.push("return this.data["+o+"]}"),p.push("proto.index=function "+S+"_index(",V.join(),"){return "+o+"}"),p.push("proto.hi=function "+S+"_hi("+V.join(",")+"){return new "+S+"(this.data,"+G.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+G.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var j=G.map((function(H){return"a"+H+"=this.shape["+H+"]"})),e=G.map((function(H){return"c"+H+"=this.stride["+H+"]"}));p.push("proto.lo=function "+S+"_lo("+V.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+e.join(","));for(var X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");p.push("return new "+S+"(this.data,"+G.map((function(H){return"a"+H})).join(",")+","+G.map((function(H){return"c"+H})).join(",")+",b)}"),p.push("proto.step=function "+S+"_step("+V.join(",")+"){var "+G.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+G.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");p.push("return new "+S+"(this.data,"+G.map((function(H){return"a"+H})).join(",")+","+G.map((function(H){return"b"+H})).join(",")+",c)}");var E=new Array(O),y=new Array(O);for(X=0;X<O;++X)E[X]="a[i"+X+"]",y[X]="b[i"+X+"]";p.push("proto.transpose=function "+S+"_transpose("+V+"){"+V.map((function(H,O){return H+"=("+H+"===undefined?"+O+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+S+"(this.data,"+E.join(",")+","+y.join(",")+",this.offset)}"),p.push("proto.pick=function "+S+"_pick("+V+"){var a=[],b=[],c=this.offset");for(X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+S+"(data,shape,stride,offset){return new "+S+"(data,"+G.map((function(H){return"shape["+H+"]"})).join(",")+","+G.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join("\n"))(w[H],U)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,O,S,t){if(void 0===H)return(0,w.array[0])([]);"number"===typeof H&&(H=[H]),void 0===O&&(O=[H.length]);var G=O.length;if(void 0===S){S=new Array(G);for(var U=G-1,o=1;U>=0;--U)S[U]=o,o*=O[U]}if(void 0===t){t=0;for(U=0;U<G;++U)S[U]<0&&(t-=(O[U]-1)*S[U])}for(var h=function(H){if(q(H))return"buffer";if(p)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),a=w[h];a.length<=G+1;)a.push(V(h,a.length-1));return(0,a[G+1])(H,O,S,t)}},13246:H=>{function O(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(O(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&O(H.slice(0,0))}(H)||!!H._isBuffer)}},13393:H=>{"use strict";var O=[],S=[],t=[],q=[],p=[],G=[],U=[],V=[],w=[],o=[],h=[],a=[];H.exports=function(H,j,e,X,E,y){for(var T=U,K=w,b=o,D=a,F=0;F<3;F++)T[F]=+e[F],b[F]=+j.max[F],K[F]=+j.base[F];y||(y=1e-10);var Y=function(H,U,w,o,a,j){var e=O,X=S,E=t,y=q,T=p,K=G,b=V,D=Math.floor,F=0,Y=0,l=0,d=0,v=0;if(z(),0===l)return 0;for(d=W();Y<=l;){if(m(d)&&r())return F;d=W()}for(F+=l,v=0;v<3;v++)o[v]+=w[v],a[v]+=w[v];return F;function z(){if(Y=0,0!==(l=Math.sqrt(w[0]*w[0]+w[1]*w[1]+w[2]*w[2])))for(var H=0;H<3;H++){var O=w[H]>=0;y[H]=O?1:-1;var S=O?a[H]:o[H];e[H]=O?o[H]:a[H],X[H]=g(S,y[H]),E[H]=N(e[H],y[H]),b[H]=w[H]/l,T[H]=Math.abs(1/b[H]);var t=O?X[H]+1-S:S-X[H];K[H]=T[H]<1/0?T[H]*t:1/0}}function m(O){for(var S=y[0],t=0===O?X[0]:E[0],q=X[0]+S,p=y[1],G=1===O?X[1]:E[1],U=X[1]+p,V=y[2],w=2===O?X[2]:E[2],o=X[2]+V,h=t;h!=q;h+=S)for(var a=G;a!=U;a+=p)for(var j=w;j!=o;j+=V)if(H(h,a,j))return!0;return!1}function r(){F+=Y;var H=y[d],O=Y/l,S=h;for(v=0;v<3;v++){var t=w[v]*O;o[v]+=t,a[v]+=t,S[v]=w[v]-t}if(H>0?a[d]=Math.round(a[d]):o[d]=Math.round(o[d]),U(F,d,H,S))return!0;for(v=0;v<3;v++)w[v]=S[v];return z(),0===l}function W(){var H=K[0]<K[1]?K[0]<K[2]?0:2:K[1]<K[2]?1:2,O=K[H]-Y;for(Y=K[H],X[H]+=y[H],K[H]+=T[H],v=0;v<3;v++)e[v]+=O*b[v],E[v]=N(e[v],y[v]);return H}function g(H,O){return D(H-O*j)}function N(H,O){return D(H+O*j)}}(H,X,T,K,b,y);if(!E){for(F=0;F<3;F++)D[F]=e[F]>0?b[F]-j.max[F]:K[F]-j.base[F];j.translate(D)}return Y}},13559:(H,O,S)=>{"use strict";S.d(O,{c:()=>h});var t=S(13389),q=S(12120);class p{constructor(H,O,S,p,G,U,V){this.dw=new t(H.base,H.Bw),this.wt=O,this.friction=S,this.restitution=p,this.gG=G,this.mj=U,this.NG=!!V,this.Rw=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Fe=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ow=q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=q.create(),this._impulses=q.create(),this._sleepFrameCount=10}loadFromCopy(H){q.i(this.dw.base,H.dw.base),q.i(this.dw.Bw,H.dw.Bw),q.i(this.dw.max,H.dw.max),this.dw.mag=H.dw.mag,this.wt=H.wt,this.friction=H.friction,this.restitution=H.restitution,this.gG=H.gG,this.mj=H.mj,this.NG=H.NG,this.Rw=H.Rw,this.fluidDrag=H.fluidDrag,this.Fe=H.Fe,this.preventFallOffEdge=H.preventFallOffEdge,this.rolledBackLastTick=H.rolledBackLastTick,q.i(this.Ow,H.Ow),q.i(this.resting,H.resting),this.inFluid=H.inFluid,this._ratioInFluid=H._ratioInFluid,q.i(this._forces,H._forces),q.i(this._impulses,H._impulses),this._sleepFrameCount=H._sleepFrameCount}setPosition(H){G(H),q.XO(H,H,this.dw.base),this.dw.translate(H),this.qw()}qq(){return q.clone(this.dw.base)}applyForce(H){G(H),q.add(this._forces,this._forces,H),this.qw()}applyImpulse(H){G(H),q.add(this._impulses,this._impulses,H),this.qw()}qw(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var G=H=>{};var U=S(13389),V=S(12120),w=S(13393);function o(){this.Rw=.1,this.fluidDrag=.4,this.JG=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function h(H,O,S){H=Object.assign(new o,H),this.gravity=H.gravity||[0,-10,0],this.Rw=H.Rw||.1,this.JG=H.JG||2,this.fluidDrag=H.fluidDrag||.4,this.minBounceImpulse=H.minBounceImpulse,this.bodies=[],this.Qa=H.Qa,this.testSolid=O,this.testFluid=S}h.prototype.Aj=function(H,O,S,t,q,G){H=H||new U([0,0,0],[1,1,1]),"undefined"==typeof O&&(O=1),"undefined"==typeof S&&(S=1),"undefined"==typeof t&&(t=0),"undefined"==typeof q&&(q=1);var V=new p(H,O,S,t,q,G);return this.bodies.push(V),V},h.prototype.uj=function(H){var O=this.bodies.indexOf(H);O<0||(this.bodies.splice(O,1),H.dw=H.mj=null)};var a=V.create(),j=V.create(),e=V.create(),X=V.create(),E=V.create(),y=V.create(),T=V.create(),K=new U([0,0,0],[1,1,1]),b=new p(K,1,1,0,1,(()=>{}),!1);function D(H,O,S){return O=S,O*=1-(1-H.ratioInFluid)**2}h.prototype.LG=function(H){H/=1e3;var O=J(0,V.squaredLength(this.gravity));this.bodies.forEach((S=>function(H,O,S,t){V.i(E,O.resting),H.Qa&&b.loadFromCopy(O);if(O.wt<=0)return V.set(O.Ow,0,0,0),V.set(O._forces,0,0,0),void V.set(O._impulses,0,0,0);var q=t||0===O.gG;if(function(H,O,S,t){if(O._sleepFrameCount>0)return!1;if(t)return!0;var q=!1,p=.5*S*S*O.gG;return V.scale(u,H.gravity,p),w(H.testSolid,O.dw,u,(function(){return q=!0,!0}),!0),q}(H,O,S,q))return;O._sleepFrameCount--,function(H,O){var S=O.dw,t=Math.floor(S.base[0]),q=Math.floor(S.base[2]),p=Math.floor(S.base[1]),G=Math.floor(S.max[1]);if(!H.testFluid(t,p,q))return O.inFluid=!1,void(O.ratioInFluid=0);var U=1,w=p+1;for(;w<=G&&H.testFluid(t,w,q);)U++,w++;var o=(p+U-S.base[1])/S.Bw[1];o>1&&(o=1);var h=S.Bw[0]*S.Bw[1]*S.Bw[2]*o,a=Y;V.scale(a,H.gravity,-H.JG*h*O.gG),O.applyForce(a),O.inFluid=!0,O.ratioInFluid=o}(H,O),f(O._forces),f(O._impulses),f(O.Ow),f(O.resting),V.scale(a,O._forces,1/O.wt),V.ZG(a,a,H.gravity,O.gG),V.scale(j,O._impulses,1/O.wt),V.ZG(j,j,a,S),V.add(O.Ow,O.Ow,j),O.friction&&(l(H,0,O,j,S),l(H,1,O,j,S),l(H,2,O,j,S));var p=O.fluidDrag>=0?O.fluidDrag:H.fluidDrag,G=O.Rw>=0?O.Rw:H.Rw,U=G,o=G;O.inFluid&&(U=D(O,U,O.fluidDragHoriz>=0?O.fluidDragHoriz:p),o=D(O,o,O.fluidDragVert>=0?O.fluidDragVert:p));U=Math.max(1-U*S/O.wt,0),o=Math.max(1-o*S/O.wt,0),V.set(F,U,o,U),V.multiply(O.Ow,O.Ow,F),V.scale(e,O.Ow,S),V.set(O._forces,0,0,0),V.set(O._impulses,0,0,0),O.NG&&P(z,O.dw);V.i(y,e),V.set(T,0,0,0),O.preventFallOffEdge&&function(H,O,S,t){if(!O.resting[1]||S[1]>0)return;var q=x;P(q,O.dw);for(var p=0;p<3;p+=2){V.set(N,0,0,0),N[p]=S[p];var G=!0;(G=(G=(G=(G=G&&!A(H,q.base[0]+N[0]+1e-5,q.base[1],q.base[2]+N[2]+1e-5))&&!A(H,q.max[0]+N[0]-1e-5,q.base[1],q.base[2]+N[2]+1e-5))&&!A(H,q.base[0]+N[0]+1e-5,q.base[1],q.max[2]+N[2]-1e-5))&&!A(H,q.max[0]+N[0]-1e-5,q.base[1],q.max[2]+N[2]-1e-5))?(t[p]=S[p]>0?1:-1,S[p]=0):0===p&&(V.set(k,S[0],0,0),v(H,q,k,t,O.slideOnCollision))}}(H,O,e,T);v(H,O.dw,e,O.resting,O.slideOnCollision),O.NG&&function(H,O,S,t){if(O.resting[1]>=0&&!O.inFluid)return;var q=0!==O.resting[0],p=0!==O.resting[2];if(!q&&!p)return;var G=Math.abs(t[0]/t[2]),U=4;if(!q&&G>U)return;if(!p&&G<1/U)return;V.add(r,S.base,t);var o=H.testSolid;w(o,S,t,(function(H,O,S,t){if(1!==O)return!0;t[O]=0}));var h=S.base[1],a=O.inFluid?1.951:1.001,j=Math.floor(h+a)-h;V.set(W,0,j,0);var e=!1;if(w(o,S,W,(function(H,O,S,t){return e=!0,!0})),e)return;V.XO(g,r,S.base),g[1]=0,v(H,S,g,m,!0);var X=J(S.base[0],r[0]),E=J(S.base[2],r[2]);if(q&&!X&&(!E||!p))return;if(p&&(!X||!q)&&!E)return;var y=!0;if(y=y&&!A(H,S.base[0]+1e-5,S.base[1],S.base[2]+1e-5),y=y&&!A(H,S.max[0]-1e-5,S.base[1],S.base[2]+1e-5),y=y&&!A(H,S.base[0]+1e-5,S.base[1],S.max[2]-1e-5),y=y&&!A(H,S.max[0]-1e-5,S.base[1],S.max[2]-1e-5),y)return;P(O.dw,S),O.resting[0]=m[0],O.resting[2]=m[2],O.Fe&&O.Fe()}(H,O,z,y);for(var h=0;h<3;++h)O.resting[h]=O.resting[h]||T[h],X[h]=0,O.resting[h]&&(E[h]||(X[h]=-O.Ow[h]),O.Ow[h]=0);var K=V.length(X);K>.001&&(V.scale(X,X,O.wt),O.mj&&O.mj(X),O.restitution>0&&K>H.minBounceImpulse&&(V.scale(X,X,O.restitution),O.applyImpulse(X)));var d=V.squaredLength(O.Ow);d>1e-5&&O.qw();H.Qa&&H.Qa(O)?(O.loadFromCopy(b),O.rolledBackLastTick=!0):O.rolledBackLastTick=!1}(this,S,H,O)))};var F=V.create([0,0,0]);var Y=V.create();function l(H,O,S,t,q){var p=S.resting[O],G=t[O];if(!S.alwaysApplyHorizFriction||1!==O){if(0===p)return;if(p*G<=0)return}V.i(d,S.Ow),d[O]=0;var U=V.length(d);if(!J(U,0)){var w=Math.abs(S.friction*H.gravity[O]*q),o=U>w?(U-w)/U:0;S.Ow[(O+1)%3]*=o,S.Ow[(O+2)%3]*=o}}var d=V.create();function v(H,O,S,t,q){return V.set(t,0,0,0),w(H.testSolid,O,S,(function(H,O,S,p){t[O]=S,p[O]=0,q||(p[0]=0,p[1]=0,p[2]=0)}))}var z=new U([],[]),m=V.create(),r=V.create(),W=V.create(),g=V.create();var N=V.create(),x=new U([],[]),k=V.create();function A(H,O,S,t){return H.testSolid(Math.floor(O),Math.floor(S-1),Math.floor(t))}var u=V.create();function J(H,O){return Math.abs(H-O)<1e-5}function P(H,O){for(var S=0;S<3;S++)H.base[S]=O.base[S],H.max[S]=O.max[S],H.Bw[S]=O.Bw[S]}var f=function(H){}},11980:function(H,O){!function(H){"use strict";var O=function(H,S){return O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(H,O){H.__proto__=O}||function(H,O){for(var S in O)Object.prototype.hasOwnProperty.call(O,S)&&(H[S]=O[S])},O(H,S)};function S(H,S){if("function"!==typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function t(){this.constructor=H}O(H,S),H.prototype=null===S?Object.create(S):(t.prototype=S.prototype,new t)}function t(H,O,S,t){var q,p=arguments.length,G=p<3?O:null===t?t=Object.getOwnPropertyDescriptor(O,S):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)G=Reflect.decorate(H,O,S,t);else for(var U=H.length-1;U>=0;U--)(q=H[U])&&(G=(p<3?q(G):p>3?q(O,S,G):q(O,S))||G);return p>3&&G&&Object.defineProperty(O,S,G),G}function q(H,O,S){if(S||2===arguments.length)for(var t,q=0,p=O.length;q<p;q++)!t&&q in O||(t||(t=Array.prototype.slice.call(O,0,q)),t[q]=O[q]);return H.concat(t||Array.prototype.slice.call(O))}var p,G=255,U=213;H.OPERATION=void 0,(p=H.OPERATION||(H.OPERATION={}))[p.ADD=128]="ADD",p[p.REPLACE=0]="REPLACE",p[p.DELETE=64]="DELETE",p[p.DELETE_AND_ADD=192]="DELETE_AND_ADD",p[p.TOUCH=1]="TOUCH",p[p.CLEAR=10]="CLEAR";var V=function(){function O(H,O,S){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=H,this.setParent(O,S)}return O.prototype.setParent=function(H,O,S){var t=this;if(this.indexes||(this.indexes=this.ref instanceof gH?this.ref._definition.indexes:{}),this.parent=H,this.parentIndex=S,O)if(this.root=O,this.ref instanceof gH){var q=this.ref._definition;for(var p in q.schema){var G=this.ref[p];if(G&&G.$changes){var U=q.indexes[p];G.$changes.setParent(this.ref,O,U)}}}else"object"===typeof this.ref&&this.ref.forEach((function(H,O){if(H instanceof gH){var S=H.$changes,q=t.ref.$changes.indexes[O];S.setParent(t.ref,t.root,q)}}))},O.prototype.operation=function(H){this.changes.set(--this.currentCustomOperation,H)},O.prototype.change=function(O,S){void 0===S&&(S=H.OPERATION.ADD);var t="number"===typeof O?O:this.indexes[O];this.assertValidIndex(t,O);var q=this.changes.get(t);q&&q.op!==H.OPERATION.DELETE&&q.op!==H.OPERATION.TOUCH||this.changes.set(t,{op:q&&q.op===H.OPERATION.DELETE?H.OPERATION.DELETE_AND_ADD:S,index:t}),this.allChanges.add(t),this.changed=!0,this.touchParents()},O.prototype.touch=function(O){var S="number"===typeof O?O:this.indexes[O];this.assertValidIndex(S,O),this.changes.has(S)||this.changes.set(S,{op:H.OPERATION.TOUCH,index:S}),this.allChanges.add(S),this.touchParents()},O.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},O.prototype.getType=function(H){if(this.ref._definition)return(O=this.ref._definition).schema[O.fieldsByIndex[H]];var O,S=(O=this.parent._definition).schema[O.fieldsByIndex[this.parentIndex]];return Object.values(S)[0]},O.prototype.getChildrenFilter=function(){var H=this.parent._definition.childFilters;return H&&H[this.parentIndex]},O.prototype.getValue=function(H){return this.ref.getByIndex(H)},O.prototype.delete=function(O){var S="number"===typeof O?O:this.indexes[O];if(void 0!==S){var t=this.getValue(S);this.changes.set(S,{op:H.OPERATION.DELETE,index:S}),this.allChanges.delete(S),delete this.caches[S],t&&t.$changes&&(t.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(O," (").concat(S,")"))},O.prototype.discard=function(O,S){var t=this;void 0===O&&(O=!1),void 0===S&&(S=!1),this.ref instanceof gH||this.changes.forEach((function(O){if(O.op===H.OPERATION.DELETE){var S=t.ref.getIndex(O.index);delete t.indexes[S]}})),this.changes.clear(),this.changed=O,S&&this.allChanges.clear(),this.currentCustomOperation=0},O.prototype.discardAll=function(){var H=this;this.changes.forEach((function(O){var S=H.getValue(O.index);S&&S.$changes&&S.$changes.discardAll()})),this.discard()},O.prototype.cache=function(H,O){this.caches[H]=O},O.prototype.clone=function(){return new O(this.ref,this.parent,this.root)},O.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},O.prototype.assertValidIndex=function(H,O){if(void 0===H)throw new Error('ChangeTree: missing index for field "'.concat(O,'"'))},O}();function w(H,O,S,t){return H[O]||(H[O]=[]),H[O].push(S),null===t||void 0===t||t.forEach((function(H,O){return S(H,O)})),function(){return h(H[O],H[O].indexOf(S))}}function o(O){var S=this,t="string"!==typeof this.$changes.getType();this.$items.forEach((function(q,p){O.push({refId:S.$changes.refId,op:H.OPERATION.DELETE,field:p,value:void 0,previousValue:q}),t&&S.$changes.root.removeRef(q.$changes.refId)}))}function h(H,O){if(-1===O||O>=H.length)return!1;for(var S=H.length-1,t=O;t<S;t++)H[t]=H[t+1];return H.length=S,!0}var a=function(H,O){var S=H.toString(),t=O.toString();return S<t?-1:S>t?1:0};function j(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,O){return"symbol"===typeof O||isNaN(O)?H[O]:H.at(O)},set:function(H,O,S){if("symbol"===typeof O||isNaN(O))H[O]=S;else{var t=Array.from(H.$items.keys()),q=parseInt(t[O]||O);void 0===S||null===S?H.deleteAt(q):H.setAt(q,S)}return!0},deleteProperty:function(H,O){return"number"===typeof O?H.deleteAt(O):delete H[O],!0}})}var e=function(){function O(){for(var H=[],O=0;O<arguments.length;O++)H[O]=arguments[O];this.$changes=new V(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,H)}return O.prototype.vU=function(O,S){return void 0===S&&(S=!0),w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,O,S?this.$items:void 0)},O.prototype.lt=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,O)},O.is=function(H){return Array.isArray(H)||void 0!==H.array},Object.defineProperty(O.prototype,"length",{get:function(){return this.$items.size},set:function(H){0===H?this.clear():this.splice(H,this.length-H)},enumerable:!1,configurable:!0}),O.prototype.push=function(){for(var H,O=this,S=[],t=0;t<arguments.length;t++)S[t]=arguments[t];return S.forEach((function(S){H=O.$refId++,O.setAt(H,S)})),H},O.prototype.pop=function(){var H=Array.from(this.$indexes.values()).pop();if(void 0!==H){this.$changes.delete(H),this.$indexes.delete(H);var O=this.$items.get(H);return this.$items.delete(H),O}},O.prototype.at=function(H){var O=Array.from(this.$items.keys())[H];return this.$items.get(O)},O.prototype.setAt=function(O,S){var t,q;if(void 0!==S&&null!==S){if(this.$items.get(O)!==S){void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,O);var p=null!==(q=null===(t=this.$changes.indexes[O])||void 0===t?void 0:t.op)&&void 0!==q?q:H.OPERATION.ADD;this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,S),this.$changes.change(O,p)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},O.prototype.deleteAt=function(H){var O=Array.from(this.$items.keys())[H];return void 0!==O&&this.$deleteAt(O)},O.prototype.$deleteAt=function(H){return this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&o.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.concat=function(){for(var H,S=[],t=0;t<arguments.length;t++)S[t]=arguments[t];return new(O.bind.apply(O,q([void 0],(H=Array.from(this.$items.values())).concat.apply(H,S),!1)))},O.prototype.join=function(H){return Array.from(this.$items.values()).join(H)},O.prototype.reverse=function(){var H=this,O=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(S,t){H.setAt(O[t],S)})),this},O.prototype.shift=function(){var H=Array.from(this.$items.keys()).shift();if(void 0!==H){var O=this.$items.get(H);return this.$deleteAt(H),O}},O.prototype.slice=function(H,S){var t=new O;return t.push.apply(t,Array.from(this.$items.values()).slice(H,S)),t},O.prototype.sort=function(H){var O=this;void 0===H&&(H=a);var S=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(H).forEach((function(H,t){O.setAt(S[t],H)})),this},O.prototype.splice=function(H,O){void 0===O&&(O=this.length-H);for(var S=Array.from(this.$items.keys()),t=[],q=H;q<H+O;q++)t.push(this.$items.get(S[q])),this.$deleteAt(S[q]);return t},O.prototype.unshift=function(){for(var H=this,O=[],S=0;S<arguments.length;S++)O[S]=arguments[S];var t=this.length,q=O.length,p=Array.from(this.$items.values());return O.forEach((function(O,S){H.setAt(S,O)})),p.forEach((function(O,S){H.setAt(q+S,O)})),t+q},O.prototype.indexOf=function(H,O){return Array.from(this.$items.values()).indexOf(H,O)},O.prototype.lastIndexOf=function(H,O){return void 0===O&&(O=this.length-1),Array.from(this.$items.values()).lastIndexOf(H,O)},O.prototype.every=function(H,O){return Array.from(this.$items.values()).every(H,O)},O.prototype.some=function(H,O){return Array.from(this.$items.values()).some(H,O)},O.prototype.forEach=function(H,O){Array.from(this.$items.values()).forEach(H,O)},O.prototype.map=function(H,O){return Array.from(this.$items.values()).map(H,O)},O.prototype.filter=function(H,O){return Array.from(this.$items.values()).filter(H,O)},O.prototype.reduce=function(H,O){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},O.prototype.reduceRight=function(H,O){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},O.prototype.find=function(H,O){return Array.from(this.$items.values()).find(H,O)},O.prototype.findIndex=function(H,O){return Array.from(this.$items.values()).findIndex(H,O)},O.prototype.fill=function(H,O,S){throw new Error("ArraySchema#fill() not implemented")},O.prototype.copyWithin=function(H,O,S){throw new Error("ArraySchema#copyWithin() not implemented")},O.prototype.toString=function(){return this.$items.toString()},O.prototype.toLocaleString=function(){return this.$items.toLocaleString()},O.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},O.prototype.includes=function(H,O){return Array.from(this.$items.values()).includes(H,O)},O.prototype.flatMap=function(H,O){throw new Error("ArraySchema#flatMap() is not supported.")},O.prototype.flat=function(H){throw new Error("ArraySchema#flat() is not supported.")},O.prototype.findLast=function(){var H=Array.from(this.$items.values());return H.findLast.apply(H,arguments)},O.prototype.findLastIndex=function(){var H=Array.from(this.$items.values());return H.findLastIndex.apply(H,arguments)},O.prototype.setIndex=function(H,O){this.$indexes.set(H,O)},O.prototype.getIndex=function(H){return this.$indexes.get(H)},O.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},O.prototype.deleteByIndex=function(H){var O=this.$indexes.get(H);this.$items.delete(O),this.$indexes.delete(H)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){return this.toArray().map((function(H){return"function"===typeof H.toJSON?H.toJSON():H}))},O.prototype.clone=function(H){return H?new(O.bind.apply(O,q([void 0],Array.from(this.$items.values()),!1))):new(O.bind.apply(O,q([void 0],this.map((function(H){return H.$changes?H.clone():H})),!1)))},O}();function X(H){return H.$proxy=!0,H=new Proxy(H,{get:function(H,O){return"symbol"!==typeof O&&"undefined"===typeof H[O]?H.get(O):H[O]},set:function(H,O,S){return"symbol"!==typeof O&&-1===O.indexOf("$")&&"vU"!==O&&"lt"!==O&&"onChange"!==O?H.set(O,S):H[O]=S,!0},deleteProperty:function(H,O){return H.delete(O),!0}})}var E=function(){function O(H){var S=this;if(this.$changes=new V(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H)if(H instanceof Map||H instanceof O)H.forEach((function(H,O){return S.set(O,H)}));else for(var t in H)this.set(t,H[t])}return O.prototype.vU=function(O,S){return void 0===S&&(S=!0),w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,O,S?this.$items:void 0)},O.prototype.lt=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,O)},O.is=function(H){return void 0!==H.map},O.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(O.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(O,Symbol.species,{get:function(){return O},enumerable:!1,configurable:!0}),O.prototype.set=function(O,S){if(void 0===S||null===S)throw new Error("MapSchema#set('".concat(O,"', ").concat(S,"): trying to set ").concat(S," value on '").concat(O,"'."));O=O.toString();var t="undefined"!==typeof this.$changes.indexes[O],q=t?this.$changes.indexes[O]:this.$refId++,p=t?H.OPERATION.REPLACE:H.OPERATION.ADD,G=void 0!==S.$changes;if(G&&S.$changes.setParent(this,this.$changes.root,q),t){if(!G&&this.$items.get(O)===S)return;G&&this.$items.get(O)!==S&&(p=H.OPERATION.ADD)}else this.$changes.indexes[O]=q,this.$indexes.set(q,O);return this.$items.set(O,S),this.$changes.change(O,p),this},O.prototype.get=function(H){return this.$items.get(H)},O.prototype.delete=function(H){return this.$changes.delete(H),this.$items.delete(H)},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&o.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(H){return this.$items.has(H)},O.prototype.forEach=function(H){this.$items.forEach(H)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.keys=function(){return this.$items.keys()},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(H,O){this.$indexes.set(H,O)},O.prototype.getIndex=function(H){return this.$indexes.get(H)},O.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},O.prototype.deleteByIndex=function(H){var O=this.$indexes.get(H);this.$items.delete(O),this.$indexes.delete(H)},O.prototype.toJSON=function(){var H={};return this.forEach((function(O,S){H[S]="function"===typeof O.toJSON?O.toJSON():O})),H},O.prototype.clone=function(H){var S;return H?S=Object.assign(new O,this):(S=new O,this.forEach((function(H,O){H.$changes?S.set(O,H.clone()):S.set(O,H)}))),S},O}(),y={};function T(H,O){y[H]=O}function K(H){return y[H]}var b=function(){function H(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return H.create=function(O){var S=new H;return S.schema=Object.assign({},O&&O.schema||{}),S.indexes=Object.assign({},O&&O.indexes||{}),S.fieldsByIndex=Object.assign({},O&&O.fieldsByIndex||{}),S.descriptors=Object.assign({},O&&O.descriptors||{}),S.deprecated=Object.assign({},O&&O.deprecated||{}),S},H.prototype.addField=function(H,O){var S=this.getNextFieldIndex();this.fieldsByIndex[S]=H,this.indexes[H]=S,this.schema[H]=Array.isArray(O)?{array:O[0]}:O},H.prototype.hasField=function(H){return void 0!==this.indexes[H]},H.prototype.addFilter=function(H,O){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[H]]=O,this.indexesWithFilters.push(this.indexes[H]),!0},H.prototype.addChildrenFilter=function(H,O){var S=this.indexes[H],t=this.schema[H];if(K(Object.keys(t)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[S]=O,!0;console.warn("@filterChildren: field '".concat(H,"' can't have children. Ignoring filter."))},H.prototype.getChildrenFilter=function(H){return this.childFilters&&this.childFilters[this.indexes[H]]},H.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},H}();function D(H){return H._context&&H._context.useFilters}var F=function(){function H(){this.types={},this.schemas=new Map,this.useFilters=!1}return H.prototype.has=function(H){return this.schemas.has(H)},H.prototype.get=function(H){return this.types[H]},H.prototype.add=function(H,O){void 0===O&&(O=this.schemas.size),H._definition=b.create(H._definition),H._typeid=O,this.types[O]=H,this.schemas.set(H,O)},H.create=function(O){return void 0===O&&(O={}),function(S){return O.context||(O.context=new H),l(S,O)}},H}(),Y=new F;function l(H,O){return void 0===O&&(O={}),function(S,t){var p=O.context||Y,G=S.constructor;if(G._context=p,!H)throw new Error("".concat(G.name,': @type() reference provided for "').concat(t,"\" is undefined. Make sure you don't have any circular dependencies."));p.has(G)||p.add(G);var U=G._definition;if(U.addField(t,H),U.descriptors[t]){if(U.deprecated[t])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(t,"' definition on '").concat(G.name,"'.\nCheck @type() annotation"))}catch(y){var V=y.stack.split("\n")[4].trim();throw new Error("".concat(y.message," ").concat(V))}}var w=e.is(H),o=!w&&E.is(H);if("string"!==typeof H&&!gH.is(H)){var h=Object.values(H)[0];"string"===typeof h||p.has(h)||p.add(h)}if(O.manual)U.descriptors[t]={enumerable:!0,configurable:!0,writable:!0};else{var a="_".concat(t);U.descriptors[a]={enumerable:!1,configurable:!1,writable:!0},U.descriptors[t]={get:function(){return this[a]},set:function(H){H!==this[a]&&(void 0!==H&&null!==H?(!w||H instanceof e||(H=new(e.bind.apply(e,q([void 0],H,!1)))),!o||H instanceof E||(H=new E(H)),void 0===H.$proxy&&(o?H=X(H):w&&(H=j(H))),this.$changes.change(t),H.$changes&&H.$changes.setParent(this,this.$changes.root,this._definition.indexes[t])):this[a]&&this.$changes.delete(t),this[a]=H)},enumerable:!0,configurable:!0}}}}function d(H){return function(O,S){var t=O.constructor;t._definition.addFilter(S,H)&&(t._context.useFilters=!0)}}function v(H){return function(O,S){var t=O.constructor;t._definition.addChildrenFilter(S,H)&&(t._context.useFilters=!0)}}function z(H){return void 0===H&&(H=!0),function(O,S){var t=O.constructor._definition;t.deprecated[S]=!0,H&&(t.descriptors[S]={get:function(){throw new Error("".concat(S," is deprecated."))},set:function(H){},enumerable:!1,configurable:!0})}}function m(H,O,S){for(var t in void 0===S&&(S={}),S.context||(S.context=H._context||S.context||Y),O)l(O[t],S)(H.prototype,t);return H}function r(H){for(var O=0,S=0,t=0,q=H.length;t<q;t++)(O=H.charCodeAt(t))<128?S+=1:O<2048?S+=2:O<55296||O>=57344?S+=3:(t++,S+=4);return S}function W(H,O,S){for(var t=0,q=0,p=S.length;q<p;q++)(t=S.charCodeAt(q))<128?H[O++]=t:t<2048?(H[O++]=192|t>>6,H[O++]=128|63&t):t<55296||t>=57344?(H[O++]=224|t>>12,H[O++]=128|t>>6&63,H[O++]=128|63&t):(q++,t=65536+((1023&t)<<10|1023&S.charCodeAt(q)),H[O++]=240|t>>18,H[O++]=128|t>>12&63,H[O++]=128|t>>6&63,H[O++]=128|63&t)}function g(H,O){H.push(255&O)}function N(H,O){H.push(255&O)}function x(H,O){H.push(255&O),H.push(O>>8&255)}function k(H,O){H.push(255&O),H.push(O>>8&255)}function A(H,O){H.push(255&O),H.push(O>>8&255),H.push(O>>16&255),H.push(O>>24&255)}function u(H,O){var S=O>>24,t=O>>16,q=O>>8,p=O;H.push(255&p),H.push(255&q),H.push(255&t),H.push(255&S)}function J(H,O){var S=Math.floor(O/Math.pow(2,32));u(H,O>>>0),u(H,S)}function P(H,O){var S=O/Math.pow(2,32)|0;u(H,O>>>0),u(H,S)}function f(H,O){I(H,O)}function c(H,O){s(H,O)}var R=new Int32Array(2),B=new Float32Array(R.buffer),Z=new Float64Array(R.buffer);function I(H,O){B[0]=O,A(H,R[0])}function s(H,O){Z[0]=O,A(H,R[0]),A(H,R[1])}function i(H,O){return N(H,O?1:0)}function M(H,O){O||(O="");var S=r(O),t=0;if(S<32)H.push(160|S),t=1;else if(S<256)H.push(217),N(H,S),t=2;else if(S<65536)H.push(218),k(H,S),t=3;else{if(!(S<4294967296))throw new Error("String too long");H.push(219),u(H,S),t=5}return W(H,H.length,O),t+S}function C(H,O){return isNaN(O)?C(H,0):isFinite(O)?O!==(0|O)?(H.push(203),s(H,O),9):O>=0?O<128?(N(H,O),1):O<256?(H.push(204),N(H,O),2):O<65536?(H.push(205),k(H,O),3):O<4294967296?(H.push(206),u(H,O),5):(H.push(207),P(H,O),9):O>=-32?(H.push(224|O+32),1):O>=-128?(H.push(208),g(H,O),2):O>=-32768?(H.push(209),x(H,O),3):O>=-2147483648?(H.push(210),A(H,O),5):(H.push(211),J(H,O),9):C(H,O>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var n=Object.freeze({__proto__:null,utf8Write:W,int8:g,uint8:N,int16:x,uint16:k,int32:A,uint32:u,int64:J,uint64:P,float32:f,float64:c,writeFloat32:I,writeFloat64:s,boolean:i,string:M,number:C});function Q(H,O,S){for(var t="",q=0,p=O,G=O+S;p<G;p++){var U=H[p];0!==(128&U)?192!==(224&U)?224!==(240&U)?240!==(248&U)?console.error("Invalid byte "+U.toString(16)):(q=(7&U)<<18|(63&H[++p])<<12|(63&H[++p])<<6|63&H[++p])>=65536?(q-=65536,t+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):t+=String.fromCharCode(q):t+=String.fromCharCode((15&U)<<12|(63&H[++p])<<6|63&H[++p]):t+=String.fromCharCode((31&U)<<6|63&H[++p]):t+=String.fromCharCode(U)}return t}function L(H,O){return HH(H,O)<<24>>24}function HH(H,O){return H[O.offset++]}function OH(H,O){return SH(H,O)<<16>>16}function SH(H,O){return H[O.offset++]|H[O.offset++]<<8}function tH(H,O){return H[O.offset++]|H[O.offset++]<<8|H[O.offset++]<<16|H[O.offset++]<<24}function qH(H,O){return tH(H,O)>>>0}function pH(H,O){return aH(H,O)}function GH(H,O){return jH(H,O)}function UH(H,O){var S=qH(H,O);return tH(H,O)*Math.pow(2,32)+S}function VH(H,O){var S=qH(H,O);return qH(H,O)*Math.pow(2,32)+S}var wH=new Int32Array(2),oH=new Float32Array(wH.buffer),hH=new Float64Array(wH.buffer);function aH(H,O){return wH[0]=tH(H,O),oH[0]}function jH(H,O){return wH[0]=tH(H,O),wH[1]=tH(H,O),hH[0]}function eH(H,O){return HH(H,O)>0}function XH(H,O){var S,t=H[O.offset++];t<192?S=31&t:217===t?S=HH(H,O):218===t?S=SH(H,O):219===t&&(S=qH(H,O));var q=Q(H,O.offset,S);return O.offset+=S,q}function EH(H,O){var S=H[O.offset];return S<192&&S>160||217===S||218===S||219===S}function yH(H,O){var S=H[O.offset++];return S<128?S:202===S?aH(H,O):203===S?jH(H,O):204===S?HH(H,O):205===S?SH(H,O):206===S?qH(H,O):207===S?VH(H,O):208===S?L(H,O):209===S?OH(H,O):210===S?tH(H,O):211===S?UH(H,O):S>223?-1*(255-S+1):void 0}function TH(H,O){var S=H[O.offset];return S<128||S>=202&&S<=211}function KH(H,O){return H[O.offset]<160}function bH(H,O){return H[O.offset-1]===G&&(H[O.offset]<128||H[O.offset]>=202&&H[O.offset]<=211)}var DH=Object.freeze({__proto__:null,int8:L,uint8:HH,int16:OH,uint16:SH,int32:tH,uint32:qH,float32:pH,float64:GH,int64:UH,uint64:VH,readFloat32:aH,readFloat64:jH,boolean:eH,string:XH,stringCheck:EH,number:yH,numberCheck:TH,arrayCheck:KH,switchStructureCheck:bH}),FH=function(){function O(H){var O=this;this.$changes=new V(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return O.add(H)}))}return O.prototype.vU=function(O,S){return void 0===S&&(S=!0),w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,O,S?this.$items:void 0)},O.prototype.lt=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,O)},O.is=function(H){return void 0!==H.collection},O.prototype.add=function(H){var O=this.$refId++;return void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,O),this.$changes.indexes[O]=O,this.$indexes.set(O,O),this.$items.set(O,H),this.$changes.change(O),O},O.prototype.at=function(H){var O=Array.from(this.$items.keys())[H];return this.$items.get(O)},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(H){for(var O,S,t=this.$items.entries();(S=t.next())&&!S.done;)if(H===S.value[1]){O=S.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&o.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(H){return Array.from(this.$items.values()).some((function(O){return O===H}))},O.prototype.forEach=function(H){var O=this;this.$items.forEach((function(S,t,q){return H(S,t,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(H,O){this.$indexes.set(H,O)},O.prototype.getIndex=function(H){return this.$indexes.get(H)},O.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},O.prototype.deleteByIndex=function(H){var O=this.$indexes.get(H);this.$items.delete(O),this.$indexes.delete(H)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var H=[];return this.forEach((function(O,S){H.push("function"===typeof O.toJSON?O.toJSON():O)})),H},O.prototype.clone=function(H){var S;return H?S=Object.assign(new O,this):(S=new O,this.forEach((function(H){H.$changes?S.add(H.clone()):S.add(H)}))),S},O}(),YH=function(){function O(H){var O=this;this.$changes=new V(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,H&&H.forEach((function(H){return O.add(H)}))}return O.prototype.vU=function(O,S){return void 0===S&&(S=!0),w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.ADD,O,S?this.$items:void 0)},O.prototype.lt=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,O)},O.prototype.onChange=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,O)},O.is=function(H){return void 0!==H.set},O.prototype.add=function(O){var S,t;if(this.has(O))return!1;var q=this.$refId++;void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,q);var p=null!==(t=null===(S=this.$changes.indexes[q])||void 0===S?void 0:S.op)&&void 0!==t?t:H.OPERATION.ADD;return this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,O),this.$changes.change(q,p),q},O.prototype.entries=function(){return this.$items.entries()},O.prototype.delete=function(H){for(var O,S,t=this.$items.entries();(S=t.next())&&!S.done;)if(H===S.value[1]){O=S.value[0];break}return void 0!==O&&(this.$changes.delete(O),this.$indexes.delete(O),this.$items.delete(O))},O.prototype.clear=function(O){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),O&&o.call(this,O),this.$items.clear(),this.$changes.operation({index:0,op:H.OPERATION.CLEAR}),this.$changes.touchParents()},O.prototype.has=function(H){for(var O,S=this.$items.values(),t=!1;(O=S.next())&&!O.done;)if(H===O.value){t=!0;break}return t},O.prototype.forEach=function(H){var O=this;this.$items.forEach((function(S,t,q){return H(S,t,O)}))},O.prototype.values=function(){return this.$items.values()},Object.defineProperty(O.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),O.prototype.setIndex=function(H,O){this.$indexes.set(H,O)},O.prototype.getIndex=function(H){return this.$indexes.get(H)},O.prototype.getByIndex=function(H){return this.$items.get(this.$indexes.get(H))},O.prototype.deleteByIndex=function(H){var O=this.$indexes.get(H);this.$items.delete(O),this.$indexes.delete(H)},O.prototype.toArray=function(){return Array.from(this.$items.values())},O.prototype.toJSON=function(){var H=[];return this.forEach((function(O,S){H.push("function"===typeof O.toJSON?O.toJSON():O)})),H},O.prototype.clone=function(H){var S;return H?S=Object.assign(new O,this):(S=new O,this.forEach((function(H){H.$changes?S.add(H.clone()):S.add(H)}))),S},O}(),lH=function(){function H(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return H.prototype.addRefId=function(H){this.refIds.has(H)||(this.refIds.add(H),this.containerIndexes.set(H,new Set))},H.get=function(O){return void 0===O.$filterState&&(O.$filterState=new H),O.$filterState},H}(),dH=function(){function H(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return H.prototype.getNextUniqueId=function(){return this.nextUniqueId++},H.prototype.addRef=function(H,O,S){void 0===S&&(S=!0),this.refs.set(H,O),S&&(this.refCounts[H]=(this.refCounts[H]||0)+1)},H.prototype.removeRef=function(H){this.refCounts[H]=this.refCounts[H]-1,this.deletedRefs.add(H)},H.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},H.prototype.garbageCollectDeletedRefs=function(){var H=this;this.deletedRefs.forEach((function(O){if(!(H.refCounts[O]>0)){var S=H.refs.get(O);if(S instanceof gH)for(var t in S._definition.schema)"string"!==typeof S._definition.schema[t]&&S[t]&&S[t].$changes&&H.removeRef(S[t].$changes.refId);else{var q=S.$changes.parent._definition,p=q.schema[q.fieldsByIndex[S.$changes.parentIndex]];"function"===typeof Object.values(p)[0]&&Array.from(S.values()).forEach((function(O){return H.removeRef(O.$changes.refId)}))}H.refs.delete(O),delete H.refCounts[O]}})),this.deletedRefs.clear()},H}(),vH=function(H){function O(){return null!==H&&H.apply(this,arguments)||this}return S(O,H),O}(Error);function zH(H,O,S,t){var q,p=!1;switch(O){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":q="number",isNaN(H)&&console.log('trying to encode "NaN" in '.concat(S.constructor.name,"#").concat(t));break;case"string":q="string",p=!0;break;case"boolean":return}if(typeof H!==q&&(!p||p&&null!==H)){var G="'".concat(JSON.stringify(H),"'").concat(H&&H.constructor&&" (".concat(H.constructor.name,")")||"");throw new vH("a '".concat(q,"' was expected, but ").concat(G," was provided in ").concat(S.constructor.name,"#").concat(t))}}function mH(H,O,S,t){if(!(H instanceof O))throw new vH("a '".concat(O.name,"' was expected, but '").concat(H.constructor.name,"' was provided in ").concat(S.constructor.name,"#").concat(t))}function rH(H,O,S,t,q){zH(S,H,t,q);var p=n[H];if(!p)throw new vH("a '".concat(H,"' was expected, but ").concat(S," was provided in ").concat(t.constructor.name,"#").concat(q));p(O,S)}function WH(H,O,S){return DH[H](O,S)}var gH=function(){function O(){for(var H=[],O=0;O<arguments.length;O++)H[O]=arguments[O];Object.defineProperties(this,{$changes:{value:new V(this,void 0,new dH),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var S=this._definition.descriptors;S&&Object.defineProperties(this,S),H[0]&&this.assign(H[0])}return O.onError=function(H){console.error(H)},O.is=function(H){return H._definition&&void 0!==H._definition.schema},O.prototype.onChange=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.REPLACE,O)},O.prototype.lt=function(O){return w(this.$callbacks||(this.$callbacks=[]),H.OPERATION.DELETE,O)},O.prototype.assign=function(H){return Object.assign(this,H),this},Object.defineProperty(O.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),O.prototype.setDirty=function(H,O){this.$changes.change(H,O)},O.prototype.listen=function(H,O,S){var t=this;return void 0===S&&(S=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[H]||(this.$callbacks[H]=[]),this.$callbacks[H].push(O),S&&void 0!==this[H]&&O(this[H],void 0),function(){return h(t.$callbacks[H],t.$callbacks[H].indexOf(O))}},O.prototype.decode=function(S,t,q){var p;void 0===t&&(t={offset:0}),void 0===q&&(q=this);var U=[],V=this.$changes.root,w=S.length,o=0;for(V.refs.set(o,this);t.offset<w;){var h=S[t.offset++];if(h!=G){var a=q.$changes,j=void 0!==q._definition,X=j?h>>6<<6:h;if(X!==H.OPERATION.CLEAR){var y=j?h%(X||255):yH(S,t),T=j?q._definition.fieldsByIndex[y]:"",b=a.getType(y),D=void 0,F=void 0,Y=void 0;if(j?F=q["_".concat(T)]:(F=q.getByIndex(y),(X&H.OPERATION.ADD)===H.OPERATION.ADD?(Y=q instanceof E?XH(S,t):y,q.setIndex(y,Y)):Y=q.getIndex(y)),(X&H.OPERATION.DELETE)===H.OPERATION.DELETE&&(X!==H.OPERATION.DELETE_AND_ADD&&q.deleteByIndex(y),F&&F.$changes&&V.removeRef(F.$changes.refId),D=null),void 0!==T){if(X===H.OPERATION.DELETE);else if(O.is(b)){var l=yH(S,t);if(D=V.refs.get(l),X!==H.OPERATION.REPLACE){var d=this.getSchemaType(S,t,b);D||((D=this.createTypeInstance(d)).$changes.refId=l,F&&(D.$callbacks=F.$callbacks,F.$changes.refId&&l!==F.$changes.refId&&V.removeRef(F.$changes.refId))),V.addRef(l,D,D!==F)}}else if("string"===typeof b)D=WH(b,S,t);else{var v=K(Object.keys(b)[0]),z=yH(S,t),m=V.refs.has(z)?F||V.refs.get(z):new v.constructor;if((D=m.clone(!0)).$changes.refId=z,F&&(D.$callbacks=F.$callbacks,F.$changes.refId&&z!==F.$changes.refId)){V.removeRef(F.$changes.refId);for(var r=F.entries(),W=void 0;(W=r.next())&&!W.done;){var g=(p=W.value)[0],N=p[1];U.push({refId:z,op:H.OPERATION.DELETE,field:g,value:void 0,previousValue:N})}}V.addRef(z,D,m!==F)}if(null!==D&&void 0!==D)if(D.$changes&&D.$changes.setParent(a.ref,a.root,y),q instanceof O)q[T]=D;else if(q instanceof E)g=Y,q.$items.set(g,D),q.$changes.allChanges.add(y);else if(q instanceof e)q.setAt(y,D);else if(q instanceof FH){var x=q.add(D);q.setIndex(y,x)}else q instanceof YH&&!1!==(x=q.add(D))&&q.setIndex(y,x);F!==D&&U.push({refId:o,op:X,field:T,dynamicIndex:Y,value:D,previousValue:F})}else{console.warn("@colyseus/schema: definition mismatch");for(var k={offset:t.offset};t.offset<w&&(!bH(S,t)||(k.offset=t.offset+1,!V.refs.has(yH(S,k))));)t.offset++}}else q.clear(U)}else{o=yH(S,t);var A=V.refs.get(o);if(!A)throw new Error('"refId" not found: '.concat(o));q=A}}return this._triggerChanges(U),V.garbageCollectDeletedRefs(),U},O.prototype.encode=function(S,t,q){void 0===S&&(S=!1),void 0===t&&(t=[]),void 0===q&&(q=!1);for(var p=this.$changes,U=new WeakSet,V=[p],w=1,o=0;o<w;o++){var h=V[o],a=h.ref,j=a instanceof O;h.ensureRefId(),U.add(h),h!==p&&(h.changed||S)&&(N(t,G),C(t,h.refId));for(var e=S?Array.from(h.allChanges):Array.from(h.changes.values()),X=0,y=e.length;X<y;X++){var T=S?{op:H.OPERATION.ADD,index:e[X]}:e[X],b=T.index,D=j?a._definition.fieldsByIndex&&a._definition.fieldsByIndex[b]:b,F=t.length;if(T.op!==H.OPERATION.TOUCH)if(j)N(t,b|T.op);else{if(N(t,T.op),T.op===H.OPERATION.CLEAR)continue;C(t,b)}if(j||(T.op&H.OPERATION.ADD)!=H.OPERATION.ADD||a instanceof E&&M(t,h.ref.$indexes.get(b)),T.op!==H.OPERATION.DELETE){var Y=h.getType(b),l=h.getValue(b);if(l&&l.$changes&&!U.has(l.$changes)&&(V.push(l.$changes),l.$changes.ensureRefId(),w++),T.op!==H.OPERATION.TOUCH){if(O.is(Y))mH(l,Y,a,D),C(t,l.$changes.refId),(T.op&H.OPERATION.ADD)===H.OPERATION.ADD&&this.tryEncodeTypeId(t,Y,l.constructor);else if("string"===typeof Y)rH(Y,t,l,a,D);else{var d=K(Object.keys(Y)[0]);mH(a["_".concat(D)],d.constructor,a,D),C(t,l.$changes.refId)}q&&h.cache(b,t.slice(F))}}}S||q||h.discard()}return t},O.prototype.encodeAll=function(H){return this.encode(!0,[],H)},O.prototype.applyFilters=function(S,t){var q,p;void 0===t&&(t=!1);for(var U=this,V=new Set,w=lH.get(S),o=[this.$changes],h=1,a=[],j=function(j){var e=o[j];if(V.has(e.refId))return"continue";var X=e.ref,y=X instanceof O;N(a,G),C(a,e.refId);var T=w.refIds.has(e),K=t||!T;w.addRefId(e);var b=w.containerIndexes.get(e),D=K?Array.from(e.allChanges):Array.from(e.changes.values());!t&&y&&X._definition.indexesWithFilters&&X._definition.indexesWithFilters.forEach((function(O){!b.has(O)&&e.allChanges.has(O)&&(K?D.push(O):D.push({op:H.OPERATION.ADD,index:O}))}));for(var F=0,Y=D.length;F<Y;F++){var l=K?{op:H.OPERATION.ADD,index:D[F]}:D[F];if(l.op!==H.OPERATION.CLEAR){var d=l.index;if(l.op!==H.OPERATION.DELETE){var v=e.getValue(d),z=e.getType(d);if(y){if((m=X._definition.filters&&X._definition.filters[d])&&!m.call(X,S,v,U)){v&&v.$changes&&V.add(v.$changes.refId);continue}}else{var m,r=e.parent;if((m=e.getChildrenFilter())&&!m.call(r,S,X.$indexes.get(d),v,U)){v&&v.$changes&&V.add(v.$changes.refId);continue}}if(v.$changes&&(o.push(v.$changes),h++),l.op!==H.OPERATION.TOUCH)if(l.op===H.OPERATION.ADD||y)a.push.apply(a,null!==(q=e.caches[d])&&void 0!==q?q:[]),b.add(d);else if(b.has(d))a.push.apply(a,null!==(p=e.caches[d])&&void 0!==p?p:[]);else{if(b.add(d),N(a,H.OPERATION.ADD),C(a,d),X instanceof E){var W=e.ref.$indexes.get(d);M(a,W)}v.$changes?C(a,v.$changes.refId):n[z](a,v)}else v.$changes&&!y&&(N(a,H.OPERATION.ADD),C(a,d),X instanceof E&&(W=e.ref.$indexes.get(d),M(a,W)),C(a,v.$changes.refId))}else y?N(a,l.op|d):(N(a,l.op),C(a,d))}else N(a,l.op)}},e=0;e<h;e++)j(e);return a},O.prototype.clone=function(){var H,O=new this.constructor,S=this._definition.schema;for(var t in S)"object"===typeof this[t]&&"function"===typeof(null===(H=this[t])||void 0===H?void 0:H.clone)?O[t]=this[t].clone():O[t]=this[t];return O},O.prototype.toJSON=function(){var H=this._definition.schema,O=this._definition.deprecated,S={};for(var t in H)O[t]||null===this[t]||"undefined"===typeof this[t]||(S[t]="function"===typeof this[t].toJSON?this[t].toJSON():this["_".concat(t)]);return S},O.prototype.discardAllChanges=function(){this.$changes.discardAll()},O.prototype.getByIndex=function(H){return this[this._definition.fieldsByIndex[H]]},O.prototype.deleteByIndex=function(H){this[this._definition.fieldsByIndex[H]]=void 0},O.prototype.tryEncodeTypeId=function(H,O,S){O._typeid!==S._typeid&&(N(H,U),C(H,S._typeid))},O.prototype.getSchemaType=function(H,O,S){var t;return H[O.offset]===U&&(O.offset++,t=this.constructor._context.get(yH(H,O))),t||S},O.prototype.createTypeInstance=function(H){var O=new H;return O.$changes.root=this.$changes.root,O},O.prototype._triggerChanges=function(S){for(var t,q,p,G,U,V,w,o,h,a=new Set,j=this.$changes.root.refs,e=function(e){var X=S[e],E=X.refId,y=j.get(E),T=y.$callbacks;if((X.op&H.OPERATION.DELETE)===H.OPERATION.DELETE&&X.previousValue instanceof O&&(null===(q=null===(t=X.previousValue.$callbacks)||void 0===t?void 0:t[H.OPERATION.DELETE])||void 0===q||q.forEach((function(H){return H()}))),!T)return"continue";if(y instanceof O){if(!a.has(E))try{null===(p=null===T||void 0===T?void 0:T[H.OPERATION.REPLACE])||void 0===p||p.forEach((function(H){return H()}))}catch(K){O.onError(K)}try{T.hasOwnProperty(X.field)&&(null===(G=T[X.field])||void 0===G||G.forEach((function(H){return H(X.value,X.previousValue)})))}catch(K){O.onError(K)}}else X.op===H.OPERATION.ADD&&void 0===X.previousValue?null===(U=T[H.OPERATION.ADD])||void 0===U||U.forEach((function(H){var O;return H(X.value,null!==(O=X.dynamicIndex)&&void 0!==O?O:X.field)})):X.op===H.OPERATION.DELETE?void 0!==X.previousValue&&(null===(V=T[H.OPERATION.DELETE])||void 0===V||V.forEach((function(H){var O;return H(X.previousValue,null!==(O=X.dynamicIndex)&&void 0!==O?O:X.field)}))):X.op===H.OPERATION.DELETE_AND_ADD&&(void 0!==X.previousValue&&(null===(w=T[H.OPERATION.DELETE])||void 0===w||w.forEach((function(H){var O;return H(X.previousValue,null!==(O=X.dynamicIndex)&&void 0!==O?O:X.field)}))),null===(o=T[H.OPERATION.ADD])||void 0===o||o.forEach((function(H){var O;return H(X.value,null!==(O=X.dynamicIndex)&&void 0!==O?O:X.field)}))),X.value!==X.previousValue&&(null===(h=T[H.OPERATION.REPLACE])||void 0===h||h.forEach((function(H){var O;return H(X.value,null!==(O=X.dynamicIndex)&&void 0!==O?O:X.field)})));a.add(E)},X=0;X<S.length;X++)e(X)},O._definition=b.create(),O}();function NH(H){for(var O=[H.$changes],S=1,t={},q=t,p=function(H){var S=O[H];S.changes.forEach((function(H){var O=S.ref,t=H.index,p=O._definition?O._definition.fieldsByIndex[t]:O.$indexes.get(t);q[p]=S.getValue(t)}))},G=0;G<S;G++)p(G);return t}var xH={context:new F},kH=function(H){function O(){return null!==H&&H.apply(this,arguments)||this}return S(O,H),t([l("string",xH)],O.prototype,"name",void 0),t([l("string",xH)],O.prototype,"type",void 0),t([l("number",xH)],O.prototype,"referencedType",void 0),O}(gH),AH=function(H){function O(){var O=null!==H&&H.apply(this,arguments)||this;return O.fields=new e,O}return S(O,H),t([l("number",xH)],O.prototype,"id",void 0),t([l([kH],xH)],O.prototype,"fields",void 0),O}(gH),uH=function(H){function O(){var O=null!==H&&H.apply(this,arguments)||this;return O.types=new e,O}return S(O,H),O.encode=function(H){var S=H.constructor,t=new O;t.rootType=S._typeid;var q=function(H,O){for(var S in O){var q=new kH;q.name=S;var p=void 0;if("string"===typeof O[S])p=O[S];else{var G=O[S],U=void 0;gH.is(G)?(p="ref",U=O[S]):"string"===typeof G[p=Object.keys(G)[0]]?p+=":"+G[p]:U=G[p],q.referencedType=U?U._typeid:-1}q.type=p,H.fields.push(q)}t.types.push(H)},p=S._context.types;for(var G in p){var U=new AH;U.id=Number(G),q(U,p[G]._definition.schema)}return t.encodeAll()},O.decode=function(H,t){var q=new F,p=new O;p.decode(H,t);var G=p.types.reduce((function(H,O){var t=function(H){function O(){return null!==H&&H.apply(this,arguments)||this}return S(O,H),O}(gH),p=O.id;return H[p]=t,q.add(t,p),H}),{});p.types.forEach((function(H){var O=G[H.id];H.fields.forEach((function(H){var S;if(void 0!==H.referencedType){var t=H.type,p=G[H.referencedType];if(!p){var U=H.type.split(":");t=U[0],p=U[1]}"ref"===t?l(p,{context:q})(O.prototype,H.name):l(((S={})[t]=p,S),{context:q})(O.prototype,H.name)}else l(H.type,{context:q})(O.prototype,H.name)}))}));var U=G[p.rootType],V=new U;for(var w in U._definition.schema){var o=U._definition.schema[w];"string"!==typeof o&&(V[w]="function"===typeof o?new o:new(K(Object.keys(o)[0]).constructor))}return V},t([l([AH],xH)],O.prototype,"types",void 0),t([l("number",xH)],O.prototype,"rootType",void 0),O}(gH);T("map",{constructor:E}),T("array",{constructor:e}),T("set",{constructor:YH}),T("collection",{constructor:FH}),H.ArraySchema=e,H.CollectionSchema=FH,H.Context=F,H.MapSchema=E,H.Reflection=uH,H.ReflectionField=kH,H.ReflectionType=AH,H.Schema=gH,H.SchemaDefinition=b,H.SetSchema=YH,H.decode=DH,H.defineTypes=m,H.deprecated=z,H.dumpChanges=NH,H.encode=n,H.filter=d,H.filterChildren=v,H.hasFilter=D,H.registerType=T,H.type=l,Object.defineProperty(H,"__esModule",{value:!0})}(O)},13437:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13429:(H,O,S)=>{var t=S(13437),q=S(13442),p=Object.hasOwnProperty,G=Object.create(null);for(var U in t)p.call(t,U)&&(G[t[U]]=U);var V=H.exports={to:{},get:{}};function w(H,O,S){return Math.min(Math.max(O,H),S)}function o(H){var O=Math.round(H).toString(16).toUpperCase();return O.length<2?"0"+O:O}V.get=function(H){var O,S;switch(H.substring(0,3).toLowerCase()){case"hsl":O=V.get.hsl(H),S="hsl";break;case"hwb":O=V.get.hwb(H),S="hwb";break;default:O=V.get.rgb(H),S="rgb"}return O?{model:S,value:O}:null},V.get.rgb=function(H){if(!H)return null;var O,S,q,G=[0,0,0,1];if(O=H.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(q=O[2],O=O[1],S=0;S<3;S++){var U=2*S;G[S]=parseInt(O.slice(U,U+2),16)}q&&(G[3]=parseInt(q,16)/255)}else if(O=H.match(/^#([a-f0-9]{3,4})$/i)){for(q=(O=O[1])[3],S=0;S<3;S++)G[S]=parseInt(O[S]+O[S],16);q&&(G[3]=parseInt(q+q,16)/255)}else if(O=H.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(S=0;S<3;S++)G[S]=parseInt(O[S+1],0);O[4]&&(O[5]?G[3]=.01*parseFloat(O[4]):G[3]=parseFloat(O[4]))}else{if(!(O=H.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(O=H.match(/^(\w+)$/))?"transparent"===O[1]?[0,0,0,0]:p.call(t,O[1])?((G=t[O[1]])[3]=1,G):null:null;for(S=0;S<3;S++)G[S]=Math.round(2.55*parseFloat(O[S+1]));O[4]&&(O[5]?G[3]=.01*parseFloat(O[4]):G[3]=parseFloat(O[4]))}for(S=0;S<3;S++)G[S]=w(G[S],0,255);return G[3]=w(G[3],0,1),G},V.get.hsl=function(H){if(!H)return null;var O=H.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var S=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,w(parseFloat(O[2]),0,100),w(parseFloat(O[3]),0,100),w(isNaN(S)?1:S,0,1)]}return null},V.get.hwb=function(H){if(!H)return null;var O=H.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(O){var S=parseFloat(O[4]);return[(parseFloat(O[1])%360+360)%360,w(parseFloat(O[2]),0,100),w(parseFloat(O[3]),0,100),w(isNaN(S)?1:S,0,1)]}return null},V.to.hex=function(){var H=q(arguments);return"#"+o(H[0])+o(H[1])+o(H[2])+(H[3]<1?o(Math.round(255*H[3])):"")},V.to.rgb=function(){var H=q(arguments);return H.length<4||1===H[3]?"rgb("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+")":"rgba("+Math.round(H[0])+", "+Math.round(H[1])+", "+Math.round(H[2])+", "+H[3]+")"},V.to.rgb.percent=function(){var H=q(arguments),O=Math.round(H[0]/255*100),S=Math.round(H[1]/255*100),t=Math.round(H[2]/255*100);return H.length<4||1===H[3]?"rgb("+O+"%, "+S+"%, "+t+"%)":"rgba("+O+"%, "+S+"%, "+t+"%, "+H[3]+")"},V.to.hsl=function(){var H=q(arguments);return H.length<4||1===H[3]?"hsl("+H[0]+", "+H[1]+"%, "+H[2]+"%)":"hsla("+H[0]+", "+H[1]+"%, "+H[2]+"%, "+H[3]+")"},V.to.hwb=function(){var H=q(arguments),O="";return H.length>=4&&1!==H[3]&&(O=", "+H[3]),"hwb("+H[0]+", "+H[1]+"%, "+H[2]+"%"+O+")"},V.to.keyword=function(H){return G[H.slice(0,3)]}},13424:(H,O,S)=>{const t=S(13429),q=S(13450),p=["keyword","gray","hex"],G={};for(const j of Object.keys(q))G[[...q[j].labels].sort().join("")]=j;const U={};function V(H,O){if(!(this instanceof V))return new V(H,O);if(O&&O in p&&(O=null),O&&!(O in q))throw new Error("Unknown model: "+O);let S,w;if(null==H)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(H instanceof V)this.model=H.model,this.color=[...H.color],this.valpha=H.valpha;else if("string"===typeof H){const O=t.get(H);if(null===O)throw new Error("Unable to parse color from string: "+H);this.model=O.model,w=q[this.model].channels,this.color=O.value.slice(0,w),this.valpha="number"===typeof O.value[w]?O.value[w]:1}else if(H.length>0){this.model=O||"rgb",w=q[this.model].channels;const S=Array.prototype.slice.call(H,0,w);this.color=a(S,w),this.valpha="number"===typeof H[w]?H[w]:1}else if("number"===typeof H)this.model="rgb",this.color=[H>>16&255,H>>8&255,255&H],this.valpha=1;else{this.valpha=1;const O=Object.keys(H);"alpha"in H&&(O.splice(O.indexOf("alpha"),1),this.valpha="number"===typeof H.alpha?H.alpha:0);const t=O.sort().join("");if(!(t in G))throw new Error("Unable to parse color from object: "+JSON.stringify(H));this.model=G[t];const{labels:p}=q[this.model],U=[];for(S=0;S<p.length;S++)U.push(H[p[S]]);this.color=a(U)}if(U[this.model])for(w=q[this.model].channels,S=0;S<w;S++){const H=U[this.model][S];H&&(this.color[S]=H(this.color[S]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}V.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(H){let O=this.model in t.to?this:this.rgb();O=O.round("number"===typeof H?H:1);const S=1===O.valpha?O.color:[...O.color,this.valpha];return t.to[O.model](S)},percentString(H){const O=this.rgb().round("number"===typeof H?H:1),S=1===O.valpha?O.color:[...O.color,this.valpha];return t.to.rgb.percent(S)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const H={},{channels:O}=q[this.model],{labels:S}=q[this.model];for(let t=0;t<O;t++)H[S[t]]=this.color[t];return 1!==this.valpha&&(H.alpha=this.valpha),H},unitArray(){const H=this.rgb().color;return H[0]/=255,H[1]/=255,H[2]/=255,1!==this.valpha&&H.push(this.valpha),H},unitObject(){const H=this.rgb().object();return H.r/=255,H.g/=255,H.b/=255,1!==this.valpha&&(H.alpha=this.valpha),H},round(H){return H=Math.max(H||0,0),new V([...this.color.map(w(H)),this.valpha],this.model)},alpha(H){return void 0!==H?new V([...this.color,Math.max(0,Math.min(1,H))],this.model):this.valpha},red:o("rgb",0,h(255)),green:o("rgb",1,h(255)),blue:o("rgb",2,h(255)),hue:o(["hsl","hsv","hsl","hwb","hcg"],0,(H=>(H%360+360)%360)),saturationl:o("hsl",1,h(100)),lightness:o("hsl",2,h(100)),saturationv:o("hsv",1,h(100)),value:o("hsv",2,h(100)),chroma:o("hcg",1,h(100)),gray:o("hcg",2,h(100)),white:o("hwb",1,h(100)),wblack:o("hwb",2,h(100)),cyan:o("cmyk",0,h(100)),magenta:o("cmyk",1,h(100)),yellow:o("cmyk",2,h(100)),black:o("cmyk",3,h(100)),x:o("xyz",0,h(95.047)),y:o("xyz",1,h(100)),z:o("xyz",2,h(108.833)),l:o("lab",0,h(100)),a:o("lab",1),b:o("lab",2),keyword(H){return void 0!==H?new V(H):q[this.model].keyword(this.color)},hex(H){return void 0!==H?new V(H):t.to.hex(this.rgb().round().color)},hexa(H){if(void 0!==H)return new V(H);const O=this.rgb().round().color;let S=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===S.length&&(S="0"+S),t.to.hex(O)+S},rgbNumber(){const H=this.rgb().color;return(255&H[0])<<16|(255&H[1])<<8|255&H[2]},luminosity(){const H=this.rgb().color,O=[];for(const[S,t]of H.entries()){const H=t/255;O[S]=H<=.04045?H/12.92:((H+.055)/1.055)**2.4}return.2126*O[0]+.7152*O[1]+.0722*O[2]},contrast(H){const O=this.luminosity(),S=H.luminosity();return O>S?(O+.05)/(S+.05):(S+.05)/(O+.05)},level(H){const O=this.contrast(H);return O>=7?"AAA":O>=4.5?"AA":""},isDark(){const H=this.rgb().color;return(2126*H[0]+7152*H[1]+722*H[2])/1e4<128},isLight(){return!this.isDark()},negate(){const H=this.rgb();for(let O=0;O<3;O++)H.color[O]=255-H.color[O];return H},lighten(H){const O=this.hsl();return O.color[2]+=O.color[2]*H,O},darken(H){const O=this.hsl();return O.color[2]-=O.color[2]*H,O},saturate(H){const O=this.hsl();return O.color[1]+=O.color[1]*H,O},desaturate(H){const O=this.hsl();return O.color[1]-=O.color[1]*H,O},whiten(H){const O=this.hwb();return O.color[1]+=O.color[1]*H,O},blacken(H){const O=this.hwb();return O.color[2]+=O.color[2]*H,O},grayscale(){const H=this.rgb().color,O=.3*H[0]+.59*H[1]+.11*H[2];return V.rgb(O,O,O)},fade(H){return this.alpha(this.valpha-this.valpha*H)},opaquer(H){return this.alpha(this.valpha+this.valpha*H)},rotate(H){const O=this.hsl();let S=O.color[0];return S=(S+H)%360,S=S<0?360+S:S,O.color[0]=S,O},mix(H,O){if(!H||!H.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof H);const S=H.rgb(),t=this.rgb(),q=void 0===O?.5:O,p=2*q-1,G=S.alpha()-t.alpha(),U=((p*G===-1?p:(p+G)/(1+p*G))+1)/2,w=1-U;return V.rgb(U*S.red()+w*t.red(),U*S.green()+w*t.green(),U*S.blue()+w*t.blue(),S.alpha()*q+t.alpha()*(1-q))}};for(const j of Object.keys(q)){if(p.includes(j))continue;const{channels:H}=q[j];V.prototype[j]=function(){if(this.model===j)return new V(this);for(var H=arguments.length,O=new Array(H),S=0;S<H;S++)O[S]=arguments[S];return O.length>0?new V(O,j):new V([...(t=q[this.model][j].raw(this.color),Array.isArray(t)?t:[t]),this.valpha],j);var t},V[j]=function(){for(var O=arguments.length,S=new Array(O),t=0;t<O;t++)S[t]=arguments[t];let q=S[0];return"number"===typeof q&&(q=a(S,H)),new V(q,j)}}function w(H){return function(O){return function(H,O){return Number(H.toFixed(O))}(O,H)}}function o(H,O,S){H=Array.isArray(H)?H:[H];for(const t of H)(U[t]||(U[t]=[]))[O]=S;return H=H[0],function(t){let q;return void 0!==t?(S&&(t=S(t)),q=this[H](),q.color[O]=t,q):(q=this[H]().color[O],S&&(q=S(q)),q)}}function h(H){return function(O){return Math.max(0,Math.min(H,O))}}function a(H,O){for(let S=0;S<O;S++)"number"!==typeof H[S]&&(H[S]=0);return H}H.exports=V},13452:(H,O,S)=>{const t=S(13454),q={};for(const G of Object.keys(t))q[t[G]]=G;const p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};H.exports=p;for(const G of Object.keys(p)){if(!("channels"in p[G]))throw new Error("missing channels property: "+G);if(!("labels"in p[G]))throw new Error("missing channel labels property: "+G);if(p[G].labels.length!==p[G].channels)throw new Error("channel and label counts mismatch: "+G);const{channels:H,labels:O}=p[G];delete p[G].channels,delete p[G].labels,Object.defineProperty(p[G],"channels",{value:H}),Object.defineProperty(p[G],"labels",{value:O})}p.rgb.hsl=function(H){const O=H[0]/255,S=H[1]/255,t=H[2]/255,q=Math.min(O,S,t),p=Math.max(O,S,t),G=p-q;let U,V;p===q?U=0:O===p?U=(S-t)/G:S===p?U=2+(t-O)/G:t===p&&(U=4+(O-S)/G),U=Math.min(60*U,360),U<0&&(U+=360);const w=(q+p)/2;return V=p===q?0:w<=.5?G/(p+q):G/(2-p-q),[U,100*V,100*w]},p.rgb.hsv=function(H){let O,S,t,q,p;const G=H[0]/255,U=H[1]/255,V=H[2]/255,w=Math.max(G,U,V),o=w-Math.min(G,U,V),h=function(H){return(w-H)/6/o+.5};return 0===o?(q=0,p=0):(p=o/w,O=h(G),S=h(U),t=h(V),G===w?q=t-S:U===w?q=1/3+O-t:V===w&&(q=2/3+S-O),q<0?q+=1:q>1&&(q-=1)),[360*q,100*p,100*w]},p.rgb.hwb=function(H){const O=H[0],S=H[1];let t=H[2];const q=p.rgb.hsl(H)[0],G=1/255*Math.min(O,Math.min(S,t));return t=1-1/255*Math.max(O,Math.max(S,t)),[q,100*G,100*t]},p.rgb.cmyk=function(H){const O=H[0]/255,S=H[1]/255,t=H[2]/255,q=Math.min(1-O,1-S,1-t);return[100*((1-O-q)/(1-q)||0),100*((1-S-q)/(1-q)||0),100*((1-t-q)/(1-q)||0),100*q]},p.rgb.keyword=function(H){const O=q[H];if(O)return O;let S,p=1/0;for(const q of Object.keys(t)){const O=t[q],V=(U=O,((G=H)[0]-U[0])**2+(G[1]-U[1])**2+(G[2]-U[2])**2);V<p&&(p=V,S=q)}var G,U;return S},p.keyword.rgb=function(H){return t[H]},p.rgb.xyz=function(H){let O=H[0]/255,S=H[1]/255,t=H[2]/255;O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92;return[100*(.4124*O+.3576*S+.1805*t),100*(.2126*O+.7152*S+.0722*t),100*(.0193*O+.1192*S+.9505*t)]},p.rgb.lab=function(H){const O=p.rgb.xyz(H);let S=O[0],t=O[1],q=O[2];S/=95.047,t/=100,q/=108.883,S=S>.008856?S**(1/3):7.787*S+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*t-16,500*(S-t),200*(t-q)]},p.hsl.rgb=function(H){const O=H[0]/360,S=H[1]/100,t=H[2]/100;let q,p,G;if(0===S)return G=255*t,[G,G,G];q=t<.5?t*(1+S):t+S-t*S;const U=2*t-q,V=[0,0,0];for(let w=0;w<3;w++)p=O+1/3*-(w-1),p<0&&p++,p>1&&p--,G=6*p<1?U+6*(q-U)*p:2*p<1?q:3*p<2?U+(q-U)*(2/3-p)*6:U,V[w]=255*G;return V},p.hsl.hsv=function(H){const O=H[0];let S=H[1]/100,t=H[2]/100,q=S;const p=Math.max(t,.01);t*=2,S*=t<=1?t:2-t,q*=p<=1?p:2-p;return[O,100*(0===t?2*q/(p+q):2*S/(t+S)),100*((t+S)/2)]},p.hsv.rgb=function(H){const O=H[0]/60,S=H[1]/100;let t=H[2]/100;const q=Math.floor(O)%6,p=O-Math.floor(O),G=255*t*(1-S),U=255*t*(1-S*p),V=255*t*(1-S*(1-p));switch(t*=255,q){case 0:return[t,V,G];case 1:return[U,t,G];case 2:return[G,t,V];case 3:return[G,U,t];case 4:return[V,G,t];case 5:return[t,G,U]}},p.hsv.hsl=function(H){const O=H[0],S=H[1]/100,t=H[2]/100,q=Math.max(t,.01);let p,G;G=(2-S)*t;const U=(2-S)*q;return p=S*q,p/=U<=1?U:2-U,p=p||0,G/=2,[O,100*p,100*G]},p.hwb.rgb=function(H){const O=H[0]/360;let S=H[1]/100,t=H[2]/100;const q=S+t;let p;q>1&&(S/=q,t/=q);const G=Math.floor(6*O),U=1-t;p=6*O-G,0!==(1&G)&&(p=1-p);const V=S+p*(U-S);let w,o,h;switch(G){default:case 6:case 0:w=U,o=V,h=S;break;case 1:w=V,o=U,h=S;break;case 2:w=S,o=U,h=V;break;case 3:w=S,o=V,h=U;break;case 4:w=V,o=S,h=U;break;case 5:w=U,o=S,h=V}return[255*w,255*o,255*h]},p.cmyk.rgb=function(H){const O=H[0]/100,S=H[1]/100,t=H[2]/100,q=H[3]/100;return[255*(1-Math.min(1,O*(1-q)+q)),255*(1-Math.min(1,S*(1-q)+q)),255*(1-Math.min(1,t*(1-q)+q))]},p.xyz.rgb=function(H){const O=H[0]/100,S=H[1]/100,t=H[2]/100;let q,p,G;return q=3.2406*O+-1.5372*S+-.4986*t,p=-.9689*O+1.8758*S+.0415*t,G=.0557*O+-.204*S+1.057*t,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,q=Math.min(Math.max(0,q),1),p=Math.min(Math.max(0,p),1),G=Math.min(Math.max(0,G),1),[255*q,255*p,255*G]},p.xyz.lab=function(H){let O=H[0],S=H[1],t=H[2];O/=95.047,S/=100,t/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*S-16,500*(O-S),200*(S-t)]},p.lab.xyz=function(H){let O,S,t;S=(H[0]+16)/116,O=H[1]/500+S,t=S-H[2]/200;const q=S**3,p=O**3,G=t**3;return S=q>.008856?q:(S-16/116)/7.787,O=p>.008856?p:(O-16/116)/7.787,t=G>.008856?G:(t-16/116)/7.787,O*=95.047,S*=100,t*=108.883,[O,S,t]},p.lab.lch=function(H){const O=H[0],S=H[1],t=H[2];let q;q=360*Math.atan2(t,S)/2/Math.PI,q<0&&(q+=360);return[O,Math.sqrt(S*S+t*t),q]},p.lch.lab=function(H){const O=H[0],S=H[1],t=H[2]/360*2*Math.PI;return[O,S*Math.cos(t),S*Math.sin(t)]},p.rgb.ansi16=function(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[S,t,q]=H;let G=null===O?p.rgb.hsv(H)[2]:O;if(G=Math.round(G/50),0===G)return 30;let U=30+(Math.round(q/255)<<2|Math.round(t/255)<<1|Math.round(S/255));return 2===G&&(U+=60),U},p.hsv.ansi16=function(H){return p.rgb.ansi16(p.hsv.rgb(H),H[2])},p.rgb.ansi256=function(H){const O=H[0],S=H[1],t=H[2];if(O===S&&S===t)return O<8?16:O>248?231:Math.round((O-8)/247*24)+232;return 16+36*Math.round(O/255*5)+6*Math.round(S/255*5)+Math.round(t/255*5)},p.ansi16.rgb=function(H){let O=H%10;if(0===O||7===O)return H>50&&(O+=3.5),O=O/10.5*255,[O,O,O];const S=.5*(1+~~(H>50));return[(1&O)*S*255,(O>>1&1)*S*255,(O>>2&1)*S*255]},p.ansi256.rgb=function(H){if(H>=232){const O=10*(H-232)+8;return[O,O,O]}let O;H-=16;return[Math.floor(H/36)/5*255,Math.floor((O=H%36)/6)/5*255,O%6/5*255]},p.rgb.hex=function(H){const O=(((255&Math.round(H[0]))<<16)+((255&Math.round(H[1]))<<8)+(255&Math.round(H[2]))).toString(16).toUpperCase();return"000000".substring(O.length)+O},p.hex.rgb=function(H){const O=H.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!O)return[0,0,0];let S=O[0];3===O[0].length&&(S=S.split("").map((H=>H+H)).join(""));const t=parseInt(S,16);return[t>>16&255,t>>8&255,255&t]},p.rgb.hcg=function(H){const O=H[0]/255,S=H[1]/255,t=H[2]/255,q=Math.max(Math.max(O,S),t),p=Math.min(Math.min(O,S),t),G=q-p;let U,V;return U=G<1?p/(1-G):0,V=G<=0?0:q===O?(S-t)/G%6:q===S?2+(t-O)/G:4+(O-S)/G,V/=6,V%=1,[360*V,100*G,100*U]},p.hsl.hcg=function(H){const O=H[1]/100,S=H[2]/100,t=S<.5?2*O*S:2*O*(1-S);let q=0;return t<1&&(q=(S-.5*t)/(1-t)),[H[0],100*t,100*q]},p.hsv.hcg=function(H){const O=H[1]/100,S=H[2]/100,t=O*S;let q=0;return t<1&&(q=(S-t)/(1-t)),[H[0],100*t,100*q]},p.hcg.rgb=function(H){const O=H[0]/360,S=H[1]/100,t=H[2]/100;if(0===S)return[255*t,255*t,255*t];const q=[0,0,0],p=O%1*6,G=p%1,U=1-G;let V=0;switch(Math.floor(p)){case 0:q[0]=1,q[1]=G,q[2]=0;break;case 1:q[0]=U,q[1]=1,q[2]=0;break;case 2:q[0]=0,q[1]=1,q[2]=G;break;case 3:q[0]=0,q[1]=U,q[2]=1;break;case 4:q[0]=G,q[1]=0,q[2]=1;break;default:q[0]=1,q[1]=0,q[2]=U}return V=(1-S)*t,[255*(S*q[0]+V),255*(S*q[1]+V),255*(S*q[2]+V)]},p.hcg.hsv=function(H){const O=H[1]/100,S=O+H[2]/100*(1-O);let t=0;return S>0&&(t=O/S),[H[0],100*t,100*S]},p.hcg.hsl=function(H){const O=H[1]/100,S=H[2]/100*(1-O)+.5*O;let t=0;return S>0&&S<.5?t=O/(2*S):S>=.5&&S<1&&(t=O/(2*(1-S))),[H[0],100*t,100*S]},p.hcg.hwb=function(H){const O=H[1]/100,S=O+H[2]/100*(1-O);return[H[0],100*(S-O),100*(1-S)]},p.hwb.hcg=function(H){const O=H[1]/100,S=1-H[2]/100,t=S-O;let q=0;return t<1&&(q=(S-t)/(1-t)),[H[0],100*t,100*q]},p.apple.rgb=function(H){return[H[0]/65535*255,H[1]/65535*255,H[2]/65535*255]},p.rgb.apple=function(H){return[H[0]/255*65535,H[1]/255*65535,H[2]/255*65535]},p.gray.rgb=function(H){return[H[0]/100*255,H[0]/100*255,H[0]/100*255]},p.gray.hsl=function(H){return[0,0,H[0]]},p.gray.hsv=p.gray.hsl,p.gray.hwb=function(H){return[0,100,H[0]]},p.gray.cmyk=function(H){return[0,0,0,H[0]]},p.gray.lab=function(H){return[H[0],0,0]},p.gray.hex=function(H){const O=255&Math.round(H[0]/100*255),S=((O<<16)+(O<<8)+O).toString(16).toUpperCase();return"000000".substring(S.length)+S},p.rgb.gray=function(H){return[(H[0]+H[1]+H[2])/3/255*100]}},13450:(H,O,S)=>{const t=S(13452),q=S(13457),p={};Object.keys(t).forEach((H=>{p[H]={},Object.defineProperty(p[H],"channels",{value:t[H].channels}),Object.defineProperty(p[H],"labels",{value:t[H].labels});const O=q(H);Object.keys(O).forEach((S=>{const t=O[S];p[H][S]=function(H){const O=function(){for(var O=arguments.length,S=new Array(O),t=0;t<O;t++)S[t]=arguments[t];const q=S[0];if(void 0===q||null===q)return q;q.length>1&&(S=q);const p=H(S);if("object"===typeof p)for(let H=p.length,G=0;G<H;G++)p[G]=Math.round(p[G]);return p};return"conversion"in H&&(O.conversion=H.conversion),O}(t),p[H][S].raw=function(H){const O=function(){for(var O=arguments.length,S=new Array(O),t=0;t<O;t++)S[t]=arguments[t];const q=S[0];return void 0===q||null===q?q:(q.length>1&&(S=q),H(S))};return"conversion"in H&&(O.conversion=H.conversion),O}(t)}))})),H.exports=p},13457:(H,O,S)=>{const t=S(13452);function q(H){const O=function(){const H={},O=Object.keys(t);for(let S=O.length,t=0;t<S;t++)H[O[t]]={distance:-1,parent:null};return H}(),S=[H];for(O[H].distance=0;S.length;){const H=S.pop(),q=Object.keys(t[H]);for(let t=q.length,p=0;p<t;p++){const t=q[p],G=O[t];-1===G.distance&&(G.distance=O[H].distance+1,G.parent=H,S.unshift(t))}}return O}function p(H,O){return function(S){return O(H(S))}}function G(H,O){const S=[O[H].parent,H];let q=t[O[H].parent][H],G=O[H].parent;for(;O[G].parent;)S.unshift(O[G].parent),q=p(t[O[G].parent][G],q),G=O[G].parent;return q.conversion=S,q}H.exports=function(H){const O=q(H),S={},t=Object.keys(O);for(let q=t.length,p=0;p<q;p++){const H=t[p];null!==O[H].parent&&(S[H]=G(H,O))}return S}},13454:H=>{"use strict";H.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12010:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.discordURLBuilder=void 0,O.discordURLBuilder=function(H){var O;const S=(null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||"localhost",t=H.hostname.split("."),q=!H.hostname.includes("trycloudflare.com")&&!H.hostname.includes("discordsays.com")&&t.length>2?`/${t[0]}`:"";return H.pathname.startsWith("/.proxy")?`${H.protocol}//${S}${q}${H.pathname}${H.search}`:`${H.protocol}//${S}/.proxy/colyseus${q}${H.pathname}${H.search}`}},11998:function(H,O,S){"use strict";var t,q,p,G,U=this&&this.__awaiter||function(H,O,S,t){return new(S||(S=Promise))((function(q,p){function G(H){try{V(t.next(H))}catch(O){p(O)}}function U(H){try{V(t.throw(H))}catch(O){p(O)}}function V(H){var O;H.done?q(H.value):(O=H.value,O instanceof S?O:new S((function(H){H(O)}))).then(G,U)}V((t=t.apply(H,O||[])).next())}))},V=this&&this.__classPrivateFieldGet||function(H,O,S,t){if("a"===S&&!t)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof O?H!==O||!t:!O.has(H))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===S?t:"a"===S?t.call(H):t?t.value:O.get(H)},w=this&&this.__classPrivateFieldSet||function(H,O,S,t,q){if("m"===t)throw new TypeError("Private method is not writable");if("a"===t&&!q)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof O?H!==O||!q:!O.has(H))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===t?q.call(H,S):q?q.value=S:O.set(H,S),S};Object.defineProperty(O,"__esModule",{value:!0}),O.Auth=void 0;const o=S(12001),h=S(11967);O.Auth=class{constructor(H){this.http=H,this.settings={path:"/auth",key:"colyseus-auth-token"},t.set(this,!1),q.set(this,void 0),p.set(this,void 0),G.set(this,(0,h.createNanoEvents)()),(0,o.getItem)(this.settings.key,(H=>this.token=H))}set token(H){this.http.authToken=H}get token(){return this.http.authToken}onChange(H){const O=V(this,G,"f").on("change",H);return V(this,t,"f")||w(this,q,new Promise(((H,O)=>{this.getUserData().then((H=>{this.emitChange(Object.assign(Object.assign({},H),{token:this.token}))})).catch((H=>{this.emitChange({user:null,token:void 0})})).finally((()=>{H()}))})),"f"),w(this,t,!0,"f"),O}getUserData(){return U(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(H,O,S){return U(this,void 0,void 0,(function*(){const t=(yield this.http.post(`${this.settings.path}/register`,{body:{email:H,password:O,options:S}})).data;return this.emitChange(t),t}))}signInWithEmailAndPassword(H,O){return U(this,void 0,void 0,(function*(){const S=(yield this.http.post(`${this.settings.path}/login`,{body:{email:H,password:O}})).data;return this.emitChange(S),S}))}signInAnonymously(H){return U(this,void 0,void 0,(function*(){const O=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:H}})).data;return this.emitChange(O),O}))}sendPasswordResetEmail(H){return U(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:H}})).data}))}signInWithProvider(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return U(this,void 0,void 0,(function*(){return new Promise(((S,t)=>{const q=O.width||480,G=O.height||768,U=this.token?`?token=${this.token}`:"",o=`Login with ${H[0].toUpperCase()+H.substring(1)}`,h=this.http.client.getHttpEndpoint(`${O.prefix||`${this.settings.path}/provider`}/${H}${U}`),a=screen.width/2-q/2,j=screen.height/2-G/2;w(this,p,window.open(h,o,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+q+", height="+G+", top="+j+", left="+a),"f");const e=H=>{void 0===H.data.user&&void 0===H.data.token||(clearInterval(X),V(this,p,"f").close(),w(this,p,void 0,"f"),window.removeEventListener("message",e),void 0!==H.data.error?t(H.data.error):(S(H.data),this.emitChange(H.data)))},X=setInterval((()=>{V(this,p,"f")&&!V(this,p,"f").closed||(w(this,p,void 0,"f"),t("Wp"),window.removeEventListener("message",e))}),200);window.addEventListener("message",e)}))}))}signOut(){return U(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(H){void 0!==H.token&&(this.token=H.token,null===H.token?(0,o.removeItem)(this.settings.key):(0,o.setItem)(this.settings.key,H.token)),V(this,G,"f").emit("change",H)}},t=new WeakMap,q=new WeakMap,p=new WeakMap,G=new WeakMap},11921:function(H,O,S){"use strict";var t,q=this&&this.__awaiter||function(H,O,S,t){return new(S||(S=Promise))((function(q,p){function G(H){try{V(t.next(H))}catch(O){p(O)}}function U(H){try{V(t.throw(H))}catch(O){p(O)}}function V(H){var O;H.done?q(H.value):(O=H.value,O instanceof S?O:new S((function(H){H(O)}))).then(G,U)}V((t=t.apply(H,O||[])).next())}))};Object.defineProperty(O,"__esModule",{value:!0}),O.Client=O.MatchMakeError=void 0;const p=S(11925),G=S(11934),U=S(11987),V=S(11998),w=S(12010);class o extends Error{constructor(H,O){super(H),this.code=O,Object.setPrototypeOf(this,o.prototype)}}O.MatchMakeError=o;const h="undefined"!==typeof window&&"undefined"!==typeof(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";O.Client=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,O=arguments.length>1?arguments[1]:void 0;var S,t;if("string"===typeof H){const O=H.startsWith("/")?new URL(H,h):new URL(H),S="https:"===O.protocol||"wss:"===O.protocol,t=Number(O.port||(S?443:80));this.settings={hostname:O.hostname,pathname:O.pathname,port:t,secure:S}}else void 0===H.port&&(H.port=H.secure?443:80),void 0===H.pathname&&(H.pathname=""),this.settings=H;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new U.HTTP(this,(null===O||void 0===O?void 0:O.headers)||{}),this.auth=new V.Auth(this.http),this.urlBuilder=null===O||void 0===O?void 0:O.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(t=null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)||void 0===t?void 0:t.includes("discordsays.com"))&&(this.urlBuilder=w.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",H,O,S)}))}create(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",H,O,S)}))}join(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",H,O,S)}))}joinById(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",H,O,S)}))}reconnect(H,O){return q(this,void 0,void 0,(function*(){if("string"===typeof H&&"string"===typeof O)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[S,t]=H.split(":");if(!S||!t)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",S,{reconnectionToken:t},O)}))}getAvailableRooms(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return q(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${H}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(H,O,S){return q(this,void 0,void 0,(function*(){const t=this.createRoom(H.room.name,O);t.roomId=H.room.roomId,t.sessionId=H.sessionId;const G={sessionId:t.sessionId};H.reconnectionToken&&(G.reconnectionToken=H.reconnectionToken);const U=S||t;return t.connect(this.buildEndpoint(H.room,G),H.devMode&&(()=>q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${t.roomId}'...`);let S=0;const p=()=>q(this,void 0,void 0,(function*(){S++;try{yield this.consumeSeatReservation(H,O,U),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${t.roomId}'`)}catch(q){S<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${S} out of 8)`),setTimeout(p,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(p,2e3)}))),U,this.http.headers),new Promise(((H,O)=>{const S=(H,S)=>O(new p.ServerError(H,S));U.onError.once(S),U.onJoin.once((()=>{U.onError.remove(S),setTimeout((()=>{try{U.dV(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),H(U)}))}))}))}createMatchMakeRequest(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;return q(this,void 0,void 0,(function*(){const q=(yield this.http.post(`matchmake/${H}/${O}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(S)})).data;if(q.error)throw new o(q.error,q.code);return"reconnect"===H&&(q.reconnectionToken=S.reconnectionToken),yield this.consumeSeatReservation(q,t,p)}))}createRoom(H,O){return new G.Room(H,O)}buildEndpoint(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=[];for(const p in O)O.hasOwnProperty(p)&&S.push(`${p}=${O[p]}`);let t=this.settings.secure?"wss://":"ws://";H.publicAddress?t+=`${H.publicAddress}`:t+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const q=`${t}/${H.processId}/${H.roomId}?${S.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(q)):q}getHttpEndpoint(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const O=H.startsWith("/")?H:`/${H}`,S=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${O}`;return this.urlBuilder?this.urlBuilder(new URL(S)):S}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11947:(H,O,S)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Connection=void 0;const t=S(11951);O.Connection=class{constructor(){this.events={},this.transport=new t.WebSocketTransport(this.events)}send(H){this.transport.send(H)}connect(H,O){this.transport.connect(H,O)}close(H,O){this.transport.close(H,O)}get isOpen(){return this.transport.isOpen}}},11987:function(H,O,S){"use strict";var t=this&&this.__createBinding||(Object.create?function(H,O,S,t){void 0===t&&(t=S);var q=Object.getOwnPropertyDescriptor(O,S);q&&!("get"in q?!O.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return O[S]}}),Object.defineProperty(H,t,q)}:function(H,O,S,t){void 0===t&&(t=S),H[t]=O[S]}),q=this&&this.__setModuleDefault||(Object.create?function(H,O){Object.defineProperty(H,"default",{enumerable:!0,value:O})}:function(H,O){H.default=O}),p=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var O={};if(null!=H)for(var S in H)"default"!==S&&Object.prototype.hasOwnProperty.call(H,S)&&t(O,H,S);return q(O,H),O};Object.defineProperty(O,"__esModule",{value:!0}),O.HTTP=void 0;const G=S(11925),U=p(S(11994));O.HTTP=class{constructor(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=H,this.headers=O}get(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",H,O)}post(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",H,O)}del(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",H,O)}put(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",H,O)}request(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return U[H](this.client.getHttpEndpoint(O),this.getOptions(S)).catch((H=>{var O;const S=H.statusCode,t=(null===(O=H.data)||void 0===O?void 0:O.error)||H.statusMessage||H.message;if(!S&&!t)throw H;throw new G.ServerError(S,t)}))}getOptions(H){return H.headers=Object.assign({},this.headers,H.headers),this.authToken&&(H.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(H.withCredentials=!0),H}}},11960:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.utf8Length=O.utf8Read=O.ErrorCode=O.Protocol=void 0,function(H){H[H.HANDSHAKE=9]="HANDSHAKE",H[H.JOIN_ROOM=10]="JOIN_ROOM",H[H.ERROR=11]="ERROR",H[H.LEAVE_ROOM=12]="LEAVE_ROOM",H[H.ROOM_DATA=13]="ROOM_DATA",H[H.ROOM_STATE=14]="ROOM_STATE",H[H.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",H[H.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",H[H.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(O.Protocol||(O.Protocol={})),function(H){H[H.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",H[H.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",H[H.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",H[H.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",H[H.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",H[H.AUTH_FAILED=4215]="AUTH_FAILED",H[H.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(O.ErrorCode||(O.ErrorCode={})),O.utf8Read=function(H,O){const S=H[O++];for(var t="",q=0,p=O,G=O+S;p<G;p++){var U=H[p];if(0!==(128&U))if(192!==(224&U))if(224!==(240&U)){if(240!==(248&U))throw new Error("Invalid byte "+U.toString(16));(q=(7&U)<<18|(63&H[++p])<<12|(63&H[++p])<<6|63&H[++p])>=65536?(q-=65536,t+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):t+=String.fromCharCode(q)}else t+=String.fromCharCode((15&U)<<12|(63&H[++p])<<6|63&H[++p]);else t+=String.fromCharCode((31&U)<<6|63&H[++p]);else t+=String.fromCharCode(U)}return t},O.utf8Length=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",O=0,S=0;for(let t=0,q=H.length;t<q;t++)O=H.charCodeAt(t),O<128?S+=1:O<2048?S+=2:O<55296||O>=57344?S+=3:(t++,S+=4);return S+1}},11934:function(H,O,S){"use strict";var t=this&&this.__createBinding||(Object.create?function(H,O,S,t){void 0===t&&(t=S);var q=Object.getOwnPropertyDescriptor(O,S);q&&!("get"in q?!O.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return O[S]}}),Object.defineProperty(H,t,q)}:function(H,O,S,t){void 0===t&&(t=S),H[t]=O[S]}),q=this&&this.__setModuleDefault||(Object.create?function(H,O){Object.defineProperty(H,"default",{enumerable:!0,value:O})}:function(H,O){H.default=O}),p=this&&this.__importStar||function(H){if(H&&H.__esModule)return H;var O={};if(null!=H)for(var S in H)"default"!==S&&Object.prototype.hasOwnProperty.call(H,S)&&t(O,H,S);return q(O,H),O};Object.defineProperty(O,"__esModule",{value:!0}),O.Room=void 0;const G=p(S(11940)),U=S(11947),V=S(11960),w=S(11962),o=S(11967),h=S(11974),a=S(11980),j=S(11925);class e{constructor(H,O){this.onStateChange=(0,h.createSignal)(),this.onError=(0,h.createSignal)(),this.onLeave=(0,h.createSignal)(),this.onJoin=(0,h.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,o.createNanoEvents)(),this.roomId=null,this.name=H,O&&(this.serializer=new((0,w.getSerializer)("schema")),this.rootSchema=O,this.serializer.state=new O),this.onError(((H,O)=>{var S;return null===(S=console.warn)||void 0===S?void 0:S.call(console,`colyseus.js - onError => (${H}) ${O}`)})),this.onLeave((()=>this.qO()))}get id(){return this.roomId}connect(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,t=arguments.length>3?arguments[3]:void 0;const q=new U.Connection;S.connection=q,q.events.onmessage=e.prototype.onMessageCallback.bind(S),q.events.onclose=function(H){var t;if(!S.hasJoined)return null===(t=console.warn)||void 0===t||t.call(console,`Room connection was closed unexpectedly (${H.code}): ${H.reason}`),void S.onError.invoke(H.code,H.reason);H.code===j.CloseCode.DEVMODE_RESTART&&O?O():(S.onLeave.invoke(H.code,H.reason),S.destroy())},q.events.onerror=function(H){var O;null===(O=console.warn)||void 0===O||O.call(console,`Room, onError (${H.code}): ${H.reason}`),S.onError.invoke(H.code,H.reason)},q.connect(H,t)}nG(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((O=>{this.onLeave((H=>O(H))),this.connection?H?this.connection.send([V.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(j.CloseCode.CONSENTED)}))}NO(H,O){return this.onMessageHandlers.on(this.getMessageHandlerKey(H),O)}send(H,O){const S=[V.Protocol.ROOM_DATA];let t;if("string"===typeof H?a.encode.string(S,H):a.encode.number(S,H),void 0!==O){const H=G.encode(O);t=new Uint8Array(S.length+H.byteLength),t.set(new Uint8Array(S),0),t.set(new Uint8Array(H),S.length)}else t=new Uint8Array(S);this.connection.send(t.buffer)}dV(H,O){const S=[V.Protocol.ROOM_DATA_BYTES];let t;"string"===typeof H?a.encode.string(S,H):a.encode.number(S,H),t=new Uint8Array(S.length+(O.byteLength||O.length)),t.set(new Uint8Array(S),0),t.set(new Uint8Array(O),S.length),this.connection.send(t.buffer)}get state(){return this.serializer.getState()}qO(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(H){const O=Array.from(new Uint8Array(H.data)),S=O[0];if(S===V.Protocol.JOIN_ROOM){let H=1;const S=(0,V.utf8Read)(O,H);if(H+=(0,V.utf8Length)(S),this.serializerId=(0,V.utf8Read)(O,H),H+=(0,V.utf8Length)(this.serializerId),!this.serializer){const H=(0,w.getSerializer)(this.serializerId);this.serializer=new H}O.length>H&&this.serializer.handshake&&this.serializer.handshake(O,{offset:H}),this.reconnectionToken=`${this.roomId}:${S}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([V.Protocol.JOIN_ROOM])}else if(S===V.Protocol.ERROR){const H={offset:1},S=a.decode.number(O,H),t=a.decode.string(O,H);this.onError.invoke(S,t)}else if(S===V.Protocol.LEAVE_ROOM)this.nG();else if(S===V.Protocol.ROOM_DATA_SCHEMA){const H={offset:1},S=this.serializer.getState().constructor._context.get(a.decode.number(O,H)),t=new S;t.decode(O,H),this.dispatchMessage(S,t)}else if(S===V.Protocol.ROOM_STATE)O.shift(),this.setState(O);else if(S===V.Protocol.ROOM_STATE_PATCH)O.shift(),this.patch(O);else if(S===V.Protocol.ROOM_DATA){const S={offset:1},t=a.decode.stringCheck(O,S)?a.decode.string(O,S):a.decode.number(O,S),q=O.length>S.offset?G.decode(H.data,S.offset):void 0;this.dispatchMessage(t,q)}else if(S===V.Protocol.ROOM_DATA_BYTES){const H={offset:1},S=a.decode.stringCheck(O,H)?a.decode.string(O,H):a.decode.number(O,H);this.dispatchMessage(S,new Uint8Array(O.slice(H.offset)))}}setState(H){this.serializer.setState(H),this.onStateChange.invoke(this.serializer.getState())}patch(H){this.serializer.patch(H),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(H,O){var S;const t=this.getMessageHandlerKey(H);this.onMessageHandlers.events[t]?this.onMessageHandlers.emit(t,O):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",H,O):null===(S=console.warn)||void 0===S||S.call(console,`colyseus.js: onMessage() not registered for type '${H}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(H){switch(typeof H){case"function":return`$${H._typeid}`;case"string":return H;case"number":return`i${H}`;default:throw new Error("invalid message type.")}}}O.Room=e},12001:(H,O)=>{"use strict";let S;function t(){if(!S)try{S="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(H){}return S||(S={cache:{},setItem:function(H,O){this.cache[H]=O},getItem:function(H){this.cache[H]},removeItem:function(H){delete this.cache[H]}}),S}Object.defineProperty(O,"__esModule",{value:!0}),O.getItem=O.removeItem=O.setItem=void 0,O.setItem=function(H,O){t().setItem(H,O)},O.removeItem=function(H){t().removeItem(H)},O.getItem=function(H,O){const S=t().getItem(H);"undefined"!==typeof Promise&&S instanceof Promise?S.then((H=>O(H))):O(S)}},11967:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createNanoEvents=void 0;O.createNanoEvents=()=>({emit(H){let O=this.events[H]||[];for(var S=arguments.length,t=new Array(S>1?S-1:0),q=1;q<S;q++)t[q-1]=arguments[q];for(let p=0,G=O.length;p<G;p++)O[p](...t)},events:{},on(H,O){var S;return(null===(S=this.events[H])||void 0===S?void 0:S.push(O))||(this.events[H]=[O]),()=>{var S;this.events[H]=null===(S=this.events[H])||void 0===S?void 0:S.filter((H=>O!==H))}}})},11974:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.createSignal=O.EventEmitter=void 0;class S{constructor(){this.handlers=[]}register(H){return this.handlers.push(H),this}invoke(){for(var H=arguments.length,O=new Array(H),S=0;S<H;S++)O[S]=arguments[S];this.handlers.forEach((H=>H.apply(this,O)))}invokeAsync(){for(var H=arguments.length,O=new Array(H),S=0;S<H;S++)O[S]=arguments[S];return Promise.all(this.handlers.map((H=>H.apply(this,O))))}remove(H){const O=this.handlers.indexOf(H);this.handlers[O]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}O.EventEmitter=S,O.createSignal=function(){const H=new S;function O(O){return H.register(O,null===this)}return O.once=O=>{const S=function(){for(var t=arguments.length,q=new Array(t),p=0;p<t;p++)q[p]=arguments[p];O.apply(this,q),H.remove(S)};H.register(S)},O.remove=O=>H.remove(O),O.invoke=function(){return H.invoke(...arguments)},O.invokeAsync=function(){return H.invokeAsync(...arguments)},O.clear=()=>H.clear(),O}},11925:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ServerError=O.CloseCode=void 0,function(H){H[H.CONSENTED=4e3]="CONSENTED",H[H.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(O.CloseCode||(O.CloseCode={}));class S extends Error{constructor(H,O){super(O),this.name="ServerError",this.code=H}}O.ServerError=S},11916:(H,O,S)=>{"use strict";O.e=void 0,S(11918);var t=S(11921);Object.defineProperty(O,"e",{enumerable:!0,get:function(){return t.Client}});var q=S(11960);var p=S(11934);var G=S(11998);const U=S(12016);const V=S(12022),w=S(11962);(0,w.registerSerializer)("schema",U.SchemaSerializer),(0,w.registerSerializer)("none",V.NoneSerializer)},11918:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=H=>null!==H&&"object"===typeof H&&H.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11940:(H,O)=>{"use strict";function S(H,O){if(this._offset=O,H instanceof ArrayBuffer)this._buffer=H,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(H))throw new Error("Invalid argument");this._buffer=H.buffer,this._view=new DataView(this._buffer,H.byteOffset,H.byteLength)}}Object.defineProperty(O,"__esModule",{value:!0}),O.decode=O.encode=void 0,S.prototype._array=function(H){for(var O=new Array(H),S=0;S<H;S++)O[S]=this._parse();return O},S.prototype._map=function(H){for(var O={},S=0;S<H;S++)O[this._parse()]=this._parse();return O},S.prototype._str=function(H){var O=function(H,O,S){for(var t="",q=0,p=O,G=O+S;p<G;p++){var U=H.getUint8(p);if(0!==(128&U))if(192!==(224&U))if(224!==(240&U)){if(240!==(248&U))throw new Error("Invalid byte "+U.toString(16));(q=(7&U)<<18|(63&H.getUint8(++p))<<12|(63&H.getUint8(++p))<<6|63&H.getUint8(++p))>=65536?(q-=65536,t+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):t+=String.fromCharCode(q)}else t+=String.fromCharCode((15&U)<<12|(63&H.getUint8(++p))<<6|63&H.getUint8(++p));else t+=String.fromCharCode((31&U)<<6|63&H.getUint8(++p));else t+=String.fromCharCode(U)}return t}(this._view,this._offset,H);return this._offset+=H,O},S.prototype._bin=function(H){var O=this._buffer.slice(this._offset,this._offset+H);return this._offset+=H,O},S.prototype._parse=function(){var H,O=this._view.getUint8(this._offset++),S=0,t=0,q=0,p=0;if(O<192)return O<128?O:O<144?this._map(15&O):O<160?this._array(15&O):this._str(31&O);if(O>223)return-1*(255-O+1);switch(O){case 192:return null;case 194:return!1;case 195:return!0;case 196:return S=this._view.getUint8(this._offset),this._offset+=1,this._bin(S);case 197:return S=this._view.getUint16(this._offset),this._offset+=2,this._bin(S);case 198:return S=this._view.getUint32(this._offset),this._offset+=4,this._bin(S);case 199:if(S=this._view.getUint8(this._offset),t=this._view.getInt8(this._offset+1),this._offset+=2,-1===t){var G=this._view.getUint32(this._offset);return q=this._view.getInt32(this._offset+4),p=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*q+p)+G/1e6)}return[t,this._bin(S)];case 200:return S=this._view.getUint16(this._offset),t=this._view.getInt8(this._offset+2),this._offset+=3,[t,this._bin(S)];case 201:return S=this._view.getUint32(this._offset),t=this._view.getInt8(this._offset+4),this._offset+=5,[t,this._bin(S)];case 202:return H=this._view.getFloat32(this._offset),this._offset+=4,H;case 203:return H=this._view.getFloat64(this._offset),this._offset+=8,H;case 204:return H=this._view.getUint8(this._offset),this._offset+=1,H;case 205:return H=this._view.getUint16(this._offset),this._offset+=2,H;case 206:return H=this._view.getUint32(this._offset),this._offset+=4,H;case 207:return q=this._view.getUint32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,q+p;case 208:return H=this._view.getInt8(this._offset),this._offset+=1,H;case 209:return H=this._view.getInt16(this._offset),this._offset+=2,H;case 210:return H=this._view.getInt32(this._offset),this._offset+=4,H;case 211:return q=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,q+p;case 212:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?void(this._offset+=1):[t,this._bin(1)];case 213:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(2)];case 214:return t=this._view.getInt8(this._offset),this._offset+=1,-1===t?(H=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*H)):[t,this._bin(4)];case 215:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?(q=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(q+p)):-1===t?(q=this._view.getUint32(this._offset),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&q)+p)+(q>>>2)/1e6)):[t,this._bin(8)];case 216:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(16)];case 217:return S=this._view.getUint8(this._offset),this._offset+=1,this._str(S);case 218:return S=this._view.getUint16(this._offset),this._offset+=2,this._str(S);case 219:return S=this._view.getUint32(this._offset),this._offset+=4,this._str(S);case 220:return S=this._view.getUint16(this._offset),this._offset+=2,this._array(S);case 221:return S=this._view.getUint32(this._offset),this._offset+=4,this._array(S);case 222:return S=this._view.getUint16(this._offset),this._offset+=2,this._map(S);case 223:return S=this._view.getUint32(this._offset),this._offset+=4,this._map(S)}throw new Error("Could not parse")},O.decode=function(H){var O=new S(H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=O._parse();if(O._offset!==H.byteLength)throw new Error(H.byteLength-O._offset+" trailing bytes");return t};function t(H,O,S){for(var t=0,q=0,p=S.length;q<p;q++)(t=S.charCodeAt(q))<128?H.setUint8(O++,t):t<2048?(H.setUint8(O++,192|t>>6),H.setUint8(O++,128|63&t)):t<55296||t>=57344?(H.setUint8(O++,224|t>>12),H.setUint8(O++,128|t>>6&63),H.setUint8(O++,128|63&t)):(q++,t=65536+((1023&t)<<10|1023&S.charCodeAt(q)),H.setUint8(O++,240|t>>18),H.setUint8(O++,128|t>>12&63),H.setUint8(O++,128|t>>6&63),H.setUint8(O++,128|63&t))}function q(H,O,S){var t=typeof S,p=0,G=0,U=0,V=0,w=0,o=0;if("string"===t){if(w=function(H){for(var O=0,S=0,t=0,q=H.length;t<q;t++)(O=H.charCodeAt(t))<128?S+=1:O<2048?S+=2:O<55296||O>=57344?S+=3:(t++,S+=4);return S}(S),w<32)H.push(160|w),o=1;else if(w<256)H.push(217,w),o=2;else if(w<65536)H.push(218,w>>8,w),o=3;else{if(!(w<4294967296))throw new Error("String too long");H.push(219,w>>24,w>>16,w>>8,w),o=5}return O.push({_str:S,_length:w,_offset:H.length}),o+w}if("number"===t)return Math.floor(S)===S&&isFinite(S)?S>=0?S<128?(H.push(S),1):S<256?(H.push(204,S),2):S<65536?(H.push(205,S>>8,S),3):S<4294967296?(H.push(206,S>>24,S>>16,S>>8,S),5):(U=S/Math.pow(2,32)|0,V=S>>>0,H.push(207,U>>24,U>>16,U>>8,U,V>>24,V>>16,V>>8,V),9):S>=-32?(H.push(S),1):S>=-128?(H.push(208,S),2):S>=-32768?(H.push(209,S>>8,S),3):S>=-2147483648?(H.push(210,S>>24,S>>16,S>>8,S),5):(U=Math.floor(S/Math.pow(2,32)),V=S>>>0,H.push(211,U>>24,U>>16,U>>8,U,V>>24,V>>16,V>>8,V),9):(H.push(203),O.push({_float:S,_length:8,_offset:H.length}),9);if("object"===t){if(null===S)return H.push(192),1;if(Array.isArray(S)){if((w=S.length)<16)H.push(144|w),o=1;else if(w<65536)H.push(220,w>>8,w),o=3;else{if(!(w<4294967296))throw new Error("Array too large");H.push(221,w>>24,w>>16,w>>8,w),o=5}for(p=0;p<w;p++)o+=q(H,O,S[p]);return o}if(S instanceof Date){var h=S.getTime(),a=Math.floor(h/1e3),j=1e6*(h-1e3*a);return a>=0&&j>=0&&a<=17179869183?0===j&&a<=4294967295?(H.push(214,255,a>>24,a>>16,a>>8,a),6):(U=a/4294967296,V=4294967295&a,H.push(215,255,j>>22,j>>14,j>>6,U,V>>24,V>>16,V>>8,V),10):(U=Math.floor(a/4294967296),V=a>>>0,H.push(199,12,255,j>>24,j>>16,j>>8,j,U>>24,U>>16,U>>8,U,V>>24,V>>16,V>>8,V),15)}if(S instanceof ArrayBuffer){if((w=S.byteLength)<256)H.push(196,w),o=2;else if(w<65536)H.push(197,w>>8,w),o=3;else{if(!(w<4294967296))throw new Error("Buffer too large");H.push(198,w>>24,w>>16,w>>8,w),o=5}return O.push({_bin:S,_length:w,_offset:H.length}),o+w}if("function"===typeof S.toJSON)return q(H,O,S.toJSON());var e=[],X="",E=Object.keys(S);for(p=0,G=E.length;p<G;p++)void 0!==S[X=E[p]]&&"function"!==typeof S[X]&&e.push(X);if((w=e.length)<16)H.push(128|w),o=1;else if(w<65536)H.push(222,w>>8,w),o=3;else{if(!(w<4294967296))throw new Error("Object too large");H.push(223,w>>24,w>>16,w>>8,w),o=5}for(p=0;p<w;p++)o+=q(H,O,X=e[p]),o+=q(H,O,S[X]);return o}if("boolean"===t)return H.push(S?195:194),1;if("undefined"===t)return H.push(192),1;if("function"===typeof S.toJSON)return q(H,O,S.toJSON());throw new Error("Could not encode")}O.encode=function(H){var O=[],S=[],p=q(O,S,H),G=new ArrayBuffer(p),U=new DataView(G),V=0,w=0,o=-1;S.length>0&&(o=S[0]._offset);for(var h,a=0,j=0,e=0,X=O.length;e<X;e++)if(U.setUint8(w+e,O[e]),e+1===o){if(a=(h=S[V])._length,j=w+o,h._bin)for(var E=new Uint8Array(h._bin),y=0;y<a;y++)U.setUint8(j+y,E[y]);else h._str?t(U,j,h._str):void 0!==h._float&&U.setFloat64(j,h._float);w+=a,S[++V]&&(o=S[V]._offset)}return G}},12022:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NoneSerializer=void 0;O.NoneSerializer=class{setState(H){}getState(){return null}patch(H){}teardown(){}handshake(H){}}},12016:(H,O,S)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.SchemaSerializer=void 0;const t=S(11980);O.SchemaSerializer=class{setState(H){return this.state.decode(H)}getState(){return this.state}patch(H){return this.state.decode(H)}teardown(){var H,O;null===(O=null===(H=this.state)||void 0===H?void 0:H.$changes)||void 0===O||O.root.clearRefs()}handshake(H,O){if(this.state){(new t.Reflection).decode(H,O)}else this.state=t.Reflection.decode(H,O)}}},11962:(H,O)=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getSerializer=O.registerSerializer=void 0;const S={};O.registerSerializer=function(H,O){S[H]=O},O.getSerializer=function(H){const O=S[H];if(!O)throw new Error("missing serializer: "+H);return O}},11951:function(H,O,S){"use strict";var t=this&&this.__importDefault||function(H){return H&&H.__esModule?H:{default:H}};Object.defineProperty(O,"__esModule",{value:!0}),O.WebSocketTransport=void 0;const q=t(S(11953)),p=globalThis.WebSocket||q.default;O.WebSocketTransport=class{constructor(H){this.events=H}send(H){H instanceof ArrayBuffer?this.ws.send(H):Array.isArray(H)&&this.ws.send(new Uint8Array(H).buffer)}connect(H,O){try{this.ws=new p(H,{headers:O,protocols:this.protocols})}catch(S){this.ws=new p(H,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(H,O){this.ws.close(H,O)}get isOpen(){return this.ws.readyState===p.OPEN}}},11953:H=>{"use strict";H.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12410:H=>{"use strict";H.exports=function(H){for(var O=new Array(H),S=0;S<H;++S)O[S]=S;return O}},12417:H=>{function O(H){return!!H.constructor&&"function"===typeof H.constructor.isBuffer&&H.constructor.isBuffer(H)}H.exports=function(H){return null!=H&&(O(H)||function(H){return"function"===typeof H.readFloatLE&&"function"===typeof H.slice&&O(H.slice(0,0))}(H)||!!H._isBuffer)}},12401:(H,O,S)=>{var t=S(12410),q=S(12417),p="undefined"!==typeof Float64Array;function G(H,O){return H[0]-O[0]}function U(){var H,O=this.stride,S=new Array(O.length);for(H=0;H<S.length;++H)S[H]=[Math.abs(O[H]),H];S.sort(G);var t=new Array(S.length);for(H=0;H<t.length;++H)t[H]=S[H][1];return t}function V(H,O){var S=["View",O,"d",H].join("");O<0&&(S="View_Nil"+H);var q="generic"===H;if(-1===O){var p="function "+S+"(a){this.data=a;};var proto="+S+".prototype;proto.dtype='"+H+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+S+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+S+"(a){return new "+S+"(a);}";return new Function(p)()}if(0===O){p="function "+S+"(a,d) {this.data = a;this.offset = d};var proto="+S+".prototype;proto.dtype='"+H+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+S+"_copy() {return new "+S+"(this.data,this.offset)};proto.pick=function "+S+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+S+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+S+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+S+"(a,b,c,d){return new "+S+"(a,d)}";return new Function("TrivialArray",p)(w[H][0])}p=["'use strict'"];var G=t(O),V=G.map((function(H){return"i"+H})),o="this.offset+"+G.map((function(H){return"this.stride["+H+"]*i"+H})).join("+"),h=G.map((function(H){return"b"+H})).join(","),a=G.map((function(H){return"c"+H})).join(",");p.push("function "+S+"(a,"+h+","+a+",d){this.data=a","this.shape=["+h+"]","this.stride=["+a+"]","this.offset=d|0}","var proto="+S+".prototype","proto.dtype='"+H+"'","proto.dimension="+O),p.push("Object.defineProperty(proto,'size',{get:function "+S+"_size(){return "+G.map((function(H){return"this.shape["+H+"]"})).join("*"),"}})"),1===O?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),O<4?(p.push("function "+S+"_order(){"),2===O?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===O&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+S+"_set("+V.join(",")+",v){"),q?p.push("return this.data.set("+o+",v)}"):p.push("return this.data["+o+"]=v}"),p.push("proto.get=function "+S+"_get("+V.join(",")+"){"),q?p.push("return this.data.get("+o+")}"):p.push("return this.data["+o+"]}"),p.push("proto.index=function "+S+"_index(",V.join(),"){return "+o+"}"),p.push("proto.hi=function "+S+"_hi("+V.join(",")+"){return new "+S+"(this.data,"+G.map((function(H){return["(typeof i",H,"!=='number'||i",H,"<0)?this.shape[",H,"]:i",H,"|0"].join("")})).join(",")+","+G.map((function(H){return"this.stride["+H+"]"})).join(",")+",this.offset)}");var j=G.map((function(H){return"a"+H+"=this.shape["+H+"]"})),e=G.map((function(H){return"c"+H+"=this.stride["+H+"]"}));p.push("proto.lo=function "+S+"_lo("+V.join(",")+"){var b=this.offset,d=0,"+j.join(",")+","+e.join(","));for(var X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'&&i"+X+">=0){d=i"+X+"|0;b+=c"+X+"*d;a"+X+"-=d}");p.push("return new "+S+"(this.data,"+G.map((function(H){return"a"+H})).join(",")+","+G.map((function(H){return"c"+H})).join(",")+",b)}"),p.push("proto.step=function "+S+"_step("+V.join(",")+"){var "+G.map((function(H){return"a"+H+"=this.shape["+H+"]"})).join(",")+","+G.map((function(H){return"b"+H+"=this.stride["+H+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'){d=i"+X+"|0;if(d<0){c+=b"+X+"*(a"+X+"-1);a"+X+"=ceil(-a"+X+"/d)}else{a"+X+"=ceil(a"+X+"/d)}b"+X+"*=d}");p.push("return new "+S+"(this.data,"+G.map((function(H){return"a"+H})).join(",")+","+G.map((function(H){return"b"+H})).join(",")+",c)}");var E=new Array(O),y=new Array(O);for(X=0;X<O;++X)E[X]="a[i"+X+"]",y[X]="b[i"+X+"]";p.push("proto.transpose=function "+S+"_transpose("+V+"){"+V.map((function(H,O){return H+"=("+H+"===undefined?"+O+":"+H+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+S+"(this.data,"+E.join(",")+","+y.join(",")+",this.offset)}"),p.push("proto.pick=function "+S+"_pick("+V+"){var a=[],b=[],c=this.offset");for(X=0;X<O;++X)p.push("if(typeof i"+X+"==='number'&&i"+X+">=0){c=(c+this.stride["+X+"]*i"+X+")|0}else{a.push(this.shape["+X+"]);b.push(this.stride["+X+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+S+"(data,shape,stride,offset){return new "+S+"(data,"+G.map((function(H){return"shape["+H+"]"})).join(",")+","+G.map((function(H){return"stride["+H+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join("\n"))(w[H],U)}var w={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};H.exports=function(H,O,S,t){if(void 0===H)return(0,w.array[0])([]);"number"===typeof H&&(H=[H]),void 0===O&&(O=[H.length]);var G=O.length;if(void 0===S){S=new Array(G);for(var U=G-1,o=1;U>=0;--U)S[U]=o,o*=O[U]}if(void 0===t){t=0;for(U=0;U<G;++U)S[U]<0&&(t-=(O[U]-1)*S[U])}for(var h=function(H){if(q(H))return"buffer";if(p)switch(Object.prototype.toString.call(H)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(H)?"array":"generic"}(H),a=w[h];a.length<=G+1;)a.push(V(h,a.length-1));return(0,a[G+1])(H,O,S,t)}},13404:H=>{var O;self,O=()=>(()=>{"use strict";var H={d:(O,S)=>{for(var t in S)H.o(S,t)&&!H.o(O,t)&&Object.defineProperty(O,t,{enumerable:!0,get:S[t]})},o:(H,O)=>Object.prototype.hasOwnProperty.call(H,O)},O={};H.d(O,{default:()=>N});var S,t=function(H,O){var S=O.x-H.x,t=O.y-H.y;return Math.sqrt(S*S+t*t)},q=function(H){return H*(Math.PI/180)},p=new Map,G=function(H){p.has(H)&&clearTimeout(p.get(H)),p.set(H,setTimeout(H,100))},U=function(H,O,S){for(var t,q=O.split(/[ ,]+/g),p=0;p<q.length;p+=1)t=q[p],H.addEventListener?H.addEventListener(t,S,!1):H.attachEvent&&H.attachEvent(t,S)},V=function(H,O,S){for(var t,q=O.split(/[ ,]+/g),p=0;p<q.length;p+=1)t=q[p],H.removeEventListener?H.removeEventListener(t,S):H.detachEvent&&H.detachEvent(t,S)},w=function(H){return H.preventDefault(),H.type.match(/^touch/)?H.changedTouches:H},o=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},h=function(H,O){O.top||O.right||O.bottom||O.left?(H.style.top=O.top,H.style.right=O.right,H.style.bottom=O.bottom,H.style.left=O.left):(H.style.left=O.x+"px",H.style.top=O.y+"px")},a=function(H,O,S){var t=j(H);for(var q in t)if(t.hasOwnProperty(q))if("string"==typeof O)t[q]=O+" "+S;else{for(var p="",G=0,U=O.length;G<U;G+=1)p+=O[G]+" "+S+", ";t[q]=p.slice(0,-2)}return t},j=function(H){var O={};return O[H]="",["webkit","Moz","o"].forEach((function(S){O[S+H.charAt(0).toUpperCase()+H.slice(1)]=""})),O},e=function(H,O){for(var S in O)O.hasOwnProperty(S)&&(H[S]=O[S]);return H},X=function(H,O){if(H.length)for(var S=0,t=H.length;S<t;S+=1)O(H[S]);else O(H)},E="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,y=window.matchMedia("(any-hover: none)").matches,T=!!("ontouchstart"in window),K=!!window.PointerEvent,b=!!window.MSPointerEvent,D={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},F={start:"mousedown",move:"mousemove",end:"mouseup"},Y={};function l(){}E&&!y?S=D:K?S={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:b?S={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:T?(S=D,Y=F):S=F,l.prototype.on=function(H,O){var S,t=this,q=H.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var p=0;p<q.length;p+=1)S=q[p],t._handlers_[S]=t._handlers_[S]||[],t._handlers_[S].push(O);return t},l.prototype.off=function(H,O){var S=this;return S._handlers_=S._handlers_||{},void 0===H?S._handlers_={}:void 0===O?S._handlers_[H]=null:S._handlers_[H]&&S._handlers_[H].indexOf(O)>=0&&S._handlers_[H].splice(S._handlers_[H].indexOf(O),1),S},l.prototype.trigger=function(H,O){var S,t=this,q=H.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var p=0;p<q.length;p+=1)S=q[p],t._handlers_[S]&&t._handlers_[S].length&&t._handlers_[S].forEach((function(H){H.call(t,{type:S,target:t},O)}))},l.prototype.config=function(H){var O=this;O.options=O.defaults||{},H&&(O.options=function(H,O){var S={};for(var t in H)H.hasOwnProperty(t)&&O.hasOwnProperty(t)?S[t]=O[t]:H.hasOwnProperty(t)&&(S[t]=H[t]);return S}(O.options,H))},l.prototype.bindEvt=function(H,O){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[O]=function(){"function"==typeof t["on"+O]?t["on"+O].apply(t,arguments):console.warn('[WARNING] : Missing "on'+O+'" handler.')},U(H,S[O],t._domHandlers_[O]),Y[O]&&U(H,Y[O],t._domHandlers_[O]),t},l.prototype.unbindEvt=function(H,O){var t=this;return t._domHandlers_=t._domHandlers_||{},V(H,S[O],t._domHandlers_[O]),Y[O]&&V(H,Y[O],t._domHandlers_[O]),delete t._domHandlers_[O],this};const d=l;function v(H,O){return this.identifier=O.identifier,this.position=O.position,this.frontPosition=O.frontPosition,this.collection=H,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(O),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=v.id,v.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}v.prototype=new d,v.constructor=v,v.id=0,v.prototype.buildEl=function(H){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},v.prototype.stylize=function(){if(this.options.dataOnly)return this;var H=this.options.fadeTime+"ms",O=function(){var H=j("borderRadius");for(var O in H)H.hasOwnProperty(O)&&(H[O]="50%");return H}(),S=a("transition","opacity",H),t={};return t.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},t.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},t.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},e(t.el,S),"circle"===this.options.shape&&e(t.back,O),e(t.front,O),this.applyStyles(t),this},v.prototype.applyStyles=function(H){for(var O in this.ui)if(this.ui.hasOwnProperty(O))for(var S in H[O])this.ui[O].style[S]=H[O][S];return this},v.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},v.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},v.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},v.prototype.show=function(H){var O=this;return O.options.dataOnly||(clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.addToDom(),O.restCallback(),setTimeout((function(){O.ui.el.style.opacity=1}),0),O.showTimeout=setTimeout((function(){O.trigger("shown",O.instance),"function"==typeof H&&H.call(this)}),O.options.fadeTime)),O},v.prototype.hide=function(H){var O=this;if(O.options.dataOnly)return O;if(O.ui.el.style.opacity=O.options.restOpacity,clearTimeout(O.removeTimeout),clearTimeout(O.showTimeout),clearTimeout(O.restTimeout),O.removeTimeout=setTimeout((function(){var S="dynamic"===O.options.mode?"none":"block";O.ui.el.style.display=S,"function"==typeof H&&H.call(O),O.trigger("hidden",O.instance)}),O.options.fadeTime),O.options.restJoystick){var S=O.options.restJoystick,t={};t.x=!0===S||!1!==S.x?0:O.instance.frontPosition.x,t.y=!0===S||!1!==S.y?0:O.instance.frontPosition.y,O.setPosition(H,t)}return O},v.prototype.setPosition=function(H,O){var S=this;S.frontPosition={x:O.x,y:O.y};var t=S.options.fadeTime+"ms",q={};q.front=a("transition",["transform"],t);var p={front:{}};p.front={transform:"translate("+S.frontPosition.x+"px,"+S.frontPosition.y+"px)"},S.applyStyles(q),S.applyStyles(p),S.restTimeout=setTimeout((function(){"function"==typeof H&&H.call(S),S.restCallback()}),S.options.fadeTime)},v.prototype.restCallback=function(){var H=this,O={};O.front=a("transition","none",""),H.applyStyles(O),H.trigger("rested",H.instance)},v.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},v.prototype.computeDirection=function(H){var O,S,t,q=H.angle.radian,p=Math.PI/4,G=Math.PI/2;if(q>p&&q<3*p&&!H.lockX?O="up":q>-p&&q<=p&&!H.lockY?O="left":q>3*-p&&q<=-p&&!H.lockX?O="down":H.lockY||(O="right"),H.lockY||(S=q>-G&&q<G?"left":"right"),H.lockX||(t=q>0?"up":"down"),H.force>this.options.threshold){var U,V={};for(U in this.direction)this.direction.hasOwnProperty(U)&&(V[U]=this.direction[U]);var w={};for(U in this.direction={x:S,y:t,angle:O},H.direction=this.direction,V)V[U]===this.direction[U]&&(w[U]=!0);if(w.x&&w.y&&w.angle)return H;w.x&&w.y||this.trigger("plain",H),w.x||this.trigger("plain:"+S,H),w.y||this.trigger("plain:"+t,H),w.angle||this.trigger("dir dir:"+O,H)}else this.resetDirection();return H};const z=v;function m(H,O){var S=this;S.nipples=[],S.idles=[],S.actives=[],S.ids=[],S.pressureIntervals={},S.manager=H,S.id=m.id,m.id+=1,S.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},S.config(O),"static"!==S.options.mode&&"semi"!==S.options.mode||(S.options.multitouch=!1),S.options.multitouch||(S.options.maxNumberOfNipples=1);var t=getComputedStyle(S.options.zone.parentElement);return t&&"flex"===t.display&&(S.parentIsFlex=!0),S.updateBox(),S.prepareNipples(),S.Ka(),S.begin(),S.nipples}m.prototype=new d,m.constructor=m,m.id=0,m.prototype.prepareNipples=function(){var H=this,O=H.nipples;O.on=H.on.bind(H),O.off=H.off.bind(H),O.options=H.options,O.destroy=H.destroy.bind(H),O.ids=H.ids,O.id=H.id,O.processOnMove=H.processOnMove.bind(H),O.processOnEnd=H.processOnEnd.bind(H),O.get=function(H){if(void 0===H)return O[0];for(var S=0,t=O.length;S<t;S+=1)if(O[S].identifier===H)return O[S];return!1}},m.prototype.Ka=function(){var H=this;H.bindEvt(H.options.zone,"start"),H.options.zone.style.touchAction="none",H.options.zone.style.msTouchAction="none"},m.prototype.begin=function(){var H=this,O=H.options;if("static"===O.mode){var S=H.createNipple(O.position,H.manager.getIdentifier());S.add(),H.idles.push(S)}},m.prototype.createNipple=function(H,O){var S=this,t=S.manager.scroll,q={},p=S.options,G=S.parentIsFlex?t.x:t.x+S.box.left,U=S.parentIsFlex?t.y:t.y+S.box.top;if(H.x&&H.y)q={x:H.x-G,y:H.y-U};else if(H.top||H.right||H.bottom||H.left){var V=document.createElement("DIV");V.style.display="hidden",V.style.top=H.top,V.style.right=H.right,V.style.bottom=H.bottom,V.style.left=H.left,V.style.position="absolute",p.zone.appendChild(V);var w=V.getBoundingClientRect();p.zone.removeChild(V),q=H,H={x:w.left+t.x,y:w.top+t.y}}var o=new z(S,{color:p.color,size:p.size,threshold:p.threshold,fadeTime:p.fadeTime,dataOnly:p.dataOnly,restJoystick:p.restJoystick,restOpacity:p.restOpacity,mode:p.mode,identifier:O,position:H,zone:p.zone,frontPosition:{x:0,y:0},shape:p.shape});return p.dataOnly||(h(o.ui.el,q),h(o.ui.front,o.frontPosition)),S.nipples.push(o),S.trigger("added "+o.identifier+":added",o),S.manager.trigger("added "+o.identifier+":added",o),S.bindNipple(o),o},m.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},m.prototype.bindNipple=function(H){var O,S=this,t=function(H,t){O=H.type+" "+t.id+":"+H.type,S.trigger(O,t)};H.on("destroyed",S.onDestroyed.bind(S)),H.on("shown hidden rested dir plain",t),H.on("dir:up dir:right dir:down dir:left",t),H.on("plain:up plain:right plain:down plain:left",t)},m.prototype.pressureFn=function(H,O,S){var t=this,q=0;clearInterval(t.pressureIntervals[S]),t.pressureIntervals[S]=setInterval(function(){var S=H.force||H.pressure||H.webkitForce||0;S!==q&&(O.trigger("pressure",S),t.trigger("pressure "+O.identifier+":pressure",S),q=S)}.bind(t),100)},m.prototype.onstart=function(H){var O=this,S=O.options,t=H;return H=w(H),O.updateBox(),X(H,(function(q){O.actives.length<S.maxNumberOfNipples?O.processOnStart(q):t.type.match(/^touch/)&&(Object.keys(O.manager.ids).forEach((function(S){if(Object.values(t.touches).findIndex((function(H){return H.identifier===S}))<0){var q=[H[0]];q.identifier=S,O.processOnEnd(q)}})),O.actives.length<S.maxNumberOfNipples&&O.processOnStart(q))})),O.manager.bindDocument(),!1},m.prototype.processOnStart=function(H){var O,S=this,q=S.options,p=S.manager.getIdentifier(H),G=H.force||H.pressure||H.webkitForce||0,U={x:H.pageX,y:H.pageY},V=S.getOrCreate(p,U);V.identifier!==p&&S.manager.removeIdentifier(V.identifier),V.identifier=p;var w=function(O){O.trigger("start",O),S.trigger("start "+O.id+":start",O),O.show(),G>0&&S.pressureFn(H,O,O.identifier),S.processOnMove(H)};if((O=S.idles.indexOf(V))>=0&&S.idles.splice(O,1),S.actives.push(V),S.ids.push(V.identifier),"semi"!==q.mode)w(V);else{if(!(t(U,V.position)<=q.catchDistance))return V.destroy(),void S.processOnStart(H);w(V)}return V},m.prototype.getOrCreate=function(H,O){var S,t=this,q=t.options;return/(semi|static)/.test(q.mode)?(S=t.idles[0])?(t.idles.splice(0,1),S):"semi"===q.mode?t.createNipple(O,H):(console.warn("Coudln't find the needed nipple."),!1):S=t.createNipple(O,H)},m.prototype.processOnMove=function(H){var O=this,S=O.options,p=O.manager.getIdentifier(H),G=O.nipples.get(p),U=O.manager.scroll;if(function(H){return isNaN(H.buttons)?0!==H.pressure:0!==H.buttons}(H)){if(!G)return console.error("Found zombie joystick with ID "+p),void O.manager.removeIdentifier(p);if(S.dynamicPage){var V=G.el.getBoundingClientRect();G.position={x:U.x+V.left,y:U.y+V.top}}G.identifier=p;var w=G.options.size/2,o={x:H.pageX,y:H.pageY};S.lockX&&(o.y=G.position.y),S.lockY&&(o.x=G.position.x);var h,a,j,e,X,E,y,T,K,b,D=t(o,G.position),F=(h=o,j=(a=G.position).x-h.x,e=a.y-h.y,function(H){return H*(180/Math.PI)}(Math.atan2(e,j))),Y=q(F),l=D/w,d={distance:D,position:o};if("circle"===G.options.shape?(X=Math.min(D,w),y=G.position,T=X,b={x:0,y:0},K=q(K=F),b.x=y.x-T*Math.cos(K),b.y=y.y-T*Math.sin(K),E=b):(E=function(H,O,S){return{x:Math.min(Math.max(H.x,O.x-S),O.x+S),y:Math.min(Math.max(H.y,O.y-S),O.y+S)}}(o,G.position,w),X=t(E,G.position)),S.follow){if(D>w){var v=o.x-E.x,z=o.y-E.y;G.position.x+=v,G.position.y+=z,G.el.style.top=G.position.y-(O.box.top+U.y)+"px",G.el.style.left=G.position.x-(O.box.left+U.x)+"px",D=t(o,G.position)}}else o=E,D=X;var m=o.x-G.position.x,r=o.y-G.position.y;G.frontPosition={x:m,y:r},S.dataOnly||(G.ui.front.style.transform="translate("+m+"px,"+r+"px)");var W={identifier:G.identifier,position:o,force:l,pressure:H.force||H.pressure||H.webkitForce||0,distance:D,angle:{radian:Y,degree:F},vector:{x:m/w,y:-r/w},raw:d,instance:G,lockX:S.lockX,lockY:S.lockY};(W=G.computeDirection(W)).angle={radian:q(180-F),degree:180-F},G.trigger("move",W),O.trigger("move "+G.id+":move",W)}else this.processOnEnd(H)},m.prototype.processOnEnd=function(H){var O=this,S=O.options,t=O.manager.getIdentifier(H),q=O.nipples.get(t),p=O.manager.removeIdentifier(q.identifier);q&&(S.dataOnly||q.hide((function(){"dynamic"===S.mode&&(q.trigger("removed",q),O.trigger("removed "+q.id+":removed",q),O.manager.trigger("removed "+q.id+":removed",q),q.destroy())})),clearInterval(O.pressureIntervals[q.identifier]),q.resetDirection(),q.trigger("end",q),O.trigger("end "+q.id+":end",q),O.ids.indexOf(q.identifier)>=0&&O.ids.splice(O.ids.indexOf(q.identifier),1),O.actives.indexOf(q)>=0&&O.actives.splice(O.actives.indexOf(q),1),/(semi|static)/.test(S.mode)?O.idles.push(q):O.nipples.indexOf(q)>=0&&O.nipples.splice(O.nipples.indexOf(q),1),O.manager.unbindDocument(),/(semi|static)/.test(S.mode)&&(O.manager.ids[p.id]=p.identifier))},m.prototype.onDestroyed=function(H,O){var S=this;S.nipples.indexOf(O)>=0&&S.nipples.splice(S.nipples.indexOf(O),1),S.actives.indexOf(O)>=0&&S.actives.splice(S.actives.indexOf(O),1),S.idles.indexOf(O)>=0&&S.idles.splice(S.idles.indexOf(O),1),S.ids.indexOf(O.identifier)>=0&&S.ids.splice(S.ids.indexOf(O.identifier),1),S.manager.removeIdentifier(O.identifier),S.manager.unbindDocument()},m.prototype.destroy=function(){var H=this;for(var O in H.unbindEvt(H.options.zone,"start"),H.nipples.forEach((function(H){H.destroy()})),H.pressureIntervals)H.pressureIntervals.hasOwnProperty(O)&&clearInterval(H.pressureIntervals[O]);H.trigger("destroyed",H.nipples),H.manager.unbindDocument(),H.off()};const r=m;function W(H){var O=this;O.ids={},O.index=0,O.collections=[],O.scroll=o(),O.config(H),O.prepareCollections();var S=function(){var H;O.collections.forEach((function(S){S.forEach((function(S){H=S.el.getBoundingClientRect(),S.position={x:O.scroll.x+H.left,y:O.scroll.y+H.top}}))}))};U(window,"resize",(function(){G(S)}));var t=function(){O.scroll=o()};return U(window,"scroll",(function(){G(t)})),O.collections}W.prototype=new d,W.constructor=W,W.prototype.prepareCollections=function(){var H=this;H.collections.create=H.create.bind(H),H.collections.on=H.on.bind(H),H.collections.off=H.off.bind(H),H.collections.destroy=H.destroy.bind(H),H.collections.get=function(O){var S;return H.collections.every((function(H){return!(S=H.get(O))})),S}},W.prototype.create=function(H){return this.createCollection(H)},W.prototype.createCollection=function(H){var O=this,S=new r(O,H);return O.bindCollection(S),O.collections.push(S),S},W.prototype.bindCollection=function(H){var O,S=this,t=function(H,t){O=H.type+" "+t.id+":"+H.type,S.trigger(O,t)};H.on("destroyed",S.onDestroyed.bind(S)),H.on("shown hidden rested dir plain",t),H.on("dir:up dir:right dir:down dir:left",t),H.on("plain:up plain:right plain:down plain:left",t)},W.prototype.bindDocument=function(){var H=this;H.binded||(H.bindEvt(document,"move").bindEvt(document,"end"),H.binded=!0)},W.prototype.unbindDocument=function(H){var O=this;Object.keys(O.ids).length&&!0!==H||(O.unbindEvt(document,"move").unbindEvt(document,"end"),O.binded=!1)},W.prototype.getIdentifier=function(H){var O;return H?void 0===(O=void 0===H.identifier?H.pointerId:H.identifier)&&(O=this.latest||0):O=this.index,void 0===this.ids[O]&&(this.ids[O]=this.index,this.index+=1),this.latest=O,this.ids[O]},W.prototype.removeIdentifier=function(H){var O={};for(var S in this.ids)if(this.ids[S]===H){O.id=S,O.identifier=this.ids[S],delete this.ids[S];break}return O},W.prototype.onmove=function(H){return this.onAny("move",H),!1},W.prototype.onend=function(H){return this.onAny("end",H),!1},W.prototype.oncancel=function(H){return this.onAny("end",H),!1},W.prototype.onAny=function(H,O){var S,t=this,q="processOn"+H.charAt(0).toUpperCase()+H.slice(1);O=w(O);var p=function(H,O,S){S.ids.indexOf(O)>=0&&(S[q](H),H._found_=!0)};return X(O,(function(H){S=t.getIdentifier(H),X(t.collections,p.bind(null,H,S)),H._found_||t.removeIdentifier(S)})),!1},W.prototype.destroy=function(){var H=this;H.unbindDocument(!0),H.ids={},H.index=0,H.collections.forEach((function(H){H.destroy()})),H.off()},W.prototype.onDestroyed=function(H,O){var S=this;if(S.collections.indexOf(O)<0)return!1;S.collections.splice(S.collections.indexOf(O),1)};var g=new W;const N={create:function(H){return g.create(H)},factory:g};return O.default})(),H.exports=O()},12434:(H,O,S)=>{"use strict";const{Deflate:t,deflate:q,deflateRaw:p,gzip:G}=S(12441),{Inflate:U,inflate:V,inflateRaw:w,ungzip:o}=S(12502),h=S(12480);H.exports.Deflate=t,H.exports.deflate=q,H.exports.deflateRaw=p,H.exports.gzip=G,H.exports.Inflate=U,H.exports.inflate=V,H.exports.inflateRaw=w,H.exports.ungzip=o,H.exports.constants=h},12441:(H,O,S)=>{"use strict";const t=S(12444),q=S(12487),p=S(12493),G=S(12473),U=S(12495),V=Object.prototype.toString,{Z_NO_FLUSH:w,Z_SYNC_FLUSH:o,Z_FULL_FLUSH:h,Z_FINISH:a,Z_OK:j,Z_STREAM_END:e,Z_DEFAULT_COMPRESSION:X,Z_DEFAULT_STRATEGY:E,Z_DEFLATED:y}=S(12480);function T(H){this.options=q.assign({level:X,method:y,JH:16384,windowBits:15,memLevel:8,strategy:E},H||{});let O=this.options;O.raw&&O.windowBits>0?O.windowBits=-O.windowBits:O.gzip&&O.windowBits>0&&O.windowBits<16&&(O.windowBits+=16),this.err=0,this.wO="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;let S=t.deflateInit2(this.strm,O.level,O.method,O.windowBits,O.memLevel,O.strategy);if(S!==j)throw new Error(G[S]);if(O.header&&t.deflateSetHeader(this.strm,O.header),O.dictionary){let H;if(H="string"===typeof O.dictionary?p.string2buf(O.dictionary):"[object ArrayBuffer]"===V.call(O.dictionary)?new Uint8Array(O.dictionary):O.dictionary,S=t.deflateSetDictionary(this.strm,H),S!==j)throw new Error(G[S]);this._dict_set=!0}}function K(H,O){const S=new T(O);if(S.push(H,!0),S.err)throw S.wO||G[S.err];return S.result}T.prototype.push=function(H,O){const S=this.strm,q=this.options.JH;let G,U;if(this.ended)return!1;for(U=O===~~O?O:!0===O?a:w,"string"===typeof H?S.input=p.string2buf(H):"[object ArrayBuffer]"===V.call(H)?S.input=new Uint8Array(H):S.input=H,S.next_in=0,S.avail_in=S.input.length;;)if(0===S.avail_out&&(S.output=new Uint8Array(q),S.next_out=0,S.avail_out=q),(U===o||U===h)&&S.avail_out<=6)this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;else{if(G=t.deflate(S,U),G===e)return S.next_out>0&&this.onData(S.output.subarray(0,S.next_out)),G=t.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===j;if(0!==S.avail_out){if(U>0&&S.next_out>0)this.onData(S.output.subarray(0,S.next_out)),S.avail_out=0;else if(0===S.avail_in)break}else this.onData(S.output)}return!0},T.prototype.onData=function(H){this.chunks.push(H)},T.prototype.onEnd=function(H){H===j&&(this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.wO=this.strm.wO},H.exports.Deflate=T,H.exports.deflate=K,H.exports.deflateRaw=function(H,O){return(O=O||{}).raw=!0,K(H,O)},H.exports.gzip=function(H,O){return(O=O||{}).gzip=!0,K(H,O)},H.exports.constants=S(12480)},12502:(H,O,S)=>{"use strict";const t=S(12507),q=S(12487),p=S(12493),G=S(12473),U=S(12495),V=S(12530),w=Object.prototype.toString,{Z_NO_FLUSH:o,Z_FINISH:h,Z_OK:a,Z_STREAM_END:j,Z_NEED_DICT:e,Z_STREAM_ERROR:X,Z_DATA_ERROR:E,Z_MEM_ERROR:y}=S(12480);function T(H){this.options=q.assign({JH:65536,windowBits:15,to:""},H||{});const O=this.options;O.raw&&O.windowBits>=0&&O.windowBits<16&&(O.windowBits=-O.windowBits,0===O.windowBits&&(O.windowBits=-15)),!(O.windowBits>=0&&O.windowBits<16)||H&&H.windowBits||(O.windowBits+=32),O.windowBits>15&&O.windowBits<48&&0===(15&O.windowBits)&&(O.windowBits|=15),this.err=0,this.wO="",this.ended=!1,this.chunks=[],this.strm=new U,this.strm.avail_out=0;let S=t.inflateInit2(this.strm,O.windowBits);if(S!==a)throw new Error(G[S]);if(this.header=new V,t.inflateGetHeader(this.strm,this.header),O.dictionary&&("string"===typeof O.dictionary?O.dictionary=p.string2buf(O.dictionary):"[object ArrayBuffer]"===w.call(O.dictionary)&&(O.dictionary=new Uint8Array(O.dictionary)),O.raw&&(S=t.inflateSetDictionary(this.strm,O.dictionary),S!==a)))throw new Error(G[S])}function K(H,O){const S=new T(O);if(S.push(H),S.err)throw S.wO||G[S.err];return S.result}T.prototype.push=function(H,O){const S=this.strm,q=this.options.JH,G=this.options.dictionary;let U,V,T;if(this.ended)return!1;for(V=O===~~O?O:!0===O?h:o,"[object ArrayBuffer]"===w.call(H)?S.input=new Uint8Array(H):S.input=H,S.next_in=0,S.avail_in=S.input.length;;){for(0===S.avail_out&&(S.output=new Uint8Array(q),S.next_out=0,S.avail_out=q),U=t.inflate(S,V),U===e&&G&&(U=t.inflateSetDictionary(S,G),U===a?U=t.inflate(S,V):U===E&&(U=e));S.avail_in>0&&U===j&&S.state.wrap>0&&0!==H[S.next_in];)t.inflateReset(S),U=t.inflate(S,V);switch(U){case X:case E:case e:case y:return this.onEnd(U),this.ended=!0,!1}if(T=S.avail_out,S.next_out&&(0===S.avail_out||U===j))if("string"===this.options.to){let H=p.utf8border(S.output,S.next_out),O=S.next_out-H,t=p.buf2string(S.output,H);S.next_out=O,S.avail_out=q-O,O&&S.output.set(S.output.subarray(H,H+O),0),this.onData(t)}else this.onData(S.output.length===S.next_out?S.output:S.output.subarray(0,S.next_out));if(U!==a||0!==T){if(U===j)return U=t.inflateEnd(this.strm),this.onEnd(U),this.ended=!0,!0;if(0===S.avail_in)break}}return!0},T.prototype.onData=function(H){this.chunks.push(H)},T.prototype.onEnd=function(H){H===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.wO=this.strm.wO},H.exports.Inflate=T,H.exports.inflate=K,H.exports.inflateRaw=function(H,O){return(O=O||{}).raw=!0,K(H,O)},H.exports.ungzip=K,H.exports.constants=S(12480)},12487:H=>{"use strict";const O=(H,O)=>Object.prototype.hasOwnProperty.call(H,O);H.exports.assign=function(H){const S=Array.prototype.slice.call(arguments,1);for(;S.length;){const t=S.shift();if(t){if("object"!==typeof t)throw new TypeError(t+"must be non-object");for(const S in t)O(t,S)&&(H[S]=t[S])}}return H},H.exports.flattenChunks=H=>{let O=0;for(let t=0,q=H.length;t<q;t++)O+=H[t].length;const S=new Uint8Array(O);for(let t=0,q=0,p=H.length;t<p;t++){let O=H[t];S.set(O,q),q+=O.length}return S}},12493:H=>{"use strict";let O=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){O=!1}const S=new Uint8Array(256);for(let q=0;q<256;q++)S[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;S[254]=S[254]=1,H.exports.string2buf=H=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(H);let O,S,t,q,p,G=H.length,U=0;for(q=0;q<G;q++)S=H.charCodeAt(q),55296===(64512&S)&&q+1<G&&(t=H.charCodeAt(q+1),56320===(64512&t)&&(S=65536+(S-55296<<10)+(t-56320),q++)),U+=S<128?1:S<2048?2:S<65536?3:4;for(O=new Uint8Array(U),p=0,q=0;p<U;q++)S=H.charCodeAt(q),55296===(64512&S)&&q+1<G&&(t=H.charCodeAt(q+1),56320===(64512&t)&&(S=65536+(S-55296<<10)+(t-56320),q++)),S<128?O[p++]=S:S<2048?(O[p++]=192|S>>>6,O[p++]=128|63&S):S<65536?(O[p++]=224|S>>>12,O[p++]=128|S>>>6&63,O[p++]=128|63&S):(O[p++]=240|S>>>18,O[p++]=128|S>>>12&63,O[p++]=128|S>>>6&63,O[p++]=128|63&S);return O};H.exports.buf2string=(H,t)=>{const q=t||H.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(H.subarray(0,t));let p,G;const U=new Array(2*q);for(G=0,p=0;p<q;){let O=H[p++];if(O<128){U[G++]=O;continue}let t=S[O];if(t>4)U[G++]=65533,p+=t-1;else{for(O&=2===t?31:3===t?15:7;t>1&&p<q;)O=O<<6|63&H[p++],t--;t>1?U[G++]=65533:O<65536?U[G++]=O:(O-=65536,U[G++]=55296|O>>10&1023,U[G++]=56320|1023&O)}}return((H,S)=>{if(S<65534&&H.subarray&&O)return String.fromCharCode.apply(null,H.length===S?H:H.subarray(0,S));let t="";for(let O=0;O<S;O++)t+=String.fromCharCode(H[O]);return t})(U,G)},H.exports.utf8border=(H,O)=>{(O=O||H.length)>H.length&&(O=H.length);let t=O-1;for(;t>=0&&128===(192&H[t]);)t--;return t<0||0===t?O:t+S[H[t]]>O?t:O}},12456:H=>{"use strict";H.exports=(H,O,S,t)=>{let q=65535&H,p=H>>>16&65535,G=0;for(;0!==S;){G=S>2e3?2e3:S,S-=G;do{q=q+O[t++]|0,p=p+q|0}while(--G);q%=65521,p%=65521}return q|p<<16}},12480:H=>{"use strict";H.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12465:H=>{"use strict";const O=new Uint32Array((()=>{let H,O=[];for(var S=0;S<256;S++){H=S;for(var t=0;t<8;t++)H=1&H?3988292384^H>>>1:H>>>1;O[S]=H}return O})());H.exports=(H,S,t,q)=>{const p=O,G=q+t;H^=-1;for(let O=q;O<G;O++)H=H>>>8^p[255&(H^S[O])];return~H}},12444:(H,O,S)=>{"use strict";const{_tr_init:t,_tr_stored_block:q,_tr_flush_block:p,_tr_tally:G,_tr_align:U}=S(12452),V=S(12456),w=S(12465),o=S(12473),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:a,Z_FULL_FLUSH:j,Z_FINISH:e,Z_BLOCK:X,Z_OK:E,Z_STREAM_END:y,Z_STREAM_ERROR:T,Z_DATA_ERROR:K,Z_BUF_ERROR:b,Z_DEFAULT_COMPRESSION:D,Z_FILTERED:F,Z_HUFFMAN_ONLY:Y,Z_RLE:l,Z_FIXED:d,Z_DEFAULT_STRATEGY:v,Z_UNKNOWN:z,Z_DEFLATED:m}=S(12480),r=258,W=262,g=103,N=113,x=666,k=(H,O)=>(H.wO=o[O],O),A=H=>(H<<1)-(H>4?9:0),u=H=>{let O=H.length;for(;--O>=0;)H[O]=0};let J=(H,O,S)=>(O<<H.hash_shift^S)&H.hash_mask;const P=H=>{const O=H.state;let S=O.pending;S>H.avail_out&&(S=H.avail_out),0!==S&&(H.output.set(O.pending_buf.subarray(O.pending_out,O.pending_out+S),H.next_out),H.next_out+=S,O.pending_out+=S,H.total_out+=S,H.avail_out-=S,O.pending-=S,0===O.pending&&(O.pending_out=0))},f=(H,O)=>{p(H,H.block_start>=0?H.block_start:-1,H.strstart-H.block_start,O),H.block_start=H.strstart,P(H.strm)},c=(H,O)=>{H.pending_buf[H.pending++]=O},R=(H,O)=>{H.pending_buf[H.pending++]=O>>>8&255,H.pending_buf[H.pending++]=255&O},B=(H,O,S,t)=>{let q=H.avail_in;return q>t&&(q=t),0===q?0:(H.avail_in-=q,O.set(H.input.subarray(H.next_in,H.next_in+q),S),1===H.state.wrap?H.adler=V(H.adler,O,q,S):2===H.state.wrap&&(H.adler=w(H.adler,O,q,S)),H.next_in+=q,H.total_in+=q,q)},Z=(H,O)=>{let S,t,q=H.max_chain_length,p=H.strstart,G=H.prev_length,U=H.nice_match;const V=H.strstart>H.w_size-W?H.strstart-(H.w_size-W):0,w=H.window,o=H.w_mask,h=H.prev,a=H.strstart+r;let j=w[p+G-1],e=w[p+G];H.prev_length>=H.good_match&&(q>>=2),U>H.lookahead&&(U=H.lookahead);do{if(S=O,w[S+G]===e&&w[S+G-1]===j&&w[S]===w[p]&&w[++S]===w[p+1]){p+=2,S++;do{}while(w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&w[++p]===w[++S]&&p<a);if(t=r-(a-p),p=a-r,t>G){if(H.match_start=O,G=t,t>=U)break;j=w[p+G-1],e=w[p+G]}}}while((O=h[O&o])>V&&0!==--q);return G<=H.lookahead?G:H.lookahead},I=H=>{const O=H.w_size;let S,t,q,p,G;do{if(p=H.window_size-H.lookahead-H.strstart,H.strstart>=O+(O-W)){H.window.set(H.window.subarray(O,O+O),0),H.match_start-=O,H.strstart-=O,H.block_start-=O,t=H.hash_size,S=t;do{q=H.head[--S],H.head[S]=q>=O?q-O:0}while(--t);t=O,S=t;do{q=H.prev[--S],H.prev[S]=q>=O?q-O:0}while(--t);p+=O}if(0===H.strm.avail_in)break;if(t=B(H.strm,H.window,H.strstart+H.lookahead,p),H.lookahead+=t,H.lookahead+H.insert>=3)for(G=H.strstart-H.insert,H.ins_h=H.window[G],H.ins_h=J(H,H.ins_h,H.window[G+1]);H.insert&&(H.ins_h=J(H,H.ins_h,H.window[G+3-1]),H.prev[G&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=G,G++,H.insert--,!(H.lookahead+H.insert<3)););}while(H.lookahead<W&&0!==H.strm.avail_in)},s=(H,O)=>{let S,t;for(;;){if(H.lookahead<W){if(I(H),H.lookahead<W&&O===h)return 1;if(0===H.lookahead)break}if(S=0,H.lookahead>=3&&(H.ins_h=J(H,H.ins_h,H.window[H.strstart+3-1]),S=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),0!==S&&H.strstart-S<=H.w_size-W&&(H.match_length=Z(H,S)),H.match_length>=3)if(t=G(H,H.strstart-H.match_start,H.match_length-3),H.lookahead-=H.match_length,H.match_length<=H.max_lazy_match&&H.lookahead>=3){H.match_length--;do{H.strstart++,H.ins_h=J(H,H.ins_h,H.window[H.strstart+3-1]),S=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart}while(0!==--H.match_length);H.strstart++}else H.strstart+=H.match_length,H.match_length=0,H.ins_h=H.window[H.strstart],H.ins_h=J(H,H.ins_h,H.window[H.strstart+1]);else t=G(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++;if(t&&(f(H,!1),0===H.strm.avail_out))return 1}return H.insert=H.strstart<2?H.strstart:2,O===e?(f(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(f(H,!1),0===H.strm.avail_out)?1:2},i=(H,O)=>{let S,t,q;for(;;){if(H.lookahead<W){if(I(H),H.lookahead<W&&O===h)return 1;if(0===H.lookahead)break}if(S=0,H.lookahead>=3&&(H.ins_h=J(H,H.ins_h,H.window[H.strstart+3-1]),S=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart),H.prev_length=H.match_length,H.prev_match=H.match_start,H.match_length=2,0!==S&&H.prev_length<H.max_lazy_match&&H.strstart-S<=H.w_size-W&&(H.match_length=Z(H,S),H.match_length<=5&&(H.strategy===F||3===H.match_length&&H.strstart-H.match_start>4096)&&(H.match_length=2)),H.prev_length>=3&&H.match_length<=H.prev_length){q=H.strstart+H.lookahead-3,t=G(H,H.strstart-1-H.prev_match,H.prev_length-3),H.lookahead-=H.prev_length-1,H.prev_length-=2;do{++H.strstart<=q&&(H.ins_h=J(H,H.ins_h,H.window[H.strstart+3-1]),S=H.prev[H.strstart&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=H.strstart)}while(0!==--H.prev_length);if(H.match_available=0,H.match_length=2,H.strstart++,t&&(f(H,!1),0===H.strm.avail_out))return 1}else if(H.match_available){if(t=G(H,0,H.window[H.strstart-1]),t&&f(H,!1),H.strstart++,H.lookahead--,0===H.strm.avail_out)return 1}else H.match_available=1,H.strstart++,H.lookahead--}return H.match_available&&(t=G(H,0,H.window[H.strstart-1]),H.match_available=0),H.insert=H.strstart<2?H.strstart:2,O===e?(f(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(f(H,!1),0===H.strm.avail_out)?1:2};function M(H,O,S,t,q){this.good_length=H,this.max_lazy=O,this.nice_length=S,this.max_chain=t,this.func=q}const C=[new M(0,0,0,0,((H,O)=>{let S=65535;for(S>H.pending_buf_size-5&&(S=H.pending_buf_size-5);;){if(H.lookahead<=1){if(I(H),0===H.lookahead&&O===h)return 1;if(0===H.lookahead)break}H.strstart+=H.lookahead,H.lookahead=0;const t=H.block_start+S;if((0===H.strstart||H.strstart>=t)&&(H.lookahead=H.strstart-t,H.strstart=t,f(H,!1),0===H.strm.avail_out))return 1;if(H.strstart-H.block_start>=H.w_size-W&&(f(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,O===e?(f(H,!0),0===H.strm.avail_out?3:4):(H.strstart>H.block_start&&(f(H,!1),H.strm.avail_out),1)})),new M(4,4,8,4,s),new M(4,5,16,8,s),new M(4,6,32,32,s),new M(4,4,16,16,i),new M(8,16,32,32,i),new M(8,16,128,128,i),new M(8,32,128,256,i),new M(32,128,258,1024,i),new M(32,258,258,4096,i)];function n(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),u(this.dyn_ltree),u(this.dyn_dtree),u(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),u(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),u(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=H=>{if(!H||!H.state)return k(H,T);H.total_in=H.total_out=0,H.data_type=z;const O=H.state;return O.pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?42:N,H.adler=2===O.wrap?0:1,O.last_flush=h,t(O),E},L=H=>{const O=Q(H);var S;return O===E&&((S=H.state).window_size=2*S.w_size,u(S.head),S.max_lazy_match=C[S.level].max_lazy,S.good_match=C[S.level].good_length,S.nice_match=C[S.level].nice_length,S.max_chain_length=C[S.level].max_chain,S.strstart=0,S.block_start=0,S.lookahead=0,S.insert=0,S.match_length=S.prev_length=2,S.match_available=0,S.ins_h=0),O},HH=(H,O,S,t,q,p)=>{if(!H)return T;let G=1;if(O===D&&(O=6),t<0?(G=0,t=-t):t>15&&(G=2,t-=16),q<1||q>9||S!==m||t<8||t>15||O<0||O>9||p<0||p>d)return k(H,T);8===t&&(t=9);const U=new n;return H.state=U,U.strm=H,U.wrap=G,U.gzhead=null,U.w_bits=t,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=q+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+3-1)/3),U.window=new Uint8Array(2*U.w_size),U.head=new Uint16Array(U.hash_size),U.prev=new Uint16Array(U.w_size),U.lit_bufsize=1<<q+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new Uint8Array(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=O,U.strategy=p,U.method=S,L(H)};H.exports.deflateInit=(H,O)=>HH(H,O,m,15,8,v),H.exports.deflateInit2=HH,H.exports.deflateReset=L,H.exports.deflateResetKeep=Q,H.exports.deflateSetHeader=(H,O)=>H&&H.state?2!==H.state.wrap?T:(H.state.gzhead=O,E):T,H.exports.deflate=(H,O)=>{let S,t;if(!H||!H.state||O>X||O<0)return H?k(H,T):T;const p=H.state;if(!H.output||!H.input&&0!==H.avail_in||p.status===x&&O!==e)return k(H,0===H.avail_out?b:T);p.strm=H;const V=p.last_flush;if(p.last_flush=O,42===p.status)if(2===p.wrap)H.adler=0,c(p,31),c(p,139),c(p,8),p.gzhead?(c(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),c(p,255&p.gzhead.time),c(p,p.gzhead.time>>8&255),c(p,p.gzhead.time>>16&255),c(p,p.gzhead.time>>24&255),c(p,9===p.level?2:p.strategy>=Y||p.level<2?4:0),c(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(c(p,255&p.gzhead.extra.length),c(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(H.adler=w(H.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(c(p,0),c(p,0),c(p,0),c(p,0),c(p,0),c(p,9===p.level?2:p.strategy>=Y||p.level<2?4:0),c(p,3),p.status=N);else{let O=m+(p.w_bits-8<<4)<<8,S=-1;S=p.strategy>=Y||p.level<2?0:p.level<6?1:6===p.level?2:3,O|=S<<6,0!==p.strstart&&(O|=32),O+=31-O%31,p.status=N,R(p,O),0!==p.strstart&&(R(p,H.adler>>>16),R(p,65535&H.adler)),H.adler=1}if(69===p.status)if(p.gzhead.extra){for(S=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),P(H),S=p.pending,p.pending!==p.pending_buf_size));)c(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(73===p.status)if(p.gzhead.name){S=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),P(H),S=p.pending,p.pending===p.pending_buf_size)){t=1;break}t=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,c(p,t)}while(0!==t);p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),0===t&&(p.gzindex=0,p.status=91)}else p.status=91;if(91===p.status)if(p.gzhead.comment){S=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),P(H),S=p.pending,p.pending===p.pending_buf_size)){t=1;break}t=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,c(p,t)}while(0!==t);p.gzhead.hcrc&&p.pending>S&&(H.adler=w(H.adler,p.pending_buf,p.pending-S,S)),0===t&&(p.status=g)}else p.status=g;if(p.status===g&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&P(H),p.pending+2<=p.pending_buf_size&&(c(p,255&H.adler),c(p,H.adler>>8&255),H.adler=0,p.status=N)):p.status=N),0!==p.pending){if(P(H),0===H.avail_out)return p.last_flush=-1,E}else if(0===H.avail_in&&A(O)<=A(V)&&O!==e)return k(H,b);if(p.status===x&&0!==H.avail_in)return k(H,b);if(0!==H.avail_in||0!==p.lookahead||O!==h&&p.status!==x){let S=p.strategy===Y?((H,O)=>{let S;for(;;){if(0===H.lookahead&&(I(H),0===H.lookahead)){if(O===h)return 1;break}if(H.match_length=0,S=G(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,S&&(f(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,O===e?(f(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(f(H,!1),0===H.strm.avail_out)?1:2})(p,O):p.strategy===l?((H,O)=>{let S,t,q,p;const U=H.window;for(;;){if(H.lookahead<=r){if(I(H),H.lookahead<=r&&O===h)return 1;if(0===H.lookahead)break}if(H.match_length=0,H.lookahead>=3&&H.strstart>0&&(q=H.strstart-1,t=U[q],t===U[++q]&&t===U[++q]&&t===U[++q])){p=H.strstart+r;do{}while(t===U[++q]&&t===U[++q]&&t===U[++q]&&t===U[++q]&&t===U[++q]&&t===U[++q]&&t===U[++q]&&t===U[++q]&&q<p);H.match_length=r-(p-q),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=3?(S=G(H,1,H.match_length-3),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(S=G(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),S&&(f(H,!1),0===H.strm.avail_out))return 1}return H.insert=0,O===e?(f(H,!0),0===H.strm.avail_out?3:4):H.last_lit&&(f(H,!1),0===H.strm.avail_out)?1:2})(p,O):C[p.level].func(p,O);if(3!==S&&4!==S||(p.status=x),1===S||3===S)return 0===H.avail_out&&(p.last_flush=-1),E;if(2===S&&(O===a?U(p):O!==X&&(q(p,0,0,!1),O===j&&(u(p.head),0===p.lookahead&&(p.strstart=0,p.block_start=0,p.insert=0))),P(H),0===H.avail_out))return p.last_flush=-1,E}return O!==e?E:p.wrap<=0?y:(2===p.wrap?(c(p,255&H.adler),c(p,H.adler>>8&255),c(p,H.adler>>16&255),c(p,H.adler>>24&255),c(p,255&H.total_in),c(p,H.total_in>>8&255),c(p,H.total_in>>16&255),c(p,H.total_in>>24&255)):(R(p,H.adler>>>16),R(p,65535&H.adler)),P(H),p.wrap>0&&(p.wrap=-p.wrap),0!==p.pending?E:y)},H.exports.deflateEnd=H=>{if(!H||!H.state)return T;const O=H.state.status;return 42!==O&&69!==O&&73!==O&&91!==O&&O!==g&&O!==N&&O!==x?k(H,T):(H.state=null,O===N?k(H,K):E)},H.exports.deflateSetDictionary=(H,O)=>{let S=O.length;if(!H||!H.state)return T;const t=H.state,q=t.wrap;if(2===q||1===q&&42!==t.status||t.lookahead)return T;if(1===q&&(H.adler=V(H.adler,O,S,0)),t.wrap=0,S>=t.w_size){0===q&&(u(t.head),t.strstart=0,t.block_start=0,t.insert=0);let H=new Uint8Array(t.w_size);H.set(O.subarray(S-t.w_size,S),0),O=H,S=t.w_size}const p=H.avail_in,G=H.next_in,U=H.input;for(H.avail_in=S,H.next_in=0,H.input=O,I(t);t.lookahead>=3;){let H=t.strstart,O=t.lookahead-2;do{t.ins_h=J(t,t.ins_h,t.window[H+3-1]),t.prev[H&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=H,H++}while(--O);t.strstart=H,t.lookahead=2,I(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=2,t.match_available=0,H.next_in=G,H.input=U,H.avail_in=p,t.wrap=q,E},H.exports.deflateInfo="pako deflate (from Nodeca project)"},12530:H=>{"use strict";H.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12515:H=>{"use strict";H.exports=function(H,O){let S,t,q,p,G,U,V,w,o,h,a,j,e,X,E,y,T,K,b,D,F,Y,l,d;const v=H.state;S=H.next_in,l=H.input,t=S+(H.avail_in-5),q=H.next_out,d=H.output,p=q-(O-H.avail_out),G=q+(H.avail_out-257),U=v.dmax,V=v.wsize,w=v.whave,o=v.wnext,h=v.window,a=v.hold,j=v.bits,e=v.lencode,X=v.distcode,E=(1<<v.lenbits)-1,y=(1<<v.distbits)-1;H:do{j<15&&(a+=l[S++]<<j,j+=8,a+=l[S++]<<j,j+=8),T=e[a&E];O:for(;;){if(K=T>>>24,a>>>=K,j-=K,K=T>>>16&255,0===K)d[q++]=65535&T;else{if(!(16&K)){if(0===(64&K)){T=e[(65535&T)+(a&(1<<K)-1)];continue O}if(32&K){v.mode=12;break H}H.wO="invalid literal/length code",v.mode=30;break H}b=65535&T,K&=15,K&&(j<K&&(a+=l[S++]<<j,j+=8),b+=a&(1<<K)-1,a>>>=K,j-=K),j<15&&(a+=l[S++]<<j,j+=8,a+=l[S++]<<j,j+=8),T=X[a&y];S:for(;;){if(K=T>>>24,a>>>=K,j-=K,K=T>>>16&255,!(16&K)){if(0===(64&K)){T=X[(65535&T)+(a&(1<<K)-1)];continue S}H.wO="invalid distance code",v.mode=30;break H}if(D=65535&T,K&=15,j<K&&(a+=l[S++]<<j,j+=8,j<K&&(a+=l[S++]<<j,j+=8)),D+=a&(1<<K)-1,D>U){H.wO="invalid distance too far back",v.mode=30;break H}if(a>>>=K,j-=K,K=q-p,D>K){if(K=D-K,K>w&&v.sane){H.wO="invalid distance too far back",v.mode=30;break H}if(F=0,Y=h,0===o){if(F+=V-K,K<b){b-=K;do{d[q++]=h[F++]}while(--K);F=q-D,Y=d}}else if(o<K){if(F+=V+o-K,K-=o,K<b){b-=K;do{d[q++]=h[F++]}while(--K);if(F=0,o<b){K=o,b-=K;do{d[q++]=h[F++]}while(--K);F=q-D,Y=d}}}else if(F+=o-K,K<b){b-=K;do{d[q++]=h[F++]}while(--K);F=q-D,Y=d}for(;b>2;)d[q++]=Y[F++],d[q++]=Y[F++],d[q++]=Y[F++],b-=3;b&&(d[q++]=Y[F++],b>1&&(d[q++]=Y[F++]))}else{F=q-D;do{d[q++]=d[F++],d[q++]=d[F++],d[q++]=d[F++],b-=3}while(b>2);b&&(d[q++]=d[F++],b>1&&(d[q++]=d[F++]))}break}}break}}while(S<t&&q<G);b=j>>3,S-=b,j-=b<<3,a&=(1<<j)-1,H.next_in=S,H.next_out=q,H.avail_in=S<t?t-S+5:5-(S-t),H.avail_out=q<G?G-q+257:257-(q-G),v.hold=a,v.bits=j}},12507:(H,O,S)=>{"use strict";const t=S(12456),q=S(12465),p=S(12515),G=S(12522),{Z_FINISH:U,Z_BLOCK:V,Z_TREES:w,Z_OK:o,Z_STREAM_END:h,Z_NEED_DICT:a,Z_STREAM_ERROR:j,Z_DATA_ERROR:e,Z_MEM_ERROR:X,Z_BUF_ERROR:E,Z_DEFLATED:y}=S(12480),T=12,K=30,b=H=>(H>>>24&255)+(H>>>8&65280)+((65280&H)<<8)+((255&H)<<24);function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const F=H=>{if(!H||!H.state)return j;const O=H.state;return H.total_in=H.total_out=O.total=0,H.wO="",O.wrap&&(H.adler=1&O.wrap),O.mode=1,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new Int32Array(852),O.distcode=O.distdyn=new Int32Array(592),O.sane=1,O.back=-1,o},Y=H=>{if(!H||!H.state)return j;const O=H.state;return O.wsize=0,O.whave=0,O.wnext=0,F(H)},l=(H,O)=>{let S;if(!H||!H.state)return j;const t=H.state;return O<0?(S=0,O=-O):(S=1+(O>>4),O<48&&(O&=15)),O&&(O<8||O>15)?j:(null!==t.window&&t.wbits!==O&&(t.window=null),t.wrap=S,t.wbits=O,Y(H))},d=(H,O)=>{if(!H)return j;const S=new D;H.state=S,S.window=null;const t=l(H,O);return t!==o&&(H.state=null),t};let v,z,m=!0;const r=H=>{if(m){v=new Int32Array(512),z=new Int32Array(32);let O=0;for(;O<144;)H.lens[O++]=8;for(;O<256;)H.lens[O++]=9;for(;O<280;)H.lens[O++]=7;for(;O<288;)H.lens[O++]=8;for(G(1,H.lens,0,288,v,0,H.work,{bits:9}),O=0;O<32;)H.lens[O++]=5;G(2,H.lens,0,32,z,0,H.work,{bits:5}),m=!1}H.lencode=v,H.lenbits=9,H.distcode=z,H.distbits=5},W=(H,O,S,t)=>{let q;const p=H.state;return null===p.window&&(p.wsize=1<<p.wbits,p.wnext=0,p.whave=0,p.window=new Uint8Array(p.wsize)),t>=p.wsize?(p.window.set(O.subarray(S-p.wsize,S),0),p.wnext=0,p.whave=p.wsize):(q=p.wsize-p.wnext,q>t&&(q=t),p.window.set(O.subarray(S-t,S-t+q),p.wnext),(t-=q)?(p.window.set(O.subarray(S-t,S),0),p.wnext=t,p.whave=p.wsize):(p.wnext+=q,p.wnext===p.wsize&&(p.wnext=0),p.whave<p.wsize&&(p.whave+=q))),0};H.exports.inflateReset=Y,H.exports.inflateReset2=l,H.exports.inflateResetKeep=F,H.exports.inflateInit=H=>d(H,15),H.exports.inflateInit2=d,H.exports.inflate=(H,O)=>{let S,D,F,Y,l,d,v,z,m,g,N,x,k,A,u,J,P,f,c,R,B,Z,I=0;const s=new Uint8Array(4);let i,M;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!H||!H.state||!H.output||!H.input&&0!==H.avail_in)return j;S=H.state,S.mode===T&&(S.mode=13),l=H.next_out,F=H.output,v=H.avail_out,Y=H.next_in,D=H.input,d=H.avail_in,z=S.hold,m=S.bits,g=d,N=v,Z=o;H:for(;;)switch(S.mode){case 1:if(0===S.wrap){S.mode=13;break}for(;m<16;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(2&S.wrap&&35615===z){S.check=0,s[0]=255&z,s[1]=z>>>8&255,S.check=q(S.check,s,2,0),z=0,m=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&z)<<8)+(z>>8))%31){H.wO="incorrect header check",S.mode=K;break}if((15&z)!==y){H.wO="unknown compression method",S.mode=K;break}if(z>>>=4,m-=4,B=8+(15&z),0===S.wbits)S.wbits=B;else if(B>S.wbits){H.wO="invalid window size",S.mode=K;break}S.dmax=1<<S.wbits,H.adler=S.check=1,S.mode=512&z?10:T,z=0,m=0;break;case 2:for(;m<16;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(S.flags=z,(255&S.flags)!==y){H.wO="unknown compression method",S.mode=K;break}if(57344&S.flags){H.wO="unknown header flags set",S.mode=K;break}S.head&&(S.head.text=z>>8&1),512&S.flags&&(s[0]=255&z,s[1]=z>>>8&255,S.check=q(S.check,s,2,0)),z=0,m=0,S.mode=3;case 3:for(;m<32;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.head&&(S.head.time=z),512&S.flags&&(s[0]=255&z,s[1]=z>>>8&255,s[2]=z>>>16&255,s[3]=z>>>24&255,S.check=q(S.check,s,4,0)),z=0,m=0,S.mode=4;case 4:for(;m<16;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.head&&(S.head.xflags=255&z,S.head.os=z>>8),512&S.flags&&(s[0]=255&z,s[1]=z>>>8&255,S.check=q(S.check,s,2,0)),z=0,m=0,S.mode=5;case 5:if(1024&S.flags){for(;m<16;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.length=z,S.head&&(S.head.extra_len=z),512&S.flags&&(s[0]=255&z,s[1]=z>>>8&255,S.check=q(S.check,s,2,0)),z=0,m=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(x=S.length,x>d&&(x=d),x&&(S.head&&(B=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Uint8Array(S.head.extra_len)),S.head.extra.set(D.subarray(Y,Y+x),B)),512&S.flags&&(S.check=q(S.check,D,x,Y)),d-=x,Y+=x,S.length-=x),S.length))break H;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(0===d)break H;x=0;do{B=D[Y+x++],S.head&&B&&S.length<65536&&(S.head.name+=String.fromCharCode(B))}while(B&&x<d);if(512&S.flags&&(S.check=q(S.check,D,x,Y)),d-=x,Y+=x,B)break H}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(0===d)break H;x=0;do{B=D[Y+x++],S.head&&B&&S.length<65536&&(S.head.comment+=String.fromCharCode(B))}while(B&&x<d);if(512&S.flags&&(S.check=q(S.check,D,x,Y)),d-=x,Y+=x,B)break H}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;m<16;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(z!==(65535&S.check)){H.wO="header crc mismatch",S.mode=K;break}z=0,m=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),H.adler=S.check=0,S.mode=T;break;case 10:for(;m<32;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}H.adler=S.check=b(z),z=0,m=0,S.mode=11;case 11:if(0===S.havedict)return H.next_out=l,H.avail_out=v,H.next_in=Y,H.avail_in=d,S.hold=z,S.bits=m,a;H.adler=S.check=1,S.mode=T;case T:if(O===V||O===w)break H;case 13:if(S.last){z>>>=7&m,m-=7&m,S.mode=27;break}for(;m<3;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}switch(S.last=1&z,z>>>=1,m-=1,3&z){case 0:S.mode=14;break;case 1:if(r(S),S.mode=20,O===w){z>>>=2,m-=2;break H}break;case 2:S.mode=17;break;case 3:H.wO="invalid block type",S.mode=K}z>>>=2,m-=2;break;case 14:for(z>>>=7&m,m-=7&m;m<32;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if((65535&z)!==(z>>>16^65535)){H.wO="invalid stored block lengths",S.mode=K;break}if(S.length=65535&z,z=0,m=0,S.mode=15,O===w)break H;case 15:S.mode=16;case 16:if(x=S.length,x){if(x>d&&(x=d),x>v&&(x=v),0===x)break H;F.set(D.subarray(Y,Y+x),l),d-=x,Y+=x,v-=x,l+=x,S.length-=x;break}S.mode=T;break;case 17:for(;m<14;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(S.nlen=257+(31&z),z>>>=5,m-=5,S.ndist=1+(31&z),z>>>=5,m-=5,S.ncode=4+(15&z),z>>>=4,m-=4,S.nlen>286||S.ndist>30){H.wO="too many length or distance symbols",S.mode=K;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;m<3;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.lens[C[S.have++]]=7&z,z>>>=3,m-=3}for(;S.have<19;)S.lens[C[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,i={bits:S.lenbits},Z=G(0,S.lens,0,19,S.lencode,0,S.work,i),S.lenbits=i.bits,Z){H.wO="invalid code lengths set",S.mode=K;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;I=S.lencode[z&(1<<S.lenbits)-1],u=I>>>24,J=I>>>16&255,P=65535&I,!(u<=m);){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(P<16)z>>>=u,m-=u,S.lens[S.have++]=P;else{if(16===P){for(M=u+2;m<M;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(z>>>=u,m-=u,0===S.have){H.wO="invalid bit length repeat",S.mode=K;break}B=S.lens[S.have-1],x=3+(3&z),z>>>=2,m-=2}else if(17===P){for(M=u+3;m<M;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}z>>>=u,m-=u,B=0,x=3+(7&z),z>>>=3,m-=3}else{for(M=u+7;m<M;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}z>>>=u,m-=u,B=0,x=11+(127&z),z>>>=7,m-=7}if(S.have+x>S.nlen+S.ndist){H.wO="invalid bit length repeat",S.mode=K;break}for(;x--;)S.lens[S.have++]=B}}if(S.mode===K)break;if(0===S.lens[256]){H.wO="invalid code -- missing end-of-block",S.mode=K;break}if(S.lenbits=9,i={bits:S.lenbits},Z=G(1,S.lens,0,S.nlen,S.lencode,0,S.work,i),S.lenbits=i.bits,Z){H.wO="invalid literal/lengths set",S.mode=K;break}if(S.distbits=6,S.distcode=S.distdyn,i={bits:S.distbits},Z=G(2,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,i),S.distbits=i.bits,Z){H.wO="invalid distances set",S.mode=K;break}if(S.mode=20,O===w)break H;case 20:S.mode=21;case 21:if(d>=6&&v>=258){H.next_out=l,H.avail_out=v,H.next_in=Y,H.avail_in=d,S.hold=z,S.bits=m,p(H,N),l=H.next_out,F=H.output,v=H.avail_out,Y=H.next_in,D=H.input,d=H.avail_in,z=S.hold,m=S.bits,S.mode===T&&(S.back=-1);break}for(S.back=0;I=S.lencode[z&(1<<S.lenbits)-1],u=I>>>24,J=I>>>16&255,P=65535&I,!(u<=m);){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(J&&0===(240&J)){for(f=u,c=J,R=P;I=S.lencode[R+((z&(1<<f+c)-1)>>f)],u=I>>>24,J=I>>>16&255,P=65535&I,!(f+u<=m);){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}z>>>=f,m-=f,S.back+=f}if(z>>>=u,m-=u,S.back+=u,S.length=P,0===J){S.mode=26;break}if(32&J){S.back=-1,S.mode=T;break}if(64&J){H.wO="invalid literal/length code",S.mode=K;break}S.extra=15&J,S.mode=22;case 22:if(S.extra){for(M=S.extra;m<M;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.length+=z&(1<<S.extra)-1,z>>>=S.extra,m-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;I=S.distcode[z&(1<<S.distbits)-1],u=I>>>24,J=I>>>16&255,P=65535&I,!(u<=m);){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(0===(240&J)){for(f=u,c=J,R=P;I=S.distcode[R+((z&(1<<f+c)-1)>>f)],u=I>>>24,J=I>>>16&255,P=65535&I,!(f+u<=m);){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}z>>>=f,m-=f,S.back+=f}if(z>>>=u,m-=u,S.back+=u,64&J){H.wO="invalid distance code",S.mode=K;break}S.offset=P,S.extra=15&J,S.mode=24;case 24:if(S.extra){for(M=S.extra;m<M;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}S.offset+=z&(1<<S.extra)-1,z>>>=S.extra,m-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){H.wO="invalid distance too far back",S.mode=K;break}S.mode=25;case 25:if(0===v)break H;if(x=N-v,S.offset>x){if(x=S.offset-x,x>S.whave&&S.sane){H.wO="invalid distance too far back",S.mode=K;break}x>S.wnext?(x-=S.wnext,k=S.wsize-x):k=S.wnext-x,x>S.length&&(x=S.length),A=S.window}else A=F,k=l-S.offset,x=S.length;x>v&&(x=v),v-=x,S.length-=x;do{F[l++]=A[k++]}while(--x);0===S.length&&(S.mode=21);break;case 26:if(0===v)break H;F[l++]=S.length,v--,S.mode=21;break;case 27:if(S.wrap){for(;m<32;){if(0===d)break H;d--,z|=D[Y++]<<m,m+=8}if(N-=v,H.total_out+=N,S.total+=N,N&&(H.adler=S.check=S.flags?q(S.check,F,N,l-N):t(S.check,F,N,l-N)),N=v,(S.flags?z:b(z))!==S.check){H.wO="incorrect data check",S.mode=K;break}z=0,m=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;m<32;){if(0===d)break H;d--,z+=D[Y++]<<m,m+=8}if(z!==(4294967295&S.total)){H.wO="incorrect length check",S.mode=K;break}z=0,m=0}S.mode=29;case 29:Z=h;break H;case K:Z=e;break H;case 31:return X;default:return j}return H.next_out=l,H.avail_out=v,H.next_in=Y,H.avail_in=d,S.hold=z,S.bits=m,(S.wsize||N!==H.avail_out&&S.mode<K&&(S.mode<27||O!==U))&&W(H,H.output,H.next_out,N-H.avail_out)?(S.mode=31,X):(g-=H.avail_in,N-=H.avail_out,H.total_in+=g,H.total_out+=N,S.total+=N,S.wrap&&N&&(H.adler=S.check=S.flags?q(S.check,F,N,H.next_out-N):t(S.check,F,N,H.next_out-N)),H.data_type=S.bits+(S.last?64:0)+(S.mode===T?128:0)+(20===S.mode||15===S.mode?256:0),(0===g&&0===N||O===U)&&Z===o&&(Z=E),Z)},H.exports.inflateEnd=H=>{if(!H||!H.state)return j;let O=H.state;return O.window&&(O.window=null),H.state=null,o},H.exports.inflateGetHeader=(H,O)=>{if(!H||!H.state)return j;const S=H.state;return 0===(2&S.wrap)?j:(S.head=O,O.done=!1,o)},H.exports.inflateSetDictionary=(H,O)=>{const S=O.length;let q,p,G;return H&&H.state?(q=H.state,0!==q.wrap&&11!==q.mode?j:11===q.mode&&(p=1,p=t(p,O,S,0),p!==q.check)?e:(G=W(H,O,S,S),G?(q.mode=31,X):(q.havedict=1,o))):j},H.exports.inflateInfo="pako inflate (from Nodeca project)"},12522:H=>{"use strict";const O=15,S=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),t=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),p=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);H.exports=(H,G,U,V,w,o,h,a)=>{const j=a.bits;let e,X,E,y,T,K,b=0,D=0,F=0,Y=0,l=0,d=0,v=0,z=0,m=0,r=0,W=null,g=0;const N=new Uint16Array(16),x=new Uint16Array(16);let k,A,u,J=null,P=0;for(b=0;b<=O;b++)N[b]=0;for(D=0;D<V;D++)N[G[U+D]]++;for(l=j,Y=O;Y>=1&&0===N[Y];Y--);if(l>Y&&(l=Y),0===Y)return w[o++]=20971520,w[o++]=20971520,a.bits=1,0;for(F=1;F<Y&&0===N[F];F++);for(l<F&&(l=F),z=1,b=1;b<=O;b++)if(z<<=1,z-=N[b],z<0)return-1;if(z>0&&(0===H||1!==Y))return-1;for(x[1]=0,b=1;b<O;b++)x[b+1]=x[b]+N[b];for(D=0;D<V;D++)0!==G[U+D]&&(h[x[G[U+D]]++]=D);if(0===H?(W=J=h,K=19):1===H?(W=S,g-=257,J=t,P-=257,K=256):(W=q,J=p,K=-1),r=0,D=0,b=F,T=o,d=l,v=0,E=-1,m=1<<l,y=m-1,1===H&&m>852||2===H&&m>592)return 1;for(;;){k=b-v,h[D]<K?(A=0,u=h[D]):h[D]>K?(A=J[P+h[D]],u=W[g+h[D]]):(A=96,u=0),e=1<<b-v,X=1<<d,F=X;do{X-=e,w[T+(r>>v)+X]=k<<24|A<<16|u}while(0!==X);for(e=1<<b-1;r&e;)e>>=1;if(0!==e?(r&=e-1,r+=e):r=0,D++,0===--N[b]){if(b===Y)break;b=G[U+h[D]]}if(b>l&&(r&y)!==E){for(0===v&&(v=l),T+=F,d=b-v,z=1<<d;d+v<Y&&(z-=N[d+v],!(z<=0));)d++,z<<=1;if(m+=1<<d,1===H&&m>852||2===H&&m>592)return 1;E=r&y,w[E]=l<<24|d<<16|T-o}}return 0!==r&&(w[T+r]=b-v<<24|64<<16),a.bits=l,0}},12473:H=>{"use strict";H.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12452:H=>{"use strict";function O(H){let O=H.length;for(;--O>=0;)H[O]=0}const S=256,t=286,q=30,p=15,G=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),U=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),V=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),w=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);O(o);const h=new Array(60);O(h);const a=new Array(512);O(a);const j=new Array(256);O(j);const e=new Array(29);O(e);const X=new Array(q);function E(H,O,S,t,q){this.static_tree=H,this.extra_bits=O,this.extra_base=S,this.elems=t,this.max_length=q,this.has_stree=H&&H.length}let y,T,K;function b(H,O){this.dyn_tree=H,this.max_code=0,this.stat_desc=O}O(X);const D=H=>H<256?a[H]:a[256+(H>>>7)],F=(H,O)=>{H.pending_buf[H.pending++]=255&O,H.pending_buf[H.pending++]=O>>>8&255},Y=(H,O,S)=>{H.bi_valid>16-S?(H.bi_buf|=O<<H.bi_valid&65535,F(H,H.bi_buf),H.bi_buf=O>>16-H.bi_valid,H.bi_valid+=S-16):(H.bi_buf|=O<<H.bi_valid&65535,H.bi_valid+=S)},l=(H,O,S)=>{Y(H,S[2*O],S[2*O+1])},d=(H,O)=>{let S=0;do{S|=1&H,H>>>=1,S<<=1}while(--O>0);return S>>>1},v=(H,O,S)=>{const t=new Array(16);let q,G,U=0;for(q=1;q<=p;q++)t[q]=U=U+S[q-1]<<1;for(G=0;G<=O;G++){let O=H[2*G+1];0!==O&&(H[2*G]=d(t[O]++,O))}},z=H=>{let O;for(O=0;O<t;O++)H.dyn_ltree[2*O]=0;for(O=0;O<q;O++)H.dyn_dtree[2*O]=0;for(O=0;O<19;O++)H.bl_tree[2*O]=0;H.dyn_ltree[512]=1,H.opt_len=H.static_len=0,H.last_lit=H.matches=0},m=H=>{H.bi_valid>8?F(H,H.bi_buf):H.bi_valid>0&&(H.pending_buf[H.pending++]=H.bi_buf),H.bi_buf=0,H.bi_valid=0},r=(H,O,S,t)=>{const q=2*O,p=2*S;return H[q]<H[p]||H[q]===H[p]&&t[O]<=t[S]},W=(H,O,S)=>{const t=H.heap[S];let q=S<<1;for(;q<=H.heap_len&&(q<H.heap_len&&r(O,H.heap[q+1],H.heap[q],H.depth)&&q++,!r(O,t,H.heap[q],H.depth));)H.heap[S]=H.heap[q],S=q,q<<=1;H.heap[S]=t},g=(H,O,t)=>{let q,p,V,w,o=0;if(0!==H.last_lit)do{q=H.pending_buf[H.d_buf+2*o]<<8|H.pending_buf[H.d_buf+2*o+1],p=H.pending_buf[H.l_buf+o],o++,0===q?l(H,p,O):(V=j[p],l(H,V+S+1,O),w=G[V],0!==w&&(p-=e[V],Y(H,p,w)),q--,V=D(q),l(H,V,t),w=U[V],0!==w&&(q-=X[V],Y(H,q,w)))}while(o<H.last_lit);l(H,256,O)},N=(H,O)=>{const S=O.dyn_tree,t=O.stat_desc.static_tree,q=O.stat_desc.has_stree,G=O.stat_desc.elems;let U,V,w,o=-1;for(H.heap_len=0,H.heap_max=573,U=0;U<G;U++)0!==S[2*U]?(H.heap[++H.heap_len]=o=U,H.depth[U]=0):S[2*U+1]=0;for(;H.heap_len<2;)w=H.heap[++H.heap_len]=o<2?++o:0,S[2*w]=1,H.depth[w]=0,H.opt_len--,q&&(H.static_len-=t[2*w+1]);for(O.max_code=o,U=H.heap_len>>1;U>=1;U--)W(H,S,U);w=G;do{U=H.heap[1],H.heap[1]=H.heap[H.heap_len--],W(H,S,1),V=H.heap[1],H.heap[--H.heap_max]=U,H.heap[--H.heap_max]=V,S[2*w]=S[2*U]+S[2*V],H.depth[w]=(H.depth[U]>=H.depth[V]?H.depth[U]:H.depth[V])+1,S[2*U+1]=S[2*V+1]=w,H.heap[1]=w++,W(H,S,1)}while(H.heap_len>=2);H.heap[--H.heap_max]=H.heap[1],((H,O)=>{const S=O.dyn_tree,t=O.max_code,q=O.stat_desc.static_tree,G=O.stat_desc.has_stree,U=O.stat_desc.extra_bits,V=O.stat_desc.extra_base,w=O.stat_desc.max_length;let o,h,a,j,e,X,E=0;for(j=0;j<=p;j++)H.bl_count[j]=0;for(S[2*H.heap[H.heap_max]+1]=0,o=H.heap_max+1;o<573;o++)h=H.heap[o],j=S[2*S[2*h+1]+1]+1,j>w&&(j=w,E++),S[2*h+1]=j,h>t||(H.bl_count[j]++,e=0,h>=V&&(e=U[h-V]),X=S[2*h],H.opt_len+=X*(j+e),G&&(H.static_len+=X*(q[2*h+1]+e)));if(0!==E){do{for(j=w-1;0===H.bl_count[j];)j--;H.bl_count[j]--,H.bl_count[j+1]+=2,H.bl_count[w]--,E-=2}while(E>0);for(j=w;0!==j;j--)for(h=H.bl_count[j];0!==h;)a=H.heap[--o],a>t||(S[2*a+1]!==j&&(H.opt_len+=(j-S[2*a+1])*S[2*a],S[2*a+1]=j),h--)}})(H,O),v(S,o,H.bl_count)},x=(H,O,S)=>{let t,q,p=-1,G=O[1],U=0,V=7,w=4;for(0===G&&(V=138,w=3),O[2*(S+1)+1]=65535,t=0;t<=S;t++)q=G,G=O[2*(t+1)+1],++U<V&&q===G||(U<w?H.bl_tree[2*q]+=U:0!==q?(q!==p&&H.bl_tree[2*q]++,H.bl_tree[32]++):U<=10?H.bl_tree[34]++:H.bl_tree[36]++,U=0,p=q,0===G?(V=138,w=3):q===G?(V=6,w=3):(V=7,w=4))},k=(H,O,S)=>{let t,q,p=-1,G=O[1],U=0,V=7,w=4;for(0===G&&(V=138,w=3),t=0;t<=S;t++)if(q=G,G=O[2*(t+1)+1],!(++U<V&&q===G)){if(U<w)do{l(H,q,H.bl_tree)}while(0!==--U);else 0!==q?(q!==p&&(l(H,q,H.bl_tree),U--),l(H,16,H.bl_tree),Y(H,U-3,2)):U<=10?(l(H,17,H.bl_tree),Y(H,U-3,3)):(l(H,18,H.bl_tree),Y(H,U-11,7));U=0,p=q,0===G?(V=138,w=3):q===G?(V=6,w=3):(V=7,w=4)}};let A=!1;const u=(H,O,S,t)=>{Y(H,0+(t?1:0),3),((H,O,S,t)=>{m(H),t&&(F(H,S),F(H,~S)),H.pending_buf.set(H.window.subarray(O,O+S),H.pending),H.pending+=S})(H,O,S,!0)};H.exports._tr_init=H=>{A||((()=>{let H,O,S,w,b;const D=new Array(16);for(S=0,w=0;w<28;w++)for(e[w]=S,H=0;H<1<<G[w];H++)j[S++]=w;for(j[S-1]=w,b=0,w=0;w<16;w++)for(X[w]=b,H=0;H<1<<U[w];H++)a[b++]=w;for(b>>=7;w<q;w++)for(X[w]=b<<7,H=0;H<1<<U[w]-7;H++)a[256+b++]=w;for(O=0;O<=p;O++)D[O]=0;for(H=0;H<=143;)o[2*H+1]=8,H++,D[8]++;for(;H<=255;)o[2*H+1]=9,H++,D[9]++;for(;H<=279;)o[2*H+1]=7,H++,D[7]++;for(;H<=287;)o[2*H+1]=8,H++,D[8]++;for(v(o,287,D),H=0;H<q;H++)h[2*H+1]=5,h[2*H]=d(H,5);y=new E(o,G,257,t,p),T=new E(h,U,0,q,p),K=new E(new Array(0),V,0,19,7)})(),A=!0),H.l_desc=new b(H.dyn_ltree,y),H.d_desc=new b(H.dyn_dtree,T),H.bl_desc=new b(H.bl_tree,K),H.bi_buf=0,H.bi_valid=0,z(H)},H.exports._tr_stored_block=u,H.exports._tr_flush_block=(H,O,t,q)=>{let p,G,U=0;H.level>0?(2===H.strm.data_type&&(H.strm.data_type=(H=>{let O,t=4093624447;for(O=0;O<=31;O++,t>>>=1)if(1&t&&0!==H.dyn_ltree[2*O])return 0;if(0!==H.dyn_ltree[18]||0!==H.dyn_ltree[20]||0!==H.dyn_ltree[26])return 1;for(O=32;O<S;O++)if(0!==H.dyn_ltree[2*O])return 1;return 0})(H)),N(H,H.l_desc),N(H,H.d_desc),U=(H=>{let O;for(x(H,H.dyn_ltree,H.l_desc.max_code),x(H,H.dyn_dtree,H.d_desc.max_code),N(H,H.bl_desc),O=18;O>=3&&0===H.bl_tree[2*w[O]+1];O--);return H.opt_len+=3*(O+1)+5+5+4,O})(H),p=H.opt_len+3+7>>>3,G=H.static_len+3+7>>>3,G<=p&&(p=G)):p=G=t+5,t+4<=p&&-1!==O?u(H,O,t,q):4===H.strategy||G===p?(Y(H,2+(q?1:0),3),g(H,o,h)):(Y(H,4+(q?1:0),3),((H,O,S,t)=>{let q;for(Y(H,O-257,5),Y(H,S-1,5),Y(H,t-4,4),q=0;q<t;q++)Y(H,H.bl_tree[2*w[q]+1],3);k(H,H.dyn_ltree,O-1),k(H,H.dyn_dtree,S-1)})(H,H.l_desc.max_code+1,H.d_desc.max_code+1,U+1),g(H,H.dyn_ltree,H.dyn_dtree)),z(H),q&&m(H)},H.exports._tr_tally=(H,O,t)=>(H.pending_buf[H.d_buf+2*H.last_lit]=O>>>8&255,H.pending_buf[H.d_buf+2*H.last_lit+1]=255&O,H.pending_buf[H.l_buf+H.last_lit]=255&t,H.last_lit++,0===O?H.dyn_ltree[2*t]++:(H.matches++,O--,H.dyn_ltree[2*(j[t]+S+1)]++,H.dyn_dtree[2*D(O)]++),H.last_lit===H.lit_bufsize-1),H.exports._tr_align=H=>{Y(H,2,3),l(H,256,o),(H=>{16===H.bi_valid?(F(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):H.bi_valid>=8&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)})(H)}},12495:H=>{"use strict";H.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.wO="",this.state=null,this.data_type=2,this.adler=0}},12110:H=>{function O(H,O,S){for(var t=H.length,q=-1/0,p=1/0,G=0;G<t;G++){var U=(S[0][G]-H[G])/O[G],V=(S[1][G]-H[G])/O[G];if(U>V){var w=U;U=V,V=w}if(V<q||U>p)return 1/0;U>q&&(q=U),V<p&&(p=V)}return q>p?1/0:q}H.exports=function(H,S,t,q){var p=O(S,t,q);if(p===1/0)H=null;else{H=H||[];for(var G=0;G<S.length;G++)H[G]=S[G]+t[G]*p}return H},H.exports.distance=O},13481:(H,O,S)=>{"use strict";S.d(O,{d:()=>G});var t=S(22);const q=t.useLayoutEffect;const p=function(H){var O=(0,t.useRef)(H);return q((function(){O.current=H})),O};var G=function(H){var O=p(H);(0,t.GO)((function(){var H=function(H){var S;if(null!=O.current&&(S=O.current(H)),H.defaultPrevented&&(H.returnValue=""),"string"===typeof S)return H.returnValue=S,S};return window.addEventListener("beforeunload",H),function(){window.removeEventListener("beforeunload",H)}}),[])}},13442:(H,O,S)=>{"use strict";var t=S(13447),q=Array.prototype.concat,p=Array.prototype.slice,G=H.exports=function(H){for(var O=[],S=0,G=H.length;S<G;S++){var U=H[S];t(U)?O=q.call(O,p.call(U)):O.push(U)}return O};G.wrap=function(H){return function(){return H(G(arguments))}}},13447:H=>{H.exports=function(H){return!(!H||"string"===typeof H)&&(H instanceof Array||Array.isArray(H)||H.length>=0&&(H.splice instanceof Function||Object.getOwnPropertyDescriptor(H,H.length-1)&&"String"!==H.constructor.name))}},12389:(H,O,S)=>{var t=S(12395);function q(H){for(var O,S,q=0,p=H.length,G=0;G<H.length;){for(O=H[G],S=0;G<p&&H[G]===O;)++G,++S;q+=t.log2(S)/7|0,q+=t.log2(O>>>0)/7|0,q+=2}return q}O.size=q,O.encode=function(H,O){O||(O=new Uint8Array(q(H)));for(var S,t,p=0,G=O.length,U=0;U<H.length;){for(S=H[U],t=0;U<H.length&&H[U]===S;)++U,++t;for(;p<G&&t>=128;)O[p++]=128+(127&t),t>>>=7;if(p>=G)throw new Error("RLE buffer overflow");for(O[p++]=t,S>>>=0;p<G&&S>=128;)O[p++]=128+(127&S),S>>>=7;if(p>=G)throw new Error("RLE buffer overflow");O[p++]=S}return O},O.decode=function(H,O){for(var S,t,q,p,G=O.length,U=H.length,V=0,w=0;w<U;){for(S=0,t=0;w<U&&H[w]>=128;)S+=(127&H[w++])<<t,t+=7;if(S+=H[w++]<<t,w>=U)throw new Error("RLE buffer underrun");if(V+S>G)throw new Error("Chunk buffer overflow");for(q=0,t=0;w<U&&H[w]>=128;)q+=(127&H[w++])<<t,t+=7;if(w>=U)throw new Error("RLE buffer underrun");for(q+=H[w++]<<t,p=0;p<S;++p)O[V++]=q}return O}},12395:(H,O)=>{"use strict";function S(H){var O=32;return(H&=-H)&&O--,65535&H&&(O-=16),16711935&H&&(O-=8),252645135&H&&(O-=4),858993459&H&&(O-=2),1431655765&H&&(O-=1),O}O.INT_BITS=32,O.INT_MAX=2147483647,O.INT_MIN=-1<<31,O.sign=function(H){return(H>0)-(H<0)},O.abs=function(H){var O=H>>31;return(H^O)-O},O.min=function(H,O){return O^(H^O)&-(H<O)},O.max=function(H,O){return H^(H^O)&-(H<O)},O.isPow2=function(H){return!(H&H-1)&&!!H},O.log2=function(H){var O,S;return O=(H>65535)<<4,O|=S=((H>>>=O)>255)<<3,O|=S=((H>>>=S)>15)<<2,(O|=S=((H>>>=S)>3)<<1)|(H>>>=S)>>1},O.log10=function(H){return H>=1e9?9:H>=1e8?8:H>=1e7?7:H>=1e6?6:H>=1e5?5:H>=1e4?4:H>=1e3?3:H>=100?2:H>=10?1:0},O.popCount=function(H){return 16843009*((H=(858993459&(H-=H>>>1&1431655765))+(H>>>2&858993459))+(H>>>4)&252645135)>>>24},O.countTrailingZeros=S,O.nextPow2=function(H){return H+=0===H,--H,H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)+1},O.prevPow2=function(H){return H|=H>>>1,H|=H>>>2,H|=H>>>4,H|=H>>>8,(H|=H>>>16)-(H>>>1)},O.parity=function(H){return H^=H>>>16,H^=H>>>8,H^=H>>>4,27030>>>(H&=15)&1};var t=new Array(256);!function(H){for(var O=0;O<256;++O){var S=O,t=O,q=7;for(S>>>=1;S;S>>>=1)t<<=1,t|=1&S,--q;H[O]=t<<q&255}}(t),O.reverse=function(H){return t[255&H]<<24|t[H>>>8&255]<<16|t[H>>>16&255]<<8|t[H>>>24&255]},O.interleave2=function(H,O){return(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))|(O=1431655765&((O=858993459&((O=252645135&((O=16711935&((O&=65535)|O<<8))|O<<4))|O<<2))|O<<1))<<1},O.deinterleave2=function(H,O){return(H=65535&((H=16711935&((H=252645135&((H=858993459&((H=H>>>O&1431655765)|H>>>1))|H>>>2))|H>>>4))|H>>>16))<<16>>16},O.interleave3=function(H,O,S){return H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2),(H|=(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<1)|(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<2},O.deinterleave3=function(H,O){return(H=1023&((H=4278190335&((H=251719695&((H=3272356035&((H=H>>>O&1227133513)|H>>>2))|H>>>4))|H>>>8))|H>>>16))<<22>>22},O.nextCombination=function(H){var O=H|H-1;return O+1|(~O&-~O)-1>>>S(H)+1}},12427:H=>{"use strict";H.exports=function(H,O,S,t){var q=self||window;try{try{var p;try{p=new q.Blob([H])}catch(w){(p=new(q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder)).append(H),p=p.getBlob()}var G=q.URL||q.webkitURL,U=G.createObjectURL(p),V=new q[O](U,S);return G.revokeObjectURL(U),V}catch(w){return new q[O]("data:application/javascript,".concat(encodeURIComponent(H)),S)}}catch(w){if(!t)throw Error("Inline worker is not supported");return new q[O](t,S)}}},12093:(H,O,S)=>{"use strict";function t(H,O,S,t,q){var p={};return Object.keys(t).forEach((function(H){p[H]=t[H]})),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=S.slice().reverse().reduce((function(S,t){return t(H,O,S)||S}),p),q&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(q):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(H,O,p),p=null),p}S.d(O,{e:()=>t})},12090:(H,O,S)=>{"use strict";function t(H,O,S,t){S&&Object.defineProperty(H,O,{enumerable:S.enumerable,configurable:S.configurable,writable:S.writable,value:S.initializer?S.initializer.call(t):void 0})}S.d(O,{b:()=>t})},13467:(H,O,S)=>{"use strict";S.d(O,{c:()=>G,d:()=>h,g:()=>U,j:()=>p,n:()=>V,o:()=>q,r:()=>w,s:()=>o});var t=S(11524);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(H){const O=Math.min(Math.max(H,0),2);this._easingMode=O}getEasingMode(){return this._easingMode}easeInCore(H){throw new Error("You must implement this method")}ease(H){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(H);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-H)}return H>=.5?.5*(1-this.easeInCore(2*(1-H)))+.5:.5*this.easeInCore(2*H)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;class p extends q{easeInCore(H){return H=Math.max(0,Math.min(1,H)),1-Math.sqrt(1-H*H)}}class G extends q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=H}easeInCore(H){const O=Math.max(0,this.amplitude);return Math.pow(H,3)-H*O*Math.sin(3.141592653589793*H)}}class U extends q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=H,this.bounciness=O}easeInCore(H){const O=Math.max(0,this.bounces);let S=this.bounciness;S<=1&&(S=1.001);const t=Math.pow(S,O),q=1-S,p=(1-t)/q+.5*t,G=H*p,U=Math.log(-G*(1-S)+1)/Math.log(S),V=Math.floor(U),w=V+1,o=(1-Math.pow(S,V))/(q*p),h=.5*(o+(1-Math.pow(S,w))/(q*p)),a=H-h,j=h-o;return-Math.pow(1/S,O-V)/(j*j)*(a-j)*(a+j)}}class V extends q{easeInCore(H){return H*H*H}}class w extends q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=H,this.springiness=O}easeInCore(H){let O;const S=Math.max(0,this.oscillations),t=Math.max(0,this.springiness);return O=0==t?H:(Math.exp(t*H)-1)/(Math.exp(t)-1),O*Math.sin((6.283185307179586*S+1.5707963267948966)*H)}}class o extends q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=H}easeInCore(H){return this.exponent<=0?H:(Math.exp(this.exponent*H)-1)/(Math.exp(this.exponent)-1)}}class h extends q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=H,this.y1=O,this.x2=S,this.y2=t}easeInCore(H){return t.c.Interpolate(H,this.x1,this.y1,this.x2,this.y2)}}},12954:(H,O,S)=>{"use strict";S.d(O,{c:()=>G});var t=S(11301),q=S(11310),p=S(11727);class G extends p.e{get _matrix(){return this._compose(),this.ka}set _matrix(H){(H.updateFlag!==this.ka.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.ka.t(H),this._markAsDirtyAndDecompose())}constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(H,O.YH(),!1),this.name=H,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=O,this.ka=(null===q||void 0===q?void 0:q.clone())??t.Matrix.Identity(),this._restMatrix=p??this.ka.clone(),this._bindMatrix=G??this.ka.clone(),this._index=U,this._absoluteMatrix=new t.Matrix,this._absoluteBindMatrix=new t.Matrix,this._absoluteInverseBindMatrix=new t.Matrix,this._finalMatrix=new t.Matrix,O.bones.push(this),this.setParent(S,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(H){this.setParent(H)}setParent(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==H){if(this.parent){const H=this.parent.children.indexOf(this);-1!==H&&this.parent.children.splice(H,1)}this._parentNode=H,this.parent&&this.parent.children.push(this),O&&this._updateAbsoluteBindMatrices(),this.kw()}}getLocalMatrix(){return this._compose(),this.ka}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(H){this._restMatrix.t(H)}setRestPose(H){this.setRestMatrix(H)}getBindPose(){return this.getBindMatrix()}setBindMatrix(H){this.VU(H)}setBindPose(H){this.setBindMatrix(H)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const H=t.TmpVectors.eO[0],O=t.TmpVectors.Quaternion[0],S=t.TmpVectors.eO[1];this.getRestMatrix().decompose(H,O,S),this._linkedTransformNode.position.t(S),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??t.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.t(O),this._linkedTransformNode.eU.t(H)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(H){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=H,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.PU}set position(H){this._decompose(),this.PU.t(H),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(H){this.setRotation(H)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(H){this.setRotationQuaternion(H)}get eU(){return this.getScale()}set eU(H){this.setScale(H)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=t.eO.Zero(),this._localRotation=t.Quaternion.Zero(),this.PU=t.eO.Zero()),this.ka.decompose(this._localScaling,this._localRotation,this.PU))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,t.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.PU,this.ka)):this._needToCompose=!1)}VU(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.t(H),O&&this._updateAbsoluteBindMatrices(),S?this._matrix=H:this.kw()}_updateAbsoluteBindMatrices(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H||(H=this._bindMatrix),this.parent?H.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.t(H),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),O)for(let S=0;S<this.children.length;S++)this.children[S]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}kw(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.kw(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.kw(),this._needToDecompose=!0}_updatePosition(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=this.getLocalMatrix();if(0==O)q?(p.addAtIndex(12,H.x),p.addAtIndex(13,H.y),p.addAtIndex(14,H.z)):p.setTranslationFromFloats(H.x,H.y,H.z);else{let O=null;S&&(O=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const U=G._TmpMats[0],V=G._TmpVecs[0];this.parent?S&&O?(U.t(this.parent.getAbsoluteMatrix()),U.multiplyToRef(O,U)):U.t(this.parent.getAbsoluteMatrix()):t.Matrix.IdentityToRef(U),q&&U.setTranslationFromFloats(0,0,0),U.invert(),t.eO.TransformCoordinatesToRef(H,U,V),q?(p.addAtIndex(12,V.x),p.addAtIndex(13,V.y),p.addAtIndex(14,V.z)):p.setTranslationFromFloats(V.x,V.y,V.z)}this._markAsDirtyAndDecompose()}translate(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,O,S,!0)}setPosition(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this._updatePosition(H,O,S,!1)}setAbsolutePosition(H,O){this.setPosition(H,1,O)}scale(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=this.getLocalMatrix(),U=G._TmpMats[0];t.Matrix.ScalingToRef(H,O,S,U),U.multiplyToRef(p,p),U.invert();for(const t of this.children){const q=t.getLocalMatrix();q.multiplyToRef(U,q),q.multiplyAtIndex(12,H),q.multiplyAtIndex(13,O),q.multiplyAtIndex(14,S),t._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),q)for(const t of this.children)t.scale(H,O,S,q)}setScale(H){this._decompose(),this._localScaling.t(H),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(H){this._decompose(),H.t(this._localScaling)}setYawPitchRoll(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4?arguments[4]:void 0;if(0===q){const U=G._TmpQuat;return t.Quaternion.RotationYawPitchRollToRef(H,O,S,U),void this.setRotationQuaternion(U,q,p)}const U=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(U,p))return;const V=G._TmpMats[1];t.Matrix.RotationYawPitchRollToRef(H,O,S,V),U.multiplyToRef(V,V),this._rotateWithMatrix(V,q,p)}rotate(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;const p=G._TmpMats[0];p.setTranslationFromFloats(0,0,0),t.Matrix.RotationAxisToRef(H,O,p),this._rotateWithMatrix(p,S,q)}setAxisAngle(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;if(0===S){const p=G._TmpQuat;return t.Quaternion.RotationAxisToRef(H,O,p),void this.setRotationQuaternion(p,S,q)}const p=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,q))return;const U=G._TmpMats[1];t.Matrix.RotationAxisToRef(H,O,U),p.multiplyToRef(U,U),this._rotateWithMatrix(U,S,q)}setRotation(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(H.y,H.x,H.z,O,S)}setRotationQuaternion(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;if(0===O)return this._decompose(),this._localRotation.t(H),void this._markAsDirtyAndCompose();const q=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,S))return;const p=G._TmpMats[1];t.Matrix.FromQuaternionToRef(H,p),q.multiplyToRef(p,p),this._rotateWithMatrix(p,O,S)}setRotationMatrix(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;if(0===O){const q=G._TmpQuat;return t.Quaternion.FromRotationMatrixToRef(H,q),void this.setRotationQuaternion(q,O,S)}const q=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,S))return;const p=G._TmpMats[1];p.t(H),q.multiplyToRef(H,p),this._rotateWithMatrix(p,O,S)}_rotateWithMatrix(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;const t=this.getLocalMatrix(),q=t.m[12],p=t.m[13],U=t.m[14],V=this.getParent(),w=G._TmpMats[3],o=G._TmpMats[4];V&&1==O?(S?(w.t(S.getWorldMatrix()),V.getAbsoluteMatrix().multiplyToRef(w,w)):w.t(V.getAbsoluteMatrix()),o.t(w),o.invert(),t.multiplyToRef(w,t),t.multiplyToRef(H,t),t.multiplyToRef(o,t)):1==O&&S?(w.t(S.getWorldMatrix()),o.t(w),o.invert(),t.multiplyToRef(w,t),t.multiplyToRef(H,t),t.multiplyToRef(o,t)):t.multiplyToRef(H,t),t.setTranslationFromFloats(q,p,U),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(H,O){const S=G._TmpMats[2];return H.t(this.getAbsoluteMatrix()),O?(H.multiplyToRef(O.getWorldMatrix(),H),t.Matrix.ScalingToRef(O.eU.x,O.eU.y,O.eU.z,S)):t.Matrix.IdentityToRef(S),H.invert(),!isNaN(H.m[0])&&(S.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyToRef(S,H),!0)}qq(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.eO.Zero();return this.getPositionToRef(H,O,S),S}getPositionToRef(){let H=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const H=this.getLocalMatrix();O.x=H.m[12],O.y=H.m[13],O.z=H.m[14]}else{let S=null;H&&(S=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let t=G._TmpMats[0];H&&S?(t.t(this.getAbsoluteMatrix()),t.multiplyToRef(S,t)):t=this.getAbsoluteMatrix(),O.x=t.m[12],O.y=t.m[13],O.z=t.m[14]}}getAbsolutePosition(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=t.eO.Zero();return this.getPositionToRef(1,H,O),O}getAbsolutePositionToRef(H,O){this.getPositionToRef(1,H,O)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.ka.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.t(this.ka);const H=this._skeleton.getPoseMatrix();H&&this._absoluteMatrix.multiplyToRef(H,this._absoluteMatrix)}const H=this.children,O=H.length;for(let S=0;S<O;S++)H[S].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}jV(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.eO.Zero();return this.getDirectionToRef(H,O,S),S}getDirectionToRef(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,q=null;O&&(q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.t(this.getAbsoluteMatrix()),O&&q&&p.multiplyToRef(q,p),t.eO.TransformNormalToRef(H,p,S),S.normalize()}getRotation(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.eO.Zero();return this.getRotationToRef(H,O,S),S}getRotationToRef(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;const t=G._TmpQuat;this.getRotationQuaternionToRef(H,O,t),t.toEulerAnglesToRef(S)}getRotationQuaternion(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.Quaternion.Identity();return this.getRotationQuaternionToRef(H,O,S),S}getRotationQuaternionToRef(){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),O.t(this._localRotation);else{const S=G._TmpMats[0],t=this.getAbsoluteMatrix();H?t.multiplyToRef(H.getWorldMatrix(),S):S.t(t),S.multiplyAtIndex(0,this._scalingDeterminant),S.multiplyAtIndex(1,this._scalingDeterminant),S.multiplyAtIndex(2,this._scalingDeterminant),S.decompose(void 0,O,void 0)}}getRotationMatrix(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1?arguments[1]:void 0;const S=t.Matrix.Identity();return this.getRotationMatrixToRef(H,O,S),S}getRotationMatrixToRef(){let H=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(O);else{const S=G._TmpMats[0],t=this.getAbsoluteMatrix();H?t.multiplyToRef(H.getWorldMatrix(),S):S.t(t),S.multiplyAtIndex(0,this._scalingDeterminant),S.multiplyAtIndex(1,this._scalingDeterminant),S.multiplyAtIndex(2,this._scalingDeterminant),S.getRotationMatrixToRef(O)}}getAbsolutePositionFromLocal(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.eO.Zero();return this.getAbsolutePositionFromLocalToRef(H,O,S),S}getAbsolutePositionFromLocalToRef(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,q=null;O&&(q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.t(this.getAbsoluteMatrix()),O&&q&&p.multiplyToRef(q,p),t.eO.TransformCoordinatesToRef(H,p,S)}getLocalPositionFromAbsolute(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=t.eO.Zero();return this.getLocalPositionFromAbsoluteToRef(H,O,S),S}getLocalPositionFromAbsoluteToRef(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0,q=null;O&&(q=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.t(this.getAbsoluteMatrix()),O&&q&&p.multiplyToRef(q,p),p.invert(),t.eO.TransformCoordinatesToRef(H,p,S)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const H=this._skeleton.bones.indexOf(this);if(-1!==H&&this._skeleton.bones.splice(H,1),this._parentNode&&this._parentNode.children){const H=this._parentNode.children,O=H.indexOf(this);-1!==O&&H.splice(O,1)}super.dispose()}}G._TmpVecs=(0,q.d)(2,t.eO.Zero),G._TmpQuat=t.Quaternion.Identity(),G._TmpMats=(0,q.d)(5,t.Matrix.Identity)},13464:(H,O,S)=>{"use strict";S.d(O,{e:()=>N});var t=S(11287),q=S(11289),p=S(11140),G=S(11301),U=S(11317),V=S(11727),w=S(11757),o=S(11586),h=S(11162),a=S(11307);class j{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(H){this._idleRotationSpeed=H}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(H){this._idleRotationWaitTime=H}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(H){this._idleRotationSpinupTime=H}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(H){this._attachedCamera=H;const O=this._attachedCamera.YH();this._onPrePointerObservableObserver=O.onPrePointerObservable.add((H=>{H.type!==o.d.POINTERDOWN?H.type===o.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const H=h.d.Now;let O=0;null!=this._lastFrameTime&&(O=H-this._lastFrameTime),this._lastFrameTime=H,this._applyUserInteraction();const S=H-this._lastInteractionTime-this._idleRotationWaitTime,t=Math.max(Math.min(S/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*t,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(O/1e3))}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.YH();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(H){this._lastInteractionTime=H??h.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<a.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let H=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(H=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?H:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=h.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var e=S(13467),X=S(11831);class E{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(H){if(this._autoTransitionRange===H)return;this._autoTransitionRange=H;const O=this._attachedCamera;O&&(H?this._onMeshTargetChangedObserver=O.onMeshTargetChangedObservable.add((H=>{if(H&&(H.wU(!0),H.getBoundingInfo)){const O=H.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*O,this.upperRadiusTransitionRange=.05*O}})):this._onMeshTargetChangedObserver&&O.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(H){this._attachedCamera=H,this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(H){return!!this._attachedCamera&&(this._attachedCamera.radius===H&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(H){if(!this._attachedCamera)return;this._radiusBounceTransition||(E.EasingFunction.setEasingMode(E.EasingMode),this._radiusBounceTransition=X.d.CreateAnimation("radius",X.d.ANIMATIONTYPE_FLOAT,60,E.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const O=X.d.TransitionTo("radius",this._attachedCamera.radius+H,this._attachedCamera,this._attachedCamera.YH(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));O&&this._animatables.push(O)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}E.EasingFunction=new e.c(.3),E.EasingMode=e.o.EASINGMODE_EASEOUT;class y{constructor(){this.onTargetFramingAnimationEndObservable=new p.b,this._mode=y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(H){this._mode=H}get mode(){return this._mode}set radiusScale(H){this._radiusScale=H}get radiusScale(){return this._radiusScale}set positionScale(H){this._positionScale=H}get positionScale(){return this._positionScale}set defaultElevation(H){this._defaultElevation=H}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(H){this._elevationReturnTime=H}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(H){this._elevationReturnWaitTime=H}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(H){this._zoomStopsAnimation=H}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(H){this._framingTime=H}get framingTime(){return this._framingTime}init(){}attach(H){this._attachedCamera=H;const O=this._attachedCamera.YH();y.EasingFunction.setEasingMode(y.EasingMode),this._onPrePointerObservableObserver=O.onPrePointerObservable.add((H=>{H.type!==o.d.POINTERDOWN?H.type===o.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((H=>{H&&H.getBoundingInfo&&this.zoomOnMesh(H,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=H.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const H=this._attachedCamera.YH();this._onPrePointerObservableObserver&&H.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.wU(!0);const t=H.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(t.minimumWorld,t.maximumWorld,O,S)}zoomOnMeshHierarchy(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.wU(!0);const t=H.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(t.min,t.max,O,S)}zoomOnMeshesHierarchy(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new G.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new G.eO(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let p=0;p<H.length;p++){const O=H[p].getHierarchyBoundingVectors(!0);G.eO.CheckExtends(O.min,t,q),G.eO.CheckExtends(O.max,t,q)}this.zoomOnBoundingInfo(t,q,O,S)}zoomOnBoundingInfo(H,O){let S,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const p=H.y,U=p+(O.y-p)*this._positionScale,V=O.XO(H).scale(.5);if(!isFinite(U))return!1;if(t)S=new G.eO(0,U,0);else{const O=H.add(V);S=new G.eO(O.x,U,O.z)}this._vectorTransition||(this._vectorTransition=X.d.CreateAnimation("target",X.d.ANIMATIONTYPE_VECTOR3,60,y.EasingFunction)),this._betaIsAnimating=!0;let w=X.d.TransitionTo("target",S,this._attachedCamera,this._attachedCamera.YH(),60,this._vectorTransition,this._framingTime);w&&this._animatables.push(w);let o=0;if(this._mode===y.FitFrustumSidesMode){const S=this._calculateLowerRadiusFromModelBoundingSphere(H,O);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=V.length()+this._attachedCamera.UU),o=S}else this._mode===y.IgnoreBoundsSizeMode&&(o=this._calculateLowerRadiusFromModelBoundingSphere(H,O),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.UU));if(this.autoCorrectCameraLimitsAndSensibility){const S=O.XO(H).length();this._attachedCamera.panningSensibility=5e3/S,this._attachedCamera.wheelPrecision=100/o}return this._radiusTransition||(this._radiusTransition=X.d.CreateAnimation("radius",X.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction)),w=X.d.TransitionTo("radius",o,this._attachedCamera,this._attachedCamera.YH(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),q&&q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),w&&this._animatables.push(w),!0}_calculateLowerRadiusFromModelBoundingSphere(H,O){const S=this._attachedCamera;if(!S)return 0;let t=S._calculateLowerRadiusFromModelBoundingSphere(H,O,this._radiusScale);return S.lowerRadiusLimit&&this._mode===y.IgnoreBoundsSizeMode&&(t=t<S.lowerRadiusLimit?S.lowerRadiusLimit:t),S.upperRadiusLimit&&(t=t>S.upperRadiusLimit?S.upperRadiusLimit:t),t}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const H=h.d.Now-this._lastInteractionTime,O=.5*Math.PI-this._defaultElevation,S=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>S&&H>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=X.d.CreateAnimation("beta",X.d.ANIMATIONTYPE_FLOAT,60,y.EasingFunction));const H=X.d.TransitionTo("beta",O,this._attachedCamera,this._attachedCamera.YH(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));H&&this._animatables.push(H)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=h.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}y.EasingFunction=new e.s,y.EasingMode=e.o.EASINGMODE_EASEINOUT,y.IgnoreBoundsSizeMode=0,y.FitFrustumSidesMode=1;var T=S(11764),K=S(11788),b=S(12947),D=S(11131);class F{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(H){H=D.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),S=O.getInputElement();let t=0,q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=p=>{var G,U;const V=p.event,w="touch"===V.pointerType;if(p.type!==o.d.POINTERMOVE&&-1===this.buttons.indexOf(V.button))return;const h=V.target;if(this._altKey=V.altKey,this._ctrlKey=V.ctrlKey,this._metaKey=V.metaKey,this._shiftKey=V.shiftKey,this._buttonsPressed=V.buttons,O.isPointerLock){const H=V.movementX,O=V.movementY;this.onTouch(null,H,O),this._pointA=null,this._pointB=null}else{if(p.type!==o.d.POINTERDOWN&&p.type!==o.d.POINTERDOUBLETAP&&w&&(null===(G=this._pointA)||void 0===G?void 0:G.pointerId)!==V.pointerId&&(null===(U=this._pointB)||void 0===U?void 0:U.pointerId)!==V.pointerId)return;if(p.type!==o.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!w)if(p.type===o.d.POINTERDOUBLETAP)this.onDoubleTap(V.pointerType);else if(p.type!==o.d.POINTERUP||this._currentMousePointerIdDown!==V.pointerId&&!w){if(p.type===o.d.POINTERMOVE)if(H||V.preventDefault(),this._pointA&&null===this._pointB){const H=V.clientX-this._pointA.x,O=V.clientY-this._pointA.y;this._pointA.x=V.clientX,this._pointA.y=V.clientY,this.onTouch(this._pointA,H,O)}else if(this._pointA&&this._pointB){const H=this._pointA.pointerId===V.pointerId?this._pointA:this._pointB;H.x=V.clientX,H.y=V.clientY;const O=this._pointA.x-this._pointB.x,S=this._pointA.y-this._pointB.y,G=O*O+S*S,U={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:V.pointerId,type:p.type};this.onMultiTouch(this._pointA,this._pointB,t,G,q,U),q=U,t=G}}else{try{null===h||void 0===h||h.releasePointerCapture(V.pointerId)}catch(a){}w||(this._pointB=null),O._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==V.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==V.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==t||q)&&(this.onMultiTouch(this._pointA,this._pointB,t,0,q,null),t=0,q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(V),H||V.preventDefault()}else{try{null===h||void 0===h||h.setPointerCapture(V.pointerId)}catch(a){}if(null===this._pointA)this._pointA={x:V.clientX,y:V.clientY,pointerId:V.pointerId,type:V.pointerType};else{if(null!==this._pointB)return;this._pointB={x:V.clientX,y:V.clientY,pointerId:V.pointerId,type:V.pointerType}}-1!==this._currentMousePointerIdDown||w||(this._currentMousePointerIdDown=V.pointerId),this.onButtonDown(V),H||(V.preventDefault(),S&&S.focus())}}},this._observer=this.camera.YH()._inputManager._addCameraPointerObserver(this._pointerInput,o.d.POINTERDOWN|o.d.POINTERUP|o.d.POINTERMOVE|o.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,t=0,q=null,this.onLostFocus()},this._contextMenuBind=H=>this.onContextMenu(H),S&&S.addEventListener("contextmenu",this._contextMenuBind,!1);const p=this.camera.YH().getEngine().getHostWindow();p&&D.Tools.RegisterTopRootEvents(p,[{name:"blur",handler:this._onLostFocus}])}Jh(){if(this._onLostFocus){const H=this.camera.YH().getEngine().getHostWindow();H&&D.Tools.UnregisterTopRootEvents(H,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.YH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const H=this.camera.YH().getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(H){}onTouch(H,O,S){}onMultiTouch(H,O,S,t,q,p){}onContextMenu(H){H.preventDefault()}onButtonDown(H){}onButtonUp(H){}onLostFocus(){}}(0,t.d)([(0,q.J)()],F.prototype,"buttons",void 0);class Y extends F{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(H,O){if(0!==this.panningSensibility&&H&&O){const S=O.x-H.x,t=O.y-H.y;this.camera.inertialPanningX+=-S/this.panningSensibility,this.camera.inertialPanningY+=t/this.panningSensibility}}_computePinchZoom(H,O){const S=this.camera.radius||Y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=S*Math.sqrt(H)/Math.sqrt(O):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(O-H)*S*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(O-H)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(H,O,S){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility):(this.camera.inertialAlphaOffset-=O/this.angularSensibilityX,this.camera.inertialBetaOffset-=S/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(H,O,S,t,q,p){0===S&&null===q||0===t&&null===p||(this.multiTouchPanAndZoom?(this._computePinchZoom(S,t),this._computeMultiTouchPanning(q,p)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(t)-Math.sqrt(S))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(S,t),this._isPinching=!0):this._computeMultiTouchPanning(q,p)):this.multiTouchPanning?this._computeMultiTouchPanning(q,p):this.pinchZoom&&this._computePinchZoom(S,t))}onButtonDown(H){this._isPanClick=H.button===this.camera._panningMouseButton}onButtonUp(H){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Y.MinimumRadiusForPinch=.001,(0,t.d)([(0,q.J)()],Y.prototype,"buttons",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"angularSensibilityX",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"angularSensibilityY",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"pinchPrecision",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"pinchDeltaPercentage",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"useNaturalPinchZoom",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"pinchZoom",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"panningSensibility",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"multiTouchPanning",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"multiTouchPanAndZoom",void 0),b.e.ArcRotateCameraPointersInput=Y;var l=S(11590);class d{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(H){H=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.YH(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const S=O.event;if(!S.metaKey)if(O.type===l.e.KEYDOWN){if(this._ctrlPressed=S.ctrlKey,this._altPressed=S.altKey,-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysReset.indexOf(S.keyCode)){-1===this._keys.indexOf(S.keyCode)&&this._keys.push(S.keyCode),S.preventDefault&&(H||S.preventDefault())}}else if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysReset.indexOf(S.keyCode)){const O=this._keys.indexOf(S.keyCode);O>=0&&this._keys.splice(O,1),S.preventDefault&&(H||S.preventDefault())}})))}Jh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let O=0;O<this._keys.length;O++){const S=this._keys[O];-1!==this.keysLeft.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX-=1/this.panningSensibility:H.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset+=1/this.zoomingSensibility:H.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningX+=1/this.panningSensibility:H.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(S)?this._ctrlPressed&&this.camera._useCtrlForPanning?H.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?H.inertialRadiusOffset-=1/this.zoomingSensibility:H.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(S)&&H.useInputToRestoreState&&H.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,t.d)([(0,q.J)()],d.prototype,"keysUp",void 0),(0,t.d)([(0,q.J)()],d.prototype,"keysDown",void 0),(0,t.d)([(0,q.J)()],d.prototype,"keysLeft",void 0),(0,t.d)([(0,q.J)()],d.prototype,"keysRight",void 0),(0,t.d)([(0,q.J)()],d.prototype,"keysReset",void 0),(0,t.d)([(0,q.J)()],d.prototype,"panningSensibility",void 0),(0,t.d)([(0,q.J)()],d.prototype,"zoomingSensibility",void 0),(0,t.d)([(0,q.J)()],d.prototype,"useAltToZoom",void 0),(0,t.d)([(0,q.J)()],d.prototype,"angularSpeed",void 0),b.e.ArcRotateCameraKeyboardMoveInput=d;var v=S(11360),z=S(11594);class m{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new G.eO(0,0,0),this._globalOffset=new G.eO(0,0,0),this._inertialPanning=G.eO.Zero()}_computeDeltaFromMouseWheelLegacyEvent(H,O){let S=0;const t=.01*H*this.wheelDeltaPercentage*O;return S=H>0?t/(1+this.wheelDeltaPercentage):t*(1+this.wheelDeltaPercentage),S}attachControl(H){H=D.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==o.d.POINTERWHEEL)return;const S=O.event;let t=0;const q=S.deltaMode===z.d.DOM_DELTA_LINE?40:1,p=-S.deltaY*q;if(this.customComputeDeltaFromMouseWheel)t=this.customComputeDeltaFromMouseWheel(p,this,S);else if(this.wheelDeltaPercentage){if(t=this._computeDeltaFromMouseWheelLegacyEvent(p,this.camera.radius),t>0){let H=this.camera.radius,O=this.camera.inertialRadiusOffset+t;for(let S=0;S<20&&!(H<=O)&&!(Math.abs(O*this.camera.inertia)<.001);S++)H-=O,O*=this.camera.inertia;H=(0,U.Clamp)(H,0,Number.MAX_VALUE),t=this._computeDeltaFromMouseWheelLegacyEvent(p,H)}}else t=p/(40*this.wheelPrecision);t&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(t)):this.camera.inertialRadiusOffset+=t),S.preventDefault&&(H||S.preventDefault())},this._observer=this.camera.YH()._inputManager._addCameraPointerObserver(this._wheel,o.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.XU(0)}Jh(){this._observer&&(this.camera.YH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const H=this.camera;0+H.inertialAlphaOffset+H.inertialBetaOffset+H.inertialRadiusOffset&&(this._updateHitPlane(),H.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(H.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const H=this.camera,O=H.target.XO(H.position);this._hitPlane=v.b.FromPositionAndNormal(H.target,O)}_getPosition(){const H=this.camera,O=H.YH(),S=O.createPickingRay(O.pointerX,O.pointerY,G.Matrix.Identity(),H,!1);0===H.targetScreenOffset.x&&0===H.targetScreenOffset.y||(this._viewOffset.set(H.targetScreenOffset.x,H.targetScreenOffset.y,0),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),this._globalOffset=G.eO.TransformNormal(this._viewOffset,H._cameraTransformMatrix),S.origin.addInPlace(this._globalOffset));let t=0;return this._hitPlane&&(t=S.intersectsPlane(this._hitPlane)??0),S.origin.addInPlace(S.direction.scaleInPlace(t))}_zoomToMouse(H){const O=this.camera,S=1-O.inertia;if(O.lowerRadiusLimit){const t=O.lowerRadiusLimit??0;O.radius-(O.inertialRadiusOffset+H)/S<t&&(H=(O.radius-t)*S-O.inertialRadiusOffset)}if(O.upperRadiusLimit){const t=O.upperRadiusLimit??0;O.radius-(O.inertialRadiusOffset+H)/S>t&&(H=(O.radius-t)*S-O.inertialRadiusOffset)}const t=H/S/O.radius,q=this._getPosition(),p=G.TmpVectors.eO[6];q.subtractToRef(O.target,p),p.scaleInPlace(t),p.scaleInPlace(S),this._inertialPanning.addInPlace(p),O.inertialRadiusOffset+=H}_zeroIfClose(H){Math.abs(H.x)<a.e&&(H.x=0),Math.abs(H.y)<a.e&&(H.y=0),Math.abs(H.z)<a.e&&(H.z=0)}}(0,t.d)([(0,q.J)()],m.prototype,"wheelPrecision",void 0),(0,t.d)([(0,q.J)()],m.prototype,"zoomToMouseLocation",void 0),(0,t.d)([(0,q.J)()],m.prototype,"wheelDeltaPercentage",void 0),b.e.ArcRotateCameraMouseWheelInput=m;class r extends b.i{constructor(H){super(H)}addMouseWheel(){return this.add(new m),this}addPointers(){return this.add(new Y),this}addKeyboard(){return this.add(new d),this}}var W=S(11262);function g(H,O){return isNaN(H)?O:H}V.e.AddNodeConstructor("ArcRotateCamera",((H,O)=>()=>new N(H,0,0,1,G.eO.Zero(),O)));class N extends K.b{get target(){return this._target}set target(H){this.setTarget(H)}get targetHost(){return this._targetHost}set targetHost(H){H&&this.setTarget(H)}getTarget(){return this.target}get position(){return this._position}set position(H){this.setPosition(H)}set upVector(H){this._upToYMatrix||(this._yToUpMatrix=new G.Matrix,this._upToYMatrix=new G.Matrix,this._upVector=G.eO.Zero()),H.normalize(),this._upVector.t(H),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){G.Matrix.RotationAlignToRef(G.eO.UpReadOnly,this._upVector,this._yToUpMatrix),G.Matrix.RotationAlignToRef(this._upVector,G.eO.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityX:0}set angularSensibilityX(H){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityX=H)}get angularSensibilityY(){const H=this.inputs.attached.pointers;return H?H.angularSensibilityY:0}set angularSensibilityY(H){const O=this.inputs.attached.pointers;O&&(O.angularSensibilityY=H)}get pinchPrecision(){const H=this.inputs.attached.pointers;return H?H.pinchPrecision:0}set pinchPrecision(H){const O=this.inputs.attached.pointers;O&&(O.pinchPrecision=H)}get pinchDeltaPercentage(){const H=this.inputs.attached.pointers;return H?H.pinchDeltaPercentage:0}set pinchDeltaPercentage(H){const O=this.inputs.attached.pointers;O&&(O.pinchDeltaPercentage=H)}get useNaturalPinchZoom(){const H=this.inputs.attached.pointers;return!!H&&H.useNaturalPinchZoom}set useNaturalPinchZoom(H){const O=this.inputs.attached.pointers;O&&(O.useNaturalPinchZoom=H)}get panningSensibility(){const H=this.inputs.attached.pointers;return H?H.panningSensibility:0}set panningSensibility(H){const O=this.inputs.attached.pointers;O&&(O.panningSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const O=this.inputs.attached.keyboard;O&&(O.keysUp=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const O=this.inputs.attached.keyboard;O&&(O.keysDown=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const O=this.inputs.attached.keyboard;O&&(O.keysRight=H)}get wheelPrecision(){const H=this.inputs.attached.mousewheel;return H?H.wheelPrecision:0}set wheelPrecision(H){const O=this.inputs.attached.mousewheel;O&&(O.wheelPrecision=H)}get zoomToMouseLocation(){const H=this.inputs.attached.mousewheel;return!!H&&H.zoomToMouseLocation}set zoomToMouseLocation(H){const O=this.inputs.attached.mousewheel;O&&(O.zoomToMouseLocation=H)}get wheelDeltaPercentage(){const H=this.inputs.attached.mousewheel;return H?H.wheelDeltaPercentage:0}set wheelDeltaPercentage(H){const O=this.inputs.attached.mousewheel;O&&(O.wheelDeltaPercentage=H)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(H){H!==this.useBouncingBehavior&&(H?(this._bouncingBehavior=new E,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(H){H!==this.useFramingBehavior&&(H?(this._framingBehavior=new y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(H){H!==this.useAutoRotationBehavior&&(H?(this._autoRotationBehavior=new j,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(H,O,S,t,q,U){var V;let w=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(H,G.eO.Zero(),U,w),V=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=G.eO.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=G.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new G.Matrix,this.panningAxis=new G.eO(1,1,0),this._transformedDirection=new G.eO,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new p.b,this.checkCollisions=!1,this.collisionRadius=new G.eO(.5,.5,.5),this._previousPosition=G.eO.Zero(),this._collisionVelocity=G.eO.Zero(),this._newPosition=G.eO.Zero(),this._computationVector=G.eO.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new G.eO(NaN,NaN,NaN),this._goalTargetScreenOffset=new G.Vector2(NaN,NaN),this._onCollisionPositionChange=function(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S?(V.setPosition(O),V.mj&&V.mj(S)):V._previousPosition.t(V._position);const t=Math.cos(V.alpha),q=Math.sin(V.alpha),p=Math.cos(V.beta);let G=Math.sin(V.beta);0===G&&(G=1e-4);const U=V._getTargetPosition();V._computationVector.jU(V.radius*t*G,V.radius*p,V.radius*q*G),U.addToRef(V._computationVector,V._newPosition),V._position.t(V._newPosition);let w=V.upVector;V.allowUpsideDown&&V.beta<0&&(w=w.clone(),w=w.negate()),V._computeViewMatrix(V._position,U,w),V._viewMatrix.addAtIndex(12,V.targetScreenOffset.x),V._viewMatrix.addAtIndex(13,V.targetScreenOffset.y),V._collisionTriggered=!1},this._target=G.eO.Zero(),q&&this.setTarget(q),this.alpha=O,this.beta=S,this.radius=t,this.getViewMatrix(),this.inputs=new r(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new G.eO(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=G.Vector2.Zero()}_updateCache(H){H||super._updateCache(),this._cache._target.t(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.t(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const H=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?H.addToRef(this._targetBoundingCenter,this._target):this._target.t(H)}const H=this._getLockedTargetPosition();return H||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>a.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,p=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=p?this._currentInterpolationFactor=p:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=g(H,this._goalAlpha),this._goalBeta=g(O,this._goalBeta),this._goalRadius=g(S,this._goalRadius),this._goalTarget.set(g(t.x,this._goalTarget.x),g(t.y,this._goalTarget.y),g(t.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(g(q.x,this._goalTargetScreenOffset.x),g(q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,U.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,U.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,U.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,U.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(H,O){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const q=arguments;O=D.Tools.BackCompatCameraNoPreventDefault(q),this._useCtrlForPanning=S,this._panningMouseButton=t,"boolean"===typeof q[0]&&(q.length>1&&(this._useCtrlForPanning=q[1]),q.length>2&&(this._panningMouseButton=q[2])),this.inputs.attachElement(O),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Jh(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let H=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){H=!0;const O=this.invertRotation?-1:1,S=this._calculateHandednessMultiplier();let t=this.inertialAlphaOffset*S;this.beta<0&&(t*=-1),this.alpha+=t*O,this.beta+=this.inertialBetaOffset*O,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*a.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){H=!0;const O=new G.eO(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),O.multiplyInPlace(this.panningAxis),G.eO.TransformNormalToRef(O,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const H=this.upVector,O=G.eO.CrossToRef(this._transformedDirection,H,this._transformedDirection);G.eO.CrossToRef(H,O,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);G.eO.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.t(this._transformedDirection)}else{if(this.parent){const H=G.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(H),H.transposeToRef(H),G.eO.TransformCoordinatesToRef(this._transformedDirection,H,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*a.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*a.e&&(this.inertialPanningY=0)}if(H)this.stopInterpolation();else if(this._isInterpolating){let H=!1;const O=this._scene.getEngine().getDeltaTime()/1e3,S=1-Math.pow(2,-O/this._currentInterpolationFactor),t=g(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const O=G.TmpVectors.eO[0].set(g(this._goalTarget.x,this._target.x),g(this._goalTarget.y,this._target.y),g(this._goalTarget.z,this._target.z));G.eO.LerpToRef(this.target,O,S,this._target),10*G.eO.Distance(this.target,O)/t<a.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.t(O),this.setTarget(this.target,!1,!0,!0)):H=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const O=G.Quaternion.RotationAlphaBetaGammaToRef(g(this._goalAlpha,this.alpha),g(this._goalBeta,this.beta),0,G.TmpVectors.Quaternion[0]),t=G.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,G.TmpVectors.Quaternion[1]),q=G.Quaternion.SlerpToRef(t,O,S,G.TmpVectors.Quaternion[2]);q.normalize();const p=q.toAlphaBetaGammaToRef(G.TmpVectors.eO[0]);if(this.alpha=p.x,this.beta=p.y,q.isApprox(O,a.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const H=O.toAlphaBetaGammaToRef(G.TmpVectors.eO[0]);this.alpha=H.x,this.beta=H.y}else H=!0}if(isNaN(this._goalRadius)||(this.radius+=(t-this.radius)*S,Math.abs(t/this.radius-1)<a.e?(this._goalRadius=NaN,this.radius=t):H=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const O=G.TmpVectors.Vector2[0].set(g(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),g(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));G.Vector2.LerpToRef(this.targetScreenOffset,O,S,this.targetScreenOffset),G.Vector2.Distance(this.targetScreenOffset,O)<a.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.t(O)):H=!0}this._isInterpolating=H}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.eO.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const H=this.alpha;var O,S;this.alpha=function(H){let O=Math.PI/2;return 0===H.x&&0===H.z||(O=Math.acos(H.x/Math.sqrt(Math.pow(H.x,2)+Math.pow(H.z,2)))),H.z<0&&(O=2*Math.PI-O),O}(this._computationVector),this.beta=(O=this._computationVector.y,S=this.radius,Math.acos(O/S));const t=Math.round((H-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this._checkLimits()}setPosition(H){this._position.equals(H)||(this._position.t(H),this.rebuildAnglesAndRadius())}setTarget(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t=this.overrideCloneAlphaBetaRadius??t,H.wU)O&&H.getBoundingInfo?this._targetBoundingCenter=H.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,H.wU(),this._targetHost=H,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const O=H,t=this._getTargetPosition();if(t&&!S&&t.equals(O))return;this._targetHost=null,this._target=O,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}t||this.rebuildAnglesAndRadius()}_getViewMatrix(){const H=Math.cos(this.alpha),O=Math.sin(this.alpha),S=Math.cos(this.beta);let t=Math.sin(this.beta);0===t&&(t=1e-4),0===this.radius&&(this.radius=1e-4);const q=this._getTargetPosition();if(this._computationVector.jU(this.radius*H*t,this.radius*S,this.radius*O*t),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.eO.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),q.addToRef(this._computationVector,this._newPosition),this.YH().collisionsEnabled&&this.checkCollisions){const H=this.YH().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,H.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.t(this._newPosition);let H=this.upVector;this.allowUpsideDown&&t<0&&(H=H.negate()),this._computeViewMatrix(this._position,q,H),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.t(q),this._viewMatrix}zoomOn(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H=H||this.YH().meshes;const S=w.d.MinMax(H);let t=this._calculateLowerRadiusFromModelBoundingSphere(S.min,S.max);if(t=Math.max(Math.min(t,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=t*this.zoomOnFactor,this.mode===T.d.ORTHOGRAPHIC_CAMERA){const H=this.YH().getEngine().getAspectRatio(this),O=t*this.zoomOnFactor/2;this.orthoLeft=-O*H,this.orthoRight=O*H,this.orthoBottom=-O,this.orthoTop=O}this.focusOn({min:S.min,max:S.max,distance:t},O)}focusOn(H){let O,S,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===H.min){const t=H||this.YH().meshes;O=w.d.MinMax(t),S=G.eO.Distance(O.min,O.max)}else{O=H,S=H.distance}this._target=w.d.Center(O),t||(this.maxZ=2*S)}createRigCamera(H,O){let S=0;switch(this.cameraRigMode){case T.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case T.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case T.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case T.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case T.d.RIG_MODE_VR:S=this._cameraRigParams.stereoHalfAngle*(0===O?1:-1);break;case T.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:S=this._cameraRigParams.stereoHalfAngle*(0===O?-1:1)}const t=new N(H,this.alpha+S,this.beta,this.radius,this._target,this.YH());return t._cameraRigParams={},t.isRigCamera=!0,t.rigParent=this,t.upVector=this.upVector,t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoBottom=this.orthoBottom,t.orthoTop=this.orthoTop,t}_updateRigCameras(){const H=this._rigCameras[0],O=this._rigCameras[1];switch(H.beta=O.beta=this.beta,this.cameraRigMode){case T.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case T.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case T.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case T.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case T.d.RIG_MODE_VR:H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case T.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,O.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const t=G.eO.Distance(H,O),q=this.YH().getEngine().getAspectRatio(this),p=Math.tan(this.fov/2),U=p*q,V=.5*t*S,w=V*Math.sqrt(1+1/(U*U)),o=V*Math.sqrt(1+1/(p*p));return Math.max(w,o)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,t.d)([(0,q.J)()],N.prototype,"alpha",void 0),(0,t.d)([(0,q.J)()],N.prototype,"beta",void 0),(0,t.d)([(0,q.J)()],N.prototype,"radius",void 0),(0,t.d)([(0,q.J)()],N.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,t.d)([(0,q.F)("target")],N.prototype,"_target",void 0),(0,t.d)([(0,q.v)("targetHost")],N.prototype,"_targetHost",void 0),(0,t.d)([(0,q.J)()],N.prototype,"inertialAlphaOffset",void 0),(0,t.d)([(0,q.J)()],N.prototype,"inertialBetaOffset",void 0),(0,t.d)([(0,q.J)()],N.prototype,"inertialRadiusOffset",void 0),(0,t.d)([(0,q.J)()],N.prototype,"lowerAlphaLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"upperAlphaLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"lowerBetaLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"upperBetaLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"lowerRadiusLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"upperRadiusLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"lowerTargetYLimit",void 0),(0,t.d)([(0,q.J)()],N.prototype,"inertialPanningX",void 0),(0,t.d)([(0,q.J)()],N.prototype,"inertialPanningY",void 0),(0,t.d)([(0,q.J)()],N.prototype,"pinchToPanMaxDistance",void 0),(0,t.d)([(0,q.J)()],N.prototype,"panningDistanceLimit",void 0),(0,t.d)([(0,q.F)()],N.prototype,"panningOriginTarget",void 0),(0,t.d)([(0,q.J)()],N.prototype,"panningInertia",void 0),(0,t.d)([(0,q.J)()],N.prototype,"zoomToMouseLocation",null),(0,t.d)([(0,q.J)()],N.prototype,"zoomOnFactor",void 0),(0,t.d)([(0,q.E)()],N.prototype,"targetScreenOffset",void 0),(0,t.d)([(0,q.J)()],N.prototype,"allowUpsideDown",void 0),(0,t.d)([(0,q.J)()],N.prototype,"useInputToRestoreState",void 0),(0,t.d)([(0,q.J)()],N.prototype,"restoreStateInterpolationFactor",void 0),(0,W.g)("BABYLON.ArcRotateCamera",N)},12947:(H,O,S)=>{"use strict";S.d(O,{e:()=>G,i:()=>U});var t=S(11151),q=S(11338),p=S(11764),G={};class U{constructor(H){this.attachedToElement=!1,this.attached={},this.camera=H,this.checkInputs=()=>{}}add(H){const O=H.getSimpleName();this.attached[O]?t.b.Warn("camera input of type "+O+" already exists on camera"):(this.attached[O]=H,H.camera=this.camera,H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H))),this.attachedToElement&&H.attachControl(this.noPreventDefault))}remove(H){for(const O in this.attached){const S=this.attached[O];if(S===H)return S.Jh(),S.camera=null,delete this.attached[O],void this.rebuildInputCheck()}}removeByType(H){for(const O in this.attached){const S=this.attached[O];S.getClassName()===H&&(S.Jh(),S.camera=null,delete this.attached[O],this.rebuildInputCheck())}}_addCheckInputs(H){const O=this.checkInputs;return()=>{O(),H()}}attachInput(H){this.attachedToElement&&H.attachControl(this.noPreventDefault)}attachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){H=!p.d.ForceAttachControlToAlwaysPreventDefault&&H,this.attachedToElement=!0,this.noPreventDefault=H;for(const O in this.attached)this.attached[O].attachControl(H)}}detachElement(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const O in this.attached)this.attached[O].Jh(),H&&(this.attached[O].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const H in this.attached){const O=this.attached[H];O.checkInputs&&(this.checkInputs=this._addCheckInputs(O.checkInputs.bind(O)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(H){const O={};for(const S in this.attached){const H=this.attached[S],t=q.e.Serialize(H);O[H.getClassName()]=t}H.inputsmgr=O}parse(H){const O=H.inputsmgr;if(O){this.clear();for(const H in O){const S=G[H];if(S){const t=O[H],p=q.e.Parse((()=>new S),t,null);this.add(p)}}}else for(const S in this.attached){const O=G[this.attached[S].getClassName()];if(O){const t=q.e.Parse((()=>new O),H,null);this.remove(this.attached[S]),this.add(t)}}}}},12938:(H,O,S)=>{"use strict";S.d(O,{e:()=>F});var t=S(11287),q=S(11289),p=S(11301),G=S(11788),U=S(12947),V=S(11590),w=S(11131);class o{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(H){H=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.YH(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((O=>{const S=O.event;if(!S.metaKey)if(O.type===V.e.KEYDOWN){if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysUpward.indexOf(S.keyCode)||-1!==this.keysDownward.indexOf(S.keyCode)||-1!==this.keysRotateLeft.indexOf(S.keyCode)||-1!==this.keysRotateRight.indexOf(S.keyCode)||-1!==this.keysRotateUp.indexOf(S.keyCode)||-1!==this.keysRotateDown.indexOf(S.keyCode)){-1===this._keys.indexOf(S.keyCode)&&this._keys.push(S.keyCode),H||S.preventDefault()}}else if(-1!==this.keysUp.indexOf(S.keyCode)||-1!==this.keysDown.indexOf(S.keyCode)||-1!==this.keysLeft.indexOf(S.keyCode)||-1!==this.keysRight.indexOf(S.keyCode)||-1!==this.keysUpward.indexOf(S.keyCode)||-1!==this.keysDownward.indexOf(S.keyCode)||-1!==this.keysRotateLeft.indexOf(S.keyCode)||-1!==this.keysRotateRight.indexOf(S.keyCode)||-1!==this.keysRotateUp.indexOf(S.keyCode)||-1!==this.keysRotateDown.indexOf(S.keyCode)){const O=this._keys.indexOf(S.keyCode);O>=0&&this._keys.splice(O,1),H||S.preventDefault()}})))}Jh(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const H=this.camera;for(let O=0;O<this._keys.length;O++){const S=this._keys[O],t=H._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(S)?H._localDirection.jU(-t,0,0):-1!==this.keysUp.indexOf(S)?H._localDirection.jU(0,0,t):-1!==this.keysRight.indexOf(S)?H._localDirection.jU(t,0,0):-1!==this.keysDown.indexOf(S)?H._localDirection.jU(0,0,-t):-1!==this.keysUpward.indexOf(S)?H._localDirection.jU(0,t,0):-1!==this.keysDownward.indexOf(S)?H._localDirection.jU(0,-t,0):-1!==this.keysRotateLeft.indexOf(S)?(H._localDirection.jU(0,0,0),H.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(S)?(H._localDirection.jU(0,0,0),H.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(S)?(H._localDirection.jU(0,0,0),H.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(S)&&(H._localDirection.jU(0,0,0),H.cameraRotation.x+=this._getLocalRotation()),H.YH().useRightHandedSystem&&(H._localDirection.z*=-1),H.getViewMatrix().invertToRef(H._cameraTransformMatrix),p.eO.TransformNormalToRef(H._localDirection,H._cameraTransformMatrix,H._transformedDirection),H.cameraDirection.addInPlace(H._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const H=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*H}}(0,t.d)([(0,q.J)()],o.prototype,"keysUp",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysUpward",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysDown",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysDownward",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysLeft",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysRight",void 0),(0,t.d)([(0,q.J)()],o.prototype,"rotationSpeed",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysRotateLeft",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysRotateRight",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysRotateUp",void 0),(0,t.d)([(0,q.J)()],o.prototype,"keysRotateDown",void 0),U.e.FreeCameraKeyboardMoveInput=o;var h=S(11140),a=S(11586);class j{constructor(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=H,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new h.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(H){H=w.Tools.BackCompatCameraNoPreventDefault(arguments);const O=this.camera.getEngine(),S=O.getInputElement();this._pointerInput||(this._pointerInput=t=>{const q=t.event,p="touch"===q.pointerType;if(!this.touchEnabled&&p)return;if(t.type!==a.d.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const G=q.target;if(t.type===a.d.POINTERDOWN){if(p&&-1!==this._activePointerId||!p&&-1!==this._currentActiveButton)return;this._activePointerId=q.pointerId;try{null===G||void 0===G||G.setPointerCapture(q.pointerId)}catch(U){}-1===this._currentActiveButton&&(this._currentActiveButton=q.button),this._previousPosition={x:q.clientX,y:q.clientY},H||(q.preventDefault(),S&&S.focus()),O.isPointerLock&&this._onMouseMove&&this._onMouseMove(t.event)}else if(t.type===a.d.POINTERUP){if(p&&this._activePointerId!==q.pointerId||!p&&this._currentActiveButton!==q.button)return;try{null===G||void 0===G||G.releasePointerCapture(q.pointerId)}catch(U){}this._currentActiveButton=-1,this._previousPosition=null,H||q.preventDefault(),this._activePointerId=-1}else if(t.type===a.d.POINTERMOVE&&(this._activePointerId===q.pointerId||!p))if(O.isPointerLock&&this._onMouseMove)this._onMouseMove(t.event);else if(this._previousPosition){const O=this.camera._calculateHandednessMultiplier(),S=(q.clientX-this._previousPosition.x)*O,t=q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=S/this.angularSensibility,this.camera.cameraRotation.x+=t/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:S,offsetY:t}),this._previousPosition={x:q.clientX,y:q.clientY},H||q.preventDefault()}}),this._onMouseMove=S=>{if(!O.isPointerLock)return;const t=this.camera._calculateHandednessMultiplier(),q=S.movementX*t;this.camera.cameraRotation.y+=q/this.angularSensibility;const p=S.movementY;this.camera.cameraRotation.x+=p/this.angularSensibility,this._previousPosition=null,H||S.preventDefault()},this._observer=this.camera.YH()._inputManager._addCameraPointerObserver(this._pointerInput,a.d.POINTERDOWN|a.d.POINTERUP|a.d.POINTERMOVE),S&&(this._contextMenuBind=H=>this.onContextMenu(H),S.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(H){H.preventDefault()}Jh(){if(this._observer){if(this.camera.YH()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,t.d)([(0,q.J)()],j.prototype,"buttons",void 0),(0,t.d)([(0,q.J)()],j.prototype,"angularSensibility",void 0),U.e.FreeCameraMouseInput=j;var e,X=S(11594);class E{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new h.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(H){H=w.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=O=>{if(O.type!==a.d.POINTERWHEEL)return;const S=O.event,t=S.deltaMode===X.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*t*S.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*t*S.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*t*S.deltaZ/this._normalize,S.preventDefault&&(H||S.preventDefault())},this._observer=this.camera.YH()._inputManager._addCameraPointerObserver(this._wheel,a.d.POINTERWHEEL)}Jh(){this._observer&&(this.camera.YH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,t.d)([(0,q.J)()],E.prototype,"wheelPrecisionX",void 0),(0,t.d)([(0,q.J)()],E.prototype,"wheelPrecisionY",void 0),(0,t.d)([(0,q.J)()],E.prototype,"wheelPrecisionZ",void 0),function(H){H[H.MoveRelative=0]="MoveRelative",H[H.RotateRelative=1]="RotateRelative",H[H.MoveScene=2]="MoveScene"}(e||(e={}));class y extends E{constructor(){super(...arguments),this._moveRelative=p.eO.Zero(),this._rotateRelative=p.eO.Zero(),this._moveScene=p.eO.Zero(),this._wheelXAction=e.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=e.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(H){null===H&&this._wheelXAction!==e.MoveRelative||(this._wheelXAction=e.MoveRelative,this._wheelXActionCoordinate=H)}get wheelXMoveRelative(){return this._wheelXAction!==e.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(H){null===H&&this._wheelYAction!==e.MoveRelative||(this._wheelYAction=e.MoveRelative,this._wheelYActionCoordinate=H)}get wheelYMoveRelative(){return this._wheelYAction!==e.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(H){null===H&&this._wheelZAction!==e.MoveRelative||(this._wheelZAction=e.MoveRelative,this._wheelZActionCoordinate=H)}get wheelZMoveRelative(){return this._wheelZAction!==e.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(H){null===H&&this._wheelXAction!==e.RotateRelative||(this._wheelXAction=e.RotateRelative,this._wheelXActionCoordinate=H)}get wheelXRotateRelative(){return this._wheelXAction!==e.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(H){null===H&&this._wheelYAction!==e.RotateRelative||(this._wheelYAction=e.RotateRelative,this._wheelYActionCoordinate=H)}get wheelYRotateRelative(){return this._wheelYAction!==e.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(H){null===H&&this._wheelZAction!==e.RotateRelative||(this._wheelZAction=e.RotateRelative,this._wheelZActionCoordinate=H)}get wheelZRotateRelative(){return this._wheelZAction!==e.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(H){null===H&&this._wheelXAction!==e.MoveScene||(this._wheelXAction=e.MoveScene,this._wheelXActionCoordinate=H)}get wheelXMoveScene(){return this._wheelXAction!==e.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(H){null===H&&this._wheelYAction!==e.MoveScene||(this._wheelYAction=e.MoveScene,this._wheelYActionCoordinate=H)}get wheelYMoveScene(){return this._wheelYAction!==e.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(H){null===H&&this._wheelZAction!==e.MoveScene||(this._wheelZAction=e.MoveScene,this._wheelZActionCoordinate=H)}get wheelZMoveScene(){return this._wheelZAction!==e.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.XU(0),this._rotateRelative.XU(0),this._moveScene.XU(0),this._updateCamera(),this.camera.YH().useRightHandedSystem&&(this._moveRelative.z*=-1);const H=p.Matrix.Zero();this.camera.getViewMatrix().invertToRef(H);const O=p.eO.Zero();p.eO.TransformNormalToRef(this._moveRelative,H,O),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(O),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(H,O,S){if(0===H)return;if(null===O||null===S)return;let t=null;switch(O){case e.MoveRelative:t=this._moveRelative;break;case e.RotateRelative:t=this._rotateRelative;break;case e.MoveScene:t=this._moveScene}switch(S){case 0:t.set(H,0,0);break;case 1:t.set(0,H,0);break;case 2:t.set(0,0,H)}}}(0,t.d)([(0,q.J)()],y.prototype,"wheelXMoveRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelYMoveRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelZMoveRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelXRotateRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelYRotateRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelZRotateRelative",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelXMoveScene",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelYMoveScene",null),(0,t.d)([(0,q.J)()],y.prototype,"wheelZMoveScene",null),U.e.FreeCameraMouseWheelInput=y;class T{constructor(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=H,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=w.Tools.IsSafari()}attachControl(H){H=w.Tools.BackCompatCameraNoPreventDefault(arguments);let O=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=S=>{const t=S.event,q="mouse"===t.pointerType||this._isSafari&&"undefined"===typeof t.pointerType;if(this.allowMouse||!q)if(S.type===a.d.POINTERDOWN){if(H||t.preventDefault(),this._pointerPressed.push(t.pointerId),1!==this._pointerPressed.length)return;O={x:t.clientX,y:t.clientY}}else if(S.type===a.d.POINTERUP){H||t.preventDefault();const S=this._pointerPressed.indexOf(t.pointerId);if(-1===S)return;if(this._pointerPressed.splice(S,1),0!=S)return;O=null,this._offsetX=null,this._offsetY=null}else if(S.type===a.d.POINTERMOVE){if(H||t.preventDefault(),!O)return;if(0!=this._pointerPressed.indexOf(t.pointerId))return;this._offsetX=t.clientX-O.x,this._offsetY=-(t.clientY-O.y)}}),this._observer=this.camera.YH()._inputManager._addCameraPointerObserver(this._pointerInput,a.d.POINTERDOWN|a.d.POINTERUP|a.d.POINTERMOVE),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.addEventListener("blur",this._onLostFocus)}}Jh(){if(this._pointerInput){if(this._observer&&(this.camera.YH()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const H=this.camera.getEngine().getInputElement();H&&H.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const H=this.camera,O=H._calculateHandednessMultiplier();H.cameraRotation.y=O*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)H.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const O=H._computeLocalCameraSpeed(),S=new p.eO(0,0,0!==this.touchMoveSensibility?O*this._offsetY/this.touchMoveSensibility:0);p.Matrix.RotationYawPitchRollToRef(H.rotation.y,H.rotation.x,0,H._cameraRotationMatrix),H.cameraDirection.addInPlace(p.eO.TransformCoordinates(S,H._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,t.d)([(0,q.J)()],T.prototype,"touchAngularSensibility",void 0),(0,t.d)([(0,q.J)()],T.prototype,"touchMoveSensibility",void 0),U.e.FreeCameraTouchInput=T;class K extends U.i{constructor(H){super(H),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new o),this}addMouse(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new j(H),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new T),this}clear(){super.clear(),this._mouseInput=null}}var b=S(11262),D=S(11213);class F extends G.b{get angularSensibility(){const H=this.inputs.attached.mouse;return H?H.angularSensibility:0}set angularSensibility(H){const O=this.inputs.attached.mouse;O&&(O.angularSensibility=H)}get keysUp(){const H=this.inputs.attached.keyboard;return H?H.keysUp:[]}set keysUp(H){const O=this.inputs.attached.keyboard;O&&(O.keysUp=H)}get keysUpward(){const H=this.inputs.attached.keyboard;return H?H.keysUpward:[]}set keysUpward(H){const O=this.inputs.attached.keyboard;O&&(O.keysUpward=H)}get keysDown(){const H=this.inputs.attached.keyboard;return H?H.keysDown:[]}set keysDown(H){const O=this.inputs.attached.keyboard;O&&(O.keysDown=H)}get keysDownward(){const H=this.inputs.attached.keyboard;return H?H.keysDownward:[]}set keysDownward(H){const O=this.inputs.attached.keyboard;O&&(O.keysDownward=H)}get keysLeft(){const H=this.inputs.attached.keyboard;return H?H.keysLeft:[]}set keysLeft(H){const O=this.inputs.attached.keyboard;O&&(O.keysLeft=H)}get keysRight(){const H=this.inputs.attached.keyboard;return H?H.keysRight:[]}set keysRight(H){const O=this.inputs.attached.keyboard;O&&(O.keysRight=H)}get keysRotateLeft(){const H=this.inputs.attached.keyboard;return H?H.keysRotateLeft:[]}set keysRotateLeft(H){const O=this.inputs.attached.keyboard;O&&(O.keysRotateLeft=H)}get keysRotateRight(){const H=this.inputs.attached.keyboard;return H?H.keysRotateRight:[]}set keysRotateRight(H){const O=this.inputs.attached.keyboard;O&&(O.keysRotateRight=H)}get keysRotateUp(){const H=this.inputs.attached.keyboard;return H?H.keysRotateUp:[]}set keysRotateUp(H){const O=this.inputs.attached.keyboard;O&&(O.keysRotateUp=H)}get keysRotateDown(){const H=this.inputs.attached.keyboard;return H?H.keysRotateDown:[]}set keysRotateDown(H){const O=this.inputs.attached.keyboard;O&&(O.keysRotateDown=H)}constructor(H,O,S){var t;super(H,O,S,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),t=this,this.ellipsoid=new p.eO(.5,1,.5),this.ellipsoidOffset=new p.eO(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=p.eO.Zero(),this._diffPosition=p.eO.Zero(),this._newPosition=p.eO.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t._newPosition.t(O),t._newPosition.subtractToRef(t._oldPosition,t._diffPosition),t._diffPosition.length()>D.b.CollisionsEpsilon&&(t.position.addToRef(t._diffPosition,t._deferredPositionUpdate),t._deferOnly?t._deferredUpdated=!0:t.position.t(t._deferredPositionUpdate),t.mj&&S&&t.mj(S))},this.inputs=new K(this),this.inputs.addKeyboard().addMouse()}attachControl(H,O){O=w.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(O)}Jh(){this.inputs.detachElement(),this.cameraDirection=new p.eO(0,0,0),this.cameraRotation=new p.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(H){this._collisionMask=isNaN(H)?-1:H}_collideWithWorld(H){let O;O=this.parent?p.eO.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,O.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const S=this.YH().collisionCoordinator;this._collider||(this._collider=S.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let t=H;this.applyGravity&&(t=H.add(this.YH().gravity)),S.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=p.eO.Zero(),this._transformedDirection=p.eO.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(H){this._needMoveForGravity=H}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.YH().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"th"}}(0,t.d)([(0,q.F)()],F.prototype,"ellipsoid",void 0),(0,t.d)([(0,q.F)()],F.prototype,"ellipsoidOffset",void 0),(0,t.d)([(0,q.J)()],F.prototype,"checkCollisions",void 0),(0,t.d)([(0,q.J)()],F.prototype,"applyGravity",void 0),(0,b.g)("BABYLON.FreeCamera",F)},13532:(H,O,S)=>{"use strict";S.d(O,{b:()=>p});var t=S(11398),q=S(13539);class p{constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=S,this.Zo=[],this._maxBlockCapacity=O||64,this._selectionContent=new t.e(1024),this._creationFunc=H}update(H,O,S){q.b._CreateBlocks(H,O,S,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Mw(H){for(let O=0;O<this.Vo.length;O++){this.Vo[O].addEntry(H)}}iw(H){for(let O=0;O<this.Vo.length;O++){this.Vo[O].removeEntry(H)}}select(H,O){this._selectionContent.reset();for(let S=0;S<this.Vo.length;S++){this.Vo[S].select(H,this._selectionContent,O)}return O?this._selectionContent.concat(this.Zo):this._selectionContent.concatWithNoDuplicate(this.Zo),this._selectionContent}intersects(H,O,S){this._selectionContent.reset();for(let t=0;t<this.Vo.length;t++){this.Vo[t].intersects(H,O,this._selectionContent,S)}return S?this._selectionContent.concat(this.Zo):this._selectionContent.concatWithNoDuplicate(this.Zo),this._selectionContent}intersectsRay(H){this._selectionContent.reset();for(let O=0;O<this.Vo.length;O++){this.Vo[O].intersectsRay(H,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Zo),this._selectionContent}}p.CreationFuncForMeshes=(H,O)=>{const S=H.getBoundingInfo();!H.isBlocked&&S.boundingBox.intersectsMinMax(O.Co,O.no)&&O.entries.push(H)},p.CreationFuncForSubMeshes=(H,O)=>{H.getBoundingInfo().boundingBox.intersectsMinMax(O.Co,O.no)&&O.entries.push(H)}},13539:(H,O,S)=>{"use strict";S.d(O,{b:()=>p});var t=S(11301),q=S(11650);class p{constructor(H,O,S,t,q,p){this.entries=[],this.Qo=new Array,this._capacity=S,this._depth=t,this._maxDepth=q,this._creationFunc=p,this._minPoint=H,this._maxPoint=O,this.Qo.push(H.clone()),this.Qo.push(O.clone()),this.Qo.push(H.clone()),this.Qo[2].x=O.x,this.Qo.push(H.clone()),this.Qo[3].y=O.y,this.Qo.push(H.clone()),this.Qo[4].z=O.z,this.Qo.push(O.clone()),this.Qo[5].z=H.z,this.Qo.push(O.clone()),this.Qo[6].x=H.x,this.Qo.push(O.clone()),this.Qo[7].y=H.y}get wS(){return this._capacity}get Co(){return this._minPoint}get no(){return this._maxPoint}addEntry(H){if(this.Vo)for(let O=0;O<this.Vo.length;O++){this.Vo[O].addEntry(H)}else this._creationFunc(H,this),this.entries.length>this.wS&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(H){if(this.Vo){for(let O=0;O<this.Vo.length;O++){this.Vo[O].removeEntry(H)}return}const O=this.entries.indexOf(H);O>-1&&this.entries.splice(O,1)}addEntries(H){for(let O=0;O<H.length;O++){const S=H[O];this.addEntry(S)}}select(H,O,S){if(q.d.IsInFrustum(this.Qo,H)){if(this.Vo){for(let t=0;t<this.Vo.length;t++){this.Vo[t].select(H,O,S)}return}S?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersects(H,O,S,t){if(q.d.IntersectsSphere(this._minPoint,this._maxPoint,H,O)){if(this.Vo){for(let q=0;q<this.Vo.length;q++){this.Vo[q].intersects(H,O,S,t)}return}t?S.concat(this.entries):S.concatWithNoDuplicate(this.entries)}}intersectsRay(H,O){if(H.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Vo){for(let S=0;S<this.Vo.length;S++){this.Vo[S].intersectsRay(H,O)}return}O.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){p._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(H,O,S,q,G,U,V,w){V.Vo=new Array;const o=new t.eO((O.x-H.x)/2,(O.y-H.y)/2,(O.z-H.z)/2);for(let t=0;t<2;t++)for(let O=0;O<2;O++)for(let h=0;h<2;h++){const a=H.add(o.multiplyByFloats(t,O,h)),j=H.add(o.multiplyByFloats(t+1,O+1,h+1)),e=new p(a,j,q,G+1,U,w);e.addEntries(S),V.Vo.push(e)}}}},13545:(H,O,S)=>{"use strict";S.d(O,{b:()=>o});var t=S(11541),q=S(11301),p=S(11734),G=S(12726),U=S(11582),V=S(13532),w=S(11180);t.e.prototype.createOrUpdateSelectionOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,S=this._getComponent(U.e.NAME_OCTREE);S||(S=new o(this),this.o(S)),this.Ro||(this.Ro=new V.b(V.b.CreationFuncForMeshes,H,O));const t=this.getWorldExtends();return this.Ro.update(t.min,t.max,this.meshes),this.Ro},Object.defineProperty(t.e.prototype,"selectionOctree",{get:function(){return this.Ro},enumerable:!0,configurable:!0}),p.e.prototype.createOrUpdateSubmeshesOctree=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const S=this.YH();let t=S._getComponent(U.e.NAME_OCTREE);t||(t=new o(S),S.o(t)),this._submeshesOctree||(this._submeshesOctree=new V.b(V.b.CreationFuncForSubMeshes,H,O)),this.wU(!0);const q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(q.minimumWorld,q.maximumWorld,this.qU),this._submeshesOctree};class o{constructor(H){this.name=U.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new G.c(q.eO.Zero(),new q.eO(1,1,1)),(H=H||w.c.LastCreatedScene)&&(this.EO=H,this.EO.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.EO.getActiveSubMeshCandidates=H=>this.getActiveSubMeshCandidates(H),this.EO.getCollidingSubMeshCandidates=(H,O)=>this.getCollidingSubMeshCandidates(H,O),this.EO.getIntersectingSubMeshCandidates=(H,O)=>this.getIntersectingSubMeshCandidates(H,O))}register(){this.EO.onMeshRemovedObservable.add((H=>{const O=this.EO.selectionOctree;if(void 0!==O&&null!==O){const S=O.Zo.indexOf(H);-1!==S&&O.Zo.splice(S,1)}})),this.EO.onMeshImportedObservable.add((H=>{const O=this.EO.selectionOctree;void 0!==O&&null!==O&&O.Mw(H)}))}getActiveMeshCandidates(){var H;return(null===(H=this.EO.Ro)||void 0===H?void 0:H.select(this.EO.frustumPlanes))||this.EO._getDefaultMeshCandidates()}getActiveSubMeshCandidates(H){if(H._submeshesOctree&&H.useOctreeForRenderingSelection){return H._submeshesOctree.select(this.EO.frustumPlanes)}return this.EO._getDefaultSubMeshCandidates(H)}getIntersectingSubMeshCandidates(H,O){if(H._submeshesOctree&&H.useOctreeForPicking){G.c.TransformToRef(O,H.getWorldMatrix(),this._tempRay);return H._submeshesOctree.intersectsRay(this._tempRay)}return this.EO._getDefaultSubMeshCandidates(H)}getCollidingSubMeshCandidates(H,O){if(H._submeshesOctree&&H.useOctreeForCollisions){const S=O._velocityWorldLength+Math.max(O._radius.x,O._radius.y,O._radius.z);return H._submeshesOctree.intersects(O._basePointWorld,S)}return this.EO._getDefaultSubMeshCandidates(H)}rebuild(){}dispose(){}}},12726:(H,O,S)=>{"use strict";S.d(O,{c:()=>j});var t=S(11541),q=S(11764),p=S(11307),G=S(11301),U=S(11310),V=S(11638),w=S(11573),o=S(11180),h=S(11599);const a={internalPickerForMesh:void 0};class j{constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.e;this.origin=H,this.direction=O,this.length=S,this.epsilon=t}clone(){return new j(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=j._TmpVector3[0].jU(H.x-S,H.y-S,H.z-S),q=j._TmpVector3[1].jU(O.x+S,O.y+S,O.z+S);let p,G,U,V,w=0,o=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>q.x)return!1}else if(p=1/this.direction.x,G=(t.x-this.origin.x)*p,U=(q.x-this.origin.x)*p,U===-1/0&&(U=1/0),G>U&&(V=G,G=U,U=V),w=Math.max(G,w),o=Math.min(U,o),w>o)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>q.y)return!1}else if(p=1/this.direction.y,G=(t.y-this.origin.y)*p,U=(q.y-this.origin.y)*p,U===-1/0&&(U=1/0),G>U&&(V=G,G=U,U=V),w=Math.max(G,w),o=Math.min(U,o),w>o)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>q.z)return!1}else if(p=1/this.direction.z,G=(t.z-this.origin.z)*p,U=(q.z-this.origin.z)*p,U===-1/0&&(U=1/0),G>U&&(V=G,G=U,U=V),w=Math.max(G,w),o=Math.min(U,o),w>o)return!1;return!0}intersectsBox(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(H.minimum,H.maximum,O)}intersectsSphere(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=H.center.x-this.origin.x,t=H.center.y-this.origin.y,q=H.center.z-this.origin.z,p=S*S+t*t+q*q,G=H.radius+O,U=G*G;if(p<=U)return!0;const V=S*this.direction.x+t*this.direction.y+q*this.direction.z;if(V<0)return!1;return p-V*V<=U}intersectsTriangle(H,O,S){const t=j._TmpVector3[0],q=j._TmpVector3[1],p=j._TmpVector3[2],U=j._TmpVector3[3],w=j._TmpVector3[4];O.subtractToRef(H,t),S.subtractToRef(H,q),G.eO.CrossToRef(this.direction,q,p);const o=G.eO.Dot(t,p);if(0===o)return null;const h=1/o;this.origin.subtractToRef(H,U);const a=G.eO.Dot(U,p)*h;if(a<-this.epsilon||a>1+this.epsilon)return null;G.eO.CrossToRef(U,t,w);const e=G.eO.Dot(this.direction,w)*h;if(e<-this.epsilon||a+e>1+this.epsilon)return null;const X=G.eO.Dot(q,w)*h;return X>this.length?null:new V.c(1-a-e,a,X)}intersectsPlane(H){let O;const S=G.eO.Dot(H.normal,this.direction);if(Math.abs(S)<9.99999997475243e-7)return null;{const t=G.eO.Dot(H.normal,this.origin);return O=(-H.d-t)/S,O<0?O<-9.99999997475243e-7?null:0:O}}intersectsAxis(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(H){case"y":{const H=(this.origin.y-O)/this.direction.y;return H>0?null:new G.eO(this.origin.x+this.direction.x*-H,O,this.origin.z+this.direction.z*-H)}case"x":{const H=(this.origin.x-O)/this.direction.x;return H>0?null:new G.eO(O,this.origin.y+this.direction.y*-H,this.origin.z+this.direction.z*-H)}case"z":{const H=(this.origin.z-O)/this.direction.z;return H>0?null:new G.eO(this.origin.x+this.direction.x*-H,this.origin.y+this.direction.y*-H,O)}default:return null}}intersectsMesh(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=G.TmpVectors.Matrix[0];return H.getWorldMatrix().invertToRef(U),this._tmpRay?j.TransformToRef(this,U,this._tmpRay):this._tmpRay=j.Transform(this,U),H.intersects(this._tmpRay,O,S,t,q,p)}intersectsMeshes(H,O,S){S?S.length=0:S=[];for(let t=0;t<H.length;t++){const q=this.intersectsMesh(H[t],O);q.hit&&S.push(q)}return S.sort(this._comparePickingInfo),S}_comparePickingInfo(H,O){return H.distance<O.distance?-1:H.distance>O.distance?1:0}intersectionSegment(H,O,S){const t=this.origin,q=G.TmpVectors.eO[0],p=G.TmpVectors.eO[1],U=G.TmpVectors.eO[2],V=G.TmpVectors.eO[3];O.subtractToRef(H,q),this.direction.scaleToRef(j._Rayl,U),t.addToRef(U,p),H.subtractToRef(t,V);const w=G.eO.Dot(q,q),o=G.eO.Dot(q,U),h=G.eO.Dot(U,U),a=G.eO.Dot(q,V),e=G.eO.Dot(U,V),X=w*h-o*o;let E,y,T=X,K=X;X<j._Smallnum?(E=0,T=1,y=e,K=h):(E=o*e-h*a,y=w*e-o*a,E<0?(E=0,y=e,K=h):E>T&&(E=T,y=e+o,K=h)),y<0?(y=0,-a<0?E=0:-a>w?E=T:(E=-a,T=w)):y>K&&(y=K,-a+o<0?E=0:-a+o>w?E=T:(E=-a+o,T=w));const b=Math.abs(E)<j._Smallnum?0:E/T,D=Math.abs(y)<j._Smallnum?0:y/K,F=G.TmpVectors.eO[4];U.scaleToRef(D,F);const Y=G.TmpVectors.eO[5];q.scaleToRef(b,Y),Y.addInPlace(V);const l=G.TmpVectors.eO[6];Y.subtractToRef(F,l);return D>0&&D<=this.length&&l.lengthSquared()<S*S?Y.length():-1}update(H,O,S,t,q,p,U){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){j._RayDistant||(j._RayDistant=j.Zero()),j._RayDistant.unprojectRayToRef(H,O,S,t,G.Matrix.IdentityReadOnly,p,U);const V=G.TmpVectors.Matrix[0];q.invertToRef(V),j.TransformToRef(j._RayDistant,V,this)}else this.unprojectRayToRef(H,O,S,t,q,p,U);return this}static Zero(){return new j(G.eO.Zero(),G.eO.Zero())}static CreateNew(H,O,S,t,q,p,G){return j.Zero().update(H,O,S,t,q,p,G)}static CreateNewFromTo(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.Matrix.IdentityReadOnly;const t=new j(new G.eO(0,0,0),new G.eO(0,0,0));return j.CreateFromToToRef(H,O,t,S)}static CreateFromToToRef(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.Matrix.IdentityReadOnly;S.origin.t(H);const q=O.subtractToRef(H,S.direction),p=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return S.length=p,S.direction.normalize(),j.TransformToRef(S,t,S)}static Transform(H,O){const S=new j(new G.eO(0,0,0),new G.eO(0,0,0));return j.TransformToRef(H,O,S),S}static TransformToRef(H,O,S){G.eO.TransformCoordinatesToRef(H.origin,O,S.origin),G.eO.TransformNormalToRef(H.direction,O,S.direction),S.length=H.length,S.epsilon=H.epsilon;const t=S.direction,q=t.length();if(0!==q&&1!==q){const H=1/q;t.x*=H,t.y*=H,t.z*=H,S.length*=q}return S}unprojectRayToRef(H,O,S,t,q,p,U){const V=G.TmpVectors.Matrix[0];q.multiplyToRef(p,V),V.multiplyToRef(U,V),V.invert();const w=o.c.LastCreatedEngine,h=G.TmpVectors.eO[0];h.x=H/S*2-1,h.y=-(O/t*2-1),h.z=null!==w&&void 0!==w&&w.useReverseDepthBuffer?1:null!==w&&void 0!==w&&w.isNDCHalfZRange?0:-1;const a=G.TmpVectors.eO[1].jU(h.x,h.y,1-1e-8),j=G.TmpVectors.eO[2],e=G.TmpVectors.eO[3];G.eO._UnprojectFromInvertedMatrixToRef(h,V,j),G.eO._UnprojectFromInvertedMatrixToRef(a,V,e),this.origin.t(j),e.subtractToRef(j,this.direction),this.direction.normalize()}}function e(H,O,S,t,q){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=j.Zero();return X(H,O,S,t,G,q,p),G}function X(H,O,S,t,q,p){let U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const w=H.getEngine();if(!p&&!(p=H.activeCamera))return H;const o=p.viewport,h=w.getRenderHeight(),{x:a,y:j,width:e,height:X}=o.toGlobal(w.getRenderWidth(),h),E=1/w.getHardwareScalingLevel();return O=O*E-a,S=S*E-(h-j-X),q.update(O,S,e,X,t||G.Matrix.IdentityReadOnly,U?G.Matrix.IdentityReadOnly:p.getViewMatrix(),p.getProjectionMatrix(),V),H}function E(H,O,S,t,q){if(!w.b)return H;const p=H.getEngine();if(!q&&!(q=H.activeCamera))throw new Error("Active camera not set");const U=q.viewport,V=p.getRenderHeight(),{x:o,y:h,width:a,height:j}=U.toGlobal(p.getRenderWidth(),V),e=G.Matrix.Identity(),X=1/p.getHardwareScalingLevel();return O=O*X-o,S=S*X-(V-h-j),t.update(O,S,a,j,e,e,q.getProjectionMatrix()),H}function y(H,O,S,t,q,p,G,U){const V=O(t,S.enableDistantPicking),w=S.intersects(V,q,G,p,t,U);return w&&w.hit?!q&&null!=H&&w.distance>=H.distance?null:w:null}function T(H,O,S,t,q,p){let U=null;const V=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),o=H.cameraToUseForPointers||H.activeCamera,h=a.internalPickerForMesh||y;for(let w=0;w<H.meshes.length;w++){const a=H.meshes[w];if(S){if(!S(a,-1))continue}else if(!a.isEnabled()||!a.isVisible||!a.WV)continue;const j=V&&a.isWorldMatrixCameraDependent(),e=a.wU(j,o);if(a.hasThinInstances&&a.ow){const H=h(U,O,a,e,!0,!0,p);if(H){if(q)return H;const V=G.TmpVectors.Matrix[1],w=a.thinInstanceGetWorldMatrices();for(let H=0;H<w.length;H++){if(S&&!S(a,H))continue;w[H].multiplyToRef(e,V);const G=h(U,O,a,V,t,q,p,!0);if(G&&(U=G,U.thinInstanceIndex=H,t))return U}}}else{const H=h(U,O,a,e,t,q,p);if(H&&(U=H,t))return U}}return U||new w.b}function K(H,O,S,t){if(!w.b)return null;const q=[],p=!!(H.activeCameras&&H.activeCameras.length>1&&H.cameraToUseForPointers!==H.activeCamera),U=H.cameraToUseForPointers||H.activeCamera,V=a.internalPickerForMesh||y;for(let w=0;w<H.meshes.length;w++){const o=H.meshes[w];if(S){if(!S(o,-1))continue}else if(!o.isEnabled()||!o.isVisible||!o.WV)continue;const h=p&&o.isWorldMatrixCameraDependent(),a=o.wU(h,U);if(o.hasThinInstances&&o.ow){if(V(null,O,o,a,!0,!0,t)){const H=G.TmpVectors.Matrix[1],p=o.thinInstanceGetWorldMatrices();for(let G=0;G<p.length;G++){if(S&&!S(o,G))continue;p[G].multiplyToRef(a,H);const U=V(null,O,o,H,!1,!1,t,!0);U&&(U.thinInstanceIndex=G,q.push(U))}}}else{const H=V(null,O,o,a,!1,!1,t);H&&q.push(H)}}return q}function b(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,t=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;t||(t=H.getWorldMatrix()),O.length=S,q?O.origin.t(q):O.origin.t(H.position);const p=G.TmpVectors.eO[2];p.set(0,0,H._scene.useRightHandedSystem?-1:1);const U=G.TmpVectors.eO[3];return G.eO.TransformNormalToRef(p,t,U),G.eO.NormalizeToRef(U,O.direction),O}var D,F;j._TmpVector3=(0,U.d)(6,G.eO.Zero),j._RayDistant=j.Zero(),j._Smallnum=1e-8,j._Rayl=1e9,D=t.e,(F=q.d)&&(F.prototype.getForwardRay=function(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,O=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;return b(this,new j(G.eO.Zero(),G.eO.Zero(),H),H,O,S)},F.prototype.getForwardRayToRef=function(H){return b(this,H,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),D&&(h.b._IsPickingAvailable=!0,D.prototype.createPickingRay=function(H,O,S,t){return e(this,H,O,S,t,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),t.e.prototype.createPickingRayToRef=function(H,O,S,t,q){return X(this,H,O,S,t,q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},t.e.prototype.createPickingRayInCameraSpace=function(H,O,S){return function(H,O,S,t){const q=j.Zero();return E(H,O,S,q,t),q}(this,H,O,S)},t.e.prototype.createPickingRayInCameraSpaceToRef=function(H,O,S,t){return E(this,H,O,S,t)},t.e.prototype.pickWithBoundingInfo=function(H,O,S,t,q){return function(H,O,S,t,q,p){if(!w.b)return null;const U=T(H,(t=>(H._tempPickingRay||(H._tempPickingRay=j.Zero()),X(H,O,S,t,H._tempPickingRay,p||null),H._tempPickingRay)),t,q,!0);return U&&(U.ray=e(H,O,S,G.Matrix.Identity(),p||null)),U}(this,H,O,S,t,q)},t.e.prototype.aS=function(H,O,S,t,q,p){return function(H,O,S,t,q,p,U){const V=T(H,((t,q)=>(H._tempPickingRay||(H._tempPickingRay=j.Zero()),X(H,O,S,t,H._tempPickingRay,p||null,!1,q),H._tempPickingRay)),t,q,!1,U);return V&&(V.ray=e(H,O,S,G.Matrix.Identity(),p||null)),V}(this,H,O,S,t,q,p)},t.e.prototype.pickWithRay=function(H,O,S,t){return function(H,O,S,t,q){const p=T(H,(S=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=G.Matrix.Identity()),S.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=j.Zero()),j.TransformToRef(O,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),S,t,!1,q);return p&&(p.ray=O),p}(this,H,O,S,t)},t.e.prototype.multiPick=function(H,O,S,t,q){return function(H,O,S,t,q,p){return K(H,(t=>e(H,O,S,t,q||null)),t,p)}(this,H,O,S,t,q)},t.e.prototype.multiPickWithRay=function(H,O,S){return function(H,O,S,t){return K(H,(S=>(H._pickWithRayInverseMatrix||(H._pickWithRayInverseMatrix=G.Matrix.Identity()),S.invertToRef(H._pickWithRayInverseMatrix),H._cachedRayForTransform||(H._cachedRayForTransform=j.Zero()),j.TransformToRef(O,H._pickWithRayInverseMatrix,H._cachedRayForTransform),H._cachedRayForTransform)),S,t)}(this,H,O,S)}},13007:(H,O,S)=>{"use strict";var t=S(11239),q=S(11151),p=S(11188),G=S(11266),U=S(11213),V=S(11246);U.b.prototype._partialLoadFile=function(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(H,(H=>{S[O]=H,S._internalCount++,6===S._internalCount&&t(S)}),void 0,void 0,!0,((H,O)=>{q&&H&&q(H.status+" "+H.statusText,O)}))},U.b.prototype._cascadeLoadFiles=function(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=[];q._internalCount=0;for(let p=0;p<6;p++)this._partialLoadFile(S[p],p,q,O,t)},U.b.prototype._cascadeLoadImgs=function(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5?arguments[5]:void 0;const G=[];G._internalCount=0;for(let U=0;U<6;U++)this._partialLoadImg(t[U],U,G,H,O,S,q,p)},U.b.prototype._partialLoadImg=function(H,O,S,t,q,U){let V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0;const o=(0,G.d)();(0,p.s)(H,(H=>{S[O]=H,S._internalCount++,t&&t.removePendingData(o),6===S._internalCount&&U&&U(q,S)}),((H,O)=>{t&&t.removePendingData(o),V&&V(H,O)}),t?t.offlineProvider:null,w),t&&t.addPendingData(o)},U.b.prototype.createCubeTextureBase=function(H,O,S,p){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,j=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,e=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,E=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,y=arguments.length>14&&void 0!==arguments[14]&&arguments[14],T=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const K=e||new t.d(this,7);K.isCube=!0,K.url=H,K.generateMipMaps=!p,K._lodGenerationScale=a,K._lodGenerationOffset=j,K._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!p),K!==e&&(K.label=H.substring(0,60)),this._doNotHandleContextLost||(K._extension=o,K._files=S,K._buffer=T);const b=H;this._transformTextureUrl&&!e&&(H=this._transformTextureUrl(H));const D=o??function(H){const O=H.split("?")[0],S=O.lastIndexOf(".");return S>-1?O.substring(S).toLowerCase():""}(H),F=(0,V.e)(D),Y=(H,O)=>{K.dispose(),U?U(H,O):H&&q.b.Warn(H)},l=(t,U)=>{H===b?t&&Y(t.status+" "+t.statusText,U):(q.b.Warn(`Failed to load ${H}, falling back to the ${b}`),this.createCubeTextureBase(b,O,S,!!p,G,Y,w,o,h,a,j,K,X,E,y,T))};if(F)F.then((t=>{const q=H=>{X&&X(K,H),t.loadCubeData(H,K,h,G,((H,O)=>{Y(H,O)}))};T?q(T):S&&6===S.length?t.supportCascades?this._cascadeLoadFiles(O,(H=>q(H.map((H=>new Uint8Array(H))))),S,Y):Y("Textures type does not support cascades."):this._loadFile(H,(H=>q(new Uint8Array(H))),void 0,void 0,!0,l)}));else{if(!S||0===S.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(O,K,((H,O)=>{E&&E(H,O)}),S,Y)}return this._internalTexturesCache.push(K),K}},13551:(H,O,S)=>{"use strict";S(11151);var t=S(11436);S(11239),S(11382),S(11234),S(11494),S(11450);t.c},13030:(H,O,S)=>{"use strict";S.d(O,{d:()=>q});var t=S(11262);class q{constructor(H){this.value=this._toInt(H)}_toInt(H){return 0|H}add(H){return new q(this.value+H.value)}XO(H){return new q(this.value-H.value)}multiply(H){return new q(Math.imul(this.value,H.value))}divide(H){return new q(this.value/H.value)}getClassName(){return q.ClassName}equals(H){return this.value===H.value}static FromValue(H){return new q(H)}toString(){return this.value.toString()}}q.ClassName="FlowGraphInteger",(0,t.g)("FlowGraphInteger",q)},13043:(H,O,S)=>{"use strict";S.d(O,{b:()=>q,c:()=>p});var t=S(11301);class q{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.ip=H}get m(){return this.ip}transformVector(H){return this.transformVectorToRef(H,new t.Vector2)}transformVectorToRef(H,O){return O.x=H.x*this.ip[0]+H.y*this.ip[1],O.y=H.x*this.ip[2]+H.y*this.ip[3],O}pU(){return this.toArray()}toArray(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<4;O++)H[O]=this.ip[O];return H}jS(H){for(let O=0;O<4;O++)this.ip[O]=H[O];return this}multiplyToRef(H,O){const S=H.ip,t=this.ip,q=O.ip;return q[0]=S[0]*t[0]+S[1]*t[2],q[1]=S[0]*t[1]+S[1]*t[3],q[2]=S[2]*t[0]+S[3]*t[2],q[3]=S[2]*t[1]+S[3]*t[3],O}multiply(H){return this.multiplyToRef(H,new q)}divideToRef(H,O){const S=this.ip,t=H.ip,q=O.ip;return q[0]=S[0]/t[0],q[1]=S[1]/t[1],q[2]=S[2]/t[2],q[3]=S[3]/t[3],O}divide(H){return this.divideToRef(H,new q)}addToRef(H,O){const S=this.ip,t=H.m,q=O.m;return q[0]=S[0]+t[0],q[1]=S[1]+t[1],q[2]=S[2]+t[2],q[3]=S[3]+t[3],O}add(H){return this.addToRef(H,new q)}subtractToRef(H,O){const S=this.ip,t=H.m,q=O.m;return q[0]=S[0]-t[0],q[1]=S[1]-t[1],q[2]=S[2]-t[2],q[3]=S[3]-t[3],O}XO(H){return this.subtractToRef(H,new q)}transpose(){const H=this.ip;return new q([H[0],H[2],H[1],H[3]])}determinant(){const H=this.ip;return H[0]*H[3]-H[1]*H[2]}inverse(){const H=this.determinant();if(0===H)throw new Error("Matrix is not invertible");const O=this.ip,S=1/H;return new q([O[3]*S,-O[1]*S,-O[2]*S,O[0]*S])}equals(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=this.ip,t=H.m;return 0===O?S[0]===t[0]&&S[1]===t[1]&&S[2]===t[2]&&S[3]===t[3]:Math.abs(S[0]-t[0])<O&&Math.abs(S[1]-t[1])<O&&Math.abs(S[2]-t[2])<O&&Math.abs(S[3]-t[3])<O}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.ip.join(", ")})`}}class p{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.ip=H}get m(){return this.ip}transformVector(H){return this.transformVectorToRef(H,new t.eO)}transformVectorToRef(H,O){const S=this.ip;return O.x=H.x*S[0]+H.y*S[1]+H.z*S[2],O.y=H.x*S[3]+H.y*S[4]+H.z*S[5],O.z=H.x*S[6]+H.y*S[7]+H.z*S[8],O}multiplyToRef(H,O){const S=H.ip,t=this.ip,q=O.m;return q[0]=S[0]*t[0]+S[1]*t[3]+S[2]*t[6],q[1]=S[0]*t[1]+S[1]*t[4]+S[2]*t[7],q[2]=S[0]*t[2]+S[1]*t[5]+S[2]*t[8],q[3]=S[3]*t[0]+S[4]*t[3]+S[5]*t[6],q[4]=S[3]*t[1]+S[4]*t[4]+S[5]*t[7],q[5]=S[3]*t[2]+S[4]*t[5]+S[5]*t[8],q[6]=S[6]*t[0]+S[7]*t[3]+S[8]*t[6],q[7]=S[6]*t[1]+S[7]*t[4]+S[8]*t[7],q[8]=S[6]*t[2]+S[7]*t[5]+S[8]*t[8],O}multiply(H){return this.multiplyToRef(H,new p)}divideToRef(H,O){const S=this.ip,t=H.m,q=O.m;return q[0]=S[0]/t[0],q[1]=S[1]/t[1],q[2]=S[2]/t[2],q[3]=S[3]/t[3],q[4]=S[4]/t[4],q[5]=S[5]/t[5],q[6]=S[6]/t[6],q[7]=S[7]/t[7],q[8]=S[8]/t[8],O}divide(H){return this.divideToRef(H,new p)}addToRef(H,O){const S=this.ip,t=H.m,q=O.m;return q[0]=S[0]+t[0],q[1]=S[1]+t[1],q[2]=S[2]+t[2],q[3]=S[3]+t[3],q[4]=S[4]+t[4],q[5]=S[5]+t[5],q[6]=S[6]+t[6],q[7]=S[7]+t[7],q[8]=S[8]+t[8],O}add(H){return this.addToRef(H,new p)}subtractToRef(H,O){const S=this.ip,t=H.m,q=O.m;return q[0]=S[0]-t[0],q[1]=S[1]-t[1],q[2]=S[2]-t[2],q[3]=S[3]-t[3],q[4]=S[4]-t[4],q[5]=S[5]-t[5],q[6]=S[6]-t[6],q[7]=S[7]-t[7],q[8]=S[8]-t[8],O}XO(H){return this.subtractToRef(H,new p)}toArray(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let O=0;O<9;O++)H[O]=this.ip[O];return H}pU(){return this.toArray()}jS(H){for(let O=0;O<9;O++)this.ip[O]=H[O];return this}transpose(){const H=this.ip;return new p([H[0],H[3],H[6],H[1],H[4],H[7],H[2],H[5],H[8]])}determinant(){const H=this.ip;return H[0]*(H[4]*H[8]-H[5]*H[7])-H[1]*(H[3]*H[8]-H[5]*H[6])+H[2]*(H[3]*H[7]-H[4]*H[6])}inverse(){const H=this.determinant();if(0===H)throw new Error("Matrix is not invertible");const O=this.ip,S=1/H;return new p([(O[4]*O[8]-O[5]*O[7])*S,(O[2]*O[7]-O[1]*O[8])*S,(O[1]*O[5]-O[2]*O[4])*S,(O[5]*O[6]-O[3]*O[8])*S,(O[0]*O[8]-O[2]*O[6])*S,(O[2]*O[3]-O[0]*O[5])*S,(O[3]*O[7]-O[4]*O[6])*S,(O[1]*O[6]-O[0]*O[7])*S,(O[0]*O[4]-O[1]*O[3])*S])}equals(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const S=this.ip,t=H.m;return 0===O?S[0]===t[0]&&S[1]===t[1]&&S[2]===t[2]&&S[3]===t[3]&&S[4]===t[4]&&S[5]===t[5]&&S[6]===t[6]&&S[7]===t[7]&&S[8]===t[8]:Math.abs(S[0]-t[0])<O&&Math.abs(S[1]-t[1])<O&&Math.abs(S[2]-t[2])<O&&Math.abs(S[3]-t[3])<O&&Math.abs(S[4]-t[4])<O&&Math.abs(S[5]-t[5])<O&&Math.abs(S[6]-t[6])<O&&Math.abs(S[7]-t[7])<O&&Math.abs(S[8]-t[8])<O}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.ip.join(", ")})`}}},13052:(H,O,S)=>{"use strict";var t;function q(H,O,S,t){switch(O){case"Animation":return t?H.animations.find((H=>H.uniqueId===S))??null:H.animations[S]??null;case"AnimationGroup":return t?H.animationGroups.find((H=>H.uniqueId===S))??null:H.animationGroups[S]??null;case"Mesh":return t?H.meshes.find((H=>H.uniqueId===S))??null:H.meshes[S]??null;case"Material":return t?H.materials.find((H=>H.uniqueId===S))??null:H.materials[S]??null;case"qo":return t?H.cameras.find((H=>H.uniqueId===S))??null:H.cameras[S]??null;case"Light":return t?H.lights.find((H=>H.uniqueId===S))??null:H.lights[S]??null;default:return null}}S.d(O,{c:()=>q}),function(H){H.Animation="Animation",H.AnimationGroup="AnimationGroup",H.Mesh="Mesh",H.Material="Material",H.qo="qo",H.Light="Light"}(t||(t={}))},13082:(H,O,S)=>{"use strict";S.d(O,{d:()=>q});var t=S(13090);class q extends t.d{constructor(H,O){if(super(H),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),O)for(const S of O)this._eventsSignalOutputs[S]=this._registerSignalOutput(S+"Event")}_executeOnTick(H){}_startPendingTasks(H){H._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(H),this._resetAfterCanceled(H)),this._preparePendingTasks(H),H._addPendingBlock(this),this.out._activateSignal(H),H._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(H){H._deleteExecutionVariable(this,"_initialized"),H._removePendingBlock(this)}}},13063:(H,O,S)=>{"use strict";S.d(O,{c:()=>w});var t=S(11266),q=S(11262),p=S(13068),G=S(11140),U=S(13025);class V extends p.e{constructor(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.defaultValue,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(H,O,S),this.richType=t,this._defaultValue=q,this._optional=p,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new G.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(H){this._isDisabled!==H&&(this._isDisabled=H,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(H,O){O._getConnectionValue(this)!==H&&(O._setConnectionValue(this,H),this.onValueChangedObservable.notifyObservers(H))}resetToDefaultValue(H){H._setConnectionValue(this,this._defaultValue)}connectTo(H){this._isDisabled||super.connectTo(H)}_getValueOrDefault(H){const O=H._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(H){if(1===this.connectionType){H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(H);const O=this._getValueOrDefault(H);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}const O=this.isConnected()?this._connectedPoint[0].getValue(H):this._getValueOrDefault(H);return this._lastValue=O,this.richType.typeTransformer?this.richType.typeTransformer(O):O}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.richType={},this.richType.serialize(H.richType),H.optional=this._optional,(0,U.f)("defaultValue",this._defaultValue,H)}}(0,q.g)("FlowGraphDataConnection",V);class w{constructor(H){var O;this.config=H,this.uniqueId=(0,t.d)(),this.name=(null===(O=this.config)||void 0===O?void 0:O.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(H){}registerDataInput(H,O,S){const t=new V(H,0,this,O,S);return this.dataInputs.push(t),t}registerDataOutput(H,O,S){const t=new V(H,1,this,O,S);return this.dataOutputs.push(t),t}getDataInput(H){return this.dataInputs.find((O=>O.name===H))}getDataOutput(H){return this.dataOutputs.find((O=>O.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.f;if(H.uniqueId=this.uniqueId,H.config={},this.config){const S=this.config,t=Object.keys(S);for(const q of t)O(q,S[q],H.config)}H.dataInputs=[],H.dataOutputs=[],H.className=this.getClassName();for(const S of this.dataInputs){const O={};S.serialize(O),H.dataInputs.push(O)}for(const S of this.dataOutputs){const O={};S.serialize(O),H.dataOutputs.push(O)}}deserialize(H){}_log(H,O,S){var t;null===(t=H.logger)||void 0===t||t.addLogItem({action:O,eS:S,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13068:(H,O,S)=>{"use strict";S.d(O,{e:()=>p});var t,q=S(11266);!function(H){H[H.Input=0]="Input",H[H.Output=1]="Output"}(t||(t={}));class p{constructor(H,O,S){this._ownerBlock=S,this._connectedPoint=[],this.uniqueId=(0,q.d)(),this.connectedPointIds=[],this.name=H,this._connectionType=O}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(H){if(this._connectionType===H._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||H._isSingularConnection()&&H._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(H),H._connectedPoint.push(this)}disconnectFrom(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const S=this._connectedPoint.indexOf(H),t=H._connectedPoint.indexOf(this);-1!==S&&-1!==t&&(O&&this._connectedPoint.splice(S,1),H._connectedPoint.splice(t,1))}disconnectFromAll(){for(const H of this._connectedPoint)this.disconnectFrom(H,!1);this._connectedPoint.length=0}dispose(){for(const H of this._connectedPoint)this.disconnectFrom(H)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};H.uniqueId=this.uniqueId,H.name=this.name,H._connectionType=this._connectionType,H.connectedPointIds=[],H.className=this.getClassName();for(const O of this._connectedPoint)H.connectedPointIds.push(O.uniqueId)}getClassName(){return"FGConnection"}deserialize(H){this.uniqueId=H.uniqueId,this.name=H.name,this._connectionType=H._connectionType,this.connectedPointIds=H.connectedPointIds}}},13023:(H,O,S)=>{"use strict";S.d(O,{d:()=>K});var t,q=S(11140),p=S(11287),G=S(11289),U=S(11266),V=S(13025),w=S(13052),o=S(11151);!function(H){H.ExecuteBlock="ExecuteBlock",H.ExecuteEvent="ExecuteEvent",H.TriggerConnection="TriggerConnection",H.ContextVariableSet="ContextVariableSet",H.GlobalVariableSet="GlobalVariableSet",H.GlobalVariableDelete="GlobalVariableDelete",H.GlobalVariableGet="GlobalVariableGet",H.AddConnection="AddConnection",H.GetConnectionValue="GetConnectionValue",H.SetConnectionValue="SetConnectionValue",H.ActivateSignal="ActivateSignal",H.ContextVariableGet="ContextVariableGet"}(t||(t={}));class h{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(H){if(H.time||(H.time=Date.now()),this.log.push(H),this.logToConsole){var O;const S=null===(O=H.eS)||void 0===O?void 0:O.value;"object"===typeof S&&S.getClassName?o.b.Log(`[FGLog] ${H.className}:${H.uniqueId.split("-")[0]} ${H.action} - ${JSON.stringify(S.getClassName())}: ${S.toString()}`):o.b.Log(`[FGLog] ${H.className}:${H.uniqueId.split("-")[0]} ${H.action} - ${JSON.stringify(H.eS)}`)}}getItemsOfType(H){return this.log.filter((O=>O.action===H))}}class a{get enableLogging(){return this._enableLogging}set enableLogging(H){this._enableLogging!==H&&(this._enableLogging=H,this._enableLogging?(this.logger=new h,this.logger.logToConsole=!0):this.logger=null)}constructor(H){this.uniqueId=(0,U.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new q.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=H,this.assetsContext=H.assetsContext??H.EO}hasVariable(H){return H in this._userVariables}setVariable(H,O){var S;this._userVariables[H]=O,null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",eS:{name:H,value:O}})}getAsset(H,O){return(0,w.c)(this.assetsContext,H,O)}getVariable(H){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",eS:{name:H,value:this._userVariables[H]}}),this._userVariables[H]}get userVariables(){return this._userVariables}YH(){return this._configuration.EO}_getUniqueIdPrefixedName(H,O){return`${H.uniqueId}_${O}`}_getGlobalContextVariable(H,O){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",eS:{name:H,defaultValue:O,possibleValue:this._globalContextVariables[H]}}),this._hasGlobalContextVariable(H)?this._globalContextVariables[H]:O}_setGlobalContextVariable(H,O){var S;null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",eS:{name:H,value:O}}),this._globalContextVariables[H]=O}_deleteGlobalContextVariable(H){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",eS:{name:H}}),delete this._globalContextVariables[H]}_hasGlobalContextVariable(H){return H in this._globalContextVariables}_setExecutionVariable(H,O,S){this._executionVariables[this._getUniqueIdPrefixedName(H,O)]=S}_getExecutionVariable(H,O,S){return this._hasExecutionVariable(H,O)?this._executionVariables[this._getUniqueIdPrefixedName(H,O)]:S}_deleteExecutionVariable(H,O){delete this._executionVariables[this._getUniqueIdPrefixedName(H,O)]}_hasExecutionVariable(H,O){return this._getUniqueIdPrefixedName(H,O)in this._executionVariables}_hasConnectionValue(H){return H.uniqueId in this._connectionValues}_setConnectionValue(H,O){var S;this._connectionValues[H.uniqueId]=O,null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",eS:{connectionPointId:H.uniqueId,value:O}})}_setConnectionValueByKey(H,O){this._connectionValues[H]=O}_getConnectionValue(H){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",eS:{connectionPointId:H.uniqueId,value:this._connectionValues[H.uniqueId]}}),this._connectionValues[H.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(H){this._pendingBlocks.includes(H)||(this._pendingBlocks.push(H),this._pendingBlocks.sort(((H,O)=>H.priority-O.priority)))}_removePendingBlock(H){const O=this._pendingBlocks.indexOf(H);-1!==O&&this._pendingBlocks.splice(O,1)}_clearPendingBlocks(){for(const H of this._pendingBlocks)H._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(H){var O;this.onNodeExecutedObservable.notifyObservers(H),null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:H.getClassName(),uniqueId:H.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(H){this._setGlobalContextVariable("timeSinceStart",H.timeSinceStart),this._setGlobalContextVariable("deltaTime",H.deltaTime);for(const S of this._pendingBlocks){var O;null===(O=S._executeOnTick)||void 0===O||O.call(S,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V.f;H.uniqueId=this.uniqueId,H._userVariables={};for(const t in this._userVariables)O(t,this._userVariables[t],H._userVariables);H._connectionValues={};for(const t in this._connectionValues)O(t,this._connectionValues[t],H._connectionValues);var S;this.assetsContext!==this.YH()&&(H._assetsContext={meshes:this.assetsContext.meshes.map((H=>H.id)),materials:this.assetsContext.materials.map((H=>H.id)),textures:this.assetsContext.textures.map((H=>H.name)),animations:this.assetsContext.animations.map((H=>H.name)),lights:this.assetsContext.lights.map((H=>H.id)),cameras:this.assetsContext.cameras.map((H=>H.id)),ia:null===(S=this.assetsContext.ia)||void 0===S?void 0:S.map((H=>H.name)),skeletons:this.assetsContext.skeletons.map((H=>H.id)),ha:this.assetsContext.ha.map((H=>H.name)),geometries:this.assetsContext.geometries.map((H=>H.id)),multiMaterials:this.assetsContext.multiMaterials.map((H=>H.id)),transformNodes:this.assetsContext.transformNodes.map((H=>H.id))})}getClassName(){return"FlowGraphContext"}}(0,p.d)([(0,G.J)()],a.prototype,"uniqueId",void 0);var j=S(13055),e=S(11586);class X{constructor(H){this.onEventTriggeredObservable=new q.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=H,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.up.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const H=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",eS:{timeSinceStart:this._startingTime,deltaTime:H}}),this._startingTime+=H})),this._meshPickedObserver=this._scene.onPointerObservable.add((H=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",eS:H})}),e.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((H=>{const O=H.pointerId,S=H.mesh,t=this._pointerUnderMeshState[O];!t&&S?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",eS:{pointerId:O,mesh:S}}):t&&!S?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",eS:{pointerId:O,mesh:t}}):t&&S&&t!==S&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",eS:{pointerId:O,mesh:t,over:S}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",eS:{pointerId:O,mesh:S,out:t}})),this._pointerUnderMeshState[O]=S}),e.d.POINTERMOVE)}dispose(){var H,O,S,t,q;null===(H=this._sceneDisposeObserver)||void 0===H||H.remove(),null===(O=this._sceneReadyObserver)||void 0===O||O.remove(),null===(S=this._sceneOnBeforeRenderObserver)||void 0===S||S.remove(),null===(t=this._meshPickedObserver)||void 0===t||t.remove(),null===(q=this._meshUnderPointerObserver)||void 0===q||q.remove(),this.onEventTriggeredObservable.clear()}}var E,y=S(13077);!function(H){H[H.Stopped=0]="Stopped",H[H.Started=1]="Started"}(E||(E={}));class T{get state(){return this._state}set state(H){this._state=H,this.onStateChangedObservable.notifyObservers(H)}constructor(H){this.onStateChangedObservable=new q.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=H.EO,this._sceneEventCoordinator=new X(this._scene),this._coordinator=H.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((H=>{for(const O of this._executionContexts){const S=this._getContextualOrder(H.type,O);for(const t of S)if(!t._executeEvent(O,H.eS))break}switch(H.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const O of this._executionContexts)O._notifyOnTick(H.eS);break;case"SceneDispose":this.dispose()}}))}createContext(){const H=new a({EO:this._scene,coordinator:this._coordinator});return this._executionContexts.push(H),H}getContext(H){return this._executionContexts[H]}addEventBlock(H){if("PointerOver"!==H.type&&"PointerOut"!==H.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==H.type&&this._eventBlocks[H.type].push(H),1===this.state)for(const O of this._executionContexts)H._startPendingTasks(O);else this.onStateChangedObservable.addOnce((O=>{if(1===O)for(const S of this._executionContexts)H._startPendingTasks(S)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((H=>{1===H&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const H of this._executionContexts)for(const O in this._eventBlocks){const S=this._getContextualOrder(O,H);for(const O of S)O._startPendingTasks(H)}}_getContextualOrder(H,O){const S=this._eventBlocks[H].sort(((H,O)=>O.initPriority-H.initPriority));if("MeshPick"===H){const H=[];for(const t of S){const q=t.asset.getValue(O);let p=0;for(;p<S.length;p++){const H=S[p].asset.getValue(O);if(q&&H&&(0,y.m)(q,H))break}H.splice(p,0,t)}return H}return S}dispose(){var H;if(0!==this.state){this.state=0;for(const H of this._executionContexts)H._clearPendingBlocks();this._executionContexts.length=0;for(const H in this._eventBlocks)this._eventBlocks[H].length=0;null===(H=this._eventObserver)||void 0===H||H.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(H){const O=[],S=new Set;for(const t in this._eventBlocks)for(const H of this._eventBlocks[t])O.push(H),S.add(H.uniqueId);for(;O.length>0;){const t=O.pop();H(t);for(const H of t.dataInputs)for(const t of H._connectedPoint)S.has(t._ownerBlock.uniqueId)||(O.push(t._ownerBlock),S.add(t._ownerBlock.uniqueId));if(t instanceof j.e)for(const H of t.signalOutputs)for(const t of H._connectedPoint)S.has(t._ownerBlock.uniqueId)||(O.push(t._ownerBlock),S.add(t._ownerBlock.uniqueId))}}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},O=arguments.length>1?arguments[1]:void 0;H.allBlocks=[],this.visitAllBlocks((O=>{const S={};O.serialize(S),H.allBlocks.push(S)})),H.executionContexts=[];for(const S of this._executionContexts){const t={};S.serialize(t,O),H.executionContexts.push(t)}}}class K{constructor(H){this.config=H,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.EO.up.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.EO.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const H=this._executeOnNextFrame.slice(0);if(H.length)for(const O of H){this.notifyCustomEvent(O.id,O.data,!1);const H=this._executeOnNextFrame.findIndex((H=>H.uniqueId===O.uniqueId));-1!==H&&this._executeOnNextFrame.splice(H,1)}}));(K.SceneCoordinators.get(this.config.EO)??[]).push(this)}createGraph(){const H=new T({EO:this.config.EO,coordinator:this});return this._flowGraphs.push(H),H}removeGraph(H){const O=this._flowGraphs.indexOf(H);-1!==O&&(H.dispose(),this._flowGraphs.splice(O,1))}start(){for(const H of this._flowGraphs)H.start()}dispose(){var H,O;for(const q of this._flowGraphs)q.dispose();this._flowGraphs.length=0,null===(H=this._disposeObserver)||void 0===H||H.remove(),null===(O=this._onBeforeRenderObserver)||void 0===O||O.remove();const S=K.SceneCoordinators.get(this.config.EO)??[],t=S.indexOf(this);-1!==t&&S.splice(t,1)}serialize(H,O){H._flowGraphs=[];for(const S of this._flowGraphs){const t={};S.serialize(t,O),H._flowGraphs.push(t)}H.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(H){let O=this._customEventsMap.get(H);return O||(O=new q.b,this._customEventsMap.set(H,O)),O}notifyCustomEvent(H,O){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:H,data:O,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(H)){const O=this._eventExecutionCounter.get(H);if(this._eventExecutionCounter.set(H,O+1),O>=K.MaxEventTypeExecutionPerFrame)return void(O===K.MaxEventTypeExecutionPerFrame&&o.b.Warn(`FlowGraphCoordinator: Too many executions of event "${H}".`))}else this._eventExecutionCounter.set(H,1);const S=this._customEventsMap.get(H);S&&S.notifyObservers(O)}}K.MaxEventsPerType=30,K.MaxEventTypeExecutionPerFrame=30,K.SceneCoordinators=new Map},13080:(H,O,S)=>{"use strict";S.d(O,{e:()=>q});var t=S(13082);class q extends t.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(H){H._notifyExecuteNode(this),this.done._activateSignal(H)}}},13055:(H,O,S)=>{"use strict";S.d(O,{e:()=>U});var t=S(13063),q=S(13068),p=S(11262);class G extends q.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(H){super.connectTo(H),this._connectedPoint.sort(((H,O)=>O.priority-H.priority))}_activateSignal(H){var O;if(null===(O=H.logger)||void 0===O||O.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,eS:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)H._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(H,this),H._increaseExecutionId();else for(const S of this._connectedPoint)S._activateSignal(H)}}(0,p.g)("FlowGraphSignalConnection",G);class U extends t.c{constructor(H){super(H),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(H){const O=new G(H,0,this);return this.signalInputs.push(O),O}_registerSignalOutput(H){const O=new G(H,1,this);return this.signalOutputs.push(O),O}_unregisterSignalInput(H){const O=this.signalInputs.findIndex((O=>O.name===H));-1!==O&&(this.signalInputs[O].dispose(),this.signalInputs.splice(O,1))}_unregisterSignalOutput(H){const O=this.signalOutputs.findIndex((O=>O.name===H));-1!==O&&(this.signalOutputs[O].dispose(),this.signalOutputs.splice(O,1))}_reportError(H,O){this.error.eS="string"===typeof O?new Error(O):O,this.error._activateSignal(H)}getSignalInput(H){return this.signalInputs.find((O=>O.name===H))}getSignalOutput(H){return this.signalOutputs.find((O=>O.name===H))}serialize(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(H),H.signalInputs=[],H.signalOutputs=[];for(const O of this.signalInputs){const S={};O.serialize(S),H.signalInputs.push(S)}for(const O of this.signalOutputs){const S={};O.serialize(S),H.signalOutputs.push(S)}}deserialize(H){for(let O=0;O<H.signalInputs.length;O++){const S=this.getSignalInput(H.signalInputs[O].name);if(!S)throw new Error("Could not find signal input with name "+H.signalInputs[O].name+" in block "+H.className);S.deserialize(H.signalInputs[O])}for(let O=0;O<H.signalOutputs.length;O++){const S=this.getSignalOutput(H.signalOutputs[O].name);if(!S)throw new Error("Could not find signal output with name "+H.signalOutputs[O].name+" in block "+H.className);S.deserialize(H.signalOutputs[O])}}getClassName(){return"FlowGraphExecutionBlock"}}},13090:(H,O,S)=>{"use strict";S.d(O,{d:()=>q});var t=S(13055);class q extends t.e{constructor(H){super(H),this.out=this._registerSignalOutput("out")}}},13035:(H,O,S)=>{"use strict";S.d(O,{A:()=>j,D:()=>e,H:()=>X,L:()=>d,O:()=>v,Q:()=>l,T:()=>Y,e:()=>w,i:()=>a,l:()=>F,p:()=>E,q:()=>y,r:()=>T,t:()=>h,v:()=>D,w:()=>o});var t,q=S(11301),p=S(11355),G=S(13030),U=S(13043);!function(H){H.Any="any",H.String="string",H.Number="number",H.Boolean="boolean",H.Object="object",H.Integer="FlowGraphInteger",H.Vector2="Vector2",H.eO="eO",H.Vector4="Vector4",H.Quaternion="Quaternion",H.Matrix="Matrix",H.Matrix2D="Matrix2D",H.Matrix3D="Matrix3D",H.TO="TO",H.EU="EU"}(t||(t={}));class V{constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=H,this.defaultValue=O,this.animationType=S}serialize(H){H.typeName=this.typeName,H.defaultValue=this.defaultValue}}const w=new V("any",void 0),o=new V("string",""),h=new V("number",0,0),a=new V("boolean",!1),j=new V("Vector2",q.Vector2.Zero(),5),e=new V("eO",q.eO.Zero(),1),X=new V("Vector4",q.Vector4.Zero()),E=new V("Matrix",q.Matrix.Identity(),3),y=new V("Matrix2D",new U.b),T=new V("Matrix3D",new U.c),K=new V("TO",p.TO.Black(),4),b=new V("EU",new p.EU(0,0,0,0),7),D=new V("Quaternion",q.Quaternion.Identity(),2);D.typeTransformer=H=>{if(H.getClassName){if("Vector4"===H.getClassName())return q.Quaternion.KO(H.pU());if("eO"===H.getClassName())return q.Quaternion.FromEulerVector(H);if("Matrix"===H.getClassName())return q.Quaternion.FromRotationMatrix(H)}return H};const F=new V("FlowGraphInteger",new G.d(0),0);function Y(H){const O=H;switch(typeof H){case"string":return o;case"number":return h;case"boolean":return a;case"object":if(O.getClassName)switch(O.getClassName()){case"Vector2":return j;case"eO":return e;case"Vector4":return X;case"Matrix":return E;case"TO":return K;case"EU":return b;case"Quaternion":return D;case"FlowGraphInteger":return F;case"Matrix2D":return y;case"Matrix3D":return T}return w;default:return w}}function l(H){switch(H){case"string":return o;case"number":return h;case"boolean":return a;case"Vector2":return j;case"eO":return e;case"Vector4":return X;case"Matrix":return E;case"TO":return K;case"EU":return b;case"Quaternion":return D;case"FlowGraphInteger":return F;case"Matrix2D":return y;case"Matrix3D":return T;default:return w}}function d(H){switch(H){case"number":default:return 0;case"Vector2":return 5;case"eO":return 1;case"Matrix":return 3;case"TO":return 4;case"EU":return 7;case"Quaternion":return 2}}function v(H){switch(H){case 0:return h;case 5:return j;case 1:return e;case 3:return E;case 4:return K;case 7:return b;case 2:return D;default:return w}}},13025:(H,O,S)=>{"use strict";S.d(O,{e:()=>o,f:()=>w,i:()=>h});var t=S(11355),q=S(11301),p=S(13030),G=S(13035),U=S(13043);function V(H){return"Vector2"===H||"eO"===H||"Vector4"===H||"Quaternion"===H||"TO"===H||"EU"===H}function w(H,O,S){var t;const q=(null===O||void 0===O||null===(t=O.getClassName)||void 0===t?void 0:t.call(O))??"";if(V(q)||function(H){return"Matrix"===H||"Matrix2D"===H||"Matrix3D"===H}(q))S[H]={value:O.pU(),className:q};else if("FlowGraphInteger"===q)S[H]={value:O.value,className:q};else if(q&&(O.id||O.name))S[H]={id:O.id,name:O.name,className:q};else{if("object"===typeof O)throw new Error(`Could not serialize value ${O}`);S[H]=O}}function o(H,O,S,w){const h=O[H];let a;const j=(null===h||void 0===h?void 0:h.type)??(null===h||void 0===h?void 0:h.className);if(function(H){return"Mesh"===H||"AbstractMesh"===H||"GroundMesh"===H||"InstanceMesh"===H||"LinesMesh"===H||"GoldbergMesh"===H||"GreasedLineMesh"===H||"TrailMesh"===H}(j)){let H=w.meshes.filter((H=>h.id?H.id===h.id:H.name===h.name));0===H.length&&(H=w.transformNodes.filter((H=>h.id?H.id===h.id:H.name===h.name))),a=h.uniqueId?H.find((H=>H.uniqueId===h.uniqueId)):H[0]}else if(V(j))a=function(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===H)return q.Vector2.KO(O);if("eO"===H)return S&&(O[2]*=-1),q.eO.KO(O);if("Vector4"===H)return q.Vector4.KO(O);if("Quaternion"===H)return S&&(O[2]*=-1,O[3]*=-1),q.Quaternion.KO(O);if("TO"===H)return new t.TO(O[0],O[1],O[2]);if("EU"===H)return new t.EU(O[0],O[1],O[2],O[3]);throw new Error(`Unknown vector class name ${H}`)}(j,h.value);else if(function(H){return"AnimationGroup"===H}(j)){const H=w.animationGroups.filter((H=>H.name===h.name));a=1===H.length?H[0]:H.find((H=>H.uniqueId===h.uniqueId))}else a="Matrix"===j?q.Matrix.KO(h.value):"Matrix2D"===j?new U.b(h.value):"Matrix3D"===j?new U.c(h.value):"FlowGraphInteger"===j?p.d.FromValue(h.value):"number"===j||"string"===j||"boolean"===j?h.value[0]:h&&void 0!==h.value?h.value:Array.isArray(h)?h.reduce(((H,O)=>O.eventData?(H[O.id]={type:(0,G.Q)(O.type)},"undefined"!==typeof O.value&&(H[O.id].value=o("value",O,S,w)),H):H),{}):h;return a}function h(H){return"FlowGraphJsonPointerParserBlock"===H}},13077:(H,O,S)=>{"use strict";function t(H,O){return!(!H.parent||H.parent!==O&&!t(H.parent,O))}function q(H){if(H.getClassName)return H.getClassName()}function p(H,O){return H===O&&("Vector2"===H||"eO"===H||"Vector4"===H||"Quaternion"===H)}function G(H,O){return H===O&&("Matrix"===H||"Matrix2D"===H||"Matrix3D"===H)}function U(H,O){return"FlowGraphInteger"===H&&"FlowGraphInteger"===O}function V(H,O){const S="number"===typeof H||"number"===typeof(null===H||void 0===H?void 0:H.value);return S&&!O?!isNaN(w(H)):S}function w(H){return"number"===typeof H?H:H.value}S.d(O,{b:()=>U,f:()=>G,i:()=>p,j:()=>q,m:()=>t,p:()=>w,s:()=>V})},12424:(H,O,S)=>{"use strict";S.r(O),S.d(O,{SceneInstrumentation:()=>p});var t=S(11131),q=S(11530);class p{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(H){H!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=H,H?(this._onBeforeActiveMeshesEvaluationObserver=this.EO.onBeforeActiveMeshesEvaluationObservable.add((()=>{t.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.EO.onAfterActiveMeshesEvaluationObservable.add((()=>{t.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.EO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.EO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(H){H!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=H,H?(this._onBeforeRenderTargetsRenderObserver=this.EO.onBeforeRenderTargetsRenderObservable.add((()=>{t.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.EO.onAfterRenderTargetsRenderObservable.add((()=>{t.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.EO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.EO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(H){H!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=H,H?(this._onBeforeParticlesRenderingObserver=this.EO.onBeforeParticlesRenderingObservable.add((()=>{t.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.EO.onAfterParticlesRenderingObservable.add((()=>{t.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.EO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.EO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(H){H!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=H,this.EO.spriteManagers&&(H?(this._onBeforeSpritesRenderingObserver=this.EO.onBeforeSpritesRenderingObservable.add((()=>{t.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.EO.onAfterSpritesRenderingObservable.add((()=>{t.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.EO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.EO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(H){H!==this._capturePhysicsTime&&this.EO.onBeforePhysicsObservable&&(this._capturePhysicsTime=H,H?(this._onBeforePhysicsObserver=this.EO.onBeforePhysicsObservable.add((()=>{t.Tools.StartPerformanceCounter("ph"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.EO.onAfterPhysicsObservable.add((()=>{t.Tools.EndPerformanceCounter("ph"),this._physicsTime.endMonitoring()}))):(this.EO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.EO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(H){H!==this._captureAnimationsTime&&(this._captureAnimationsTime=H,H?this._onAfterAnimationsObserver=this.EO.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.EO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(H){this._captureFrameTime=H}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(H){this._captureInterFrameTime=H}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(H){H!==this._captureRenderTime&&(this._captureRenderTime=H,H?(this._onBeforeDrawPhaseObserver=this.EO.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),t.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.EO.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter("Main render")}))):(this.EO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.EO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(H){H!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=H,H?(this._onBeforeCameraRenderObserver=this.EO.onBeforeCameraRenderObservable.add((H=>{this._cameraRenderTime.beginMonitoring(),t.Tools.StartPerformanceCounter(`Rendering camera ${H.name}`)})),this._onAfterCameraRenderObserver=this.EO.onAfterCameraRenderObservable.add((H=>{this._cameraRenderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter(`Rendering camera ${H.name}`)}))):(this.EO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.EO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.EO.getEngine()._drawCalls}constructor(H){this.EO=H,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new q.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new q.b,this._captureFrameTime=!1,this._frameTime=new q.b,this._captureRenderTime=!1,this._renderTime=new q.b,this._captureInterFrameTime=!1,this._interFrameTime=new q.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new q.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new q.b,this._capturePhysicsTime=!1,this._physicsTime=new q.b,this._captureAnimationsTime=!1,this._animationsTime=new q.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new q.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=H.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(t.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.EO.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=H.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(t.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dp(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dp(),this._captureParticlesRenderTime&&this._particlesRenderTime.dp(),this._captureSpritesRenderTime&&this._spritesRenderTime.dp(),this._captureRenderTime&&this._renderTime.dp(),this._captureCameraRenderTime&&this._cameraRenderTime.dp()}))}dispose(){this._disposed||(this.EO.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.EO.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.EO.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.EO.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.EO.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.EO.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.EO.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.EO.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.EO.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.EO.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.EO.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.EO.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.EO.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.EO.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.EO.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.EO.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.EO.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.EO=null,this._disposed=!0)}}},13021:(H,O,S)=>{"use strict";S.d(O,{b:()=>o});var t=S(11287),q=S(11289),p=S(11301),G=S(11727),U=S(11851),V=S(11904),w=S(11262);G.e.AddNodeConstructor("Light_Type_1",((H,O)=>()=>new o(H,p.eO.Zero(),O)));class o extends V.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(H){this._shadowFrustumSize=H,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(H){this._shadowOrthoScale=H,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(H){this._orthoLeft=H}get orthoRight(){return this._orthoRight}set orthoRight(H){this._orthoRight=H}get orthoTop(){return this._orthoTop}set orthoTop(H){this._orthoTop=H}get orthoBottom(){return this._orthoBottom}set orthoBottom(H){this._orthoBottom=H}constructor(H,O,S){super(H,S),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=O.scale(-1),this.direction=O}getClassName(){return"wh"}getTypeID(){return U.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(H,O,S){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(H):this._setDefaultAutoExtendShadowProjectionMatrix(H,O,S)}_setDefaultFixedFrustumShadowProjectionMatrix(H){const O=this.YH().activeCamera;O&&p.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:O.UU,void 0!==this.shadowMaxZ?this.shadowMaxZ:O.maxZ,H,this.YH().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(H,O,S){const t=this.YH().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const H=p.eO.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let t=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let G=0;G<S.length;G++){const U=S[G];if(!U)continue;const V=U.getBoundingInfo().boundingBox;for(let S=0;S<V.vectorsWorld.length;S++)p.eO.TransformCoordinatesToRef(V.vectorsWorld[S],O,H),H.x<this._orthoLeft&&(this._orthoLeft=H.x),H.y<this._orthoBottom&&(this._orthoBottom=H.y),H.x>this._orthoRight&&(this._orthoRight=H.x),H.y>this._orthoTop&&(this._orthoTop=H.y),this.autoCalcShadowZBounds&&(H.z<t&&(t=H.z),H.z>q&&(q=H.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=t,this._shadowMaxZ=q)}const q=this._orthoRight-this._orthoLeft,G=this._orthoTop-this._orthoBottom,U=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.UU)||0,V=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)||1e4,w=this.YH().getEngine().useReverseDepthBuffer;p.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-q*this.shadowOrthoScale,this._orthoRight+q*this.shadowOrthoScale,this._orthoBottom-G*this.shadowOrthoScale,this._orthoTop+G*this.shadowOrthoScale,w?V:U,w?U:V,H,this.YH().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,O){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,O),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,O),this)}transferToNodeMaterialEffect(H,O){return this.computeTransformedInformation()?(H.setFloat3(O,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(H.setFloat3(O,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(H){const O=this._scene.getEngine();return!O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}getDepthMaxZ(H){const O=this._scene.getEngine();return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:1}prepareLightSpecificDefines(H,O){H["DIRLIGHT"+O]=!0}}(0,t.d)([(0,q.J)()],o.prototype,"shadowFrustumSize",null),(0,t.d)([(0,q.J)()],o.prototype,"shadowOrthoScale",null),(0,t.d)([(0,q.J)()],o.prototype,"autoUpdateExtends",void 0),(0,t.d)([(0,q.J)()],o.prototype,"autoCalcShadowZBounds",void 0),(0,t.d)([(0,q.J)("orthoLeft")],o.prototype,"_orthoLeft",void 0),(0,t.d)([(0,q.J)("orthoRight")],o.prototype,"_orthoRight",void 0),(0,t.d)([(0,q.J)("orthoTop")],o.prototype,"_orthoTop",void 0),(0,t.d)([(0,q.J)("orthoBottom")],o.prototype,"_orthoBottom",void 0),(0,w.g)("BABYLON.DirectionalLight",o)},13473:(H,O,S)=>{"use strict";S.d(O,{b:()=>o});var t=S(11287),q=S(11289),p=S(11301),G=S(11355),U=S(11727),V=S(11851),w=S(11262);U.e.AddNodeConstructor("Light_Type_3",((H,O)=>()=>new o(H,p.eO.Zero(),O)));class o extends V.b{constructor(H,O,S){super(H,S),this.groundColor=new G.TO(0,0,0),this.direction=O||p.eO.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ah"}setDirectionToTarget(H){return this.direction=p.eO.Normalize(H.XO(p.eO.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(H,O){const S=p.eO.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",S.x,S.y,S.z,0,O),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.KU),O),this}transferToNodeMaterialEffect(H,O){const S=p.eO.Normalize(this.direction);return H.setFloat3(O,S.x,S.y,S.z),this}wU(){return this._worldMatrix||(this._worldMatrix=p.Matrix.Identity()),this._worldMatrix}getTypeID(){return V.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(H,O){H["HEMILIGHT"+O]=!0}}(0,t.d)([(0,q.j)()],o.prototype,"groundColor",void 0),(0,t.d)([(0,q.F)()],o.prototype,"direction",void 0),(0,w.g)("BABYLON.HemisphericLight",o)},12980:(H,O,S)=>{"use strict";S.d(O,{b:()=>h});var t=S(11287),q=S(11289),p=S(11301),G=S(11727),U=S(11851),V=S(11904),w=S(11279),o=S(11262);G.e.AddNodeConstructor("Light_Type_2",((H,O)=>()=>new h(H,p.eO.Zero(),p.eO.Zero(),0,0,O)));class h extends V.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(H){this._iesProfileTexture!==H&&(this._iesProfileTexture=H,this._iesProfileTexture&&h._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(H){this._angle=H,this._cosHalfAngle=Math.cos(.5*H),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(H){this._innerAngle=H,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(H){this._shadowAngleScale=H,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(H){this._projectionTextureLightNear=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(H){this._projectionTextureLightFar=H,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(H){this._projectionTextureUpDirection=H,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(H){this._projectionTexture!==H&&(this._projectionTexture=H,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(h._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):h._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(H){return void 0!==H.onGeneratedObservable}static _IsTexture(H){return void 0!==H.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(H){this._projectionTextureProjectionLightMatrix=H,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(H,O,S,t,q,G){super(H,G),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=p.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=p.eO.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=p.eO.Zero(),this._projectionTextureViewLightMatrix=p.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=p.Matrix.Zero(),this._projectionTextureScalingMatrix=p.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=O,this.direction=S,this.angle=t,this.exponent=q}getClassName(){return"SpotLight"}getTypeID(){return U.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(H){super._setDirection(H),this._projectionTextureViewLightDirty=!0}_setPosition(H){super._setPosition(H),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(H,O,S){const t=this.YH().activeCamera;if(!t)return;this._shadowAngleScale=this._shadowAngleScale||1;const q=this._shadowAngleScale*this._angle,G=void 0!==this.shadowMinZ?this.shadowMinZ:t.UU,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,V=this.YH().getEngine().useReverseDepthBuffer;p.Matrix.PerspectiveFovLHToRef(q,1,V?U:G,V?G:U,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,V)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),p.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const H=this.projectionTextureLightFar,O=this.projectionTextureLightNear,S=H/(H-O),t=-S*O,q=1/Math.tan(this._angle/2);p.Matrix.FromValuesToRef(q/1,0,0,0,0,q,0,0,0,0,S,1,0,0,t,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof w.b){const H=this._projectionTexture.uScale/2,O=this._projectionTexture.vScale/2;p.Matrix.FromValuesToRef(H,0,0,0,0,O,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(H,O){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),H.setMatrix("textureProjectionMatrix"+O,this._projectionTextureMatrix),H.setTexture("projectionLightTexture"+O,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&H.setTexture("iesLightTexture"+O,this._iesProfileTexture),this}transferToEffect(H,O){let S;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,O),S=p.eO.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,O),S=p.eO.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",S.x,S.y,S.z,this._cosHalfAngle,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,O),this}transferToNodeMaterialEffect(H,O){let S;return S=this.computeTransformedInformation()?p.eO.Normalize(this.transformedDirection):p.eO.Normalize(this.direction),this.YH().useRightHandedSystem?H.setFloat3(O,-S.x,-S.y,-S.z):H.setFloat3(O,S.x,S.y,S.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(H){const O=this._scene.getEngine(),S=void 0!==this.shadowMinZ?this.shadowMinZ:(null===H||void 0===H?void 0:H.UU)??0;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?S:this._scene.getEngine().isNDCHalfZRange?0:S}getDepthMaxZ(H){const O=this._scene.getEngine(),S=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===H||void 0===H?void 0:H.maxZ)??1e4;return O.useReverseDepthBuffer&&O.isNDCHalfZRange?0:S}prepareLightSpecificDefines(H,O){H["SPOTLIGHT"+O]=!0,H["PROJECTEDLIGHTTEXTURE"+O]=!(!this.projectionTexture||!this.projectionTexture.isReady()),H["IESLIGHTTEXTURE"+O]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,t.d)([(0,q.J)()],h.prototype,"angle",null),(0,t.d)([(0,q.J)()],h.prototype,"innerAngle",null),(0,t.d)([(0,q.J)()],h.prototype,"shadowAngleScale",null),(0,t.d)([(0,q.J)()],h.prototype,"exponent",void 0),(0,t.d)([(0,q.J)()],h.prototype,"projectionTextureLightNear",null),(0,t.d)([(0,q.J)()],h.prototype,"projectionTextureLightFar",null),(0,t.d)([(0,q.J)()],h.prototype,"projectionTextureUpDirection",null),(0,t.d)([(0,q.A)("projectedLightTexture")],h.prototype,"_projectionTexture",void 0),(0,o.g)("BABYLON.SpotLight",h)},12713:(H,O,S)=>{"use strict";S.d(O,{c:()=>G,e:()=>p,i:()=>U});const t={},q={};function p(H,O){t[H]=O}function G(H,O){q[H]=O}function U(H){return q[H]?q[H]:null}},12599:(H,O,S)=>{"use strict";S.d(O,{c:()=>Y,e:()=>k});var t,q=S(11131),p=S(11140),G=S(11541),U=S(11180),V=S(11151),w=S(11774),o=S(11188),h=S(11190),a=S(11266),j=S(11213),e=S(11175);!function(H){H[H.Clean=0]="Clean",H[H.Stop=1]="Stop",H[H.Sync=2]="Sync",H[H.NoSync=3]="NoSync"}(t||(t={}));const X=new p.b,E={};let y=!1;function T(){return E[".babylon"]}function K(H,O){const S=E[H];return S||(V.b.Warn("Unable to find a plugin to load "+H+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),O?T():void 0)}function b(H,O,S){let t="Unable to load from "+(H.rawData?"binary data":H.url);return O?t+=`: ${O}`:S&&(t+=`: ${S}`),t}async function D(H,O,S,t,q,p,G,U,V){var w;const h="data:"===(a=H.url).substring(0,5)?a.substring(5):null;var a;if(H.rawData&&!G)throw"When using ArrayBufferView to load data the file extension must be provided.";const y=h||G?"":function(H){const O=H.indexOf("?");-1!==O&&(H=H.substring(0,O));const S=H.lastIndexOf(".");return H.substring(S,H.length).toLowerCase()}(H.url);let b=G?K(G,!0):h?function(H){for(const O in E){const S=E[O].plugin;if(S.canDirectLoad&&S.canDirectLoad(H))return E[O]}return T()}(H.url):K(y,!1);if(!b&&y){if(H.url&&!H.url.startsWith("blob:")){const O=await async function(H,O){const S=O.method||"GET";return await new Promise(((t,q)=>{const p=new e.c;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const H={};if(O.responseHeaders)for(const S of O.responseHeaders)H[S]=p.getResponseHeader(S)||"";t({response:p.response,headerValues:H})}else q(`Unable to fetch data from ${H}. Error code: ${p.status}`)})),p.open(S,H),p.send()}))}(H.url,{method:"HEAD",responseHeaders:["Content-Type"]}),S=O.headerValues?O.headerValues["Content-Type"]:"";S&&(b=function(H){for(const O in E){const S=E[O];if(S.mimeType===H)return S}}(S))}b||(b=T())}if(!b)throw new Error(`No plugin or fallback for ${G??H.url}`);if(!1===(null===V||void 0===V||null===(w=V[b.plugin.name])||void 0===w?void 0:w.enabled))throw new Error(`The '${b.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(H.rawData&&!b.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(H=>{if(b.plugin.createPlugin){const O=b.plugin.createPlugin(V??{});return O instanceof Promise?(O.then(H).catch((H=>{q("Error instantiating plugin.",H)})),null):(H(O),O)}return H(b.plugin),b.plugin})((V=>{var w;if(!V)throw`The loader plugin corresponding to the '${G}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(X.notifyObservers(V),h&&(V.canDirectLoad&&V.canDirectLoad(H.url)||!(0,o.m)(H.url))){if(V.directLoad){const H=V.directLoad(O,h);H instanceof Promise?H.then((H=>{S(V,H)})).catch((H=>{q("Error in directLoad of _loadData: "+H,H)})):S(V,H)}else S(V,h);return}const a=b.isBinary,e=(H,t)=>{O.G?q("Scene has been disposed"):S(V,H,t)};let E=null,y=!1;null===(w=V.up)||void 0===w||w.add((()=>{y=!0,E&&(E.abort(),E=null),p()}));const T=()=>{if(y)return;const S=(H,O)=>{q(null===H||void 0===H?void 0:H.statusText,O)};if(!V.loadFile&&H.rawData)throw"Plugin does not support loading ArrayBufferView.";E=V.loadFile?V.loadFile(O,H.rawData||H.file||H.url,H.rootUrl,e,t,a,S,U):O._loadFile(H.file||H.url,e,t,!0,a,S)},K=O.getEngine();let D=K.enableOfflineSupport;if(D){let S=!1;for(const t of O.disableOfflineSupportExceptionRules)if(t.test(H.url)){S=!0;break}D=!S}D&&j.b.OfflineProviderFactory?O.offlineProvider=j.b.OfflineProviderFactory(H.url,T,K.disableManifestCheck):T()}))}function F(H,O){let S,t,p=null,G=null;if(O)if(O.name)S=`file:${O.name}`,t=O.name,p=O;else if(ArrayBuffer.isView(O))S="",t=(0,a.d)(),G=O;else if(O.startsWith("data:"))S=O,t="";else if(H){const p=O;if("/"===p.substring(0,1))return q.Tools.Error("Wrong sceneFilename parameter"),null;S=H+p,t=p}else S=O,t=q.Tools.GetFilename(O),H=q.Tools.GetFolderPath(O);else S=H,t=q.Tools.GetFilename(H),H=q.Tools.GetFolderPath(H);return{url:S,rootUrl:H,name:t,file:p,rawData:G}}function Y(H){if("string"===typeof H.extensions){const O=H.extensions;E[O.toLowerCase()]={plugin:H,isBinary:!1}}else{const O=H.extensions,S=Object.keys(O);for(const t of S)E[t.toLowerCase()]={plugin:H,isBinary:O[t].isBinary,mimeType:O[t].mimeType}}}async function l(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.c.LastCreatedScene,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!t)return V.b.Error("No scene available to import mesh to"),null;const j=F(O,S);if(!j)return null;const e={};t.addPendingData(e);const X=()=>{t.removePendingData(e)},E=(H,O)=>{const S=b(j,H,O);G?G(t,S,new h.f(S,h.e.SceneLoaderError,O)):V.b.Error(S),X()},y=p?H=>{try{p(H)}catch(O){E("Error in onProgress callback: "+O,O)}}:void 0,T=(H,O,S,p,G,U,V,w)=>{if(t.importedMeshesFiles.push(j.url),q)try{q(H,O,S,p,G,U,V,w)}catch(o){E("Error in onSuccess callback: "+o,o)}t.removePendingData(e)};return await D(j,t,((O,S,q)=>{if(O.rewriteRootURL&&(j.rootUrl=O.rewriteRootURL(j.rootUrl,q)),O.importMesh){const q=[],p=[],G=[];if(!O.importMesh(H,t,S,j.rootUrl,q,p,G,E))return;t.loadingPluginName=O.name,T(q,p,G,[],[],[],[],[])}else{O.importMeshAsync(H,t,S,j.rootUrl,y,j.name).then((H=>{t.loadingPluginName=O.name,T(H.meshes,H.ha,H.skeletons,H.animationGroups,H.transformNodes,H.geometries,H.lights,H.spriteManagers)})).catch((H=>{E(H.message,H)}))}}),y,E,X,w,o,a)}async function d(H,O,S,t,q,p,G,U){return await new Promise(((V,w)=>{try{l(H,O,S,t,((H,O,S,t,q,p,G,U)=>{V({meshes:H,ha:O,skeletons:S,animationGroups:t,transformNodes:q,geometries:p,lights:G,spriteManagers:U})}),q,((H,O,S)=>{w(S||new Error(O))}),p,G,U).catch(w)}catch(h){w(h)}}))}async function v(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.c.LastCreatedEngine,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,V=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};S?await m(H,O,new G.e(S),t,p,V,w,o,h):q.Tools.Error("No engine available")}async function z(H,O,S,t,q,p,G){return await new Promise(((U,V)=>{v(H,O,S,(H=>{U(H)}),t,((H,O,S)=>{V(S||new Error(O))}),q,p,G)}))}async function m(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.c.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!S)return V.b.Error("No scene available to append to"),null;const j=F(H,O);if(!j)return null;const e={};S.addPendingData(e);const X=()=>{S.removePendingData(e)};w.d.ShowLoadingScreen&&!y&&(y=!0,S.getEngine().displayLoadingUI(),S.executeWhenReady((()=>{S.getEngine().hideLoadingUI(),y=!1})));const E=(H,O)=>{const t=b(j,H,O);p?p(S,t,new h.f(t,h.e.SceneLoaderError,O)):V.b.Error(t),X()},T=q?H=>{try{q(H)}catch(O){E("Error in onProgress callback",O)}}:void 0,K=()=>{if(t)try{t(S)}catch(H){E("Error in onSuccess callback",H)}S.removePendingData(e)};return await D(j,S,((H,O)=>{if(H.load){if(!H.load(S,O,j.rootUrl,E))return;S.loadingPluginName=H.name,K()}else{H.loadAsync(S,O,j.rootUrl,T,j.name).then((()=>{S.loadingPluginName=H.name,K()})).catch((H=>{E(H.message,H)}))}}),T,E,X,G,o,a)}async function r(H,O,S,t,q,p,G){return await new Promise(((U,V)=>{try{m(H,O,S,(H=>{U(H)}),t,((H,O,S)=>{V(S||new Error(O))}),q,p,G).catch(V)}catch(h){V(h)}}))}async function W(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.c.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!S)return V.b.Error("No scene available to load asset container to"),null;const a=F(H,O);if(!a)return null;const j={};S.addPendingData(j);const e=()=>{S.removePendingData(j)},X=(H,O)=>{const t=b(a,H,O);p?p(S,t,new h.f(t,h.e.SceneLoaderError,O)):V.b.Error(t),e()},E=q?H=>{try{q(H)}catch(O){X("Error in onProgress callback",O)}}:void 0,y=H=>{if(t)try{t(H)}catch(O){X("Error in onSuccess callback",O)}S.removePendingData(j)};return await D(a,S,((H,O)=>{if(H.loadAssetContainer){const t=H.loadAssetContainer(S,O,a.rootUrl,X);if(!t)return;t.populateRootNodes(),S.loadingPluginName=H.name,y(t)}else if(H.loadAssetContainerAsync){H.loadAssetContainerAsync(S,O,a.rootUrl,E,a.name).then((O=>{O.populateRootNodes(),S.loadingPluginName=H.name,y(O)})).catch((H=>{X(H.message,H)}))}else X("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),E,X,e,G,w,o)}async function g(H,O,S,t,q,p,G){return await new Promise(((U,V)=>{try{W(H,O,S,(H=>{U(H)}),t,((H,O,S)=>{V(S||new Error(O))}),q,p,G).catch(V)}catch(h){V(h)}}))}async function N(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.c.LastCreatedScene,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!S)return void V.b.Error("No scene available to load animations to");if(t){for(const t of S.animatables)t.reset();S.stopAllAnimations();const H=S.animationGroups.slice();for(const S of H)S.dispose();const O=S.getNodes();for(const S of O)S.animations&&(S.animations=[])}else switch(q){case 0:const H=S.animationGroups.slice();for(const O of H)O.dispose();break;case 1:for(const O of S.animationGroups)O.stop();break;case 2:for(const O of S.animationGroups)O.reset(),O.restart();break;case 3:break;default:return void V.b.Error("Unknown animation group loading mode value '"+q+"'")}const e=S.animatables.length;await W(H,O,S,(H=>{H.mergeAnimationsTo(S,S.animatables.slice(e),p),H.dispose(),S.onAnimationFileImportedObservable.notifyObservers(S),G&&G(S)}),w,o,h,a,j)}async function x(H,O,S,t,q,p,G,U,V,w){return await new Promise(((o,a)=>{try{N(H,O,S,t,q,p,(H=>{o(H)}),G,((H,O,S)=>{a(S||new Error(O))}),U,V,w).catch(a)}catch(h){a(h)}}))}class k{static get ForceFullSceneLoadingForIncremental(){return w.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(H){w.d.ForceFullSceneLoadingForIncremental=H}static get ShowLoadingScreen(){return w.d.ShowLoadingScreen}static set ShowLoadingScreen(H){w.d.ShowLoadingScreen=H}static get loggingLevel(){return w.d.loggingLevel}static set loggingLevel(H){w.d.loggingLevel=H}static get CleanBoneMatrixWeights(){return w.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(H){w.d.CleanBoneMatrixWeights=H}static GetDefaultPlugin(){return T()}static GetPluginForExtension(H){var O;return null===(O=K(H,!0))||void 0===O?void 0:O.plugin}static IsPluginForExtensionAvailable(H){return function(H){return!!E[H]}(H)}static RegisterPlugin(H){Y(H)}static ImportMesh(H,O,S,t,q,p,G,V,w){l(H,O,S,t,q,p,G,V,w).catch((H=>null===G||void 0===G?void 0:G(U.c.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async ImportMeshAsync(H,O,S,t,q,p,G){return await d(H,O,S,t,q,p,G)}static Load(H,O,S,t,q,p,G,V){v(H,O,S,t,q,p,G,V).catch((H=>null===p||void 0===p?void 0:p(U.c.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async LoadAsync(H,O,S,t,q,p){return await z(H,O,S,t,q,p)}static Append(H,O,S,t,q,p,G,V){m(H,O,S,t,q,p,G,V).catch((H=>null===p||void 0===p?void 0:p(S??U.c.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async AppendAsync(H,O,S,t,q,p){return await r(H,O,S,t,q,p)}static LoadAssetContainer(H,O,S,t,q,p,G,V){W(H,O,S,t,q,p,G,V).catch((H=>null===p||void 0===p?void 0:p(S??U.c.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async LoadAssetContainerAsync(H,O,S,t,q,p){return await g(H,O,S,t,q,p)}static ImportAnimations(H,O,S,t,q,p,G,V,w,o,h){N(H,O,S,t,q,p,G,V,w,o,h).catch((H=>null===w||void 0===w?void 0:w(S??U.c.LastCreatedScene,null===H||void 0===H?void 0:H.message,H)))}static async ImportAnimationsAsync(H,O,S,t,q,p,G,U,V,w,o){return await x(H,O,S,t,q,p,U,w,o)}}k.NO_LOGGING=0,k.MINIMAL_LOGGING=1,k.SUMMARY_LOGGING=2,k.DETAILED_LOGGING=3,k.OnPluginActivatedObservable=X},13005:(H,O,S)=>{"use strict";S.d(O,{b:()=>a});var t=S(11287),q=S(11289),p=S(11131),G=S(11301),U=S(11322),V=S(11279),w=S(11262),o=S(11140),h=S(11338);S(13007);class a extends U.e{set boundingBoxSize(H){if(this._boundingBoxSize&&this._boundingBoxSize.equals(H))return;this._boundingBoxSize=H;const O=this.YH();O&&O.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(H){this._rotationY=H,this.setReflectionTextureMatrix(G.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(H,O,S){let t="";for(const q of H)t+=q;return new a(t,O,null,S,H)}static CreateFromPrefilteredData(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=O.useDelayedTextureLoading;O.useDelayedTextureLoading=!1;const p=new a(H,O,null,!1,null,null,null,void 0,!0,S,t);return O.useDelayedTextureLoading=q,p}constructor(H,O){var S;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,a=arguments.length>8&&void 0!==arguments[8]&&arguments[8],j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]&&arguments[10],X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,y=arguments.length>13?arguments[13]:void 0,T=arguments.length>14?arguments[14]:void 0;super(O),this.onLoadObservable=new o.b,this.boundingBoxPosition=G.eO.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new G.Matrix,this._buffer=null,this.name=H,this.url=H,this._noMipmap=q,this.GU=!1,this.isCube=!0,this._textureMatrix=G.Matrix.Identity(),this.coordinatesMode=V.b.CUBIC_MODE;let K=null,b=null;null===t||Array.isArray(t)?(this._noMipmap=q,this._format=h,this._createPolynomials=e,K=t,this._loaderOptions=y,this._useSRGBBuffer=T,this._lodScale=X,this._lodOffset=E):(K=t.extensions??null,this._noMipmap=t.noMipmap??!1,p=t.files??null,b=t.buffer??null,this._format=t.format??5,a=t.prefiltered??!1,j=t.forcedExtension??null,this._createPolynomials=t.createPolynomials??!1,this._lodScale=t.lodScale??.8,this._lodOffset=t.lodOffset??0,this._loaderOptions=t.loaderOptions,this._useSRGBBuffer=t.useSRGBBuffer,U=t.M??null,w=t.onError??null),(H||p)&&this.updateURL(H,j,U,a,w,K,null===(S=this.YH())||void 0===S?void 0:S.useDelayedTextureLoading,p,b)}getClassName(){return"CubeTexture"}updateURL(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=H),this.url=H,O&&(this._forcedExtension=O);const w=H.lastIndexOf("."),o=O||(w>-1?H.substring(w).toLowerCase():""),h=0===o.indexOf(".dds"),a=0===o.indexOf(".env"),j=0===o.indexOf(".basis");if(a?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=t,t&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),U)this._files=U;else if(j||a||h||p||(p=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,p){for(let O=0;O<p.length;O++)this._files.push(H+p[O]);this._extensions=p}this._buffer=V,G?(this.delayLoadState=4,this._delayedOnLoad=S,this._delayedOnError=q):this._loadTexture(S,q)}delayLoad(H){4===this.delayLoadState&&(H&&(this._forcedExtension=H),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(H){var O,S;if(H.updateFlag===this._textureMatrix.updateFlag)return;H.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(S=this.YH())||void 0===S||S.markAllMaterialsAsDirty(1,(H=>-1!==H.getActiveTextures().indexOf(this))));if(this._textureMatrix=H,null===(O=this.YH())||void 0===O||!O.useRightHandedSystem)return;const t=G.TmpVectors.eO[0],q=G.TmpVectors.Quaternion[0],p=G.TmpVectors.eO[1];this._textureMatrix.decompose(t,q,p),q.z*=-1,q.w*=-1,G.Matrix.ComposeToRef(t,q,p,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var H;return null!==(H=this.YH())&&void 0!==H&&H.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=this.YH(),t=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const q=()=>{var O;(this.onLoadObservable.notifyObservers(this),t)&&(t.dispose(),null===(O=this.YH())||void 0===O||O.markAllMaterialsAsDirty(1));H&&H()},G=(H,S)=>{this._loadingError=!0,this._errorObject={message:H,exception:S},O&&O(H,S),V.b.OnTextureLoadErrorObservable.notifyObservers(this)};var U;this._texture?this._texture.isReady?p.Tools.SetImmediate((()=>q())):this._texture.onLoadedObservable.add((()=>q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,S,this._lodScale,this._lodOffset,H,G,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,S,this._files,this._noMipmap,H,G,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(U=this._texture)||void 0===U||U.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(H,O,S){const t=h.e.Parse((()=>{let t=!1;return H.prefiltered&&(t=H.prefiltered),new a(S+(H.url??H.name),O,H.extensions,!1,H.files||null,null,null,void 0,t,H.forcedExtension)}),H,O);if(H.boundingBoxPosition&&(t.boundingBoxPosition=G.eO.KO(H.boundingBoxPosition)),H.boundingBoxSize&&(t.boundingBoxSize=G.eO.KO(H.boundingBoxSize)),H.animations)for(let q=0;q<H.animations.length;q++){const O=H.animations[q],S=(0,w.e)("BABYLON.Animation");S&&t.animations.push(S.Parse(O))}return t}clone(){let H=0;const O=h.e.Clone((()=>{const O=new a(this.url,this.YH()||this._getEngine(),this._extensions,this._noMipmap,this._files);return H=O.uniqueId,O}),this);return O.uniqueId=H,O}}(0,t.d)([(0,q.J)()],a.prototype,"url",void 0),(0,t.d)([(0,q.F)()],a.prototype,"boundingBoxPosition",void 0),(0,t.d)([(0,q.F)()],a.prototype,"boundingBoxSize",null),(0,t.d)([(0,q.J)("rotationY")],a.prototype,"rotationY",null),(0,t.d)([(0,q.J)("files")],a.prototype,"_files",void 0),(0,t.d)([(0,q.J)("forcedExtension")],a.prototype,"_forcedExtension",void 0),(0,t.d)([(0,q.J)("extensions")],a.prototype,"_extensions",void 0),(0,t.d)([(0,q.t)("textureMatrix")],a.prototype,"_textureMatrix",void 0),(0,t.d)([(0,q.t)("textureMatrixRefraction")],a.prototype,"_textureMatrixRefraction",void 0),V.b._CubeTextureParser=a.Parse,(0,w.g)("BABYLON.CubeTexture",a)},13486:(H,O,S)=>{"use strict";S.d(O,{e:()=>V});var t=S(11151),q=S(11279),p=S(11271),G=S(11442),U=S(11239);G.ThinEngine.prototype.createDynamicTexture=function(H,O,S,t){const q=new U.d(this,4);return q.baseWidth=H,q.baseHeight=O,S&&(H=this.needPOTTextures?(0,p.f)(H,this._caps.maxTextureSize):H,O=this.needPOTTextures?(0,p.f)(O,this._caps.maxTextureSize):O),q.width=H,q.height=O,q.isReady=!1,q.generateMipMaps=S,q.samplingMode=t,this.updateTextureSamplingMode(t,q),this._internalTexturesCache.push(q),q},G.ThinEngine.prototype.updateDynamicTexture=function(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!H)return;const G=this._gl,U=G.TEXTURE_2D,V=this._bindTextureDirectly(U,H,!0,p);this._unpackFlipY(void 0===S?H.invertY:S),t&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const w=this._getWebGLTextureType(H.type),o=this._getInternalFormat(q||H.format),h=this._getRGBABufferInternalSizedFormat(H.type,o);G.texImage2D(U,0,h,o,w,O),H.generateMipMaps&&G.generateMipmap(U),V||this._bindTextureDirectly(U,null),t&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),q&&(H.format=q),H._dynamicTextureSource=O,H._premulAlpha=t,H.invertY=S||!1,H.isReady=!0};class V extends q.b{constructor(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,U=arguments.length>6?arguments[6]:void 0;const V=!S||S._isScene;super(null,V?S:null===S||void 0===S?void 0:S.EO,V?!t:S,U,p,void 0,void 0,void 0,void 0,G),this.name=H,this.wrapU=q.b.CLAMP_ADDRESSMODE,this.wrapV=q.b.CLAMP_ADDRESSMODE,this._generateMipMaps=t;const w=this._getEngine();if(!w)return;if(O.getContext)this._canvas=O,this._ownCanvas=!1,this._texture=w.createDynamicTexture(this._canvas.width,this._canvas.height,t,p);else{this._canvas=w.createCanvas(1,1),this._ownCanvas=!0;const H=O;H.width||0===H.width?this._texture=w.createDynamicTexture(H.width,H.height,t,p):this._texture=w.createDynamicTexture(O,O,t,p)}const o=this.getSize();this._canvas.width!==o.width&&(this._canvas.width=o.width),this._canvas.height!==o.height&&(this._canvas.height=o.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(H){this._canvas.width=H.width,this._canvas.height=H.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(H.width,H.height,this._generateMipMaps,this.samplingMode)}scale(H){const O=this.getSize();O.width*=H,O.height*=H,this._recreate(O)}scaleTo(H,O){const S=this.getSize();S.width=H,S.height=O,this._recreate(S)}getContext(){return this._context}clear(H){const O=this.getSize();H&&(this._context.fillStyle=H),this._context.clearRect(0,0,O.width,O.height)}update(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===H||H,O,this._format||void 0,void 0,S)}drawText(H,O,S,t,q,p,G){let U=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const V=this.getSize();if(p&&(this._context.fillStyle=p,this._context.fillRect(0,0,V.width,V.height)),this._context.font=t,null===O||void 0===O){const S=this._context.measureText(H);O=(V.width-S.width)/2}if(null===S||void 0===S){const H=parseInt(t.replace(/\D/g,""));S=V.height/2+H/3.65}this._context.fillStyle=q||"",this._context.fillText(H,O,S),U&&this.update(G)}dispose(){var H,O;(super.dispose(),this._ownCanvas)&&(null===(H=this._canvas)||void 0===H||null===(O=H.remove)||void 0===O||O.call(H));this._canvas=null,this._context=null}clone(){const H=this.YH();if(!H)return this;const O=this.getSize(),S=new V(this.name,O,H,this._generateMipMaps);return S.GU=this.GU,S.level=this.level,S.wrapU=this.wrapU,S.wrapV=this.wrapV,S}serialize(){const H=this.YH();H&&!H.isReady()&&t.b.Warn("The scene must be ready before serializing the dynamic texture");const O=super.serialize();return V._IsCanvasElement(this._canvas)&&(O.base64String=this._canvas.toDataURL()),O.invertY=this._invertY,O.samplingMode=this.samplingMode,O}static _IsCanvasElement(H){return void 0!==H.toDataURL}_rebuild(){this.update()}}},12903:(H,O,S)=>{"use strict";S.d(O,{e:()=>q});var t=S(11279);class q extends t.b{get depth(){return this._depth}constructor(H,O,S,q,p,G){let U=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],V=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.b.TRILINEAR_SAMPLINGMODE,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,h=arguments.length>10?arguments[10]:void 0;super(null,G,!U,V),this.format=p,this._texture=G.getEngine().createRawTexture2DArray(H,O,S,q,p,U,V,w,null,o,h),this._depth=q,this.is2DArray=!0}update(H){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,H,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(H,O,S,t,p){return new q(H,O,S,t,5,p,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12732:(H,O,S)=>{"use strict";S.d(O,{c:()=>U,f:()=>V,g:()=>p,i:()=>G});var t=S(11317),q=S(11301);function p(H,O){return`{X: ${H.x.toFixed(O)} Y: ${H.y.toFixed(O)}}`}function G(H,O){return`{X: ${H._x.toFixed(O)} Y: ${H._y.toFixed(O)} Z: ${H._z.toFixed(O)}}`}function U(H,O){return 2*Math.acos((0,t.Clamp)(q.Quaternion.Dot(H,O)))}function V(H,O){const S=new q.Quaternion;return function(H,O,S){const p=q.eO.Cross(H,O),G=Math.acos((0,t.Clamp)(q.eO.Dot(H,O),-1,1));q.Quaternion.RotationAxisToRef(p,G,S)}(H,O,S),S}},12554:(H,O,S)=>{"use strict";S.d(O,{c:()=>w});var t=S(11301),q=S(11355),p=S(11757),G=S(11736),U=S(11365);S(12556);function V(H){let O=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const S=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],p=[];let V=[];const w=H.width||H.size||1,o=H.height||H.size||1,h=H.depth||H.size||1,a=H.wrap||!1;let j=void 0===H.topBaseAt?1:H.topBaseAt,e=void 0===H.bottomBaseAt?0:H.bottomBaseAt;j=(j+4)%4,e=(e+4)%4;let X=[2,0,3,1][j],E=[2,0,1,3][e],y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(a){O=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let H=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],S=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const t=[17,18,19,16],q=[22,23,20,21];for(;X>0;)H.unshift(H.pop()),t.unshift(t.pop()),X--;for(;E>0;)S.unshift(S.pop()),q.unshift(q.pop()),E--;H=H.flat(),S=S.flat(),y=y.concat(H).concat(S),O.push(t[0],t[2],t[3],t[0],t[1],t[2]),O.push(q[0],q[2],q[3],q[0],q[1],q[2])}const T=[w/2,o/2,h/2];V=y.reduce(((H,O,S)=>H.concat(O*T[S%3])),[]);const K=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,b=H.faceUV||new Array(6),D=H.faceColors,F=[];for(let G=0;G<6;G++)void 0===b[G]&&(b[G]=new t.Vector4(0,0,1,1)),D&&void 0===D[G]&&(D[G]=new q.EU(1,1,1,1));for(let t=0;t<6;t++)if(p.push(b[t].z,U.d?1-b[t].w:b[t].w),p.push(b[t].x,U.d?1-b[t].w:b[t].w),p.push(b[t].x,U.d?1-b[t].y:b[t].y),p.push(b[t].z,U.d?1-b[t].y:b[t].y),D)for(let H=0;H<4;H++)F.push(D[t].r,D[t].g,D[t].b,D[t].a);G.c._ComputeSides(K,V,O,S,p,H.frontUVs,H.backUVs);const Y=new G.c;if(Y.indices=O,Y.dH=V,Y.vH=S,Y.mH=p,D){const H=K===G.c.DOUBLESIDE?F.concat(F):F;Y.zH=H}return Y}function w(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new p.d(H,S);O.sideOrientation=p.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return V(O).WH(t,O.updatable),t}G.c.CreateBox=V,p.d.CreateBox=function(H,O){return w(H,{size:O,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12722:(H,O,S)=>{"use strict";S.d(O,{e:()=>U});var t=S(11757),q=S(11736),p=S(11365);function G(H){const O=[],S=[],t=[],G=[],U=H.radius||.5,V=H.tessellation||64,w=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,o=0===H.sideOrientation?0:H.sideOrientation||q.c.DEFAULTSIDE;O.push(0,0,0),G.push(.5,.5);const h=2*Math.PI*w,a=1===w?h/V:h/(V-1);let j=0;for(let q=0;q<V;q++){const H=Math.cos(j),S=Math.sin(j),t=(H+1)/2,q=(1-S)/2;O.push(U*H,U*S,0),G.push(t,p.d?1-q:q),j+=a}1===w&&(O.push(O[3],O[4],O[5]),G.push(G[2],p.d?1-G[3]:G[3]));const e=O.length/3;for(let q=1;q<e-1;q++)S.push(q+1,0,q);q.c.ComputeNormals(O,S,t),q.c._ComputeSides(o,O,S,t,G,H.frontUVs,H.backUVs);const X=new q.c;return X.indices=S,X.dH=O,X.vH=t,X.mH=G,X}function U(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.d(H,S);O.sideOrientation=t.d._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return G(O).WH(q,O.updatable),q}q.c.CreateDisc=G,t.d.CreateDisc=function(H,O,S){return U(H,{radius:O,tessellation:S,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12556:(H,O,S)=>{"use strict";S.d(O,{h:()=>E,d:()=>T,i:()=>y});var t=S(11301),q=S(11355),p=S(11757),G=S(11736),U=S(11378);p.d._GroundMeshParser=(H,O)=>V.Parse(H,O);class V extends p.d{constructor(H,O){super(H,O),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=H,this._subdivisionsY=H,this.subdivide(H);const S=this;S.createOrUpdateSubmeshesOctree&&S.createOrUpdateSubmeshesOctree(O)}getHeightAtCoordinates(H,O){const S=this.getWorldMatrix(),q=t.TmpVectors.Matrix[5];S.invertToRef(q);const p=t.TmpVectors.eO[8];if(t.eO.TransformCoordinatesFromFloatsToRef(H,0,O,q,p),H=p.x,O=p.z,H<this._minX||H>=this._maxX||O<=this._minZ||O>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(H,O),U=-(G.x*H+G.z*O+G.w)/G.y;return t.eO.TransformCoordinatesFromFloatsToRef(0,U,0,S,p),p.y}getNormalAtCoordinates(H,O){const S=new t.eO(0,1,0);return this.getNormalAtCoordinatesToRef(H,O,S),S}getNormalAtCoordinatesToRef(H,O,S){const q=this.getWorldMatrix(),p=t.TmpVectors.Matrix[5];q.invertToRef(p);const G=t.TmpVectors.eO[8];if(t.eO.TransformCoordinatesFromFloatsToRef(H,0,O,p,G),H=G.x,O=G.z,H<this._minX||H>this._maxX||O<this._minZ||O>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(H,O);return t.eO.TransformNormalFromFloatsToRef(U.x,U.y,U.z,q,S),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(H,O){const S=Math.floor((H+this._maxX)*this._subdivisionsX/this._width),t=Math.floor(-(O+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),q=this._heightQuads[t*this._subdivisionsX+S];let p;return p=O<q.slope.x*H+q.slope.y?q.facet1:q.facet2,p}_initHeightQuads(){const H=this._subdivisionsX,O=this._subdivisionsY;this._heightQuads=[];for(let S=0;S<O;S++)for(let O=0;O<H;O++){const q={slope:t.Vector2.Zero(),facet1:new t.Vector4(0,0,0,0),facet2:new t.Vector4(0,0,0,0)};this._heightQuads[S*H+O]=q}return this}_computeHeightQuads(){const H=this.getVerticesData(U.h.PositionKind);if(!H)return this;const O=t.TmpVectors.eO[3],S=t.TmpVectors.eO[2],q=t.TmpVectors.eO[1],p=t.TmpVectors.eO[0],G=t.TmpVectors.eO[4],V=t.TmpVectors.eO[5],w=t.TmpVectors.eO[6],o=t.TmpVectors.eO[7],h=t.TmpVectors.eO[8];let a=0,j=0,e=0,X=0,E=0,y=0,T=0;const K=this._subdivisionsX,b=this._subdivisionsY;for(let U=0;U<b;U++)for(let b=0;b<K;b++){a=3*b,j=U*(K+1)*3,e=(U+1)*(K+1)*3,O.x=H[j+a],O.y=H[j+a+1],O.z=H[j+a+2],S.x=H[j+a+3],S.y=H[j+a+4],S.z=H[j+a+5],q.x=H[e+a],q.y=H[e+a+1],q.z=H[e+a+2],p.x=H[e+a+3],p.y=H[e+a+4],p.z=H[e+a+5],X=(p.z-O.z)/(p.x-O.x),E=O.z-X*O.x,S.subtractToRef(O,G),q.subtractToRef(O,V),p.subtractToRef(O,w),t.eO.CrossToRef(w,V,o),t.eO.CrossToRef(G,w,h),o.normalize(),h.normalize(),y=-(o.x*O.x+o.y*O.y+o.z*O.z),T=-(h.x*S.x+h.y*S.y+h.z*S.z);const D=this._heightQuads[U*K+b];D.slope.jU(X,E),D.facet1.jU(o.x,o.y,o.z,y),D.facet2.jU(h.x,h.y,h.z,T)}return this}serialize(H){super.serialize(H),H.subdivisionsX=this._subdivisionsX,H.subdivisionsY=this._subdivisionsY,H.minX=this._minX,H.maxX=this._maxX,H.UU=this._minZ,H.maxZ=this._maxZ,H.width=this._width,H.height=this._height}static Parse(H,O){const S=new V(H.name,O);return S._subdivisionsX=H.subdivisionsX||1,S._subdivisionsY=H.subdivisionsY||1,S._minX=H.minX,S._maxX=H.maxX,S._minZ=H.UU,S._maxZ=H.maxZ,S._width=H.width,S._height=H.height,S}}var w=S(11131),o=S(11180),h=S(11307),a=S(11365);function j(H){const O=[],S=[],q=[],p=[];let U,V;const w=H.width||H.size||1,o=H.height||H.size||1,h=0|(H.subdivisionsX||H.subdivisions||1),j=0|(H.subdivisionsY||H.subdivisions||1);for(U=0;U<=j;U++)for(V=0;V<=h;V++){const H=new t.eO(V*w/h-w/2,0,(j-U)*o/j-o/2),O=new t.eO(0,1,0);S.push(H.x,H.y,H.z),q.push(O.x,O.y,O.z),p.push(V/h,a.d?U/j:1-U/j)}for(U=0;U<j;U++)for(V=0;V<h;V++)O.push(V+1+(U+1)*(h+1)),O.push(V+1+U*(h+1)),O.push(V+U*(h+1)),O.push(V+(U+1)*(h+1)),O.push(V+1+(U+1)*(h+1)),O.push(V+U*(h+1));const e=new G.c;return e.indices=O,e.dH=S,e.vH=q,e.mH=p,e}function e(H){const O=void 0!==H.xmin&&null!==H.xmin?H.xmin:-1,S=void 0!==H.zmin&&null!==H.zmin?H.zmin:-1,q=void 0!==H.xmax&&null!==H.xmax?H.xmax:1,p=void 0!==H.zmax&&null!==H.zmax?H.zmax:1,U=H.subdivisions||{w:1,h:1},V=H.precision||{w:1,h:1},w=[],o=[],h=[],a=[];let j,e,X,E;U.h=U.h<1?1:U.h,U.w=U.w<1?1:U.w,V.w=V.w<1?1:V.w,V.h=V.h<1?1:V.h;const y=(q-O)/U.w,T=(p-S)/U.h;function K(H,O,S,q){const p=o.length/3,G=V.w+1;for(j=0;j<V.h;j++)for(e=0;e<V.w;e++){const H=[p+e+j*G,p+(e+1)+j*G,p+(e+1)+(j+1)*G,p+e+(j+1)*G];w.push(H[1]),w.push(H[2]),w.push(H[3]),w.push(H[0]),w.push(H[1]),w.push(H[3])}const U=t.eO.Zero(),X=new t.eO(0,1,0);for(j=0;j<=V.h;j++)for(U.z=j*(q-O)/V.h+O,e=0;e<=V.w;e++)U.x=e*(S-H)/V.w+H,U.y=0,o.push(U.x,U.y,U.z),h.push(X.x,X.y,X.z),a.push(e/V.w,j/V.h)}for(X=0;X<U.h;X++)for(E=0;E<U.w;E++)K(O+E*y,S+X*T,O+(E+1)*y,S+(X+1)*T);const b=new G.c;return b.indices=w,b.dH=o,b.vH=h,b.mH=a,b}function X(H){const O=[],S=[],p=[],U=[];let V,w;const o=H.colorFilter||new q.TO(.3,.59,.11),a=H.alphaFilter||0;let j=!1;if(H.minHeight>H.maxHeight){j=!0;const O=H.maxHeight;H.maxHeight=H.minHeight,H.minHeight=O}for(V=0;V<=H.subdivisions;V++)for(w=0;w<=H.subdivisions;w++){const O=new t.eO(w*H.width/H.subdivisions-H.width/2,0,(H.subdivisions-V)*H.height/H.subdivisions-H.height/2),q=4*(((O.x+H.width/2)/H.width*(H.bufferWidth-1)|0)+((1-(O.z+H.height/2)/H.height)*(H.bufferHeight-1)|0)*H.bufferWidth);let G=H.buffer[q]/255,e=H.buffer[q+1]/255,X=H.buffer[q+2]/255;const E=H.buffer[q+3]/255;j&&(G=1-G,e=1-e,X=1-X);const y=G*o.r+e*o.g+X*o.b;O.y=E>=a?H.minHeight+(H.maxHeight-H.minHeight)*y:H.minHeight-h.e,H.heightBuffer&&(H.heightBuffer[V*(H.subdivisions+1)+w]=O.y),S.push(O.x,O.y,O.z),p.push(0,0,0),U.push(w/H.subdivisions,1-V/H.subdivisions)}for(V=0;V<H.subdivisions;V++)for(w=0;w<H.subdivisions;w++){const t=w+1+(V+1)*(H.subdivisions+1),q=w+1+V*(H.subdivisions+1),p=w+V*(H.subdivisions+1),G=w+(V+1)*(H.subdivisions+1),U=S[3*t+1]>=H.minHeight,o=S[3*q+1]>=H.minHeight,h=S[3*p+1]>=H.minHeight;U&&o&&h&&(O.push(t),O.push(q),O.push(p));S[3*G+1]>=H.minHeight&&U&&h&&(O.push(G),O.push(t),O.push(p))}G.c.ComputeNormals(S,O,p);const e=new G.c;return e.indices=O,e.dH=S,e.vH=p,e.mH=U,e}function E(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const S=new V(H,arguments.length>2?arguments[2]:void 0);S._setReady(!1),S._subdivisionsX=O.subdivisionsX||O.subdivisions||1,S._subdivisionsY=O.subdivisionsY||O.subdivisions||1,S._width=O.width||1,S._height=O.height||1,S._maxX=S._width/2,S._maxZ=S._height/2,S._minX=-S._maxX,S._minZ=-S._maxZ;return j(O).WH(S,O.updatable),S._setReady(!0),S}function y(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new p.d(H,S);return e(O).WH(t,O.updatable),t}function T(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=S.width||10,G=S.height||10,U=S.subdivisions||1,h=S.minHeight||0,a=S.maxHeight||1,j=S.colorFilter||new q.TO(.3,.59,.11),e=S.alphaFilter||0,E=S.updatable,y=S.onReady;t=t||o.c.LastCreatedScene;const T=new V(H,t);let K;T._subdivisionsX=U,T._subdivisionsY=U,T._width=p,T._height=G,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ,T._setReady(!1),S.passHeightBufferInCallback&&(K=new Float32Array((U+1)*(U+1)));const b=(H,O,S)=>{X({width:p,height:G,subdivisions:U,minHeight:h,maxHeight:a,colorFilter:j,buffer:H,bufferWidth:O,bufferHeight:S,alphaFilter:e,heightBuffer:K}).WH(T,E),y&&y(T,K),T._setReady(!0)};if("string"===typeof O){const H=H=>{var O;const S=H.width,q=H.height;if(t.G)return;const p=null===(O=t)||void 0===O?void 0:O.getEngine().resizeImageBitmap(H,S,q);b(p,S,q)};w.Tools.LoadImage(O,H,S.onError?S.onError:()=>{},t.offlineProvider)}else b(O.data,O.width,O.height);return T}G.c.CreateGround=j,G.c.CreateTiledGround=e,G.c.CreateGroundFromHeightMap=X,p.d.CreateGround=(H,O,S,t,q,p)=>E(H,{width:O,height:S,subdivisions:t,updatable:p},q),p.d.CreateTiledGround=(H,O,S,t,q,p,G,U,V)=>y(H,{xmin:O,zmin:S,xmax:t,zmax:q,subdivisions:p,precision:G,updatable:V},U),p.d.CreateGroundFromHeightMap=(H,O,S,t,q,p,G,U,V,w,o)=>T(H,O,{width:S,height:t,subdivisions:q,minHeight:p,maxHeight:G,updatable:V,onReady:w,alphaFilter:o},U)},13206:(H,O,S)=>{"use strict";S.d(O,{c:()=>j,g:()=>h,k:()=>a});var t=S(11301),q=S(11757),p=S(11736),G=S(11855),U=S(11378),V=S(11151);function w(H){const O=[],S=[],t=H.lines,q=H.zH,G=[];let U=0;for(let p=0;p<t.length;p++){const H=t[p];for(let t=0;t<H.length;t++){const{x:V,y:w,z:o}=H[t];if(S.push(V,w,o),q){const H=q[p],{r:O,g:S,b:U,a:V}=H[t];G.push(O,S,U,V)}t>0&&(O.push(U-1),O.push(U)),U++}}const V=new p.c;return V.indices=O,V.dH=S,q&&(V.zH=G),V}function o(H){const O=H.dashSize||3,S=H.gapSize||1,q=H.dashNb||200,G=H.points,U=[],V=[],w=t.eO.Zero();let o=0,h=0,a=0,j=0,e=0,X=0,E=0;for(E=0;E<G.length-1;E++)G[E+1].subtractToRef(G[E],w),o+=w.length();for(a=o/q,j=O*a/(O+S),E=0;E<G.length-1;E++){G[E+1].subtractToRef(G[E],w),h=Math.floor(w.length()/a),w.normalize();for(let H=0;H<h;H++)e=a*H,U.push(G[E].x+e*w.x,G[E].y+e*w.y,G[E].z+e*w.z),U.push(G[E].x+(e+j)*w.x,G[E].y+(e+j)*w.y,G[E].z+(e+j)*w.z),V.push(X,X+1),X+=2}const y=new p.c;return y.dH=U,y.indices=V,y}function h(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=O.instance,q=O.lines,p=O.zH;if(t){const H=t.getVerticesData(U.h.PositionKind);let O,S;p&&(O=t.getVerticesData(U.h.ColorKind));let G=0,V=0;for(let t=0;t<q.length;t++){const U=q[t];for(let q=0;q<U.length;q++)H[G]=U[q].x,H[G+1]=U[q].y,H[G+2]=U[q].z,p&&O&&(S=p[t],O[V]=S[q].r,O[V+1]=S[q].g,O[V+2]=S[q].b,O[V+3]=S[q].a,V+=4),G+=3}return t.updateVerticesData(U.h.PositionKind,H,!1,!1),p&&O&&t.updateVerticesData(U.h.ColorKind,O,!1,!1),t.refreshBoundingInfo(),t}const V=!!p,o=new G.d(H,S,null,void 0,void 0,V,O.useVertexAlpha,O.material);return w(O).WH(o,O.updatable),o}function a(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=O.zH?[O.zH]:null;return h(H,{lines:[O.points],updatable:O.updatable,instance:O.instance,zH:t,useVertexAlpha:O.useVertexAlpha,material:O.material},S)}function j(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=O.points,U=O.instance,w=O.gapSize||1,h=O.dashSize||3;if(U){const H=H=>{const O=t.eO.Zero(),S=H.length/6;let q=0,G=0,V=0,w=0,o=0,h=0,a=0,j=0;for(a=0;a<p.length-1;a++)p[a+1].subtractToRef(p[a],O),q+=O.length();V=q/S;const e=U._creationDataStorage.dashSize;for(w=e*V/(e+U._creationDataStorage.gapSize),a=0;a<p.length-1;a++)for(p[a+1].subtractToRef(p[a],O),G=Math.floor(O.length()/V),O.normalize(),j=0;j<G&&h<H.length;)o=V*j,H[h]=p[a].x+o*O.x,H[h+1]=p[a].y+o*O.y,H[h+2]=p[a].z+o*O.z,H[h+3]=p[a].x+(o+w)*O.x,H[h+4]=p[a].y+(o+w)*O.y,H[h+5]=p[a].z+(o+w)*O.z,h+=6,j++;for(;h<H.length;)H[h]=p[a].x,H[h+1]=p[a].y,H[h+2]=p[a].z,h+=3};return(O.dashNb||O.dashSize||O.gapSize||O.useVertexAlpha||O.material)&&V.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),U.updateMeshPositions(H,!1),U}const a=new G.d(H,S,null,void 0,void 0,void 0,O.useVertexAlpha,O.material);return o(O).WH(a,O.updatable),a._creationDataStorage=new q.f,a._creationDataStorage.dashSize=h,a._creationDataStorage.gapSize=w,a}p.c.CreateLineSystem=w,p.c.CreateDashedLines=o,q.d.ww=function(H,O){return a(H,{points:O,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},q.d.CreateDashedLines=function(H,O,S,t,q){return j(H,{points:O,dashSize:S,gapSize:t,dashNb:q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12606:(H,O,S)=>{"use strict";S.d(O,{e:()=>U,i:()=>V});var t=S(11757),q=S(11736),p=S(11365);function G(H){const O=[],S=[],t=[],G=[],U=void 0!==H.width?H.width:void 0!==H.size?H.size:1,V=void 0!==H.height?H.height:void 0!==H.size?H.size:1,w=0===H.sideOrientation?0:H.sideOrientation||q.c.DEFAULTSIDE,o=U/2,h=V/2;S.push(-o,-h,0),t.push(0,0,-1),G.push(0,p.d?1:0),S.push(o,-h,0),t.push(0,0,-1),G.push(1,p.d?1:0),S.push(o,h,0),t.push(0,0,-1),G.push(1,p.d?0:1),S.push(-o,h,0),t.push(0,0,-1),G.push(0,p.d?0:1),O.push(0),O.push(1),O.push(2),O.push(0),O.push(2),O.push(3),q.c._ComputeSides(w,S,O,t,G,H.frontUVs,H.backUVs);const a=new q.c;return a.indices=O,a.dH=S,a.vH=t,a.mH=G,a}function U(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new t.d(H,S);O.sideOrientation=t.d._GetDefaultSideOrientation(O.sideOrientation),q._originalBuilderSideOrientation=O.sideOrientation;return G(O).WH(q,O.updatable),O.sourcePlane&&(q.translate(O.sourcePlane.normal,-O.sourcePlane.d),q.setDirection(O.sourcePlane.normal.scale(-1))),q}const V={aw:U};q.c.aw=G,t.d.aw=(H,O,S,t,q)=>U(H,{size:O,width:O,height:O,sideOrientation:q,updatable:t},S)},12708:(H,O,S)=>{"use strict";S.d(O,{c:()=>V});var t=S(11301),q=S(11757),p=S(11736),G=S(11365);function U(H){const O=0|(H.segments||32),S=H.diameterX||H.diameter||1,q=H.diameterY||H.diameter||1,U=H.diameterZ||H.diameter||1,V=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,w=H.slice&&H.slice<=0?1:H.slice||1,o=0===H.sideOrientation?0:H.sideOrientation||p.c.DEFAULTSIDE,h=!!H.dedupTopBottomIndices,a=new t.eO(S/2,q/2,U/2),j=2+O,e=2*j,X=[],E=[],y=[],T=[];for(let p=0;p<=j;p++){const H=p/j,O=H*Math.PI*w;for(let S=0;S<=e;S++){const q=S/e,p=q*Math.PI*2*V,U=t.Matrix.RotationZ(-O),w=t.Matrix.RotationY(p),o=t.eO.TransformCoordinates(t.eO.Up(),U),h=t.eO.TransformCoordinates(o,w),j=h.multiply(a),X=h.divide(a).normalize();E.push(j.x,j.y,j.z),y.push(X.x,X.y,X.z),T.push(q,G.d?1-H:H)}if(p>0){const H=E.length/3;for(let O=H-2*(e+1);O+e+2<H;O++)h?(p>1&&(X.push(O),X.push(O+1),X.push(O+e+1)),(p<j||w<1)&&(X.push(O+e+1),X.push(O+1),X.push(O+e+2))):(X.push(O),X.push(O+1),X.push(O+e+1),X.push(O+e+1),X.push(O+1),X.push(O+e+2))}}p.c._ComputeSides(o,E,X,y,T,H.frontUVs,H.backUVs);const K=new p.c;return K.indices=X,K.dH=E,K.vH=y,K.mH=T,K}function V(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return U(O).WH(t,O.updatable),t}p.c.CreateSphere=U,q.d.CreateSphere=(H,O,S,t,q,p)=>V(H,{segments:O,diameterX:S,diameterY:S,diameterZ:S,sideOrientation:p,updatable:q},t)},13499:(H,O,S)=>{"use strict";S.d(O,{b:()=>U});var t=S(11873),q=S(13014),p=S(11893),G=S(11736);class U{static get Configuration(){return{get decoder(){return q.c.DefaultConfiguration},set decoder(H){q.c.DefaultConfiguration=H}}}static set Configuration(H){q.c.DefaultConfiguration=H.decoder}static get DecoderAvailable(){return(0,t.h)(q.c.DefaultConfiguration)}static get Default(){return U._Default??(U._Default=new U),U._Default}static ResetDefault(H){U._Default&&(H||U._Default.dispose(),U._Default=null)}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U.DefaultNumWorkers;const O="number"===typeof H?{...q.c.DefaultConfiguration,numWorkers:H}:{...q.c.DefaultConfiguration,...H};this._decoder=new q.c(O)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(H,O,S){return this._decoder.decodeMeshToMeshDataAsync(H,O,S)}async decodeMeshToGeometryAsync(H,O,S,t){return await this._decoder.decodeMeshToGeometryAsync(H,O,S,t)}async _decodeMeshToGeometryForGltfAsync(H,O,S,t,q,p){return await this._decoder._decodeMeshToGeometryForGltfAsync(H,O,S,t,q,p)}async decodeMeshAsync(H,O){const S=await this._decoder.decodeMeshToMeshDataAsync(H,O),t=new G.c;S.indices&&(t.indices=S.indices);for(const q of S.attributes){const H=p.d.GetFloatData(q.data,q.size,p.d.GetDataType(q.data),q.byteOffset,q.byteStride,q.normalized,S.totalVertices);t.set(H,q.kind)}return t}}U.DefaultNumWorkers=(0,t.g)(),U._Default=null},13014:(H,O,S)=>{"use strict";S.d(O,{c:()=>w});var t=S(11873),q=S(11131),p=S(11768),G=S(11893),U=S(11151),V=S(11884);class w extends t.e{static get DefaultAvailable(){return(0,t.h)(w.DefaultConfiguration)}static get Default(){return w._Default??(w._Default=new w),w._Default}static ResetDefault(H){w._Default&&(H||w._Default.dispose(),w._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(H,O){return{module:await(O||DracoDecoderModule)({wasmBinary:H})}}_getWorkerContent(){return`${V.e}(${V.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.DefaultConfiguration)}decodeMeshToMeshDataAsync(H,O,S){const t=H instanceof ArrayBuffer?new Int8Array(H):new Int8Array(H.buffer,H.byteOffset,H.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async H=>await new Promise(((q,p)=>{H.push(((H,G)=>{let V=null;const w=[],o=O=>{H.removeEventListener("error",o),H.removeEventListener("message",h),p(O),G()},h=O=>{const t=O.data;switch(t.id){case"indices":V=t.data;break;case"attribute":w.push({kind:t.kind,data:t.data,size:t.size,byteOffset:t.byteOffset,byteStride:t.byteStride,normalized:(p=t.kind,a=t.normalized,S&&void 0!==S[p]?(a!==S[p]&&U.b.Warn(`Normalized flag from Draco data (${a}) does not match normalized flag from glTF accessor (${S[p]}). Using flag from glTF accessor.`),S[p]):a)});break;case"decodeMeshDone":H.removeEventListener("error",o),H.removeEventListener("message",h),q({indices:V,attributes:w,totalVertices:t.totalVertices}),G()}var p,a};H.addEventListener("error",o),H.addEventListener("message",h);const a=t.slice();H.postMessage({id:"decodeMesh",dataView:a,attributes:O},[a.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((H=>{let S=null;const q=[],p=(0,V.e)(H.module,t,O,(H=>{S=H}),((H,O,S,t,p,G)=>{q.push({kind:H,data:O,size:S,byteOffset:t,byteStride:p,normalized:G})}));return{indices:S,attributes:q,totalVertices:p}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(H,O,S,t){const q=await this.decodeMeshToMeshDataAsync(S,t),U=new p.b(H,O);q.indices&&U.setIndices(q.indices);for(const p of q.attributes)U.setVerticesBuffer(new G.d(O.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),q.totalVertices);return U}async _decodeMeshToGeometryForGltfAsync(H,O,S,t,q,U){const V=await this.decodeMeshToMeshDataAsync(S,t,q),w=new p.b(H,O);U&&(w._boundingInfo=U,w.useBoundingInfoFromGeometry=!0),V.indices&&w.setIndices(V.indices);for(const p of V.attributes)w.setVerticesBuffer(new G.d(O.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),V.totalVertices);return w}}w.DefaultConfiguration={wasmUrl:`${q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},w._Default=null},13204:(H,O,S)=>{"use strict";S.d(O,{e:()=>UH});var t=S(11301),q=S(11757),p=S(11378),G=S(11736),U=S(11365);function V(H){let O=H.pathArray;const S=H.closeArray||!1,t=H.closePath||!1,q=H.invertUV||!1,V=Math.floor(O[0].length/2);let w=H.offset||V;w=w>V?V:Math.floor(w);const o=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,h=H.mH,a=H.zH,j=[],e=[],X=[],E=[],y=[],T=[],K=[],b=[];let D;const F=[],Y=[];let l,d,v;if(O.length<2){const H=[],S=[];for(d=0;d<O[0].length-w;d++)H.push(O[0][d]),S.push(O[0][d+w]);O=[H,S]}let z=0;const m=t?1:0,r=S?1:0;let W,g,N,x,k,A;for(D=O[0].length,l=0;l<O.length+r;l++){for(K[l]=0,y[l]=[0],W=l===O.length?O[0]:O[l],g=W.length,D=D<g?D:g,v=0;v<g;)j.push(W[v].x,W[v].y,W[v].z),v>0&&(N=W[v].XO(W[v-1]).length(),x=N+K[l],y[l].push(x),K[l]=x),v++;t&&(v--,j.push(W[0].x,W[0].y,W[0].z),N=W[v].XO(W[0]).length(),x=N+K[l],y[l].push(x),K[l]=x),F[l]=g+m,Y[l]=z,z+=g+m}let u,J,P=null,f=null;for(d=0;d<D+m;d++)for(b[d]=0,T[d]=[0],l=0;l<O.length-1+r;l++)k=O[l],A=l===O.length-1?O[0]:O[l+1],d===D?(P=k[0],f=A[0]):(P=k[d],f=A[d]),N=f.XO(P).length(),x=N+b[d],T[d].push(x),b[d]=x;if(h)for(l=0;l<h.length;l++)E.push(h[l].x,U.d?1-h[l].y:h[l].y);else for(l=0;l<O.length+r;l++)for(d=0;d<D+m;d++)u=0!=K[l]?y[l][d]/K[l]:0,J=0!=b[d]?T[d][l]/b[d]:0,q?E.push(J,u):E.push(u,U.d?1-J:J);l=0;let c=0,R=F[l]-1,B=F[l+1]-1,Z=R<B?R:B,I=Y[1]-Y[0];const s=F.length-1;for(;c<=Z&&l<s;)e.push(c,c+I,c+1),e.push(c+I+1,c+1,c+I),c+=1,c===Z&&(l++,I=Y[l+1]-Y[l],R=F[l]-1,B=F[l+1]-1,c=Y[l],Z=R<B?R+c:B+c);if(G.c.ComputeNormals(j,e,X),t){let H=0,S=0;for(l=0;l<O.length;l++){H=3*Y[l],S=l+1<O.length?3*(Y[l+1]-1):X.length-3,X[H]=.5*(X[H]+X[S]),X[H+1]=.5*(X[H+1]+X[S+1]),X[H+2]=.5*(X[H+2]+X[S+2]);const t=Math.sqrt(X[H]*X[H]+X[H+1]*X[H+1]+X[H+2]*X[H+2]);X[H]/=t,X[H+1]/=t,X[H+2]/=t,X[S]=X[H],X[S+1]=X[H+1],X[S+2]=X[H+2]}}if(S){let H=3*Y[0],S=3*Y[O.length];for(d=0;d<D+m;d++){X[H]=.5*(X[H]+X[S]),X[H+1]=.5*(X[H+1]+X[S+1]),X[H+2]=.5*(X[H+2]+X[S+2]);const O=Math.sqrt(X[H]*X[H]+X[H+1]*X[H+1]+X[H+2]*X[H+2]);X[H]/=O,X[H+1]/=O,X[H+2]/=O,X[S]=X[H],X[S+1]=X[H+1],X[S+2]=X[H+2],H+=3,S+=3}}G.c._ComputeSides(o,j,e,X,E,H.frontUVs,H.backUVs);let i=null;if(a){i=new Float32Array(4*a.length);for(let H=0;H<a.length;H++)i[4*H]=a[H].r,i[4*H+1]=a[H].g,i[4*H+2]=a[H].b,i[4*H+3]=a[H].a}const M=new G.c,C=new Float32Array(j),n=new Float32Array(X),Q=new Float32Array(E);return M.indices=e,M.dH=C,M.vH=n,M.mH=Q,i&&M.set(i,p.h.ColorKind),t&&(M._idx=Y),M}function w(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=O.pathArray,o=O.closeArray,h=O.closePath,a=q.d._GetDefaultSideOrientation(O.sideOrientation),j=O.instance,e=O.updatable;if(j){const H=t.TmpVectors.eO[0].XU(Number.MAX_VALUE),S=t.TmpVectors.eO[1].XU(-Number.MAX_VALUE),V=O=>{let t=w[0].length;const p=j;let G=0;const U=p._originalBuilderSideOrientation===q.d.DOUBLESIDE?2:1;for(let q=1;q<=U;++q)for(let U=0;U<w.length;++U){const q=w[U],V=q.length;t=t<V?t:V;for(let p=0;p<t;++p){const t=q[p];O[G]=t.x,O[G+1]=t.y,O[G+2]=t.z,H.minimizeInPlaceFromFloats(t.x,t.y,t.z),S.maximizeInPlaceFromFloats(t.x,t.y,t.z),G+=3}if(p._creationDataStorage&&p._creationDataStorage.closePath){const H=q[0];O[G]=H.x,O[G+1]=H.y,O[G+2]=H.z,G+=3}}},o=j.getVerticesData(p.h.PositionKind);if(V(o),j.hasBoundingInfo?j.getBoundingInfo().reConstruct(H,S,j._worldMatrix):j.buildBoundingInfo(H,S,j._worldMatrix),j.updateVerticesData(p.h.PositionKind,o,!1,!1),O.zH){const H=j.getVerticesData(p.h.ColorKind);for(let S=0,t=0;S<O.zH.length;S++,t+=4){const q=O.zH[S];H[t]=q.r,H[t+1]=q.g,H[t+2]=q.b,H[t+3]=q.a}j.updateVerticesData(p.h.ColorKind,H,!1,!1)}if(O.mH){const H=j.getVerticesData(p.h.UVKind);for(let S=0;S<O.mH.length;S++)H[2*S]=O.mH[S].x,H[2*S+1]=U.d?1-O.mH[S].y:O.mH[S].y;j.updateVerticesData(p.h.UVKind,H,!1,!1)}if(!j.areNormalsFrozen||j.isFacetDataEnabled){const H=j.hU(),O=j.getVerticesData(p.h.NormalKind),S=j.isFacetDataEnabled?j.getFacetDataParameters():null;if(G.c.ComputeNormals(o,H,O,S),j._creationDataStorage&&j._creationDataStorage.closePath){let H=0,S=0;for(let t=0;t<w.length;t++)H=3*j._creationDataStorage.idx[t],S=t+1<w.length?3*(j._creationDataStorage.idx[t+1]-1):O.length-3,O[H]=.5*(O[H]+O[S]),O[H+1]=.5*(O[H+1]+O[S+1]),O[H+2]=.5*(O[H+2]+O[S+2]),O[S]=O[H],O[S+1]=O[H+1],O[S+2]=O[H+2]}j.areNormalsFrozen||j.updateVerticesData(p.h.NormalKind,O,!1,!1)}return j}{const t=new q.d(H,S);t._originalBuilderSideOrientation=a,t._creationDataStorage=new q.f;const p=V(O);return h&&(t._creationDataStorage.idx=p._idx),t._creationDataStorage.closePath=h,t._creationDataStorage.closeArray=o,p.WH(t,e),t}}G.c.CreateRibbon=V,q.d.CreateRibbon=function(H,O){return w(H,{pathArray:O,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var o=S(12722),h=S(12554),a=S(11355);function j(H){const O=H.pattern||q.d.NO_FLIP,S=H.tileWidth||H.tileSize||1,t=H.tileHeight||H.tileSize||1,p=H.alignHorizontal||0,U=H.alignVertical||0,V=H.width||H.size||1,w=Math.floor(V/S);let o=V-w*S;const h=H.height||H.size||1,a=Math.floor(h/t);let j=h-a*t;const e=S*w/2,X=t*a/2;let E=0,y=0,T=0,K=0,b=0,D=0;if(o>0||j>0){switch(T=-e,K=-X,b=e,D=X,p){case q.d.CENTER:o/=2,T-=o,b+=o;break;case q.d.LEFT:b+=o,E=-o/2;break;case q.d.RIGHT:T-=o,E=o/2}switch(U){case q.d.CENTER:j/=2,K-=j,D+=j;break;case q.d.BOTTOM:D+=j,y=-j/2;break;case q.d.TOP:K-=j,y=j/2}}const F=[],Y=[],l=[];l[0]=[0,0,1,0,1,1,0,1],l[1]=[0,0,1,0,1,1,0,1],O!==q.d.ROTATE_TILE&&O!==q.d.ROTATE_ROW||(l[1]=[1,1,0,1,0,0,1,0]),O!==q.d.FLIP_TILE&&O!==q.d.FLIP_ROW||(l[1]=[1,0,0,0,0,1,1,1]),O!==q.d.FLIP_N_ROTATE_TILE&&O!==q.d.FLIP_N_ROTATE_ROW||(l[1]=[0,1,1,1,1,0,0,0]);let d=[];const v=[],z=[];let m=0;for(let G=0;G<a;G++)for(let H=0;H<w;H++)F.push(H*S-e+E,G*t-X+y,0),F.push((H+1)*S-e+E,G*t-X+y,0),F.push((H+1)*S-e+E,(G+1)*t-X+y,0),F.push(H*S-e+E,(G+1)*t-X+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),d=O===q.d.FLIP_TILE||O===q.d.ROTATE_TILE||O===q.d.FLIP_N_ROTATE_TILE?d.concat(l[(H%2+G%2)%2]):O===q.d.FLIP_ROW||O===q.d.ROTATE_ROW||O===q.d.FLIP_N_ROTATE_ROW?d.concat(l[G%2]):d.concat(l[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),m+=4;if(o>0||j>0){const H=j>0&&(U===q.d.CENTER||U===q.d.TOP),G=j>0&&(U===q.d.CENTER||U===q.d.BOTTOM),V=o>0&&(p===q.d.CENTER||p===q.d.RIGHT),h=o>0&&(p===q.d.CENTER||p===q.d.LEFT);let l,r,W,g,N=[];if(H&&V&&(F.push(T+E,K+y,0),F.push(-e+E,K+y,0),F.push(-e+E,K+j+y,0),F.push(T+E,K+j+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,l=1-o/S,r=1-j/t,W=1,g=1,N=[l,r,W,r,W,g,l,g],O===q.d.ROTATE_ROW&&(N=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),O===q.d.FLIP_ROW&&(N=[1-l,r,1-W,r,1-W,g,1-l,g]),O===q.d.FLIP_N_ROTATE_ROW&&(N=[l,1-r,W,1-r,W,1-g,l,1-g]),d=d.concat(N),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H&&h&&(F.push(e+E,K+y,0),F.push(b+E,K+y,0),F.push(b+E,K+j+y,0),F.push(e+E,K+j+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,l=0,r=1-j/t,W=o/S,g=1,N=[l,r,W,r,W,g,l,g],(O===q.d.ROTATE_ROW||O===q.d.ROTATE_TILE&&w%2===0)&&(N=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),(O===q.d.FLIP_ROW||O===q.d.FLIP_TILE&&w%2===0)&&(N=[1-l,r,1-W,r,1-W,g,1-l,g]),(O===q.d.FLIP_N_ROTATE_ROW||O===q.d.FLIP_N_ROTATE_TILE&&w%2===0)&&(N=[l,1-r,W,1-r,W,1-g,l,1-g]),d=d.concat(N),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&V&&(F.push(T+E,X+y,0),F.push(-e+E,X+y,0),F.push(-e+E,D+y,0),F.push(T+E,D+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,l=1-o/S,r=0,W=1,g=j/t,N=[l,r,W,r,W,g,l,g],(O===q.d.ROTATE_ROW&&a%2===1||O===q.d.ROTATE_TILE&&a%1===0)&&(N=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),(O===q.d.FLIP_ROW&&a%2===1||O===q.d.FLIP_TILE&&a%2===0)&&(N=[1-l,r,1-W,r,1-W,g,1-l,g]),(O===q.d.FLIP_N_ROTATE_ROW&&a%2===1||O===q.d.FLIP_N_ROTATE_TILE&&a%2===0)&&(N=[l,1-r,W,1-r,W,1-g,l,1-g]),d=d.concat(N),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&h&&(F.push(e+E,X+y,0),F.push(b+E,X+y,0),F.push(b+E,D+y,0),F.push(e+E,D+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,l=0,r=0,W=o/S,g=j/t,N=[l,r,W,r,W,g,l,g],(O===q.d.ROTATE_ROW&&a%2===1||O===q.d.ROTATE_TILE&&(a+w)%2===1)&&(N=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),(O===q.d.FLIP_ROW&&a%2===1||O===q.d.FLIP_TILE&&(a+w)%2===1)&&(N=[1-l,r,1-W,r,1-W,g,1-l,g]),(O===q.d.FLIP_N_ROTATE_ROW&&a%2===1||O===q.d.FLIP_N_ROTATE_TILE&&(a+w)%2===1)&&(N=[l,1-r,W,1-r,W,1-g,l,1-g]),d=d.concat(N),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),H){const H=[];l=0,r=1-j/t,W=1,g=1,H[0]=[l,r,W,r,W,g,l,g],H[1]=[l,r,W,r,W,g,l,g],O!==q.d.ROTATE_TILE&&O!==q.d.ROTATE_ROW||(H[1]=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),O!==q.d.FLIP_TILE&&O!==q.d.FLIP_ROW||(H[1]=[1-l,r,1-W,r,1-W,g,1-l,g]),O!==q.d.FLIP_N_ROTATE_TILE&&O!==q.d.FLIP_N_ROTATE_ROW||(H[1]=[l,1-r,W,1-r,W,1-g,l,1-g]);for(let t=0;t<w;t++)F.push(t*S-e+E,K+y,0),F.push((t+1)*S-e+E,K+y,0),F.push((t+1)*S-e+E,K+j+y,0),F.push(t*S-e+E,K+j+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=O===q.d.FLIP_TILE||O===q.d.ROTATE_TILE||O===q.d.FLIP_N_ROTATE_TILE?d.concat(H[(t+1)%2]):O===q.d.FLIP_ROW||O===q.d.ROTATE_ROW||O===q.d.FLIP_N_ROTATE_ROW?d.concat(H[1]):d.concat(H[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const H=[];l=0,r=0,W=1,g=j/t,H[0]=[l,r,W,r,W,g,l,g],H[1]=[l,r,W,r,W,g,l,g],O!==q.d.ROTATE_TILE&&O!==q.d.ROTATE_ROW||(H[1]=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),O!==q.d.FLIP_TILE&&O!==q.d.FLIP_ROW||(H[1]=[1-l,r,1-W,r,1-W,g,1-l,g]),O!==q.d.FLIP_N_ROTATE_TILE&&O!==q.d.FLIP_N_ROTATE_ROW||(H[1]=[l,1-r,W,1-r,W,1-g,l,1-g]);for(let t=0;t<w;t++)F.push(t*S-e+E,D-j+y,0),F.push((t+1)*S-e+E,D-j+y,0),F.push((t+1)*S-e+E,D+y,0),F.push(t*S-e+E,D+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=O===q.d.FLIP_TILE||O===q.d.ROTATE_TILE||O===q.d.FLIP_N_ROTATE_TILE?d.concat(H[(t+a)%2]):O===q.d.FLIP_ROW||O===q.d.ROTATE_ROW||O===q.d.FLIP_N_ROTATE_ROW?d.concat(H[a%2]):d.concat(H[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(V){const H=[];l=1-o/S,r=0,W=1,g=1,H[0]=[l,r,W,r,W,g,l,g],H[1]=[l,r,W,r,W,g,l,g],O!==q.d.ROTATE_TILE&&O!==q.d.ROTATE_ROW||(H[1]=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),O!==q.d.FLIP_TILE&&O!==q.d.FLIP_ROW||(H[1]=[1-l,r,1-W,r,1-W,g,1-l,g]),O!==q.d.FLIP_N_ROTATE_TILE&&O!==q.d.FLIP_N_ROTATE_ROW||(H[1]=[l,1-r,W,1-r,W,1-g,l,1-g]);for(let S=0;S<a;S++)F.push(T+E,S*t-X+y,0),F.push(T+o+E,S*t-X+y,0),F.push(T+o+E,(S+1)*t-X+y,0),F.push(T+E,(S+1)*t-X+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=O===q.d.FLIP_TILE||O===q.d.ROTATE_TILE||O===q.d.FLIP_N_ROTATE_TILE?d.concat(H[(S+1)%2]):O===q.d.FLIP_ROW||O===q.d.ROTATE_ROW||O===q.d.FLIP_N_ROTATE_ROW?d.concat(H[S%2]):d.concat(H[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const H=[];l=0,r=0,W=o/t,g=1,H[0]=[l,r,W,r,W,g,l,g],H[1]=[l,r,W,r,W,g,l,g],O!==q.d.ROTATE_TILE&&O!==q.d.ROTATE_ROW||(H[1]=[1-l,1-r,1-W,1-r,1-W,1-g,1-l,1-g]),O!==q.d.FLIP_TILE&&O!==q.d.FLIP_ROW||(H[1]=[1-l,r,1-W,r,1-W,g,1-l,g]),O!==q.d.FLIP_N_ROTATE_TILE&&O!==q.d.FLIP_N_ROTATE_ROW||(H[1]=[l,1-r,W,1-r,W,1-g,l,1-g]);for(let S=0;S<a;S++)F.push(b-o+E,S*t-X+y,0),F.push(b+E,S*t-X+y,0),F.push(b+E,(S+1)*t-X+y,0),F.push(b-o+E,(S+1)*t-X+y,0),z.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=O===q.d.FLIP_TILE||O===q.d.ROTATE_TILE||O===q.d.FLIP_N_ROTATE_TILE?d.concat(H[(S+w)%2]):O===q.d.FLIP_ROW||O===q.d.ROTATE_ROW||O===q.d.FLIP_N_ROTATE_ROW?d.concat(H[S%2]):d.concat(H[0]),v.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const r=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE;G.c._ComputeSides(r,F,z,Y,d,H.frontUVs,H.backUVs);const W=new G.c;W.indices=z,W.dH=F,W.vH=Y,W.mH=d;const g=r===G.c.DOUBLESIDE?v.concat(v):v;return W.zH=g,W}function e(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return j(O).WH(t,O.updatable),t}function X(H){const O=H.faceUV||new Array(6),S=H.faceColors,p=H.pattern||q.d.NO_FLIP,V=H.width||H.size||1,w=H.height||H.size||1,o=H.depth||H.size||1,h=H.tileWidth||H.tileSize||1,e=H.tileHeight||H.tileSize||1,X=H.alignHorizontal||0,E=H.alignVertical||0,y=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE;for(let q=0;q<6;q++)void 0===O[q]&&(O[q]=new t.Vector4(0,0,1,1)),S&&void 0===S[q]&&(S[q]=new a.EU(1,1,1,1));const T=V/2,K=w/2,b=o/2,D=[];for(let t=0;t<2;t++)D[t]=j({pattern:p,tileWidth:h,tileHeight:e,width:V,height:w,alignVertical:E,alignHorizontal:X,sideOrientation:y});for(let t=2;t<4;t++)D[t]=j({pattern:p,tileWidth:h,tileHeight:e,width:o,height:w,alignVertical:E,alignHorizontal:X,sideOrientation:y});let F=E;E===q.d.BOTTOM?F=q.d.TOP:E===q.d.TOP&&(F=q.d.BOTTOM);for(let t=4;t<6;t++)D[t]=j({pattern:p,tileWidth:h,tileHeight:e,width:V,height:o,alignVertical:F,alignHorizontal:X,sideOrientation:y});let Y=[],l=[],d=[],v=[];const z=[],m=[],r=[],W=[];let g=0,N=0;for(let q=0;q<6;q++){const H=D[q].dH.length;m[q]=[],r[q]=[];for(let O=0;O<H/3;O++)m[q].push(new t.eO(D[q].dH[3*O],D[q].dH[3*O+1],D[q].dH[3*O+2])),r[q].push(new t.eO(D[q].vH[3*O],D[q].vH[3*O+1],D[q].vH[3*O+2]));g=D[q].mH.length,W[q]=[];for(let S=0;S<g;S+=2)W[q][S]=O[q].x+(O[q].z-O[q].x)*D[q].mH[S],W[q][S+1]=O[q].y+(O[q].w-O[q].y)*D[q].mH[S+1],U.d&&(W[q][S+1]=1-W[q][S+1]);if(d=d.concat(W[q]),v=v.concat(D[q].indices.map((H=>H+N))),N+=m[q].length,S)for(let O=0;O<4;O++)z.push(S[q].r,S[q].g,S[q].b,S[q].a)}const x=new t.eO(0,0,b),k=t.Matrix.RotationY(Math.PI);Y=m[0].map((H=>t.eO.TransformNormal(H,k).add(x))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]),l=r[0].map((H=>t.eO.TransformNormal(H,k))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]),Y=Y.concat(m[1].map((H=>H.XO(x))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),l=l.concat(r[1].map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]));const A=new t.eO(T,0,0),u=t.Matrix.RotationY(-Math.PI/2);Y=Y.concat(m[2].map((H=>t.eO.TransformNormal(H,u).add(A))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),l=l.concat(r[2].map((H=>t.eO.TransformNormal(H,u))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]));const J=t.Matrix.RotationY(Math.PI/2);Y=Y.concat(m[3].map((H=>t.eO.TransformNormal(H,J).XO(A))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),l=l.concat(r[3].map((H=>t.eO.TransformNormal(H,J))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]));const P=new t.eO(0,K,0),f=t.Matrix.RotationX(Math.PI/2);Y=Y.concat(m[4].map((H=>t.eO.TransformNormal(H,f).add(P))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),l=l.concat(r[4].map((H=>t.eO.TransformNormal(H,f))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[]));const c=t.Matrix.RotationX(-Math.PI/2);Y=Y.concat(m[5].map((H=>t.eO.TransformNormal(H,c).XO(P))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),l=l.concat(r[5].map((H=>t.eO.TransformNormal(H,c))).map((H=>[H.x,H.y,H.z])).reduce(((H,O)=>H.concat(O)),[])),G.c._ComputeSides(y,Y,v,l,d);const R=new G.c;if(R.indices=v,R.dH=Y,R.vH=l,R.mH=d,S){const H=y===G.c.DOUBLESIDE?z.concat(z):z;R.zH=H}return R}function E(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return X(O).WH(t,O.updatable),t}G.c.CreateTiledPlane=j;G.c.CreateTiledBox=X;var y=S(12708),T=S(11541),K=S(11515);function b(H){const O=H.height||2;let S=0===H.diameterTop?0:H.diameterTop||H.diameter||1,p=0===H.diameterBottom?0:H.diameterBottom||H.diameter||1;S=S||1e-5,p=p||1e-5;const V=0|(H.tessellation||24),w=0|(H.subdivisions||1),o=!!H.hasRings,h=!!H.enclose,j=0===H.cap?0:H.cap||q.d.CAP_ALL,e=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1,X=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,E=H.faceUV||new Array(3),y=H.faceColors,T=2+(1+(1!==e&&h?2:0))*(o?w:1);let b;for(b=0;b<T;b++)y&&void 0===y[b]&&(y[b]=new a.EU(1,1,1,1));for(b=0;b<T;b++)E&&void 0===E[b]&&(E[b]=new t.Vector4(0,0,1,1));const D=[],F=[],Y=[],l=[],d=[],v=2*Math.PI*e/V;let z,m,r;const W=(p-S)/2/O,g=t.eO.Zero(),N=t.eO.Zero(),x=t.eO.Zero(),k=t.eO.Zero(),A=t.eO.Zero(),u=K.d.Y;let J,P,f,c=1,R=1,B=0,Z=0;for(J=0;J<=w;J++)for(m=J/w,r=(m*(S-p)+p)/2,c=o&&0!==J&&J!==w?2:1,f=0;f<c;f++){for(o&&(R+=f),h&&(R+=2*f),P=0;P<=V;P++)z=P*v,g.x=Math.cos(-z)*r,g.y=-O/2+m*O,g.z=Math.sin(-z)*r,0===S&&J===w?(N.x=Y[Y.length-3*(V+1)],N.y=Y[Y.length-3*(V+1)+1],N.z=Y[Y.length-3*(V+1)+2]):(N.x=g.x,N.z=g.z,N.y=Math.sqrt(N.x*N.x+N.z*N.z)*W,N.normalize()),0===P&&(x.t(g),k.t(N)),F.push(g.x,g.y,g.z),Y.push(N.x,N.y,N.z),Z=o?B!==R?E[R].y:E[R].w:E[R].y+(E[R].w-E[R].y)*m,l.push(E[R].x+(E[R].z-E[R].x)*P/V,U.d?1-Z:Z),y&&d.push(y[R].r,y[R].g,y[R].b,y[R].a);1!==e&&h&&(F.push(g.x,g.y,g.z),F.push(0,g.y,0),F.push(0,g.y,0),F.push(x.x,x.y,x.z),t.eO.CrossToRef(u,N,A),A.normalize(),Y.push(A.x,A.y,A.z,A.x,A.y,A.z),t.eO.CrossToRef(k,u,A),A.normalize(),Y.push(A.x,A.y,A.z,A.x,A.y,A.z),Z=o?B!==R?E[R+1].y:E[R+1].w:E[R+1].y+(E[R+1].w-E[R+1].y)*m,l.push(E[R+1].x,U.d?1-Z:Z),l.push(E[R+1].z,U.d?1-Z:Z),Z=o?B!==R?E[R+2].y:E[R+2].w:E[R+2].y+(E[R+2].w-E[R+2].y)*m,l.push(E[R+2].x,U.d?1-Z:Z),l.push(E[R+2].z,U.d?1-Z:Z),y&&(d.push(y[R+1].r,y[R+1].g,y[R+1].b,y[R+1].a),d.push(y[R+1].r,y[R+1].g,y[R+1].b,y[R+1].a),d.push(y[R+2].r,y[R+2].g,y[R+2].b,y[R+2].a),d.push(y[R+2].r,y[R+2].g,y[R+2].b,y[R+2].a))),B!==R&&(B=R)}const I=1!==e&&h?V+4:V;for(J=0,R=0;R<w;R++){let H=0,O=0,S=0,t=0;for(P=0;P<V;P++)H=J*(I+1)+P,O=(J+1)*(I+1)+P,S=J*(I+1)+(P+1),t=(J+1)*(I+1)+(P+1),D.push(H,O,S),D.push(t,S,O);1!==e&&h&&(D.push(H+2,O+2,S+2),D.push(t+2,S+2,O+2),D.push(H+4,O+4,S+4),D.push(t+4,S+4,O+4)),J=o?J+2:J+1}const s=H=>{const q=H?S/2:p/2;if(0===q)return;let G,w,o;const h=H?E[T-1]:E[0];let a=null;y&&(a=H?y[T-1]:y[0]);const j=F.length/3,X=H?O/2:-O/2,K=new t.eO(0,X,0);F.push(K.x,K.y,K.z),Y.push(0,H?1:-1,0);const b=h.y+.5*(h.w-h.y);l.push(h.x+.5*(h.z-h.x),U.d?1-b:b),a&&d.push(a.r,a.g,a.b,a.a);const v=new t.Vector2(.5,.5);for(o=0;o<=V;o++){G=2*Math.PI*o*e/V;const O=Math.cos(-G),S=Math.sin(-G);w=new t.eO(O*q,X,S*q);const p=new t.Vector2(O*v.x+.5,S*v.y+.5);F.push(w.x,w.y,w.z),Y.push(0,H?1:-1,0);const j=h.y+(h.w-h.y)*p.y;l.push(h.x+(h.z-h.x)*p.x,U.d?1-j:j),a&&d.push(a.r,a.g,a.b,a.a)}for(o=0;o<V;o++)H?(D.push(j),D.push(j+(o+2)),D.push(j+(o+1))):(D.push(j),D.push(j+(o+1)),D.push(j+(o+2)))};j!==q.d.CAP_START&&j!==q.d.CAP_ALL||s(!1),j!==q.d.CAP_END&&j!==q.d.CAP_ALL||s(!0),G.c._ComputeSides(X,F,D,Y,l,H.frontUVs,H.backUVs);const i=new G.c;return i.indices=D,i.dH=F,i.vH=Y,i.mH=l,y&&(i.zH=d),i}function D(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return b(O).WH(t,O.updatable),t}function F(H){const O=[],S=[],q=[],p=[],V=H.diameter||1,w=H.thickness||.5,o=0|(H.tessellation||16),h=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,a=o+1;for(let G=0;G<=o;G++){const H=G/o,h=G*Math.PI*2/o-Math.PI/2,j=t.Matrix.Translation(V/2,0,0).multiply(t.Matrix.RotationY(h));for(let V=0;V<=o;V++){const h=1-V/o,e=V*Math.PI*2/o+Math.PI,X=Math.cos(e),E=Math.sin(e);let y=new t.eO(X,E,0),T=y.scale(w/2);const K=new t.Vector2(H,h);T=t.eO.TransformCoordinates(T,j),y=t.eO.TransformNormal(y,j),S.push(T.x,T.y,T.z),q.push(y.x,y.y,y.z),p.push(K.x,U.d?1-K.y:K.y);const b=(G+1)%a,D=(V+1)%a;O.push(G*a+V),O.push(G*a+D),O.push(b*a+V),O.push(G*a+D),O.push(b*a+D),O.push(b*a+V)}}G.c._ComputeSides(h,S,O,q,p,H.frontUVs,H.backUVs);const j=new G.c;return j.indices=O,j.dH=S,j.vH=q,j.mH=p,j}function Y(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return F(O).WH(t,O.updatable),t}G.c.CreateCylinder=b,q.d.CreateCylinder=(H,O,S,t,p,G,U,V,w)=>{void 0!==U&&U instanceof T.e||(void 0!==U&&(w=V||q.d.DEFAULTSIDE,V=U),U=G,G=1);return D(H,{height:O,diameterTop:S,diameterBottom:t,tessellation:p,subdivisions:G,sideOrientation:w,updatable:V},U)};function l(H){const O=[],S=[],q=[],p=[],V=H.radius||2,w=H.tube||.5,o=H.radialSegments||32,h=H.tubularSegments||32,a=H.p||2,j=H.q||3,e=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,X=H=>{const O=Math.cos(H),S=Math.sin(H),q=j/a*H,p=Math.cos(q),G=V*(2+p)*.5*O,U=V*(2+p)*S*.5,w=V*Math.sin(q)*.5;return new t.eO(G,U,w)};let E,y;for(E=0;E<=o;E++){const H=E%o/o*2*a*Math.PI,O=X(H),q=X(H+.01),G=q.XO(O);let V=q.add(O);const j=t.eO.Cross(G,V);for(V=t.eO.Cross(j,G),j.normalize(),V.normalize(),y=0;y<h;y++){const H=y%h/h*2*Math.PI,t=-w*Math.cos(H),q=w*Math.sin(H);S.push(O.x+t*V.x+q*j.x),S.push(O.y+t*V.y+q*j.y),S.push(O.z+t*V.z+q*j.z),p.push(E/o),p.push(U.d?1-y/h:y/h)}}for(E=0;E<o;E++)for(y=0;y<h;y++){const H=(y+1)%h,S=E*h+y,t=(E+1)*h+y,q=(E+1)*h+H,p=E*h+H;O.push(p),O.push(t),O.push(S),O.push(p),O.push(q),O.push(t)}G.c.ComputeNormals(S,O,q),G.c._ComputeSides(e,S,O,q,p,H.frontUVs,H.backUVs);const T=new G.c;return T.indices=O,T.dH=S,T.vH=q,T.mH=p,T}function d(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2?arguments[2]:void 0;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return l(O).WH(t,O.updatable),t}G.c.CreateTorus=F,q.d.CreateTorus=(H,O,S,t,q,p,G)=>Y(H,{diameter:O,thickness:S,tessellation:t,sideOrientation:G,updatable:p},q);G.c.CreateTorusKnot=l,q.d.CreateTorusKnot=(H,O,S,t,q,p,G,U,V,w)=>d(H,{radius:O,tube:S,radialSegments:t,tubularSegments:q,p:p,q:G,sideOrientation:w,updatable:V},U);var v=S(13206),z=S(11863),m=S(11524);function r(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=O.path,p=O.shape,G=O.scale||1,U=O.rotation||0,V=0===O.cap?0:O.cap||q.d.NO_CAP,w=O.updatable,o=q.d._GetDefaultSideOrientation(O.sideOrientation),h=O.instance||null,a=O.invertUV||!1,j=O.closeShape||!1,e=O.closePath||!1,X=O.capFunction||null;return g(H,p,t,G,U,null,null,e,j,V,!1,S,!!w,o,h,a,O.frontUVs||null,O.backUVs||null,O.firstNormal||null,!!O.adjustFrame,X)}function W(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=O.path,p=O.shape,G=O.scaleFunction||(()=>1),U=O.rotationFunction||(()=>0),V=O.closePath||O.ribbonCloseArray||!1,w=O.closeShape||O.ribbonClosePath||!1,o=0===O.cap?0:O.cap||q.d.NO_CAP,h=O.updatable,a=O.firstNormal||null,j=O.adjustFrame||!1,e=q.d._GetDefaultSideOrientation(O.sideOrientation),X=O.instance,E=O.invertUV||!1,y=O.capFunction||null;return g(H,p,t,null,null,G,U,V,w,o,!0,S,!!h,e,X||null,E,O.frontUVs||null,O.backUVs||null,a,j,y||null)}function g(H,O,S,p,G,U,V,o,h,a,j,e,X,E,y,T,K,b,D,F,Y){const l=(H,O,S,p,G,U,V,w,o,h,a)=>{const j=S.getTangents(),e=S.getNormals(),X=S.getBinormals(),E=S.getDistances();if(a)for(let q=0;q<j.length;q++)if(0==j[q].x&&0==j[q].y&&0==j[q].z&&j[q].t(j[q-1]),0==e[q].x&&0==e[q].y&&0==e[q].z&&e[q].t(e[q-1]),0==X[q].x&&0==X[q].y&&0==X[q].z&&X[q].t(X[q-1]),q>0){let H=j[q-1];t.eO.Dot(H,j[q])<0&&j[q].scaleInPlace(-1),H=e[q-1],t.eO.Dot(H,e[q])<0&&e[q].scaleInPlace(-1),H=X[q-1],t.eO.Dot(H,X[q])<0&&X[q].scaleInPlace(-1)}let y=0;const T=h&&w?w:()=>null!==U?U:0,K=h&&V?V:()=>null!==G?G:1;let b=o===q.d.NO_CAP||o===q.d.CAP_END?0:2;const D=t.TmpVectors.Matrix[0];for(let q=0;q<O.length;q++){const S=[],G=T(q,E[q]),U=K(q,E[q]);t.Matrix.RotationAxisToRef(j[q],y,D);for(let p=0;p<H.length;p++){const G=j[q].scale(H[p].z).add(e[q].scale(H[p].x)).add(X[q].scale(H[p].y)),V=t.eO.Zero();t.eO.TransformCoordinatesToRef(G,D,V),V.scaleInPlace(U).addInPlace(O[q]),S[p]=V}p[b]=S,y+=G,b++}const F=Y||(H=>{const O=Array(),S=t.eO.Zero();let q;for(q=0;q<H.length;q++)S.addInPlace(H[q]);for(S.scaleInPlace(1/H.length),q=0;q<H.length;q++)O.push(S);return O});switch(o){case q.d.NO_CAP:break;case q.d.CAP_START:p[0]=F(p[2]),p[1]=p[2];break;case q.d.CAP_END:p[b]=p[b-1],p[b+1]=F(p[b-1]);break;case q.d.CAP_ALL:p[0]=F(p[2]),p[1]=p[2],p[b]=p[b-1],p[b+1]=F(p[b-1])}return p};let d,v;if(y){const H=y._creationDataStorage;return d=D?H.path3D.update(S,D):H.path3D.update(S),v=l(O,S,H.path3D,H.pathArray,p,G,U,V,H.cap,j,F),y=w("",{pathArray:v,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:y},e||void 0)}d=D?new m.j(S,D):new m.j(S);v=l(O,S,d,new Array,p,G,U,V,a=a<0||a>3?0:a,j,F);const z=w(H,{pathArray:v,closeArray:o,closePath:h,updatable:X,sideOrientation:E,invertUV:T,frontUVs:K||void 0,backUVs:b||void 0},e);return z._creationDataStorage.pathArray=v,z._creationDataStorage.path3D=d,z._creationDataStorage.cap=a,z}function N(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=O.arc?O.arc<=0||O.arc>1?1:O.arc:1,G=void 0===O.closed||O.closed,U=O.shape,V=O.radius||1,o=O.tessellation||64,h=O.clip||0,a=O.updatable,j=q.d._GetDefaultSideOrientation(O.sideOrientation),e=O.cap||q.d.NO_CAP,X=2*Math.PI,E=[],y=O.invertUV||!1;let T=0,K=0;const b=X/o*p;let D,F;for(T=0;T<=o-h;T++){for(F=[],e!=q.d.CAP_START&&e!=q.d.CAP_ALL||(F.push(new t.eO(0,U[0].y,0)),F.push(new t.eO(Math.cos(T*b)*U[0].x*V,U[0].y,Math.sin(T*b)*U[0].x*V))),K=0;K<U.length;K++)D=new t.eO(Math.cos(T*b)*U[K].x*V,U[K].y,Math.sin(T*b)*U[K].x*V),F.push(D);e!=q.d.CAP_END&&e!=q.d.CAP_ALL||(F.push(new t.eO(Math.cos(T*b)*U[U.length-1].x*V,U[U.length-1].y,Math.sin(T*b)*U[U.length-1].x*V)),F.push(new t.eO(0,U[U.length-1].y,0))),E.push(F)}return w(H,{pathArray:E,closeArray:G,sideOrientation:j,updatable:a,invertUV:y,frontUVs:O.frontUVs,backUVs:O.backUVs},S)}q.d.ExtrudeShape=function(H,O,S,t,p,G){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0,o=arguments.length>9?arguments[9]:void 0;return r(H,{shape:O,path:S,scale:t,rotation:p,cap:0===G?0:G||q.d.NO_CAP,sideOrientation:w,instance:o,updatable:V},U)},q.d.ExtrudeShapeCustom=(H,O,S,t,p,G,U,V,w,o,h,a)=>W(H,{shape:O,path:S,scaleFunction:t,rotationFunction:p,ribbonCloseArray:G,ribbonClosePath:U,cap:0===V?0:V||q.d.NO_CAP,sideOrientation:h,instance:a,updatable:o},w);q.d.CreateLathe=(H,O,S,t,q,p,G)=>N(H,{shape:O,radius:S,tessellation:t,sideOrientation:G,updatable:p},q);var x=S(12606),k=S(12556);function A(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=O.path;let G=O.instance,U=1;void 0!==O.radius?U=O.radius:G&&(U=G._creationDataStorage.radius);const V=O.tessellation||64,o=O.radiusFunction||null;let h=O.cap||q.d.NO_CAP;const a=O.invertUV||!1,j=O.updatable,e=q.d._GetDefaultSideOrientation(O.sideOrientation);O.arc=O.arc&&(O.arc<=0||O.arc>1)?1:O.arc||1;const X=(H,O,S,p,G,U,V,w)=>{const o=O.getTangents(),h=O.getNormals(),a=O.getDistances(),j=2*Math.PI/G*w,e=U||(()=>p);let X,E,y,T;const K=t.TmpVectors.Matrix[0];let b=V===q.d.NO_CAP||V===q.d.CAP_END?0:2;for(let q=0;q<H.length;q++){E=e(q,a[q]),X=Array(),y=h[q];for(let O=0;O<G;O++)t.Matrix.RotationAxisToRef(o[q],j*O,K),T=X[O]?X[O]:t.eO.Zero(),t.eO.TransformCoordinatesToRef(y,K,T),T.scaleInPlace(E).addInPlace(H[q]),X[O]=T;S[b]=X,b++}const D=(O,S)=>{const t=Array();for(let q=0;q<O;q++)t.push(H[S]);return t};switch(V){case q.d.NO_CAP:break;case q.d.CAP_START:S[0]=D(G,0),S[1]=S[2].slice(0);break;case q.d.CAP_END:S[b]=S[b-1].slice(0),S[b+1]=D(G,H.length-1);break;case q.d.CAP_ALL:S[0]=D(G,0),S[1]=S[2].slice(0),S[b]=S[b-1].slice(0),S[b+1]=D(G,H.length-1)}return S};let E,y;if(G){const H=G._creationDataStorage,S=O.arc||H.arc;return E=H.path3D.update(p),y=X(p,E,H.pathArray,U,H.tessellation,o,H.cap,S),G=w("",{pathArray:y,instance:G}),H.path3D=E,H.pathArray=y,H.arc=S,H.radius=U,G}E=new m.j(p);h=h<0||h>3?0:h,y=X(p,E,new Array,U,V,o,h,O.arc);const T=w(H,{pathArray:y,closePath:!0,closeArray:!1,updatable:j,sideOrientation:e,invertUV:a,frontUVs:O.frontUVs,backUVs:O.backUVs},S);return T._creationDataStorage.pathArray=y,T._creationDataStorage.path3D=E,T._creationDataStorage.tessellation=V,T._creationDataStorage.cap=h,T._creationDataStorage.arc=O.arc,T._creationDataStorage.radius=U,T}function u(H){const O=[];O[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},O[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},O[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},O[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},O[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},O[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},O[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},O[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},O[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},O[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},O[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},O[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},O[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},O[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},O[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const S=H.type&&(H.type<0||H.type>=O.length)?0:H.type||0,q=H.size,p=H.sizeX||q||1,V=H.sizeY||q||1,w=H.sizeZ||q||1,o=H.custom||O[S],h=o.face.length,j=H.faceUV||new Array(h),e=H.faceColors,X=void 0===H.flat||H.flat,E=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,y=[],T=[],K=[],b=[],D=[];let F=0,Y=0;const l=[];let d,v,z,m,r,W,g=0,N=0;if(X)for(N=0;N<h;N++)e&&void 0===e[N]&&(e[N]=new a.EU(1,1,1,1)),j&&void 0===j[N]&&(j[N]=new t.Vector4(0,0,1,1));if(X)for(N=0;N<h;N++){const H=o.face[N].length;for(z=2*Math.PI/H,m=.5*Math.tan(z/2),r=.5,g=0;g<H;g++)y.push(o.vertex[o.face[N][g]][0]*p,o.vertex[o.face[N][g]][1]*V,o.vertex[o.face[N][g]][2]*w),l.push(F),F++,d=j[N].x+(j[N].z-j[N].x)*(.5+m),v=j[N].y+(j[N].w-j[N].y)*(r-.5),b.push(d,U.d?1-v:v),W=m*Math.cos(z)-r*Math.sin(z),r=m*Math.sin(z)+r*Math.cos(z),m=W,e&&D.push(e[N].r,e[N].g,e[N].b,e[N].a);for(g=0;g<H-2;g++)T.push(l[0+Y],l[g+2+Y],l[g+1+Y]);Y+=H}else{for(g=0;g<o.vertex.length;g++)y.push(o.vertex[g][0]*p,o.vertex[g][1]*V,o.vertex[g][2]*w),b.push(0,U.d?1:0);for(N=0;N<h;N++)for(g=0;g<o.face[N].length-2;g++)T.push(o.face[N][0],o.face[N][g+2],o.face[N][g+1])}G.c.ComputeNormals(y,T,K),G.c._ComputeSides(E,y,T,K,b,H.frontUVs,H.backUVs);const x=new G.c;return x.dH=y,x.indices=T,x.vH=K,x.mH=b,e&&X&&(x.zH=D),x}function J(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return u(O).WH(t,O.updatable),t}q.d.CreateTube=(H,O,S,t,q,p,G,U,V,w)=>A(H,{path:O,radius:S,tessellation:t,radiusFunction:q,arc:1,cap:p,updatable:U,sideOrientation:V,instance:w},G);function P(H){const O=H.sideOrientation||G.c.DEFAULTSIDE,S=H.radius||1,q=void 0===H.flat||H.flat,p=0|(H.subdivisions||4),V=H.radiusX||S,w=H.radiusY||S,o=H.radiusZ||S,h=(1+Math.sqrt(5))/2,a=[-1,h,-0,1,h,0,-1,-h,0,1,-h,0,0,-1,-h,0,1,-h,0,-1,h,0,1,h,h,0,1,h,0,-1,-h,0,1,-h,0,-1],j=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],e=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],X=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],E=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=[],T=[],K=[],b=[];let D=0;const F=new Array(3),Y=new Array(3);let l;for(l=0;l<3;l++)F[l]=t.eO.Zero(),Y[l]=t.Vector2.Zero();for(let G=0;G<20;G++){for(l=0;l<3;l++){const H=j[3*G+l];F[l].jU(a[3*e[H]],a[3*e[H]+1],a[3*e[H]+2]),F[l].normalize(),Y[l].jU(.134765625*X[2*H]+.05859375+-.0390625*E[G],.2333984375*X[2*H+1]+.025390625+.01953125*E[G])}const H=(H,O,S,G)=>{const h=t.eO.Lerp(F[0],F[2],O/p),a=t.eO.Lerp(F[1],F[2],O/p),j=p===O?F[2]:t.eO.Lerp(h,a,H/(p-O));let e;if(j.normalize(),q){const H=t.eO.Lerp(F[0],F[2],G/p),O=t.eO.Lerp(F[1],F[2],G/p);e=t.eO.Lerp(H,O,S/(p-G))}else e=new t.eO(j.x,j.y,j.z);e.x/=V,e.y/=w,e.z/=o,e.normalize();const X=t.Vector2.Lerp(Y[0],Y[2],O/p),E=t.Vector2.Lerp(Y[1],Y[2],O/p),l=p===O?Y[2]:t.Vector2.Lerp(X,E,H/(p-O));T.push(j.x*V,j.y*w,j.z*o),K.push(e.x,e.y,e.z),b.push(l.x,U.d?1-l.y:l.y),y.push(D),D++};for(let O=0;O<p;O++)for(let S=0;S+O<p;S++)H(S,O,S+1/3,O+1/3),H(S+1,O,S+1/3,O+1/3),H(S,O+1,S+1/3,O+1/3),S+O+1<p&&(H(S+1,O,S+2/3,O+2/3),H(S+1,O+1,S+2/3,O+2/3),H(S,O+1,S+2/3,O+2/3))}G.c._ComputeSides(O,T,y,K,b,H.frontUVs,H.backUVs);const d=new G.c;return d.indices=y,d.dH=T,d.vH=K,d.mH=b,d}function f(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new q.d(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),t._originalBuilderSideOrientation=O.sideOrientation;return P(O).WH(t,O.updatable),t}G.c.CreatePolyhedron=u,q.d.CreatePolyhedron=(H,O,S)=>J(H,O,S);G.c.CreateIcoSphere=P,q.d.CreateIcoSphere=(H,O,S)=>f(H,O,S);var c=S(11317);const R=new t.eO(1,0,0),B=new t.eO(-1,0,0),Z=new t.eO(0,1,0),I=new t.eO(0,-1,0),s=new t.eO(0,0,1),i=new t.eO(0,0,-1);class M{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.eO.Zero(),O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.eO.Up(),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.Vector2.Zero(),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=H,this.normal=O,this.uv=S,this.vertexIdx=q,this.vertexIdxForBones=p,this.localPositionOverride=G,this.localNormalOverride=U,this.matrixIndicesOverride=V,this.matrixWeightsOverride=w}clone(){var H,O,S,t;return new M(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(H=this.localPositionOverride)||void 0===H?void 0:H.slice(),null===(O=this.localNormalOverride)||void 0===O?void 0:O.slice(),null===(S=this.matrixIndicesOverride)||void 0===S?void 0:S.slice(),null===(t=this.matrixWeightsOverride)||void 0===t?void 0:t.slice())}}function C(H,O,S){var V,w,o,h,a;const j=!!O.skeleton,e=!(null===(V=O.morphTargetManager)||void 0===V||!V.numTargets),X=S.localMode||j,E=O.hU(),y=j||e?O.mU(!0,!0):O.getVerticesData(p.h.PositionKind),T=j||e?O.getNormalsData(!0,!0):O.getVerticesData(p.h.NormalKind),K=X?j?O.getVerticesData(p.h.PositionKind):y:null,b=X?j?O.getVerticesData(p.h.NormalKind):T:null,D=O.getVerticesData(p.h.UVKind),F=j?O.getVerticesData(p.h.MatricesIndicesKind):null,Y=j?O.getVerticesData(p.h.MatricesWeightsKind):null,l=j?O.getVerticesData(p.h.MatricesIndicesExtraKind):null,d=j?O.getVerticesData(p.h.MatricesWeightsExtraKind):null,v=S.position||t.eO.Zero();let z=S.normal||t.eO.Up();const m=S.size||t.eO.One(),r=S.angle||0;if(!z){const H=new t.eO(0,0,1),S=O.YH().activeCamera,q=t.eO.TransformCoordinates(H,S.getWorldMatrix());z=S.globalPosition.XO(q)}const W=-Math.atan2(z.z,z.x)-Math.PI/2,g=Math.sqrt(z.x*z.x+z.z*z.z),N=Math.atan2(z.y,g),x=new G.c;x.indices=[],x.dH=[],x.vH=[],x.mH=[],x.matricesIndices=j?[]:null,x.matricesWeights=j?[]:null,x.matricesIndicesExtra=l?[]:null,x.matricesWeightsExtra=d?[]:null;let k=0;const A=(H,O)=>{const q=new M;if(!E||!y||!T)return q;const p=E[H];if(q.vertexIdx=3*p,q.vertexIdxForBones=4*p,q.position=new t.eO(y[3*p],y[3*p+1],y[3*p+2]),t.eO.TransformCoordinatesToRef(q.position,O,q.position),q.normal=new t.eO(T[3*p],T[3*p+1],T[3*p+2]),t.eO.TransformNormalToRef(q.normal,O,q.normal),S.captureUVS&&D){const H=D[2*p+1];q.uv=new t.Vector2(D[2*p],U.d?1-H:H)}return q},u=[0,0,0,0],J=(H,O)=>{if(0===H.length)return H;const S=.5*Math.abs(t.eO.Dot(m,O)),q=(H,O,S,t)=>{for(let q=0;q<t;++q)if(H[S+q]===O)return S+q;return-1},p=(H,p)=>{const G=t.eO.GetClipFactor(H.position,p.position,O,S);let U=u,V=u;if(F&&Y){const O=H.matrixIndicesOverride?0:H.vertexIdxForBones,S=H.matrixIndicesOverride??F,t=H.matrixWeightsOverride??Y,w=p.matrixIndicesOverride?0:p.vertexIdxForBones,o=p.matrixIndicesOverride??F,h=p.matrixWeightsOverride??Y;U=[0,0,0,0],V=[0,0,0,0];let a=0;for(let H=0;H<4;++H)if(t[O+H]>0){const p=q(o,S[O+H],w,4);U[a]=S[O+H],V[a]=(0,c.Lerp)(t[O+H],p>=0?h[p]:0,G),a++}for(let H=0;H<4&&a<4;++H){const t=o[w+H];-1===q(S,t,O,4)&&(U[a]=t,V[a]=(0,c.Lerp)(0,h[w+H],G),a++)}const j=V[0]+V[1]+V[2]+V[3];V[0]/=j,V[1]/=j,V[2]/=j,V[3]/=j}const w=H.localPositionOverride?H.localPositionOverride[0]:(null===K||void 0===K?void 0:K[H.vertexIdx])??0,o=H.localPositionOverride?H.localPositionOverride[1]:(null===K||void 0===K?void 0:K[H.vertexIdx+1])??0,h=H.localPositionOverride?H.localPositionOverride[2]:(null===K||void 0===K?void 0:K[H.vertexIdx+2])??0,a=p.localPositionOverride?p.localPositionOverride[0]:(null===K||void 0===K?void 0:K[p.vertexIdx])??0,j=p.localPositionOverride?p.localPositionOverride[1]:(null===K||void 0===K?void 0:K[p.vertexIdx+1])??0,e=p.localPositionOverride?p.localPositionOverride[2]:(null===K||void 0===K?void 0:K[p.vertexIdx+2])??0,X=H.localNormalOverride?H.localNormalOverride[0]:(null===b||void 0===b?void 0:b[H.vertexIdx])??0,E=H.localNormalOverride?H.localNormalOverride[1]:(null===b||void 0===b?void 0:b[H.vertexIdx+1])??0,y=H.localNormalOverride?H.localNormalOverride[2]:(null===b||void 0===b?void 0:b[H.vertexIdx+2])??0,T=X+((p.localNormalOverride?p.localNormalOverride[0]:(null===b||void 0===b?void 0:b[p.vertexIdx])??0)-X)*G,D=E+((p.localNormalOverride?p.localNormalOverride[1]:(null===b||void 0===b?void 0:b[p.vertexIdx+1])??0)-E)*G,l=y+((p.localNormalOverride?p.localNormalOverride[2]:(null===b||void 0===b?void 0:b[p.vertexIdx+2])??0)-y)*G,d=Math.sqrt(T*T+D*D+l*l);return new M(t.eO.Lerp(H.position,p.position,G),t.eO.Lerp(H.normal,p.normal,G).normalize(),t.Vector2.Lerp(H.uv,p.uv,G),-1,-1,K?[w+(a-w)*G,o+(j-o)*G,h+(e-h)*G]:null,b?[T/d,D/d,l/d]:null,U,V)};let G=null;H.length>3&&(G=[]);for(let U=0;U<H.length;U+=3){let q=0,V=null,w=null,o=null,h=null;const a=t.eO.Dot(H[U].position,O)-S>0,j=t.eO.Dot(H[U+1].position,O)-S>0,e=t.eO.Dot(H[U+2].position,O)-S>0;switch(q=(a?1:0)+(j?1:0)+(e?1:0),q){case 0:H.length>3?(G.push(H[U]),G.push(H[U+1]),G.push(H[U+2])):G=H;break;case 1:if(G=G??new Array,a&&(V=H[U+1],w=H[U+2],o=p(H[U],V),h=p(H[U],w)),j){V=H[U],w=H[U+2],o=p(H[U+1],V),h=p(H[U+1],w),G.push(o),G.push(w.clone()),G.push(V.clone()),G.push(w.clone()),G.push(o.clone()),G.push(h);break}e&&(V=H[U],w=H[U+1],o=p(H[U+2],V),h=p(H[U+2],w)),V&&w&&o&&h&&(G.push(V.clone()),G.push(w.clone()),G.push(o),G.push(h),G.push(o.clone()),G.push(w.clone()));break;case 2:G=G??new Array,a||(V=H[U].clone(),w=p(V,H[U+1]),o=p(V,H[U+2]),G.push(V),G.push(w),G.push(o)),j||(V=H[U+1].clone(),w=p(V,H[U+2]),o=p(V,H[U]),G.push(V),G.push(w),G.push(o)),e||(V=H[U+2].clone(),w=p(V,H[U]),o=p(V,H[U+1]),G.push(V),G.push(w),G.push(o))}}return G},P=O instanceof q.d?O:null,f=null===P||void 0===P?void 0:P._thinInstanceDataStorage.matrixData,C=(null===P||void 0===P?void 0:P.TU)||1,n=t.TmpVectors.Matrix[0];n.t(t.Matrix.IdentityReadOnly);for(let q=0;q<C;++q){if(null!==P&&void 0!==P&&P.hasThinInstances&&f){const H=16*q;n.setRowFromFloats(0,f[H+0],f[H+1],f[H+2],f[H+3]),n.setRowFromFloats(1,f[H+4],f[H+5],f[H+6],f[H+7]),n.setRowFromFloats(2,f[H+8],f[H+9],f[H+10],f[H+11]),n.setRowFromFloats(3,f[H+12],f[H+13],f[H+14],f[H+15])}const H=t.Matrix.RotationYawPitchRoll(W,N,r).multiply(t.Matrix.Translation(v.x,v.y,v.z)),p=t.Matrix.Invert(H),G=O.getWorldMatrix(),V=n.multiply(G).multiply(p),w=new Array(3);for(let O=0;O<E.length;O+=3){let H=w;if(H[0]=A(O,V),H[1]=A(O+1,V),H[2]=A(O+2,V),!(S.cullBackFaces&&-H[0].normal.z<=0&&-H[1].normal.z<=0&&-H[2].normal.z<=0)&&(H=J(H,R),H&&(H=J(H,B),H&&(H=J(H,Z),H&&(H=J(H,I),H&&(H=J(H,s),H&&(H=J(H,i),H)))))))for(let O=0;O<H.length;O++){const t=H[O];if(x.indices.push(k),X?(t.localPositionOverride?(x.dH[3*k]=t.localPositionOverride[0],x.dH[3*k+1]=t.localPositionOverride[1],x.dH[3*k+2]=t.localPositionOverride[2]):K&&(x.dH[3*k]=K[t.vertexIdx],x.dH[3*k+1]=K[t.vertexIdx+1],x.dH[3*k+2]=K[t.vertexIdx+2]),t.localNormalOverride?(x.vH[3*k]=t.localNormalOverride[0],x.vH[3*k+1]=t.localNormalOverride[1],x.vH[3*k+2]=t.localNormalOverride[2]):b&&(x.vH[3*k]=b[t.vertexIdx],x.vH[3*k+1]=b[t.vertexIdx+1],x.vH[3*k+2]=b[t.vertexIdx+2])):(t.position.toArray(x.dH,3*k),t.normal.toArray(x.vH,3*k)),x.matricesIndices&&x.matricesWeights&&(t.matrixIndicesOverride?(x.matricesIndices[4*k]=t.matrixIndicesOverride[0],x.matricesIndices[4*k+1]=t.matrixIndicesOverride[1],x.matricesIndices[4*k+2]=t.matrixIndicesOverride[2],x.matricesIndices[4*k+3]=t.matrixIndicesOverride[3]):(F&&(x.matricesIndices[4*k]=F[t.vertexIdxForBones],x.matricesIndices[4*k+1]=F[t.vertexIdxForBones+1],x.matricesIndices[4*k+2]=F[t.vertexIdxForBones+2],x.matricesIndices[4*k+3]=F[t.vertexIdxForBones+3]),l&&x.matricesIndicesExtra&&(x.matricesIndicesExtra[4*k]=l[t.vertexIdxForBones],x.matricesIndicesExtra[4*k+1]=l[t.vertexIdxForBones+1],x.matricesIndicesExtra[4*k+2]=l[t.vertexIdxForBones+2],x.matricesIndicesExtra[4*k+3]=l[t.vertexIdxForBones+3])),t.matrixWeightsOverride?(x.matricesWeights[4*k]=t.matrixWeightsOverride[0],x.matricesWeights[4*k+1]=t.matrixWeightsOverride[1],x.matricesWeights[4*k+2]=t.matrixWeightsOverride[2],x.matricesWeights[4*k+3]=t.matrixWeightsOverride[3]):(Y&&(x.matricesWeights[4*k]=Y[t.vertexIdxForBones],x.matricesWeights[4*k+1]=Y[t.vertexIdxForBones+1],x.matricesWeights[4*k+2]=Y[t.vertexIdxForBones+2],x.matricesWeights[4*k+3]=Y[t.vertexIdxForBones+3]),d&&x.matricesWeightsExtra&&(x.matricesWeightsExtra[4*k]=d[t.vertexIdxForBones],x.matricesWeightsExtra[4*k+1]=d[t.vertexIdxForBones+1],x.matricesWeightsExtra[4*k+2]=d[t.vertexIdxForBones+2],x.matricesWeightsExtra[4*k+3]=d[t.vertexIdxForBones+3]))),S.captureUVS)t.uv.toArray(x.mH,2*k);else{x.mH.push(.5+t.position.x/m.x);const H=.5+t.position.y/m.y;x.mH.push(U.d?1-H:H)}k++}}}0===x.indices.length&&(x.indices=null),0===x.dH.length&&(x.dH=null),0===x.vH.length&&(x.vH=null),0===x.mH.length&&(x.mH=null),0===(null===(w=x.matricesIndices)||void 0===w?void 0:w.length)&&(x.matricesIndices=null),0===(null===(o=x.matricesWeights)||void 0===o?void 0:o.length)&&(x.matricesWeights=null),0===(null===(h=x.matricesIndicesExtra)||void 0===h?void 0:h.length)&&(x.matricesIndicesExtra=null),0===(null===(a=x.matricesWeightsExtra)||void 0===a?void 0:a.length)&&(x.matricesWeightsExtra=null);const Q=new q.d(H,O.YH());return x.WH(Q),X?(Q.skeleton=O.skeleton,Q.parent=O):(Q.position=v.clone(),Q.rotation=new t.eO(N,W,r)),Q.wU(!0),Q.refreshBoundingInfo(!0,!0),Q}function n(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const O=0|Math.max(H.subdivisions?H.subdivisions:2,1),S=0|Math.max(H.tessellation?H.tessellation:16,3),q=Math.max(H.height?H.height:1,0),p=Math.max(H.radius?H.radius:.25,0),V=0|Math.max(H.capSubdivisions?H.capSubdivisions:6,1),w=S,o=O,h=Math.max(H.radiusTop?H.radiusTop:p,0),a=Math.max(H.radiusBottom?H.radiusBottom:p,0),j=q-(h+a),e=2*Math.PI,X=Math.max(H.topCapSubdivisions?H.topCapSubdivisions:V,1),E=Math.max(H.bottomCapSubdivisions?H.bottomCapSubdivisions:V,1),y=Math.acos((a-h)/q);let T=[];const K=[],b=[],D=[];let F=0;const Y=[],l=.5*j,d=.5*Math.PI;let v,z;const m=t.eO.Zero(),r=t.eO.Zero(),W=Math.cos(y),g=Math.sin(y),N=new t.Vector2(h*g,l+h*W).XO(new t.Vector2(a*g,a*W-l)).length(),x=h*y+N+a*(d-y);let k=0;for(z=0;z<=X;z++){const H=[],O=d-y*(z/X);k+=h*y/X;const S=Math.cos(O),t=Math.sin(O),q=S*h;for(v=0;v<=w;v++){const O=v/w,p=O*e+0,G=Math.sin(p),V=Math.cos(p);r.x=q*G,r.y=l+t*h,r.z=q*V,K.push(r.x,r.y,r.z),m.set(S*G,t,S*V),b.push(m.x,m.y,m.z),D.push(O,U.d?k/x:1-k/x),H.push(F),F++}Y.push(H)}const A=q-h-a+W*h-W*a,u=g*(a-h)/A;for(z=1;z<=o;z++){const H=[];k+=N/o;const O=g*(z*(a-h)/o+h);for(v=0;v<=w;v++){const S=v/w,t=S*e+0,q=Math.sin(t),p=Math.cos(t);r.x=O*q,r.y=l+W*h-z*A/o,r.z=O*p,K.push(r.x,r.y,r.z),m.set(q,u,p).normalize(),b.push(m.x,m.y,m.z),D.push(S,U.d?k/x:1-k/x),H.push(F),F++}Y.push(H)}for(z=1;z<=E;z++){const H=[],O=d-y-(Math.PI-y)*(z/E);k+=a*y/E;const S=Math.cos(O),t=Math.sin(O),q=S*a;for(v=0;v<=w;v++){const O=v/w,p=O*e+0,G=Math.sin(p),V=Math.cos(p);r.x=q*G,r.y=t*a-l,r.z=q*V,K.push(r.x,r.y,r.z),m.set(S*G,t,S*V),b.push(m.x,m.y,m.z),D.push(O,U.d?k/x:1-k/x),H.push(F),F++}Y.push(H)}for(v=0;v<w;v++)for(z=0;z<X+o+E;z++){const H=Y[z][v],O=Y[z+1][v],S=Y[z+1][v+1],t=Y[z][v+1];T.push(H),T.push(O),T.push(t),T.push(O),T.push(S),T.push(t)}if(T=T.reverse(),H.orientation&&!H.orientation.equals(t.eO.Up())){const O=new t.Matrix;H.orientation.clone().scale(.5*Math.PI).cross(t.eO.Up()).toQuaternion().toRotationMatrix(O);const S=t.eO.Zero();for(let H=0;H<K.length;H+=3)S.set(K[H],K[H+1],K[H+2]),t.eO.TransformCoordinatesToRef(S.clone(),O,S),K[H]=S.x,K[H+1]=S.y,K[H+2]=S.z}const J=new G.c;return J.dH=K,J.vH=b,J.mH=D,J.indices=T,J}function Q(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:t.eO.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new q.d(H,S);return n(O).WH(p,O.updatable),p}q.d.CreateDecal=(H,O,S,t,q,p)=>C(H,O,{position:S,normal:t,size:q,angle:p});q.d.CreateCapsule=(H,O,S)=>Q(H,O,S),G.c.CreateCapsule=n;var L=S(11151),HH=S(11307);class OH{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=H,this.y=O,H!==Math.floor(H)&&(H=Math.floor(H),L.b.Warn("x is not an integer, floor(x) used")),O!==Math.floor(O)&&(O=Math.floor(O),L.b.Warn("y is not an integer, floor(y) used"))}clone(){return new OH(this.x,this.y)}rotate60About(H){const O=this.x;return this.x=H.x+H.y-this.y,this.y=O+this.y-H.x,this}rotateNeg60About(H){const O=this.x;return this.x=O+this.y-H.y,this.y=H.x+H.y-O,this}rotate120(H,O){H!==Math.floor(H)&&(H=Math.floor(H),L.b.Warn("m not an integer only floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),L.b.Warn("n not an integer only floor(n) used"));const S=this.x;return this.x=H-S-this.y,this.y=O+S,this}rotateNeg120(H,O){H!==Math.floor(H)&&(H=Math.floor(H),L.b.Warn("m is not an integer, floor(m) used")),O!==Math.floor(O)&&(O=Math.floor(O),L.b.Warn("n is not an integer,   floor(n) used"));const S=this.x;return this.x=this.y-O,this.y=H+O-S-this.y,this}toCartesianOrigin(H,O){const S=t.eO.Zero();return S.x=H.x+2*this.x*O+this.y*O,S.y=H.y+Math.sqrt(3)*this.y*O,S}static Zero(){return new OH(0,0)}}class SH{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new tH("icosahedron","Regular",[[0,HH.g,-1],[-HH.g,1,0],[-1,0,-HH.g],[1,0,-HH.g],[HH.g,1,0],[0,HH.g,1],[-1,0,HH.g],[-HH.g,-1,0],[0,-HH.g,-1],[HH.g,-1,0],[1,0,HH.g],[0,-HH.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let H=12;const O={},S=this.m,t=this.n;let q,p,G,U,V,w=S,o=1,h=0;0!==t&&(w=(0,c.HighestCommonFactor)(S,t)),o=S/w,h=t/w;const a=OH.Zero(),j=new OH(S,t),e=new OH(-t,S+t),X=OH.Zero(),E=OH.Zero(),y=OH.Zero();let T,K,b,D,F=[];const Y=[],l=this.vertByDist,d=(S,t,q,p)=>{T=S+"|"+q,K=t+"|"+p,T in O||K in O?T in O&&!(K in O)?O[K]=O[T]:K in O&&!(T in O)&&(O[T]=O[K]):(O[T]=H,O[K]=H,H++),l[q][0]>2?Y[O[T]]=[-l[q][0],l[q][1],O[T]]:Y[O[T]]=[F[l[q][0]],l[q][1],O[T]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let v=0;v<20;v++){if(F=this.IDATA.face[v],G=F[2],U=F[1],V=F[0],b=a.x+"|"+a.y,T=v+"|"+b,T in O||(O[T]=G,Y[G]=[F[l[b][0]],l[b][1]]),b=j.x+"|"+j.y,T=v+"|"+b,T in O||(O[T]=U,Y[U]=[F[l[b][0]],l[b][1]]),b=e.x+"|"+e.y,T=v+"|"+b,T in O||(O[T]=V,Y[V]=[F[l[b][0]],l[b][1]]),q=this.IDATA.edgematch[v][0],p=this.IDATA.edgematch[v][1],"B"===p)for(let H=1;H<w;H++)E.x=S-H*(o+h),E.y=t+H*o,y.x=-H*h,y.y=H*(o+h),b=E.x+"|"+E.y,D=y.x+"|"+y.y,d(v,q,b,D);if("O"===p)for(let H=1;H<w;H++)y.x=-H*h,y.y=H*(o+h),X.x=H*o,X.y=H*h,b=y.x+"|"+y.y,D=X.x+"|"+X.y,d(v,q,b,D);if(q=this.IDATA.edgematch[v][2],p=this.IDATA.edgematch[v][3],p&&"A"===p)for(let H=1;H<w;H++)X.x=H*o,X.y=H*h,E.x=S-(w-H)*(o+h),E.y=t+(w-H)*o,b=X.x+"|"+X.y,D=E.x+"|"+E.y,d(v,q,b,D);for(let S=0;S<this.vertices.length;S++)b=this.vertices[S].x+"|"+this.vertices[S].y,T=v+"|"+b,T in O||(O[T]=H++,l[b][0]>2?Y[O[T]]=[-l[b][0],l[b][1],O[T]]:Y[O[T]]=[F[l[b][0]],l[b][1],O[T]])}this.closestTo=Y,this.vecToidx=O}calcCoeffs(){const H=this.m,O=this.n,S=Math.sqrt(3)/3,t=H*H+O*O+H*O;this.coau=(H+O)/t,this.cobu=-O/t,this.coav=-S*(H-O)/t,this.cobv=S*(2*H+O)/t}createInnerFacets(){const H=this.m,O=this.n;for(let S=0;S<O+H+1;S++)for(let H=this.min[S];H<this.max[S]+1;H++)H<this.max[S]&&H<this.max[S+1]+1&&this.innerFacets.push(["|"+H+"|"+S,"|"+H+"|"+(S+1),"|"+(H+1)+"|"+S]),S>0&&H<this.max[S-1]&&H+1<this.max[S]+1&&this.innerFacets.push(["|"+H+"|"+S,"|"+(H+1)+"|"+S,"|"+(H+1)+"|"+(S-1)])}edgeVecsABOB(){const H=this.m,O=this.n,S=new OH(-O,H+O);for(let t=1;t<H+O;t++){const H=new OH(this.min[t],t),O=new OH(this.min[t-1],t-1),q=new OH(this.min[t+1],t+1),p=H.clone(),G=O.clone(),U=q.clone();p.rotate60About(S),G.rotate60About(S),U.rotate60About(S);const V=new OH(this.max[p.y],p.y),w=new OH(this.max[p.y-1],p.y-1),o=new OH(this.max[p.y-1]-1,p.y-1);p.x===V.x&&p.y===V.y||(p.x!==w.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,w,o]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,o,V])):p.y===U.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,O,w]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([H,w,q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([H,O,w]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([H,w,V])))}}mapABOBtoOBOA(){const H=new OH(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const S=[];for(let t=0;t<3;t++)H.x=this.isoVecsABOB[O][t].x,H.y=this.isoVecsABOB[O][t].y,0===this.vertexTypes[O][t]&&H.rotateNeg120(this.m,this.n),S.push(H.clone());this.isoVecsOBOA.push(S)}}mapABOBtoBAOA(){const H=new OH(0,0);for(let O=0;O<this.isoVecsABOB.length;O++){const S=[];for(let t=0;t<3;t++)H.x=this.isoVecsABOB[O][t].x,H.y=this.isoVecsABOB[O][t].y,1===this.vertexTypes[O][t]&&H.rotate120(this.m,this.n),S.push(H.clone());this.isoVecsBAOA.push(S)}}MapToFace(H,O){const S=this.IDATA.face[H],q=S[2],p=S[1],G=S[0],U=t.eO.KO(this.IDATA.vertex[q]),V=t.eO.KO(this.IDATA.vertex[p]),w=t.eO.KO(this.IDATA.vertex[G]),o=V.XO(U),h=w.XO(U),a=o.scale(this.coau).add(h.scale(this.cobu)),j=o.scale(this.coav).add(h.scale(this.cobv)),e=[];let X,E=t.TmpVectors.eO[0];for(let t=0;t<this.cartesian.length;t++)E=a.scale(this.cartesian[t].x).add(j.scale(this.cartesian[t].y)).add(U),e[t]=[E.x,E.y,E.z],X=H+"|"+this.vertices[t].x+"|"+this.vertices[t].y,O.vertex[this.vecToidx[X]]=[E.x,E.y,E.z]}build(H,O){const S=[],t=OH.Zero(),q=new OH(H,O),p=new OH(-O,H+O);S.push(t,q,p);for(let b=O;b<H+1;b++)for(let O=0;O<H+1-b;O++)S.push(new OH(O,b));if(O>0){const t=(0,c.HighestCommonFactor)(H,O),q=H/t,p=O/t;for(let U=1;U<t;U++)S.push(new OH(U*q,U*p)),S.push(new OH(-U*p,U*(q+p))),S.push(new OH(H-U*(q+p),O+U*q));const G=H/O;for(let U=1;U<O;U++)for(let t=0;t<U*G;t++)S.push(new OH(t,U)),S.push(new OH(t,U).rotate120(H,O)),S.push(new OH(t,U).rotateNeg120(H,O))}S.sort(((H,O)=>H.x-O.x)),S.sort(((H,O)=>H.y-O.y));const G=new Array(H+O+1),U=new Array(H+O+1);for(let b=0;b<G.length;b++)G[b]=1/0,U[b]=-1/0;let V=0,w=0;const o=S.length;for(let b=0;b<o;b++)w=S[b].x,V=S[b].y,G[V]=Math.min(w,G[V]),U[V]=Math.max(w,U[V]);const h=(S,t)=>{const q=S.clone();return"A"===t&&q.rotateNeg120(H,O),"B"===t&&q.rotate120(H,O),q.x<0?q.y:q.x+q.y},a=[],j=[],e=[],X=[],E={},y=[];let T=-1,K=-1;for(let b=0;b<o;b++)a[b]=S[b].toCartesianOrigin(new OH(0,0),.5),j[b]=h(S[b],"O"),e[b]=h(S[b],"A"),X[b]=h(S[b],"B"),j[b]===e[b]&&e[b]===X[b]?(T=3,K=j[b]):j[b]===e[b]?(T=4,K=j[b]):e[b]===X[b]?(T=5,K=e[b]):X[b]===j[b]&&(T=6,K=j[b]),j[b]<e[b]&&j[b]<X[b]&&(T=2,K=j[b]),e[b]<j[b]&&e[b]<X[b]&&(T=1,K=e[b]),X[b]<e[b]&&X[b]<j[b]&&(T=0,K=X[b]),y.push([T,K,S[b].x,S[b].y]);y.sort(((H,O)=>H[2]-O[2])),y.sort(((H,O)=>H[3]-O[3])),y.sort(((H,O)=>H[1]-O[1])),y.sort(((H,O)=>H[0]-O[0]));for(let b=0;b<y.length;b++)E[y[b][2]+"|"+y[b][3]]=[y[b][0],y[b][1],b];return this.m=H,this.n=O,this.vertices=S,this.vertByDist=E,this.cartesian=a,this.min=G,this.max=U,this}}class tH{constructor(H,O,S,t){this.name=H,this.category=O,this.vertex=S,this.face=t}}class qH extends tH{innerToData(H,O){for(let S=0;S<O.innerFacets.length;S++)this.face.push(O.innerFacets[S].map((S=>O.vecToidx[H+S])))}mapABOBtoDATA(H,O){const S=O.IDATA.edgematch[H][0];for(let t=0;t<O.isoVecsABOB.length;t++){const q=[];for(let p=0;p<3;p++)0===O.vertexTypes[t][p]?q.push(H+"|"+O.isoVecsABOB[t][p].x+"|"+O.isoVecsABOB[t][p].y):q.push(S+"|"+O.isoVecsABOB[t][p].x+"|"+O.isoVecsABOB[t][p].y);this.face.push([O.vecToidx[q[0]],O.vecToidx[q[1]],O.vecToidx[q[2]]])}}mapOBOAtoDATA(H,O){const S=O.IDATA.edgematch[H][0];for(let t=0;t<O.isoVecsOBOA.length;t++){const q=[];for(let p=0;p<3;p++)1===O.vertexTypes[t][p]?q.push(H+"|"+O.isoVecsOBOA[t][p].x+"|"+O.isoVecsOBOA[t][p].y):q.push(S+"|"+O.isoVecsOBOA[t][p].x+"|"+O.isoVecsOBOA[t][p].y);this.face.push([O.vecToidx[q[0]],O.vecToidx[q[1]],O.vecToidx[q[2]]])}}mapBAOAtoDATA(H,O){const S=O.IDATA.edgematch[H][2];for(let t=0;t<O.isoVecsBAOA.length;t++){const q=[];for(let p=0;p<3;p++)1===O.vertexTypes[t][p]?q.push(H+"|"+O.isoVecsBAOA[t][p].x+"|"+O.isoVecsBAOA[t][p].y):q.push(S+"|"+O.isoVecsBAOA[t][p].x+"|"+O.isoVecsBAOA[t][p].y);this.face.push([O.vecToidx[q[0]],O.vecToidx[q[1]],O.vecToidx[q[2]]])}}orderData(H){const O=[];for(let p=0;p<13;p++)O[p]=[];const S=H.closestTo;for(let p=0;p<S.length;p++)S[p][0]>-1?S[p][1]>0&&O[S[p][0]].push([p,S[p][1]]):O[12].push([p,S[p][0]]);const t=[];for(let p=0;p<12;p++)t[p]=p;let q=12;for(let p=0;p<12;p++){O[p].sort(((H,O)=>H[1]-O[1]));for(let H=0;H<O[p].length;H++)t[O[p][H][0]]=q++}for(let p=0;p<O[12].length;p++)t[O[12][p][0]]=q++;for(let p=0;p<this.vertex.length;p++)this.vertex[p].push(t[p]);this.vertex.sort(((H,O)=>H[3]-O[3]));for(let p=0;p<this.vertex.length;p++)this.vertex[p].pop();for(let p=0;p<this.face.length;p++)for(let H=0;H<this.face[p].length;H++)this.face[p][H]=t[this.face[p][H]];this.sharedNodes=O[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(H,O){const S=[],t=[];let q=O.pop();t.push(q);let p=this.face[q].indexOf(H);p=(p+2)%3;let G=this.face[q][p];S.push(G);let U=0;for(;O.length>0;)q=O[U],this.face[q].indexOf(G)>-1?(p=(this.face[q].indexOf(G)+1)%3,G=this.face[q][p],S.push(G),t.push(q),O.splice(U,1),U=0):U++;return this.adjacentFaces.push(S),t}toGoldbergPolyhedronData(){const H=new tH("GeoDual","Goldberg",[],[]);H.name="GD dual";const O=this.vertex.length,S=new Array(O);for(let V=0;V<O;V++)S[V]=[];for(let V=0;V<this.face.length;V++)for(let H=0;H<3;H++)S[this.face[V][H]].push(V);let t=0,q=0,p=0,G=[],U=[];this.adjacentFaces=[];for(let V=0;V<S.length;V++){H.face[V]=this.setOrder(V,S[V].concat([]));for(const O of S[V]){t=0,q=0,p=0,G=this.face[O];for(let H=0;H<3;H++)U=this.vertex[G[H]],t+=U[0],q+=U[1],p+=U[2];H.vertex[O]=[t/3,q/3,p/3]}}return H}static BuildGeodesicData(H){const O=new qH("Geodesic-m-n","Geodesic",[[0,HH.g,-1],[-HH.g,1,0],[-1,0,-HH.g],[1,0,-HH.g],[HH.g,1,0],[0,HH.g,1],[-1,0,HH.g],[-HH.g,-1,0],[0,-HH.g,-1],[HH.g,-1,0],[1,0,HH.g],[0,-HH.g,1]],[]);H.setIndices(),H.calcCoeffs(),H.createInnerFacets(),H.edgeVecsABOB(),H.mapABOBtoOBOA(),H.mapABOBtoBAOA();for(let S=0;S<H.IDATA.face.length;S++)H.MapToFace(S,O),O.innerToData(S,H),"B"===H.IDATA.edgematch[S][1]&&O.mapABOBtoDATA(S,H),"O"===H.IDATA.edgematch[S][1]&&O.mapOBOAtoDATA(S,H),"A"===H.IDATA.edgematch[S][3]&&O.mapBAOAtoDATA(S,H);O.orderData(H);return O.vertex=O.vertex.map((function(H){const O=H[0],S=H[1],t=H[2],q=Math.sqrt(O*O+S*S+t*t);return H[0]*=1/q,H[1]*=1/q,H[2]*=1/q,H})),O}}q.d._GoldbergMeshParser=(H,O)=>pH.Parse(H,O);class pH extends q.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(H,O){return void 0===O?(H>this.goldbergData.nbUnsharedFaces-1&&(L.b.Warn("Maximum number of unshared faces used"),H=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+H):(H>11&&(L.b.Warn("Last pole used"),H=11),O>this.goldbergData.nbFacesAtPole-1&&(L.b.Warn("Maximum number of faces at a pole used"),O=this.goldbergData.nbFacesAtPole-1),12+H*this.goldbergData.nbFacesAtPole+O)}_changeGoldbergFaceColors(H){for(let S=0;S<H.length;S++){const O=H[S][0],t=H[S][1],q=H[S][2];for(let H=O;H<t+1;H++)this.goldbergData.faceColors[H]=q}const O=[];for(let S=0;S<12;S++)for(let H=0;H<5;H++)O.push(this.goldbergData.faceColors[S].r,this.goldbergData.faceColors[S].g,this.goldbergData.faceColors[S].b,this.goldbergData.faceColors[S].a);for(let S=12;S<this.goldbergData.faceColors.length;S++)for(let H=0;H<6;H++)O.push(this.goldbergData.faceColors[S].r,this.goldbergData.faceColors[S].g,this.goldbergData.faceColors[S].b,this.goldbergData.faceColors[S].a);return O}setGoldbergFaceColors(H){const O=this._changeGoldbergFaceColors(H);this.kH(p.h.ColorKind,O)}updateGoldbergFaceColors(H){const O=this._changeGoldbergFaceColors(H);this.updateVerticesData(p.h.ColorKind,O)}_changeGoldbergFaceUVs(H){const O=this.getVerticesData(p.h.UVKind);for(let S=0;S<H.length;S++){const t=H[S][0],q=H[S][1],p=H[S][2],G=H[S][3],U=H[S][4],V=[],w=[];let o,h;for(let H=0;H<5;H++)o=p.x+G*Math.cos(U+H*Math.PI/2.5),h=p.y+G*Math.sin(U+H*Math.PI/2.5),o<0&&(o=0),o>1&&(o=1),V.push(o,h);for(let H=0;H<6;H++)o=p.x+G*Math.cos(U+H*Math.PI/3),h=p.y+G*Math.sin(U+H*Math.PI/3),o<0&&(o=0),o>1&&(o=1),w.push(o,h);for(let H=t;H<Math.min(12,q+1);H++)for(let S=0;S<5;S++)O[10*H+2*S]=V[2*S],O[10*H+2*S+1]=V[2*S+1];for(let H=Math.max(12,t);H<q+1;H++)for(let S=0;S<6;S++)O[12*H-24+2*S]=w[2*S],O[12*H-23+2*S]=w[2*S+1]}return O}setGoldbergFaceUVs(H){const O=this._changeGoldbergFaceUVs(H);this.kH(p.h.UVKind,O)}updateGoldbergFaceUVs(H){const O=this._changeGoldbergFaceUVs(H);this.updateVerticesData(p.h.UVKind,O)}placeOnGoldbergFaceAt(H,O,S){const q=t.eO.RotationFromAxis(this.goldbergData.faceXaxis[O],this.goldbergData.faceYaxis[O],this.goldbergData.faceZaxis[O]);H.rotation=q,H.position=this.goldbergData.faceCenters[O].add(this.goldbergData.faceXaxis[O].scale(S.x)).add(this.goldbergData.faceYaxis[O].scale(S.y)).add(this.goldbergData.faceZaxis[O].scale(S.z))}serialize(H){super.serialize(H),H.type="GoldbergMesh";const O={};if(O.adjacentFaces=this.goldbergData.adjacentFaces,O.nbSharedFaces=this.goldbergData.nbSharedFaces,O.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,O.nbFaces=this.goldbergData.nbFaces,O.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){O.faceColors=[];for(const H of this.goldbergData.faceColors)O.faceColors.push(H.pU())}if(this.goldbergData.faceCenters){O.faceCenters=[];for(const H of this.goldbergData.faceCenters)O.faceCenters.push(H.pU())}if(this.goldbergData.faceZaxis){O.faceZaxis=[];for(const H of this.goldbergData.faceZaxis)O.faceZaxis.push(H.pU())}if(this.goldbergData.faceYaxis){O.faceYaxis=[];for(const H of this.goldbergData.faceYaxis)O.faceYaxis.push(H.pU())}if(this.goldbergData.faceXaxis){O.faceXaxis=[];for(const H of this.goldbergData.faceXaxis)O.faceXaxis.push(H.pU())}H.goldbergData=O}static Parse(H,O){const S=H.goldbergData;S.faceColors=S.faceColors.map((H=>a.EU.KO(H))),S.faceCenters=S.faceCenters.map((H=>t.eO.KO(H))),S.faceZaxis=S.faceZaxis.map((H=>t.eO.KO(H))),S.faceXaxis=S.faceXaxis.map((H=>t.eO.KO(H))),S.faceYaxis=S.faceYaxis.map((H=>t.eO.KO(H)));const q=new pH(H.name,O);return q.goldbergData=S,q}}var GH=S(11858);const UH={CreateBox:h.c,CreateTiledBox:E,CreateSphere:y.c,CreateDisc:o.e,CreateIcoSphere:f,CreateRibbon:w,CreateCylinder:D,CreateTorus:Y,CreateTorusKnot:d,CreateLineSystem:v.g,ww:v.k,CreateDashedLines:v.c,ExtrudeShape:r,ExtrudeShapeCustom:W,CreateLathe:N,CreateTiledPlane:e,aw:x.e,CreateGround:k.h,CreateTiledGround:k.i,CreateGroundFromHeightMap:k.d,CreatePolygon:z.e,ExtrudePolygon:z.i,CreateTube:A,CreatePolyhedron:J,CreateGeodesic:function(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=O.m||1;t!==Math.floor(t)&&(t=Math.floor(t),L.b.Warn("m not an integer only floor(m) used"));let q=O.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),L.b.Warn("n not an integer only floor(n) used")),q>t){const H=q;q=t,t=H,L.b.Warn("n > m therefore m and n swapped")}const p=new SH;return p.build(t,q),J(H,{custom:qH.BuildGeodesicData(p),size:O.size,sizeX:O.sizeX,sizeY:O.sizeY,sizeZ:O.sizeZ,faceUV:O.faceUV,faceColors:O.faceColors,flat:O.flat,updatable:O.updatable,sideOrientation:O.sideOrientation,frontUVs:O.frontUVs,backUVs:O.backUVs},S)},CreateGoldberg:function(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=O.size,V=O.sizeX||p||1,w=O.sizeY||p||1,o=O.sizeZ||p||1;let h=O.m||1;h!==Math.floor(h)&&(h=Math.floor(h),L.b.Warn("m not an integer only floor(m) used"));let j=O.n||0;if(j!==Math.floor(j)&&(j=Math.floor(j),L.b.Warn("n not an integer only floor(n) used")),j>h){const H=j;j=h,h=H,L.b.Warn("n > m therefore m and n swapped")}const e=new SH;e.build(h,j);const X=qH.BuildGeodesicData(e),E=X.toGoldbergPolyhedronData(),y=new pH(H,S);O.sideOrientation=q.d._GetDefaultSideOrientation(O.sideOrientation),y._originalBuilderSideOrientation=O.sideOrientation;(function(H,O){const S=H.size,q=H.sizeX||S||1,p=H.sizeY||S||1,V=H.sizeZ||S||1,w=0===H.sideOrientation?0:H.sideOrientation||G.c.DEFAULTSIDE,o=[],h=[],a=[],j=[];let e=1/0,X=-1/0,E=1/0,y=-1/0;for(let t=0;t<O.vertex.length;t++)e=Math.min(e,O.vertex[t][0]*q),X=Math.max(X,O.vertex[t][0]*q),E=Math.min(E,O.vertex[t][1]*p),y=Math.max(y,O.vertex[t][1]*p);let T=0;for(let G=0;G<O.face.length;G++){const H=O.face[G],S=t.eO.KO(O.vertex[H[0]]),w=t.eO.KO(O.vertex[H[2]]),K=t.eO.KO(O.vertex[H[1]]),b=w.XO(S),D=K.XO(S),F=t.eO.Cross(D,b).normalize();for(let t=0;t<H.length;t++){a.push(F.x,F.y,F.z);const S=O.vertex[H[t]];o.push(S[0]*q,S[1]*p,S[2]*V);const G=(S[1]*p-E)/(y-E);j.push((S[0]*q-e)/(X-e),U.d?1-G:G)}for(let O=0;O<H.length-2;O++)h.push(T,T+O+2,T+O+1);T+=H.length}G.c._ComputeSides(w,o,h,a,j);const K=new G.c;return K.dH=o,K.indices=h,K.vH=a,K.mH=j,K})(O,E).WH(y,O.updatable),y.goldbergData.nbSharedFaces=X.sharedNodes,y.goldbergData.nbUnsharedFaces=X.poleNodes,y.goldbergData.adjacentFaces=X.adjacentFaces,y.goldbergData.nbFaces=y.goldbergData.nbSharedFaces+y.goldbergData.nbUnsharedFaces,y.goldbergData.nbFacesAtPole=(y.goldbergData.nbUnsharedFaces-12)/12;for(let q=0;q<X.vertex.length;q++)y.goldbergData.faceCenters.push(t.eO.KO(X.vertex[q])),y.goldbergData.faceCenters[q].x*=V,y.goldbergData.faceCenters[q].y*=w,y.goldbergData.faceCenters[q].z*=o,y.goldbergData.faceColors.push(new a.EU(1,1,1,1));for(let q=0;q<E.face.length;q++){const H=E.face[q],O=t.eO.KO(E.vertex[H[0]]),S=t.eO.KO(E.vertex[H[2]]),p=t.eO.KO(E.vertex[H[1]]),G=S.XO(O),U=p.XO(O),V=t.eO.Cross(U,G).normalize(),w=t.eO.Cross(U,V).normalize();y.goldbergData.faceXaxis.push(U.normalize()),y.goldbergData.faceYaxis.push(V),y.goldbergData.faceZaxis.push(w)}return y},CreateDecal:C,CreateCapsule:Q,CreateText:GH.g}},12627:(H,O,S)=>{"use strict";S.d(O,{c:()=>UO});var t=S(11301),q=S(11689);class p extends q.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var G=S(11355),U=(S(11482),S(11262));class V{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(H){this._targetStopDuration!==H&&(this._targetStopDuration=H)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(H){this._noiseTexture!==H&&(this._noiseTexture=H,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(H){this._animationSheetEnabled!==H&&(this._animationSheetEnabled=H)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(H){this._isAnimationSheetEnabled!=H&&(this._isAnimationSheetEnabled=H,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(H){this._useLogarithmicDepth=H&&this.YH().getEngine().getCaps().fragmentDepthSupported}YH(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(H){switch(H){case V.BLENDMODE_MULTIPLYADD:return;case V.BLENDMODE_ADD:H=1;break;case V.BLENDMODE_ONEONE:H=6;break;case V.BLENDMODE_STANDARD:H=2;break;case V.BLENDMODE_MULTIPLY:H=4;break;case V.BLENDMODE_SUBTRACT:H=3}this._engine.setAlphaMode(H)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:t.eO.Zero()}set direction1(H){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=H)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:t.eO.Zero()}set direction2(H){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=H)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:t.eO.Zero()}set minEmitBox(H){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=H)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:t.eO.Zero()}set maxEmitBox(H){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=H)}get billboardMode(){return this._billboardMode}set billboardMode(H){this._billboardMode!==H&&(this._billboardMode=H,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(H){this._isBillboardBased!==H&&(this._isBillboardBased=H,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(H){this._attachImageProcessingConfiguration(H)}_attachImageProcessingConfiguration(H){H!==this._imageProcessingConfiguration&&(!H&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=H)}_reset(){}_removeGradientAndTexture(H,O,S){if(!O)return this;let t=0;for(const q of O){if(q.gradient===H){O.splice(t,1);break}t++}return S&&S.dispose(),this}constructor(H){this.animations=[],this.renderingGroupId=0,this.tO=t.eO.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new t.eO(10,10,10),this.onAnimationEnd=null,this.blendMode=V.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new t.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Gw=new t.eO(0,0,0),this._useLogarithmicDepth=!1,this.gravity=t.eO.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.EU(1,1,1,1),this.color2=new G.EU(1,1,1,1),this.colorDead=new G.EU(0,0,0,1),this.textureMask=new G.EU(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new p,this.id=H,this.name=H}createPointEmitter(H,O){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new t.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]||new t.eO(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new t.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]||new t.eO(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new t.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]||new t.eO(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(H,O,S,t){throw new Error("Method not implemented.")}}V.BLENDMODE_ONEONE=0,V.BLENDMODE_STANDARD=1,V.BLENDMODE_ADD=2,V.BLENDMODE_MULTIPLY=3,V.BLENDMODE_MULTIPLYADD=4,V.BLENDMODE_SUBTRACT=-1,(0,U.g)("BABYLON.BaseParticleSystem",V);var w=S(11317),o=S(11160);class h{constructor(){this.direction1=new t.eO(0,1,0),this.direction2=new t.eO(0,1,0),this.minEmitBox=new t.eO(-.5,-.5,-.5),this.maxEmitBox=new t.eO(.5,.5,.5)}startDirectionFunction(H,O,S,q){const p=(0,w.RandomRange)(this.direction1.x,this.direction2.x),G=(0,w.RandomRange)(this.direction1.y,this.direction2.y),U=(0,w.RandomRange)(this.direction1.z,this.direction2.z);if(q)return O.x=p,O.y=G,void(O.z=U);t.eO.TransformNormalFromFloatsToRef(p,G,U,H,O)}startPositionFunction(H,O,S,q){const p=(0,w.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),G=(0,w.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),U=(0,w.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(q)return O.x=p,O.y=G,void(O.z=U);t.eO.TransformCoordinatesFromFloatsToRef(p,G,U,H,O)}clone(){const H=new h;return o.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2),H.setVector3("minEmitBox",this.minEmitBox),H.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3),H.addUniform("minEmitBox",3),H.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.pU(),H.direction2=this.direction2.pU(),H.minEmitBox=this.minEmitBox.pU(),H.maxEmitBox=this.maxEmitBox.pU(),H}parse(H){t.eO.FromArrayToRef(H.direction1,0,this.direction1),t.eO.FromArrayToRef(H.direction2,0,this.direction2),t.eO.FromArrayToRef(H.minEmitBox,0,this.minEmitBox),t.eO.FromArrayToRef(H.maxEmitBox,0,this.maxEmitBox)}}class a{get radius(){return this._radius}set radius(H){this._radius=H,this._buildHeight()}get angle(){return this._angle}set angle(H){this._angle=H,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=S,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=O,this.radius=H}startDirectionFunction(H,O,S,q){q?t.TmpVectors.eO[0].t(S.PU).normalize():S.position.subtractToRef(H.getTranslation(),t.TmpVectors.eO[0]).normalize();const p=(0,w.RandomRange)(0,this.directionRandomizer),G=(0,w.RandomRange)(0,this.directionRandomizer),U=(0,w.RandomRange)(0,this.directionRandomizer);O.x=t.TmpVectors.eO[0].x+p,O.y=t.TmpVectors.eO[0].y+G,O.z=t.TmpVectors.eO[0].z+U,O.normalize()}startPositionFunction(H,O,S,q){const p=(0,w.RandomRange)(0,2*Math.PI);let G;this.emitFromSpawnPointOnly?G=1e-4:(G=(0,w.RandomRange)(0,this.heightRange),G=1-G*G);let U=this._radius-(0,w.RandomRange)(0,this._radius*this.radiusRange);U*=G;const V=U*Math.sin(p),o=U*Math.cos(p),h=G*this._height;if(q)return O.x=V,O.y=h,void(O.z=o);t.eO.TransformCoordinatesFromFloatsToRef(V,h,o,H,O)}clone(){const H=new a(this._radius,this._angle,this.directionRandomizer);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat2("radius",this._radius,this.radiusRange),H.setFloat("coneAngle",this._angle),H.setFloat2("height",this._height,this.heightRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",2),H.addUniform("coneAngle",1),H.addUniform("height",2),H.addUniform("directionRandomizer",1)}getEffectDefines(){let H="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(H+="\n#define CONEEMITTERSPAWNPOINT"),H}getClassName(){return"ConeParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this._radius,H.angle=this._angle,H.directionRandomizer=this.directionRandomizer,H.radiusRange=this.radiusRange,H.heightRange=this.heightRange,H.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,H}parse(H){this.radius=H.radius,this.angle=H.angle,this.directionRandomizer=H.directionRandomizer,this.radiusRange=void 0!==H.radiusRange?H.radiusRange:1,this.heightRange=void 0!==H.radiusRange?H.heightRange:1,this.emitFromSpawnPointOnly=void 0!==H.emitFromSpawnPointOnly&&H.emitFromSpawnPointOnly}}class j extends a{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0);super(H,O),this.direction1=S,this.direction2=q}startDirectionFunction(H,O){const S=(0,w.RandomRange)(this.direction1.x,this.direction2.x),q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),p=(0,w.RandomRange)(this.direction1.z,this.direction2.z);t.eO.TransformNormalFromFloatsToRef(S,q,p,H,O)}clone(){const H=new j(this.radius,this.angle,this.direction1,this.direction2);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.pU(),H.direction2=this.direction2.pU(),H}parse(H){super.parse(H),this.direction1.t(H.direction1),this.direction2.t(H.direction2)}}class e{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=H,this.height=O,this.radiusRange=S,this.directionRandomizer=q,this._tempVector=t.eO.Zero()}startDirectionFunction(H,O,S,q,p){S.position.subtractToRef(H.getTranslation(),this._tempVector),this._tempVector.normalize(),t.eO.TransformNormalToRef(this._tempVector,p,this._tempVector);const G=(0,w.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=G,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),q?O.t(this._tempVector):t.eO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,H,O)}startPositionFunction(H,O,S,q){const p=(0,w.RandomRange)(-this.height/2,this.height/2),G=(0,w.RandomRange)(0,2*Math.PI),U=(0,w.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),V=Math.sqrt(U)*this.radius,o=V*Math.cos(G),h=V*Math.sin(G);q?O.jU(o,p,h):t.eO.TransformCoordinatesFromFloatsToRef(o,p,h,H,O)}clone(){const H=new e(this.radius,this.directionRandomizer);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.height=this.height,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.height=H.height,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class X extends e{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.eO(0,1,0);super(H,O,S),this.direction1=q,this.direction2=p}startDirectionFunction(H,O,S,q){const p=(0,w.RandomRange)(this.direction1.x,this.direction2.x),G=(0,w.RandomRange)(this.direction1.y,this.direction2.y),U=(0,w.RandomRange)(this.direction1.z,this.direction2.z);q?O.jU(p,G,U):t.eO.TransformNormalFromFloatsToRef(p,G,U,H,O)}clone(){const H=new X(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("height",this.height),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("height",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.pU(),H.direction2=this.direction2.pU(),H}parse(H){super.parse(H),t.eO.FromArrayToRef(H.direction1,0,this.direction1),t.eO.FromArrayToRef(H.direction2,0,this.direction2)}}class E{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=O,this.directionRandomizer=S}startDirectionFunction(H,O,S,q){const p=S.position.XO(H.getTranslation()).normalize(),G=(0,w.RandomRange)(0,this.directionRandomizer),U=(0,w.RandomRange)(0,this.directionRandomizer),V=(0,w.RandomRange)(0,this.directionRandomizer);p.x+=G,p.y+=U,p.z+=V,p.normalize(),q?O.t(p):t.eO.TransformNormalFromFloatsToRef(p.x,p.y,p.z,H,O)}startPositionFunction(H,O,S,q){const p=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),G=(0,w.RandomRange)(0,1),U=(0,w.RandomRange)(0,2*Math.PI),V=Math.acos(2*G-1),o=p*Math.cos(U)*Math.sin(V),h=p*Math.cos(V),a=p*Math.sin(U)*Math.sin(V);q?O.jU(o,Math.abs(h),a):t.eO.TransformCoordinatesFromFloatsToRef(o,Math.abs(h),a,H,O)}clone(){const H=new E(this.radius,this.directionRandomizer);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class y{constructor(){this.direction1=new t.eO(0,1,0),this.direction2=new t.eO(0,1,0)}startDirectionFunction(H,O,S,q){const p=(0,w.RandomRange)(this.direction1.x,this.direction2.x),G=(0,w.RandomRange)(this.direction1.y,this.direction2.y),U=(0,w.RandomRange)(this.direction1.z,this.direction2.z);q?O.jU(p,G,U):t.eO.TransformNormalFromFloatsToRef(p,G,U,H,O)}startPositionFunction(H,O,S,q){q?O.jU(0,0,0):t.eO.TransformCoordinatesFromFloatsToRef(0,0,0,H,O)}clone(){const H=new y;return o.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.direction1=this.direction1.pU(),H.direction2=this.direction2.pU(),H}parse(H){t.eO.FromArrayToRef(H.direction1,0,this.direction1),t.eO.FromArrayToRef(H.direction2,0,this.direction2)}}class T{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=H,this.radiusRange=O,this.directionRandomizer=S}startDirectionFunction(H,O,S,q){const p=S.position.XO(H.getTranslation()).normalize(),G=(0,w.RandomRange)(0,this.directionRandomizer),U=(0,w.RandomRange)(0,this.directionRandomizer),V=(0,w.RandomRange)(0,this.directionRandomizer);p.x+=G,p.y+=U,p.z+=V,p.normalize(),q?O.t(p):t.eO.TransformNormalFromFloatsToRef(p.x,p.y,p.z,H,O)}startPositionFunction(H,O,S,q){const p=this.radius-(0,w.RandomRange)(0,this.radius*this.radiusRange),G=(0,w.RandomRange)(0,1),U=(0,w.RandomRange)(0,2*Math.PI),V=Math.acos(2*G-1),o=p*Math.cos(U)*Math.sin(V),h=p*Math.cos(V),a=p*Math.sin(U)*Math.sin(V);q?O.jU(o,h,a):t.eO.TransformCoordinatesFromFloatsToRef(o,h,a,H,O)}clone(){const H=new T(this.radius,this.directionRandomizer);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.radius=this.radius,H.radiusRange=this.radiusRange,H.directionRandomizer=this.directionRandomizer,H}parse(H){this.radius=H.radius,this.radiusRange=H.radiusRange,this.directionRandomizer=H.directionRandomizer}}class K extends T{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.eO(0,1,0),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0);super(H),this.direction1=O,this.direction2=S}startDirectionFunction(H,O){const S=(0,w.RandomRange)(this.direction1.x,this.direction2.x),q=(0,w.RandomRange)(this.direction1.y,this.direction2.y),p=(0,w.RandomRange)(this.direction1.z,this.direction2.z);t.eO.TransformNormalFromFloatsToRef(S,q,p,H,O)}clone(){const H=new K(this.radius,this.direction1,this.direction2);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setFloat("radius",this.radius),H.setFloat("radiusRange",this.radiusRange),H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("radius",1),H.addUniform("radiusRange",1),H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const H=super.serialize();return H.direction1=this.direction1.pU(),H.direction2=this.direction2.pU(),H}parse(H){super.parse(H),this.direction1.t(H.direction1),this.direction2.t(H.direction2)}}class b{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(H,O,S,q){const p=t.TmpVectors.eO[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,S,p);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,S,p);const H=t.TmpVectors.eO[1];p.subtractToRef(S.position,H),H.scaleToRef(1/S.lifeTime,p)}else p.set(0,0,0);q?O.t(p):t.eO.TransformNormalToRef(p,H,O)}startPositionFunction(H,O,S,q){const p=t.TmpVectors.eO[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,S,p):p.set(0,0,0),q?O.t(p):t.eO.TransformCoordinatesToRef(p,H,O)}clone(){const H=new b;return o.e.DeepCopy(this,H),H}applyToShader(H){}buildUniformLayout(H){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const H={};return H.type=this.getClassName(),H.particlePositionGenerator=this.particlePositionGenerator,H.particleDestinationGenerator=this.particleDestinationGenerator,H}parse(H){H.particlePositionGenerator&&(this.particlePositionGenerator=H.particlePositionGenerator),H.particleDestinationGenerator&&(this.particleDestinationGenerator=H.particleDestinationGenerator)}}var D=S(11378);class F{get mesh(){return this._mesh}set mesh(H){this._mesh!==H&&(this._mesh=H,H?(this._indices=H.hU(),this._positions=H.getVerticesData(D.h.PositionKind),this._normals=H.getVerticesData(D.h.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=t.eO.Zero(),this._mesh=null,this.direction1=new t.eO(0,1,0),this.direction2=new t.eO(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=H}startDirectionFunction(H,O,S,q){if(this.useMeshNormalsForDirection&&this._normals)return void t.eO.TransformNormalToRef(this._storedNormal,H,O);const p=(0,w.RandomRange)(this.direction1.x,this.direction2.x),G=(0,w.RandomRange)(this.direction1.y,this.direction2.y),U=(0,w.RandomRange)(this.direction1.z,this.direction2.z);q?O.jU(p,G,U):t.eO.TransformNormalFromFloatsToRef(p,G,U,H,O)}startPositionFunction(H,O,S,q){if(!this._indices||!this._positions)return;const p=3*(Math.random()*(this._indices.length/3)|0),G=Math.random(),U=Math.random()*(1-G),V=1-G-U,w=this._indices[p],o=this._indices[p+1],h=this._indices[p+2],a=t.TmpVectors.eO[0],j=t.TmpVectors.eO[1],e=t.TmpVectors.eO[2],X=t.TmpVectors.eO[3];t.eO.FromArrayToRef(this._positions,3*w,a),t.eO.FromArrayToRef(this._positions,3*o,j),t.eO.FromArrayToRef(this._positions,3*h,e),X.x=G*a.x+U*j.x+V*e.x,X.y=G*a.y+U*j.y+V*e.y,X.z=G*a.z+U*j.z+V*e.z,q?O.jU(X.x,X.y,X.z):t.eO.TransformCoordinatesFromFloatsToRef(X.x,X.y,X.z,H,O),this.useMeshNormalsForDirection&&this._normals&&(t.eO.FromArrayToRef(this._normals,3*w,a),t.eO.FromArrayToRef(this._normals,3*o,j),t.eO.FromArrayToRef(this._normals,3*h,e),this._storedNormal.x=G*a.x+U*j.x+V*e.x,this._storedNormal.y=G*a.y+U*j.y+V*e.y,this._storedNormal.z=G*a.z+U*j.z+V*e.z)}clone(){const H=new F(this.mesh);return o.e.DeepCopy(this,H),H}applyToShader(H){H.setVector3("direction1",this.direction1),H.setVector3("direction2",this.direction2)}buildUniformLayout(H){H.addUniform("direction1",3),H.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var H;const O={};return O.type=this.getClassName(),O.direction1=this.direction1.pU(),O.direction2=this.direction2.pU(),O.meshId=null===(H=this.mesh)||void 0===H?void 0:H.id,O.useMeshNormalsForDirection=this.useMeshNormalsForDirection,O}parse(H,O){t.eO.FromArrayToRef(H.direction1,0,this.direction1),t.eO.FromArrayToRef(H.direction2,0,this.direction2),H.meshId&&O&&(this.mesh=O.getLastMeshById(H.meshId)),this.useMeshNormalsForDirection=H.useMeshNormalsForDirection}}class Y{_isUbo(H){return void 0!==H.addUniform}constructor(H){this._isUbo(H)?(this.setMatrix3x3=H.updateMatrix3x3.bind(H),this.setMatrix2x2=H.updateMatrix2x2.bind(H),this.setFloat=H.updateFloat.bind(H),this.setFloat2=H.updateFloat2.bind(H),this.setFloat3=H.updateFloat3.bind(H),this.setFloat4=H.updateFloat4.bind(H),this.setFloatArray=H.updateFloatArray.bind(H),this.setArray=H.updateArray.bind(H),this.setIntArray=H.updateIntArray.bind(H),this.setMatrix=H.VU.bind(H),this.setMatrices=H.updateMatrices.bind(H),this.setVector3=H.updateVector3.bind(H),this.setVector4=H.updateVector4.bind(H),this.setColor3=H.updateColor3.bind(H),this.setColor4=H.updateColor4.bind(H),this.setDirectColor4=H.updateDirectColor4.bind(H),this.setInt=H.updateInt.bind(H),this.setInt2=H.updateInt2.bind(H),this.setInt3=H.updateInt3.bind(H),this.setInt4=H.updateInt4.bind(H)):(this.setMatrix3x3=H.setMatrix3x3.bind(H),this.setMatrix2x2=H.setMatrix2x2.bind(H),this.setFloat=H.setFloat.bind(H),this.setFloat2=H.setFloat2.bind(H),this.setFloat3=H.setFloat3.bind(H),this.setFloat4=H.setFloat4.bind(H),this.setFloatArray=H.setFloatArray.bind(H),this.setArray=H.setArray.bind(H),this.setIntArray=H.setIntArray.bind(H),this.setMatrix=H.setMatrix.bind(H),this.setMatrices=H.setMatrices.bind(H),this.setVector3=H.setVector3.bind(H),this.setVector4=H.setVector4.bind(H),this.setColor3=H.setColor3.bind(H),this.setColor4=H.setColor4.bind(H),this.setDirectColor4=H.setDirectColor4.bind(H),this.setInt=H.setInt.bind(H),this.setInt2=H.setInt2.bind(H),this.setInt3=H.setInt3.bind(H),this.setInt4=H.setInt4.bind(H))}}var l=S(11223);const d="gpuUpdateParticlesPixelShader",v="#version 300 es\nvoid main() {discard;}\n";l.d.ShadersStore[d]||(l.d.ShadersStore[d]=v);const z="gpuUpdateParticlesVertexShader",m="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";l.d.ShadersStore[z]||(l.d.ShadersStore[z]=m);(0,U.g)("BABYLON.WebGL2ParticleSystem",class{constructor(H,O){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=H,this._engine=O,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var H;return(null===(H=this._updateEffect)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof b&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=H,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Y(this._updateEffect)}createVertexBuffers(H,O){this._updateVAO.push(this._createUpdateVAO(H)),this._renderVAO.push(this._engine.recordVertexArrayObject(O,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=O}createParticleBuffer(H){return H}bindDrawBuffers(H,O,S){S?this._engine.bindBuffers(this._renderVertexBuffers,S,O):this._engine.bindVertexArrayObject(this._renderVAO[H],null)}preUpdateParticleBuffer(){const H=this._engine;if(this._engine.enableEffect(this._updateEffect),!H.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(H,O,S){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[H],null);const t=this._engine;t.bindTransformFeedbackBuffer(O.getBuffer()),t.setRasterizerState(!1),t.beginTransformFeedback(!0),t.drawArraysType(3,0,S),t.endTransformFeedback(),t.setRasterizerState(!0),t.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let H=0;H<this._updateVAO.length;H++)this._engine.releaseVertexArrayObject(this._updateVAO[H]);this._updateVAO.length=0;for(let H=0;H<this._renderVAO.length;H++)this._engine.releaseVertexArrayObject(this._renderVAO[H]);this._renderVAO.length=0}_createUpdateVAO(H){const O={};O.position=H.createVertexBuffer("position",0,3);let S=3;O.age=H.createVertexBuffer("age",S,1),S+=1,O.size=H.createVertexBuffer("size",S,3),S+=3,O.life=H.createVertexBuffer("life",S,1),S+=1,O.seed=H.createVertexBuffer("seed",S,4),S+=4,O.direction=H.createVertexBuffer("direction",S,3),S+=3,this._parent.particleEmitterType instanceof b&&(O.initialPosition=H.createVertexBuffer("initialPosition",S,3),S+=3),this._parent._colorGradientsTexture||(O.color=H.createVertexBuffer("color",S,4),S+=4),this._parent._isBillboardBased||(O.initialDirection=H.createVertexBuffer("initialDirection",S,3),S+=3),this._parent.noiseTexture&&(O.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",S,3),S+=3,O.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",S,3),S+=3),this._parent._angularSpeedGradientsTexture?(O.angle=H.createVertexBuffer("angle",S,1),S+=1):(O.angle=H.createVertexBuffer("angle",S,2),S+=2),this._parent._isAnimationSheetEnabled&&(O.cellIndex=H.createVertexBuffer("cellIndex",S,1),S+=1,this._parent.spriteRandomStartCell&&(O.cellStartOffset=H.createVertexBuffer("cellStartOffset",S,1),S+=1));const t=this._engine.recordVertexArrayObject(O,null,this._updateEffect);return this._engine.bindArrayBuffer(null),t}});class r{constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,t=arguments.length>3?arguments[3]:void 0;this._engine=H,this._label=t,this._engine._storageBuffers.push(this),this._create(O,S)}_create(H,O){this._bufferSize=H,this._creationFlags=O,this._buffer=this._engine.createStorageBuffer(H,O,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(H,O,S){this._buffer&&this._engine.updateStorageBuffer(this._buffer,H,O,S)}async read(H,O,S,t){return await this._engine.readFromStorageBuffer(this._buffer,H,O,S,t)}dispose(){const H=this._engine._storageBuffers,O=H.indexOf(this);-1!==O&&(H[O]=H[H.length-1],H.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var W=S(11287),g=S(11289),N=S(11338),x=S(11279),k=S(11601),A=S(11151),u=S(11242),J=S(11530);class P{constructor(){this._gpuTimeInFrameId=-1,this.counter=new J.b}_addDuration(H,O){H<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==H?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(O,!1),this._gpuTimeInFrameId=H):this.counter.addCount(O,!1))}}var f=S(11205);class c{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=H,this._engine=O,this.uniqueId=k.c.UniqueId,O.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new P),this._engine.getCaps().supportComputeShaders?t.bindingsMapping?(this._context=O.createComputeContext(),this._shaderPath=S,this._options={bindingsMapping:{},defines:[],...t}):A.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):A.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(H,O){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const t=this._bindings[H];this._bindings[H]={type:S?0:4,object:O,indexInGroupEntries:null===t||void 0===t?void 0:t.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!t||t.object!==O||t.type!==this._bindings[H].type)}setStorageTexture(H,O){const S=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==O),this._bindings[H]={type:1,object:O,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setExternalTexture(H,O){const S=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==O),this._bindings[H]={type:6,object:O,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setVideoTexture(H,O){return!!O.externalTexture&&(this.setExternalTexture(H,O.externalTexture),!0)}setUniformBuffer(H,O){const S=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==O),this._bindings[H]={type:c._BufferIsDataBuffer(O)?7:2,object:O,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setStorageBuffer(H,O){const S=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!S||S.object!==O),this._bindings[H]={type:c._BufferIsDataBuffer(O)?7:3,object:O,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}setTextureSampler(H,O){const S=this._bindings[H];this._contextIsDirty||(this._contextIsDirty=!S||!O.compareSampler(S.object)),this._bindings[H]={type:5,object:O,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries}}isReady(){let H=this._effect;for(const q in this._bindings){const H=this._bindings[q],O=H.type,S=H.object;switch(O){case 0:case 4:case 1:if(!S.isReady())return!1;break;case 6:if(!S.isReady())return!1;break}}const O=[],S=this._shaderPath;if(this._options.defines)for(let q=0;q<this._options.defines.length;q++)O.push(this._options.defines[q]);const t=O.join("\n");return this._cachedDefines!==t&&(this._cachedDefines=t,H=this._engine.createComputeEffect(S,{defines:t,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=H),!!H.isReady()}dispatch(H,O,S){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,H,O,S,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const S=c._BufferIsDataBuffer(H)?H:H.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,S,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const O in this._bindings){const S=this._bindings[O];if(!this._options.bindingsMapping[O])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+O+"'");switch(S.type){case 0:{const t=this._samplers[O],q=S.object;var H;if(!t||!q._texture||!t.compareSampler(q._texture))this._samplers[O]=(new u.d).setParameters(q.wrapU,q.wrapV,q.wrapR,q.anisotropicFilteringLevel,q._texture.samplingMode,null===(H=q._texture)||void 0===H?void 0:H._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const H=S.object;H.getBuffer()!==S.buffer&&(S.buffer=H.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((q=>{(0,f.f)((()=>this.dispatch(H,O,S)),q,void 0,t)}))}serialize(){const H=N.e.Serialize(this);H.options=this._options,H.shaderPath=this._shaderPath,H.Ka={},H.textures={};for(const O in this._bindings){const S=this._bindings[O],t=S.object;switch(S.type){case 0:case 4:case 1:{const q=t.serialize();q&&(H.textures[O]=q,H.Ka[O]={type:S.type});break}}}return H}static Parse(H,O,S){const t=N.e.Parse((()=>new c(H.name,O.getEngine(),H.shaderPath,H.options)),H,O,S);for(const q in H.textures){const p=H.Ka[q],G=x.b.Parse(H.textures[q],O,S);0===p.type?t.setTexture(q,G):4===p.type?t.setTexture(q,G,!1):t.setStorageTexture(q,G)}return t}static _BufferIsDataBuffer(H){return void 0!==H.underlyingResource}}(0,W.d)([(0,g.J)()],c.prototype,"name",void 0),(0,W.d)([(0,g.J)()],c.prototype,"fastMode",void 0),(0,U.g)("BABYLON.ComputeShader",c);var R=S(11566);const B="gpuUpdateParticlesComputeShader",Z="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";l.d.ShadersStoreWGSL[B]||(l.d.ShadersStoreWGSL[B]=Z);(0,U.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(H,O){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=H,this._engine=O}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var H;return(null===(H=this._updateComputeShader)||void 0===H?void 0:H.isReady())??!1}createUpdateBuffer(H){var O;const S={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(S.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(S.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(S.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(S.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(S.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(S.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(S.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new c("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:S,defines:H.split("\n")}),null===(O=this._simParamsComputeShader)||void 0===O||O.dispose(),this._simParamsComputeShader=new R.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Y(this._simParamsComputeShader)}createVertexBuffers(H,O){this._renderVertexBuffers.push(O)}createParticleBuffer(H){const O=new r(this._engine,4*H.length,11,"ComputeShaderParticleSystemBuffer");return O.update(H),this._bufferComputeShader.push(O),O.getBuffer()}bindDrawBuffers(H,O,S){this._engine.bindBuffers(this._renderVertexBuffers[H],S,O)}preUpdateParticleBuffer(){}updateParticleBuffer(H,O,S){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[H]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^H]),this._updateComputeShader.dispatch(Math.ceil(S/64))}releaseBuffers(){var H;for(let O=0;O<this._bufferComputeShader.length;++O)this._bufferComputeShader[O].dispose();this._bufferComputeShader.length=0,null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(H,O,S){this.gradient=H,this.color1=O,this.color2=S}getColorToRef(H){this.color2?G.EU.LerpToRef(this.color1,this.color2,Math.random(),H):H.t(this.color1)}}class s{constructor(H,O){this.gradient=H,this.color=O}}class i{constructor(H,O,S){this.gradient=H,this.factor1=O,this.factor2=S}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class M{static GetCurrentGradient(H,O,S){if(O[0].gradient>H)return void S(O[0],O[0],1);for(let q=0;q<O.length-1;q++){const t=O[q],p=O[q+1];if(H>=t.gradient&&H<=p.gradient){return void S(t,p,(H-t.gradient)/(p.gradient-t.gradient))}}const t=O.length-1;S(O[t],O[t],1)}}var C=S(11140),n=S(11781),Q=S(11180);class L{constructor(H){this.particleSystem=H,this.position=t.eO.Zero(),this.direction=t.eO.Zero(),this.color=new G.EU(0,0,0,0),this.colorStep=new G.EU(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new t.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.EU(0,0,0,0),this._currentColor2=new G.EU(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=L._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let H=this.age,O=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===O?(O=1,H=this._randomCellOffset):H+=this._randomCellOffset);const S=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let t;t=this._initialSpriteCellLoop?(0,w.Clamp)(H*O%this.lifeTime/this.lifeTime):(0,w.Clamp)(H*O/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+t*S|0}_inheritParticleInfoToSubEmitter(H){if(H.particleSystem.tO.position){const O=H.particleSystem.tO;if(O.position.t(this.position),H.inheritDirection){const H=t.TmpVectors.eO[0];this.direction.normalizeToRef(H),O.setDirection(H,0,Math.PI/2)}}else{H.particleSystem.tO.t(this.position)}this.direction.scaleToRef(H.inheritedVelocityAmount/2,t.TmpVectors.eO[0]),H.particleSystem._inheritedVelocityOffset.t(t.TmpVectors.eO[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const H of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(H)}_reset(){this.age=0,this.id=L._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(H){H.position.t(this.position),this._initialDirection?H._initialDirection?H._initialDirection.t(this._initialDirection):H._initialDirection=this._initialDirection.clone():H._initialDirection=null,H.direction.t(this.direction),this.PU&&(H.PU?H.PU.t(this.PU):H.PU=this.PU.clone()),H.color.t(this.color),H.colorStep.t(this.colorStep),H.lifeTime=this.lifeTime,H.age=this.age,H._randomCellOffset=this._randomCellOffset,H.size=this.size,H.scale.t(this.scale),H.angle=this.angle,H.angularSpeed=this.angularSpeed,H.particleSystem=this.particleSystem,H.cellIndex=this.cellIndex,H.id=this.id,H._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(H._currentColorGradient=this._currentColorGradient,H._currentColor1.t(this._currentColor1),H._currentColor2.t(this._currentColor2)),this._currentSizeGradient&&(H._currentSizeGradient=this._currentSizeGradient,H._currentSize1=this._currentSize1,H._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(H._currentAngularSpeedGradient=this._currentAngularSpeedGradient,H._currentAngularSpeed1=this._currentAngularSpeed1,H._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(H._currentVelocityGradient=this._currentVelocityGradient,H._currentVelocity1=this._currentVelocity1,H._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(H._currentLimitVelocityGradient=this._currentLimitVelocityGradient,H._currentLimitVelocity1=this._currentLimitVelocity1,H._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(H._currentDragGradient=this._currentDragGradient,H._currentDrag1=this._currentDrag1,H._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(H._initialStartSpriteCellId=this._initialStartSpriteCellId,H._initialEndSpriteCellId=this._initialEndSpriteCellId,H._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(H.remapData&&this.remapData?H.remapData.t(this.remapData):H.remapData=new t.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(H._randomNoiseCoordinates1?(H._randomNoiseCoordinates1.t(this._randomNoiseCoordinates1),H._randomNoiseCoordinates2.t(this._randomNoiseCoordinates2)):(H._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),H._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}L._Count=0;var HH=S(11422),OH=(S(11478),S(11671)),SH=S(11669),tH=S(11560);function qH(H,O){const S=(0,w.RandomRange)(0,1);G.EU.LerpToRef(O.color1,O.color2,S,H.color),O.colorDead.subtractToRef(H.color,O._colorDiff),O._colorDiff.scaleToRef(1/H.lifeTime,H.colorStep)}function pH(H,O){H._currentColorGradient=O._colorGradients[0],H._currentColorGradient.getColorToRef(H.color),H._currentColor1.t(H.color),O._colorGradients.length>1?O._colorGradients[1].getColorToRef(H._currentColor2):H._currentColor2.t(H.color)}function GH(H,O){const S=O._colorGradients;M.GetCurrentGradient(O._ratio,S,((O,S,t)=>{O!==H._currentColorGradient&&(H._currentColor1.t(H._currentColor2),S.getColorToRef(H._currentColor2),H._currentColorGradient=O),G.EU.LerpToRef(H._currentColor1,H._currentColor2,t,H.color)}))}function UH(H,O){H.colorStep.scaleToRef(O._scaledUpdateSpeed,O._scaledColorStep),H.color.addInPlace(O._scaledColorStep),H.color.a<0&&(H.color.a=0)}function VH(H,O){M.GetCurrentGradient(O._ratio,O._angularSpeedGradients,((O,S,t)=>{O!==H._currentAngularSpeedGradient&&(H._currentAngularSpeed1=H._currentAngularSpeed2,H._currentAngularSpeed2=S.getFactor(),H._currentAngularSpeedGradient=O),H.angularSpeed=(0,w.Lerp)(H._currentAngularSpeed1,H._currentAngularSpeed2,t)}))}function wH(H,O){H.angle+=H.angularSpeed*O._scaledUpdateSpeed}function oH(H,O){O.particleEmitterType.startDirectionFunction(O._emitterWorldMatrix,H.direction,H,O.isLocal,O._emitterInverseWorldMatrix)}function hH(H,O){O.startDirectionFunction(O._emitterWorldMatrix,H.direction,H,O.isLocal)}function aH(H,O){H._currentVelocityGradient=O._velocityGradients[0],H._currentVelocity1=H._currentVelocityGradient.getFactor(),O._velocityGradients.length>1?H._currentVelocity2=O._velocityGradients[1].getFactor():H._currentVelocity2=H._currentVelocity1}function jH(H,O){H._currentLimitVelocityGradient=O._limitVelocityGradients[0],H._currentLimitVelocity1=H._currentLimitVelocityGradient.getFactor(),O._limitVelocityGradients.length>1?H._currentLimitVelocity2=O._limitVelocityGradients[1].getFactor():H._currentLimitVelocity2=H._currentLimitVelocity1}function eH(H,O){M.GetCurrentGradient(O._ratio,O._velocityGradients,((S,t,q)=>{S!==H._currentVelocityGradient&&(H._currentVelocity1=H._currentVelocity2,H._currentVelocity2=t.getFactor(),H._currentVelocityGradient=S),O._directionScale*=(0,w.Lerp)(H._currentVelocity1,H._currentVelocity2,q)}))}function XH(H,O){M.GetCurrentGradient(O._ratio,O._limitVelocityGradients,((S,t,q)=>{S!==H._currentLimitVelocityGradient&&(H._currentLimitVelocity1=H._currentLimitVelocity2,H._currentLimitVelocity2=t.getFactor(),H._currentLimitVelocityGradient=S);const p=(0,w.Lerp)(H._currentLimitVelocity1,H._currentLimitVelocity2,q);H.direction.length()>p&&H.direction.scaleInPlace(O.limitVelocityDamping)}))}function EH(H,O){H.direction.scaleToRef(O._directionScale,O._scaledDirection)}function yH(H,O){O.particleEmitterType.startPositionFunction(O._emitterWorldMatrix,H.position,H,O.isLocal)}function TH(H,O){O.startPositionFunction(O._emitterWorldMatrix,H.position,H,O.isLocal)}function KH(H,O){H.PU?H.PU.t(H.position):H.PU=H.position.clone(),t.eO.TransformCoordinatesToRef(H.PU,O._emitterWorldMatrix,H.position)}function bH(H,O){O.isLocal&&H.PU?(H.PU.addInPlace(O._scaledDirection),t.eO.TransformCoordinatesToRef(H.PU,O._emitterWorldMatrix,H.position)):H.position.addInPlace(O._scaledDirection)}function DH(H,O){H._currentDragGradient=O._dragGradients[0],H._currentDrag1=H._currentDragGradient.getFactor(),O._dragGradients.length>1?H._currentDrag2=O._dragGradients[1].getFactor():H._currentDrag2=H._currentDrag1}function FH(H,O){M.GetCurrentGradient(O._ratio,O._dragGradients,((S,t,q)=>{S!==H._currentDragGradient&&(H._currentDrag1=H._currentDrag2,H._currentDrag2=t.getFactor(),H._currentDragGradient=S);const p=(0,w.Lerp)(H._currentDrag1,H._currentDrag2,q);O._scaledDirection.scaleInPlace(1-p)}))}function YH(H,O){H._randomNoiseCoordinates1?(H._randomNoiseCoordinates1.jU(Math.random(),Math.random(),Math.random()),H._randomNoiseCoordinates2.jU(Math.random(),Math.random(),Math.random())):(H._randomNoiseCoordinates1=new t.eO(Math.random(),Math.random(),Math.random()),H._randomNoiseCoordinates2=new t.eO(Math.random(),Math.random(),Math.random()))}function lH(H,O){const S=O._noiseTextureData,q=O._noiseTextureSize;if(S&&q&&H._randomNoiseCoordinates1){const p=O._fetchR(H._randomNoiseCoordinates1.x,H._randomNoiseCoordinates1.y,q.width,q.height,S),G=O._fetchR(H._randomNoiseCoordinates1.z,H._randomNoiseCoordinates2.x,q.width,q.height,S),U=O._fetchR(H._randomNoiseCoordinates2.y,H._randomNoiseCoordinates2.z,q.width,q.height,S),V=t.TmpVectors.eO[0],w=t.TmpVectors.eO[1];V.jU((2*p-1)*O.noiseStrength.x,(2*G-1)*O.noiseStrength.y,(2*U-1)*O.noiseStrength.z),V.scaleToRef(O._tempScaledUpdateSpeed,w),H.direction.addInPlace(w)}}function dH(H,O){O.gravity.scaleToRef(O._tempScaledUpdateSpeed,O._scaledGravity),H.direction.addInPlace(O._scaledGravity)}function vH(H,O){H.size=(0,w.RandomRange)(O.minSize,O.maxSize),H.scale.jU((0,w.RandomRange)(O.minScaleX,O.maxScaleX),(0,w.RandomRange)(O.minScaleY,O.maxScaleY))}function zH(H,O){H._currentSizeGradient=O._sizeGradients[0],H._currentSize1=H._currentSizeGradient.getFactor(),H.size=H._currentSize1,O._sizeGradients.length>1?H._currentSize2=O._sizeGradients[1].getFactor():H._currentSize2=H._currentSize1,H.scale.jU((0,w.RandomRange)(O.minScaleX,O.maxScaleX),(0,w.RandomRange)(O.minScaleY,O.maxScaleY))}function mH(H,O){const S=O._actualFrame/O.targetStopDuration;M.GetCurrentGradient(S,O._startSizeGradients,((S,t,q)=>{S!==O._currentStartSizeGradient&&(O._currentStartSize1=O._currentStartSize2,O._currentStartSize2=t.getFactor(),O._currentStartSizeGradient=S);const p=(0,w.Lerp)(O._currentStartSize1,O._currentStartSize2,q);H.scale.scaleInPlace(p)}))}function rH(H,O){M.GetCurrentGradient(O._ratio,O._sizeGradients,((O,S,t)=>{O!==H._currentSizeGradient&&(H._currentSize1=H._currentSize2,H._currentSize2=S.getFactor(),H._currentSizeGradient=O),H.size=(0,w.Lerp)(H._currentSize1,H._currentSize2,t)}))}function WH(H,O){H.remapData=new t.Vector4(0,1,0,1)}function gH(H,O){O._colorRemapGradients&&O._colorRemapGradients.length>0&&M.GetCurrentGradient(O._ratio,O._colorRemapGradients,((O,S,t)=>{const q=(0,w.Lerp)(O.factor1,S.factor1,t),p=(0,w.Lerp)(O.factor2,S.factor2,t);H.remapData.x=q,H.remapData.y=p-q})),O._alphaRemapGradients&&O._alphaRemapGradients.length>0&&M.GetCurrentGradient(O._ratio,O._alphaRemapGradients,((O,S,t)=>{const q=(0,w.Lerp)(O.factor1,S.factor1,t),p=(0,w.Lerp)(O.factor2,S.factor2,t);H.remapData.z=q,H.remapData.w=p-q}))}function NH(H,O){const S=(0,w.Clamp)(O._actualFrame/O.targetStopDuration);M.GetCurrentGradient(S,O._lifeTimeGradients,((O,t)=>{const q=O,p=t,G=q.getFactor(),U=p.getFactor(),V=(S-q.gradient)/(p.gradient-q.gradient);H.lifeTime=(0,w.Lerp)(G,U,V)})),O._emitPower=(0,w.RandomRange)(O.minEmitPower,O.maxEmitPower)}function xH(H,O){H.lifeTime=(0,w.RandomRange)(O.minLifeTime,O.maxLifeTime),O._emitPower=(0,w.RandomRange)(O.minEmitPower,O.maxEmitPower)}function kH(H,O){0===O._emitPower?(H._initialDirection?H._initialDirection.t(H.direction):H._initialDirection=H.direction.clone(),H.direction.set(0,0,0)):(H._initialDirection=null,H.direction.scaleInPlace(O._emitPower)),H.direction.addInPlace(O._inheritedVelocityOffset)}function AH(H,O){H.angularSpeed=(0,w.RandomRange)(O.minAngularSpeed,O.maxAngularSpeed),H.angle=(0,w.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function uH(H,O){H._currentAngularSpeedGradient=O._angularSpeedGradients[0],H.angularSpeed=H._currentAngularSpeedGradient.getFactor(),H._currentAngularSpeed1=H.angularSpeed,O._angularSpeedGradients.length>1?H._currentAngularSpeed2=O._angularSpeedGradients[1].getFactor():H._currentAngularSpeed2=H._currentAngularSpeed1,H.angle=(0,w.RandomRange)(O.minInitialRotation,O.maxInitialRotation)}function JH(H,O){H._initialStartSpriteCellId=O.startSpriteCellID,H._initialEndSpriteCellId=O.endSpriteCellID,H._initialSpriteCellLoop=O.spriteCellLoop}function PH(H,O){H.previousItem=O.previousItem,H.nextItem=O,O.previousItem&&(O.previousItem.nextItem=H),O.previousItem=H}function fH(H,O){H.previousItem=O,H.nextItem=O.nextItem,O.nextItem&&(O.nextItem.previousItem=H),O.nextItem=H}function cH(H,O){let S=O;for(;S.nextItem;)S=S.nextItem;H.previousItem=S,H.nextItem=S.nextItem,S.nextItem=H}function RH(H){H.previousItem&&(H.previousItem.nextItem=H.nextItem),H.nextItem&&(H.nextItem.previousItem=H.previousItem)}class BH extends V{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(H){this._startDirectionFunction!==H&&(this._startDirectionFunction=H,this._directionProcessing.process=H?hH:oH)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(H){this._startPositionFunction!==H&&(this._startPositionFunction=H,this._positionCreation.process=H?TH:yH)}set onDispose(H){this._onDisposeObserver&&this.up.remove(this._onDisposeObserver),this._onDisposeObserver=this.up.add(H)}get G(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(H){this._useRampGradients!==H&&(this._useRampGradients=H,this._resetEffect(),H?(this._rampCreation={process:WH,previousItem:null,nextItem:null},fH(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:gH,previousItem:null,nextItem:null},fH(this._remapGradientProcessing,this._gravityProcessing)):(RH(this._rampCreation),RH(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(H){this._isLocal!==H&&(this._isLocal=H,H?(this._isLocalCreation={process:KH,previousItem:null,nextItem:null},fH(this._isLocalCreation,this._positionCreation)):RH(this._isLocalCreation))}get particles(){return this.ja}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(H){this._animationSheetEnabled!==H&&(this._animationSheetEnabled=H,H?(this._sheetCreation={process:JH,previousItem:null,nextItem:null},fH(this._sheetCreation,this._colorCreation)):RH(this._sheetCreation),this._reset())}getActiveCount(){return this.ja.length}getClassName(){return"lo"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var H;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[O])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new HH.e(this._engine),this._customWrappers[O].effect=H,this._customWrappers[O].drawContext&&(this._customWrappers[O].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(H){if(this.noiseTexture!==H){if(this._noiseTexture=H,!H)return RH(this._noiseCreation),void RH(this._noiseProcessing);this._noiseCreation={process:YH,previousItem:null,nextItem:null},fH(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:lH,previousItem:null,nextItem:null},fH(this._noiseProcessing,this._positionProcessing)}}constructor(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(H),this._emitterInverseWorldMatrix=t.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new t.eO,this.up=new C.b,this.onStoppedObservable=new C.b,this.onStartedObservable=new C.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.ja=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new G.EU(0,0,0,0),this._colorDiff=new G.EU(0,0,0,0),this._scaledDirection=t.eO.Zero(),this._scaledGravity=t.eO.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=H=>{},this.recycleParticle=H=>{const O=this.ja.pop();O!==H&&O.copyTo(H),this._stockParticles.push(O)},this._createParticle=()=>{let H;return 0!==this._stockParticles.length?(H=this._stockParticles.pop(),H._reset()):H=new L(this),this._prepareParticle(H),H},this.paused=!1,this._shadersLoaded=!1,this._capacity=O,this._epsilon=U,S&&"Scene"!==S.getClassName()?(this._engine=S,this.defaultProjectionMatrix=t.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=S||Q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ha.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:xH,previousItem:null,nextItem:null},this._positionCreation={process:yH,previousItem:null,nextItem:null},fH(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:oH,previousItem:null,nextItem:null},fH(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:kH,previousItem:null,nextItem:null},fH(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:vH,previousItem:null,nextItem:null},fH(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:AH,previousItem:null,nextItem:null},fH(this._angleCreation,this._sizeCreation),this._colorCreation={process:qH,previousItem:null,nextItem:null},fH(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,V||(this._colorProcessing={process:UH,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:wH,previousItem:null,nextItem:null},fH(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:EH,previousItem:null,nextItem:null},fH(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:bH,previousItem:null,nextItem:null},fH(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:dH,previousItem:null,nextItem:null},fH(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=p,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new HH.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new h,this.updateFunction=H=>{var O;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(O=this.noiseTexture.getContent())||void 0===O||O.then((H=>{this._noiseTextureData=H})));const S=H===this.ja;for(let t=0;t<H.length;t++){const O=H[t];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const q=O.age;if(O.age+=this._tempScaledUpdateSpeed,O.age>O.lifeTime){const H=O.age-q,S=O.lifeTime-q;this._tempScaledUpdateSpeed=S*this._tempScaledUpdateSpeed/H,O.age=O.lifeTime}this._ratio=O.age/O.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let p=this._updateQueueStart;for(;p;)p.process(O,this),p=p.nextItem;if(this._isAnimationSheetEnabled&&!V&&O.updateCellIndex(),O._inheritParticleInfoToSubEmitters(),O.age>=O.lifeTime){if(this._emitFromParticle(O),O._attachedSubEmitters){for(const H of O._attachedSubEmitters)H.particleSystem.disposeOnStop=!0,H.particleSystem.stop();O._attachedSubEmitters=null}this.recycleParticle(O),S&&t--}else;}}}serialize(H){throw new Error("Method not implemented.")}clone(H,O){throw new Error("Method not implemented.")}_addFactorGradient(H,O,S,t){const q=new i(O,S,t);H.push(q),H.sort(((H,O)=>H.gradient<O.gradient?-1:H.gradient>O.gradient?1:0))}_removeFactorGradient(H,O){if(!H)return;let S=0;for(const t of H){if(t.gradient===O){H.splice(S,1);break}S++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=NH:this._lifeTimeCreation.process=xH}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:mH,previousItem:null,nextItem:null},fH(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(RH(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(H){this.targetStopDuration!==H&&(this._targetStopDuration=H,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(H,O,S){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,H,O,S),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(H){return this._removeFactorGradient(this._lifeTimeGradients,H),this._syncLifeTimeCreation(),this}addSizeGradient(H,O,S){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=zH,this._sizeGradientProcessing={process:rH,previousItem:null,nextItem:null},PH(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,H,O,S),this}removeSizeGradient(H){var O;return this._removeFactorGradient(this._sizeGradients,H),0===(null===(O=this._sizeGradients)||void 0===O?void 0:O.length)&&(RH(this._sizeGradientProcessing),this._sizeCreation.process=vH),this}addColorRemapGradient(H,O,S){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,H,O,S),this}removeColorRemapGradient(H){return this._removeFactorGradient(this._colorRemapGradients,H),this}addAlphaRemapGradient(H,O,S){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,H,O,S),this}removeAlphaRemapGradient(H){return this._removeFactorGradient(this._alphaRemapGradients,H),this}addAngularSpeedGradient(H,O,S){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=uH,this._angularSpeedGradientProcessing={process:VH,previousItem:null,nextItem:null},PH(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,H,O,S),this}removeAngularSpeedGradient(H){var O;return this._removeFactorGradient(this._angularSpeedGradients,H),0===(null===(O=this._angularSpeedGradients)||void 0===O?void 0:O.length)&&(this._angleCreation.process=AH,RH(this._angularSpeedGradientProcessing)),this}addVelocityGradient(H,O,S){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:aH,previousItem:null,nextItem:null},fH(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:eH,previousItem:null,nextItem:null},PH(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,H,O,S),this}removeVelocityGradient(H){var O;return this._removeFactorGradient(this._velocityGradients,H),0===(null===(O=this._velocityGradients)||void 0===O?void 0:O.length)&&(RH(this._velocityCreation),RH(this._velocityGradientProcessing)),this}addLimitVelocityGradient(H,O,S){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:jH,previousItem:null,nextItem:null},fH(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:XH,previousItem:null,nextItem:null},fH(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,H,O,S),this}removeLimitVelocityGradient(H){var O;return this._removeFactorGradient(this._limitVelocityGradients,H),0===(null===(O=this._limitVelocityGradients)||void 0===O?void 0:O.length)&&(RH(this._limitVelocityCreation),RH(this._limitVelocityGradientProcessing)),this}addDragGradient(H,O,S){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:DH,previousItem:null,nextItem:null},PH(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:FH,previousItem:null,nextItem:null},PH(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,H,O,S),this}removeDragGradient(H){var O;return this._removeFactorGradient(this._dragGradients,H),0===(null===(O=this._dragGradients)||void 0===O?void 0:O.length)&&(RH(this._dragCreation),RH(this._dragGradientProcessing)),this}addEmitRateGradient(H,O,S){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,H,O,S),this}removeEmitRateGradient(H){return this._removeFactorGradient(this._emitRateGradients,H),this}addStartSizeGradient(H,O,S){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,H,O,S),this._syncStartSizeCreation(),this}removeStartSizeGradient(H){return this._removeFactorGradient(this._startSizeGradients,H),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const H=new Uint8Array(4*this._rawTextureWidth),O=G.TmpColors.TO[0];for(let S=0;S<this._rawTextureWidth;S++){const t=S/this._rawTextureWidth;M.GetCurrentGradient(t,this._rampGradients,((t,q,p)=>{G.TO.LerpToRef(t.color,q.color,p,O),H[4*S]=255*O.r,H[4*S+1]=255*O.g,H[4*S+2]=255*O.b,H[4*S+3]=255}))}this._rampGradientsTexture=n.b.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((H,O)=>H.gradient<O.gradient?-1:H.gradient>O.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(H,O){this._rampGradients||(this._rampGradients=[]);const S=new s(H,O);return this._rampGradients.push(S),this._syncRampGradientTexture(),this}removeRampGradient(H){return this._removeGradientAndTexture(H,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(H,O,S){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=pH,this._colorProcessing.process=GH);const t=new I(H,O,S);return this._colorGradients.push(t),this._colorGradients.sort(((H,O)=>H.gradient<O.gradient?-1:H.gradient>O.gradient?1:0)),this}removeColorGradient(H){if(!this._colorGradients)return this;let O=0;for(const S of this._colorGradients){if(S.gradient===H){this._colorGradients.splice(O,1);break}O++}return 0===this._colorGradients.length&&(this._colorCreation.process=qH,this._colorProcessing.process=UH),this}resetDrawCache(){if(this._drawWrappers){for(const H of this._drawWrappers)if(H)for(const O of H)null===O||void 0===O||O.dispose();this._drawWrappers=[]}}_fetchR(H,O,S,t,q){return q[4*(((H=.5*Math.abs(H)+.5)*S%S|0)+((O=.5*Math.abs(O)+.5)*t%t|0)*S)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const H=this._engine,O=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*O),this._vertexBuffer=new D.d(H,this._vertexData,!0,O);let S=0;const t=this._vertexBuffer.createVertexBuffer(D.h.PositionKind,S,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.h.PositionKind]=t,S+=3;const q=this._vertexBuffer.createVertexBuffer(D.h.ColorKind,S,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[D.h.ColorKind]=q,S+=4;const p=this._vertexBuffer.createVertexBuffer("angle",S,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=p,S+=1;const G=this._vertexBuffer.createVertexBuffer("size",S,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=G,S+=2,this._isAnimationSheetEnabled){const H=this._vertexBuffer.createVertexBuffer("cellIndex",S,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=H,S+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const H=this._vertexBuffer.createVertexBuffer("direction",S,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=H,S+=3}if(this._useRampGradients){const H=this._vertexBuffer.createVertexBuffer("remapData",S,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=H,S+=4}let U;if(this._useInstancing){const O=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new D.d(H,O,!1,2),U=this._spriteBuffer.createVertexBuffer("offset",0,2)}else U=this._vertexBuffer.createVertexBuffer("offset",S,2,this._vertexBufferSize,this._useInstancing),S+=2;this._vertexBuffers.offset=U,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const H=[],O=[];let S=0;for(let t=0;t<this._capacity;t++)H.push(S),H.push(S+1),H.push(S+2),H.push(S),H.push(S+2),H.push(S+3),O.push(S,S+1,S+1,S+2,S+2,S+3,S+3,S,S,S+3),S+=4;this._indexBuffer=this._engine.createIndexBuffer(H),this._linesIndexBuffer=this._engine.createIndexBuffer(O)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(H)setTimeout((()=>{this.start(0)}),H);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var O;-1!==(null===(O=this.tO)||void 0===O?void 0:O.getClassName().indexOf("Mesh"))&&this.tO.wU(!0);const H=this.noiseTexture;if(H&&H.onGeneratedObservable)H.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let O=0;O<this.preWarmCycles;O++)this.animate(!0),H.render()}))}));else for(let O=0;O<this.preWarmCycles;O++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(H))}_postStop(H){}reset(){this._stockParticles.length=0,this.ja.length=0}_appendParticleVertex(H,O,S,q){let p=H*this._vertexBufferSize;if(this._vertexData[p++]=O.position.x+this.Gw.x,this._vertexData[p++]=O.position.y+this.Gw.y,this._vertexData[p++]=O.position.z+this.Gw.z,this._vertexData[p++]=O.color.r,this._vertexData[p++]=O.color.g,this._vertexData[p++]=O.color.b,this._vertexData[p++]=O.color.a,this._vertexData[p++]=O.angle,this._vertexData[p++]=O.scale.x*O.size,this._vertexData[p++]=O.scale.y*O.size,this._isAnimationSheetEnabled&&(this._vertexData[p++]=O.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[p++]=O.direction.x,this._vertexData[p++]=O.direction.y,this._vertexData[p++]=O.direction.z);else if(O._initialDirection){let H=O._initialDirection;this.isLocal&&(t.eO.TransformNormalToRef(H,this._emitterWorldMatrix,t.TmpVectors.eO[0]),H=t.TmpVectors.eO[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[p++]=H.x,this._vertexData[p++]=H.y,this._vertexData[p++]=H.z}else{let H=O.direction;this.isLocal&&(t.eO.TransformNormalToRef(H,this._emitterWorldMatrix,t.TmpVectors.eO[0]),H=t.TmpVectors.eO[0]),0===H.x&&0===H.z&&(H.x=.001),this._vertexData[p++]=H.x,this._vertexData[p++]=H.y,this._vertexData[p++]=H.z}this._useRampGradients&&O.remapData&&(this._vertexData[p++]=O.remapData.x,this._vertexData[p++]=O.remapData.y,this._vertexData[p++]=O.remapData.z,this._vertexData[p++]=O.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===S?S=this._epsilon:1===S&&(S=1-this._epsilon),0===q?q=this._epsilon:1===q&&(q=1-this._epsilon)),this._vertexData[p++]=S,this._vertexData[p++]=q)}_prepareParticle(H){}_createNewOnes(H){let O;for(let S=0;S<H&&this.ja.length!==this._capacity;S++){O=this._createParticle(),this.ja.push(O);let H=this._createQueueStart;for(;H;)H.process(O,this),H=H.nextItem;O._inheritParticleInfoToSubEmitters()}}_update(H){if(this._alive=this.ja.length>0,this.tO.position){const H=this.tO;this._emitterWorldMatrix=H.getWorldMatrix()}else{const H=this.tO;this._emitterWorldMatrix=t.Matrix.Translation(H.x,H.y,H.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ja),this._createNewOnes(H)}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=[D.h.PositionKind,D.h.ColorKind,"angle","offset","size"];return H&&t.push("cellIndex"),O||t.push("direction"),S&&t.push("remapData"),t}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,OH.d)(t),H&&t.push("particlesInfos"),O&&t.push("logarithmicDepthConstant"),S&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(H,O){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OH.n)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&H.push("#define FOG")),this._isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),O===V.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&H.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case 2:H.push("#define BILLBOARDY");break;case 8:case 9:H.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&H.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:H.push("#define BILLBOARDMODE_ALL")}S&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,O,S){O.push(...BH._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),H.push(...BH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),S.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,tH.f)(H,this._imageProcessingConfigurationDefines),(0,tH.c)(S,this._imageProcessingConfigurationDefines))}_getWrapper(H){const O=this._getCustomDrawWrapper(H);if(null!==O&&void 0!==O&&O.effect)return O;const S=[];this.fillDefines(S,H);const t=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let q=this._drawWrappers[t];q||(q=this._drawWrappers[t]=[]);let p=q[H];p||(p=new HH.e(this._engine),p.drawContext&&(p.drawContext.useInstancing=this._useInstancing),q[H]=p);const G=S.join("\n");if(p.defines!==G){const H=[],O=[],S=[];this.fillUniformsAttributesAndSamplerNames(O,H,S),p.setEffect(this._engine.createEffect("particles",H,O,S,G,void 0,void 0,void 0,void 0,this._shaderLanguage),G)}return p}animate(){var H;let O,S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!S&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(S?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this.manualEmitCount>-1)O=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let H=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const O=this._actualFrame/this.targetStopDuration;M.GetCurrentGradient(O,this._emitRateGradients,((O,S,t)=>{O!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=S.getFactor(),this._currentEmitRateGradient=O),H=(0,w.Lerp)(this._currentEmitRate1,this._currentEmitRate2,t)}))}O=H*this._scaledUpdateSpeed|0,this._newPartsExcess+=H*this._scaledUpdateSpeed-O}if(this._newPartsExcess>1&&(O+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?O=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(O),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!S){let H=0;for(let O=0;O<this.ja.length;O++){const S=this.ja[O];this._appendParticleVertices(H,S),H+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ja.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(H,O){this._appendParticleVertex(H++,O,0,0),this._useInstancing||(this._appendParticleVertex(H++,O,1,0),this._appendParticleVertex(H++,O,1,1),this._appendParticleVertex(H++,O,0,1))}rebuild(){var H;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(H=this._spriteBuffer)||void 0===H||H._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!BH.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(S.bind(S,12804)),Promise.resolve().then(S.bind(S,12753))])):await Promise.all([Promise.resolve().then(S.bind(S,12747)),Promise.resolve().then(S.bind(S,12737))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.tO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==V.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(V.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(V.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(H){const O=this._getWrapper(H),S=O.effect,q=this._engine;q.enableEffect(O);const p=this.defaultViewMatrix??this._scene.getViewMatrix();if(S.setTexture("diffuseSampler",this.particleTexture),S.setMatrix("view",p),S.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();S.setFloat3("particlesInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,this.spriteCellWidth/H.width)}if(S.setVector2("translationPivot",this.translationPivot),S.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;S.setVector3("eyePosition",H.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),S.setTexture("rampSampler",this._rampGradientsTexture));const G=S.defines;var U,V,w,o,h,a;(this._scene&&((0,OH.g)(S,this,this._scene),this.applyFog&&(0,SH.f)(this._scene,void 0,S)),G.indexOf("#define BILLBOARDMODE_ALL")>=0&&(p.invertToRef(t.TmpVectors.Matrix[0]),S.setMatrix("invView",t.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,S):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,S)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?q.bindBuffers(this._vertexBuffers,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBuffer:this._indexBuffer,S):q.bindBuffers(this._vertexBuffers,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null,S);(this.useLogarithmicDepth&&this._scene&&(0,SH.h)(G,S,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(S),this._setEngineBasedOnBlendMode(H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(S),this._useInstancing)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?q.drawElementsType(6,0,10,this.ja.length):q.drawArraysType(7,0,4,this.ja.length):null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?q.drawElementsType(1,0,10*this.ja.length):q.drawElementsType(0,0,6*this.ja.length);return this.ja.length}render(){if(!this.isReady()||!this.ja.length)return 0;const H=this._engine;H.setState&&(H.setState(!1),this.forceDepthWrite&&H.setDepthWrite(!0));let O=0;return O=this.blendMode===V.BLENDMODE_MULTIPLYADD?this._render(V.BLENDMODE_MULTIPLY)+this._render(V.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),O}_onDispose(){}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(O,S),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const H=this._scene.ha.indexOf(this);H>-1&&this._scene.ha.splice(H,1),this._scene._activeParticleSystems.dispose()}this.up.notifyObservers(this),this.up.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}BH.ForceGLSL=!1;var ZH,IH=S(11169);!function(H){H[H.ATTACHED=0]="ATTACHED",H[H.END=1]="END"}(ZH||(ZH={}));class sH{constructor(H){if(this.particleSystem=H,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!H.tO||!H.tO.dispose){const O=(0,U.e)("BABYLON.AbstractMesh");H.tO=new O("SubemitterSystemEmitter",H.YH()),H._disposeEmitterOnDispose=!0}}clone(){let H=this.particleSystem.tO;if(H){if(H instanceof t.eO)H=H.clone();else if(-1!==H.getClassName().indexOf("Mesh")){H=new((0,U.e)("BABYLON.Mesh"))("",H.YH()),H.isVisible=!1}}else H=new t.eO;const O=new sH(this.particleSystem.clone(this.particleSystem.name,H));return O.particleSystem.name+="Clone",O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem._disposeEmitterOnDispose=!0,O.particleSystem.disposeOnStop=!0,O}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return O.type=this.type,O.inheritDirection=this.inheritDirection,O.inheritedVelocityAmount=this.inheritedVelocityAmount,O.particleSystem=this.particleSystem.serialize(H),O}static _ParseParticleSystem(H,O,S){throw(0,IH.b)("ParseParticle")}static Parse(H,O,S){const t=H.particleSystem,q=new sH(sH._ParseParticleSystem(t,O,S,!0));return q.type=H.type,q.inheritDirection=H.inheritDirection,q.inheritedVelocityAmount=H.inheritedVelocityAmount,q.particleSystem._isSubEmitter=!0,q}dispose(){this.particleSystem.dispose()}}var iH=S(11213);function MH(H,O){const S=new y;return S.direction1=H,S.direction2=O,S}function CH(){return new E(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function nH(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function QH(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.eO(0,1,0),S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0);return new K(H,O,S)}function LH(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function HO(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.eO(0,1,0);return new X(H,O,S,q,p)}function OO(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new a(H,O)}function SO(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0);return new j(H,O,S,q)}const tO=t.eO.Zero(),qO=t.eO.Zero(),pO=t.eO.Zero();class GO{constructor(){this.strength=0,this.position=t.eO.Zero()}_processParticle(H,O){this.position.subtractToRef(H.position,tO);const S=tO.lengthSquared()+1;tO.normalize().scaleToRef(this.strength/S,qO),qO.scaleToRef(O._tempScaledUpdateSpeed,pO),H.direction.addInPlace(pO)}serialize(){return{position:this.position.pU(),strength:this.strength}}}class UO extends BH{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=H=>{if(!this._subEmitters||0===this._subEmitters.length)return;const O=Math.floor(Math.random()*this._subEmitters.length);for(const S of this._subEmitters[O])if(1===S.type){const O=S.clone();H._inheritParticleInfoToSubEmitter(O),O.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(O.particleSystem),O.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(H,O){const S=MH(H,O);return this.particleEmitterType=S,S}get flowMap(){return this._flowMap}set flowMap(H){this._flowMap!==H&&(this._flowMap=H,this._flowMapUpdate&&(RH(this._flowMapUpdate),this._flowMapUpdate=null),H&&(this._flowMapUpdate={process:H=>{var O;const S=null===(O=this.YH())||void 0===O?void 0:O.getTransformMatrix();this._flowMap._processParticle(H,this.flowMapStrength*this._tempScaledUpdateSpeed,S)},previousItem:null,nextItem:null},fH(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(H){this._attractors.push(H),1===this._attractors.length&&(this._attractorUpdate={process:H=>{for(const O of this._attractors)O._processParticle(H,this)},previousItem:null,nextItem:null},fH(this._attractorUpdate,this._directionProcessing))}removeAttractor(H){const O=this._attractors.indexOf(H);-1!==O&&this._attractors.splice(O,1),0===this._attractors.length&&RH(this._attractorUpdate)}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(H)}createHemisphericEmitter(){const H=CH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=nH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=QH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=LH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=HO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=SO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,O,S,t){const q=new h;return this.particleEmitterType=q,this.direction1=H,this.direction2=O,this.minEmitBox=S,this.maxEmitBox=t,q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const H of this.subEmitters)H instanceof UO?this._subEmitters.push([new sH(H)]):H instanceof sH?this._subEmitters.push([H]):H instanceof Array&&this._subEmitters.push(H)}_stopSubEmitters(){if(this.activeSubSystems){for(const H of this.activeSubSystems)H.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const H=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==H&&this._rootParticleSystem.activeSubSystems.splice(H,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(H){H&&this._stopSubEmitters()}_prepareParticle(H){if(this._subEmitters&&this._subEmitters.length>0){const O=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];H._attachedSubEmitters=[];for(const S of O)if(0===S.type){const O=S.clone();H._attachedSubEmitters.push(O),O.particleSystem.start()}}}_onDispose(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),H&&this.particles)for(const S of this.particles)if(S._attachedSubEmitters)for(let H=S._attachedSubEmitters.length-1;H>=0;H-=1)S._attachedSubEmitters[H].dispose();if(O&&this.activeSubSystems)for(let S=this.activeSubSystems.length-1;S>=0;S-=1)this.activeSubSystems[S].dispose();if(this._subEmitters&&this._subEmitters.length){for(let H=0;H<this._subEmitters.length;H++)for(const O of this._subEmitters[H])O.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.tO&&this.tO.dispose&&this.tO.dispose(!0)}static _Parse(H,O,S,q){let p;p=S instanceof iH.b?null:S;const V=(0,U.e)("BABYLON.Texture");if(V&&p&&(H.texture?O.particleTexture=V.Parse(H.texture,p,q):H.textureName&&(O.particleTexture=new V(q+H.textureName,p,!1,void 0===H.invertY||H.invertY),O.particleTexture.name=H.textureName)),H.emitterId||0===H.emitterId||void 0!==H.tO?H.emitterId&&p?O.tO=p.getLastMeshById(H.emitterId):O.tO=t.eO.KO(H.tO):O.tO=t.eO.Zero(),O.isLocal=!!H.isLocal,void 0!==H.renderingGroupId&&(O.renderingGroupId=H.renderingGroupId),void 0!==H.isBillboardBased&&(O.isBillboardBased=H.isBillboardBased),void 0!==H.billboardMode&&(O.billboardMode=H.billboardMode),void 0!==H.useLogarithmicDepth&&(O.useLogarithmicDepth=H.useLogarithmicDepth),H.animations){for(let S=0;S<H.animations.length;S++){const t=H.animations[S],q=(0,U.e)("BABYLON.Animation");q&&O.animations.push(q.Parse(t))}O.beginAnimationOnStart=H.beginAnimationOnStart,O.beginAnimationFrom=H.beginAnimationFrom,O.beginAnimationTo=H.beginAnimationTo,O.beginAnimationLoop=H.beginAnimationLoop}if(H.autoAnimate&&p&&p.beginAnimation(O,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1),O.startDelay=0|H.startDelay,O.minAngularSpeed=H.minAngularSpeed,O.maxAngularSpeed=H.maxAngularSpeed,O.minSize=H.minSize,O.maxSize=H.maxSize,H.minScaleX&&(O.minScaleX=H.minScaleX,O.maxScaleX=H.maxScaleX,O.minScaleY=H.minScaleY,O.maxScaleY=H.maxScaleY),void 0!==H.preWarmCycles&&(O.preWarmCycles=H.preWarmCycles,O.preWarmStepOffset=H.preWarmStepOffset),void 0!==H.minInitialRotation&&(O.minInitialRotation=H.minInitialRotation,O.maxInitialRotation=H.maxInitialRotation),O.minLifeTime=H.minLifeTime,O.maxLifeTime=H.maxLifeTime,O.minEmitPower=H.minEmitPower,O.maxEmitPower=H.maxEmitPower,O.emitRate=H.emitRate,O.gravity=t.eO.KO(H.gravity),H.noiseStrength&&(O.noiseStrength=t.eO.KO(H.noiseStrength)),O.color1=G.EU.KO(H.color1),O.color2=G.EU.KO(H.color2),O.colorDead=G.EU.KO(H.colorDead),O.updateSpeed=H.updateSpeed,O.targetStopDuration=H.targetStopDuration,O.blendMode=H.blendMode,H.colorGradients)for(const t of H.colorGradients)O.addColorGradient(t.gradient,G.EU.KO(t.color1),t.color2?G.EU.KO(t.color2):void 0);if(H.rampGradients){for(const S of H.rampGradients)O.addRampGradient(S.gradient,G.TO.KO(S.color));O.useRampGradients=H.useRampGradients}if(H.colorRemapGradients)for(const t of H.colorRemapGradients)O.addColorRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.alphaRemapGradients)for(const t of H.alphaRemapGradients)O.addAlphaRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.sizeGradients)for(const t of H.sizeGradients)O.addSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.angularSpeedGradients)for(const t of H.angularSpeedGradients)O.addAngularSpeedGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.velocityGradients)for(const t of H.velocityGradients)O.addVelocityGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.dragGradients)for(const t of H.dragGradients)O.addDragGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.emitRateGradients)for(const t of H.emitRateGradients)O.addEmitRateGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.startSizeGradients)for(const t of H.startSizeGradients)O.addStartSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.lifeTimeGradients)for(const t of H.lifeTimeGradients)O.addLifeTimeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(H.limitVelocityGradients){for(const S of H.limitVelocityGradients)O.addLimitVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);O.limitVelocityDamping=H.limitVelocityDamping}if(H.noiseTexture&&p){const S=(0,U.e)("BABYLON.ProceduralTexture");O.noiseTexture=S.Parse(H.noiseTexture,p,q)}let w;if(H.particleEmitterType){switch(H.particleEmitterType.type){case"SphereParticleEmitter":w=new T;break;case"SphereDirectedParticleEmitter":w=new K;break;case"ConeEmitter":case"ConeParticleEmitter":w=new a;break;case"ConeDirectedParticleEmitter":w=new j;break;case"CylinderParticleEmitter":w=new e;break;case"CylinderDirectedParticleEmitter":w=new X;break;case"HemisphericParticleEmitter":w=new E;break;case"PointParticleEmitter":w=new y;break;case"MeshParticleEmitter":w=new F;break;case"CustomParticleEmitter":w=new b;break;default:w=new h}w.parse(H.particleEmitterType,p)}else w=new h,w.parse(H,p);O.particleEmitterType=w,O.startSpriteCellID=H.startSpriteCellID,O.endSpriteCellID=H.endSpriteCellID,O.spriteCellLoop=H.spriteCellLoop??!0,O.spriteCellWidth=H.spriteCellWidth,O.spriteCellHeight=H.spriteCellHeight,O.spriteCellChangeSpeed=H.spriteCellChangeSpeed,O.spriteRandomStartCell=H.spriteRandomStartCell,O.disposeOnStop=H.disposeOnStop??!1,O.manualEmitCount=H.manualEmitCount??-1}static Parse(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const U=H.name;let V,w,o=null,h=null;if(O instanceof iH.b?V=O:(w=O,V=w.getEngine()),H.customShader&&V.createEffectForParticles){h=H.customShader;const O=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"";o=V.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,O)}const a=new UO(U,p||H.wS,O,o,H.isAnimationSheetEnabled);if(a.customShader=h,a._rootUrl=S,H.id&&(a.id=H.id),H.subEmitters){a.subEmitters=[];for(const t of H.subEmitters){const H=[];for(const q of t)H.push(sH.Parse(q,O,S));a.subEmitters.push(H)}}if(H.attractors)for(const G of H.attractors){const H=new GO;H.position=t.eO.KO(G.position),H.strength=G.strength,a.addAttractor(H)}return UO._Parse(H,a,O,S),H.textureMask&&(a.textureMask=G.EU.KO(H.textureMask)),H.Gw&&(a.Gw=t.eO.KO(H.Gw)),H.preventAutoStart&&(a.preventAutoStart=H.preventAutoStart),q||a.preventAutoStart||a.start(),a}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};if(UO._Serialize(O,this,H),O.textureMask=this.textureMask.pU(),O.customShader=this.customShader,O.preventAutoStart=this.preventAutoStart,O.Gw=this.Gw.pU(),this.subEmitters){O.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const S of this._subEmitters){const t=[];for(const O of S)t.push(O.serialize(H));O.subEmitters.push(t)}}if(this._attractors&&this._attractors.length){O.attractors=[];for(const H of this._attractors)O.attractors.push(H.serialize())}return O}static _Serialize(H,O,S){if(H.name=O.name,H.id=O.id,H.wS=O.getCapacity(),H.disposeOnStop=O.disposeOnStop,H.manualEmitCount=O.manualEmitCount,O.tO.position){const S=O.tO;H.emitterId=S.id}else{const S=O.tO;H.tO=S.pU()}O.particleEmitterType&&(H.particleEmitterType=O.particleEmitterType.serialize()),O.particleTexture&&(S?H.texture=O.particleTexture.serialize():(H.textureName=O.particleTexture.name,H.invertY=!!O.particleTexture._invertY)),H.isLocal=O.isLocal,N.e.AppendSerializedAnimations(O,H),H.beginAnimationOnStart=O.beginAnimationOnStart,H.beginAnimationFrom=O.beginAnimationFrom,H.beginAnimationTo=O.beginAnimationTo,H.beginAnimationLoop=O.beginAnimationLoop,H.startDelay=O.startDelay,H.renderingGroupId=O.renderingGroupId,H.isBillboardBased=O.isBillboardBased,H.billboardMode=O.billboardMode,H.minAngularSpeed=O.minAngularSpeed,H.maxAngularSpeed=O.maxAngularSpeed,H.minSize=O.minSize,H.maxSize=O.maxSize,H.minScaleX=O.minScaleX,H.maxScaleX=O.maxScaleX,H.minScaleY=O.minScaleY,H.maxScaleY=O.maxScaleY,H.minEmitPower=O.minEmitPower,H.maxEmitPower=O.maxEmitPower,H.minLifeTime=O.minLifeTime,H.maxLifeTime=O.maxLifeTime,H.emitRate=O.emitRate,H.gravity=O.gravity.pU(),H.noiseStrength=O.noiseStrength.pU(),H.color1=O.color1.pU(),H.color2=O.color2.pU(),H.colorDead=O.colorDead.pU(),H.updateSpeed=O.updateSpeed,H.targetStopDuration=O.targetStopDuration,H.blendMode=O.blendMode,H.preWarmCycles=O.preWarmCycles,H.preWarmStepOffset=O.preWarmStepOffset,H.minInitialRotation=O.minInitialRotation,H.maxInitialRotation=O.maxInitialRotation,H.startSpriteCellID=O.startSpriteCellID,H.spriteCellLoop=O.spriteCellLoop,H.endSpriteCellID=O.endSpriteCellID,H.spriteCellChangeSpeed=O.spriteCellChangeSpeed,H.spriteCellWidth=O.spriteCellWidth,H.spriteCellHeight=O.spriteCellHeight,H.spriteRandomStartCell=O.spriteRandomStartCell,H.isAnimationSheetEnabled=O.isAnimationSheetEnabled,H.useLogarithmicDepth=O.useLogarithmicDepth;const t=O.getColorGradients();if(t){H.colorGradients=[];for(const O of t){const S={gradient:O.gradient,color1:O.color1.pU()};O.color2?S.color2=O.color2.pU():S.color2=O.color1.pU(),H.colorGradients.push(S)}}const q=O.getRampGradients();if(q){H.rampGradients=[];for(const O of q){const S={gradient:O.gradient,color:O.color.pU()};H.rampGradients.push(S)}H.useRampGradients=O.useRampGradients}const p=O.getColorRemapGradients();if(p){H.colorRemapGradients=[];for(const O of p){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.colorRemapGradients.push(S)}}const G=O.getAlphaRemapGradients();if(G){H.alphaRemapGradients=[];for(const O of G){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.alphaRemapGradients.push(S)}}const U=O.getSizeGradients();if(U){H.sizeGradients=[];for(const O of U){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.sizeGradients.push(S)}}const V=O.getAngularSpeedGradients();if(V){H.angularSpeedGradients=[];for(const O of V){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.angularSpeedGradients.push(S)}}const w=O.getVelocityGradients();if(w){H.velocityGradients=[];for(const O of w){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.velocityGradients.push(S)}}const o=O.getDragGradients();if(o){H.dragGradients=[];for(const O of o){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.dragGradients.push(S)}}const h=O.getEmitRateGradients();if(h){H.emitRateGradients=[];for(const O of h){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.emitRateGradients.push(S)}}const a=O.getStartSizeGradients();if(a){H.startSizeGradients=[];for(const O of a){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.startSizeGradients.push(S)}}const j=O.getLifeTimeGradients();if(j){H.lifeTimeGradients=[];for(const O of j){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.lifeTimeGradients.push(S)}}const e=O.getLimitVelocityGradients();if(e){H.limitVelocityGradients=[];for(const O of e){const S={gradient:O.gradient,factor1:O.factor1};void 0!==O.factor2?S.factor2=O.factor2:S.factor2=O.factor1,H.limitVelocityGradients.push(S)}H.limitVelocityDamping=O.limitVelocityDamping}O.noiseTexture&&(H.noiseTexture=O.noiseTexture.serialize())}clone(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let q=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){q=this.customShader;const H=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",O=p.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,H);t[0]?t[0].effect=O:this.setCustomEffect(O,0)}const G=this.serialize(S),U=UO.Parse(G,this._scene||this._engine,this._rootUrl);return U.name=H,U.customShader=q,U._customWrappers=t,void 0===O&&(O=this.tO),this.noiseTexture&&(U.noiseTexture=this.noiseTexture.clone()),U.tO=O,this.preventAutoStart||U.start(),U}}UO.BILLBOARDMODE_Y=2,UO.BILLBOARDMODE_ALL=7,UO.BILLBOARDMODE_STRETCHED=8,UO.BILLBOARDMODE_STRETCHED_LOCAL=9,sH._ParseParticleSystem=UO.Parse;var VO=S(11549),wO=S(11541),oO=S(11436);oO.c.prototype.createTransformFeedback=function(){const H=this._gl.createTransformFeedback();if(!H)throw new Error("Unable to create Transform Feedback");return H},oO.c.prototype.deleteTransformFeedback=function(H){this._gl.deleteTransformFeedback(H)},oO.c.prototype.bindTransformFeedback=function(H){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,H)},oO.c.prototype.beginTransformFeedback=function(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(H?this._gl.POINTS:this._gl.TRIANGLES)},oO.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},oO.c.prototype.setTranformFeedbackVaryings=function(H,O){this._gl.transformFeedbackVaryings(H,O,this._gl.INTERLEAVED_ATTRIBS)},oO.c.prototype.bindTransformFeedbackBuffer=function(H){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H?H.underlyingResource:null)},oO.c.prototype.readTransformFeedbackBuffer=function(H){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,H)};const hO="clipPlaneFragmentDeclaration2",aO="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";l.d.IncludesShadersStore[hO]||(l.d.IncludesShadersStore[hO]=aO);S(12631),S(12639),S(12646),S(12655),S(12662),S(12666),S(12672),S(12680);const jO="gpuRenderParticlesPixelShader",eO="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";l.d.ShadersStore[jO]||(l.d.ShadersStore[jO]=eO);const XO="clipPlaneVertexDeclaration2",EO="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";l.d.IncludesShadersStore[XO]||(l.d.IncludesShadersStore[XO]=EO);S(12688),S(12691),S(12700),S(12702);const yO="gpuRenderParticlesVertexShader",TO="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";l.d.ShadersStore[yO]||(l.d.ShadersStore[yO]=TO);class KO extends V{static get IsSupported(){if(!Q.c.LastCreatedEngine)return!1;const H=Q.c.LastCreatedEngine.getCaps();return H.supportTransformFeedbacks||H.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(H){this._maxActiveParticleCount=Math.min(H,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(H){this.maxActiveParticleCount=H}createPointEmitter(H,O){const S=MH(H,O);return this.particleEmitterType=S,S}createHemisphericEmitter(){const H=CH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createSphereEmitter(){const H=nH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=H,H}createDirectedSphereEmitter(){const H=QH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.eO(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createCylinderEmitter(){const H=LH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=H,H}createDirectedCylinderEmitter(){const H=HO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createConeEmitter(){const H=OO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=H,H}createDirectedConeEmitter(){const H=SO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.eO(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.eO(0,1,0));return this.particleEmitterType=H,H}createBoxEmitter(H,O,S,t){const q=new h;return this.particleEmitterType=q,this.direction1=H,this.direction2=O,this.minEmitBox=S,this.maxEmitBox=t,q}get flowMap(){return this._flowMap}set flowMap(H){this._flowMap!==H&&(this._flowMap=H)}isReady(){if(!this.tO||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==UO.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(UO.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(UO.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";H?setTimeout((()=>{this.start(0)}),H):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var H;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(H=this._customWrappers[O])||void 0===H?void 0:H.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[H]??this._customWrappers[0]}setCustomEffect(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[O]=new HH.e(this._engine),this._customWrappers[O].effect=H}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(H,O,S){return super._removeGradientAndTexture(H,O,S),this._releaseBuffers(),this}addColorGradient(H,O){this._colorGradients||(this._colorGradients=[]);const S=new I(H,O);return this._colorGradients.push(S),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(H&&this._colorGradients.sort(((H,O)=>H.gradient<O.gradient?-1:H.gradient>O.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(H){return this._removeGradientAndTexture(H,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const O in this._drawWrappers){var H;null===(H=this._drawWrappers[O].drawContext)||void 0===H||H.reset()}}_addFactorGradient(H,O,S){const t=new i(O,S);H.push(t),this._releaseBuffers()}addSizeGradient(H,O){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,H,O),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(H){return this._removeGradientAndTexture(H,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(H,O){if(!H)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&H.sort(((H,O)=>H.gradient<O.gradient?-1:H.gradient>O.gradient?1:0));const S=this;S[O]&&(S[O].dispose(),S[O]=null)}addAngularSpeedGradient(H,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,H,O),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(H){return this._removeGradientAndTexture(H,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(H,O){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,H,O),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(H){return this._removeGradientAndTexture(H,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(H,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,H,O),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(H){return this._removeGradientAndTexture(H,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(H,O){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,H,O),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(H){return this._removeGradientAndTexture(H,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(H){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(H),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.up=new C.b,this.onStoppedObservable=new C.b,this.onStartedObservable=new C.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,S&&"Scene"!==S.getClassName()?(this._engine=S,this.defaultProjectionMatrix=t.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=S||Q.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.ha.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,U.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,U.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,U.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,U.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new HH.e(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers={0:new HH.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(O=O??{}).randomTextureSize||delete O.randomTextureSize;const G={wS:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...O},V=O;isFinite(V)&&(G.wS=V),this._capacity=G.wS,this._maxActiveParticleCount=G.wS,this._currentActiveCount=0,this._isAnimationSheetEnabled=p,this.particleEmitterType=new h;const w=Math.min(this._engine.getCaps().maxTextureSize,G.randomTextureSize);let o=[];for(let t=0;t<w;++t)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture=new n.b(new Float32Array(o),w,1,5,S,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,o=[];for(let t=0;t<w;++t)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture2=new n.b(new Float32Array(o),w,1,5,S,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=w}_reset(){this._releaseBuffers()}_createVertexBuffers(H,O,S){const t={};t.position=O.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let q=3;t.age=O.createVertexBuffer("age",q,1,this._attributesStrideSize,!0),q+=1,t.size=O.createVertexBuffer("size",q,3,this._attributesStrideSize,!0),q+=3,t.life=O.createVertexBuffer("life",q,1,this._attributesStrideSize,!0),q+=1,q+=4,this.billboardMode===UO.BILLBOARDMODE_STRETCHED&&(t.direction=O.createVertexBuffer("direction",q,3,this._attributesStrideSize,!0)),q+=3,this._platform.alignDataInBuffer&&(q+=1),this.particleEmitterType instanceof b&&(q+=3,this._platform.alignDataInBuffer&&(q+=1)),this._colorGradientsTexture||(t.color=O.createVertexBuffer("color",q,4,this._attributesStrideSize,!0),q+=4),this._isBillboardBased||(t.initialDirection=O.createVertexBuffer("initialDirection",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),this.noiseTexture&&(t.noiseCoordinates1=O.createVertexBuffer("noiseCoordinates1",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1),t.noiseCoordinates2=O.createVertexBuffer("noiseCoordinates2",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),t.angle=O.createVertexBuffer("angle",q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?q++:q+=2,this._isAnimationSheetEnabled&&(t.cellIndex=O.createVertexBuffer("cellIndex",q,1,this._attributesStrideSize,!0),q+=1,this.spriteRandomStartCell&&(t.cellStartOffset=O.createVertexBuffer("cellStartOffset",q,1,this._attributesStrideSize,!0),q+=1)),t.offset=S.createVertexBuffer("offset",0,2),t.uv=S.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(t),this._platform.createVertexBuffers(H,t),this.resetDrawCache()}_initialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!H)return;const O=this._engine,S=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof b&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const q=this.particleEmitterType instanceof b,p=t.TmpVectors.eO[0];let G=0;for(let t=0;t<this._capacity;t++)if(S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(0),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),q?(this.particleEmitterType.particleDestinationGenerator(t,null,p),S.push(p.x),S.push(p.y),S.push(p.z)):(S.push(0),S.push(0),S.push(0)),this._platform.alignDataInBuffer&&S.push(0),G+=16,q&&(this.particleEmitterType.particlePositionGenerator(t,null,p),S.push(p.x),S.push(p.y),S.push(p.z),this._platform.alignDataInBuffer&&S.push(0),G+=4),this._colorGradientsTexture||(S.push(0),S.push(0),S.push(0),S.push(0),G+=4),this.isBillboardBased||(S.push(0),S.push(0),S.push(0),this._platform.alignDataInBuffer&&S.push(0),G+=4),this.noiseTexture&&(S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),this._platform.alignDataInBuffer&&S.push(0),S.push(Math.random()),S.push(Math.random()),S.push(Math.random()),this._platform.alignDataInBuffer&&S.push(0),G+=8),S.push(0),G+=1,this._angularSpeedGradientsTexture||(S.push(0),G+=1),this._isAnimationSheetEnabled&&(S.push(0),G+=1,this.spriteRandomStartCell&&(S.push(0),G+=1)),this._platform.alignDataInBuffer){let H=3-(G+3&3);for(G+=H;H-- >0;)S.push(0)}const U=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),V=this._platform.createParticleBuffer(S),w=this._platform.createParticleBuffer(S);this._buffer0=new D.d(O,V,!1,this._attributesStrideSize),this._buffer1=new D.d(O,w,!1,this._attributesStrideSize),this._spriteBuffer=new D.d(O,U,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let H=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(H+="\n#define BILLBOARD"),this._colorGradientsTexture&&(H+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(H+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(H+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(H+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(H+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(H+="\n#define DRAGGRADIENTS"),this._flowMap&&(H+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(H+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(H+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(H+="\n#define NOISE"),this.isLocal&&(H+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===H||(this._cachedUpdateDefines=H,this._updateBuffer=this._platform.createUpdateBuffer(H)),this._platform.isUpdateBufferReady()}_getWrapper(H){const O=this._getCustomDrawWrapper(H);if(null!==O&&void 0!==O&&O.effect)return O;const S=[];this.fillDefines(S,H);let t=this._drawWrappers[H];t||(t=new HH.e(this._engine),t.drawContext&&(t.drawContext.useInstancing=!0),this._drawWrappers[H]=t);const q=S.join("\n");if(t.defines!==q){const H=[],O=[],S=[];this.fillUniformsAttributesAndSamplerNames(O,H,S),t.setEffect(this._engine.createEffect("gpuRenderParticles",H,O,S,q),q)}return t}static _GetAttributeNamesOrOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=[D.h.PositionKind,"age","life","size","angle"];return H||q.push(D.h.ColorKind),O&&q.push("cellIndex"),S||q.push("initialDirection"),t&&q.push("direction"),q.push("offset",D.h.UVKind),q}static _GetEffectCreationOptions(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["emitterWM","Gw","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,OH.d)(t),H&&t.push("sheetInfos"),O&&t.push("logarithmicDepthConstant"),S&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OH.n)(this,this._scene,H),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==wO.e.FOGMODE_NONE&&H.push("#define FOG")),O===UO.BLENDMODE_MULTIPLY&&H.push("#define BLENDMULTIPLYMODE"),this.isLocal&&H.push("#define LOCAL"),this.useLogarithmicDepth&&H.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(H.push("#define BILLBOARD"),this.billboardMode){case UO.BILLBOARDMODE_Y:H.push("#define BILLBOARDY");break;case UO.BILLBOARDMODE_STRETCHED:H.push("#define BILLBOARDSTRETCHED");break;case UO.BILLBOARDMODE_ALL:H.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&H.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&H.push("#define ANIMATESHEET"),S&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),H.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(H,O,S){O.push(...KO._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===UO.BILLBOARDMODE_STRETCHED)),H.push(...KO._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),S.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(VO.b.PrepareUniforms(H,this._imageProcessingConfigurationDefines),VO.b.PrepareSamplers(S,this._imageProcessingConfigurationDefines))}animate(){var H;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(O?this.preWarmStepOffset:(null===(H=this._scene)||void 0===H?void 0:H.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(H,O){const S=this[O];if(!H||!H.length||S)return;const t=new Float32Array(this._rawTextureWidth);for(let q=0;q<this._rawTextureWidth;q++){const O=q/this._rawTextureWidth;M.GetCurrentGradient(O,H,((H,O,S)=>{t[q]=(0,w.Lerp)(H.factor1,O.factor1,S)}))}this[O]=n.b.CreateRTexture(t,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[O].name=O.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const H=new Uint8Array(4*this._rawTextureWidth),O=G.TmpColors.EU[0];for(let S=0;S<this._rawTextureWidth;S++){const t=S/this._rawTextureWidth;M.GetCurrentGradient(t,this._colorGradients,((t,q,p)=>{G.EU.LerpToRef(t.color1,q.color1,p,O),H[4*S]=255*O.r,H[4*S+1]=255*O.g,H[4*S+2]=255*O.b,H[4*S+3]=255*O.a}))}this._colorGradientsTexture=n.b.CreateRGBATexture(H,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(H,O){var S,q,p,G;const U=this._getWrapper(H),V=U.effect;this._engine.enableEffect(U);const w=(null===(S=this._scene)||void 0===S?void 0:S.getViewMatrix())||t.Matrix.IdentityReadOnly;if(V.setMatrix("view",w),V.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),V.setTexture("diffuseSampler",this.particleTexture),V.setVector2("translationPivot",this.translationPivot),V.setVector3("Gw",this.Gw),this.isLocal&&V.setMatrix("emitterWM",O),this._colorGradientsTexture?V.setTexture("colorGradientSampler",this._colorGradientsTexture):V.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const H=this.particleTexture.getBaseSize();V.setFloat3("sheetInfos",this.spriteCellWidth/H.width,this.spriteCellHeight/H.height,H.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const H=this._scene.activeCamera;V.setVector3("eyePosition",H.globalPosition)}const o=V.defines;if(this._scene&&((0,OH.g)(V,this,this._scene),this.applyFog&&(0,SH.f)(this._scene,void 0,V)),o.indexOf("#define BILLBOARDMODE_ALL")>=0){const H=w.clone();H.invert(),V.setMatrix("invView",H)}return this.useLogarithmicDepth&&this._scene&&(0,SH.h)(o,V,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(V),this._setEngineBasedOnBlendMode(H),this._platform.bindDrawBuffers(this._targetIndex,V,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(V),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(H){if(!this.tO||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!H)if(this.tO.position){H=this.tO.getWorldMatrix()}else{const O=this.tO;H=t.TmpVectors.Matrix[0],t.Matrix.TranslationToRef(O.x,O.y,O.z,H)}const O=this._engine,S=O.getDepthWrite();if(O.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const H=this.YH();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",H.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",H),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,O.setDepthWrite(S)}render(){let H,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!O&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const H=0|this._accumulatedCount;this._accumulatedCount-=H,this._currentActiveCount+=H}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.tO.position){H=this.tO.getWorldMatrix()}else{const O=this.tO;H=t.TmpVectors.Matrix[0],t.Matrix.TranslationToRef(O.x,O.y,O.z,H)}const q=this._engine;this.updateInAnimate||this._update(H);let p=0;return O||S||(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0),p=this.blendMode===UO.BLENDMODE_MULTIPLYADD?this._render(UO.BLENDMODE_MULTIPLY,H)+this._render(UO.BLENDMODE_ADD,H):this._render(this.blendMode,H),this._engine.setAlphaMode(0)),p}rebuild(){const H=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(H,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,H()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const O in this._drawWrappers){this._drawWrappers[O].dispose()}if(this._drawWrappers={},this._scene){const H=this._scene.ha.indexOf(this);H>-1&&this._scene.ha.splice(H,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let O=0;O<this._renderVertexBuffers.length;++O){const H=this._renderVertexBuffers[O];for(const O in H)H[O].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),H&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),H&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.up.notifyObservers(this),this.up.clear()}clone(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let q=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){q=this.customShader;const H=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";t[0]=p.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,H,void 0,void 0,void 0,this)}const G=this.serialize(S),U=KO.Parse(G,this._scene||this._engine,this._rootUrl);return U.name=H,U.customShader=q,U._customWrappers=t,void 0===O&&(O=this.tO),this.noiseTexture&&(U.noiseTexture=this.noiseTexture.clone()),U.tO=O,U}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={};return UO._Serialize(O,this,H),O.activeParticleCount=this.activeParticleCount,O.randomTextureSize=this._randomTextureSize,O.customShader=this.customShader,O}static Parse(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const p=H.name;let G,U;O instanceof iH.b?G=O:(U=O,G=U.getEngine());const V=new KO(p,{wS:q||H.wS,randomTextureSize:H.randomTextureSize},O,null,H.isAnimationSheetEnabled);if(V._rootUrl=S,H.customShader&&G.createEffectForParticles){const O=H.customShader,S=O.shaderOptions.defines.length>0?O.shaderOptions.defines.join("\n"):"",t=G.createEffectForParticles(O.shaderPath.fragmentElement,O.shaderOptions.uniforms,O.shaderOptions.samplers,S,void 0,void 0,void 0,V);V.setCustomEffect(t,0),V.customShader=O}return H.id&&(V.id=H.id),H.activeParticleCount&&(V.activeParticleCount=H.activeParticleCount),UO._Parse(H,V,O,S),H.preventAutoStart&&(V.preventAutoStart=H.preventAutoStart),t||V.preventAutoStart||V.start(),V}}var bO=S(11131),DO=S(12708),FO=S(11675);class YO{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(H){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const O of this.systems)O.tO=H;this._emitterNode=H}setEmitterAsSphere(H,O,S){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:H,renderingGroupId:O};const t=(0,DO.c)("emitterSphere",{diameter:H.diameter,segments:H.segments},S);t.renderingGroupId=O;const q=new FO.yO("emitterSphereMaterial",S);q.emissiveColor=H.color,t.material=q;for(const p of this.systems)p.tO=t;this._emitterNode=t}start(H){for(const O of this.systems)H&&(O.tO=H),O.start()}dispose(){for(const H of this.systems)H.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O={systems:[]};for(const S of this.systems)O.systems.push(S.serialize(H));return this._emitterNode&&(O.tO=this._emitterCreationOptions),O}static Parse(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;const q=new YO,p=this.BaseAssetsUrl+"/textures/";O=O||Q.c.LastCreatedScene;for(const G of H.systems)q.systems.push(S?KO.Parse(G,O,p,!0,t):UO.Parse(G,O,p,!0,t));if(H.tO){const S=H.tO.options;if("Sphere"===H.tO.kind)q.setEmitterAsSphere({diameter:S.diameter,segments:S.segments,color:G.TO.KO(S.color)},H.tO.renderingGroupId,O)}return q}}YO.BaseAssetsUrl="https://assets.babylonjs.com/particles";var lO=S(11175);class dO{static CreateDefault(H){let O,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,t=arguments.length>2?arguments[2]:void 0;O=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new KO("default system",{wS:S},t):new UO("default system",S,t),O.tO=H;const q=bO.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return O.particleTexture=new x.b(q,O.YH()),O.createConeEmitter(.1,Math.PI/4),O.color1=new G.EU(1,1,1,1),O.color2=new G.EU(1,1,1,1),O.colorDead=new G.EU(1,1,1,0),O.minSize=.1,O.maxSize=.1,O.minEmitPower=2,O.maxEmitPower=2,O.updateSpeed=1/60,O.emitRate=30,O}static CreateAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;O||(O=Q.c.LastCreatedScene);const q={};return O.addPendingData(q),new Promise(((p,G)=>{if(S&&!KO.IsSupported)return O.removePendingData(q),G("Particle system with GPU is not supported.");bO.Tools.LoadFile(`${dO.BaseAssetsUrl}/systems/${H}.json`,(H=>{O.removePendingData(q);const G=JSON.parse(H.toString());return p(YO.Parse(G,O,S,t))}),void 0,void 0,void 0,(()=>(O.removePendingData(q),G(`An error occurred with the creation of your particle system. Check if your type '${H}' exists.`))))}))}static ExportSet(H){const O=new YO;for(const S of H)O.systems.push(S);return O}static ParseFromFileAsync(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",p=arguments.length>5?arguments[5]:void 0;return new Promise(((G,U)=>{const V=new lO.c;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const O=JSON.parse(V.responseText);let U;U=t?KO.Parse(O,S,q,!1,p):UO.Parse(O,S,q,!1,p),H&&(U.name=H),G(U)}else U("Unable to load the particle system")})),V.open("GET",O),V.send()}))}static ParseFromSnippetAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===H){const H=this.CreateDefault(null);return H.start(),Promise.resolve(H)}return new Promise(((p,G)=>{const U=new lO.c;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const G=JSON.parse(JSON.parse(U.responseText).jsonPayload),V=JSON.parse(G.particleSystem);let w;w=S?KO.Parse(V,O,t,!1,q):UO.Parse(V,O,t,!1,q),w.snippetId=H,p(w)}else G("Unable to load the snippet "+H)})),U.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),U.send()}))}}dO.BaseAssetsUrl=YO.BaseAssetsUrl,dO.SnippetUrl="https://snippet.babylonjs.com",dO.CreateFromSnippetAsync=dO.ParseFromSnippetAsync;var vO=S(11757),zO=S(11582),mO=S(12713);(0,mO.e)(zO.e.NAME_PARTICLESYSTEM,((H,O,S,t)=>{const q=(0,mO.i)(zO.e.NAME_PARTICLESYSTEM);if(q&&void 0!==H.ha&&null!==H.ha)for(let p=0,G=H.ha.length;p<G;p++){const G=H.ha[p];S.ha.push(q(G,O,t))}})),(0,mO.c)(zO.e.NAME_PARTICLESYSTEM,((H,O,S)=>{if(H.activeParticleCount){return KO.Parse(H,O,S)}return UO.Parse(H,O,S)})),iH.b.prototype.createEffectForParticles=function(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0,V=arguments.length>7?arguments[7]:void 0,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,o=arguments.length>9?arguments[9]:void 0,h=[],a=[];const j=[];return V?V.fillUniformsAttributesAndSamplerNames(a,h,j):(h=UO._GetAttributeNamesOrOptions(),a=UO._GetEffectCreationOptions()),-1===q.indexOf(" BILLBOARD")&&(q+="\n#define BILLBOARD\n"),null!==V&&void 0!==V&&V.isAnimationSheetEnabled&&-1===q.indexOf(" ANIMATESHEET")&&(q+="\n#define ANIMATESHEET\n"),-1===t.indexOf("diffuseSampler")&&t.push("diffuseSampler"),this.createEffect({vertex:o??(null===V||void 0===V?void 0:V.vertexShaderName)??"particles",fragmentElement:H},h,a.concat(O),j.concat(t),q,p,G,U,void 0,w,(async()=>{0===w?await Promise.resolve().then(S.bind(S,12747)):await Promise.resolve().then(S.bind(S,12804))}))},vO.d.prototype.getEmittedParticleSystems=function(){const H=[];for(let O=0;O<this.YH().ha.length;O++){const S=this.YH().ha[O];S.tO===this&&H.push(S)}return H},vO.d.prototype.getHierarchyEmittedParticleSystems=function(){const H=[],O=this.getDescendants();O.push(this);for(let S=0;S<this.YH().ha.length;S++){const t=this.YH().ha[S],q=t.tO;q.position&&-1!==O.indexOf(q)&&H.push(t)}return H};S(11644),S(11658),S(11734);S(11736),S(12722),S(11515),S(11633),S(11776);S(11511);var rO;S(12726),S(11322);!function(H){H[H.Color=2]="Color",H[H.UV=1]="UV",H[H.Random=0]="Random",H[H.Stated=3]="Stated"}(rO||(rO={}));var WO=S(11534);const gO=new t.eO(0,0,0),NO=new t.eO(0,0,0),xO=new t.eO(0,0,0);class kO{constructor(H,O,S){this.width=H,this.height=O,this.data=S}processFlowable(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;if(!S)return;S instanceof t.Matrix?t.eO.TransformCoordinatesToRef(H.position,S,xO):(xO.x=S.x,xO.y=S.y,xO.z=S.z);const q=.5*xO.x+.5,p=1-(.5*xO.y+.5),G=Math.floor(q*this.width),U=Math.floor(p*this.height);if(G<0||G>=this.width||U<0||U>=this.height)return;const V=4*(U*this.width+G),w=this.data[V]/255*2-1,o=this.data[V+1]/255*2-1,h=this.data[V+2]/255*2-1,a=this.data[V+3]/255;gO.set(w,o,h),gO.scaleToRef(O*a,NO),H.direction.addInPlace(NO)}_processParticle(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,S=arguments.length>2?arguments[2]:void 0;this.processFlowable(H,O,S)}static async FromUrlAsync(H){return await new Promise(((O,S)=>{const t=document.createElement("canvas"),q=t.getContext("2d");let p=null;const G=new Image;G.crossOrigin="anonymous",G.src=H,G.onerror=O=>{S(new Error(`Failed to load image: ${H} : ${O}`))},G.onload=()=>{t.width=G.width,t.height=G.height,q.drawImage(G,0,0),p=q.getImageData(0,0,t.width,t.height),O(new kO(t.width,t.height,p.data))}}))}static async ExtractFromTextureAsync(H){return await new Promise(((O,S)=>{if(!H.isReady())return void H.onLoadObservable.addOnce((async()=>{try{const S=await this.ExtractFromTextureAsync(H);O(S)}catch(t){S(t)}}));const t=H.getSize();WO.l.GetTextureDataAsync(H,t.width,t.height).then((H=>{O(new kO(t.width,t.height,new Uint8ClampedArray(H)))})).catch(S)}))}}var AO,uO,JO,PO,fO,cO,RO,BO,ZO;!function(H){H[H.Int=1]="Int",H[H.Float=2]="Float",H[H.Vector2=4]="Vector2",H[H.eO=8]="eO",H[H.Matrix=16]="Matrix",H[H.Particle=32]="Particle",H[H.Texture=64]="Texture",H[H.EU=128]="EU",H[H.FloatGradient=256]="FloatGradient",H[H.Vector2Gradient=512]="Vector2Gradient",H[H.Vector3Gradient=1024]="Vector3Gradient",H[H.Color4Gradient=2048]="Color4Gradient",H[H.System=4096]="System",H[H.AutoDetect=8192]="AutoDetect",H[H.BasedOnInput=16384]="BasedOnInput",H[H.Undefined=32768]="Undefined",H[H.All=65535]="All"}(AO||(AO={})),function(H){H[H.Compatible=0]="Compatible",H[H.TypeIncompatible=1]="TypeIncompatible",H[H.HierarchyIssue=2]="HierarchyIssue"}(uO||(uO={})),function(H){H[H.Input=0]="Input",H[H.Output=1]="Output"}(JO||(JO={}));class IO{get direction(){return this._direction}get type(){if(this._type===AO.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===AO.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(H){this._type=H}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((H=>H.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(H,O,S){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=AO.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new C.b,this.onDisconnectionObservable=new C.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=O,this.name=H,this._direction=S}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(H){var O;return this.isConnected?null!==(O=this._connectedPoint)&&void 0!==O&&O._storedFunction?this._connectedPoint._storedFunction(H):this._connectedPoint._storedValue:this.value}canConnectTo(H){return 0===this.checkCompatibilityState(H)}checkCompatibilityState(H){const O=this._ownerBlock,S=H.ownerBlock;if(this.type!==H.type&&H.innerType!==AO.AutoDetect)return H.acceptedConnectionPointTypes&&-1!==H.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(H.excludedConnectionPointTypes&&-1!==H.excludedConnectionPointTypes.indexOf(this.type))return 1;let t=S,q=O;return 0===this.direction&&(t=O,q=S),t.isAnAncestorOf(q)?2:0}connectTo(H){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(H))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${H.ownerBlock.name}".${H.name}`;return this._endpoints.push(H),H._connectedPoint=this,this.onConnectionObservable.notifyObservers(H),H.onConnectionObservable.notifyObservers(this),this}disconnectFrom(H){const O=this._endpoints.indexOf(H);return-1===O||(this._endpoints.splice(O,1),H._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(H),H.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(H){let O=1;for(;O<AO.All;)H&O||this.excludedConnectionPointTypes.push(O),O<<=1}serialize(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const O={};return O.name=this.name,O.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.pU?(O.valueType="BABYLON."+this.value.getClassName(),O.value=this.value.pU()):(O.valueType="number",O.value=this.value)),H&&this.connectedPoint&&(O.inputName=this.name,O.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,O.targetConnectionName=this.connectedPoint.name,O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(O.isExposedOnFrame=!0,O.exposedPortPosition=this.exposedPortPosition),O}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class sO{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(H){this._name=H}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(H){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new C.b,this.up=new C.b,this.onInputChangedObservable=new C.b,this.visibleOnFrame=!1,this._name=H,this.uniqueId=k.c.UniqueId}_inputRename(H){return H}_outputRename(H){return H}isAnAncestorOf(H){for(const O of this._outputs)if(O.hasEndpoints)for(const S of O.endpoints){if(S.ownerBlock===H)return!0;if(S.ownerBlock.isAnAncestorOf(H))return!0}return!1}isAnAncestorOfType(H){if(this.getClassName()===H)return!0;for(const O of this._outputs)if(O.hasEndpoints)for(const S of O.endpoints)if(S.ownerBlock.isAnAncestorOfType(H))return!0;return!1}getInputByName(H){const O=this._inputs.filter((O=>O.name===H));return O.length?O[0]:null}_linkConnectionTypes(H,O){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[O]._acceptedConnectionPointType=this._inputs[H]:(this._inputs[H]._linkedConnectionSource=this._inputs[O],this._inputs[H]._isMainLinkSource=!0),this._inputs[O]._linkedConnectionSource=this._inputs[H]}registerInput(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const G=new IO(H,this,0);return G.type=O,G.isOptional=S,G.defaultValue=t,G.value=t,G.valueMin=q,G.valueMax=p,this._inputs.push(G),this.onInputChangedObservable.notifyObservers(G),this}registerOutput(H,O,S){return(S=S??new IO(H,this,1)).type=O,this._outputs.push(S),this}_build(H){}_customBuildStep(H){}build(H){if(this._buildId===H.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((H=>H.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=H.buildId;for(const O of this._inputs){if(!O.connectedPoint){O.isOptional||H.notConnectedNonOptionalInputs.push(O);continue}const S=O.connectedPoint.ownerBlock;S&&S!==this&&!S.isSystem&&S.build(H)}return this._customBuildStep(H),H.verbose&&A.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(H),this.onBuildObservable.notifyObservers(this),!1}serialize(){const H={};H.customType="BABYLON."+this.getClassName(),H.id=this.uniqueId,H.name=this.name,H.visibleOnFrame=this.visibleOnFrame,H.inputs=[],H.outputs=[];for(const O of this.inputs)H.inputs.push(O.serialize());for(const O of this.outputs)H.outputs.push(O.serialize(!1));return H}_deserialize(H){this._name=H.name,this.comments=H.comments,this.visibleOnFrame=!!H.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(H)}_deserializePortDisplayNamesAndExposedOnFrame(H){const O=H.inputs,S=H.outputs;if(O)for(const t of O){const H=this.inputs.find((H=>H.name===t.name));if(!H)return;if(t.displayName&&(H.displayName=t.displayName),t.isExposedOnFrame&&(H.isExposedOnFrame=t.isExposedOnFrame,H.exposedPortPosition=t.exposedPortPosition),void 0!==t.value&&null!==t.value)if("number"===t.valueType)H.value=t.value;else{const O=(0,U.e)(t.valueType);O&&(H.value=O.KO(t.value))}}if(S)for(let t=0;t<S.length;t++){const H=S[t];H.displayName&&(this.outputs[t].displayName=H.displayName),H.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=H.isExposedOnFrame,this.outputs[t].exposedPortPosition=H.exposedPortPosition)}}clone(){const H=this.serialize(),O=(0,U.e)(H.customType);if(O){const S=new O;return S._deserialize(H),S}return null}dispose(){this.up.notifyObservers(this),this.up.clear();for(const H of this.inputs)H.dispose();for(const H of this.outputs)H.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function iO(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",t=arguments.length>3?arguments[3]:void 0;return(q,p)=>{let G=q._propStore;G||(G=[],q._propStore=G),G.push({propertyName:p,displayName:H,type:O,groupName:S,options:t??{},className:q.getClassName()})}}(0,W.d)([(0,g.J)("comment")],sO.prototype,"comments",void 0),function(H){H[H.Boolean=0]="Boolean",H[H.Float=1]="Float",H[H.Int=2]="Int",H[H.Vector2=3]="Vector2",H[H.List=4]="List",H[H.EU=5]="EU",H[H.SamplingMode=6]="SamplingMode",H[H.TextureFormat=7]="TextureFormat",H[H.TextureType=8]="TextureType"}(PO||(PO={})),function(H){H[H.None=0]="None",H[H.Position=1]="Position",H[H.Direction=2]="Direction",H[H.Age=3]="Age",H[H.Lifetime=4]="Lifetime",H[H.Color=5]="Color",H[H.ScaledDirection=6]="ScaledDirection",H[H.Scale=7]="Scale",H[H.AgeGradient=8]="AgeGradient",H[H.Angle=9]="Angle",H[H.SpriteCellIndex=16]="SpriteCellIndex",H[H.SpriteCellStart=17]="SpriteCellStart",H[H.SpriteCellEnd=18]="SpriteCellEnd"}(fO||(fO={})),function(H){H[H.None=0]="None",H[H.Time=1]="Time",H[H.Delta=2]="Delta",H[H.Emitter=3]="Emitter"}(cO||(cO={}));class MO{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let H="";for(const O of this.notConnectedNonOptionalInputs)H+=`input ${O.name} from block ${O.ownerBlock.name}[${O.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(H)throw"Build of Node Particle System Set failed:\n"+H}adapt(H,O){const S=H.getConnectedValue(this)||0;if(H.type===O)return S;switch(O){case AO.Vector2:return new t.Vector2(S,S);case AO.eO:return new t.eO(S,S,S);case AO.EU:return new G.EU(S,S,S,S)}return null}getContextualValue(H){if(!this.particleContext||!this.systemContext)return null;switch(H){case fO.Position:return this.particleContext.position;case fO.Direction:return this.particleContext.direction;case fO.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case fO.Color:return this.particleContext.color;case fO.Age:return this.particleContext.age;case fO.Lifetime:return this.particleContext.lifeTime;case fO.Angle:return this.particleContext.angle;case fO.Scale:return this.particleContext.scale;case fO.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case fO.SpriteCellEnd:return this.systemContext.endSpriteCellID;case fO.SpriteCellIndex:return this.particleContext.cellIndex;case fO.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.tO.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.tO.absolutePosition:this.systemContext.tO:null}getSystemValue(H){if(!this.particleContext||!this.systemContext)return null;switch(H){case cO.Time:return this.systemContext._actualFrame;case cO.Delta:return this.systemContext._scaledUpdateSpeed;case cO.Emitter:if(this.isEmitterTransformNode){return this.systemContext.tO.absolutePosition}return this.systemContext.tO}return null}}function CO(H,O,S){const t=new MO;t.EO=O;const q=H.createSystem(t);return q.canStart=()=>!0,q.tO=S.clone(),q.disposeOnStop=!0,q.start(),q}class nO extends sO{constructor(H){super(H),this.blendMode=V.BLENDMODE_ONEONE,this.wS=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",AO.Particle),this.registerInput("texture",AO.Texture),this.registerInput("onStart",AO.System,!0),this.registerInput("onEnd",AO.System,!0),this.registerOutput("system",AO.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(H){H.wS=this.wS,H.buildId=this._buildId++,this.build(H);const O=this.particle.getConnectedValue(H);return O.particleTexture=this.texture.getConnectedValue(H),O.emitRate=this.emitRate,O.blendMode=this.blendMode,O.name=this.name,O._nodeGenerated=!0,O._targetStopDuration=this.targetStopDuration,O.startDelay=this.startDelay,this.system._storedValue=this,O.canStart=()=>!this.doNoStart,O.onStartedObservable.add((S=>{const t=this.onStart.getConnectedValue(H);t&&S.onStartedObservable.addOnce((()=>{H.systemContext=O;const S=CO(t,H.EO,H.emitterPosition);this.up.addOnce((()=>{S.dispose()}))}));const q=this.onEnd.getConnectedValue(H);q&&S.onStoppedObservable.addOnce((()=>{H.systemContext=O;const S=CO(q,H.EO,H.emitterPosition);this.up.addOnce((()=>{S.dispose()}))}))})),this.up.addOnce((()=>{O.dispose()})),O}serialize(){const H=super.serialize();return H.wS=this.wS,H.emitRate=this.emitRate,H.blendMode=this.blendMode,H.doNoStart=this.doNoStart,H.targetStopDuration=this.targetStopDuration,H.startDelay=this.startDelay,H}_deserialize(H){super._deserialize(H),this.wS=H.wS,this.emitRate=H.emitRate,this.doNoStart=!!H.doNoStart,void 0!==H.blendMode&&(this.blendMode=H.blendMode),void 0!==H.targetStopDuration&&(this.targetStopDuration=H.targetStopDuration),void 0!==H.startDelay&&(this.startDelay=H.startDelay)}}(0,W.d)([iO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:V.BLENDMODE_ONEONE},{label:"Standard",value:V.BLENDMODE_STANDARD},{label:"Add",value:V.BLENDMODE_ADD},{label:"Multiply",value:V.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:V.BLENDMODE_MULTIPLYADD}]})],nO.prototype,"blendMode",void 0),(0,W.d)([iO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],nO.prototype,"wS",void 0),(0,W.d)([iO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nO.prototype,"emitRate",void 0),(0,W.d)([iO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nO.prototype,"targetStopDuration",void 0),(0,W.d)([iO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],nO.prototype,"startDelay",void 0),(0,W.d)([iO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],nO.prototype,"doNoStart",void 0),(0,U.g)("BABYLON.SystemBlock",nO);class QO extends sO{get type(){if(this._type===AO.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=AO.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=AO.Vector2,this._type;case"eO":return this._type=AO.eO,this._type;case"EU":return this._type=AO.EU,this._type;case"Matrix":return this._type=AO.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===fO.None&&this._systemSource!==cO.None}get systemSource(){return this._systemSource}set systemSource(H){if(this._systemSource=H,H!==cO.None){switch(this._contextualSource=fO.None,this._type=AO.Float,H){case cO.Time:case cO.Delta:this._type=AO.Float;break;case cO.Emitter:this._type=AO.eO}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==fO.None}get contextualValue(){return this._contextualSource}set contextualValue(H){if(this._contextualSource=H,H!==fO.None){switch(this._systemSource=cO.None,H){case fO.Scale:this._type=AO.Vector2;break;case fO.Position:case fO.Direction:case fO.ScaledDirection:this._type=AO.eO;break;case fO.Color:this._type=AO.EU;break;case fO.Age:case fO.Lifetime:case fO.Angle:case fO.AgeGradient:this._type=AO.Float;break;case fO.SpriteCellEnd:case fO.SpriteCellStart:case fO.SpriteCellIndex:this._type=AO.Int}this.output&&(this.output.type=this._type)}}constructor(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AO.AutoDetect;super(H),this._type=AO.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new C.b,this._systemSource=cO.None,this._contextualSource=fO.None,this._type=O,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",O)}get value(){return this._storedValue}set value(H){this.type===AO.Float&&this.min!==this.max&&(H=Math.max(this.min,H),H=Math.min(this.max,H)),this._storedValue=H,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(H){this._valueCallback=H}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case AO.Int:case AO.Float:this.value=0;break;case AO.Vector2:this.value=t.Vector2.Zero();break;case AO.eO:this.value=t.eO.Zero();break;case AO.EU:this.value=new G.EU(1,1,1,1);break;case AO.Matrix:this.value=t.Matrix.Identity()}}_build(H){super._build(H),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=H=>H.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=H=>H.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const H=super.serialize();return H.type=this.type,H.contextualValue=this.contextualValue,H.systemSource=this.systemSource,H.min=this.min,H.max=this.max,H.groupInInspector=this.groupInInspector,H.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.pU?(H.valueType="BABYLON."+this._storedValue.getClassName(),H.value=this._storedValue.pU()):(H.valueType="number",H.value=this._storedValue)),H}_deserialize(H){if(super._deserialize(H),this._type=H.type,this.contextualValue=H.contextualValue,this.systemSource=H.systemSource||cO.None,this.min=H.min||0,this.max=H.max||0,this.groupInInspector=H.groupInInspector||"",void 0!==H.displayInInspector&&(this.displayInInspector=H.displayInInspector),H.valueType)if("number"===H.valueType)this._storedValue=H.value;else{const O=(0,U.e)(H.valueType);O&&(this._storedValue=O.KO(H.value))}}}(0,U.g)("BABYLON.ParticleInputBlock",QO);class LO extends sO{get url(){return this._url}set url(H){this._url!==H&&(this._cachedData=null,this._url=H,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(H){this._textureDataUrl!==H&&(this._cachedData=null,this._textureDataUrl=H,this._url="",this._sourceTexture=null)}set sourceTexture(H){this._sourceTexture!==H&&(this._cachedData=null,this._sourceTexture=H,this._url="",this._textureDataUrl="")}constructor(H){super(H),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",AO.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const H=this.texture._storedValue;return await new Promise(((O,S)=>{if(!H.isReady())return void H.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),O(this._cachedData)}catch(H){S(H)}}));const t=H.getSize();WO.l.GetTextureDataAsync(H,t.width,t.height).then((S=>{this._cachedData={width:t.width,height:t.height,data:new Uint8ClampedArray(S)},H.dispose(),O(this._cachedData)})).catch(S)}))}_build(H){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new x.b(this._textureDataUrl,H.EO):this.texture._storedValue=new x.b(this._url,H.EO):this.texture._storedValue=null}serialize(){const H=super.serialize();return H.url=this.url,H.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(H.textureDataUrl=this.textureDataUrl),H}_deserialize(H){super._deserialize(H),this.url=H.url,this.serializedCachedData=!!H.serializedCachedData,H.textureDataUrl&&(this.textureDataUrl=H.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,U.g)("BABYLON.ParticleTextureSourceBlock",LO);class HS extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("position",AO.eO),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.position.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.position.t(this.position.getConnectedValue(H))},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}}(0,U.g)("BABYLON.UpdatePositionBlock",HS),function(H){H[H.Add=0]="Add",H[H.Subtract=1]="Subtract",H[H.Multiply=2]="Multiply",H[H.Divide=3]="Divide",H[H.Max=4]="Max",H[H.Min=5]="Min"}(RO||(RO={}));class OS extends sO{constructor(H){super(H),this.operation=RO.Add,this.registerInput("left",AO.AutoDetect),this.registerInput("right",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this.output._typeConnectionSource=this.left;const O=[AO.Matrix,AO.Particle,AO.Texture,AO.System,AO.FloatGradient,AO.Color4Gradient,AO.Vector2Gradient,AO.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...O),this.right.excludedConnectionPointTypes.push(...O),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(H){let O;const S=this.left,q=this.right;if(!S.isConnected||!q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const p=S.type===AO.Float||S.type===AO.Int,U=q.type===AO.Float||q.type===AO.Int,V=p&&U;switch(this.operation){case RO.Add:O=V?H=>S.getConnectedValue(H)+q.getConnectedValue(H):p?H=>H.adapt(S,q.type).add(q.getConnectedValue(H)):H=>S.getConnectedValue(H).add(H.adapt(q,S.type));break;case RO.Subtract:O=V?H=>S.getConnectedValue(H)-q.getConnectedValue(H):p?H=>H.adapt(S,q.type).XO(q.getConnectedValue(H)):H=>S.getConnectedValue(H).XO(H.adapt(q,S.type));break;case RO.Multiply:O=V?H=>S.getConnectedValue(H)*q.getConnectedValue(H):p?H=>H.adapt(S,q.type).multiply(q.getConnectedValue(H)):H=>S.getConnectedValue(H).multiply(H.adapt(q,S.type));break;case RO.Divide:O=V?H=>S.getConnectedValue(H)/q.getConnectedValue(H):p?H=>H.adapt(S,q.type).divide(q.getConnectedValue(H)):H=>S.getConnectedValue(H).divide(H.adapt(q,S.type));break;case RO.Min:if(V)O=H=>Math.min(S.getConnectedValue(H),q.getConnectedValue(H));else{const[H,U]=p?[q,S]:[S,q];switch(H.type){case AO.Vector2:O=O=>t.Vector2.Minimize(H.getConnectedValue(O),O.adapt(U,H.type));break;case AO.eO:O=O=>t.eO.Minimize(H.getConnectedValue(O),O.adapt(U,H.type));break;case AO.EU:O=O=>{const S=H.getConnectedValue(O),{r:t,g:q,b:p,a:V}=O.adapt(U,H.type);return new G.EU(Math.min(S.r,t),Math.min(S.g,q),Math.min(S.b,p),Math.min(S.a,V))}}}break;case RO.Max:if(!V){const[H,U]=p?[q,S]:[S,q];switch(H.type){case AO.Vector2:O=O=>t.Vector2.Maximize(H.getConnectedValue(O),O.adapt(U,H.type));break;case AO.eO:O=O=>t.eO.Maximize(H.getConnectedValue(O),O.adapt(U,H.type));break;case AO.EU:O=O=>{const S=H.getConnectedValue(O),{r:t,g:q,b:p,a:V}=O.adapt(U,H.type);return new G.EU(Math.max(S.r,t),Math.min(S.g,q),Math.min(S.b,p),Math.min(S.a,V))}}break}O=H=>Math.max(S.getConnectedValue(H),q.getConnectedValue(H))}this.output._storedFunction=H=>S.type===AO.Int?0|O(H):O(H)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===AO.Int||this.left.type===AO.Float&&this.right.type!==AO.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[H,O]of[[this.left,this.right],[this.right,this.left]])H.acceptedConnectionPointTypes=[AO.Int,AO.Float],O.isConnected&&(H.acceptedConnectionPointTypes.push(O.type),O.type!==AO.Int&&O.type!==AO.Float||H.acceptedConnectionPointTypes.push(AO.Vector2,AO.eO,AO.EU))}dispose(){super.dispose();for(const H of this._connectionObservers)H.remove();this._connectionObservers.length=0}serialize(){const H=super.serialize();return H.operation=this.operation,H}_deserialize(H){super._deserialize(H),this.operation=H.operation}}(0,W.d)([iO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:RO.Add},{label:"Subtract",value:RO.Subtract},{label:"Multiply",value:RO.Multiply},{label:"Divide",value:RO.Divide},{label:"Max",value:RO.Max},{label:"Min",value:RO.Min}]})],OS.prototype,"operation",void 0),(0,U.g)("BABYLON.ParticleMathBlock",OS);class SS extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("direction1",AO.eO,!0,new t.eO(0,1,0)),this.registerInput("direction2",AO.eO,!0,new t.eO(0,1,0)),this.registerInput("minEmitBox",AO.eO,!0,new t.eO(-.5,-.5,-.5)),this.registerInput("maxEmitBox",AO.eO,!0,new t.eO(.5,.5,.5)),this.registerOutput("output",AO.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(H){const O=this.particle.getConnectedValue(H);O._directionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.direction1.getConnectedValue(H),p=this.direction2.getConnectedValue(H),G=(0,w.RandomRange)(q.x,p.x),U=(0,w.RandomRange)(q.y,p.y),V=(0,w.RandomRange)(q.z,p.z);H.isEmitterTransformNode?t.eO.TransformNormalFromFloatsToRef(G,U,V,H.emitterWorldMatrix,S.direction):S.direction.jU(G,U,V)},O._positionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.minEmitBox.getConnectedValue(H),p=this.maxEmitBox.getConnectedValue(H),G=(0,w.RandomRange)(q.x,p.x),U=(0,w.RandomRange)(q.y,p.y),V=(0,w.RandomRange)(q.z,p.z);H.isEmitterTransformNode?t.eO.TransformCoordinatesFromFloatsToRef(G,U,V,H.emitterWorldMatrix,S.position):(S.position.jU(G,U,V),S.position.addInPlace(H.emitterPosition))},this.output._storedValue=O}}(0,U.g)("BABYLON.BoxShapeBlock",SS);class tS extends sO{constructor(H){super(H),this.registerInput("emitPower",AO.Float,!0,1),this.registerInput("lifeTime",AO.Float,!0,1),this.registerInput("color",AO.EU,!0,new G.EU(1,1,1,1)),this.registerInput("scale",AO.Vector2,!0,new t.Vector2(1,1)),this.registerInput("angle",AO.Float,!0,0),this.registerOutput("particle",AO.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(H){const O=new UO(this.name,H.wS,H.EO,null,!1,void 0,!0);O.particleEmitterType=new y,O._lifeTimeCreation.process=(O,S)=>{H.particleContext=O,O.lifeTime=this.lifeTime.getConnectedValue(H),S._emitPower=this.emitPower.getConnectedValue(H)},O._colorCreation.process=O=>{H.particleContext=O,O.color.t(this.color.getConnectedValue(H))},O._sizeCreation.process=O=>{H.particleContext=O,O.size=1,O.scale.t(this.scale.getConnectedValue(H))},O._angleCreation.process=O=>{H.particleContext=O,O.angle=this.angle.getConnectedValue(H)},this.particle._storedValue=O}}(0,U.g)("BABYLON.CreateParticleBlock",tS);class qS{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const H=[];for(const O of this.attachedBlocks)O.isInput&&H.push(O);return H}constructor(H){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new C.b,this.name=H}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(H)&&this.attachedBlocks.push(H);for(const S of H.inputs){const t=S.connectedPoint;if(t){const S=t.ownerBlock;S!==H&&this._initializeBlock(S,O)}}}async buildAsync(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((S=>{const t=new YO;for(const H of this._systemBlocks)this._initializeBlock(H);for(const q of this.systemBlocks){const S=new MO;S.buildId=this._buildId++,S.EO=H,S.verbose=O;const p=q.createSystem(S);S.emitErrors(),t.systems.push(p)}this.onBuildObservable.notifyObservers(this),S(t)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const H=new nO("Particle system"),O=new HS("Update position");O.output.connectTo(H.particle);const S=new QO("Position");S.contextualValue=fO.Position;const t=new QO("Scaled direction");t.contextualValue=fO.ScaledDirection;const q=new OS("Add");q.operation=RO.Add,S.output.connectTo(q.left),t.output.connectTo(q.right),q.output.connectTo(O.position);const p=new tS("Create particle"),G=new SS("Box shape");p.particle.connectTo(G.particle),G.output.connectTo(O.particle);const U=new LO("Texture");U.texture.connectTo(H.texture),U.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(H)}removeBlock(H){const O=this.attachedBlocks.indexOf(H);if(O>-1&&this.attachedBlocks.splice(O,1),H.isSystem){const O=this._systemBlocks.indexOf(H);O>-1&&this._systemBlocks.splice(O,1)}}parseSerializedObject(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];O||this.clear();const S={};for(const t of H.Vo){const H=(0,U.e)(t.customType);if(H){const O=new H;O._deserialize(t),S[t.id]=O,this.attachedBlocks.push(O),O.isSystem&&this._systemBlocks.push(O)}}for(const t of this.attachedBlocks)if(t.isTeleportOut){const H=t,O=H._tempEntryPointUniqueId;if(O){const t=S[O];t&&t.attachToEndpoint(H)}}for(let t=0;t<H.Vo.length;t++){const q=H.Vo[t],p=S[q.id];p&&(p.inputs.length&&q.inputs.some((H=>H.targetConnectionName))&&!O||this._restoreConnections(p,H,S))}if(H.locations||H.editorData&&H.editorData.locations){const t=H.locations||H.editorData.locations;for(const H of t)S[H.Mt]&&(H.Mt=S[H.Mt].uniqueId);O&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),H.locations?this.editorData={locations:t}:(this.editorData=H.editorData,this.editorData.locations=t);const q=[];for(const H in S)q[H]=S[H].uniqueId;this.editorData.map=q}this.comment=H.comment}_restoreConnections(H,O,S){for(const t of H.outputs)for(const q of O.Vo){const p=S[q.id];if(p)for(const G of q.inputs)if(S[G.targetBlockId]!==H||G.targetConnectionName!==t.name);else{const H=p.getInputByName(G.inputName);if(!H||H.isConnected)continue;t.connectTo(H,!0),this._restoreConnections(p,O,S)}}}serialize(H){const O=H?{}:N.e.Serialize(this);O.editorData=JSON.parse(JSON.stringify(this.editorData));let S=[];H?S=H:O.customType="BABYLON.NodeParticleSystemSet",O.Vo=[];for(const t of S)O.Vo.push(t.serialize());if(!H)for(const t of this.attachedBlocks)-1===S.indexOf(t)&&O.Vo.push(t.serialize());return O}dispose(){for(const H of this.attachedBlocks)H.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(H){const O=new qS(H);return O.setToDefault(),O}static Parse(H){const O=N.e.Parse((()=>new qS(H.name)),H,null);return O.parseSerializedObject(H),O}static ParseFromSnippetAsync(H,O){return"_BLANK"===H?Promise.resolve(qS.CreateDefault("blank")):new Promise(((S,t)=>{const q=new lO.c;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const G=JSON.parse(JSON.parse(q.responseText).jsonPayload),U=JSON.parse(G.nodeParticle);O||(O=N.e.Parse((()=>new qS(H)),U,null)),O.parseSerializedObject(U),O.snippetId=H;try{S(O)}catch(p){t(p)}}else t("Unable to load the snippet "+H)})),q.open("GET",this.SnippetUrl+"/"+H.replace(/#/g,"/")),q.send()}))}}qS.EditorURL=`${bO.Tools._DefaultCdnUrl}/v${iH.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,qS.SnippetUrl="https://snippet.babylonjs.com",(0,W.d)([(0,g.J)()],qS.prototype,"name",void 0),(0,W.d)([(0,g.J)("comment")],qS.prototype,"comment",void 0),function(H){H[H.None=0]="None",H[H.PerParticle=1]="PerParticle",H[H.PerSystem=2]="PerSystem"}(BO||(BO={}));class pS extends sO{constructor(H){super(H),this._currentLockId=-2,this.lockMode=BO.PerParticle,this.registerInput("min",AO.AutoDetect,!0,0),this.registerInput("max",AO.AutoDetect,!0,1),this.registerOutput("output",AO.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AO.Float|AO.Int|AO.Vector2|AO.eO|AO.EU),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(AO.Float|AO.Int|AO.Vector2|AO.eO|AO.EU),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=AO.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let H=null;switch(this._currentLockId=-2,this.min.type){case AO.AutoDetect:case AO.Int:case AO.Float:H=H=>{const O=this.min.getConnectedValue(H)||0,S=this.max.getConnectedValue(H)||1;return O+Math.random()*(S-O)};break;case AO.Vector2:H=H=>{const O=this.min.getConnectedValue(H)||t.Vector2.Zero(),S=this.max.getConnectedValue(H)||t.Vector2.One();return new t.Vector2(O.x+Math.random()*(S.x-O.x),O.y+Math.random()*(S.y-O.y))};break;case AO.eO:H=H=>{const O=this.min.getConnectedValue(H)||t.eO.Zero(),S=this.max.getConnectedValue(H)||t.eO.One();return new t.eO(O.x+Math.random()*(S.x-O.x),O.y+Math.random()*(S.y-O.y),O.z+Math.random()*(S.z-O.z))};break;case AO.EU:H=H=>{const O=this.min.getConnectedValue(H)||new G.EU(0,0,0,0),S=this.max.getConnectedValue(H)||new G.EU(1,1,1,1);return new G.EU(O.x+Math.random()*(S.x-O.x),O.y+Math.random()*(S.y-O.y),O.z+Math.random()*(S.z-O.z),O.w+Math.random()*(S.w-O.w))}}this.output._storedFunction=O=>{var S;let t=0;switch(this.lockMode){case BO.PerParticle:t=(null===(S=O.particleContext)||void 0===S?void 0:S.id)||-1;break;case BO.PerSystem:t=O.buildId||0}return this._currentLockId!==t&&(this.lockMode!==BO.None&&(this._currentLockId=t),this.output._storedValue=H(O)),this.output._storedValue}}serialize(){const H=super.serialize();return H.lockMode=this.lockMode,H}_deserialize(H){super._deserialize(H),this.lockMode=H.lockMode}}(0,W.d)([iO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:BO.None},{label:"Per particle",value:BO.PerParticle},{label:"Per system",value:BO.PerSystem}]})],pS.prototype,"lockMode",void 0),(0,U.g)("BABYLON.ParticleRandomBlock",pS);class GS extends sO{constructor(H){super(H),this._currentLockId=-2,this.lockMode=BO.PerParticle,this.registerInput("min",AO.AutoDetect),this.registerInput("max",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const O=[AO.Matrix,AO.Particle,AO.Texture,AO.System,AO.FloatGradient,AO.Color4Gradient,AO.Vector2Gradient,AO.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...O),this.max.excludedConnectionPointTypes.push(...O)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let H=null;switch(this._currentLockId=-2,this.min.type){case AO.Float:case AO.Int:H=H=>{const O=this.min.getConnectedValue(H),S=this.max.getConnectedValue(H);return Math.random()*(S-O)+O};break;case AO.Vector2:H=H=>{const O=this.min.getConnectedValue(H),S=this.max.getConnectedValue(H);return new t.Vector2(Math.random()*(S.x-O.x)+O.x,Math.random()*(S.y-O.y)+O.y)};break;case AO.eO:H=H=>{const O=this.min.getConnectedValue(H),S=this.max.getConnectedValue(H);return new t.eO(Math.random()*(S.x-O.x)+O.x,Math.random()*(S.y-O.y)+O.y,Math.random()*(S.z-O.z)+O.z)};break;case AO.EU:H=H=>{const O=this.min.getConnectedValue(H),S=this.max.getConnectedValue(H);return new G.EU(Math.random()*(S.r-O.r)+O.r,Math.random()*(S.g-O.g)+O.g,Math.random()*(S.b-O.b)+O.b,Math.random()*(S.a-O.a)+O.a)}}this.output._storedFunction=O=>{var S;let t=0;switch(this.lockMode){case BO.PerParticle:t=(null===(S=O.particleContext)||void 0===S?void 0:S.id)||-1;break;case BO.PerSystem:t=O.buildId||0}return this._currentLockId!==t&&(this.lockMode!==BO.None&&(this._currentLockId=t),this.output._storedValue=H(O)),this.output._storedValue}}serialize(){const H=super.serialize();return H.lockMode=this.lockMode,H}_deserialize(H){super._deserialize(H),void 0!==H.lockMode&&(this.lockMode=H.lockMode)}}(0,W.d)([iO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:BO.None},{label:"Per particle",value:BO.PerParticle},{label:"Per system",value:BO.PerSystem}]})],GS.prototype,"lockMode",void 0),(0,U.g)("BABYLON.RandomRangeBlock",GS);(0,U.g)("BABYLON.ParticleLerpBlock",class extends sO{constructor(H){super(H),this.registerInput("left",AO.AutoDetect),this.registerInput("right",AO.AutoDetect),this.registerInput("gradient",AO.Float,!0,0,0,1),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AO.Float|AO.Int|AO.Vector2|AO.eO|AO.EU)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const H=(H,O,S)=>(1-H)*O+H*S;this.output._storedFunction=O=>{const S=this.left.getConnectedValue(O),q=this.right.getConnectedValue(O),p=this.gradient.getConnectedValue(O);switch(this.left.type){case AO.Int:case AO.Float:return H(p,S,q);case AO.Vector2:return new t.Vector2(H(p,S.x,q.x),H(p,S.y,q.y));case AO.eO:return new t.eO(H(p,S.x,q.x),H(p,S.y,q.y),H(p,S.z,q.z));case AO.EU:return new G.EU(H(p,S.r,q.r),H(p,S.g,q.g),H(p,S.b,q.b),H(p,S.a,q.a))}return 0}}});(0,U.g)("BABYLON.UpdateDirectionBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("direction",AO.eO),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.direction.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.direction.t(this.direction.getConnectedValue(H))},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}});(0,U.g)("BABYLON.UpdateColorBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("color",AO.EU),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.color.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.color.t(this.color.getConnectedValue(H))},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}});(0,U.g)("BABYLON.UpdateScaleBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("scale",AO.Vector2),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.scale.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.scale.t(this.scale.getConnectedValue(H))},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}});(0,U.g)("BABYLON.UpdateAngleBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("angle",AO.Float),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.angle.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.angle=this.angle.getConnectedValue(H)},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}});(0,U.g)("BABYLON.BasicPositionUpdateBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(H){const O=this.particle.getConnectedValue(H),S={process:S=>{H.particleContext=S,H.systemContext=O,S.direction.scaleToRef(O._directionScale,O._scaledDirection),S.position.addInPlace(O._scaledDirection)},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S,this.output._storedValue=O}});(0,U.g)("BABYLON.BasicSpriteUpdateBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(H){const O=this.particle.getConnectedValue(H),S={process:S=>{H.particleContext=S,H.systemContext=O,S.updateCellIndex()},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S,this.output._storedValue=O}});(0,U.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("cellIndex",AO.Int),this.registerOutput("output",AO.Particle),this.cellIndex.acceptedConnectionPointTypes=[AO.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(H){const O=this.particle.getConnectedValue(H);if(this.output._storedValue=O,!this.cellIndex.isConnected)return;const S={process:S=>{H.particleContext=S,H.systemContext=O,S.cellIndex=Math.floor(this.cellIndex.getConnectedValue(H))},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S}});class US extends sO{constructor(H){super(H),this.strength=1,this.registerInput("particle",AO.Particle),this.registerInput("flowMap",AO.Texture),this.registerOutput("output",AO.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(H){var O;const S=this.particle.getConnectedValue(H),t=H.EO;let q;(null===(O=this.flowMap.connectedPoint)||void 0===O?void 0:O.ownerBlock).extractTextureContentAsync().then((H=>{H&&(q=new kO(H.width,H.height,H.data))}));const p={process:H=>{const O=t.getTransformMatrix();q&&q._processParticle(H,this.strength*S._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null};S._updateQueueStart?cH(p,S._updateQueueStart):S._updateQueueStart=p,this.output._storedValue=S}serialize(){const H=super.serialize();return H.strength=this.strength,H}_deserialize(H){super._deserialize(H),this.strength=H.strength}}(0,W.d)([iO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],US.prototype,"strength",void 0),(0,U.g)("BABYLON.UpdateFlowMapBlock",US);(0,U.g)("BABYLON.SphereShapeBlock",class extends sO{constructor(H){super(H),this.registerInput("input",AO.Particle),this.registerInput("radius",AO.Float,!0,1),this.registerInput("radiusRange",AO.Float,!0,1,0,1),this.registerInput("directionRandomizer",AO.Float,!0,0,0,1),this.registerOutput("output",AO.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(H){const O=this.input.getConnectedValue(H);O._directionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.directionRandomizer.getConnectedValue(H),p=S.position.XO(H.emitterPosition).normalize(),G=(0,w.RandomRange)(0,q),U=(0,w.RandomRange)(0,q),V=(0,w.RandomRange)(0,q);p.x+=G,p.y+=U,p.z+=V,p.normalize(),H.isEmitterTransformNode?t.eO.TransformNormalFromFloatsToRef(G,U,V,H.emitterWorldMatrix,S.direction):S.direction.jU(G,U,V)},O._positionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.radius.getConnectedValue(H),p=this.radiusRange.getConnectedValue(H),G=q-(0,w.RandomRange)(0,q*p),U=(0,w.RandomRange)(0,1),V=(0,w.RandomRange)(0,2*Math.PI),o=Math.acos(2*U-1),h=G*Math.cos(V)*Math.sin(o),a=G*Math.cos(o),j=G*Math.sin(V)*Math.sin(o);H.isEmitterTransformNode?t.eO.TransformCoordinatesFromFloatsToRef(h,a,j,H.emitterWorldMatrix,S.position):(S.position.jU(h,a,j),S.position.addInPlace(H.emitterPosition))},this.output._storedValue=O}});(0,U.g)("BABYLON.PointShapeBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("direction1",AO.eO,!0,new t.eO(0,1,0)),this.registerInput("direction2",AO.eO,!0,new t.eO(0,1,0)),this.registerOutput("output",AO.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){const O=this.particle.getConnectedValue(H);O._directionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.direction1.getConnectedValue(H),p=this.direction2.getConnectedValue(H),G=(0,w.RandomRange)(q.x,p.x),U=(0,w.RandomRange)(q.y,p.y),V=(0,w.RandomRange)(q.z,p.z);H.isEmitterTransformNode?t.eO.TransformNormalFromFloatsToRef(G,U,V,H.emitterWorldMatrix,S.direction):S.direction.jU(G,U,V)},O._positionCreation.process=S=>{H.systemContext=O,H.isEmitterTransformNode?t.eO.TransformCoordinatesFromFloatsToRef(0,0,0,H.emitterWorldMatrix,S.position):S.position.t(H.emitterPosition)},this.output._storedValue=O}});(0,U.g)("BABYLON.CustomShapeBlock",class extends sO{constructor(H){super(H),this.registerInput("particle",AO.Particle),this.registerInput("position",AO.eO,!0,new t.eO(0,0,0)),this.registerInput("direction",AO.eO,!0,new t.eO(0,1,0)),this.registerOutput("output",AO.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){const O=this.particle.getConnectedValue(H);O._directionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.direction.getConnectedValue(H);H.isEmitterTransformNode?t.eO.TransformNormalToRef(q,H.emitterWorldMatrix,S.direction):S.direction.t(q)},O._positionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.position.getConnectedValue(H);H.isEmitterTransformNode?t.eO.TransformCoordinatesToRef(q,H.emitterWorldMatrix,S.position):(S.position.t(q),S.position.addInPlace(H.emitterPosition))},this.output._storedValue=O}});(0,U.g)("BABYLON.CylinderShapeBlock",class extends sO{constructor(H){super(H),this._tempVector=t.eO.Zero(),this.registerInput("particle",AO.Particle),this.registerInput("radius",AO.Float,!0,1),this.registerInput("height",AO.Float,!0,1,0),this.registerInput("radiusRange",AO.Float,!0,1,0,1),this.registerInput("directionRandomizer",AO.Float,!0,0,0,1),this.registerOutput("output",AO.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(H){const O=this.particle.getConnectedValue(H);O._directionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.directionRandomizer.getConnectedValue(H);S.position.subtractToRef(H.emitterPosition,this._tempVector),this._tempVector.normalize(),H.isEmitterTransformNode&&t.eO.TransformNormalToRef(this._tempVector,H.emitterInverseWorldMatrix,this._tempVector);const p=(0,w.RandomRange)(-q/2,q/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,w.RandomRange)(-Math.PI/2,Math.PI/2)*q,this._tempVector.y=p,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),H.isEmitterTransformNode?t.eO.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,H.emitterWorldMatrix,S.direction):S.direction.t(this._tempVector)},O._positionCreation.process=S=>{H.particleContext=S,H.systemContext=O;const q=this.height.getConnectedValue(H),p=this.radiusRange.getConnectedValue(H),G=this.radius.getConnectedValue(H),U=(0,w.RandomRange)(-q/2,q/2),V=(0,w.RandomRange)(0,2*Math.PI),o=(0,w.RandomRange)((1-p)*(1-p),1),h=Math.sqrt(o)*G,a=h*Math.cos(V),j=h*Math.sin(V);H.isEmitterTransformNode?t.eO.TransformCoordinatesFromFloatsToRef(a,U,j,H.emitterWorldMatrix,S.position):(S.position.jU(a,U,j),S.position.addInPlace(H.emitterPosition))},this.output._storedValue=O}});class VS extends sO{constructor(H){super(H),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",AO.Particle),this.registerOutput("output",AO.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);const O=this.particle.getConnectedValue(H);O._isAnimationSheetEnabled=!0,O.spriteCellWidth=this.width,O.spriteCellHeight=this.height,O.startSpriteCellID=this.start,O.endSpriteCellID=this.end,O.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=O}serialize(){const H=super.serialize();return H.width=this.width,H.height=this.height,H.start=this.start,H.end=this.end,H.randomStartCell=this.randomStartCell,H}_deserialize(H){super._deserialize(H),this.width=H.width,this.height=H.height,this.start=H.start,this.end=H.end,this.randomStartCell=H.randomStartCell}}(0,W.d)([iO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VS.prototype,"start",void 0),(0,W.d)([iO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VS.prototype,"end",void 0),(0,W.d)([iO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VS.prototype,"width",void 0),(0,W.d)([iO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VS.prototype,"height",void 0),(0,W.d)([iO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],VS.prototype,"loop",void 0),(0,W.d)([iO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],VS.prototype,"randomStartCell",void 0),(0,U.g)("BABYLON.SetupSpriteSheetBlock",VS);class wS extends sO{constructor(H){super(H),this.reference=0,this.registerInput("value",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=H=>{switch(H){case AO.Float:return AO.FloatGradient;case AO.Vector2:return AO.Vector2Gradient;case AO.eO:return AO.Vector3Gradient;case AO.EU:return AO.Color4Gradient}return H},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AO.Float|AO.Vector2|AO.eO|AO.EU)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=H=>null}serialize(){const H=super.serialize();return H.reference=this.reference,H}_deserialize(H){super._deserialize(H),this.reference=H.reference}}(0,W.d)([iO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],wS.prototype,"reference",void 0),(0,U.g)("BABYLON.ParticleGradientValueBlock",wS);(0,U.g)("BABYLON.ParticleGradientBlock",class extends sO{constructor(H){super(H),this._entryCount=1,this.registerInput("gradient",AO.Float,!0,1,0,1),this.registerInput("value0",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=H=>{switch(H){case AO.FloatGradient:return AO.Float;case AO.Vector2Gradient:return AO.Vector2;case AO.Vector3Gradient:return AO.eO;case AO.Color4Gradient:return AO.EU}return H},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(AO.FloatGradient|AO.Vector2Gradient|AO.Vector3Gradient|AO.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(H){this._inputs[H].onConnectionObservable.add((()=>{this._entryCount>H||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),AO.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const H=[];for(let S=1;S<this._inputs.length;S++){var O;if(this._inputs[S].isConnected)H.push(null===(O=this._inputs[S].connectedPoint)||void 0===O?void 0:O.ownerBlock)}H.sort(((H,O)=>H.reference-O.reference)),this.output._storedFunction=O=>{const S=this.gradient.getConnectedValue(O);if(1===H.length)return H[0].value.getConnectedValue(O);let q=null;for(let p=H.length-1;p>=0;p--){const U=H[p];if(U.reference<=S){const H=U.value.getConnectedValue(O);if(q){const p=q.value.getConnectedValue(O),V=q.reference,o=U.reference,h=Math.max(0,Math.min(1,(S-o)/(V-o)));switch(this.output.type){case AO.Float:return(0,w.Lerp)(H,p,h);case AO.Vector2:return t.Vector2.Lerp(H,p,h);case AO.eO:return t.eO.Lerp(H,p,h);case AO.EU:return G.EU.Lerp(H,p,h)}}return H}q=U}return 0}}});(0,U.g)("BABYLON.ParticleConverterBlock",class extends sO{constructor(H){super(H),this.registerInput("color ",AO.EU,!0),this.registerInput("xyz ",AO.eO,!0),this.registerInput("xy ",AO.Vector2,!0),this.registerInput("zw ",AO.Vector2,!0),this.registerInput("x ",AO.Float,!0),this.registerInput("y ",AO.Float,!0),this.registerInput("z ",AO.Float,!0),this.registerInput("w ",AO.Float,!0),this.registerOutput("color",AO.EU),this.registerOutput("xyz",AO.eO),this.registerOutput("xy",AO.Vector2),this.registerOutput("zw",AO.Vector2),this.registerOutput("x",AO.Float),this.registerOutput("y",AO.Float),this.registerOutput("z",AO.Float),this.registerOutput("w",AO.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(H){return"color "===H?"colorIn":"xyz "===H?"xyzIn":"xy "===H?"xyIn":"zw "===H?"zwIn":"x "===H?"xIn":"y "===H?"yIn":"z "===H?"zIn":"w "===H?"wIn":H}_outputRename(H){switch(H){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return H}}_build(H){super._build(H);const O=this.xIn,S=this.yIn,q=this.zIn,p=this.wIn,U=this.xyIn,V=this.zwIn,w=this.xyzIn,o=this.colorIn,h=this.colorOut,a=this.xyzOut,j=this.xyOut,e=this.zwOut,X=this.xOut,E=this.yOut,y=this.zOut,T=this.wOut,K=H=>{if(o.isConnected)return o.getConnectedValue(H);let t=0,h=0,a=0,j=0;if(O.isConnected&&(t=O.getConnectedValue(H)),S.isConnected&&(h=S.getConnectedValue(H)),q.isConnected&&(a=q.getConnectedValue(H)),p.isConnected&&(j=p.getConnectedValue(H)),U.isConnected){const O=U.getConnectedValue(H);O&&(t=O.x,h=O.y)}if(V.isConnected){const O=V.getConnectedValue(H);O&&(a=O.x,j=O.y)}if(w.isConnected){const O=w.getConnectedValue(H);O&&(t=O.x,h=O.y,a=O.z)}return new G.EU(t,h,a,j)};h._storedFunction=H=>K(H),a._storedFunction=H=>{const O=K(H);return new t.eO(O.r,O.g,O.b)},j._storedFunction=H=>{const O=K(H);return new t.Vector2(O.r,O.g)},e._storedFunction=H=>{const O=K(H);return new t.Vector2(O.b,O.a)},X._storedFunction=H=>K(H).r,E._storedFunction=H=>K(H).g,y._storedFunction=H=>K(H).b,T._storedFunction=H=>K(H).a}}),function(H){H[H.Cos=0]="Cos",H[H.Sin=1]="Sin",H[H.Abs=2]="Abs",H[H.Exp=3]="Exp",H[H.Exp2=4]="Exp2",H[H.Round=5]="Round",H[H.Floor=6]="Floor",H[H.Ceiling=7]="Ceiling",H[H.Sqrt=8]="Sqrt",H[H.Log=9]="Log",H[H.Tan=10]="Tan",H[H.ArcTan=11]="ArcTan",H[H.ArcCos=12]="ArcCos",H[H.ArcSin=13]="ArcSin",H[H.Sign=14]="Sign",H[H.Negate=15]="Negate",H[H.OneMinus=16]="OneMinus",H[H.Reciprocal=17]="Reciprocal",H[H.ToDegrees=18]="ToDegrees",H[H.ToRadians=19]="ToRadians",H[H.Fract=20]="Fract"}(ZO||(ZO={}));class oS extends sO{constructor(H){super(H),this.operation=ZO.Cos,this.registerInput("input",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AO.Float|AO.Int|AO.Vector2|AO.eO|AO.EU)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);let O=null;switch(this.operation){case ZO.Cos:O=H=>Math.cos(H);break;case ZO.Sin:O=H=>Math.sin(H);break;case ZO.Abs:O=H=>Math.abs(H);break;case ZO.Exp:O=H=>Math.exp(H);break;case ZO.Exp2:O=H=>Math.pow(2,H);break;case ZO.Round:O=H=>Math.round(H);break;case ZO.Floor:O=H=>Math.floor(H);break;case ZO.Ceiling:O=H=>Math.ceil(H);break;case ZO.Sqrt:O=H=>Math.sqrt(H);break;case ZO.Log:O=H=>Math.log(H);break;case ZO.Tan:O=H=>Math.tan(H);break;case ZO.ArcTan:O=H=>Math.atan(H);break;case ZO.ArcCos:O=H=>Math.acos(H);break;case ZO.ArcSin:O=H=>Math.asin(H);break;case ZO.Sign:O=H=>Math.sign(H);break;case ZO.Negate:O=H=>-H;break;case ZO.OneMinus:O=H=>1-H;break;case ZO.Reciprocal:O=H=>1/H;break;case ZO.ToRadians:O=H=>H*Math.PI/180;break;case ZO.ToDegrees:O=H=>180*H/Math.PI;break;case ZO.Fract:O=H=>H>=0?H-Math.floor(H):H-Math.ceil(H)}if(!O)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case AO.Int:case AO.Float:this.output._storedFunction=H=>{const S=this.input.getConnectedValue(H);return O(S)};break;case AO.Vector2:this.output._storedFunction=H=>{const S=this.input.getConnectedValue(H);return new t.Vector2(O(S.x),O(S.y))};break;case AO.eO:this.output._storedFunction=H=>{const S=this.input.getConnectedValue(H);return new t.eO(O(S.x),O(S.y),O(S.z))};break;case AO.EU:this.output._storedFunction=H=>{const S=this.input.getConnectedValue(H);return new G.EU(O(S.r),O(S.g),O(S.b),O(S.a))}}return this}serialize(){const H=super.serialize();return H.operation=this.operation,H}_deserialize(H){super._deserialize(H),this.operation=H.operation}}(0,W.d)([iO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ZO.Cos},{label:"Sin",value:ZO.Sin},{label:"Abs",value:ZO.Abs},{label:"Exp",value:ZO.Exp},{label:"Exp2",value:ZO.Exp2},{label:"Round",value:ZO.Round},{label:"Floor",value:ZO.Floor},{label:"Ceiling",value:ZO.Ceiling},{label:"Sqrt",value:ZO.Sqrt},{label:"Log",value:ZO.Log},{label:"Tan",value:ZO.Tan},{label:"ArcTan",value:ZO.ArcTan},{label:"ArcCos",value:ZO.ArcCos},{label:"ArcSin",value:ZO.ArcSin},{label:"Sign",value:ZO.Sign},{label:"Negate",value:ZO.Negate},{label:"OneMinus",value:ZO.OneMinus},{label:"Reciprocal",value:ZO.Reciprocal},{label:"ToDegrees",value:ZO.ToDegrees},{label:"ToRadians",value:ZO.ToRadians},{label:"Fract",value:ZO.Fract}]})],oS.prototype,"operation",void 0),(0,U.g)("BABYLON.ParticleTrigonometryBlock",oS);var hS,aS=S(12732);class jS extends sO{constructor(H){super(H),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(AO.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(AO.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(AO.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(AO.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(AO.System),this._inputs[0].excludedConnectionPointTypes.push(AO.Particle),this._inputs[0].excludedConnectionPointTypes.push(AO.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const O=H=>{const O=this.input.getConnectedValue(H);if(this.log.length>=this.stackSize)return O;if(null===O||void 0===O)return this.log.push(["null",""]),O;switch(this.input.type){case AO.Vector2:this.log.push([(0,aS.g)(O,4),O.toString()]);break;case AO.eO:this.log.push([(0,aS.i)(O,4),O.toString()]);break;case AO.EU:this.log.push([`{R: ${O.r.toFixed(4)} G: ${O.g.toFixed(4)} B: ${O.b.toFixed(4)} A: ${O.a.toFixed(4)}}`,O.toString()]);break;default:this.log.push([O.toString(),O.toString()])}return O};this.output.isConnected?this.output._storedFunction=O:this.output._storedValue=O(H)}serialize(){const H=super.serialize();return H.stackSize=this.stackSize,H}_deserialize(H){super._deserialize(H),this.stackSize=H.stackSize}}(0,W.d)([iO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],jS.prototype,"stackSize",void 0),(0,U.g)("BABYLON.ParticleDebugBlock",jS);(0,U.g)("BABYLON.ParticleElbowBlock",class extends sO{constructor(H){super(H),this.registerInput("input",AO.AutoDetect),this.registerOutput("output",AO.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(H){super._build(H);const O=this._outputs[0],S=this._inputs[0];O._storedFunction=H=>S.getConnectedValue(H)}});(0,U.g)("BABYLON.ParticleTeleportInBlock",class extends sO{get endpoints(){return this._endpoints}constructor(H){super(H),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",AO.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(H){if(this.getClassName()===H)return!0;for(const O of this.endpoints)if(O.isAnAncestorOfType(H))return!0;return!1}isAnAncestorOf(H){for(const O of this.endpoints){if(O===H)return!0;if(O.isAnAncestorOf(H))return!0}return!1}attachToEndpoint(H){H.detach(),this._endpoints.push(H),H._entryPoint=this,H._outputs[0]._typeConnectionSource=this._inputs[0],H._tempEntryPointUniqueId=null,H.name="> "+this.name}detachFromEndpoint(H){const O=this._endpoints.indexOf(H);-1!==O&&(this._endpoints.splice(O,1),H._outputs[0]._typeConnectionSource=null,H._entryPoint=null)}_build(){for(const H of this._endpoints)H.output._storedFunction=H=>this.input.getConnectedValue(H)}});(0,U.g)("BABYLON.ParticleTeleportOutBlock",class extends sO{constructor(H){super(H),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",AO.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(H){this.entryPoint&&this.entryPoint.build(H)}clone(){const H=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(H),H}serialize(){var H;const O=super.serialize();return O.entryPoint=(null===(H=this.entryPoint)||void 0===H?void 0:H.uniqueId)??"",O}_deserialize(H){super._deserialize(H),this._tempEntryPointUniqueId=H.entryPoint}}),function(H){H[H.Equal=0]="Equal",H[H.NotEqual=1]="NotEqual",H[H.LessThan=2]="LessThan",H[H.GreaterThan=3]="GreaterThan",H[H.LessOrEqual=4]="LessOrEqual",H[H.GreaterOrEqual=5]="GreaterOrEqual",H[H.Xor=6]="Xor",H[H.Or=7]="Or",H[H.And=8]="And"}(hS||(hS={}));class eS extends sO{constructor(H){super(H),this.test=hS.Equal,this.epsilon=0,this.registerInput("left",AO.Float),this.registerInput("right",AO.Float,!0,0),this.registerInput("ifTrue",AO.AutoDetect,!0,1),this.registerInput("ifFalse",AO.AutoDetect,!0,0),this.registerOutput("output",AO.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=AO.Float,this._inputs[0].acceptedConnectionPointTypes.push(AO.Int),this._inputs[1].acceptedConnectionPointTypes.push(AO.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const H=H=>{const O=this.left.getConnectedValue(H),S=this.right.getConnectedValue(H);let t=!1;switch(this.test){case hS.Equal:t=(0,w.WithinEpsilon)(O,S,this.epsilon);break;case hS.NotEqual:t=!(0,w.WithinEpsilon)(O,S,this.epsilon);break;case hS.LessThan:t=O<S+this.epsilon;break;case hS.GreaterThan:t=O>S-this.epsilon;break;case hS.LessOrEqual:t=O<=S+this.epsilon;break;case hS.GreaterOrEqual:t=O>=S-this.epsilon;break;case hS.Xor:t=!!O&&!S||!O&&!!S;break;case hS.Or:t=!!O||!!S;break;case hS.And:t=!!O&&!!S}return t};this.output._storedFunction=O=>H(O)?this.ifTrue.getConnectedValue(O):this.ifFalse.getConnectedValue(O)}serialize(){const H=super.serialize();return H.test=this.test,H.epsilon=this.epsilon,H}_deserialize(H){super._deserialize(H),this.test=H.test,void 0!==H.epsilon&&(this.epsilon=H.epsilon)}}(0,W.d)([iO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:hS.Equal},{label:"NotEqual",value:hS.NotEqual},{label:"LessThan",value:hS.LessThan},{label:"GreaterThan",value:hS.GreaterThan},{label:"LessOrEqual",value:hS.LessOrEqual},{label:"GreaterOrEqual",value:hS.GreaterOrEqual},{label:"Xor",value:hS.Xor},{label:"Or",value:hS.Or},{label:"And",value:hS.And}]})],eS.prototype,"test",void 0),(0,W.d)([iO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eS.prototype,"epsilon",void 0),(0,U.g)("BABYLON.ParticleConditionBlock",eS);class XS extends sO{constructor(H){super(H),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",AO.Particle),this.registerInput("condition",AO.Float,!0,0),this.registerInput("system",AO.System),this.registerOutput("output",AO.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(H){this._triggerCount=0;const O=this.input.getConnectedValue(H),S={process:S=>{if(H.particleContext=S,H.systemContext=O,0!==this.condition.getConnectedValue(H)&&(0===this.limit||this._triggerCount<this.limit)){const t=(new Date).getTime();if(this._previousOne&&t-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=t;const q=this.system.getConnectedValue(H);if(q){const t=CO(q,H.EO,S.position);t.up.addOnce((()=>{this._triggerCount--})),O.up.addOnce((()=>{t.dispose()}))}}},previousItem:null,nextItem:null};O._updateQueueStart?cH(S,O._updateQueueStart):O._updateQueueStart=S,this.output._storedValue=O}serialize(){const H=super.serialize();return H.limit=this.limit,H.delay=this.delay,H}_deserialize(H){super._deserialize(H),void 0!==H.limit&&(this.limit=H.limit),void 0!==H.delay&&(this.delay=H.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,W.d)([iO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XS.prototype,"limit",void 0),(0,W.d)([iO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XS.prototype,"delay",void 0),(0,U.g)("BABYLON.ParticleTriggerBlock",XS);S(12737),S(12747),S(12753),S(12804)},12789:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12756:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12822:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneVertex",p="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12811:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12801:(H,O,S)=>{"use strict";var t=S(11223);const q="fogFragment",p="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12783:(H,O,S)=>{"use strict";var t=S(11223);const q="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12830:(H,O,S)=>{"use strict";var t=S(11223);const q="fogVertex",p="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12814:(H,O,S)=>{"use strict";var t=S(11223);const q="fogVertexDeclaration",p="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12769:(H,O,S)=>{"use strict";var t=S(11223);const q="helperFunctions",p="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12758:(H,O,S)=>{"use strict";var t=S(11223);const q="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12778:(H,O,S)=>{"use strict";var t=S(11223);const q="imageProcessingFunctions",p="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12763:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12795:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12834:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";t.d.IncludesShadersStoreWGSL[q]||(t.d.IncludesShadersStoreWGSL[q]=p)},12753:(H,O,S)=>{"use strict";S.r(O),S.d(O,{particlesPixelShaderWGSL:()=>G});var t=S(11223);S(12756),S(12758),S(12763),S(12769),S(12778),S(12783),S(12789),S(12795),S(12801);const q="particlesPixelShader",p="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.d.ShadersStoreWGSL[q]||(t.d.ShadersStoreWGSL[q]=p);const G={name:q,shader:p}},12804:(H,O,S)=>{"use strict";S.r(O),S.d(O,{particlesVertexShaderWGSL:()=>G});var t=S(11223);S(12811),S(12814),S(12763),S(12822),S(12830),S(12834);const q="particlesVertexShader",p="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.d.ShadersStoreWGSL[q]||(t.d.ShadersStoreWGSL[q]=p);const G={name:q,shader:p}},12666:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12742:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12691:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneVertex",p="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12749:(H,O,S)=>{"use strict";var t=S(11223);const q="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12680:(H,O,S)=>{"use strict";var t=S(11223);const q="fogFragment",p="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12662:(H,O,S)=>{"use strict";var t=S(11223);const q="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12700:(H,O,S)=>{"use strict";var t=S(11223);const q="fogVertex",p="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12688:(H,O,S)=>{"use strict";var t=S(11223);const q="fogVertexDeclaration",p="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12646:(H,O,S)=>{"use strict";var t=S(11223);const q="helperFunctions",p="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12631:(H,O,S)=>{"use strict";var t=S(11223);const q="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12655:(H,O,S)=>{"use strict";var t=S(11223);const q="imageProcessingFunctions",p="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12639:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12672:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12702:(H,O,S)=>{"use strict";var t=S(11223);const q="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";t.d.IncludesShadersStore[q]||(t.d.IncludesShadersStore[q]=p)},12737:(H,O,S)=>{"use strict";S.r(O),S.d(O,{particlesPixelShader:()=>G});var t=S(11223);S(12742),S(12631),S(12639),S(12646),S(12655),S(12662),S(12666),S(12672),S(12680);const q="particlesPixelShader",p="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.d.ShadersStore[q]||(t.d.ShadersStore[q]=p);const G={name:q,shader:p}},12747:(H,O,S)=>{"use strict";S.r(O),S.d(O,{particlesVertexShader:()=>G});var t=S(11223);S(12749),S(12688),S(12639),S(12691),S(12700),S(12702);const q="particlesVertexShader",p="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.d.ShadersStore[q]||(t.d.ShadersStore[q]=p);const G={name:q,shader:p}},13096:(H,O,S)=>{"use strict";S.r(O),S.d(O,{FlowGraphGLTFDataProvider:()=>p});var t=S(13063),q=S(13035);class p extends t.c{constructor(H){var O,S;super();const t=H.glTF,p=(null===(O=t.animations)||void 0===O?void 0:O.map((H=>H._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",q.e,p);const G=(null===(S=t.nodes)||void 0===S?void 0:S.map((H=>H._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",q.e,G)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12975:(H,O,S)=>{"use strict";S.d(O,{b:()=>E,c:()=>e,f:()=>j,h:()=>X});var t=S(11301),q=S(11783),p=S(11355),G=S(12980);const U=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class V{constructor(H,O){this._gltf=H,this._infoTree=O}convert(H){let O,S=this._gltf,t=this._infoTree;if(!H.startsWith("/"))throw new Error("Path must start with a /");const q=H.split("/");if(q.shift(),q[q.length-1].includes(".length")){const H=q[q.length-1].split(".");q.pop(),q.push(...H)}let p=!1;for(const V of q){const q="length"===V;if(q&&!t.__array__)throw new Error(`Path ${H} is invalid`);if(t.__ignoreObjectTree__&&(p=!0),t.__array__&&!q)t=t.__array__;else if(t=t[V],!t)throw new Error(`Path ${H} is invalid`);if(!p)if(void 0===S){if(!U.find((O=>O.regex.test(H))))throw new Error(`Path ${H} is invalid`)}else if(!q){var G;S=null===(G=S)||void 0===G?void 0:G[V]}(t.__target__||q)&&(O=S)}return{object:O,info:t}}}function w(H,O,S,t){const q=o(H,O);return t?q[S][t]:q[S]}function o(H,O,S){var t,p;return null===(t=H._data)||void 0===t||null===(p=t[(null===S||void 0===S?void 0:S.fillMode)??q.b.MATERIAL_TriangleFillMode])||void 0===p?void 0:p.babylonMaterial}function h(H,O){return{offset:{componentsCount:2,type:"Vector2",get:(S,q,p)=>{const G=w(S,p,H,O);return new t.Vector2(null===G||void 0===G?void 0:G.uOffset,null===G||void 0===G?void 0:G.vOffset)},getTarget:o,set:(S,t,q,p)=>{const G=w(t,p,H,O);G.uOffset=S.x,G.vOffset=S.y},getPropertyName:[()=>`${H}${O?"."+O:""}.uOffset`,()=>`${H}${O?"."+O:""}.vOffset`]},rotation:{type:"number",get:(S,t,q)=>{var p;return null===(p=w(S,q,H,O))||void 0===p?void 0:p.wAng},getTarget:o,set:(S,t,q,p)=>w(t,p,H,O).wAng=S,getPropertyName:[()=>`${H}${O?"."+O:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(S,q,p)=>{const G=w(S,p,H,O);return new t.Vector2(null===G||void 0===G?void 0:G.uScale,null===G||void 0===G?void 0:G.vScale)},getTarget:o,set:(S,t,q,p)=>{const G=w(t,p,H,O);G.uScale=S.x,G.vScale=S.y},getPropertyName:[()=>`${H}${O?"."+O:""}.uScale`,()=>`${H}${O?"."+O:""}.vScale`]}}}const a={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:H=>{var O,S;return new t.Vector2((null===(O=H._babylonCamera)||void 0===O?void 0:O.orthoLeft)??0,(null===(S=H._babylonCamera)||void 0===S?void 0:S.orthoRight)??0)},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.orthoLeft=H.x,O._babylonCamera.orthoRight=H.y)},getTarget:H=>H,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:H=>{var O,S;return new t.Vector2((null===(O=H._babylonCamera)||void 0===O?void 0:O.orthoBottom)??0,(null===(S=H._babylonCamera)||void 0===S?void 0:S.orthoTop)??0)},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.orthoBottom=H.x,O._babylonCamera.orthoTop=H.y)},getTarget:H=>H,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.maxZ},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=H)},getTarget:H=>H,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.UU},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.UU=H)},getTarget:H=>H,getPropertyName:[()=>"UU"]}},perspective:{aspectRatio:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.getEngine().getAspectRatio(H._babylonCamera)},getTarget:H=>H,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.fov},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.fov=H)},getTarget:H=>H,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.maxZ},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.maxZ=H)},getTarget:H=>H,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:H=>{var O;return null===(O=H._babylonCamera)||void 0===O?void 0:O.UU},set:(H,O)=>{O._babylonCamera&&(O._babylonCamera.UU=H)},getTarget:H=>H,getPropertyName:[()=>"UU"]}}}},nodes:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"eO",get:H=>{var O;return null===(O=H._babylonTransformNode)||void 0===O?void 0:O.position},set:(H,O)=>{var S;return null===(S=O._babylonTransformNode)||void 0===S?void 0:S.position.t(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:H=>{var O;return null===(O=H._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion},set:(H,O)=>{var S,t;return null===(S=O._babylonTransformNode)||void 0===S||null===(t=S.rotationQuaternion)||void 0===t?void 0:t.t(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"eO",get:H=>{var O;return null===(O=H._babylonTransformNode)||void 0===O?void 0:O.eU},set:(H,O)=>{var S;return null===(S=O._babylonTransformNode)||void 0===S?void 0:S.eU.t(H)},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"eU"]},weights:{length:{type:"number",get:H=>H._numMorphTargets,getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(H,O)=>{var S,t;return void 0!==O?null===(S=H._primitiveBabylonMeshes)||void 0===S||null===(t=S[0].morphTargetManager)||void 0===t?void 0:t.getTarget(O).influence:void 0},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(H,O)=>[0],getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:H=>{var O,S,q;return t.Matrix.Compose(null===(O=H._babylonTransformNode)||void 0===O?void 0:O.eU,null===(S=H._babylonTransformNode)||void 0===S?void 0:S.rotationQuaternion,null===(q=H._babylonTransformNode)||void 0===q?void 0:q.position)},getTarget:H=>H._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:H=>{var O,S,q,p;const G=t.Matrix.Identity();let U=H.parent;for(;U&&U.parent;)U=U.parent;const V=(null===(O=H._babylonTransformNode)||void 0===O?void 0:O.position._isDirty)||(null===(S=H._babylonTransformNode)||void 0===S||null===(q=S.rotationQuaternion)||void 0===q?void 0:q._isDirty)||(null===(p=H._babylonTransformNode)||void 0===p?void 0:p.eU._isDirty);if(U){var w;const O=null===(w=U._babylonTransformNode)||void 0===w?void 0:w.wU(!0).invert();var o,h;if(O)null===(o=H._babylonTransformNode)||void 0===o||null===(h=o.wU(V))||void 0===h||h.multiplyToRef(O,G)}else H._babylonTransformNode&&G.t(H._babylonTransformNode.wU(V));return G},getTarget:H=>H._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:H=>{var O,S;return null===(O=H._babylonTransformNode)||void 0===O||null===(S=O.getChildren((H=>H instanceof G.b),!0)[0])||void 0===S?void 0:S.KU},getTarget:H=>{var O;return null===(O=H._babylonTransformNode)||void 0===O?void 0:O.getChildren((H=>H instanceof G.b),!0)[0]},set:(H,O)=>{if(O._babylonTransformNode){const S=O._babylonTransformNode.getChildren((H=>H instanceof G.b),!0)[0];S&&(S.KU=H)}}},color:{type:"TO",get:H=>{var O,S;return null===(O=H._babylonTransformNode)||void 0===O||null===(S=O.getChildren((H=>H instanceof G.b),!0)[0])||void 0===S?void 0:S.bU},getTarget:H=>{var O;return null===(O=H._babylonTransformNode)||void 0===O?void 0:O.getChildren((H=>H instanceof G.b),!0)[0]},set:(H,O)=>{if(O._babylonTransformNode){const S=O._babylonTransformNode.getChildren((H=>H instanceof G.b),!0)[0];S&&(S.bU=H)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"TO",get:(H,O,S)=>o(H,O,S).emissiveColor,set:(H,O,S,t)=>o(O,S,t).emissiveColor.t(H),getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:h("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(H,O,S)=>{var t;return null===(t=w(H,S,"bumpTexture"))||void 0===t?void 0:t.level},set:(H,O,S,t)=>{const q=w(O,t,"bumpTexture");q&&(q.level=H)},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:h("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(H,O,S)=>o(H,O,S).ambientTextureStrength,set:(H,O,S,t)=>{const q=o(O,S,t);q&&(q.ambientTextureStrength=H)},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:h("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"EU",get:(H,O,S)=>{const t=o(H,O,S);return p.EU.FromColor3(t.albedoColor,t.alpha)},set:(H,O,S,t)=>{const q=o(O,S,t);q.albedoColor.set(H.r,H.g,H.b),q.alpha=H.a},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:h("albedoTexture")}},metallicFactor:{type:"number",get:(H,O,S)=>o(H,O,S).metallic,set:(H,O,S,t)=>{const q=o(O,S,t);q&&(q.metallic=H)},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(H,O,S)=>o(H,O,S).roughness,set:(H,O,S,t)=>{const q=o(O,S,t);q&&(q.roughness=H)},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:h("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(H,O,S)=>o(H,O,S).anisotropy.KU,set:(H,O,S,t)=>{o(O,S,t).anisotropy.KU=H},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(H,O,S)=>o(H,O,S).anisotropy.angle,set:(H,O,S,t)=>{o(O,S,t).anisotropy.angle=H},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:h("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(H,O,S)=>o(H,O,S).clearCoat.KU,set:(H,O,S,t)=>{o(O,S,t).clearCoat.KU=H},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(H,O,S)=>o(H,O,S).clearCoat.roughness,set:(H,O,S,t)=>{o(O,S,t).clearCoat.roughness=H},getTarget:(H,O,S)=>o(H,O,S),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:h("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(H,O,S)=>{var t;return null===(t=o(H,O,S).clearCoat.bumpTexture)||void 0===t?void 0:t.level},getTarget:o,set:(H,O,S,t)=>o(O,S,t).clearCoat.bumpTexture.level=H},extensions:{KHR_texture_transform:h("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:h("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(H,O,S)=>o(H,O,S).subSurface.dispersion,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.dispersion=H}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(H,O,S)=>o(H,O,S).emissiveIntensity,getTarget:o,set:(H,O,S,t)=>o(O,S,t).emissiveIntensity=H}},KHR_materials_ior:{ior:{type:"number",get:(H,O,S)=>o(H,O,S).indexOfRefraction,getTarget:o,set:(H,O,S,t)=>o(O,S,t).indexOfRefraction=H}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(H,O,S)=>o(H,O,S).iridescence.KU,getTarget:o,set:(H,O,S,t)=>o(O,S,t).iridescence.KU=H},iridescenceIor:{type:"number",get:(H,O,S)=>o(H,O,S).iridescence.indexOfRefraction,getTarget:o,set:(H,O,S,t)=>o(O,S,t).iridescence.indexOfRefraction=H},iridescenceTexture:{extensions:{KHR_texture_transform:h("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(H,O,S)=>o(H,O,S).iridescence.maximumThickness,getTarget:o,set:(H,O,S,t)=>o(O,S,t).iridescence.maximumThickness=H},iridescenceThicknessMinimum:{type:"number",get:(H,O,S)=>o(H,O,S).iridescence.minimumThickness,getTarget:o,set:(H,O,S,t)=>o(O,S,t).iridescence.minimumThickness=H},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:h("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"TO",get:(H,O,S)=>o(H,O,S).sheen.color,getTarget:o,set:(H,O,S,t)=>o(O,S,t).sheen.color.t(H)},sheenColorTexture:{extensions:{KHR_texture_transform:h("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(H,O,S)=>o(H,O,S).sheen.KU,getTarget:o,set:(H,O,S,t)=>o(O,S,t).sheen.KU=H},sheenRoughnessTexture:{extensions:{KHR_texture_transform:h("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(H,O,S)=>o(H,O,S).metallicF0Factor,getTarget:o,set:(H,O,S,t)=>o(O,S,t).metallicF0Factor=H,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"TO",get:(H,O,S)=>o(H,O,S).metallicReflectanceColor,getTarget:o,set:(H,O,S,t)=>o(O,S,t).metallicReflectanceColor.t(H),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:h("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:h("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(H,O,S)=>o(H,O,S).subSurface.refractionIntensity,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.refractionIntensity=H,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(H,O,S)=>o(H,O,S).subSurface.translucencyIntensity,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.translucencyIntensity=H},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"TO",get:(H,O,S)=>o(H,O,S).subSurface.translucencyColor,getTarget:o,set:(H,O,S,t)=>{var q;return H&&(null===(q=o(O,S,t).subSurface.translucencyColor)||void 0===q?void 0:q.t(H))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"TO",get:(H,O,S)=>o(H,O,S).subSurface.tintColor,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.tintColor.t(H)},attenuationDistance:{type:"number",get:(H,O,S)=>o(H,O,S).subSurface.tintColorAtDistance,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.tintColorAtDistance=H},thicknessFactor:{type:"number",get:(H,O,S)=>o(H,O,S).subSurface.maximumThickness,getTarget:o,set:(H,O,S,t)=>o(O,S,t).subSurface.maximumThickness=H},thicknessTexture:{extensions:{KHR_texture_transform:h("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonLight)),getPropertyName:[H=>"length"]},__array__:{__target__:!0,color:{type:"TO",get:H=>{var O;return null===(O=H._babylonLight)||void 0===O?void 0:O.bU},set:(H,O)=>{var S;return null===(S=O._babylonLight)||void 0===S?void 0:S.bU.t(H)},getTarget:H=>H._babylonLight,getPropertyName:[H=>"diffuse"]},KU:{type:"number",get:H=>{var O;return null===(O=H._babylonLight)||void 0===O?void 0:O.KU},set:(H,O)=>O._babylonLight?O._babylonLight.KU=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"intensity"]},range:{type:"number",get:H=>{var O;return null===(O=H._babylonLight)||void 0===O?void 0:O.range},set:(H,O)=>O._babylonLight?O._babylonLight.range=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"range"]},spot:{innerConeAngle:{type:"number",get:H=>{var O;return null===(O=H._babylonLight)||void 0===O?void 0:O.innerAngle},set:(H,O)=>O._babylonLight?O._babylonLight.innerAngle=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"innerConeAngle"]},outerConeAngle:{type:"number",get:H=>{var O;return null===(O=H._babylonLight)||void 0===O?void 0:O.angle},set:(H,O)=>O._babylonLight?O._babylonLight.angle=H:void 0,getTarget:H=>H._babylonLight,getPropertyName:[H=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonLight)),getPropertyName:[H=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonTexture)),getPropertyName:[H=>"length"]},__array__:{__target__:!0,KU:{type:"number",get:H=>{var O;return null===(O=H._babylonTexture)||void 0===O?void 0:O.level},set:(H,O)=>{O._babylonTexture&&(O._babylonTexture.level=H)},getTarget:H=>H._babylonTexture},rotation:{type:"Quaternion",get:H=>{var O;return H._babylonTexture&&t.Quaternion.FromRotationMatrix(null===(O=H._babylonTexture)||void 0===O?void 0:O.getReflectionTextureMatrix())},set:(H,O)=>{var S;O._babylonTexture&&(null!==(S=O._babylonTexture.YH())&&void 0!==S&&S.useRightHandedSystem||(H=t.Quaternion.Inverse(H)),t.Matrix.FromQuaternionToRef(H,O._babylonTexture.getReflectionTextureMatrix()))},getTarget:H=>H._babylonTexture}}}}},animations:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>H._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:H=>H.length,getTarget:H=>H.map((H=>{var O;return null===(O=H.primitives[0]._instanceData)||void 0===O?void 0:O.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function j(H){return new V(H,a)}function e(H){const O=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let S=a;for(const t of O)t&&(S=S[t]);if(S&&S.type&&S.get)return S}function X(H,O){const S=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let t=a;for(const q of S)q&&(t=t[q]);t&&t.type&&t.get&&(t.interpolation=O)}function E(H,O){const S=H.split("/").map((H=>H.replace(/{}/g,"__array__")));let t=a;for(const q of S)if(q){if(!t[q]){if("?"===q){t.__ignoreObjectTree__=!0;continue}t[q]={},"__array__"===q&&(t[q].__target__=!0)}t=t[q]}Object.assign(t,O)}},12988:(H,O,S)=>{"use strict";S.r(O),S.d(O,{AnimationPropertyInfo:()=>w,TransformNodeAnimationPropertyInfo:()=>o,WeightAnimationPropertyInfo:()=>h,getQuaternion:()=>U,getVector3:()=>G,getWeights:()=>V});var t=S(11831),q=S(11301),p=S(12975);function G(H,O,S,t){return q.eO.KO(O,S).scaleInPlace(t)}function U(H,O,S,t){return q.Quaternion.KO(O,S).scaleInPlace(t)}function V(H,O,S,t){const q=new Array(H._numMorphTargets);for(let p=0;p<q.length;p++)q[p]=O[S++]*t;return q}class w{constructor(H,O,S,t){this.type=H,this.name=O,this.getValue=S,this.getStride=t}_buildAnimation(H,O,S){const q=new t.d(H,this.name,O,this.type);return q.setKeys(S),q}}class o extends w{buildAnimations(H,O,S,t){const q=[];return q.push({babylonAnimatable:H._babylonTransformNode,babylonAnimation:this._buildAnimation(O,S,t)}),q}}class h extends w{buildAnimations(H,O,S,q){const p=[];if(H._numMorphTargets)for(let G=0;G<H._numMorphTargets;G++){const U=new t.d(`${O}_${G}`,this.name,S,this.type);if(U.setKeys(q.map((H=>({frame:H.frame,inTangent:H.inTangent?H.inTangent[G]:void 0,value:H.value[G],outTangent:H.outTangent?H.outTangent[G]:void 0,interpolation:H.interpolation})))),H._primitiveBabylonMeshes)for(const O of H._primitiveBabylonMeshes)if(O.morphTargetManager){const H=O.morphTargetManager.getTarget(G),S=U.clone();H.animations.push(S),p.push({babylonAnimatable:H,babylonAnimation:S})}}return p}}(0,p.h)("/nodes/{}/translation",[new o(t.d.ANIMATIONTYPE_VECTOR3,"position",G,(()=>3))]),(0,p.h)("/nodes/{}/rotation",[new o(t.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",U,(()=>4))]),(0,p.h)("/nodes/{}/scale",[new o(t.d.ANIMATIONTYPE_VECTOR3,"eU",G,(()=>3))]),(0,p.h)("/nodes/{}/weights",[new h(t.d.ANIMATIONTYPE_FLOAT,"influence",V,(H=>H._numMorphTargets))])},12934:(H,O,S)=>{"use strict";class t{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((H,O)=>{this._resolve=H,this._reject=O}))}}var q=S(11301),p=S(11355),G=S(11131),U=S(11764),V=S(12938),w=S(12954),o=S(11140),h=S(11781),a=S(11831),j=S(11836),e=S(11180),X=S(11151),E=S(11160);class y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(H){this._useTextureToStoreBoneMatrices=H,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(H){this._animationPropertiesOverride=H}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(H,O,S){this.name=H,this.id=O,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new o.b,this.bones=[],this._scene=S||e.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const t=this._scene.getEngine().getCaps();this._canUseTextureForBones=t.textureFloat&&t.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((H=>!H.getParent()))}getTransformMatrices(H){if(this.needInitialSkinMatrix){if(!H)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return H._bonesTransformMatrices||this.prepare(!0),H._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(H){return this.needInitialSkinMatrix&&H._transformMatrixTexture?H._transformMatrixTexture:this._transformMatrixTexture}YH(){return this._scene}toString(H){let O=`Name: ${this.name}, nBones: ${this.bones.length}`;if(O+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,H){O+=", Ranges: {";let H=!0;for(const S in this._ranges)H&&(O+=", ",H=!1),O+=S;O+="}"}return O}getBoneIndexByName(H){for(let O=0,S=this.bones.length;O<S;O++)if(this.bones[O].name===H)return O;return-1}createAnimationRange(H,O,S){if(!this._ranges[H]){this._ranges[H]=new j.c(H,O,S);for(let t=0,q=this.bones.length;t<q;t++)this.bones[t].animations[0]&&this.bones[t].animations[0].createRange(H,O,S)}}deleteAnimationRange(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let S=0,t=this.bones.length;S<t;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].deleteRange(H,O);this._ranges[H]=null}getAnimationRange(H){return this._ranges[H]||null}getAnimationRanges(){const H=[];let O;for(O in this._ranges)H.push(this._ranges[O]);return H}copyAnimationRange(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[O]||!H.getAnimationRange(O))return!1;let t=!0;const q=this._getHighestAnimationFrame()+1,p={},G=H.bones;let U,V;for(V=0,U=G.length;V<U;V++)p[G[V].name]=G[V];this.bones.length!==G.length&&(X.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${G.length}`),t=!1);const w=S&&this.dimensionsAtRest&&H.dimensionsAtRest?this.dimensionsAtRest.divide(H.dimensionsAtRest):null;for(V=0,U=this.bones.length;V<U;V++){const H=this.bones[V].name,G=p[H];G?t=t&&this.bones[V].copyAnimationRange(G,O,q,S,w):(X.b.Warn("copyAnimationRange: not same rig, missing source bone "+H),t=!1)}const o=H.getAnimationRange(O);return o&&(this._ranges[O]=new j.c(O,o.from+q,o.to+q)),t}returnToRest(){for(const H of this.bones)-1!==H._index&&H.returnToRest()}_getHighestAnimationFrame(){let H=0;for(let O=0,S=this.bones.length;O<S;O++)if(this.bones[O].animations[0]){const S=this.bones[O].animations[0].getHighestFrame();H<S&&(H=S)}return H}beginAnimation(H,O,S,t){const q=this.getAnimationRange(H);return q?this._scene.beginAnimation(this,q.from,q.to,O,S,t):null}static MakeAnimationAdditive(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,S=arguments.length>2?arguments[2]:void 0;const t=H.getAnimationRange(S);if(!t)return null;const q=H._scene.getAllAnimatablesByTarget(H);let p=null;for(let U=0;U<q.length;U++){const H=q[U];if(H.fromFrame===(null===t||void 0===t?void 0:t.from)&&H.toFrame===(null===t||void 0===t?void 0:t.to)){p=H;break}}const G=H.getAnimatables();for(let U=0;U<G.length;U++){const H=G[U].animations;if(H)for(let t=0;t<H.length;t++)a.d.MakeAnimationAdditive(H[t],O,S)}return p&&(p.isAdditive=!0),H}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(H){this._meshesWithPoseMatrix.push(H)}_unregisterMeshWithPoseMatrix(H){const O=this._meshesWithPoseMatrix.indexOf(H);O>-1&&this._meshesWithPoseMatrix.splice(O,1)}_computeTransformMatrices(H,O){this.onBeforeComputeObservable.notifyObservers(this);for(let S=0;S<this.bones.length;S++){const t=this.bones[S];t._childUpdateId++;const q=t.getParent();if(q?t.getLocalMatrix().multiplyToRef(q.getFinalMatrix(),t.getFinalMatrix()):O?t.getLocalMatrix().multiplyToRef(O,t.getFinalMatrix()):t.getFinalMatrix().t(t.getLocalMatrix()),-1!==t._index){const O=null===t._index?S:t._index;t.getAbsoluteInverseBindMatrix().multiplyToArray(t.getFinalMatrix(),H,16*O)}}this._identity.copyToArray(H,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const H=this.YH().getRenderId();if(this._currentRenderId===H)return;this._currentRenderId=H}if(this._numBonesWithLinkedTransformNode>0)for(const H of this.bones)if(H._linkedTransformNode){const O=H._linkedTransformNode;H.position=O.position,O.rotationQuaternion?H.rotationQuaternion=O.rotationQuaternion:H.rotation=O.rotation,H.eU=O.eU}if(this.needInitialSkinMatrix)for(const H of this._meshesWithPoseMatrix){const O=H.getPoseMatrix();let S=this._isDirty;if(H._bonesTransformMatrices&&H._bonesTransformMatrices.length===16*(this.bones.length+1)||(H._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),S=!0),S){if(this._synchronizedWithMesh!==H){this._synchronizedWithMesh=H;for(const H of this.bones)if(!H.getParent()){H.getBindMatrix().multiplyToRef(O,q.TmpVectors.Matrix[1]),H._updateAbsoluteBindMatrices(q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const O=4*(this.bones.length+1);H._transformMatrixTexture&&H._transformMatrixTexture.getSize().width===O||(H._transformMatrixTexture&&H._transformMatrixTexture.dispose(),H._transformMatrixTexture=h.b.CreateRGBATexture(H._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(H._bonesTransformMatrices,O),this.isUsingTextureForMatrices&&H._transformMatrixTexture&&H._transformMatrixTexture.update(H._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=h.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let H=0;H<this.bones.length;H++)this._animatables.push(this.bones[H])}return this._animatables}clone(H,O){const S=new y(H,O||H,this._scene);S.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const H=this.bones[t];let O=null;const q=H.getParent();if(q){const H=this.bones.indexOf(q);O=S.bones[H]}const p=new w.c(H.name,S,O,H.getBindMatrix().clone(),H.getRestMatrix().clone());p._index=H._index,H._linkedTransformNode&&p.linkTransformNode(H._linkedTransformNode),E.e.DeepCopy(H.animations,p.animations)}if(this._ranges){S._ranges={};for(const H in this._ranges){const O=this._ranges[H];O&&(S._ranges[H]=O.clone())}}return this._isDirty=!0,S.prepare(!0),S}enableBlending(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const O of this.bones)for(const S of O.animations)S.enableBlending=!0,S.blendingSpeed=H}dispose(){if(this._meshesWithPoseMatrix.length=0,this.YH().stopAnimation(this),this.YH().removeSkeleton(this),this._parentContainer){const H=this._parentContainer.skeletons.indexOf(this);H>-1&&this._parentContainer.skeletons.splice(H,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const H={};H.name=this.name,H.id=this.id,this.dimensionsAtRest&&(H.dimensionsAtRest=this.dimensionsAtRest.pU()),H.bones=[],H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){var O;const t=this.bones[S],q=t.getParent(),p={parentBoneIndex:q?this.bones.indexOf(q):-1,index:t.getIndex(),name:t.name,id:t.id,matrix:t.getBindMatrix().pU(),rest:t.getRestMatrix().pU(),linkedTransformNodeId:null===(O=t.getTransformNode())||void 0===O?void 0:O.id};H.bones.push(p),t.length&&(p.length=t.length),t.metadata&&(p.metadata=t.metadata),t.animations&&t.animations.length>0&&(p.animation=t.animations[0].serialize()),H.ranges=[];for(const O in this._ranges){const S=this._ranges[O];if(!S)continue;const t={};t.name=O,t.from=S.from,t.to=S.to,H.ranges.push(t)}}return H}static Parse(H,O){const S=new y(H.name,H.id,O);let t;for(H.dimensionsAtRest&&(S.dimensionsAtRest=q.eO.KO(H.dimensionsAtRest)),S.needInitialSkinMatrix=H.needInitialSkinMatrix,t=0;t<H.bones.length;t++){const O=H.bones[t],p=H.bones[t].index;let G=null;O.parentBoneIndex>-1&&(G=S.bones[O.parentBoneIndex]);const U=O.rest?q.Matrix.KO(O.rest):null,V=new w.c(O.name,S,G,q.Matrix.KO(O.matrix),U,null,p);void 0!==O.id&&null!==O.id&&(V.id=O.id),O.length&&(V.length=O.length),O.metadata&&(V.metadata=O.metadata),O.animation&&V.animations.push(a.d.Parse(O.animation)),void 0!==O.linkedTransformNodeId&&null!==O.linkedTransformNodeId&&(S._hasWaitingData=!0,V._waitingTransformNodeId=O.linkedTransformNodeId)}if(H.ranges)for(t=0;t<H.ranges.length;t++){const O=H.ranges[t];S.createAnimationRange(O.name,O.from,O.to)}return S}computeAbsoluteMatrices(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||H)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(H)}getPoseMatrix(){let H=null;return this._meshesWithPoseMatrix.length>0&&(H=this._meshesWithPoseMatrix[0].getPoseMatrix()),H}sortBones(){const H=[],O=new Array(this.bones.length);for(let S=0;S<this.bones.length;S++)this._sortBones(S,H,O);this.bones=H}_sortBones(H,O,S){if(S[H])return;S[H]=!0;const t=this.bones[H];if(!t)return;void 0===t._index&&(t._index=H);const q=t.getParent();q&&this._sortBones(this.bones.indexOf(q),O,S),O.push(t)}setCurrentPoseAsRest(){for(const H of this.bones)H.setCurrentPoseAsRest()}}var T=S(11624),K=S(11791),b=S(11279),D=S(11718),F=S(11378),Y=S(11768),l=S(11734),d=S(11757),v=S(11842),z=S(11398),m=S(12903);class r{set areUpdatesFrozen(H){H?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new z.i(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,H||(H=e.c.LastCreatedScene),this._scene=H,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const H=this._scene.getEngine().getCaps();this._canUseTextureForTargets=H.canUseGLVertexID&&H.textureFloat&&H.maxVertexTextureImageUnits>0&&H.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return r.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?r.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(H){this._numMaxInfluencers!==H&&(this._numMaxInfluencers=H,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(H){this._useTextureToStoreTargets!==H&&(this._useTextureToStoreTargets=H,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var H;return r.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(H=this._scene)&&void 0!==H&&H.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(H){return this._activeTargets.data[H]}getTarget(H){return this._targets[H]}getTargetByName(H){for(const O of this._targets)if(O.name===H)return O;return null}addTarget(H){this._targets.push(H),this._targetInfluenceChangedObservers.push(H.onInfluenceChanged.add((H=>{this.areUpdatesFrozen&&H&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(H)}))),this._targetDataLayoutChangedObservers.push(H._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(H){const O=this._targets.indexOf(H);O>=0&&(this._targets.splice(O,1),H.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(O,1)[0]),H._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(O,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(H)}_bind(H){H.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),H.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),H.setTexture("morphTargets",this._targetStoreTexture),H.setInt("morphTargetCount",this.numInfluencers)}clone(){const H=new r(this._scene);for(const O of this._targets)H.addTarget(O.clone());return H.enablePositionMorphing=this.enablePositionMorphing,H.enableNormalMorphing=this.enableNormalMorphing,H.enableTangentMorphing=this.enableTangentMorphing,H.enableUVMorphing=this.enableUVMorphing,H.enableUV2Morphing=this.enableUV2Morphing,H.enableColorMorphing=this.enableColorMorphing,H}serialize(){const H={};H.id=this.uniqueId,H.targets=[];for(const O of this._targets)H.targets.push(O.serialize());return H}_syncActiveTargets(){let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const O=!!this._targetStoreTexture,S=this.isUsingTextureForTargets;(this._mustSynchronize||O!==S)&&(this._mustSynchronize=!1,this.synchronize());let t=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const p of this._targets)if(q++,0!==p.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=r.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(p),this._morphTargetTextureIndices[t]=q,this._tempInfluences[t++]=p.influence}this._morphTargetTextureIndices.length!==t&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,t)),this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(let p=0;p<t;p++)this._influences[p]=this._tempInfluences[p];if(H&&this._scene)for(const p of this._scene.meshes)p.morphTargetManager===this&&(S?p._markSubMeshesAsAttributesDirty():p._syncGeometryWithMorphTargetManager())}synchronize(){var H;if(!this._scene||this.areUpdatesFrozen)return;const O=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(H=this._targetStoreTexture)||void 0===H||H.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>O.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const S of this._targets){this._supportsPositions=this._supportsPositions&&S.hasPositions,this._supportsNormals=this._supportsNormals&&S.hasNormals,this._supportsTangents=this._supportsTangents&&S.hasTangents,this._supportsUVs=this._supportsUVs&&S.hasUVs,this._supportsUV2s=this._supportsUV2s&&S.hasUV2s,this._supportsColors=this._supportsColors&&S.hasColors;const H=S.vertexCount;if(0===this._vertexCount)this._vertexCount=H;else if(this._vertexCount!==H)return void X.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${S.name}": ${H}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const H=O.getCaps().maxTextureSize;this._textureWidth>H&&(this._textureHeight=Math.ceil(this._textureWidth/H),this._textureWidth=H);const S=this._targets.length,t=new Float32Array(S*this._textureWidth*this._textureHeight*4);let q=0;for(let O=0;O<S;O++){const H=this._targets[O],S=H.getPositions(),p=H.getNormals(),G=H.getUVs(),U=H.getTangents(),V=H.getUV2s(),w=H.getColors();q=O*this._textureWidth*this._textureHeight*4;for(let O=0;O<this._vertexCount;O++)this._supportsPositions&&S&&(t[q]=S[3*O],t[q+1]=S[3*O+1],t[q+2]=S[3*O+2],q+=4),this._supportsNormals&&p&&(t[q]=p[3*O],t[q+1]=p[3*O+1],t[q+2]=p[3*O+2],q+=4),this._supportsUVs&&G&&(t[q]=G[2*O],t[q+1]=G[2*O+1],q+=4),this._supportsTangents&&U&&(t[q]=U[3*O],t[q+1]=U[3*O+1],t[q+2]=U[3*O+2],q+=4),this._supportsUV2s&&V&&(t[q]=V[2*O],t[q+1]=V[2*O+1],q+=4),this._supportsColors&&w&&(t[q]=w[4*O],t[q+1]=w[4*O+1],t[q+2]=w[4*O+2],t[q+3]=w[4*O+3],q+=4)}this._targetStoreTexture=m.e.CreateRGBATexture(t,this._textureWidth,this._textureHeight,S,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const S of this._scene.meshes)S.morphTargetManager===this&&S._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const H=this._parentContainer.morphTargetManagers.indexOf(this);H>-1&&this._parentContainer.morphTargetManagers.splice(H,1),this._parentContainer=null}for(const H of this._targets)this._scene.stopAnimation(H)}}static Parse(H,O){const S=new r(O);for(const t of H.targets)S.addTarget(v.c.Parse(t,O));return S}}r.EnableTextureStorage=!0,r.MaxActiveMorphTargetsInVertexAttributeMode=8,r.ConstantTargetCountForTextureMode=0;var W=S(12962),g=S(11188),N=S(11644);const x=new Map,k=x;function A(H,O,S){u(H)&&X.b.Warn(`Extension with the name '${H}' already exists`),x.set(H,{isGLTFExtension:O,factory:S})}function u(H){return x.delete(H)}var J=S(12975),P=S(11895),f=S(11386);class c{static Get(H,O,S){if(!O||void 0==S||!O[S])throw new Error(`${H}: Failed to find index (${S})`);return O[S]}static TryGet(H,O){return H&&void 0!=O&&H[O]?H[O]:null}static Assign(H){if(H)for(let O=0;O<H.length;O++)H[O].index=O}}function R(H){if(H.min&&H.max){const O=H.min,S=H.max,t=q.TmpVectors.eO[0].jU(O[0],O[1],O[2]),p=q.TmpVectors.eO[1].jU(S[0],S[1],S[2]);if(H.normalized&&5126!==H.componentType){let O=1;switch(H.componentType){case 5120:O=127;break;case 5121:O=255;break;case 5122:O=32767;break;case 5123:O=65535}const S=1/O;t.scaleInPlace(S),p.scaleInPlace(S)}return new N.c(t,p)}return null}class B{static RegisterExtension(H,O){A(H,!1,O)}static UnregisterExtension(H){return u(H)}get OU(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(H){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=H}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((H=>H.dispose&&H.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(H,O,S,t,q,p){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=O,this._assetContainer=S,this._loadData(t);let p=null;if(H){const O={};if(this._gltf.nodes)for(const H of this._gltf.nodes)H.name&&(O[H.name]=H.index);p=(H instanceof Array?H:[H]).map((H=>{const S=O[H];if(void 0===S)throw new Error(`Failed to find node '${H}'`);return S}))}return await this._loadAsync(q,G,p,(()=>({meshes:this._getMeshes(),ha:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=H,this._loadData(O),await this._loadAsync(S,q,null,(()=>{}))}async _loadAsync(H,O,S,t){return await Promise.resolve().then((async()=>{this._rootUrl=H,this._uniqueRootUrl=!H.startsWith("file:")&&O?H:`${H}${Date.now()}/`,this._fileName=O,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const q=`${W.l[W.l.LOADING]} => ${W.l[W.l.READY]}`,p=`${W.l[W.l.LOADING]} => ${W.l[W.l.COMPLETE]}`;this._parent._startPerformanceCounter(q),this._parent._startPerformanceCounter(p),this._parent._setState(W.l.LOADING),this._extensionsOnLoading();const U=new Array;if(!this.parent.loadOnlyMaterials)if(S)U.push(this.loadSceneAsync("/nodes",{nodes:S,index:-1}));else if(void 0!=this._gltf.EO||this._gltf.scenes&&this._gltf.scenes[0]){const H=c.Get("/scene",this._gltf.scenes,this._gltf.EO||0);U.push(this.loadSceneAsync(`/scenes/${H.index}`,H))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let H=0;H<this._gltf.materials.length;++H){const O=this._gltf.materials[H],S="/materials/"+H,t=T.e.TriangleFillMode;U.push(this._loadMaterialAsync(S,O,null,t,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&U.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&U.push(this._compileShadowGeneratorsAsync());const V=Promise.all(U).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.uU(!0);for(const H of this._babylonScene.materials){const O=H;void 0!==O.maxSimultaneousLights&&(O.maxSimultaneousLights=Math.max(O.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(W.l.READY),this._skipStartAnimationStep||this._startAnimations(),t()}));return await V.then((H=>(this._parent._endPerformanceCounter(q),G.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(p),this._parent._setState(W.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(H=>{this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()}))})),H)))})).catch((H=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(H),this._parent.onErrorObservable.clear(),this.dispose()),H}))}_loadData(H){if(this._gltf=H.json,this._setupData(),H.bin){const O=this._gltf.buffers;if(O&&O[0]&&!O[0].uri){const S=O[0];(S.byteLength<H.bin.byteLength-3||S.byteLength>H.bin.byteLength)&&X.b.Warn(`Binary buffer length (${S.byteLength}) from JSON does not match chunk length (${H.bin.byteLength})`),this._bin=H.bin}else X.b.Warn("Unexpected BIN chunk")}}_setupData(){if(c.Assign(this._gltf.accessors),c.Assign(this._gltf.animations),c.Assign(this._gltf.buffers),c.Assign(this._gltf.bufferViews),c.Assign(this._gltf.cameras),c.Assign(this._gltf.images),c.Assign(this._gltf.materials),c.Assign(this._gltf.meshes),c.Assign(this._gltf.nodes),c.Assign(this._gltf.samplers),c.Assign(this._gltf.scenes),c.Assign(this._gltf.skins),c.Assign(this._gltf.textures),this._gltf.nodes){const H={};for(const S of this._gltf.nodes)if(S.children)for(const O of S.children)H[O]=S.index;const O=this._createRootNode();for(const S of this._gltf.nodes){const t=H[S.index];S.parent=void 0===t?O:this._gltf.nodes[t]}}}async _loadExtensionsAsync(){const H=[];if(k.forEach(((O,S)=>{var t;!1===(null===(t=this.parent.extensionOptions[S])||void 0===t?void 0:t.enabled)?O.isGLTFExtension&&this.isExtensionUsed(S)&&X.b.Warn(`Extension ${S} is used but has been explicitly disabled.`):O.isGLTFExtension&&!this.isExtensionUsed(S)||H.push((async()=>{const H=await O.factory(this);return H.name!==S&&X.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${H.name} !== ${S}`),this._parent.onExtensionLoadedObservable.notifyObservers(H),H})())})),this._extensions.push(...await Promise.all(H)),this._extensions.sort(((H,O)=>(H.order||Number.MAX_VALUE)-(O.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const S of this._gltf.extensionsRequired){if(!this._extensions.some((H=>H.name===S&&H.enabled))){var O;if(!1===(null===(O=this.parent.extensionOptions[S])||void 0===O?void 0:O.enabled))throw new Error(`Required extension ${S} is disabled`);throw new Error(`Required extension ${S} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new d.d("__root__",this._babylonScene);this._rootBabylonMesh=H,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.uU(!1);const O={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case W.j.AUTO:this._babylonScene.useRightHandedSystem||(O.rotation=[0,1,0,0],O.scale=[1,1,-1],B._LoadTransform(O,this._rootBabylonMesh));break;case W.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(H),O}loadSceneAsync(H,O){const S=this._extensionsLoadSceneAsync(H,O);if(S)return S;const t=new Array;if(this.logOpen(`${H} ${O.name||""}`),O.nodes)for(const q of O.nodes){const O=c.Get(`${H}/nodes/${q}`,this._gltf.nodes,q);t.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(H=>{H.parent=this._rootBabylonMesh})))}for(const q of this._postSceneLoadActions)q();return t.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(t).then((()=>{}))}_forEachPrimitive(H,O){if(H._primitiveBabylonMeshes)for(const S of H._primitiveBabylonMeshes)O(S)}_getGeometries(){const H=[],O=this._gltf.nodes;if(O)for(const S of O)this._forEachPrimitive(S,(O=>{const S=O.oU;S&&-1===H.indexOf(S)&&H.push(S)}));return H}_getMeshes(){const H=[];this._rootBabylonMesh instanceof l.e&&H.push(this._rootBabylonMesh);const O=this._gltf.nodes;if(O)for(const S of O)this._forEachPrimitive(S,(O=>{H.push(O)}));return H}_getTransformNodes(){const H=[],O=this._gltf.nodes;if(O)for(const S of O)S._babylonTransformNode&&"Sh"===S._babylonTransformNode.getClassName()&&H.push(S._babylonTransformNode),S._babylonTransformNodeForSkin&&H.push(S._babylonTransformNodeForSkin);return H}_getSkeletons(){const H=[],O=this._gltf.skins;if(O)for(const S of O)S._data&&H.push(S._data.babylonSkeleton);return H}_getAnimationGroups(){const H=[],O=this._gltf.animations;if(O)for(const S of O)S._babylonAnimationGroup&&H.push(S._babylonAnimationGroup);return H}_startAnimations(){switch(this._parent.animationStartMode){case W.f.NONE:break;case W.f.FIRST:{const H=this._getAnimationGroups();0!==H.length&&H[0].start(!0);break}case W.f.ALL:{const H=this._getAnimationGroups();for(const O of H)O.start(!0);break}default:return void X.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadNodeAsync(H,O,S);if(t)return t;if(O._babylonTransformNode)throw new Error(`${H}: Invalid recursive node hierarchy`);const q=new Array;this.logOpen(`${H} ${O.name||""}`);const p=t=>{if(B.AddPointerMetadata(t,H),B._LoadTransform(O,t),void 0!=O.camera){const S=c.Get(`${H}/camera`,this._gltf.cameras,O.camera);q.push(this.loadCameraAsync(`/cameras/${S.index}`,S,(H=>{H.parent=t,this._babylonScene.useRightHandedSystem||(t.eU.x=-1)})))}if(O.children)for(const S of O.children){const O=c.Get(`${H}/children/${S}`,this._gltf.nodes,S);q.push(this.loadNodeAsync(`/nodes/${O.index}`,O,(H=>{H.parent=t})))}S(t)},G=void 0!=O.mesh,U=this._parent.loadSkins&&void 0!=O.skin;if(!G||U){const H=O.name||`node${O.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new D.e(H,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==O.mesh?O._babylonTransformNode=S:O._babylonTransformNodeForSkin=S,p(S)}if(G)if(U){const S=c.Get(`${H}/mesh`,this._gltf.meshes,O.mesh);q.push(this._loadMeshAsync(`/meshes/${S.index}`,O,S,(S=>{const t=O._babylonTransformNodeForSkin;S.metadata=(0,P.c)(t.metadata,S.metadata||{});const p=c.Get(`${H}/skin`,this._gltf.skins,O.skin);q.push(this._loadSkinAsync(`/skins/${p.index}`,O,p,(H=>{this._forEachPrimitive(O,(O=>{O.skeleton=H})),this._postSceneLoadActions.push((()=>{if(void 0!=p.skeleton){const H=c.Get(`/skins/${p.index}/skeleton`,this._gltf.nodes,p.skeleton).parent;O.index===H.index?S.parent=t.parent:S.parent=H._babylonTransformNode}else S.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:t,skinnedNode:S})}))})))})))}else{const S=c.Get(`${H}/mesh`,this._gltf.meshes,O.mesh);q.push(this._loadMeshAsync(`/meshes/${S.index}`,O,S,p))}return this.logClose(),Promise.all(q).then((()=>(this._forEachPrimitive(O,(H=>{const O=H;!O.isAnInstance&&O.oU&&O.oU.useBoundingInfoFromGeometry?H.NH():H.refreshBoundingInfo(!0,!0)})),O._babylonTransformNode)))}_loadMeshAsync(H,O,S,t){const q=S.primitives;if(!q||!q.length)throw new Error(`${H}: Primitives are missing`);void 0==q[0].index&&c.Assign(q);const p=new Array;this.logOpen(`${H} ${S.name||""}`);const G=O.name||`node${O.index}`;if(1===q.length){const t=S.primitives[0];p.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${t.index}`,G,O,S,t,(H=>{O._babylonTransformNode=H,O._primitiveBabylonMeshes=[H]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,O._babylonTransformNode=new D.e(G,this._babylonScene),O._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._primitiveBabylonMeshes=[];for(const t of q)p.push(this._loadMeshPrimitiveAsync(`${H}/primitives/${t.index}`,`${G}_primitive${t.index}`,O,S,t,(H=>{H.parent=O._babylonTransformNode,O._primitiveBabylonMeshes.push(H)})))}return t(O._babylonTransformNode),this.logClose(),Promise.all(p).then((()=>O._babylonTransformNode))}_loadMeshPrimitiveAsync(H,O,S,t,q,p){const G=this._extensionsLoadMeshPrimitiveAsync(H,O,S,t,q,p);if(G)return G;this.logOpen(`${H}`);const U=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==S.skin&&!t.primitives[0].targets;let V,w;if(U&&q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,V=q._instanceData.babylonSourceMesh.createInstance(O),V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w=q._instanceData.promise;else{const p=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new d.d(O,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.sideOrientation=this._babylonScene.useRightHandedSystem?T.e.CounterClockWiseSideOrientation:T.e.ClockWiseSideOrientation,this._createMorphTargets(H,S,t,q,G),p.push(this._loadVertexDataAsync(H,q,G).then((async O=>await this._loadMorphTargetsAsync(H,q,G,O).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,O.WH(G),O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const o=B._GetDrawMode(H,q.mode);if(void 0==q.material){let H=this._defaultBabylonMaterialData[o];H||(H=this._createDefaultMaterial("__GLTFLoader._default",o),this._parent.onMaterialLoadedObservable.notifyObservers(H),this._defaultBabylonMaterialData[o]=H),G.material=H}else if(!this.parent.skipMaterials){const O=c.Get(`${H}/material`,this._gltf.materials,q.material);p.push(this._loadMaterialAsync(`/materials/${O.index}`,O,G,o,(H=>{G.material=H})))}w=Promise.all(p),U&&(q._instanceData={babylonSourceMesh:G,promise:w}),V=G}return B.AddPointerMetadata(V,H),this._parent.onMeshLoadedObservable.notifyObservers(V),p(V),this.logClose(),w.then((()=>V))}_loadVertexDataAsync(H,O,S){const t=this._extensionsLoadVertexDataAsync(H,O,S);if(t)return t;const q=O.attributes;if(!q)throw new Error(`${H}: Attributes are missing`);const p=new Array,G=new Y.b(S.name,this._babylonScene);if(void 0==O.indices)S.isUnIndexed=!0;else{const S=c.Get(`${H}/indices`,this._gltf.accessors,O.indices);p.push(this._loadIndicesAccessorAsync(`/accessors/${S.index}`,S).then((H=>{G.setIndices(H)})))}const U=(O,t,U)=>{if(void 0==q[O])return;S._delayInfo=S._delayInfo||[],-1===S._delayInfo.indexOf(t)&&S._delayInfo.push(t);const V=c.Get(`${H}/attributes/${O}`,this._gltf.accessors,q[O]);p.push(this._loadVertexAccessorAsync(`/accessors/${V.index}`,V,t).then((H=>{if(H.getKind()===F.h.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!S.skeleton){const H=R(V);H&&(G._boundingInfo=H,G.useBoundingInfoFromGeometry=!0)}G.setVerticesBuffer(H,V.count)}))),t==F.h.MatricesIndicesExtraKind&&(S.numBoneInfluencers=8),U&&U(V)};return U("POSITION",F.h.PositionKind),U("NORMAL",F.h.NormalKind),U("TANGENT",F.h.TangentKind),U("TEXCOORD_0",F.h.UVKind),U("TEXCOORD_1",F.h.UV2Kind),U("TEXCOORD_2",F.h.UV3Kind),U("TEXCOORD_3",F.h.UV4Kind),U("TEXCOORD_4",F.h.UV5Kind),U("TEXCOORD_5",F.h.UV6Kind),U("JOINTS_0",F.h.MatricesIndicesKind),U("WEIGHTS_0",F.h.MatricesWeightsKind),U("JOINTS_1",F.h.MatricesIndicesExtraKind),U("WEIGHTS_1",F.h.MatricesWeightsExtraKind),U("COLOR_0",F.h.ColorKind,(H=>{"VEC4"===H.type&&(S.hasVertexAlpha=!0)})),Promise.all(p).then((()=>G))}_createMorphTargets(H,O,S,t,q){if(!t.targets||!this._parent.loadMorphTargets)return;if(void 0==O._numMorphTargets)O._numMorphTargets=t.targets.length;else if(t.targets.length!==O._numMorphTargets)throw new Error(`${H}: Primitives do not have the same number of targets`);const p=S.extras?S.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,q.morphTargetManager=new r(this._babylonScene),q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.morphTargetManager.areUpdatesFrozen=!0;for(let G=0;G<t.targets.length;G++){const H=O.weights?O.weights[G]:S.weights?S.weights[G]:0,t=p?p[G]:`morphTarget${G}`;q.morphTargetManager.addTarget(new v.c(t,H,q.YH()))}}_loadMorphTargetsAsync(H,O,S,t){if(!O.targets||!this._parent.loadMorphTargets)return Promise.resolve();const q=new Array,p=S.morphTargetManager;for(let G=0;G<p.numTargets;G++){const S=p.getTarget(G);q.push(this._loadMorphTargetVertexDataAsync(`${H}/targets/${G}`,t,O.targets[G],S))}return Promise.all(q).then((()=>{p.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(H,O,S,t){const q=new Array,p=(t,p,G)=>{if(void 0==S[t])return;const U=O.getVertexBuffer(p);if(!U)return;const V=c.Get(`${H}/${t}`,this._gltf.accessors,S[t]);q.push(this._loadFloatAccessorAsync(`/accessors/${V.index}`,V).then((H=>{G(U,H)})))};return p("POSITION",F.h.PositionKind,((H,O)=>{const S=new Float32Array(O.length);H.forEach(O.length,((H,t)=>{S[t]=O[t]+H})),t.setPositions(S)})),p("NORMAL",F.h.NormalKind,((H,O)=>{const S=new Float32Array(O.length);H.forEach(S.length,((H,t)=>{S[t]=O[t]+H})),t.setNormals(S)})),p("TANGENT",F.h.TangentKind,((H,O)=>{const S=new Float32Array(O.length/3*4);let q=0;H.forEach(O.length/3*4,((H,t)=>{(t+1)%4!==0&&(S[q]=O[q]+H,q++)})),t.setTangents(S)})),p("TEXCOORD_0",F.h.UVKind,((H,O)=>{const S=new Float32Array(O.length);H.forEach(O.length,((H,t)=>{S[t]=O[t]+H})),t.setUVs(S)})),p("TEXCOORD_1",F.h.UV2Kind,((H,O)=>{const S=new Float32Array(O.length);H.forEach(O.length,((H,t)=>{S[t]=O[t]+H})),t.setUV2s(S)})),p("COLOR_0",F.h.ColorKind,((O,S)=>{let q=null;const p=O.getSize();if(3===p){q=new Float32Array(S.length/3*4),O.forEach(S.length,((H,O)=>{const t=Math.floor(O/3),p=O%3;q[4*t+p]=S[3*t+p]+H}));for(let H=0;H<S.length/3;++H)q[4*H+3]=1}else{if(4!==p)throw new Error(`${H}: Invalid number of components (${p}) for COLOR_0 attribute`);q=new Float32Array(S.length),O.forEach(S.length,((H,O)=>{q[O]=S[O]+H}))}t.setColors(q)})),await Promise.all(q).then((()=>{}))}static _LoadTransform(H,O){if(void 0!=H.skin)return;let S=q.eO.Zero(),t=q.Quaternion.Identity(),p=q.eO.One();if(H.matrix){q.Matrix.KO(H.matrix).decompose(p,t,S)}else H.translation&&(S=q.eO.KO(H.translation)),H.rotation&&(t=q.Quaternion.KO(H.rotation)),H.scale&&(p=q.eO.KO(H.scale));O.position=S,O.rotationQuaternion=t,O.eU=p}_loadSkinAsync(H,O,S,t){if(!this._parent.loadSkins)return Promise.resolve();const q=this._extensionsLoadSkinAsync(H,O,S);if(q)return q;if(S._data)return t(S._data.babylonSkeleton),S._data.promise;const p=`skeleton${S.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new y(S.name||p,p,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(H,S,G);const U=this._loadSkinInverseBindMatricesDataAsync(H,S).then((H=>{this._updateBoneMatrices(G,H)}));return S._data={babylonSkeleton:G,promise:U},t(G),U}_loadBones(H,O,S){if(void 0==O.skeleton||this._parent.alwaysComputeSkeletonRootNode){const S=this._findSkeletonRootNode(`${H}/joints`,O.joints);if(S)if(void 0===O.skeleton)O.skeleton=S.index;else{const t=(H,O)=>{for(;O.parent;O=O.parent)if(O.parent===H)return!0;return!1},q=c.Get(`${H}/skeleton`,this._gltf.nodes,O.skeleton);q===S||t(q,S)||(X.b.Warn(`${H}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),O.skeleton=S.index)}else X.b.Warn(`${H}: Failed to find common root`)}const t={};for(const q of O.joints){const p=c.Get(`${H}/joints/${q}`,this._gltf.nodes,q);this._loadBone(p,O,S,t)}}_findSkeletonRootNode(H,O){if(0===O.length)return null;const S={};for(const q of O){const O=[];let t=c.Get(`${H}/${q}`,this._gltf.nodes,q);for(;-1!==t.index;)O.unshift(t),t=t.parent;S[q]=O}let t=null;for(let q=0;;++q){let H=S[O[0]];if(q>=H.length)return t;const p=H[q];for(let G=1;G<O.length;++G)if(H=S[O[G]],q>=H.length||p!==H[q])return t;t=p}}_loadBone(H,O,S,t){H._isJoint=!0;let q=t[H.index];if(q)return q;let p=null;H.index!==O.skeleton&&(H.parent&&-1!==H.parent.index?p=this._loadBone(H.parent,O,S,t):void 0!==O.skeleton&&X.b.Warn(`/skins/${O.index}/skeleton: Skeleton node is not a common root`));const G=O.joints.indexOf(H.index);return q=new w.c(H.name||`joint${H.index}`,S,p,this._getNodeMatrix(H),null,null,G),t[H.index]=q,this._postSceneLoadActions.push((()=>{q.linkTransformNode(H._babylonTransformNode)})),q}_loadSkinInverseBindMatricesDataAsync(H,O){if(void 0==O.inverseBindMatrices)return Promise.resolve(null);const S=c.Get(`${H}/inverseBindMatrices`,this._gltf.accessors,O.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${S.index}`,S)}_updateBoneMatrices(H,O){for(const S of H.bones){const H=q.Matrix.Identity(),t=S._index;O&&-1!==t&&(q.Matrix.FromArrayToRef(O,16*t,H),H.invertToRef(H));const p=S.getParent();p&&H.multiplyToRef(p.getAbsoluteInverseBindMatrix(),H),S.VU(H,!1,!1),S._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(H){return H.matrix?q.Matrix.KO(H.matrix):q.Matrix.Compose(H.scale?q.eO.KO(H.scale):q.eO.One(),H.rotation?q.Quaternion.KO(H.rotation):q.Quaternion.Identity(),H.translation?q.eO.KO(H.translation):q.eO.Zero())}loadCameraAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadCameraAsync(H,O,S);if(t)return t;const p=new Array;this.logOpen(`${H} ${O.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new V.e(O.name||`camera${O.index}`,q.eO.Zero(),this._babylonScene,!1);switch(G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonCamera=G,G.setTarget(new q.eO(0,0,-1)),O.type){case"perspective":{const S=O.perspective;if(!S)throw new Error(`${H}: Camera perspective properties are missing`);G.fov=S.yfov,G.UU=S.znear,G.maxZ=S.zfar||0;break}case"orthographic":if(!O.orthographic)throw new Error(`${H}: Camera orthographic properties are missing`);G.mode=U.d.ORTHOGRAPHIC_CAMERA,G.orthoLeft=-O.orthographic.xmag,G.orthoRight=O.orthographic.xmag,G.orthoBottom=-O.orthographic.ymag,G.orthoTop=O.orthographic.ymag,G.UU=O.orthographic.znear,G.maxZ=O.orthographic.zfar;break;default:throw new Error(`${H}: Invalid camera type (${O.type})`)}return B.AddPointerMetadata(G,H),this._parent.onCameraLoadedObservable.notifyObservers(G),S(G),this.logClose(),Promise.all(p).then((()=>G))}_loadAnimationsAsync(){const H=this._gltf.animations;if(!H)return Promise.resolve();const O=new Array;for(let S=0;S<H.length;S++){const t=H[S];O.push(this.loadAnimationAsync(`/animations/${t.index}`,t).then((H=>{0===H.targetedAnimations.length&&H.dispose()})))}return Promise.all(O).then((()=>{}))}loadAnimationAsync(H,O){const t=this._extensionsLoadAnimationAsync(H,O);return t||S.e(78).then(S.bind(S,14443)).then((S=>{let{AnimationGroup:t}=S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new t(O.name||`animation${O.index}`,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O._babylonAnimationGroup=q;const p=new Array;c.Assign(O.channels),c.Assign(O.samplers);for(const G of O.channels)p.push(this._loadAnimationChannelAsync(`${H}/channels/${G.index}`,H,O,G,((H,O)=>{H.animations=H.animations||[],H.animations.push(O),q.addTargetedAnimation(O,H)})));return Promise.all(p).then((()=>(q.normalize(0),q)))}))}async _loadAnimationChannelAsync(H,O,t,q,p){const G=this._extensionsLoadAnimationChannelAsync(H,O,t,q,p);if(G)return await G;if(void 0==q.target.node)return await Promise.resolve();const U=c.Get(`${H}/target/node`,this._gltf.nodes,q.target.node),V=q.target.path,w="weights"===V;if(w&&!U._numMorphTargets||!w&&!U._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!w&&!U._isJoint)return await Promise.resolve();let o;switch(await Promise.resolve().then(S.bind(S,12988)),V){case"translation":var h;o=null===(h=(0,J.c)("/nodes/{}/translation"))||void 0===h?void 0:h.interpolation;break;case"rotation":var a;o=null===(a=(0,J.c)("/nodes/{}/rotation"))||void 0===a?void 0:a.interpolation;break;case"scale":var j;o=null===(j=(0,J.c)("/nodes/{}/scale"))||void 0===j?void 0:j.interpolation;break;case"weights":var e;o=null===(e=(0,J.c)("/nodes/{}/weights"))||void 0===e?void 0:e.interpolation;break;default:throw new Error(`${H}/target/path: Invalid value (${q.target.path})`)}if(!o)throw new Error(`${H}/target/path: Could not find interpolation properties for target path (${q.target.path})`);const X={object:U,info:o};return await this._loadAnimationChannelFromTargetInfoAsync(H,O,t,q,X,p)}_loadAnimationChannelFromTargetInfoAsync(H,O,S,t,q,p){const G=this.parent.targetFps,U=1/G,V=c.Get(`${H}/sampler`,S.samplers,t.sampler);return this._loadAnimationSamplerAsync(`${O}/samplers/${t.sampler}`,V).then((H=>{let O=0;const V=q.object,w=q.info;for(const q of w){const w=q.getStride(V),o=H.input,h=H.output,a=new Array(o.length);let j=0;switch(H.interpolation){case"STEP":for(let H=0;H<o.length;H++){const O=q.getValue(V,h,j,1);j+=w,a[H]={frame:o[H]*G,value:O,interpolation:1}}break;case"CUBICSPLINE":for(let H=0;H<o.length;H++){const O=q.getValue(V,h,j,U);j+=w;const S=q.getValue(V,h,j,1);j+=w;const t=q.getValue(V,h,j,U);j+=w,a[H]={frame:o[H]*G,inTangent:O,value:S,outTangent:t}}break;case"LINEAR":for(let H=0;H<o.length;H++){const O=q.getValue(V,h,j,1);j+=w,a[H]={frame:o[H]*G,value:O}}}if(j>0){const H=`${S.name||`animation${S.index}`}_channel${t.index}_${O}`,U=q.buildAnimations(V,H,G,a);for(const S of U)O++,p(S.babylonAnimatable,S.babylonAnimation)}}}))}_loadAnimationSamplerAsync(H,O){if(O._data)return O._data;const S=O.interpolation||"LINEAR";switch(S){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${H}/interpolation: Invalid value (${O.interpolation})`)}const t=c.Get(`${H}/input`,this._gltf.accessors,O.input),q=c.Get(`${H}/output`,this._gltf.accessors,O.output);return O._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${t.index}`,t),this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)]).then((H=>{let[O,t]=H;return{input:O,interpolation:S,output:t}})),O._data}loadBufferAsync(H,O,S,t){const q=this._extensionsLoadBufferAsync(H,O,S,t);if(q)return q;if(!O._data)if(O.uri)O._data=this.loadUriAsync(`${H}/uri`,O,O.uri);else{if(!this._bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);O._data=this._bin.readAsync(0,O.byteLength)}return O._data.then((O=>{try{return new Uint8Array(O.buffer,O.byteOffset+S,t)}catch(q){throw new Error(`${H}: ${q.message}`)}}))}loadBufferViewAsync(H,O){const S=this._extensionsLoadBufferViewAsync(H,O);if(S)return S;if(O._data)return O._data;const t=c.Get(`${H}/buffer`,this._gltf.buffers,O.buffer);return O._data=this.loadBufferAsync(`/buffers/${t.index}`,t,O.byteOffset||0,O.byteLength),O._data}_loadAccessorAsync(H,O,S){if(O._data)return O._data;const t=B._GetNumComponents(H,O.type),q=t*F.h.GetTypeByteLength(O.componentType),p=t*O.count;if(void 0==O.bufferView)O._data=Promise.resolve(new S(p));else{const G=c.Get(`${H}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((U=>{if(5126!==O.componentType||O.normalized||G.byteStride&&G.byteStride!==q){const H=new S(p);return F.h.ForEach(U,O.byteOffset||0,G.byteStride||q,t,O.componentType,H.length,O.normalized||!1,((O,S)=>{H[S]=O})),H}return B._GetTypedArray(H,O.componentType,U,O.byteOffset,p)}))}if(O.sparse){const p=O.sparse;O._data=O._data.then((G=>{const U=G,V=c.Get(`${H}/sparse/indices/bufferView`,this._gltf.bufferViews,p.indices.bufferView),w=c.Get(`${H}/sparse/values/bufferView`,this._gltf.bufferViews,p.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${V.index}`,V),this.loadBufferViewAsync(`/bufferViews/${w.index}`,w)]).then((G=>{let[V,w]=G;const o=B._GetTypedArray(`${H}/sparse/indices`,p.indices.componentType,V,p.indices.byteOffset,p.count),h=t*p.count;let a;if(5126!==O.componentType||O.normalized){const G=B._GetTypedArray(`${H}/sparse/values`,O.componentType,w,p.values.byteOffset,h);a=new S(h),F.h.ForEach(G,0,q,t,O.componentType,a.length,O.normalized||!1,((H,O)=>{a[O]=H}))}else a=B._GetTypedArray(`${H}/sparse/values`,O.componentType,w,p.values.byteOffset,h);let j=0;for(let H=0;H<o.length;H++){let O=o[H]*t;for(let H=0;H<t;H++)U[O++]=a[j++]}return U}))}))}return O._data}_loadFloatAccessorAsync(H,O){return this._loadAccessorAsync(H,O,Float32Array)}_loadIndicesAccessorAsync(H,O){if("SCALAR"!==O.type)throw new Error(`${H}/type: Invalid value ${O.type}`);if(5121!==O.componentType&&5123!==O.componentType&&5125!==O.componentType)throw new Error(`${H}/componentType: Invalid value ${O.componentType}`);if(O._data)return O._data;if(O.sparse){const S=B._GetTypedArrayConstructor(`${H}/componentType`,O.componentType);O._data=this._loadAccessorAsync(H,O,S)}else{const S=c.Get(`${H}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S).then((S=>B._GetTypedArray(H,O.componentType,S,O.byteOffset,O.count)))}return O._data}_loadVertexBufferViewAsync(H){if(H._babylonBuffer)return H._babylonBuffer;const O=this._babylonScene.getEngine();return H._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>new F.d(O,H,!1))),H._babylonBuffer}_loadVertexAccessorAsync(H,O,S){var t;if(null!==(t=O._babylonVertexBuffer)&&void 0!==t&&t[S])return O._babylonVertexBuffer[S];O._babylonVertexBuffer||(O._babylonVertexBuffer={});const q=this._babylonScene.getEngine();if(O.sparse||void 0==O.bufferView)O._babylonVertexBuffer[S]=this._loadFloatAccessorAsync(H,O).then((H=>new F.h(q,H,S,!1)));else{const t=c.Get(`${H}/bufferView`,this._gltf.bufferViews,O.bufferView);O._babylonVertexBuffer[S]=this._loadVertexBufferViewAsync(t).then((p=>{const G=B._GetNumComponents(H,O.type);return new F.h(q,p,S,!1,void 0,t.byteStride,void 0,O.byteOffset,G,O.componentType,O.normalized,!0,void 0,!0)}))}return O._babylonVertexBuffer[S]}_loadMaterialMetallicRoughnessPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return O&&(O.baseColorFactor?(S.albedoColor=p.TO.KO(O.baseColorFactor),S.alpha=O.baseColorFactor[3]):S.albedoColor=p.TO.White(),S.metallic=void 0==O.metallicFactor?1:O.metallicFactor,S.roughness=void 0==O.roughnessFactor?1:O.roughnessFactor,O.baseColorTexture&&t.push(this.loadTextureInfoAsync(`${H}/baseColorTexture`,O.baseColorTexture,(H=>{H.name=`${S.name} (Base Color)`,S.albedoTexture=H}))),O.metallicRoughnessTexture&&(O.metallicRoughnessTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${H}/metallicRoughnessTexture`,O.metallicRoughnessTexture,(H=>{H.name=`${S.name} (Metallic Roughness)`,S.metallicTexture=H}))),S.useMetallnessFromMetallicTextureBlue=!0,S.useRoughnessFromMetallicTextureGreen=!0,S.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(t).then((()=>{}))}_loadMaterialAsync(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const p=this._extensionsLoadMaterialAsync(H,O,S,t,q);if(p)return p;O._data=O._data||{};let G=O._data[t];if(!G){this.logOpen(`${H} ${O.name||""}`);const S=this.createMaterial(H,O,t);G={babylonMaterial:S,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(H,O,S)},O._data[t]=G,B.AddPointerMetadata(S,H),this._parent.onMaterialLoadedObservable.notifyObservers(S),this.logClose()}return S&&(G.babylonMeshes.push(S),S.up.addOnce((()=>{const H=G.babylonMeshes.indexOf(S);-1!==H&&G.babylonMeshes.splice(H,1)}))),q(G.babylonMaterial),G.promise.then((()=>G.babylonMaterial))}_createDefaultMaterial(H,O){this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new K.c(H,this._babylonScene);return S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.fillMode=O,S.enableSpecularAntiAliasing=!0,S.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,S.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,S.transparencyMode=K.c.PBRMATERIAL_OPAQUE,S.metallic=1,S.roughness=1,S}createMaterial(H,O,S){const t=this._extensionsCreateMaterial(H,O,S);if(t)return t;const q=O.name||`material${O.index}`;return this._createDefaultMaterial(q,S)}loadMaterialPropertiesAsync(H,O,S){const t=this._extensionsLoadMaterialPropertiesAsync(H,O,S);if(t)return t;const q=new Array;return q.push(this.loadMaterialBasePropertiesAsync(H,O,S)),O.pbrMetallicRoughness&&q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${H}/pbrMetallicRoughness`,O.pbrMetallicRoughness,S)),this.loadMaterialAlphaProperties(H,O,S),Promise.all(q).then((()=>{}))}loadMaterialBasePropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.emissiveColor=O.emissiveFactor?p.TO.KO(O.emissiveFactor):new p.TO(0,0,0),O.doubleSided&&(S.aU=!1,S.twoSidedLighting=!0),O.normalTexture&&(O.normalTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${H}/normalTexture`,O.normalTexture,(H=>{H.name=`${S.name} (Normal)`,S.bumpTexture=H}))),S.invertNormalMapX=!this._babylonScene.useRightHandedSystem,S.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=O.normalTexture.scale&&S.bumpTexture&&(S.bumpTexture.level=O.normalTexture.scale),S.forceIrradianceInFragment=!0),O.occlusionTexture&&(O.occlusionTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${H}/occlusionTexture`,O.occlusionTexture,(H=>{H.name=`${S.name} (Occlusion)`,S.ambientTexture=H}))),S.useAmbientInGrayScale=!0,void 0!=O.occlusionTexture.strength&&(S.ambientTextureStrength=O.occlusionTexture.strength)),O.emissiveTexture&&t.push(this.loadTextureInfoAsync(`${H}/emissiveTexture`,O.emissiveTexture,(H=>{H.name=`${S.name} (Emissive)`,S.emissiveTexture=H}))),Promise.all(t).then((()=>{}))}loadMaterialAlphaProperties(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);switch(O.alphaMode||"OPAQUE"){case"OPAQUE":S.transparencyMode=K.c.PBRMATERIAL_OPAQUE,S.alpha=1;break;case"MASK":S.transparencyMode=K.c.PBRMATERIAL_ALPHATEST,S.alphaCutOff=void 0==O.alphaCutoff?.5:O.alphaCutoff,S.albedoTexture&&(S.albedoTexture.GU=!0);break;case"BLEND":S.transparencyMode=K.c.PBRMATERIAL_ALPHABLEND,S.albedoTexture&&(S.albedoTexture.GU=!0,S.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${H}/alphaMode: Invalid value (${O.alphaMode})`)}}loadTextureInfoAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureInfoAsync(H,O,S);if(t)return t;if(this.logOpen(`${H}`),O.texCoord>=6)throw new Error(`${H}/texCoord: Invalid value (${O.texCoord})`);const q=c.Get(`${H}/index`,this._gltf.textures,O.index);q._textureInfo=O;const p=this._loadTextureAsync(`/textures/${O.index}`,q,(t=>{t.coordinatesIndex=O.texCoord||0,B.AddPointerMetadata(t,H),this._parent.onTextureLoadedObservable.notifyObservers(t),S(t)}));return this.logClose(),p}_loadTextureAsync(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureAsync(H,O,S);if(t)return t;this.logOpen(`${H} ${O.name||""}`);const q=void 0==O.sampler?B.DefaultSampler:c.Get(`${H}/sampler`,this._gltf.samplers,O.sampler),p=c.Get(`${H}/source`,this._gltf.images,O.source),G=this._createTextureAsync(H,q,p,S,void 0,!O._textureInfo.nonColorData);return this.logClose(),G}_createTextureAsync(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const U=this._loadSampler(`/samplers/${O.index}`,O),V=new Array,w=new t;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o={noMipmap:U.noMipMaps,invertY:!1,samplingMode:U.samplingMode,M:()=>{this._disposed||w.resolve()},onError:(O,S)=>{this._disposed||w.reject(new Error(`${H}: ${S&&S.message?S.message:O||"Failed to load texture"}`))},mimeType:S.mimeType??(0,g.i)(S.uri??""),loaderOptions:p,useSRGBBuffer:!!G&&this._parent.useSRGBBuffers},h=new b.b(null,this._babylonScene,o);return h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.push(w.promise),V.push(this.loadImageAsync(`/images/${S.index}`,S).then((H=>{const O=S.uri||`${this._fileName}#image${S.index}`,t=`data:${this._uniqueRootUrl}${O}`;h.updateURL(t,H);const q=h.getInternalTexture();q&&(q.label=S.name)}))),h.wrapU=U.wrapU,h.wrapV=U.wrapV,q(h),this._parent.useGltfTextureNames&&(h.name=S.name||S.uri||`image${S.index}`),Promise.all(V).then((()=>h))}_loadSampler(H,O){return O._data||(O._data={noMipMaps:9728===O.minFilter||9729===O.minFilter,samplingMode:B._GetTextureSamplingMode(H,O),wrapU:B._GetTextureWrapMode(`${H}/wrapS`,O.wrapS),wrapV:B._GetTextureWrapMode(`${H}/wrapT`,O.wrapT)}),O._data}loadImageAsync(H,O){if(!O._data){if(this.logOpen(`${H} ${O.name||""}`),O.uri)O._data=this.loadUriAsync(`${H}/uri`,O,O.uri);else{const S=c.Get(`${H}/bufferView`,this._gltf.bufferViews,O.bufferView);O._data=this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}this.logClose()}return O._data}loadUriAsync(H,O,S){const t=this._extensionsLoadUriAsync(H,O,S);if(t)return t;if(!B._ValidateUri(S))throw new Error(`${H}: '${S}' is invalid`);if((0,g.m)(S)){const O=new Uint8Array((0,g.d)(S));return this.log(`${H}: Decoded ${S.substring(0,64)}... (${O.length} bytes)`),Promise.resolve(O)}return this.log(`${H}: Loading ${S}`),this._parent.preprocessUrlAsync(this._rootUrl+S).then((O=>new Promise(((t,q)=>{this._parent._loadFile(this._babylonScene,O,(O=>{this._disposed||(this.log(`${H}: Loaded ${S} (${O.byteLength} bytes)`),t(new Uint8Array(O)))}),!0,(O=>{q(new g.n(`${H}: Failed to load '${S}'${O?": "+O.status+" "+O.statusText:""}`,O))}))}))))}static AddPointerMetadata(H,O){H.metadata=H.metadata||{};const S=H._internalMetadata=H._internalMetadata||{},t=S.OU=S.OU||{};(t.pointers=t.pointers||[]).push(O)}static _GetTextureWrapMode(H,O){switch(O=void 0==O?10497:O){case 33071:return b.b.CLAMP_ADDRESSMODE;case 33648:return b.b.MIRROR_ADDRESSMODE;case 10497:return b.b.WRAP_ADDRESSMODE;default:return X.b.Warn(`${H}: Invalid value (${O})`),b.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(H,O){const S=void 0==O.magFilter?9729:O.magFilter,t=void 0==O.minFilter?9987:O.minFilter;if(9729===S)switch(t){case 9728:return b.b.LINEAR_NEAREST;case 9729:return b.b.LINEAR_LINEAR;case 9984:return b.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return b.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return b.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return b.b.LINEAR_LINEAR_MIPLINEAR;default:return X.b.Warn(`${H}/minFilter: Invalid value (${t})`),b.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==S&&X.b.Warn(`${H}/magFilter: Invalid value (${S})`),t){case 9728:return b.b.NEAREST_NEAREST;case 9729:return b.b.NEAREST_LINEAR;case 9984:return b.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return b.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return b.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return b.b.NEAREST_LINEAR_MIPLINEAR;default:return X.b.Warn(`${H}/minFilter: Invalid value (${t})`),b.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(H,O){try{return(0,f.s)(O)}catch(S){throw new Error(`${H}: ${S.message}`)}}static _GetTypedArray(H,O,S,t,q){const p=S.buffer;t=S.byteOffset+(t||0);const G=B._GetTypedArrayConstructor(`${H}/componentType`,O),U=F.h.GetTypeByteLength(O);return t%U!==0?(X.b.Warn(`${H}: Copying buffer as byte offset (${t}) is not a multiple of component type byte length (${U})`),new G(p.slice(t,t+q*U),0)):new G(p,t,q)}static _GetNumComponents(H,O){switch(O){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${H}: Invalid type (${O})`)}static _ValidateUri(H){return G.Tools.IsBase64(H)||-1===H.indexOf("..")}static _GetDrawMode(H,O){switch(void 0==O&&(O=4),O){case 0:return T.e.PointListDrawMode;case 1:return T.e.LineListDrawMode;case 2:return T.e.LineLoopDrawMode;case 3:return T.e.LineStripDrawMode;case 4:return T.e.TriangleFillMode;case 5:return T.e.TriangleStripDrawMode;case 6:return T.e.TriangleFanDrawMode}throw new Error(`${H}: Invalid mesh primitive mode (${O})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const H=new Array;if(this._gltf.materials)for(const O of this._gltf.materials)if(O._data)for(const S in O._data){const t=O._data[S];for(const O of t.babylonMeshes){O.wU(!0);const S=t.babylonMaterial;H.push(S.forceCompilationAsync(O)),H.push(S.forceCompilationAsync(O,{useInstances:!0})),this._parent.useClipPlane&&(H.push(S.forceCompilationAsync(O,{clipPlane:!0})),H.push(S.forceCompilationAsync(O,{clipPlane:!0,useInstances:!0})))}}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const H=new Array,O=this._babylonScene.lights;for(const S of O){const O=S.getShadowGenerator();O&&H.push(O.forceCompilationAsync())}return Promise.all(H).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(H){for(const O of this._extensions)O.enabled&&H(O)}_applyExtensions(H,O,S){for(const t of this._extensions)if(t.enabled){const q=`${t.name}.${O}`,p=H;p._activeLoaderExtensionFunctions=p._activeLoaderExtensionFunctions||{};const G=p._activeLoaderExtensionFunctions;if(!G[q]){G[q]=!0;try{const H=S(t);if(H)return H}finally{delete G[q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((H=>H.onLoading&&H.onLoading()))}_extensionsOnReady(){this._forEachExtensions((H=>H.onReady&&H.onReady()))}_extensionsLoadSceneAsync(H,O){return this._applyExtensions(O,"loadScene",(S=>S.loadSceneAsync&&S.loadSceneAsync(H,O)))}_extensionsLoadNodeAsync(H,O,S){return this._applyExtensions(O,"loadNode",(t=>t.loadNodeAsync&&t.loadNodeAsync(H,O,S)))}_extensionsLoadCameraAsync(H,O,S){return this._applyExtensions(O,"loadCamera",(t=>t.loadCameraAsync&&t.loadCameraAsync(H,O,S)))}_extensionsLoadVertexDataAsync(H,O,S){return this._applyExtensions(O,"loadVertexData",(t=>t._loadVertexDataAsync&&t._loadVertexDataAsync(H,O,S)))}_extensionsLoadMeshPrimitiveAsync(H,O,S,t,q,p){return this._applyExtensions(q,"loadMeshPrimitive",(G=>G._loadMeshPrimitiveAsync&&G._loadMeshPrimitiveAsync(H,O,S,t,q,p)))}_extensionsLoadMaterialAsync(H,O,S,t,q){return this._applyExtensions(O,"loadMaterial",(p=>p._loadMaterialAsync&&p._loadMaterialAsync(H,O,S,t,q)))}_extensionsCreateMaterial(H,O,S){return this._applyExtensions(O,"createMaterial",(t=>t.createMaterial&&t.createMaterial(H,O,S)))}_extensionsLoadMaterialPropertiesAsync(H,O,S){return this._applyExtensions(O,"loadMaterialProperties",(t=>t.loadMaterialPropertiesAsync&&t.loadMaterialPropertiesAsync(H,O,S)))}_extensionsLoadTextureInfoAsync(H,O,S){return this._applyExtensions(O,"loadTextureInfo",(t=>t.loadTextureInfoAsync&&t.loadTextureInfoAsync(H,O,S)))}_extensionsLoadTextureAsync(H,O,S){return this._applyExtensions(O,"loadTexture",(t=>t._loadTextureAsync&&t._loadTextureAsync(H,O,S)))}_extensionsLoadAnimationAsync(H,O){return this._applyExtensions(O,"loadAnimation",(S=>S.loadAnimationAsync&&S.loadAnimationAsync(H,O)))}_extensionsLoadAnimationChannelAsync(H,O,S,t,q){return this._applyExtensions(S,"loadAnimationChannel",(p=>p._loadAnimationChannelAsync&&p._loadAnimationChannelAsync(H,O,S,t,q)))}_extensionsLoadSkinAsync(H,O,S){return this._applyExtensions(S,"loadSkin",(t=>t._loadSkinAsync&&t._loadSkinAsync(H,O,S)))}_extensionsLoadUriAsync(H,O,S){return this._applyExtensions(O,"loadUri",(t=>t._loadUriAsync&&t._loadUriAsync(H,O,S)))}_extensionsLoadBufferViewAsync(H,O){return this._applyExtensions(O,"loadBufferView",(S=>S.loadBufferViewAsync&&S.loadBufferViewAsync(H,O)))}_extensionsLoadBufferAsync(H,O,S,t){return this._applyExtensions(O,"loadBuffer",(q=>q.loadBufferAsync&&q.loadBufferAsync(H,O,S,t)))}static LoadExtensionAsync(H,O,S,t){if(!O.extensions)return null;const q=O.extensions[S];return q?t(`${H}/extensions/${S}`,q):null}static LoadExtraAsync(H,O,S,t){if(!O.extras)return null;const q=O.extras[S];return q?t(`${H}/extras/${S}`,q):null}isExtensionUsed(H){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(H)}logOpen(H){this._parent._logOpen(H)}logClose(){this._parent._logClose()}log(H){this._parent._log(H)}startPerformanceCounter(H){this._parent._startPerformanceCounter(H)}endPerformanceCounter(H){this._parent._endPerformanceCounter(H)}}B.DefaultSampler={index:-1},W.e._CreateGLTF2Loader=H=>new B(H);var Z=S(12988),I=S(11509),s=S(11338),i=S(12996),M=S(13005);class C extends M.b{constructor(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",H),this._texture=H.getEngine().createRawCubeTexture(O,S,t,q,p,G,U,V)}update(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,H,O,S,t,q)}updateRGBDAsync(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,i.m)(this._texture,H,O,S,t).then((()=>{}))}clone(){return s.e.Clone((()=>{const H=this.YH(),O=this._texture,S=new C(H,O._bufferViewArray,O.width,O.format,O.type,O.generateMipMaps,O.invertY,O.samplingMode,O._compression);return 13===O.source&&S.updateRGBDAsync(O._bufferViewArrayArray,O._sphericalPolynomial,O._lodGenerationScale,O._lodGenerationOffset),S}),this)}}const n="EXT_lights_image_based";class Q{constructor(H){this.name=n,this._loader=H,this.enabled=this._loader.isExtensionUsed(n)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.OU.extensions;if(H&&H[this.name]){const O=H[this.name];this._lights=O.lights}}loadSceneAsync(H,O){return B.LoadExtensionAsync(H,O,this.name,(async(S,t)=>{this._loader._allMaterialsDirtyRequired=!0;const q=new Array;q.push(this._loader.loadSceneAsync(H,O)),this._loader.logOpen(`${S}`);const p=c.Get(`${S}/light`,this._lights,t.eq);return q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${t.eq}`,p).then((H=>{this._loader.babylonScene.environmentTexture=H}))),this._loader.logClose(),await Promise.all(q).then((()=>{}))}))}_loadLightAsync(H,O){if(!O._loaded){const S=new Array;this._loader.logOpen(`${H}`);const t=new Array(O.specularImages.length);for(let q=0;q<O.specularImages.length;q++){const p=O.specularImages[q];t[q]=new Array(p.length);for(let O=0;O<p.length;O++){const G=`${H}/specularImages/${q}/${O}`;this._loader.logOpen(`${G}`);const U=p[O],V=c.Get(G,this._loader.OU.images,U);S.push(this._loader.loadImageAsync(`/images/${U}`,V).then((H=>{t[q][O]=H}))),this._loader.logClose()}}this._loader.logClose(),O._loaded=Promise.all(S).then((async()=>{const S=new C(this._loader.babylonScene,null,O.specularImageSize);if(S.name=O.name||"environment",O._babylonTexture=S,void 0!=O.KU&&(S.level=O.KU),O.rotation){let H=q.Quaternion.KO(O.rotation);this._loader.babylonScene.useRightHandedSystem||(H=q.Quaternion.Inverse(H)),q.Matrix.FromQuaternionToRef(H,S.getReflectionTextureMatrix())}if(!O.irradianceCoefficients)throw new Error(`${H}: Irradiance coefficients are missing`);const p=I.d.KO(O.irradianceCoefficients);p.scaleInPlace(O.KU),p.convertIrradianceToLambertianRadiance();const G=I.h.FromHarmonics(p),U=(t.length-1)/Math.log2(O.specularImageSize);return await S.updateRGBDAsync(t,G,U)}))}return O._loaded.then((()=>O._babylonTexture))}}u(n),A(n,!0,(H=>new Q(H)));S(11866);const L="EXT_mesh_gpu_instancing";class HH{constructor(H){this.name=L,this._loader=H,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null}loadNodeAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(H,t)=>{this._loader._disableInstancedMesh++;const p=this._loader.loadNodeAsync(`/nodes/${O.index}`,O,S);if(this._loader._disableInstancedMesh--,!O._primitiveBabylonMeshes)return await p;const G=new Array;let U=0;const V=O=>{if(void 0==t.attributes[O])return void G.push(Promise.resolve(null));const S=c.Get(`${H}/attributes/${O}`,this._loader.OU.accessors,t.attributes[O]);if(G.push(this._loader._loadFloatAccessorAsync(`/accessors/${S.bufferView}`,S)),0===U)U=S.count;else if(U!==S.count)throw new Error(`${H}/attributes: Instance buffer accessors do not have the same count.`)};return V("TRANSLATION"),V("ROTATION"),V("SCALE"),await p.then((async H=>{const[S,t,p]=await Promise.all(G),V=new Float32Array(16*U);q.TmpVectors.eO[0].jU(0,0,0),q.TmpVectors.Quaternion[0].jU(0,0,0,1),q.TmpVectors.eO[1].jU(1,1,1);for(let O=0;O<U;++O)S&&q.eO.FromArrayToRef(S,3*O,q.TmpVectors.eO[0]),t&&q.Quaternion.FromArrayToRef(t,4*O,q.TmpVectors.Quaternion[0]),p&&q.eO.FromArrayToRef(p,3*O,q.TmpVectors.eO[1]),q.Matrix.ComposeToRef(q.TmpVectors.eO[1],q.TmpVectors.Quaternion[0],q.TmpVectors.eO[0],q.TmpVectors.Matrix[0]),q.TmpVectors.Matrix[0].copyToArray(V,16*O);for(const q of O._primitiveBabylonMeshes)q.yh("matrix",V,16,!0);return H}))}))}}u(L),A(L,!0,(H=>new HH(H)));let OH=0,SH=null;class tH{static get Default(){return tH._Default||(tH._Default=new tH),tH._Default}constructor(){const H=tH.Configuration.decoder;this._decoderModulePromise=G.Tools.LoadBabylonScriptAsync(H.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(H,O,S,t,q){await this._decoderModulePromise,0===OH&&(MeshoptDecoder.useWorkers(1),OH=1);const p=await MeshoptDecoder.decodeGltfBufferAsync(O,S,H,t,q);return null!==SH&&clearTimeout(SH),SH=setTimeout((()=>{MeshoptDecoder.useWorkers(0),OH=0,SH=null}),1e3),p}}tH.Configuration={decoder:{url:`${G.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},tH._Default=null;const qH="EXT_meshopt_compression";class pH{constructor(H){this.name=qH,this.enabled=H.isExtensionUsed(qH),this._loader=H}dispose(){this._loader=null}loadBufferViewAsync(H,O){return B.LoadExtensionAsync(H,O,this.name,(async(S,t)=>{const q=O;if(q._meshOptData)return await q._meshOptData;const p=c.Get(`${H}/buffer`,this._loader.OU.buffers,t.buffer);return q._meshOptData=this._loader.loadBufferAsync(`/buffers/${p.index}`,p,t.byteOffset||0,t.byteLength).then((async H=>await tH.Default.decodeGltfBufferAsync(H,t.count,t.byteStride,t.mode,t.filter))),await q._meshOptData}))}}u(qH),A(qH,!0,(H=>new pH(H)));const GH="EXT_texture_webp";class UH{constructor(H){this.name=GH,this._loader=H,this.enabled=H.isExtensionUsed(GH)}dispose(){this._loader=null}_loadTextureAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=void 0==O.sampler?B.DefaultSampler:c.Get(`${H}/sampler`,this._loader.OU.samplers,O.sampler),G=c.Get(`${t}/source`,this._loader.OU.images,q.source);return await this._loader._createTextureAsync(H,p,G,(H=>{S(H)}),void 0,!O._textureInfo.nonColorData)}))}}u(GH),A(GH,!0,(H=>new UH(H)));const VH="EXT_texture_avif";class wH{constructor(H){this.name=VH,this._loader=H,this.enabled=H.isExtensionUsed(VH)}dispose(){this._loader=null}_loadTextureAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=void 0==O.sampler?B.DefaultSampler:c.Get(`${H}/sampler`,this._loader.OU.samplers,O.sampler),G=c.Get(`${t}/source`,this._loader.OU.images,q.source);return await this._loader._createTextureAsync(H,p,G,(H=>{S(H)}),void 0,!O._textureInfo.nonColorData)}))}}u(VH),A(VH,!0,(H=>new wH(H)));var oH=S(12980),hH=S(11851);const aH="EXT_lights_ies";class jH{constructor(H){this.name=aH,this._loader=H,this.enabled=this._loader.isExtensionUsed(aH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.OU.extensions;if(H&&H[this.name]){const O=H[this.name];this._lights=O.lights,c.Assign(this._lights)}}loadNodeAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,G)=>{let U,V;this._loader._allMaterialsDirtyRequired=!0;const w=await this._loader.loadNodeAsync(H,O,(H=>{V=c.Get(t,this._lights,G.eq);const O=V.name||H.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,U=new oH.b(O,q.eO.Zero(),q.eO.Backward(),0,1,this._loader.babylonScene),U.angle=Math.PI/2,U.innerAngle=0,U._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,V._babylonLight=U,U.falloffType=hH.b.FALLOFF_GLTF,U.bU=G.color?p.TO.KO(G.color):p.TO.White(),U.KU=G.multiplier||1,U.range=Number.MAX_VALUE,U.parent=H,this._loader._babylonLights.push(U),B.AddPointerMetadata(U,t),S(H)}));let o;if(V.uri)o=await this._loader.loadUriAsync(H,V,V.uri);else{const O=c.Get(`${H}/bufferView`,this._loader.OU.bufferViews,V.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${O.index}`,O)}return U.iesProfileTexture=new b.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),w}))}}u(aH),A(aH,!0,(H=>new jH(H)));var eH=S(13014);const XH="KHR_draco_mesh_compression";class EH{constructor(H){this.name=XH,this.useNormalizedFlagFromAccessor=!0,this._loader=H,this.enabled=eH.c.DefaultAvailable&&this._loader.isExtensionUsed(XH)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{if(void 0!=O.mode&&4!==O.mode&&5!==O.mode)throw new Error(`${H}: Unsupported mode ${O.mode}`);const p={},G={},U=(H,t)=>{const U=q.attributes[H];if(void 0!=U&&(S._delayInfo=S._delayInfo||[],-1===S._delayInfo.indexOf(t)&&S._delayInfo.push(t),p[t]=U,this.useNormalizedFlagFromAccessor)){const S=c.TryGet(this._loader.OU.accessors,O.attributes[H]);S&&(G[t]=S.normalized||!1)}};U("POSITION",F.h.PositionKind),U("NORMAL",F.h.NormalKind),U("TANGENT",F.h.TangentKind),U("TEXCOORD_0",F.h.UVKind),U("TEXCOORD_1",F.h.UV2Kind),U("TEXCOORD_2",F.h.UV3Kind),U("TEXCOORD_3",F.h.UV4Kind),U("TEXCOORD_4",F.h.UV5Kind),U("TEXCOORD_5",F.h.UV6Kind),U("JOINTS_0",F.h.MatricesIndicesKind),U("WEIGHTS_0",F.h.MatricesWeightsKind),U("COLOR_0",F.h.ColorKind);const V=c.Get(t,this._loader.OU.bufferViews,q.bufferView);return V._dracoBabylonGeometry||(V._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((async t=>{const q=this.dracoDecoder||eH.c.Default,U=c.TryGet(this._loader.OU.accessors,O.attributes.POSITION),V=this._loader.parent.alwaysComputeBoundingBox||S.skeleton||!U?null:R(U);return await q._decodeMeshToGeometryForGltfAsync(S.name,this._loader.babylonScene,t,p,G,V).catch((O=>{throw new Error(`${H}: ${O.message}`)}))}))),await V._dracoBabylonGeometry}))}}u(XH),A(XH,!0,(H=>new EH(H)));var yH=S(13021),TH=S(11287),KH=S(11289),bH=S(11727),DH=S(11904),FH=S(11262);bH.e.AddNodeConstructor("Light_Type_0",((H,O)=>()=>new YH(H,q.eO.Zero(),O)));class YH extends DH.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(H){this._shadowAngle=H,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(H){const O=this.needCube();if(this._direction=H,this.needCube()!==O&&this._shadowGenerators){const H=this._shadowGenerators.values();for(let O=H.next();!0!==O.done;O=H.next()){O.value.recreateShadowMap()}}}constructor(H,O,S){super(H,S),this._shadowAngle=Math.PI/2,this.position=O}getClassName(){return"PointLight"}getTypeID(){return hH.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(H){if(this.direction)return super.getShadowDirection(H);switch(H){case 0:return new q.eO(1,0,0);case 1:return new q.eO(-1,0,0);case 2:return new q.eO(0,-1,0);case 3:return new q.eO(0,1,0);case 4:return new q.eO(0,0,1);case 5:return new q.eO(0,0,-1)}return q.eO.Zero()}_setDefaultShadowProjectionMatrix(H,O,S){const t=this.YH().activeCamera;if(!t)return;const p=void 0!==this.shadowMinZ?this.shadowMinZ:t.UU,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,U=this.YH().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,U?G:p,U?p:G,H,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(H,O){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,O):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,O),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,O),this}transferToNodeMaterialEffect(H,O){return this.computeTransformedInformation()?H.setFloat3(O,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):H.setFloat3(O,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(H,O){H["POINTLIGHT"+O]=!0}}(0,TH.d)([(0,KH.J)()],YH.prototype,"shadowAngle",null),(0,FH.g)("BABYLON.PointLight",YH);const lH="KHR_lights_punctual";class dH{constructor(H){this.name=lH,this._loader=H,this.enabled=this._loader.isExtensionUsed(lH)}dispose(){this._loader=null,delete this._lights}onLoading(){const H=this._loader.OU.extensions;if(H&&H[this.name]){const O=H[this.name];this._lights=O.lights,c.Assign(this._lights)}}loadNodeAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,G)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(H,O,(H=>{let O;const U=c.Get(t,this._lights,G.eq),V=U.name||H.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,U.type){case"directional":{const H=new yH.b(V,q.eO.Backward(),this._loader.babylonScene);H.position.XU(0),O=H;break}case"point":O=new YH(V,q.eO.Zero(),this._loader.babylonScene);break;case"spot":{const H=new oH.b(V,q.eO.Zero(),q.eO.Backward(),0,1,this._loader.babylonScene);H.angle=2*(U.spot&&U.spot.outerConeAngle||Math.PI/4),H.innerAngle=2*(U.spot&&U.spot.innerConeAngle||0),O=H;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${t}: Invalid light type (${U.type})`)}O._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=O,O.falloffType=hH.b.FALLOFF_GLTF,O.bU=U.color?p.TO.KO(U.color):p.TO.White(),O.KU=void 0==U.KU?1:U.KU,O.range=void 0==U.range?Number.MAX_VALUE:U.range,O.parent=H,this._loader._babylonLights.push(O),B.AddPointerMetadata(O,t),S(H)})))))}}u(lH),A(lH,!0,(H=>new dH(H)));const vH="KHR_materials_pbrSpecularGlossiness";class zH{constructor(H){this.name=vH,this.order=200,this._loader=H,this.enabled=this._loader.isExtensionUsed(vH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialBasePropertiesAsync(H,O,S)),p.push(this._loadSpecularGlossinessPropertiesAsync(t,q,S)),this._loader.loadMaterialAlphaProperties(H,O,S),await Promise.all(p).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.metallic=null,S.roughness=null,O.diffuseFactor?(S.albedoColor=p.TO.KO(O.diffuseFactor),S.alpha=O.diffuseFactor[3]):S.albedoColor=p.TO.White(),S.reflectivityColor=O.specularFactor?p.TO.KO(O.specularFactor):p.TO.White(),S.microSurface=void 0==O.glossinessFactor?1:O.glossinessFactor,O.diffuseTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTexture`,O.diffuseTexture,(H=>{H.name=`${S.name} (Diffuse)`,S.albedoTexture=H}))),O.specularGlossinessTexture&&(t.push(this._loader.loadTextureInfoAsync(`${H}/specularGlossinessTexture`,O.specularGlossinessTexture,(H=>{H.name=`${S.name} (Specular Glossiness)`,S.reflectivityTexture=H,S.reflectivityTexture.GU=!0}))),S.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(t).then((()=>{}))}}u(vH),A(vH,!0,(H=>new zH(H)));const mH="KHR_materials_unlit";class rH{constructor(H){this.name=mH,this.order=210,this._loader=H,this.enabled=this._loader.isExtensionUsed(mH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async()=>await this._loadUnlitPropertiesAsync(H,O,S)))}_loadUnlitPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;S.unlit=!0;const q=O.pbrMetallicRoughness;return q&&(q.baseColorFactor?(S.albedoColor=p.TO.KO(q.baseColorFactor),S.alpha=q.baseColorFactor[3]):S.albedoColor=p.TO.White(),q.baseColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/baseColorTexture`,q.baseColorTexture,(H=>{H.name=`${S.name} (Base Color)`,S.albedoTexture=H})))),O.doubleSided&&(S.aU=!1,S.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(H,O,S),Promise.all(t).then((()=>{}))}}u(mH),A(mH,!0,(H=>new rH(H)));const WH="KHR_materials_clearcoat";class gH{constructor(H){this.name=WH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(WH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadClearCoatPropertiesAsync(t,q,S)),await Promise.all(p)}))}_loadClearCoatPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.clearCoat.isEnabled=!0,S.clearCoat.useRoughnessFromMainTexture=!1,S.clearCoat.remapF0OnInterfaceChange=!1,void 0!=O.clearcoatFactor?S.clearCoat.KU=O.clearcoatFactor:S.clearCoat.KU=0,O.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatTexture`,O.clearcoatTexture,(H=>{H.name=`${S.name} (ClearCoat)`,S.clearCoat.texture=H}))),void 0!=O.clearcoatRoughnessFactor?S.clearCoat.roughness=O.clearcoatRoughnessFactor:S.clearCoat.roughness=0,O.clearcoatRoughnessTexture&&(O.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatRoughnessTexture`,O.clearcoatRoughnessTexture,(H=>{H.name=`${S.name} (ClearCoat Roughness)`,S.clearCoat.textureRoughness=H})))),O.clearcoatNormalTexture&&(O.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${H}/clearcoatNormalTexture`,O.clearcoatNormalTexture,(H=>{H.name=`${S.name} (ClearCoat Normal)`,S.clearCoat.bumpTexture=H}))),S.invertNormalMapX=!S.YH().useRightHandedSystem,S.invertNormalMapY=S.YH().useRightHandedSystem,void 0!=O.clearcoatNormalTexture.scale&&(S.clearCoat.bumpTexture.level=O.clearcoatNormalTexture.scale)),Promise.all(t).then((()=>{}))}}u(WH),A(WH,!0,(H=>new gH(H)));const NH="KHR_materials_iridescence";class xH{constructor(H){this.name=NH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(NH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadIridescencePropertiesAsync(t,q,S)),await Promise.all(p).then((()=>{}))}))}_loadIridescencePropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.iridescence.isEnabled=!0,S.iridescence.KU=O.iridescenceFactor??0,S.iridescence.indexOfRefraction=O.iridescenceIor??O.iridescenceIOR??1.3,S.iridescence.minimumThickness=O.iridescenceThicknessMinimum??100,S.iridescence.maximumThickness=O.iridescenceThicknessMaximum??400,O.iridescenceTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceTexture`,O.iridescenceTexture,(H=>{H.name=`${S.name} (Iridescence)`,S.iridescence.texture=H}))),O.iridescenceThicknessTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/iridescenceThicknessTexture`,O.iridescenceThicknessTexture,(H=>{H.name=`${S.name} (Iridescence Thickness)`,S.iridescence.thicknessTexture=H}))),Promise.all(t).then((()=>{}))}}u(NH),A(NH,!0,(H=>new xH(H)));const kH="KHR_materials_anisotropy";class AH{constructor(H){this.name=kH,this.order=195,this._loader=H,this.enabled=this._loader.isExtensionUsed(kH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadIridescencePropertiesAsync(t,q,S)),await Promise.all(p)}))}async _loadIridescencePropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;S.anisotropy.isEnabled=!0,S.anisotropy.KU=O.anisotropyStrength??0,S.anisotropy.angle=O.anisotropyRotation??0,O.anisotropyTexture&&(O.anisotropyTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${H}/anisotropyTexture`,O.anisotropyTexture,(H=>{H.name=`${S.name} (Anisotropy Intensity)`,S.anisotropy.texture=H})))),await Promise.all(t)}}u(kH),A(kH,!0,(H=>new AH(H)));const uH="KHR_materials_emissive_strength";class JH{constructor(H){this.name=uH,this.order=170,this._loader=H,this.enabled=this._loader.isExtensionUsed(uH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>await this._loader.loadMaterialPropertiesAsync(H,O,S).then((()=>{this._loadEmissiveProperties(t,q,S)}))))}_loadEmissiveProperties(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);void 0!==O.emissiveStrength&&(S.emissiveIntensity=O.emissiveStrength)}}u(uH),A(uH,!0,(H=>new JH(H)));const PH="KHR_materials_sheen";class fH{constructor(H){this.name=PH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(PH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadSheenPropertiesAsync(t,q,S)),await Promise.all(p).then((()=>{}))}))}_loadSheenPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.sheen.isEnabled=!0,S.sheen.KU=1,void 0!=O.sheenColorFactor?S.sheen.color=p.TO.KO(O.sheenColorFactor):S.sheen.color=p.TO.Black(),O.sheenColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/sheenColorTexture`,O.sheenColorTexture,(H=>{H.name=`${S.name} (Sheen Color)`,S.sheen.texture=H}))),void 0!==O.sheenRoughnessFactor?S.sheen.roughness=O.sheenRoughnessFactor:S.sheen.roughness=0,O.sheenRoughnessTexture&&(O.sheenRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${H}/sheenRoughnessTexture`,O.sheenRoughnessTexture,(H=>{H.name=`${S.name} (Sheen Roughness)`,S.sheen.textureRoughness=H})))),S.sheen.albedoScaling=!0,S.sheen.useRoughnessFromMainTexture=!1,Promise.all(t).then((()=>{}))}}u(PH),A(PH,!0,(H=>new fH(H)));var cH=S(11783);const RH="KHR_materials_specular";class BH{constructor(H){this.name=RH,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(RH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;if(p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadSpecularPropertiesAsync(t,q,S)),q.extensions&&q.extensions.EXT_materials_specular_edge_color&&S instanceof K.c){q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(S.brdf.dielectricSpecularModel=cH.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,S.brdf.conductorSpecularModel=cH.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(p).then((()=>{}))}))}_loadSpecularPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return void 0!==O.specularFactor&&(S.metallicF0Factor=O.specularFactor),void 0!==O.specularColorFactor&&(S.metallicReflectanceColor=p.TO.KO(O.specularColorFactor)),O.specularTexture&&(O.specularTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${H}/specularTexture`,O.specularTexture,(H=>{H.name=`${S.name} (Specular)`,S.metallicReflectanceTexture=H,S.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),O.specularColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/specularColorTexture`,O.specularColorTexture,(H=>{H.name=`${S.name} (Specular Color)`,S.reflectanceTexture=H}))),Promise.all(t).then((()=>{}))}}u(RH),A(RH,!0,(H=>new BH(H)));const ZH="KHR_materials_ior";class IH{constructor(H){this.name=ZH,this.order=180,this._loader=H,this.enabled=this._loader.isExtensionUsed(ZH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadIorPropertiesAsync(t,q,S)),await Promise.all(p).then((()=>{}))}))}_loadIorPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);return void 0!==O.ior?S.indexOfRefraction=O.ior:S.indexOfRefraction=IH._DEFAULT_IOR,Promise.resolve()}}IH._DEFAULT_IOR=1.5,u(ZH),A(ZH,!0,(H=>new IH(H)));const sH="KHR_materials_variants";class iH{constructor(H){this.name=sH,this._loader=H,this.enabled=this._loader.isExtensionUsed(sH)}dispose(){this._loader=null}static GetAvailableVariants(H){const O=this._GetExtensionMetadata(H);return O?Object.keys(O.variants):[]}getAvailableVariants(H){return iH.GetAvailableVariants(H)}static SelectVariant(H,O){const S=this._GetExtensionMetadata(H);if(!S)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${sH} extension`);const t=H=>{const O=S.variants[H];if(O)for(const S of O)S.mesh.material=S.material};if(O instanceof Array)for(const q of O)t(q);else t(O);S.lastSelected=O}selectVariant(H,O){iH.SelectVariant(H,O)}static Reset(H){const O=this._GetExtensionMetadata(H);if(!O)throw new Error(`Cannot reset on a glTF mesh that does not have the ${sH} extension`);for(const S of O.original)S.mesh.material=S.material;O.lastSelected=null}reset(H){iH.Reset(H)}static GetLastSelectedVariant(H){const O=this._GetExtensionMetadata(H);if(!O)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${sH} extension`);return O.lastSelected}getLastSelectedVariant(H){return iH.GetLastSelectedVariant(H)}static _GetExtensionMetadata(H){var O,S;return(null===H||void 0===H||null===(O=H._internalMetadata)||void 0===O||null===(S=O.OU)||void 0===S?void 0:S[sH])||null}onLoading(){const H=this._loader.OU.extensions;if(H&&H[this.name]){const O=H[this.name];this._variants=O.variants}}onReady(){const H=this._loader.rootBabylonMesh;if(H){var O;const S=this._loader.parent.extensionOptions[sH];null!==S&&void 0!==S&&S.defaultVariant&&iH.SelectVariant(H,S.defaultVariant),null===S||void 0===S||null===(O=S.onLoaded)||void 0===O||O.call(S,{get variants(){return iH.GetAvailableVariants(H)},get selectedVariant(){const O=iH.GetLastSelectedVariant(H);return O?Array.isArray(O)?O[0]:O:iH.GetAvailableVariants(H)[0]},set selectedVariant(O){iH.SelectVariant(H,O)}})}}_loadMeshPrimitiveAsync(H,O,S,t,q,p){return B.LoadExtensionAsync(H,q,this.name,(async(G,U)=>{const V=new Array;return V.push(this._loader._loadMeshPrimitiveAsync(H,O,S,t,q,(O=>{if(p(O),O instanceof d.d){const S=B._GetDrawMode(H,q.mode),t=this._loader.rootBabylonMesh,p=t?t._internalMetadata=t._internalMetadata||{}:{},w=p.OU=p.OU||{},o=w[sH]=w[sH]||{lastSelected:null,original:[],variants:{}};o.original.push({mesh:O,material:O.material});for(let H=0;H<U.mappings.length;++H){const q=U.mappings[H],p=c.Get(`${G}/mappings/${H}/material`,this._loader.OU.materials,q.material);V.push(this._loader._loadMaterialAsync(`#/materials/${q.material}`,p,O,S,(H=>{for(let S=0;S<q.variants.length;++S){const p=q.variants[S],G=c.Get(`/extensions/${sH}/variants/${p}`,this._variants,p);o.variants[G.name]=o.variants[G.name]||[],o.variants[G.name].push({mesh:O,material:H}),O.onClonedObservable.add((H=>{const S=H;let q=null,p=S;do{if(p=p.parent,!p)return;q=iH._GetExtensionMetadata(p)}while(null===q);if(t&&q===iH._GetExtensionMetadata(t)){p._internalMetadata={};for(const H in t._internalMetadata)p._internalMetadata[H]=t._internalMetadata[H];p._internalMetadata.OU=[];for(const H in t._internalMetadata.OU)p._internalMetadata.OU[H]=t._internalMetadata.OU[H];p._internalMetadata.OU[sH]={lastSelected:null,original:[],variants:{}};for(const H of q.original)p._internalMetadata.OU[sH].original.push({mesh:H.mesh,material:H.material});for(const H in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,H)){p._internalMetadata.OU[sH].variants[H]=[];for(const O of q.variants[H])p._internalMetadata.OU[sH].variants[H].push({mesh:O.mesh,material:O.material})}q=p._internalMetadata.OU[sH]}for(const t of q.original)t.mesh===O&&(t.mesh=S);for(const t of q.variants[G.name])t.mesh===O&&(t.mesh=S)}))}})))}}}))),await Promise.all(V).then((H=>{let[O]=H;return O}))}))}}u(sH),A(sH,!0,(H=>new iH(H)));var MH=S(11370);class CH{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:cH.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(H,O){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...CH._GetDefaultOptions(),...H},this._scene=O,this._scene._transmissionHelper=this,this.onErrorObservable=new o.b,this._scene.up.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(H){if(!Object.keys(H).filter((O=>this._options[O]!==H[O])).length)return;const O={...this._options,...H},S=this._options;this._options=O,O.renderSize===S.renderSize&&O.renderTargetTextureType===S.renderTargetTextureType&&O.generateMipmaps===S.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=O.samples,this._opaqueRenderTarget.lodGenerationScale=O.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=O.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(H){return!!H&&!!(H instanceof K.c&&H.subSurface.isRefractionEnabled)}_addMesh(H){this._materialObservers[H.uniqueId]=H.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),G.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(H.material)?(H.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(H)&&this._transparentMeshesCache.push(H)):-1===this._opaqueMeshesCache.indexOf(H)&&this._opaqueMeshesCache.push(H)}))}_removeMesh(H){H.onMaterialChangedObservable.remove(this._materialObservers[H.uniqueId]),delete this._materialObservers[H.uniqueId];let O=this._transparentMeshesCache.indexOf(H);-1!==O&&this._transparentMeshesCache.splice(O,1),O=this._opaqueMeshesCache.indexOf(H),-1!==O&&this._opaqueMeshesCache.splice(O,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(H){const O=this._transparentMeshesCache.indexOf(H),S=this._opaqueMeshesCache.indexOf(H);this._shouldRenderAsTransmission(H.material)?(H.material instanceof K.c&&(H.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==S?(this._opaqueMeshesCache.splice(S,1),this._transparentMeshesCache.push(H)):-1===O&&this._transparentMeshesCache.push(H)):-1!==O?(this._transparentMeshesCache.splice(O,1),this._opaqueMeshesCache.push(H)):-1===S&&this._opaqueMeshesCache.push(H)}_isRenderTargetValid(){var H;return null!==(null===(H=this._opaqueRenderTarget)||void 0===H?void 0:H.getInternalTexture())}_setupRenderTargets(){var H;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new MH.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(H=this._options.clearColor)||void 0===H?void 0:H.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((H=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?H.clearColor.t(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(H.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const S of this._transparentMeshesCache)this._shouldRenderAsTransmission(S.material)&&(S.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const nH="KHR_materials_transmission";class QH{constructor(H){this.name=nH,this.order=175,this._loader=H,this.enabled=this._loader.isExtensionUsed(nH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadTransparentPropertiesAsync(t,O,S,q)),await Promise.all(p).then((()=>{}))}))}_loadTransparentPropertiesAsync(H,O,S,t){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const q=S;if(q.subSurface.isRefractionEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.useAlbedoToTintRefraction=!0,void 0===t.transmissionFactor)return q.subSurface.refractionIntensity=0,q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var p;q.subSurface.refractionIntensity=t.transmissionFactor;const H=q.YH();if(q.subSurface.refractionIntensity&&!H._transmissionHelper)new CH({},q.YH());else if(q.subSurface.refractionIntensity&&(null===(p=H._transmissionHelper)||void 0===p||!p._isRenderTargetValid())){var G;null===(G=H._transmissionHelper)||void 0===G||G._setupRenderTargets()}}return q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,t.transmissionTexture?(t.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/transmissionTexture`,t.transmissionTexture,void 0).then((H=>{H.name=`${S.name} (Transmission)`,q.subSurface.refractionIntensityTexture=H,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(nH),A(nH,!0,(H=>new QH(H)));const LH="KHR_materials_diffuse_transmission";class HO{constructor(H){this.name=LH,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(LH),this.enabled&&(H.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadTranslucentPropertiesAsync(t,O,S,q)),await Promise.all(p).then((()=>{}))}))}_loadTranslucentPropertiesAsync(H,O,S,t){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const q=S;if(q.subSurface.isTranslucencyEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,q.subSurface.useAlbedoToTintTranslucency=!1,void 0===t.diffuseTransmissionFactor)return q.subSurface.translucencyIntensity=0,q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();q.subSurface.translucencyIntensity=t.diffuseTransmissionFactor;const G=new Array;return q.subSurface.useGltfStyleTextures=!0,t.diffuseTransmissionTexture&&(t.diffuseTransmissionTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionTexture`,t.diffuseTransmissionTexture).then((H=>{H.name=`${S.name} (Diffuse Transmission)`,q.subSurface.translucencyIntensityTexture=H})))),void 0!==t.diffuseTransmissionColorFactor?q.subSurface.translucencyColor=p.TO.KO(t.diffuseTransmissionColorFactor):q.subSurface.translucencyColor=p.TO.White(),t.diffuseTransmissionColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${H}/diffuseTransmissionColorTexture`,t.diffuseTransmissionColorTexture).then((H=>{H.name=`${S.name} (Diffuse Transmission Color)`,q.subSurface.translucencyColorTexture=H}))),Promise.all(G).then((()=>{}))}}u(LH),A(LH,!0,(H=>new HO(H)));const OO="KHR_materials_volume";class SO{constructor(H){this.name=OO,this.order=173,this._loader=H,this.enabled=this._loader.isExtensionUsed(OO),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadVolumePropertiesAsync(t,O,S,q)),await Promise.all(p).then((()=>{}))}))}_loadVolumePropertiesAsync(H,O,S,t){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);if(!S.subSurface.isRefractionEnabled&&!S.subSurface.isTranslucencyEnabled||!t.thicknessFactor)return Promise.resolve();S.subSurface.volumeIndexOfRefraction=S.indexOfRefraction;const q=void 0!==t.attenuationDistance?t.attenuationDistance:Number.MAX_VALUE;return S.subSurface.tintColorAtDistance=q,void 0!==t.attenuationColor&&3==t.attenuationColor.length&&S.subSurface.tintColor.jU(t.attenuationColor[0],t.attenuationColor[1],t.attenuationColor[2]),S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=t.thicknessFactor,S.subSurface.useThicknessAsDepth=!0,t.thicknessTexture?(t.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${H}/thicknessTexture`,t.thicknessTexture).then((H=>{H.name=`${S.name} (Thickness)`,S.subSurface.thicknessTexture=H,S.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}u(OO),A(OO,!0,(H=>new SO(H)));const tO="KHR_materials_dispersion";class qO{constructor(H){this.name=tO,this.order=174,this._loader=H,this.enabled=this._loader.isExtensionUsed(tO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadDispersionPropertiesAsync(t,O,S,q)),await Promise.all(p).then((()=>{}))}))}_loadDispersionPropertiesAsync(H,O,S,t){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);return S.subSurface.isRefractionEnabled&&t.dispersion?(S.subSurface.isDispersionEnabled=!0,S.subSurface.dispersion=t.dispersion,Promise.resolve()):Promise.resolve()}}u(tO),A(tO,!0,(H=>new qO(H)));const pO="EXT_materials_diffuse_roughness";class GO{constructor(H){this.name=pO,this.order=190,this._loader=H,this.enabled=this._loader.isExtensionUsed(pO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(H,O,S)),p.push(this._loadDiffuseRoughnessPropertiesAsync(t,q,S)),await Promise.all(p).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(H,O,S){if(!(S instanceof K.c))throw new Error(`${H}: Material type not supported`);const t=new Array;return S.brdf.baseDiffuseModel=cH.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=O.diffuseRoughnessFactor?S.baseDiffuseRoughness=O.diffuseRoughnessFactor:S.baseDiffuseRoughness=0,O.diffuseRoughnessTexture&&t.push(this._loader.loadTextureInfoAsync(`${H}/diffuseRoughnessTexture`,O.diffuseRoughnessTexture,(H=>{H.name=`${S.name} (Diffuse Roughness)`,S.baseDiffuseRoughnessTexture=H}))),Promise.all(t).then((()=>{}))}}u(pO),A(pO,!0,(H=>new GO(H)));const UO="KHR_mesh_quantization";class VO{constructor(H){this.name=UO,this.enabled=H.isExtensionUsed(UO)}dispose(){}}u(UO),A(UO,!0,(H=>new VO(H)));const wO="KHR_texture_basisu";class oO{constructor(H){this.name=wO,this._loader=H,this.enabled=H.isExtensionUsed(wO)}dispose(){this._loader=null}_loadTextureAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>{const p=void 0==O.sampler?B.DefaultSampler:c.Get(`${H}/sampler`,this._loader.OU.samplers,O.sampler),G=c.Get(`${t}/source`,this._loader.OU.images,q.source);return await this._loader._createTextureAsync(H,p,G,(H=>{S(H)}),O._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!O._textureInfo.nonColorData)}))}}u(wO),A(wO,!0,(H=>new oO(H)));const hO="KHR_texture_transform";class aO{constructor(H){this.name=hO,this._loader=H,this.enabled=this._loader.isExtensionUsed(hO)}dispose(){this._loader=null}loadTextureInfoAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(t,q)=>await this._loader.loadTextureInfoAsync(H,O,(H=>{if(!(H instanceof b.b))throw new Error(`${t}: Texture type not supported`);q.offset&&(H.uOffset=q.offset[0],H.vOffset=q.offset[1]),H.uRotationCenter=0,H.vRotationCenter=0,q.rotation&&(H.wAng=-q.rotation),q.scale&&(H.uScale=q.scale[0],H.vScale=q.scale[1]),void 0!=q.texCoord&&(H.coordinatesIndex=q.texCoord),S(H)}))))}}u(hO),A(hO,!0,(H=>new aO(H)));const jO="KHR_xmp_json_ld";class eO{constructor(H){this.name=jO,this.order=100,this._loader=H,this.enabled=this._loader.isExtensionUsed(jO)}dispose(){this._loader=null}onLoading(){var H,O,S;if(null===this._loader.rootBabylonMesh)return;const t=null===(H=this._loader.OU.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld,q=null===(O=this._loader.OU.asset)||void 0===O||null===(S=O.extensions)||void 0===S?void 0:S.KHR_xmp_json_ld;if(t&&q){const H=+q.packet;t.packets&&H<t.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=t.packets[H])}}}function XO(H,O,S,t){return p.TO.KO(O,S).scale(t)}function EO(H,O,S,t){return O[S]*t}function yO(H,O,S,t){return-O[S]*t}function TO(H,O,S,t){return O[S+1]*t}function KO(H,O,S,t){return O[S]*t*2}function bO(H){return{scale:[new FO(a.d.ANIMATIONTYPE_FLOAT,`${H}.uScale`,EO,(()=>2)),new FO(a.d.ANIMATIONTYPE_FLOAT,`${H}.vScale`,TO,(()=>2))],offset:[new FO(a.d.ANIMATIONTYPE_FLOAT,`${H}.uOffset`,EO,(()=>2)),new FO(a.d.ANIMATIONTYPE_FLOAT,`${H}.vOffset`,TO,(()=>2))],rotation:[new FO(a.d.ANIMATIONTYPE_FLOAT,`${H}.wAng`,yO,(()=>1))]}}u(jO),A(jO,!0,(H=>new eO(H)));class DO extends Z.AnimationPropertyInfo{buildAnimations(H,O,S,t){return[{babylonAnimatable:H._babylonCamera,babylonAnimation:this._buildAnimation(O,S,t)}]}}class FO extends Z.AnimationPropertyInfo{buildAnimations(H,O,S,t){const q=[];for(const p in H._data)q.push({babylonAnimatable:H._data[p].babylonMaterial,babylonAnimation:this._buildAnimation(O,S,t)});return q}}class YO extends Z.AnimationPropertyInfo{buildAnimations(H,O,S,t){return[{babylonAnimatable:H._babylonLight,babylonAnimation:this._buildAnimation(O,S,t)}]}}(0,J.h)("/cameras/{}/orthographic/xmag",[new DO(a.d.ANIMATIONTYPE_FLOAT,"orthoLeft",yO,(()=>1)),new DO(a.d.ANIMATIONTYPE_FLOAT,"orthoRight",TO,(()=>1))]),(0,J.h)("/cameras/{}/orthographic/ymag",[new DO(a.d.ANIMATIONTYPE_FLOAT,"orthoBottom",yO,(()=>1)),new DO(a.d.ANIMATIONTYPE_FLOAT,"orthoTop",TO,(()=>1))]),(0,J.h)("/cameras/{}/orthographic/zfar",[new DO(a.d.ANIMATIONTYPE_FLOAT,"maxZ",EO,(()=>1))]),(0,J.h)("/cameras/{}/orthographic/znear",[new DO(a.d.ANIMATIONTYPE_FLOAT,"UU",EO,(()=>1))]),(0,J.h)("/cameras/{}/perspective/yfov",[new DO(a.d.ANIMATIONTYPE_FLOAT,"fov",EO,(()=>1))]),(0,J.h)("/cameras/{}/perspective/zfar",[new DO(a.d.ANIMATIONTYPE_FLOAT,"maxZ",EO,(()=>1))]),(0,J.h)("/cameras/{}/perspective/znear",[new DO(a.d.ANIMATIONTYPE_FLOAT,"UU",EO,(()=>1))]),(0,J.h)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"albedoColor",XO,(()=>4)),new FO(a.d.ANIMATIONTYPE_FLOAT,"alpha",(function(H,O,S,t){return O[S+3]*t}),(()=>4))]),(0,J.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"metallic",EO,(()=>1))]),(0,J.h)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"roughness",EO,(()=>1))]);const lO=bO("albedoTexture");(0,J.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",lO.scale),(0,J.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",lO.offset),(0,J.h)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",lO.rotation);const dO=bO("metallicTexture");(0,J.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",dO.scale),(0,J.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",dO.offset),(0,J.h)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",dO.rotation),(0,J.h)("/materials/{}/emissiveFactor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"emissiveColor",XO,(()=>3))]);const vO=bO("bumpTexture");(0,J.h)("/materials/{}/normalTexture/scale",[new FO(a.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",EO,(()=>1))]),(0,J.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",vO.scale),(0,J.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",vO.offset),(0,J.h)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",vO.rotation),(0,J.h)("/materials/{}/occlusionTexture/strength",[new FO(a.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",EO,(()=>1))]);const zO=bO("ambientTexture");(0,J.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",zO.scale),(0,J.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",zO.offset),(0,J.h)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",zO.rotation);const mO=bO("emissiveTexture");(0,J.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",mO.scale),(0,J.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",mO.offset),(0,J.h)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",mO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new FO(a.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new FO(a.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",EO,(()=>1))]);const rO=bO("anisotropy.texture");(0,J.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",rO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",rO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",rO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",EO,(()=>1))]);const WO=bO("clearCoat.texture");(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",WO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",WO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",WO.rotation);const gO=bO("clearCoat.bumpTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new FO(a.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",gO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",gO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",gO.rotation);const NO=bO("clearCoat.textureRoughness");(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",NO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",NO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",NO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new FO(a.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_ior/ior",[new FO(a.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new FO(a.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new FO(a.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",EO,(()=>1))]);const xO=bO("iridescence.texture");(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",xO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",xO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",xO.rotation);const kO=bO("iridescence.thicknessTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",kO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",kO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",kO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"sheen.color",XO,(()=>3))]),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",EO,(()=>1))]);const AO=bO("sheen.texture");(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",AO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",AO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",AO.rotation);const uO=bO("sheen.textureRoughness");(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",uO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",uO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",uO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",XO,(()=>3))]);const JO=bO("metallicReflectanceTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",JO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",JO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",JO.rotation);const PO=bO("reflectanceTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",PO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",PO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",PO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",EO,(()=>1))]);const fO=bO("subSurface.refractionIntensityTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",fO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",fO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",fO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",XO,(()=>3))]),(0,J.h)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new FO(a.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",EO,(()=>1))]),(0,J.h)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",EO,(()=>1))]);const cO=bO("subSurface.thicknessTexture");(0,J.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",cO.scale),(0,J.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",cO.offset),(0,J.h)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",cO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new FO(a.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",EO,(()=>1))]);const RO=bO("subSurface.translucencyIntensityTexture");(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",RO.scale),(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",RO.offset),(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",RO.rotation),(0,J.h)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new FO(a.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",XO,(()=>3))]);const BO=bO("subSurface.translucencyColorTexture");(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",BO.scale),(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",BO.offset),(0,J.h)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",BO.rotation),(0,J.h)("/extensions/KHR_lights_punctual/lights/{}/color",[new YO(a.d.ANIMATIONTYPE_COLOR3,"diffuse",XO,(()=>3))]),(0,J.h)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new YO(a.d.ANIMATIONTYPE_FLOAT,"intensity",EO,(()=>1))]),(0,J.h)("/extensions/KHR_lights_punctual/lights/{}/range",[new YO(a.d.ANIMATIONTYPE_FLOAT,"range",EO,(()=>1))]),(0,J.h)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new YO(a.d.ANIMATIONTYPE_FLOAT,"innerAngle",KO,(()=>1))]),(0,J.h)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new YO(a.d.ANIMATIONTYPE_FLOAT,"angle",KO,(()=>1))]),(0,J.h)("/nodes/{}/extensions/EXT_lights_ies/color",[new YO(a.d.ANIMATIONTYPE_COLOR3,"diffuse",XO,(()=>3))]),(0,J.h)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new YO(a.d.ANIMATIONTYPE_FLOAT,"intensity",EO,(()=>1))]);const ZO="KHR_animation_pointer";class IO{constructor(H){this.name=ZO,this._loader=H,this._pathToObjectConverter=(0,J.f)(this._loader.OU)}get enabled(){return this._loader.isExtensionUsed(ZO)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(H,O,S,t,q){var p;const G=null===(p=t.target.extensions)||void 0===p?void 0:p.KHR_animation_pointer;if(!G||!this._pathToObjectConverter)return null;"pointer"!==t.target.path&&X.b.Warn(`${H}/target/path: Value (${t.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=t.target.node&&X.b.Warn(`${H}/target/node: Value (${t.target.node}) must not be present when using the ${this.name} extension`);const U=`${H}/extensions/${this.name}`,V=G.pointer;if(!V)throw new Error(`${U}: Pointer is missing`);try{const p=this._pathToObjectConverter.convert(V);if(!p.info.interpolation)throw new Error(`${U}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(H,O,S,t,{object:p.object,info:p.info.interpolation},q)}catch(w){return X.b.Warn(`${U}/pointer: Invalid pointer (${V}) skipped`),null}}}u(ZO),A(ZO,!0,(H=>new IO(H)));class sO{constructor(H,O,S){this.frame=H,this.action=O,this.onlyOnce=S,this.isDone=!1}_clone(){return new sO(this.frame,this.action,this.onlyOnce)}}var iO=S(11169),MO=S(11213),CO=S(11205);class nO{get loop(){return this._loop}set loop(H){H!==this._loop&&(this._loop=H,this.updateOptions({loop:H}))}get currentTime(){var H;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(H=MO.b.audioEngine)&&void 0!==H&&H.audioContext&&(this.isPlaying||this.isPaused)){const H=this.isPaused?0:MO.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+H}return 0}get spatialSound(){return this._spatialSound}set spatialSound(H){if(H==this._spatialSound)return;const O=this.isPlaying;this.pause(),H?(this._spatialSound=H,this._updateSpatialParameters()):this._disableSpatialSound(),O&&this.play()}constructor(H,O,S){var t;let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,U=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new o.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=q.eO.Zero(),this._localDirection=new q.eO(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=H,S=S||e.c.LastCreatedScene)if(this._scene=S,nO._SceneComponentInitialization(S),this._readyToPlayCallback=p,this._customAttenuationFunction=(H,O,S,t,q)=>O<S?H*(1-O/S):0,U&&(this.autoplay=U.autoplay||!1,this._loop=U.loop||!1,void 0!==U.volume&&(this._volume=U.volume),this._spatialSound=U.spatialSound??!1,this.maxDistance=U.maxDistance??100,this.useCustomAttenuation=U.useCustomAttenuation??!1,this.rolloffFactor=U.rolloffFactor||1,this.refDistance=U.refDistance||1,this.distanceModel=U.distanceModel||"linear",this._playbackRate=U.playbackRate||1,this._streaming=U.streaming??!1,this._length=U.length,this._offset=U.offset),null!==(t=MO.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&MO.b.audioEngine.audioContext){this._soundGain=MO.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let H=!0;if(O)try{"string"===typeof O?(this._urlType="String",this._url=O):O instanceof ArrayBuffer?this._urlType="ArrayBuffer":O instanceof HTMLMediaElement?this._urlType="MediaElement":O instanceof MediaStream?this._urlType="MediaStream":O instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(O)&&(this._urlType="Array");let S=[],t=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MO.b.audioEngine.audioContext.createMediaElementSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=MO.b.audioEngine.audioContext.createMediaStreamSource(O),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":O.byteLength>0&&(t=!0,this._soundLoaded(O));break;case"AudioBuffer":this._audioBufferLoaded(O);break;case"String":S.push(O);case"Array":0===S.length&&(S=O);for(let H=0;H<S.length;H++){const O=S[H];if(t=U&&U.skipCodecCheck||-1!==O.indexOf(".mp3",O.length-4)&&MO.b.audioEngine.isMP3supported||-1!==O.indexOf(".ogg",O.length-4)&&MO.b.audioEngine.isOGGsupported||-1!==O.indexOf(".wav",O.length-4)||-1!==O.indexOf(".m4a",O.length-4)||-1!==O.indexOf(".mp4",O.length-4)||-1!==O.indexOf("blob:"),t){this._streaming?(this._htmlAudioElement=new Audio(O),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,G.Tools.SetCorsBehavior(O,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(O,(H=>{this._soundLoaded(H)}),void 0,!0,!0,(H=>{H&&X.b.Error("XHR "+H.status+" error on: "+O+"."),X.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:H=!1}H?t||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):X.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(V){X.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),MO.b.audioEngine&&!MO.b.audioEngine.WarnedWebAudioUnsupported&&(X.b.Error("Web Audio is not supported by your browser."),MO.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var H;null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(H){var O;null!==(O=MO.b.audioEngine)&&void 0!==O&&O.audioContext&&(this._audioBuffer=H,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(H){var O;null!==(O=MO.b.audioEngine)&&void 0!==O&&O.audioContext&&MO.b.audioEngine.audioContext.decodeAudioData(H,(H=>{this._audioBufferLoaded(H)}),(H=>{X.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+H)}))}setAudioBuffer(H){var O;null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&(this._audioBuffer=H,this._isReadyToPlay=!0)}updateOptions(H){H&&(this.loop=H.loop??this.loop,this.maxDistance=H.maxDistance??this.maxDistance,this.useCustomAttenuation=H.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=H.rolloffFactor??this.rolloffFactor,this.refDistance=H.refDistance??this.refDistance,this.distanceModel=H.distanceModel??this.distanceModel,this._playbackRate=H.playbackRate??this._playbackRate,this._length=H.length??void 0,this.spatialSound=H.spatialSound??this._spatialSound,this._setOffset(H.offset??void 0),this.setVolume(H.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var H;null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&MO.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??MO.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var H;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(H=this._soundPanner)||void 0===H||H.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var H;null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(H){var O;null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(H),this._isOutputConnected=!0)}setDirectionalCone(H,O,S){O<H?X.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=H,this._coneOuterAngle=O,this._coneOuterGain=S,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!=this._coneInnerAngle){var O;if(this._coneOuterAngle<H)return void X.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H,null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!=this._coneOuterAngle){var O;if(H<this._coneInnerAngle)return void X.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H,null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(H){var O;H.equals(this._position)||(this._position.t(H),null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(H){var O;this._localDirection=H,null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const H=this._connectedTransformNode.getWorldMatrix(),O=q.eO.TransformNormal(this._localDirection,H);O.normalize(),this._soundPanner.orientationX.value=O.x,this._soundPanner.orientationY.value=O.y,this._soundPanner.orientationZ.value=O.z}updateDistanceFromListener(){var H;if(null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const H=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.XO(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,H,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(H){this._customAttenuationFunction=H}play(H,O,S){var t;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(t=MO.b.audioEngine)&&void 0!==t&&t.audioContext)try{var q,p;this._clearTimeoutsAndObservers();let t=H?(null===(q=MO.b.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+H:null===(p=MO.b.audioEngine)||void 0===p?void 0:p.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=MO.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const H=()=>{var S;if(null!==(S=MO.b.audioEngine)&&void 0!==S&&S.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=O??0;const S=this._htmlAudioElement.play();void 0!==S&&S.catch((()=>{var O,S;(null===(O=MO.b.audioEngine)||void 0===O||O.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(S=MO.b.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{H()})))}))}else{var t;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(t=MO.b.audioEngine)||void 0===t?void 0:t.onAudioUnlockedObservable.addOnce((()=>{H()}))}};H()}}else{var G;const q=()=>{var q;if(null!==(q=MO.b.audioEngine)&&void 0!==q&&q.audioContext){var p;if(S=S||this._length,void 0!==O&&this._setOffset(O),this._soundSource){const H=this._soundSource;H.onended=()=>{H.disconnect()}}if(this._soundSource=null===(p=MO.b.audioEngine)||void 0===p?void 0:p.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var G;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==O&&(this._soundSource.loopStart=O),void 0!==S&&(this._soundSource.loopEnd=(0|O)+S),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},t=H?(null===(G=MO.b.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+H:MO.b.audioEngine.audioContext.currentTime;const q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(t,q,this.loop?void 0:S)}}};"suspended"===(null===(G=MO.b.audioEngine)||void 0===G?void 0:G.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var H;"suspended"===(null===(H=MO.b.audioEngine)||void 0===H?void 0:H.audioContext.state)?(MO.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=MO.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{q()})))):q()}),500):q()}this._startTime=t,this.isPlaying=!0,this.isPaused=!1}catch(U){X.b.Error("Error while trying to play audio: "+this.name+", "+U.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(H){var O;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var S;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(S=this._streamingSource)||void 0===S||S.disconnect();this.isPlaying=!1}else if(null!==(O=MO.b.audioEngine)&&void 0!==O&&O.audioContext&&this._soundSource){const O=H?MO.b.audioEngine.audioContext.currentTime+H:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(O)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(H=MO.b.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=MO.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(H,O){var S;null!==(S=MO.b.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._soundGain&&(O&&MO.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(MO.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,MO.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(H,MO.b.audioEngine.audioContext.currentTime+O)):this._soundGain.gain.value=H),this._volume=H}setPlaybackRate(H){this._playbackRate=H,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(H){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=H,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=H=>this._onRegisterAfterWorldMatrixUpdate(H),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(H){var O;if(H.getBoundingInfo){const O=H.getBoundingInfo();this.setPosition(O.boundingSphere.centerWorld)}else this.setPosition(H.absolutePosition);null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const H=()=>{(0,CO.f)((()=>this._isReadyToPlay),(()=>{S._audioBuffer=this.getAudioBuffer(),S._isReadyToPlay=!0,S.autoplay&&S.play(0,this._offset,this._length)}),void 0,300)},O={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},S=new nO(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,O);return this.useCustomAttenuation&&S.setAttenuationFunction(this._customAttenuationFunction),S.setPosition(this._position),S.setPlaybackRate(this._playbackRate),H(),S}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const H={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(H.connectedMeshId=this._connectedTransformNode.id),H.position=this._position.pU(),H.refDistance=this.refDistance,H.distanceModel=this.distanceModel,H.isDirectional=this._isDirectional,H.localDirectionToMesh=this._localDirection.pU(),H.coneInnerAngle=this._coneInnerAngle,H.coneOuterAngle=this._coneOuterAngle,H.coneOuterGain=this._coneOuterGain),H}static Parse(H,O,S,t){const p=H.name;let G;G=H.url?S+H.url:S+p;const U={autoplay:H.autoplay,loop:H.loop,volume:H.volume,spatialSound:H.spatialSound,maxDistance:H.maxDistance,rolloffFactor:H.rolloffFactor,refDistance:H.refDistance,distanceModel:H.distanceModel,playbackRate:H.playbackRate};let V;if(t){const H=()=>{(0,CO.f)((()=>t._isReadyToPlay),(()=>{V._audioBuffer=t.getAudioBuffer(),V._isReadyToPlay=!0,V.autoplay&&V.play(0,V._offset,V._length)}),void 0,300)};V=new nO(p,new ArrayBuffer(0),O,null,U),H()}else V=new nO(p,G,O,(()=>{O.removePendingData(V)}),U),O.addPendingData(V);if(H.position){const O=q.eO.KO(H.position);V.setPosition(O)}if(H.isDirectional&&(V.setDirectionalCone(H.coneInnerAngle||360,H.coneOuterAngle||360,H.coneOuterGain||0),H.localDirectionToMesh)){const O=q.eO.KO(H.localDirectionToMesh);V.setLocalDirectionToMesh(O)}if(H.connectedMeshId){const S=O.getMeshById(H.connectedMeshId);S&&V.attachToMesh(S)}return H.metadata&&(V.metadata=H.metadata),V}_setOffset(H){this._offset!==H&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=H)}_clearTimeoutsAndObservers(){var H;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(H=MO.b.audioEngine)||void 0===H||H.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}nO._SceneComponentInitialization=H=>{throw(0,iO.b)("AudioSceneComponent")},(0,FH.g)("BABYLON.Sound",nO);class QO{constructor(H,O,S){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],O.length!==S.length)throw new Error("Sounds length does not equal weights length");this.loop=H,this._weights=S;let t=0;for(const p of S)t+=p;const q=t>0?1/t:0;for(let p=0;p<this._weights.length;p++)this._weights[p]*=q;this._sounds=O;for(const p of this._sounds)p.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(H){if(H!==this._coneInnerAngle){if(this._coneOuterAngle<H)return void X.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=H;for(const O of this._sounds)O.directionalConeInnerAngle=H}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(H){if(H!==this._coneOuterAngle){if(H<this._coneInnerAngle)return void X.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=H;for(const O of this._sounds)O.directionalConeOuterAngle=H}}get volume(){return this._volume}set volume(H){if(H!==this._volume)for(const O of this._sounds)O.setVolume(H)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(H){if(!this.isPaused){this.stop();const H=Math.random();let O=0;for(let S=0;S<this._weights.length;S++)if(O+=this._weights[S],H<=O){this._currentIndex=S;break}}const O=this._sounds[this._currentIndex??0];O.isReady()?O.play(0,this.isPaused?void 0:H):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class LO{constructor(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(H=H||e.c.LastCreatedScene)&&(this._scene=H,this.soundCollection=[],this._options=O,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var H;null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&MO.b.audioEngine.audioContext&&(this._outputAudioNode=MO.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(MO.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(MO.b.audioEngine&&MO.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(H){var O;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&H.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==H.soundTrackId&&(-1===H.soundTrackId?this._scene.mainSoundTrack.removeSound(H):this._scene.soundTracks&&this._scene.soundTracks[H.soundTrackId].removeSound(H)),this.soundCollection.push(H),H.soundTrackId=this.id}removeSound(H){const O=this.soundCollection.indexOf(H);-1!==O&&this.soundCollection.splice(O,1)}setVolume(H){var O;null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=H)}switchPanningModelToHRTF(){var H;if(null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var H;if(null!==(H=MO.b.audioEngine)&&void 0!==H&&H.canUseWebAudio)for(let O=0;O<this.soundCollection.length;O++)this.soundCollection[O].switchPanningModelToEqualPower()}connectToAnalyser(H){var O;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=H,null!==(O=MO.b.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,MO.b.audioEngine.masterGain))}}var HS=S(11582),OS=S(11541),SS=S(11148);MO.b.AudioEngineFactory=(H,O,S)=>new tS(H,O,S);class tS{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new o.b,this.onAudioLockedObservable=new o.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,SS.n)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const t=document.createElement("audio");this._hostElement=H,this._audioContext=O,this._audioDestination=S;try{t&&t.canPlayType&&(t.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||t.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(q){}try{t&&t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(q){}}lock(){this._triggerSuspendedState()}unlock(){var H,O;if("running"===(null===(H=this._audioContext)||void 0===H?void 0:H.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(O=this._audioContext)||void 0===O||O.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{X.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var H;null===(H=this._audioContext)||void 0===H||H.addEventListener("statechange",(()=>{var H;this.unlocked&&"running"!==(null===(H=this._audioContext)||void 0===H?void 0:H.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var H;return null!==(H=this._audioContext)&&void 0!==H&&H.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(H){this.canUseWebAudio=!1,X.b.Error("Web Audio: "+H.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(H){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const H=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",O=document.createElement("style");O.appendChild(document.createTextNode(H)),document.getElementsByTagName("head")[0].appendChild(O),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var H;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(H=this._audioContext)||void 0===H||H.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(H){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=H)}connectToAnalyser(H){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=H,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var qS=S(11162);(0,S(12713).e)(HS.e.NAME_AUDIO,((H,O,S,t)=>{let q,p=[];if(S.ia=S.ia||[],void 0!==H.ia&&null!==H.ia)for(let U=0,V=H.ia.length;U<V;U++){var G;const V=H.ia[U];null!==(G=MO.b.audioEngine)&&void 0!==G&&G.canUseWebAudio?(V.url||(V.url=V.name),p[V.url]?S.ia.push(nO.Parse(V,O,t,p[V.url])):(q=nO.Parse(V,O,t),p[V.url]=q,S.ia.push(q))):S.ia.push(new nO(V.name,null,O))}p=[]})),Object.defineProperty(OS.e.prototype,"mainSoundTrack",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),this._mainSoundTrack||(this._mainSoundTrack=new LO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OS.e.prototype.getSoundByName=function(H){let O;for(O=0;O<this.mainSoundTrack.soundCollection.length;O++)if(this.mainSoundTrack.soundCollection[O].name===H)return this.mainSoundTrack.soundCollection[O];if(this.soundTracks)for(let S=0;S<this.soundTracks.length;S++)for(O=0;O<this.soundTracks[S].soundCollection.length;O++)if(this.soundTracks[S].soundCollection[O].name===H)return this.soundTracks[S].soundCollection[O];return null},Object.defineProperty(OS.e.prototype,"audioEnabled",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),H.audioEnabled},set:function(H){let O=this._getComponent(HS.e.NAME_AUDIO);O||(O=new pS(this),this.o(O)),H?O.enableAudio():O.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OS.e.prototype,"headphone",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),H.headphone},set:function(H){let O=this._getComponent(HS.e.NAME_AUDIO);O||(O=new pS(this),this.o(O)),H?O.switchAudioModeForHeadphones():O.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OS.e.prototype,"audioListenerPositionProvider",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),H.audioListenerPositionProvider},set:function(H){let O=this._getComponent(HS.e.NAME_AUDIO);if(O||(O=new pS(this),this.o(O)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");O.audioListenerPositionProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(OS.e.prototype,"audioListenerRotationProvider",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),H.audioListenerRotationProvider},set:function(H){let O=this._getComponent(HS.e.NAME_AUDIO);if(O||(O=new pS(this),this.o(O)),H&&"function"!==typeof H)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");O.audioListenerRotationProvider=H},enumerable:!0,configurable:!0}),Object.defineProperty(OS.e.prototype,"audioPositioningRefreshRate",{get:function(){let H=this._getComponent(HS.e.NAME_AUDIO);return H||(H=new pS(this),this.o(H)),H.audioPositioningRefreshRate},set:function(H){let O=this._getComponent(HS.e.NAME_AUDIO);O||(O=new pS(this),this.o(O)),O.audioPositioningRefreshRate=H},enumerable:!0,configurable:!0});class pS{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(H){this.name=HS.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new q.eO,this._cachedCameraPosition=new q.eO,this._lastCheck=0,this._invertMatrixTemp=new q.Matrix,this._cameraDirectionTemp=new q.eO,(H=H||e.c.LastCreatedScene)&&(this.EO=H,H.soundTracks=[],H.ia=[])}register(){this.EO._afterRenderStage.registerStep(HS.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(H){if(H.ia=[],this.EO.soundTracks)for(let O=0;O<this.EO.soundTracks.length;O++){const S=this.EO.soundTracks[O];for(let O=0;O<S.soundCollection.length;O++)H.ia.push(S.soundCollection[O].serialize())}}addFromContainer(H){if(H.ia)for(const O of H.ia)O.play(),O.autoplay=!0,this.EO.mainSoundTrack.addSound(O)}removeFromContainer(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(H.ia)for(const S of H.ia)S.stop(),S.autoplay=!1,this.EO.mainSoundTrack.removeSound(S),O&&S.dispose()}dispose(){const H=this.EO;if(H._mainSoundTrack&&H.mainSoundTrack.dispose(),H.soundTracks)for(let O=0;O<H.soundTracks.length;O++)H.soundTracks[O].dispose()}disableAudio(){const H=this.EO;let O;for(this._audioEnabled=!1,MO.b.audioEngine&&MO.b.audioEngine.audioContext&&MO.b.audioEngine.audioContext.suspend(),O=0;O<H.mainSoundTrack.soundCollection.length;O++)H.mainSoundTrack.soundCollection[O].pause();if(H.soundTracks)for(O=0;O<H.soundTracks.length;O++)for(let S=0;S<H.soundTracks[O].soundCollection.length;S++)H.soundTracks[O].soundCollection[S].pause()}enableAudio(){const H=this.EO;let O;for(this._audioEnabled=!0,MO.b.audioEngine&&MO.b.audioEngine.audioContext&&MO.b.audioEngine.audioContext.resume(),O=0;O<H.mainSoundTrack.soundCollection.length;O++)H.mainSoundTrack.soundCollection[O].isPaused&&H.mainSoundTrack.soundCollection[O].play();if(H.soundTracks)for(O=0;O<H.soundTracks.length;O++)for(let S=0;S<H.soundTracks[O].soundCollection.length;S++)H.soundTracks[O].soundCollection[S].isPaused&&H.soundTracks[O].soundCollection[S].play()}switchAudioModeForHeadphones(){const H=this.EO;if(this._headphone=!0,H.mainSoundTrack.switchPanningModelToHRTF(),H.soundTracks)for(let O=0;O<H.soundTracks.length;O++)H.soundTracks[O].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const H=this.EO;if(this._headphone=!1,H.mainSoundTrack.switchPanningModelToEqualPower(),H.soundTracks)for(let O=0;O<H.soundTracks.length;O++)H.soundTracks[O].switchPanningModelToEqualPower()}_afterRender(){const H=qS.d.Now;if(this._lastCheck&&H-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=H;const O=this.EO;if(!this._audioEnabled||!O._mainSoundTrack||!O.soundTracks||0===O._mainSoundTrack.soundCollection.length&&1===O.soundTracks.length)return;const S=MO.b.audioEngine;if(S&&S.audioContext){let H,t=O.activeCamera;if(O.activeCameras&&O.activeCameras.length>0&&(t=O.activeCameras[0]),this.audioListenerPositionProvider){const H=this.audioListenerPositionProvider();S.audioContext.listener.setPosition(H.x||0,H.y||0,H.z||0)}else t?this._cachedCameraPosition.equals(t.globalPosition)||(this._cachedCameraPosition.t(t.globalPosition),S.audioContext.listener.setPosition(t.globalPosition.x,t.globalPosition.y,t.globalPosition.z)):S.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const H=this.audioListenerRotationProvider();S.audioContext.listener.setOrientation(H.x||0,H.y||0,H.z||0,0,1,0)}else t?(t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]),t.getViewMatrix().invertToRef(this._invertMatrixTemp),q.eO.TransformNormalToRef(pS._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.t(this._cameraDirectionTemp),S.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):S.audioContext.listener.setOrientation(0,0,0,0,1,0);for(H=0;H<O.mainSoundTrack.soundCollection.length;H++){const S=O.mainSoundTrack.soundCollection[H];S.useCustomAttenuation&&S.updateDistanceFromListener()}if(O.soundTracks)for(H=0;H<O.soundTracks.length;H++)for(let S=0;S<O.soundTracks[H].soundCollection.length;S++){const t=O.soundTracks[H].soundCollection[S];t.useCustomAttenuation&&t.updateDistanceFromListener()}}}}pS._CameraDirection=new q.eO(0,0,-1),nO._SceneComponentInitialization=H=>{let O=H._getComponent(HS.e.NAME_AUDIO);O||(O=new pS(H),H.o(O))};const GS="MSFT_audio_emitter";class US{constructor(H){this.name=GS,this._loader=H,this.enabled=this._loader.isExtensionUsed(GS)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const H=this._loader.OU.extensions;if(H&&H[this.name]){const O=H[this.name];this._clips=O.clips,this._emitters=O.emitters,c.Assign(this._clips),c.Assign(this._emitters)}}loadSceneAsync(H,O){return B.LoadExtensionAsync(H,O,this.name,(async(S,t)=>{const q=new Array;q.push(this._loader.loadSceneAsync(H,O));for(const H of t.emitters){const O=c.Get(`${S}/emitters`,this._emitters,H);if(void 0!=O.refDistance||void 0!=O.maxDistance||void 0!=O.rolloffFactor||void 0!=O.distanceModel||void 0!=O.innerAngle||void 0!=O.outerAngle)throw new Error(`${S}: Direction or Distance properties are not allowed on emitters attached to a scene`);q.push(this._loadEmitterAsync(`${S}/emitters/${O.index}`,O))}await Promise.all(q)}))}loadNodeAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(H,t)=>{const p=new Array,U=await this._loader.loadNodeAsync(H,O,(O=>{for(const S of t.emitters){const t=c.Get(`${H}/emitters`,this._emitters,S);p.push(this._loadEmitterAsync(`${H}/emitters/${t.index}`,t).then((()=>{for(const H of t._babylonSounds)H.attachToMesh(O),void 0==t.innerAngle&&void 0==t.outerAngle||(H.setLocalDirectionToMesh(q.eO.Forward()),H.setDirectionalCone(2*G.Tools.ToDegrees(void 0==t.innerAngle?Math.PI:t.innerAngle),2*G.Tools.ToDegrees(void 0==t.outerAngle?Math.PI:t.outerAngle),0))})))}S(O)}));return await Promise.all(p),U}))}loadAnimationAsync(H,O){return B.LoadExtensionAsync(H,O,this.name,(async(S,t)=>{const q=await this._loader.loadAnimationAsync(H,O),p=new Array;c.Assign(t.events);for(const G of t.events)p.push(this._loadAnimationEventAsync(`${S}/events/${G.index}`,H,O,G,q));return await Promise.all(p),q}))}_loadClipAsync(H,O){if(O._objectURL)return O._objectURL;let S;if(O.uri)S=this._loader.loadUriAsync(H,O,O.uri);else{const t=c.Get(`${H}/bufferView`,this._loader.OU.bufferViews,O.bufferView);S=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return O._objectURL=S.then((H=>URL.createObjectURL(new Blob([H],{type:O.mimeType})))),O._objectURL}_loadEmitterAsync(H,O){if(O._babylonSounds=O._babylonSounds||[],!O._babylonData){const H=new Array,S=O.name||`emitter${O.index}`,t={loop:!1,autoplay:!1,volume:void 0==O.volume?1:O.volume};for(let p=0;p<O.clips.length;p++){const q=`/extensions/${this.name}/clips`,G=c.Get(q,this._clips,O.clips[p].clip);H.push(this._loadClipAsync(`${q}/${O.clips[p].clip}`,G).then((H=>{const q=O._babylonSounds[p]=new nO(S,H,this._loader.babylonScene,null,t);q.refDistance=O.refDistance||1,q.maxDistance=O.maxDistance||256,q.rolloffFactor=O.rolloffFactor||1,q.distanceModel=O.distanceModel||"exponential"})))}const q=Promise.all(H).then((()=>{const H=O.clips.map((H=>H.weight||1)),S=new QO(O.loop||!1,O._babylonSounds,H);O.innerAngle&&(S.directionalConeInnerAngle=2*G.Tools.ToDegrees(O.innerAngle)),O.outerAngle&&(S.directionalConeOuterAngle=2*G.Tools.ToDegrees(O.outerAngle)),O.volume&&(S.volume=O.volume),O._babylonData.sound=S}));O._babylonData={loaded:q}}return O._babylonData.loaded}_getEventAction(H,O,S,t,q){switch(S){case"play":return H=>{const S=(q||0)+(H-t);O.play(S)};case"stop":return()=>{O.stop()};case"pause":return()=>{O.pause()};default:throw new Error(`${H}: Unsupported action ${S}`)}}_loadAnimationEventAsync(H,O,S,t,q){if(0==q.targetedAnimations.length)return Promise.resolve();const p=q.targetedAnimations[0],G=t.tO,U=c.Get(`/extensions/${this.name}/emitters`,this._emitters,G);return this._loadEmitterAsync(H,U).then((()=>{const O=U._babylonData.sound;if(O){const S=new sO(t.time,this._getEventAction(H,O,t.action,t.time,t.startOffset));p.animation.addEvent(S),q.onAnimationGroupEndObservable.add((()=>{O.stop()})),q.onAnimationGroupPauseObservable.add((()=>{O.pause()}))}}))}}u(GS),A(GS,!0,(H=>new US(H)));const VS="MSFT_lod";class wS{constructor(H){var O;this.name=VS,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new o.b,this.onMaterialLODsLoadedObservable=new o.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=H,this.maxLODsToLoad=(null===(O=this._loader.parent.extensionOptions[VS])||void 0===O?void 0:O.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(VS)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let H=0;H<this._nodePromiseLODs.length;H++){const O=Promise.all(this._nodePromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Node LOD ${H}`),this._loader.log(`Loaded node LOD ${H}`)),this.onNodeLODsLoadedObservable.notifyObservers(H),H!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${H+1}`),this._loadBufferLOD(this._nodeBufferLODs,H+1),this._nodeSignalLODs[H]&&this._nodeSignalLODs[H].resolve())}));this._loader._completePromises.push(O)}for(let H=0;H<this._materialPromiseLODs.length;H++){const O=Promise.all(this._materialPromiseLODs[H]).then((()=>{0!==H&&(this._loader.endPerformanceCounter(`Material LOD ${H}`),this._loader.log(`Loaded material LOD ${H}`)),this.onMaterialLODsLoadedObservable.notifyObservers(H),H!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${H+1}`),this._loadBufferLOD(this._materialBufferLODs,H+1),this._materialSignalLODs[H]&&this._materialSignalLODs[H].resolve())}));this._loader._completePromises.push(O)}}loadSceneAsync(H,O){const S=this._loader.loadSceneAsync(H,O);return this._loadBufferLOD(this._bufferLODs,0),S}loadNodeAsync(H,O,S){return B.LoadExtensionAsync(H,O,this.name,(async(H,q)=>{let p;const G=this._getLODs(H,O,this._loader.OU.nodes,q.ids);this._loader.logOpen(`${H}`);for(let O=0;O<G.length;O++){const H=G[O];0!==O&&(this._nodeIndexLOD=O,this._nodeSignalLODs[O]=this._nodeSignalLODs[O]||new t);const q=H=>{S(H),H.uU(!1)},U=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,q).then((H=>{if(0!==O){const H=G[O-1];H._babylonTransformNode&&(this._disposeTransformNode(H._babylonTransformNode),delete H._babylonTransformNode)}return H.uU(!0),H}));this._nodePromiseLODs[O]=this._nodePromiseLODs[O]||[],0===O?p=U:(this._nodeIndexLOD=null,this._nodePromiseLODs[O].push(U))}return this._loader.logClose(),await p}))}_loadMaterialAsync(H,O,S,t,q){return this._nodeIndexLOD?null:B.LoadExtensionAsync(H,O,this.name,(async(H,p)=>{let G;const U=this._getLODs(H,O,this._loader.OU.materials,p.ids);this._loader.logOpen(`${H}`);for(let O=0;O<U.length;O++){const H=U[O];0!==O&&(this._materialIndexLOD=O);const p=this._loader._loadMaterialAsync(`/materials/${H.index}`,H,S,t,(H=>{0===O&&q(H)})).then((H=>{if(0!==O){q(H);const S=U[O-1]._data;S[t]&&(this._disposeMaterials([S[t].babylonMaterial]),delete S[t])}return H}));this._materialPromiseLODs[O]=this._materialPromiseLODs[O]||[],0===O?G=p:(this._materialIndexLOD=null,this._materialPromiseLODs[O].push(p))}return this._loader.logClose(),await G}))}_loadUriAsync(H,O,S){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const q=this._nodeIndexLOD-1;return this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new t,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(H,O,S)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const q=this._materialIndexLOD-1;return this._materialSignalLODs[q]=this._materialSignalLODs[q]||new t,this._materialSignalLODs[q].promise.then((async()=>await this._loader.loadUriAsync(H,O,S)))}return null}loadBufferAsync(H,O,S,q){if(this._loader.parent.useRangeRequests&&!O.uri){if(!this._loader.bin)throw new Error(`${H}: Uri is missing or the binary glTF is missing its binary chunk`);const O=async(H,O)=>{const p=S,G=p+q-1;let U=H[O];return U?(U.start=Math.min(U.start,p),U.end=Math.max(U.end,G)):(U={start:p,end:G,loaded:new t},H[O]=U),await U.loaded.promise.then((H=>new Uint8Array(H.buffer,H.byteOffset+S-U.start,q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?O(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?O(this._materialBufferLODs,this._materialIndexLOD):O(this._bufferLODs,0)}return null}_loadBufferLOD(H,O){const S=H[O];S&&(this._loader.log(`Loading buffer range [${S.start}-${S.end}]`),this._loader.bin.readAsync(S.start,S.end-S.start+1).then((H=>{S.loaded.resolve(H)}),(H=>{S.loaded.reject(H)})))}_getLODs(H,O,S,t){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const q=[];for(let p=t.length-1;p>=0;p--)if(q.push(c.Get(`${H}/ids/${t[p]}`,S,t[p])),q.length===this.maxLODsToLoad)return q;return q.push(O),q}_disposeTransformNode(H){const O=[],S=H.material;S&&O.push(S);for(const q of H.getChildMeshes())q.material&&O.push(q.material);H.dispose();const t=O.filter((H=>this._loader.babylonScene.meshes.every((O=>O.material!=H))));this._disposeMaterials(t)}_disposeMaterials(H){const O={};for(const S of H){for(const H of S.getActiveTextures())O[H.uniqueId]=H;S.dispose()}for(const S in O)for(const H of this._loader.babylonScene.materials)H.hasTexture(O[S])&&delete O[S];for(const S in O)O[S].dispose()}}u(VS),A(VS,!0,(H=>new wS(H)));const oS="MSFT_minecraftMesh";class hS{constructor(H){this.name=oS,this._loader=H,this.enabled=this._loader.isExtensionUsed(oS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtraAsync(H,O,this.name,(async(t,q)=>{if(q){if(!(S instanceof K.c))throw new Error(`${t}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(H,O,S);return S.needAlphaBlending()&&(S.forceDepthWrite=!0,S.separateCullingPass=!0),S.aU=S.forceDepthWrite,S.twoSidedLighting=!0,await q}}))}}u(oS),A(oS,!0,(H=>new hS(H)));const aS="MSFT_sRGBFactors";class jS{constructor(H){this.name=aS,this._loader=H,this.enabled=this._loader.isExtensionUsed(aS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(H,O,S){return B.LoadExtraAsync(H,O,this.name,(async(t,q)=>{if(q){if(!(S instanceof K.c))throw new Error(`${t}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(H,O,S),p=S.YH().getEngine().useExactSrgbConversions;return S.albedoTexture||S.albedoColor.toLinearSpaceToRef(S.albedoColor,p),S.reflectivityTexture||S.reflectivityColor.toLinearSpaceToRef(S.reflectivityColor,p),await q}}))}}u(aS),A(aS,!0,(H=>new jS(H)));var eS=S(13023);const XS={};var ES=S(13080),yS=S(13055),TS=S(13025),KS=S(13035);function bS(H,O){for(const S of H)for(const H of S.dataOutputs)if(H.uniqueId===O)return H;throw new Error("Could not find data out connection with unique id "+O)}function DS(H,O){for(const S of H)if(S instanceof yS.e)for(const H of S.signalInputs)if(H.uniqueId===O)return H;throw new Error("Could not find signal in connection with unique id "+O)}async function FS(H,O){const t=await Promise.all(H.allBlocks.map((async H=>{const O=function(H){switch(H){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([S.e(78),S.e(79)]).then(S.bind(S,14451))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await S.e(80).then(S.bind(S,14459))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await S.e(81).then(S.bind(S,14467))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await S.e(82).then(S.bind(S,14471))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await S.e(83).then(S.bind(S,14478))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await S.e(84).then(S.bind(S,14483))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await S.e(85).then(S.bind(S,14487))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await S.e(86).then(S.bind(S,14494))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await S.e(87).then(S.bind(S,14500))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await S.e(95).then(S.bind(S,14539))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await S.e(96).then(S.bind(S,14546))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await S.e(97).then(S.bind(S,14549))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await S.e(98).then(S.bind(S,14558))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await S.e(99).then(S.bind(S,14562))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await S.e(100).then(S.bind(S,14564))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await S.e(101).then(S.bind(S,14568))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await S.e(102).then(S.bind(S,14571))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await S.e(103).then(S.bind(S,14574))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await S.e(104).then(S.bind(S,14581))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await S.e(105).then(S.bind(S,14589))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await S.e(106).then(S.bind(S,14596))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await S.e(107).then(S.bind(S,14598))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await S.e(108).then(S.bind(S,14607))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await S.e(109).then(S.bind(S,14613))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await S.e(110).then(S.bind(S,14622))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await S.e(111).then(S.bind(S,14626))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await S.e(112).then(S.bind(S,14632))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await S.e(113).then(S.bind(S,14637))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await S.e(92).then(S.bind(S,14646))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await S.e(114).then(S.bind(S,14655))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await S.e(115).then(S.bind(S,14659))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await S.e(116).then(S.bind(S,14663))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await S.e(93).then(S.bind(S,14667))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await S.e(88).then(S.bind(S,14508))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await S.e(94).then(S.bind(S,14670))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await S.e(89).then(S.bind(S,14527))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await S.e(90).then(S.bind(S,14533))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await S.e(91).then(S.bind(S,14678))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await S.e(117).then(S.bind(S,14680))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await S.e(118).then(S.bind(S,14682))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await S.e(119).then(S.bind(S,14691))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await S.e(120).then(S.bind(S,14695))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await S.e(121).then(S.bind(S,14697))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await S.e(122).then(S.bind(S,14705))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await S.e(123).then(S.bind(S,14714))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await S.e(124).then(S.bind(S,14721))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await S.e(125).then(S.bind(S,14726))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await S.e(126).then(S.bind(S,14732))).FlowGraphDataSwitchBlock;default:if(XS[H])return XS[H];throw new Error(`Unknown block name ${H}`)}}(H.className);return await O()})));return function(H,O,S){const t=O.coordinator.createGraph(),q=[],p=O.valueParseFunction??TS.e;for(let G=0;G<H.allBlocks.length;G++){const U=lS(H.allBlocks[G],{EO:O.coordinator.config.EO,pathConverter:O.pathConverter,assetsContainer:O.coordinator.config.EO,valueParseFunction:p},S[G]);q.push(U),U instanceof ES.e&&t.addEventBlock(U)}for(const G of q){for(const H of G.dataInputs)for(const O of H.connectedPointIds){const S=bS(q,O);H.connectTo(S)}if(G instanceof yS.e)for(const H of G.signalOutputs)for(const O of H.connectedPointIds){const S=DS(q,O);H.connectTo(S)}}for(const G of H.executionContexts)YS(G,{graph:t,valueParseFunction:p},H.rightHanded);return t}(H,O,t)}function YS(H,O,S){const t=O.graph.createContext();H.enableLogging&&(t.enableLogging=!0),t.treatDataAsRightHanded=S||!1;const q=O.valueParseFunction??TS.e;t.uniqueId=H.uniqueId;const p=t.YH();if(H._assetsContext){var G,U,V,w,o,h,a,j,e,X;const O=H._assetsContext,S={meshes:null===(G=O.meshes)||void 0===G?void 0:G.map((H=>p.getMeshById(H))),lights:null===(U=O.lights)||void 0===U?void 0:U.map((H=>p.getLightByName(H))),cameras:null===(V=O.cameras)||void 0===V?void 0:V.map((H=>p.getCameraByName(H))),materials:null===(w=O.materials)||void 0===w?void 0:w.map((H=>p.getMaterialById(H))),textures:null===(o=O.textures)||void 0===o?void 0:o.map((H=>p.getTextureByName(H))),animations:null===(h=O.animations)||void 0===h?void 0:h.map((H=>p.animations.find((O=>O.name===H)))),skeletons:null===(a=O.skeletons)||void 0===a?void 0:a.map((H=>p.getSkeletonByName(H))),ha:null===(j=O.ha)||void 0===j?void 0:j.map((H=>p.getParticleSystemById(H))),animationGroups:null===(e=O.animationGroups)||void 0===e?void 0:e.map((H=>p.getAnimationGroupByName(H))),transformNodes:null===(X=O.transformNodes)||void 0===X?void 0:X.map((H=>p.getTransformNodeById(H))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ia:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};t.assetsContext=S}for(const E in H._userVariables){const O=q(E,H._userVariables,t.assetsContext,p);t.userVariables[E]=O}for(const E in H._connectionValues){const O=q(E,H._connectionValues,t.assetsContext,p);t._setConnectionValueByKey(E,O)}return t}function lS(H,O,S){const t={},q=O.valueParseFunction??TS.e;if(H.config)for(const G in H.config)t[G]=q(G,H.config,O.assetsContainer||O.EO,O.EO);if((0,TS.i)(H.className)){if(!O.pathConverter)throw new Error("Path converter is required for this block");t.pathConverter=O.pathConverter}const p=new S(t);p.uniqueId=H.uniqueId;for(let G=0;G<H.dataInputs.length;G++){const O=p.getDataInput(H.dataInputs[G].name);if(!O)throw new Error("Could not find data input with name "+H.dataInputs[G].name+" in block "+H.className);O.deserialize(H.dataInputs[G])}for(let G=0;G<H.dataOutputs.length;G++){const O=p.getDataOutput(H.dataOutputs[G].name);if(!O)throw new Error("Could not find data output with name "+H.dataOutputs[G].name+" in block "+H.className);O.deserialize(H.dataOutputs[G])}return p.metadata=H.metadata,p.deserialize&&p.deserialize(H),p}function dS(H){const[O,S]=H.split(":");return vS({op:O,extension:S})}function vS(H){var O;let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const t=H.extension?null===(O=mS[H.extension])||void 0===O?void 0:O[H.op]:rS[H.op];if(!t&&(X.b.Warn(`No mapping found for operation ${H.op} and extension ${H.extension||"KHR_interactivity"}`),S)){const O={},S={flows:{}};if(H.inputValueSockets){O.values={};for(const S in H.inputValueSockets)O.values[S]={name:S}}return H.outputValueSockets&&(S.values={},Object.keys(H.outputValueSockets).forEach((H=>{S.values[H]={name:H}}))),{Vo:[],inputs:O,outputs:S}}return t}function zS(H,O,S){mS[O]||(mS[O]={}),mS[O][H]=S}const mS={BABYLON:{"flow/log":{Vo:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},rS={"event/onStart":{Vo:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{Vo:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{Vo:["FlowGraphSendCustomEventBlock"],extraProcessor(H,O,S,t,q){if("event/send"!==O.op||!H.configuration||1!==Object.keys(H.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const p=H.configuration.event.value[0];if("number"!==typeof p)throw new Error("Event id should be a number");const G=t.arrays.events[p],U=q[0];return U.config||(U.config={}),U.config.eventId=G.eventId,U.config.eventData=G.eventData,q}},"event/receive":{Vo:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(H,O){var S;if(!H.configuration)return X.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const t=H.configuration.event;if(!t)return X.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const q=t.value[0];if("number"!==typeof q)return X.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(S=O.events)||void 0===S?void 0:S[q])?{valid:!0}:(X.b.Error(`Event with id ${q} not found`),{valid:!1,error:`Event with id ${q} not found`})},extraProcessor(H,O,S,t,q){if("event/receive"!==O.op||!H.configuration||1!==Object.keys(H.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const p=H.configuration.event.value[0];if("number"!==typeof p)throw new Error("Event id should be a number");const G=t.arrays.events[p],U=q[0];return U.config||(U.config={}),U.config.eventId=G.eventId,U.config.eventData=G.eventData,q}},"math/e":WS("FlowGraphEBlock"),"math/pi":WS("FlowGraphPIBlock"),"math/inf":WS("FlowGraphInfBlock"),"math/nan":WS("FlowGraphNaNBlock"),"math/abs":WS("FlowGraphAbsBlock"),"math/sign":WS("FlowGraphSignBlock"),"math/trunc":WS("FlowGraphTruncBlock"),"math/floor":WS("FlowGraphFloorBlock"),"math/ceil":WS("FlowGraphCeilBlock"),"math/round":{Vo:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q){var p;return(p=q[0]).config||(p.config={}),q[0].config.roundHalfAwayFromZero=!0,q}},"math/fract":WS("FlowGraphFractBlock"),"math/neg":WS("FlowGraphNegationBlock"),"math/add":WS("FlowGraphAddBlock",["a","b"],!0),"math/sub":WS("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{Vo:["FlowGraphMultiplyBlock"],extraProcessor(H,O,S,t,q){var p;(p=q[0]).config||(p.config={}),q[0].config.useMatrixPerComponent=!0,q[0].config.preventIntegerFloatArithmetic=!0;let G=-1;return Object.keys(H.values||{}).find((O=>{var S;return void 0!==(null===(S=H.values)||void 0===S?void 0:S[O].type)&&(G=H.values[O].type,!0)})),-1!==G&&(q[0].config.type=t.arrays.types[G].flowGraphType),q},validation:H=>H.values?gS(H):{valid:!0}},"math/div":WS("FlowGraphDivideBlock",["a","b"],!0),"math/rem":WS("FlowGraphModuloBlock",["a","b"]),"math/min":WS("FlowGraphMinBlock",["a","b"]),"math/max":WS("FlowGraphMaxBlock",["a","b"]),"math/clamp":WS("FlowGraphClampBlock",["a","b","c"]),"math/saturate":WS("FlowGraphSaturateBlock"),"math/mix":WS("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":WS("FlowGraphEqualityBlock",["a","b"]),"math/lt":WS("FlowGraphLessThanBlock",["a","b"]),"math/le":WS("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":WS("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":WS("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":WS("FlowGraphIsNaNBlock"),"math/isinf":WS("FlowGraphIsInfBlock"),"math/select":{Vo:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{Vo:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":WS("FlowGraphSinBlock"),"math/cos":WS("FlowGraphCosBlock"),"math/tan":WS("FlowGraphTanBlock"),"math/asin":WS("FlowGraphASinBlock"),"math/acos":WS("FlowGraphACosBlock"),"math/atan":WS("FlowGraphATanBlock"),"math/atan2":WS("FlowGraphATan2Block",["a","b"]),"math/sinh":WS("FlowGraphSinhBlock"),"math/cosh":WS("FlowGraphCoshBlock"),"math/tanh":WS("FlowGraphTanhBlock"),"math/asinh":WS("FlowGraphASinhBlock"),"math/acosh":WS("FlowGraphACoshBlock"),"math/atanh":WS("FlowGraphATanhBlock"),"math/exp":WS("FlowGraphExponentialBlock"),"math/log":WS("FlowGraphLogBlock"),"math/log2":WS("FlowGraphLog2Block"),"math/log10":WS("FlowGraphLog10Block"),"math/sqrt":WS("FlowGraphSquareRootBlock"),"math/cbrt":WS("FlowGraphCubeRootBlock"),"math/pow":WS("FlowGraphPowerBlock",["a","b"]),"math/length":WS("FlowGraphLengthBlock"),"math/normalize":WS("FlowGraphNormalizeBlock"),"math/dot":WS("FlowGraphDotBlock",["a","b"]),"math/cross":WS("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":WS("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":WS("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{Vo:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{Vo:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{Vo:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{Vo:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{Vo:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{Vo:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{Vo:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":WS("FlowGraphTransposeBlock"),"math/determinant":WS("FlowGraphDeterminantBlock"),"math/inverse":WS("FlowGraphInvertMatrixBlock"),"math/matmul":WS("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{Vo:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"eU",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q,p){const G=q[0].dataInputs.find((H=>"rotationQuaternion"===H.name));if(!G)throw new Error("Rotation quaternion input not found");return p._connectionValues[G.uniqueId]&&(p._connectionValues[G.uniqueId].type="Quaternion"),q}},"math/matDecompose":{Vo:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"eU"}}}},"math/quatConjugate":WS("FlowGraphConjugateBlock",["a"]),"math/quatMul":{Vo:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q){var p;return(p=q[0]).config||(p.config={}),q[0].config.type="Quaternion",q}},"math/quatAngleBetween":WS("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{Vo:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":WS("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":WS("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{Vo:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q){var p;return(p=q[0]).config||(p.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract2x2":{Vo:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{Vo:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q){var p;return(p=q[0]).config||(p.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract3x3":{Vo:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{Vo:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q){var p;return(p=q[0]).config||(p.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract4x4":{Vo:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{Vo:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q,p){var G,U;(U=q[0]).config||(U.config={});const V=q[0].dataInputs[0];return q[0].config.valueType=(null===(G=p._connectionValues[V.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",q}},"math/and":{Vo:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q,p){var G,U,V;(V=q[0]).config||(V.config={});const w=q[0].dataInputs[0],o=q[0].dataInputs[1];return q[0].config.valueType=(null===(G=p._connectionValues[w.uniqueId])||void 0===G?void 0:G.type)??(null===(U=p._connectionValues[o.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",q}},"math/or":{Vo:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q,p){var G,U,V;(V=q[0]).config||(V.config={});const w=q[0].dataInputs[0],o=q[0].dataInputs[1];return q[0].config.valueType=(null===(G=p._connectionValues[w.uniqueId])||void 0===G?void 0:G.type)??(null===(U=p._connectionValues[o.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",q}},"math/xor":{Vo:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(H,O,S,t,q,p){var G,U,V;(V=q[0]).config||(V.config={});const w=q[0].dataInputs[0],o=q[0].dataInputs[1];return q[0].config.valueType=(null===(G=p._connectionValues[w.uniqueId])||void 0===G?void 0:G.type)??(null===(U=p._connectionValues[o.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",q}},"math/asr":WS("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":WS("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":WS("FlowGraphLeadingZerosBlock"),"math/ctz":WS("FlowGraphTrailingZerosBlock"),"math/popcnt":WS("FlowGraphOneBitsCounterBlock"),"math/rad":WS("FlowGraphDegToRadBlock"),"math/deg":WS("FlowGraphRadToDegBlock"),"type/boolToInt":WS("FlowGraphBooleanToInt"),"type/boolToFloat":WS("FlowGraphBooleanToFloat"),"type/intToBool":WS("FlowGraphIntToBoolean"),"type/intToFloat":WS("FlowGraphIntToFloat"),"type/floatToInt":WS("FlowGraphFloatToInt"),"type/floatToBool":WS("FlowGraphFloatToBoolean"),"flow/sequence":{Vo:["FlowGraphSequenceBlock"],extraProcessor(H,O,S,t,q){const p=q[0];return p.config||(p.config={}),p.config.outputSignalCount=Object.keys(H.flows||[]).length,p.signalOutputs.forEach(((H,O)=>{H.name="out_"+O})),q}},"flow/branch":{Vo:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{Vo:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(H){if(H.configuration&&H.configuration.cases){const O=H.configuration.cases.value;if(!O.every((H=>"number"===typeof H&&/^-?\d+$/.test(H.toString()))))return X.b.Warn("Switch cases should be integers. Using empty array instead."),H.configuration.cases.value=[],{valid:!0};const S=new Set(O);H.configuration.cases.value=Array.from(S)}return{valid:!0}},extraProcessor(H,O,S,t,q){if("flow/switch"!==O.op||!H.flows||0===Object.keys(H.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return q[0].signalOutputs.forEach((H=>{"default"!==H.name&&(H.name="out_"+H.name)})),q}},"flow/while":{Vo:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{Vo:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(H,O,S,t,q){const p=q[0];return p.config||(p.config={}),p.config.incrementIndexWhenLoopDone=!0,q}},"flow/doN":{Vo:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{Vo:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(H,O,S,t,q){if("flow/multiGate"!==O.op||!H.flows||0===Object.keys(H.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const p=q[0];return p.config||(p.config={}),p.config.outputSignalCount=Object.keys(H.flows).length,p.signalOutputs.forEach(((H,O)=>{H.name="out_"+O})),q}},"flow/waitAll":{Vo:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(H){var O,S;return"number"!==typeof(null===(O=H.configuration)||void 0===O||null===(S=O.inputFlows)||void 0===S?void 0:S.value[0])&&(H.configuration=H.configuration||{inputFlows:{value:[0]}},H.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{Vo:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{Vo:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{Vo:["FlowGraphCancelDelayBlock"]},"variable/get":{Vo:["FlowGraphGetVariableBlock"],validation(H){var O,S;return null!==(O=H.configuration)&&void 0!==O&&null!==(S=O.variable)&&void 0!==S&&S.value?{valid:!0}:(X.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(H,O)=>[O.getVariableName(H[0])]}}},"variable/set":{Vo:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(H,O)=>[O.getVariableName(H[0])]}}},"variable/setMultiple":{Vo:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(H,O)=>[H[0].map((H=>O.getVariableName(H)))]}},extraProcessor:(H,O,S,t,q)=>(q[0].dataInputs.forEach((H=>{H.name=t.getVariableName(+H.name)})),q)},"variable/interpolate":{Vo:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(H,O)=>[O.getVariableName(H[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:H=>!0===H[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FS:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FS:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FS:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FS:"FlowGraphPlayAnimationBlock"},out:{name:"out",FS:"FlowGraphPlayAnimationBlock"},done:{name:"done",FS:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(H,O,S,t,q){var p,G,U;const V=q[0],w=null===(p=H.configuration)||void 0===p?void 0:p.variable.value[0];if("number"!==typeof w)throw X.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const o=t.arrays.staticVariables[w];"undefined"===typeof V.config.animationType.value&&(t.arrays.staticVariables,V.config.animationType.value=(0,KS.L)(o.type));const h=q[4];return h.config||(h.config={}),(G=h.config).variable||(G.variable={}),h.config.variable.value=t.getVariableName(w),(U=q[3]).config||(U.config={}),q}},"pointer/get":{Vo:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FS:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",FS:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,O,S,t,q)=>(q.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className&&(H.config||(H.config={}),H.config.outputValue=!0)})),q)},"pointer/set":{Vo:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FS:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",FS:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,O,S,t,q)=>(q.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className&&(H.config||(H.config={}),H.config.outputValue=!0)})),q)},"pointer/interpolate":{Vo:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",FS:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",FS:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FS:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FS:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FS:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FS:"FlowGraphPlayAnimationBlock"},out:{name:"out",FS:"FlowGraphPlayAnimationBlock"},done:{name:"done",FS:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(H,O,S,t,q)=>(q.forEach((O=>{"FlowGraphJsonPointerParserBlock"===O.className?(O.config||(O.config={}),O.config.outputValue=!0):"FlowGraphInterpolationBlock"===O.className&&(O.config||(O.config={}),Object.keys(H.values||[]).forEach((S=>{var q;const p=null===(q=H.values)||void 0===q?void 0:q[S];if("value"===S&&p){const H=p.type;void 0!==H&&(O.config.animationType=t.arrays.types[H].flowGraphType)}})))})),q)},"animation/start":{Vo:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FS:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(H,O)=>[H[0]*O._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(H,O)=>[H[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){const U=q[q.length-1];return U.config||(U.config={}),U.config.glTF=G,q}},"animation/stop":{Vo:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FS:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){const U=q[q.length-1];return U.config||(U.config={}),U.config.glTF=G,q}},"animation/stopAt":{Vo:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",FS:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(H,O)=>[H[0]*O._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){const U=q[q.length-1];return U.config||(U.config={}),U.config.glTF=G,q}},"math/switch":{Vo:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(H){if(H.configuration&&H.configuration.cases){const O=H.configuration.cases.value;if(!O.every((H=>"number"===typeof H&&/^-?\d+$/.test(H.toString()))))return X.b.Warn("Switch cases should be integers. Using empty array instead."),H.configuration.cases.value=[],{valid:!0};const S=new Set(O);H.configuration.cases.value=Array.from(S)}return{valid:!0}},extraProcessor(H,O,S,t,q){const p=q[0];return p.dataInputs.forEach((H=>{"default"!==H.name&&"case"!==H.name&&(H.name="in_"+H.name)})),p.config||(p.config={}),p.config.treatCasesAsIntegers=!0,q}},"debug/log":{Vo:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function WS(H){let O=arguments.length>2?arguments[2]:void 0;return{Vo:[H],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((H,O)=>(H[O]={name:O},H)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(H,S,t,q,p){var G;if(O){(G=p[0]).config||(G.config={}),p[0].config.preventIntegerFloatArithmetic=!0;let O=-1;Object.keys(H.values||{}).find((S=>{var t;return void 0!==(null===(t=H.values)||void 0===t?void 0:t[S].type)&&(O=H.values[S].type,!0)})),-1!==O&&(p[0].config.type=q.arrays.types[O].flowGraphType)}return p},validation:H=>O?gS(H):{valid:!0}}}function gS(H){if(H.values){const O=Object.keys(H.values).map((O=>H.values[O].type)).filter((H=>void 0!==H));if(!O.every((H=>H===O[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}rS["math/compose"]=rS["math/matCompose"],rS["math/decompose"]=rS["math/matDecompose"];var NS=S(11266);const xS={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"eO",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class kS{constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=H,this._gltf=O,this._animationTargetFps=S,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const H of this._interactivityGraph.types)this._types.push(xS[H.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const H of this._interactivityGraph.declarations){const O=vS(H);if(!O)throw X.b.Error(["No mapping found for declaration",H]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:O,fullOperationName:H.extension?H.op+":"+H.extension:H.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const H of this._interactivityGraph.variables){const O=this._parseVariable(H);this._staticVariables.push(O)}}_parseVariable(H,O){const S=this._types[H.type];if(!S)throw X.b.Error(["No type found for variable",H]),new Error("Error parsing variables");if(H.value&&H.value.length!==S.length)throw X.b.Error(["Invalid value length for variable",H,S]),new Error("Error parsing variables");const t=H.value||[];if(!t.length)switch(S.flowGraphType){case"boolean":t.push(!1);break;case"FlowGraphInteger":t.push(0);break;case"number":t.push(NaN);break;case"Vector2":t.push(NaN,NaN);break;case"eO":t.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":t.fill(NaN,0,4);break;case"Matrix":t.fill(NaN,0,16);break;case"Matrix3D":t.fill(NaN,0,9)}return"number"===S.elementType&&"string"===typeof t[0]&&(t[0]=parseFloat(t[0])),{type:S.flowGraphType,value:O?O(t,this):t}}_parseEvents(){if(this._interactivityGraph.events)for(const H of this._interactivityGraph.events){const O={eventId:H.id||"internalEvent_"+this._internalEventsCounter++};H.values&&(O.eventData=Object.keys(H.values).map((O=>{var S;const t=null===(S=H.values)||void 0===S?void 0:S[O];if(!t)throw X.b.Error(["No value found for event key",O]),new Error("Error parsing events");const q=this._types[t.type];if(!q)throw X.b.Error(["No type found for event value",t]),new Error("Error parsing events");const p="undefined"!==typeof t.value?this._parseVariable(t):void 0;return{id:O,type:q.flowGraphType,eventData:!0,value:p}}))),this._events.push(O)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const O of this._interactivityGraph.nodes){if("number"!==typeof O.declaration)throw X.b.Error(["No declaration found for node",O]),new Error("Error parsing nodes");const S=this._mappings[O.declaration];if(!S)throw X.b.Error(["No mapping found for node",O]),new Error("Error parsing nodes");if(S.flowGraphMapping.validation){const t=S.flowGraphMapping.validation(O,this._interactivityGraph,this._gltf);var H;if(!t.valid)throw new Error(`Error validating interactivity node ${null===(H=this._interactivityGraph.declarations)||void 0===H?void 0:H[O.declaration].op} - ${t.error}`)}const t=[];for(const H of S.flowGraphMapping.Vo){const q=this._getEmptyBlock(H,S.fullOperationName);this._parseNodeConfiguration(O,q,S.flowGraphMapping,H),t.push(q)}this._nodes.push({Vo:t,fullOperationName:S.fullOperationName})}}_getEmptyBlock(H,O){return{uniqueId:(0,NS.d)(),className:H,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:O,metadata:{}}}_parseNodeConfiguration(H,O,S,t){const q=O.config;if(H.configuration){const O=Object.keys(H.configuration);for(const U of O){var p,G;const O=null===(p=H.configuration)||void 0===p?void 0:p[U];if(!O)throw X.b.Error(["No value found for node configuration",U]),new Error("Error parsing node configuration");const V=null===(G=S.configuration)||void 0===G?void 0:G[U];if(V&&V.FS?V.FS===t:0===S.Vo.indexOf(t)){const H=(null===V||void 0===V?void 0:V.name)||U;O&&"undefined"!==typeof O.value||"undefined"===typeof(null===V||void 0===V?void 0:V.defaultValue)?O.value.length>=0?q[H]={value:1===O.value.length?O.value[0]:O.value}:X.b.Warn(["Invalid value for node configuration",O]):q[H]={value:V.defaultValue},V&&V.dataTransformer&&(q[H].value=V.dataTransformer([q[H].value],this)[0])}}}}_parseNodeConnections(H){for(let F=0;F<this._nodes.length;F++){var O;const Y=null===(O=this._interactivityGraph.nodes)||void 0===O?void 0:O[F];if(!Y)throw X.b.Error(["No node found for interactivity node",this._nodes[F]]),new Error("Error parsing node connections");const l=this._nodes[F],d=this._mappings[Y.declaration];if(!d)throw X.b.Error(["No mapping found for node",Y]),new Error("Error parsing node connections");const v=Y.flows||{},z=Object.keys(v).sort();for(const H of z){var S,t,q,p;const O=v[H],w=null===(S=d.flowGraphMapping.outputs)||void 0===S||null===(t=S.flows)||void 0===t?void 0:t[H],o=(null===w||void 0===w?void 0:w.name)||H,h=this._createNewSocketConnection(o,!0);(w&&w.FS&&l.Vo.find((H=>H.className===w.FS))||l.Vo[0]).signalOutputs.push(h);const a=O.node,j=this._nodes[a];if(!j)throw X.b.Error(["No node found for input node id",a]),new Error("Error parsing node connections");const e=dS(j.fullOperationName);if(!e)throw X.b.Error(["No mapping found for input node",j]),new Error("Error parsing node connections");let E=null===(q=e.inputs)||void 0===q||null===(p=q.flows)||void 0===p?void 0:p[O.socket||"in"],y=!1;if(!E)for(const H in null===(G=e.inputs)||void 0===G?void 0:G.flows){var G,U,V;if(H.startsWith("[")&&H.endsWith("]"))y=!0,E=null===(U=e.inputs)||void 0===U||null===(V=U.flows)||void 0===V?void 0:V[H]}const T=E?y?E.name.replace("$1",O.socket||""):E.name:O.socket||"in",K=E&&E.FS&&j.Vo.find((H=>H.className===E.FS))||j.Vo[0];let b=K.signalInputs.find((H=>H.name===T));b||(b=this._createNewSocketConnection(T),K.signalInputs.push(b)),b.connectedPointIds.push(h.uniqueId),h.connectedPointIds.push(b.uniqueId)}const m=Y.values||{},r=Object.keys(m);for(const O of r){var w,o;const S=m[O];let t=null===(w=d.flowGraphMapping.inputs)||void 0===w||null===(o=w.values)||void 0===o?void 0:o[O],q=!1;if(!t)for(const H in null===(h=d.flowGraphMapping.inputs)||void 0===h?void 0:h.values){var h,a,j;if(H.startsWith("[")&&H.endsWith("]"))q=!0,t=null===(a=d.flowGraphMapping.inputs)||void 0===a||null===(j=a.values)||void 0===j?void 0:j[H]}const p=t?q?t.name.replace("$1",O):t.name:O,G=this._createNewSocketConnection(p);if((t&&t.FS&&l.Vo.find((H=>H.className===t.FS))||l.Vo[0]).dataInputs.push(G),void 0!==S.value){const O=this._parseVariable(S,t&&t.dataTransformer);H._connectionValues[G.uniqueId]=O}else{if("undefined"===typeof S.node)throw X.b.Error(["Invalid value for value connection",S]),new Error("Error parsing node connections");{var e,E,y;const H=S.node,O=S.socket||"value",t=this._nodes[H];if(!t)throw X.b.Error(["No node found for output socket reference",S]),new Error("Error parsing node connections");const q=dS(t.fullOperationName);if(!q)throw X.b.Error(["No mapping found for output socket reference",S]),new Error("Error parsing node connections");let p=null===(e=q.outputs)||void 0===e||null===(E=e.values)||void 0===E?void 0:E[O],U=!1;if(!p)for(const S in null===(T=q.outputs)||void 0===T?void 0:T.values){var T,K,b;if(S.startsWith("[")&&S.endsWith("]"))U=!0,p=null===(K=q.outputs)||void 0===K||null===(b=K.values)||void 0===b?void 0:b[S]}const V=p?U?p.name.replace("$1",O):null===(y=p)||void 0===y?void 0:y.name:O,w=p&&p.FS&&t.Vo.find((H=>H.className===p.FS))||t.Vo[0];let o=w.dataOutputs.find((H=>H.name===V));o||(o=this._createNewSocketConnection(V,!0),w.dataOutputs.push(o)),G.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(G.uniqueId)}}}if(d.flowGraphMapping.interBlockConnectors)for(const H of d.flowGraphMapping.interBlockConnectors){const O=H.input,S=H.output,t=H.isVariable;this._connectFlowGraphNodes(O,S,l.Vo[H.inputBlockIndex],l.Vo[H.outputBlockIndex],t)}if(d.flowGraphMapping.extraProcessor){var D;const O=null===(D=this._interactivityGraph.declarations)||void 0===D?void 0:D[Y.declaration];if(!O)throw X.b.Error(["No declaration found for extra processor",Y]),new Error("Error parsing node connections");l.Vo=d.flowGraphMapping.extraProcessor(Y,O,d.flowGraphMapping,this,l.Vo,H,this._gltf)}}}_createNewSocketConnection(H,O){return{uniqueId:(0,NS.d)(),name:H,_connectionType:O?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(H,O,S,t,q){const p=q?S.dataInputs:S.signalInputs,G=q?t.dataOutputs:t.signalOutputs,U=p.find((O=>O.name===H))||this._createNewSocketConnection(H),V=G.find((H=>H.name===O))||this._createNewSocketConnection(O,!0);p.find((O=>O.name===H))||p.push(U),G.find((H=>H.name===O))||G.push(V),U.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(U.uniqueId)}getVariableName(H){return"staticVariable_"+H}serializeToFlowGraph(){const H={uniqueId:(0,NS.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(H);for(let O=0;O<this._staticVariables.length;O++){const S=this._staticVariables[O];H._userVariables[this.getVariableName(O)]=S}return{rightHanded:!0,allBlocks:this._nodes.reduce(((H,O)=>H.concat(O.Vo)),[]),executionContexts:[H]}}}const AS="KHR_interactivity";class uS{constructor(H){this._loader=H,this.name=AS,this.enabled=this._loader.isExtensionUsed(AS),this._pathConverter=(0,J.f)(this._loader.OU),H._skipStartAnimationStep=!0;const O=H.babylonScene;O&&function(H){(0,J.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!H.activeCamera)return new q.Quaternion(NaN,NaN,NaN,NaN);const O=q.Quaternion.FromRotationMatrix(H.activeCamera.getWorldMatrix()).normalize();return H.useRightHandedSystem||(O.w*=-1,O.x*=-1),O},type:"Quaternion",getTarget:()=>H.activeCamera}),(0,J.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!H.activeCamera)return new q.eO(NaN,NaN,NaN);const O=H.activeCamera.getWorldMatrix().getTranslation();return H.useRightHandedSystem||(O.x*=-1),O},type:"eO",getTarget:()=>H.activeCamera}),(0,J.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:H=>{var O;return(null===(O=H._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)??!1},type:"boolean",getTarget:H=>H._babylonAnimationGroup}),(0,J.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:H=>{var O;return((null===(O=H._babylonAnimationGroup)||void 0===O?void 0:O.from)??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,J.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:H=>{var O;return((null===(O=H._babylonAnimationGroup)||void 0===O?void 0:O.to)??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,J.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:H=>{var O;return((null===(O=H._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup}),(0,J.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:H=>{var O;return((null===(O=H._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())??0)/60},type:"number",getTarget:H=>H._babylonAnimationGroup})}(O)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var H;if(!this._loader.babylonScene||!this._pathConverter)return;const O=this._loader.babylonScene,S=null===(H=this._loader.OU.extensions)||void 0===H?void 0:H.KHR_interactivity;if(!S)return;const t=new eS.d({EO:O});t.dispatchEventsSynchronously=!1;const q=S.graphs.map((H=>new kS(H,this._loader.OU,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(q.map((async H=>await FS(H,{coordinator:t,pathConverter:this._pathConverter})))),t.start()}}var JS;JS=async()=>(await Promise.resolve().then(S.bind(S,13096))).FlowGraphGLTFDataProvider,XS[`${AS}/${"FlowGraphGLTFDataProvider"}`]=JS,u(AS),A(AS,!0,(H=>new uS(H)));const PS="KHR_node_visibility";(0,J.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:H=>{const O=H._babylonTransformNode;return!O||void 0===O.isVisible||O.isVisible},set:(H,O)=>{var S,t;null===(S=O._primitiveBabylonMeshes)||void 0===S||S.forEach((H=>{H.inheritVisibility=!0})),O._babylonTransformNode&&(O._babylonTransformNode.isVisible=H),null===(t=O._primitiveBabylonMeshes)||void 0===t||t.forEach((O=>{O.isVisible=H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class fS{constructor(H){this.name=PS,this._loader=H,this.enabled=H.isExtensionUsed(PS)}async onReady(){var H;null===(H=this._loader.OU.nodes)||void 0===H||H.forEach((H=>{var O,S,t,q;(null===(O=H._primitiveBabylonMeshes)||void 0===O||O.forEach((H=>{H.inheritVisibility=!0})),null!==(S=H.extensions)&&void 0!==S&&S.KHR_node_visibility)&&(!1===(null===(t=H.extensions)||void 0===t?void 0:t.KHR_node_visibility.visible)&&(H._babylonTransformNode&&(H._babylonTransformNode.isVisible=!1),null===(q=H._primitiveBabylonMeshes)||void 0===q||q.forEach((H=>{H.isVisible=!1}))))}))}dispose(){this._loader=null}}u(PS),A(PS,!0,(H=>new fS(H)));const cS="KHR_node_selectability";zS("event/onSelect",cS,{Vo:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FS:"FlowGraphGetVariableBlock",dataTransformer:H=>["pickedMesh_"+H[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",FS:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){var U,V,w,o,h,a;const j=q[q.length-1];j.config=j.config||{},j.config.glTF=G;const e=null===(U=H.configuration)||void 0===U||null===(V=U.nodeIndex)||void 0===V?void 0:V.value[0];if(void 0===e||"number"!==typeof e)throw new Error("nodeIndex not found in configuration");const X="pickedMesh_"+e;return q[1].config.variable=X,p._userVariables[X]={className:"Mesh",id:null===G||void 0===G||null===(w=G.nodes)||void 0===w||null===(o=w[e]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===G||void 0===G||null===(h=G.nodes)||void 0===h||null===(a=h[e]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},q}}),(0,J.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:H=>{const O=H._babylonTransformNode;return!O||void 0===O.WV||O.WV},set:(H,O)=>{var S;null===(S=O._primitiveBabylonMeshes)||void 0===S||S.forEach((O=>{O.WV=H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"WV"],type:"boolean"});class RS{constructor(H){this.name=cS,this._loader=H,this.enabled=H.isExtensionUsed(cS)}async onReady(){var H;null===(H=this._loader.OU.nodes)||void 0===H||H.forEach((H=>{var O,S,t;null!==(O=H.extensions)&&void 0!==O&&O.KHR_node_selectability&&!1===(null===(S=H.extensions)||void 0===S?void 0:S.KHR_node_selectability.selectable)&&(null===(t=H._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((H=>{H.WV=!1})))}))}dispose(){this._loader=null}}u(cS),A(cS,!0,(H=>new RS(H)));const BS="KHR_node_hoverability",ZS="targetMeshPointerOver_";zS("event/onHoverIn",BS,{Vo:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FS:"FlowGraphGetVariableBlock",dataTransformer:H=>[ZS+H[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FS:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){var U,V,w,o,h,a;const j=q[q.length-1];j.config=j.config||{},j.config.glTF=G;const e=null===(U=H.configuration)||void 0===U||null===(V=U.nodeIndex)||void 0===V?void 0:V.value[0];if(void 0===e||"number"!==typeof e)throw new Error("nodeIndex not found in configuration");const X=ZS+e;return q[1].config.variable=X,p._userVariables[X]={className:"Mesh",id:null===G||void 0===G||null===(w=G.nodes)||void 0===w||null===(o=w[e]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===G||void 0===G||null===(h=G.nodes)||void 0===h||null===(a=h[e]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},q}});const IS="targetMeshPointerOut_";zS("event/onHoverOut",BS,{Vo:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FS:"FlowGraphGetVariableBlock",dataTransformer:H=>[IS+H[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FS:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(H,O,S,t,q,p,G){var U,V,w,o,h,a;const j=q[q.length-1];j.config=j.config||{},j.config.glTF=G;const e=null===(U=H.configuration)||void 0===U||null===(V=U.nodeIndex)||void 0===V?void 0:V.value[0];if(void 0===e||"number"!==typeof e)throw new Error("nodeIndex not found in configuration");const X=IS+e;return q[1].config.variable=X,p._userVariables[X]={className:"Mesh",id:null===G||void 0===G||null===(w=G.nodes)||void 0===w||null===(o=w[e]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===G||void 0===G||null===(h=G.nodes)||void 0===h||null===(a=h[e]._babylonTransformNode)||void 0===a?void 0:a.uniqueId},q}}),(0,J.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:H=>{const O=H._babylonTransformNode;return!O||void 0===O.pointerOverDisableMeshTesting||O.pointerOverDisableMeshTesting},set:(H,O)=>{var S;null===(S=O._primitiveBabylonMeshes)||void 0===S||S.forEach((O=>{O.pointerOverDisableMeshTesting=!H}))},getTarget:H=>H._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class sS{constructor(H){this.name=BS,this._loader=H,this.enabled=H.isExtensionUsed(BS)}async onReady(){var H;null===(H=this._loader.OU.nodes)||void 0===H||H.forEach((H=>{var O,S,t;null!==(O=H.extensions)&&void 0!==O&&O.KHR_node_hoverability&&!1===(null===(S=H.extensions)||void 0===S?void 0:S.KHR_node_hoverability.hoverable)&&(null===(t=H._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((H=>{H.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}u(BS),A(BS,!0,(H=>new sS(H)));const iS="ExtrasAsMetadata";class MS{_assignExtras(H,O){if(O.extras&&Object.keys(O.extras).length>0){const S=H.metadata=H.metadata||{};(S.OU=S.OU||{}).extras=O.extras}}constructor(H){this.name=iS,this.enabled=!0,this._loader=H}dispose(){this._loader=null}loadNodeAsync(H,O,S){return this._loader.loadNodeAsync(H,O,(H=>{this._assignExtras(H,O),S(H)}))}loadCameraAsync(H,O,S){return this._loader.loadCameraAsync(H,O,(H=>{this._assignExtras(H,O),S(H)}))}createMaterial(H,O,S){const t=this._loader.createMaterial(H,O,S);return this._assignExtras(t,O),t}}u(iS),A(iS,!1,(H=>new MS(H)));S(13096)},12962:(H,O,S)=>{"use strict";S.d(O,{e:()=>g,f:()=>d,j:()=>l,l:()=>v});var t=S(11140),q=S(11131),p=S(12599),G=S(11757),U=S(11718),V=S(11734),w=S(11151),o=S(11180),h=S(11749),a=S(11851),j=S(11764),e=S(11346);class X{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.ha=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ia=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(H){this._environmentTexture=H}getNodes(){let H=[];H=H.concat(this.meshes),H=H.concat(this.lights),H=H.concat(this.cameras),H=H.concat(this.transformNodes);for(const O of this.skeletons)H=H.concat(O.bones);return H}}class E extends X{}class y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const H=this.rootNodes;for(const t of H)t.dispose();H.length=0;const O=this.skeletons;for(const t of O)t.dispose();O.length=0;const S=this.animationGroups;for(const t of S)t.dispose();S.length=0}}class T extends X{constructor(H){super(),this._wasAddedToScene=!1,(H=H||o.c.LastCreatedScene)&&(this.EO=H,this.proceduralTextures=[],H.up.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=H.getEngine().onContextRestoredObservable.add((()=>{for(const H of this.geometries)H._rebuild();for(const H of this.meshes)H._rebuild();for(const H of this.ha)H.rebuild();for(const H of this.textures)H._rebuild()})))}_topologicalSort(H){const O=new Map;for(const G of H)O.set(G.uniqueId,G);const S={dependsOn:new Map,dependedBy:new Map};for(const G of H){const H=G.uniqueId;S.dependsOn.set(H,new Set),S.dependedBy.set(H,new Set)}for(const G of H){const H=G.uniqueId,t=S.dependsOn.get(H);if(G instanceof h.c){const q=G.sourceMesh;O.has(q.uniqueId)&&(t.add(q.uniqueId),S.dependedBy.get(q.uniqueId).add(H))}const q=S.dependedBy.get(H);for(const p of G.getDescendants()){const t=p.uniqueId;if(O.has(t)){q.add(t);S.dependsOn.get(t).add(H)}}}const t=[],q=[];for(const G of H){const H=G.uniqueId;0===S.dependsOn.get(H).size&&(q.push(G),O.delete(H))}const p=q;for(;p.length>0;){const H=p.shift();t.push(H);const q=S.dependedBy.get(H.uniqueId);for(const t of Array.from(q.values())){const q=S.dependsOn.get(t);q.delete(H.uniqueId),0===q.size&&O.get(t)&&(p.push(O.get(t)),O.delete(t))}}return O.size>0&&(w.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),O.forEach((H=>{w.b.Error(H.name)}))),t}_addNodeAndDescendantsToList(H,O,S,t){if(S&&(!t||t(S))&&!O.has(S.uniqueId)){H.push(S),O.add(S.uniqueId);for(const q of S.getDescendants(!0))this._addNodeAndDescendantsToList(H,O,q,t)}}_isNodeInContainer(H){return H instanceof V.e&&-1!==this.meshes.indexOf(H)||(H instanceof U.e&&-1!==this.transformNodes.indexOf(H)||(H instanceof a.b&&-1!==this.lights.indexOf(H)||H instanceof j.d&&-1!==this.cameras.indexOf(H)))}_isValidHierarchy(){for(const H of this.meshes)if(H.parent&&!this._isNodeInContainer(H.parent))return w.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.transformNodes)if(H.parent&&!this._isNodeInContainer(H.parent))return w.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.lights)if(H.parent&&!this._isNodeInContainer(H.parent))return w.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;for(const H of this.cameras)if(H.parent&&!this._isNodeInContainer(H.parent))return w.b.Warn(`Node ${H.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(H){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const t={},p={},U=new y,V=[],w=[],o={doNotInstantiate:!0,...S},h=[],a=new Set;for(const q of this.transformNodes)null===q.parent&&this._addNodeAndDescendantsToList(h,a,q,o.predicate);for(const q of this.meshes)null===q.parent&&this._addNodeAndDescendantsToList(h,a,q,o.predicate);const j=this._topologicalSort(h),e=(S,q)=>{if(((O,S)=>{if(t[O.uniqueId]=S.uniqueId,p[S.uniqueId]=S,H&&(S.name=H(O.name)),S instanceof G.d){const H=S;if(H.morphTargetManager){const S=O.morphTargetManager;H.morphTargetManager=S.clone();for(let O=0;O<S.numTargets;O++){const q=S.getTarget(O),G=H.morphTargetManager.getTarget(O);t[q.uniqueId]=G.uniqueId,p[G.uniqueId]=G}}}})(S,q),S.parent){const H=t[S.parent.uniqueId],O=p[H];q.parent=O||S.parent}if(q.position&&S.position&&q.position.t(S.position),q.rotationQuaternion&&S.rotationQuaternion&&q.rotationQuaternion.t(S.rotationQuaternion),q.rotation&&S.rotation&&q.rotation.t(S.rotation),q.eU&&S.eU&&q.eU.t(S.eU),q.material){const G=q;if(G.material)if(O){const O=S.material;if(-1===w.indexOf(O)){let S=O.clone(H?H(O.name):"Clone of "+O.name);if(w.push(O),t[O.uniqueId]=S.uniqueId,p[S.uniqueId]=S,"MultiMaterial"===O.getClassName()){const q=O;for(const O of q.yU)O&&(S=O.clone(H?H(O.name):"Clone of "+O.name),w.push(O),t[O.uniqueId]=S.uniqueId,p[S.uniqueId]=S);q.yU=q.yU.map((H=>H&&p[t[H.uniqueId]]))}}"InstancedMesh"!==G.getClassName()&&(G.material=p[t[O.uniqueId]])}else"MultiMaterial"===G.material.getClassName()?-1===this.EO.multiMaterials.indexOf(G.material)&&this.EO.addMultiMaterial(G.material):-1===this.EO.materials.indexOf(G.material)&&this.EO.addMaterial(G.material)}null===q.parent&&U.rootNodes.push(q)};for(const q of j)if("InstancedMesh"===q.getClassName()){const H=q,O=H.sourceMesh,S=t[O.uniqueId];e(H,("number"===typeof S?p[S]:O).createInstance(H.name))}else{let H=!0;"Sh"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?H=!1:o.doNotInstantiate&&(H="function"===typeof o.doNotInstantiate?!o.doNotInstantiate(q):!o.doNotInstantiate);const O=H?q.createInstance(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!O)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);e(q,O)}for(const q of this.skeletons){if(o.predicate&&!o.predicate(q))continue;const O=q.clone(H?H(q.name):"Clone of "+q.name);for(const H of this.meshes)if(H.skeleton===q&&!H.isAnInstance){const S=p[t[H.uniqueId]];if(!S||S.isAnInstance)continue;if(S.skeleton=O,-1!==V.indexOf(O))continue;V.push(O);for(const H of O.bones)H._linkedTransformNode&&(H._linkedTransformNode=p[t[H._linkedTransformNode.uniqueId]])}U.skeletons.push(O)}for(const q of this.animationGroups){if(o.predicate&&!o.predicate(q))continue;const O=q.clone(H?H(q.name):"Clone of "+q.name,(H=>p[t[H.uniqueId]]||H));U.animationGroups.push(O)}return U}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.EO.environmentTexture=this.environmentTexture);for(const H of this.EO._serializableComponents)H.addFromContainer(this);this.EO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const O=[];for(const S of this.cameras)H&&!H(S)||(this.EO.addCamera(S),O.push(S));for(const S of this.lights)H&&!H(S)||(this.EO.addLight(S),O.push(S));for(const S of this.meshes)H&&!H(S)||(this.EO.Mw(S),O.push(S));for(const S of this.skeletons)H&&!H(S)||this.EO.addSkeleton(S);for(const S of this.animations)H&&!H(S)||this.EO.addAnimation(S);for(const S of this.animationGroups)H&&!H(S)||this.EO.addAnimationGroup(S);for(const S of this.multiMaterials)H&&!H(S)||this.EO.addMultiMaterial(S);for(const S of this.materials)H&&!H(S)||this.EO.addMaterial(S);for(const S of this.morphTargetManagers)H&&!H(S)||this.EO.addMorphTargetManager(S);for(const S of this.geometries)H&&!H(S)||this.EO.addGeometry(S);for(const S of this.transformNodes)H&&!H(S)||(this.EO.addTransformNode(S),O.push(S));for(const S of this.actionManagers)H&&!H(S)||this.EO.addActionManager(S);for(const S of this.textures)H&&!H(S)||this.EO.addTexture(S);for(const S of this.reflectionProbes)H&&!H(S)||this.EO.addReflectionProbe(S);for(const S of O)S.parent&&-1===this.EO.getNodes().indexOf(S.parent)&&(S.setParent?S.setParent(null):S.parent=null)}removeAllFromScene(){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.EO.environmentTexture&&(this.EO.environmentTexture=null);for(const H of this.EO._serializableComponents)H.removeFromContainer(this)}removeFromScene(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const O of this.cameras)H&&!H(O)||this.EO.removeCamera(O);for(const O of this.lights)H&&!H(O)||this.EO.removeLight(O);for(const O of this.meshes)H&&!H(O)||this.EO.iw(O,!0);for(const O of this.skeletons)H&&!H(O)||this.EO.removeSkeleton(O);for(const O of this.animations)H&&!H(O)||this.EO.removeAnimation(O);for(const O of this.animationGroups)H&&!H(O)||this.EO.removeAnimationGroup(O);for(const O of this.multiMaterials)H&&!H(O)||this.EO.removeMultiMaterial(O);for(const O of this.materials)H&&!H(O)||this.EO.removeMaterial(O);for(const O of this.morphTargetManagers)H&&!H(O)||this.EO.removeMorphTargetManager(O);for(const O of this.geometries)H&&!H(O)||this.EO.removeGeometry(O);for(const O of this.transformNodes)H&&!H(O)||this.EO.removeTransformNode(O);for(const O of this.actionManagers)H&&!H(O)||this.EO.removeActionManager(O);for(const O of this.textures)H&&!H(O)||this.EO.removeTexture(O);for(const O of this.reflectionProbes)H&&!H(O)||this.EO.removeReflectionProbe(O)}dispose(){const H=this.cameras.slice(0);for(const j of H)j.dispose();this.cameras.length=0;const O=this.lights.slice(0);for(const j of O)j.dispose();this.lights.length=0;const S=this.meshes.slice(0);for(const j of S)j.dispose();this.meshes.length=0;const t=this.skeletons.slice(0);for(const j of t)j.dispose();this.skeletons.length=0;const q=this.animationGroups.slice(0);for(const j of q)j.dispose();this.animationGroups.length=0;const p=this.multiMaterials.slice(0);for(const j of p)j.dispose();this.multiMaterials.length=0;const G=this.materials.slice(0);for(const j of G)j.dispose();this.materials.length=0;const U=this.geometries.slice(0);for(const j of U)j.dispose();this.geometries.length=0;const V=this.transformNodes.slice(0);for(const j of V)j.dispose();this.transformNodes.length=0;const w=this.actionManagers.slice(0);for(const j of w)j.dispose();this.actionManagers.length=0;const o=this.textures.slice(0);for(const j of o)j.dispose();this.textures.length=0;const h=this.reflectionProbes.slice(0);for(const j of h)j.dispose();this.reflectionProbes.length=0;const a=this.morphTargetManagers.slice(0);for(const j of a)j.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const j of this.EO._serializableComponents)j.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.EO.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(H,O,S){if(H&&O)for(const t of H){let H=!0;if(S)for(const O of S)if(t===O){H=!1;break}H&&(O.push(t),t._parentContainer=this)}}moveAllFromScene(H){this._wasAddedToScene=!1,void 0===H&&(H=new E);for(const O in this)Object.prototype.hasOwnProperty.call(this,O)&&(this[O]=this[O]||("_environmentTexture"===O?null:[]),this._moveAssets(this.EO[O],this[O],H[O]));this.environmentTexture=this.EO.environmentTexture,this.removeAllFromScene()}createRootMesh(){const H=new G.d("assetContainerRootMesh",this.EO);for(const O of this.meshes)O.parent||H.addChild(O);return this.meshes.unshift(H),H}mergeAnimationsTo(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.c.LastCreatedScene,O=arguments.length>1?arguments[1]:void 0,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!H)return w.b.Error("No scene available to merge animations to"),[];const t=S||(O=>{let S=null;const t=O.animations.length?O.animations[0].targetProperty:"",q=O.name.split(".").join("").split("_primitive")[0];switch(t){case"position":case"rotationQuaternion":S=H.getTransformNodeByName(O.name)||H.getTransformNodeByName(q);break;case"influence":S=H.getMorphTargetByName(O.name)||H.getMorphTargetByName(q);break;default:S=H.getNodeByName(O.name)||H.getNodeByName(q)}return S}),q=this.getNodes();for(const U of q){const H=t(U);if(null!==H){for(const O of U.animations){const S=H.animations.filter((H=>H.targetProperty===O.targetProperty));for(const O of S){const S=H.animations.indexOf(O,0);S>-1&&H.animations.splice(S,1)}}H.animations=H.animations.concat(U.animations)}}const p=[],G=this.animationGroups.slice();for(const U of G){p.push(U.clone(U.name,t));for(const H of U.animatables)H.stop()}for(const U of O){const O=t(U.target);O&&(H.beginAnimation(O,U.fromFrame,U.toFrame,U.loopAnimation,U.speedRatio,U.onAnimationEnd?U.onAnimationEnd:void 0,void 0,!0,void 0,U.onAnimationLoop?U.onAnimationLoop:void 0),H.stopAnimation(U.target))}return p}populateRootNodes(){this.rootNodes.length=0;for(const H of this.meshes)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.transformNodes)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.lights)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H);for(const H of this.cameras)H.parent||-1!==this.rootNodes.indexOf(H)||this.rootNodes.push(H)}addAllAssetsToContainer(H){if(!H)return;const O=[],S=new Set;for(O.push(H);O.length>0;){const H=O.pop();if(H instanceof G.d?(H.oU&&-1===this.geometries.indexOf(H.oU)&&this.geometries.push(H.oU),this.meshes.push(H)):H instanceof h.c?this.meshes.push(H):H instanceof U.e?this.transformNodes.push(H):H instanceof a.b?this.lights.push(H):H instanceof j.d&&this.cameras.push(H),H instanceof V.e){if(H.material&&-1===this.materials.indexOf(H.material)){this.materials.push(H.material);for(const O of H.material.getActiveTextures())-1===this.textures.indexOf(O)&&this.textures.push(O)}H.skeleton&&-1===this.skeletons.indexOf(H.skeleton)&&this.skeletons.push(H.skeleton),H.morphTargetManager&&-1===this.morphTargetManagers.indexOf(H.morphTargetManager)&&this.morphTargetManagers.push(H.morphTargetManager)}for(const t of H.getChildren())S.has(t)||O.push(t);S.add(H)}this.populateRootNodes()}_getByTags(H,O,S){if(void 0===O)return H;const t=[];for(const q in H){const p=H[q];e.e&&e.e.MatchesQuery(p,O)&&(!S||S(p))&&t.push(p)}return t}getMeshesByTags(H,O){return this._getByTags(this.meshes,H,O)}getCamerasByTags(H,O){return this._getByTags(this.cameras,H,O)}getLightsByTags(H,O){return this._getByTags(this.lights,H,O)}getMaterialsByTags(H,O){return this._getByTags(this.materials,H,O).concat(this._getByTags(this.multiMaterials,H,O))}getTransformNodesByTags(H,O){return this._getByTags(this.transformNodes,H,O)}}var K=S(11192);class b{constructor(H){this.byteOffset=0,this.buffer=H}async loadAsync(H){const O=await this.buffer.readAsync(this.byteOffset,H);this._dataView=new DataView(O.buffer,O.byteOffset,O.byteLength),this._dataByteOffset=0}readUint32(){const H=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,H}readUint8Array(H){const O=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,H);return this._dataByteOffset+=H,this.byteOffset+=H,O}readString(H){return(0,K.i)(this.readUint8Array(H))}skipBytes(H){this._dataByteOffset+=H,this.byteOffset+=H}}var D=S(12969);const F="Z2xURg",Y={name:"OU",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:H=>-1!==H.indexOf("asset")&&-1!==H.indexOf("version")||H.startsWith("data:base64,"+F)||H.startsWith("data:;base64,"+F)||H.startsWith("data:application/octet-stream;base64,"+F)||H.startsWith("data:model/gltf-binary;base64,"+F)};var l,d,v,z=S(11188),m=S(11190);function r(H,O,S){try{return Promise.resolve(new Uint8Array(H,O,S))}catch(t){return Promise.reject(t)}}!function(H){H[H.AUTO=0]="AUTO",H[H.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(l||(l={})),function(H){H[H.NONE=0]="NONE",H[H.FIRST=1]="FIRST",H[H.ALL=2]="ALL"}(d||(d={})),function(H){H[H.LOADING=0]="LOADING",H[H.READY=1]="READY",H[H.COMPLETE=2]="COMPLETE"}(v||(v={}));class W{constructor(){this.coordinateSystemMode=l.AUTO,this.animationStartMode=d.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=H=>Promise.resolve(H),this.extensionOptions={}}t(H){H&&(this.onParsed=H.onParsed,this.coordinateSystemMode=H.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=H.animationStartMode??this.animationStartMode,this.loadNodeAnimations=H.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=H.loadSkins??this.loadSkins,this.loadMorphTargets=H.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=H.compileMaterials??this.compileMaterials,this.useClipPlane=H.useClipPlane??this.useClipPlane,this.compileShadowGenerators=H.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=H.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=H.useRangeRequests??this.useRangeRequests,this.createInstances=H.createInstances??this.createInstances,this.alwaysComputeBoundingBox=H.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=H.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=H.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=H.skipMaterials??this.skipMaterials,this.useSRGBBuffers=H.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=H.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=H.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=H.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=H.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=H.customRootNode,this.onMeshLoaded=H.onMeshLoaded,this.onSkinLoaded=H.onSkinLoaded,this.onTextureLoaded=H.onTextureLoaded,this.onMaterialLoaded=H.onMaterialLoaded,this.onCameraLoaded=H.onCameraLoaded,this.extensionOptions=H.extensionOptions??this.extensionOptions)}}class g extends W{constructor(H){super(),this.onParsedObservable=new t.b,this.onMeshLoadedObservable=new t.b,this.onSkinLoadedObservable=new t.b,this.onTextureLoadedObservable=new t.b,this.onMaterialLoadedObservable=new t.b,this.onCameraLoadedObservable=new t.b,this.onCompleteObservable=new t.b,this.onErrorObservable=new t.b,this.up=new t.b,this.onExtensionLoadedObservable=new t.b,this.validate=!1,this.onValidatedObservable=new t.b,this._loader=null,this._state=null,this._requests=new Array,this.name=Y.name,this.extensions=Y.extensions,this.onLoaderStateChangedObservable=new t.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.t(H)}set onParsed(H){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),H&&(this._onParsedObserver=this.onParsedObservable.add(H))}set onMeshLoaded(H){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),H&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(H))}set onSkinLoaded(H){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),H&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((O=>H(O.node,O.skinnedNode))))}set onTextureLoaded(H){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),H&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(H))}set onMaterialLoaded(H){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),H&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(H))}set onCameraLoaded(H){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),H&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(H))}set onComplete(H){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(H)}set onError(H){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(H)}set onDispose(H){this._onDisposeObserver&&this.up.remove(this._onDisposeObserver),this._onDisposeObserver=this.up.add(H)}set onExtensionLoaded(H){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(H)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(H){this._loggingEnabled!==H&&(this._loggingEnabled=H,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(H){this._capturePerformanceCounters!==H&&(this._capturePerformanceCounters=H,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(H){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(H)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const H of this._requests)H.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=H=>Promise.resolve(H),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.up.notifyObservers(void 0),this.up.clear()}loadFile(H,O,S,p,G,U,V,o){if(ArrayBuffer.isView(O))return this._loadBinary(H,O,S,p,V,o),null;this._progressCallback=G;const h=O.name||q.Tools.GetFilename(O);if(U){if(this.useRangeRequests){this.validate&&w.b.Warn("glTF validation is not supported when range requests are enabled");const S={abort:()=>{},onCompleteObservable:new t.b},q={readAsync:(S,t)=>new Promise(((q,p)=>{this._loadFile(H,O,(H=>{q(new Uint8Array(H))}),!0,(H=>{p(H)}),(H=>{H.setRequestHeader("Range",`bytes=${S}-${S+t-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new b(q)).then((H=>{S.onCompleteObservable.notifyObservers(S),p(H)}),V?H=>V(void 0,H):void 0),S}return this._loadFile(H,O,(O=>{this._validate(H,new Uint8Array(O,0,O.byteLength),S,h),this._unpackBinaryAsync(new b({readAsync:(H,S)=>r(O,H,S),byteLength:O.byteLength})).then((H=>{p(H)}),V?H=>V(void 0,H):void 0)}),!0,V)}return this._loadFile(H,O,(O=>{try{this._validate(H,O,S,h),p({json:this._parseJson(O)})}catch{V&&V()}}),!1,V)}_loadBinary(H,O,S,t,q,p){this._validate(H,new Uint8Array(O.buffer,O.byteOffset,O.byteLength),S,p),this._unpackBinaryAsync(new b({readAsync:(H,S)=>function(H,O,S){try{if(O<0||O>=H.byteLength)throw new RangeError("Offset is out of range.");if(O+S>H.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(H.buffer,H.byteOffset+O,S))}catch(t){return Promise.reject(t)}}(O,H,S),byteLength:O.byteLength})).then((H=>{t(H)}),q?H=>q(void 0,H):void 0)}importMeshAsync(H,O,S,t,q,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(S),this._loader.importMeshAsync(H,O,null,S,t,q,p))))}loadAsync(H,O,S,t,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(O),this._loader.loadAsync(H,O,S,t,q))))}loadAssetContainerAsync(H,O,S,t,q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(O);const p=new T(H),G=[];this.onMaterialLoadedObservable.add((H=>{G.push(H)}));const U=[];this.onTextureLoadedObservable.add((H=>{U.push(H)}));const V=[];this.onCameraLoadedObservable.add((H=>{V.push(H)}));const w=[];return this.onMeshLoadedObservable.add((H=>{H.morphTargetManager&&w.push(H.morphTargetManager)})),this._loader.importMeshAsync(null,H,p,O,S,t,q).then((H=>(Array.prototype.push.apply(p.geometries,H.geometries),Array.prototype.push.apply(p.meshes,H.meshes),Array.prototype.push.apply(p.ha,H.ha),Array.prototype.push.apply(p.skeletons,H.skeletons),Array.prototype.push.apply(p.animationGroups,H.animationGroups),Array.prototype.push.apply(p.materials,G),Array.prototype.push.apply(p.textures,U),Array.prototype.push.apply(p.lights,H.lights),Array.prototype.push.apply(p.transformNodes,H.transformNodes),Array.prototype.push.apply(p.cameras,V),Array.prototype.push.apply(p.morphTargetManagers,w),p)))}))}canDirectLoad(H){return Y.canDirectLoad(H)}directLoad(H,O){if(O.startsWith("base64,"+F)||O.startsWith(";base64,"+F)||O.startsWith("application/octet-stream;base64,"+F)||O.startsWith("model/gltf-binary;base64,"+F)){const S=(0,z.d)(O);return this._validate(H,new Uint8Array(S,0,S.byteLength)),this._unpackBinaryAsync(new b({readAsync:(H,O)=>r(S,H,O),byteLength:S.byteLength}))}return this._validate(H,O),Promise.resolve({json:this._parseJson(O)})}createPlugin(H){return new g(H[Y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((H,O)=>{this.onCompleteObservable.addOnce((()=>{H()})),this.onErrorObservable.addOnce((H=>{O(H)}))}))}_setState(H){this._state!==H&&(this._state=H,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(v[this._state]))}_loadFile(H,O,S,t,q,p){const G=H._loadFile(O,S,(H=>{this._onProgress(H,G)}),!0,t,q,p);return G.onCompleteObservable.add((()=>{G._lengthComputable=!0,G._total=G._loaded})),this._requests.push(G),G}_onProgress(H,O){if(!this._progressCallback)return;O._lengthComputable=H.lengthComputable,O._loaded=H.loaded,O._total=H.total;let S=!0,t=0,q=0;for(const p of this._requests){if(void 0===p._lengthComputable||void 0===p._loaded||void 0===p._total)return;S=S&&p._lengthComputable,t+=p._loaded,q+=p._total}this._progressCallback({lengthComputable:S,loaded:t,total:S?q:0})}_validate(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),D.b.ValidateAsync(O,S,t,(O=>this.preprocessUrlAsync(S+O).then((O=>H._loadFileAsync(O,void 0,!0,!0).then((H=>new Uint8Array(H,0,H.byteLength))))))).then((H=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(H),this.onValidatedObservable.clear()}),(H=>{this._endPerformanceCounter("Validate JSON"),q.Tools.Warn(`Failed to validate: ${H.message}`),this.onValidatedObservable.clear()})))}_getLoader(H){const O=H.json.asset||{};this._log(`Asset version: ${O.version}`),O.minVersion&&this._log(`Asset minimum version: ${O.minVersion}`),O.generator&&this._log(`Asset generator: ${O.generator}`);const S=g._parseVersion(O.version);if(!S)throw new Error("Invalid version: "+O.version);if(void 0!==O.minVersion){const H=g._parseVersion(O.minVersion);if(!H)throw new Error("Invalid minimum version: "+O.minVersion);if(g._compareVersion(H,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+O.minVersion)}const t={1:g._CreateGLTF1Loader,2:g._CreateGLTF2Loader}[S.major];if(!t)throw new Error("Unsupported version: "+O.version);return t(this)}_parseJson(H){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${H.length}`);const O=JSON.parse(H);return this._endPerformanceCounter("Parse JSON"),O}_unpackBinaryAsync(H){return this._startPerformanceCounter("Unpack Binary"),H.loadAsync(20).then((()=>{const O=H.readUint32();if(1179937895!==O)throw new m.f("Unexpected magic: "+O,m.e.GLTFLoaderUnexpectedMagicError);const S=H.readUint32();this.loggingEnabled&&this._log(`Binary version: ${S}`);const t=H.readUint32();let q;switch(this.useRangeRequests||t===H.buffer.byteLength||w.b.Warn(`Length in header does not match actual data length: ${t} != ${H.buffer.byteLength}`),S){case 1:q=this._unpackBinaryV1Async(H,t);break;case 2:q=this._unpackBinaryV2Async(H,t);break;default:throw new Error("Unsupported version: "+S)}return this._endPerformanceCounter("Unpack Binary"),q}))}_unpackBinaryV1Async(H,O){const S=H.readUint32(),t=H.readUint32();if(0!==t)throw new Error(`Unexpected content format: ${t}`);const q=O-H.byteOffset,p={json:this._parseJson(H.readString(S)),bin:null};if(0!==q){const O=H.byteOffset;p.bin={readAsync:(S,t)=>H.buffer.readAsync(O+S,t),byteLength:q}}return Promise.resolve(p)}_unpackBinaryV2Async(H,O){const S=1313821514,t=5130562,q=H.readUint32();if(H.readUint32()!==S)throw new Error("First chunk format is not JSON");return H.byteOffset+q===O?H.loadAsync(q).then((()=>({json:this._parseJson(H.readString(q)),bin:null}))):H.loadAsync(q+8).then((()=>{const p={json:this._parseJson(H.readString(q)),bin:null},G=()=>{const q=H.readUint32();switch(H.readUint32()){case S:throw new Error("Unexpected JSON chunk");case t:{const O=H.byteOffset;p.bin={readAsync:(S,t)=>H.buffer.readAsync(O+S,t),byteLength:q},H.skipBytes(q);break}default:H.skipBytes(q)}return H.byteOffset!==O?H.loadAsync(8).then(G):Promise.resolve(p)};return G()}))}static _parseVersion(H){if("1.0"===H||"1.0.1"===H)return{major:1,minor:0};const O=(H+"").match(/^(\d+)\.(\d+)/);return O?{major:parseInt(O[1]),minor:parseInt(O[2])}:null}static _compareVersion(H,O){return H.major>O.major?1:H.major<O.major?-1:H.minor>O.minor?1:H.minor<O.minor?-1:0}_logOpen(H){this._log(H),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(H){const O=g._logSpaces.substring(0,2*this._logIndentLevel);w.b.Log(`${O}${H}`)}_logDisabled(H){}_startPerformanceCounterEnabled(H){q.Tools.StartPerformanceCounter(H)}_startPerformanceCounterDisabled(H){}_endPerformanceCounterEnabled(H){q.Tools.EndPerformanceCounter(H)}_endPerformanceCounterDisabled(H){}}g.IncrementalLoading=!0,g.HomogeneousCoordinates=!1,g._logSpaces="                                ",(0,p.c)(new g)},12969:(H,O,S)=>{"use strict";S.d(O,{b:()=>G});var t=S(11131);function q(H,O,S,t){const q={externalResourceFunction:t};return S&&(q.uri="file:"===O?S:O+S),ArrayBuffer.isView(H)?GLTFValidator.validateBytes(H,q):GLTFValidator.validateString(H,q)}function p(){const H=[];onmessage=O=>{const S=O.data;switch(S.id){case"init":importScripts(S.url);break;case"validate":q(S.data,S.rootUrl,S.fileName,(O=>new Promise(((S,t)=>{const q=H.length;H.push({resolve:S,reject:t}),postMessage({id:"getExternalResource",index:q,uri:O})})))).then((H=>{postMessage({id:"validate.resolve",value:H})}),(H=>{postMessage({id:"validate.reject",reason:H})}));break;case"getExternalResource.resolve":H[S.index].resolve(S.value);break;case"getExternalResource.reject":H[S.index].reject(S.reason)}}}class G{static ValidateAsync(H,O,S,G){return"function"===typeof Worker?new Promise(((U,V)=>{const w=`${q}(${p})()`,o=URL.createObjectURL(new Blob([w],{type:"application/javascript"})),h=new Worker(o),a=H=>{h.removeEventListener("error",a),h.removeEventListener("message",j),V(H)},j=H=>{const O=H.data;switch(O.id){case"getExternalResource":G(O.uri).then((H=>{h.postMessage({id:"getExternalResource.resolve",index:O.index,value:H},[H.buffer])}),(H=>{h.postMessage({id:"getExternalResource.reject",index:O.index,reason:H})}));break;case"validate.resolve":h.removeEventListener("error",a),h.removeEventListener("message",j),U(O.value),h.terminate();break;case"validate.reject":h.removeEventListener("error",a),h.removeEventListener("message",j),V(O.reason),h.terminate()}};if(h.addEventListener("error",a),h.addEventListener("message",j),h.postMessage({id:"init",url:t.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(H)){const t=H.slice();h.postMessage({id:"validate",data:t,rootUrl:O,fileName:S},[t.buffer])}else h.postMessage({id:"validate",data:H,rootUrl:O,fileName:S})})):(this._LoadScriptPromise||(this._LoadScriptPromise=t.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>q(H,O,S,G))))}}G.Configuration={url:`${t.Tools._DefaultCdnUrl}/gltf_validator.js`}},13490:(H,O,S)=>{"use strict";S.d(O,{b:()=>Y});var t=S(11287),q=S(11289),p=S(11338),G=S(11301),U=S(11689),V=S(11615),w=S(11378),o=S(11541),h=S(11262),a=S(11223);S(12742),S(12639),S(12662),S(12646),S(12666),S(12672),S(12680);const j="imageProcessingCompatibility",e="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";a.d.IncludesShadersStore[j]||(a.d.IncludesShadersStore[j]=e);const X="skyPixelShader",E="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";a.d.ShadersStore[X]||(a.d.ShadersStore[X]=E);S(12749),S(12688),S(12691),S(12702),S(12700);const y="skyVertexShader",T="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";a.d.ShadersStore[y]||(a.d.ShadersStore[y]=T);var K=S(11609),b=S(11671),D=S(11669);class F extends U.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Y extends V.c{constructor(H,O){super(H,O),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new G.eO(0,100,0),this.useSunPosition=!1,this.cameraOffset=G.eO.Zero(),this.up=G.eO.Up(),this.dithering=!1,this._cameraPosition=G.eO.Zero(),this._skyOrientation=new G.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(H,O){const S=O._drawWrapper;if(this.isFrozen&&S.effect&&S._wasPreviouslyReady)return!0;O.materialDefines||(O.materialDefines=new F);const t=O.materialDefines,q=this.YH();if(this._isReadyForSubMesh(O))return!0;if((0,D.Q)(H,q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,t),(0,D.H)(H,t,!0,!1),t.IMAGEPROCESSINGPOSTPROCESS!==q.imageProcessingConfiguration.applyByPostProcess&&t.markAsMiscDirty(),t.DITHER!==this.dithering&&t.markAsMiscDirty(),t.isDirty){t.markAsProcessed(),q.resetCachedMaterial();const H=new K.c;t.FOG&&H.addFallback(1,"FOG"),t.IMAGEPROCESSINGPOSTPROCESS=q.imageProcessingConfiguration.applyByPostProcess,t.DITHER=this.dithering;const S=[w.h.PositionKind];t.VERTEXCOLOR&&S.push(w.h.ColorKind);const p="sky",G=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,b.d)(G);const U=t.toString();O.setEffect(q.getEngine().createEffect(p,S,G,[],U,H,this.onCompiled,this.onError),t,this._materialContext)}return!(!O.effect||!O.effect.isReady())&&(t._renderId=q.getRenderId(),S._wasPreviouslyReady=!0,!0)}bindForSubMesh(H,O,S){const t=this.YH(),q=S.materialDefines;if(!q)return;const p=S.effect;if(!p)return;this._activeEffect=p,this.bindOnlyWorldMatrix(H),this._activeEffect.setMatrix("viewProjection",t.getTransformMatrix()),this._mustRebind(t,p,S)&&((0,b.g)(p,this,t),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,D.h)(q,p,t)),t.fogEnabled&&O.applyFog&&t.fogMode!==o.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",t.getViewMatrix()),(0,D.f)(t,O,this._activeEffect);const U=t.activeCamera;if(U){const H=U.getWorldMatrix();this._cameraPosition.x=H.m[12],this._cameraPosition.y=H.m[13],this._cameraPosition.z=H.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const H=Math.PI*(this.inclination-.5),O=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(O)*Math.cos(H),this.sunPosition.y=this.distance*Math.sin(-H),this.sunPosition.z=this.distance*Math.sin(O)*Math.cos(H),G.Quaternion.FromUnitVectorsToRef(G.eO.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(O,this._activeEffect,S)}getAnimatables(){return[]}dispose(H){super.dispose(H)}clone(H){return p.e.Clone((()=>new Y(H,this.YH())),this)}serialize(){const H=super.serialize();return H.customType="BABYLON.SkyMaterial",H}getClassName(){return"SkyMaterial"}static Parse(H,O,S){return p.e.Parse((()=>new Y(H.name,O)),H,O,S)}}(0,t.d)([(0,q.J)()],Y.prototype,"luminance",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"turbidity",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"rayleigh",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"mieCoefficient",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"mieDirectionalG",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"distance",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"inclination",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"azimuth",void 0),(0,t.d)([(0,q.F)()],Y.prototype,"sunPosition",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"useSunPosition",void 0),(0,t.d)([(0,q.F)()],Y.prototype,"cameraOffset",void 0),(0,t.d)([(0,q.F)()],Y.prototype,"up",void 0),(0,t.d)([(0,q.J)()],Y.prototype,"dithering",void 0),(0,h.g)("BABYLON.SkyMaterial",Y)},11994:(H,O,S)=>{"use strict";function t(H,O){O.headers=H.headers||{},O.statusMessage=H.statusText,O.statusCode=H.status,O.data=H.response}function q(H,O,S){return new Promise((function(q,p){S=S||{};var G,U,V,w=new XMLHttpRequest,o=S.body,h=S.headers||{};for(G in S.timeout&&(w.timeout=S.timeout),w.ontimeout=w.onerror=function(H){H.timeout="timeout"==H.type,p(H)},w.open(H,O.href||O),w.onload=function(){for(V=w.getAllResponseHeaders().trim().split(/[\r\n]+/),t(w,w);U=V.shift();)U=U.split(": "),w.headers[U.shift().toLowerCase()]=U.join(": ");if((U=w.headers["content-type"])&&~U.indexOf("application/json"))try{w.data=JSON.parse(w.data,S.reviver)}catch(H){return t(w,H),p(H)}(w.status>=400?p:q)(w)},typeof FormData<"u"&&o instanceof FormData||o&&"object"==typeof o&&(h["content-type"]="application/json",o=JSON.stringify(o)),w.withCredentials=!!S.withCredentials,h)w.setRequestHeader(G,h[G]);w.send(o)}))}S.r(O),S.d(O,{del:()=>V,get:()=>p,patch:()=>U,post:()=>G,put:()=>w,send:()=>q});var p=q.bind(q,"GET"),G=q.bind(q,"POST"),U=q.bind(q,"PATCH"),V=q.bind(q,"DELETE"),w=q.bind(q,"PUT")},13606:(H,O,S)=>{"use strict";S.d(O,{d:()=>h});const t=.5*(Math.sqrt(3)-1),q=(3-Math.sqrt(3))/6,p=1/3,G=1/6,U=(Math.sqrt(5)-1)/4,V=(5-Math.sqrt(5))/20,w=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),o=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const h=class{constructor(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const O="function"==typeof H?H:function(H){let O=0,S=0,t=0,q=1;const p=function(){let H=4022871197;return function(O){O=O.toString();for(let S=0;S<O.length;S++){H+=O.charCodeAt(S);let t=.02519603282416938*H;H=t>>>0,t-=H,t*=H,H=t>>>0,t-=H,H+=4294967296*t}return 2.3283064365386963e-10*(H>>>0)}}();O=p(" "),S=p(" "),t=p(" "),O-=p(H),O<0&&(O+=1);S-=p(H),S<0&&(S+=1);t-=p(H),t<0&&(t+=1);return function(){const H=2091639*O+2.3283064365386963e-10*q;return O=S,S=t,t=H-(q=0|H)}}(H);this.p=function(H){const O=new Uint8Array(256);for(let S=0;S<256;S++)O[S]=S;for(let S=0;S<255;S++){const t=S+~~(H()*(256-S)),q=O[S];O[S]=O[t],O[t]=q}return O}(O),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let S=0;S<512;S++)this.perm[S]=this.p[255&S],this.permMod12[S]=this.perm[S]%12}noise2D(H,O){const S=this.permMod12,p=this.perm;let G=0,U=0,V=0;const o=(H+O)*t,h=Math.floor(H+o),a=Math.floor(O+o),j=(h+a)*q,e=H-(h-j),X=O-(a-j);let E,y;e>X?(E=1,y=0):(E=0,y=1);const T=e-E+q,K=X-y+q,b=e-1+2*q,D=X-1+2*q,F=255&h,Y=255&a;let l=.5-e*e-X*X;if(l>=0){const H=3*S[F+p[Y]];l*=l,G=l*l*(w[H]*e+w[H+1]*X)}let d=.5-T*T-K*K;if(d>=0){const H=3*S[F+E+p[Y+y]];d*=d,U=d*d*(w[H]*T+w[H+1]*K)}let v=.5-b*b-D*D;if(v>=0){const H=3*S[F+1+p[Y+1]];v*=v,V=v*v*(w[H]*b+w[H+1]*D)}return 70*(G+U+V)}noise3D(H,O,S){const t=this.permMod12,q=this.perm;let U,V,o,h;const a=(H+O+S)*p,j=Math.floor(H+a),e=Math.floor(O+a),X=Math.floor(S+a),E=(j+e+X)*G,y=H-(j-E),T=O-(e-E),K=S-(X-E);let b,D,F,Y,l,d;y>=T?T>=K?(b=1,D=0,F=0,Y=1,l=1,d=0):y>=K?(b=1,D=0,F=0,Y=1,l=0,d=1):(b=0,D=0,F=1,Y=1,l=0,d=1):T<K?(b=0,D=0,F=1,Y=0,l=1,d=1):y<K?(b=0,D=1,F=0,Y=0,l=1,d=1):(b=0,D=1,F=0,Y=1,l=1,d=0);const v=y-b+G,z=T-D+G,m=K-F+G,r=y-Y+2*G,W=T-l+2*G,g=K-d+2*G,N=y-1+.5,x=T-1+.5,k=K-1+.5,A=255&j,u=255&e,J=255&X;let P=.6-y*y-T*T-K*K;if(P<0)U=0;else{const H=3*t[A+q[u+q[J]]];P*=P,U=P*P*(w[H]*y+w[H+1]*T+w[H+2]*K)}let f=.6-v*v-z*z-m*m;if(f<0)V=0;else{const H=3*t[A+b+q[u+D+q[J+F]]];f*=f,V=f*f*(w[H]*v+w[H+1]*z+w[H+2]*m)}let c=.6-r*r-W*W-g*g;if(c<0)o=0;else{const H=3*t[A+Y+q[u+l+q[J+d]]];c*=c,o=c*c*(w[H]*r+w[H+1]*W+w[H+2]*g)}let R=.6-N*N-x*x-k*k;if(R<0)h=0;else{const H=3*t[A+1+q[u+1+q[J+1]]];R*=R,h=R*R*(w[H]*N+w[H+1]*x+w[H+2]*k)}return 32*(U+V+o+h)}noise4D(H,O,S,t){const q=this.perm;let p,G,w,h,a;const j=(H+O+S+t)*U,e=Math.floor(H+j),X=Math.floor(O+j),E=Math.floor(S+j),y=Math.floor(t+j),T=(e+X+E+y)*V,K=H-(e-T),b=O-(X-T),D=S-(E-T),F=t-(y-T);let Y=0,l=0,d=0,v=0;K>b?Y++:l++,K>D?Y++:d++,K>F?Y++:v++,b>D?l++:d++,b>F?l++:v++,D>F?d++:v++;const z=Y>=3?1:0,m=l>=3?1:0,r=d>=3?1:0,W=v>=3?1:0,g=Y>=2?1:0,N=l>=2?1:0,x=d>=2?1:0,k=v>=2?1:0,A=Y>=1?1:0,u=l>=1?1:0,J=d>=1?1:0,P=v>=1?1:0,f=K-z+V,c=b-m+V,R=D-r+V,B=F-W+V,Z=K-g+2*V,I=b-N+2*V,s=D-x+2*V,i=F-k+2*V,M=K-A+3*V,C=b-u+3*V,n=D-J+3*V,Q=F-P+3*V,L=K-1+4*V,HH=b-1+4*V,OH=D-1+4*V,SH=F-1+4*V,tH=255&e,qH=255&X,pH=255&E,GH=255&y;let UH=.6-K*K-b*b-D*D-F*F;if(UH<0)p=0;else{const H=q[tH+q[qH+q[pH+q[GH]]]]%32*4;UH*=UH,p=UH*UH*(o[H]*K+o[H+1]*b+o[H+2]*D+o[H+3]*F)}let VH=.6-f*f-c*c-R*R-B*B;if(VH<0)G=0;else{const H=q[tH+z+q[qH+m+q[pH+r+q[GH+W]]]]%32*4;VH*=VH,G=VH*VH*(o[H]*f+o[H+1]*c+o[H+2]*R+o[H+3]*B)}let wH=.6-Z*Z-I*I-s*s-i*i;if(wH<0)w=0;else{const H=q[tH+g+q[qH+N+q[pH+x+q[GH+k]]]]%32*4;wH*=wH,w=wH*wH*(o[H]*Z+o[H+1]*I+o[H+2]*s+o[H+3]*i)}let oH=.6-M*M-C*C-n*n-Q*Q;if(oH<0)h=0;else{const H=q[tH+A+q[qH+u+q[pH+J+q[GH+P]]]]%32*4;oH*=oH,h=oH*oH*(o[H]*M+o[H+1]*C+o[H+2]*n+o[H+3]*Q)}let hH=.6-L*L-HH*HH-OH*OH-SH*SH;if(hH<0)a=0;else{const H=q[tH+1+q[qH+1+q[pH+1+q[GH+1]]]]%32*4;hH*=hH,a=hH*hH*(o[H]*L+o[H+1]*HH+o[H+2]*OH+o[H+3]*SH)}return 27*(p+G+w+h+a)}}}}]);