/*! For license information please see g2ybjd.32.693e7049.chunk.js.LICENSE.txt */
(self.qbp2s7qydk=self.qbp2s7qydk||[]).push([[32],{13647:function(M,A){!function(M){"use strict";var A=function(M,O){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,A){M.__proto__=A}||function(M,A){for(var O in A)Object.prototype.hasOwnProperty.call(A,O)&&(M[O]=A[O])},A(M,O)};function O(M,O){if("function"!==typeof O&&null!==O)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function S(){this.constructor=M}A(M,O),M.prototype=null===O?Object.create(O):(S.prototype=O.prototype,new S)}function S(M,A,O,S){var z,Q=arguments.length,X=Q<3?A:null===S?S=Object.getOwnPropertyDescriptor(A,O):S;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)X=Reflect.decorate(M,A,O,S);else for(var c=M.length-1;c>=0;c--)(z=M[c])&&(X=(Q<3?z(X):Q>3?z(A,O,X):z(A,O))||X);return Q>3&&X&&Object.defineProperty(A,O,X),X}function z(M,A,O){if(O||2===arguments.length)for(var S,z=0,Q=A.length;z<Q;z++)!S&&z in A||(S||(S=Array.prototype.slice.call(A,0,z)),S[z]=A[z]);return M.concat(S||Array.prototype.slice.call(A))}var Q,X=255,c=213;M.OPERATION=void 0,(Q=M.OPERATION||(M.OPERATION={}))[Q.ADD=128]="ADD",Q[Q.REPLACE=0]="REPLACE",Q[Q.DELETE=64]="DELETE",Q[Q.DELETE_AND_ADD=192]="DELETE_AND_ADD",Q[Q.TOUCH=1]="TOUCH",Q[Q.CLEAR=10]="CLEAR";var j=function(){function A(M,A,O){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=M,this.setParent(A,O)}return A.prototype.setParent=function(M,A,O){var S=this;if(this.indexes||(this.indexes=this.ref instanceof uM?this.ref._definition.indexes:{}),this.parent=M,this.parentIndex=O,A)if(this.root=A,this.ref instanceof uM){var z=this.ref._definition;for(var Q in z.schema){var X=this.ref[Q];if(X&&X.$changes){var c=z.indexes[Q];X.$changes.setParent(this.ref,A,c)}}}else"object"===typeof this.ref&&this.ref.forEach((function(M,A){if(M instanceof uM){var O=M.$changes,z=S.ref.$changes.indexes[A];O.setParent(S.ref,S.root,z)}}))},A.prototype.operation=function(M){this.changes.set(--this.currentCustomOperation,M)},A.prototype.change=function(A,O){void 0===O&&(O=M.OPERATION.ADD);var S="number"===typeof A?A:this.indexes[A];this.assertValidIndex(S,A);var z=this.changes.get(S);z&&z.op!==M.OPERATION.DELETE&&z.op!==M.OPERATION.TOUCH||this.changes.set(S,{op:z&&z.op===M.OPERATION.DELETE?M.OPERATION.DELETE_AND_ADD:O,index:S}),this.allChanges.add(S),this.changed=!0,this.touchParents()},A.prototype.touch=function(A){var O="number"===typeof A?A:this.indexes[A];this.assertValidIndex(O,A),this.changes.has(O)||this.changes.set(O,{op:M.OPERATION.TOUCH,index:O}),this.allChanges.add(O),this.touchParents()},A.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},A.prototype.getType=function(M){if(this.ref._definition)return(A=this.ref._definition).schema[A.fieldsByIndex[M]];var A,O=(A=this.parent._definition).schema[A.fieldsByIndex[this.parentIndex]];return Object.values(O)[0]},A.prototype.getChildrenFilter=function(){var M=this.parent._definition.childFilters;return M&&M[this.parentIndex]},A.prototype.getValue=function(M){return this.ref.getByIndex(M)},A.prototype.delete=function(A){var O="number"===typeof A?A:this.indexes[A];if(void 0!==O){var S=this.getValue(O);this.changes.set(O,{op:M.OPERATION.DELETE,index:O}),this.allChanges.delete(O),delete this.caches[O],S&&S.$changes&&(S.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(A," (").concat(O,")"))},A.prototype.discard=function(A,O){var S=this;void 0===A&&(A=!1),void 0===O&&(O=!1),this.ref instanceof uM||this.changes.forEach((function(A){if(A.op===M.OPERATION.DELETE){var O=S.ref.getIndex(A.index);delete S.indexes[O]}})),this.changes.clear(),this.changed=A,O&&this.allChanges.clear(),this.currentCustomOperation=0},A.prototype.discardAll=function(){var M=this;this.changes.forEach((function(A){var O=M.getValue(A.index);O&&O.$changes&&O.$changes.discardAll()})),this.discard()},A.prototype.cache=function(M,A){this.caches[M]=A},A.prototype.clone=function(){return new A(this.ref,this.parent,this.root)},A.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},A.prototype.assertValidIndex=function(M,A){if(void 0===M)throw new Error('ChangeTree: missing index for field "'.concat(A,'"'))},A}();function B(M,A,O,S){return M[A]||(M[A]=[]),M[A].push(O),null===S||void 0===S||S.forEach((function(M,A){return O(M,A)})),function(){return e(M[A],M[A].indexOf(O))}}function g(A){var O=this,S="string"!==typeof this.$changes.getType();this.$items.forEach((function(z,Q){A.push({refId:O.$changes.refId,op:M.OPERATION.DELETE,field:Q,value:void 0,previousValue:z}),S&&O.$changes.root.removeRef(z.$changes.refId)}))}function e(M,A){if(-1===A||A>=M.length)return!1;for(var O=M.length-1,S=A;S<O;S++)M[S]=M[S+1];return M.length=O,!0}var T=function(M,A){var O=M.toString(),S=A.toString();return O<S?-1:O>S?1:0};function J(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,A){return"symbol"===typeof A||isNaN(A)?M[A]:M.at(A)},set:function(M,A,O){if("symbol"===typeof A||isNaN(A))M[A]=O;else{var S=Array.from(M.$items.keys()),z=parseInt(S[A]||A);void 0===O||null===O?M.deleteAt(z):M.setAt(z,O)}return!0},deleteProperty:function(M,A){return"number"===typeof A?M.deleteAt(A):delete M[A],!0}})}var K=function(){function A(){for(var M=[],A=0;A<arguments.length;A++)M[A]=arguments[A];this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,M)}return A.prototype.bj=function(A,O){return void 0===O&&(O=!0),B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,A,O?this.$items:void 0)},A.prototype.mz=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,A)},A.is=function(M){return Array.isArray(M)||void 0!==M.array},Object.defineProperty(A.prototype,"length",{get:function(){return this.$items.size},set:function(M){0===M?this.clear():this.splice(M,this.length-M)},enumerable:!1,configurable:!0}),A.prototype.push=function(){for(var M,A=this,O=[],S=0;S<arguments.length;S++)O[S]=arguments[S];return O.forEach((function(O){M=A.$refId++,A.setAt(M,O)})),M},A.prototype.pop=function(){var M=Array.from(this.$indexes.values()).pop();if(void 0!==M){this.$changes.delete(M),this.$indexes.delete(M);var A=this.$items.get(M);return this.$items.delete(M),A}},A.prototype.at=function(M){var A=Array.from(this.$items.keys())[M];return this.$items.get(A)},A.prototype.setAt=function(A,O){var S,z;if(void 0!==O&&null!==O){if(this.$items.get(A)!==O){void 0!==O.$changes&&O.$changes.setParent(this,this.$changes.root,A);var Q=null!==(z=null===(S=this.$changes.indexes[A])||void 0===S?void 0:S.op)&&void 0!==z?z:M.OPERATION.ADD;this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,O),this.$changes.change(A,Q)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},A.prototype.deleteAt=function(M){var A=Array.from(this.$items.keys())[M];return void 0!==A&&this.$deleteAt(A)},A.prototype.$deleteAt=function(M){return this.$changes.delete(M),this.$indexes.delete(M),this.$items.delete(M)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&g.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.concat=function(){for(var M,O=[],S=0;S<arguments.length;S++)O[S]=arguments[S];return new(A.bind.apply(A,z([void 0],(M=Array.from(this.$items.values())).concat.apply(M,O),!1)))},A.prototype.join=function(M){return Array.from(this.$items.values()).join(M)},A.prototype.reverse=function(){var M=this,A=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(O,S){M.setAt(A[S],O)})),this},A.prototype.shift=function(){var M=Array.from(this.$items.keys()).shift();if(void 0!==M){var A=this.$items.get(M);return this.$deleteAt(M),A}},A.prototype.slice=function(M,O){var S=new A;return S.push.apply(S,Array.from(this.$items.values()).slice(M,O)),S},A.prototype.sort=function(M){var A=this;void 0===M&&(M=T);var O=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(M).forEach((function(M,S){A.setAt(O[S],M)})),this},A.prototype.splice=function(M,A){void 0===A&&(A=this.length-M);for(var O=Array.from(this.$items.keys()),S=[],z=M;z<M+A;z++)S.push(this.$items.get(O[z])),this.$deleteAt(O[z]);return S},A.prototype.unshift=function(){for(var M=this,A=[],O=0;O<arguments.length;O++)A[O]=arguments[O];var S=this.length,z=A.length,Q=Array.from(this.$items.values());return A.forEach((function(A,O){M.setAt(O,A)})),Q.forEach((function(A,O){M.setAt(z+O,A)})),S+z},A.prototype.indexOf=function(M,A){return Array.from(this.$items.values()).indexOf(M,A)},A.prototype.lastIndexOf=function(M,A){return void 0===A&&(A=this.length-1),Array.from(this.$items.values()).lastIndexOf(M,A)},A.prototype.every=function(M,A){return Array.from(this.$items.values()).every(M,A)},A.prototype.some=function(M,A){return Array.from(this.$items.values()).some(M,A)},A.prototype.forEach=function(M,A){Array.from(this.$items.values()).forEach(M,A)},A.prototype.map=function(M,A){return Array.from(this.$items.values()).map(M,A)},A.prototype.filter=function(M,A){return Array.from(this.$items.values()).filter(M,A)},A.prototype.reduce=function(M,A){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},A.prototype.reduceRight=function(M,A){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},A.prototype.find=function(M,A){return Array.from(this.$items.values()).find(M,A)},A.prototype.findIndex=function(M,A){return Array.from(this.$items.values()).findIndex(M,A)},A.prototype.fill=function(M,A,O){throw new Error("ArraySchema#fill() not implemented")},A.prototype.copyWithin=function(M,A,O){throw new Error("ArraySchema#copyWithin() not implemented")},A.prototype.toString=function(){return this.$items.toString()},A.prototype.toLocaleString=function(){return this.$items.toLocaleString()},A.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},A.prototype.includes=function(M,A){return Array.from(this.$items.values()).includes(M,A)},A.prototype.flatMap=function(M,A){throw new Error("ArraySchema#flatMap() is not supported.")},A.prototype.flat=function(M){throw new Error("ArraySchema#flat() is not supported.")},A.prototype.findLast=function(){var M=Array.from(this.$items.values());return M.findLast.apply(M,arguments)},A.prototype.findLastIndex=function(){var M=Array.from(this.$items.values());return M.findLastIndex.apply(M,arguments)},A.prototype.setIndex=function(M,A){this.$indexes.set(M,A)},A.prototype.getIndex=function(M){return this.$indexes.get(M)},A.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},A.prototype.deleteByIndex=function(M){var A=this.$indexes.get(M);this.$items.delete(A),this.$indexes.delete(M)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){return this.toArray().map((function(M){return"function"===typeof M.toJSON?M.toJSON():M}))},A.prototype.clone=function(M){return M?new(A.bind.apply(A,z([void 0],Array.from(this.$items.values()),!1))):new(A.bind.apply(A,z([void 0],this.map((function(M){return M.$changes?M.clone():M})),!1)))},A}();function G(M){return M.$proxy=!0,M=new Proxy(M,{get:function(M,A){return"symbol"!==typeof A&&"undefined"===typeof M[A]?M.get(A):M[A]},set:function(M,A,O){return"symbol"!==typeof A&&-1===A.indexOf("$")&&"bj"!==A&&"mz"!==A&&"onChange"!==A?M.set(A,O):M[A]=O,!0},deleteProperty:function(M,A){return M.delete(A),!0}})}var d=function(){function A(M){var O=this;if(this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M)if(M instanceof Map||M instanceof A)M.forEach((function(M,A){return O.set(A,M)}));else for(var S in M)this.set(S,M[S])}return A.prototype.bj=function(A,O){return void 0===O&&(O=!0),B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,A,O?this.$items:void 0)},A.prototype.mz=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,A)},A.is=function(M){return void 0!==M.map},A.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(A.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(A,Symbol.species,{get:function(){return A},enumerable:!1,configurable:!0}),A.prototype.set=function(A,O){if(void 0===O||null===O)throw new Error("MapSchema#set('".concat(A,"', ").concat(O,"): trying to set ").concat(O," value on '").concat(A,"'."));A=A.toString();var S="undefined"!==typeof this.$changes.indexes[A],z=S?this.$changes.indexes[A]:this.$refId++,Q=S?M.OPERATION.REPLACE:M.OPERATION.ADD,X=void 0!==O.$changes;if(X&&O.$changes.setParent(this,this.$changes.root,z),S){if(!X&&this.$items.get(A)===O)return;X&&this.$items.get(A)!==O&&(Q=M.OPERATION.ADD)}else this.$changes.indexes[A]=z,this.$indexes.set(z,A);return this.$items.set(A,O),this.$changes.change(A,Q),this},A.prototype.get=function(M){return this.$items.get(M)},A.prototype.delete=function(M){return this.$changes.delete(M),this.$items.delete(M)},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&g.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(M){return this.$items.has(M)},A.prototype.forEach=function(M){this.$items.forEach(M)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.keys=function(){return this.$items.keys()},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(M,A){this.$indexes.set(M,A)},A.prototype.getIndex=function(M){return this.$indexes.get(M)},A.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},A.prototype.deleteByIndex=function(M){var A=this.$indexes.get(M);this.$items.delete(A),this.$indexes.delete(M)},A.prototype.toJSON=function(){var M={};return this.forEach((function(A,O){M[O]="function"===typeof A.toJSON?A.toJSON():A})),M},A.prototype.clone=function(M){var O;return M?O=Object.assign(new A,this):(O=new A,this.forEach((function(M,A){M.$changes?O.set(A,M.clone()):O.set(A,M)}))),O},A}(),w={};function I(M,A){w[M]=A}function b(M){return w[M]}var s=function(){function M(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return M.create=function(A){var O=new M;return O.schema=Object.assign({},A&&A.schema||{}),O.indexes=Object.assign({},A&&A.indexes||{}),O.fieldsByIndex=Object.assign({},A&&A.fieldsByIndex||{}),O.descriptors=Object.assign({},A&&A.descriptors||{}),O.deprecated=Object.assign({},A&&A.deprecated||{}),O},M.prototype.addField=function(M,A){var O=this.getNextFieldIndex();this.fieldsByIndex[O]=M,this.indexes[M]=O,this.schema[M]=Array.isArray(A)?{array:A[0]}:A},M.prototype.hasField=function(M){return void 0!==this.indexes[M]},M.prototype.addFilter=function(M,A){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[M]]=A,this.indexesWithFilters.push(this.indexes[M]),!0},M.prototype.addChildrenFilter=function(M,A){var O=this.indexes[M],S=this.schema[M];if(b(Object.keys(S)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[O]=A,!0;console.warn("@filterChildren: field '".concat(M,"' can't have children. Ignoring filter."))},M.prototype.getChildrenFilter=function(M){return this.childFilters&&this.childFilters[this.indexes[M]]},M.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},M}();function Y(M){return M._context&&M._context.useFilters}var E=function(){function M(){this.types={},this.schemas=new Map,this.useFilters=!1}return M.prototype.has=function(M){return this.schemas.has(M)},M.prototype.get=function(M){return this.types[M]},M.prototype.add=function(M,A){void 0===A&&(A=this.schemas.size),M._definition=s.create(M._definition),M._typeid=A,this.types[A]=M,this.schemas.set(M,A)},M.create=function(A){return void 0===A&&(A={}),function(O){return A.context||(A.context=new M),C(O,A)}},M}(),H=new E;function C(M,A){return void 0===A&&(A={}),function(O,S){var Q=A.context||H,X=O.constructor;if(X._context=Q,!M)throw new Error("".concat(X.name,': @type() reference provided for "').concat(S,"\" is undefined. Make sure you don't have any circular dependencies."));Q.has(X)||Q.add(X);var c=X._definition;if(c.addField(S,M),c.descriptors[S]){if(c.deprecated[S])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(S,"' definition on '").concat(X.name,"'.\nCheck @type() annotation"))}catch(w){var j=w.stack.split("\n")[4].trim();throw new Error("".concat(w.message," ").concat(j))}}var B=K.is(M),g=!B&&d.is(M);if("string"!==typeof M&&!uM.is(M)){var e=Object.values(M)[0];"string"===typeof e||Q.has(e)||Q.add(e)}if(A.manual)c.descriptors[S]={enumerable:!0,configurable:!0,writable:!0};else{var T="_".concat(S);c.descriptors[T]={enumerable:!1,configurable:!1,writable:!0},c.descriptors[S]={get:function(){return this[T]},set:function(M){M!==this[T]&&(void 0!==M&&null!==M?(!B||M instanceof K||(M=new(K.bind.apply(K,z([void 0],M,!1)))),!g||M instanceof d||(M=new d(M)),void 0===M.$proxy&&(g?M=G(M):B&&(M=J(M))),this.$changes.change(S),M.$changes&&M.$changes.setParent(this,this.$changes.root,this._definition.indexes[S])):this[T]&&this.$changes.delete(S),this[T]=M)},enumerable:!0,configurable:!0}}}}function f(M){return function(A,O){var S=A.constructor;S._definition.addFilter(O,M)&&(S._context.useFilters=!0)}}function D(M){return function(A,O){var S=A.constructor;S._definition.addChildrenFilter(O,M)&&(S._context.useFilters=!0)}}function F(M){return void 0===M&&(M=!0),function(A,O){var S=A.constructor._definition;S.deprecated[O]=!0,M&&(S.descriptors[O]={get:function(){throw new Error("".concat(O," is deprecated."))},set:function(M){},enumerable:!1,configurable:!0})}}function N(M,A,O){for(var S in void 0===O&&(O={}),O.context||(O.context=M._context||O.context||H),A)C(A[S],O)(M.prototype,S);return M}function y(M){for(var A=0,O=0,S=0,z=M.length;S<z;S++)(A=M.charCodeAt(S))<128?O+=1:A<2048?O+=2:A<55296||A>=57344?O+=3:(S++,O+=4);return O}function h(M,A,O){for(var S=0,z=0,Q=O.length;z<Q;z++)(S=O.charCodeAt(z))<128?M[A++]=S:S<2048?(M[A++]=192|S>>6,M[A++]=128|63&S):S<55296||S>=57344?(M[A++]=224|S>>12,M[A++]=128|S>>6&63,M[A++]=128|63&S):(z++,S=65536+((1023&S)<<10|1023&O.charCodeAt(z)),M[A++]=240|S>>18,M[A++]=128|S>>12&63,M[A++]=128|S>>6&63,M[A++]=128|63&S)}function u(M,A){M.push(255&A)}function i(M,A){M.push(255&A)}function U(M,A){M.push(255&A),M.push(A>>8&255)}function L(M,A){M.push(255&A),M.push(A>>8&255)}function t(M,A){M.push(255&A),M.push(A>>8&255),M.push(A>>16&255),M.push(A>>24&255)}function x(M,A){var O=A>>24,S=A>>16,z=A>>8,Q=A;M.push(255&Q),M.push(255&z),M.push(255&S),M.push(255&O)}function o(M,A){var O=Math.floor(A/Math.pow(2,32));x(M,A>>>0),x(M,O)}function p(M,A){var O=A/Math.pow(2,32)|0;x(M,A>>>0),x(M,O)}function v(M,A){V(M,A)}function q(M,A){Z(M,A)}var r=new Int32Array(2),n=new Float32Array(r.buffer),a=new Float64Array(r.buffer);function V(M,A){n[0]=A,t(M,r[0])}function Z(M,A){a[0]=A,t(M,r[0]),t(M,r[1])}function P(M,A){return i(M,A?1:0)}function mM(M,A){A||(A="");var O=y(A),S=0;if(O<32)M.push(160|O),S=1;else if(O<256)M.push(217),i(M,O),S=2;else if(O<65536)M.push(218),L(M,O),S=3;else{if(!(O<4294967296))throw new Error("String too long");M.push(219),x(M,O),S=5}return h(M,M.length,A),S+O}function R(M,A){return isNaN(A)?R(M,0):isFinite(A)?A!==(0|A)?(M.push(203),Z(M,A),9):A>=0?A<128?(i(M,A),1):A<256?(M.push(204),i(M,A),2):A<65536?(M.push(205),L(M,A),3):A<4294967296?(M.push(206),x(M,A),5):(M.push(207),p(M,A),9):A>=-32?(M.push(224|A+32),1):A>=-128?(M.push(208),u(M,A),2):A>=-32768?(M.push(209),U(M,A),3):A>=-2147483648?(M.push(210),t(M,A),5):(M.push(211),o(M,A),9):R(M,A>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var k=Object.freeze({__proto__:null,utf8Write:h,int8:u,uint8:i,int16:U,uint16:L,int32:t,uint32:x,int64:o,uint64:p,float32:v,float64:q,writeFloat32:V,writeFloat64:Z,boolean:P,string:mM,number:R});function W(M,A,O){for(var S="",z=0,Q=A,X=A+O;Q<X;Q++){var c=M[Q];0!==(128&c)?192!==(224&c)?224!==(240&c)?240!==(248&c)?console.error("Invalid byte "+c.toString(16)):(z=(7&c)<<18|(63&M[++Q])<<12|(63&M[++Q])<<6|63&M[++Q])>=65536?(z-=65536,S+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):S+=String.fromCharCode(z):S+=String.fromCharCode((15&c)<<12|(63&M[++Q])<<6|63&M[++Q]):S+=String.fromCharCode((31&c)<<6|63&M[++Q]):S+=String.fromCharCode(c)}return S}function l(M,A){return MM(M,A)<<24>>24}function MM(M,A){return M[A.offset++]}function AM(M,A){return OM(M,A)<<16>>16}function OM(M,A){return M[A.offset++]|M[A.offset++]<<8}function SM(M,A){return M[A.offset++]|M[A.offset++]<<8|M[A.offset++]<<16|M[A.offset++]<<24}function zM(M,A){return SM(M,A)>>>0}function QM(M,A){return TM(M,A)}function XM(M,A){return JM(M,A)}function cM(M,A){var O=zM(M,A);return SM(M,A)*Math.pow(2,32)+O}function jM(M,A){var O=zM(M,A);return zM(M,A)*Math.pow(2,32)+O}var BM=new Int32Array(2),gM=new Float32Array(BM.buffer),eM=new Float64Array(BM.buffer);function TM(M,A){return BM[0]=SM(M,A),gM[0]}function JM(M,A){return BM[0]=SM(M,A),BM[1]=SM(M,A),eM[0]}function KM(M,A){return MM(M,A)>0}function GM(M,A){var O,S=M[A.offset++];S<192?O=31&S:217===S?O=MM(M,A):218===S?O=OM(M,A):219===S&&(O=zM(M,A));var z=W(M,A.offset,O);return A.offset+=O,z}function dM(M,A){var O=M[A.offset];return O<192&&O>160||217===O||218===O||219===O}function wM(M,A){var O=M[A.offset++];return O<128?O:202===O?TM(M,A):203===O?JM(M,A):204===O?MM(M,A):205===O?OM(M,A):206===O?zM(M,A):207===O?jM(M,A):208===O?l(M,A):209===O?AM(M,A):210===O?SM(M,A):211===O?cM(M,A):O>223?-1*(255-O+1):void 0}function IM(M,A){var O=M[A.offset];return O<128||O>=202&&O<=211}function bM(M,A){return M[A.offset]<160}function sM(M,A){return M[A.offset-1]===X&&(M[A.offset]<128||M[A.offset]>=202&&M[A.offset]<=211)}var YM=Object.freeze({__proto__:null,int8:l,uint8:MM,int16:AM,uint16:OM,int32:SM,uint32:zM,float32:QM,float64:XM,int64:cM,uint64:jM,readFloat32:TM,readFloat64:JM,boolean:KM,string:GM,stringCheck:dM,number:wM,numberCheck:IM,arrayCheck:bM,switchStructureCheck:sM}),EM=function(){function A(M){var A=this;this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return A.add(M)}))}return A.prototype.bj=function(A,O){return void 0===O&&(O=!0),B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,A,O?this.$items:void 0)},A.prototype.mz=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,A)},A.is=function(M){return void 0!==M.collection},A.prototype.add=function(M){var A=this.$refId++;return void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,A),this.$changes.indexes[A]=A,this.$indexes.set(A,A),this.$items.set(A,M),this.$changes.change(A),A},A.prototype.at=function(M){var A=Array.from(this.$items.keys())[M];return this.$items.get(A)},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(M){for(var A,O,S=this.$items.entries();(O=S.next())&&!O.done;)if(M===O.value[1]){A=O.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&g.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(M){return Array.from(this.$items.values()).some((function(A){return A===M}))},A.prototype.forEach=function(M){var A=this;this.$items.forEach((function(O,S,z){return M(O,S,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(M,A){this.$indexes.set(M,A)},A.prototype.getIndex=function(M){return this.$indexes.get(M)},A.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},A.prototype.deleteByIndex=function(M){var A=this.$indexes.get(M);this.$items.delete(A),this.$indexes.delete(M)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var M=[];return this.forEach((function(A,O){M.push("function"===typeof A.toJSON?A.toJSON():A)})),M},A.prototype.clone=function(M){var O;return M?O=Object.assign(new A,this):(O=new A,this.forEach((function(M){M.$changes?O.add(M.clone()):O.add(M)}))),O},A}(),HM=function(){function A(M){var A=this;this.$changes=new j(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,M&&M.forEach((function(M){return A.add(M)}))}return A.prototype.bj=function(A,O){return void 0===O&&(O=!0),B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.ADD,A,O?this.$items:void 0)},A.prototype.mz=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,A)},A.prototype.onChange=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,A)},A.is=function(M){return void 0!==M.set},A.prototype.add=function(A){var O,S;if(this.has(A))return!1;var z=this.$refId++;void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,z);var Q=null!==(S=null===(O=this.$changes.indexes[z])||void 0===O?void 0:O.op)&&void 0!==S?S:M.OPERATION.ADD;return this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,A),this.$changes.change(z,Q),z},A.prototype.entries=function(){return this.$items.entries()},A.prototype.delete=function(M){for(var A,O,S=this.$items.entries();(O=S.next())&&!O.done;)if(M===O.value[1]){A=O.value[0];break}return void 0!==A&&(this.$changes.delete(A),this.$indexes.delete(A),this.$items.delete(A))},A.prototype.clear=function(A){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),A&&g.call(this,A),this.$items.clear(),this.$changes.operation({index:0,op:M.OPERATION.CLEAR}),this.$changes.touchParents()},A.prototype.has=function(M){for(var A,O=this.$items.values(),S=!1;(A=O.next())&&!A.done;)if(M===A.value){S=!0;break}return S},A.prototype.forEach=function(M){var A=this;this.$items.forEach((function(O,S,z){return M(O,S,A)}))},A.prototype.values=function(){return this.$items.values()},Object.defineProperty(A.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),A.prototype.setIndex=function(M,A){this.$indexes.set(M,A)},A.prototype.getIndex=function(M){return this.$indexes.get(M)},A.prototype.getByIndex=function(M){return this.$items.get(this.$indexes.get(M))},A.prototype.deleteByIndex=function(M){var A=this.$indexes.get(M);this.$items.delete(A),this.$indexes.delete(M)},A.prototype.toArray=function(){return Array.from(this.$items.values())},A.prototype.toJSON=function(){var M=[];return this.forEach((function(A,O){M.push("function"===typeof A.toJSON?A.toJSON():A)})),M},A.prototype.clone=function(M){var O;return M?O=Object.assign(new A,this):(O=new A,this.forEach((function(M){M.$changes?O.add(M.clone()):O.add(M)}))),O},A}(),CM=function(){function M(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return M.prototype.addRefId=function(M){this.refIds.has(M)||(this.refIds.add(M),this.containerIndexes.set(M,new Set))},M.get=function(A){return void 0===A.$filterState&&(A.$filterState=new M),A.$filterState},M}(),fM=function(){function M(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return M.prototype.getNextUniqueId=function(){return this.nextUniqueId++},M.prototype.addRef=function(M,A,O){void 0===O&&(O=!0),this.refs.set(M,A),O&&(this.refCounts[M]=(this.refCounts[M]||0)+1)},M.prototype.removeRef=function(M){this.refCounts[M]=this.refCounts[M]-1,this.deletedRefs.add(M)},M.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},M.prototype.garbageCollectDeletedRefs=function(){var M=this;this.deletedRefs.forEach((function(A){if(!(M.refCounts[A]>0)){var O=M.refs.get(A);if(O instanceof uM)for(var S in O._definition.schema)"string"!==typeof O._definition.schema[S]&&O[S]&&O[S].$changes&&M.removeRef(O[S].$changes.refId);else{var z=O.$changes.parent._definition,Q=z.schema[z.fieldsByIndex[O.$changes.parentIndex]];"function"===typeof Object.values(Q)[0]&&Array.from(O.values()).forEach((function(A){return M.removeRef(A.$changes.refId)}))}M.refs.delete(A),delete M.refCounts[A]}})),this.deletedRefs.clear()},M}(),DM=function(M){function A(){return null!==M&&M.apply(this,arguments)||this}return O(A,M),A}(Error);function FM(M,A,O,S){var z,Q=!1;switch(A){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":z="number",isNaN(M)&&console.log('trying to encode "NaN" in '.concat(O.constructor.name,"#").concat(S));break;case"string":z="string",Q=!0;break;case"boolean":return}if(typeof M!==z&&(!Q||Q&&null!==M)){var X="'".concat(JSON.stringify(M),"'").concat(M&&M.constructor&&" (".concat(M.constructor.name,")")||"");throw new DM("a '".concat(z,"' was expected, but ").concat(X," was provided in ").concat(O.constructor.name,"#").concat(S))}}function NM(M,A,O,S){if(!(M instanceof A))throw new DM("a '".concat(A.name,"' was expected, but '").concat(M.constructor.name,"' was provided in ").concat(O.constructor.name,"#").concat(S))}function yM(M,A,O,S,z){FM(O,M,S,z);var Q=k[M];if(!Q)throw new DM("a '".concat(M,"' was expected, but ").concat(O," was provided in ").concat(S.constructor.name,"#").concat(z));Q(A,O)}function hM(M,A,O){return YM[M](A,O)}var uM=function(){function A(){for(var M=[],A=0;A<arguments.length;A++)M[A]=arguments[A];Object.defineProperties(this,{$changes:{value:new j(this,void 0,new fM),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var O=this._definition.descriptors;O&&Object.defineProperties(this,O),M[0]&&this.assign(M[0])}return A.onError=function(M){console.error(M)},A.is=function(M){return M._definition&&void 0!==M._definition.schema},A.prototype.onChange=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.REPLACE,A)},A.prototype.mz=function(A){return B(this.$callbacks||(this.$callbacks=[]),M.OPERATION.DELETE,A)},A.prototype.assign=function(M){return Object.assign(this,M),this},Object.defineProperty(A.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),A.prototype.setDirty=function(M,A){this.$changes.change(M,A)},A.prototype.listen=function(M,A,O){var S=this;return void 0===O&&(O=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[M]||(this.$callbacks[M]=[]),this.$callbacks[M].push(A),O&&void 0!==this[M]&&A(this[M],void 0),function(){return e(S.$callbacks[M],S.$callbacks[M].indexOf(A))}},A.prototype.decode=function(O,S,z){var Q;void 0===S&&(S={offset:0}),void 0===z&&(z=this);var c=[],j=this.$changes.root,B=O.length,g=0;for(j.refs.set(g,this);S.offset<B;){var e=O[S.offset++];if(e!=X){var T=z.$changes,J=void 0!==z._definition,G=J?e>>6<<6:e;if(G!==M.OPERATION.CLEAR){var w=J?e%(G||255):wM(O,S),I=J?z._definition.fieldsByIndex[w]:"",s=T.getType(w),Y=void 0,E=void 0,H=void 0;if(J?E=z["_".concat(I)]:(E=z.getByIndex(w),(G&M.OPERATION.ADD)===M.OPERATION.ADD?(H=z instanceof d?GM(O,S):w,z.setIndex(w,H)):H=z.getIndex(w)),(G&M.OPERATION.DELETE)===M.OPERATION.DELETE&&(G!==M.OPERATION.DELETE_AND_ADD&&z.deleteByIndex(w),E&&E.$changes&&j.removeRef(E.$changes.refId),Y=null),void 0!==I){if(G===M.OPERATION.DELETE);else if(A.is(s)){var C=wM(O,S);if(Y=j.refs.get(C),G!==M.OPERATION.REPLACE){var f=this.getSchemaType(O,S,s);Y||((Y=this.createTypeInstance(f)).$changes.refId=C,E&&(Y.$callbacks=E.$callbacks,E.$changes.refId&&C!==E.$changes.refId&&j.removeRef(E.$changes.refId))),j.addRef(C,Y,Y!==E)}}else if("string"===typeof s)Y=hM(s,O,S);else{var D=b(Object.keys(s)[0]),F=wM(O,S),N=j.refs.has(F)?E||j.refs.get(F):new D.constructor;if((Y=N.clone(!0)).$changes.refId=F,E&&(Y.$callbacks=E.$callbacks,E.$changes.refId&&F!==E.$changes.refId)){j.removeRef(E.$changes.refId);for(var y=E.entries(),h=void 0;(h=y.next())&&!h.done;){var u=(Q=h.value)[0],i=Q[1];c.push({refId:F,op:M.OPERATION.DELETE,field:u,value:void 0,previousValue:i})}}j.addRef(F,Y,N!==E)}if(null!==Y&&void 0!==Y)if(Y.$changes&&Y.$changes.setParent(T.ref,T.root,w),z instanceof A)z[I]=Y;else if(z instanceof d)u=H,z.$items.set(u,Y),z.$changes.allChanges.add(w);else if(z instanceof K)z.setAt(w,Y);else if(z instanceof EM){var U=z.add(Y);z.setIndex(w,U)}else z instanceof HM&&!1!==(U=z.add(Y))&&z.setIndex(w,U);E!==Y&&c.push({refId:g,op:G,field:I,dynamicIndex:H,value:Y,previousValue:E})}else{console.warn("@colyseus/schema: definition mismatch");for(var L={offset:S.offset};S.offset<B&&(!sM(O,S)||(L.offset=S.offset+1,!j.refs.has(wM(O,L))));)S.offset++}}else z.clear(c)}else{g=wM(O,S);var t=j.refs.get(g);if(!t)throw new Error('"refId" not found: '.concat(g));z=t}}return this._triggerChanges(c),j.garbageCollectDeletedRefs(),c},A.prototype.encode=function(O,S,z){void 0===O&&(O=!1),void 0===S&&(S=[]),void 0===z&&(z=!1);for(var Q=this.$changes,c=new WeakSet,j=[Q],B=1,g=0;g<B;g++){var e=j[g],T=e.ref,J=T instanceof A;e.ensureRefId(),c.add(e),e!==Q&&(e.changed||O)&&(i(S,X),R(S,e.refId));for(var K=O?Array.from(e.allChanges):Array.from(e.changes.values()),G=0,w=K.length;G<w;G++){var I=O?{op:M.OPERATION.ADD,index:K[G]}:K[G],s=I.index,Y=J?T._definition.fieldsByIndex&&T._definition.fieldsByIndex[s]:s,E=S.length;if(I.op!==M.OPERATION.TOUCH)if(J)i(S,s|I.op);else{if(i(S,I.op),I.op===M.OPERATION.CLEAR)continue;R(S,s)}if(J||(I.op&M.OPERATION.ADD)!=M.OPERATION.ADD||T instanceof d&&mM(S,e.ref.$indexes.get(s)),I.op!==M.OPERATION.DELETE){var H=e.getType(s),C=e.getValue(s);if(C&&C.$changes&&!c.has(C.$changes)&&(j.push(C.$changes),C.$changes.ensureRefId(),B++),I.op!==M.OPERATION.TOUCH){if(A.is(H))NM(C,H,T,Y),R(S,C.$changes.refId),(I.op&M.OPERATION.ADD)===M.OPERATION.ADD&&this.tryEncodeTypeId(S,H,C.constructor);else if("string"===typeof H)yM(H,S,C,T,Y);else{var f=b(Object.keys(H)[0]);NM(T["_".concat(Y)],f.constructor,T,Y),R(S,C.$changes.refId)}z&&e.cache(s,S.slice(E))}}}O||z||e.discard()}return S},A.prototype.encodeAll=function(M){return this.encode(!0,[],M)},A.prototype.applyFilters=function(O,S){var z,Q;void 0===S&&(S=!1);for(var c=this,j=new Set,B=CM.get(O),g=[this.$changes],e=1,T=[],J=function(J){var K=g[J];if(j.has(K.refId))return"continue";var G=K.ref,w=G instanceof A;i(T,X),R(T,K.refId);var I=B.refIds.has(K),b=S||!I;B.addRefId(K);var s=B.containerIndexes.get(K),Y=b?Array.from(K.allChanges):Array.from(K.changes.values());!S&&w&&G._definition.indexesWithFilters&&G._definition.indexesWithFilters.forEach((function(A){!s.has(A)&&K.allChanges.has(A)&&(b?Y.push(A):Y.push({op:M.OPERATION.ADD,index:A}))}));for(var E=0,H=Y.length;E<H;E++){var C=b?{op:M.OPERATION.ADD,index:Y[E]}:Y[E];if(C.op!==M.OPERATION.CLEAR){var f=C.index;if(C.op!==M.OPERATION.DELETE){var D=K.getValue(f),F=K.getType(f);if(w){if((N=G._definition.filters&&G._definition.filters[f])&&!N.call(G,O,D,c)){D&&D.$changes&&j.add(D.$changes.refId);continue}}else{var N,y=K.parent;if((N=K.getChildrenFilter())&&!N.call(y,O,G.$indexes.get(f),D,c)){D&&D.$changes&&j.add(D.$changes.refId);continue}}if(D.$changes&&(g.push(D.$changes),e++),C.op!==M.OPERATION.TOUCH)if(C.op===M.OPERATION.ADD||w)T.push.apply(T,null!==(z=K.caches[f])&&void 0!==z?z:[]),s.add(f);else if(s.has(f))T.push.apply(T,null!==(Q=K.caches[f])&&void 0!==Q?Q:[]);else{if(s.add(f),i(T,M.OPERATION.ADD),R(T,f),G instanceof d){var h=K.ref.$indexes.get(f);mM(T,h)}D.$changes?R(T,D.$changes.refId):k[F](T,D)}else D.$changes&&!w&&(i(T,M.OPERATION.ADD),R(T,f),G instanceof d&&(h=K.ref.$indexes.get(f),mM(T,h)),R(T,D.$changes.refId))}else w?i(T,C.op|f):(i(T,C.op),R(T,f))}else i(T,C.op)}},K=0;K<e;K++)J(K);return T},A.prototype.clone=function(){var M,A=new this.constructor,O=this._definition.schema;for(var S in O)"object"===typeof this[S]&&"function"===typeof(null===(M=this[S])||void 0===M?void 0:M.clone)?A[S]=this[S].clone():A[S]=this[S];return A},A.prototype.toJSON=function(){var M=this._definition.schema,A=this._definition.deprecated,O={};for(var S in M)A[S]||null===this[S]||"undefined"===typeof this[S]||(O[S]="function"===typeof this[S].toJSON?this[S].toJSON():this["_".concat(S)]);return O},A.prototype.discardAllChanges=function(){this.$changes.discardAll()},A.prototype.getByIndex=function(M){return this[this._definition.fieldsByIndex[M]]},A.prototype.deleteByIndex=function(M){this[this._definition.fieldsByIndex[M]]=void 0},A.prototype.tryEncodeTypeId=function(M,A,O){A._typeid!==O._typeid&&(i(M,c),R(M,O._typeid))},A.prototype.getSchemaType=function(M,A,O){var S;return M[A.offset]===c&&(A.offset++,S=this.constructor._context.get(wM(M,A))),S||O},A.prototype.createTypeInstance=function(M){var A=new M;return A.$changes.root=this.$changes.root,A},A.prototype._triggerChanges=function(O){for(var S,z,Q,X,c,j,B,g,e,T=new Set,J=this.$changes.root.refs,K=function(K){var G=O[K],d=G.refId,w=J.get(d),I=w.$callbacks;if((G.op&M.OPERATION.DELETE)===M.OPERATION.DELETE&&G.previousValue instanceof A&&(null===(z=null===(S=G.previousValue.$callbacks)||void 0===S?void 0:S[M.OPERATION.DELETE])||void 0===z||z.forEach((function(M){return M()}))),!I)return"continue";if(w instanceof A){if(!T.has(d))try{null===(Q=null===I||void 0===I?void 0:I[M.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(M){return M()}))}catch(b){A.onError(b)}try{I.hasOwnProperty(G.field)&&(null===(X=I[G.field])||void 0===X||X.forEach((function(M){return M(G.value,G.previousValue)})))}catch(b){A.onError(b)}}else G.op===M.OPERATION.ADD&&void 0===G.previousValue?null===(c=I[M.OPERATION.ADD])||void 0===c||c.forEach((function(M){var A;return M(G.value,null!==(A=G.dynamicIndex)&&void 0!==A?A:G.field)})):G.op===M.OPERATION.DELETE?void 0!==G.previousValue&&(null===(j=I[M.OPERATION.DELETE])||void 0===j||j.forEach((function(M){var A;return M(G.previousValue,null!==(A=G.dynamicIndex)&&void 0!==A?A:G.field)}))):G.op===M.OPERATION.DELETE_AND_ADD&&(void 0!==G.previousValue&&(null===(B=I[M.OPERATION.DELETE])||void 0===B||B.forEach((function(M){var A;return M(G.previousValue,null!==(A=G.dynamicIndex)&&void 0!==A?A:G.field)}))),null===(g=I[M.OPERATION.ADD])||void 0===g||g.forEach((function(M){var A;return M(G.value,null!==(A=G.dynamicIndex)&&void 0!==A?A:G.field)}))),G.value!==G.previousValue&&(null===(e=I[M.OPERATION.REPLACE])||void 0===e||e.forEach((function(M){var A;return M(G.value,null!==(A=G.dynamicIndex)&&void 0!==A?A:G.field)})));T.add(d)},G=0;G<O.length;G++)K(G)},A._definition=s.create(),A}();function iM(M){for(var A=[M.$changes],O=1,S={},z=S,Q=function(M){var O=A[M];O.changes.forEach((function(M){var A=O.ref,S=M.index,Q=A._definition?A._definition.fieldsByIndex[S]:A.$indexes.get(S);z[Q]=O.getValue(S)}))},X=0;X<O;X++)Q(X);return S}var UM={context:new E},LM=function(M){function A(){return null!==M&&M.apply(this,arguments)||this}return O(A,M),S([C("string",UM)],A.prototype,"name",void 0),S([C("string",UM)],A.prototype,"type",void 0),S([C("number",UM)],A.prototype,"referencedType",void 0),A}(uM),tM=function(M){function A(){var A=null!==M&&M.apply(this,arguments)||this;return A.fields=new K,A}return O(A,M),S([C("number",UM)],A.prototype,"id",void 0),S([C([LM],UM)],A.prototype,"fields",void 0),A}(uM),xM=function(M){function A(){var A=null!==M&&M.apply(this,arguments)||this;return A.types=new K,A}return O(A,M),A.encode=function(M){var O=M.constructor,S=new A;S.rootType=O._typeid;var z=function(M,A){for(var O in A){var z=new LM;z.name=O;var Q=void 0;if("string"===typeof A[O])Q=A[O];else{var X=A[O],c=void 0;uM.is(X)?(Q="ref",c=A[O]):"string"===typeof X[Q=Object.keys(X)[0]]?Q+=":"+X[Q]:c=X[Q],z.referencedType=c?c._typeid:-1}z.type=Q,M.fields.push(z)}S.types.push(M)},Q=O._context.types;for(var X in Q){var c=new tM;c.id=Number(X),z(c,Q[X]._definition.schema)}return S.encodeAll()},A.decode=function(M,S){var z=new E,Q=new A;Q.decode(M,S);var X=Q.types.reduce((function(M,A){var S=function(M){function A(){return null!==M&&M.apply(this,arguments)||this}return O(A,M),A}(uM),Q=A.id;return M[Q]=S,z.add(S,Q),M}),{});Q.types.forEach((function(M){var A=X[M.id];M.fields.forEach((function(M){var O;if(void 0!==M.referencedType){var S=M.type,Q=X[M.referencedType];if(!Q){var c=M.type.split(":");S=c[0],Q=c[1]}"ref"===S?C(Q,{context:z})(A.prototype,M.name):C(((O={})[S]=Q,O),{context:z})(A.prototype,M.name)}else C(M.type,{context:z})(A.prototype,M.name)}))}));var c=X[Q.rootType],j=new c;for(var B in c._definition.schema){var g=c._definition.schema[B];"string"!==typeof g&&(j[B]="function"===typeof g?new g:new(b(Object.keys(g)[0]).constructor))}return j},S([C([tM],UM)],A.prototype,"types",void 0),S([C("number",UM)],A.prototype,"rootType",void 0),A}(uM);I("map",{constructor:d}),I("array",{constructor:K}),I("set",{constructor:HM}),I("collection",{constructor:EM}),M.ArraySchema=K,M.CollectionSchema=EM,M.Context=E,M.MapSchema=d,M.Reflection=xM,M.ReflectionField=LM,M.ReflectionType=tM,M.Schema=uM,M.SchemaDefinition=s,M.SetSchema=HM,M.decode=YM,M.defineTypes=N,M.deprecated=F,M.dumpChanges=iM,M.encode=k,M.filter=f,M.filterChildren=D,M.hasFilter=Y,M.registerType=I,M.type=C,Object.defineProperty(M,"__esModule",{value:!0})}(A)},14474:M=>{M.exports=function(M){return null!=M&&null!=M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}},14457:(M,A,O)=>{"use strict";var S=O(14460),z=O(14465),Q=O(14474);O.g.__TYPEDARRAY_POOL||(O.g.__TYPEDARRAY_POOL={UINT8:z([32,0]),UINT16:z([32,0]),UINT32:z([32,0]),INT8:z([32,0]),INT16:z([32,0]),INT32:z([32,0]),FLOAT:z([32,0]),DOUBLE:z([32,0]),DATA:z([32,0]),UINT8C:z([32,0]),BUFFER:z([32,0])});var X="undefined"!==typeof Uint8ClampedArray,c=O.g.__TYPEDARRAY_POOL;c.UINT8C||(c.UINT8C=z([32,0])),c.BUFFER||(c.BUFFER=z([32,0]));var j=c.DATA,B=c.BUFFER;function g(M){if(M){var A=M.length||M.byteLength,O=S.log2(A);j[O].push(M)}}function e(M){M=S.nextPow2(M);var A=S.log2(M),O=j[A];return O.length>0?O.pop():new ArrayBuffer(M)}function T(M){return new Uint8Array(e(M),0,M)}function J(M){return new Uint16Array(e(2*M),0,M)}function K(M){return new Uint32Array(e(4*M),0,M)}function G(M){return new Int8Array(e(M),0,M)}function d(M){return new Int16Array(e(2*M),0,M)}function w(M){return new Int32Array(e(4*M),0,M)}function I(M){return new Float32Array(e(4*M),0,M)}function b(M){return new Float64Array(e(8*M),0,M)}function s(M){return X?new Uint8ClampedArray(e(M),0,M):T(M)}function Y(M){return new DataView(e(M),0,M)}A.free=function(M){if(Q(M))B[S.log2(M.length)].push(M);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(M)&&(M=M.buffer),!M)return;var A=M.length||M.byteLength,O=0|S.log2(A);j[O].push(M)}},A.freeUint8=A.freeUint16=A.freeUint32=A.freeInt8=A.freeInt16=A.freeInt32=A.freeFloat32=A.freeFloat=A.freeFloat64=A.freeDouble=A.freeUint8Clamped=A.freeDataView=function(M){g(M.buffer)},A.freeArrayBuffer=g,A.freeBuffer=function(M){B[S.log2(M.length)].push(M)},A.malloc=function(M,A){if(void 0===A||"arraybuffer"===A)return e(M);switch(A){case"uint8":return T(M);case"uint16":return J(M);case"uint32":return K(M);case"int8":return G(M);case"int16":return d(M);case"int32":return w(M);case"float":case"float32":return I(M);case"double":case"float64":return b(M);case"uint8_clamped":return s(M);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Y(M);default:return null}return null},A.mallocArrayBuffer=e,A.mallocUint8=T,A.mallocUint16=J,A.mallocUint32=K,A.mallocInt8=G,A.mallocInt16=d,A.mallocInt32=w,A.mallocFloat32=A.mallocFloat=I,A.mallocFloat64=A.mallocDouble=b,A.mallocUint8Clamped=s,A.mallocDataView=Y,A.clearCache=function(){for(var M=0;M<32;++M)c.UINT8[M].length=0,c.UINT16[M].length=0,c.UINT32[M].length=0,c.INT8[M].length=0,c.INT16[M].length=0,c.INT32[M].length=0,c.FLOAT[M].length=0,c.DOUBLE[M].length=0,c.UINT8C[M].length=0,j[M].length=0,B[M].length=0}},14544:(M,A,O)=>{M.exports=z;var S=O(166);function z(M,A){if(!(this instanceof z))return new z(M,A);var O=S.create();S.add(O,M,A),this.base=S.min(S.create(),M,O),this.Pg=S.clone(A),this.max=S.max(S.create(),M,O),this.mag=S.length(this.Pg)}var Q=z.prototype;Q.width=function(){return this.Pg[0]},Q.height=function(){return this.Pg[1]},Q.depth=function(){return this.Pg[2]},Q.x0=function(){return this.base[0]},Q.y0=function(){return this.base[1]},Q.z0=function(){return this.base[2]},Q.x1=function(){return this.max[0]},Q.y1=function(){return this.max[1]},Q.z1=function(){return this.max[2]},Q.translate=function(M){return S.add(this.max,this.max,M),S.add(this.base,this.base,M),this},Q.setPosition=function(M){return S.add(this.max,M,this.Pg),S.k(this.base,M),this},Q.expand=function(M){var A=S.create(),O=S.create();return S.max(A,M.max,this.max),S.min(O,M.base,this.base),S.dA(A,A,O),new z(O,A)},Q.intersects=function(M){return!(M.base[0]>this.max[0])&&(!(M.base[1]>this.max[1])&&(!(M.base[2]>this.max[2])&&(!(M.max[0]<this.base[0])&&(!(M.max[1]<this.base[1])&&!(M.max[2]<this.base[2])))))},Q.touches=function(M){var A=this.union(M);return null!==A&&(0==A.width()||0==A.height()||0==A.depth())},Q.union=function(M){if(!this.intersects(M))return null;var A=Math.max(M.base[0],this.base[0]),O=Math.max(M.base[1],this.base[1]),S=Math.max(M.base[2],this.base[2]);return new z([A,O,S],[Math.min(M.max[0],this.max[0])-A,Math.min(M.max[1],this.max[1])-O,Math.min(M.max[2],this.max[2])-S])}},14460:(M,A)=>{"use strict";function O(M){var A=32;return(M&=-M)&&A--,65535&M&&(A-=16),16711935&M&&(A-=8),252645135&M&&(A-=4),858993459&M&&(A-=2),1431655765&M&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(M){return(M>0)-(M<0)},A.abs=function(M){var A=M>>31;return(M^A)-A},A.min=function(M,A){return A^(M^A)&-(M<A)},A.max=function(M,A){return M^(M^A)&-(M<A)},A.isPow2=function(M){return!(M&M-1)&&!!M},A.log2=function(M){var A,O;return A=(M>65535)<<4,A|=O=((M>>>=A)>255)<<3,A|=O=((M>>>=O)>15)<<2,(A|=O=((M>>>=O)>3)<<1)|(M>>>=O)>>1},A.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},A.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},A.countTrailingZeros=O,A.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},A.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},A.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var S=new Array(256);!function(M){for(var A=0;A<256;++A){var O=A,S=A,z=7;for(O>>>=1;O;O>>>=1)S<<=1,S|=1&O,--z;M[A]=S<<z&255}}(S),A.reverse=function(M){return S[255&M]<<24|S[M>>>8&255]<<16|S[M>>>16&255]<<8|S[M>>>24&255]},A.interleave2=function(M,A){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(M,A){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>A&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},A.interleave3=function(M,A,O){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<2},A.deinterleave3=function(M,A){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>A&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},A.nextCombination=function(M){var A=M|M-1;return A+1|(~A&-~A)-1>>>O(M)+1}},14454:(M,A,O)=>{"use strict";M.exports=function(M,A,O){switch(arguments.length){case 1:return S=[],B(z=M,z,g,!0),S;case 2:return"function"===typeof A?B(M,M,A,!0):function(M,A){return S=[],B(M,A,g,!1),S}(M,A);case 3:return B(M,A,O,!1);default:throw new Error("box-intersect: Invalid arguments")}var z};var S,z=O(14457),Q=O(14477),X=O(14486);function c(M,A){for(var O=0;O<M;++O)if(!(A[O]<=A[O+M]))return!0;return!1}function j(M,A,O,S){for(var z=0,Q=0,X=0,j=M.length;X<j;++X){var B=M[X];if(!c(A,B)){for(var g=0;g<2*A;++g)O[z++]=B[g];S[Q++]=X}}return Q}function B(M,A,O,S){var c=M.length,B=A.length;if(!(c<=0||B<=0)){var g=M[0].length>>>1;if(!(g<=0)){var e,T=z.mallocDouble(2*g*c),J=z.mallocInt32(c);if((c=j(M,g,T,J))>0){if(1===g&&S)Q.init(c),e=Q.sweepComplete(g,O,0,c,T,J,0,c,T,J);else{var K=z.mallocDouble(2*g*B),G=z.mallocInt32(B);(B=j(A,g,K,G))>0&&(Q.init(c+B),e=1===g?Q.sweepBipartite(g,O,0,c,T,J,0,B,K,G):X(g,O,S,c,T,J,B,K,G),z.free(K),z.free(G))}z.free(T),z.free(J)}return e}}}function g(M,A){S.push([M,A])}},14492:(M,A)=>{"use strict";var O="d",S="ax",z="fp",Q="es",X="rs",c="re",j="rb",B="bs",g="be",e="bb",T=[O,S,"vv",X,c,j,"ri",B,g,e,"bi"];function J(M){var A="bruteForce"+(M?"Full":"Partial"),S=[],X=T.slice();M||X.splice(3,0,z);var c=["function "+A+"("+X.join()+"){"];function j(A,z){var X=function(M,A,S){var z="bruteForce"+(M?"Red":"Blue")+(A?"Flip":"")+(S?"Full":""),X=["function ",z,"(",T.join(),"){","var ",Q,"=2*",O,";"],c="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",j="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(S?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return M?X.push(c,"Q",":",j):X.push(j,"Q",":",c),S?X.push("if(y1<x0||x1<y0)continue;"):A?X.push("if(y0<=x0||x1<y0)continue;"):X.push("if(y0<x0||x1<y0)continue;"),X.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),A?X.push("yi,xi"):X.push("xi,yi"),X.push(");if(rv!==void 0)return rv;}}}"),{name:z,code:X.join("")}}(A,z,M);S.push(X.code),c.push("return "+X.name+"("+T.join()+");")}c.push("if(re-rs>be-bs){"),M?(j(!0,!1),c.push("}else{"),j(!1,!1)):(c.push("if(fp){"),j(!0,!0),c.push("}else{"),j(!0,!1),c.push("}}else{if(fp){"),j(!1,!0),c.push("}else{"),j(!1,!1),c.push("}")),c.push("}}return "+A);var B=S.join("")+c.join("");return new Function(B)()}A.partial=J(!1),A.full=J(!0)},14486:(M,A,O)=>{"use strict";M.exports=function(M,A,O,Q,g,F,N,y,h){!function(M,A){var O=8*z.log2(A+1)*(M+1)|0,Q=z.nextPow2(s*O);E.length<Q&&(S.free(E),E=S.mallocInt32(Q));var X=z.nextPow2(Y*O);H.length<X&&(S.free(H),H=S.mallocDouble(X))}(M,Q+N);var u,i=0,U=2*M;C(i++,0,0,Q,0,N,O?16:0,-1/0,1/0),O||C(i++,0,0,N,0,Q,1,-1/0,1/0);for(;i>0;){var L=(i-=1)*s,t=E[L],x=E[L+1],o=E[L+2],p=E[L+3],v=E[L+4],q=E[L+5],r=i*Y,n=H[r],a=H[r+1],V=1&q,Z=!!(16&q),P=g,mM=F,R=y,k=h;if(V&&(P=y,mM=h,R=g,k=F),!(2&q&&x>=(o=d(M,t,x,o,P,mM,a)))&&!(4&q&&(x=w(M,t,x,o,P,mM,n))>=o)){var W=o-x,l=v-p;if(Z){if(M*W*(W+l)<J){if(void 0!==(u=j.scanComplete(M,t,A,x,o,P,mM,p,v,R,k)))return u;continue}}else{if(M*Math.min(W,l)<e){if(void 0!==(u=X(M,t,A,V,x,o,P,mM,p,v,R,k)))return u;continue}if(M*W*l<T){if(void 0!==(u=j.scanBipartite(M,t,A,V,x,o,P,mM,p,v,R,k)))return u;continue}}var MM=K(M,t,x,o,P,mM,n,a);if(x<MM)if(M*(MM-x)<e){if(void 0!==(u=c(M,t+1,A,x,MM,P,mM,p,v,R,k)))return u}else if(t===M-2){if(void 0!==(u=V?j.sweepBipartite(M,A,p,v,R,k,x,MM,P,mM):j.sweepBipartite(M,A,x,MM,P,mM,p,v,R,k)))return u}else C(i++,t+1,x,MM,p,v,V,-1/0,1/0),C(i++,t+1,p,v,x,MM,1^V,-1/0,1/0);if(MM<o){var AM=B(M,t,p,v,R,k),OM=R[U*AM+t],SM=G(M,t,AM,v,R,k,OM);if(SM<v&&C(i++,t,MM,o,SM,v,(4|V)+(Z?16:0),OM,a),p<AM&&C(i++,t,MM,o,p,AM,(2|V)+(Z?16:0),n,OM),AM+1===SM){if(void 0!==(u=Z?D(M,t,A,MM,o,P,mM,AM,R,k[AM]):f(M,t,A,V,MM,o,P,mM,AM,R,k[AM])))return u}else if(AM<SM){var zM;if(Z){if(MM<(zM=I(M,t,MM,o,P,mM,OM))){var QM=G(M,t,MM,zM,P,mM,OM);if(t===M-2){if(MM<QM&&void 0!==(u=j.sweepComplete(M,A,MM,QM,P,mM,AM,SM,R,k)))return u;if(QM<zM&&void 0!==(u=j.sweepBipartite(M,A,QM,zM,P,mM,AM,SM,R,k)))return u}else MM<QM&&C(i++,t+1,MM,QM,AM,SM,16,-1/0,1/0),QM<zM&&(C(i++,t+1,QM,zM,AM,SM,0,-1/0,1/0),C(i++,t+1,AM,SM,QM,zM,1,-1/0,1/0))}}else MM<(zM=V?b(M,t,MM,o,P,mM,OM):I(M,t,MM,o,P,mM,OM))&&(t===M-2?u=V?j.sweepBipartite(M,A,AM,SM,R,k,MM,zM,P,mM):j.sweepBipartite(M,A,MM,zM,P,mM,AM,SM,R,k):(C(i++,t+1,MM,zM,AM,SM,V,-1/0,1/0),C(i++,t+1,AM,SM,MM,zM,1^V,-1/0,1/0)))}}}}};var S=O(14457),z=O(14460),Q=O(14492),X=Q.partial,c=Q.full,j=O(14477),B=O(14497),g=O(14501),e=128,T=1<<22,J=1<<22,K=g("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),G=g("lo===p0",["p0"]),d=g("lo<p0",["p0"]),w=g("hi<=p0",["p0"]),I=g("lo<=p0&&p0<=hi",["p0"]),b=g("lo<p0&&p0<=hi",["p0"]),s=6,Y=2,E=S.mallocInt32(1024),H=S.mallocDouble(1024);function C(M,A,O,S,z,Q,X,c,j){var B=s*M;E[B]=A,E[B+1]=O,E[B+2]=S,E[B+3]=z,E[B+4]=Q,E[B+5]=X;var g=Y*M;H[g]=c,H[g+1]=j}function f(M,A,O,S,z,Q,X,c,j,B,g){var e=2*M,T=j*e,J=B[T+A];M:for(var K=z,G=z*e;K<Q;++K,G+=e){var d=X[G+A],w=X[G+A+M];if(!(J<d||w<J)&&(!S||J!==d)){for(var I,b=c[K],s=A+1;s<M;++s){d=X[G+s],w=X[G+s+M];var Y=B[T+s],E=B[T+s+M];if(w<Y||E<d)continue M}if(void 0!==(I=S?O(g,b):O(b,g)))return I}}}function D(M,A,O,S,z,Q,X,c,j,B){var g=2*M,e=c*g,T=j[e+A];M:for(var J=S,K=S*g;J<z;++J,K+=g){var G=X[J];if(G!==B){var d=Q[K+A],w=Q[K+A+M];if(!(T<d||w<T)){for(var I=A+1;I<M;++I){d=Q[K+I],w=Q[K+I+M];var b=j[e+I],s=j[e+I+M];if(w<b||s<d)continue M}var Y=O(G,B);if(void 0!==Y)return Y}}}}},14497:(M,A,O)=>{"use strict";M.exports=function(M,A,O,X,c,j){if(X<=O+1)return O;var B=O,g=X,e=X+O>>>1,T=2*M,J=e,K=c[T*e+A];for(;B<g;){if(g-B<z){Q(M,A,B,g,c,j),K=c[T*e+A];break}var G=g-B,d=Math.random()*G+B|0,w=c[T*d+A],I=Math.random()*G+B|0,b=c[T*I+A],s=Math.random()*G+B|0,Y=c[T*s+A];w<=b?Y>=b?(J=I,K=b):w>=Y?(J=d,K=w):(J=s,K=Y):b>=Y?(J=I,K=b):Y>=w?(J=d,K=w):(J=s,K=Y);for(var E=T*(g-1),H=T*J,C=0;C<T;++C,++E,++H){var f=c[E];c[E]=c[H],c[H]=f}var D=j[g-1];j[g-1]=j[J],j[J]=D;for(E=T*(g-1),H=T*(J=S(M,A,B,g-1,c,j,K)),C=0;C<T;++C,++E,++H){f=c[E];c[E]=c[H],c[H]=f}D=j[g-1];if(j[g-1]=j[J],j[J]=D,e<J){for(g=J-1;B<g&&c[T*(g-1)+A]===K;)g-=1;g+=1}else{if(!(J<e))break;for(B=J+1;B<g&&c[T*B+A]===K;)B+=1}}return S(M,A,O,e,c,j,c[T*e+A])};var S=O(14501)("lo<p0",["p0"]),z=8;function Q(M,A,O,S,z,Q){for(var X=2*M,c=X*(O+1)+A,j=O+1;j<S;++j,c+=X)for(var B=z[c],g=j,e=X*(j-1);g>O&&z[e+A]>B;--g,e-=X){for(var T=e,J=e+X,K=0;K<X;++K,++T,++J){var G=z[T];z[T]=z[J],z[J]=G}var d=Q[g];Q[g]=Q[g-1],Q[g-1]=d}}},14501:M=>{"use strict";M.exports=function(M,O){var S="abcdef".split("").concat(O),z=[];M.indexOf("lo")>=0&&z.push("lo=e[k+n]");M.indexOf("hi")>=0&&z.push("hi=e[k+o]");return S.push(A.replace("_",z.join()).replace("$",M)),Function.apply(void 0,S)};var A="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14480:M=>{"use strict";M.exports=function(M,S){S<=4*A?O(0,S-1,M):B(0,S-1,M)};var A=32;function O(M,A,O){for(var S=2*(M+1),z=M+1;z<=A;++z){for(var Q=O[S++],X=O[S++],c=z,j=S-2;c-- >M;){var B=O[j-2],g=O[j-1];if(B<Q)break;if(B===Q&&g<X)break;O[j]=B,O[j+1]=g,j-=2}O[j]=Q,O[j+1]=X}}function S(M,A,O){A*=2;var S=O[M*=2],z=O[M+1];O[M]=O[A],O[M+1]=O[A+1],O[A]=S,O[A+1]=z}function z(M,A,O){A*=2,O[M*=2]=O[A],O[M+1]=O[A+1]}function Q(M,A,O,S){A*=2,O*=2;var z=S[M*=2],Q=S[M+1];S[M]=S[A],S[M+1]=S[A+1],S[A]=S[O],S[A+1]=S[O+1],S[O]=z,S[O+1]=Q}function X(M,A,O,S,z){A*=2,z[M*=2]=z[A],z[A]=O,z[M+1]=z[A+1],z[A+1]=S}function c(M,A,O){A*=2;var S=O[M*=2],z=O[A];return!(S<z)&&(S!==z||O[M+1]>O[A+1])}function j(M,A,O,S){var z=S[M*=2];return z<A||z===A&&S[M+1]<O}function B(M,g,e){var T=(g-M+1)/6|0,J=M+T,K=g-T,G=M+g>>1,d=G-T,w=G+T,I=J,b=d,s=G,Y=w,E=K,H=M+1,C=g-1,f=0;c(I,b,e)&&(f=I,I=b,b=f),c(Y,E,e)&&(f=Y,Y=E,E=f),c(I,s,e)&&(f=I,I=s,s=f),c(b,s,e)&&(f=b,b=s,s=f),c(I,Y,e)&&(f=I,I=Y,Y=f),c(s,Y,e)&&(f=s,s=Y,Y=f),c(b,E,e)&&(f=b,b=E,E=f),c(b,s,e)&&(f=b,b=s,s=f),c(Y,E,e)&&(f=Y,Y=E,E=f);for(var D=e[2*b],F=e[2*b+1],N=e[2*Y],y=e[2*Y+1],h=2*I,u=2*s,i=2*E,U=2*J,L=2*G,t=2*K,x=0;x<2;++x){var o=e[h+x],p=e[u+x],v=e[i+x];e[U+x]=o,e[L+x]=p,e[t+x]=v}z(d,M,e),z(w,g,e);for(var q=H;q<=C;++q)if(j(q,D,F,e))q!==H&&S(q,H,e),++H;else if(!j(q,N,y,e))for(;;){if(j(C,N,y,e)){j(C,D,F,e)?(Q(q,H,C,e),++H,--C):(S(q,C,e),--C);break}if(--C<q)break}X(M,H-1,D,F,e),X(g,C+1,N,y,e),H-2-M<=A?O(M,H-2,e):B(M,H-2,e),g-(C+2)<=A?O(C+2,g,e):B(C+2,g,e),C-H<=A?O(H,C,e):B(H,C,e)}},14477:(M,A,O)=>{"use strict";M.exports={init:function(M){var A=z.nextPow2(M);j.length<A&&(S.free(j),j=S.mallocInt32(A));B.length<A&&(S.free(B),B=S.mallocInt32(A));g.length<A&&(S.free(g),g=S.mallocInt32(A));e.length<A&&(S.free(e),e=S.mallocInt32(A));T.length<A&&(S.free(T),T=S.mallocInt32(A));J.length<A&&(S.free(J),J=S.mallocInt32(A));var O=8*A;K.length<O&&(S.free(K),K=S.mallocDouble(O))},sweepBipartite:function(M,A,O,S,z,c,T,J,w,I){for(var b=0,s=2*M,Y=M-1,E=s-1,H=O;H<S;++H){var C=c[H],f=s*H;K[b++]=z[f+Y],K[b++]=-(C+1),K[b++]=z[f+E],K[b++]=C}for(H=T;H<J;++H){C=I[H]+X;var D=s*H;K[b++]=w[D+Y],K[b++]=-C,K[b++]=w[D+E],K[b++]=C}var F=b>>>1;Q(K,F);var N=0,y=0;for(H=0;H<F;++H){var h=0|K[2*H+1];if(h>=X)G(g,e,y--,h=h-X|0);else if(h>=0)G(j,B,N--,h);else if(h<=-X){h=-h-X|0;for(var u=0;u<N;++u){if(void 0!==(i=A(j[u],h)))return i}d(g,e,y++,h)}else{h=-h-1|0;for(u=0;u<y;++u){var i;if(void 0!==(i=A(h,g[u])))return i}d(j,B,N++,h)}}},sweepComplete:function(M,A,O,S,z,X,c,w,I,b){for(var s=0,Y=2*M,E=M-1,H=Y-1,C=O;C<S;++C){var f=X[C]+1<<1,D=Y*C;K[s++]=z[D+E],K[s++]=-f,K[s++]=z[D+H],K[s++]=f}for(C=c;C<w;++C){f=b[C]+1<<1;var F=Y*C;K[s++]=I[F+E],K[s++]=1|-f,K[s++]=I[F+H],K[s++]=1|f}var N=s>>>1;Q(K,N);var y=0,h=0,u=0;for(C=0;C<N;++C){var i=0|K[2*C+1],U=1&i;if(C<N-1&&i>>1===K[2*C+3]>>1&&(U=2,C+=1),i<0){for(var L=-(i>>1)-1,t=0;t<u;++t){if(void 0!==(x=A(T[t],L)))return x}if(0!==U)for(t=0;t<y;++t){if(void 0!==(x=A(j[t],L)))return x}if(1!==U)for(t=0;t<h;++t){var x;if(void 0!==(x=A(g[t],L)))return x}0===U?d(j,B,y++,L):1===U?d(g,e,h++,L):2===U&&d(T,J,u++,L)}else{L=(i>>1)-1;0===U?G(j,B,y--,L):1===U?G(g,e,h--,L):2===U&&G(T,J,u--,L)}}},scanBipartite:function(M,A,O,S,z,c,g,e,T,J,w,I){var b=0,s=2*M,Y=A,E=A+M,H=1,C=1;S?C=X:H=X;for(var f=z;f<c;++f){var D=f+H,F=s*f;K[b++]=g[F+Y],K[b++]=-D,K[b++]=g[F+E],K[b++]=D}for(f=T;f<J;++f){D=f+C;var N=s*f;K[b++]=w[N+Y],K[b++]=-D}var y=b>>>1;Q(K,y);var h=0;for(f=0;f<y;++f){var u=0|K[2*f+1];if(u<0){var i=!1;if((D=-u)>=X?(i=!S,D-=X):(i=!!S,D-=1),i)d(j,B,h++,D);else{var U=I[D],L=s*D,t=w[L+A+1],x=w[L+A+1+M];M:for(var o=0;o<h;++o){var p=j[o],v=s*p;if(!(x<g[v+A+1]||g[v+A+1+M]<t)){for(var q=A+2;q<M;++q)if(w[L+q+M]<g[v+q]||g[v+q+M]<w[L+q])continue M;var r,n=e[p];if(void 0!==(r=S?O(U,n):O(n,U)))return r}}}}else G(j,B,h--,u-H)}},scanComplete:function(M,A,O,S,z,c,B,g,e,T,J){for(var G=0,d=2*M,w=A,I=A+M,b=S;b<z;++b){var s=b+X,Y=d*b;K[G++]=c[Y+w],K[G++]=-s,K[G++]=c[Y+I],K[G++]=s}for(b=g;b<e;++b){s=b+1;var E=d*b;K[G++]=T[E+w],K[G++]=-s}var H=G>>>1;Q(K,H);var C=0;for(b=0;b<H;++b){var f=0|K[2*b+1];if(f<0){if((s=-f)>=X)j[C++]=s-X;else{var D=J[s-=1],F=d*s,N=T[F+A+1],y=T[F+A+1+M];M:for(var h=0;h<C;++h){var u=j[h],i=B[u];if(i===D)break;var U=d*u;if(!(y<c[U+A+1]||c[U+A+1+M]<N)){for(var L=A+2;L<M;++L)if(T[F+L+M]<c[U+L]||c[U+L+M]<T[F+L])continue M;var t=O(i,D);if(void 0!==t)return t}}}}else{for(s=f-X,h=C-1;h>=0;--h)if(j[h]===s){for(L=h+1;L<C;++L)j[L-1]=j[L];break}--C}}}};var S=O(14457),z=O(14460),Q=O(14480),X=1<<28,c=1024,j=S.mallocInt32(c),B=S.mallocInt32(c),g=S.mallocInt32(c),e=S.mallocInt32(c),T=S.mallocInt32(c),J=S.mallocInt32(c),K=S.mallocDouble(8192);function G(M,A,O,S){var z=A[S],Q=M[O-1];M[z]=Q,A[Q]=z}function d(M,A,O,S){M[O]=S,A[S]=O}},14710:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14704:(M,A,O)=>{var S=O(14710),z=O(14715),Q=Object.hasOwnProperty,X=Object.create(null);for(var c in S)Q.call(S,c)&&(X[S[c]]=c);var j=M.exports={to:{},get:{}};function B(M,A,O){return Math.min(Math.max(A,M),O)}function g(M){var A=Math.round(M).toString(16).toUpperCase();return A.length<2?"0"+A:A}j.get=function(M){var A,O;switch(M.substring(0,3).toLowerCase()){case"hsl":A=j.get.hsl(M),O="hsl";break;case"hwb":A=j.get.hwb(M),O="hwb";break;default:A=j.get.rgb(M),O="rgb"}return A?{model:O,value:A}:null},j.get.rgb=function(M){if(!M)return null;var A,O,z,X=[0,0,0,1];if(A=M.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(z=A[2],A=A[1],O=0;O<3;O++){var c=2*O;X[O]=parseInt(A.slice(c,c+2),16)}z&&(X[3]=parseInt(z,16)/255)}else if(A=M.match(/^#([a-f0-9]{3,4})$/i)){for(z=(A=A[1])[3],O=0;O<3;O++)X[O]=parseInt(A[O]+A[O],16);z&&(X[3]=parseInt(z+z,16)/255)}else if(A=M.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(O=0;O<3;O++)X[O]=parseInt(A[O+1],0);A[4]&&(A[5]?X[3]=.01*parseFloat(A[4]):X[3]=parseFloat(A[4]))}else{if(!(A=M.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(A=M.match(/^(\w+)$/))?"transparent"===A[1]?[0,0,0,0]:Q.call(S,A[1])?((X=S[A[1]])[3]=1,X):null:null;for(O=0;O<3;O++)X[O]=Math.round(2.55*parseFloat(A[O+1]));A[4]&&(A[5]?X[3]=.01*parseFloat(A[4]):X[3]=parseFloat(A[4]))}for(O=0;O<3;O++)X[O]=B(X[O],0,255);return X[3]=B(X[3],0,1),X},j.get.hsl=function(M){if(!M)return null;var A=M.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var O=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,B(parseFloat(A[2]),0,100),B(parseFloat(A[3]),0,100),B(isNaN(O)?1:O,0,1)]}return null},j.get.hwb=function(M){if(!M)return null;var A=M.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(A){var O=parseFloat(A[4]);return[(parseFloat(A[1])%360+360)%360,B(parseFloat(A[2]),0,100),B(parseFloat(A[3]),0,100),B(isNaN(O)?1:O,0,1)]}return null},j.to.hex=function(){var M=z(arguments);return"#"+g(M[0])+g(M[1])+g(M[2])+(M[3]<1?g(Math.round(255*M[3])):"")},j.to.rgb=function(){var M=z(arguments);return M.length<4||1===M[3]?"rgb("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+")":"rgba("+Math.round(M[0])+", "+Math.round(M[1])+", "+Math.round(M[2])+", "+M[3]+")"},j.to.rgb.percent=function(){var M=z(arguments),A=Math.round(M[0]/255*100),O=Math.round(M[1]/255*100),S=Math.round(M[2]/255*100);return M.length<4||1===M[3]?"rgb("+A+"%, "+O+"%, "+S+"%)":"rgba("+A+"%, "+O+"%, "+S+"%, "+M[3]+")"},j.to.hsl=function(){var M=z(arguments);return M.length<4||1===M[3]?"hsl("+M[0]+", "+M[1]+"%, "+M[2]+"%)":"hsla("+M[0]+", "+M[1]+"%, "+M[2]+"%, "+M[3]+")"},j.to.hwb=function(){var M=z(arguments),A="";return M.length>=4&&1!==M[3]&&(A=", "+M[3]),"hwb("+M[0]+", "+M[1]+"%, "+M[2]+"%"+A+")"},j.to.keyword=function(M){return X[M.slice(0,3)]}},14702:(M,A,O)=>{const S=O(14704),z=O(14722),Q=["keyword","gray","hex"],X={};for(const J of Object.keys(z))X[[...z[J].labels].sort().join("")]=J;const c={};function j(M,A){if(!(this instanceof j))return new j(M,A);if(A&&A in Q&&(A=null),A&&!(A in z))throw new Error("Unknown model: "+A);let O,B;if(null==M)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(M instanceof j)this.model=M.model,this.color=[...M.color],this.valpha=M.valpha;else if("string"===typeof M){const A=S.get(M);if(null===A)throw new Error("Unable to parse color from string: "+M);this.model=A.model,B=z[this.model].channels,this.color=A.value.slice(0,B),this.valpha="number"===typeof A.value[B]?A.value[B]:1}else if(M.length>0){this.model=A||"rgb",B=z[this.model].channels;const O=Array.prototype.slice.call(M,0,B);this.color=T(O,B),this.valpha="number"===typeof M[B]?M[B]:1}else if("number"===typeof M)this.model="rgb",this.color=[M>>16&255,M>>8&255,255&M],this.valpha=1;else{this.valpha=1;const A=Object.keys(M);"alpha"in M&&(A.splice(A.indexOf("alpha"),1),this.valpha="number"===typeof M.alpha?M.alpha:0);const S=A.sort().join("");if(!(S in X))throw new Error("Unable to parse color from object: "+JSON.stringify(M));this.model=X[S];const{labels:Q}=z[this.model],c=[];for(O=0;O<Q.length;O++)c.push(M[Q[O]]);this.color=T(c)}if(c[this.model])for(B=z[this.model].channels,O=0;O<B;O++){const M=c[this.model][O];M&&(this.color[O]=M(this.color[O]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}j.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(M){let A=this.model in S.to?this:this.rgb();A=A.round("number"===typeof M?M:1);const O=1===A.valpha?A.color:[...A.color,this.valpha];return S.to[A.model](O)},percentString(M){const A=this.rgb().round("number"===typeof M?M:1),O=1===A.valpha?A.color:[...A.color,this.valpha];return S.to.rgb.percent(O)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const M={},{channels:A}=z[this.model],{labels:O}=z[this.model];for(let S=0;S<A;S++)M[O[S]]=this.color[S];return 1!==this.valpha&&(M.alpha=this.valpha),M},unitArray(){const M=this.rgb().color;return M[0]/=255,M[1]/=255,M[2]/=255,1!==this.valpha&&M.push(this.valpha),M},unitObject(){const M=this.rgb().object();return M.r/=255,M.g/=255,M.b/=255,1!==this.valpha&&(M.alpha=this.valpha),M},round(M){return M=Math.max(M||0,0),new j([...this.color.map(B(M)),this.valpha],this.model)},alpha(M){return void 0!==M?new j([...this.color,Math.max(0,Math.min(1,M))],this.model):this.valpha},red:g("rgb",0,e(255)),green:g("rgb",1,e(255)),blue:g("rgb",2,e(255)),hue:g(["hsl","hsv","hsl","hwb","hcg"],0,(M=>(M%360+360)%360)),saturationl:g("hsl",1,e(100)),lightness:g("hsl",2,e(100)),saturationv:g("hsv",1,e(100)),value:g("hsv",2,e(100)),chroma:g("hcg",1,e(100)),gray:g("hcg",2,e(100)),white:g("hwb",1,e(100)),wblack:g("hwb",2,e(100)),cyan:g("cmyk",0,e(100)),magenta:g("cmyk",1,e(100)),yellow:g("cmyk",2,e(100)),black:g("cmyk",3,e(100)),x:g("xyz",0,e(95.047)),y:g("xyz",1,e(100)),z:g("xyz",2,e(108.833)),l:g("lab",0,e(100)),a:g("lab",1),b:g("lab",2),keyword(M){return void 0!==M?new j(M):z[this.model].keyword(this.color)},hex(M){return void 0!==M?new j(M):S.to.hex(this.rgb().round().color)},hexa(M){if(void 0!==M)return new j(M);const A=this.rgb().round().color;let O=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===O.length&&(O="0"+O),S.to.hex(A)+O},rgbNumber(){const M=this.rgb().color;return(255&M[0])<<16|(255&M[1])<<8|255&M[2]},luminosity(){const M=this.rgb().color,A=[];for(const[O,S]of M.entries()){const M=S/255;A[O]=M<=.04045?M/12.92:((M+.055)/1.055)**2.4}return.2126*A[0]+.7152*A[1]+.0722*A[2]},contrast(M){const A=this.luminosity(),O=M.luminosity();return A>O?(A+.05)/(O+.05):(O+.05)/(A+.05)},level(M){const A=this.contrast(M);return A>=7?"AAA":A>=4.5?"AA":""},isDark(){const M=this.rgb().color;return(2126*M[0]+7152*M[1]+722*M[2])/1e4<128},isLight(){return!this.isDark()},negate(){const M=this.rgb();for(let A=0;A<3;A++)M.color[A]=255-M.color[A];return M},lighten(M){const A=this.hsl();return A.color[2]+=A.color[2]*M,A},darken(M){const A=this.hsl();return A.color[2]-=A.color[2]*M,A},saturate(M){const A=this.hsl();return A.color[1]+=A.color[1]*M,A},desaturate(M){const A=this.hsl();return A.color[1]-=A.color[1]*M,A},whiten(M){const A=this.hwb();return A.color[1]+=A.color[1]*M,A},blacken(M){const A=this.hwb();return A.color[2]+=A.color[2]*M,A},grayscale(){const M=this.rgb().color,A=.3*M[0]+.59*M[1]+.11*M[2];return j.rgb(A,A,A)},fade(M){return this.alpha(this.valpha-this.valpha*M)},opaquer(M){return this.alpha(this.valpha+this.valpha*M)},rotate(M){const A=this.hsl();let O=A.color[0];return O=(O+M)%360,O=O<0?360+O:O,A.color[0]=O,A},mix(M,A){if(!M||!M.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof M);const O=M.rgb(),S=this.rgb(),z=void 0===A?.5:A,Q=2*z-1,X=O.alpha()-S.alpha(),c=((Q*X===-1?Q:(Q+X)/(1+Q*X))+1)/2,B=1-c;return j.rgb(c*O.red()+B*S.red(),c*O.green()+B*S.green(),c*O.blue()+B*S.blue(),O.alpha()*z+S.alpha()*(1-z))}};for(const J of Object.keys(z)){if(Q.includes(J))continue;const{channels:M}=z[J];j.prototype[J]=function(){if(this.model===J)return new j(this);for(var M=arguments.length,A=new Array(M),O=0;O<M;O++)A[O]=arguments[O];return A.length>0?new j(A,J):new j([...(S=z[this.model][J].raw(this.color),Array.isArray(S)?S:[S]),this.valpha],J);var S},j[J]=function(){for(var A=arguments.length,O=new Array(A),S=0;S<A;S++)O[S]=arguments[S];let z=O[0];return"number"===typeof z&&(z=T(O,M)),new j(z,J)}}function B(M){return function(A){return function(M,A){return Number(M.toFixed(A))}(A,M)}}function g(M,A,O){M=Array.isArray(M)?M:[M];for(const S of M)(c[S]||(c[S]=[]))[A]=O;return M=M[0],function(S){let z;return void 0!==S?(O&&(S=O(S)),z=this[M](),z.color[A]=S,z):(z=this[M]().color[A],O&&(z=O(z)),z)}}function e(M){return function(A){return Math.max(0,Math.min(M,A))}}function T(M,A){for(let O=0;O<A;O++)"number"!==typeof M[O]&&(M[O]=0);return M}M.exports=j},14726:(M,A,O)=>{const S=O(14733),z={};for(const X of Object.keys(S))z[S[X]]=X;const Q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};M.exports=Q;for(const X of Object.keys(Q)){if(!("channels"in Q[X]))throw new Error("missing channels property: "+X);if(!("labels"in Q[X]))throw new Error("missing channel labels property: "+X);if(Q[X].labels.length!==Q[X].channels)throw new Error("channel and label counts mismatch: "+X);const{channels:M,labels:A}=Q[X];delete Q[X].channels,delete Q[X].labels,Object.defineProperty(Q[X],"channels",{value:M}),Object.defineProperty(Q[X],"labels",{value:A})}Q.rgb.hsl=function(M){const A=M[0]/255,O=M[1]/255,S=M[2]/255,z=Math.min(A,O,S),Q=Math.max(A,O,S),X=Q-z;let c,j;Q===z?c=0:A===Q?c=(O-S)/X:O===Q?c=2+(S-A)/X:S===Q&&(c=4+(A-O)/X),c=Math.min(60*c,360),c<0&&(c+=360);const B=(z+Q)/2;return j=Q===z?0:B<=.5?X/(Q+z):X/(2-Q-z),[c,100*j,100*B]},Q.rgb.hsv=function(M){let A,O,S,z,Q;const X=M[0]/255,c=M[1]/255,j=M[2]/255,B=Math.max(X,c,j),g=B-Math.min(X,c,j),e=function(M){return(B-M)/6/g+.5};return 0===g?(z=0,Q=0):(Q=g/B,A=e(X),O=e(c),S=e(j),X===B?z=S-O:c===B?z=1/3+A-S:j===B&&(z=2/3+O-A),z<0?z+=1:z>1&&(z-=1)),[360*z,100*Q,100*B]},Q.rgb.hwb=function(M){const A=M[0],O=M[1];let S=M[2];const z=Q.rgb.hsl(M)[0],X=1/255*Math.min(A,Math.min(O,S));return S=1-1/255*Math.max(A,Math.max(O,S)),[z,100*X,100*S]},Q.rgb.cmyk=function(M){const A=M[0]/255,O=M[1]/255,S=M[2]/255,z=Math.min(1-A,1-O,1-S);return[100*((1-A-z)/(1-z)||0),100*((1-O-z)/(1-z)||0),100*((1-S-z)/(1-z)||0),100*z]},Q.rgb.keyword=function(M){const A=z[M];if(A)return A;let O,Q=1/0;for(const z of Object.keys(S)){const A=S[z],j=(c=A,((X=M)[0]-c[0])**2+(X[1]-c[1])**2+(X[2]-c[2])**2);j<Q&&(Q=j,O=z)}var X,c;return O},Q.keyword.rgb=function(M){return S[M]},Q.rgb.xyz=function(M){let A=M[0]/255,O=M[1]/255,S=M[2]/255;A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,O=O>.04045?((O+.055)/1.055)**2.4:O/12.92,S=S>.04045?((S+.055)/1.055)**2.4:S/12.92;return[100*(.4124*A+.3576*O+.1805*S),100*(.2126*A+.7152*O+.0722*S),100*(.0193*A+.1192*O+.9505*S)]},Q.rgb.lab=function(M){const A=Q.rgb.xyz(M);let O=A[0],S=A[1],z=A[2];O/=95.047,S/=100,z/=108.883,O=O>.008856?O**(1/3):7.787*O+16/116,S=S>.008856?S**(1/3):7.787*S+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*S-16,500*(O-S),200*(S-z)]},Q.hsl.rgb=function(M){const A=M[0]/360,O=M[1]/100,S=M[2]/100;let z,Q,X;if(0===O)return X=255*S,[X,X,X];z=S<.5?S*(1+O):S+O-S*O;const c=2*S-z,j=[0,0,0];for(let B=0;B<3;B++)Q=A+1/3*-(B-1),Q<0&&Q++,Q>1&&Q--,X=6*Q<1?c+6*(z-c)*Q:2*Q<1?z:3*Q<2?c+(z-c)*(2/3-Q)*6:c,j[B]=255*X;return j},Q.hsl.hsv=function(M){const A=M[0];let O=M[1]/100,S=M[2]/100,z=O;const Q=Math.max(S,.01);S*=2,O*=S<=1?S:2-S,z*=Q<=1?Q:2-Q;return[A,100*(0===S?2*z/(Q+z):2*O/(S+O)),100*((S+O)/2)]},Q.hsv.rgb=function(M){const A=M[0]/60,O=M[1]/100;let S=M[2]/100;const z=Math.floor(A)%6,Q=A-Math.floor(A),X=255*S*(1-O),c=255*S*(1-O*Q),j=255*S*(1-O*(1-Q));switch(S*=255,z){case 0:return[S,j,X];case 1:return[c,S,X];case 2:return[X,S,j];case 3:return[X,c,S];case 4:return[j,X,S];case 5:return[S,X,c]}},Q.hsv.hsl=function(M){const A=M[0],O=M[1]/100,S=M[2]/100,z=Math.max(S,.01);let Q,X;X=(2-O)*S;const c=(2-O)*z;return Q=O*z,Q/=c<=1?c:2-c,Q=Q||0,X/=2,[A,100*Q,100*X]},Q.hwb.rgb=function(M){const A=M[0]/360;let O=M[1]/100,S=M[2]/100;const z=O+S;let Q;z>1&&(O/=z,S/=z);const X=Math.floor(6*A),c=1-S;Q=6*A-X,0!==(1&X)&&(Q=1-Q);const j=O+Q*(c-O);let B,g,e;switch(X){default:case 6:case 0:B=c,g=j,e=O;break;case 1:B=j,g=c,e=O;break;case 2:B=O,g=c,e=j;break;case 3:B=O,g=j,e=c;break;case 4:B=j,g=O,e=c;break;case 5:B=c,g=O,e=j}return[255*B,255*g,255*e]},Q.cmyk.rgb=function(M){const A=M[0]/100,O=M[1]/100,S=M[2]/100,z=M[3]/100;return[255*(1-Math.min(1,A*(1-z)+z)),255*(1-Math.min(1,O*(1-z)+z)),255*(1-Math.min(1,S*(1-z)+z))]},Q.xyz.rgb=function(M){const A=M[0]/100,O=M[1]/100,S=M[2]/100;let z,Q,X;return z=3.2406*A+-1.5372*O+-.4986*S,Q=-.9689*A+1.8758*O+.0415*S,X=.0557*A+-.204*O+1.057*S,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:12.92*Q,X=X>.0031308?1.055*X**(1/2.4)-.055:12.92*X,z=Math.min(Math.max(0,z),1),Q=Math.min(Math.max(0,Q),1),X=Math.min(Math.max(0,X),1),[255*z,255*Q,255*X]},Q.xyz.lab=function(M){let A=M[0],O=M[1],S=M[2];A/=95.047,O/=100,S/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,O=O>.008856?O**(1/3):7.787*O+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*O-16,500*(A-O),200*(O-S)]},Q.lab.xyz=function(M){let A,O,S;O=(M[0]+16)/116,A=M[1]/500+O,S=O-M[2]/200;const z=O**3,Q=A**3,X=S**3;return O=z>.008856?z:(O-16/116)/7.787,A=Q>.008856?Q:(A-16/116)/7.787,S=X>.008856?X:(S-16/116)/7.787,A*=95.047,O*=100,S*=108.883,[A,O,S]},Q.lab.lch=function(M){const A=M[0],O=M[1],S=M[2];let z;z=360*Math.atan2(S,O)/2/Math.PI,z<0&&(z+=360);return[A,Math.sqrt(O*O+S*S),z]},Q.lch.lab=function(M){const A=M[0],O=M[1],S=M[2]/360*2*Math.PI;return[A,O*Math.cos(S),O*Math.sin(S)]},Q.rgb.ansi16=function(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[O,S,z]=M;let X=null===A?Q.rgb.hsv(M)[2]:A;if(X=Math.round(X/50),0===X)return 30;let c=30+(Math.round(z/255)<<2|Math.round(S/255)<<1|Math.round(O/255));return 2===X&&(c+=60),c},Q.hsv.ansi16=function(M){return Q.rgb.ansi16(Q.hsv.rgb(M),M[2])},Q.rgb.ansi256=function(M){const A=M[0],O=M[1],S=M[2];if(A===O&&O===S)return A<8?16:A>248?231:Math.round((A-8)/247*24)+232;return 16+36*Math.round(A/255*5)+6*Math.round(O/255*5)+Math.round(S/255*5)},Q.ansi16.rgb=function(M){let A=M%10;if(0===A||7===A)return M>50&&(A+=3.5),A=A/10.5*255,[A,A,A];const O=.5*(1+~~(M>50));return[(1&A)*O*255,(A>>1&1)*O*255,(A>>2&1)*O*255]},Q.ansi256.rgb=function(M){if(M>=232){const A=10*(M-232)+8;return[A,A,A]}let A;M-=16;return[Math.floor(M/36)/5*255,Math.floor((A=M%36)/6)/5*255,A%6/5*255]},Q.rgb.hex=function(M){const A=(((255&Math.round(M[0]))<<16)+((255&Math.round(M[1]))<<8)+(255&Math.round(M[2]))).toString(16).toUpperCase();return"000000".substring(A.length)+A},Q.hex.rgb=function(M){const A=M.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!A)return[0,0,0];let O=A[0];3===A[0].length&&(O=O.split("").map((M=>M+M)).join(""));const S=parseInt(O,16);return[S>>16&255,S>>8&255,255&S]},Q.rgb.hcg=function(M){const A=M[0]/255,O=M[1]/255,S=M[2]/255,z=Math.max(Math.max(A,O),S),Q=Math.min(Math.min(A,O),S),X=z-Q;let c,j;return c=X<1?Q/(1-X):0,j=X<=0?0:z===A?(O-S)/X%6:z===O?2+(S-A)/X:4+(A-O)/X,j/=6,j%=1,[360*j,100*X,100*c]},Q.hsl.hcg=function(M){const A=M[1]/100,O=M[2]/100,S=O<.5?2*A*O:2*A*(1-O);let z=0;return S<1&&(z=(O-.5*S)/(1-S)),[M[0],100*S,100*z]},Q.hsv.hcg=function(M){const A=M[1]/100,O=M[2]/100,S=A*O;let z=0;return S<1&&(z=(O-S)/(1-S)),[M[0],100*S,100*z]},Q.hcg.rgb=function(M){const A=M[0]/360,O=M[1]/100,S=M[2]/100;if(0===O)return[255*S,255*S,255*S];const z=[0,0,0],Q=A%1*6,X=Q%1,c=1-X;let j=0;switch(Math.floor(Q)){case 0:z[0]=1,z[1]=X,z[2]=0;break;case 1:z[0]=c,z[1]=1,z[2]=0;break;case 2:z[0]=0,z[1]=1,z[2]=X;break;case 3:z[0]=0,z[1]=c,z[2]=1;break;case 4:z[0]=X,z[1]=0,z[2]=1;break;default:z[0]=1,z[1]=0,z[2]=c}return j=(1-O)*S,[255*(O*z[0]+j),255*(O*z[1]+j),255*(O*z[2]+j)]},Q.hcg.hsv=function(M){const A=M[1]/100,O=A+M[2]/100*(1-A);let S=0;return O>0&&(S=A/O),[M[0],100*S,100*O]},Q.hcg.hsl=function(M){const A=M[1]/100,O=M[2]/100*(1-A)+.5*A;let S=0;return O>0&&O<.5?S=A/(2*O):O>=.5&&O<1&&(S=A/(2*(1-O))),[M[0],100*S,100*O]},Q.hcg.hwb=function(M){const A=M[1]/100,O=A+M[2]/100*(1-A);return[M[0],100*(O-A),100*(1-O)]},Q.hwb.hcg=function(M){const A=M[1]/100,O=1-M[2]/100,S=O-A;let z=0;return S<1&&(z=(O-S)/(1-S)),[M[0],100*S,100*z]},Q.apple.rgb=function(M){return[M[0]/65535*255,M[1]/65535*255,M[2]/65535*255]},Q.rgb.apple=function(M){return[M[0]/255*65535,M[1]/255*65535,M[2]/255*65535]},Q.gray.rgb=function(M){return[M[0]/100*255,M[0]/100*255,M[0]/100*255]},Q.gray.hsl=function(M){return[0,0,M[0]]},Q.gray.hsv=Q.gray.hsl,Q.gray.hwb=function(M){return[0,100,M[0]]},Q.gray.cmyk=function(M){return[0,0,0,M[0]]},Q.gray.lab=function(M){return[M[0],0,0]},Q.gray.hex=function(M){const A=255&Math.round(M[0]/100*255),O=((A<<16)+(A<<8)+A).toString(16).toUpperCase();return"000000".substring(O.length)+O},Q.rgb.gray=function(M){return[(M[0]+M[1]+M[2])/3/255*100]}},14722:(M,A,O)=>{const S=O(14726),z=O(14739),Q={};Object.keys(S).forEach((M=>{Q[M]={},Object.defineProperty(Q[M],"channels",{value:S[M].channels}),Object.defineProperty(Q[M],"labels",{value:S[M].labels});const A=z(M);Object.keys(A).forEach((O=>{const S=A[O];Q[M][O]=function(M){const A=function(){for(var A=arguments.length,O=new Array(A),S=0;S<A;S++)O[S]=arguments[S];const z=O[0];if(void 0===z||null===z)return z;z.length>1&&(O=z);const Q=M(O);if("object"===typeof Q)for(let M=Q.length,X=0;X<M;X++)Q[X]=Math.round(Q[X]);return Q};return"conversion"in M&&(A.conversion=M.conversion),A}(S),Q[M][O].raw=function(M){const A=function(){for(var A=arguments.length,O=new Array(A),S=0;S<A;S++)O[S]=arguments[S];const z=O[0];return void 0===z||null===z?z:(z.length>1&&(O=z),M(O))};return"conversion"in M&&(A.conversion=M.conversion),A}(S)}))})),M.exports=Q},14739:(M,A,O)=>{const S=O(14726);function z(M){const A=function(){const M={},A=Object.keys(S);for(let O=A.length,S=0;S<O;S++)M[A[S]]={distance:-1,parent:null};return M}(),O=[M];for(A[M].distance=0;O.length;){const M=O.pop(),z=Object.keys(S[M]);for(let S=z.length,Q=0;Q<S;Q++){const S=z[Q],X=A[S];-1===X.distance&&(X.distance=A[M].distance+1,X.parent=M,O.unshift(S))}}return A}function Q(M,A){return function(O){return A(M(O))}}function X(M,A){const O=[A[M].parent,M];let z=S[A[M].parent][M],X=A[M].parent;for(;A[X].parent;)O.unshift(A[X].parent),z=Q(S[A[X].parent][X],z),X=A[X].parent;return z.conversion=O,z}M.exports=function(M){const A=z(M),O={},S=Object.keys(A);for(let z=S.length,Q=0;Q<z;Q++){const M=S[Q];null!==A[M].parent&&(O[M]=X(M,A))}return O}},14733:M=>{"use strict";M.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13672:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.discordURLBuilder=void 0,A.discordURLBuilder=function(M){var A;const O=(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)||"localhost",S=M.hostname.split("."),z=!M.hostname.includes("trycloudflare.com")&&!M.hostname.includes("discordsays.com")&&S.length>2?"/".concat(S[0]):"";return M.pathname.startsWith("/.proxy")?"".concat(M.protocol,"//").concat(O).concat(z).concat(M.pathname).concat(M.search):"".concat(M.protocol,"//").concat(O,"/.proxy/colyseus").concat(z).concat(M.pathname).concat(M.search)}},13662:function(M,A,O){"use strict";var S,z,Q,X,c=this&&this.__awaiter||function(M,A,O,S){return new(O||(O=Promise))((function(z,Q){function X(M){try{j(S.next(M))}catch(A){Q(A)}}function c(M){try{j(S.throw(M))}catch(A){Q(A)}}function j(M){var A;M.done?z(M.value):(A=M.value,A instanceof O?A:new O((function(M){M(A)}))).then(X,c)}j((S=S.apply(M,A||[])).next())}))},j=this&&this.__classPrivateFieldGet||function(M,A,O,S){if("a"===O&&!S)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof A?M!==A||!S:!A.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===O?S:"a"===O?S.call(M):S?S.value:A.get(M)},B=this&&this.__classPrivateFieldSet||function(M,A,O,S,z){if("m"===S)throw new TypeError("Private method is not writable");if("a"===S&&!z)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof A?M!==A||!z:!A.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===S?z.call(M,O):z?z.value=O:A.set(M,O),O};Object.defineProperty(A,"__esModule",{value:!0}),A.Auth=void 0;const g=O(13665),e=O(13634);A.Auth=class{constructor(M){this.http=M,this.settings={path:"/auth",key:"colyseus-auth-token"},S.set(this,!1),z.set(this,void 0),Q.set(this,void 0),X.set(this,(0,e.createNanoEvents)()),(0,g.getItem)(this.settings.key,(M=>this.token=M))}set token(M){this.http.authToken=M}get token(){return this.http.authToken}onChange(M){const A=j(this,X,"f").on("change",M);return j(this,S,"f")||B(this,z,new Promise(((M,A)=>{this.getUserData().then((M=>{this.emitChange(Object.assign(Object.assign({},M),{token:this.token}))})).catch((M=>{this.emitChange({user:null,token:void 0})})).finally((()=>{M()}))})),"f"),B(this,S,!0,"f"),A}getUserData(){return c(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get("".concat(this.settings.path,"/userdata"))).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(M,A,O){return c(this,void 0,void 0,(function*(){const S=(yield this.http.post("".concat(this.settings.path,"/register"),{body:{email:M,password:A,options:O}})).data;return this.emitChange(S),S}))}signInWithEmailAndPassword(M,A){return c(this,void 0,void 0,(function*(){const O=(yield this.http.post("".concat(this.settings.path,"/login"),{body:{email:M,password:A}})).data;return this.emitChange(O),O}))}signInAnonymously(M){return c(this,void 0,void 0,(function*(){const A=(yield this.http.post("".concat(this.settings.path,"/anonymous"),{body:{options:M}})).data;return this.emitChange(A),A}))}sendPasswordResetEmail(M){return c(this,void 0,void 0,(function*(){return(yield this.http.post("".concat(this.settings.path,"/forgot-password"),{body:{email:M}})).data}))}signInWithProvider(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c(this,void 0,void 0,(function*(){return new Promise(((O,S)=>{const z=A.width||480,X=A.height||768,c=this.token?"?token=".concat(this.token):"",g="Login with ".concat(M[0].toUpperCase()+M.substring(1)),e=this.http.client.getHttpEndpoint("".concat(A.prefix||"".concat(this.settings.path,"/provider"),"/").concat(M).concat(c)),T=screen.width/2-z/2,J=screen.height/2-X/2;B(this,Q,window.open(e,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+z+", height="+X+", top="+J+", left="+T),"f");const K=M=>{void 0===M.data.user&&void 0===M.data.token||(clearInterval(G),j(this,Q,"f").close(),B(this,Q,void 0,"f"),window.removeEventListener("message",K),void 0!==M.data.error?S(M.data.error):(O(M.data),this.emitChange(M.data)))},G=setInterval((()=>{j(this,Q,"f")&&!j(this,Q,"f").closed||(B(this,Q,void 0,"f"),S("dX"),window.removeEventListener("message",K))}),200);window.addEventListener("message",K)}))}))}signOut(){return c(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(M){void 0!==M.token&&(this.token=M.token,null===M.token?(0,g.removeItem)(this.settings.key):(0,g.setItem)(this.settings.key,M.token)),j(this,X,"f").emit("change",M)}},S=new WeakMap,z=new WeakMap,Q=new WeakMap,X=new WeakMap},13591:function(M,A,O){"use strict";var S,z=this&&this.__awaiter||function(M,A,O,S){return new(O||(O=Promise))((function(z,Q){function X(M){try{j(S.next(M))}catch(A){Q(A)}}function c(M){try{j(S.throw(M))}catch(A){Q(A)}}function j(M){var A;M.done?z(M.value):(A=M.value,A instanceof O?A:new O((function(M){M(A)}))).then(X,c)}j((S=S.apply(M,A||[])).next())}))};Object.defineProperty(A,"__esModule",{value:!0}),A.Client=A.MatchMakeError=void 0;const Q=O(13597),X=O(13600),c=O(13650),j=O(13662),B=O(13672);class g extends Error{constructor(M,A){super(M),this.code=A,Object.setPrototypeOf(this,g.prototype)}}A.MatchMakeError=g;const e="undefined"!==typeof window&&"undefined"!==typeof(null===(S=null===window||void 0===window?void 0:window.location)||void 0===S?void 0:S.hostname)?"".concat(window.location.protocol.replace("http","ws"),"//").concat(window.location.hostname).concat(window.location.port&&":".concat(window.location.port)):"ws://127.0.0.1:2567";A.Client=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,A=arguments.length>1?arguments[1]:void 0;var O,S;if("string"===typeof M){const A=M.startsWith("/")?new URL(M,e):new URL(M),O="https:"===A.protocol||"wss:"===A.protocol,S=Number(A.port||(O?443:80));this.settings={hostname:A.hostname,pathname:A.pathname,port:S,secure:O}}else void 0===M.port&&(M.port=M.secure?443:80),void 0===M.pathname&&(M.pathname=""),this.settings=M;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new c.HTTP(this,(null===A||void 0===A?void 0:A.headers)||{}),this.auth=new j.Auth(this.http),this.urlBuilder=null===A||void 0===A?void 0:A.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(S=null===(O=null===window||void 0===window?void 0:window.location)||void 0===O?void 0:O.hostname)||void 0===S?void 0:S.includes("discordsays.com"))&&(this.urlBuilder=B.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",M,A,O)}))}create(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",M,A,O)}))}join(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",M,A,O)}))}joinById(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",M,A,O)}))}reconnect(M,A){return z(this,void 0,void 0,(function*(){if("string"===typeof M&&"string"===typeof A)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[O,S]=M.split(":");if(!O||!S)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",O,{reconnectionToken:S},A)}))}getAvailableRooms(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return z(this,void 0,void 0,(function*(){return(yield this.http.get("matchmake/".concat(M),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(M,A,O){return z(this,void 0,void 0,(function*(){const S=this.createRoom(M.room.name,A);S.roomId=M.room.roomId,S.sessionId=M.sessionId;const X={sessionId:S.sessionId};M.reconnectionToken&&(X.reconnectionToken=M.reconnectionToken);const c=O||S;return S.connect(this.buildEndpoint(M.room,X),M.devMode&&(()=>z(this,void 0,void 0,(function*(){console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," Re-establishing connection with room id '").concat(S.roomId,"'..."));let O=0;const Q=()=>z(this,void 0,void 0,(function*(){O++;try{yield this.consumeSeatReservation(M,A,c),console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(9989)," Successfully re-established connection with room '").concat(S.roomId,"'"))}catch(z){O<8?(console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(128260)," retrying... (").concat(O," out of ").concat(8,")")),setTimeout(Q,2e3)):console.info("[Colyseus devMode]: ".concat(String.fromCodePoint(10060)," Failed to reconnect. Is your server running? Please check server logs."))}}));setTimeout(Q,2e3)}))),c,this.http.headers),new Promise(((M,A)=>{const O=(M,O)=>A(new Q.ServerError(M,O));c.onError.once(O),c.onJoin.once((()=>{c.onError.remove(O),setTimeout((()=>{try{c.wB(128,new Uint8Array([90,27,159,130,32,221,41,21,1,74,124,56,59,116,97,234,165,4,80,146]))}catch(M){}}),3e3),M(c)}))}))}))}createMatchMakeRequest(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;return z(this,void 0,void 0,(function*(){const z=(yield this.http.post("matchmake/".concat(M,"/").concat(A),{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(O)})).data;if(z.error)throw new g(z.error,z.code);return"reconnect"===M&&(z.reconnectionToken=O.reconnectionToken),yield this.consumeSeatReservation(z,S,Q)}))}createRoom(M,A){return new X.Room(M,A)}buildEndpoint(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const O=[];for(const Q in A)A.hasOwnProperty(Q)&&O.push("".concat(Q,"=").concat(A[Q]));let S=this.settings.secure?"wss://":"ws://";M.publicAddress?S+="".concat(M.publicAddress):S+="".concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname);const z="".concat(S,"/").concat(M.processId,"/").concat(M.roomId,"?").concat(O.join("&"));return this.urlBuilder?this.urlBuilder(new URL(z)):z}getHttpEndpoint(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const A=M.startsWith("/")?M:"/".concat(M),O="".concat(this.settings.secure?"https":"http","://").concat(this.settings.hostname).concat(this.getEndpointPort()).concat(this.settings.pathname).concat(A);return this.urlBuilder?this.urlBuilder(new URL(O)):O}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?":".concat(this.settings.port):""}}},13613:(M,A,O)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.Connection=void 0;const S=O(13617);A.Connection=class{constructor(){this.events={},this.transport=new S.WebSocketTransport(this.events)}send(M){this.transport.send(M)}connect(M,A){this.transport.connect(M,A)}close(M,A){this.transport.close(M,A)}get isOpen(){return this.transport.isOpen}}},13650:function(M,A,O){"use strict";var S=this&&this.__createBinding||(Object.create?function(M,A,O,S){void 0===S&&(S=O);var z=Object.getOwnPropertyDescriptor(A,O);z&&!("get"in z?!A.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return A[O]}}),Object.defineProperty(M,S,z)}:function(M,A,O,S){void 0===S&&(S=O),M[S]=A[O]}),z=this&&this.__setModuleDefault||(Object.create?function(M,A){Object.defineProperty(M,"default",{enumerable:!0,value:A})}:function(M,A){M.default=A}),Q=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var A={};if(null!=M)for(var O in M)"default"!==O&&Object.prototype.hasOwnProperty.call(M,O)&&S(A,M,O);return z(A,M),A};Object.defineProperty(A,"__esModule",{value:!0}),A.HTTP=void 0;const X=O(13597),c=Q(O(13654));A.HTTP=class{constructor(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=M,this.headers=A}get(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",M,A)}post(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",M,A)}del(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",M,A)}put(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",M,A)}request(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c[M](this.client.getHttpEndpoint(A),this.getOptions(O)).catch((M=>{var A;const O=M.statusCode,S=(null===(A=M.data)||void 0===A?void 0:A.error)||M.statusMessage||M.message;if(!O&&!S)throw M;throw new X.ServerError(O,S)}))}getOptions(M){return M.headers=Object.assign({},this.headers,M.headers),this.authToken&&(M.headers.Authorization="Bearer ".concat(this.authToken)),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(M.withCredentials=!0),M}}},13622:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.utf8Length=A.utf8Read=A.ErrorCode=A.Protocol=void 0,function(M){M[M.HANDSHAKE=9]="HANDSHAKE",M[M.JOIN_ROOM=10]="JOIN_ROOM",M[M.ERROR=11]="ERROR",M[M.LEAVE_ROOM=12]="LEAVE_ROOM",M[M.ROOM_DATA=13]="ROOM_DATA",M[M.ROOM_STATE=14]="ROOM_STATE",M[M.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",M[M.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",M[M.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(A.Protocol||(A.Protocol={})),function(M){M[M.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",M[M.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",M[M.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",M[M.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",M[M.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",M[M.AUTH_FAILED=4215]="AUTH_FAILED",M[M.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(A.ErrorCode||(A.ErrorCode={})),A.utf8Read=function(M,A){const O=M[A++];for(var S="",z=0,Q=A,X=A+O;Q<X;Q++){var c=M[Q];if(0!==(128&c))if(192!==(224&c))if(224!==(240&c)){if(240!==(248&c))throw new Error("Invalid byte "+c.toString(16));(z=(7&c)<<18|(63&M[++Q])<<12|(63&M[++Q])<<6|63&M[++Q])>=65536?(z-=65536,S+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):S+=String.fromCharCode(z)}else S+=String.fromCharCode((15&c)<<12|(63&M[++Q])<<6|63&M[++Q]);else S+=String.fromCharCode((31&c)<<6|63&M[++Q]);else S+=String.fromCharCode(c)}return S},A.utf8Length=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",A=0,O=0;for(let S=0,z=M.length;S<z;S++)A=M.charCodeAt(S),A<128?O+=1:A<2048?O+=2:A<55296||A>=57344?O+=3:(S++,O+=4);return O+1}},13600:function(M,A,O){"use strict";var S=this&&this.__createBinding||(Object.create?function(M,A,O,S){void 0===S&&(S=O);var z=Object.getOwnPropertyDescriptor(A,O);z&&!("get"in z?!A.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return A[O]}}),Object.defineProperty(M,S,z)}:function(M,A,O,S){void 0===S&&(S=O),M[S]=A[O]}),z=this&&this.__setModuleDefault||(Object.create?function(M,A){Object.defineProperty(M,"default",{enumerable:!0,value:A})}:function(M,A){M.default=A}),Q=this&&this.__importStar||function(M){if(M&&M.__esModule)return M;var A={};if(null!=M)for(var O in M)"default"!==O&&Object.prototype.hasOwnProperty.call(M,O)&&S(A,M,O);return z(A,M),A};Object.defineProperty(A,"__esModule",{value:!0}),A.Room=void 0;const X=Q(O(13605)),c=O(13613),j=O(13622),B=O(13630),g=O(13634),e=O(13639),T=O(13647),J=O(13597);class K{constructor(M,A){this.onStateChange=(0,e.createSignal)(),this.onError=(0,e.createSignal)(),this.onLeave=(0,e.createSignal)(),this.onJoin=(0,e.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=M,A&&(this.serializer=new((0,B.getSerializer)("schema")),this.rootSchema=A,this.serializer.state=new A),this.onError(((M,A)=>{var O;return null===(O=console.warn)||void 0===O?void 0:O.call(console,"colyseus.js - onError => (".concat(M,") ").concat(A))})),this.onLeave((()=>this.zA()))}get id(){return this.roomId}connect(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,S=arguments.length>3?arguments[3]:void 0;const z=new c.Connection;O.connection=z,z.events.onmessage=K.prototype.onMessageCallback.bind(O),z.events.onclose=function(M){var S;if(!O.hasJoined)return null===(S=console.warn)||void 0===S||S.call(console,"Room connection was closed unexpectedly (".concat(M.code,"): ").concat(M.reason)),void O.onError.invoke(M.code,M.reason);M.code===J.CloseCode.DEVMODE_RESTART&&A?A():(O.onLeave.invoke(M.code,M.reason),O.destroy())},z.events.onerror=function(M){var A;null===(A=console.warn)||void 0===A||A.call(console,"Room, onError (".concat(M.code,"): ").concat(M.reason)),O.onError.invoke(M.code,M.reason)},z.connect(M,S)}dj(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((A=>{this.onLeave((M=>A(M))),this.connection?M?this.connection.send([j.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(J.CloseCode.CONSENTED)}))}LA(M,A){return this.onMessageHandlers.on(this.getMessageHandlerKey(M),A)}send(M,A){const O=[j.Protocol.ROOM_DATA];let S;if("string"===typeof M?T.encode.string(O,M):T.encode.number(O,M),void 0!==A){const M=X.encode(A);S=new Uint8Array(O.length+M.byteLength),S.set(new Uint8Array(O),0),S.set(new Uint8Array(M),O.length)}else S=new Uint8Array(O);this.connection.send(S.buffer)}wB(M,A){const O=[j.Protocol.ROOM_DATA_BYTES];let S;"string"===typeof M?T.encode.string(O,M):T.encode.number(O,M),S=new Uint8Array(O.length+(A.byteLength||A.length)),S.set(new Uint8Array(O),0),S.set(new Uint8Array(A),O.length),this.connection.send(S.buffer)}get state(){return this.serializer.getState()}zA(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(M){const A=Array.from(new Uint8Array(M.data)),O=A[0];if(O===j.Protocol.JOIN_ROOM){let M=1;const O=(0,j.utf8Read)(A,M);if(M+=(0,j.utf8Length)(O),this.serializerId=(0,j.utf8Read)(A,M),M+=(0,j.utf8Length)(this.serializerId),!this.serializer){const M=(0,B.getSerializer)(this.serializerId);this.serializer=new M}A.length>M&&this.serializer.handshake&&this.serializer.handshake(A,{offset:M}),this.reconnectionToken="".concat(this.roomId,":").concat(O),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([j.Protocol.JOIN_ROOM])}else if(O===j.Protocol.ERROR){const M={offset:1},O=T.decode.number(A,M),S=T.decode.string(A,M);this.onError.invoke(O,S)}else if(O===j.Protocol.LEAVE_ROOM)this.dj();else if(O===j.Protocol.ROOM_DATA_SCHEMA){const M={offset:1},O=this.serializer.getState().constructor._context.get(T.decode.number(A,M)),S=new O;S.decode(A,M),this.dispatchMessage(O,S)}else if(O===j.Protocol.ROOM_STATE)A.shift(),this.setState(A);else if(O===j.Protocol.ROOM_STATE_PATCH)A.shift(),this.patch(A);else if(O===j.Protocol.ROOM_DATA){const O={offset:1},S=T.decode.stringCheck(A,O)?T.decode.string(A,O):T.decode.number(A,O),z=A.length>O.offset?X.decode(M.data,O.offset):void 0;this.dispatchMessage(S,z)}else if(O===j.Protocol.ROOM_DATA_BYTES){const M={offset:1},O=T.decode.stringCheck(A,M)?T.decode.string(A,M):T.decode.number(A,M);this.dispatchMessage(O,new Uint8Array(A.slice(M.offset)))}}setState(M){this.serializer.setState(M),this.onStateChange.invoke(this.serializer.getState())}patch(M){this.serializer.patch(M),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(M,A){var O;const S=this.getMessageHandlerKey(M);this.onMessageHandlers.events[S]?this.onMessageHandlers.emit(S,A):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",M,A):null===(O=console.warn)||void 0===O||O.call(console,"colyseus.js: onMessage() not registered for type '".concat(M,"'."))}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(M){switch(typeof M){case"function":return"$".concat(M._typeid);case"string":return M;case"number":return"i".concat(M);default:throw new Error("invalid message type.")}}}A.Room=K},13665:(M,A)=>{"use strict";let O;function S(){if(!O)try{O="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(M){}return O||(O={cache:{},setItem:function(M,A){this.cache[M]=A},getItem:function(M){this.cache[M]},removeItem:function(M){delete this.cache[M]}}),O}Object.defineProperty(A,"__esModule",{value:!0}),A.getItem=A.removeItem=A.setItem=void 0,A.setItem=function(M,A){S().setItem(M,A)},A.removeItem=function(M){S().removeItem(M)},A.getItem=function(M,A){const O=S().getItem(M);"undefined"!==typeof Promise&&O instanceof Promise?O.then((M=>A(M))):A(O)}},13634:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createNanoEvents=void 0;A.createNanoEvents=()=>({emit(M){let A=this.events[M]||[];for(var O=arguments.length,S=new Array(O>1?O-1:0),z=1;z<O;z++)S[z-1]=arguments[z];for(let Q=0,X=A.length;Q<X;Q++)A[Q](...S)},events:{},on(M,A){var O;return(null===(O=this.events[M])||void 0===O?void 0:O.push(A))||(this.events[M]=[A]),()=>{var O;this.events[M]=null===(O=this.events[M])||void 0===O?void 0:O.filter((M=>A!==M))}}})},13639:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.createSignal=A.EventEmitter=void 0;class O{constructor(){this.handlers=[]}register(M){return this.handlers.push(M),this}invoke(){for(var M=arguments.length,A=new Array(M),O=0;O<M;O++)A[O]=arguments[O];this.handlers.forEach((M=>M.apply(this,A)))}invokeAsync(){for(var M=arguments.length,A=new Array(M),O=0;O<M;O++)A[O]=arguments[O];return Promise.all(this.handlers.map((M=>M.apply(this,A))))}remove(M){const A=this.handlers.indexOf(M);this.handlers[A]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}A.EventEmitter=O,A.createSignal=function(){const M=new O;function A(A){return M.register(A,null===this)}return A.once=A=>{const O=function(){for(var S=arguments.length,z=new Array(S),Q=0;Q<S;Q++)z[Q]=arguments[Q];A.apply(this,z),M.remove(O)};M.register(O)},A.remove=A=>M.remove(A),A.invoke=function(){return M.invoke(...arguments)},A.invokeAsync=function(){return M.invokeAsync(...arguments)},A.clear=()=>M.clear(),A}},13597:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.ServerError=A.CloseCode=void 0,function(M){M[M.CONSENTED=4e3]="CONSENTED",M[M.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(A.CloseCode||(A.CloseCode={}));class O extends Error{constructor(M,A){super(A),this.name="ServerError",this.code=M}}A.ServerError=O},13579:(M,A,O)=>{"use strict";A.d=void 0,O(13584);var S=O(13591);Object.defineProperty(A,"d",{enumerable:!0,get:function(){return S.Client}});var z=O(13622);var Q=O(13600);var X=O(13662);const c=O(13681);const j=O(13683),B=O(13630);(0,B.registerSerializer)("schema",c.SchemaSerializer),(0,B.registerSerializer)("none",j.NoneSerializer)},13584:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=M=>null!==M&&"object"===typeof M&&M.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13605:(M,A)=>{"use strict";function O(M,A){if(this._offset=A,M instanceof ArrayBuffer)this._buffer=M,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(M))throw new Error("Invalid argument");this._buffer=M.buffer,this._view=new DataView(this._buffer,M.byteOffset,M.byteLength)}}Object.defineProperty(A,"__esModule",{value:!0}),A.decode=A.encode=void 0,O.prototype._array=function(M){for(var A=new Array(M),O=0;O<M;O++)A[O]=this._parse();return A},O.prototype._map=function(M){for(var A={},O=0;O<M;O++)A[this._parse()]=this._parse();return A},O.prototype._str=function(M){var A=function(M,A,O){for(var S="",z=0,Q=A,X=A+O;Q<X;Q++){var c=M.getUint8(Q);if(0!==(128&c))if(192!==(224&c))if(224!==(240&c)){if(240!==(248&c))throw new Error("Invalid byte "+c.toString(16));(z=(7&c)<<18|(63&M.getUint8(++Q))<<12|(63&M.getUint8(++Q))<<6|63&M.getUint8(++Q))>=65536?(z-=65536,S+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):S+=String.fromCharCode(z)}else S+=String.fromCharCode((15&c)<<12|(63&M.getUint8(++Q))<<6|63&M.getUint8(++Q));else S+=String.fromCharCode((31&c)<<6|63&M.getUint8(++Q));else S+=String.fromCharCode(c)}return S}(this._view,this._offset,M);return this._offset+=M,A},O.prototype._bin=function(M){var A=this._buffer.slice(this._offset,this._offset+M);return this._offset+=M,A},O.prototype._parse=function(){var M,A=this._view.getUint8(this._offset++),O=0,S=0,z=0,Q=0;if(A<192)return A<128?A:A<144?this._map(15&A):A<160?this._array(15&A):this._str(31&A);if(A>223)return-1*(255-A+1);switch(A){case 192:return null;case 194:return!1;case 195:return!0;case 196:return O=this._view.getUint8(this._offset),this._offset+=1,this._bin(O);case 197:return O=this._view.getUint16(this._offset),this._offset+=2,this._bin(O);case 198:return O=this._view.getUint32(this._offset),this._offset+=4,this._bin(O);case 199:if(O=this._view.getUint8(this._offset),S=this._view.getInt8(this._offset+1),this._offset+=2,-1===S){var X=this._view.getUint32(this._offset);return z=this._view.getInt32(this._offset+4),Q=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*z+Q)+X/1e6)}return[S,this._bin(O)];case 200:return O=this._view.getUint16(this._offset),S=this._view.getInt8(this._offset+2),this._offset+=3,[S,this._bin(O)];case 201:return O=this._view.getUint32(this._offset),S=this._view.getInt8(this._offset+4),this._offset+=5,[S,this._bin(O)];case 202:return M=this._view.getFloat32(this._offset),this._offset+=4,M;case 203:return M=this._view.getFloat64(this._offset),this._offset+=8,M;case 204:return M=this._view.getUint8(this._offset),this._offset+=1,M;case 205:return M=this._view.getUint16(this._offset),this._offset+=2,M;case 206:return M=this._view.getUint32(this._offset),this._offset+=4,M;case 207:return z=this._view.getUint32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,z+Q;case 208:return M=this._view.getInt8(this._offset),this._offset+=1,M;case 209:return M=this._view.getInt16(this._offset),this._offset+=2,M;case 210:return M=this._view.getInt32(this._offset),this._offset+=4,M;case 211:return z=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,z+Q;case 212:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?void(this._offset+=1):[S,this._bin(1)];case 213:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(2)];case 214:return S=this._view.getInt8(this._offset),this._offset+=1,-1===S?(M=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*M)):[S,this._bin(4)];case 215:return S=this._view.getInt8(this._offset),this._offset+=1,0===S?(z=this._view.getInt32(this._offset)*Math.pow(2,32),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(z+Q)):-1===S?(z=this._view.getUint32(this._offset),Q=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&z)+Q)+(z>>>2)/1e6)):[S,this._bin(8)];case 216:return S=this._view.getInt8(this._offset),this._offset+=1,[S,this._bin(16)];case 217:return O=this._view.getUint8(this._offset),this._offset+=1,this._str(O);case 218:return O=this._view.getUint16(this._offset),this._offset+=2,this._str(O);case 219:return O=this._view.getUint32(this._offset),this._offset+=4,this._str(O);case 220:return O=this._view.getUint16(this._offset),this._offset+=2,this._array(O);case 221:return O=this._view.getUint32(this._offset),this._offset+=4,this._array(O);case 222:return O=this._view.getUint16(this._offset),this._offset+=2,this._map(O);case 223:return O=this._view.getUint32(this._offset),this._offset+=4,this._map(O)}throw new Error("Could not parse")},A.decode=function(M){var A=new O(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),S=A._parse();if(A._offset!==M.byteLength)throw new Error(M.byteLength-A._offset+" trailing bytes");return S};function S(M,A,O){for(var S=0,z=0,Q=O.length;z<Q;z++)(S=O.charCodeAt(z))<128?M.setUint8(A++,S):S<2048?(M.setUint8(A++,192|S>>6),M.setUint8(A++,128|63&S)):S<55296||S>=57344?(M.setUint8(A++,224|S>>12),M.setUint8(A++,128|S>>6&63),M.setUint8(A++,128|63&S)):(z++,S=65536+((1023&S)<<10|1023&O.charCodeAt(z)),M.setUint8(A++,240|S>>18),M.setUint8(A++,128|S>>12&63),M.setUint8(A++,128|S>>6&63),M.setUint8(A++,128|63&S))}function z(M,A,O){var S=typeof O,Q=0,X=0,c=0,j=0,B=0,g=0;if("string"===S){if(B=function(M){for(var A=0,O=0,S=0,z=M.length;S<z;S++)(A=M.charCodeAt(S))<128?O+=1:A<2048?O+=2:A<55296||A>=57344?O+=3:(S++,O+=4);return O}(O),B<32)M.push(160|B),g=1;else if(B<256)M.push(217,B),g=2;else if(B<65536)M.push(218,B>>8,B),g=3;else{if(!(B<4294967296))throw new Error("String too long");M.push(219,B>>24,B>>16,B>>8,B),g=5}return A.push({_str:O,_length:B,_offset:M.length}),g+B}if("number"===S)return Math.floor(O)===O&&isFinite(O)?O>=0?O<128?(M.push(O),1):O<256?(M.push(204,O),2):O<65536?(M.push(205,O>>8,O),3):O<4294967296?(M.push(206,O>>24,O>>16,O>>8,O),5):(c=O/Math.pow(2,32)|0,j=O>>>0,M.push(207,c>>24,c>>16,c>>8,c,j>>24,j>>16,j>>8,j),9):O>=-32?(M.push(O),1):O>=-128?(M.push(208,O),2):O>=-32768?(M.push(209,O>>8,O),3):O>=-2147483648?(M.push(210,O>>24,O>>16,O>>8,O),5):(c=Math.floor(O/Math.pow(2,32)),j=O>>>0,M.push(211,c>>24,c>>16,c>>8,c,j>>24,j>>16,j>>8,j),9):(M.push(203),A.push({_float:O,_length:8,_offset:M.length}),9);if("object"===S){if(null===O)return M.push(192),1;if(Array.isArray(O)){if((B=O.length)<16)M.push(144|B),g=1;else if(B<65536)M.push(220,B>>8,B),g=3;else{if(!(B<4294967296))throw new Error("Array too large");M.push(221,B>>24,B>>16,B>>8,B),g=5}for(Q=0;Q<B;Q++)g+=z(M,A,O[Q]);return g}if(O instanceof Date){var e=O.getTime(),T=Math.floor(e/1e3),J=1e6*(e-1e3*T);return T>=0&&J>=0&&T<=17179869183?0===J&&T<=4294967295?(M.push(214,255,T>>24,T>>16,T>>8,T),6):(c=T/4294967296,j=4294967295&T,M.push(215,255,J>>22,J>>14,J>>6,c,j>>24,j>>16,j>>8,j),10):(c=Math.floor(T/4294967296),j=T>>>0,M.push(199,12,255,J>>24,J>>16,J>>8,J,c>>24,c>>16,c>>8,c,j>>24,j>>16,j>>8,j),15)}if(O instanceof ArrayBuffer){if((B=O.byteLength)<256)M.push(196,B),g=2;else if(B<65536)M.push(197,B>>8,B),g=3;else{if(!(B<4294967296))throw new Error("Buffer too large");M.push(198,B>>24,B>>16,B>>8,B),g=5}return A.push({_bin:O,_length:B,_offset:M.length}),g+B}if("function"===typeof O.toJSON)return z(M,A,O.toJSON());var K=[],G="",d=Object.keys(O);for(Q=0,X=d.length;Q<X;Q++)void 0!==O[G=d[Q]]&&"function"!==typeof O[G]&&K.push(G);if((B=K.length)<16)M.push(128|B),g=1;else if(B<65536)M.push(222,B>>8,B),g=3;else{if(!(B<4294967296))throw new Error("Object too large");M.push(223,B>>24,B>>16,B>>8,B),g=5}for(Q=0;Q<B;Q++)g+=z(M,A,G=K[Q]),g+=z(M,A,O[G]);return g}if("boolean"===S)return M.push(O?195:194),1;if("undefined"===S)return M.push(192),1;if("function"===typeof O.toJSON)return z(M,A,O.toJSON());throw new Error("Could not encode")}A.encode=function(M){var A=[],O=[],Q=z(A,O,M),X=new ArrayBuffer(Q),c=new DataView(X),j=0,B=0,g=-1;O.length>0&&(g=O[0]._offset);for(var e,T=0,J=0,K=0,G=A.length;K<G;K++)if(c.setUint8(B+K,A[K]),K+1===g){if(T=(e=O[j])._length,J=B+g,e._bin)for(var d=new Uint8Array(e._bin),w=0;w<T;w++)c.setUint8(J+w,d[w]);else e._str?S(c,J,e._str):void 0!==e._float&&c.setFloat64(J,e._float);B+=T,O[++j]&&(g=O[j]._offset)}return X}},13683:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.NoneSerializer=void 0;A.NoneSerializer=class{setState(M){}getState(){return null}patch(M){}teardown(){}handshake(M){}}},13681:(M,A,O)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.SchemaSerializer=void 0;const S=O(13647);A.SchemaSerializer=class{setState(M){return this.state.decode(M)}getState(){return this.state}patch(M){return this.state.decode(M)}teardown(){var M,A;null===(A=null===(M=this.state)||void 0===M?void 0:M.$changes)||void 0===A||A.root.clearRefs()}handshake(M,A){if(this.state){(new S.Reflection).decode(M,A)}else this.state=S.Reflection.decode(M,A)}}},13630:(M,A)=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0}),A.getSerializer=A.registerSerializer=void 0;const O={};A.registerSerializer=function(M,A){O[M]=A},A.getSerializer=function(M){const A=O[M];if(!A)throw new Error("missing serializer: "+M);return A}},13617:function(M,A,O){"use strict";var S=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(A,"__esModule",{value:!0}),A.WebSocketTransport=void 0;const z=S(O(13620)),Q=globalThis.WebSocket||z.default;A.WebSocketTransport=class{constructor(M){this.events=M}send(M){M instanceof ArrayBuffer?this.ws.send(M):Array.isArray(M)&&this.ws.send(new Uint8Array(M).buffer)}connect(M,A){try{this.ws=new Q(M,{headers:A,protocols:this.protocols})}catch(O){this.ws=new Q(M,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(M,A){this.ws.close(M,A)}get isOpen(){return this.ws.readyState===Q.OPEN}}},13620:M=>{"use strict";M.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14465:M=>{"use strict";function A(M,O,S){var z=0|M[S];if(z<=0)return[];var Q,X=new Array(z);if(S===M.length-1)for(Q=0;Q<z;++Q)X[Q]=O;else for(Q=0;Q<z;++Q)X[Q]=A(M,O,S+1);return X}M.exports=function(M,O){switch("undefined"===typeof O&&(O=0),typeof M){case"number":if(M>0)return function(M,A){var O,S;for(O=new Array(M),S=0;S<M;++S)O[S]=A;return O}(0|M,O);break;case"object":if("number"===typeof M.length)return A(M,O,0)}return[]}},14422:(M,A,O)=>{M.exports=function(){var M=this;this.components={},this.comps=this.components;var A=this.components,O=1,z={},Q=[],X=[],c={timeout:!1,removals:[],multiComps:[]};function j(M,O){var S=A[O],Q=z[O],X=Q.hash[M];X&&(Q.remove(M),S.mz&&(S.multi?(X.forEach((A=>{A&&S.mz(M,A)})),X.length=0):S.mz(M,X)),c.removals.push(Q),B())}function B(){c.timeout||(c.timeout=!0,setTimeout(g,1))}function g(){c.timeout=!1,e()}function e(){c.multiComps.length&&function(M){for(var A=0;A<M.length;A++){var{entID:O,data:S}=M[A],z=S.hash[O];if(z){for(var Q=0;Q<z.length;Q++)z[Q]||(z.splice(Q,1),Q--);0===z.length&&(S.remove(O),c.removals.push(S))}}M.length=0}(c.multiComps),c.removals.length&&function(M){for(var A=0;A<M.length;A++){M[A].flush()}M.length=0}(c.removals)}this.DT=z,this._systems=Q,this._renderSystems=X,this.NB=function(A){var S=O++;return Array.isArray(A)&&A.forEach((A=>M.sB(S,A))),S},this.deleteEntity=function(A){return Object.keys(z).forEach((M=>{z[M].hash[A]&&j(A,M)})),M},this.Ye=function(M){if(!M)throw new Error("Missing component definition");var O=M.name;if(!O)throw new Error("Component definition must have a name property.");if("string"!==typeof O)throw new Error("Component name must be a string.");if(""===O)throw new Error("Component name must be a non-empty string.");if(z[O])throw new Error("Component ".concat(O," already exists."));var c={};return c.name=O,c.multi=!!M.multi,c.order=isNaN(M.order)?99:M.order,c.stateConstructor=M.stateConstructor||null,c.state=M.state||{},c.bj=M.bj||null,c.mz=M.mz||null,c.system=M.system||null,c.fj=M.fj||null,A[O]=c,z[O]=new S,z[O]._pendingMultiCleanup=!1,z[O]._multiCleanupIDs=c.multi?[]:null,c.system&&(Q.push(O),Q.sort(((M,O)=>A[M].order-A[O].order))),c.fj&&(X.push(O),X.sort(((M,O)=>A[M].order-A[O].order))),O},this.overwriteComponent=function(M,O){var S=A[M];if(!S)throw new Error("Unknown component: ".concat(M));if(!O)throw new Error("Missing component definition");if(S.name!==O.name)throw new Error("Overwriting component must use the same name property.");var c={};c.name=M,c.multi=!!O.multi,c.order=isNaN(O.order)?99:O.order,c.state=O.state||{},c.bj=O.bj||null,c.mz=O.mz||null,c.system=O.system||null,c.fj=O.fj||null,A[M]=c,z[M]._pendingMultiCleanup=!1,z[M]._multiCleanupIDs=c.multi?[]:null;var j=Q.indexOf(M);c.system&&j<0&&Q.push(M),!c.system&&j>=0&&Q.splice(j,1),Q.sort(((M,O)=>A[M].order-A[O].order));var B=X.indexOf(M);c.fj&&B<0&&X.push(M),!c.fj&&B>=0&&X.splice(B,1),X.sort(((M,O)=>A[M].order-A[O].order));var g=c.state;return this.Eg(M).forEach((M=>{for(var A in g)A in M||(M[A]=g[A]);c.bj&&c.bj(M.Hj,M)})),M},this.deleteComponent=function(O){var S=z[O];if(!S)throw new Error("Unknown component: ".concat(O));S.flush(),S.list.forEach((M=>{M&&j(M.Hj||M[0].Hj,O)}));var c=Q.indexOf(O),B=X.indexOf(O);return c>-1&&Q.splice(c,1),B>-1&&X.splice(B,1),z[O].dispose(),delete z[O],delete A[O],M},this.sB=function(M,O,S){var Q,X=A[O],c=z[O];if(!c)throw new Error("Unknown component: ".concat(O,"."));if(c.hash[M]&&!X.multi)throw new Error("Entity ".concat(M," already has component: ").concat(O,"."));if(X.stateConstructor){if(!(Q=new X.stateConstructor).hasOwnProperty("Hj"))throw new Error("Component ".concat(X.name," stateConstructor type does not have property __id"))}else Q=Object.assign({},{Hj:M},X.state,S);if(Q.Hj=M,X.multi){var j=c.hash[M];j||(j=[],c.add(M,j)),j.push(Q)}else c.add(M,Q);return X.bj&&X.bj(M,Q),this},this.uB=function(M,A){var O=z[A];if(!O)throw new Error("Unknown component: ".concat(A,"."));return!!O.hash[M]},this.CB=function(A,O){if(!z[O])throw new Error("Unknown component: ".concat(O,"."));return j(A,O),M},this.getState=function(M,A){var O=z[A];if(!O)throw new Error("Unknown component: ".concat(A,"."));return O.hash[M]},this.Eg=function(M){var A=z[M];if(!A)throw new Error("Unknown component: ".concat(M,"."));return e(),A.list},this.dK=function(M){if(!z[M])throw new Error("Unknown component: ".concat(M,"."));var A=z[M].hash;return M=>A[M]},this.bK=function(M){if(!z[M])throw new Error("Unknown component: ".concat(M,"."));var A=z[M].hash;return M=>!!A[M]},this.Ij=function(O){e();for(var S=0;S<Q.length;S++){var X=Q[S],c=A[X],j=z[X];c.system(O,j.list),e()}return M},this.render=function(O){e();for(var S=0;S<X.length;S++){var Q=X[S],c=A[Q],j=z[Q];c.fj(O,j.list),e()}return M},this.removeMultiComponent=function(O,S,Q){var X=A[S],j=z[S];if(!j)throw new Error("Unknown component: ".concat(S,"."));if(!X.multi)throw new Error("removeMultiComponent called on non-multi component");return function(M,A,O,S){var z=O.hash[M];if(z){var Q=z[S];Q&&(z[S]=null,A.mz&&A.mz(M,Q),c.multiComps.push({entID:M,data:O}),B())}}(O,X,j,Q),M}};var S=O(14430)},14430:M=>{function A(M,A){var O=M._map[A];if(delete M.hash[A],delete M._map[A],O===M.list.length-1)M.list.pop();else{var S=M.list.pop();if(M.list[O]=S,null===S||null===S[0]){var z=M.list.length;for(var Q in M._map)if(M._map[Q]===z)return void(M._map[Q]=O)}else{var X=S.Hj||S[0].Hj;M._map[X]=O}}}M.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(M,A){if("number"===typeof this._map[M]){var O=this._map[M];this.hash[M]=A,this.list[O]=A}else this._map[M]=this.list.length,this.hash[M]=A,this.list.push(A)}remove(M){var A=this._map[M];this.hash[M]=null,this.list[A]=null,this._pendingRemovals.push(M)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var M=0;M<this._pendingRemovals.length;M++){var O=this._pendingRemovals[M];null===this.hash[O]&&A(this,O)}this._pendingRemovals.length=0}}},14807:M=>{"use strict";M.exports=function(M,A,O,S,z,Q){var X=+A[0],c=+A[1],j=+A[2],B=+O[0],g=+O[1],e=+O[2],T=Math.sqrt(B*B+g*g+e*e);if(0===T)throw new Error("Can't raycast along a zero vector");return function(M,A,O,S,z,Q,X,c,j,B){for(var g=0,e=Math.floor,T=0|e(A),J=0|e(O),K=0|e(S),G=z>0?1:-1,d=Q>0?1:-1,w=X>0?1:-1,I=Math.abs(1/z),b=Math.abs(1/Q),s=Math.abs(1/X),Y=I<1/0?I*(G>0?T+1-A:A-T):1/0,E=b<1/0?b*(d>0?J+1-O:O-J):1/0,H=s<1/0?s*(w>0?K+1-S:S-K):1/0,C=-1;g<=c;){var f=M(T,J,K);if(f)return j&&(j[0]=A+g*z,j[1]=O+g*Q,j[2]=S+g*X),B&&(B[0]=B[1]=B[2]=0,0===C&&(B[0]=-G),1===C&&(B[1]=-d),2===C&&(B[2]=-w)),f;Y<E?Y<H?(T+=G,g=Y,Y+=I,C=0):(K+=w,g=H,H+=s,C=2):E<H?(J+=d,g=E,E+=b,C=1):(K+=w,g=H,H+=s,C=2)}return j&&(j[0]=A+g*z,j[1]=O+g*Q,j[2]=S+g*X),B&&(B[0]=B[1]=B[2]=0),0}(M,X,c,j,B/=T,g/=T,e/=T,S="undefined"===typeof S?64:+S,z,Q)}},14840:(M,A,O)=>{"use strict";O.d(A,{b:()=>Q});var S=O(812);function z(){this.wJ=!1,this.stopPropagation=!1,this.IJ=!1,this.disabled=!1}class Q{constructor(M,A){this.version="0.7.0";var O=Object.assign({},new z,A||{});this.element=M||document,this.wJ=!!O.wJ,this.stopPropagation=!!O.stopPropagation,this.IJ=!!O.IJ,this.disabled=!!O.disabled,this.filterEvents=(M,A)=>!0,this.down=new S.EventEmitter,this.up=new S.EventEmitter,this.state={},this.wg={dx:0,dy:0,jK:0,dg:0,BK:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?c(this):document.addEventListener("DOMContentLoaded",(M=>{c(this)}),{once:!0})}bind(M){for(var A=arguments.length,O=new Array(A>1?A-1:0),S=1;S<A;S++)O[S-1]=arguments[S];O.forEach((A=>{var O=this._keyBindmap[A]||[];O.includes(M)||(O.push(M),this._keyBindmap[A]=O)})),this.state[M]=!!this.state[M],this.pressCount[M]=this.pressCount[M]||0,this.releaseCount[M]=this.releaseCount[M]||0}unbind(M){for(var A in this._keyBindmap){var O=this._keyBindmap[A],S=O.indexOf(M);S>-1&&O.splice(S,1)}}getBindings(){var M={};for(var A in this._keyBindmap){this._keyBindmap[A].forEach((O=>{M[O]=M[O]||[],M[O].push(A)}))}return M}Ij(){X(this.wg),X(this.pressCount),X(this.releaseCount)}}function X(M){for(var A in M)M[A]=0}function c(M){window.addEventListener("keydown",K.bind(null,M,!0),!1),window.addEventListener("keyup",K.bind(null,M,!1),!1);var A={passive:!0};M.element.addEventListener("touchstart",e.bind(void 0,M),{passive:!1}),M.element.addEventListener("touchend",J.bind(void 0,M),A),M.element.addEventListener("mousedown",G.bind(null,M,!0),A),window.document.addEventListener("mouseup",G.bind(null,M,!1),A),M.element.addEventListener("touchmove",d.bind(null,M),A),M.element.addEventListener("mousemove",d.bind(null,M),A),window.PointerEvent,M.element.addEventListener("wheel",w.bind(null,M),A),M.element.addEventListener("contextmenu",I.bind(null,M),!1),window.addEventListener("blur",b.bind(null,M),!1)}var j=0,B=0,g=null;function e(M,A){A.preventDefault(),T(A)}function T(M){let A=!1;for(let O=0;O<M.touches.length;++O)if(M.touches[O].identifier===g){A=!0;break}if(!A){const A=M.changedTouches[0];j=A.clientX,B=A.clientY,g=A.identifier}}function J(M,A){for(var O=A.changedTouches,S=0;S<O.length;++S)O[S].identifier===g&&(g=null)}function K(M,A,O){s(O.code,A,M,O)}function G(M,A,O){if("pointerId"in O)if(A){if(null!==M._touches.currID)return;M._touches.currID=O.pointerId}else{if(M._touches.currID!==O.pointerId)return;M._touches.currID=null}return s("Mouse"+("button"in O?O.button+1:1),A,M,O),!1}function d(M,A){var O=A.movementX||A.mozMovementX||0,S=A.movementY||A.mozMovementY||0;if(A.touches&&0===(O|S)){var z=function(M){T(M);for(let A=0;A<M.changedTouches.length;++A)if(M.changedTouches[A].identifier==g){const O=M.changedTouches[A],S=[O.clientX-j,O.clientY-B];return j=O.clientX,B=O.clientY,S}return console.error("Did not find touch id ".concat(g)),[0,0]}(A);O=z[0],S=z[1]}M.wg.dx+=O,M.wg.dy+=S}function w(M,A){var O=1;switch(A.deltaMode){case 0:O=1;break;case 1:O=12;break;case 2:O=M.element.clientHeight||window.innerHeight}M.wg.jK+=(A.deltaX||0)*O,M.wg.dg+=(A.deltaY||0)*O,M.wg.BK+=(A.deltaZ||0)*O}function I(M,A){if(!M.IJ)return A.preventDefault(),!1}function b(M){for(var A in M._keyStates)M._keyStates[A]&&(/^Mouse\d/.test(A)||s(A,!1,M,{code:A,note:"iuc33qhucc",preventDefault:()=>{},stopPropagation:()=>{}}))}function s(M,A,O,S){var z=O._keyBindmap[M];z&&(Y(O._keyStates[M],A)&&(O._keyStates[M]=A,z.forEach((M=>{(!O.filterEvents||O.filterEvents(S,M))&&function(M,A,O,S){var z=A?O.pressCount:O.releaseCount;z[M]=(z[M]||0)+1;var Q=O._bindPressCount[M]||0;(Q+=A?1:-1)<0&&(Q=0);O._bindPressCount[M]=Q;var X=O.state[M];if(Y(X,Q)){O.state[M]=Q>0;var c=A?O.down:O.up;O.disabled||c.emit(M,S)}}(M,A,O,S)}))),"button"in S||(O.wJ&&!S.defaultPrevented&&S.preventDefault(),O.stopPropagation&&S.stopPropagation()))}function Y(M,A){return M?!A:A}},14401:M=>{"use strict";M.exports=function(M){for(var A=new Array(M),O=0;O<M;++O)A[O]=O;return A}},14408:M=>{function A(M){return!!M.constructor&&"function"===typeof M.constructor.isBuffer&&M.constructor.isBuffer(M)}M.exports=function(M){return null!=M&&(A(M)||function(M){return"function"===typeof M.readFloatLE&&"function"===typeof M.slice&&A(M.slice(0,0))}(M)||!!M._isBuffer)}},14809:(M,A,O)=>{"use strict";O.d(A,{d:()=>S});class S{constructor(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ke=!1,this.le=!1,this.mT=30,this.Re=0,this.cT=!1,this.fullscreen=!1,this.AT=function(M){},this.OT=function(){},this.QT=function(){},this.tz=function(){},this.ST=function(M){},this.onFullscreenChanged=function(M){},B((()=>{!function(M,A){M._nowObject=performance||Date,M._lastTick=0,M._renderAccum=0,M._rt=0,M._frameCB=c.bind(null,M),requestAnimationFrame(M._frameCB),A>0&&(M._intervalCB=X.bind(null,M),M._interval=setInterval(M._intervalCB,Math.max(A,1e3/M.mT/2)))}(this,A),function(M,A){if(!A)return;var O=!1,S=!1;document.addEventListener("pointerlockchange",(S=>{O=document.pointerLockElement===A,M.ST(O)})),document.addEventListener("fullscreenchange",(O=>{S=document.fullscreenElement===A,M.onFullscreenChanged(S)})),Object.defineProperty(M,"cT",{get:()=>O,set:M=>{M&&!O?j(A):O&&!M&&function(M){M.exitPointerLock&&M.exitPointerLock()}(document)}}),Object.defineProperty(M,"fullscreen",{get:()=>S,set:M=>{M&&!S?A.requestFullscreen():S&&!M&&document.exitFullscreen()}}),A.addEventListener("click",(z=>{M.ke&&!O&&j(A),M.le&&!S&&A.requestFullscreen()}));var z=()=>M.tz();if(window.ResizeObserver){new ResizeObserver(z).observe(A)}else window.addEventListener("resize",z)}(this,M),this.QT()}))}}var z=3,Q=20;function X(M){for(var A=1e3/M.mT,O=M._nowObject.now()+Q,S=0;M._nowObject.now()>=M._lastTick+A&&M._nowObject.now()<O&&++S<=z;)M.AT(A),M._lastTick+=A;var X=5*(A+5),c=M._nowObject.now();if(c-M._lastTick>X)for(;c>=M._lastTick+A;)M._lastTick+=A}function c(M){requestAnimationFrame(M._frameCB),X(M);var A=M._nowObject.now(),O=A-M._rt;if(M._rt=A,M.Re>0){M._renderAccum+=O;var S=1e3/M.Re;if(M._renderAccum<S)return;M._renderAccum=Math.min(M._renderAccum-S,S)}var z=1e3/M.mT,Q=(A-M._lastTick)/z;M.OT(O,Q,z)}function j(M){M.requestPointerLock&&M.requestPointerLock()}var B=M=>{if("loading"===document.readyState){var A=()=>{document.removeEventListener("readystatechange",A),M()};document.addEventListener("readystatechange",A)}else setTimeout(M,1)}},14393:(M,A,O)=>{var S=O(14401),z=O(14408),Q="undefined"!==typeof Float64Array;function X(M,A){return M[0]-A[0]}function c(){var M,A=this.stride,O=new Array(A.length);for(M=0;M<O.length;++M)O[M]=[Math.abs(A[M]),M];O.sort(X);var S=new Array(O.length);for(M=0;M<S.length;++M)S[M]=O[M][1];return S}function j(M,A){var O=["View",A,"d",M].join("");A<0&&(O="View_Nil"+M);var z="generic"===M;if(-1===A){var Q="function "+O+"(a){this.data=a;};var proto="+O+".prototype;proto.dtype='"+M+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+O+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+O+"(a){return new "+O+"(a);}";return new Function(Q)()}if(0===A){Q="function "+O+"(a,d) {this.data = a;this.offset = d};var proto="+O+".prototype;proto.dtype='"+M+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+O+"_copy() {return new "+O+"(this.data,this.offset)};proto.pick=function "+O+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+O+"_get(){return "+(z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+O+"_set(v){return "+(z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+O+"(a,b,c,d){return new "+O+"(a,d)}";return new Function("TrivialArray",Q)(B[M][0])}Q=["'use strict'"];var X=S(A),j=X.map((function(M){return"i"+M})),g="this.offset+"+X.map((function(M){return"this.stride["+M+"]*i"+M})).join("+"),e=X.map((function(M){return"b"+M})).join(","),T=X.map((function(M){return"c"+M})).join(",");Q.push("function "+O+"(a,"+e+","+T+",d){this.data=a","this.shape=["+e+"]","this.stride=["+T+"]","this.offset=d|0}","var proto="+O+".prototype","proto.dtype='"+M+"'","proto.dimension="+A),Q.push("Object.defineProperty(proto,'size',{get:function "+O+"_size(){return "+X.map((function(M){return"this.shape["+M+"]"})).join("*"),"}})"),1===A?Q.push("proto.order=[0]"):(Q.push("Object.defineProperty(proto,'order',{get:"),A<4?(Q.push("function "+O+"_order(){"),2===A?Q.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===A&&Q.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Q.push("ORDER})")),Q.push("proto.set=function "+O+"_set("+j.join(",")+",v){"),z?Q.push("return this.data.set("+g+",v)}"):Q.push("return this.data["+g+"]=v}"),Q.push("proto.get=function "+O+"_get("+j.join(",")+"){"),z?Q.push("return this.data.get("+g+")}"):Q.push("return this.data["+g+"]}"),Q.push("proto.index=function "+O+"_index(",j.join(),"){return "+g+"}"),Q.push("proto.hi=function "+O+"_hi("+j.join(",")+"){return new "+O+"(this.data,"+X.map((function(M){return["(typeof i",M,"!=='number'||i",M,"<0)?this.shape[",M,"]:i",M,"|0"].join("")})).join(",")+","+X.map((function(M){return"this.stride["+M+"]"})).join(",")+",this.offset)}");var J=X.map((function(M){return"a"+M+"=this.shape["+M+"]"})),K=X.map((function(M){return"c"+M+"=this.stride["+M+"]"}));Q.push("proto.lo=function "+O+"_lo("+j.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+K.join(","));for(var G=0;G<A;++G)Q.push("if(typeof i"+G+"==='number'&&i"+G+">=0){d=i"+G+"|0;b+=c"+G+"*d;a"+G+"-=d}");Q.push("return new "+O+"(this.data,"+X.map((function(M){return"a"+M})).join(",")+","+X.map((function(M){return"c"+M})).join(",")+",b)}"),Q.push("proto.step=function "+O+"_step("+j.join(",")+"){var "+X.map((function(M){return"a"+M+"=this.shape["+M+"]"})).join(",")+","+X.map((function(M){return"b"+M+"=this.stride["+M+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(G=0;G<A;++G)Q.push("if(typeof i"+G+"==='number'){d=i"+G+"|0;if(d<0){c+=b"+G+"*(a"+G+"-1);a"+G+"=ceil(-a"+G+"/d)}else{a"+G+"=ceil(a"+G+"/d)}b"+G+"*=d}");Q.push("return new "+O+"(this.data,"+X.map((function(M){return"a"+M})).join(",")+","+X.map((function(M){return"b"+M})).join(",")+",c)}");var d=new Array(A),w=new Array(A);for(G=0;G<A;++G)d[G]="a[i"+G+"]",w[G]="b[i"+G+"]";Q.push("proto.transpose=function "+O+"_transpose("+j+"){"+j.map((function(M,A){return M+"=("+M+"===undefined?"+A+":"+M+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+O+"(this.data,"+d.join(",")+","+w.join(",")+",this.offset)}"),Q.push("proto.pick=function "+O+"_pick("+j+"){var a=[],b=[],c=this.offset");for(G=0;G<A;++G)Q.push("if(typeof i"+G+"==='number'&&i"+G+">=0){c=(c+this.stride["+G+"]*i"+G+")|0}else{a.push(this.shape["+G+"]);b.push(this.stride["+G+"])}");return Q.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Q.push("return function construct_"+O+"(data,shape,stride,offset){return new "+O+"(data,"+X.map((function(M){return"shape["+M+"]"})).join(",")+","+X.map((function(M){return"stride["+M+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Q.join("\n"))(B[M],c)}var B={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};M.exports=function(M,A,O,S){if(void 0===M)return(0,B.array[0])([]);"number"===typeof M&&(M=[M]),void 0===A&&(A=[M.length]);var X=A.length;if(void 0===O){O=new Array(X);for(var c=X-1,g=1;c>=0;--c)O[c]=g,g*=A[c]}if(void 0===S){S=0;for(c=0;c<X;++c)O[c]<0&&(S-=(A[c]-1)*O[c])}for(var e=function(M){if(z(M))return"buffer";if(Q)switch(Object.prototype.toString.call(M)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(M)?"array":"generic"}(M),T=B[e];T.length<=X+1;)T.push(j(e,T.length-1));return(0,T[X+1])(M,A,O,S)}},14564:M=>{var A;self,A=()=>(()=>{"use strict";var M={d:(A,O)=>{for(var S in O)M.o(O,S)&&!M.o(A,S)&&Object.defineProperty(A,S,{enumerable:!0,get:O[S]})},o:(M,A)=>Object.prototype.hasOwnProperty.call(M,A)},A={};M.d(A,{default:()=>i});var O,S=function(M,A){var O=A.x-M.x,S=A.y-M.y;return Math.sqrt(O*O+S*S)},z=function(M){return M*(Math.PI/180)},Q=new Map,X=function(M){Q.has(M)&&clearTimeout(Q.get(M)),Q.set(M,setTimeout(M,100))},c=function(M,A,O){for(var S,z=A.split(/[ ,]+/g),Q=0;Q<z.length;Q+=1)S=z[Q],M.addEventListener?M.addEventListener(S,O,!1):M.attachEvent&&M.attachEvent(S,O)},j=function(M,A,O){for(var S,z=A.split(/[ ,]+/g),Q=0;Q<z.length;Q+=1)S=z[Q],M.removeEventListener?M.removeEventListener(S,O):M.detachEvent&&M.detachEvent(S,O)},B=function(M){return M.preventDefault(),M.type.match(/^touch/)?M.changedTouches:M},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},e=function(M,A){A.top||A.right||A.bottom||A.left?(M.style.top=A.top,M.style.right=A.right,M.style.bottom=A.bottom,M.style.left=A.left):(M.style.left=A.x+"px",M.style.top=A.y+"px")},T=function(M,A,O){var S=J(M);for(var z in S)if(S.hasOwnProperty(z))if("string"==typeof A)S[z]=A+" "+O;else{for(var Q="",X=0,c=A.length;X<c;X+=1)Q+=A[X]+" "+O+", ";S[z]=Q.slice(0,-2)}return S},J=function(M){var A={};return A[M]="",["webkit","Moz","o"].forEach((function(O){A[O+M.charAt(0).toUpperCase()+M.slice(1)]=""})),A},K=function(M,A){for(var O in A)A.hasOwnProperty(O)&&(M[O]=A[O]);return M},G=function(M,A){if(M.length)for(var O=0,S=M.length;O<S;O+=1)A(M[O]);else A(M)},d="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,w=window.matchMedia("(any-hover: none)").matches,I=!!("ontouchstart"in window),b=!!window.PointerEvent,s=!!window.MSPointerEvent,Y={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},E={start:"mousedown",move:"mousemove",end:"mouseup"},H={};function C(){}d&&!w?O=Y:b?O={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:s?O={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:I?(O=Y,H=E):O=E,C.prototype.on=function(M,A){var O,S=this,z=M.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Q=0;Q<z.length;Q+=1)O=z[Q],S._handlers_[O]=S._handlers_[O]||[],S._handlers_[O].push(A);return S},C.prototype.off=function(M,A){var O=this;return O._handlers_=O._handlers_||{},void 0===M?O._handlers_={}:void 0===A?O._handlers_[M]=null:O._handlers_[M]&&O._handlers_[M].indexOf(A)>=0&&O._handlers_[M].splice(O._handlers_[M].indexOf(A),1),O},C.prototype.trigger=function(M,A){var O,S=this,z=M.split(/[ ,]+/g);S._handlers_=S._handlers_||{};for(var Q=0;Q<z.length;Q+=1)O=z[Q],S._handlers_[O]&&S._handlers_[O].length&&S._handlers_[O].forEach((function(M){M.call(S,{type:O,target:S},A)}))},C.prototype.config=function(M){var A=this;A.options=A.defaults||{},M&&(A.options=function(M,A){var O={};for(var S in M)M.hasOwnProperty(S)&&A.hasOwnProperty(S)?O[S]=A[S]:M.hasOwnProperty(S)&&(O[S]=M[S]);return O}(A.options,M))},C.prototype.bindEvt=function(M,A){var S=this;return S._domHandlers_=S._domHandlers_||{},S._domHandlers_[A]=function(){"function"==typeof S["on"+A]?S["on"+A].apply(S,arguments):console.warn('[WARNING] : Missing "on'+A+'" handler.')},c(M,O[A],S._domHandlers_[A]),H[A]&&c(M,H[A],S._domHandlers_[A]),S},C.prototype.unbindEvt=function(M,A){var S=this;return S._domHandlers_=S._domHandlers_||{},j(M,O[A],S._domHandlers_[A]),H[A]&&j(M,H[A],S._domHandlers_[A]),delete S._domHandlers_[A],this};const f=C;function D(M,A){return this.identifier=A.identifier,this.position=A.position,this.frontPosition=A.frontPosition,this.collection=M,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(A),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=D.id,D.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}D.prototype=new f,D.constructor=D,D.id=0,D.prototype.buildEl=function(M){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},D.prototype.stylize=function(){if(this.options.dataOnly)return this;var M=this.options.fadeTime+"ms",A=function(){var M=J("borderRadius");for(var A in M)M.hasOwnProperty(A)&&(M[A]="50%");return M}(),O=T("transition","opacity",M),S={};return S.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},S.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},S.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},K(S.el,O),"circle"===this.options.shape&&K(S.back,A),K(S.front,A),this.applyStyles(S),this},D.prototype.applyStyles=function(M){for(var A in this.ui)if(this.ui.hasOwnProperty(A))for(var O in M[A])this.ui[A].style[O]=M[A][O];return this},D.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},D.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},D.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},D.prototype.show=function(M){var A=this;return A.options.dataOnly||(clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.addToDom(),A.restCallback(),setTimeout((function(){A.ui.el.style.opacity=1}),0),A.showTimeout=setTimeout((function(){A.trigger("shown",A.instance),"function"==typeof M&&M.call(this)}),A.options.fadeTime)),A},D.prototype.hide=function(M){var A=this;if(A.options.dataOnly)return A;if(A.ui.el.style.opacity=A.options.restOpacity,clearTimeout(A.removeTimeout),clearTimeout(A.showTimeout),clearTimeout(A.restTimeout),A.removeTimeout=setTimeout((function(){var O="dynamic"===A.options.mode?"none":"block";A.ui.el.style.display=O,"function"==typeof M&&M.call(A),A.trigger("hidden",A.instance)}),A.options.fadeTime),A.options.restJoystick){var O=A.options.restJoystick,S={};S.x=!0===O||!1!==O.x?0:A.instance.frontPosition.x,S.y=!0===O||!1!==O.y?0:A.instance.frontPosition.y,A.setPosition(M,S)}return A},D.prototype.setPosition=function(M,A){var O=this;O.frontPosition={x:A.x,y:A.y};var S=O.options.fadeTime+"ms",z={};z.front=T("transition",["transform"],S);var Q={front:{}};Q.front={transform:"translate("+O.frontPosition.x+"px,"+O.frontPosition.y+"px)"},O.applyStyles(z),O.applyStyles(Q),O.restTimeout=setTimeout((function(){"function"==typeof M&&M.call(O),O.restCallback()}),O.options.fadeTime)},D.prototype.restCallback=function(){var M=this,A={};A.front=T("transition","none",""),M.applyStyles(A),M.trigger("rested",M.instance)},D.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},D.prototype.computeDirection=function(M){var A,O,S,z=M.angle.radian,Q=Math.PI/4,X=Math.PI/2;if(z>Q&&z<3*Q&&!M.lockX?A="up":z>-Q&&z<=Q&&!M.lockY?A="left":z>3*-Q&&z<=-Q&&!M.lockX?A="down":M.lockY||(A="right"),M.lockY||(O=z>-X&&z<X?"left":"right"),M.lockX||(S=z>0?"up":"down"),M.force>this.options.threshold){var c,j={};for(c in this.direction)this.direction.hasOwnProperty(c)&&(j[c]=this.direction[c]);var B={};for(c in this.direction={x:O,y:S,angle:A},M.direction=this.direction,j)j[c]===this.direction[c]&&(B[c]=!0);if(B.x&&B.y&&B.angle)return M;B.x&&B.y||this.trigger("plain",M),B.x||this.trigger("plain:"+O,M),B.y||this.trigger("plain:"+S,M),B.angle||this.trigger("dir dir:"+A,M)}else this.resetDirection();return M};const F=D;function N(M,A){var O=this;O.nipples=[],O.idles=[],O.actives=[],O.ids=[],O.pressureIntervals={},O.manager=M,O.id=N.id,N.id+=1,O.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},O.config(A),"static"!==O.options.mode&&"semi"!==O.options.mode||(O.options.multitouch=!1),O.options.multitouch||(O.options.maxNumberOfNipples=1);var S=getComputedStyle(O.options.zone.parentElement);return S&&"flex"===S.display&&(O.parentIsFlex=!0),O.updateBox(),O.prepareNipples(),O.bJ(),O.begin(),O.nipples}N.prototype=new f,N.constructor=N,N.id=0,N.prototype.prepareNipples=function(){var M=this,A=M.nipples;A.on=M.on.bind(M),A.off=M.off.bind(M),A.options=M.options,A.destroy=M.destroy.bind(M),A.ids=M.ids,A.id=M.id,A.processOnMove=M.processOnMove.bind(M),A.processOnEnd=M.processOnEnd.bind(M),A.get=function(M){if(void 0===M)return A[0];for(var O=0,S=A.length;O<S;O+=1)if(A[O].identifier===M)return A[O];return!1}},N.prototype.bJ=function(){var M=this;M.bindEvt(M.options.zone,"start"),M.options.zone.style.touchAction="none",M.options.zone.style.msTouchAction="none"},N.prototype.begin=function(){var M=this,A=M.options;if("static"===A.mode){var O=M.createNipple(A.position,M.manager.getIdentifier());O.add(),M.idles.push(O)}},N.prototype.createNipple=function(M,A){var O=this,S=O.manager.scroll,z={},Q=O.options,X=O.parentIsFlex?S.x:S.x+O.box.left,c=O.parentIsFlex?S.y:S.y+O.box.top;if(M.x&&M.y)z={x:M.x-X,y:M.y-c};else if(M.top||M.right||M.bottom||M.left){var j=document.createElement("DIV");j.style.display="hidden",j.style.top=M.top,j.style.right=M.right,j.style.bottom=M.bottom,j.style.left=M.left,j.style.position="absolute",Q.zone.appendChild(j);var B=j.getBoundingClientRect();Q.zone.removeChild(j),z=M,M={x:B.left+S.x,y:B.top+S.y}}var g=new F(O,{color:Q.color,size:Q.size,threshold:Q.threshold,fadeTime:Q.fadeTime,dataOnly:Q.dataOnly,restJoystick:Q.restJoystick,restOpacity:Q.restOpacity,mode:Q.mode,identifier:A,position:M,zone:Q.zone,frontPosition:{x:0,y:0},shape:Q.shape});return Q.dataOnly||(e(g.ui.el,z),e(g.ui.front,g.frontPosition)),O.nipples.push(g),O.trigger("added "+g.identifier+":added",g),O.manager.trigger("added "+g.identifier+":added",g),O.bindNipple(g),g},N.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},N.prototype.bindNipple=function(M){var A,O=this,S=function(M,S){A=M.type+" "+S.id+":"+M.type,O.trigger(A,S)};M.on("destroyed",O.onDestroyed.bind(O)),M.on("shown hidden rested dir plain",S),M.on("dir:up dir:right dir:down dir:left",S),M.on("plain:up plain:right plain:down plain:left",S)},N.prototype.pressureFn=function(M,A,O){var S=this,z=0;clearInterval(S.pressureIntervals[O]),S.pressureIntervals[O]=setInterval(function(){var O=M.force||M.pressure||M.webkitForce||0;O!==z&&(A.trigger("pressure",O),S.trigger("pressure "+A.identifier+":pressure",O),z=O)}.bind(S),100)},N.prototype.onstart=function(M){var A=this,O=A.options,S=M;return M=B(M),A.updateBox(),G(M,(function(z){A.actives.length<O.maxNumberOfNipples?A.processOnStart(z):S.type.match(/^touch/)&&(Object.keys(A.manager.ids).forEach((function(O){if(Object.values(S.touches).findIndex((function(M){return M.identifier===O}))<0){var z=[M[0]];z.identifier=O,A.processOnEnd(z)}})),A.actives.length<O.maxNumberOfNipples&&A.processOnStart(z))})),A.manager.bindDocument(),!1},N.prototype.processOnStart=function(M){var A,O=this,z=O.options,Q=O.manager.getIdentifier(M),X=M.force||M.pressure||M.webkitForce||0,c={x:M.pageX,y:M.pageY},j=O.getOrCreate(Q,c);j.identifier!==Q&&O.manager.removeIdentifier(j.identifier),j.identifier=Q;var B=function(A){A.trigger("start",A),O.trigger("start "+A.id+":start",A),A.show(),X>0&&O.pressureFn(M,A,A.identifier),O.processOnMove(M)};if((A=O.idles.indexOf(j))>=0&&O.idles.splice(A,1),O.actives.push(j),O.ids.push(j.identifier),"semi"!==z.mode)B(j);else{if(!(S(c,j.position)<=z.catchDistance))return j.destroy(),void O.processOnStart(M);B(j)}return j},N.prototype.getOrCreate=function(M,A){var O,S=this,z=S.options;return/(semi|static)/.test(z.mode)?(O=S.idles[0])?(S.idles.splice(0,1),O):"semi"===z.mode?S.createNipple(A,M):(console.warn("Coudln't find the needed nipple."),!1):O=S.createNipple(A,M)},N.prototype.processOnMove=function(M){var A=this,O=A.options,Q=A.manager.getIdentifier(M),X=A.nipples.get(Q),c=A.manager.scroll;if(function(M){return isNaN(M.buttons)?0!==M.pressure:0!==M.buttons}(M)){if(!X)return console.error("Found zombie joystick with ID "+Q),void A.manager.removeIdentifier(Q);if(O.dynamicPage){var j=X.el.getBoundingClientRect();X.position={x:c.x+j.left,y:c.y+j.top}}X.identifier=Q;var B=X.options.size/2,g={x:M.pageX,y:M.pageY};O.lockX&&(g.y=X.position.y),O.lockY&&(g.x=X.position.x);var e,T,J,K,G,d,w,I,b,s,Y=S(g,X.position),E=(e=g,J=(T=X.position).x-e.x,K=T.y-e.y,function(M){return M*(180/Math.PI)}(Math.atan2(K,J))),H=z(E),C=Y/B,f={distance:Y,position:g};if("circle"===X.options.shape?(G=Math.min(Y,B),w=X.position,I=G,s={x:0,y:0},b=z(b=E),s.x=w.x-I*Math.cos(b),s.y=w.y-I*Math.sin(b),d=s):(d=function(M,A,O){return{x:Math.min(Math.max(M.x,A.x-O),A.x+O),y:Math.min(Math.max(M.y,A.y-O),A.y+O)}}(g,X.position,B),G=S(d,X.position)),O.follow){if(Y>B){var D=g.x-d.x,F=g.y-d.y;X.position.x+=D,X.position.y+=F,X.el.style.top=X.position.y-(A.box.top+c.y)+"px",X.el.style.left=X.position.x-(A.box.left+c.x)+"px",Y=S(g,X.position)}}else g=d,Y=G;var N=g.x-X.position.x,y=g.y-X.position.y;X.frontPosition={x:N,y:y},O.dataOnly||(X.ui.front.style.transform="translate("+N+"px,"+y+"px)");var h={identifier:X.identifier,position:g,force:C,pressure:M.force||M.pressure||M.webkitForce||0,distance:Y,angle:{radian:H,degree:E},vector:{x:N/B,y:-y/B},raw:f,instance:X,lockX:O.lockX,lockY:O.lockY};(h=X.computeDirection(h)).angle={radian:z(180-E),degree:180-E},X.trigger("move",h),A.trigger("move "+X.id+":move",h)}else this.processOnEnd(M)},N.prototype.processOnEnd=function(M){var A=this,O=A.options,S=A.manager.getIdentifier(M),z=A.nipples.get(S),Q=A.manager.removeIdentifier(z.identifier);z&&(O.dataOnly||z.hide((function(){"dynamic"===O.mode&&(z.trigger("removed",z),A.trigger("removed "+z.id+":removed",z),A.manager.trigger("removed "+z.id+":removed",z),z.destroy())})),clearInterval(A.pressureIntervals[z.identifier]),z.resetDirection(),z.trigger("end",z),A.trigger("end "+z.id+":end",z),A.ids.indexOf(z.identifier)>=0&&A.ids.splice(A.ids.indexOf(z.identifier),1),A.actives.indexOf(z)>=0&&A.actives.splice(A.actives.indexOf(z),1),/(semi|static)/.test(O.mode)?A.idles.push(z):A.nipples.indexOf(z)>=0&&A.nipples.splice(A.nipples.indexOf(z),1),A.manager.unbindDocument(),/(semi|static)/.test(O.mode)&&(A.manager.ids[Q.id]=Q.identifier))},N.prototype.onDestroyed=function(M,A){var O=this;O.nipples.indexOf(A)>=0&&O.nipples.splice(O.nipples.indexOf(A),1),O.actives.indexOf(A)>=0&&O.actives.splice(O.actives.indexOf(A),1),O.idles.indexOf(A)>=0&&O.idles.splice(O.idles.indexOf(A),1),O.ids.indexOf(A.identifier)>=0&&O.ids.splice(O.ids.indexOf(A.identifier),1),O.manager.removeIdentifier(A.identifier),O.manager.unbindDocument()},N.prototype.destroy=function(){var M=this;for(var A in M.unbindEvt(M.options.zone,"start"),M.nipples.forEach((function(M){M.destroy()})),M.pressureIntervals)M.pressureIntervals.hasOwnProperty(A)&&clearInterval(M.pressureIntervals[A]);M.trigger("destroyed",M.nipples),M.manager.unbindDocument(),M.off()};const y=N;function h(M){var A=this;A.ids={},A.index=0,A.collections=[],A.scroll=g(),A.config(M),A.prepareCollections();var O=function(){var M;A.collections.forEach((function(O){O.forEach((function(O){M=O.el.getBoundingClientRect(),O.position={x:A.scroll.x+M.left,y:A.scroll.y+M.top}}))}))};c(window,"resize",(function(){X(O)}));var S=function(){A.scroll=g()};return c(window,"scroll",(function(){X(S)})),A.collections}h.prototype=new f,h.constructor=h,h.prototype.prepareCollections=function(){var M=this;M.collections.create=M.create.bind(M),M.collections.on=M.on.bind(M),M.collections.off=M.off.bind(M),M.collections.destroy=M.destroy.bind(M),M.collections.get=function(A){var O;return M.collections.every((function(M){return!(O=M.get(A))})),O}},h.prototype.create=function(M){return this.createCollection(M)},h.prototype.createCollection=function(M){var A=this,O=new y(A,M);return A.bindCollection(O),A.collections.push(O),O},h.prototype.bindCollection=function(M){var A,O=this,S=function(M,S){A=M.type+" "+S.id+":"+M.type,O.trigger(A,S)};M.on("destroyed",O.onDestroyed.bind(O)),M.on("shown hidden rested dir plain",S),M.on("dir:up dir:right dir:down dir:left",S),M.on("plain:up plain:right plain:down plain:left",S)},h.prototype.bindDocument=function(){var M=this;M.binded||(M.bindEvt(document,"move").bindEvt(document,"end"),M.binded=!0)},h.prototype.unbindDocument=function(M){var A=this;Object.keys(A.ids).length&&!0!==M||(A.unbindEvt(document,"move").unbindEvt(document,"end"),A.binded=!1)},h.prototype.getIdentifier=function(M){var A;return M?void 0===(A=void 0===M.identifier?M.pointerId:M.identifier)&&(A=this.latest||0):A=this.index,void 0===this.ids[A]&&(this.ids[A]=this.index,this.index+=1),this.latest=A,this.ids[A]},h.prototype.removeIdentifier=function(M){var A={};for(var O in this.ids)if(this.ids[O]===M){A.id=O,A.identifier=this.ids[O],delete this.ids[O];break}return A},h.prototype.onmove=function(M){return this.onAny("move",M),!1},h.prototype.onend=function(M){return this.onAny("end",M),!1},h.prototype.oncancel=function(M){return this.onAny("end",M),!1},h.prototype.onAny=function(M,A){var O,S=this,z="processOn"+M.charAt(0).toUpperCase()+M.slice(1);A=B(A);var Q=function(M,A,O){O.ids.indexOf(A)>=0&&(O[z](M),M._found_=!0)};return G(A,(function(M){O=S.getIdentifier(M),G(S.collections,Q.bind(null,M,O)),M._found_||S.removeIdentifier(O)})),!1},h.prototype.destroy=function(){var M=this;M.unbindDocument(!0),M.ids={},M.index=0,M.collections.forEach((function(M){M.destroy()})),M.off()},h.prototype.onDestroyed=function(M,A){var O=this;if(O.collections.indexOf(A)<0)return!1;O.collections.splice(O.collections.indexOf(A),1)};var u=new h;const i={create:function(M){return u.create(M)},factory:u};return A.default})(),M.exports=A()},14614:(M,A,O)=>{"use strict";const{Deflate:S,deflate:z,deflateRaw:Q,gzip:X}=O(14620),{Inflate:c,inflate:j,inflateRaw:B,ungzip:g}=O(14670),e=O(14649);M.exports.Deflate=S,M.exports.deflate=z,M.exports.deflateRaw=Q,M.exports.gzip=X,M.exports.Inflate=c,M.exports.inflate=j,M.exports.inflateRaw=B,M.exports.ungzip=g,M.exports.constants=e},14620:(M,A,O)=>{"use strict";const S=O(14626),z=O(14658),Q=O(14662),X=O(14646),c=O(14667),j=Object.prototype.toString,{Z_NO_FLUSH:B,Z_SYNC_FLUSH:g,Z_FULL_FLUSH:e,Z_FINISH:T,Z_OK:J,Z_STREAM_END:K,Z_DEFAULT_COMPRESSION:G,Z_DEFAULT_STRATEGY:d,Z_DEFLATED:w}=O(14649);function I(M){this.options=z.assign({level:G,method:w,oM:16384,windowBits:15,memLevel:8,strategy:d},M||{});let A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.BA="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;let O=S.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(O!==J)throw new Error(X[O]);if(A.header&&S.deflateSetHeader(this.strm,A.header),A.dictionary){let M;if(M="string"===typeof A.dictionary?Q.string2buf(A.dictionary):"[object ArrayBuffer]"===j.call(A.dictionary)?new Uint8Array(A.dictionary):A.dictionary,O=S.deflateSetDictionary(this.strm,M),O!==J)throw new Error(X[O]);this._dict_set=!0}}function b(M,A){const O=new I(A);if(O.push(M,!0),O.err)throw O.BA||X[O.err];return O.result}I.prototype.push=function(M,A){const O=this.strm,z=this.options.oM;let X,c;if(this.ended)return!1;for(c=A===~~A?A:!0===A?T:B,"string"===typeof M?O.input=Q.string2buf(M):"[object ArrayBuffer]"===j.call(M)?O.input=new Uint8Array(M):O.input=M,O.next_in=0,O.avail_in=O.input.length;;)if(0===O.avail_out&&(O.output=new Uint8Array(z),O.next_out=0,O.avail_out=z),(c===g||c===e)&&O.avail_out<=6)this.onData(O.output.subarray(0,O.next_out)),O.avail_out=0;else{if(X=S.deflate(O,c),X===K)return O.next_out>0&&this.onData(O.output.subarray(0,O.next_out)),X=S.deflateEnd(this.strm),this.onEnd(X),this.ended=!0,X===J;if(0!==O.avail_out){if(c>0&&O.next_out>0)this.onData(O.output.subarray(0,O.next_out)),O.avail_out=0;else if(0===O.avail_in)break}else this.onData(O.output)}return!0},I.prototype.onData=function(M){this.chunks.push(M)},I.prototype.onEnd=function(M){M===J&&(this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.BA=this.strm.BA},M.exports.Deflate=I,M.exports.deflate=b,M.exports.deflateRaw=function(M,A){return(A=A||{}).raw=!0,b(M,A)},M.exports.gzip=function(M,A){return(A=A||{}).gzip=!0,b(M,A)},M.exports.constants=O(14649)},14670:(M,A,O)=>{"use strict";const S=O(14677),z=O(14658),Q=O(14662),X=O(14646),c=O(14667),j=O(14688),B=Object.prototype.toString,{Z_NO_FLUSH:g,Z_FINISH:e,Z_OK:T,Z_STREAM_END:J,Z_NEED_DICT:K,Z_STREAM_ERROR:G,Z_DATA_ERROR:d,Z_MEM_ERROR:w}=O(14649);function I(M){this.options=z.assign({oM:65536,windowBits:15,to:""},M||{});const A=this.options;A.raw&&A.windowBits>=0&&A.windowBits<16&&(A.windowBits=-A.windowBits,0===A.windowBits&&(A.windowBits=-15)),!(A.windowBits>=0&&A.windowBits<16)||M&&M.windowBits||(A.windowBits+=32),A.windowBits>15&&A.windowBits<48&&0===(15&A.windowBits)&&(A.windowBits|=15),this.err=0,this.BA="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;let O=S.inflateInit2(this.strm,A.windowBits);if(O!==T)throw new Error(X[O]);if(this.header=new j,S.inflateGetHeader(this.strm,this.header),A.dictionary&&("string"===typeof A.dictionary?A.dictionary=Q.string2buf(A.dictionary):"[object ArrayBuffer]"===B.call(A.dictionary)&&(A.dictionary=new Uint8Array(A.dictionary)),A.raw&&(O=S.inflateSetDictionary(this.strm,A.dictionary),O!==T)))throw new Error(X[O])}function b(M,A){const O=new I(A);if(O.push(M),O.err)throw O.BA||X[O.err];return O.result}I.prototype.push=function(M,A){const O=this.strm,z=this.options.oM,X=this.options.dictionary;let c,j,I;if(this.ended)return!1;for(j=A===~~A?A:!0===A?e:g,"[object ArrayBuffer]"===B.call(M)?O.input=new Uint8Array(M):O.input=M,O.next_in=0,O.avail_in=O.input.length;;){for(0===O.avail_out&&(O.output=new Uint8Array(z),O.next_out=0,O.avail_out=z),c=S.inflate(O,j),c===K&&X&&(c=S.inflateSetDictionary(O,X),c===T?c=S.inflate(O,j):c===d&&(c=K));O.avail_in>0&&c===J&&O.state.wrap>0&&0!==M[O.next_in];)S.inflateReset(O),c=S.inflate(O,j);switch(c){case G:case d:case K:case w:return this.onEnd(c),this.ended=!0,!1}if(I=O.avail_out,O.next_out&&(0===O.avail_out||c===J))if("string"===this.options.to){let M=Q.utf8border(O.output,O.next_out),A=O.next_out-M,S=Q.buf2string(O.output,M);O.next_out=A,O.avail_out=z-A,A&&O.output.set(O.output.subarray(M,M+A),0),this.onData(S)}else this.onData(O.output.length===O.next_out?O.output:O.output.subarray(0,O.next_out));if(c!==T||0!==I){if(c===J)return c=S.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(0===O.avail_in)break}}return!0},I.prototype.onData=function(M){this.chunks.push(M)},I.prototype.onEnd=function(M){M===T&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.BA=this.strm.BA},M.exports.Inflate=I,M.exports.inflate=b,M.exports.inflateRaw=function(M,A){return(A=A||{}).raw=!0,b(M,A)},M.exports.ungzip=b,M.exports.constants=O(14649)},14658:M=>{"use strict";const A=(M,A)=>Object.prototype.hasOwnProperty.call(M,A);M.exports.assign=function(M){const O=Array.prototype.slice.call(arguments,1);for(;O.length;){const S=O.shift();if(S){if("object"!==typeof S)throw new TypeError(S+"must be non-object");for(const O in S)A(S,O)&&(M[O]=S[O])}}return M},M.exports.flattenChunks=M=>{let A=0;for(let S=0,z=M.length;S<z;S++)A+=M[S].length;const O=new Uint8Array(A);for(let S=0,z=0,Q=M.length;S<Q;S++){let A=M[S];O.set(A,z),z+=A.length}return O}},14662:M=>{"use strict";let A=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(S){A=!1}const O=new Uint8Array(256);for(let z=0;z<256;z++)O[z]=z>=252?6:z>=248?5:z>=240?4:z>=224?3:z>=192?2:1;O[254]=O[254]=1,M.exports.string2buf=M=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(M);let A,O,S,z,Q,X=M.length,c=0;for(z=0;z<X;z++)O=M.charCodeAt(z),55296===(64512&O)&&z+1<X&&(S=M.charCodeAt(z+1),56320===(64512&S)&&(O=65536+(O-55296<<10)+(S-56320),z++)),c+=O<128?1:O<2048?2:O<65536?3:4;for(A=new Uint8Array(c),Q=0,z=0;Q<c;z++)O=M.charCodeAt(z),55296===(64512&O)&&z+1<X&&(S=M.charCodeAt(z+1),56320===(64512&S)&&(O=65536+(O-55296<<10)+(S-56320),z++)),O<128?A[Q++]=O:O<2048?(A[Q++]=192|O>>>6,A[Q++]=128|63&O):O<65536?(A[Q++]=224|O>>>12,A[Q++]=128|O>>>6&63,A[Q++]=128|63&O):(A[Q++]=240|O>>>18,A[Q++]=128|O>>>12&63,A[Q++]=128|O>>>6&63,A[Q++]=128|63&O);return A};M.exports.buf2string=(M,S)=>{const z=S||M.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(M.subarray(0,S));let Q,X;const c=new Array(2*z);for(X=0,Q=0;Q<z;){let A=M[Q++];if(A<128){c[X++]=A;continue}let S=O[A];if(S>4)c[X++]=65533,Q+=S-1;else{for(A&=2===S?31:3===S?15:7;S>1&&Q<z;)A=A<<6|63&M[Q++],S--;S>1?c[X++]=65533:A<65536?c[X++]=A:(A-=65536,c[X++]=55296|A>>10&1023,c[X++]=56320|1023&A)}}return((M,O)=>{if(O<65534&&M.subarray&&A)return String.fromCharCode.apply(null,M.length===O?M:M.subarray(0,O));let S="";for(let A=0;A<O;A++)S+=String.fromCharCode(M[A]);return S})(c,X)},M.exports.utf8border=(M,A)=>{(A=A||M.length)>M.length&&(A=M.length);let S=A-1;for(;S>=0&&128===(192&M[S]);)S--;return S<0||0===S?A:S+O[M[S]]>A?S:A}},14641:M=>{"use strict";M.exports=(M,A,O,S)=>{let z=65535&M,Q=M>>>16&65535,X=0;for(;0!==O;){X=O>2e3?2e3:O,O-=X;do{z=z+A[S++]|0,Q=Q+z|0}while(--X);z%=65521,Q%=65521}return z|Q<<16}},14649:M=>{"use strict";M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14643:M=>{"use strict";const A=new Uint32Array((()=>{let M,A=[];for(var O=0;O<256;O++){M=O;for(var S=0;S<8;S++)M=1&M?3988292384^M>>>1:M>>>1;A[O]=M}return A})());M.exports=(M,O,S,z)=>{const Q=A,X=z+S;M^=-1;for(let A=z;A<X;A++)M=M>>>8^Q[255&(M^O[A])];return~M}},14626:(M,A,O)=>{"use strict";const{_tr_init:S,_tr_stored_block:z,_tr_flush_block:Q,_tr_tally:X,_tr_align:c}=O(14635),j=O(14641),B=O(14643),g=O(14646),{Z_NO_FLUSH:e,Z_PARTIAL_FLUSH:T,Z_FULL_FLUSH:J,Z_FINISH:K,Z_BLOCK:G,Z_OK:d,Z_STREAM_END:w,Z_STREAM_ERROR:I,Z_DATA_ERROR:b,Z_BUF_ERROR:s,Z_DEFAULT_COMPRESSION:Y,Z_FILTERED:E,Z_HUFFMAN_ONLY:H,Z_RLE:C,Z_FIXED:f,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:F,Z_DEFLATED:N}=O(14649),y=258,h=262,u=103,i=113,U=666,L=(M,A)=>(M.BA=g[A],A),t=M=>(M<<1)-(M>4?9:0),x=M=>{let A=M.length;for(;--A>=0;)M[A]=0};let o=(M,A,O)=>(A<<M.hash_shift^O)&M.hash_mask;const p=M=>{const A=M.state;let O=A.pending;O>M.avail_out&&(O=M.avail_out),0!==O&&(M.output.set(A.pending_buf.subarray(A.pending_out,A.pending_out+O),M.next_out),M.next_out+=O,A.pending_out+=O,M.total_out+=O,M.avail_out-=O,A.pending-=O,0===A.pending&&(A.pending_out=0))},v=(M,A)=>{Q(M,M.block_start>=0?M.block_start:-1,M.strstart-M.block_start,A),M.block_start=M.strstart,p(M.strm)},q=(M,A)=>{M.pending_buf[M.pending++]=A},r=(M,A)=>{M.pending_buf[M.pending++]=A>>>8&255,M.pending_buf[M.pending++]=255&A},n=(M,A,O,S)=>{let z=M.avail_in;return z>S&&(z=S),0===z?0:(M.avail_in-=z,A.set(M.input.subarray(M.next_in,M.next_in+z),O),1===M.state.wrap?M.adler=j(M.adler,A,z,O):2===M.state.wrap&&(M.adler=B(M.adler,A,z,O)),M.next_in+=z,M.total_in+=z,z)},a=(M,A)=>{let O,S,z=M.max_chain_length,Q=M.strstart,X=M.prev_length,c=M.nice_match;const j=M.strstart>M.w_size-h?M.strstart-(M.w_size-h):0,B=M.window,g=M.w_mask,e=M.prev,T=M.strstart+y;let J=B[Q+X-1],K=B[Q+X];M.prev_length>=M.good_match&&(z>>=2),c>M.lookahead&&(c=M.lookahead);do{if(O=A,B[O+X]===K&&B[O+X-1]===J&&B[O]===B[Q]&&B[++O]===B[Q+1]){Q+=2,O++;do{}while(B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&B[++Q]===B[++O]&&Q<T);if(S=y-(T-Q),Q=T-y,S>X){if(M.match_start=A,X=S,S>=c)break;J=B[Q+X-1],K=B[Q+X]}}}while((A=e[A&g])>j&&0!==--z);return X<=M.lookahead?X:M.lookahead},V=M=>{const A=M.w_size;let O,S,z,Q,X;do{if(Q=M.window_size-M.lookahead-M.strstart,M.strstart>=A+(A-h)){M.window.set(M.window.subarray(A,A+A),0),M.match_start-=A,M.strstart-=A,M.block_start-=A,S=M.hash_size,O=S;do{z=M.head[--O],M.head[O]=z>=A?z-A:0}while(--S);S=A,O=S;do{z=M.prev[--O],M.prev[O]=z>=A?z-A:0}while(--S);Q+=A}if(0===M.strm.avail_in)break;if(S=n(M.strm,M.window,M.strstart+M.lookahead,Q),M.lookahead+=S,M.lookahead+M.insert>=3)for(X=M.strstart-M.insert,M.ins_h=M.window[X],M.ins_h=o(M,M.ins_h,M.window[X+1]);M.insert&&(M.ins_h=o(M,M.ins_h,M.window[X+3-1]),M.prev[X&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=X,X++,M.insert--,!(M.lookahead+M.insert<3)););}while(M.lookahead<h&&0!==M.strm.avail_in)},Z=(M,A)=>{let O,S;for(;;){if(M.lookahead<h){if(V(M),M.lookahead<h&&A===e)return 1;if(0===M.lookahead)break}if(O=0,M.lookahead>=3&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),O=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),0!==O&&M.strstart-O<=M.w_size-h&&(M.match_length=a(M,O)),M.match_length>=3)if(S=X(M,M.strstart-M.match_start,M.match_length-3),M.lookahead-=M.match_length,M.match_length<=M.max_lazy_match&&M.lookahead>=3){M.match_length--;do{M.strstart++,M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),O=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart}while(0!==--M.match_length);M.strstart++}else M.strstart+=M.match_length,M.match_length=0,M.ins_h=M.window[M.strstart],M.ins_h=o(M,M.ins_h,M.window[M.strstart+1]);else S=X(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++;if(S&&(v(M,!1),0===M.strm.avail_out))return 1}return M.insert=M.strstart<2?M.strstart:2,A===K?(v(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(v(M,!1),0===M.strm.avail_out)?1:2},P=(M,A)=>{let O,S,z;for(;;){if(M.lookahead<h){if(V(M),M.lookahead<h&&A===e)return 1;if(0===M.lookahead)break}if(O=0,M.lookahead>=3&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),O=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart),M.prev_length=M.match_length,M.prev_match=M.match_start,M.match_length=2,0!==O&&M.prev_length<M.max_lazy_match&&M.strstart-O<=M.w_size-h&&(M.match_length=a(M,O),M.match_length<=5&&(M.strategy===E||3===M.match_length&&M.strstart-M.match_start>4096)&&(M.match_length=2)),M.prev_length>=3&&M.match_length<=M.prev_length){z=M.strstart+M.lookahead-3,S=X(M,M.strstart-1-M.prev_match,M.prev_length-3),M.lookahead-=M.prev_length-1,M.prev_length-=2;do{++M.strstart<=z&&(M.ins_h=o(M,M.ins_h,M.window[M.strstart+3-1]),O=M.prev[M.strstart&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=M.strstart)}while(0!==--M.prev_length);if(M.match_available=0,M.match_length=2,M.strstart++,S&&(v(M,!1),0===M.strm.avail_out))return 1}else if(M.match_available){if(S=X(M,0,M.window[M.strstart-1]),S&&v(M,!1),M.strstart++,M.lookahead--,0===M.strm.avail_out)return 1}else M.match_available=1,M.strstart++,M.lookahead--}return M.match_available&&(S=X(M,0,M.window[M.strstart-1]),M.match_available=0),M.insert=M.strstart<2?M.strstart:2,A===K?(v(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(v(M,!1),0===M.strm.avail_out)?1:2};function mM(M,A,O,S,z){this.good_length=M,this.max_lazy=A,this.nice_length=O,this.max_chain=S,this.func=z}const R=[new mM(0,0,0,0,((M,A)=>{let O=65535;for(O>M.pending_buf_size-5&&(O=M.pending_buf_size-5);;){if(M.lookahead<=1){if(V(M),0===M.lookahead&&A===e)return 1;if(0===M.lookahead)break}M.strstart+=M.lookahead,M.lookahead=0;const S=M.block_start+O;if((0===M.strstart||M.strstart>=S)&&(M.lookahead=M.strstart-S,M.strstart=S,v(M,!1),0===M.strm.avail_out))return 1;if(M.strstart-M.block_start>=M.w_size-h&&(v(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,A===K?(v(M,!0),0===M.strm.avail_out?3:4):(M.strstart>M.block_start&&(v(M,!1),M.strm.avail_out),1)})),new mM(4,4,8,4,Z),new mM(4,5,16,8,Z),new mM(4,6,32,32,Z),new mM(4,4,16,16,P),new mM(8,16,32,32,P),new mM(8,16,128,128,P),new mM(8,32,128,256,P),new mM(32,128,258,1024,P),new mM(32,258,258,4096,P)];function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const W=M=>{if(!M||!M.state)return L(M,I);M.total_in=M.total_out=0,M.data_type=F;const A=M.state;return A.pending=0,A.pending_out=0,A.wrap<0&&(A.wrap=-A.wrap),A.status=A.wrap?42:i,M.adler=2===A.wrap?0:1,A.last_flush=e,S(A),d},l=M=>{const A=W(M);var O;return A===d&&((O=M.state).window_size=2*O.w_size,x(O.head),O.max_lazy_match=R[O.level].max_lazy,O.good_match=R[O.level].good_length,O.nice_match=R[O.level].nice_length,O.max_chain_length=R[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=2,O.match_available=0,O.ins_h=0),A},MM=(M,A,O,S,z,Q)=>{if(!M)return I;let X=1;if(A===Y&&(A=6),S<0?(X=0,S=-S):S>15&&(X=2,S-=16),z<1||z>9||O!==N||S<8||S>15||A<0||A>9||Q<0||Q>f)return L(M,I);8===S&&(S=9);const c=new k;return M.state=c,c.strm=M,c.wrap=X,c.gzhead=null,c.w_bits=S,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=z+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<z+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=A,c.strategy=Q,c.method=O,l(M)};M.exports.deflateInit=(M,A)=>MM(M,A,N,15,8,D),M.exports.deflateInit2=MM,M.exports.deflateReset=l,M.exports.deflateResetKeep=W,M.exports.deflateSetHeader=(M,A)=>M&&M.state?2!==M.state.wrap?I:(M.state.gzhead=A,d):I,M.exports.deflate=(M,A)=>{let O,S;if(!M||!M.state||A>G||A<0)return M?L(M,I):I;const Q=M.state;if(!M.output||!M.input&&0!==M.avail_in||Q.status===U&&A!==K)return L(M,0===M.avail_out?s:I);Q.strm=M;const j=Q.last_flush;if(Q.last_flush=A,42===Q.status)if(2===Q.wrap)M.adler=0,q(Q,31),q(Q,139),q(Q,8),Q.gzhead?(q(Q,(Q.gzhead.text?1:0)+(Q.gzhead.hcrc?2:0)+(Q.gzhead.extra?4:0)+(Q.gzhead.name?8:0)+(Q.gzhead.comment?16:0)),q(Q,255&Q.gzhead.time),q(Q,Q.gzhead.time>>8&255),q(Q,Q.gzhead.time>>16&255),q(Q,Q.gzhead.time>>24&255),q(Q,9===Q.level?2:Q.strategy>=H||Q.level<2?4:0),q(Q,255&Q.gzhead.os),Q.gzhead.extra&&Q.gzhead.extra.length&&(q(Q,255&Q.gzhead.extra.length),q(Q,Q.gzhead.extra.length>>8&255)),Q.gzhead.hcrc&&(M.adler=B(M.adler,Q.pending_buf,Q.pending,0)),Q.gzindex=0,Q.status=69):(q(Q,0),q(Q,0),q(Q,0),q(Q,0),q(Q,0),q(Q,9===Q.level?2:Q.strategy>=H||Q.level<2?4:0),q(Q,3),Q.status=i);else{let A=N+(Q.w_bits-8<<4)<<8,O=-1;O=Q.strategy>=H||Q.level<2?0:Q.level<6?1:6===Q.level?2:3,A|=O<<6,0!==Q.strstart&&(A|=32),A+=31-A%31,Q.status=i,r(Q,A),0!==Q.strstart&&(r(Q,M.adler>>>16),r(Q,65535&M.adler)),M.adler=1}if(69===Q.status)if(Q.gzhead.extra){for(O=Q.pending;Q.gzindex<(65535&Q.gzhead.extra.length)&&(Q.pending!==Q.pending_buf_size||(Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),p(M),O=Q.pending,Q.pending!==Q.pending_buf_size));)q(Q,255&Q.gzhead.extra[Q.gzindex]),Q.gzindex++;Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),Q.gzindex===Q.gzhead.extra.length&&(Q.gzindex=0,Q.status=73)}else Q.status=73;if(73===Q.status)if(Q.gzhead.name){O=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),p(M),O=Q.pending,Q.pending===Q.pending_buf_size)){S=1;break}S=Q.gzindex<Q.gzhead.name.length?255&Q.gzhead.name.charCodeAt(Q.gzindex++):0,q(Q,S)}while(0!==S);Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),0===S&&(Q.gzindex=0,Q.status=91)}else Q.status=91;if(91===Q.status)if(Q.gzhead.comment){O=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),p(M),O=Q.pending,Q.pending===Q.pending_buf_size)){S=1;break}S=Q.gzindex<Q.gzhead.comment.length?255&Q.gzhead.comment.charCodeAt(Q.gzindex++):0,q(Q,S)}while(0!==S);Q.gzhead.hcrc&&Q.pending>O&&(M.adler=B(M.adler,Q.pending_buf,Q.pending-O,O)),0===S&&(Q.status=u)}else Q.status=u;if(Q.status===u&&(Q.gzhead.hcrc?(Q.pending+2>Q.pending_buf_size&&p(M),Q.pending+2<=Q.pending_buf_size&&(q(Q,255&M.adler),q(Q,M.adler>>8&255),M.adler=0,Q.status=i)):Q.status=i),0!==Q.pending){if(p(M),0===M.avail_out)return Q.last_flush=-1,d}else if(0===M.avail_in&&t(A)<=t(j)&&A!==K)return L(M,s);if(Q.status===U&&0!==M.avail_in)return L(M,s);if(0!==M.avail_in||0!==Q.lookahead||A!==e&&Q.status!==U){let O=Q.strategy===H?((M,A)=>{let O;for(;;){if(0===M.lookahead&&(V(M),0===M.lookahead)){if(A===e)return 1;break}if(M.match_length=0,O=X(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,O&&(v(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,A===K?(v(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(v(M,!1),0===M.strm.avail_out)?1:2})(Q,A):Q.strategy===C?((M,A)=>{let O,S,z,Q;const c=M.window;for(;;){if(M.lookahead<=y){if(V(M),M.lookahead<=y&&A===e)return 1;if(0===M.lookahead)break}if(M.match_length=0,M.lookahead>=3&&M.strstart>0&&(z=M.strstart-1,S=c[z],S===c[++z]&&S===c[++z]&&S===c[++z])){Q=M.strstart+y;do{}while(S===c[++z]&&S===c[++z]&&S===c[++z]&&S===c[++z]&&S===c[++z]&&S===c[++z]&&S===c[++z]&&S===c[++z]&&z<Q);M.match_length=y-(Q-z),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=3?(O=X(M,1,M.match_length-3),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(O=X(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),O&&(v(M,!1),0===M.strm.avail_out))return 1}return M.insert=0,A===K?(v(M,!0),0===M.strm.avail_out?3:4):M.last_lit&&(v(M,!1),0===M.strm.avail_out)?1:2})(Q,A):R[Q.level].func(Q,A);if(3!==O&&4!==O||(Q.status=U),1===O||3===O)return 0===M.avail_out&&(Q.last_flush=-1),d;if(2===O&&(A===T?c(Q):A!==G&&(z(Q,0,0,!1),A===J&&(x(Q.head),0===Q.lookahead&&(Q.strstart=0,Q.block_start=0,Q.insert=0))),p(M),0===M.avail_out))return Q.last_flush=-1,d}return A!==K?d:Q.wrap<=0?w:(2===Q.wrap?(q(Q,255&M.adler),q(Q,M.adler>>8&255),q(Q,M.adler>>16&255),q(Q,M.adler>>24&255),q(Q,255&M.total_in),q(Q,M.total_in>>8&255),q(Q,M.total_in>>16&255),q(Q,M.total_in>>24&255)):(r(Q,M.adler>>>16),r(Q,65535&M.adler)),p(M),Q.wrap>0&&(Q.wrap=-Q.wrap),0!==Q.pending?d:w)},M.exports.deflateEnd=M=>{if(!M||!M.state)return I;const A=M.state.status;return 42!==A&&69!==A&&73!==A&&91!==A&&A!==u&&A!==i&&A!==U?L(M,I):(M.state=null,A===i?L(M,b):d)},M.exports.deflateSetDictionary=(M,A)=>{let O=A.length;if(!M||!M.state)return I;const S=M.state,z=S.wrap;if(2===z||1===z&&42!==S.status||S.lookahead)return I;if(1===z&&(M.adler=j(M.adler,A,O,0)),S.wrap=0,O>=S.w_size){0===z&&(x(S.head),S.strstart=0,S.block_start=0,S.insert=0);let M=new Uint8Array(S.w_size);M.set(A.subarray(O-S.w_size,O),0),A=M,O=S.w_size}const Q=M.avail_in,X=M.next_in,c=M.input;for(M.avail_in=O,M.next_in=0,M.input=A,V(S);S.lookahead>=3;){let M=S.strstart,A=S.lookahead-2;do{S.ins_h=o(S,S.ins_h,S.window[M+3-1]),S.prev[M&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=M,M++}while(--A);S.strstart=M,S.lookahead=2,V(S)}return S.strstart+=S.lookahead,S.block_start=S.strstart,S.insert=S.lookahead,S.lookahead=0,S.match_length=S.prev_length=2,S.match_available=0,M.next_in=X,M.input=c,M.avail_in=Q,S.wrap=z,d},M.exports.deflateInfo="pako deflate (from Nodeca project)"},14688:M=>{"use strict";M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14680:M=>{"use strict";M.exports=function(M,A){let O,S,z,Q,X,c,j,B,g,e,T,J,K,G,d,w,I,b,s,Y,E,H,C,f;const D=M.state;O=M.next_in,C=M.input,S=O+(M.avail_in-5),z=M.next_out,f=M.output,Q=z-(A-M.avail_out),X=z+(M.avail_out-257),c=D.dmax,j=D.wsize,B=D.whave,g=D.wnext,e=D.window,T=D.hold,J=D.bits,K=D.lencode,G=D.distcode,d=(1<<D.lenbits)-1,w=(1<<D.distbits)-1;M:do{J<15&&(T+=C[O++]<<J,J+=8,T+=C[O++]<<J,J+=8),I=K[T&d];A:for(;;){if(b=I>>>24,T>>>=b,J-=b,b=I>>>16&255,0===b)f[z++]=65535&I;else{if(!(16&b)){if(0===(64&b)){I=K[(65535&I)+(T&(1<<b)-1)];continue A}if(32&b){D.mode=12;break M}M.BA="invalid literal/length code",D.mode=30;break M}s=65535&I,b&=15,b&&(J<b&&(T+=C[O++]<<J,J+=8),s+=T&(1<<b)-1,T>>>=b,J-=b),J<15&&(T+=C[O++]<<J,J+=8,T+=C[O++]<<J,J+=8),I=G[T&w];O:for(;;){if(b=I>>>24,T>>>=b,J-=b,b=I>>>16&255,!(16&b)){if(0===(64&b)){I=G[(65535&I)+(T&(1<<b)-1)];continue O}M.BA="invalid distance code",D.mode=30;break M}if(Y=65535&I,b&=15,J<b&&(T+=C[O++]<<J,J+=8,J<b&&(T+=C[O++]<<J,J+=8)),Y+=T&(1<<b)-1,Y>c){M.BA="invalid distance too far back",D.mode=30;break M}if(T>>>=b,J-=b,b=z-Q,Y>b){if(b=Y-b,b>B&&D.sane){M.BA="invalid distance too far back",D.mode=30;break M}if(E=0,H=e,0===g){if(E+=j-b,b<s){s-=b;do{f[z++]=e[E++]}while(--b);E=z-Y,H=f}}else if(g<b){if(E+=j+g-b,b-=g,b<s){s-=b;do{f[z++]=e[E++]}while(--b);if(E=0,g<s){b=g,s-=b;do{f[z++]=e[E++]}while(--b);E=z-Y,H=f}}}else if(E+=g-b,b<s){s-=b;do{f[z++]=e[E++]}while(--b);E=z-Y,H=f}for(;s>2;)f[z++]=H[E++],f[z++]=H[E++],f[z++]=H[E++],s-=3;s&&(f[z++]=H[E++],s>1&&(f[z++]=H[E++]))}else{E=z-Y;do{f[z++]=f[E++],f[z++]=f[E++],f[z++]=f[E++],s-=3}while(s>2);s&&(f[z++]=f[E++],s>1&&(f[z++]=f[E++]))}break}}break}}while(O<S&&z<X);s=J>>3,O-=s,J-=s<<3,T&=(1<<J)-1,M.next_in=O,M.next_out=z,M.avail_in=O<S?S-O+5:5-(O-S),M.avail_out=z<X?X-z+257:257-(z-X),D.hold=T,D.bits=J}},14677:(M,A,O)=>{"use strict";const S=O(14641),z=O(14643),Q=O(14680),X=O(14683),{Z_FINISH:c,Z_BLOCK:j,Z_TREES:B,Z_OK:g,Z_STREAM_END:e,Z_NEED_DICT:T,Z_STREAM_ERROR:J,Z_DATA_ERROR:K,Z_MEM_ERROR:G,Z_BUF_ERROR:d,Z_DEFLATED:w}=O(14649),I=12,b=30,s=M=>(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24);function Y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const E=M=>{if(!M||!M.state)return J;const A=M.state;return M.total_in=M.total_out=A.total=0,M.BA="",A.wrap&&(M.adler=1&A.wrap),A.mode=1,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new Int32Array(852),A.distcode=A.distdyn=new Int32Array(592),A.sane=1,A.back=-1,g},H=M=>{if(!M||!M.state)return J;const A=M.state;return A.wsize=0,A.whave=0,A.wnext=0,E(M)},C=(M,A)=>{let O;if(!M||!M.state)return J;const S=M.state;return A<0?(O=0,A=-A):(O=1+(A>>4),A<48&&(A&=15)),A&&(A<8||A>15)?J:(null!==S.window&&S.wbits!==A&&(S.window=null),S.wrap=O,S.wbits=A,H(M))},f=(M,A)=>{if(!M)return J;const O=new Y;M.state=O,O.window=null;const S=C(M,A);return S!==g&&(M.state=null),S};let D,F,N=!0;const y=M=>{if(N){D=new Int32Array(512),F=new Int32Array(32);let A=0;for(;A<144;)M.lens[A++]=8;for(;A<256;)M.lens[A++]=9;for(;A<280;)M.lens[A++]=7;for(;A<288;)M.lens[A++]=8;for(X(1,M.lens,0,288,D,0,M.work,{bits:9}),A=0;A<32;)M.lens[A++]=5;X(2,M.lens,0,32,F,0,M.work,{bits:5}),N=!1}M.lencode=D,M.lenbits=9,M.distcode=F,M.distbits=5},h=(M,A,O,S)=>{let z;const Q=M.state;return null===Q.window&&(Q.wsize=1<<Q.wbits,Q.wnext=0,Q.whave=0,Q.window=new Uint8Array(Q.wsize)),S>=Q.wsize?(Q.window.set(A.subarray(O-Q.wsize,O),0),Q.wnext=0,Q.whave=Q.wsize):(z=Q.wsize-Q.wnext,z>S&&(z=S),Q.window.set(A.subarray(O-S,O-S+z),Q.wnext),(S-=z)?(Q.window.set(A.subarray(O-S,O),0),Q.wnext=S,Q.whave=Q.wsize):(Q.wnext+=z,Q.wnext===Q.wsize&&(Q.wnext=0),Q.whave<Q.wsize&&(Q.whave+=z))),0};M.exports.inflateReset=H,M.exports.inflateReset2=C,M.exports.inflateResetKeep=E,M.exports.inflateInit=M=>f(M,15),M.exports.inflateInit2=f,M.exports.inflate=(M,A)=>{let O,Y,E,H,C,f,D,F,N,u,i,U,L,t,x,o,p,v,q,r,n,a,V=0;const Z=new Uint8Array(4);let P,mM;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!M||!M.state||!M.output||!M.input&&0!==M.avail_in)return J;O=M.state,O.mode===I&&(O.mode=13),C=M.next_out,E=M.output,D=M.avail_out,H=M.next_in,Y=M.input,f=M.avail_in,F=O.hold,N=O.bits,u=f,i=D,a=g;M:for(;;)switch(O.mode){case 1:if(0===O.wrap){O.mode=13;break}for(;N<16;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(2&O.wrap&&35615===F){O.check=0,Z[0]=255&F,Z[1]=F>>>8&255,O.check=z(O.check,Z,2,0),F=0,N=0,O.mode=2;break}if(O.flags=0,O.head&&(O.head.done=!1),!(1&O.wrap)||(((255&F)<<8)+(F>>8))%31){M.BA="incorrect header check",O.mode=b;break}if((15&F)!==w){M.BA="unknown compression method",O.mode=b;break}if(F>>>=4,N-=4,n=8+(15&F),0===O.wbits)O.wbits=n;else if(n>O.wbits){M.BA="invalid window size",O.mode=b;break}O.dmax=1<<O.wbits,M.adler=O.check=1,O.mode=512&F?10:I,F=0,N=0;break;case 2:for(;N<16;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(O.flags=F,(255&O.flags)!==w){M.BA="unknown compression method",O.mode=b;break}if(57344&O.flags){M.BA="unknown header flags set",O.mode=b;break}O.head&&(O.head.text=F>>8&1),512&O.flags&&(Z[0]=255&F,Z[1]=F>>>8&255,O.check=z(O.check,Z,2,0)),F=0,N=0,O.mode=3;case 3:for(;N<32;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.head&&(O.head.time=F),512&O.flags&&(Z[0]=255&F,Z[1]=F>>>8&255,Z[2]=F>>>16&255,Z[3]=F>>>24&255,O.check=z(O.check,Z,4,0)),F=0,N=0,O.mode=4;case 4:for(;N<16;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.head&&(O.head.xflags=255&F,O.head.os=F>>8),512&O.flags&&(Z[0]=255&F,Z[1]=F>>>8&255,O.check=z(O.check,Z,2,0)),F=0,N=0,O.mode=5;case 5:if(1024&O.flags){for(;N<16;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.length=F,O.head&&(O.head.extra_len=F),512&O.flags&&(Z[0]=255&F,Z[1]=F>>>8&255,O.check=z(O.check,Z,2,0)),F=0,N=0}else O.head&&(O.head.extra=null);O.mode=6;case 6:if(1024&O.flags&&(U=O.length,U>f&&(U=f),U&&(O.head&&(n=O.head.extra_len-O.length,O.head.extra||(O.head.extra=new Uint8Array(O.head.extra_len)),O.head.extra.set(Y.subarray(H,H+U),n)),512&O.flags&&(O.check=z(O.check,Y,U,H)),f-=U,H+=U,O.length-=U),O.length))break M;O.length=0,O.mode=7;case 7:if(2048&O.flags){if(0===f)break M;U=0;do{n=Y[H+U++],O.head&&n&&O.length<65536&&(O.head.name+=String.fromCharCode(n))}while(n&&U<f);if(512&O.flags&&(O.check=z(O.check,Y,U,H)),f-=U,H+=U,n)break M}else O.head&&(O.head.name=null);O.length=0,O.mode=8;case 8:if(4096&O.flags){if(0===f)break M;U=0;do{n=Y[H+U++],O.head&&n&&O.length<65536&&(O.head.comment+=String.fromCharCode(n))}while(n&&U<f);if(512&O.flags&&(O.check=z(O.check,Y,U,H)),f-=U,H+=U,n)break M}else O.head&&(O.head.comment=null);O.mode=9;case 9:if(512&O.flags){for(;N<16;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(F!==(65535&O.check)){M.BA="header crc mismatch",O.mode=b;break}F=0,N=0}O.head&&(O.head.hcrc=O.flags>>9&1,O.head.done=!0),M.adler=O.check=0,O.mode=I;break;case 10:for(;N<32;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}M.adler=O.check=s(F),F=0,N=0,O.mode=11;case 11:if(0===O.havedict)return M.next_out=C,M.avail_out=D,M.next_in=H,M.avail_in=f,O.hold=F,O.bits=N,T;M.adler=O.check=1,O.mode=I;case I:if(A===j||A===B)break M;case 13:if(O.last){F>>>=7&N,N-=7&N,O.mode=27;break}for(;N<3;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}switch(O.last=1&F,F>>>=1,N-=1,3&F){case 0:O.mode=14;break;case 1:if(y(O),O.mode=20,A===B){F>>>=2,N-=2;break M}break;case 2:O.mode=17;break;case 3:M.BA="invalid block type",O.mode=b}F>>>=2,N-=2;break;case 14:for(F>>>=7&N,N-=7&N;N<32;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if((65535&F)!==(F>>>16^65535)){M.BA="invalid stored block lengths",O.mode=b;break}if(O.length=65535&F,F=0,N=0,O.mode=15,A===B)break M;case 15:O.mode=16;case 16:if(U=O.length,U){if(U>f&&(U=f),U>D&&(U=D),0===U)break M;E.set(Y.subarray(H,H+U),C),f-=U,H+=U,D-=U,C+=U,O.length-=U;break}O.mode=I;break;case 17:for(;N<14;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(O.nlen=257+(31&F),F>>>=5,N-=5,O.ndist=1+(31&F),F>>>=5,N-=5,O.ncode=4+(15&F),F>>>=4,N-=4,O.nlen>286||O.ndist>30){M.BA="too many length or distance symbols",O.mode=b;break}O.have=0,O.mode=18;case 18:for(;O.have<O.ncode;){for(;N<3;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.lens[R[O.have++]]=7&F,F>>>=3,N-=3}for(;O.have<19;)O.lens[R[O.have++]]=0;if(O.lencode=O.lendyn,O.lenbits=7,P={bits:O.lenbits},a=X(0,O.lens,0,19,O.lencode,0,O.work,P),O.lenbits=P.bits,a){M.BA="invalid code lengths set",O.mode=b;break}O.have=0,O.mode=19;case 19:for(;O.have<O.nlen+O.ndist;){for(;V=O.lencode[F&(1<<O.lenbits)-1],x=V>>>24,o=V>>>16&255,p=65535&V,!(x<=N);){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(p<16)F>>>=x,N-=x,O.lens[O.have++]=p;else{if(16===p){for(mM=x+2;N<mM;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(F>>>=x,N-=x,0===O.have){M.BA="invalid bit length repeat",O.mode=b;break}n=O.lens[O.have-1],U=3+(3&F),F>>>=2,N-=2}else if(17===p){for(mM=x+3;N<mM;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}F>>>=x,N-=x,n=0,U=3+(7&F),F>>>=3,N-=3}else{for(mM=x+7;N<mM;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}F>>>=x,N-=x,n=0,U=11+(127&F),F>>>=7,N-=7}if(O.have+U>O.nlen+O.ndist){M.BA="invalid bit length repeat",O.mode=b;break}for(;U--;)O.lens[O.have++]=n}}if(O.mode===b)break;if(0===O.lens[256]){M.BA="invalid code -- missing end-of-block",O.mode=b;break}if(O.lenbits=9,P={bits:O.lenbits},a=X(1,O.lens,0,O.nlen,O.lencode,0,O.work,P),O.lenbits=P.bits,a){M.BA="invalid literal/lengths set",O.mode=b;break}if(O.distbits=6,O.distcode=O.distdyn,P={bits:O.distbits},a=X(2,O.lens,O.nlen,O.ndist,O.distcode,0,O.work,P),O.distbits=P.bits,a){M.BA="invalid distances set",O.mode=b;break}if(O.mode=20,A===B)break M;case 20:O.mode=21;case 21:if(f>=6&&D>=258){M.next_out=C,M.avail_out=D,M.next_in=H,M.avail_in=f,O.hold=F,O.bits=N,Q(M,i),C=M.next_out,E=M.output,D=M.avail_out,H=M.next_in,Y=M.input,f=M.avail_in,F=O.hold,N=O.bits,O.mode===I&&(O.back=-1);break}for(O.back=0;V=O.lencode[F&(1<<O.lenbits)-1],x=V>>>24,o=V>>>16&255,p=65535&V,!(x<=N);){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(o&&0===(240&o)){for(v=x,q=o,r=p;V=O.lencode[r+((F&(1<<v+q)-1)>>v)],x=V>>>24,o=V>>>16&255,p=65535&V,!(v+x<=N);){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}F>>>=v,N-=v,O.back+=v}if(F>>>=x,N-=x,O.back+=x,O.length=p,0===o){O.mode=26;break}if(32&o){O.back=-1,O.mode=I;break}if(64&o){M.BA="invalid literal/length code",O.mode=b;break}O.extra=15&o,O.mode=22;case 22:if(O.extra){for(mM=O.extra;N<mM;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.length+=F&(1<<O.extra)-1,F>>>=O.extra,N-=O.extra,O.back+=O.extra}O.was=O.length,O.mode=23;case 23:for(;V=O.distcode[F&(1<<O.distbits)-1],x=V>>>24,o=V>>>16&255,p=65535&V,!(x<=N);){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(0===(240&o)){for(v=x,q=o,r=p;V=O.distcode[r+((F&(1<<v+q)-1)>>v)],x=V>>>24,o=V>>>16&255,p=65535&V,!(v+x<=N);){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}F>>>=v,N-=v,O.back+=v}if(F>>>=x,N-=x,O.back+=x,64&o){M.BA="invalid distance code",O.mode=b;break}O.offset=p,O.extra=15&o,O.mode=24;case 24:if(O.extra){for(mM=O.extra;N<mM;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}O.offset+=F&(1<<O.extra)-1,F>>>=O.extra,N-=O.extra,O.back+=O.extra}if(O.offset>O.dmax){M.BA="invalid distance too far back",O.mode=b;break}O.mode=25;case 25:if(0===D)break M;if(U=i-D,O.offset>U){if(U=O.offset-U,U>O.whave&&O.sane){M.BA="invalid distance too far back",O.mode=b;break}U>O.wnext?(U-=O.wnext,L=O.wsize-U):L=O.wnext-U,U>O.length&&(U=O.length),t=O.window}else t=E,L=C-O.offset,U=O.length;U>D&&(U=D),D-=U,O.length-=U;do{E[C++]=t[L++]}while(--U);0===O.length&&(O.mode=21);break;case 26:if(0===D)break M;E[C++]=O.length,D--,O.mode=21;break;case 27:if(O.wrap){for(;N<32;){if(0===f)break M;f--,F|=Y[H++]<<N,N+=8}if(i-=D,M.total_out+=i,O.total+=i,i&&(M.adler=O.check=O.flags?z(O.check,E,i,C-i):S(O.check,E,i,C-i)),i=D,(O.flags?F:s(F))!==O.check){M.BA="incorrect data check",O.mode=b;break}F=0,N=0}O.mode=28;case 28:if(O.wrap&&O.flags){for(;N<32;){if(0===f)break M;f--,F+=Y[H++]<<N,N+=8}if(F!==(4294967295&O.total)){M.BA="incorrect length check",O.mode=b;break}F=0,N=0}O.mode=29;case 29:a=e;break M;case b:a=K;break M;case 31:return G;default:return J}return M.next_out=C,M.avail_out=D,M.next_in=H,M.avail_in=f,O.hold=F,O.bits=N,(O.wsize||i!==M.avail_out&&O.mode<b&&(O.mode<27||A!==c))&&h(M,M.output,M.next_out,i-M.avail_out)?(O.mode=31,G):(u-=M.avail_in,i-=M.avail_out,M.total_in+=u,M.total_out+=i,O.total+=i,O.wrap&&i&&(M.adler=O.check=O.flags?z(O.check,E,i,M.next_out-i):S(O.check,E,i,M.next_out-i)),M.data_type=O.bits+(O.last?64:0)+(O.mode===I?128:0)+(20===O.mode||15===O.mode?256:0),(0===u&&0===i||A===c)&&a===g&&(a=d),a)},M.exports.inflateEnd=M=>{if(!M||!M.state)return J;let A=M.state;return A.window&&(A.window=null),M.state=null,g},M.exports.inflateGetHeader=(M,A)=>{if(!M||!M.state)return J;const O=M.state;return 0===(2&O.wrap)?J:(O.head=A,A.done=!1,g)},M.exports.inflateSetDictionary=(M,A)=>{const O=A.length;let z,Q,X;return M&&M.state?(z=M.state,0!==z.wrap&&11!==z.mode?J:11===z.mode&&(Q=1,Q=S(Q,A,O,0),Q!==z.check)?K:(X=h(M,A,O,O),X?(z.mode=31,G):(z.havedict=1,g))):J},M.exports.inflateInfo="pako inflate (from Nodeca project)"},14683:M=>{"use strict";const A=15,O=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),S=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),z=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Q=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);M.exports=(M,X,c,j,B,g,e,T)=>{const J=T.bits;let K,G,d,w,I,b,s=0,Y=0,E=0,H=0,C=0,f=0,D=0,F=0,N=0,y=0,h=null,u=0;const i=new Uint16Array(16),U=new Uint16Array(16);let L,t,x,o=null,p=0;for(s=0;s<=A;s++)i[s]=0;for(Y=0;Y<j;Y++)i[X[c+Y]]++;for(C=J,H=A;H>=1&&0===i[H];H--);if(C>H&&(C=H),0===H)return B[g++]=20971520,B[g++]=20971520,T.bits=1,0;for(E=1;E<H&&0===i[E];E++);for(C<E&&(C=E),F=1,s=1;s<=A;s++)if(F<<=1,F-=i[s],F<0)return-1;if(F>0&&(0===M||1!==H))return-1;for(U[1]=0,s=1;s<A;s++)U[s+1]=U[s]+i[s];for(Y=0;Y<j;Y++)0!==X[c+Y]&&(e[U[X[c+Y]]++]=Y);if(0===M?(h=o=e,b=19):1===M?(h=O,u-=257,o=S,p-=257,b=256):(h=z,o=Q,b=-1),y=0,Y=0,s=E,I=g,f=C,D=0,d=-1,N=1<<C,w=N-1,1===M&&N>852||2===M&&N>592)return 1;for(;;){L=s-D,e[Y]<b?(t=0,x=e[Y]):e[Y]>b?(t=o[p+e[Y]],x=h[u+e[Y]]):(t=96,x=0),K=1<<s-D,G=1<<f,E=G;do{G-=K,B[I+(y>>D)+G]=L<<24|t<<16|x}while(0!==G);for(K=1<<s-1;y&K;)K>>=1;if(0!==K?(y&=K-1,y+=K):y=0,Y++,0===--i[s]){if(s===H)break;s=X[c+e[Y]]}if(s>C&&(y&w)!==d){for(0===D&&(D=C),I+=E,f=s-D,F=1<<f;f+D<H&&(F-=i[f+D],!(F<=0));)f++,F<<=1;if(N+=1<<f,1===M&&N>852||2===M&&N>592)return 1;d=y&w,B[d]=C<<24|f<<16|I-g}}return 0!==y&&(B[I+y]=s-D<<24|64<<16),T.bits=C,0}},14646:M=>{"use strict";M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14635:M=>{"use strict";function A(M){let A=M.length;for(;--A>=0;)M[A]=0}const O=256,S=286,z=30,Q=15,X=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),c=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),j=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Array(576);A(g);const e=new Array(60);A(e);const T=new Array(512);A(T);const J=new Array(256);A(J);const K=new Array(29);A(K);const G=new Array(z);function d(M,A,O,S,z){this.static_tree=M,this.extra_bits=A,this.extra_base=O,this.elems=S,this.max_length=z,this.has_stree=M&&M.length}let w,I,b;function s(M,A){this.dyn_tree=M,this.max_code=0,this.stat_desc=A}A(G);const Y=M=>M<256?T[M]:T[256+(M>>>7)],E=(M,A)=>{M.pending_buf[M.pending++]=255&A,M.pending_buf[M.pending++]=A>>>8&255},H=(M,A,O)=>{M.bi_valid>16-O?(M.bi_buf|=A<<M.bi_valid&65535,E(M,M.bi_buf),M.bi_buf=A>>16-M.bi_valid,M.bi_valid+=O-16):(M.bi_buf|=A<<M.bi_valid&65535,M.bi_valid+=O)},C=(M,A,O)=>{H(M,O[2*A],O[2*A+1])},f=(M,A)=>{let O=0;do{O|=1&M,M>>>=1,O<<=1}while(--A>0);return O>>>1},D=(M,A,O)=>{const S=new Array(16);let z,X,c=0;for(z=1;z<=Q;z++)S[z]=c=c+O[z-1]<<1;for(X=0;X<=A;X++){let A=M[2*X+1];0!==A&&(M[2*X]=f(S[A]++,A))}},F=M=>{let A;for(A=0;A<S;A++)M.dyn_ltree[2*A]=0;for(A=0;A<z;A++)M.dyn_dtree[2*A]=0;for(A=0;A<19;A++)M.bl_tree[2*A]=0;M.dyn_ltree[512]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0},N=M=>{M.bi_valid>8?E(M,M.bi_buf):M.bi_valid>0&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0},y=(M,A,O,S)=>{const z=2*A,Q=2*O;return M[z]<M[Q]||M[z]===M[Q]&&S[A]<=S[O]},h=(M,A,O)=>{const S=M.heap[O];let z=O<<1;for(;z<=M.heap_len&&(z<M.heap_len&&y(A,M.heap[z+1],M.heap[z],M.depth)&&z++,!y(A,S,M.heap[z],M.depth));)M.heap[O]=M.heap[z],O=z,z<<=1;M.heap[O]=S},u=(M,A,S)=>{let z,Q,j,B,g=0;if(0!==M.last_lit)do{z=M.pending_buf[M.d_buf+2*g]<<8|M.pending_buf[M.d_buf+2*g+1],Q=M.pending_buf[M.l_buf+g],g++,0===z?C(M,Q,A):(j=J[Q],C(M,j+O+1,A),B=X[j],0!==B&&(Q-=K[j],H(M,Q,B)),z--,j=Y(z),C(M,j,S),B=c[j],0!==B&&(z-=G[j],H(M,z,B)))}while(g<M.last_lit);C(M,256,A)},i=(M,A)=>{const O=A.dyn_tree,S=A.stat_desc.static_tree,z=A.stat_desc.has_stree,X=A.stat_desc.elems;let c,j,B,g=-1;for(M.heap_len=0,M.heap_max=573,c=0;c<X;c++)0!==O[2*c]?(M.heap[++M.heap_len]=g=c,M.depth[c]=0):O[2*c+1]=0;for(;M.heap_len<2;)B=M.heap[++M.heap_len]=g<2?++g:0,O[2*B]=1,M.depth[B]=0,M.opt_len--,z&&(M.static_len-=S[2*B+1]);for(A.max_code=g,c=M.heap_len>>1;c>=1;c--)h(M,O,c);B=X;do{c=M.heap[1],M.heap[1]=M.heap[M.heap_len--],h(M,O,1),j=M.heap[1],M.heap[--M.heap_max]=c,M.heap[--M.heap_max]=j,O[2*B]=O[2*c]+O[2*j],M.depth[B]=(M.depth[c]>=M.depth[j]?M.depth[c]:M.depth[j])+1,O[2*c+1]=O[2*j+1]=B,M.heap[1]=B++,h(M,O,1)}while(M.heap_len>=2);M.heap[--M.heap_max]=M.heap[1],((M,A)=>{const O=A.dyn_tree,S=A.max_code,z=A.stat_desc.static_tree,X=A.stat_desc.has_stree,c=A.stat_desc.extra_bits,j=A.stat_desc.extra_base,B=A.stat_desc.max_length;let g,e,T,J,K,G,d=0;for(J=0;J<=Q;J++)M.bl_count[J]=0;for(O[2*M.heap[M.heap_max]+1]=0,g=M.heap_max+1;g<573;g++)e=M.heap[g],J=O[2*O[2*e+1]+1]+1,J>B&&(J=B,d++),O[2*e+1]=J,e>S||(M.bl_count[J]++,K=0,e>=j&&(K=c[e-j]),G=O[2*e],M.opt_len+=G*(J+K),X&&(M.static_len+=G*(z[2*e+1]+K)));if(0!==d){do{for(J=B-1;0===M.bl_count[J];)J--;M.bl_count[J]--,M.bl_count[J+1]+=2,M.bl_count[B]--,d-=2}while(d>0);for(J=B;0!==J;J--)for(e=M.bl_count[J];0!==e;)T=M.heap[--g],T>S||(O[2*T+1]!==J&&(M.opt_len+=(J-O[2*T+1])*O[2*T],O[2*T+1]=J),e--)}})(M,A),D(O,g,M.bl_count)},U=(M,A,O)=>{let S,z,Q=-1,X=A[1],c=0,j=7,B=4;for(0===X&&(j=138,B=3),A[2*(O+1)+1]=65535,S=0;S<=O;S++)z=X,X=A[2*(S+1)+1],++c<j&&z===X||(c<B?M.bl_tree[2*z]+=c:0!==z?(z!==Q&&M.bl_tree[2*z]++,M.bl_tree[32]++):c<=10?M.bl_tree[34]++:M.bl_tree[36]++,c=0,Q=z,0===X?(j=138,B=3):z===X?(j=6,B=3):(j=7,B=4))},L=(M,A,O)=>{let S,z,Q=-1,X=A[1],c=0,j=7,B=4;for(0===X&&(j=138,B=3),S=0;S<=O;S++)if(z=X,X=A[2*(S+1)+1],!(++c<j&&z===X)){if(c<B)do{C(M,z,M.bl_tree)}while(0!==--c);else 0!==z?(z!==Q&&(C(M,z,M.bl_tree),c--),C(M,16,M.bl_tree),H(M,c-3,2)):c<=10?(C(M,17,M.bl_tree),H(M,c-3,3)):(C(M,18,M.bl_tree),H(M,c-11,7));c=0,Q=z,0===X?(j=138,B=3):z===X?(j=6,B=3):(j=7,B=4)}};let t=!1;const x=(M,A,O,S)=>{H(M,0+(S?1:0),3),((M,A,O,S)=>{N(M),S&&(E(M,O),E(M,~O)),M.pending_buf.set(M.window.subarray(A,A+O),M.pending),M.pending+=O})(M,A,O,!0)};M.exports._tr_init=M=>{t||((()=>{let M,A,O,B,s;const Y=new Array(16);for(O=0,B=0;B<28;B++)for(K[B]=O,M=0;M<1<<X[B];M++)J[O++]=B;for(J[O-1]=B,s=0,B=0;B<16;B++)for(G[B]=s,M=0;M<1<<c[B];M++)T[s++]=B;for(s>>=7;B<z;B++)for(G[B]=s<<7,M=0;M<1<<c[B]-7;M++)T[256+s++]=B;for(A=0;A<=Q;A++)Y[A]=0;for(M=0;M<=143;)g[2*M+1]=8,M++,Y[8]++;for(;M<=255;)g[2*M+1]=9,M++,Y[9]++;for(;M<=279;)g[2*M+1]=7,M++,Y[7]++;for(;M<=287;)g[2*M+1]=8,M++,Y[8]++;for(D(g,287,Y),M=0;M<z;M++)e[2*M+1]=5,e[2*M]=f(M,5);w=new d(g,X,257,S,Q),I=new d(e,c,0,z,Q),b=new d(new Array(0),j,0,19,7)})(),t=!0),M.l_desc=new s(M.dyn_ltree,w),M.d_desc=new s(M.dyn_dtree,I),M.bl_desc=new s(M.bl_tree,b),M.bi_buf=0,M.bi_valid=0,F(M)},M.exports._tr_stored_block=x,M.exports._tr_flush_block=(M,A,S,z)=>{let Q,X,c=0;M.level>0?(2===M.strm.data_type&&(M.strm.data_type=(M=>{let A,S=4093624447;for(A=0;A<=31;A++,S>>>=1)if(1&S&&0!==M.dyn_ltree[2*A])return 0;if(0!==M.dyn_ltree[18]||0!==M.dyn_ltree[20]||0!==M.dyn_ltree[26])return 1;for(A=32;A<O;A++)if(0!==M.dyn_ltree[2*A])return 1;return 0})(M)),i(M,M.l_desc),i(M,M.d_desc),c=(M=>{let A;for(U(M,M.dyn_ltree,M.l_desc.max_code),U(M,M.dyn_dtree,M.d_desc.max_code),i(M,M.bl_desc),A=18;A>=3&&0===M.bl_tree[2*B[A]+1];A--);return M.opt_len+=3*(A+1)+5+5+4,A})(M),Q=M.opt_len+3+7>>>3,X=M.static_len+3+7>>>3,X<=Q&&(Q=X)):Q=X=S+5,S+4<=Q&&-1!==A?x(M,A,S,z):4===M.strategy||X===Q?(H(M,2+(z?1:0),3),u(M,g,e)):(H(M,4+(z?1:0),3),((M,A,O,S)=>{let z;for(H(M,A-257,5),H(M,O-1,5),H(M,S-4,4),z=0;z<S;z++)H(M,M.bl_tree[2*B[z]+1],3);L(M,M.dyn_ltree,A-1),L(M,M.dyn_dtree,O-1)})(M,M.l_desc.max_code+1,M.d_desc.max_code+1,c+1),u(M,M.dyn_ltree,M.dyn_dtree)),F(M),z&&N(M)},M.exports._tr_tally=(M,A,S)=>(M.pending_buf[M.d_buf+2*M.last_lit]=A>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&A,M.pending_buf[M.l_buf+M.last_lit]=255&S,M.last_lit++,0===A?M.dyn_ltree[2*S]++:(M.matches++,A--,M.dyn_ltree[2*(J[S]+O+1)]++,M.dyn_dtree[2*Y(A)]++),M.last_lit===M.lit_bufsize-1),M.exports._tr_align=M=>{H(M,2,3),C(M,256,g),(M=>{16===M.bi_valid?(E(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):M.bi_valid>=8&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)})(M)}},14667:M=>{"use strict";M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.BA="",this.state=null,this.data_type=2,this.adler=0}},13759:M=>{function A(M,A,O){for(var S=M.length,z=-1/0,Q=1/0,X=0;X<S;X++){var c=(O[0][X]-M[X])/A[X],j=(O[1][X]-M[X])/A[X];if(c>j){var B=c;c=j,j=B}if(j<z||c>Q)return 1/0;c>z&&(z=c),j<Q&&(Q=j)}return z>Q?1/0:z}M.exports=function(M,O,S,z){var Q=A(O,S,z);if(Q===1/0)M=null;else{M=M||[];for(var X=0;X<O.length;X++)M[X]=O[X]+S[X]*Q}return M},M.exports.distance=A},14747:(M,A,O)=>{"use strict";O.d(A,{c:()=>X});var S=O(56);const z=S.useLayoutEffect;const Q=function(M){var A=(0,S.useRef)(M);return z((function(){A.current=M})),A};var X=function(M){var A=Q(M);(0,S.XA)((function(){var M=function(M){var O;if(null!=A.current&&(O=A.current(M)),M.defaultPrevented&&(M.returnValue=""),"string"===typeof O)return M.returnValue=O,O};return window.addEventListener("beforeunload",M),function(){window.removeEventListener("beforeunload",M)}}),[])}},14715:(M,A,O)=>{"use strict";var S=O(14719),z=Array.prototype.concat,Q=Array.prototype.slice,X=M.exports=function(M){for(var A=[],O=0,X=M.length;O<X;O++){var c=M[O];S(c)?A=z.call(A,Q.call(c)):A.push(c)}return A};X.wrap=function(M){return function(){return M(X(arguments))}}},14719:M=>{M.exports=function(M){return!(!M||"string"===typeof M)&&(M instanceof Array||Array.isArray(M)||M.length>=0&&(M.splice instanceof Function||Object.getOwnPropertyDescriptor(M,M.length-1)&&"String"!==M.constructor.name))}},14552:M=>{"use strict";var A=[],O=[],S=[],z=[],Q=[],X=[],c=[],j=[],B=[],g=[],e=[],T=[];M.exports=function(M,J,K,G,d,w){for(var I=c,b=B,s=g,Y=T,E=0;E<3;E++)I[E]=+K[E],s[E]=+J.max[E],b[E]=+J.base[E];w||(w=1e-10);var H=function(M,c,B,g,T,J){var K=A,G=O,d=S,w=z,I=Q,b=X,s=j,Y=Math.floor,E=0,H=0,C=0,f=0,D=0;if(F(),0===C)return 0;for(f=h();H<=C;){if(N(f)&&y())return E;f=h()}for(E+=C,D=0;D<3;D++)g[D]+=B[D],T[D]+=B[D];return E;function F(){if(H=0,0!==(C=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2])))for(var M=0;M<3;M++){var A=B[M]>=0;w[M]=A?1:-1;var O=A?T[M]:g[M];K[M]=A?g[M]:T[M],G[M]=u(O,w[M]),d[M]=i(K[M],w[M]),s[M]=B[M]/C,I[M]=Math.abs(1/s[M]);var S=A?G[M]+1-O:O-G[M];b[M]=I[M]<1/0?I[M]*S:1/0}}function N(A){for(var O=w[0],S=0===A?G[0]:d[0],z=G[0]+O,Q=w[1],X=1===A?G[1]:d[1],c=G[1]+Q,j=w[2],B=2===A?G[2]:d[2],g=G[2]+j,e=S;e!=z;e+=O)for(var T=X;T!=c;T+=Q)for(var J=B;J!=g;J+=j)if(M(e,T,J))return!0;return!1}function y(){E+=H;var M=w[f],A=H/C,O=e;for(D=0;D<3;D++){var S=B[D]*A;g[D]+=S,T[D]+=S,O[D]=B[D]-S}if(M>0?T[f]=Math.round(T[f]):g[f]=Math.round(g[f]),c(E,f,M,O))return!0;for(D=0;D<3;D++)B[D]=O[D];return F(),0===C}function h(){var M=b[0]<b[1]?b[0]<b[2]?0:2:b[1]<b[2]?1:2,A=b[M]-H;for(H=b[M],G[M]+=w[M],b[M]+=I[M],D=0;D<3;D++)K[D]+=A*s[D],d[D]=i(K[D],w[D]);return M}function u(M,A){return Y(M-A*J)}function i(M,A){return Y(M+A*J)}}(M,G,I,b,s,w);if(!d){for(E=0;E<3;E++)Y[E]=K[E]>0?s[E]-J.max[E]:b[E]-J.base[E];J.translate(Y)}return H}},14587:(M,A,O)=>{var S=O(14593);function z(M){for(var A,O,z=0,Q=M.length,X=0;X<M.length;){for(A=M[X],O=0;X<Q&&M[X]===A;)++X,++O;z+=S.log2(O)/7|0,z+=S.log2(A>>>0)/7|0,z+=2}return z}A.size=z,A.encode=function(M,A){A||(A=new Uint8Array(z(M)));for(var O,S,Q=0,X=A.length,c=0;c<M.length;){for(O=M[c],S=0;c<M.length&&M[c]===O;)++c,++S;for(;Q<X&&S>=128;)A[Q++]=128+(127&S),S>>>=7;if(Q>=X)throw new Error("RLE buffer overflow");for(A[Q++]=S,O>>>=0;Q<X&&O>=128;)A[Q++]=128+(127&O),O>>>=7;if(Q>=X)throw new Error("RLE buffer overflow");A[Q++]=O}return A},A.decode=function(M,A){for(var O,S,z,Q,X=A.length,c=M.length,j=0,B=0;B<c;){for(O=0,S=0;B<c&&M[B]>=128;)O+=(127&M[B++])<<S,S+=7;if(O+=M[B++]<<S,B>=c)throw new Error("RLE buffer underrun");if(j+O>X)throw new Error("Chunk buffer overflow");for(z=0,S=0;B<c&&M[B]>=128;)z+=(127&M[B++])<<S,S+=7;if(B>=c)throw new Error("RLE buffer underrun");for(z+=M[B++]<<S,Q=0;Q<O;++Q)A[j++]=z}return A}},14593:(M,A)=>{"use strict";function O(M){var A=32;return(M&=-M)&&A--,65535&M&&(A-=16),16711935&M&&(A-=8),252645135&M&&(A-=4),858993459&M&&(A-=2),1431655765&M&&(A-=1),A}A.INT_BITS=32,A.INT_MAX=2147483647,A.INT_MIN=-1<<31,A.sign=function(M){return(M>0)-(M<0)},A.abs=function(M){var A=M>>31;return(M^A)-A},A.min=function(M,A){return A^(M^A)&-(M<A)},A.max=function(M,A){return M^(M^A)&-(M<A)},A.isPow2=function(M){return!(M&M-1)&&!!M},A.log2=function(M){var A,O;return A=(M>65535)<<4,A|=O=((M>>>=A)>255)<<3,A|=O=((M>>>=O)>15)<<2,(A|=O=((M>>>=O)>3)<<1)|(M>>>=O)>>1},A.log10=function(M){return M>=1e9?9:M>=1e8?8:M>=1e7?7:M>=1e6?6:M>=1e5?5:M>=1e4?4:M>=1e3?3:M>=100?2:M>=10?1:0},A.popCount=function(M){return 16843009*((M=(858993459&(M-=M>>>1&1431655765))+(M>>>2&858993459))+(M>>>4)&252645135)>>>24},A.countTrailingZeros=O,A.nextPow2=function(M){return M+=0===M,--M,M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)+1},A.prevPow2=function(M){return M|=M>>>1,M|=M>>>2,M|=M>>>4,M|=M>>>8,(M|=M>>>16)-(M>>>1)},A.parity=function(M){return M^=M>>>16,M^=M>>>8,M^=M>>>4,27030>>>(M&=15)&1};var S=new Array(256);!function(M){for(var A=0;A<256;++A){var O=A,S=A,z=7;for(O>>>=1;O;O>>>=1)S<<=1,S|=1&O,--z;M[A]=S<<z&255}}(S),A.reverse=function(M){return S[255&M]<<24|S[M>>>8&255]<<16|S[M>>>16&255]<<8|S[M>>>24&255]},A.interleave2=function(M,A){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M&=65535)|M<<8))|M<<4))|M<<2))|M<<1))|(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A&=65535)|A<<8))|A<<4))|A<<2))|A<<1))<<1},A.deinterleave2=function(M,A){return(M=65535&((M=16711935&((M=252645135&((M=858993459&((M=M>>>A&1431655765)|M>>>1))|M>>>2))|M>>>4))|M>>>16))<<16>>16},A.interleave3=function(M,A,O){return M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2),(M|=(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<1)|(O=1227133513&((O=3272356035&((O=251719695&((O=4278190335&((O&=1023)|O<<16))|O<<8))|O<<4))|O<<2))<<2},A.deinterleave3=function(M,A){return(M=1023&((M=4278190335&((M=251719695&((M=3272356035&((M=M>>>A&1227133513)|M>>>2))|M>>>4))|M>>>8))|M>>>16))<<22>>22},A.nextCombination=function(M){var A=M|M-1;return A+1|(~A&-~A)-1>>>O(M)+1}},14845:(M,A,O)=>{"use strict";O.d(A,{b:()=>e});var S=O(14544),z=O(166);class Q{constructor(M,A,O,Q,X,c,j){this.Yg=new S(M.base,M.Pg),this.ez=A,this.friction=O,this.restitution=Q,this.lX=X,this.FK=c,this.Mc=!!j,this.Zg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.JG=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.tB=z.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=z.create(),this._impulses=z.create(),this._sleepFrameCount=10}loadFromCopy(M){z.k(this.Yg.base,M.Yg.base),z.k(this.Yg.Pg,M.Yg.Pg),z.k(this.Yg.max,M.Yg.max),this.Yg.mag=M.Yg.mag,this.ez=M.ez,this.friction=M.friction,this.restitution=M.restitution,this.lX=M.lX,this.FK=M.FK,this.Mc=M.Mc,this.Zg=M.Zg,this.fluidDrag=M.fluidDrag,this.JG=M.JG,this.preventFallOffEdge=M.preventFallOffEdge,this.rolledBackLastTick=M.rolledBackLastTick,z.k(this.tB,M.tB),z.k(this.resting,M.resting),this.inFluid=M.inFluid,this._ratioInFluid=M._ratioInFluid,z.k(this._forces,M._forces),z.k(this._impulses,M._impulses),this._sleepFrameCount=M._sleepFrameCount}setPosition(M){X(M),z.dA(M,M,this.Yg.base),this.Yg.translate(M),this.xB()}pz(){return z.clone(this.Yg.base)}applyForce(M){X(M),z.add(this._forces,this._forces,M),this.xB()}applyImpulse(M){X(M),z.add(this._impulses,this._impulses,M),this.xB()}xB(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var X=M=>{};var c=O(14544),j=O(166),B=O(14552);function g(){this.Zg=.1,this.fluidDrag=.4,this.hc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function e(M,A,O){M=Object.assign(new g,M),this.gravity=M.gravity||[0,-10,0],this.Zg=M.Zg||.1,this.hc=M.hc||2,this.fluidDrag=M.fluidDrag||.4,this.minBounceImpulse=M.minBounceImpulse,this.bodies=[],this.kJ=M.kJ,this.testSolid=A,this.testFluid=O}e.prototype.LK=function(M,A,O,S,z,X){M=M||new c([0,0,0],[1,1,1]),"undefined"==typeof A&&(A=1),"undefined"==typeof O&&(O=1),"undefined"==typeof S&&(S=0),"undefined"==typeof z&&(z=1);var j=new Q(M,A,O,S,z,X);return this.bodies.push(j),j},e.prototype.tK=function(M){var A=this.bodies.indexOf(M);A<0||(this.bodies.splice(A,1),M.Yg=M.FK=null)};var T=j.create(),J=j.create(),K=j.create(),G=j.create(),d=j.create(),w=j.create(),I=j.create(),b=new c([0,0,0],[1,1,1]),s=new Q(b,1,1,0,1,(()=>{}),!1);function Y(M,A,O){return A=O,A*=1-(1-M.ratioInFluid)**2}e.prototype.Ij=function(M){M/=1e3;var A=o(0,j.squaredLength(this.gravity));this.bodies.forEach((O=>function(M,A,O,S){j.k(d,A.resting),M.kJ&&s.loadFromCopy(A);if(A.ez<=0)return j.set(A.tB,0,0,0),j.set(A._forces,0,0,0),void j.set(A._impulses,0,0,0);var z=S||0===A.lX;if(function(M,A,O,S){if(A._sleepFrameCount>0)return!1;if(S)return!0;var z=!1,Q=.5*O*O*A.lX;return j.scale(x,M.gravity,Q),B(M.testSolid,A.Yg,x,(function(){return z=!0,!0}),!0),z}(M,A,O,z))return;A._sleepFrameCount--,function(M,A){var O=A.Yg,S=Math.floor(O.base[0]),z=Math.floor(O.base[2]),Q=Math.floor(O.base[1]),X=Math.floor(O.max[1]);if(!M.testFluid(S,Q,z))return A.inFluid=!1,void(A.ratioInFluid=0);var c=1,B=Q+1;for(;B<=X&&M.testFluid(S,B,z);)c++,B++;var g=(Q+c-O.base[1])/O.Pg[1];g>1&&(g=1);var e=O.Pg[0]*O.Pg[1]*O.Pg[2]*g,T=H;j.scale(T,M.gravity,-M.hc*e*A.lX),A.applyForce(T),A.inFluid=!0,A.ratioInFluid=g}(M,A),v(A._forces),v(A._impulses),v(A.tB),v(A.resting),j.scale(T,A._forces,1/A.ez),j.gj(T,T,M.gravity,A.lX),j.scale(J,A._impulses,1/A.ez),j.gj(J,J,T,O),j.add(A.tB,A.tB,J),A.friction&&(C(M,0,A,J,O),C(M,1,A,J,O),C(M,2,A,J,O));var Q=A.fluidDrag>=0?A.fluidDrag:M.fluidDrag,X=A.Zg>=0?A.Zg:M.Zg,c=X,g=X;A.inFluid&&(c=Y(A,c,A.fluidDragHoriz>=0?A.fluidDragHoriz:Q),g=Y(A,g,A.fluidDragVert>=0?A.fluidDragVert:Q));c=Math.max(1-c*O/A.ez,0),g=Math.max(1-g*O/A.ez,0),j.set(E,c,g,c),j.multiply(A.tB,A.tB,E),j.scale(K,A.tB,O),j.set(A._forces,0,0,0),j.set(A._impulses,0,0,0),A.Mc&&p(F,A.Yg);j.k(w,K),j.set(I,0,0,0),A.preventFallOffEdge&&function(M,A,O,S){if(!A.resting[1]||O[1]>0)return;var z=U;p(z,A.Yg);for(var Q=0;Q<3;Q+=2){j.set(i,0,0,0),i[Q]=O[Q];var X=!0;(X=(X=(X=(X=X&&!t(M,z.base[0]+i[0]+1e-5,z.base[1],z.base[2]+i[2]+1e-5))&&!t(M,z.max[0]+i[0]-1e-5,z.base[1],z.base[2]+i[2]+1e-5))&&!t(M,z.base[0]+i[0]+1e-5,z.base[1],z.max[2]+i[2]-1e-5))&&!t(M,z.max[0]+i[0]-1e-5,z.base[1],z.max[2]+i[2]-1e-5))?(S[Q]=O[Q]>0?1:-1,O[Q]=0):0===Q&&(j.set(L,O[0],0,0),D(M,z,L,S,A.slideOnCollision))}}(M,A,K,I);D(M,A.Yg,K,A.resting,A.slideOnCollision),A.Mc&&function(M,A,O,S){if(A.resting[1]>=0&&!A.inFluid)return;var z=0!==A.resting[0],Q=0!==A.resting[2];if(!z&&!Q)return;var X=Math.abs(S[0]/S[2]),c=4;if(!z&&X>c)return;if(!Q&&X<1/c)return;j.add(y,O.base,S);var g=M.testSolid;B(g,O,S,(function(M,A,O,S){if(1!==A)return!0;S[A]=0}));var e=O.base[1],T=A.inFluid?1.951:1.001,J=Math.floor(e+T)-e;j.set(h,0,J,0);var K=!1;if(B(g,O,h,(function(M,A,O,S){return K=!0,!0})),K)return;j.dA(u,y,O.base),u[1]=0,D(M,O,u,N,!0);var G=o(O.base[0],y[0]),d=o(O.base[2],y[2]);if(z&&!G&&(!d||!Q))return;if(Q&&(!G||!z)&&!d)return;var w=!0;if(w=w&&!t(M,O.base[0]+1e-5,O.base[1],O.base[2]+1e-5),w=w&&!t(M,O.max[0]-1e-5,O.base[1],O.base[2]+1e-5),w=w&&!t(M,O.base[0]+1e-5,O.base[1],O.max[2]-1e-5),w=w&&!t(M,O.max[0]-1e-5,O.base[1],O.max[2]-1e-5),w)return;p(A.Yg,O),A.resting[0]=N[0],A.resting[2]=N[2],A.JG&&A.JG()}(M,A,F,w);for(var e=0;e<3;++e)A.resting[e]=A.resting[e]||I[e],G[e]=0,A.resting[e]&&(d[e]||(G[e]=-A.tB[e]),A.tB[e]=0);var b=j.length(G);b>.001&&(j.scale(G,G,A.ez),A.FK&&A.FK(G),A.restitution>0&&b>M.minBounceImpulse&&(j.scale(G,G,A.restitution),A.applyImpulse(G)));var f=j.squaredLength(A.tB);f>1e-5&&A.xB();M.kJ&&M.kJ(A)?(A.loadFromCopy(s),A.rolledBackLastTick=!0):A.rolledBackLastTick=!1}(this,O,M,A)))};var E=j.create([0,0,0]);var H=j.create();function C(M,A,O,S,z){var Q=O.resting[A],X=S[A];if(!O.alwaysApplyHorizFriction||1!==A){if(0===Q)return;if(Q*X<=0)return}j.k(f,O.tB),f[A]=0;var c=j.length(f);if(!o(c,0)){var B=Math.abs(O.friction*M.gravity[A]*z),g=c>B?(c-B)/c:0;O.tB[(A+1)%3]*=g,O.tB[(A+2)%3]*=g}}var f=j.create();function D(M,A,O,S,z){return j.set(S,0,0,0),B(M.testSolid,A,O,(function(M,A,O,Q){S[A]=O,Q[A]=0,z||(Q[0]=0,Q[1]=0,Q[2]=0)}))}var F=new c([],[]),N=j.create(),y=j.create(),h=j.create(),u=j.create();var i=j.create(),U=new c([],[]),L=j.create();function t(M,A,O,S){return M.testSolid(Math.floor(A),Math.floor(O-1),Math.floor(S))}var x=j.create();function o(M,A){return Math.abs(M-A)<1e-5}function p(M,A){for(var O=0;O<3;O++)M.base[O]=A.base[O],M.max[O]=A.max[O],M.Pg[O]=A.Pg[O]}var v=function(M){}},14608:M=>{"use strict";M.exports=function(M,A,O,S){var z=self||window;try{try{var Q;try{Q=new z.Blob([M])}catch(B){(Q=new(z.BlobBuilder||z.WebKitBlobBuilder||z.MozBlobBuilder||z.MSBlobBuilder)).append(M),Q=Q.getBlob()}var X=z.URL||z.webkitURL,c=X.createObjectURL(Q),j=new z[A](c,O);return X.revokeObjectURL(c),j}catch(B){return new z[A]("data:application/javascript,".concat(encodeURIComponent(M)),O)}}catch(B){if(!S)throw Error("Inline worker is not supported");return new z[A](S,O)}}},13741:(M,A,O)=>{"use strict";function S(M,A,O,S,z){var Q={};return Object.keys(S).forEach((function(M){Q[M]=S[M]})),Q.enumerable=!!Q.enumerable,Q.configurable=!!Q.configurable,("value"in Q||Q.initializer)&&(Q.writable=!0),Q=O.slice().reverse().reduce((function(O,S){return S(M,A,O)||O}),Q),z&&void 0!==Q.initializer&&(Q.value=Q.initializer?Q.initializer.call(z):void 0,Q.initializer=void 0),void 0===Q.initializer&&(Object.defineProperty(M,A,Q),Q=null),Q}O.d(A,{e:()=>S})},13734:(M,A,O)=>{"use strict";function S(M,A,O,S){O&&Object.defineProperty(M,A,{enumerable:O.enumerable,configurable:O.configurable,writable:O.writable,value:O.initializer?O.initializer.call(S):void 0})}O.d(A,{b:()=>S})},14761:(M,A,O)=>{"use strict";O.d(A,{b:()=>X,e:()=>e,i:()=>c,m:()=>Q,q:()=>j,s:()=>z,w:()=>B,y:()=>g});var S=O(13189);class z{constructor(){this._easingMode=z.EASINGMODE_EASEIN}setEasingMode(M){const A=Math.min(Math.max(M,0),2);this._easingMode=A}getEasingMode(){return this._easingMode}easeInCore(M){throw new Error("You must implement this method")}ease(M){switch(this._easingMode){case z.EASINGMODE_EASEIN:return this.easeInCore(M);case z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-M)}return M>=.5?.5*(1-this.easeInCore(2*(1-M)))+.5:.5*this.easeInCore(2*M)}}z.EASINGMODE_EASEIN=0,z.EASINGMODE_EASEOUT=1,z.EASINGMODE_EASEINOUT=2;class Q extends z{easeInCore(M){return M=Math.max(0,Math.min(1,M)),1-Math.sqrt(1-M*M)}}class X extends z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=M}easeInCore(M){const A=Math.max(0,this.amplitude);return Math.pow(M,3)-M*A*Math.sin(3.141592653589793*M)}}class c extends z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=M,this.bounciness=A}easeInCore(M){const A=Math.max(0,this.bounces);let O=this.bounciness;O<=1&&(O=1.001);const S=Math.pow(O,A),z=1-O,Q=(1-S)/z+.5*S,X=M*Q,c=Math.log(-X*(1-O)+1)/Math.log(O),j=Math.floor(c),B=j+1,g=(1-Math.pow(O,j))/(z*Q),e=.5*(g+(1-Math.pow(O,B))/(z*Q)),T=M-e,J=e-g;return-Math.pow(1/O,A-j)/(J*J)*(T-J)*(T+J)}}class j extends z{easeInCore(M){return M*M*M}}class B extends z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=M,this.springiness=A}easeInCore(M){let A;const O=Math.max(0,this.oscillations),S=Math.max(0,this.springiness);return A=0==S?M:(Math.exp(S*M)-1)/(Math.exp(S)-1),A*Math.sin((6.283185307179586*O+1.5707963267948966)*M)}}class g extends z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=M}easeInCore(M){return this.exponent<=0?M:(Math.exp(this.exponent*M)-1)/(Math.exp(this.exponent)-1)}}class e extends z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=M,this.y1=A,this.x2=O,this.y2=S}easeInCore(M){return S.e.Interpolate(M,this.x1,this.y1,this.x2,this.y2)}}},14162:(M,A,O)=>{"use strict";O.d(A,{e:()=>X});var S=O(12970),z=O(12977),Q=O(13393);class X extends Q.e{get _matrix(){return this._compose(),this.LJ}set _matrix(M){(M.updateFlag!==this.LJ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.LJ.S(M),this._markAsDirtyAndDecompose())}constructor(M,A){var O;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(M,A.HM(),!1),this.name=M,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=A,this.LJ=null!==(O=null===Q||void 0===Q?void 0:Q.clone())&&void 0!==O?O:S.Matrix.Identity(),this._restMatrix=null!==X&&void 0!==X?X:this.LJ.clone(),this._bindMatrix=null!==c&&void 0!==c?c:this.LJ.clone(),this._index=j,this._absoluteMatrix=new S.Matrix,this._absoluteBindMatrix=new S.Matrix,this._absoluteInverseBindMatrix=new S.Matrix,this._finalMatrix=new S.Matrix,A.bones.push(this),this.setParent(z,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(M){this.setParent(M)}setParent(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==M){if(this.parent){const M=this.parent.children.indexOf(this);-1!==M&&this.parent.children.splice(M,1)}this._parentNode=M,this.parent&&this.parent.children.push(this),A&&this._updateAbsoluteBindMatrices(),this.ug()}}getLocalMatrix(){return this._compose(),this.LJ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(M){this._restMatrix.S(M)}setRestPose(M){this.setRestMatrix(M)}getBindPose(){return this.getBindMatrix()}setBindMatrix(M){this.Kc(M)}setBindPose(M){this.setBindMatrix(M)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){var M;const A=S.TmpVectors.GA[0],O=S.TmpVectors.Quaternion[0],z=S.TmpVectors.GA[1];this.getRestMatrix().decompose(A,O,z),this._linkedTransformNode.position.S(z),this._linkedTransformNode.rotationQuaternion=null!==(M=this._linkedTransformNode.rotationQuaternion)&&void 0!==M?M:S.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.S(O),this._linkedTransformNode.Ec.S(A)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(M){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=M,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.uj}set position(M){this._decompose(),this.uj.S(M),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(M){this.setRotation(M)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(M){this.setRotationQuaternion(M)}get Ec(){return this.getScale()}set Ec(M){this.setScale(M)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=S.GA.Zero(),this._localRotation=S.Quaternion.Zero(),this.uj=S.GA.Zero()),this.LJ.decompose(this._localScaling,this._localRotation,this.uj))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,S.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.uj,this.LJ)):this._needToCompose=!1)}Kc(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.S(M),A&&this._updateAbsoluteBindMatrices(),O?this._matrix=M:this.ug()}_updateAbsoluteBindMatrices(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(M||(M=this._bindMatrix),this.parent?M.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.S(M),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),A)for(let O=0;O<this.children.length;O++)this.children[O]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ug(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ug(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ug(),this._needToDecompose=!0}_updatePosition(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=this.getLocalMatrix();if(0==A)z?(Q.addAtIndex(12,M.x),Q.addAtIndex(13,M.y),Q.addAtIndex(14,M.z)):Q.setTranslationFromFloats(M.x,M.y,M.z);else{let A=null;O&&(A=O.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const c=X._TmpMats[0],j=X._TmpVecs[0];this.parent?O&&A?(c.S(this.parent.getAbsoluteMatrix()),c.multiplyToRef(A,c)):c.S(this.parent.getAbsoluteMatrix()):S.Matrix.IdentityToRef(c),z&&c.setTranslationFromFloats(0,0,0),c.invert(),S.GA.TransformCoordinatesToRef(M,c,j),z?(Q.addAtIndex(12,j.x),Q.addAtIndex(13,j.y),Q.addAtIndex(14,j.z)):Q.setTranslationFromFloats(j.x,j.y,j.z)}this._markAsDirtyAndDecompose()}translate(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,A,O,!0)}setPosition(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;this._updatePosition(M,A,O,!1)}setAbsolutePosition(M,A){this.setPosition(M,1,A)}scale(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.getLocalMatrix(),c=X._TmpMats[0];S.Matrix.ScalingToRef(M,A,O,c),c.multiplyToRef(Q,Q),c.invert();for(const S of this.children){const z=S.getLocalMatrix();z.multiplyToRef(c,z),z.multiplyAtIndex(12,M),z.multiplyAtIndex(13,A),z.multiplyAtIndex(14,O),S._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),z)for(const S of this.children)S.scale(M,A,O,z)}setScale(M){this._decompose(),this._localScaling.S(M),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(M){this._decompose(),M.S(this._localScaling)}setYawPitchRoll(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4?arguments[4]:void 0;if(0===z){const c=X._TmpQuat;return S.Quaternion.RotationYawPitchRollToRef(M,A,O,c),void this.setRotationQuaternion(c,z,Q)}const c=X._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,Q))return;const j=X._TmpMats[1];S.Matrix.RotationYawPitchRollToRef(M,A,O,j),c.multiplyToRef(j,j),this._rotateWithMatrix(j,z,Q)}rotate(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;const Q=X._TmpMats[0];Q.setTranslationFromFloats(0,0,0),S.Matrix.RotationAxisToRef(M,A,Q),this._rotateWithMatrix(Q,O,z)}setAxisAngle(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;if(0===O){const Q=X._TmpQuat;return S.Quaternion.RotationAxisToRef(M,A,Q),void this.setRotationQuaternion(Q,O,z)}const Q=X._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Q,z))return;const c=X._TmpMats[1];S.Matrix.RotationAxisToRef(M,A,c),Q.multiplyToRef(c,c),this._rotateWithMatrix(c,O,z)}setRotation(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(M.y,M.x,M.z,A,O)}setRotationQuaternion(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;if(0===A)return this._decompose(),this._localRotation.S(M),void this._markAsDirtyAndCompose();const z=X._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,O))return;const Q=X._TmpMats[1];S.Matrix.FromQuaternionToRef(M,Q),z.multiplyToRef(Q,Q),this._rotateWithMatrix(Q,A,O)}setRotationMatrix(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;if(0===A){const z=X._TmpQuat;return S.Quaternion.FromRotationMatrixToRef(M,z),void this.setRotationQuaternion(z,A,O)}const z=X._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,O))return;const Q=X._TmpMats[1];Q.S(M),z.multiplyToRef(M,Q),this._rotateWithMatrix(Q,A,O)}_rotateWithMatrix(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;const S=this.getLocalMatrix(),z=S.m[12],Q=S.m[13],c=S.m[14],j=this.getParent(),B=X._TmpMats[3],g=X._TmpMats[4];j&&1==A?(O?(B.S(O.getWorldMatrix()),j.getAbsoluteMatrix().multiplyToRef(B,B)):B.S(j.getAbsoluteMatrix()),g.S(B),g.invert(),S.multiplyToRef(B,S),S.multiplyToRef(M,S),S.multiplyToRef(g,S)):1==A&&O?(B.S(O.getWorldMatrix()),g.S(B),g.invert(),S.multiplyToRef(B,S),S.multiplyToRef(M,S),S.multiplyToRef(g,S)):S.multiplyToRef(M,S),S.setTranslationFromFloats(z,Q,c),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(M,A){const O=X._TmpMats[2];return M.S(this.getAbsoluteMatrix()),A?(M.multiplyToRef(A.getWorldMatrix(),M),S.Matrix.ScalingToRef(A.Ec.x,A.Ec.y,A.Ec.z,O)):S.Matrix.IdentityToRef(O),M.invert(),!isNaN(M.m[0])&&(O.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyToRef(O,M),!0)}pz(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.GA.Zero();return this.getPositionToRef(M,A,O),O}getPositionToRef(){let M=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const M=this.getLocalMatrix();A.x=M.m[12],A.y=M.m[13],A.z=M.m[14]}else{let O=null;M&&(O=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let S=X._TmpMats[0];M&&O?(S.S(this.getAbsoluteMatrix()),S.multiplyToRef(O,S)):S=this.getAbsoluteMatrix(),A.x=S.m[12],A.y=S.m[13],A.z=S.m[14]}}getAbsolutePosition(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=S.GA.Zero();return this.getPositionToRef(1,M,A),A}getAbsolutePositionToRef(M,A){this.getPositionToRef(1,M,A)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.LJ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.S(this.LJ);const M=this._skeleton.getPoseMatrix();M&&this._absoluteMatrix.multiplyToRef(M,this._absoluteMatrix)}const M=this.children,A=M.length;for(let O=0;O<A;O++)M[O].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}QB(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.GA.Zero();return this.getDirectionToRef(M,A,O),O}getDirectionToRef(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0,z=null;A&&(z=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=X._TmpMats[0];Q.S(this.getAbsoluteMatrix()),A&&z&&Q.multiplyToRef(z,Q),S.GA.TransformNormalToRef(M,Q,O),O.normalize()}getRotation(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.GA.Zero();return this.getRotationToRef(M,A,O),O}getRotationToRef(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0;const S=X._TmpQuat;this.getRotationQuaternionToRef(M,A,S),S.toEulerAnglesToRef(O)}getRotationQuaternion(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.Quaternion.Identity();return this.getRotationQuaternionToRef(M,A,O),O}getRotationQuaternionToRef(){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),A.S(this._localRotation);else{const O=X._TmpMats[0],S=this.getAbsoluteMatrix();M?S.multiplyToRef(M.getWorldMatrix(),O):O.S(S),O.multiplyAtIndex(0,this._scalingDeterminant),O.multiplyAtIndex(1,this._scalingDeterminant),O.multiplyAtIndex(2,this._scalingDeterminant),O.decompose(void 0,A,void 0)}}getRotationMatrix(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1?arguments[1]:void 0;const O=S.Matrix.Identity();return this.getRotationMatrixToRef(M,A,O),O}getRotationMatrixToRef(){let M=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(A);else{const O=X._TmpMats[0],S=this.getAbsoluteMatrix();M?S.multiplyToRef(M.getWorldMatrix(),O):O.S(S),O.multiplyAtIndex(0,this._scalingDeterminant),O.multiplyAtIndex(1,this._scalingDeterminant),O.multiplyAtIndex(2,this._scalingDeterminant),O.getRotationMatrixToRef(A)}}getAbsolutePositionFromLocal(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.GA.Zero();return this.getAbsolutePositionFromLocalToRef(M,A,O),O}getAbsolutePositionFromLocalToRef(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0,z=null;A&&(z=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=X._TmpMats[0];Q.S(this.getAbsoluteMatrix()),A&&z&&Q.multiplyToRef(z,Q),S.GA.TransformCoordinatesToRef(M,Q,O)}getLocalPositionFromAbsolute(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=S.GA.Zero();return this.getLocalPositionFromAbsoluteToRef(M,A,O),O}getLocalPositionFromAbsoluteToRef(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2?arguments[2]:void 0,z=null;A&&(z=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Q=X._TmpMats[0];Q.S(this.getAbsoluteMatrix()),A&&z&&Q.multiplyToRef(z,Q),Q.invert(),S.GA.TransformCoordinatesToRef(M,Q,O)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const M=this._skeleton.bones.indexOf(this);if(-1!==M&&this._skeleton.bones.splice(M,1),this._parentNode&&this._parentNode.children){const M=this._parentNode.children,A=M.indexOf(this);-1!==A&&M.splice(A,1)}super.dispose()}}X._TmpVecs=(0,z.b)(2,S.GA.Zero),X._TmpQuat=S.Quaternion.Identity(),X._TmpMats=(0,z.b)(5,S.Matrix.Identity)},14752:(M,A,O)=>{"use strict";O.d(A,{d:()=>i});var S=O(12958),z=O(12964),Q=O(12776),X=O(12970),c=O(12980),j=O(13393),B=O(13422),g=O(13244),e=O(12793),T=O(12974);class J{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(M){this._idleRotationSpeed=M}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(M){this._idleRotationWaitTime=M}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(M){this._idleRotationSpinupTime=M}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(M){this._attachedCamera=M;const A=this._attachedCamera.HM();this._onPrePointerObservableObserver=A.onPrePointerObservable.add((M=>{M.type!==g.b.POINTERDOWN?M.type===g.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const M=e.d.Now;let A=0;null!=this._lastFrameTime&&(A=M-this._lastFrameTime),this._lastFrameTime=M,this._applyUserInteraction();const O=M-this._lastInteractionTime-this._idleRotationWaitTime,S=Math.max(Math.min(O/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*S,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(A/1e3))}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.HM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(M){this._lastInteractionTime=null!==M&&void 0!==M?M:e.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<T.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let M=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(M=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?M:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var K=O(14761),G=O(13499);class d{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(M){if(this._autoTransitionRange===M)return;this._autoTransitionRange=M;const A=this._attachedCamera;A&&(M?this._onMeshTargetChangedObserver=A.onMeshTargetChangedObservable.add((M=>{if(M&&(M.Gc(!0),M.getBoundingInfo)){const A=M.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*A,this.upperRadiusTransitionRange=.05*A}})):this._onMeshTargetChangedObserver&&A.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(M){this._attachedCamera=M,this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(M){return!!this._attachedCamera&&(this._attachedCamera.radius===M&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(M){if(!this._attachedCamera)return;this._radiusBounceTransition||(d.EasingFunction.setEasingMode(d.EasingMode),this._radiusBounceTransition=G.b.CreateAnimation("radius",G.b.ANIMATIONTYPE_FLOAT,60,d.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const A=G.b.TransitionTo("radius",this._attachedCamera.radius+M,this._attachedCamera,this._attachedCamera.HM(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));A&&this._animatables.push(A)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}d.EasingFunction=new K.b(.3),d.EasingMode=K.s.EASINGMODE_EASEOUT;class w{constructor(){this.onTargetFramingAnimationEndObservable=new Q.c,this._mode=w.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(M){this._mode=M}get mode(){return this._mode}set radiusScale(M){this._radiusScale=M}get radiusScale(){return this._radiusScale}set positionScale(M){this._positionScale=M}get positionScale(){return this._positionScale}set defaultElevation(M){this._defaultElevation=M}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(M){this._elevationReturnTime=M}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(M){this._elevationReturnWaitTime=M}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(M){this._zoomStopsAnimation=M}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(M){this._framingTime=M}get framingTime(){return this._framingTime}init(){}attach(M){this._attachedCamera=M;const A=this._attachedCamera.HM();w.EasingFunction.setEasingMode(w.EasingMode),this._onPrePointerObservableObserver=A.onPrePointerObservable.add((M=>{M.type!==g.b.POINTERDOWN?M.type===g.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=M.onMeshTargetChangedObservable.add((M=>{M&&M.getBoundingInfo&&this.zoomOnMesh(M,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=M.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const M=this._attachedCamera.HM();this._onPrePointerObservableObserver&&M.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.Gc(!0);const S=M.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(S.minimumWorld,S.maximumWorld,A,O)}zoomOnMeshHierarchy(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M.Gc(!0);const S=M.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(S.min,S.max,A,O)}zoomOnMeshesHierarchy(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new X.GA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new X.GA(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Q=0;Q<M.length;Q++){const A=M[Q].getHierarchyBoundingVectors(!0);X.GA.CheckExtends(A.min,S,z),X.GA.CheckExtends(A.max,S,z)}this.zoomOnBoundingInfo(S,z,A,O)}zoomOnBoundingInfo(M,A){let O,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Q=M.y,c=Q+(A.y-Q)*this._positionScale,j=A.dA(M).scale(.5);if(!isFinite(c))return!1;if(S)O=new X.GA(0,c,0);else{const A=M.add(j);O=new X.GA(A.x,c,A.z)}this._vectorTransition||(this._vectorTransition=G.b.CreateAnimation("target",G.b.ANIMATIONTYPE_VECTOR3,60,w.EasingFunction)),this._betaIsAnimating=!0;let B=G.b.TransitionTo("target",O,this._attachedCamera,this._attachedCamera.HM(),60,this._vectorTransition,this._framingTime);B&&this._animatables.push(B);let g=0;if(this._mode===w.FitFrustumSidesMode){const O=this._calculateLowerRadiusFromModelBoundingSphere(M,A);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=j.length()+this._attachedCamera.Tc),g=O}else this._mode===w.IgnoreBoundsSizeMode&&(g=this._calculateLowerRadiusFromModelBoundingSphere(M,A),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Tc));if(this.autoCorrectCameraLimitsAndSensibility){const O=A.dA(M).length();this._attachedCamera.panningSensibility=5e3/O,this._attachedCamera.wheelPrecision=100/g}return this._radiusTransition||(this._radiusTransition=G.b.CreateAnimation("radius",G.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction)),B=G.b.TransitionTo("radius",g,this._attachedCamera,this._attachedCamera.HM(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),z&&z(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),B&&this._animatables.push(B),!0}_calculateLowerRadiusFromModelBoundingSphere(M,A){const O=this._attachedCamera;if(!O)return 0;let S=O._calculateLowerRadiusFromModelBoundingSphere(M,A,this._radiusScale);return O.lowerRadiusLimit&&this._mode===w.IgnoreBoundsSizeMode&&(S=S<O.lowerRadiusLimit?O.lowerRadiusLimit:S),O.upperRadiusLimit&&(S=S>O.upperRadiusLimit?O.upperRadiusLimit:S),S}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const M=e.d.Now-this._lastInteractionTime,A=.5*Math.PI-this._defaultElevation,O=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>O&&M>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=G.b.CreateAnimation("beta",G.b.ANIMATIONTYPE_FLOAT,60,w.EasingFunction));const M=G.b.TransitionTo("beta",A,this._attachedCamera,this._attachedCamera.HM(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));M&&this._animatables.push(M)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=e.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}w.EasingFunction=new K.y,w.EasingMode=K.s.EASINGMODE_EASEINOUT,w.IgnoreBoundsSizeMode=0,w.FitFrustumSidesMode=1;var I=O(13428),b=O(13460),s=O(14160),Y=O(12768);class E{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(M){M=Y.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),O=A.getInputElement();let S=0,z=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Q=>{var X,c;const j=Q.event,B="touch"===j.pointerType;if(Q.type!==g.b.POINTERMOVE&&-1===this.buttons.indexOf(j.button))return;const e=j.target;if(this._altKey=j.altKey,this._ctrlKey=j.ctrlKey,this._metaKey=j.metaKey,this._shiftKey=j.shiftKey,this._buttonsPressed=j.buttons,A.isPointerLock){const M=j.movementX,A=j.movementY;this.onTouch(null,M,A),this._pointA=null,this._pointB=null}else{if(Q.type!==g.b.POINTERDOWN&&Q.type!==g.b.POINTERDOUBLETAP&&B&&(null===(X=this._pointA)||void 0===X?void 0:X.pointerId)!==j.pointerId&&(null===(c=this._pointB)||void 0===c?void 0:c.pointerId)!==j.pointerId)return;if(Q.type!==g.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!B)if(Q.type===g.b.POINTERDOUBLETAP)this.onDoubleTap(j.pointerType);else if(Q.type!==g.b.POINTERUP||this._currentMousePointerIdDown!==j.pointerId&&!B){if(Q.type===g.b.POINTERMOVE)if(M||j.preventDefault(),this._pointA&&null===this._pointB){const M=j.clientX-this._pointA.x,A=j.clientY-this._pointA.y;this._pointA.x=j.clientX,this._pointA.y=j.clientY,this.onTouch(this._pointA,M,A)}else if(this._pointA&&this._pointB){const M=this._pointA.pointerId===j.pointerId?this._pointA:this._pointB;M.x=j.clientX,M.y=j.clientY;const A=this._pointA.x-this._pointB.x,O=this._pointA.y-this._pointB.y,X=A*A+O*O,c={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:j.pointerId,type:Q.type};this.onMultiTouch(this._pointA,this._pointB,S,X,z,c),z=c,S=X}}else{try{null===e||void 0===e||e.releasePointerCapture(j.pointerId)}catch(T){}B||(this._pointB=null),A._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==j.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==j.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==S||z)&&(this.onMultiTouch(this._pointA,this._pointB,S,0,z,null),S=0,z=null),this._currentMousePointerIdDown=-1,this.onButtonUp(j),M||j.preventDefault()}else{try{null===e||void 0===e||e.setPointerCapture(j.pointerId)}catch(T){}if(null===this._pointA)this._pointA={x:j.clientX,y:j.clientY,pointerId:j.pointerId,type:j.pointerType};else{if(null!==this._pointB)return;this._pointB={x:j.clientX,y:j.clientY,pointerId:j.pointerId,type:j.pointerType}}-1!==this._currentMousePointerIdDown||B||(this._currentMousePointerIdDown=j.pointerId),this.onButtonDown(j),M||(j.preventDefault(),O&&O.focus())}}},this._observer=this.camera.HM()._inputManager._addCameraPointerObserver(this._pointerInput,g.b.POINTERDOWN|g.b.POINTERUP|g.b.POINTERMOVE|g.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,S=0,z=null,this.onLostFocus()},this._contextMenuBind=M=>this.onContextMenu(M),O&&O.addEventListener("contextmenu",this._contextMenuBind,!1);const Q=this.camera.HM().getEngine().getHostWindow();Q&&Y.Tools.RegisterTopRootEvents(Q,[{name:"blur",handler:this._onLostFocus}])}VT(){if(this._onLostFocus){const M=this.camera.HM().getEngine().getHostWindow();M&&Y.Tools.UnregisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.HM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const M=this.camera.HM().getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(M){}onTouch(M,A,O){}onMultiTouch(M,A,O,S,z,Q){}onContextMenu(M){M.preventDefault()}onButtonDown(M){}onButtonUp(M){}onLostFocus(){}}(0,S.d)([(0,z.H)()],E.prototype,"buttons",void 0);class H extends E{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(M,A){if(0!==this.panningSensibility&&M&&A){const O=A.x-M.x,S=A.y-M.y;this.camera.inertialPanningX+=-O/this.panningSensibility,this.camera.inertialPanningY+=S/this.panningSensibility}}_computePinchZoom(M,A){const O=this.camera.radius||H.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=O*Math.sqrt(M)/Math.sqrt(A):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(A-M)*O*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(A-M)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(M,A,O){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=O/this.panningSensibility):(this.camera.inertialAlphaOffset-=A/this.angularSensibilityX,this.camera.inertialBetaOffset-=O/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(M,A,O,S,z,Q){0===O&&null===z||0===S&&null===Q||(this.multiTouchPanAndZoom?(this._computePinchZoom(O,S),this._computeMultiTouchPanning(z,Q)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(S)-Math.sqrt(O))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(O,S),this._isPinching=!0):this._computeMultiTouchPanning(z,Q)):this.multiTouchPanning?this._computeMultiTouchPanning(z,Q):this.pinchZoom&&this._computePinchZoom(O,S))}onButtonDown(M){this._isPanClick=M.button===this.camera._panningMouseButton}onButtonUp(M){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}H.MinimumRadiusForPinch=.001,(0,S.d)([(0,z.H)()],H.prototype,"buttons",void 0),(0,S.d)([(0,z.H)()],H.prototype,"angularSensibilityX",void 0),(0,S.d)([(0,z.H)()],H.prototype,"angularSensibilityY",void 0),(0,S.d)([(0,z.H)()],H.prototype,"pinchPrecision",void 0),(0,S.d)([(0,z.H)()],H.prototype,"pinchDeltaPercentage",void 0),(0,S.d)([(0,z.H)()],H.prototype,"useNaturalPinchZoom",void 0),(0,S.d)([(0,z.H)()],H.prototype,"pinchZoom",void 0),(0,S.d)([(0,z.H)()],H.prototype,"panningSensibility",void 0),(0,S.d)([(0,z.H)()],H.prototype,"multiTouchPanning",void 0),(0,S.d)([(0,z.H)()],H.prototype,"multiTouchPanAndZoom",void 0),s.b.ArcRotateCameraPointersInput=H;var C=O(13247);class f{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(M){M=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const O=A.event;if(!O.metaKey)if(A.type===C.e.KEYDOWN){if(this._ctrlPressed=O.ctrlKey,this._altPressed=O.altKey,-1!==this.keysUp.indexOf(O.keyCode)||-1!==this.keysDown.indexOf(O.keyCode)||-1!==this.keysLeft.indexOf(O.keyCode)||-1!==this.keysRight.indexOf(O.keyCode)||-1!==this.keysReset.indexOf(O.keyCode)){-1===this._keys.indexOf(O.keyCode)&&this._keys.push(O.keyCode),O.preventDefault&&(M||O.preventDefault())}}else if(-1!==this.keysUp.indexOf(O.keyCode)||-1!==this.keysDown.indexOf(O.keyCode)||-1!==this.keysLeft.indexOf(O.keyCode)||-1!==this.keysRight.indexOf(O.keyCode)||-1!==this.keysReset.indexOf(O.keyCode)){const A=this._keys.indexOf(O.keyCode);A>=0&&this._keys.splice(A,1),O.preventDefault&&(M||O.preventDefault())}})))}VT(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let A=0;A<this._keys.length;A++){const O=this._keys[A];-1!==this.keysLeft.indexOf(O)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX-=1/this.panningSensibility:M.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(O)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset+=1/this.zoomingSensibility:M.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(O)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningX+=1/this.panningSensibility:M.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(O)?this._ctrlPressed&&this.camera._useCtrlForPanning?M.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?M.inertialRadiusOffset-=1/this.zoomingSensibility:M.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(O)&&M.useInputToRestoreState&&M.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,S.d)([(0,z.H)()],f.prototype,"keysUp",void 0),(0,S.d)([(0,z.H)()],f.prototype,"keysDown",void 0),(0,S.d)([(0,z.H)()],f.prototype,"keysLeft",void 0),(0,S.d)([(0,z.H)()],f.prototype,"keysRight",void 0),(0,S.d)([(0,z.H)()],f.prototype,"keysReset",void 0),(0,S.d)([(0,z.H)()],f.prototype,"panningSensibility",void 0),(0,S.d)([(0,z.H)()],f.prototype,"zoomingSensibility",void 0),(0,S.d)([(0,z.H)()],f.prototype,"useAltToZoom",void 0),(0,S.d)([(0,z.H)()],f.prototype,"angularSpeed",void 0),s.b.ArcRotateCameraKeyboardMoveInput=f;var D=O(13019),F=O(13250);class N{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new X.GA(0,0,0),this._globalOffset=new X.GA(0,0,0),this._inertialPanning=X.GA.Zero()}_computeDeltaFromMouseWheelLegacyEvent(M,A){let O=0;const S=.01*M*this.wheelDeltaPercentage*A;return O=M>0?S/(1+this.wheelDeltaPercentage):S*(1+this.wheelDeltaPercentage),O}attachControl(M){M=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==g.b.POINTERWHEEL)return;const O=A.event;let S=0;const z=O.deltaMode===F.d.DOM_DELTA_LINE?40:1,Q=-O.deltaY*z;if(this.customComputeDeltaFromMouseWheel)S=this.customComputeDeltaFromMouseWheel(Q,this,O);else if(this.wheelDeltaPercentage){if(S=this._computeDeltaFromMouseWheelLegacyEvent(Q,this.camera.radius),S>0){let M=this.camera.radius,A=this.camera.inertialRadiusOffset+S;for(let O=0;O<20&&!(M<=A)&&!(Math.abs(A*this.camera.inertia)<.001);O++)M-=A,A*=this.camera.inertia;M=(0,c.Clamp)(M,0,Number.MAX_VALUE),S=this._computeDeltaFromMouseWheelLegacyEvent(Q,M)}}else S=Q/(40*this.wheelPrecision);S&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(S)):this.camera.inertialRadiusOffset+=S),O.preventDefault&&(M||O.preventDefault())},this._observer=this.camera.HM()._inputManager._addCameraPointerObserver(this._wheel,g.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Hc(0)}VT(){this._observer&&(this.camera.HM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const M=this.camera;0+M.inertialAlphaOffset+M.inertialBetaOffset+M.inertialRadiusOffset&&(this._updateHitPlane(),M.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(M.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const M=this.camera,A=M.target.dA(M.position);this._hitPlane=D.e.FromPositionAndNormal(M.target,A)}_getPosition(){const M=this.camera,A=M.HM(),O=A.createPickingRay(A.pointerX,A.pointerY,X.Matrix.Identity(),M,!1);0===M.targetScreenOffset.x&&0===M.targetScreenOffset.y||(this._viewOffset.set(M.targetScreenOffset.x,M.targetScreenOffset.y,0),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),this._globalOffset=X.GA.TransformNormal(this._viewOffset,M._cameraTransformMatrix),O.origin.addInPlace(this._globalOffset));let S=0;var z;this._hitPlane&&(S=null!==(z=O.intersectsPlane(this._hitPlane))&&void 0!==z?z:0);return O.origin.addInPlace(O.direction.scaleInPlace(S))}_zoomToMouse(M){const A=this.camera,O=1-A.inertia;if(A.lowerRadiusLimit){var S;const z=null!==(S=A.lowerRadiusLimit)&&void 0!==S?S:0;A.radius-(A.inertialRadiusOffset+M)/O<z&&(M=(A.radius-z)*O-A.inertialRadiusOffset)}if(A.upperRadiusLimit){var z;const S=null!==(z=A.upperRadiusLimit)&&void 0!==z?z:0;A.radius-(A.inertialRadiusOffset+M)/O>S&&(M=(A.radius-S)*O-A.inertialRadiusOffset)}const Q=M/O/A.radius,c=this._getPosition(),j=X.TmpVectors.GA[6];c.subtractToRef(A.target,j),j.scaleInPlace(Q),j.scaleInPlace(O),this._inertialPanning.addInPlace(j),A.inertialRadiusOffset+=M}_zeroIfClose(M){Math.abs(M.x)<T.e&&(M.x=0),Math.abs(M.y)<T.e&&(M.y=0),Math.abs(M.z)<T.e&&(M.z=0)}}(0,S.d)([(0,z.H)()],N.prototype,"wheelPrecision",void 0),(0,S.d)([(0,z.H)()],N.prototype,"zoomToMouseLocation",void 0),(0,S.d)([(0,z.H)()],N.prototype,"wheelDeltaPercentage",void 0),s.b.ArcRotateCameraMouseWheelInput=N;class y extends s.c{constructor(M){super(M)}addMouseWheel(){return this.add(new N),this}addPointers(){return this.add(new H),this}addKeyboard(){return this.add(new f),this}}var h=O(12919);function u(M,A){return isNaN(M)?A:M}j.e.AddNodeConstructor("ArcRotateCamera",((M,A)=>()=>new i(M,0,0,1,X.GA.Zero(),A)));class i extends b.b{get target(){return this._target}set target(M){this.setTarget(M)}get targetHost(){return this._targetHost}set targetHost(M){M&&this.setTarget(M)}getTarget(){return this.target}get position(){return this._position}set position(M){this.setPosition(M)}set upVector(M){this._upToYMatrix||(this._yToUpMatrix=new X.Matrix,this._upToYMatrix=new X.Matrix,this._upVector=X.GA.Zero()),M.normalize(),this._upVector.S(M),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){X.Matrix.RotationAlignToRef(X.GA.UpReadOnly,this._upVector,this._yToUpMatrix),X.Matrix.RotationAlignToRef(this._upVector,X.GA.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityX:0}set angularSensibilityX(M){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityX=M)}get angularSensibilityY(){const M=this.inputs.attached.pointers;return M?M.angularSensibilityY:0}set angularSensibilityY(M){const A=this.inputs.attached.pointers;A&&(A.angularSensibilityY=M)}get pinchPrecision(){const M=this.inputs.attached.pointers;return M?M.pinchPrecision:0}set pinchPrecision(M){const A=this.inputs.attached.pointers;A&&(A.pinchPrecision=M)}get pinchDeltaPercentage(){const M=this.inputs.attached.pointers;return M?M.pinchDeltaPercentage:0}set pinchDeltaPercentage(M){const A=this.inputs.attached.pointers;A&&(A.pinchDeltaPercentage=M)}get useNaturalPinchZoom(){const M=this.inputs.attached.pointers;return!!M&&M.useNaturalPinchZoom}set useNaturalPinchZoom(M){const A=this.inputs.attached.pointers;A&&(A.useNaturalPinchZoom=M)}get panningSensibility(){const M=this.inputs.attached.pointers;return M?M.panningSensibility:0}set panningSensibility(M){const A=this.inputs.attached.pointers;A&&(A.panningSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const A=this.inputs.attached.keyboard;A&&(A.keysUp=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const A=this.inputs.attached.keyboard;A&&(A.keysDown=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const A=this.inputs.attached.keyboard;A&&(A.keysRight=M)}get wheelPrecision(){const M=this.inputs.attached.mousewheel;return M?M.wheelPrecision:0}set wheelPrecision(M){const A=this.inputs.attached.mousewheel;A&&(A.wheelPrecision=M)}get zoomToMouseLocation(){const M=this.inputs.attached.mousewheel;return!!M&&M.zoomToMouseLocation}set zoomToMouseLocation(M){const A=this.inputs.attached.mousewheel;A&&(A.zoomToMouseLocation=M)}get wheelDeltaPercentage(){const M=this.inputs.attached.mousewheel;return M?M.wheelDeltaPercentage:0}set wheelDeltaPercentage(M){const A=this.inputs.attached.mousewheel;A&&(A.wheelDeltaPercentage=M)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(M){M!==this.useBouncingBehavior&&(M?(this._bouncingBehavior=new d,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(M){M!==this.useFramingBehavior&&(M?(this._framingBehavior=new w,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(M){M!==this.useAutoRotationBehavior&&(M?(this._autoRotationBehavior=new J,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(M,A,O,S,z,c){var j;let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(M,X.GA.Zero(),c,B),j=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=X.GA.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=X.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new X.Matrix,this.panningAxis=new X.GA(1,1,0),this._transformedDirection=new X.GA,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new Q.c,this.checkCollisions=!1,this.collisionRadius=new X.GA(.5,.5,.5),this._previousPosition=X.GA.Zero(),this._collisionVelocity=X.GA.Zero(),this._newPosition=X.GA.Zero(),this._computationVector=X.GA.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new X.GA(NaN,NaN,NaN),this._goalTargetScreenOffset=new X.Vector2(NaN,NaN),this._onCollisionPositionChange=function(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;O?(j.setPosition(A),j.FK&&j.FK(O)):j._previousPosition.S(j._position);const S=Math.cos(j.alpha),z=Math.sin(j.alpha),Q=Math.cos(j.beta);let X=Math.sin(j.beta);0===X&&(X=1e-4);const c=j._getTargetPosition();j._computationVector.Yc(j.radius*S*X,j.radius*Q,j.radius*z*X),c.addToRef(j._computationVector,j._newPosition),j._position.S(j._newPosition);let B=j.upVector;j.allowUpsideDown&&j.beta<0&&(B=B.clone(),B=B.negate()),j._computeViewMatrix(j._position,c,B),j._viewMatrix.addAtIndex(12,j.targetScreenOffset.x),j._viewMatrix.addAtIndex(13,j.targetScreenOffset.y),j._collisionTriggered=!1},this._target=X.GA.Zero(),z&&this.setTarget(z),this.alpha=A,this.beta=O,this.radius=S,this.getViewMatrix(),this.inputs=new y(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new X.GA(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=X.Vector2.Zero()}_updateCache(M){M||super._updateCache(),this._cache._target.S(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.S(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const M=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?M.addToRef(this._targetBoundingCenter,this._target):this._target.S(M)}const M=this._getLockedTargetPosition();return M||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>T.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){var M,A,O,S,z,Q,X;let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,J=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=J?this._currentInterpolationFactor=J:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=u(j,this._goalAlpha),this._goalBeta=u(B,this._goalBeta),this._goalRadius=u(g,this._goalRadius),this._goalTarget.set(u(e.x,this._goalTarget.x),u(e.y,this._goalTarget.y),u(e.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(u(T.x,this._goalTargetScreenOffset.x),u(T.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,c.Clamp)(this._goalAlpha,null!==(M=this.lowerAlphaLimit)&&void 0!==M?M:-1/0,null!==(A=this.upperAlphaLimit)&&void 0!==A?A:1/0),this._goalBeta=(0,c.Clamp)(this._goalBeta,null!==(O=this.lowerBetaLimit)&&void 0!==O?O:-1/0,null!==(S=this.upperBetaLimit)&&void 0!==S?S:1/0),this._goalRadius=(0,c.Clamp)(this._goalRadius,null!==(z=this.lowerRadiusLimit)&&void 0!==z?z:-1/0,null!==(Q=this.upperRadiusLimit)&&void 0!==Q?Q:1/0),this._goalTarget.y=(0,c.Clamp)(this._goalTarget.y,null!==(X=this.lowerTargetYLimit)&&void 0!==X?X:-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const z=arguments;A=Y.Tools.BackCompatCameraNoPreventDefault(z),this._useCtrlForPanning=O,this._panningMouseButton=S,"boolean"===typeof z[0]&&(z.length>1&&(this._useCtrlForPanning=z[1]),z.length>2&&(this._panningMouseButton=z[2])),this.inputs.attachElement(A),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}VT(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let M=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){M=!0;const A=this.invertRotation?-1:1,O=this._calculateHandednessMultiplier();let S=this.inertialAlphaOffset*O;this.beta<0&&(S*=-1),this.alpha+=S*A,this.beta+=this.inertialBetaOffset*A,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<T.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<T.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*T.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){M=!0;const A=new X.GA(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),A.multiplyInPlace(this.panningAxis),X.GA.TransformNormalToRef(A,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const M=this.upVector,A=X.GA.CrossToRef(this._transformedDirection,M,this._transformedDirection);X.GA.CrossToRef(M,A,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);X.GA.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.S(this._transformedDirection)}else{if(this.parent){const M=X.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(M),M.transposeToRef(M),X.GA.TransformCoordinatesToRef(this._transformedDirection,M,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*T.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*T.e&&(this.inertialPanningY=0)}if(M)this.stopInterpolation();else if(this._isInterpolating){let M=!1;const A=this._scene.getEngine().getDeltaTime()/1e3,O=1-Math.pow(2,-A/this._currentInterpolationFactor),S=u(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const A=X.TmpVectors.GA[0].set(u(this._goalTarget.x,this._target.x),u(this._goalTarget.y,this._target.y),u(this._goalTarget.z,this._target.z));X.GA.LerpToRef(this.target,A,O,this._target),10*X.GA.Distance(this.target,A)/S<T.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.S(A),this.setTarget(this.target,!1,!0,!0)):M=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const A=X.Quaternion.RotationAlphaBetaGammaToRef(u(this._goalAlpha,this.alpha),u(this._goalBeta,this.beta),0,X.TmpVectors.Quaternion[0]),S=X.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,X.TmpVectors.Quaternion[1]),z=X.Quaternion.SlerpToRef(S,A,O,X.TmpVectors.Quaternion[2]);z.normalize();const Q=z.toAlphaBetaGammaToRef(X.TmpVectors.GA[0]);if(this.alpha=Q.x,this.beta=Q.y,z.isApprox(A,T.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const M=A.toAlphaBetaGammaToRef(X.TmpVectors.GA[0]);this.alpha=M.x,this.beta=M.y}else M=!0}if(isNaN(this._goalRadius)||(this.radius+=(S-this.radius)*O,Math.abs(S/this.radius-1)<T.e?(this._goalRadius=NaN,this.radius=S):M=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const A=X.TmpVectors.Vector2[0].set(u(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),u(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));X.Vector2.LerpToRef(this.targetScreenOffset,A,O,this.targetScreenOffset),X.Vector2.Distance(this.targetScreenOffset,A)<T.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.S(A)):M=!0}this._isInterpolating=M}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||X.GA.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const M=this.alpha;var A,O;this.alpha=function(M){let A=Math.PI/2;return 0===M.x&&0===M.z||(A=Math.acos(M.x/Math.sqrt(Math.pow(M.x,2)+Math.pow(M.z,2)))),M.z<0&&(A=2*Math.PI-A),A}(this._computationVector),this.beta=(A=this._computationVector.y,O=this.radius,Math.acos(A/O));const S=Math.round((M-this.alpha)/(2*Math.PI));this.alpha+=2*S*Math.PI,this._checkLimits()}setPosition(M){this._position.equals(M)||(this._position.S(M),this.rebuildAnglesAndRadius())}setTarget(M){var A;let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=null!==(A=this.overrideCloneAlphaBetaRadius)&&void 0!==A?A:z,M.Gc)O&&M.getBoundingInfo?this._targetBoundingCenter=M.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,M.Gc(),this._targetHost=M,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const A=M,O=this._getTargetPosition();if(O&&!S&&O.equals(A))return;this._targetHost=null,this._target=A,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const M=Math.cos(this.alpha),A=Math.sin(this.alpha),O=Math.cos(this.beta);let S=Math.sin(this.beta);0===S&&(S=1e-4),0===this.radius&&(this.radius=1e-4);const z=this._getTargetPosition();if(this._computationVector.Yc(this.radius*M*S,this.radius*O,this.radius*A*S),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||X.GA.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),z.addToRef(this._computationVector,this._newPosition),this.HM().collisionsEnabled&&this.checkCollisions){const M=this.HM().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,M.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.S(this._newPosition);let M=this.upVector;this.allowUpsideDown&&S<0&&(M=M.negate()),this._computeViewMatrix(this._position,z,M),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.S(z),this._viewMatrix}zoomOn(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];M=M||this.HM().meshes;const O=B.d.MinMax(M);let S=this._calculateLowerRadiusFromModelBoundingSphere(O.min,O.max);if(S=Math.max(Math.min(S,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=S*this.zoomOnFactor,this.mode===I.c.ORTHOGRAPHIC_CAMERA){const M=this.HM().getEngine().getAspectRatio(this),A=S*this.zoomOnFactor/2;this.orthoLeft=-A*M,this.orthoRight=A*M,this.orthoBottom=-A,this.orthoTop=A}this.focusOn({min:O.min,max:O.max,distance:S},A)}focusOn(M){let A,O,S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===M.min){const S=M||this.HM().meshes;A=B.d.MinMax(S),O=X.GA.Distance(A.min,A.max)}else{A=M,O=M.distance}this._target=B.d.Center(A),S||(this.maxZ=2*O)}createRigCamera(M,A){let O=0;switch(this.cameraRigMode){case I.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case I.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case I.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case I.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case I.c.RIG_MODE_VR:O=this._cameraRigParams.stereoHalfAngle*(0===A?1:-1);break;case I.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:O=this._cameraRigParams.stereoHalfAngle*(0===A?-1:1)}const S=new i(M,this.alpha+O,this.beta,this.radius,this._target,this.HM());return S._cameraRigParams={},S.isRigCamera=!0,S.rigParent=this,S.upVector=this.upVector,S.mode=this.mode,S.orthoLeft=this.orthoLeft,S.orthoRight=this.orthoRight,S.orthoBottom=this.orthoBottom,S.orthoTop=this.orthoTop,S}_updateRigCameras(){const M=this._rigCameras[0],A=this._rigCameras[1];switch(M.beta=A.beta=this.beta,this.cameraRigMode){case I.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case I.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case I.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case I.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case I.c.RIG_MODE_VR:M.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case I.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,A.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const S=X.GA.Distance(M,A),z=this.HM().getEngine().getAspectRatio(this),Q=Math.tan(this.fov/2),c=Q*z,j=.5*S*O,B=j*Math.sqrt(1+1/(c*c)),g=j*Math.sqrt(1+1/(Q*Q));return Math.max(B,g)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,S.d)([(0,z.H)()],i.prototype,"alpha",void 0),(0,S.d)([(0,z.H)()],i.prototype,"beta",void 0),(0,S.d)([(0,z.H)()],i.prototype,"radius",void 0),(0,S.d)([(0,z.H)()],i.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,S.d)([(0,z.D)("target")],i.prototype,"_target",void 0),(0,S.d)([(0,z.s)("targetHost")],i.prototype,"_targetHost",void 0),(0,S.d)([(0,z.H)()],i.prototype,"inertialAlphaOffset",void 0),(0,S.d)([(0,z.H)()],i.prototype,"inertialBetaOffset",void 0),(0,S.d)([(0,z.H)()],i.prototype,"inertialRadiusOffset",void 0),(0,S.d)([(0,z.H)()],i.prototype,"lowerAlphaLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"upperAlphaLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"lowerBetaLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"upperBetaLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"lowerRadiusLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"upperRadiusLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"lowerTargetYLimit",void 0),(0,S.d)([(0,z.H)()],i.prototype,"inertialPanningX",void 0),(0,S.d)([(0,z.H)()],i.prototype,"inertialPanningY",void 0),(0,S.d)([(0,z.H)()],i.prototype,"pinchToPanMaxDistance",void 0),(0,S.d)([(0,z.H)()],i.prototype,"panningDistanceLimit",void 0),(0,S.d)([(0,z.D)()],i.prototype,"panningOriginTarget",void 0),(0,S.d)([(0,z.H)()],i.prototype,"panningInertia",void 0),(0,S.d)([(0,z.H)()],i.prototype,"zoomToMouseLocation",null),(0,S.d)([(0,z.H)()],i.prototype,"zoomOnFactor",void 0),(0,S.d)([(0,z.C)()],i.prototype,"targetScreenOffset",void 0),(0,S.d)([(0,z.H)()],i.prototype,"allowUpsideDown",void 0),(0,S.d)([(0,z.H)()],i.prototype,"useInputToRestoreState",void 0),(0,S.d)([(0,z.H)()],i.prototype,"restoreStateInterpolationFactor",void 0),(0,h.g)("BABYLON.ArcRotateCamera",i)},14160:(M,A,O)=>{"use strict";O.d(A,{b:()=>X,c:()=>c});var S=O(12783),z=O(12998),Q=O(13428),X={};class c{constructor(M){this.attachedToElement=!1,this.attached={},this.camera=M,this.checkInputs=()=>{}}add(M){const A=M.getSimpleName();this.attached[A]?S.c.Warn("camera input of type "+A+" already exists on camera"):(this.attached[A]=M,M.camera=this.camera,M.checkInputs&&(this.checkInputs=this._addCheckInputs(M.checkInputs.bind(M))),this.attachedToElement&&M.attachControl(this.noPreventDefault))}remove(M){for(const A in this.attached){const O=this.attached[A];if(O===M)return O.VT(),O.camera=null,delete this.attached[A],void this.rebuildInputCheck()}}removeByType(M){for(const A in this.attached){const O=this.attached[A];O.getClassName()===M&&(O.VT(),O.camera=null,delete this.attached[A],this.rebuildInputCheck())}}_addCheckInputs(M){const A=this.checkInputs;return()=>{A(),M()}}attachInput(M){this.attachedToElement&&M.attachControl(this.noPreventDefault)}attachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){M=!Q.c.ForceAttachControlToAlwaysPreventDefault&&M,this.attachedToElement=!0,this.noPreventDefault=M;for(const A in this.attached)this.attached[A].attachControl(M)}}detachElement(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const A in this.attached)this.attached[A].VT(),M&&(this.attached[A].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const M in this.attached){const A=this.attached[M];A.checkInputs&&(this.checkInputs=this._addCheckInputs(A.checkInputs.bind(A)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(M){const A={};for(const O in this.attached){const M=this.attached[O],S=z.e.Serialize(M);A[M.getClassName()]=S}M.inputsmgr=A}parse(M){const A=M.inputsmgr;if(A){this.clear();for(const M in A){const O=X[M];if(O){const S=A[M],Q=z.e.Parse((()=>new O),S,null);this.add(Q)}}}else for(const O in this.attached){const A=X[this.attached[O].getClassName()];if(A){const S=z.e.Parse((()=>new A),M,null);this.remove(this.attached[O]),this.add(S)}}}}},14157:(M,A,O)=>{"use strict";O.d(A,{e:()=>E});var S=O(12958),z=O(12964),Q=O(12970),X=O(13460),c=O(14160),j=O(13247),B=O(12768);class g{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(M){M=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.HM(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((A=>{const O=A.event;if(!O.metaKey)if(A.type===j.e.KEYDOWN){if(-1!==this.keysUp.indexOf(O.keyCode)||-1!==this.keysDown.indexOf(O.keyCode)||-1!==this.keysLeft.indexOf(O.keyCode)||-1!==this.keysRight.indexOf(O.keyCode)||-1!==this.keysUpward.indexOf(O.keyCode)||-1!==this.keysDownward.indexOf(O.keyCode)||-1!==this.keysRotateLeft.indexOf(O.keyCode)||-1!==this.keysRotateRight.indexOf(O.keyCode)||-1!==this.keysRotateUp.indexOf(O.keyCode)||-1!==this.keysRotateDown.indexOf(O.keyCode)){-1===this._keys.indexOf(O.keyCode)&&this._keys.push(O.keyCode),M||O.preventDefault()}}else if(-1!==this.keysUp.indexOf(O.keyCode)||-1!==this.keysDown.indexOf(O.keyCode)||-1!==this.keysLeft.indexOf(O.keyCode)||-1!==this.keysRight.indexOf(O.keyCode)||-1!==this.keysUpward.indexOf(O.keyCode)||-1!==this.keysDownward.indexOf(O.keyCode)||-1!==this.keysRotateLeft.indexOf(O.keyCode)||-1!==this.keysRotateRight.indexOf(O.keyCode)||-1!==this.keysRotateUp.indexOf(O.keyCode)||-1!==this.keysRotateDown.indexOf(O.keyCode)){const A=this._keys.indexOf(O.keyCode);A>=0&&this._keys.splice(A,1),M||O.preventDefault()}})))}VT(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const M=this.camera;for(let A=0;A<this._keys.length;A++){const O=this._keys[A],S=M._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(O)?M._localDirection.Yc(-S,0,0):-1!==this.keysUp.indexOf(O)?M._localDirection.Yc(0,0,S):-1!==this.keysRight.indexOf(O)?M._localDirection.Yc(S,0,0):-1!==this.keysDown.indexOf(O)?M._localDirection.Yc(0,0,-S):-1!==this.keysUpward.indexOf(O)?M._localDirection.Yc(0,S,0):-1!==this.keysDownward.indexOf(O)?M._localDirection.Yc(0,-S,0):-1!==this.keysRotateLeft.indexOf(O)?(M._localDirection.Yc(0,0,0),M.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(O)?(M._localDirection.Yc(0,0,0),M.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(O)?(M._localDirection.Yc(0,0,0),M.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(O)&&(M._localDirection.Yc(0,0,0),M.cameraRotation.x+=this._getLocalRotation()),M.HM().useRightHandedSystem&&(M._localDirection.z*=-1),M.getViewMatrix().invertToRef(M._cameraTransformMatrix),Q.GA.TransformNormalToRef(M._localDirection,M._cameraTransformMatrix,M._transformedDirection),M.cameraDirection.addInPlace(M._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const M=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*M}}(0,S.d)([(0,z.H)()],g.prototype,"keysUp",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysUpward",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysDown",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysDownward",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysLeft",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysRight",void 0),(0,S.d)([(0,z.H)()],g.prototype,"rotationSpeed",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysRotateLeft",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysRotateRight",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysRotateUp",void 0),(0,S.d)([(0,z.H)()],g.prototype,"keysRotateDown",void 0),c.b.FreeCameraKeyboardMoveInput=g;var e=O(12776),T=O(13244);class J{constructor(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=M,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new e.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(M){M=B.Tools.BackCompatCameraNoPreventDefault(arguments);const A=this.camera.getEngine(),O=A.getInputElement();this._pointerInput||(this._pointerInput=S=>{const z=S.event,Q="touch"===z.pointerType;if(!this.touchEnabled&&Q)return;if(S.type!==T.b.POINTERMOVE&&-1===this.buttons.indexOf(z.button))return;const X=z.target;if(S.type===T.b.POINTERDOWN){if(Q&&-1!==this._activePointerId||!Q&&-1!==this._currentActiveButton)return;this._activePointerId=z.pointerId;try{null===X||void 0===X||X.setPointerCapture(z.pointerId)}catch(c){}-1===this._currentActiveButton&&(this._currentActiveButton=z.button),this._previousPosition={x:z.clientX,y:z.clientY},M||(z.preventDefault(),O&&O.focus()),A.isPointerLock&&this._onMouseMove&&this._onMouseMove(S.event)}else if(S.type===T.b.POINTERUP){if(Q&&this._activePointerId!==z.pointerId||!Q&&this._currentActiveButton!==z.button)return;try{null===X||void 0===X||X.releasePointerCapture(z.pointerId)}catch(c){}this._currentActiveButton=-1,this._previousPosition=null,M||z.preventDefault(),this._activePointerId=-1}else if(S.type===T.b.POINTERMOVE&&(this._activePointerId===z.pointerId||!Q))if(A.isPointerLock&&this._onMouseMove)this._onMouseMove(S.event);else if(this._previousPosition){const A=this.camera._calculateHandednessMultiplier(),O=(z.clientX-this._previousPosition.x)*A,S=z.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=O/this.angularSensibility,this.camera.cameraRotation.x+=S/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:O,offsetY:S}),this._previousPosition={x:z.clientX,y:z.clientY},M||z.preventDefault()}}),this._onMouseMove=O=>{if(!A.isPointerLock)return;const S=this.camera._calculateHandednessMultiplier(),z=O.movementX*S;this.camera.cameraRotation.y+=z/this.angularSensibility;const Q=O.movementY;this.camera.cameraRotation.x+=Q/this.angularSensibility,this._previousPosition=null,M||O.preventDefault()},this._observer=this.camera.HM()._inputManager._addCameraPointerObserver(this._pointerInput,T.b.POINTERDOWN|T.b.POINTERUP|T.b.POINTERMOVE),O&&(this._contextMenuBind=M=>this.onContextMenu(M),O.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(M){M.preventDefault()}VT(){if(this._observer){if(this.camera.HM()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,S.d)([(0,z.H)()],J.prototype,"buttons",void 0),(0,S.d)([(0,z.H)()],J.prototype,"angularSensibility",void 0),c.b.FreeCameraMouseInput=J;var K,G=O(13250);class d{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new e.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(M){M=B.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=A=>{if(A.type!==T.b.POINTERWHEEL)return;const O=A.event,S=O.deltaMode===G.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*S*O.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*S*O.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*S*O.deltaZ/this._normalize,O.preventDefault&&(M||O.preventDefault())},this._observer=this.camera.HM()._inputManager._addCameraPointerObserver(this._wheel,T.b.POINTERWHEEL)}VT(){this._observer&&(this.camera.HM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,S.d)([(0,z.H)()],d.prototype,"wheelPrecisionX",void 0),(0,S.d)([(0,z.H)()],d.prototype,"wheelPrecisionY",void 0),(0,S.d)([(0,z.H)()],d.prototype,"wheelPrecisionZ",void 0),function(M){M[M.MoveRelative=0]="MoveRelative",M[M.RotateRelative=1]="RotateRelative",M[M.MoveScene=2]="MoveScene"}(K||(K={}));class w extends d{constructor(){super(...arguments),this._moveRelative=Q.GA.Zero(),this._rotateRelative=Q.GA.Zero(),this._moveScene=Q.GA.Zero(),this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(M){null===M&&this._wheelXAction!==K.MoveRelative||(this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=M)}get wheelXMoveRelative(){return this._wheelXAction!==K.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(M){null===M&&this._wheelYAction!==K.MoveRelative||(this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=M)}get wheelYMoveRelative(){return this._wheelYAction!==K.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(M){null===M&&this._wheelZAction!==K.MoveRelative||(this._wheelZAction=K.MoveRelative,this._wheelZActionCoordinate=M)}get wheelZMoveRelative(){return this._wheelZAction!==K.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(M){null===M&&this._wheelXAction!==K.RotateRelative||(this._wheelXAction=K.RotateRelative,this._wheelXActionCoordinate=M)}get wheelXRotateRelative(){return this._wheelXAction!==K.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(M){null===M&&this._wheelYAction!==K.RotateRelative||(this._wheelYAction=K.RotateRelative,this._wheelYActionCoordinate=M)}get wheelYRotateRelative(){return this._wheelYAction!==K.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(M){null===M&&this._wheelZAction!==K.RotateRelative||(this._wheelZAction=K.RotateRelative,this._wheelZActionCoordinate=M)}get wheelZRotateRelative(){return this._wheelZAction!==K.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(M){null===M&&this._wheelXAction!==K.MoveScene||(this._wheelXAction=K.MoveScene,this._wheelXActionCoordinate=M)}get wheelXMoveScene(){return this._wheelXAction!==K.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(M){null===M&&this._wheelYAction!==K.MoveScene||(this._wheelYAction=K.MoveScene,this._wheelYActionCoordinate=M)}get wheelYMoveScene(){return this._wheelYAction!==K.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(M){null===M&&this._wheelZAction!==K.MoveScene||(this._wheelZAction=K.MoveScene,this._wheelZActionCoordinate=M)}get wheelZMoveScene(){return this._wheelZAction!==K.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Hc(0),this._rotateRelative.Hc(0),this._moveScene.Hc(0),this._updateCamera(),this.camera.HM().useRightHandedSystem&&(this._moveRelative.z*=-1);const M=Q.Matrix.Zero();this.camera.getViewMatrix().invertToRef(M);const A=Q.GA.Zero();Q.GA.TransformNormalToRef(this._moveRelative,M,A),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(A),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(M,A,O){if(0===M)return;if(null===A||null===O)return;let S=null;switch(A){case K.MoveRelative:S=this._moveRelative;break;case K.RotateRelative:S=this._rotateRelative;break;case K.MoveScene:S=this._moveScene}switch(O){case 0:S.set(M,0,0);break;case 1:S.set(0,M,0);break;case 2:S.set(0,0,M)}}}(0,S.d)([(0,z.H)()],w.prototype,"wheelXMoveRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelYMoveRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelZMoveRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelXRotateRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelYRotateRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelZRotateRelative",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelXMoveScene",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelYMoveScene",null),(0,S.d)([(0,z.H)()],w.prototype,"wheelZMoveScene",null),c.b.FreeCameraMouseWheelInput=w;class I{constructor(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=M,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=B.Tools.IsSafari()}attachControl(M){M=B.Tools.BackCompatCameraNoPreventDefault(arguments);let A=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=O=>{const S=O.event,z="mouse"===S.pointerType||this._isSafari&&"undefined"===typeof S.pointerType;if(this.allowMouse||!z)if(O.type===T.b.POINTERDOWN){if(M||S.preventDefault(),this._pointerPressed.push(S.pointerId),1!==this._pointerPressed.length)return;A={x:S.clientX,y:S.clientY}}else if(O.type===T.b.POINTERUP){M||S.preventDefault();const O=this._pointerPressed.indexOf(S.pointerId);if(-1===O)return;if(this._pointerPressed.splice(O,1),0!=O)return;A=null,this._offsetX=null,this._offsetY=null}else if(O.type===T.b.POINTERMOVE){if(M||S.preventDefault(),!A)return;if(0!=this._pointerPressed.indexOf(S.pointerId))return;this._offsetX=S.clientX-A.x,this._offsetY=-(S.clientY-A.y)}}),this._observer=this.camera.HM()._inputManager._addCameraPointerObserver(this._pointerInput,T.b.POINTERDOWN|T.b.POINTERUP|T.b.POINTERMOVE),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.addEventListener("blur",this._onLostFocus)}}VT(){if(this._pointerInput){if(this._observer&&(this.camera.HM()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const M=this.camera.getEngine().getInputElement();M&&M.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const M=this.camera,A=M._calculateHandednessMultiplier();M.cameraRotation.y=A*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)M.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const A=M._computeLocalCameraSpeed(),O=new Q.GA(0,0,0!==this.touchMoveSensibility?A*this._offsetY/this.touchMoveSensibility:0);Q.Matrix.RotationYawPitchRollToRef(M.rotation.y,M.rotation.x,0,M._cameraRotationMatrix),M.cameraDirection.addInPlace(Q.GA.TransformCoordinates(O,M._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,S.d)([(0,z.H)()],I.prototype,"touchAngularSensibility",void 0),(0,S.d)([(0,z.H)()],I.prototype,"touchMoveSensibility",void 0),c.b.FreeCameraTouchInput=I;class b extends c.c{constructor(M){super(M),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new g),this}addMouse(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new J(M),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new w,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new I),this}clear(){super.clear(),this._mouseInput=null}}var s=O(12919),Y=O(12852);class E extends X.b{get angularSensibility(){const M=this.inputs.attached.mouse;return M?M.angularSensibility:0}set angularSensibility(M){const A=this.inputs.attached.mouse;A&&(A.angularSensibility=M)}get keysUp(){const M=this.inputs.attached.keyboard;return M?M.keysUp:[]}set keysUp(M){const A=this.inputs.attached.keyboard;A&&(A.keysUp=M)}get keysUpward(){const M=this.inputs.attached.keyboard;return M?M.keysUpward:[]}set keysUpward(M){const A=this.inputs.attached.keyboard;A&&(A.keysUpward=M)}get keysDown(){const M=this.inputs.attached.keyboard;return M?M.keysDown:[]}set keysDown(M){const A=this.inputs.attached.keyboard;A&&(A.keysDown=M)}get keysDownward(){const M=this.inputs.attached.keyboard;return M?M.keysDownward:[]}set keysDownward(M){const A=this.inputs.attached.keyboard;A&&(A.keysDownward=M)}get keysLeft(){const M=this.inputs.attached.keyboard;return M?M.keysLeft:[]}set keysLeft(M){const A=this.inputs.attached.keyboard;A&&(A.keysLeft=M)}get keysRight(){const M=this.inputs.attached.keyboard;return M?M.keysRight:[]}set keysRight(M){const A=this.inputs.attached.keyboard;A&&(A.keysRight=M)}get keysRotateLeft(){const M=this.inputs.attached.keyboard;return M?M.keysRotateLeft:[]}set keysRotateLeft(M){const A=this.inputs.attached.keyboard;A&&(A.keysRotateLeft=M)}get keysRotateRight(){const M=this.inputs.attached.keyboard;return M?M.keysRotateRight:[]}set keysRotateRight(M){const A=this.inputs.attached.keyboard;A&&(A.keysRotateRight=M)}get keysRotateUp(){const M=this.inputs.attached.keyboard;return M?M.keysRotateUp:[]}set keysRotateUp(M){const A=this.inputs.attached.keyboard;A&&(A.keysRotateUp=M)}get keysRotateDown(){const M=this.inputs.attached.keyboard;return M?M.keysRotateDown:[]}set keysRotateDown(M){const A=this.inputs.attached.keyboard;A&&(A.keysRotateDown=M)}constructor(M,A,O){var S;super(M,A,O,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),S=this,this.ellipsoid=new Q.GA(.5,1,.5),this.ellipsoidOffset=new Q.GA(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Q.GA.Zero(),this._diffPosition=Q.GA.Zero(),this._newPosition=Q.GA.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;S._newPosition.S(A),S._newPosition.subtractToRef(S._oldPosition,S._diffPosition),S._diffPosition.length()>Y.e.CollisionsEpsilon&&(S.position.addToRef(S._diffPosition,S._deferredPositionUpdate),S._deferOnly?S._deferredUpdated=!0:S.position.S(S._deferredPositionUpdate),S.FK&&O&&S.FK(O))},this.inputs=new b(this),this.inputs.addKeyboard().addMouse()}attachControl(M,A){A=B.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(A)}VT(){this.inputs.detachElement(),this.cameraDirection=new Q.GA(0,0,0),this.cameraRotation=new Q.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(M){this._collisionMask=isNaN(M)?-1:M}_collideWithWorld(M){let A;A=this.parent?Q.GA.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,A.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const O=this.HM().collisionCoordinator;this._collider||(this._collider=O.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let S=M;this.applyGravity&&(S=M.add(this.HM().gravity)),O.getNewPosition(this._oldPosition,S,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Q.GA.Zero(),this._transformedDirection=Q.GA.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(M){this._needMoveForGravity=M}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.HM().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Lc"}}(0,S.d)([(0,z.D)()],E.prototype,"ellipsoid",void 0),(0,S.d)([(0,z.D)()],E.prototype,"ellipsoidOffset",void 0),(0,S.d)([(0,z.H)()],E.prototype,"checkCollisions",void 0),(0,S.d)([(0,z.H)()],E.prototype,"applyGravity",void 0),(0,s.g)("BABYLON.FreeCamera",E)},14817:(M,A,O)=>{"use strict";O.d(A,{d:()=>Q});var S=O(13075),z=O(14825);class Q{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=O,this.gT=[],this._maxBlockCapacity=A||64,this._selectionContent=new S.e(1024),this._creationFunc=M}update(M,A,O){z.d._CreateBlocks(M,A,O,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Xe(M){for(let A=0;A<this.we.length;A++){this.we[A].addEntry(M)}}Qe(M){for(let A=0;A<this.we.length;A++){this.we[A].removeEntry(M)}}select(M,A){this._selectionContent.reset();for(let O=0;O<this.we.length;O++){this.we[O].select(M,this._selectionContent,A)}return A?this._selectionContent.concat(this.gT):this._selectionContent.concatWithNoDuplicate(this.gT),this._selectionContent}intersects(M,A,O){this._selectionContent.reset();for(let S=0;S<this.we.length;S++){this.we[S].intersects(M,A,this._selectionContent,O)}return O?this._selectionContent.concat(this.gT):this._selectionContent.concatWithNoDuplicate(this.gT),this._selectionContent}intersectsRay(M){this._selectionContent.reset();for(let A=0;A<this.we.length;A++){this.we[A].intersectsRay(M,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.gT),this._selectionContent}}Q.CreationFuncForMeshes=(M,A)=>{const O=M.getBoundingInfo();!M.isBlocked&&O.boundingBox.intersectsMinMax(A.GT,A.dT)&&A.entries.push(M)},Q.CreationFuncForSubMeshes=(M,A)=>{M.getBoundingInfo().boundingBox.intersectsMinMax(A.GT,A.dT)&&A.entries.push(M)}},14825:(M,A,O)=>{"use strict";O.d(A,{d:()=>Q});var S=O(12970),z=O(13303);class Q{constructor(M,A,O,S,z,Q){this.entries=[],this.wT=new Array,this._capacity=O,this._depth=S,this._maxDepth=z,this._creationFunc=Q,this._minPoint=M,this._maxPoint=A,this.wT.push(M.clone()),this.wT.push(A.clone()),this.wT.push(M.clone()),this.wT[2].x=A.x,this.wT.push(M.clone()),this.wT[3].y=A.y,this.wT.push(M.clone()),this.wT[4].z=A.z,this.wT.push(A.clone()),this.wT[5].z=M.z,this.wT.push(A.clone()),this.wT[6].x=M.x,this.wT.push(A.clone()),this.wT[7].y=M.y}get wO(){return this._capacity}get GT(){return this._minPoint}get dT(){return this._maxPoint}addEntry(M){if(this.we)for(let A=0;A<this.we.length;A++){this.we[A].addEntry(M)}else this._creationFunc(M,this),this.entries.length>this.wO&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(M){if(this.we){for(let A=0;A<this.we.length;A++){this.we[A].removeEntry(M)}return}const A=this.entries.indexOf(M);A>-1&&this.entries.splice(A,1)}addEntries(M){for(let A=0;A<M.length;A++){const O=M[A];this.addEntry(O)}}select(M,A,O){if(z.c.IsInFrustum(this.wT,M)){if(this.we){for(let S=0;S<this.we.length;S++){this.we[S].select(M,A,O)}return}O?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersects(M,A,O,S){if(z.c.IntersectsSphere(this._minPoint,this._maxPoint,M,A)){if(this.we){for(let z=0;z<this.we.length;z++){this.we[z].intersects(M,A,O,S)}return}S?O.concat(this.entries):O.concatWithNoDuplicate(this.entries)}}intersectsRay(M,A){if(M.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.we){for(let O=0;O<this.we.length;O++){this.we[O].intersectsRay(M,A)}return}A.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Q._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(M,A,O,z,X,c,j,B){j.we=new Array;const g=new S.GA((A.x-M.x)/2,(A.y-M.y)/2,(A.z-M.z)/2);for(let S=0;S<2;S++)for(let A=0;A<2;A++)for(let e=0;e<2;e++){const T=M.add(g.multiplyByFloats(S,A,e)),J=M.add(g.multiplyByFloats(S+1,A+1,e+1)),K=new Q(T,J,z,X+1,c,B);K.addEntries(O),j.we.push(K)}}}},14830:(M,A,O)=>{"use strict";O.d(A,{b:()=>g});var S=O(13214),z=O(12970),Q=O(13398),X=O(13945),c=O(13241),j=O(14817),B=O(12811);S.b.prototype.createOrUpdateSelectionOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,O=this._getComponent(c.b.NAME_OCTREE);O||(O=new g(this),this.o(O)),this.jT||(this.jT=new j.d(j.d.CreationFuncForMeshes,M,A));const S=this.getWorldExtends();return this.jT.update(S.min,S.max,this.meshes),this.jT},Object.defineProperty(S.b.prototype,"selectionOctree",{get:function(){return this.jT},enumerable:!0,configurable:!0}),Q.d.prototype.createOrUpdateSubmeshesOctree=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const O=this.HM();let S=O._getComponent(c.b.NAME_OCTREE);S||(S=new g(O),O.o(S)),this._submeshesOctree||(this._submeshesOctree=new j.d(j.d.CreationFuncForSubMeshes,M,A)),this.Gc(!0);const z=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(z.minimumWorld,z.maximumWorld,this.Bc),this._submeshesOctree};class g{constructor(M){this.name=c.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new X.b(z.GA.Zero(),new z.GA(1,1,1)),(M=M||B.d.LastCreatedScene)&&(this.wA=M,this.wA.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.wA.getActiveSubMeshCandidates=M=>this.getActiveSubMeshCandidates(M),this.wA.getCollidingSubMeshCandidates=(M,A)=>this.getCollidingSubMeshCandidates(M,A),this.wA.getIntersectingSubMeshCandidates=(M,A)=>this.getIntersectingSubMeshCandidates(M,A))}register(){this.wA.onMeshRemovedObservable.add((M=>{const A=this.wA.selectionOctree;if(void 0!==A&&null!==A){const O=A.gT.indexOf(M);-1!==O&&A.gT.splice(O,1)}})),this.wA.onMeshImportedObservable.add((M=>{const A=this.wA.selectionOctree;void 0!==A&&null!==A&&A.Xe(M)}))}getActiveMeshCandidates(){var M;return(null===(M=this.wA.jT)||void 0===M?void 0:M.select(this.wA.frustumPlanes))||this.wA._getDefaultMeshCandidates()}getActiveSubMeshCandidates(M){if(M._submeshesOctree&&M.useOctreeForRenderingSelection){return M._submeshesOctree.select(this.wA.frustumPlanes)}return this.wA._getDefaultSubMeshCandidates(M)}getIntersectingSubMeshCandidates(M,A){if(M._submeshesOctree&&M.useOctreeForPicking){X.b.TransformToRef(A,M.getWorldMatrix(),this._tempRay);return M._submeshesOctree.intersectsRay(this._tempRay)}return this.wA._getDefaultSubMeshCandidates(M)}getCollidingSubMeshCandidates(M,A){if(M._submeshesOctree&&M.useOctreeForCollisions){const O=A._velocityWorldLength+Math.max(A._radius.x,A._radius.y,A._radius.z);return M._submeshesOctree.intersects(A._basePointWorld,O)}return this.wA._getDefaultSubMeshCandidates(M)}rebuild(){}dispose(){}}},13945:(M,A,O)=>{"use strict";O.d(A,{b:()=>J});var S=O(13214),z=O(13428),Q=O(12974),X=O(12970),c=O(12977),j=O(13298),B=O(13238),g=O(12811),e=O(13255);const T={internalPickerForMesh:void 0};class J{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Q.e;this.origin=M,this.direction=A,this.length=O,this.epsilon=S}clone(){return new J(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const S=J._TmpVector3[0].Yc(M.x-O,M.y-O,M.z-O),z=J._TmpVector3[1].Yc(A.x+O,A.y+O,A.z+O);let Q,X,c,j,B=0,g=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<S.x||this.origin.x>z.x)return!1}else if(Q=1/this.direction.x,X=(S.x-this.origin.x)*Q,c=(z.x-this.origin.x)*Q,c===-1/0&&(c=1/0),X>c&&(j=X,X=c,c=j),B=Math.max(X,B),g=Math.min(c,g),B>g)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<S.y||this.origin.y>z.y)return!1}else if(Q=1/this.direction.y,X=(S.y-this.origin.y)*Q,c=(z.y-this.origin.y)*Q,c===-1/0&&(c=1/0),X>c&&(j=X,X=c,c=j),B=Math.max(X,B),g=Math.min(c,g),B>g)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<S.z||this.origin.z>z.z)return!1}else if(Q=1/this.direction.z,X=(S.z-this.origin.z)*Q,c=(z.z-this.origin.z)*Q,c===-1/0&&(c=1/0),X>c&&(j=X,X=c,c=j),B=Math.max(X,B),g=Math.min(c,g),B>g)return!1;return!0}intersectsBox(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(M.minimum,M.maximum,A)}intersectsSphere(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const O=M.center.x-this.origin.x,S=M.center.y-this.origin.y,z=M.center.z-this.origin.z,Q=O*O+S*S+z*z,X=M.radius+A,c=X*X;if(Q<=c)return!0;const j=O*this.direction.x+S*this.direction.y+z*this.direction.z;if(j<0)return!1;return Q-j*j<=c}intersectsTriangle(M,A,O){const S=J._TmpVector3[0],z=J._TmpVector3[1],Q=J._TmpVector3[2],c=J._TmpVector3[3],B=J._TmpVector3[4];A.subtractToRef(M,S),O.subtractToRef(M,z),X.GA.CrossToRef(this.direction,z,Q);const g=X.GA.Dot(S,Q);if(0===g)return null;const e=1/g;this.origin.subtractToRef(M,c);const T=X.GA.Dot(c,Q)*e;if(T<-this.epsilon||T>1+this.epsilon)return null;X.GA.CrossToRef(c,S,B);const K=X.GA.Dot(this.direction,B)*e;if(K<-this.epsilon||T+K>1+this.epsilon)return null;const G=X.GA.Dot(z,B)*e;return G>this.length?null:new j.c(1-T-K,T,G)}intersectsPlane(M){let A;const O=X.GA.Dot(M.normal,this.direction);if(Math.abs(O)<9.99999997475243e-7)return null;{const S=X.GA.Dot(M.normal,this.origin);return A=(-M.d-S)/O,A<0?A<-9.99999997475243e-7?null:0:A}}intersectsAxis(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(M){case"y":{const M=(this.origin.y-A)/this.direction.y;return M>0?null:new X.GA(this.origin.x+this.direction.x*-M,A,this.origin.z+this.direction.z*-M)}case"x":{const M=(this.origin.x-A)/this.direction.x;return M>0?null:new X.GA(A,this.origin.y+this.direction.y*-M,this.origin.z+this.direction.z*-M)}case"z":{const M=(this.origin.z-A)/this.direction.z;return M>0?null:new X.GA(this.origin.x+this.direction.x*-M,this.origin.y+this.direction.y*-M,A)}default:return null}}intersectsMesh(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const c=X.TmpVectors.Matrix[0];return M.getWorldMatrix().invertToRef(c),this._tmpRay?J.TransformToRef(this,c,this._tmpRay):this._tmpRay=J.Transform(this,c),M.intersects(this._tmpRay,A,O,S,z,Q)}intersectsMeshes(M,A,O){O?O.length=0:O=[];for(let S=0;S<M.length;S++){const z=this.intersectsMesh(M[S],A);z.hit&&O.push(z)}return O.sort(this._comparePickingInfo),O}_comparePickingInfo(M,A){return M.distance<A.distance?-1:M.distance>A.distance?1:0}intersectionSegment(M,A,O){const S=this.origin,z=X.TmpVectors.GA[0],Q=X.TmpVectors.GA[1],c=X.TmpVectors.GA[2],j=X.TmpVectors.GA[3];A.subtractToRef(M,z),this.direction.scaleToRef(J._Rayl,c),S.addToRef(c,Q),M.subtractToRef(S,j);const B=X.GA.Dot(z,z),g=X.GA.Dot(z,c),e=X.GA.Dot(c,c),T=X.GA.Dot(z,j),K=X.GA.Dot(c,j),G=B*e-g*g;let d,w,I=G,b=G;G<J._Smallnum?(d=0,I=1,w=K,b=e):(d=g*K-e*T,w=B*K-g*T,d<0?(d=0,w=K,b=e):d>I&&(d=I,w=K+g,b=e)),w<0?(w=0,-T<0?d=0:-T>B?d=I:(d=-T,I=B)):w>b&&(w=b,-T+g<0?d=0:-T+g>B?d=I:(d=-T+g,I=B));const s=Math.abs(d)<J._Smallnum?0:d/I,Y=Math.abs(w)<J._Smallnum?0:w/b,E=X.TmpVectors.GA[4];c.scaleToRef(Y,E);const H=X.TmpVectors.GA[5];z.scaleToRef(s,H),H.addInPlace(j);const C=X.TmpVectors.GA[6];H.subtractToRef(E,C);return Y>0&&Y<=this.length&&C.lengthSquared()<O*O?H.length():-1}update(M,A,O,S,z,Q,c){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){J._RayDistant||(J._RayDistant=J.Zero()),J._RayDistant.unprojectRayToRef(M,A,O,S,X.Matrix.IdentityReadOnly,Q,c);const j=X.TmpVectors.Matrix[0];z.invertToRef(j),J.TransformToRef(J._RayDistant,j,this)}else this.unprojectRayToRef(M,A,O,S,z,Q,c);return this}static Zero(){return new J(X.GA.Zero(),X.GA.Zero())}static CreateNew(M,A,O,S,z,Q,X){return J.Zero().update(M,A,O,S,z,Q,X)}static CreateNewFromTo(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.Matrix.IdentityReadOnly;const S=new J(new X.GA(0,0,0),new X.GA(0,0,0));return J.CreateFromToToRef(M,A,S,O)}static CreateFromToToRef(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.Matrix.IdentityReadOnly;O.origin.S(M);const z=A.subtractToRef(M,O.direction),Q=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);return O.length=Q,O.direction.normalize(),J.TransformToRef(O,S,O)}static Transform(M,A){const O=new J(new X.GA(0,0,0),new X.GA(0,0,0));return J.TransformToRef(M,A,O),O}static TransformToRef(M,A,O){X.GA.TransformCoordinatesToRef(M.origin,A,O.origin),X.GA.TransformNormalToRef(M.direction,A,O.direction),O.length=M.length,O.epsilon=M.epsilon;const S=O.direction,z=S.length();if(0!==z&&1!==z){const M=1/z;S.x*=M,S.y*=M,S.z*=M,O.length*=z}return O}unprojectRayToRef(M,A,O,S,z,Q,c){const j=X.TmpVectors.Matrix[0];z.multiplyToRef(Q,j),j.multiplyToRef(c,j),j.invert();const B=g.d.LastCreatedEngine,e=X.TmpVectors.GA[0];e.x=M/O*2-1,e.y=-(A/S*2-1),e.z=null!==B&&void 0!==B&&B.QQ?1:null!==B&&void 0!==B&&B.isNDCHalfZRange?0:-1;const T=X.TmpVectors.GA[1].Yc(e.x,e.y,1-1e-8),J=X.TmpVectors.GA[2],K=X.TmpVectors.GA[3];X.GA._UnprojectFromInvertedMatrixToRef(e,j,J),X.GA._UnprojectFromInvertedMatrixToRef(T,j,K),this.origin.S(J),K.subtractToRef(J,this.direction),this.direction.normalize()}}function K(M,A,O,S,z){let Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=J.Zero();return G(M,A,O,S,X,z,Q),X}function G(M,A,O,S,z,Q){let c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const B=M.getEngine();if(!Q&&!(Q=M.activeCamera))return M;const g=Q.viewport,e=B.getRenderHeight(),{x:T,y:J,width:K,height:G}=g.toGlobal(B.getRenderWidth(),e),d=1/B.getHardwareScalingLevel();return A=A*d-T,O=O*d-(e-J-G),z.update(A,O,K,G,S||X.Matrix.IdentityReadOnly,c?X.Matrix.IdentityReadOnly:Q.getViewMatrix(),Q.getProjectionMatrix(),j),M}function d(M,A,O,S,z){if(!B.e)return M;const Q=M.getEngine();if(!z&&!(z=M.activeCamera))throw new Error("Active camera not set");const c=z.viewport,j=Q.getRenderHeight(),{x:g,y:e,width:T,height:J}=c.toGlobal(Q.getRenderWidth(),j),K=X.Matrix.Identity(),G=1/Q.getHardwareScalingLevel();return A=A*G-g,O=O*G-(j-e-J),S.update(A,O,T,J,K,K,z.getProjectionMatrix()),M}function w(M,A,O,S,z,Q,X,c){const j=A(S,O.enableDistantPicking),B=O.intersects(j,z,X,Q,S,c);return B&&B.hit?!z&&null!=M&&B.distance>=M.distance?null:B:null}function I(M,A,O,S,z,Q){let c=null;const j=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),g=M.cameraToUseForPointers||M.activeCamera,e=T.internalPickerForMesh||w;for(let B=0;B<M.meshes.length;B++){const T=M.meshes[B];if(O){if(!O(T,-1))continue}else if(!T.isEnabled()||!T.isVisible||!T.EB)continue;const J=j&&T.isWorldMatrixCameraDependent(),K=T.Gc(J,g);if(T.hasThinInstances&&T.zg){const M=e(c,A,T,K,!0,!0,Q);if(M){if(z)return M;const j=X.TmpVectors.Matrix[1],B=T.thinInstanceGetWorldMatrices();for(let M=0;M<B.length;M++){if(O&&!O(T,M))continue;B[M].multiplyToRef(K,j);const X=e(c,A,T,j,S,z,Q,!0);if(X&&(c=X,c.thinInstanceIndex=M,S))return c}}}else{const M=e(c,A,T,K,S,z,Q);if(M&&(c=M,S))return c}}return c||new B.e}function b(M,A,O,S){if(!B.e)return null;const z=[],Q=!!(M.activeCameras&&M.activeCameras.length>1&&M.cameraToUseForPointers!==M.activeCamera),c=M.cameraToUseForPointers||M.activeCamera,j=T.internalPickerForMesh||w;for(let B=0;B<M.meshes.length;B++){const g=M.meshes[B];if(O){if(!O(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.EB)continue;const e=Q&&g.isWorldMatrixCameraDependent(),T=g.Gc(e,c);if(g.hasThinInstances&&g.zg){if(j(null,A,g,T,!0,!0,S)){const M=X.TmpVectors.Matrix[1],Q=g.thinInstanceGetWorldMatrices();for(let X=0;X<Q.length;X++){if(O&&!O(g,X))continue;Q[X].multiplyToRef(T,M);const c=j(null,A,g,M,!1,!1,S,!0);c&&(c.thinInstanceIndex=X,z.push(c))}}}else{const M=j(null,A,g,T,!1,!1,S);M&&z.push(M)}}return z}function s(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,S=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;S||(S=M.getWorldMatrix()),A.length=O,z?A.origin.S(z):A.origin.S(M.position);const Q=X.TmpVectors.GA[2];Q.set(0,0,M._scene.useRightHandedSystem?-1:1);const c=X.TmpVectors.GA[3];return X.GA.TransformNormalToRef(Q,S,c),X.GA.NormalizeToRef(c,A.direction),A}var Y,E;J._TmpVector3=(0,c.b)(6,X.GA.Zero),J._RayDistant=J.Zero(),J._Smallnum=1e-8,J._Rayl=1e9,Y=S.b,(E=z.c)&&(E.prototype.getForwardRay=function(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,A=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;return s(this,new J(X.GA.Zero(),X.GA.Zero(),M),M,A,O)},E.prototype.getForwardRayToRef=function(M){return s(this,M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Y&&(e.b._IsPickingAvailable=!0,Y.prototype.createPickingRay=function(M,A,O,S){return K(this,M,A,O,S,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),S.b.prototype.createPickingRayToRef=function(M,A,O,S,z){return G(this,M,A,O,S,z,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},S.b.prototype.createPickingRayInCameraSpace=function(M,A,O){return function(M,A,O,S){const z=J.Zero();return d(M,A,O,z,S),z}(this,M,A,O)},S.b.prototype.createPickingRayInCameraSpaceToRef=function(M,A,O,S){return d(this,M,A,O,S)},S.b.prototype.pickWithBoundingInfo=function(M,A,O,S,z){return function(M,A,O,S,z,Q){if(!B.e)return null;const c=I(M,(S=>(M._tempPickingRay||(M._tempPickingRay=J.Zero()),G(M,A,O,S,M._tempPickingRay,Q||null),M._tempPickingRay)),S,z,!0);return c&&(c.ray=K(M,A,O,X.Matrix.Identity(),Q||null)),c}(this,M,A,O,S,z)},S.b.prototype.KO=function(M,A,O,S,z,Q){return function(M,A,O,S,z,Q,c){const j=I(M,((S,z)=>(M._tempPickingRay||(M._tempPickingRay=J.Zero()),G(M,A,O,S,M._tempPickingRay,Q||null,!1,z),M._tempPickingRay)),S,z,!1,c);return j&&(j.ray=K(M,A,O,X.Matrix.Identity(),Q||null)),j}(this,M,A,O,S,z,Q)},S.b.prototype.pickWithRay=function(M,A,O,S){return function(M,A,O,S,z){const Q=I(M,(O=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=X.Matrix.Identity()),O.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=J.Zero()),J.TransformToRef(A,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),O,S,!1,z);return Q&&(Q.ray=A),Q}(this,M,A,O,S)},S.b.prototype.multiPick=function(M,A,O,S,z){return function(M,A,O,S,z,Q){return b(M,(S=>K(M,A,O,S,z||null)),S,Q)}(this,M,A,O,S,z)},S.b.prototype.multiPickWithRay=function(M,A,O){return function(M,A,O,S){return b(M,(O=>(M._pickWithRayInverseMatrix||(M._pickWithRayInverseMatrix=X.Matrix.Identity()),O.invertToRef(M._pickWithRayInverseMatrix),M._cachedRayForTransform||(M._cachedRayForTransform=J.Zero()),J.TransformToRef(A,M._pickWithRayInverseMatrix,M._cachedRayForTransform),M._cachedRayForTransform)),O,S)}(this,M,A,O)}},14203:(M,A,O)=>{"use strict";var S=O(12888),z=O(12783),Q=O(12813),X=O(12927),c=O(12852),j=O(12905);c.e.prototype._partialLoadFile=function(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(M,(M=>{O[A]=M,O._internalCount++,6===O._internalCount&&S(O)}),void 0,void 0,!0,((M,A)=>{z&&M&&z(M.status+" "+M.statusText,A)}))},c.e.prototype._cascadeLoadFiles=function(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=[];z._internalCount=0;for(let Q=0;Q<6;Q++)this._partialLoadFile(O[Q],Q,z,A,S)},c.e.prototype._cascadeLoadImgs=function(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5?arguments[5]:void 0;const X=[];X._internalCount=0;for(let c=0;c<6;c++)this._partialLoadImg(S[c],c,X,M,A,O,z,Q)},c.e.prototype._partialLoadImg=function(M,A,O,S,z,c){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0;const g=(0,X.b)();(0,Q.s)(M,(M=>{O[A]=M,O._internalCount++,S&&S.removePendingData(g),6===O._internalCount&&c&&c(z,O)}),((M,A)=>{S&&S.removePendingData(g),j&&j(M,A)}),S?S.offlineProvider:null,B),S&&S.addPendingData(g)},c.e.prototype.createCubeTextureBase=function(M,A,O,Q){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,G=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,d=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,w=arguments.length>14&&void 0!==arguments[14]&&arguments[14],I=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const b=K||new S.b(this,7);b.isCube=!0,b.url=M,b.generateMipMaps=!Q,b._lodGenerationScale=T,b._lodGenerationOffset=J,b._useSRGBBuffer=!!w&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!Q),b!==K&&(b.label=M.substring(0,60)),this._doNotHandleContextLost||(b._extension=g,b._files=O,b._buffer=I);const s=M;this._transformTextureUrl&&!K&&(M=this._transformTextureUrl(M));const Y=null!==g&&void 0!==g?g:function(M){const A=M.split("?")[0],O=A.lastIndexOf(".");return O>-1?A.substring(O).toLowerCase():""}(M),E=(0,j.e)(Y),H=(M,A)=>{b.dispose(),c?c(M,A):M&&z.c.Warn(M)},C=(S,c)=>{M===s?S&&H(S.status+" "+S.statusText,c):(z.c.Warn("Failed to load ".concat(M,", falling back to the ").concat(s)),this.createCubeTextureBase(s,A,O,!!Q,X,H,B,g,e,T,J,b,G,d,w,I))};if(E)E.then((S=>{const z=M=>{G&&G(b,M),S.loadCubeData(M,b,e,X,((M,A)=>{H(M,A)}))};I?z(I):O&&6===O.length?S.supportCascades?this._cascadeLoadFiles(A,(M=>z(M.map((M=>new Uint8Array(M))))),O,H):H("Textures type does not support cascades."):this._loadFile(M,(M=>z(new Uint8Array(M))),void 0,void 0,!0,C)}));else{if(!O||0===O.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(A,b,((M,A)=>{d&&d(M,A)}),O,H)}return this._internalTexturesCache.push(b),b}},14833:(M,A,O)=>{"use strict";O(22),O(12783);var S=O(13110);O(12888),O(13051),O(12883),O(13163),O(13125);S.b},14236:(M,A,O)=>{"use strict";O.d(A,{b:()=>z});var S=O(12919);class z{constructor(M){this.value=this._toInt(M)}_toInt(M){return 0|M}add(M){return new z(this.value+M.value)}dA(M){return new z(this.value-M.value)}multiply(M){return new z(Math.imul(this.value,M.value))}divide(M){return new z(this.value/M.value)}getClassName(){return z.ClassName}equals(M){return this.value===M.value}static FromValue(M){return new z(M)}toString(){return this.value.toString()}}z.ClassName="FlowGraphInteger",(0,S.g)("FlowGraphInteger",z)},14241:(M,A,O)=>{"use strict";O.d(A,{d:()=>z,h:()=>Q});var S=O(12970);class z{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.zc=M}get m(){return this.zc}transformVector(M){return this.transformVectorToRef(M,new S.Vector2)}transformVectorToRef(M,A){return A.x=M.x*this.zc[0]+M.y*this.zc[1],A.y=M.x*this.zc[2]+M.y*this.zc[3],A}gc(){return this.toArray()}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<4;A++)M[A]=this.zc[A];return M}GO(M){for(let A=0;A<4;A++)this.zc[A]=M[A];return this}multiplyToRef(M,A){const O=M.zc,S=this.zc,z=A.zc;return z[0]=O[0]*S[0]+O[1]*S[2],z[1]=O[0]*S[1]+O[1]*S[3],z[2]=O[2]*S[0]+O[3]*S[2],z[3]=O[2]*S[1]+O[3]*S[3],A}multiply(M){return this.multiplyToRef(M,new z)}divideToRef(M,A){const O=this.zc,S=M.zc,z=A.zc;return z[0]=O[0]/S[0],z[1]=O[1]/S[1],z[2]=O[2]/S[2],z[3]=O[3]/S[3],A}divide(M){return this.divideToRef(M,new z)}addToRef(M,A){const O=this.zc,S=M.m,z=A.m;return z[0]=O[0]+S[0],z[1]=O[1]+S[1],z[2]=O[2]+S[2],z[3]=O[3]+S[3],A}add(M){return this.addToRef(M,new z)}subtractToRef(M,A){const O=this.zc,S=M.m,z=A.m;return z[0]=O[0]-S[0],z[1]=O[1]-S[1],z[2]=O[2]-S[2],z[3]=O[3]-S[3],A}dA(M){return this.subtractToRef(M,new z)}transpose(){const M=this.zc;return new z([M[0],M[2],M[1],M[3]])}determinant(){const M=this.zc;return M[0]*M[3]-M[1]*M[2]}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const A=this.zc,O=1/M;return new z([A[3]*O,-A[1]*O,-A[2]*O,A[0]*O])}equals(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const O=this.zc,S=M.m;return 0===A?O[0]===S[0]&&O[1]===S[1]&&O[2]===S[2]&&O[3]===S[3]:Math.abs(O[0]-S[0])<A&&Math.abs(O[1]-S[1])<A&&Math.abs(O[2]-S[2])<A&&Math.abs(O[3]-S[3])<A}getClassName(){return"FlowGraphMatrix2D"}toString(){return"FlowGraphMatrix2D(".concat(this.zc.join(", "),")")}}class Q{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.zc=M}get m(){return this.zc}transformVector(M){return this.transformVectorToRef(M,new S.GA)}transformVectorToRef(M,A){const O=this.zc;return A.x=M.x*O[0]+M.y*O[1]+M.z*O[2],A.y=M.x*O[3]+M.y*O[4]+M.z*O[5],A.z=M.x*O[6]+M.y*O[7]+M.z*O[8],A}multiplyToRef(M,A){const O=M.zc,S=this.zc,z=A.m;return z[0]=O[0]*S[0]+O[1]*S[3]+O[2]*S[6],z[1]=O[0]*S[1]+O[1]*S[4]+O[2]*S[7],z[2]=O[0]*S[2]+O[1]*S[5]+O[2]*S[8],z[3]=O[3]*S[0]+O[4]*S[3]+O[5]*S[6],z[4]=O[3]*S[1]+O[4]*S[4]+O[5]*S[7],z[5]=O[3]*S[2]+O[4]*S[5]+O[5]*S[8],z[6]=O[6]*S[0]+O[7]*S[3]+O[8]*S[6],z[7]=O[6]*S[1]+O[7]*S[4]+O[8]*S[7],z[8]=O[6]*S[2]+O[7]*S[5]+O[8]*S[8],A}multiply(M){return this.multiplyToRef(M,new Q)}divideToRef(M,A){const O=this.zc,S=M.m,z=A.m;return z[0]=O[0]/S[0],z[1]=O[1]/S[1],z[2]=O[2]/S[2],z[3]=O[3]/S[3],z[4]=O[4]/S[4],z[5]=O[5]/S[5],z[6]=O[6]/S[6],z[7]=O[7]/S[7],z[8]=O[8]/S[8],A}divide(M){return this.divideToRef(M,new Q)}addToRef(M,A){const O=this.zc,S=M.m,z=A.m;return z[0]=O[0]+S[0],z[1]=O[1]+S[1],z[2]=O[2]+S[2],z[3]=O[3]+S[3],z[4]=O[4]+S[4],z[5]=O[5]+S[5],z[6]=O[6]+S[6],z[7]=O[7]+S[7],z[8]=O[8]+S[8],A}add(M){return this.addToRef(M,new Q)}subtractToRef(M,A){const O=this.zc,S=M.m,z=A.m;return z[0]=O[0]-S[0],z[1]=O[1]-S[1],z[2]=O[2]-S[2],z[3]=O[3]-S[3],z[4]=O[4]-S[4],z[5]=O[5]-S[5],z[6]=O[6]-S[6],z[7]=O[7]-S[7],z[8]=O[8]-S[8],A}dA(M){return this.subtractToRef(M,new Q)}toArray(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let A=0;A<9;A++)M[A]=this.zc[A];return M}gc(){return this.toArray()}GO(M){for(let A=0;A<9;A++)this.zc[A]=M[A];return this}transpose(){const M=this.zc;return new Q([M[0],M[3],M[6],M[1],M[4],M[7],M[2],M[5],M[8]])}determinant(){const M=this.zc;return M[0]*(M[4]*M[8]-M[5]*M[7])-M[1]*(M[3]*M[8]-M[5]*M[6])+M[2]*(M[3]*M[7]-M[4]*M[6])}inverse(){const M=this.determinant();if(0===M)throw new Error("Matrix is not invertible");const A=this.zc,O=1/M;return new Q([(A[4]*A[8]-A[5]*A[7])*O,(A[2]*A[7]-A[1]*A[8])*O,(A[1]*A[5]-A[2]*A[4])*O,(A[5]*A[6]-A[3]*A[8])*O,(A[0]*A[8]-A[2]*A[6])*O,(A[2]*A[3]-A[0]*A[5])*O,(A[3]*A[7]-A[4]*A[6])*O,(A[1]*A[6]-A[0]*A[7])*O,(A[0]*A[4]-A[1]*A[3])*O])}equals(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const O=this.zc,S=M.m;return 0===A?O[0]===S[0]&&O[1]===S[1]&&O[2]===S[2]&&O[3]===S[3]&&O[4]===S[4]&&O[5]===S[5]&&O[6]===S[6]&&O[7]===S[7]&&O[8]===S[8]:Math.abs(O[0]-S[0])<A&&Math.abs(O[1]-S[1])<A&&Math.abs(O[2]-S[2])<A&&Math.abs(O[3]-S[3])<A&&Math.abs(O[4]-S[4])<A&&Math.abs(O[5]-S[5])<A&&Math.abs(O[6]-S[6])<A&&Math.abs(O[7]-S[7])<A&&Math.abs(O[8]-S[8])<A}getClassName(){return"FlowGraphMatrix3D"}toString(){return"FlowGraphMatrix3D(".concat(this.zc.join(", "),")")}}},14245:(M,A,O)=>{"use strict";var S;function z(M,A,O,S){var z,Q,X,c,j,B,g,e,T,J,K,G;switch(A){case"Animation":return S?null!==(z=M.animations.find((M=>M.uniqueId===O)))&&void 0!==z?z:null:null!==(Q=M.animations[O])&&void 0!==Q?Q:null;case"AnimationGroup":return S?null!==(X=M.animationGroups.find((M=>M.uniqueId===O)))&&void 0!==X?X:null:null!==(c=M.animationGroups[O])&&void 0!==c?c:null;case"Mesh":return S?null!==(j=M.meshes.find((M=>M.uniqueId===O)))&&void 0!==j?j:null:null!==(B=M.meshes[O])&&void 0!==B?B:null;case"Material":return S?null!==(g=M.materials.find((M=>M.uniqueId===O)))&&void 0!==g?g:null:null!==(e=M.materials[O])&&void 0!==e?e:null;case"be":return S?null!==(T=M.cameras.find((M=>M.uniqueId===O)))&&void 0!==T?T:null:null!==(J=M.cameras[O])&&void 0!==J?J:null;case"Light":return S?null!==(K=M.lights.find((M=>M.uniqueId===O)))&&void 0!==K?K:null:null!==(G=M.lights[O])&&void 0!==G?G:null;default:return null}}O.d(A,{e:()=>z}),function(M){M.Animation="Animation",M.AnimationGroup="AnimationGroup",M.Mesh="Mesh",M.Material="Material",M.be="be",M.Light="Light"}(S||(S={}))},14284:(M,A,O)=>{"use strict";O.d(A,{d:()=>z});var S=O(14288);class z extends S.e{constructor(M,A){if(super(M),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),A)for(const O of A)this._eventsSignalOutputs[O]=this._registerSignalOutput(O+"Event")}_executeOnTick(M){}_startPendingTasks(M){M._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(M),this._resetAfterCanceled(M)),this._preparePendingTasks(M),M._addPendingBlock(this),this.out._activateSignal(M),M._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(M){M._deleteExecutionVariable(this,"_initialized"),M._removePendingBlock(this)}}},14255:(M,A,O)=>{"use strict";O.d(A,{c:()=>B});var S=O(12927),z=O(12919),Q=O(14264),X=O(12776),c=O(14228);class j extends Q.b{constructor(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.defaultValue,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(M,A,O),this.richType=S,this._defaultValue=z,this._optional=Q,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new X.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(M){this._isDisabled!==M&&(this._isDisabled=M,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(M,A){A._getConnectionValue(this)!==M&&(A._setConnectionValue(this,M),this.onValueChangedObservable.notifyObservers(M))}resetToDefaultValue(M){M._setConnectionValue(this,this._defaultValue)}connectTo(M){this._isDisabled||super.connectTo(M)}_getValueOrDefault(M){var A;const O=null!==(A=M._getConnectionValue(this))&&void 0!==A?A:this._defaultValue;return this.dataTransformer?this.dataTransformer(O):O}getValue(M){if(1===this.connectionType){M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(M);const A=this._getValueOrDefault(M);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}const A=this.isConnected()?this._connectedPoint[0].getValue(M):this._getValueOrDefault(M);return this._lastValue=A,this.richType.typeTransformer?this.richType.typeTransformer(A):A}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.richType={},this.richType.serialize(M.richType),M.optional=this._optional,(0,c.e)("defaultValue",this._defaultValue,M)}}(0,z.g)("FlowGraphDataConnection",j);class B{constructor(M){var A,O;this.config=M,this.uniqueId=(0,S.b)(),this.name=null!==(A=null===(O=this.config)||void 0===O?void 0:O.name)&&void 0!==A?A:this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(M){}registerDataInput(M,A,O){const S=new j(M,0,this,A,O);return this.dataInputs.push(S),S}registerDataOutput(M,A,O){const S=new j(M,1,this,A,O);return this.dataOutputs.push(S),S}getDataInput(M){return this.dataInputs.find((A=>A.name===M))}getDataOutput(M){return this.dataOutputs.find((A=>A.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.e;if(M.uniqueId=this.uniqueId,M.config={},this.config){const O=this.config,S=Object.keys(O);for(const z of S)A(z,O[z],M.config)}M.dataInputs=[],M.dataOutputs=[],M.className=this.getClassName();for(const O of this.dataInputs){const A={};O.serialize(A),M.dataInputs.push(A)}for(const O of this.dataOutputs){const A={};O.serialize(A),M.dataOutputs.push(A)}}deserialize(M){}_log(M,A,O){var S;null===(S=M.logger)||void 0===S||S.addLogItem({action:A,dO:O,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14264:(M,A,O)=>{"use strict";O.d(A,{b:()=>Q});var S,z=O(12927);!function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(S||(S={}));class Q{constructor(M,A,O){this._ownerBlock=O,this._connectedPoint=[],this.uniqueId=(0,z.b)(),this.connectedPointIds=[],this.name=M,this._connectionType=A}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(M){if(this._connectionType===M._connectionType)throw new Error("Cannot connect two points of type ".concat(this.connectionType));if(this._isSingularConnection()&&this._connectedPoint.length>0||M._isSingularConnection()&&M._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(M),M._connectedPoint.push(this)}disconnectFrom(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const O=this._connectedPoint.indexOf(M),S=M._connectedPoint.indexOf(this);-1!==O&&-1!==S&&(A&&this._connectedPoint.splice(O,1),M._connectedPoint.splice(S,1))}disconnectFromAll(){for(const M of this._connectedPoint)this.disconnectFrom(M,!1);this._connectedPoint.length=0}dispose(){for(const M of this._connectedPoint)this.disconnectFrom(M)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M.uniqueId=this.uniqueId,M.name=this.name,M._connectionType=this._connectionType,M.connectedPointIds=[],M.className=this.getClassName();for(const A of this._connectedPoint)M.connectedPointIds.push(A.uniqueId)}getClassName(){return"FGConnection"}deserialize(M){this.uniqueId=M.uniqueId,this.name=M.name,this._connectionType=M._connectionType,this.connectedPointIds=M.connectedPointIds}}},14223:(M,A,O)=>{"use strict";O.d(A,{e:()=>b});var S,z=O(12776),Q=O(12958),X=O(12964),c=O(12927),j=O(14228),B=O(14245),g=O(12783);!function(M){M.ExecuteBlock="ExecuteBlock",M.ExecuteEvent="ExecuteEvent",M.TriggerConnection="TriggerConnection",M.ContextVariableSet="ContextVariableSet",M.GlobalVariableSet="GlobalVariableSet",M.GlobalVariableDelete="GlobalVariableDelete",M.GlobalVariableGet="GlobalVariableGet",M.AddConnection="AddConnection",M.GetConnectionValue="GetConnectionValue",M.SetConnectionValue="SetConnectionValue",M.ActivateSignal="ActivateSignal",M.ContextVariableGet="ContextVariableGet"}(S||(S={}));class e{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(M){if(M.time||(M.time=Date.now()),this.log.push(M),this.logToConsole){var A;const O=null===(A=M.dO)||void 0===A?void 0:A.value;"object"===typeof O&&O.getClassName?g.c.Log("[FGLog] ".concat(M.className,":").concat(M.uniqueId.split("-")[0]," ").concat(M.action," - ").concat(JSON.stringify(O.getClassName()),": ").concat(O.toString())):g.c.Log("[FGLog] ".concat(M.className,":").concat(M.uniqueId.split("-")[0]," ").concat(M.action," - ").concat(JSON.stringify(M.dO)))}}getItemsOfType(M){return this.log.filter((A=>A.action===M))}}class T{get enableLogging(){return this._enableLogging}set enableLogging(M){this._enableLogging!==M&&(this._enableLogging=M,this._enableLogging?(this.logger=new e,this.logger.logToConsole=!0):this.logger=null)}constructor(M){var A;this.uniqueId=(0,c.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new z.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=M,this.assetsContext=null!==(A=M.assetsContext)&&void 0!==A?A:M.wA}hasVariable(M){return M in this._userVariables}setVariable(M,A){var O;this._userVariables[M]=A,null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",dO:{name:M,value:A}})}getAsset(M,A){return(0,B.e)(this.assetsContext,M,A)}getVariable(M){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",dO:{name:M,value:this._userVariables[M]}}),this._userVariables[M]}get userVariables(){return this._userVariables}HM(){return this._configuration.wA}_getUniqueIdPrefixedName(M,A){return"".concat(M.uniqueId,"_").concat(A)}_getGlobalContextVariable(M,A){var O;return null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",dO:{name:M,defaultValue:A,possibleValue:this._globalContextVariables[M]}}),this._hasGlobalContextVariable(M)?this._globalContextVariables[M]:A}_setGlobalContextVariable(M,A){var O;null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",dO:{name:M,value:A}}),this._globalContextVariables[M]=A}_deleteGlobalContextVariable(M){var A;null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",dO:{name:M}}),delete this._globalContextVariables[M]}_hasGlobalContextVariable(M){return M in this._globalContextVariables}_setExecutionVariable(M,A,O){this._executionVariables[this._getUniqueIdPrefixedName(M,A)]=O}_getExecutionVariable(M,A,O){return this._hasExecutionVariable(M,A)?this._executionVariables[this._getUniqueIdPrefixedName(M,A)]:O}_deleteExecutionVariable(M,A){delete this._executionVariables[this._getUniqueIdPrefixedName(M,A)]}_hasExecutionVariable(M,A){return this._getUniqueIdPrefixedName(M,A)in this._executionVariables}_hasConnectionValue(M){return M.uniqueId in this._connectionValues}_setConnectionValue(M,A){var O;this._connectionValues[M.uniqueId]=A,null===(O=this.logger)||void 0===O||O.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",dO:{connectionPointId:M.uniqueId,value:A}})}_setConnectionValueByKey(M,A){this._connectionValues[M]=A}_getConnectionValue(M){var A;return null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",dO:{connectionPointId:M.uniqueId,value:this._connectionValues[M.uniqueId]}}),this._connectionValues[M.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(M){this._pendingBlocks.includes(M)||(this._pendingBlocks.push(M),this._pendingBlocks.sort(((M,A)=>M.priority-A.priority)))}_removePendingBlock(M){const A=this._pendingBlocks.indexOf(M);-1!==A&&this._pendingBlocks.splice(A,1)}_clearPendingBlocks(){for(const M of this._pendingBlocks)M._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(M){var A;this.onNodeExecutedObservable.notifyObservers(M),null===(A=this.logger)||void 0===A||A.addLogItem({time:Date.now(),className:M.getClassName(),uniqueId:M.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(M){this._setGlobalContextVariable("timeSinceStart",M.timeSinceStart),this._setGlobalContextVariable("deltaTime",M.deltaTime);for(const O of this._pendingBlocks){var A;null===(A=O._executeOnTick)||void 0===A||A.call(O,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.e;M.uniqueId=this.uniqueId,M._userVariables={};for(const S in this._userVariables)A(S,this._userVariables[S],M._userVariables);M._connectionValues={};for(const S in this._connectionValues)A(S,this._connectionValues[S],M._connectionValues);var O;this.assetsContext!==this.HM()&&(M._assetsContext={meshes:this.assetsContext.meshes.map((M=>M.id)),materials:this.assetsContext.materials.map((M=>M.id)),textures:this.assetsContext.textures.map((M=>M.name)),animations:this.assetsContext.animations.map((M=>M.name)),lights:this.assetsContext.lights.map((M=>M.id)),cameras:this.assetsContext.cameras.map((M=>M.id)),ZJ:null===(O=this.assetsContext.ZJ)||void 0===O?void 0:O.map((M=>M.name)),skeletons:this.assetsContext.skeletons.map((M=>M.id)),TJ:this.assetsContext.TJ.map((M=>M.name)),geometries:this.assetsContext.geometries.map((M=>M.id)),multiMaterials:this.assetsContext.multiMaterials.map((M=>M.id)),transformNodes:this.assetsContext.transformNodes.map((M=>M.id))})}getClassName(){return"FlowGraphContext"}}(0,Q.d)([(0,X.H)()],T.prototype,"uniqueId",void 0);var J=O(14248),K=O(13244);class G{constructor(M){this.onEventTriggeredObservable=new z.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=M,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Ac.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const M=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",dO:{timeSinceStart:this._startingTime,deltaTime:M}}),this._startingTime+=M})),this._meshPickedObserver=this._scene.onPointerObservable.add((M=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",dO:M})}),K.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((M=>{const A=M.pointerId,O=M.mesh,S=this._pointerUnderMeshState[A];!S&&O?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",dO:{pointerId:A,mesh:O}}):S&&!O?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",dO:{pointerId:A,mesh:S}}):S&&O&&S!==O&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",dO:{pointerId:A,mesh:S,over:O}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",dO:{pointerId:A,mesh:O,out:S}})),this._pointerUnderMeshState[A]=O}),K.b.POINTERMOVE)}dispose(){var M,A,O,S,z;null===(M=this._sceneDisposeObserver)||void 0===M||M.remove(),null===(A=this._sceneReadyObserver)||void 0===A||A.remove(),null===(O=this._sceneOnBeforeRenderObserver)||void 0===O||O.remove(),null===(S=this._meshPickedObserver)||void 0===S||S.remove(),null===(z=this._meshUnderPointerObserver)||void 0===z||z.remove(),this.onEventTriggeredObservable.clear()}}var d,w=O(14273);!function(M){M[M.Stopped=0]="Stopped",M[M.Started=1]="Started"}(d||(d={}));class I{get state(){return this._state}set state(M){this._state=M,this.onStateChangedObservable.notifyObservers(M)}constructor(M){this.onStateChangedObservable=new z.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=M.wA,this._sceneEventCoordinator=new G(this._scene),this._coordinator=M.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((M=>{for(const A of this._executionContexts){const O=this._getContextualOrder(M.type,A);for(const S of O)if(!S._executeEvent(A,M.dO))break}switch(M.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const A of this._executionContexts)A._notifyOnTick(M.dO);break;case"SceneDispose":this.dispose()}}))}createContext(){const M=new T({wA:this._scene,coordinator:this._coordinator});return this._executionContexts.push(M),M}getContext(M){return this._executionContexts[M]}addEventBlock(M){if("PointerOver"!==M.type&&"PointerOut"!==M.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==M.type&&this._eventBlocks[M.type].push(M),1===this.state)for(const A of this._executionContexts)M._startPendingTasks(A);else this.onStateChangedObservable.addOnce((A=>{if(1===A)for(const O of this._executionContexts)M._startPendingTasks(O)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((M=>{1===M&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const M of this._executionContexts)for(const A in this._eventBlocks){const O=this._getContextualOrder(A,M);for(const A of O)A._startPendingTasks(M)}}_getContextualOrder(M,A){const O=this._eventBlocks[M].sort(((M,A)=>A.initPriority-M.initPriority));if("MeshPick"===M){const M=[];for(const S of O){const z=S.asset.getValue(A);let Q=0;for(;Q<O.length;Q++){const M=O[Q].asset.getValue(A);if(z&&M&&(0,w.j)(z,M))break}M.splice(Q,0,S)}return M}return O}dispose(){var M;if(0!==this.state){this.state=0;for(const M of this._executionContexts)M._clearPendingBlocks();this._executionContexts.length=0;for(const M in this._eventBlocks)this._eventBlocks[M].length=0;null===(M=this._eventObserver)||void 0===M||M.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(M){const A=[],O=new Set;for(const S in this._eventBlocks)for(const M of this._eventBlocks[S])A.push(M),O.add(M.uniqueId);for(;A.length>0;){const S=A.pop();M(S);for(const M of S.dataInputs)for(const S of M._connectedPoint)O.has(S._ownerBlock.uniqueId)||(A.push(S._ownerBlock),O.add(S._ownerBlock.uniqueId));if(S instanceof J.d)for(const M of S.signalOutputs)for(const S of M._connectedPoint)O.has(S._ownerBlock.uniqueId)||(A.push(S._ownerBlock),O.add(S._ownerBlock.uniqueId))}}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},A=arguments.length>1?arguments[1]:void 0;M.allBlocks=[],this.visitAllBlocks((A=>{const O={};A.serialize(O),M.allBlocks.push(O)})),M.executionContexts=[];for(const O of this._executionContexts){const S={};O.serialize(S,A),M.executionContexts.push(S)}}}class b{constructor(M){var A;this.config=M,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.wA.Ac.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.wA.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const M=this._executeOnNextFrame.slice(0);if(M.length)for(const A of M){this.notifyCustomEvent(A.id,A.data,!1);const M=this._executeOnNextFrame.findIndex((M=>M.uniqueId===A.uniqueId));-1!==M&&this._executeOnNextFrame.splice(M,1)}}));(null!==(A=b.SceneCoordinators.get(this.config.wA))&&void 0!==A?A:[]).push(this)}createGraph(){const M=new I({wA:this.config.wA,coordinator:this});return this._flowGraphs.push(M),M}removeGraph(M){const A=this._flowGraphs.indexOf(M);-1!==A&&(M.dispose(),this._flowGraphs.splice(A,1))}start(){for(const M of this._flowGraphs)M.start()}dispose(){var M,A,O;for(const Q of this._flowGraphs)Q.dispose();this._flowGraphs.length=0,null===(M=this._disposeObserver)||void 0===M||M.remove(),null===(A=this._onBeforeRenderObserver)||void 0===A||A.remove();const S=null!==(O=b.SceneCoordinators.get(this.config.wA))&&void 0!==O?O:[],z=S.indexOf(this);-1!==z&&S.splice(z,1)}serialize(M,A){M._flowGraphs=[];for(const O of this._flowGraphs){const S={};O.serialize(S,A),M._flowGraphs.push(S)}M.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(M){let A=this._customEventsMap.get(M);return A||(A=new z.c,this._customEventsMap.set(M,A)),A}notifyCustomEvent(M,A){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:M,data:A,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(M)){const A=this._eventExecutionCounter.get(M);if(this._eventExecutionCounter.set(M,A+1),A>=b.MaxEventTypeExecutionPerFrame)return void(A===b.MaxEventTypeExecutionPerFrame&&g.c.Warn('FlowGraphCoordinator: Too many executions of event "'.concat(M,'".')))}else this._eventExecutionCounter.set(M,1);const O=this._customEventsMap.get(M);O&&O.notifyObservers(A)}}b.MaxEventsPerType=30,b.MaxEventTypeExecutionPerFrame=30,b.SceneCoordinators=new Map},14280:(M,A,O)=>{"use strict";O.d(A,{e:()=>z});var S=O(14284);class z extends S.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(M){M._notifyExecuteNode(this),this.done._activateSignal(M)}}},14248:(M,A,O)=>{"use strict";O.d(A,{d:()=>c});var S=O(14255),z=O(14264),Q=O(12919);class X extends z.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(M){super.connectTo(M),this._connectedPoint.sort(((M,A)=>A.priority-M.priority))}_activateSignal(M){var A;if(null===(A=M.logger)||void 0===A||A.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,dO:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)M._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(M,this),M._increaseExecutionId();else for(const O of this._connectedPoint)O._activateSignal(M)}}(0,Q.g)("FlowGraphSignalConnection",X);class c extends S.c{constructor(M){super(M),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(M){const A=new X(M,0,this);return this.signalInputs.push(A),A}_registerSignalOutput(M){const A=new X(M,1,this);return this.signalOutputs.push(A),A}_unregisterSignalInput(M){const A=this.signalInputs.findIndex((A=>A.name===M));-1!==A&&(this.signalInputs[A].dispose(),this.signalInputs.splice(A,1))}_unregisterSignalOutput(M){const A=this.signalOutputs.findIndex((A=>A.name===M));-1!==A&&(this.signalOutputs[A].dispose(),this.signalOutputs.splice(A,1))}_reportError(M,A){this.error.dO="string"===typeof A?new Error(A):A,this.error._activateSignal(M)}getSignalInput(M){return this.signalInputs.find((A=>A.name===M))}getSignalOutput(M){return this.signalOutputs.find((A=>A.name===M))}serialize(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(M),M.signalInputs=[],M.signalOutputs=[];for(const A of this.signalInputs){const O={};A.serialize(O),M.signalInputs.push(O)}for(const A of this.signalOutputs){const O={};A.serialize(O),M.signalOutputs.push(O)}}deserialize(M){for(let A=0;A<M.signalInputs.length;A++){const O=this.getSignalInput(M.signalInputs[A].name);if(!O)throw new Error("Could not find signal input with name "+M.signalInputs[A].name+" in block "+M.className);O.deserialize(M.signalInputs[A])}for(let A=0;A<M.signalOutputs.length;A++){const O=this.getSignalOutput(M.signalOutputs[A].name);if(!O)throw new Error("Could not find signal output with name "+M.signalOutputs[A].name+" in block "+M.className);O.deserialize(M.signalOutputs[A])}}getClassName(){return"FlowGraphExecutionBlock"}}},14288:(M,A,O)=>{"use strict";O.d(A,{e:()=>z});var S=O(14248);class z extends S.d{constructor(M){super(M),this.out=this._registerSignalOutput("out")}}},14238:(M,A,O)=>{"use strict";O.d(A,{D:()=>K,F:()=>G,H:()=>f,L:()=>D,P:()=>C,R:()=>H,b:()=>B,f:()=>T,h:()=>E,k:()=>d,m:()=>w,q:()=>I,t:()=>e,v:()=>Y,y:()=>g,z:()=>J});var S,z=O(12970),Q=O(13010),X=O(14236),c=O(14241);!function(M){M.Any="any",M.String="string",M.Number="number",M.Boolean="boolean",M.Object="object",M.Integer="FlowGraphInteger",M.Vector2="Vector2",M.GA="GA",M.Vector4="Vector4",M.Quaternion="Quaternion",M.Matrix="Matrix",M.Matrix2D="Matrix2D",M.Matrix3D="Matrix3D",M.bA="bA",M.Cc="Cc"}(S||(S={}));class j{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=M,this.defaultValue=A,this.animationType=O}serialize(M){M.typeName=this.typeName,M.defaultValue=this.defaultValue}}const B=new j("any",void 0),g=new j("string",""),e=new j("number",0,0),T=new j("boolean",!1),J=new j("Vector2",z.Vector2.Zero(),5),K=new j("GA",z.GA.Zero(),1),G=new j("Vector4",z.Vector4.Zero()),d=new j("Matrix",z.Matrix.Identity(),3),w=new j("Matrix2D",new c.d),I=new j("Matrix3D",new c.h),b=new j("bA",Q.bA.Black(),4),s=new j("Cc",new Q.Cc(0,0,0,0),7),Y=new j("Quaternion",z.Quaternion.Identity(),2);Y.typeTransformer=M=>{if(M.getClassName){if("Vector4"===M.getClassName())return z.Quaternion.sA(M.gc());if("GA"===M.getClassName())return z.Quaternion.FromEulerVector(M);if("Matrix"===M.getClassName())return z.Quaternion.FromRotationMatrix(M)}return M};const E=new j("FlowGraphInteger",new X.b(0),0);function H(M){const A=M;switch(typeof M){case"string":return g;case"number":return e;case"boolean":return T;case"object":if(A.getClassName)switch(A.getClassName()){case"Vector2":return J;case"GA":return K;case"Vector4":return G;case"Matrix":return d;case"bA":return b;case"Cc":return s;case"Quaternion":return Y;case"FlowGraphInteger":return E;case"Matrix2D":return w;case"Matrix3D":return I}return B;default:return B}}function C(M){switch(M){case"string":return g;case"number":return e;case"boolean":return T;case"Vector2":return J;case"GA":return K;case"Vector4":return G;case"Matrix":return d;case"bA":return b;case"Cc":return s;case"Quaternion":return Y;case"FlowGraphInteger":return E;case"Matrix2D":return w;case"Matrix3D":return I;default:return B}}function f(M){switch(M){case"number":default:return 0;case"Vector2":return 5;case"GA":return 1;case"Matrix":return 3;case"bA":return 4;case"Cc":return 7;case"Quaternion":return 2}}function D(M){switch(M){case 0:return e;case 5:return J;case 1:return K;case 3:return d;case 4:return b;case 7:return s;case 2:return Y;default:return B}}},14228:(M,A,O)=>{"use strict";O.d(A,{c:()=>g,e:()=>B,g:()=>e});var S=O(13010),z=O(12970),Q=O(14236),X=O(14238),c=O(14241);function j(M){return"Vector2"===M||"GA"===M||"Vector4"===M||"Quaternion"===M||"bA"===M||"Cc"===M}function B(M,A,O){var S,z;const Q=null!==(S=null===A||void 0===A||null===(z=A.getClassName)||void 0===z?void 0:z.call(A))&&void 0!==S?S:"";if(j(Q)||function(M){return"Matrix"===M||"Matrix2D"===M||"Matrix3D"===M}(Q))O[M]={value:A.gc(),className:Q};else if("FlowGraphInteger"===Q)O[M]={value:A.value,className:Q};else if(Q&&(A.id||A.name))O[M]={id:A.id,name:A.name,className:Q};else{if("object"===typeof A)throw new Error("Could not serialize value ".concat(A));O[M]=A}}function g(M,A,O,B){var e;const T=A[M];let J;const K=null!==(e=null===T||void 0===T?void 0:T.type)&&void 0!==e?e:null===T||void 0===T?void 0:T.className;if(function(M){return"Mesh"===M||"AbstractMesh"===M||"GroundMesh"===M||"InstanceMesh"===M||"LinesMesh"===M||"GoldbergMesh"===M||"GreasedLineMesh"===M||"TrailMesh"===M}(K)){let M=B.meshes.filter((M=>T.id?M.id===T.id:M.name===T.name));0===M.length&&(M=B.transformNodes.filter((M=>T.id?M.id===T.id:M.name===T.name))),J=T.uniqueId?M.find((M=>M.uniqueId===T.uniqueId)):M[0]}else if(j(K))J=function(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===M)return z.Vector2.sA(A);if("GA"===M)return O&&(A[2]*=-1),z.GA.sA(A);if("Vector4"===M)return z.Vector4.sA(A);if("Quaternion"===M)return O&&(A[2]*=-1,A[3]*=-1),z.Quaternion.sA(A);if("bA"===M)return new S.bA(A[0],A[1],A[2]);if("Cc"===M)return new S.Cc(A[0],A[1],A[2],A[3]);throw new Error("Unknown vector class name ".concat(M))}(K,T.value);else if(function(M){return"AnimationGroup"===M}(K)){const M=B.animationGroups.filter((M=>M.name===T.name));J=1===M.length?M[0]:M.find((M=>M.uniqueId===T.uniqueId))}else J="Matrix"===K?z.Matrix.sA(T.value):"Matrix2D"===K?new c.d(T.value):"Matrix3D"===K?new c.h(T.value):"FlowGraphInteger"===K?Q.b.FromValue(T.value):"number"===K||"string"===K||"boolean"===K?T.value[0]:T&&void 0!==T.value?T.value:Array.isArray(T)?T.reduce(((M,A)=>A.eventData?(M[A.id]={type:(0,X.P)(A.type)},"undefined"!==typeof A.value&&(M[A.id].value=g("value",A,O,B)),M):M),{}):T;return J}function e(M){return"FlowGraphJsonPointerParserBlock"===M}},14273:(M,A,O)=>{"use strict";function S(M,A){return!(!M.parent||M.parent!==A&&!S(M.parent,A))}function z(M){if(M.getClassName)return M.getClassName()}function Q(M,A){return M===A&&("Vector2"===M||"GA"===M||"Vector4"===M||"Quaternion"===M)}function X(M,A){return M===A&&("Matrix"===M||"Matrix2D"===M||"Matrix3D"===M)}function c(M,A){return"FlowGraphInteger"===M&&"FlowGraphInteger"===A}function j(M,A){const O="number"===typeof M||"number"===typeof(null===M||void 0===M?void 0:M.value);return O&&!A?!isNaN(B(M)):O}function B(M){return"number"===typeof M?M:M.value}O.d(A,{b:()=>c,c:()=>X,e:()=>Q,g:()=>z,j:()=>S,n:()=>B,p:()=>j})},14601:(M,A,O)=>{"use strict";O.r(A),O.d(A,{SceneInstrumentation:()=>Q});var S=O(12768),z=O(13192);class Q{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(M){M!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=M,M?(this._onBeforeActiveMeshesEvaluationObserver=this.wA.onBeforeActiveMeshesEvaluationObservable.add((()=>{S.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.wA.onAfterActiveMeshesEvaluationObservable.add((()=>{S.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.wA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(M){M!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=M,M?(this._onBeforeRenderTargetsRenderObserver=this.wA.onBeforeRenderTargetsRenderObservable.add((()=>{S.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.wA.onAfterRenderTargetsRenderObservable.add((()=>{S.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.wA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(M){M!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=M,M?(this._onBeforeParticlesRenderingObserver=this.wA.onBeforeParticlesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.wA.onAfterParticlesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.wA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(M){M!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=M,this.wA.spriteManagers&&(M?(this._onBeforeSpritesRenderingObserver=this.wA.onBeforeSpritesRenderingObservable.add((()=>{S.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.wA.onAfterSpritesRenderingObservable.add((()=>{S.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.wA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.wA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(M){M!==this._capturePhysicsTime&&this.wA.onBeforePhysicsObservable&&(this._capturePhysicsTime=M,M?(this._onBeforePhysicsObserver=this.wA.onBeforePhysicsObservable.add((()=>{S.Tools.StartPerformanceCounter("tc"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.wA.onAfterPhysicsObservable.add((()=>{S.Tools.EndPerformanceCounter("tc"),this._physicsTime.endMonitoring()}))):(this.wA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.wA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(M){M!==this._captureAnimationsTime&&(this._captureAnimationsTime=M,M?this._onAfterAnimationsObserver=this.wA.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.wA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(M){this._captureFrameTime=M}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(M){this._captureInterFrameTime=M}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(M){M!==this._captureRenderTime&&(this._captureRenderTime=M,M?(this._onBeforeDrawPhaseObserver=this.wA.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),S.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.wA.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter("Main render")}))):(this.wA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(M){M!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=M,M?(this._onBeforeCameraRenderObserver=this.wA.onBeforeCameraRenderObservable.add((M=>{this._cameraRenderTime.beginMonitoring(),S.Tools.StartPerformanceCounter("Rendering camera ".concat(M.name))})),this._onAfterCameraRenderObserver=this.wA.onAfterCameraRenderObservable.add((M=>{this._cameraRenderTime.endMonitoring(!1),S.Tools.EndPerformanceCounter("Rendering camera ".concat(M.name))}))):(this.wA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.wA.getEngine()._drawCalls}constructor(M){this.wA=M,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new z.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new z.e,this._captureFrameTime=!1,this._frameTime=new z.e,this._captureRenderTime=!1,this._renderTime=new z.e,this._captureInterFrameTime=!1,this._interFrameTime=new z.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new z.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new z.e,this._capturePhysicsTime=!1,this._physicsTime=new z.e,this._captureAnimationsTime=!1,this._animationsTime=new z.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new z.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=M.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(S.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.wA.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=M.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(S.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.mc(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.mc(),this._captureParticlesRenderTime&&this._particlesRenderTime.mc(),this._captureSpritesRenderTime&&this._spritesRenderTime.mc(),this._captureRenderTime&&this._renderTime.mc(),this._captureCameraRenderTime&&this._cameraRenderTime.mc()}))}dispose(){this._disposed||(this.wA.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.wA.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.wA.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.wA.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.wA.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.wA.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.wA.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.wA.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.wA.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.wA.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.wA.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.wA.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.wA.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.wA.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.wA.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.wA.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.wA.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.wA=null,this._disposed=!0)}}},14217:(M,A,O)=>{"use strict";O.d(A,{c:()=>g});var S=O(12958),z=O(12964),Q=O(12970),X=O(13393),c=O(13522),j=O(13568),B=O(12919);X.e.AddNodeConstructor("Light_Type_1",((M,A)=>()=>new g(M,Q.GA.Zero(),A)));class g extends j.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(M){this._shadowFrustumSize=M,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(M){this._shadowOrthoScale=M,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(M){this._orthoLeft=M}get orthoRight(){return this._orthoRight}set orthoRight(M){this._orthoRight=M}get orthoTop(){return this._orthoTop}set orthoTop(M){this._orthoTop=M}get orthoBottom(){return this._orthoBottom}set orthoBottom(M){this._orthoBottom=M}constructor(M,A,O){super(M,O),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=A.scale(-1),this.direction=A}getClassName(){return"xc"}getTypeID(){return c.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(M,A,O){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(M):this._setDefaultAutoExtendShadowProjectionMatrix(M,A,O)}_setDefaultFixedFrustumShadowProjectionMatrix(M){const A=this.HM().activeCamera;A&&Q.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:A.Tc,void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,M,this.HM().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(M,A,O){const S=this.HM().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const M=Q.GA.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let S=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let X=0;X<O.length;X++){const c=O[X];if(!c)continue;const j=c.getBoundingInfo().boundingBox;for(let O=0;O<j.vectorsWorld.length;O++)Q.GA.TransformCoordinatesToRef(j.vectorsWorld[O],A,M),M.x<this._orthoLeft&&(this._orthoLeft=M.x),M.y<this._orthoBottom&&(this._orthoBottom=M.y),M.x>this._orthoRight&&(this._orthoRight=M.x),M.y>this._orthoTop&&(this._orthoTop=M.y),this.autoCalcShadowZBounds&&(M.z<S&&(S=M.z),M.z>z&&(z=M.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=S,this._shadowMaxZ=z)}const z=this._orthoRight-this._orthoLeft,X=this._orthoTop-this._orthoBottom,c=void 0!==this.shadowMinZ?this.shadowMinZ:(null===S||void 0===S?void 0:S.Tc)||0,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===S||void 0===S?void 0:S.maxZ)||1e4,B=this.HM().getEngine().QQ;Q.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-z*this.shadowOrthoScale,this._orthoRight+z*this.shadowOrthoScale,this._orthoBottom-X*this.shadowOrthoScale,this._orthoTop+X*this.shadowOrthoScale,B?j:c,B?c:j,M,this.HM().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,A){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,A),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,A),this)}transferToNodeMaterialEffect(M,A){return this.computeTransformedInformation()?(M.setFloat3(A,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(M.setFloat3(A,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(M){const A=this._scene.getEngine();return!A.QQ&&A.isNDCHalfZRange?0:1}getDepthMaxZ(M){const A=this._scene.getEngine();return A.QQ&&A.isNDCHalfZRange?0:1}prepareLightSpecificDefines(M,A){M["DIRLIGHT"+A]=!0}}(0,S.d)([(0,z.H)()],g.prototype,"shadowFrustumSize",null),(0,S.d)([(0,z.H)()],g.prototype,"shadowOrthoScale",null),(0,S.d)([(0,z.H)()],g.prototype,"autoUpdateExtends",void 0),(0,S.d)([(0,z.H)()],g.prototype,"autoCalcShadowZBounds",void 0),(0,S.d)([(0,z.H)("orthoLeft")],g.prototype,"_orthoLeft",void 0),(0,S.d)([(0,z.H)("orthoRight")],g.prototype,"_orthoRight",void 0),(0,S.d)([(0,z.H)("orthoTop")],g.prototype,"_orthoTop",void 0),(0,S.d)([(0,z.H)("orthoBottom")],g.prototype,"_orthoBottom",void 0),(0,B.g)("BABYLON.DirectionalLight",g)},14767:(M,A,O)=>{"use strict";O.d(A,{e:()=>g});var S=O(12958),z=O(12964),Q=O(12970),X=O(13010),c=O(13393),j=O(13522),B=O(12919);c.e.AddNodeConstructor("Light_Type_3",((M,A)=>()=>new g(M,Q.GA.Zero(),A)));class g extends j.d{constructor(M,A,O){super(M,O),this.groundColor=new X.bA(0,0,0),this.direction=A||Q.GA.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"oc"}setDirectionToTarget(M){return this.direction=Q.GA.Normalize(M.dA(Q.GA.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(M,A){const O=Q.GA.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",O.x,O.y,O.z,0,A),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Fc),A),this}transferToNodeMaterialEffect(M,A){const O=Q.GA.Normalize(this.direction);return M.setFloat3(A,O.x,O.y,O.z),this}Gc(){return this._worldMatrix||(this._worldMatrix=Q.Matrix.Identity()),this._worldMatrix}getTypeID(){return j.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(M,A){M["HEMILIGHT"+A]=!0}}(0,S.d)([(0,z.f)()],g.prototype,"groundColor",void 0),(0,S.d)([(0,z.D)()],g.prototype,"direction",void 0),(0,B.g)("BABYLON.HemisphericLight",g)},14186:(M,A,O)=>{"use strict";O.d(A,{c:()=>e});var S=O(12958),z=O(12964),Q=O(12970),X=O(13393),c=O(13522),j=O(13568),B=O(12949),g=O(12919);X.e.AddNodeConstructor("Light_Type_2",((M,A)=>()=>new e(M,Q.GA.Zero(),Q.GA.Zero(),0,0,A)));class e extends j.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(M){this._iesProfileTexture!==M&&(this._iesProfileTexture=M,this._iesProfileTexture&&e._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(M){this._angle=M,this._cosHalfAngle=Math.cos(.5*M),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(M){this._innerAngle=M,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(M){this._shadowAngleScale=M,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(M){this._projectionTextureLightNear=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(M){this._projectionTextureLightFar=M,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(M){this._projectionTextureUpDirection=M,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(M){this._projectionTexture!==M&&(this._projectionTexture=M,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(e._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):e._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(M){return void 0!==M.onGeneratedObservable}static _IsTexture(M){return void 0!==M.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(M){this._projectionTextureProjectionLightMatrix=M,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(M,A,O,S,z,X){super(M,X),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=Q.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=Q.GA.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=Q.GA.Zero(),this._projectionTextureViewLightMatrix=Q.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=Q.Matrix.Zero(),this._projectionTextureScalingMatrix=Q.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=A,this.direction=O,this.angle=S,this.exponent=z}getClassName(){return"SpotLight"}getTypeID(){return c.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(M){super._setDirection(M),this._projectionTextureViewLightDirty=!0}_setPosition(M){super._setPosition(M),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(M,A,O){const S=this.HM().activeCamera;if(!S)return;this._shadowAngleScale=this._shadowAngleScale||1;const z=this._shadowAngleScale*this._angle,X=void 0!==this.shadowMinZ?this.shadowMinZ:S.Tc,c=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,j=this.HM().getEngine().QQ;Q.Matrix.PerspectiveFovLHToRef(z,1,j?c:X,j?X:c,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,j)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),Q.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const M=this.projectionTextureLightFar,A=this.projectionTextureLightNear,O=M/(M-A),S=-O*A,z=1/Math.tan(this._angle/2);Q.Matrix.FromValuesToRef(z/1,0,0,0,0,z,0,0,0,0,O,1,0,0,S,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof B.c){const M=this._projectionTexture.uScale/2,A=this._projectionTexture.vScale/2;Q.Matrix.FromValuesToRef(M,0,0,0,0,A,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(M,A){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),M.setMatrix("textureProjectionMatrix"+A,this._projectionTextureMatrix),M.setTexture("projectionLightTexture"+A,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&M.setTexture("iesLightTexture"+A,this._iesProfileTexture),this}transferToEffect(M,A){let O;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,A),O=Q.GA.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,A),O=Q.GA.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",O.x,O.y,O.z,this._cosHalfAngle,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,A),this}transferToNodeMaterialEffect(M,A){let O;return O=this.computeTransformedInformation()?Q.GA.Normalize(this.transformedDirection):Q.GA.Normalize(this.direction),this.HM().useRightHandedSystem?M.setFloat3(A,-O.x,-O.y,-O.z):M.setFloat3(A,O.x,O.y,O.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(M){var A;const O=this._scene.getEngine(),S=void 0!==this.shadowMinZ?this.shadowMinZ:null!==(A=null===M||void 0===M?void 0:M.Tc)&&void 0!==A?A:0;return O.QQ&&O.isNDCHalfZRange?S:this._scene.getEngine().isNDCHalfZRange?0:S}getDepthMaxZ(M){var A;const O=this._scene.getEngine(),S=void 0!==this.shadowMaxZ?this.shadowMaxZ:null!==(A=null===M||void 0===M?void 0:M.maxZ)&&void 0!==A?A:1e4;return O.QQ&&O.isNDCHalfZRange?0:S}prepareLightSpecificDefines(M,A){M["SPOTLIGHT"+A]=!0,M["PROJECTEDLIGHTTEXTURE"+A]=!(!this.projectionTexture||!this.projectionTexture.isReady()),M["IESLIGHTTEXTURE"+A]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,S.d)([(0,z.H)()],e.prototype,"angle",null),(0,S.d)([(0,z.H)()],e.prototype,"innerAngle",null),(0,S.d)([(0,z.H)()],e.prototype,"shadowAngleScale",null),(0,S.d)([(0,z.H)()],e.prototype,"exponent",void 0),(0,S.d)([(0,z.H)()],e.prototype,"projectionTextureLightNear",null),(0,S.d)([(0,z.H)()],e.prototype,"projectionTextureLightFar",null),(0,S.d)([(0,z.H)()],e.prototype,"projectionTextureUpDirection",null),(0,S.d)([(0,z.y)("projectedLightTexture")],e.prototype,"_projectionTexture",void 0),(0,g.g)("BABYLON.SpotLight",e)},13936:(M,A,O)=>{"use strict";O.d(A,{c:()=>X,f:()=>Q,i:()=>c});const S={},z={};function Q(M,A){S[M]=A}function X(M,A){z[M]=A}function c(M){return z[M]?z[M]:null}},13840:(M,A,O)=>{"use strict";O.d(A,{c:()=>H,d:()=>L});var S,z=O(12768),Q=O(12776),X=O(13214),c=O(12811),j=O(12783),B=O(13436),g=O(12813),e=O(12821),T=O(12927),J=O(12852),K=O(12804);!function(M){M[M.Clean=0]="Clean",M[M.Stop=1]="Stop",M[M.Sync=2]="Sync",M[M.NoSync=3]="NoSync"}(S||(S={}));const G=new Q.c,d={};let w=!1;function I(){return d[".babylon"]}function b(M,A){const O=d[M];return O||(j.c.Warn("Unable to find a plugin to load "+M+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),A?I():void 0)}function s(M,A,O){let S="Unable to load from "+(M.rawData?"binary data":M.url);return A?S+=": ".concat(A):O&&(S+=": ".concat(O)),S}async function Y(M,A,O,S,z,Q,X,c,j){var B;const e="data:"===(T=M.url).substring(0,5)?T.substring(5):null;var T;if(M.rawData&&!X)throw"When using ArrayBufferView to load data the file extension must be provided.";const w=e||X?"":function(M){const A=M.indexOf("?");-1!==A&&(M=M.substring(0,A));const O=M.lastIndexOf(".");return M.substring(O,M.length).toLowerCase()}(M.url);let s=X?b(X,!0):e?function(M){for(const A in d){const O=d[A].plugin;if(O.canDirectLoad&&O.canDirectLoad(M))return d[A]}return I()}(M.url):b(w,!1);if(!s&&w){if(M.url&&!M.url.startsWith("blob:")){const A=await async function(M,A){const O=A.method||"GET";return await new Promise(((S,z)=>{const Q=new K.b;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){const M={};if(A.responseHeaders)for(const O of A.responseHeaders)M[O]=Q.getResponseHeader(O)||"";S({response:Q.response,headerValues:M})}else z("Unable to fetch data from ".concat(M,". Error code: ").concat(Q.status))})),Q.open(O,M),Q.send()}))}(M.url,{method:"HEAD",responseHeaders:["Content-Type"]}),O=A.headerValues?A.headerValues["Content-Type"]:"";O&&(s=function(M){for(const A in d){const O=d[A];if(O.mimeType===M)return O}}(O))}s||(s=I())}if(!s)throw new Error("No plugin or fallback for ".concat(null!==X&&void 0!==X?X:M.url));if(!1===(null===j||void 0===j||null===(B=j[s.plugin.name])||void 0===B?void 0:B.enabled))throw new Error("The '".concat(s.plugin.name,"' plugin is disabled via the loader options passed to the loading operation."));if(M.rawData&&!s.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(M=>{if(s.plugin.createPlugin){const A=s.plugin.createPlugin(null!==j&&void 0!==j?j:{});return A instanceof Promise?(A.then(M).catch((M=>{z("Error instantiating plugin.",M)})),null):(M(A),A)}return M(s.plugin),s.plugin})((j=>{var B;if(!j)throw"The loader plugin corresponding to the '".concat(X,"' file type has not been found. If using es6, please import the plugin you wish to use before.");if(G.notifyObservers(j),e&&(j.canDirectLoad&&j.canDirectLoad(M.url)||!(0,g.l)(M.url))){if(j.directLoad){const M=j.directLoad(A,e);M instanceof Promise?M.then((M=>{O(j,M)})).catch((M=>{z("Error in directLoad of _loadData: "+M,M)})):O(j,M)}else O(j,e);return}const T=s.isBinary,K=(M,S)=>{A.T?z("Scene has been disposed"):O(j,M,S)};let d=null,w=!1;null===(B=j.Ac)||void 0===B||B.add((()=>{w=!0,d&&(d.abort(),d=null),Q()}));const I=()=>{if(w)return;const O=(M,A)=>{z(null===M||void 0===M?void 0:M.statusText,A)};if(!j.loadFile&&M.rawData)throw"Plugin does not support loading ArrayBufferView.";d=j.loadFile?j.loadFile(A,M.rawData||M.file||M.url,M.rootUrl,K,S,T,O,c):A._loadFile(M.file||M.url,K,S,!0,T,O)},b=A.getEngine();let Y=b.enableOfflineSupport;if(Y){let O=!1;for(const S of A.disableOfflineSupportExceptionRules)if(S.test(M.url)){O=!0;break}Y=!O}Y&&J.e.OfflineProviderFactory?A.offlineProvider=J.e.OfflineProviderFactory(M.url,I,b.disableManifestCheck):I()}))}function E(M,A){let O,S,Q=null,X=null;if(A)if(A.name)O="file:".concat(A.name),S=A.name,Q=A;else if(ArrayBuffer.isView(A))O="",S=(0,T.b)(),X=A;else if(A.startsWith("data:"))O=A,S="";else if(M){const Q=A;if("/"===Q.substring(0,1))return z.Tools.Error("Wrong sceneFilename parameter"),null;O=M+Q,S=Q}else O=A,S=z.Tools.GetFilename(A),M=z.Tools.GetFolderPath(A);else O=M,S=z.Tools.GetFilename(M),M=z.Tools.GetFolderPath(M);return{url:O,rootUrl:M,name:S,file:Q,rawData:X}}function H(M){if("string"===typeof M.extensions){const A=M.extensions;d[A.toLowerCase()]={plugin:M,isBinary:!1}}else{const A=M.extensions,O=Object.keys(A);for(const S of O)d[S.toLowerCase()]={plugin:M,isBinary:A[S].isBinary,mimeType:A[S].mimeType}}}async function C(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c.d.LastCreatedScene,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",T=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!S)return j.c.Error("No scene available to import mesh to"),null;const J=E(A,O);if(!J)return null;const K={};S.addPendingData(K);const G=()=>{S.removePendingData(K)},d=(M,A)=>{const O=s(J,M,A);X?X(S,O,new e.i(O,e.e.SceneLoaderError,A)):j.c.Error(O),G()},w=Q?M=>{try{Q(M)}catch(A){d("Error in onProgress callback: "+A,A)}}:void 0,I=(M,A,O,Q,X,c,j,B)=>{if(S.importedMeshesFiles.push(J.url),z)try{z(M,A,O,Q,X,c,j,B)}catch(g){d("Error in onSuccess callback: "+g,g)}S.removePendingData(K)};return await Y(J,S,((A,O,z)=>{if(A.rewriteRootURL&&(J.rootUrl=A.rewriteRootURL(J.rootUrl,z)),A.importMesh){const z=[],Q=[],X=[];if(!A.importMesh(M,S,O,J.rootUrl,z,Q,X,d))return;S.loadingPluginName=A.name,I(z,Q,X,[],[],[],[],[])}else{A.importMeshAsync(M,S,O,J.rootUrl,w,J.name).then((M=>{S.loadingPluginName=A.name,I(M.meshes,M.TJ,M.skeletons,M.animationGroups,M.transformNodes,M.geometries,M.lights,M.spriteManagers)})).catch((M=>{d(M.message,M)}))}}),w,d,G,B,g,T)}async function f(M,A,O,S,z,Q,X,c){return await new Promise(((j,B)=>{try{C(M,A,O,S,((M,A,O,S,z,Q,X,c)=>{j({meshes:M,TJ:A,skeletons:O,animationGroups:S,transformNodes:z,geometries:Q,lights:X,spriteManagers:c})}),z,((M,A,O)=>{B(O||new Error(A))}),Q,X,c).catch(B)}catch(e){B(e)}}))}async function D(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.d.LastCreatedEngine,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};O?await N(M,A,new X.b(O),S,Q,j,B,g,e):z.Tools.Error("No engine available")}async function F(M,A,O,S,z,Q,X){return await new Promise(((c,j)=>{D(M,A,O,(M=>{c(M)}),S,((M,A,O)=>{j(O||new Error(A))}),z,Q,X)}))}async function N(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.d.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",T=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!O)return j.c.Error("No scene available to append to"),null;const J=E(M,A);if(!J)return null;const K={};O.addPendingData(K);const G=()=>{O.removePendingData(K)};B.b.ShowLoadingScreen&&!w&&(w=!0,O.getEngine().displayLoadingUI(),O.executeWhenReady((()=>{O.getEngine().hideLoadingUI(),w=!1})));const d=(M,A)=>{const S=s(J,M,A);Q?Q(O,S,new e.i(S,e.e.SceneLoaderError,A)):j.c.Error(S),G()},I=z?M=>{try{z(M)}catch(A){d("Error in onProgress callback",A)}}:void 0,b=()=>{if(S)try{S(O)}catch(M){d("Error in onSuccess callback",M)}O.removePendingData(K)};return await Y(J,O,((M,A)=>{if(M.load){if(!M.load(O,A,J.rootUrl,d))return;O.loadingPluginName=M.name,b()}else{M.loadAsync(O,A,J.rootUrl,I,J.name).then((()=>{O.loadingPluginName=M.name,b()})).catch((M=>{d(M.message,M)}))}}),I,d,G,X,g,T)}async function y(M,A,O,S,z,Q,X){return await new Promise(((c,j)=>{try{N(M,A,O,(M=>{c(M)}),S,((M,A,O)=>{j(O||new Error(A))}),z,Q,X).catch(j)}catch(e){j(e)}}))}async function h(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.d.LastCreatedScene,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!O)return j.c.Error("No scene available to load asset container to"),null;const T=E(M,A);if(!T)return null;const J={};O.addPendingData(J);const K=()=>{O.removePendingData(J)},G=(M,A)=>{const S=s(T,M,A);Q?Q(O,S,new e.i(S,e.e.SceneLoaderError,A)):j.c.Error(S),K()},d=z?M=>{try{z(M)}catch(A){G("Error in onProgress callback",A)}}:void 0,w=M=>{if(S)try{S(M)}catch(A){G("Error in onSuccess callback",A)}O.removePendingData(J)};return await Y(T,O,((M,A)=>{if(M.loadAssetContainer){const S=M.loadAssetContainer(O,A,T.rootUrl,G);if(!S)return;S.populateRootNodes(),O.loadingPluginName=M.name,w(S)}else if(M.loadAssetContainerAsync){M.loadAssetContainerAsync(O,A,T.rootUrl,d,T.name).then((A=>{A.populateRootNodes(),O.loadingPluginName=M.name,w(A)})).catch((M=>{G(M.message,M)}))}else G("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),d,G,K,X,B,g)}async function u(M,A,O,S,z,Q,X){return await new Promise(((c,j)=>{try{h(M,A,O,(M=>{c(M)}),S,((M,A,O)=>{j(O||new Error(A))}),z,Q,X).catch(j)}catch(e){j(e)}}))}async function i(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.d.LastCreatedScene,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!O)return void j.c.Error("No scene available to load animations to");if(S){for(const S of O.animatables)S.reset();O.stopAllAnimations();const M=O.animationGroups.slice();for(const O of M)O.dispose();const A=O.getNodes();for(const O of A)O.animations&&(O.animations=[])}else switch(z){case 0:const M=O.animationGroups.slice();for(const A of M)A.dispose();break;case 1:for(const A of O.animationGroups)A.stop();break;case 2:for(const A of O.animationGroups)A.reset(),A.restart();break;case 3:break;default:return void j.c.Error("Unknown animation group loading mode value '"+z+"'")}const K=O.animatables.length;await h(M,A,O,(M=>{M.mergeAnimationsTo(O,O.animatables.slice(K),Q),M.dispose(),O.onAnimationFileImportedObservable.notifyObservers(O),X&&X(O)}),B,g,e,T,J)}async function U(M,A,O,S,z,Q,X,c,j,B){return await new Promise(((g,T)=>{try{i(M,A,O,S,z,Q,(M=>{g(M)}),X,((M,A,O)=>{T(O||new Error(A))}),c,j,B).catch(T)}catch(e){T(e)}}))}class L{static get ForceFullSceneLoadingForIncremental(){return B.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(M){B.b.ForceFullSceneLoadingForIncremental=M}static get ShowLoadingScreen(){return B.b.ShowLoadingScreen}static set ShowLoadingScreen(M){B.b.ShowLoadingScreen=M}static get loggingLevel(){return B.b.loggingLevel}static set loggingLevel(M){B.b.loggingLevel=M}static get CleanBoneMatrixWeights(){return B.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(M){B.b.CleanBoneMatrixWeights=M}static GetDefaultPlugin(){return I()}static GetPluginForExtension(M){var A;return null===(A=b(M,!0))||void 0===A?void 0:A.plugin}static IsPluginForExtensionAvailable(M){return function(M){return!!d[M]}(M)}static RegisterPlugin(M){H(M)}static ImportMesh(M,A,O,S,z,Q,X,j,B){C(M,A,O,S,z,Q,X,j,B).catch((M=>null===X||void 0===X?void 0:X(c.d.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportMeshAsync(M,A,O,S,z,Q,X){return await f(M,A,O,S,z,Q,X)}static Load(M,A,O,S,z,Q,X,j){D(M,A,O,S,z,Q,X,j).catch((M=>null===Q||void 0===Q?void 0:Q(c.d.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAsync(M,A,O,S,z,Q){return await F(M,A,O,S,z,Q)}static Append(M,A,O,S,z,Q,X,j){N(M,A,O,S,z,Q,X,j).catch((M=>null===Q||void 0===Q?void 0:Q(null!==O&&void 0!==O?O:c.d.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async AppendAsync(M,A,O,S,z,Q){return await y(M,A,O,S,z,Q)}static LoadAssetContainer(M,A,O,S,z,Q,X,j){h(M,A,O,S,z,Q,X,j).catch((M=>null===Q||void 0===Q?void 0:Q(null!==O&&void 0!==O?O:c.d.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async LoadAssetContainerAsync(M,A,O,S,z,Q){return await u(M,A,O,S,z,Q)}static ImportAnimations(M,A,O,S,z,Q,X,j,B,g,e){i(M,A,O,S,z,Q,X,j,B,g,e).catch((M=>null===B||void 0===B?void 0:B(null!==O&&void 0!==O?O:c.d.LastCreatedScene,null===M||void 0===M?void 0:M.message,M)))}static async ImportAnimationsAsync(M,A,O,S,z,Q,X,c,j,B,g){return await U(M,A,O,S,z,Q,c,B,g)}}L.NO_LOGGING=0,L.MINIMAL_LOGGING=1,L.SUMMARY_LOGGING=2,L.DETAILED_LOGGING=3,L.OnPluginActivatedObservable=G},14197:(M,A,O)=>{"use strict";O.d(A,{b:()=>T});var S=O(12958),z=O(12964),Q=O(12768),X=O(12970),c=O(12986),j=O(12949),B=O(12919),g=O(12776),e=O(12998);O(14203);class T extends c.d{set boundingBoxSize(M){if(this._boundingBoxSize&&this._boundingBoxSize.equals(M))return;this._boundingBoxSize=M;const A=this.HM();A&&A.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(M){this._rotationY=M,this.setReflectionTextureMatrix(X.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(M,A,O){let S="";for(const z of M)S+=z;return new T(S,A,null,O,M)}static CreateFromPrefilteredData(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=A.useDelayedTextureLoading;A.useDelayedTextureLoading=!1;const Q=new T(M,A,null,!1,null,null,null,void 0,!0,O,S);return A.useDelayedTextureLoading=z,Q}constructor(M,A){var O;let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,T=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]&&arguments[10],G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0;super(A),this.onLoadObservable=new g.c,this.boundingBoxPosition=X.GA.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new X.Matrix,this._buffer=null,this.name=M,this.url=M,this._noMipmap=z,this.ec=!1,this.isCube=!0,this._textureMatrix=X.Matrix.Identity(),this.coordinatesMode=j.c.CUBIC_MODE;let b=null,s=null;var Y,E,H,C,f,D,F,N,y,h,u,i;null===S||Array.isArray(S)?(this._noMipmap=z,this._format=e,this._createPolynomials=K,b=S,this._loaderOptions=w,this._useSRGBBuffer=I,this._lodScale=G,this._lodOffset=d):(b=null!==(Y=S.extensions)&&void 0!==Y?Y:null,this._noMipmap=null!==(E=S.noMipmap)&&void 0!==E&&E,Q=null!==(H=S.files)&&void 0!==H?H:null,s=null!==(C=S.buffer)&&void 0!==C?C:null,this._format=null!==(f=S.format)&&void 0!==f?f:5,T=null!==(D=S.prefiltered)&&void 0!==D&&D,J=null!==(F=S.forcedExtension)&&void 0!==F?F:null,this._createPolynomials=null!==(N=S.createPolynomials)&&void 0!==N&&N,this._lodScale=null!==(y=S.lodScale)&&void 0!==y?y:.8,this._lodOffset=null!==(h=S.lodOffset)&&void 0!==h?h:0,this._loaderOptions=S.loaderOptions,this._useSRGBBuffer=S.useSRGBBuffer,c=null!==(u=S.R)&&void 0!==u?u:null,B=null!==(i=S.onError)&&void 0!==i?i:null);(M||Q)&&this.updateURL(M,J,c,T,B,b,null===(O=this.HM())||void 0===O?void 0:O.useDelayedTextureLoading,Q,s)}getClassName(){return"CubeTexture"}updateURL(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=M),this.url=M,A&&(this._forcedExtension=A);const B=M.lastIndexOf("."),g=A||(B>-1?M.substring(B).toLowerCase():""),e=0===g.indexOf(".dds"),T=0===g.indexOf(".env"),J=0===g.indexOf(".basis");if(T?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=S,S&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),c)this._files=c;else if(J||T||e||Q||(Q=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Q){for(let A=0;A<Q.length;A++)this._files.push(M+Q[A]);this._extensions=Q}this._buffer=j,X?(this.delayLoadState=4,this._delayedOnLoad=O,this._delayedOnError=z):this._loadTexture(O,z)}delayLoad(M){4===this.delayLoadState&&(M&&(this._forcedExtension=M),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(M){var A,O;if(M.updateFlag===this._textureMatrix.updateFlag)return;M.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(O=this.HM())||void 0===O||O.markAllMaterialsAsDirty(1,(M=>-1!==M.getActiveTextures().indexOf(this))));if(this._textureMatrix=M,null===(A=this.HM())||void 0===A||!A.useRightHandedSystem)return;const S=X.TmpVectors.GA[0],z=X.TmpVectors.Quaternion[0],Q=X.TmpVectors.GA[1];this._textureMatrix.decompose(S,z,Q),z.z*=-1,z.w*=-1,X.Matrix.ComposeToRef(S,z,Q,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var M;return null!==(M=this.HM())&&void 0!==M&&M.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=this.HM(),S=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const z=()=>{var A;(this.onLoadObservable.notifyObservers(this),S)&&(S.dispose(),null===(A=this.HM())||void 0===A||A.markAllMaterialsAsDirty(1));M&&M()},X=(M,O)=>{this._loadingError=!0,this._errorObject={message:M,exception:O},A&&A(M,O),j.c.OnTextureLoadErrorObservable.notifyObservers(this)};var c;this._texture?this._texture.isReady?Q.Tools.SetImmediate((()=>z())):this._texture.onLoadedObservable.add((()=>z())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,O,this._lodScale,this._lodOffset,M,X,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,O,this._files,this._noMipmap,M,X,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(c=this._texture)||void 0===c||c.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(M,A,O){const S=e.e.Parse((()=>{var S;let z=!1;return M.prefiltered&&(z=M.prefiltered),new T(O+(null!==(S=M.url)&&void 0!==S?S:M.name),A,M.extensions,!1,M.files||null,null,null,void 0,z,M.forcedExtension)}),M,A);if(M.boundingBoxPosition&&(S.boundingBoxPosition=X.GA.sA(M.boundingBoxPosition)),M.boundingBoxSize&&(S.boundingBoxSize=X.GA.sA(M.boundingBoxSize)),M.animations)for(let z=0;z<M.animations.length;z++){const A=M.animations[z],O=(0,B.c)("BABYLON.Animation");O&&S.animations.push(O.Parse(A))}return S}clone(){let M=0;const A=e.e.Clone((()=>{const A=new T(this.url,this.HM()||this._getEngine(),this._extensions,this._noMipmap,this._files);return M=A.uniqueId,A}),this);return A.uniqueId=M,A}}(0,S.d)([(0,z.H)()],T.prototype,"url",void 0),(0,S.d)([(0,z.D)()],T.prototype,"boundingBoxPosition",void 0),(0,S.d)([(0,z.D)()],T.prototype,"boundingBoxSize",null),(0,S.d)([(0,z.H)("rotationY")],T.prototype,"rotationY",null),(0,S.d)([(0,z.H)("files")],T.prototype,"_files",void 0),(0,S.d)([(0,z.H)("forcedExtension")],T.prototype,"_forcedExtension",void 0),(0,S.d)([(0,z.H)("extensions")],T.prototype,"_extensions",void 0),(0,S.d)([(0,z.q)("textureMatrix")],T.prototype,"_textureMatrix",void 0),(0,S.d)([(0,z.q)("textureMatrixRefraction")],T.prototype,"_textureMatrixRefraction",void 0),j.c._CubeTextureParser=T.Parse,(0,B.g)("BABYLON.CubeTexture",T)},14775:(M,A,O)=>{"use strict";O.d(A,{c:()=>j});var S=O(12783),z=O(12949),Q=O(12931),X=O(13119),c=O(12888);X.ThinEngine.prototype.createDynamicTexture=function(M,A,O,S){const z=new c.b(this,4);return z.baseWidth=M,z.baseHeight=A,O&&(M=this.needPOTTextures?(0,Q.g)(M,this._caps.maxTextureSize):M,A=this.needPOTTextures?(0,Q.g)(A,this._caps.maxTextureSize):A),z.width=M,z.height=A,z.isReady=!1,z.generateMipMaps=O,z.samplingMode=S,this.updateTextureSamplingMode(S,z),this._internalTexturesCache.push(z),z},X.ThinEngine.prototype.updateDynamicTexture=function(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!M)return;const X=this._gl,c=X.TEXTURE_2D,j=this._bindTextureDirectly(c,M,!0,Q);this._unpackFlipY(void 0===O?M.invertY:O),S&&X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const B=this._getWebGLTextureType(M.type),g=this._getInternalFormat(z||M.format),e=this._getRGBABufferInternalSizedFormat(M.type,g);X.texImage2D(c,0,e,g,B,A),M.generateMipMaps&&X.generateMipmap(c),j||this._bindTextureDirectly(c,null),S&&X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),z&&(M.format=z),M._dynamicTextureSource=A,M._premulAlpha=S,M.invertY=O||!1,M.isReady=!0};class j extends z.c{constructor(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,c=arguments.length>6?arguments[6]:void 0;const j=!O||O._isScene;super(null,j?O:null===O||void 0===O?void 0:O.wA,j?!S:O,c,Q,void 0,void 0,void 0,void 0,X),this.name=M,this.wrapU=z.c.CLAMP_ADDRESSMODE,this.wrapV=z.c.CLAMP_ADDRESSMODE,this._generateMipMaps=S;const B=this._getEngine();if(!B)return;if(A.getContext)this._canvas=A,this._ownCanvas=!1,this._texture=B.createDynamicTexture(this._canvas.width,this._canvas.height,S,Q);else{this._canvas=B.createCanvas(1,1),this._ownCanvas=!0;const M=A;M.width||0===M.width?this._texture=B.createDynamicTexture(M.width,M.height,S,Q):this._texture=B.createDynamicTexture(A,A,S,Q)}const g=this.getSize();this._canvas.width!==g.width&&(this._canvas.width=g.width),this._canvas.height!==g.height&&(this._canvas.height=g.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(M){this._canvas.width=M.width,this._canvas.height=M.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(M.width,M.height,this._generateMipMaps,this.samplingMode)}scale(M){const A=this.getSize();A.width*=M,A.height*=M,this._recreate(A)}scaleTo(M,A){const O=this.getSize();O.width=M,O.height=A,this._recreate(O)}getContext(){return this._context}clear(M){const A=this.getSize();M&&(this._context.fillStyle=M),this._context.clearRect(0,0,A.width,A.height)}update(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===M||M,A,this._format||void 0,void 0,O)}drawText(M,A,O,S,z,Q,X){let c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const j=this.getSize();if(Q&&(this._context.fillStyle=Q,this._context.fillRect(0,0,j.width,j.height)),this._context.font=S,null===A||void 0===A){const O=this._context.measureText(M);A=(j.width-O.width)/2}if(null===O||void 0===O){const M=parseInt(S.replace(/\D/g,""));O=j.height/2+M/3.65}this._context.fillStyle=z||"",this._context.fillText(M,A,O),c&&this.update(X)}dispose(){var M,A;(super.dispose(),this._ownCanvas)&&(null===(M=this._canvas)||void 0===M||null===(A=M.remove)||void 0===A||A.call(M));this._canvas=null,this._context=null}clone(){const M=this.HM();if(!M)return this;const A=this.getSize(),O=new j(this.name,A,M,this._generateMipMaps);return O.ec=this.ec,O.level=this.level,O.wrapU=this.wrapU,O.wrapV=this.wrapV,O}serialize(){const M=this.HM();M&&!M.isReady()&&S.c.Warn("The scene must be ready before serializing the dynamic texture");const A=super.serialize();return j._IsCanvasElement(this._canvas)&&(A.base64String=this._canvas.toDataURL()),A.invertY=this._invertY,A.samplingMode=this.samplingMode,A}static _IsCanvasElement(M){return void 0!==M.toDataURL}_rebuild(){this.update()}}},14126:(M,A,O)=>{"use strict";O.d(A,{b:()=>z});var S=O(12949);class z extends S.c{get depth(){return this._depth}constructor(M,A,O,z,Q,X){let c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:S.c.TRILINEAR_SAMPLINGMODE,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,e=arguments.length>10?arguments[10]:void 0;super(null,X,!c,j),this.format=Q,this._texture=X.getEngine().createRawTexture2DArray(M,A,O,z,Q,c,j,B,null,g,e),this._depth=z,this.is2DArray=!0}update(M){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,M,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(M,A,O,S,Q){return new z(M,A,O,S,5,Q,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13949:(M,A,O)=>{"use strict";O.d(A,{e:()=>c,f:()=>j,j:()=>Q,m:()=>X});var S=O(12980),z=O(12970);function Q(M,A){return"{X: ".concat(M.x.toFixed(A)," Y: ").concat(M.y.toFixed(A),"}")}function X(M,A){return"{X: ".concat(M._x.toFixed(A)," Y: ").concat(M._y.toFixed(A)," Z: ").concat(M._z.toFixed(A),"}")}function c(M,A){return 2*Math.acos((0,S.Clamp)(z.Quaternion.Dot(M,A)))}function j(M,A){const O=new z.Quaternion;return function(M,A,O){const Q=z.GA.Cross(M,A),X=Math.acos((0,S.Clamp)(z.GA.Dot(M,A),-1,1));z.Quaternion.RotationAxisToRef(Q,X,O)}(M,A,O),O}},13794:(M,A,O)=>{"use strict";O.d(A,{e:()=>B});var S=O(12970),z=O(13010),Q=O(13422),X=O(13405),c=O(13025);O(13798);function j(M){let A=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const O=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Q=[];let j=[];const B=M.width||M.size||1,g=M.height||M.size||1,e=M.depth||M.size||1,T=M.wrap||!1;let J=void 0===M.topBaseAt?1:M.topBaseAt,K=void 0===M.bottomBaseAt?0:M.bottomBaseAt;J=(J+4)%4,K=(K+4)%4;let G=[2,0,3,1][J],d=[2,0,1,3][K],w=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(T){A=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],w=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let M=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],O=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const S=[17,18,19,16],z=[22,23,20,21];for(;G>0;)M.unshift(M.pop()),S.unshift(S.pop()),G--;for(;d>0;)O.unshift(O.pop()),z.unshift(z.pop()),d--;M=M.flat(),O=O.flat(),w=w.concat(M).concat(O),A.push(S[0],S[2],S[3],S[0],S[1],S[2]),A.push(z[0],z[2],z[3],z[0],z[1],z[2])}const I=[B/2,g/2,e/2];j=w.reduce(((M,A,O)=>M.concat(A*I[O%3])),[]);const b=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,s=M.faceUV||new Array(6),Y=M.faceColors,E=[];for(let X=0;X<6;X++)void 0===s[X]&&(s[X]=new S.Vector4(0,0,1,1)),Y&&void 0===Y[X]&&(Y[X]=new z.Cc(1,1,1,1));for(let S=0;S<6;S++)if(Q.push(s[S].z,c.d?1-s[S].w:s[S].w),Q.push(s[S].x,c.d?1-s[S].w:s[S].w),Q.push(s[S].x,c.d?1-s[S].y:s[S].y),Q.push(s[S].z,c.d?1-s[S].y:s[S].y),Y)for(let M=0;M<4;M++)E.push(Y[S].r,Y[S].g,Y[S].b,Y[S].a);X.e._ComputeSides(b,j,A,O,Q,M.frontUVs,M.backUVs);const H=new X.e;if(H.indices=A,H.fM=j,H.DM=O,H.NM=Q,Y){const M=b===X.e.DOUBLESIDE?E.concat(E):E;H.FM=M}return H}function B(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Q.d(M,O);A.sideOrientation=Q.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return j(A).hM(S,A.updatable),S}X.e.CreateBox=j,Q.d.CreateBox=function(M,A){return B(M,{size:A,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13938:(M,A,O)=>{"use strict";O.d(A,{b:()=>c});var S=O(13422),z=O(13405),Q=O(13025);function X(M){const A=[],O=[],S=[],X=[],c=M.radius||.5,j=M.tessellation||64,B=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,g=0===M.sideOrientation?0:M.sideOrientation||z.e.DEFAULTSIDE;A.push(0,0,0),X.push(.5,.5);const e=2*Math.PI*B,T=1===B?e/j:e/(j-1);let J=0;for(let z=0;z<j;z++){const M=Math.cos(J),O=Math.sin(J),S=(M+1)/2,z=(1-O)/2;A.push(c*M,c*O,0),X.push(S,Q.d?1-z:z),J+=T}1===B&&(A.push(A[3],A[4],A[5]),X.push(X[2],Q.d?1-X[3]:X[3]));const K=A.length/3;for(let z=1;z<K-1;z++)O.push(z+1,0,z);z.e.ComputeNormals(A,O,S),z.e._ComputeSides(g,A,O,S,X,M.frontUVs,M.backUVs);const G=new z.e;return G.indices=O,G.fM=A,G.DM=S,G.NM=X,G}function c(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new S.d(M,O);A.sideOrientation=S.d._GetDefaultSideOrientation(A.sideOrientation),z._originalBuilderSideOrientation=A.sideOrientation;return X(A).hM(z,A.updatable),z}z.e.CreateDisc=X,S.d.CreateDisc=function(M,A,O){return c(M,{radius:A,tessellation:O,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13798:(M,A,O)=>{"use strict";O.d(A,{i:()=>d,e:()=>I,l:()=>w});var S=O(12970),z=O(13010),Q=O(13422),X=O(13405),c=O(13043);Q.d._GroundMeshParser=(M,A)=>j.Parse(M,A);class j extends Q.d{constructor(M,A){super(M,A),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=M,this._subdivisionsY=M,this.subdivide(M);const O=this;O.createOrUpdateSubmeshesOctree&&O.createOrUpdateSubmeshesOctree(A)}getHeightAtCoordinates(M,A){const O=this.getWorldMatrix(),z=S.TmpVectors.Matrix[5];O.invertToRef(z);const Q=S.TmpVectors.GA[8];if(S.GA.TransformCoordinatesFromFloatsToRef(M,0,A,z,Q),M=Q.x,A=Q.z,M<this._minX||M>=this._maxX||A<=this._minZ||A>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(M,A),c=-(X.x*M+X.z*A+X.w)/X.y;return S.GA.TransformCoordinatesFromFloatsToRef(0,c,0,O,Q),Q.y}getNormalAtCoordinates(M,A){const O=new S.GA(0,1,0);return this.getNormalAtCoordinatesToRef(M,A,O),O}getNormalAtCoordinatesToRef(M,A,O){const z=this.getWorldMatrix(),Q=S.TmpVectors.Matrix[5];z.invertToRef(Q);const X=S.TmpVectors.GA[8];if(S.GA.TransformCoordinatesFromFloatsToRef(M,0,A,Q,X),M=X.x,A=X.z,M<this._minX||M>this._maxX||A<this._minZ||A>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const c=this._getFacetAt(M,A);return S.GA.TransformNormalFromFloatsToRef(c.x,c.y,c.z,z,O),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(M,A){const O=Math.floor((M+this._maxX)*this._subdivisionsX/this._width),S=Math.floor(-(A+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),z=this._heightQuads[S*this._subdivisionsX+O];let Q;return Q=A<z.slope.x*M+z.slope.y?z.facet1:z.facet2,Q}_initHeightQuads(){const M=this._subdivisionsX,A=this._subdivisionsY;this._heightQuads=[];for(let O=0;O<A;O++)for(let A=0;A<M;A++){const z={slope:S.Vector2.Zero(),facet1:new S.Vector4(0,0,0,0),facet2:new S.Vector4(0,0,0,0)};this._heightQuads[O*M+A]=z}return this}_computeHeightQuads(){const M=this.getVerticesData(c.c.PositionKind);if(!M)return this;const A=S.TmpVectors.GA[3],O=S.TmpVectors.GA[2],z=S.TmpVectors.GA[1],Q=S.TmpVectors.GA[0],X=S.TmpVectors.GA[4],j=S.TmpVectors.GA[5],B=S.TmpVectors.GA[6],g=S.TmpVectors.GA[7],e=S.TmpVectors.GA[8];let T=0,J=0,K=0,G=0,d=0,w=0,I=0;const b=this._subdivisionsX,s=this._subdivisionsY;for(let c=0;c<s;c++)for(let s=0;s<b;s++){T=3*s,J=c*(b+1)*3,K=(c+1)*(b+1)*3,A.x=M[J+T],A.y=M[J+T+1],A.z=M[J+T+2],O.x=M[J+T+3],O.y=M[J+T+4],O.z=M[J+T+5],z.x=M[K+T],z.y=M[K+T+1],z.z=M[K+T+2],Q.x=M[K+T+3],Q.y=M[K+T+4],Q.z=M[K+T+5],G=(Q.z-A.z)/(Q.x-A.x),d=A.z-G*A.x,O.subtractToRef(A,X),z.subtractToRef(A,j),Q.subtractToRef(A,B),S.GA.CrossToRef(B,j,g),S.GA.CrossToRef(X,B,e),g.normalize(),e.normalize(),w=-(g.x*A.x+g.y*A.y+g.z*A.z),I=-(e.x*O.x+e.y*O.y+e.z*O.z);const Y=this._heightQuads[c*b+s];Y.slope.Yc(G,d),Y.facet1.Yc(g.x,g.y,g.z,w),Y.facet2.Yc(e.x,e.y,e.z,I)}return this}serialize(M){super.serialize(M),M.subdivisionsX=this._subdivisionsX,M.subdivisionsY=this._subdivisionsY,M.minX=this._minX,M.maxX=this._maxX,M.Tc=this._minZ,M.maxZ=this._maxZ,M.width=this._width,M.height=this._height}static Parse(M,A){const O=new j(M.name,A);return O._subdivisionsX=M.subdivisionsX||1,O._subdivisionsY=M.subdivisionsY||1,O._minX=M.minX,O._maxX=M.maxX,O._minZ=M.Tc,O._maxZ=M.maxZ,O._width=M.width,O._height=M.height,O}}var B=O(12768),g=O(12811),e=O(12974),T=O(13025);function J(M){const A=[],O=[],z=[],Q=[];let c,j;const B=M.width||M.size||1,g=M.height||M.size||1,e=0|(M.subdivisionsX||M.subdivisions||1),J=0|(M.subdivisionsY||M.subdivisions||1);for(c=0;c<=J;c++)for(j=0;j<=e;j++){const M=new S.GA(j*B/e-B/2,0,(J-c)*g/J-g/2),A=new S.GA(0,1,0);O.push(M.x,M.y,M.z),z.push(A.x,A.y,A.z),Q.push(j/e,T.d?c/J:1-c/J)}for(c=0;c<J;c++)for(j=0;j<e;j++)A.push(j+1+(c+1)*(e+1)),A.push(j+1+c*(e+1)),A.push(j+c*(e+1)),A.push(j+(c+1)*(e+1)),A.push(j+1+(c+1)*(e+1)),A.push(j+c*(e+1));const K=new X.e;return K.indices=A,K.fM=O,K.DM=z,K.NM=Q,K}function K(M){const A=void 0!==M.xmin&&null!==M.xmin?M.xmin:-1,O=void 0!==M.zmin&&null!==M.zmin?M.zmin:-1,z=void 0!==M.xmax&&null!==M.xmax?M.xmax:1,Q=void 0!==M.zmax&&null!==M.zmax?M.zmax:1,c=M.subdivisions||{w:1,h:1},j=M.precision||{w:1,h:1},B=[],g=[],e=[],T=[];let J,K,G,d;c.h=c.h<1?1:c.h,c.w=c.w<1?1:c.w,j.w=j.w<1?1:j.w,j.h=j.h<1?1:j.h;const w=(z-A)/c.w,I=(Q-O)/c.h;function b(M,A,O,z){const Q=g.length/3,X=j.w+1;for(J=0;J<j.h;J++)for(K=0;K<j.w;K++){const M=[Q+K+J*X,Q+(K+1)+J*X,Q+(K+1)+(J+1)*X,Q+K+(J+1)*X];B.push(M[1]),B.push(M[2]),B.push(M[3]),B.push(M[0]),B.push(M[1]),B.push(M[3])}const c=S.GA.Zero(),G=new S.GA(0,1,0);for(J=0;J<=j.h;J++)for(c.z=J*(z-A)/j.h+A,K=0;K<=j.w;K++)c.x=K*(O-M)/j.w+M,c.y=0,g.push(c.x,c.y,c.z),e.push(G.x,G.y,G.z),T.push(K/j.w,J/j.h)}for(G=0;G<c.h;G++)for(d=0;d<c.w;d++)b(A+d*w,O+G*I,A+(d+1)*w,O+(G+1)*I);const s=new X.e;return s.indices=B,s.fM=g,s.DM=e,s.NM=T,s}function G(M){const A=[],O=[],Q=[],c=[];let j,B;const g=M.colorFilter||new z.bA(.3,.59,.11),T=M.alphaFilter||0;let J=!1;if(M.minHeight>M.maxHeight){J=!0;const A=M.maxHeight;M.maxHeight=M.minHeight,M.minHeight=A}for(j=0;j<=M.subdivisions;j++)for(B=0;B<=M.subdivisions;B++){const A=new S.GA(B*M.width/M.subdivisions-M.width/2,0,(M.subdivisions-j)*M.height/M.subdivisions-M.height/2),z=4*(((A.x+M.width/2)/M.width*(M.bufferWidth-1)|0)+((1-(A.z+M.height/2)/M.height)*(M.bufferHeight-1)|0)*M.bufferWidth);let X=M.buffer[z]/255,K=M.buffer[z+1]/255,G=M.buffer[z+2]/255;const d=M.buffer[z+3]/255;J&&(X=1-X,K=1-K,G=1-G);const w=X*g.r+K*g.g+G*g.b;A.y=d>=T?M.minHeight+(M.maxHeight-M.minHeight)*w:M.minHeight-e.e,M.heightBuffer&&(M.heightBuffer[j*(M.subdivisions+1)+B]=A.y),O.push(A.x,A.y,A.z),Q.push(0,0,0),c.push(B/M.subdivisions,1-j/M.subdivisions)}for(j=0;j<M.subdivisions;j++)for(B=0;B<M.subdivisions;B++){const S=B+1+(j+1)*(M.subdivisions+1),z=B+1+j*(M.subdivisions+1),Q=B+j*(M.subdivisions+1),X=B+(j+1)*(M.subdivisions+1),c=O[3*S+1]>=M.minHeight,g=O[3*z+1]>=M.minHeight,e=O[3*Q+1]>=M.minHeight;c&&g&&e&&(A.push(S),A.push(z),A.push(Q));O[3*X+1]>=M.minHeight&&c&&e&&(A.push(X),A.push(S),A.push(Q))}X.e.ComputeNormals(O,A,Q);const K=new X.e;return K.indices=A,K.fM=O,K.DM=Q,K.NM=c,K}function d(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const O=new j(M,arguments.length>2?arguments[2]:void 0);O._setReady(!1),O._subdivisionsX=A.subdivisionsX||A.subdivisions||1,O._subdivisionsY=A.subdivisionsY||A.subdivisions||1,O._width=A.width||1,O._height=A.height||1,O._maxX=O._width/2,O._maxZ=O._height/2,O._minX=-O._maxX,O._minZ=-O._maxZ;return J(A).hM(O,A.updatable),O._setReady(!0),O}function w(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new Q.d(M,O);return K(A).hM(S,A.updatable),S}function I(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=O.width||10,X=O.height||10,c=O.subdivisions||1,e=O.minHeight||0,T=O.maxHeight||1,J=O.colorFilter||new z.bA(.3,.59,.11),K=O.alphaFilter||0,d=O.updatable,w=O.onReady;S=S||g.d.LastCreatedScene;const I=new j(M,S);let b;I._subdivisionsX=c,I._subdivisionsY=c,I._width=Q,I._height=X,I._maxX=I._width/2,I._maxZ=I._height/2,I._minX=-I._maxX,I._minZ=-I._maxZ,I._setReady(!1),O.passHeightBufferInCallback&&(b=new Float32Array((c+1)*(c+1)));const s=(M,A,O)=>{G({width:Q,height:X,subdivisions:c,minHeight:e,maxHeight:T,colorFilter:J,buffer:M,bufferWidth:A,bufferHeight:O,alphaFilter:K,heightBuffer:b}).hM(I,d),w&&w(I,b),I._setReady(!0)};if("string"===typeof A){const M=M=>{var A;const O=M.width,z=M.height;if(S.T)return;const Q=null===(A=S)||void 0===A?void 0:A.getEngine().resizeImageBitmap(M,O,z);s(Q,O,z)};B.Tools.LoadImage(A,M,O.onError?O.onError:()=>{},S.offlineProvider)}else s(A.data,A.width,A.height);return I}X.e.CreateGround=J,X.e.CreateTiledGround=K,X.e.CreateGroundFromHeightMap=G,Q.d.CreateGround=(M,A,O,S,z,Q)=>d(M,{width:A,height:O,subdivisions:S,updatable:Q},z),Q.d.CreateTiledGround=(M,A,O,S,z,Q,X,c,j)=>w(M,{xmin:A,zmin:O,xmax:S,zmax:z,subdivisions:Q,precision:X,updatable:j},c),Q.d.CreateGroundFromHeightMap=(M,A,O,S,z,Q,X,c,j,B,g)=>I(M,A,{width:O,height:S,subdivisions:z,minHeight:Q,maxHeight:X,updatable:j,onReady:B,alphaFilter:g},c)},14348:(M,A,O)=>{"use strict";O.d(A,{c:()=>J,f:()=>e,i:()=>T});var S=O(12970),z=O(13422),Q=O(13405),X=O(13526),c=O(13043),j=O(12783);function B(M){const A=[],O=[],S=M.lines,z=M.FM,X=[];let c=0;for(let Q=0;Q<S.length;Q++){const M=S[Q];for(let S=0;S<M.length;S++){const{x:j,y:B,z:g}=M[S];if(O.push(j,B,g),z){const M=z[Q],{r:A,g:O,b:c,a:j}=M[S];X.push(A,O,c,j)}S>0&&(A.push(c-1),A.push(c)),c++}}const j=new Q.e;return j.indices=A,j.fM=O,z&&(j.FM=X),j}function g(M){const A=M.dashSize||3,O=M.gapSize||1,z=M.dashNb||200,X=M.points,c=[],j=[],B=S.GA.Zero();let g=0,e=0,T=0,J=0,K=0,G=0,d=0;for(d=0;d<X.length-1;d++)X[d+1].subtractToRef(X[d],B),g+=B.length();for(T=g/z,J=A*T/(A+O),d=0;d<X.length-1;d++){X[d+1].subtractToRef(X[d],B),e=Math.floor(B.length()/T),B.normalize();for(let M=0;M<e;M++)K=T*M,c.push(X[d].x+K*B.x,X[d].y+K*B.y,X[d].z+K*B.z),c.push(X[d].x+(K+J)*B.x,X[d].y+(K+J)*B.y,X[d].z+(K+J)*B.z),j.push(G,G+1),G+=2}const w=new Q.e;return w.fM=c,w.indices=j,w}function e(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=A.instance,z=A.lines,Q=A.FM;if(S){const M=S.getVerticesData(c.c.PositionKind);let A,O;Q&&(A=S.getVerticesData(c.c.ColorKind));let X=0,j=0;for(let S=0;S<z.length;S++){const c=z[S];for(let z=0;z<c.length;z++)M[X]=c[z].x,M[X+1]=c[z].y,M[X+2]=c[z].z,Q&&A&&(O=Q[S],A[j]=O[z].r,A[j+1]=O[z].g,A[j+2]=O[z].b,A[j+3]=O[z].a,j+=4),X+=3}return S.updateVerticesData(c.c.PositionKind,M,!1,!1),Q&&A&&S.updateVerticesData(c.c.ColorKind,A,!1,!1),S.refreshBoundingInfo(),S}const j=!!Q,g=new X.d(M,O,null,void 0,void 0,j,A.useVertexAlpha,A.material);return B(A).hM(g,A.updatable),g}function T(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=A.FM?[A.FM]:null;return e(M,{lines:[A.points],updatable:A.updatable,instance:A.instance,FM:S,useVertexAlpha:A.useVertexAlpha,material:A.material},O)}function J(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=A.points,c=A.instance,B=A.gapSize||1,e=A.dashSize||3;if(c){const M=M=>{const A=S.GA.Zero(),O=M.length/6;let z=0,X=0,j=0,B=0,g=0,e=0,T=0,J=0;for(T=0;T<Q.length-1;T++)Q[T+1].subtractToRef(Q[T],A),z+=A.length();j=z/O;const K=c._creationDataStorage.dashSize;for(B=K*j/(K+c._creationDataStorage.gapSize),T=0;T<Q.length-1;T++)for(Q[T+1].subtractToRef(Q[T],A),X=Math.floor(A.length()/j),A.normalize(),J=0;J<X&&e<M.length;)g=j*J,M[e]=Q[T].x+g*A.x,M[e+1]=Q[T].y+g*A.y,M[e+2]=Q[T].z+g*A.z,M[e+3]=Q[T].x+(g+B)*A.x,M[e+4]=Q[T].y+(g+B)*A.y,M[e+5]=Q[T].z+(g+B)*A.z,e+=6,J++;for(;e<M.length;)M[e]=Q[T].x,M[e+1]=Q[T].y,M[e+2]=Q[T].z,e+=3};return(A.dashNb||A.dashSize||A.gapSize||A.useVertexAlpha||A.material)&&j.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),c.updateMeshPositions(M,!1),c}const T=new X.d(M,O,null,void 0,void 0,void 0,A.useVertexAlpha,A.material);return g(A).hM(T,A.updatable),T._creationDataStorage=new z.g,T._creationDataStorage.dashSize=e,T._creationDataStorage.gapSize=B,T}Q.e.CreateLineSystem=B,Q.e.CreateDashedLines=g,z.d.Og=function(M,A){return T(M,{points:A,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},z.d.CreateDashedLines=function(M,A,O,S,z){return J(M,{points:A,dashSize:O,gapSize:S,dashNb:z,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13845:(M,A,O)=>{"use strict";O.d(A,{b:()=>c,d:()=>j});var S=O(13422),z=O(13405),Q=O(13025);function X(M){const A=[],O=[],S=[],X=[],c=void 0!==M.width?M.width:void 0!==M.size?M.size:1,j=void 0!==M.height?M.height:void 0!==M.size?M.size:1,B=0===M.sideOrientation?0:M.sideOrientation||z.e.DEFAULTSIDE,g=c/2,e=j/2;O.push(-g,-e,0),S.push(0,0,-1),X.push(0,Q.d?1:0),O.push(g,-e,0),S.push(0,0,-1),X.push(1,Q.d?1:0),O.push(g,e,0),S.push(0,0,-1),X.push(1,Q.d?0:1),O.push(-g,e,0),S.push(0,0,-1),X.push(0,Q.d?0:1),A.push(0),A.push(1),A.push(2),A.push(0),A.push(2),A.push(3),z.e._ComputeSides(B,O,A,S,X,M.frontUVs,M.backUVs);const T=new z.e;return T.indices=A,T.fM=O,T.DM=S,T.NM=X,T}function c(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new S.d(M,O);A.sideOrientation=S.d._GetDefaultSideOrientation(A.sideOrientation),z._originalBuilderSideOrientation=A.sideOrientation;return X(A).hM(z,A.updatable),A.sourcePlane&&(z.translate(A.sourcePlane.normal,-A.sourcePlane.d),z.setDirection(A.sourcePlane.normal.scale(-1))),z}const j={Xg:c};z.e.Xg=X,S.d.Xg=(M,A,O,S,z)=>c(M,{size:A,width:A,height:A,sideOrientation:z,updatable:S},O)},13932:(M,A,O)=>{"use strict";O.d(A,{d:()=>j});var S=O(12970),z=O(13422),Q=O(13405),X=O(13025);function c(M){const A=0|(M.segments||32),O=M.diameterX||M.diameter||1,z=M.diameterY||M.diameter||1,c=M.diameterZ||M.diameter||1,j=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,B=M.slice&&M.slice<=0?1:M.slice||1,g=0===M.sideOrientation?0:M.sideOrientation||Q.e.DEFAULTSIDE,e=!!M.dedupTopBottomIndices,T=new S.GA(O/2,z/2,c/2),J=2+A,K=2*J,G=[],d=[],w=[],I=[];for(let Q=0;Q<=J;Q++){const M=Q/J,A=M*Math.PI*B;for(let O=0;O<=K;O++){const z=O/K,Q=z*Math.PI*2*j,c=S.Matrix.RotationZ(-A),B=S.Matrix.RotationY(Q),g=S.GA.TransformCoordinates(S.GA.Up(),c),e=S.GA.TransformCoordinates(g,B),J=e.multiply(T),G=e.divide(T).normalize();d.push(J.x,J.y,J.z),w.push(G.x,G.y,G.z),I.push(z,X.d?1-M:M)}if(Q>0){const M=d.length/3;for(let A=M-2*(K+1);A+K+2<M;A++)e?(Q>1&&(G.push(A),G.push(A+1),G.push(A+K+1)),(Q<J||B<1)&&(G.push(A+K+1),G.push(A+1),G.push(A+K+2))):(G.push(A),G.push(A+1),G.push(A+K+1),G.push(A+K+1),G.push(A+1),G.push(A+K+2))}}Q.e._ComputeSides(g,d,G,w,I,M.frontUVs,M.backUVs);const b=new Q.e;return b.indices=G,b.fM=d,b.DM=w,b.NM=I,b}function j(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return c(A).hM(S,A.updatable),S}Q.e.CreateSphere=c,z.d.CreateSphere=(M,A,O,S,z,Q)=>j(M,{segments:A,diameterX:O,diameterY:O,diameterZ:O,sideOrientation:Q,updatable:z},S)},14788:(M,A,O)=>{"use strict";O.d(A,{e:()=>j});var S=O(22),z=O(13539),Q=O(14210),X=O(13559),c=O(13405);class j{static get Configuration(){return{get decoder(){return Q.d.DefaultConfiguration},set decoder(M){Q.d.DefaultConfiguration=M}}}static set Configuration(M){Q.d.DefaultConfiguration=M.decoder}static get DecoderAvailable(){return(0,z.h)(Q.d.DefaultConfiguration)}static get Default(){var M;return null!==(M=j._Default)&&void 0!==M||(j._Default=new j),j._Default}static ResetDefault(M){j._Default&&(M||j._Default.dispose(),j._Default=null)}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultNumWorkers;const A="number"===typeof M?(0,S.d)((0,S.d)({},Q.d.DefaultConfiguration),{},{numWorkers:M}):(0,S.d)((0,S.d)({},Q.d.DefaultConfiguration),M);this._decoder=new Q.d(A)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(M,A,O){return this._decoder.decodeMeshToMeshDataAsync(M,A,O)}async decodeMeshToGeometryAsync(M,A,O,S){return await this._decoder.decodeMeshToGeometryAsync(M,A,O,S)}async _decodeMeshToGeometryForGltfAsync(M,A,O,S,z,Q){return await this._decoder._decodeMeshToGeometryForGltfAsync(M,A,O,S,z,Q)}async decodeMeshAsync(M,A){const O=await this._decoder.decodeMeshToMeshDataAsync(M,A),S=new c.e;O.indices&&(S.indices=O.indices);for(const z of O.attributes){const M=X.b.GetFloatData(z.data,z.size,X.b.GetDataType(z.data),z.byteOffset,z.byteStride,z.normalized,O.totalVertices);S.set(M,z.kind)}return S}}j.DefaultNumWorkers=(0,z.e)(),j._Default=null},14210:(M,A,O)=>{"use strict";O.d(A,{d:()=>B});var S=O(13539),z=O(12768),Q=O(13432),X=O(13559),c=O(12783),j=O(13552);class B extends S.b{static get DefaultAvailable(){return(0,S.h)(B.DefaultConfiguration)}static get Default(){var M;return null!==(M=B._Default)&&void 0!==M||(B._Default=new B),B._Default}static ResetDefault(M){B._Default&&(M||B._Default.dispose(),B._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(M,A){return{module:await(A||DracoDecoderModule)({wasmBinary:M})}}_getWorkerContent(){return"".concat(j.e,"(").concat(j.f,")()")}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.DefaultConfiguration)}decodeMeshToMeshDataAsync(M,A,O){const S=M instanceof ArrayBuffer?new Int8Array(M):new Int8Array(M.buffer,M.byteOffset,M.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async M=>await new Promise(((z,Q)=>{M.push(((M,X)=>{let j=null;const B=[],g=A=>{M.removeEventListener("error",g),M.removeEventListener("message",e),Q(A),X()},e=A=>{const S=A.data;switch(S.id){case"indices":j=S.data;break;case"attribute":B.push({kind:S.kind,data:S.data,size:S.size,byteOffset:S.byteOffset,byteStride:S.byteStride,normalized:(Q=S.kind,T=S.normalized,O&&void 0!==O[Q]?(T!==O[Q]&&c.c.Warn("Normalized flag from Draco data (".concat(T,") does not match normalized flag from glTF accessor (").concat(O[Q],"). Using flag from glTF accessor.")),O[Q]):T)});break;case"decodeMeshDone":M.removeEventListener("error",g),M.removeEventListener("message",e),z({indices:j,attributes:B,totalVertices:S.totalVertices}),X()}var Q,T};M.addEventListener("error",g),M.addEventListener("message",e);const T=S.slice();M.postMessage({id:"decodeMesh",dataView:T,attributes:A},[T.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((M=>{let O=null;const z=[],Q=(0,j.e)(M.module,S,A,(M=>{O=M}),((M,A,O,S,Q,X)=>{z.push({kind:M,data:A,size:O,byteOffset:S,byteStride:Q,normalized:X})}));return{indices:O,attributes:z,totalVertices:Q}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(M,A,O,S){const z=await this.decodeMeshToMeshDataAsync(O,S),c=new Q.d(M,A);z.indices&&c.setIndices(z.indices);for(const Q of z.attributes)c.setVerticesBuffer(new X.b(A.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),z.totalVertices);return c}async _decodeMeshToGeometryForGltfAsync(M,A,O,S,z,c){const j=await this.decodeMeshToMeshDataAsync(O,S,z),B=new Q.d(M,A);c&&(B._boundingInfo=c,B.useBoundingInfoFromGeometry=!0),j.indices&&B.setIndices(j.indices);for(const Q of j.attributes)B.setVerticesBuffer(new X.b(A.getEngine(),Q.data,Q.kind,!1,void 0,Q.byteStride,void 0,Q.byteOffset,Q.size,void 0,Q.normalized,!0),j.totalVertices);return B}}B.DefaultConfiguration={wasmUrl:"".concat(z.Tools._DefaultCdnUrl,"/draco_wasm_wrapper_gltf.js"),wasmBinaryUrl:"".concat(z.Tools._DefaultCdnUrl,"/draco_decoder_gltf.wasm"),fallbackUrl:"".concat(z.Tools._DefaultCdnUrl,"/draco_decoder_gltf.js")},B._Default=null},14343:(M,A,O)=>{"use strict";O.d(A,{d:()=>cM});var S=O(12970),z=O(13422),Q=O(13043),X=O(13405),c=O(13025);function j(M){let A=M.pathArray;const O=M.closeArray||!1,S=M.closePath||!1,z=M.invertUV||!1,j=Math.floor(A[0].length/2);let B=M.offset||j;B=B>j?j:Math.floor(B);const g=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,e=M.NM,T=M.FM,J=[],K=[],G=[],d=[],w=[],I=[],b=[],s=[];let Y;const E=[],H=[];let C,f,D;if(A.length<2){const M=[],O=[];for(f=0;f<A[0].length-B;f++)M.push(A[0][f]),O.push(A[0][f+B]);A=[M,O]}let F=0;const N=S?1:0,y=O?1:0;let h,u,i,U,L,t;for(Y=A[0].length,C=0;C<A.length+y;C++){for(b[C]=0,w[C]=[0],h=C===A.length?A[0]:A[C],u=h.length,Y=Y<u?Y:u,D=0;D<u;)J.push(h[D].x,h[D].y,h[D].z),D>0&&(i=h[D].dA(h[D-1]).length(),U=i+b[C],w[C].push(U),b[C]=U),D++;S&&(D--,J.push(h[0].x,h[0].y,h[0].z),i=h[D].dA(h[0]).length(),U=i+b[C],w[C].push(U),b[C]=U),E[C]=u+N,H[C]=F,F+=u+N}let x,o,p=null,v=null;for(f=0;f<Y+N;f++)for(s[f]=0,I[f]=[0],C=0;C<A.length-1+y;C++)L=A[C],t=C===A.length-1?A[0]:A[C+1],f===Y?(p=L[0],v=t[0]):(p=L[f],v=t[f]),i=v.dA(p).length(),U=i+s[f],I[f].push(U),s[f]=U;if(e)for(C=0;C<e.length;C++)d.push(e[C].x,c.d?1-e[C].y:e[C].y);else for(C=0;C<A.length+y;C++)for(f=0;f<Y+N;f++)x=0!=b[C]?w[C][f]/b[C]:0,o=0!=s[f]?I[f][C]/s[f]:0,z?d.push(o,x):d.push(x,c.d?1-o:o);C=0;let q=0,r=E[C]-1,n=E[C+1]-1,a=r<n?r:n,V=H[1]-H[0];const Z=E.length-1;for(;q<=a&&C<Z;)K.push(q,q+V,q+1),K.push(q+V+1,q+1,q+V),q+=1,q===a&&(C++,V=H[C+1]-H[C],r=E[C]-1,n=E[C+1]-1,q=H[C],a=r<n?r+q:n+q);if(X.e.ComputeNormals(J,K,G),S){let M=0,O=0;for(C=0;C<A.length;C++){M=3*H[C],O=C+1<A.length?3*(H[C+1]-1):G.length-3,G[M]=.5*(G[M]+G[O]),G[M+1]=.5*(G[M+1]+G[O+1]),G[M+2]=.5*(G[M+2]+G[O+2]);const S=Math.sqrt(G[M]*G[M]+G[M+1]*G[M+1]+G[M+2]*G[M+2]);G[M]/=S,G[M+1]/=S,G[M+2]/=S,G[O]=G[M],G[O+1]=G[M+1],G[O+2]=G[M+2]}}if(O){let M=3*H[0],O=3*H[A.length];for(f=0;f<Y+N;f++){G[M]=.5*(G[M]+G[O]),G[M+1]=.5*(G[M+1]+G[O+1]),G[M+2]=.5*(G[M+2]+G[O+2]);const A=Math.sqrt(G[M]*G[M]+G[M+1]*G[M+1]+G[M+2]*G[M+2]);G[M]/=A,G[M+1]/=A,G[M+2]/=A,G[O]=G[M],G[O+1]=G[M+1],G[O+2]=G[M+2],M+=3,O+=3}}X.e._ComputeSides(g,J,K,G,d,M.frontUVs,M.backUVs);let P=null;if(T){P=new Float32Array(4*T.length);for(let M=0;M<T.length;M++)P[4*M]=T[M].r,P[4*M+1]=T[M].g,P[4*M+2]=T[M].b,P[4*M+3]=T[M].a}const mM=new X.e,R=new Float32Array(J),k=new Float32Array(G),W=new Float32Array(d);return mM.indices=K,mM.fM=R,mM.DM=k,mM.NM=W,P&&mM.set(P,Q.c.ColorKind),S&&(mM._idx=H),mM}function B(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=A.pathArray,g=A.closeArray,e=A.closePath,T=z.d._GetDefaultSideOrientation(A.sideOrientation),J=A.instance,K=A.updatable;if(J){const M=S.TmpVectors.GA[0].Hc(Number.MAX_VALUE),O=S.TmpVectors.GA[1].Hc(-Number.MAX_VALUE),j=A=>{let S=B[0].length;const Q=J;let X=0;const c=Q._originalBuilderSideOrientation===z.d.DOUBLESIDE?2:1;for(let z=1;z<=c;++z)for(let c=0;c<B.length;++c){const z=B[c],j=z.length;S=S<j?S:j;for(let Q=0;Q<S;++Q){const S=z[Q];A[X]=S.x,A[X+1]=S.y,A[X+2]=S.z,M.minimizeInPlaceFromFloats(S.x,S.y,S.z),O.maximizeInPlaceFromFloats(S.x,S.y,S.z),X+=3}if(Q._creationDataStorage&&Q._creationDataStorage.closePath){const M=z[0];A[X]=M.x,A[X+1]=M.y,A[X+2]=M.z,X+=3}}},g=J.getVerticesData(Q.c.PositionKind);if(j(g),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(M,O,J._worldMatrix):J.buildBoundingInfo(M,O,J._worldMatrix),J.updateVerticesData(Q.c.PositionKind,g,!1,!1),A.FM){const M=J.getVerticesData(Q.c.ColorKind);for(let O=0,S=0;O<A.FM.length;O++,S+=4){const z=A.FM[O];M[S]=z.r,M[S+1]=z.g,M[S+2]=z.b,M[S+3]=z.a}J.updateVerticesData(Q.c.ColorKind,M,!1,!1)}if(A.NM){const M=J.getVerticesData(Q.c.UVKind);for(let O=0;O<A.NM.length;O++)M[2*O]=A.NM[O].x,M[2*O+1]=c.d?1-A.NM[O].y:A.NM[O].y;J.updateVerticesData(Q.c.UVKind,M,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){const M=J.Ic(),A=J.getVerticesData(Q.c.NormalKind),O=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(X.e.ComputeNormals(g,M,A,O),J._creationDataStorage&&J._creationDataStorage.closePath){let M=0,O=0;for(let S=0;S<B.length;S++)M=3*J._creationDataStorage.idx[S],O=S+1<B.length?3*(J._creationDataStorage.idx[S+1]-1):A.length-3,A[M]=.5*(A[M]+A[O]),A[M+1]=.5*(A[M+1]+A[O+1]),A[M+2]=.5*(A[M+2]+A[O+2]),A[O]=A[M],A[O+1]=A[M+1],A[O+2]=A[M+2]}J.areNormalsFrozen||J.updateVerticesData(Q.c.NormalKind,A,!1,!1)}return J}{const S=new z.d(M,O);S._originalBuilderSideOrientation=T,S._creationDataStorage=new z.g;const Q=j(A);return e&&(S._creationDataStorage.idx=Q._idx),S._creationDataStorage.closePath=e,S._creationDataStorage.closeArray=g,Q.hM(S,K),S}}X.e.CreateRibbon=j,z.d.CreateRibbon=function(M,A){return B(M,{pathArray:A,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var g=O(13938),e=O(13794),T=O(13010);function J(M){const A=M.pattern||z.d.NO_FLIP,O=M.tileWidth||M.tileSize||1,S=M.tileHeight||M.tileSize||1,Q=M.alignHorizontal||0,c=M.alignVertical||0,j=M.width||M.size||1,B=Math.floor(j/O);let g=j-B*O;const e=M.height||M.size||1,T=Math.floor(e/S);let J=e-T*S;const K=O*B/2,G=S*T/2;let d=0,w=0,I=0,b=0,s=0,Y=0;if(g>0||J>0){switch(I=-K,b=-G,s=K,Y=G,Q){case z.d.CENTER:g/=2,I-=g,s+=g;break;case z.d.LEFT:s+=g,d=-g/2;break;case z.d.RIGHT:I-=g,d=g/2}switch(c){case z.d.CENTER:J/=2,b-=J,Y+=J;break;case z.d.BOTTOM:Y+=J,w=-J/2;break;case z.d.TOP:b-=J,w=J/2}}const E=[],H=[],C=[];C[0]=[0,0,1,0,1,1,0,1],C[1]=[0,0,1,0,1,1,0,1],A!==z.d.ROTATE_TILE&&A!==z.d.ROTATE_ROW||(C[1]=[1,1,0,1,0,0,1,0]),A!==z.d.FLIP_TILE&&A!==z.d.FLIP_ROW||(C[1]=[1,0,0,0,0,1,1,1]),A!==z.d.FLIP_N_ROTATE_TILE&&A!==z.d.FLIP_N_ROTATE_ROW||(C[1]=[0,1,1,1,1,0,0,0]);let f=[];const D=[],F=[];let N=0;for(let X=0;X<T;X++)for(let M=0;M<B;M++)E.push(M*O-K+d,X*S-G+w,0),E.push((M+1)*O-K+d,X*S-G+w,0),E.push((M+1)*O-K+d,(X+1)*S-G+w,0),E.push(M*O-K+d,(X+1)*S-G+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),f=A===z.d.FLIP_TILE||A===z.d.ROTATE_TILE||A===z.d.FLIP_N_ROTATE_TILE?f.concat(C[(M%2+X%2)%2]):A===z.d.FLIP_ROW||A===z.d.ROTATE_ROW||A===z.d.FLIP_N_ROTATE_ROW?f.concat(C[X%2]):f.concat(C[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),N+=4;if(g>0||J>0){const M=J>0&&(c===z.d.CENTER||c===z.d.TOP),X=J>0&&(c===z.d.CENTER||c===z.d.BOTTOM),j=g>0&&(Q===z.d.CENTER||Q===z.d.RIGHT),e=g>0&&(Q===z.d.CENTER||Q===z.d.LEFT);let C,y,h,u,i=[];if(M&&j&&(E.push(I+d,b+w,0),E.push(-K+d,b+w,0),E.push(-K+d,b+J+w,0),E.push(I+d,b+J+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=1-g/O,y=1-J/S,h=1,u=1,i=[C,y,h,y,h,u,C,u],A===z.d.ROTATE_ROW&&(i=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),A===z.d.FLIP_ROW&&(i=[1-C,y,1-h,y,1-h,u,1-C,u]),A===z.d.FLIP_N_ROTATE_ROW&&(i=[C,1-y,h,1-y,h,1-u,C,1-u]),f=f.concat(i),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&e&&(E.push(K+d,b+w,0),E.push(s+d,b+w,0),E.push(s+d,b+J+w,0),E.push(K+d,b+J+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=0,y=1-J/S,h=g/O,u=1,i=[C,y,h,y,h,u,C,u],(A===z.d.ROTATE_ROW||A===z.d.ROTATE_TILE&&B%2===0)&&(i=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),(A===z.d.FLIP_ROW||A===z.d.FLIP_TILE&&B%2===0)&&(i=[1-C,y,1-h,y,1-h,u,1-C,u]),(A===z.d.FLIP_N_ROTATE_ROW||A===z.d.FLIP_N_ROTATE_TILE&&B%2===0)&&(i=[C,1-y,h,1-y,h,1-u,C,1-u]),f=f.concat(i),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),X&&j&&(E.push(I+d,G+w,0),E.push(-K+d,G+w,0),E.push(-K+d,Y+w,0),E.push(I+d,Y+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=1-g/O,y=0,h=1,u=J/S,i=[C,y,h,y,h,u,C,u],(A===z.d.ROTATE_ROW&&T%2===1||A===z.d.ROTATE_TILE&&T%1===0)&&(i=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),(A===z.d.FLIP_ROW&&T%2===1||A===z.d.FLIP_TILE&&T%2===0)&&(i=[1-C,y,1-h,y,1-h,u,1-C,u]),(A===z.d.FLIP_N_ROTATE_ROW&&T%2===1||A===z.d.FLIP_N_ROTATE_TILE&&T%2===0)&&(i=[C,1-y,h,1-y,h,1-u,C,1-u]),f=f.concat(i),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),X&&e&&(E.push(K+d,G+w,0),E.push(s+d,G+w,0),E.push(s+d,Y+w,0),E.push(K+d,Y+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,C=0,y=0,h=g/O,u=J/S,i=[C,y,h,y,h,u,C,u],(A===z.d.ROTATE_ROW&&T%2===1||A===z.d.ROTATE_TILE&&(T+B)%2===1)&&(i=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),(A===z.d.FLIP_ROW&&T%2===1||A===z.d.FLIP_TILE&&(T+B)%2===1)&&(i=[1-C,y,1-h,y,1-h,u,1-C,u]),(A===z.d.FLIP_N_ROTATE_ROW&&T%2===1||A===z.d.FLIP_N_ROTATE_TILE&&(T+B)%2===1)&&(i=[C,1-y,h,1-y,h,1-u,C,1-u]),f=f.concat(i),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M){const M=[];C=0,y=1-J/S,h=1,u=1,M[0]=[C,y,h,y,h,u,C,u],M[1]=[C,y,h,y,h,u,C,u],A!==z.d.ROTATE_TILE&&A!==z.d.ROTATE_ROW||(M[1]=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),A!==z.d.FLIP_TILE&&A!==z.d.FLIP_ROW||(M[1]=[1-C,y,1-h,y,1-h,u,1-C,u]),A!==z.d.FLIP_N_ROTATE_TILE&&A!==z.d.FLIP_N_ROTATE_ROW||(M[1]=[C,1-y,h,1-y,h,1-u,C,1-u]);for(let S=0;S<B;S++)E.push(S*O-K+d,b+w,0),E.push((S+1)*O-K+d,b+w,0),E.push((S+1)*O-K+d,b+J+w,0),E.push(S*O-K+d,b+J+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,f=A===z.d.FLIP_TILE||A===z.d.ROTATE_TILE||A===z.d.FLIP_N_ROTATE_TILE?f.concat(M[(S+1)%2]):A===z.d.FLIP_ROW||A===z.d.ROTATE_ROW||A===z.d.FLIP_N_ROTATE_ROW?f.concat(M[1]):f.concat(M[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const M=[];C=0,y=0,h=1,u=J/S,M[0]=[C,y,h,y,h,u,C,u],M[1]=[C,y,h,y,h,u,C,u],A!==z.d.ROTATE_TILE&&A!==z.d.ROTATE_ROW||(M[1]=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),A!==z.d.FLIP_TILE&&A!==z.d.FLIP_ROW||(M[1]=[1-C,y,1-h,y,1-h,u,1-C,u]),A!==z.d.FLIP_N_ROTATE_TILE&&A!==z.d.FLIP_N_ROTATE_ROW||(M[1]=[C,1-y,h,1-y,h,1-u,C,1-u]);for(let S=0;S<B;S++)E.push(S*O-K+d,Y-J+w,0),E.push((S+1)*O-K+d,Y-J+w,0),E.push((S+1)*O-K+d,Y+w,0),E.push(S*O-K+d,Y+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,f=A===z.d.FLIP_TILE||A===z.d.ROTATE_TILE||A===z.d.FLIP_N_ROTATE_TILE?f.concat(M[(S+T)%2]):A===z.d.FLIP_ROW||A===z.d.ROTATE_ROW||A===z.d.FLIP_N_ROTATE_ROW?f.concat(M[T%2]):f.concat(M[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const M=[];C=1-g/O,y=0,h=1,u=1,M[0]=[C,y,h,y,h,u,C,u],M[1]=[C,y,h,y,h,u,C,u],A!==z.d.ROTATE_TILE&&A!==z.d.ROTATE_ROW||(M[1]=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),A!==z.d.FLIP_TILE&&A!==z.d.FLIP_ROW||(M[1]=[1-C,y,1-h,y,1-h,u,1-C,u]),A!==z.d.FLIP_N_ROTATE_TILE&&A!==z.d.FLIP_N_ROTATE_ROW||(M[1]=[C,1-y,h,1-y,h,1-u,C,1-u]);for(let O=0;O<T;O++)E.push(I+d,O*S-G+w,0),E.push(I+g+d,O*S-G+w,0),E.push(I+g+d,(O+1)*S-G+w,0),E.push(I+d,(O+1)*S-G+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,f=A===z.d.FLIP_TILE||A===z.d.ROTATE_TILE||A===z.d.FLIP_N_ROTATE_TILE?f.concat(M[(O+1)%2]):A===z.d.FLIP_ROW||A===z.d.ROTATE_ROW||A===z.d.FLIP_N_ROTATE_ROW?f.concat(M[O%2]):f.concat(M[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const M=[];C=0,y=0,h=g/S,u=1,M[0]=[C,y,h,y,h,u,C,u],M[1]=[C,y,h,y,h,u,C,u],A!==z.d.ROTATE_TILE&&A!==z.d.ROTATE_ROW||(M[1]=[1-C,1-y,1-h,1-y,1-h,1-u,1-C,1-u]),A!==z.d.FLIP_TILE&&A!==z.d.FLIP_ROW||(M[1]=[1-C,y,1-h,y,1-h,u,1-C,u]),A!==z.d.FLIP_N_ROTATE_TILE&&A!==z.d.FLIP_N_ROTATE_ROW||(M[1]=[C,1-y,h,1-y,h,1-u,C,1-u]);for(let O=0;O<T;O++)E.push(s-g+d,O*S-G+w,0),E.push(s+d,O*S-G+w,0),E.push(s+d,(O+1)*S-G+w,0),E.push(s-g+d,(O+1)*S-G+w,0),F.push(N,N+1,N+3,N+1,N+2,N+3),N+=4,f=A===z.d.FLIP_TILE||A===z.d.ROTATE_TILE||A===z.d.FLIP_N_ROTATE_TILE?f.concat(M[(O+B)%2]):A===z.d.FLIP_ROW||A===z.d.ROTATE_ROW||A===z.d.FLIP_N_ROTATE_ROW?f.concat(M[O%2]):f.concat(M[0]),D.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),H.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const y=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE;X.e._ComputeSides(y,E,F,H,f,M.frontUVs,M.backUVs);const h=new X.e;h.indices=F,h.fM=E,h.DM=H,h.NM=f;const u=y===X.e.DOUBLESIDE?D.concat(D):D;return h.FM=u,h}function K(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return J(A).hM(S,A.updatable),S}function G(M){const A=M.faceUV||new Array(6),O=M.faceColors,Q=M.pattern||z.d.NO_FLIP,j=M.width||M.size||1,B=M.height||M.size||1,g=M.depth||M.size||1,e=M.tileWidth||M.tileSize||1,K=M.tileHeight||M.tileSize||1,G=M.alignHorizontal||0,d=M.alignVertical||0,w=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE;for(let z=0;z<6;z++)void 0===A[z]&&(A[z]=new S.Vector4(0,0,1,1)),O&&void 0===O[z]&&(O[z]=new T.Cc(1,1,1,1));const I=j/2,b=B/2,s=g/2,Y=[];for(let S=0;S<2;S++)Y[S]=J({pattern:Q,tileWidth:e,tileHeight:K,width:j,height:B,alignVertical:d,alignHorizontal:G,sideOrientation:w});for(let S=2;S<4;S++)Y[S]=J({pattern:Q,tileWidth:e,tileHeight:K,width:g,height:B,alignVertical:d,alignHorizontal:G,sideOrientation:w});let E=d;d===z.d.BOTTOM?E=z.d.TOP:d===z.d.TOP&&(E=z.d.BOTTOM);for(let S=4;S<6;S++)Y[S]=J({pattern:Q,tileWidth:e,tileHeight:K,width:j,height:g,alignVertical:E,alignHorizontal:G,sideOrientation:w});let H=[],C=[],f=[],D=[];const F=[],N=[],y=[],h=[];let u=0,i=0;for(let z=0;z<6;z++){const M=Y[z].fM.length;N[z]=[],y[z]=[];for(let A=0;A<M/3;A++)N[z].push(new S.GA(Y[z].fM[3*A],Y[z].fM[3*A+1],Y[z].fM[3*A+2])),y[z].push(new S.GA(Y[z].DM[3*A],Y[z].DM[3*A+1],Y[z].DM[3*A+2]));u=Y[z].NM.length,h[z]=[];for(let O=0;O<u;O+=2)h[z][O]=A[z].x+(A[z].z-A[z].x)*Y[z].NM[O],h[z][O+1]=A[z].y+(A[z].w-A[z].y)*Y[z].NM[O+1],c.d&&(h[z][O+1]=1-h[z][O+1]);if(f=f.concat(h[z]),D=D.concat(Y[z].indices.map((M=>M+i))),i+=N[z].length,O)for(let A=0;A<4;A++)F.push(O[z].r,O[z].g,O[z].b,O[z].a)}const U=new S.GA(0,0,s),L=S.Matrix.RotationY(Math.PI);H=N[0].map((M=>S.GA.TransformNormal(M,L).add(U))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]),C=y[0].map((M=>S.GA.TransformNormal(M,L))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]),H=H.concat(N[1].map((M=>M.dA(U))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),C=C.concat(y[1].map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]));const t=new S.GA(I,0,0),x=S.Matrix.RotationY(-Math.PI/2);H=H.concat(N[2].map((M=>S.GA.TransformNormal(M,x).add(t))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),C=C.concat(y[2].map((M=>S.GA.TransformNormal(M,x))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]));const o=S.Matrix.RotationY(Math.PI/2);H=H.concat(N[3].map((M=>S.GA.TransformNormal(M,o).dA(t))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),C=C.concat(y[3].map((M=>S.GA.TransformNormal(M,o))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]));const p=new S.GA(0,b,0),v=S.Matrix.RotationX(Math.PI/2);H=H.concat(N[4].map((M=>S.GA.TransformNormal(M,v).add(p))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),C=C.concat(y[4].map((M=>S.GA.TransformNormal(M,v))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[]));const q=S.Matrix.RotationX(-Math.PI/2);H=H.concat(N[5].map((M=>S.GA.TransformNormal(M,q).dA(p))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),C=C.concat(y[5].map((M=>S.GA.TransformNormal(M,q))).map((M=>[M.x,M.y,M.z])).reduce(((M,A)=>M.concat(A)),[])),X.e._ComputeSides(w,H,D,C,f);const r=new X.e;if(r.indices=D,r.fM=H,r.DM=C,r.NM=f,O){const M=w===X.e.DOUBLESIDE?F.concat(F):F;r.FM=M}return r}function d(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return G(A).hM(S,A.updatable),S}X.e.CreateTiledPlane=J;X.e.CreateTiledBox=G;var w=O(13932),I=O(13214),b=O(13181);function s(M){const A=M.height||2;let O=0===M.diameterTop?0:M.diameterTop||M.diameter||1,Q=0===M.diameterBottom?0:M.diameterBottom||M.diameter||1;O=O||1e-5,Q=Q||1e-5;const j=0|(M.tessellation||24),B=0|(M.subdivisions||1),g=!!M.hasRings,e=!!M.enclose,J=0===M.cap?0:M.cap||z.d.CAP_ALL,K=M.arc&&(M.arc<=0||M.arc>1)?1:M.arc||1,G=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,d=M.faceUV||new Array(3),w=M.faceColors,I=2+(1+(1!==K&&e?2:0))*(g?B:1);let s;for(s=0;s<I;s++)w&&void 0===w[s]&&(w[s]=new T.Cc(1,1,1,1));for(s=0;s<I;s++)d&&void 0===d[s]&&(d[s]=new S.Vector4(0,0,1,1));const Y=[],E=[],H=[],C=[],f=[],D=2*Math.PI*K/j;let F,N,y;const h=(Q-O)/2/A,u=S.GA.Zero(),i=S.GA.Zero(),U=S.GA.Zero(),L=S.GA.Zero(),t=S.GA.Zero(),x=b.e.Y;let o,p,v,q=1,r=1,n=0,a=0;for(o=0;o<=B;o++)for(N=o/B,y=(N*(O-Q)+Q)/2,q=g&&0!==o&&o!==B?2:1,v=0;v<q;v++){for(g&&(r+=v),e&&(r+=2*v),p=0;p<=j;p++)F=p*D,u.x=Math.cos(-F)*y,u.y=-A/2+N*A,u.z=Math.sin(-F)*y,0===O&&o===B?(i.x=H[H.length-3*(j+1)],i.y=H[H.length-3*(j+1)+1],i.z=H[H.length-3*(j+1)+2]):(i.x=u.x,i.z=u.z,i.y=Math.sqrt(i.x*i.x+i.z*i.z)*h,i.normalize()),0===p&&(U.S(u),L.S(i)),E.push(u.x,u.y,u.z),H.push(i.x,i.y,i.z),a=g?n!==r?d[r].y:d[r].w:d[r].y+(d[r].w-d[r].y)*N,C.push(d[r].x+(d[r].z-d[r].x)*p/j,c.d?1-a:a),w&&f.push(w[r].r,w[r].g,w[r].b,w[r].a);1!==K&&e&&(E.push(u.x,u.y,u.z),E.push(0,u.y,0),E.push(0,u.y,0),E.push(U.x,U.y,U.z),S.GA.CrossToRef(x,i,t),t.normalize(),H.push(t.x,t.y,t.z,t.x,t.y,t.z),S.GA.CrossToRef(L,x,t),t.normalize(),H.push(t.x,t.y,t.z,t.x,t.y,t.z),a=g?n!==r?d[r+1].y:d[r+1].w:d[r+1].y+(d[r+1].w-d[r+1].y)*N,C.push(d[r+1].x,c.d?1-a:a),C.push(d[r+1].z,c.d?1-a:a),a=g?n!==r?d[r+2].y:d[r+2].w:d[r+2].y+(d[r+2].w-d[r+2].y)*N,C.push(d[r+2].x,c.d?1-a:a),C.push(d[r+2].z,c.d?1-a:a),w&&(f.push(w[r+1].r,w[r+1].g,w[r+1].b,w[r+1].a),f.push(w[r+1].r,w[r+1].g,w[r+1].b,w[r+1].a),f.push(w[r+2].r,w[r+2].g,w[r+2].b,w[r+2].a),f.push(w[r+2].r,w[r+2].g,w[r+2].b,w[r+2].a))),n!==r&&(n=r)}const V=1!==K&&e?j+4:j;for(o=0,r=0;r<B;r++){let M=0,A=0,O=0,S=0;for(p=0;p<j;p++)M=o*(V+1)+p,A=(o+1)*(V+1)+p,O=o*(V+1)+(p+1),S=(o+1)*(V+1)+(p+1),Y.push(M,A,O),Y.push(S,O,A);1!==K&&e&&(Y.push(M+2,A+2,O+2),Y.push(S+2,O+2,A+2),Y.push(M+4,A+4,O+4),Y.push(S+4,O+4,A+4)),o=g?o+2:o+1}const Z=M=>{const z=M?O/2:Q/2;if(0===z)return;let X,B,g;const e=M?d[I-1]:d[0];let T=null;w&&(T=M?w[I-1]:w[0]);const J=E.length/3,G=M?A/2:-A/2,b=new S.GA(0,G,0);E.push(b.x,b.y,b.z),H.push(0,M?1:-1,0);const s=e.y+.5*(e.w-e.y);C.push(e.x+.5*(e.z-e.x),c.d?1-s:s),T&&f.push(T.r,T.g,T.b,T.a);const D=new S.Vector2(.5,.5);for(g=0;g<=j;g++){X=2*Math.PI*g*K/j;const A=Math.cos(-X),O=Math.sin(-X);B=new S.GA(A*z,G,O*z);const Q=new S.Vector2(A*D.x+.5,O*D.y+.5);E.push(B.x,B.y,B.z),H.push(0,M?1:-1,0);const J=e.y+(e.w-e.y)*Q.y;C.push(e.x+(e.z-e.x)*Q.x,c.d?1-J:J),T&&f.push(T.r,T.g,T.b,T.a)}for(g=0;g<j;g++)M?(Y.push(J),Y.push(J+(g+2)),Y.push(J+(g+1))):(Y.push(J),Y.push(J+(g+1)),Y.push(J+(g+2)))};J!==z.d.CAP_START&&J!==z.d.CAP_ALL||Z(!1),J!==z.d.CAP_END&&J!==z.d.CAP_ALL||Z(!0),X.e._ComputeSides(G,E,Y,H,C,M.frontUVs,M.backUVs);const P=new X.e;return P.indices=Y,P.fM=E,P.DM=H,P.NM=C,w&&(P.FM=f),P}function Y(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return s(A).hM(S,A.updatable),S}function E(M){const A=[],O=[],z=[],Q=[],j=M.diameter||1,B=M.thickness||.5,g=0|(M.tessellation||16),e=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,T=g+1;for(let X=0;X<=g;X++){const M=X/g,e=X*Math.PI*2/g-Math.PI/2,J=S.Matrix.Translation(j/2,0,0).multiply(S.Matrix.RotationY(e));for(let j=0;j<=g;j++){const e=1-j/g,K=j*Math.PI*2/g+Math.PI,G=Math.cos(K),d=Math.sin(K);let w=new S.GA(G,d,0),I=w.scale(B/2);const b=new S.Vector2(M,e);I=S.GA.TransformCoordinates(I,J),w=S.GA.TransformNormal(w,J),O.push(I.x,I.y,I.z),z.push(w.x,w.y,w.z),Q.push(b.x,c.d?1-b.y:b.y);const s=(X+1)%T,Y=(j+1)%T;A.push(X*T+j),A.push(X*T+Y),A.push(s*T+j),A.push(X*T+Y),A.push(s*T+Y),A.push(s*T+j)}}X.e._ComputeSides(e,O,A,z,Q,M.frontUVs,M.backUVs);const J=new X.e;return J.indices=A,J.fM=O,J.DM=z,J.NM=Q,J}function H(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return E(A).hM(S,A.updatable),S}X.e.CreateCylinder=s,z.d.CreateCylinder=(M,A,O,S,Q,X,c,j,B)=>{void 0!==c&&c instanceof I.b||(void 0!==c&&(B=j||z.d.DEFAULTSIDE,j=c),c=X,X=1);return Y(M,{height:A,diameterTop:O,diameterBottom:S,tessellation:Q,subdivisions:X,sideOrientation:B,updatable:j},c)};function C(M){const A=[],O=[],z=[],Q=[],j=M.radius||2,B=M.tube||.5,g=M.radialSegments||32,e=M.tubularSegments||32,T=M.p||2,J=M.q||3,K=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,G=M=>{const A=Math.cos(M),O=Math.sin(M),z=J/T*M,Q=Math.cos(z),X=j*(2+Q)*.5*A,c=j*(2+Q)*O*.5,B=j*Math.sin(z)*.5;return new S.GA(X,c,B)};let d,w;for(d=0;d<=g;d++){const M=d%g/g*2*T*Math.PI,A=G(M),z=G(M+.01),X=z.dA(A);let j=z.add(A);const J=S.GA.Cross(X,j);for(j=S.GA.Cross(J,X),J.normalize(),j.normalize(),w=0;w<e;w++){const M=w%e/e*2*Math.PI,S=-B*Math.cos(M),z=B*Math.sin(M);O.push(A.x+S*j.x+z*J.x),O.push(A.y+S*j.y+z*J.y),O.push(A.z+S*j.z+z*J.z),Q.push(d/g),Q.push(c.d?1-w/e:w/e)}}for(d=0;d<g;d++)for(w=0;w<e;w++){const M=(w+1)%e,O=d*e+w,S=(d+1)*e+w,z=(d+1)*e+M,Q=d*e+M;A.push(Q),A.push(S),A.push(O),A.push(Q),A.push(z),A.push(S)}X.e.ComputeNormals(O,A,z),X.e._ComputeSides(K,O,A,z,Q,M.frontUVs,M.backUVs);const I=new X.e;return I.indices=A,I.fM=O,I.DM=z,I.NM=Q,I}function f(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2?arguments[2]:void 0;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return C(A).hM(S,A.updatable),S}X.e.CreateTorus=E,z.d.CreateTorus=(M,A,O,S,z,Q,X)=>H(M,{diameter:A,thickness:O,tessellation:S,sideOrientation:X,updatable:Q},z);X.e.CreateTorusKnot=C,z.d.CreateTorusKnot=(M,A,O,S,z,Q,X,c,j,B)=>f(M,{radius:A,tube:O,radialSegments:S,tubularSegments:z,p:Q,q:X,sideOrientation:B,updatable:j},c);var D=O(14348),F=O(13535),N=O(13189);function y(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=A.path,Q=A.shape,X=A.scale||1,c=A.rotation||0,j=0===A.cap?0:A.cap||z.d.NO_CAP,B=A.updatable,g=z.d._GetDefaultSideOrientation(A.sideOrientation),e=A.instance||null,T=A.invertUV||!1,J=A.closeShape||!1,K=A.closePath||!1,G=A.capFunction||null;return u(M,Q,S,X,c,null,null,K,J,j,!1,O,!!B,g,e,T,A.frontUVs||null,A.backUVs||null,A.firstNormal||null,!!A.adjustFrame,G)}function h(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=A.path,Q=A.shape,X=A.scaleFunction||(()=>1),c=A.rotationFunction||(()=>0),j=A.closePath||A.ribbonCloseArray||!1,B=A.closeShape||A.ribbonClosePath||!1,g=0===A.cap?0:A.cap||z.d.NO_CAP,e=A.updatable,T=A.firstNormal||null,J=A.adjustFrame||!1,K=z.d._GetDefaultSideOrientation(A.sideOrientation),G=A.instance,d=A.invertUV||!1,w=A.capFunction||null;return u(M,Q,S,null,null,X,c,j,B,g,!0,O,!!e,K,G||null,d,A.frontUVs||null,A.backUVs||null,T,J,w||null)}function u(M,A,O,Q,X,c,j,g,e,T,J,K,G,d,w,I,b,s,Y,E,H){const C=(M,A,O,Q,X,c,j,B,g,e,T)=>{const J=O.getTangents(),K=O.getNormals(),G=O.getBinormals(),d=O.getDistances();if(T)for(let z=0;z<J.length;z++)if(0==J[z].x&&0==J[z].y&&0==J[z].z&&J[z].S(J[z-1]),0==K[z].x&&0==K[z].y&&0==K[z].z&&K[z].S(K[z-1]),0==G[z].x&&0==G[z].y&&0==G[z].z&&G[z].S(G[z-1]),z>0){let M=J[z-1];S.GA.Dot(M,J[z])<0&&J[z].scaleInPlace(-1),M=K[z-1],S.GA.Dot(M,K[z])<0&&K[z].scaleInPlace(-1),M=G[z-1],S.GA.Dot(M,G[z])<0&&G[z].scaleInPlace(-1)}let w=0;const I=e&&B?B:()=>null!==c?c:0,b=e&&j?j:()=>null!==X?X:1;let s=g===z.d.NO_CAP||g===z.d.CAP_END?0:2;const Y=S.TmpVectors.Matrix[0];for(let z=0;z<A.length;z++){const O=[],X=I(z,d[z]),c=b(z,d[z]);S.Matrix.RotationAxisToRef(J[z],w,Y);for(let Q=0;Q<M.length;Q++){const X=J[z].scale(M[Q].z).add(K[z].scale(M[Q].x)).add(G[z].scale(M[Q].y)),j=S.GA.Zero();S.GA.TransformCoordinatesToRef(X,Y,j),j.scaleInPlace(c).addInPlace(A[z]),O[Q]=j}Q[s]=O,w+=X,s++}const E=H||(M=>{const A=Array(),O=S.GA.Zero();let z;for(z=0;z<M.length;z++)O.addInPlace(M[z]);for(O.scaleInPlace(1/M.length),z=0;z<M.length;z++)A.push(O);return A});switch(g){case z.d.NO_CAP:break;case z.d.CAP_START:Q[0]=E(Q[2]),Q[1]=Q[2];break;case z.d.CAP_END:Q[s]=Q[s-1],Q[s+1]=E(Q[s-1]);break;case z.d.CAP_ALL:Q[0]=E(Q[2]),Q[1]=Q[2],Q[s]=Q[s-1],Q[s+1]=E(Q[s-1])}return Q};let f,D;if(w){const M=w._creationDataStorage;return f=Y?M.path3D.update(O,Y):M.path3D.update(O),D=C(A,O,M.path3D,M.pathArray,Q,X,c,j,M.cap,J,E),w=B("",{pathArray:D,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:w},K||void 0)}f=Y?new N.n(O,Y):new N.n(O);D=C(A,O,f,new Array,Q,X,c,j,T=T<0||T>3?0:T,J,E);const F=B(M,{pathArray:D,closeArray:g,closePath:e,updatable:G,sideOrientation:d,invertUV:I,frontUVs:b||void 0,backUVs:s||void 0},K);return F._creationDataStorage.pathArray=D,F._creationDataStorage.path3D=f,F._creationDataStorage.cap=T,F}function i(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=A.arc?A.arc<=0||A.arc>1?1:A.arc:1,X=void 0===A.closed||A.closed,c=A.shape,j=A.radius||1,g=A.tessellation||64,e=A.clip||0,T=A.updatable,J=z.d._GetDefaultSideOrientation(A.sideOrientation),K=A.cap||z.d.NO_CAP,G=2*Math.PI,d=[],w=A.invertUV||!1;let I=0,b=0;const s=G/g*Q;let Y,E;for(I=0;I<=g-e;I++){for(E=[],K!=z.d.CAP_START&&K!=z.d.CAP_ALL||(E.push(new S.GA(0,c[0].y,0)),E.push(new S.GA(Math.cos(I*s)*c[0].x*j,c[0].y,Math.sin(I*s)*c[0].x*j))),b=0;b<c.length;b++)Y=new S.GA(Math.cos(I*s)*c[b].x*j,c[b].y,Math.sin(I*s)*c[b].x*j),E.push(Y);K!=z.d.CAP_END&&K!=z.d.CAP_ALL||(E.push(new S.GA(Math.cos(I*s)*c[c.length-1].x*j,c[c.length-1].y,Math.sin(I*s)*c[c.length-1].x*j)),E.push(new S.GA(0,c[c.length-1].y,0))),d.push(E)}return B(M,{pathArray:d,closeArray:X,sideOrientation:J,updatable:T,invertUV:w,frontUVs:A.frontUVs,backUVs:A.backUVs},O)}z.d.ExtrudeShape=function(M,A,O,S,Q,X){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;return y(M,{shape:A,path:O,scale:S,rotation:Q,cap:0===X?0:X||z.d.NO_CAP,sideOrientation:B,instance:g,updatable:j},c)},z.d.ExtrudeShapeCustom=(M,A,O,S,Q,X,c,j,B,g,e,T)=>h(M,{shape:A,path:O,scaleFunction:S,rotationFunction:Q,ribbonCloseArray:X,ribbonClosePath:c,cap:0===j?0:j||z.d.NO_CAP,sideOrientation:e,instance:T,updatable:g},B);z.d.CreateLathe=(M,A,O,S,z,Q,X)=>i(M,{shape:A,radius:O,tessellation:S,sideOrientation:X,updatable:Q},z);var U=O(13845),L=O(13798);function t(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=A.path;let X=A.instance,c=1;void 0!==A.radius?c=A.radius:X&&(c=X._creationDataStorage.radius);const j=A.tessellation||64,g=A.radiusFunction||null;let e=A.cap||z.d.NO_CAP;const T=A.invertUV||!1,J=A.updatable,K=z.d._GetDefaultSideOrientation(A.sideOrientation);A.arc=A.arc&&(A.arc<=0||A.arc>1)?1:A.arc||1;const G=(M,A,O,Q,X,c,j,B)=>{const g=A.getTangents(),e=A.getNormals(),T=A.getDistances(),J=2*Math.PI/X*B,K=c||(()=>Q);let G,d,w,I;const b=S.TmpVectors.Matrix[0];let s=j===z.d.NO_CAP||j===z.d.CAP_END?0:2;for(let z=0;z<M.length;z++){d=K(z,T[z]),G=Array(),w=e[z];for(let A=0;A<X;A++)S.Matrix.RotationAxisToRef(g[z],J*A,b),I=G[A]?G[A]:S.GA.Zero(),S.GA.TransformCoordinatesToRef(w,b,I),I.scaleInPlace(d).addInPlace(M[z]),G[A]=I;O[s]=G,s++}const Y=(A,O)=>{const S=Array();for(let z=0;z<A;z++)S.push(M[O]);return S};switch(j){case z.d.NO_CAP:break;case z.d.CAP_START:O[0]=Y(X,0),O[1]=O[2].slice(0);break;case z.d.CAP_END:O[s]=O[s-1].slice(0),O[s+1]=Y(X,M.length-1);break;case z.d.CAP_ALL:O[0]=Y(X,0),O[1]=O[2].slice(0),O[s]=O[s-1].slice(0),O[s+1]=Y(X,M.length-1)}return O};let d,w;if(X){const M=X._creationDataStorage,O=A.arc||M.arc;return d=M.path3D.update(Q),w=G(Q,d,M.pathArray,c,M.tessellation,g,M.cap,O),X=B("",{pathArray:w,instance:X}),M.path3D=d,M.pathArray=w,M.arc=O,M.radius=c,X}d=new N.n(Q);e=e<0||e>3?0:e,w=G(Q,d,new Array,c,j,g,e,A.arc);const I=B(M,{pathArray:w,closePath:!0,closeArray:!1,updatable:J,sideOrientation:K,invertUV:T,frontUVs:A.frontUVs,backUVs:A.backUVs},O);return I._creationDataStorage.pathArray=w,I._creationDataStorage.path3D=d,I._creationDataStorage.tessellation=j,I._creationDataStorage.cap=e,I._creationDataStorage.arc=A.arc,I._creationDataStorage.radius=c,I}function x(M){const A=[];A[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},A[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},A[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},A[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},A[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},A[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},A[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},A[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},A[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},A[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},A[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},A[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},A[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},A[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},A[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const O=M.type&&(M.type<0||M.type>=A.length)?0:M.type||0,z=M.size,Q=M.sizeX||z||1,j=M.sizeY||z||1,B=M.sizeZ||z||1,g=M.custom||A[O],e=g.face.length,J=M.faceUV||new Array(e),K=M.faceColors,G=void 0===M.flat||M.flat,d=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,w=[],I=[],b=[],s=[],Y=[];let E=0,H=0;const C=[];let f,D,F,N,y,h,u=0,i=0;if(G)for(i=0;i<e;i++)K&&void 0===K[i]&&(K[i]=new T.Cc(1,1,1,1)),J&&void 0===J[i]&&(J[i]=new S.Vector4(0,0,1,1));if(G)for(i=0;i<e;i++){const M=g.face[i].length;for(F=2*Math.PI/M,N=.5*Math.tan(F/2),y=.5,u=0;u<M;u++)w.push(g.vertex[g.face[i][u]][0]*Q,g.vertex[g.face[i][u]][1]*j,g.vertex[g.face[i][u]][2]*B),C.push(E),E++,f=J[i].x+(J[i].z-J[i].x)*(.5+N),D=J[i].y+(J[i].w-J[i].y)*(y-.5),s.push(f,c.d?1-D:D),h=N*Math.cos(F)-y*Math.sin(F),y=N*Math.sin(F)+y*Math.cos(F),N=h,K&&Y.push(K[i].r,K[i].g,K[i].b,K[i].a);for(u=0;u<M-2;u++)I.push(C[0+H],C[u+2+H],C[u+1+H]);H+=M}else{for(u=0;u<g.vertex.length;u++)w.push(g.vertex[u][0]*Q,g.vertex[u][1]*j,g.vertex[u][2]*B),s.push(0,c.d?1:0);for(i=0;i<e;i++)for(u=0;u<g.face[i].length-2;u++)I.push(g.face[i][0],g.face[i][u+2],g.face[i][u+1])}X.e.ComputeNormals(w,I,b),X.e._ComputeSides(d,w,I,b,s,M.frontUVs,M.backUVs);const U=new X.e;return U.fM=w,U.indices=I,U.DM=b,U.NM=s,K&&G&&(U.FM=Y),U}function o(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return x(A).hM(S,A.updatable),S}z.d.CreateTube=(M,A,O,S,z,Q,X,c,j,B)=>t(M,{path:A,radius:O,tessellation:S,radiusFunction:z,arc:1,cap:Q,updatable:c,sideOrientation:j,instance:B},X);function p(M){const A=M.sideOrientation||X.e.DEFAULTSIDE,O=M.radius||1,z=void 0===M.flat||M.flat,Q=0|(M.subdivisions||4),j=M.radiusX||O,B=M.radiusY||O,g=M.radiusZ||O,e=(1+Math.sqrt(5))/2,T=[-1,e,-0,1,e,0,-1,-e,0,1,-e,0,0,-1,-e,0,1,-e,0,-1,e,0,1,e,e,0,1,e,0,-1,-e,0,1,-e,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],K=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],G=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],d=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],w=[],I=[],b=[],s=[];let Y=0;const E=new Array(3),H=new Array(3);let C;for(C=0;C<3;C++)E[C]=S.GA.Zero(),H[C]=S.Vector2.Zero();for(let X=0;X<20;X++){for(C=0;C<3;C++){const M=J[3*X+C];E[C].Yc(T[3*K[M]],T[3*K[M]+1],T[3*K[M]+2]),E[C].normalize(),H[C].Yc(.134765625*G[2*M]+.05859375+-.0390625*d[X],.2333984375*G[2*M+1]+.025390625+.01953125*d[X])}const M=(M,A,O,X)=>{const e=S.GA.Lerp(E[0],E[2],A/Q),T=S.GA.Lerp(E[1],E[2],A/Q),J=Q===A?E[2]:S.GA.Lerp(e,T,M/(Q-A));let K;if(J.normalize(),z){const M=S.GA.Lerp(E[0],E[2],X/Q),A=S.GA.Lerp(E[1],E[2],X/Q);K=S.GA.Lerp(M,A,O/(Q-X))}else K=new S.GA(J.x,J.y,J.z);K.x/=j,K.y/=B,K.z/=g,K.normalize();const G=S.Vector2.Lerp(H[0],H[2],A/Q),d=S.Vector2.Lerp(H[1],H[2],A/Q),C=Q===A?H[2]:S.Vector2.Lerp(G,d,M/(Q-A));I.push(J.x*j,J.y*B,J.z*g),b.push(K.x,K.y,K.z),s.push(C.x,c.d?1-C.y:C.y),w.push(Y),Y++};for(let A=0;A<Q;A++)for(let O=0;O+A<Q;O++)M(O,A,O+1/3,A+1/3),M(O+1,A,O+1/3,A+1/3),M(O,A+1,O+1/3,A+1/3),O+A+1<Q&&(M(O+1,A,O+2/3,A+2/3),M(O+1,A+1,O+2/3,A+2/3),M(O,A+1,O+2/3,A+2/3))}X.e._ComputeSides(A,I,w,b,s,M.frontUVs,M.backUVs);const f=new X.e;return f.indices=w,f.fM=I,f.DM=b,f.NM=s,f}function v(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new z.d(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),S._originalBuilderSideOrientation=A.sideOrientation;return p(A).hM(S,A.updatable),S}X.e.CreatePolyhedron=x,z.d.CreatePolyhedron=(M,A,O)=>o(M,A,O);X.e.CreateIcoSphere=p,z.d.CreateIcoSphere=(M,A,O)=>v(M,A,O);var q=O(12980);const r=new S.GA(1,0,0),n=new S.GA(-1,0,0),a=new S.GA(0,1,0),V=new S.GA(0,-1,0),Z=new S.GA(0,0,1),P=new S.GA(0,0,-1);class mM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.GA.Zero(),A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.GA.Up(),O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.Vector2.Zero(),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=M,this.normal=A,this.uv=O,this.vertexIdx=z,this.vertexIdxForBones=Q,this.localPositionOverride=X,this.localNormalOverride=c,this.matrixIndicesOverride=j,this.matrixWeightsOverride=B}clone(){var M,A,O,S;return new mM(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(M=this.localPositionOverride)||void 0===M?void 0:M.slice(),null===(A=this.localNormalOverride)||void 0===A?void 0:A.slice(),null===(O=this.matrixIndicesOverride)||void 0===O?void 0:O.slice(),null===(S=this.matrixWeightsOverride)||void 0===S?void 0:S.slice())}}function R(M,A,O){var j,B,g,e,T;const J=!!A.skeleton,K=!(null===(j=A.morphTargetManager)||void 0===j||!j.numTargets),G=O.localMode||J,d=A.Ic(),w=J||K?A.Yj(!0,!0):A.getVerticesData(Q.c.PositionKind),I=J||K?A.getNormalsData(!0,!0):A.getVerticesData(Q.c.NormalKind),b=G?J?A.getVerticesData(Q.c.PositionKind):w:null,s=G?J?A.getVerticesData(Q.c.NormalKind):I:null,Y=A.getVerticesData(Q.c.UVKind),E=J?A.getVerticesData(Q.c.MatricesIndicesKind):null,H=J?A.getVerticesData(Q.c.MatricesWeightsKind):null,C=J?A.getVerticesData(Q.c.MatricesIndicesExtraKind):null,f=J?A.getVerticesData(Q.c.MatricesWeightsExtraKind):null,D=O.position||S.GA.Zero();let F=O.normal||S.GA.Up();const N=O.size||S.GA.One(),y=O.angle||0;if(!F){const M=new S.GA(0,0,1),O=A.HM().activeCamera,z=S.GA.TransformCoordinates(M,O.getWorldMatrix());F=O.globalPosition.dA(z)}const h=-Math.atan2(F.z,F.x)-Math.PI/2,u=Math.sqrt(F.x*F.x+F.z*F.z),i=Math.atan2(F.y,u),U=new X.e;U.indices=[],U.fM=[],U.DM=[],U.NM=[],U.matricesIndices=J?[]:null,U.matricesWeights=J?[]:null,U.matricesIndicesExtra=C?[]:null,U.matricesWeightsExtra=f?[]:null;let L=0;const t=(M,A)=>{const z=new mM;if(!d||!w||!I)return z;const Q=d[M];if(z.vertexIdx=3*Q,z.vertexIdxForBones=4*Q,z.position=new S.GA(w[3*Q],w[3*Q+1],w[3*Q+2]),S.GA.TransformCoordinatesToRef(z.position,A,z.position),z.normal=new S.GA(I[3*Q],I[3*Q+1],I[3*Q+2]),S.GA.TransformNormalToRef(z.normal,A,z.normal),O.captureUVS&&Y){const M=Y[2*Q+1];z.uv=new S.Vector2(Y[2*Q],c.d?1-M:M)}return z},x=[0,0,0,0],o=(M,A)=>{var O,z;if(0===M.length)return M;const Q=.5*Math.abs(S.GA.Dot(N,A)),X=(M,A,O,S)=>{for(let z=0;z<S;++z)if(M[O+z]===A)return O+z;return-1},c=(M,O)=>{var z,c,j,B,g,e,T,J,K,G,d,w;const I=S.GA.GetClipFactor(M.position,O.position,A,Q);let Y=x,C=x;if(E&&H){var f,D,F,N;const A=M.matrixIndicesOverride?0:M.vertexIdxForBones,S=null!==(f=M.matrixIndicesOverride)&&void 0!==f?f:E,z=null!==(D=M.matrixWeightsOverride)&&void 0!==D?D:H,Q=O.matrixIndicesOverride?0:O.vertexIdxForBones,c=null!==(F=O.matrixIndicesOverride)&&void 0!==F?F:E,j=null!==(N=O.matrixWeightsOverride)&&void 0!==N?N:H;Y=[0,0,0,0],C=[0,0,0,0];let B=0;for(let M=0;M<4;++M)if(z[A+M]>0){const O=X(c,S[A+M],Q,4);Y[B]=S[A+M],C[B]=(0,q.Lerp)(z[A+M],O>=0?j[O]:0,I),B++}for(let M=0;M<4&&B<4;++M){const O=c[Q+M];-1===X(S,O,A,4)&&(Y[B]=O,C[B]=(0,q.Lerp)(0,j[Q+M],I),B++)}const g=C[0]+C[1]+C[2]+C[3];C[0]/=g,C[1]/=g,C[2]/=g,C[3]/=g}const y=M.localPositionOverride?M.localPositionOverride[0]:null!==(z=null===b||void 0===b?void 0:b[M.vertexIdx])&&void 0!==z?z:0,h=M.localPositionOverride?M.localPositionOverride[1]:null!==(c=null===b||void 0===b?void 0:b[M.vertexIdx+1])&&void 0!==c?c:0,u=M.localPositionOverride?M.localPositionOverride[2]:null!==(j=null===b||void 0===b?void 0:b[M.vertexIdx+2])&&void 0!==j?j:0,i=O.localPositionOverride?O.localPositionOverride[0]:null!==(B=null===b||void 0===b?void 0:b[O.vertexIdx])&&void 0!==B?B:0,U=O.localPositionOverride?O.localPositionOverride[1]:null!==(g=null===b||void 0===b?void 0:b[O.vertexIdx+1])&&void 0!==g?g:0,L=O.localPositionOverride?O.localPositionOverride[2]:null!==(e=null===b||void 0===b?void 0:b[O.vertexIdx+2])&&void 0!==e?e:0,t=M.localNormalOverride?M.localNormalOverride[0]:null!==(T=null===s||void 0===s?void 0:s[M.vertexIdx])&&void 0!==T?T:0,o=M.localNormalOverride?M.localNormalOverride[1]:null!==(J=null===s||void 0===s?void 0:s[M.vertexIdx+1])&&void 0!==J?J:0,p=M.localNormalOverride?M.localNormalOverride[2]:null!==(K=null===s||void 0===s?void 0:s[M.vertexIdx+2])&&void 0!==K?K:0,v=t+((O.localNormalOverride?O.localNormalOverride[0]:null!==(G=null===s||void 0===s?void 0:s[O.vertexIdx])&&void 0!==G?G:0)-t)*I,r=o+((O.localNormalOverride?O.localNormalOverride[1]:null!==(d=null===s||void 0===s?void 0:s[O.vertexIdx+1])&&void 0!==d?d:0)-o)*I,n=p+((O.localNormalOverride?O.localNormalOverride[2]:null!==(w=null===s||void 0===s?void 0:s[O.vertexIdx+2])&&void 0!==w?w:0)-p)*I,a=Math.sqrt(v*v+r*r+n*n);return new mM(S.GA.Lerp(M.position,O.position,I),S.GA.Lerp(M.normal,O.normal,I).normalize(),S.Vector2.Lerp(M.uv,O.uv,I),-1,-1,b?[y+(i-y)*I,h+(U-h)*I,u+(L-u)*I]:null,s?[v/a,r/a,n/a]:null,Y,C)};let j=null;M.length>3&&(j=[]);for(let B=0;B<M.length;B+=3){let X=0,g=null,e=null,T=null,J=null;const K=S.GA.Dot(M[B].position,A)-Q>0,G=S.GA.Dot(M[B+1].position,A)-Q>0,d=S.GA.Dot(M[B+2].position,A)-Q>0;switch(X=(K?1:0)+(G?1:0)+(d?1:0),X){case 0:M.length>3?(j.push(M[B]),j.push(M[B+1]),j.push(M[B+2])):j=M;break;case 1:if(j=null!==(O=j)&&void 0!==O?O:new Array,K&&(g=M[B+1],e=M[B+2],T=c(M[B],g),J=c(M[B],e)),G){g=M[B],e=M[B+2],T=c(M[B+1],g),J=c(M[B+1],e),j.push(T),j.push(e.clone()),j.push(g.clone()),j.push(e.clone()),j.push(T.clone()),j.push(J);break}d&&(g=M[B],e=M[B+1],T=c(M[B+2],g),J=c(M[B+2],e)),g&&e&&T&&J&&(j.push(g.clone()),j.push(e.clone()),j.push(T),j.push(J),j.push(T.clone()),j.push(e.clone()));break;case 2:j=null!==(z=j)&&void 0!==z?z:new Array,K||(g=M[B].clone(),e=c(g,M[B+1]),T=c(g,M[B+2]),j.push(g),j.push(e),j.push(T)),G||(g=M[B+1].clone(),e=c(g,M[B+2]),T=c(g,M[B]),j.push(g),j.push(e),j.push(T)),d||(g=M[B+2].clone(),e=c(g,M[B]),T=c(g,M[B+1]),j.push(g),j.push(e),j.push(T))}}return j},p=A instanceof z.d?A:null,v=null===p||void 0===p?void 0:p._thinInstanceDataStorage.matrixData,R=(null===p||void 0===p?void 0:p.Dc)||1,k=S.TmpVectors.Matrix[0];k.S(S.Matrix.IdentityReadOnly);for(let z=0;z<R;++z){if(null!==p&&void 0!==p&&p.hasThinInstances&&v){const M=16*z;k.setRowFromFloats(0,v[M+0],v[M+1],v[M+2],v[M+3]),k.setRowFromFloats(1,v[M+4],v[M+5],v[M+6],v[M+7]),k.setRowFromFloats(2,v[M+8],v[M+9],v[M+10],v[M+11]),k.setRowFromFloats(3,v[M+12],v[M+13],v[M+14],v[M+15])}const M=S.Matrix.RotationYawPitchRoll(h,i,y).multiply(S.Matrix.Translation(D.x,D.y,D.z)),Q=S.Matrix.Invert(M),X=A.getWorldMatrix(),j=k.multiply(X).multiply(Q),B=new Array(3);for(let A=0;A<d.length;A+=3){let M=B;if(M[0]=t(A,j),M[1]=t(A+1,j),M[2]=t(A+2,j),!(O.cullBackFaces&&-M[0].normal.z<=0&&-M[1].normal.z<=0&&-M[2].normal.z<=0)&&(M=o(M,r),M&&(M=o(M,n),M&&(M=o(M,a),M&&(M=o(M,V),M&&(M=o(M,Z),M&&(M=o(M,P),M)))))))for(let A=0;A<M.length;A++){const S=M[A];if(U.indices.push(L),G?(S.localPositionOverride?(U.fM[3*L]=S.localPositionOverride[0],U.fM[3*L+1]=S.localPositionOverride[1],U.fM[3*L+2]=S.localPositionOverride[2]):b&&(U.fM[3*L]=b[S.vertexIdx],U.fM[3*L+1]=b[S.vertexIdx+1],U.fM[3*L+2]=b[S.vertexIdx+2]),S.localNormalOverride?(U.DM[3*L]=S.localNormalOverride[0],U.DM[3*L+1]=S.localNormalOverride[1],U.DM[3*L+2]=S.localNormalOverride[2]):s&&(U.DM[3*L]=s[S.vertexIdx],U.DM[3*L+1]=s[S.vertexIdx+1],U.DM[3*L+2]=s[S.vertexIdx+2])):(S.position.toArray(U.fM,3*L),S.normal.toArray(U.DM,3*L)),U.matricesIndices&&U.matricesWeights&&(S.matrixIndicesOverride?(U.matricesIndices[4*L]=S.matrixIndicesOverride[0],U.matricesIndices[4*L+1]=S.matrixIndicesOverride[1],U.matricesIndices[4*L+2]=S.matrixIndicesOverride[2],U.matricesIndices[4*L+3]=S.matrixIndicesOverride[3]):(E&&(U.matricesIndices[4*L]=E[S.vertexIdxForBones],U.matricesIndices[4*L+1]=E[S.vertexIdxForBones+1],U.matricesIndices[4*L+2]=E[S.vertexIdxForBones+2],U.matricesIndices[4*L+3]=E[S.vertexIdxForBones+3]),C&&U.matricesIndicesExtra&&(U.matricesIndicesExtra[4*L]=C[S.vertexIdxForBones],U.matricesIndicesExtra[4*L+1]=C[S.vertexIdxForBones+1],U.matricesIndicesExtra[4*L+2]=C[S.vertexIdxForBones+2],U.matricesIndicesExtra[4*L+3]=C[S.vertexIdxForBones+3])),S.matrixWeightsOverride?(U.matricesWeights[4*L]=S.matrixWeightsOverride[0],U.matricesWeights[4*L+1]=S.matrixWeightsOverride[1],U.matricesWeights[4*L+2]=S.matrixWeightsOverride[2],U.matricesWeights[4*L+3]=S.matrixWeightsOverride[3]):(H&&(U.matricesWeights[4*L]=H[S.vertexIdxForBones],U.matricesWeights[4*L+1]=H[S.vertexIdxForBones+1],U.matricesWeights[4*L+2]=H[S.vertexIdxForBones+2],U.matricesWeights[4*L+3]=H[S.vertexIdxForBones+3]),f&&U.matricesWeightsExtra&&(U.matricesWeightsExtra[4*L]=f[S.vertexIdxForBones],U.matricesWeightsExtra[4*L+1]=f[S.vertexIdxForBones+1],U.matricesWeightsExtra[4*L+2]=f[S.vertexIdxForBones+2],U.matricesWeightsExtra[4*L+3]=f[S.vertexIdxForBones+3]))),O.captureUVS)S.uv.toArray(U.NM,2*L);else{U.NM.push(.5+S.position.x/N.x);const M=.5+S.position.y/N.y;U.NM.push(c.d?1-M:M)}L++}}}0===U.indices.length&&(U.indices=null),0===U.fM.length&&(U.fM=null),0===U.DM.length&&(U.DM=null),0===U.NM.length&&(U.NM=null),0===(null===(B=U.matricesIndices)||void 0===B?void 0:B.length)&&(U.matricesIndices=null),0===(null===(g=U.matricesWeights)||void 0===g?void 0:g.length)&&(U.matricesWeights=null),0===(null===(e=U.matricesIndicesExtra)||void 0===e?void 0:e.length)&&(U.matricesIndicesExtra=null),0===(null===(T=U.matricesWeightsExtra)||void 0===T?void 0:T.length)&&(U.matricesWeightsExtra=null);const W=new z.d(M,A.HM());return U.hM(W),G?(W.skeleton=A.skeleton,W.parent=A):(W.position=D.clone(),W.rotation=new S.GA(i,h,y)),W.Gc(!0),W.refreshBoundingInfo(!0,!0),W}function k(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const A=0|Math.max(M.subdivisions?M.subdivisions:2,1),O=0|Math.max(M.tessellation?M.tessellation:16,3),z=Math.max(M.height?M.height:1,0),Q=Math.max(M.radius?M.radius:.25,0),j=0|Math.max(M.capSubdivisions?M.capSubdivisions:6,1),B=O,g=A,e=Math.max(M.radiusTop?M.radiusTop:Q,0),T=Math.max(M.radiusBottom?M.radiusBottom:Q,0),J=z-(e+T),K=2*Math.PI,G=Math.max(M.topCapSubdivisions?M.topCapSubdivisions:j,1),d=Math.max(M.bottomCapSubdivisions?M.bottomCapSubdivisions:j,1),w=Math.acos((T-e)/z);let I=[];const b=[],s=[],Y=[];let E=0;const H=[],C=.5*J,f=.5*Math.PI;let D,F;const N=S.GA.Zero(),y=S.GA.Zero(),h=Math.cos(w),u=Math.sin(w),i=new S.Vector2(e*u,C+e*h).dA(new S.Vector2(T*u,T*h-C)).length(),U=e*w+i+T*(f-w);let L=0;for(F=0;F<=G;F++){const M=[],A=f-w*(F/G);L+=e*w/G;const O=Math.cos(A),S=Math.sin(A),z=O*e;for(D=0;D<=B;D++){const A=D/B,Q=A*K+0,X=Math.sin(Q),j=Math.cos(Q);y.x=z*X,y.y=C+S*e,y.z=z*j,b.push(y.x,y.y,y.z),N.set(O*X,S,O*j),s.push(N.x,N.y,N.z),Y.push(A,c.d?L/U:1-L/U),M.push(E),E++}H.push(M)}const t=z-e-T+h*e-h*T,x=u*(T-e)/t;for(F=1;F<=g;F++){const M=[];L+=i/g;const A=u*(F*(T-e)/g+e);for(D=0;D<=B;D++){const O=D/B,S=O*K+0,z=Math.sin(S),Q=Math.cos(S);y.x=A*z,y.y=C+h*e-F*t/g,y.z=A*Q,b.push(y.x,y.y,y.z),N.set(z,x,Q).normalize(),s.push(N.x,N.y,N.z),Y.push(O,c.d?L/U:1-L/U),M.push(E),E++}H.push(M)}for(F=1;F<=d;F++){const M=[],A=f-w-(Math.PI-w)*(F/d);L+=T*w/d;const O=Math.cos(A),S=Math.sin(A),z=O*T;for(D=0;D<=B;D++){const A=D/B,Q=A*K+0,X=Math.sin(Q),j=Math.cos(Q);y.x=z*X,y.y=S*T-C,y.z=z*j,b.push(y.x,y.y,y.z),N.set(O*X,S,O*j),s.push(N.x,N.y,N.z),Y.push(A,c.d?L/U:1-L/U),M.push(E),E++}H.push(M)}for(D=0;D<B;D++)for(F=0;F<G+g+d;F++){const M=H[F][D],A=H[F+1][D],O=H[F+1][D+1],S=H[F][D+1];I.push(M),I.push(A),I.push(S),I.push(A),I.push(O),I.push(S)}if(I=I.reverse(),M.orientation&&!M.orientation.equals(S.GA.Up())){const A=new S.Matrix;M.orientation.clone().scale(.5*Math.PI).cross(S.GA.Up()).toQuaternion().toRotationMatrix(A);const O=S.GA.Zero();for(let M=0;M<b.length;M+=3)O.set(b[M],b[M+1],b[M+2]),S.GA.TransformCoordinatesToRef(O.clone(),A,O),b[M]=O.x,b[M+1]=O.y,b[M+2]=O.z}const o=new X.e;return o.fM=b,o.DM=s,o.NM=Y,o.indices=I,o}function W(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:S.GA.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=new z.d(M,O);return k(A).hM(Q,A.updatable),Q}z.d.CreateDecal=(M,A,O,S,z,Q)=>R(M,A,{position:O,normal:S,size:z,angle:Q});z.d.CreateCapsule=(M,A,O)=>W(M,A,O),X.e.CreateCapsule=k;var l=O(12783),MM=O(12974);class AM{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=M,this.y=A,M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("x is not an integer, floor(x) used")),A!==Math.floor(A)&&(A=Math.floor(A),l.c.Warn("y is not an integer, floor(y) used"))}clone(){return new AM(this.x,this.y)}rotate60About(M){const A=this.x;return this.x=M.x+M.y-this.y,this.y=A+this.y-M.x,this}rotateNeg60About(M){const A=this.x;return this.x=A+this.y-M.y,this.y=M.x+M.y-A,this}rotate120(M,A){M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("m not an integer only floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),l.c.Warn("n not an integer only floor(n) used"));const O=this.x;return this.x=M-O-this.y,this.y=A+O,this}rotateNeg120(M,A){M!==Math.floor(M)&&(M=Math.floor(M),l.c.Warn("m is not an integer, floor(m) used")),A!==Math.floor(A)&&(A=Math.floor(A),l.c.Warn("n is not an integer,   floor(n) used"));const O=this.x;return this.x=this.y-A,this.y=M+A-O-this.y,this}toCartesianOrigin(M,A){const O=S.GA.Zero();return O.x=M.x+2*this.x*A+this.y*A,O.y=M.y+Math.sqrt(3)*this.y*A,O}static Zero(){return new AM(0,0)}}class OM{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new SM("icosahedron","Regular",[[0,MM.g,-1],[-MM.g,1,0],[-1,0,-MM.g],[1,0,-MM.g],[MM.g,1,0],[0,MM.g,1],[-1,0,MM.g],[-MM.g,-1,0],[0,-MM.g,-1],[MM.g,-1,0],[1,0,MM.g],[0,-MM.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let M=12;const A={},O=this.m,S=this.n;let z,Q,X,c,j,B=O,g=1,e=0;0!==S&&(B=(0,q.HighestCommonFactor)(O,S)),g=O/B,e=S/B;const T=AM.Zero(),J=new AM(O,S),K=new AM(-S,O+S),G=AM.Zero(),d=AM.Zero(),w=AM.Zero();let I,b,s,Y,E=[];const H=[],C=this.vertByDist,f=(O,S,z,Q)=>{I=O+"|"+z,b=S+"|"+Q,I in A||b in A?I in A&&!(b in A)?A[b]=A[I]:b in A&&!(I in A)&&(A[I]=A[b]):(A[I]=M,A[b]=M,M++),C[z][0]>2?H[A[I]]=[-C[z][0],C[z][1],A[I]]:H[A[I]]=[E[C[z][0]],C[z][1],A[I]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let D=0;D<20;D++){if(E=this.IDATA.face[D],X=E[2],c=E[1],j=E[0],s=T.x+"|"+T.y,I=D+"|"+s,I in A||(A[I]=X,H[X]=[E[C[s][0]],C[s][1]]),s=J.x+"|"+J.y,I=D+"|"+s,I in A||(A[I]=c,H[c]=[E[C[s][0]],C[s][1]]),s=K.x+"|"+K.y,I=D+"|"+s,I in A||(A[I]=j,H[j]=[E[C[s][0]],C[s][1]]),z=this.IDATA.edgematch[D][0],Q=this.IDATA.edgematch[D][1],"B"===Q)for(let M=1;M<B;M++)d.x=O-M*(g+e),d.y=S+M*g,w.x=-M*e,w.y=M*(g+e),s=d.x+"|"+d.y,Y=w.x+"|"+w.y,f(D,z,s,Y);if("O"===Q)for(let M=1;M<B;M++)w.x=-M*e,w.y=M*(g+e),G.x=M*g,G.y=M*e,s=w.x+"|"+w.y,Y=G.x+"|"+G.y,f(D,z,s,Y);if(z=this.IDATA.edgematch[D][2],Q=this.IDATA.edgematch[D][3],Q&&"A"===Q)for(let M=1;M<B;M++)G.x=M*g,G.y=M*e,d.x=O-(B-M)*(g+e),d.y=S+(B-M)*g,s=G.x+"|"+G.y,Y=d.x+"|"+d.y,f(D,z,s,Y);for(let O=0;O<this.vertices.length;O++)s=this.vertices[O].x+"|"+this.vertices[O].y,I=D+"|"+s,I in A||(A[I]=M++,C[s][0]>2?H[A[I]]=[-C[s][0],C[s][1],A[I]]:H[A[I]]=[E[C[s][0]],C[s][1],A[I]])}this.closestTo=H,this.vecToidx=A}calcCoeffs(){const M=this.m,A=this.n,O=Math.sqrt(3)/3,S=M*M+A*A+M*A;this.coau=(M+A)/S,this.cobu=-A/S,this.coav=-O*(M-A)/S,this.cobv=O*(2*M+A)/S}createInnerFacets(){const M=this.m,A=this.n;for(let O=0;O<A+M+1;O++)for(let M=this.min[O];M<this.max[O]+1;M++)M<this.max[O]&&M<this.max[O+1]+1&&this.innerFacets.push(["|"+M+"|"+O,"|"+M+"|"+(O+1),"|"+(M+1)+"|"+O]),O>0&&M<this.max[O-1]&&M+1<this.max[O]+1&&this.innerFacets.push(["|"+M+"|"+O,"|"+(M+1)+"|"+O,"|"+(M+1)+"|"+(O-1)])}edgeVecsABOB(){const M=this.m,A=this.n,O=new AM(-A,M+A);for(let S=1;S<M+A;S++){const M=new AM(this.min[S],S),A=new AM(this.min[S-1],S-1),z=new AM(this.min[S+1],S+1),Q=M.clone(),X=A.clone(),c=z.clone();Q.rotate60About(O),X.rotate60About(O),c.rotate60About(O);const j=new AM(this.max[Q.y],Q.y),B=new AM(this.max[Q.y-1],Q.y-1),g=new AM(this.max[Q.y-1]-1,Q.y-1);Q.x===j.x&&Q.y===j.y||(Q.x!==B.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,B,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,g,j])):Q.y===c.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,A,B]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([M,B,z])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([M,A,B]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([M,B,j])))}}mapABOBtoOBOA(){const M=new AM(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const O=[];for(let S=0;S<3;S++)M.x=this.isoVecsABOB[A][S].x,M.y=this.isoVecsABOB[A][S].y,0===this.vertexTypes[A][S]&&M.rotateNeg120(this.m,this.n),O.push(M.clone());this.isoVecsOBOA.push(O)}}mapABOBtoBAOA(){const M=new AM(0,0);for(let A=0;A<this.isoVecsABOB.length;A++){const O=[];for(let S=0;S<3;S++)M.x=this.isoVecsABOB[A][S].x,M.y=this.isoVecsABOB[A][S].y,1===this.vertexTypes[A][S]&&M.rotate120(this.m,this.n),O.push(M.clone());this.isoVecsBAOA.push(O)}}MapToFace(M,A){const O=this.IDATA.face[M],z=O[2],Q=O[1],X=O[0],c=S.GA.sA(this.IDATA.vertex[z]),j=S.GA.sA(this.IDATA.vertex[Q]),B=S.GA.sA(this.IDATA.vertex[X]),g=j.dA(c),e=B.dA(c),T=g.scale(this.coau).add(e.scale(this.cobu)),J=g.scale(this.coav).add(e.scale(this.cobv)),K=[];let G,d=S.TmpVectors.GA[0];for(let S=0;S<this.cartesian.length;S++)d=T.scale(this.cartesian[S].x).add(J.scale(this.cartesian[S].y)).add(c),K[S]=[d.x,d.y,d.z],G=M+"|"+this.vertices[S].x+"|"+this.vertices[S].y,A.vertex[this.vecToidx[G]]=[d.x,d.y,d.z]}build(M,A){const O=[],S=AM.Zero(),z=new AM(M,A),Q=new AM(-A,M+A);O.push(S,z,Q);for(let s=A;s<M+1;s++)for(let A=0;A<M+1-s;A++)O.push(new AM(A,s));if(A>0){const S=(0,q.HighestCommonFactor)(M,A),z=M/S,Q=A/S;for(let c=1;c<S;c++)O.push(new AM(c*z,c*Q)),O.push(new AM(-c*Q,c*(z+Q))),O.push(new AM(M-c*(z+Q),A+c*z));const X=M/A;for(let c=1;c<A;c++)for(let S=0;S<c*X;S++)O.push(new AM(S,c)),O.push(new AM(S,c).rotate120(M,A)),O.push(new AM(S,c).rotateNeg120(M,A))}O.sort(((M,A)=>M.x-A.x)),O.sort(((M,A)=>M.y-A.y));const X=new Array(M+A+1),c=new Array(M+A+1);for(let s=0;s<X.length;s++)X[s]=1/0,c[s]=-1/0;let j=0,B=0;const g=O.length;for(let s=0;s<g;s++)B=O[s].x,j=O[s].y,X[j]=Math.min(B,X[j]),c[j]=Math.max(B,c[j]);const e=(O,S)=>{const z=O.clone();return"A"===S&&z.rotateNeg120(M,A),"B"===S&&z.rotate120(M,A),z.x<0?z.y:z.x+z.y},T=[],J=[],K=[],G=[],d={},w=[];let I=-1,b=-1;for(let s=0;s<g;s++)T[s]=O[s].toCartesianOrigin(new AM(0,0),.5),J[s]=e(O[s],"O"),K[s]=e(O[s],"A"),G[s]=e(O[s],"B"),J[s]===K[s]&&K[s]===G[s]?(I=3,b=J[s]):J[s]===K[s]?(I=4,b=J[s]):K[s]===G[s]?(I=5,b=K[s]):G[s]===J[s]&&(I=6,b=J[s]),J[s]<K[s]&&J[s]<G[s]&&(I=2,b=J[s]),K[s]<J[s]&&K[s]<G[s]&&(I=1,b=K[s]),G[s]<K[s]&&G[s]<J[s]&&(I=0,b=G[s]),w.push([I,b,O[s].x,O[s].y]);w.sort(((M,A)=>M[2]-A[2])),w.sort(((M,A)=>M[3]-A[3])),w.sort(((M,A)=>M[1]-A[1])),w.sort(((M,A)=>M[0]-A[0]));for(let s=0;s<w.length;s++)d[w[s][2]+"|"+w[s][3]]=[w[s][0],w[s][1],s];return this.m=M,this.n=A,this.vertices=O,this.vertByDist=d,this.cartesian=T,this.min=X,this.max=c,this}}class SM{constructor(M,A,O,S){this.name=M,this.category=A,this.vertex=O,this.face=S}}class zM extends SM{innerToData(M,A){for(let O=0;O<A.innerFacets.length;O++)this.face.push(A.innerFacets[O].map((O=>A.vecToidx[M+O])))}mapABOBtoDATA(M,A){const O=A.IDATA.edgematch[M][0];for(let S=0;S<A.isoVecsABOB.length;S++){const z=[];for(let Q=0;Q<3;Q++)0===A.vertexTypes[S][Q]?z.push(M+"|"+A.isoVecsABOB[S][Q].x+"|"+A.isoVecsABOB[S][Q].y):z.push(O+"|"+A.isoVecsABOB[S][Q].x+"|"+A.isoVecsABOB[S][Q].y);this.face.push([A.vecToidx[z[0]],A.vecToidx[z[1]],A.vecToidx[z[2]]])}}mapOBOAtoDATA(M,A){const O=A.IDATA.edgematch[M][0];for(let S=0;S<A.isoVecsOBOA.length;S++){const z=[];for(let Q=0;Q<3;Q++)1===A.vertexTypes[S][Q]?z.push(M+"|"+A.isoVecsOBOA[S][Q].x+"|"+A.isoVecsOBOA[S][Q].y):z.push(O+"|"+A.isoVecsOBOA[S][Q].x+"|"+A.isoVecsOBOA[S][Q].y);this.face.push([A.vecToidx[z[0]],A.vecToidx[z[1]],A.vecToidx[z[2]]])}}mapBAOAtoDATA(M,A){const O=A.IDATA.edgematch[M][2];for(let S=0;S<A.isoVecsBAOA.length;S++){const z=[];for(let Q=0;Q<3;Q++)1===A.vertexTypes[S][Q]?z.push(M+"|"+A.isoVecsBAOA[S][Q].x+"|"+A.isoVecsBAOA[S][Q].y):z.push(O+"|"+A.isoVecsBAOA[S][Q].x+"|"+A.isoVecsBAOA[S][Q].y);this.face.push([A.vecToidx[z[0]],A.vecToidx[z[1]],A.vecToidx[z[2]]])}}orderData(M){const A=[];for(let Q=0;Q<13;Q++)A[Q]=[];const O=M.closestTo;for(let Q=0;Q<O.length;Q++)O[Q][0]>-1?O[Q][1]>0&&A[O[Q][0]].push([Q,O[Q][1]]):A[12].push([Q,O[Q][0]]);const S=[];for(let Q=0;Q<12;Q++)S[Q]=Q;let z=12;for(let Q=0;Q<12;Q++){A[Q].sort(((M,A)=>M[1]-A[1]));for(let M=0;M<A[Q].length;M++)S[A[Q][M][0]]=z++}for(let Q=0;Q<A[12].length;Q++)S[A[12][Q][0]]=z++;for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].push(S[Q]);this.vertex.sort(((M,A)=>M[3]-A[3]));for(let Q=0;Q<this.vertex.length;Q++)this.vertex[Q].pop();for(let Q=0;Q<this.face.length;Q++)for(let M=0;M<this.face[Q].length;M++)this.face[Q][M]=S[this.face[Q][M]];this.sharedNodes=A[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(M,A){const O=[],S=[];let z=A.pop();S.push(z);let Q=this.face[z].indexOf(M);Q=(Q+2)%3;let X=this.face[z][Q];O.push(X);let c=0;for(;A.length>0;)z=A[c],this.face[z].indexOf(X)>-1?(Q=(this.face[z].indexOf(X)+1)%3,X=this.face[z][Q],O.push(X),S.push(z),A.splice(c,1),c=0):c++;return this.adjacentFaces.push(O),S}toGoldbergPolyhedronData(){const M=new SM("GeoDual","Goldberg",[],[]);M.name="GD dual";const A=this.vertex.length,O=new Array(A);for(let j=0;j<A;j++)O[j]=[];for(let j=0;j<this.face.length;j++)for(let M=0;M<3;M++)O[this.face[j][M]].push(j);let S=0,z=0,Q=0,X=[],c=[];this.adjacentFaces=[];for(let j=0;j<O.length;j++){M.face[j]=this.setOrder(j,O[j].concat([]));for(const A of O[j]){S=0,z=0,Q=0,X=this.face[A];for(let M=0;M<3;M++)c=this.vertex[X[M]],S+=c[0],z+=c[1],Q+=c[2];M.vertex[A]=[S/3,z/3,Q/3]}}return M}static BuildGeodesicData(M){const A=new zM("Geodesic-m-n","Geodesic",[[0,MM.g,-1],[-MM.g,1,0],[-1,0,-MM.g],[1,0,-MM.g],[MM.g,1,0],[0,MM.g,1],[-1,0,MM.g],[-MM.g,-1,0],[0,-MM.g,-1],[MM.g,-1,0],[1,0,MM.g],[0,-MM.g,1]],[]);M.setIndices(),M.calcCoeffs(),M.createInnerFacets(),M.edgeVecsABOB(),M.mapABOBtoOBOA(),M.mapABOBtoBAOA();for(let O=0;O<M.IDATA.face.length;O++)M.MapToFace(O,A),A.innerToData(O,M),"B"===M.IDATA.edgematch[O][1]&&A.mapABOBtoDATA(O,M),"O"===M.IDATA.edgematch[O][1]&&A.mapOBOAtoDATA(O,M),"A"===M.IDATA.edgematch[O][3]&&A.mapBAOAtoDATA(O,M);A.orderData(M);return A.vertex=A.vertex.map((function(M){const A=M[0],O=M[1],S=M[2],z=Math.sqrt(A*A+O*O+S*S);return M[0]*=1/z,M[1]*=1/z,M[2]*=1/z,M})),A}}z.d._GoldbergMeshParser=(M,A)=>QM.Parse(M,A);class QM extends z.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(M,A){return void 0===A?(M>this.goldbergData.nbUnsharedFaces-1&&(l.c.Warn("Maximum number of unshared faces used"),M=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+M):(M>11&&(l.c.Warn("Last pole used"),M=11),A>this.goldbergData.nbFacesAtPole-1&&(l.c.Warn("Maximum number of faces at a pole used"),A=this.goldbergData.nbFacesAtPole-1),12+M*this.goldbergData.nbFacesAtPole+A)}_changeGoldbergFaceColors(M){for(let O=0;O<M.length;O++){const A=M[O][0],S=M[O][1],z=M[O][2];for(let M=A;M<S+1;M++)this.goldbergData.faceColors[M]=z}const A=[];for(let O=0;O<12;O++)for(let M=0;M<5;M++)A.push(this.goldbergData.faceColors[O].r,this.goldbergData.faceColors[O].g,this.goldbergData.faceColors[O].b,this.goldbergData.faceColors[O].a);for(let O=12;O<this.goldbergData.faceColors.length;O++)for(let M=0;M<6;M++)A.push(this.goldbergData.faceColors[O].r,this.goldbergData.faceColors[O].g,this.goldbergData.faceColors[O].b,this.goldbergData.faceColors[O].a);return A}setGoldbergFaceColors(M){const A=this._changeGoldbergFaceColors(M);this.LM(Q.c.ColorKind,A)}updateGoldbergFaceColors(M){const A=this._changeGoldbergFaceColors(M);this.updateVerticesData(Q.c.ColorKind,A)}_changeGoldbergFaceUVs(M){const A=this.getVerticesData(Q.c.UVKind);for(let O=0;O<M.length;O++){const S=M[O][0],z=M[O][1],Q=M[O][2],X=M[O][3],c=M[O][4],j=[],B=[];let g,e;for(let M=0;M<5;M++)g=Q.x+X*Math.cos(c+M*Math.PI/2.5),e=Q.y+X*Math.sin(c+M*Math.PI/2.5),g<0&&(g=0),g>1&&(g=1),j.push(g,e);for(let M=0;M<6;M++)g=Q.x+X*Math.cos(c+M*Math.PI/3),e=Q.y+X*Math.sin(c+M*Math.PI/3),g<0&&(g=0),g>1&&(g=1),B.push(g,e);for(let M=S;M<Math.min(12,z+1);M++)for(let O=0;O<5;O++)A[10*M+2*O]=j[2*O],A[10*M+2*O+1]=j[2*O+1];for(let M=Math.max(12,S);M<z+1;M++)for(let O=0;O<6;O++)A[12*M-24+2*O]=B[2*O],A[12*M-23+2*O]=B[2*O+1]}return A}setGoldbergFaceUVs(M){const A=this._changeGoldbergFaceUVs(M);this.LM(Q.c.UVKind,A)}updateGoldbergFaceUVs(M){const A=this._changeGoldbergFaceUVs(M);this.updateVerticesData(Q.c.UVKind,A)}placeOnGoldbergFaceAt(M,A,O){const z=S.GA.RotationFromAxis(this.goldbergData.faceXaxis[A],this.goldbergData.faceYaxis[A],this.goldbergData.faceZaxis[A]);M.rotation=z,M.position=this.goldbergData.faceCenters[A].add(this.goldbergData.faceXaxis[A].scale(O.x)).add(this.goldbergData.faceYaxis[A].scale(O.y)).add(this.goldbergData.faceZaxis[A].scale(O.z))}serialize(M){super.serialize(M),M.type="GoldbergMesh";const A={};if(A.adjacentFaces=this.goldbergData.adjacentFaces,A.nbSharedFaces=this.goldbergData.nbSharedFaces,A.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,A.nbFaces=this.goldbergData.nbFaces,A.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){A.faceColors=[];for(const M of this.goldbergData.faceColors)A.faceColors.push(M.gc())}if(this.goldbergData.faceCenters){A.faceCenters=[];for(const M of this.goldbergData.faceCenters)A.faceCenters.push(M.gc())}if(this.goldbergData.faceZaxis){A.faceZaxis=[];for(const M of this.goldbergData.faceZaxis)A.faceZaxis.push(M.gc())}if(this.goldbergData.faceYaxis){A.faceYaxis=[];for(const M of this.goldbergData.faceYaxis)A.faceYaxis.push(M.gc())}if(this.goldbergData.faceXaxis){A.faceXaxis=[];for(const M of this.goldbergData.faceXaxis)A.faceXaxis.push(M.gc())}M.goldbergData=A}static Parse(M,A){const O=M.goldbergData;O.faceColors=O.faceColors.map((M=>T.Cc.sA(M))),O.faceCenters=O.faceCenters.map((M=>S.GA.sA(M))),O.faceZaxis=O.faceZaxis.map((M=>S.GA.sA(M))),O.faceXaxis=O.faceXaxis.map((M=>S.GA.sA(M))),O.faceYaxis=O.faceYaxis.map((M=>S.GA.sA(M)));const z=new QM(M.name,A);return z.goldbergData=O,z}}var XM=O(13530);const cM={CreateBox:e.e,CreateTiledBox:d,CreateSphere:w.d,CreateDisc:g.b,CreateIcoSphere:v,CreateRibbon:B,CreateCylinder:Y,CreateTorus:H,CreateTorusKnot:f,CreateLineSystem:D.f,Og:D.i,CreateDashedLines:D.c,ExtrudeShape:y,ExtrudeShapeCustom:h,CreateLathe:i,CreateTiledPlane:K,Xg:U.b,CreateGround:L.i,CreateTiledGround:L.l,CreateGroundFromHeightMap:L.e,CreatePolygon:F.d,ExtrudePolygon:F.f,CreateTube:t,CreatePolyhedron:o,CreateGeodesic:function(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=A.m||1;S!==Math.floor(S)&&(S=Math.floor(S),l.c.Warn("m not an integer only floor(m) used"));let z=A.n||0;if(z!==Math.floor(z)&&(z=Math.floor(z),l.c.Warn("n not an integer only floor(n) used")),z>S){const M=z;z=S,S=M,l.c.Warn("n > m therefore m and n swapped")}const Q=new OM;return Q.build(S,z),o(M,{custom:zM.BuildGeodesicData(Q),size:A.size,sizeX:A.sizeX,sizeY:A.sizeY,sizeZ:A.sizeZ,faceUV:A.faceUV,faceColors:A.faceColors,flat:A.flat,updatable:A.updatable,sideOrientation:A.sideOrientation,frontUVs:A.frontUVs,backUVs:A.backUVs},O)},CreateGoldberg:function(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Q=A.size,j=A.sizeX||Q||1,B=A.sizeY||Q||1,g=A.sizeZ||Q||1;let e=A.m||1;e!==Math.floor(e)&&(e=Math.floor(e),l.c.Warn("m not an integer only floor(m) used"));let J=A.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),l.c.Warn("n not an integer only floor(n) used")),J>e){const M=J;J=e,e=M,l.c.Warn("n > m therefore m and n swapped")}const K=new OM;K.build(e,J);const G=zM.BuildGeodesicData(K),d=G.toGoldbergPolyhedronData(),w=new QM(M,O);A.sideOrientation=z.d._GetDefaultSideOrientation(A.sideOrientation),w._originalBuilderSideOrientation=A.sideOrientation;(function(M,A){const O=M.size,z=M.sizeX||O||1,Q=M.sizeY||O||1,j=M.sizeZ||O||1,B=0===M.sideOrientation?0:M.sideOrientation||X.e.DEFAULTSIDE,g=[],e=[],T=[],J=[];let K=1/0,G=-1/0,d=1/0,w=-1/0;for(let S=0;S<A.vertex.length;S++)K=Math.min(K,A.vertex[S][0]*z),G=Math.max(G,A.vertex[S][0]*z),d=Math.min(d,A.vertex[S][1]*Q),w=Math.max(w,A.vertex[S][1]*Q);let I=0;for(let X=0;X<A.face.length;X++){const M=A.face[X],O=S.GA.sA(A.vertex[M[0]]),B=S.GA.sA(A.vertex[M[2]]),b=S.GA.sA(A.vertex[M[1]]),s=B.dA(O),Y=b.dA(O),E=S.GA.Cross(Y,s).normalize();for(let S=0;S<M.length;S++){T.push(E.x,E.y,E.z);const O=A.vertex[M[S]];g.push(O[0]*z,O[1]*Q,O[2]*j);const X=(O[1]*Q-d)/(w-d);J.push((O[0]*z-K)/(G-K),c.d?1-X:X)}for(let A=0;A<M.length-2;A++)e.push(I,I+A+2,I+A+1);I+=M.length}X.e._ComputeSides(B,g,e,T,J);const b=new X.e;return b.fM=g,b.indices=e,b.DM=T,b.NM=J,b})(A,d).hM(w,A.updatable),w.goldbergData.nbSharedFaces=G.sharedNodes,w.goldbergData.nbUnsharedFaces=G.poleNodes,w.goldbergData.adjacentFaces=G.adjacentFaces,w.goldbergData.nbFaces=w.goldbergData.nbSharedFaces+w.goldbergData.nbUnsharedFaces,w.goldbergData.nbFacesAtPole=(w.goldbergData.nbUnsharedFaces-12)/12;for(let z=0;z<G.vertex.length;z++)w.goldbergData.faceCenters.push(S.GA.sA(G.vertex[z])),w.goldbergData.faceCenters[z].x*=j,w.goldbergData.faceCenters[z].y*=B,w.goldbergData.faceCenters[z].z*=g,w.goldbergData.faceColors.push(new T.Cc(1,1,1,1));for(let z=0;z<d.face.length;z++){const M=d.face[z],A=S.GA.sA(d.vertex[M[0]]),O=S.GA.sA(d.vertex[M[2]]),Q=S.GA.sA(d.vertex[M[1]]),X=O.dA(A),c=Q.dA(A),j=S.GA.Cross(c,X).normalize(),B=S.GA.Cross(c,j).normalize();w.goldbergData.faceXaxis.push(c.normalize()),w.goldbergData.faceYaxis.push(j),w.goldbergData.faceZaxis.push(B)}return w},CreateDecal:R,CreateCapsule:W,CreateText:XM.g}},13862:(M,A,O)=>{"use strict";O.d(A,{d:()=>jA});var S=O(12970),z=O(13350);class Q extends z.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var X=O(13010),c=(O(13154),O(12919));class j{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this._targetStopDuration!==M&&(this._targetStopDuration=M)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){this._noiseTexture!==M&&(this._noiseTexture=M,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(M){this._isAnimationSheetEnabled!=M&&(this._isAnimationSheetEnabled=M,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(M){this._useLogarithmicDepth=M&&this.HM().getEngine().getCaps().fragmentDepthSupported}HM(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(M){switch(M){case j.BLENDMODE_MULTIPLYADD:return;case j.BLENDMODE_ADD:M=1;break;case j.BLENDMODE_ONEONE:M=6;break;case j.BLENDMODE_STANDARD:M=2;break;case j.BLENDMODE_MULTIPLY:M=4;break;case j.BLENDMODE_SUBTRACT:M=3}this._engine.setAlphaMode(M)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:S.GA.Zero()}set direction1(M){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=M)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:S.GA.Zero()}set direction2(M){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=M)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:S.GA.Zero()}set minEmitBox(M){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=M)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:S.GA.Zero()}set maxEmitBox(M){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=M)}get billboardMode(){return this._billboardMode}set billboardMode(M){this._billboardMode!==M&&(this._billboardMode=M,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(M){this._isBillboardBased!==M&&(this._isBillboardBased=M,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(M){this._attachImageProcessingConfiguration(M)}_attachImageProcessingConfiguration(M){M!==this._imageProcessingConfiguration&&(!M&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=M)}_reset(){}_removeGradientAndTexture(M,A,O){if(!A)return this;let S=0;for(const z of A){if(z.gradient===M){A.splice(S,1);break}S++}return O&&O.dispose(),this}constructor(M){this.animations=[],this.renderingGroupId=0,this.SA=S.GA.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new S.GA(10,10,10),this.onAnimationEnd=null,this.blendMode=j.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new S.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.lB=new S.GA(0,0,0),this._useLogarithmicDepth=!1,this.gravity=S.GA.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new X.Cc(1,1,1,1),this.color2=new X.Cc(1,1,1,1),this.colorDead=new X.Cc(0,0,0,1),this.textureMask=new X.Cc(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Q,this.id=M,this.name=M}createPointEmitter(M,A){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new S.GA(0,1,0),arguments.length>2&&void 0!==arguments[2]||new S.GA(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new S.GA(0,1,0),arguments.length>4&&void 0!==arguments[4]||new S.GA(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new S.GA(0,1,0),arguments.length>3&&void 0!==arguments[3]||new S.GA(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(M,A,O,S){throw new Error("Method not implemented.")}}j.BLENDMODE_ONEONE=0,j.BLENDMODE_STANDARD=1,j.BLENDMODE_ADD=2,j.BLENDMODE_MULTIPLY=3,j.BLENDMODE_MULTIPLYADD=4,j.BLENDMODE_SUBTRACT=-1,(0,c.g)("BABYLON.BaseParticleSystem",j);var B=O(12980),g=O(12786);class e{constructor(){this.direction1=new S.GA(0,1,0),this.direction2=new S.GA(0,1,0),this.minEmitBox=new S.GA(-.5,-.5,-.5),this.maxEmitBox=new S.GA(.5,.5,.5)}startDirectionFunction(M,A,O,z){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),X=(0,B.RandomRange)(this.direction1.y,this.direction2.y),c=(0,B.RandomRange)(this.direction1.z,this.direction2.z);if(z)return A.x=Q,A.y=X,void(A.z=c);S.GA.TransformNormalFromFloatsToRef(Q,X,c,M,A)}startPositionFunction(M,A,O,z){const Q=(0,B.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),X=(0,B.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),c=(0,B.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(z)return A.x=Q,A.y=X,void(A.z=c);S.GA.TransformCoordinatesFromFloatsToRef(Q,X,c,M,A)}clone(){const M=new e;return g.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2),M.setVector3("minEmitBox",this.minEmitBox),M.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3),M.addUniform("minEmitBox",3),M.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.gc(),M.direction2=this.direction2.gc(),M.minEmitBox=this.minEmitBox.gc(),M.maxEmitBox=this.maxEmitBox.gc(),M}parse(M){S.GA.FromArrayToRef(M.direction1,0,this.direction1),S.GA.FromArrayToRef(M.direction2,0,this.direction2),S.GA.FromArrayToRef(M.minEmitBox,0,this.minEmitBox),S.GA.FromArrayToRef(M.maxEmitBox,0,this.maxEmitBox)}}class T{get radius(){return this._radius}set radius(M){this._radius=M,this._buildHeight()}get angle(){return this._angle}set angle(M){this._angle=M,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=O,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=A,this.radius=M}startDirectionFunction(M,A,O,z){z?S.TmpVectors.GA[0].S(O.uj).normalize():O.position.subtractToRef(M.getTranslation(),S.TmpVectors.GA[0]).normalize();const Q=(0,B.RandomRange)(0,this.directionRandomizer),X=(0,B.RandomRange)(0,this.directionRandomizer),c=(0,B.RandomRange)(0,this.directionRandomizer);A.x=S.TmpVectors.GA[0].x+Q,A.y=S.TmpVectors.GA[0].y+X,A.z=S.TmpVectors.GA[0].z+c,A.normalize()}startPositionFunction(M,A,O,z){const Q=(0,B.RandomRange)(0,2*Math.PI);let X;this.emitFromSpawnPointOnly?X=1e-4:(X=(0,B.RandomRange)(0,this.heightRange),X=1-X*X);let c=this._radius-(0,B.RandomRange)(0,this._radius*this.radiusRange);c*=X;const j=c*Math.sin(Q),g=c*Math.cos(Q),e=X*this._height;if(z)return A.x=j,A.y=e,void(A.z=g);S.GA.TransformCoordinatesFromFloatsToRef(j,e,g,M,A)}clone(){const M=new T(this._radius,this._angle,this.directionRandomizer);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat2("radius",this._radius,this.radiusRange),M.setFloat("coneAngle",this._angle),M.setFloat2("height",this._height,this.heightRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",2),M.addUniform("coneAngle",1),M.addUniform("height",2),M.addUniform("directionRandomizer",1)}getEffectDefines(){let M="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(M+="\n#define CONEEMITTERSPAWNPOINT"),M}getClassName(){return"ConeParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this._radius,M.angle=this._angle,M.directionRandomizer=this.directionRandomizer,M.radiusRange=this.radiusRange,M.heightRange=this.heightRange,M.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,M}parse(M){this.radius=M.radius,this.angle=M.angle,this.directionRandomizer=M.directionRandomizer,this.radiusRange=void 0!==M.radiusRange?M.radiusRange:1,this.heightRange=void 0!==M.radiusRange?M.heightRange:1,this.emitFromSpawnPointOnly=void 0!==M.emitFromSpawnPointOnly&&M.emitFromSpawnPointOnly}}class J extends T{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0);super(M,A),this.direction1=O,this.direction2=z}startDirectionFunction(M,A){const O=(0,B.RandomRange)(this.direction1.x,this.direction2.x),z=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,B.RandomRange)(this.direction1.z,this.direction2.z);S.GA.TransformNormalFromFloatsToRef(O,z,Q,M,A)}clone(){const M=new J(this.radius,this.angle,this.direction1,this.direction2);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.gc(),M.direction2=this.direction2.gc(),M}parse(M){super.parse(M),this.direction1.S(M.direction1),this.direction2.S(M.direction2)}}class K{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=M,this.height=A,this.radiusRange=O,this.directionRandomizer=z,this._tempVector=S.GA.Zero()}startDirectionFunction(M,A,O,z,Q){O.position.subtractToRef(M.getTranslation(),this._tempVector),this._tempVector.normalize(),S.GA.TransformNormalToRef(this._tempVector,Q,this._tempVector);const X=(0,B.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let c=Math.atan2(this._tempVector.x,this._tempVector.z);c+=(0,B.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=X,this._tempVector.x=Math.sin(c),this._tempVector.z=Math.cos(c),this._tempVector.normalize(),z?A.S(this._tempVector):S.GA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M,A)}startPositionFunction(M,A,O,z){const Q=(0,B.RandomRange)(-this.height/2,this.height/2),X=(0,B.RandomRange)(0,2*Math.PI),c=(0,B.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),j=Math.sqrt(c)*this.radius,g=j*Math.cos(X),e=j*Math.sin(X);z?A.Yc(g,Q,e):S.GA.TransformCoordinatesFromFloatsToRef(g,Q,e,M,A)}clone(){const M=new K(this.radius,this.directionRandomizer);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.height=this.height,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.height=M.height,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class G extends K{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.GA(0,1,0);super(M,A,O),this.direction1=z,this.direction2=Q}startDirectionFunction(M,A,O,z){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),X=(0,B.RandomRange)(this.direction1.y,this.direction2.y),c=(0,B.RandomRange)(this.direction1.z,this.direction2.z);z?A.Yc(Q,X,c):S.GA.TransformNormalFromFloatsToRef(Q,X,c,M,A)}clone(){const M=new G(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("height",this.height),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("height",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.gc(),M.direction2=this.direction2.gc(),M}parse(M){super.parse(M),S.GA.FromArrayToRef(M.direction1,0,this.direction1),S.GA.FromArrayToRef(M.direction2,0,this.direction2)}}class d{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=A,this.directionRandomizer=O}startDirectionFunction(M,A,O,z){const Q=O.position.dA(M.getTranslation()).normalize(),X=(0,B.RandomRange)(0,this.directionRandomizer),c=(0,B.RandomRange)(0,this.directionRandomizer),j=(0,B.RandomRange)(0,this.directionRandomizer);Q.x+=X,Q.y+=c,Q.z+=j,Q.normalize(),z?A.S(Q):S.GA.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,M,A)}startPositionFunction(M,A,O,z){const Q=this.radius-(0,B.RandomRange)(0,this.radius*this.radiusRange),X=(0,B.RandomRange)(0,1),c=(0,B.RandomRange)(0,2*Math.PI),j=Math.acos(2*X-1),g=Q*Math.cos(c)*Math.sin(j),e=Q*Math.cos(j),T=Q*Math.sin(c)*Math.sin(j);z?A.Yc(g,Math.abs(e),T):S.GA.TransformCoordinatesFromFloatsToRef(g,Math.abs(e),T,M,A)}clone(){const M=new d(this.radius,this.directionRandomizer);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class w{constructor(){this.direction1=new S.GA(0,1,0),this.direction2=new S.GA(0,1,0)}startDirectionFunction(M,A,O,z){const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),X=(0,B.RandomRange)(this.direction1.y,this.direction2.y),c=(0,B.RandomRange)(this.direction1.z,this.direction2.z);z?A.Yc(Q,X,c):S.GA.TransformNormalFromFloatsToRef(Q,X,c,M,A)}startPositionFunction(M,A,O,z){z?A.Yc(0,0,0):S.GA.TransformCoordinatesFromFloatsToRef(0,0,0,M,A)}clone(){const M=new w;return g.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.direction1=this.direction1.gc(),M.direction2=this.direction2.gc(),M}parse(M){S.GA.FromArrayToRef(M.direction1,0,this.direction1),S.GA.FromArrayToRef(M.direction2,0,this.direction2)}}class I{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=M,this.radiusRange=A,this.directionRandomizer=O}startDirectionFunction(M,A,O,z){const Q=O.position.dA(M.getTranslation()).normalize(),X=(0,B.RandomRange)(0,this.directionRandomizer),c=(0,B.RandomRange)(0,this.directionRandomizer),j=(0,B.RandomRange)(0,this.directionRandomizer);Q.x+=X,Q.y+=c,Q.z+=j,Q.normalize(),z?A.S(Q):S.GA.TransformNormalFromFloatsToRef(Q.x,Q.y,Q.z,M,A)}startPositionFunction(M,A,O,z){const Q=this.radius-(0,B.RandomRange)(0,this.radius*this.radiusRange),X=(0,B.RandomRange)(0,1),c=(0,B.RandomRange)(0,2*Math.PI),j=Math.acos(2*X-1),g=Q*Math.cos(c)*Math.sin(j),e=Q*Math.cos(j),T=Q*Math.sin(c)*Math.sin(j);z?A.Yc(g,e,T):S.GA.TransformCoordinatesFromFloatsToRef(g,e,T,M,A)}clone(){const M=new I(this.radius,this.directionRandomizer);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.radius=this.radius,M.radiusRange=this.radiusRange,M.directionRandomizer=this.directionRandomizer,M}parse(M){this.radius=M.radius,this.radiusRange=M.radiusRange,this.directionRandomizer=M.directionRandomizer}}class b extends I{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.GA(0,1,0),O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0);super(M),this.direction1=A,this.direction2=O}startDirectionFunction(M,A){const O=(0,B.RandomRange)(this.direction1.x,this.direction2.x),z=(0,B.RandomRange)(this.direction1.y,this.direction2.y),Q=(0,B.RandomRange)(this.direction1.z,this.direction2.z);S.GA.TransformNormalFromFloatsToRef(O,z,Q,M,A)}clone(){const M=new b(this.radius,this.direction1,this.direction2);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setFloat("radius",this.radius),M.setFloat("radiusRange",this.radiusRange),M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("radius",1),M.addUniform("radiusRange",1),M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const M=super.serialize();return M.direction1=this.direction1.gc(),M.direction2=this.direction2.gc(),M}parse(M){super.parse(M),this.direction1.S(M.direction1),this.direction2.S(M.direction2)}}class s{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(M,A,O,z){const Q=S.TmpVectors.GA[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,O,Q);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,O,Q);const M=S.TmpVectors.GA[1];Q.subtractToRef(O.position,M),M.scaleToRef(1/O.lifeTime,Q)}else Q.set(0,0,0);z?A.S(Q):S.GA.TransformNormalToRef(Q,M,A)}startPositionFunction(M,A,O,z){const Q=S.TmpVectors.GA[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,O,Q):Q.set(0,0,0),z?A.S(Q):S.GA.TransformCoordinatesToRef(Q,M,A)}clone(){const M=new s;return g.c.DeepCopy(this,M),M}applyToShader(M){}buildUniformLayout(M){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const M={};return M.type=this.getClassName(),M.particlePositionGenerator=this.particlePositionGenerator,M.particleDestinationGenerator=this.particleDestinationGenerator,M}parse(M){M.particlePositionGenerator&&(this.particlePositionGenerator=M.particlePositionGenerator),M.particleDestinationGenerator&&(this.particleDestinationGenerator=M.particleDestinationGenerator)}}var Y=O(13043);class E{get mesh(){return this._mesh}set mesh(M){this._mesh!==M&&(this._mesh=M,M?(this._indices=M.Ic(),this._positions=M.getVerticesData(Y.c.PositionKind),this._normals=M.getVerticesData(Y.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=S.GA.Zero(),this._mesh=null,this.direction1=new S.GA(0,1,0),this.direction2=new S.GA(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=M}startDirectionFunction(M,A,O,z){if(this.useMeshNormalsForDirection&&this._normals)return void S.GA.TransformNormalToRef(this._storedNormal,M,A);const Q=(0,B.RandomRange)(this.direction1.x,this.direction2.x),X=(0,B.RandomRange)(this.direction1.y,this.direction2.y),c=(0,B.RandomRange)(this.direction1.z,this.direction2.z);z?A.Yc(Q,X,c):S.GA.TransformNormalFromFloatsToRef(Q,X,c,M,A)}startPositionFunction(M,A,O,z){if(!this._indices||!this._positions)return;const Q=3*(Math.random()*(this._indices.length/3)|0),X=Math.random(),c=Math.random()*(1-X),j=1-X-c,B=this._indices[Q],g=this._indices[Q+1],e=this._indices[Q+2],T=S.TmpVectors.GA[0],J=S.TmpVectors.GA[1],K=S.TmpVectors.GA[2],G=S.TmpVectors.GA[3];S.GA.FromArrayToRef(this._positions,3*B,T),S.GA.FromArrayToRef(this._positions,3*g,J),S.GA.FromArrayToRef(this._positions,3*e,K),G.x=X*T.x+c*J.x+j*K.x,G.y=X*T.y+c*J.y+j*K.y,G.z=X*T.z+c*J.z+j*K.z,z?A.Yc(G.x,G.y,G.z):S.GA.TransformCoordinatesFromFloatsToRef(G.x,G.y,G.z,M,A),this.useMeshNormalsForDirection&&this._normals&&(S.GA.FromArrayToRef(this._normals,3*B,T),S.GA.FromArrayToRef(this._normals,3*g,J),S.GA.FromArrayToRef(this._normals,3*e,K),this._storedNormal.x=X*T.x+c*J.x+j*K.x,this._storedNormal.y=X*T.y+c*J.y+j*K.y,this._storedNormal.z=X*T.z+c*J.z+j*K.z)}clone(){const M=new E(this.mesh);return g.c.DeepCopy(this,M),M}applyToShader(M){M.setVector3("direction1",this.direction1),M.setVector3("direction2",this.direction2)}buildUniformLayout(M){M.addUniform("direction1",3),M.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var M;const A={};return A.type=this.getClassName(),A.direction1=this.direction1.gc(),A.direction2=this.direction2.gc(),A.meshId=null===(M=this.mesh)||void 0===M?void 0:M.id,A.useMeshNormalsForDirection=this.useMeshNormalsForDirection,A}parse(M,A){S.GA.FromArrayToRef(M.direction1,0,this.direction1),S.GA.FromArrayToRef(M.direction2,0,this.direction2),M.meshId&&A&&(this.mesh=A.getLastMeshById(M.meshId)),this.useMeshNormalsForDirection=M.useMeshNormalsForDirection}}class H{_isUbo(M){return void 0!==M.addUniform}constructor(M){this._isUbo(M)?(this.setMatrix3x3=M.updateMatrix3x3.bind(M),this.setMatrix2x2=M.updateMatrix2x2.bind(M),this.setFloat=M.updateFloat.bind(M),this.setFloat2=M.updateFloat2.bind(M),this.setFloat3=M.updateFloat3.bind(M),this.setFloat4=M.updateFloat4.bind(M),this.setFloatArray=M.updateFloatArray.bind(M),this.setArray=M.updateArray.bind(M),this.setIntArray=M.updateIntArray.bind(M),this.setMatrix=M.Kc.bind(M),this.setMatrices=M.updateMatrices.bind(M),this.setVector3=M.updateVector3.bind(M),this.setVector4=M.updateVector4.bind(M),this.setColor3=M.updateColor3.bind(M),this.setColor4=M.updateColor4.bind(M),this.setDirectColor4=M.updateDirectColor4.bind(M),this.setInt=M.updateInt.bind(M),this.setInt2=M.updateInt2.bind(M),this.setInt3=M.updateInt3.bind(M),this.setInt4=M.updateInt4.bind(M)):(this.setMatrix3x3=M.setMatrix3x3.bind(M),this.setMatrix2x2=M.setMatrix2x2.bind(M),this.setFloat=M.setFloat.bind(M),this.setFloat2=M.setFloat2.bind(M),this.setFloat3=M.setFloat3.bind(M),this.setFloat4=M.setFloat4.bind(M),this.setFloatArray=M.setFloatArray.bind(M),this.setArray=M.setArray.bind(M),this.setIntArray=M.setIntArray.bind(M),this.setMatrix=M.setMatrix.bind(M),this.setMatrices=M.setMatrices.bind(M),this.setVector3=M.setVector3.bind(M),this.setVector4=M.setVector4.bind(M),this.setColor3=M.setColor3.bind(M),this.setColor4=M.setColor4.bind(M),this.setDirectColor4=M.setDirectColor4.bind(M),this.setInt=M.setInt.bind(M),this.setInt2=M.setInt2.bind(M),this.setInt3=M.setInt3.bind(M),this.setInt4=M.setInt4.bind(M))}}var C=O(12864);const f="gpuUpdateParticlesPixelShader",D="#version 300 es\nvoid main() {discard;}\n";C.c.ShadersStore[f]||(C.c.ShadersStore[f]=D);const F="gpuUpdateParticlesVertexShader",N="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";C.c.ShadersStore[F]||(C.c.ShadersStore[F]=N);(0,c.g)("BABYLON.WebGL2ParticleSystem",class{constructor(M,A){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=M,this._engine=A,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var M,A;return null!==(M=null===(A=this._updateEffect)||void 0===A?void 0:A.isReady())&&void 0!==M&&M}createUpdateBuffer(M){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof s&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=M,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new H(this._updateEffect)}createVertexBuffers(M,A){this._updateVAO.push(this._createUpdateVAO(M)),this._renderVAO.push(this._engine.recordVertexArrayObject(A,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=A}createParticleBuffer(M){return M}bindDrawBuffers(M,A,O){O?this._engine.bindBuffers(this._renderVertexBuffers,O,A):this._engine.bindVertexArrayObject(this._renderVAO[M],null)}preUpdateParticleBuffer(){const M=this._engine;if(this._engine.enableEffect(this._updateEffect),!M.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(M,A,O){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[M],null);const S=this._engine;S.bindTransformFeedbackBuffer(A.getBuffer()),S.setRasterizerState(!1),S.beginTransformFeedback(!0),S.drawArraysType(3,0,O),S.endTransformFeedback(),S.setRasterizerState(!0),S.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let M=0;M<this._updateVAO.length;M++)this._engine.releaseVertexArrayObject(this._updateVAO[M]);this._updateVAO.length=0;for(let M=0;M<this._renderVAO.length;M++)this._engine.releaseVertexArrayObject(this._renderVAO[M]);this._renderVAO.length=0}_createUpdateVAO(M){const A={};A.position=M.createVertexBuffer("position",0,3);let O=3;A.age=M.createVertexBuffer("age",O,1),O+=1,A.size=M.createVertexBuffer("size",O,3),O+=3,A.life=M.createVertexBuffer("life",O,1),O+=1,A.seed=M.createVertexBuffer("seed",O,4),O+=4,A.direction=M.createVertexBuffer("direction",O,3),O+=3,this._parent.particleEmitterType instanceof s&&(A.initialPosition=M.createVertexBuffer("initialPosition",O,3),O+=3),this._parent._colorGradientsTexture||(A.color=M.createVertexBuffer("color",O,4),O+=4),this._parent._isBillboardBased||(A.initialDirection=M.createVertexBuffer("initialDirection",O,3),O+=3),this._parent.noiseTexture&&(A.noiseCoordinates1=M.createVertexBuffer("noiseCoordinates1",O,3),O+=3,A.noiseCoordinates2=M.createVertexBuffer("noiseCoordinates2",O,3),O+=3),this._parent._angularSpeedGradientsTexture?(A.angle=M.createVertexBuffer("angle",O,1),O+=1):(A.angle=M.createVertexBuffer("angle",O,2),O+=2),this._parent._isAnimationSheetEnabled&&(A.cellIndex=M.createVertexBuffer("cellIndex",O,1),O+=1,this._parent.spriteRandomStartCell&&(A.cellStartOffset=M.createVertexBuffer("cellStartOffset",O,1),O+=1));const S=this._engine.recordVertexArrayObject(A,null,this._updateEffect);return this._engine.bindArrayBuffer(null),S}});class y{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,S=arguments.length>3?arguments[3]:void 0;this._engine=M,this._label=S,this._engine._storageBuffers.push(this),this._create(A,O)}_create(M,A){this._bufferSize=M,this._creationFlags=A,this._buffer=this._engine.createStorageBuffer(M,A,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(M,A,O){this._buffer&&this._engine.updateStorageBuffer(this._buffer,M,A,O)}async read(M,A,O,S){return await this._engine.readFromStorageBuffer(this._buffer,M,A,O,S)}dispose(){const M=this._engine._storageBuffers,A=M.indexOf(this);-1!==A&&(M[A]=M[M.length-1],M.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var h=O(22),u=O(12958),i=O(12964),U=O(12998),L=O(12949),t=O(13261),x=O(12783),o=O(12897),p=O(13192);class v{constructor(){this._gpuTimeInFrameId=-1,this.counter=new p.e}_addDuration(M,A){M<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==M?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(A,!1),this._gpuTimeInFrameId=M):this.counter.addCount(A,!1))}}var q=O(12848);class r{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=M,this._engine=A,this.uniqueId=t.b.UniqueId,A.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new v),this._engine.getCaps().supportComputeShaders?S.bindingsMapping?(this._context=A.createComputeContext(),this._shaderPath=O,this._options=(0,h.d)({bindingsMapping:{},defines:[]},S)):x.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):x.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const S=this._bindings[M];this._bindings[M]={type:O?0:4,object:A,indexInGroupEntries:null===S||void 0===S?void 0:S.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!S||S.object!==A||S.type!==this._bindings[M].type)}setStorageTexture(M,A){const O=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!O||O.object!==A),this._bindings[M]={type:1,object:A,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries}}setExternalTexture(M,A){const O=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!O||O.object!==A),this._bindings[M]={type:6,object:A,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries}}setVideoTexture(M,A){return!!A.externalTexture&&(this.setExternalTexture(M,A.externalTexture),!0)}setUniformBuffer(M,A){const O=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!O||O.object!==A),this._bindings[M]={type:r._BufferIsDataBuffer(A)?7:2,object:A,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries}}setStorageBuffer(M,A){const O=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!O||O.object!==A),this._bindings[M]={type:r._BufferIsDataBuffer(A)?7:3,object:A,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries}}setTextureSampler(M,A){const O=this._bindings[M];this._contextIsDirty||(this._contextIsDirty=!O||!A.compareSampler(O.object)),this._bindings[M]={type:5,object:A,indexInGroupEntries:null===O||void 0===O?void 0:O.indexInGroupEntries}}isReady(){let M=this._effect;for(const z in this._bindings){const M=this._bindings[z],A=M.type,O=M.object;switch(A){case 0:case 4:case 1:if(!O.isReady())return!1;break;case 6:if(!O.isReady())return!1;break}}const A=[],O=this._shaderPath;if(this._options.defines)for(let z=0;z<this._options.defines.length;z++)A.push(this._options.defines[z]);const S=A.join("\n");return this._cachedDefines!==S&&(this._cachedDefines=S,M=this._engine.createComputeEffect(O,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=M),!!M.isReady()}dispatch(M,A,O){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,M,A,O,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const O=r._BufferIsDataBuffer(M)?M:M.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,O,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const A in this._bindings){const O=this._bindings[A];if(!this._options.bindingsMapping[A])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+A+"'");switch(O.type){case 0:{const S=this._samplers[A],z=O.object;var M;if(!S||!z._texture||!S.compareSampler(z._texture))this._samplers[A]=(new o.d).setParameters(z.wrapU,z.wrapV,z.wrapR,z.anisotropicFilteringLevel,z._texture.samplingMode,null===(M=z._texture)||void 0===M?void 0:M._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const M=O.object;M.getBuffer()!==O.buffer&&(O.buffer=M.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((z=>{(0,q.c)((()=>this.dispatch(M,A,O)),z,void 0,S)}))}serialize(){const M=U.e.Serialize(this);M.options=this._options,M.shaderPath=this._shaderPath,M.bJ={},M.textures={};for(const A in this._bindings){const O=this._bindings[A],S=O.object;switch(O.type){case 0:case 4:case 1:{const z=S.serialize();z&&(M.textures[A]=z,M.bJ[A]={type:O.type});break}}}return M}static Parse(M,A,O){const S=U.e.Parse((()=>new r(M.name,A.getEngine(),M.shaderPath,M.options)),M,A,O);for(const z in M.textures){const Q=M.bJ[z],X=L.c.Parse(M.textures[z],A,O);0===Q.type?S.setTexture(z,X):4===Q.type?S.setTexture(z,X,!1):S.setStorageTexture(z,X)}return S}static _BufferIsDataBuffer(M){return void 0!==M.underlyingResource}}(0,u.d)([(0,i.H)()],r.prototype,"name",void 0),(0,u.d)([(0,i.H)()],r.prototype,"fastMode",void 0),(0,c.g)("BABYLON.ComputeShader",r);var n=O(13235);const a="gpuUpdateParticlesComputeShader",V="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";C.c.ShadersStoreWGSL[a]||(C.c.ShadersStoreWGSL[a]=V);(0,c.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(M,A){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=M,this._engine=A}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var M,A;return null!==(M=null===(A=this._updateComputeShader)||void 0===A?void 0:A.isReady())&&void 0!==M&&M}createUpdateBuffer(M){var A;const O={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(O.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(O.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(O.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(O.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(O.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(O.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(O.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new r("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:O,defines:M.split("\n")}),null===(A=this._simParamsComputeShader)||void 0===A||A.dispose(),this._simParamsComputeShader=new n.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new H(this._simParamsComputeShader)}createVertexBuffers(M,A){this._renderVertexBuffers.push(A)}createParticleBuffer(M){const A=new y(this._engine,4*M.length,11,"ComputeShaderParticleSystemBuffer");return A.update(M),this._bufferComputeShader.push(A),A.getBuffer()}bindDrawBuffers(M,A,O){this._engine.bindBuffers(this._renderVertexBuffers[M],O,A)}preUpdateParticleBuffer(){}updateParticleBuffer(M,A,O){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[M]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^M]),this._updateComputeShader.dispatch(Math.ceil(O/64))}releaseBuffers(){var M;for(let A=0;A<this._bufferComputeShader.length;++A)this._bufferComputeShader[A].dispose();this._bufferComputeShader.length=0,null===(M=this._simParamsComputeShader)||void 0===M||M.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Z{constructor(M,A,O){this.gradient=M,this.color1=A,this.color2=O}getColorToRef(M){this.color2?X.Cc.LerpToRef(this.color1,this.color2,Math.random(),M):M.S(this.color1)}}class P{constructor(M,A){this.gradient=M,this.color=A}}class mM{constructor(M,A,O){this.gradient=M,this.factor1=A,this.factor2=O}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class R{static GetCurrentGradient(M,A,O){if(A[0].gradient>M)return void O(A[0],A[0],1);for(let z=0;z<A.length-1;z++){const S=A[z],Q=A[z+1];if(M>=S.gradient&&M<=Q.gradient){return void O(S,Q,(M-S.gradient)/(Q.gradient-S.gradient))}}const S=A.length-1;O(A[S],A[S],1)}}var k=O(12776),W=O(13447),l=O(12811);class MM{constructor(M){this.particleSystem=M,this.position=S.GA.Zero(),this.direction=S.GA.Zero(),this.color=new X.Cc(0,0,0,0),this.colorStep=new X.Cc(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new S.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new X.Cc(0,0,0,0),this._currentColor2=new X.Cc(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=MM._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let M=this.age,A=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===A?(A=1,M=this._randomCellOffset):M+=this._randomCellOffset);const O=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let S;S=this._initialSpriteCellLoop?(0,B.Clamp)(M*A%this.lifeTime/this.lifeTime):(0,B.Clamp)(M*A/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+S*O|0}_inheritParticleInfoToSubEmitter(M){if(M.particleSystem.SA.position){const A=M.particleSystem.SA;if(A.position.S(this.position),M.inheritDirection){const M=S.TmpVectors.GA[0];this.direction.normalizeToRef(M),A.setDirection(M,0,Math.PI/2)}}else{M.particleSystem.SA.S(this.position)}this.direction.scaleToRef(M.inheritedVelocityAmount/2,S.TmpVectors.GA[0]),M.particleSystem._inheritedVelocityOffset.S(S.TmpVectors.GA[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const M of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(M)}_reset(){this.age=0,this.id=MM._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(M){M.position.S(this.position),this._initialDirection?M._initialDirection?M._initialDirection.S(this._initialDirection):M._initialDirection=this._initialDirection.clone():M._initialDirection=null,M.direction.S(this.direction),this.uj&&(M.uj?M.uj.S(this.uj):M.uj=this.uj.clone()),M.color.S(this.color),M.colorStep.S(this.colorStep),M.lifeTime=this.lifeTime,M.age=this.age,M._randomCellOffset=this._randomCellOffset,M.size=this.size,M.scale.S(this.scale),M.angle=this.angle,M.angularSpeed=this.angularSpeed,M.particleSystem=this.particleSystem,M.cellIndex=this.cellIndex,M.id=this.id,M._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(M._currentColorGradient=this._currentColorGradient,M._currentColor1.S(this._currentColor1),M._currentColor2.S(this._currentColor2)),this._currentSizeGradient&&(M._currentSizeGradient=this._currentSizeGradient,M._currentSize1=this._currentSize1,M._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(M._currentAngularSpeedGradient=this._currentAngularSpeedGradient,M._currentAngularSpeed1=this._currentAngularSpeed1,M._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(M._currentVelocityGradient=this._currentVelocityGradient,M._currentVelocity1=this._currentVelocity1,M._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(M._currentLimitVelocityGradient=this._currentLimitVelocityGradient,M._currentLimitVelocity1=this._currentLimitVelocity1,M._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(M._currentDragGradient=this._currentDragGradient,M._currentDrag1=this._currentDrag1,M._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(M._initialStartSpriteCellId=this._initialStartSpriteCellId,M._initialEndSpriteCellId=this._initialEndSpriteCellId,M._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(M.remapData&&this.remapData?M.remapData.S(this.remapData):M.remapData=new S.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.S(this._randomNoiseCoordinates1),M._randomNoiseCoordinates2.S(this._randomNoiseCoordinates2)):(M._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),M._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}MM._Count=0;var AM=O(13096),OM=(O(13152),O(13329)),SM=O(13322),zM=O(13232);function QM(M,A){const O=(0,B.RandomRange)(0,1);X.Cc.LerpToRef(A.color1,A.color2,O,M.color),A.colorDead.subtractToRef(M.color,A._colorDiff),A._colorDiff.scaleToRef(1/M.lifeTime,M.colorStep)}function XM(M,A){M._currentColorGradient=A._colorGradients[0],M._currentColorGradient.getColorToRef(M.color),M._currentColor1.S(M.color),A._colorGradients.length>1?A._colorGradients[1].getColorToRef(M._currentColor2):M._currentColor2.S(M.color)}function cM(M,A){const O=A._colorGradients;R.GetCurrentGradient(A._ratio,O,((A,O,S)=>{A!==M._currentColorGradient&&(M._currentColor1.S(M._currentColor2),O.getColorToRef(M._currentColor2),M._currentColorGradient=A),X.Cc.LerpToRef(M._currentColor1,M._currentColor2,S,M.color)}))}function jM(M,A){M.colorStep.scaleToRef(A._scaledUpdateSpeed,A._scaledColorStep),M.color.addInPlace(A._scaledColorStep),M.color.a<0&&(M.color.a=0)}function BM(M,A){R.GetCurrentGradient(A._ratio,A._angularSpeedGradients,((A,O,S)=>{A!==M._currentAngularSpeedGradient&&(M._currentAngularSpeed1=M._currentAngularSpeed2,M._currentAngularSpeed2=O.getFactor(),M._currentAngularSpeedGradient=A),M.angularSpeed=(0,B.Lerp)(M._currentAngularSpeed1,M._currentAngularSpeed2,S)}))}function gM(M,A){M.angle+=M.angularSpeed*A._scaledUpdateSpeed}function eM(M,A){A.particleEmitterType.startDirectionFunction(A._emitterWorldMatrix,M.direction,M,A.isLocal,A._emitterInverseWorldMatrix)}function TM(M,A){A.startDirectionFunction(A._emitterWorldMatrix,M.direction,M,A.isLocal)}function JM(M,A){M._currentVelocityGradient=A._velocityGradients[0],M._currentVelocity1=M._currentVelocityGradient.getFactor(),A._velocityGradients.length>1?M._currentVelocity2=A._velocityGradients[1].getFactor():M._currentVelocity2=M._currentVelocity1}function KM(M,A){M._currentLimitVelocityGradient=A._limitVelocityGradients[0],M._currentLimitVelocity1=M._currentLimitVelocityGradient.getFactor(),A._limitVelocityGradients.length>1?M._currentLimitVelocity2=A._limitVelocityGradients[1].getFactor():M._currentLimitVelocity2=M._currentLimitVelocity1}function GM(M,A){R.GetCurrentGradient(A._ratio,A._velocityGradients,((O,S,z)=>{O!==M._currentVelocityGradient&&(M._currentVelocity1=M._currentVelocity2,M._currentVelocity2=S.getFactor(),M._currentVelocityGradient=O),A._directionScale*=(0,B.Lerp)(M._currentVelocity1,M._currentVelocity2,z)}))}function dM(M,A){R.GetCurrentGradient(A._ratio,A._limitVelocityGradients,((O,S,z)=>{O!==M._currentLimitVelocityGradient&&(M._currentLimitVelocity1=M._currentLimitVelocity2,M._currentLimitVelocity2=S.getFactor(),M._currentLimitVelocityGradient=O);const Q=(0,B.Lerp)(M._currentLimitVelocity1,M._currentLimitVelocity2,z);M.direction.length()>Q&&M.direction.scaleInPlace(A.limitVelocityDamping)}))}function wM(M,A){M.direction.scaleToRef(A._directionScale,A._scaledDirection)}function IM(M,A){A.particleEmitterType.startPositionFunction(A._emitterWorldMatrix,M.position,M,A.isLocal)}function bM(M,A){A.startPositionFunction(A._emitterWorldMatrix,M.position,M,A.isLocal)}function sM(M,A){M.uj?M.uj.S(M.position):M.uj=M.position.clone(),S.GA.TransformCoordinatesToRef(M.uj,A._emitterWorldMatrix,M.position)}function YM(M,A){A.isLocal&&M.uj?(M.uj.addInPlace(A._scaledDirection),S.GA.TransformCoordinatesToRef(M.uj,A._emitterWorldMatrix,M.position)):M.position.addInPlace(A._scaledDirection)}function EM(M,A){M._currentDragGradient=A._dragGradients[0],M._currentDrag1=M._currentDragGradient.getFactor(),A._dragGradients.length>1?M._currentDrag2=A._dragGradients[1].getFactor():M._currentDrag2=M._currentDrag1}function HM(M,A){R.GetCurrentGradient(A._ratio,A._dragGradients,((O,S,z)=>{O!==M._currentDragGradient&&(M._currentDrag1=M._currentDrag2,M._currentDrag2=S.getFactor(),M._currentDragGradient=O);const Q=(0,B.Lerp)(M._currentDrag1,M._currentDrag2,z);A._scaledDirection.scaleInPlace(1-Q)}))}function CM(M,A){M._randomNoiseCoordinates1?(M._randomNoiseCoordinates1.Yc(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2.Yc(Math.random(),Math.random(),Math.random())):(M._randomNoiseCoordinates1=new S.GA(Math.random(),Math.random(),Math.random()),M._randomNoiseCoordinates2=new S.GA(Math.random(),Math.random(),Math.random()))}function fM(M,A){const O=A._noiseTextureData,z=A._noiseTextureSize;if(O&&z&&M._randomNoiseCoordinates1){const Q=A._fetchR(M._randomNoiseCoordinates1.x,M._randomNoiseCoordinates1.y,z.width,z.height,O),X=A._fetchR(M._randomNoiseCoordinates1.z,M._randomNoiseCoordinates2.x,z.width,z.height,O),c=A._fetchR(M._randomNoiseCoordinates2.y,M._randomNoiseCoordinates2.z,z.width,z.height,O),j=S.TmpVectors.GA[0],B=S.TmpVectors.GA[1];j.Yc((2*Q-1)*A.noiseStrength.x,(2*X-1)*A.noiseStrength.y,(2*c-1)*A.noiseStrength.z),j.scaleToRef(A._tempScaledUpdateSpeed,B),M.direction.addInPlace(B)}}function DM(M,A){A.gravity.scaleToRef(A._tempScaledUpdateSpeed,A._scaledGravity),M.direction.addInPlace(A._scaledGravity)}function FM(M,A){M.size=(0,B.RandomRange)(A.minSize,A.maxSize),M.scale.Yc((0,B.RandomRange)(A.minScaleX,A.maxScaleX),(0,B.RandomRange)(A.minScaleY,A.maxScaleY))}function NM(M,A){M._currentSizeGradient=A._sizeGradients[0],M._currentSize1=M._currentSizeGradient.getFactor(),M.size=M._currentSize1,A._sizeGradients.length>1?M._currentSize2=A._sizeGradients[1].getFactor():M._currentSize2=M._currentSize1,M.scale.Yc((0,B.RandomRange)(A.minScaleX,A.maxScaleX),(0,B.RandomRange)(A.minScaleY,A.maxScaleY))}function yM(M,A){const O=A._actualFrame/A.targetStopDuration;R.GetCurrentGradient(O,A._startSizeGradients,((O,S,z)=>{O!==A._currentStartSizeGradient&&(A._currentStartSize1=A._currentStartSize2,A._currentStartSize2=S.getFactor(),A._currentStartSizeGradient=O);const Q=(0,B.Lerp)(A._currentStartSize1,A._currentStartSize2,z);M.scale.scaleInPlace(Q)}))}function hM(M,A){R.GetCurrentGradient(A._ratio,A._sizeGradients,((A,O,S)=>{A!==M._currentSizeGradient&&(M._currentSize1=M._currentSize2,M._currentSize2=O.getFactor(),M._currentSizeGradient=A),M.size=(0,B.Lerp)(M._currentSize1,M._currentSize2,S)}))}function uM(M,A){M.remapData=new S.Vector4(0,1,0,1)}function iM(M,A){A._colorRemapGradients&&A._colorRemapGradients.length>0&&R.GetCurrentGradient(A._ratio,A._colorRemapGradients,((A,O,S)=>{const z=(0,B.Lerp)(A.factor1,O.factor1,S),Q=(0,B.Lerp)(A.factor2,O.factor2,S);M.remapData.x=z,M.remapData.y=Q-z})),A._alphaRemapGradients&&A._alphaRemapGradients.length>0&&R.GetCurrentGradient(A._ratio,A._alphaRemapGradients,((A,O,S)=>{const z=(0,B.Lerp)(A.factor1,O.factor1,S),Q=(0,B.Lerp)(A.factor2,O.factor2,S);M.remapData.z=z,M.remapData.w=Q-z}))}function UM(M,A){const O=(0,B.Clamp)(A._actualFrame/A.targetStopDuration);R.GetCurrentGradient(O,A._lifeTimeGradients,((A,S)=>{const z=A,Q=S,X=z.getFactor(),c=Q.getFactor(),j=(O-z.gradient)/(Q.gradient-z.gradient);M.lifeTime=(0,B.Lerp)(X,c,j)})),A._emitPower=(0,B.RandomRange)(A.minEmitPower,A.maxEmitPower)}function LM(M,A){M.lifeTime=(0,B.RandomRange)(A.minLifeTime,A.maxLifeTime),A._emitPower=(0,B.RandomRange)(A.minEmitPower,A.maxEmitPower)}function tM(M,A){0===A._emitPower?(M._initialDirection?M._initialDirection.S(M.direction):M._initialDirection=M.direction.clone(),M.direction.set(0,0,0)):(M._initialDirection=null,M.direction.scaleInPlace(A._emitPower)),M.direction.addInPlace(A._inheritedVelocityOffset)}function xM(M,A){M.angularSpeed=(0,B.RandomRange)(A.minAngularSpeed,A.maxAngularSpeed),M.angle=(0,B.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function oM(M,A){M._currentAngularSpeedGradient=A._angularSpeedGradients[0],M.angularSpeed=M._currentAngularSpeedGradient.getFactor(),M._currentAngularSpeed1=M.angularSpeed,A._angularSpeedGradients.length>1?M._currentAngularSpeed2=A._angularSpeedGradients[1].getFactor():M._currentAngularSpeed2=M._currentAngularSpeed1,M.angle=(0,B.RandomRange)(A.minInitialRotation,A.maxInitialRotation)}function pM(M,A){M._initialStartSpriteCellId=A.startSpriteCellID,M._initialEndSpriteCellId=A.endSpriteCellID,M._initialSpriteCellLoop=A.spriteCellLoop}function vM(M,A){M.previousItem=A.previousItem,M.nextItem=A,A.previousItem&&(A.previousItem.nextItem=M),A.previousItem=M}function qM(M,A){M.previousItem=A,M.nextItem=A.nextItem,A.nextItem&&(A.nextItem.previousItem=M),A.nextItem=M}function rM(M,A){let O=A;for(;O.nextItem;)O=O.nextItem;M.previousItem=O,M.nextItem=O.nextItem,O.nextItem=M}function nM(M){M.previousItem&&(M.previousItem.nextItem=M.nextItem),M.nextItem&&(M.nextItem.previousItem=M.previousItem)}class aM extends j{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(M){this._startDirectionFunction!==M&&(this._startDirectionFunction=M,this._directionProcessing.process=M?TM:eM)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(M){this._startPositionFunction!==M&&(this._startPositionFunction=M,this._positionCreation.process=M?bM:IM)}set onDispose(M){this._onDisposeObserver&&this.Ac.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ac.add(M)}get T(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(M){this._useRampGradients!==M&&(this._useRampGradients=M,this._resetEffect(),M?(this._rampCreation={process:uM,previousItem:null,nextItem:null},qM(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:iM,previousItem:null,nextItem:null},qM(this._remapGradientProcessing,this._gravityProcessing)):(nM(this._rampCreation),nM(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(M){this._isLocal!==M&&(this._isLocal=M,M?(this._isLocalCreation={process:sM,previousItem:null,nextItem:null},qM(this._isLocalCreation,this._positionCreation)):nM(this._isLocalCreation))}get particles(){return this.KJ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(M){this._animationSheetEnabled!==M&&(this._animationSheetEnabled=M,M?(this._sheetCreation={process:pM,previousItem:null,nextItem:null},qM(this._sheetCreation,this._colorCreation)):nM(this._sheetCreation),this._reset())}getActiveCount(){return this.KJ.length}getClassName(){return"uc"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var M,A;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(M=null===(A=this._customWrappers[O])||void 0===A?void 0:A.effect)&&void 0!==M?M:this._customWrappers[0].effect}_getCustomDrawWrapper(){var M;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(M=this._customWrappers[A])&&void 0!==M?M:this._customWrappers[0]}setCustomEffect(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new AM.c(this._engine),this._customWrappers[A].effect=M,this._customWrappers[A].drawContext&&(this._customWrappers[A].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(M){if(this.noiseTexture!==M){if(this._noiseTexture=M,!M)return nM(this._noiseCreation),void nM(this._noiseProcessing);this._noiseCreation={process:CM,previousItem:null,nextItem:null},qM(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:fM,previousItem:null,nextItem:null},qM(this._noiseProcessing,this._positionProcessing)}}constructor(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(M),this._emitterInverseWorldMatrix=S.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new S.GA,this.Ac=new k.c,this.onStoppedObservable=new k.c,this.onStartedObservable=new k.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.KJ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new X.Cc(0,0,0,0),this._colorDiff=new X.Cc(0,0,0,0),this._scaledDirection=S.GA.Zero(),this._scaledGravity=S.GA.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=M=>{},this.recycleParticle=M=>{const A=this.KJ.pop();A!==M&&A.copyTo(M),this._stockParticles.push(A)},this._createParticle=()=>{let M;return 0!==this._stockParticles.length?(M=this._stockParticles.pop(),M._reset()):M=new MM(this),this._prepareParticle(M),M},this.paused=!1,this._shadersLoaded=!1,this._capacity=A,this._epsilon=c,O&&"Scene"!==O.getClassName()?(this._engine=O,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=O||l.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.TJ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:LM,previousItem:null,nextItem:null},this._positionCreation={process:IM,previousItem:null,nextItem:null},qM(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:eM,previousItem:null,nextItem:null},qM(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:tM,previousItem:null,nextItem:null},qM(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:FM,previousItem:null,nextItem:null},qM(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:xM,previousItem:null,nextItem:null},qM(this._angleCreation,this._sizeCreation),this._colorCreation={process:QM,previousItem:null,nextItem:null},qM(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,j||(this._colorProcessing={process:jM,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:gM,previousItem:null,nextItem:null},qM(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:wM,previousItem:null,nextItem:null},qM(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:YM,previousItem:null,nextItem:null},qM(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:DM,previousItem:null,nextItem:null},qM(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=Q,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new AM.c(this._engine)},this._customWrappers[0].effect=z,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new e,this.updateFunction=M=>{var A;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(A=this.noiseTexture.getContent())||void 0===A||A.then((M=>{this._noiseTextureData=M})));const O=M===this.KJ;for(let S=0;S<M.length;S++){const A=M[S];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const z=A.age;if(A.age+=this._tempScaledUpdateSpeed,A.age>A.lifeTime){const M=A.age-z,O=A.lifeTime-z;this._tempScaledUpdateSpeed=O*this._tempScaledUpdateSpeed/M,A.age=A.lifeTime}this._ratio=A.age/A.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let Q=this._updateQueueStart;for(;Q;)Q.process(A,this),Q=Q.nextItem;if(this._isAnimationSheetEnabled&&!j&&A.updateCellIndex(),A._inheritParticleInfoToSubEmitters(),A.age>=A.lifeTime){if(this._emitFromParticle(A),A._attachedSubEmitters){for(const M of A._attachedSubEmitters)M.particleSystem.disposeOnStop=!0,M.particleSystem.stop();A._attachedSubEmitters=null}this.recycleParticle(A),O&&S--}else;}}}serialize(M){throw new Error("Method not implemented.")}clone(M,A){throw new Error("Method not implemented.")}_addFactorGradient(M,A,O,S){const z=new mM(A,O,S);M.push(z),M.sort(((M,A)=>M.gradient<A.gradient?-1:M.gradient>A.gradient?1:0))}_removeFactorGradient(M,A){if(!M)return;let O=0;for(const S of M){if(S.gradient===A){M.splice(O,1);break}O++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=UM:this._lifeTimeCreation.process=LM}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:yM,previousItem:null,nextItem:null},qM(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(nM(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(M){this.targetStopDuration!==M&&(this._targetStopDuration=M,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(M,A,O){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,M,A,O),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(M){return this._removeFactorGradient(this._lifeTimeGradients,M),this._syncLifeTimeCreation(),this}addSizeGradient(M,A,O){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=NM,this._sizeGradientProcessing={process:hM,previousItem:null,nextItem:null},vM(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,M,A,O),this}removeSizeGradient(M){var A;return this._removeFactorGradient(this._sizeGradients,M),0===(null===(A=this._sizeGradients)||void 0===A?void 0:A.length)&&(nM(this._sizeGradientProcessing),this._sizeCreation.process=FM),this}addColorRemapGradient(M,A,O){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,M,A,O),this}removeColorRemapGradient(M){return this._removeFactorGradient(this._colorRemapGradients,M),this}addAlphaRemapGradient(M,A,O){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,M,A,O),this}removeAlphaRemapGradient(M){return this._removeFactorGradient(this._alphaRemapGradients,M),this}addAngularSpeedGradient(M,A,O){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oM,this._angularSpeedGradientProcessing={process:BM,previousItem:null,nextItem:null},vM(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,M,A,O),this}removeAngularSpeedGradient(M){var A;return this._removeFactorGradient(this._angularSpeedGradients,M),0===(null===(A=this._angularSpeedGradients)||void 0===A?void 0:A.length)&&(this._angleCreation.process=xM,nM(this._angularSpeedGradientProcessing)),this}addVelocityGradient(M,A,O){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:JM,previousItem:null,nextItem:null},qM(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:GM,previousItem:null,nextItem:null},vM(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,M,A,O),this}removeVelocityGradient(M){var A;return this._removeFactorGradient(this._velocityGradients,M),0===(null===(A=this._velocityGradients)||void 0===A?void 0:A.length)&&(nM(this._velocityCreation),nM(this._velocityGradientProcessing)),this}addLimitVelocityGradient(M,A,O){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:KM,previousItem:null,nextItem:null},qM(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:dM,previousItem:null,nextItem:null},qM(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,M,A,O),this}removeLimitVelocityGradient(M){var A;return this._removeFactorGradient(this._limitVelocityGradients,M),0===(null===(A=this._limitVelocityGradients)||void 0===A?void 0:A.length)&&(nM(this._limitVelocityCreation),nM(this._limitVelocityGradientProcessing)),this}addDragGradient(M,A,O){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:EM,previousItem:null,nextItem:null},vM(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:HM,previousItem:null,nextItem:null},vM(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,M,A,O),this}removeDragGradient(M){var A;return this._removeFactorGradient(this._dragGradients,M),0===(null===(A=this._dragGradients)||void 0===A?void 0:A.length)&&(nM(this._dragCreation),nM(this._dragGradientProcessing)),this}addEmitRateGradient(M,A,O){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,M,A,O),this}removeEmitRateGradient(M){return this._removeFactorGradient(this._emitRateGradients,M),this}addStartSizeGradient(M,A,O){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,M,A,O),this._syncStartSizeCreation(),this}removeStartSizeGradient(M){return this._removeFactorGradient(this._startSizeGradients,M),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const M=new Uint8Array(4*this._rawTextureWidth),A=X.TmpColors.bA[0];for(let O=0;O<this._rawTextureWidth;O++){const S=O/this._rawTextureWidth;R.GetCurrentGradient(S,this._rampGradients,((S,z,Q)=>{X.bA.LerpToRef(S.color,z.color,Q,A),M[4*O]=255*A.r,M[4*O+1]=255*A.g,M[4*O+2]=255*A.b,M[4*O+3]=255}))}this._rampGradientsTexture=W.d.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((M,A)=>M.gradient<A.gradient?-1:M.gradient>A.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(M,A){this._rampGradients||(this._rampGradients=[]);const O=new P(M,A);return this._rampGradients.push(O),this._syncRampGradientTexture(),this}removeRampGradient(M){return this._removeGradientAndTexture(M,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(M,A,O){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=XM,this._colorProcessing.process=cM);const S=new Z(M,A,O);return this._colorGradients.push(S),this._colorGradients.sort(((M,A)=>M.gradient<A.gradient?-1:M.gradient>A.gradient?1:0)),this}removeColorGradient(M){if(!this._colorGradients)return this;let A=0;for(const O of this._colorGradients){if(O.gradient===M){this._colorGradients.splice(A,1);break}A++}return 0===this._colorGradients.length&&(this._colorCreation.process=QM,this._colorProcessing.process=jM),this}resetDrawCache(){if(this._drawWrappers){for(const M of this._drawWrappers)if(M)for(const A of M)null===A||void 0===A||A.dispose();this._drawWrappers=[]}}_fetchR(M,A,O,S,z){return z[4*(((M=.5*Math.abs(M)+.5)*O%O|0)+((A=.5*Math.abs(A)+.5)*S%S|0)*O)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const M=this._engine,A=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*A),this._vertexBuffer=new Y.b(M,this._vertexData,!0,A);let O=0;const S=this._vertexBuffer.createVertexBuffer(Y.c.PositionKind,O,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.c.PositionKind]=S,O+=3;const z=this._vertexBuffer.createVertexBuffer(Y.c.ColorKind,O,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Y.c.ColorKind]=z,O+=4;const Q=this._vertexBuffer.createVertexBuffer("angle",O,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Q,O+=1;const X=this._vertexBuffer.createVertexBuffer("size",O,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=X,O+=2,this._isAnimationSheetEnabled){const M=this._vertexBuffer.createVertexBuffer("cellIndex",O,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=M,O+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const M=this._vertexBuffer.createVertexBuffer("direction",O,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=M,O+=3}if(this._useRampGradients){const M=this._vertexBuffer.createVertexBuffer("remapData",O,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=M,O+=4}let c;if(this._useInstancing){const A=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Y.b(M,A,!1,2),c=this._spriteBuffer.createVertexBuffer("offset",0,2)}else c=this._vertexBuffer.createVertexBuffer("offset",O,2,this._vertexBufferSize,this._useInstancing),O+=2;this._vertexBuffers.offset=c,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const M=[],A=[];let O=0;for(let S=0;S<this._capacity;S++)M.push(O),M.push(O+1),M.push(O+2),M.push(O),M.push(O+2),M.push(O+3),A.push(O,O+1,O+1,O+2,O+2,O+3,O+3,O,O,O+3),O+=4;this._indexBuffer=this._engine.createIndexBuffer(M),this._linesIndexBuffer=this._engine.createIndexBuffer(A)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(M)setTimeout((()=>{this.start(0)}),M);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var A;-1!==(null===(A=this.SA)||void 0===A?void 0:A.getClassName().indexOf("Mesh"))&&this.SA.Gc(!0);const M=this.noiseTexture;if(M&&M.onGeneratedObservable)M.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let A=0;A<this.preWarmCycles;A++)this.animate(!0),M.render()}))}));else for(let A=0;A<this.preWarmCycles;A++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(M))}_postStop(M){}reset(){this._stockParticles.length=0,this.KJ.length=0}_appendParticleVertex(M,A,O,z){let Q=M*this._vertexBufferSize;if(this._vertexData[Q++]=A.position.x+this.lB.x,this._vertexData[Q++]=A.position.y+this.lB.y,this._vertexData[Q++]=A.position.z+this.lB.z,this._vertexData[Q++]=A.color.r,this._vertexData[Q++]=A.color.g,this._vertexData[Q++]=A.color.b,this._vertexData[Q++]=A.color.a,this._vertexData[Q++]=A.angle,this._vertexData[Q++]=A.scale.x*A.size,this._vertexData[Q++]=A.scale.y*A.size,this._isAnimationSheetEnabled&&(this._vertexData[Q++]=A.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Q++]=A.direction.x,this._vertexData[Q++]=A.direction.y,this._vertexData[Q++]=A.direction.z);else if(A._initialDirection){let M=A._initialDirection;this.isLocal&&(S.GA.TransformNormalToRef(M,this._emitterWorldMatrix,S.TmpVectors.GA[0]),M=S.TmpVectors.GA[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[Q++]=M.x,this._vertexData[Q++]=M.y,this._vertexData[Q++]=M.z}else{let M=A.direction;this.isLocal&&(S.GA.TransformNormalToRef(M,this._emitterWorldMatrix,S.TmpVectors.GA[0]),M=S.TmpVectors.GA[0]),0===M.x&&0===M.z&&(M.x=.001),this._vertexData[Q++]=M.x,this._vertexData[Q++]=M.y,this._vertexData[Q++]=M.z}this._useRampGradients&&A.remapData&&(this._vertexData[Q++]=A.remapData.x,this._vertexData[Q++]=A.remapData.y,this._vertexData[Q++]=A.remapData.z,this._vertexData[Q++]=A.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===O?O=this._epsilon:1===O&&(O=1-this._epsilon),0===z?z=this._epsilon:1===z&&(z=1-this._epsilon)),this._vertexData[Q++]=O,this._vertexData[Q++]=z)}_prepareParticle(M){}_createNewOnes(M){let A;for(let O=0;O<M&&this.KJ.length!==this._capacity;O++){A=this._createParticle(),this.KJ.push(A);let M=this._createQueueStart;for(;M;)M.process(A,this),M=M.nextItem;A._inheritParticleInfoToSubEmitters()}}_update(M){if(this._alive=this.KJ.length>0,this.SA.position){const M=this.SA;this._emitterWorldMatrix=M.getWorldMatrix()}else{const M=this.SA;this._emitterWorldMatrix=S.Matrix.Translation(M.x,M.y,M.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.KJ),this._createNewOnes(M)}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=[Y.c.PositionKind,Y.c.ColorKind,"angle","offset","size"];return M&&S.push("cellIndex"),A||S.push("direction"),O&&S.push("remapData"),S}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,OM.b)(S),M&&S.push("particlesInfos"),A&&S.push("logarithmicDepthConstant"),O&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OM.f)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&M.push("#define FOG")),this._isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),A===j.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&M.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case 2:M.push("#define BILLBOARDY");break;case 8:case 9:M.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&M.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:M.push("#define BILLBOARDMODE_ALL")}O&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,A,O){A.push(...aM._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),M.push(...aM._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),O.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zM.f)(M,this._imageProcessingConfigurationDefines),(0,zM.c)(O,this._imageProcessingConfigurationDefines))}_getWrapper(M){const A=this._getCustomDrawWrapper(M);if(null!==A&&void 0!==A&&A.effect)return A;const O=[];this.fillDefines(O,M);const S=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let z=this._drawWrappers[S];z||(z=this._drawWrappers[S]=[]);let Q=z[M];Q||(Q=new AM.c(this._engine),Q.drawContext&&(Q.drawContext.useInstancing=this._useInstancing),z[M]=Q);const X=O.join("\n");if(Q.defines!==X){const M=[],A=[],O=[];this.fillUniformsAttributesAndSamplerNames(A,M,O),Q.setEffect(this._engine.createEffect("particles",M,A,O,X,void 0,void 0,void 0,void 0,this._shaderLanguage),X)}return Q}animate(){var M;let A,O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!O&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(O?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this.manualEmitCount>-1)A=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let M=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const A=this._actualFrame/this.targetStopDuration;R.GetCurrentGradient(A,this._emitRateGradients,((A,O,S)=>{A!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=O.getFactor(),this._currentEmitRateGradient=A),M=(0,B.Lerp)(this._currentEmitRate1,this._currentEmitRate2,S)}))}A=M*this._scaledUpdateSpeed|0,this._newPartsExcess+=M*this._scaledUpdateSpeed-A}if(this._newPartsExcess>1&&(A+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?A=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(A),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!O){let M=0;for(let A=0;A<this.KJ.length;A++){const O=this.KJ[A];this._appendParticleVertices(M,O),M+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.KJ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(M,A){this._appendParticleVertex(M++,A,0,0),this._useInstancing||(this._appendParticleVertex(M++,A,1,0),this._appendParticleVertex(M++,A,1,1),this._appendParticleVertex(M++,A,0,1))}rebuild(){var M;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(M=this._spriteBuffer)||void 0===M||M._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!aM.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(O.bind(O,14028)),Promise.resolve().then(O.bind(O,13976))])):await Promise.all([Promise.resolve().then(O.bind(O,13965)),Promise.resolve().then(O.bind(O,13952))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.SA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==j.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(j.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(j.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(M){var A,O;const z=this._getWrapper(M),Q=z.effect,X=this._engine;X.enableEffect(z);const c=null!==(A=this.defaultViewMatrix)&&void 0!==A?A:this._scene.getViewMatrix();if(Q.setTexture("diffuseSampler",this.particleTexture),Q.setMatrix("view",c),Q.setMatrix("projection",null!==(O=this.defaultProjectionMatrix)&&void 0!==O?O:this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();Q.setFloat3("particlesInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,this.spriteCellWidth/M.width)}if(Q.setVector2("translationPivot",this.translationPivot),Q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;Q.setVector3("eyePosition",M.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Q.setTexture("rampSampler",this._rampGradientsTexture));const j=Q.defines;var B,g,e,T,J,K;(this._scene&&((0,OM.d)(Q,this,this._scene),this.applyFog&&(0,SM.d)(this._scene,void 0,Q)),j.indexOf("#define BILLBOARDMODE_ALL")>=0&&(c.invertToRef(S.TmpVectors.Matrix[0]),Q.setMatrix("invView",S.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?X.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?X.bindBuffers(this._vertexBuffers,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Q):X.bindBuffers(this._vertexBuffers,null!==(T=this._scene)&&void 0!==T&&T.forceWireframe?this._linesIndexBufferUseInstancing:null,Q);(this.useLogarithmicDepth&&this._scene&&(0,SM.g)(j,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),this._setEngineBasedOnBlendMode(M),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),this._useInstancing)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?X.drawElementsType(6,0,10,this.KJ.length):X.drawArraysType(7,0,4,this.KJ.length):null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?X.drawElementsType(1,0,10*this.KJ.length):X.drawElementsType(0,0,6*this.KJ.length);return this.KJ.length}render(){if(!this.isReady()||!this.KJ.length)return 0;const M=this._engine;M.setState&&(M.setState(!1),this.forceDepthWrite&&M.setDepthWrite(!0));let A=0;return A=this.blendMode===j.BLENDMODE_MULTIPLYADD?this._render(j.BLENDMODE_MULTIPLY)+this._render(j.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),A}_onDispose(){}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(A,O),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const M=this._scene.TJ.indexOf(this);M>-1&&this._scene.TJ.splice(M,1),this._scene._activeParticleSystems.dispose()}this.Ac.notifyObservers(this),this.Ac.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}aM.ForceGLSL=!1;var VM,ZM=O(12799);!function(M){M[M.ATTACHED=0]="ATTACHED",M[M.END=1]="END"}(VM||(VM={}));class PM{constructor(M){if(this.particleSystem=M,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!M.SA||!M.SA.dispose){const A=(0,c.c)("BABYLON.AbstractMesh");M.SA=new A("SubemitterSystemEmitter",M.HM()),M._disposeEmitterOnDispose=!0}}clone(){let M=this.particleSystem.SA;if(M){if(M instanceof S.GA)M=M.clone();else if(-1!==M.getClassName().indexOf("Mesh")){M=new((0,c.c)("BABYLON.Mesh"))("",M.HM()),M.isVisible=!1}}else M=new S.GA;const A=new PM(this.particleSystem.clone(this.particleSystem.name,M));return A.particleSystem.name+="Clone",A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem._disposeEmitterOnDispose=!0,A.particleSystem.disposeOnStop=!0,A}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return A.type=this.type,A.inheritDirection=this.inheritDirection,A.inheritedVelocityAmount=this.inheritedVelocityAmount,A.particleSystem=this.particleSystem.serialize(M),A}static _ParseParticleSystem(M,A,O){throw(0,ZM.d)("ParseParticle")}static Parse(M,A,O){const S=M.particleSystem,z=new PM(PM._ParseParticleSystem(S,A,O,!0));return z.type=M.type,z.inheritDirection=M.inheritDirection,z.inheritedVelocityAmount=M.inheritedVelocityAmount,z.particleSystem._isSubEmitter=!0,z}dispose(){this.particleSystem.dispose()}}var mA=O(12852);function RM(M,A){const O=new w;return O.direction1=M,O.direction2=A,O}function kM(){return new d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function WM(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function lM(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.GA(0,1,0),O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0);return new b(M,A,O)}function MA(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function AA(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0),Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.GA(0,1,0);return new G(M,A,O,z,Q)}function OA(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new T(M,A)}function SA(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0);return new J(M,A,O,z)}const zA=S.GA.Zero(),QA=S.GA.Zero(),XA=S.GA.Zero();class cA{constructor(){this.strength=0,this.position=S.GA.Zero()}_processParticle(M,A){this.position.subtractToRef(M.position,zA);const O=zA.lengthSquared()+1;zA.normalize().scaleToRef(this.strength/O,QA),QA.scaleToRef(A._tempScaledUpdateSpeed,XA),M.direction.addInPlace(XA)}serialize(){return{position:this.position.gc(),strength:this.strength}}}class jA extends aM{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=M=>{if(!this._subEmitters||0===this._subEmitters.length)return;const A=Math.floor(Math.random()*this._subEmitters.length);for(const O of this._subEmitters[A])if(1===O.type){const A=O.clone();M._inheritParticleInfoToSubEmitter(A),A.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(A.particleSystem),A.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(M,A){const O=RM(M,A);return this.particleEmitterType=O,O}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M,this._flowMapUpdate&&(nM(this._flowMapUpdate),this._flowMapUpdate=null),M&&(this._flowMapUpdate={process:M=>{var A;const O=null===(A=this.HM())||void 0===A?void 0:A.getTransformMatrix();this._flowMap._processParticle(M,this.flowMapStrength*this._tempScaledUpdateSpeed,O)},previousItem:null,nextItem:null},qM(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(M){this._attractors.push(M),1===this._attractors.length&&(this._attractorUpdate={process:M=>{for(const A of this._attractors)A._processParticle(M,this)},previousItem:null,nextItem:null},qM(this._attractorUpdate,this._directionProcessing))}removeAttractor(M){const A=this._attractors.indexOf(M);-1!==A&&this._attractors.splice(A,1),0===this._attractors.length&&nM(this._attractorUpdate)}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(M)}createHemisphericEmitter(){const M=kM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=WM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=lM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.GA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=MA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=OA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=SA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,A,O,S){const z=new e;return this.particleEmitterType=z,this.direction1=M,this.direction2=A,this.minEmitBox=O,this.maxEmitBox=S,z}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const M of this.subEmitters)M instanceof jA?this._subEmitters.push([new PM(M)]):M instanceof PM?this._subEmitters.push([M]):M instanceof Array&&this._subEmitters.push(M)}_stopSubEmitters(){if(this.activeSubSystems){for(const M of this.activeSubSystems)M.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const M=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==M&&this._rootParticleSystem.activeSubSystems.splice(M,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(M){M&&this._stopSubEmitters()}_prepareParticle(M){if(this._subEmitters&&this._subEmitters.length>0){const A=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];M._attachedSubEmitters=[];for(const O of A)if(0===O.type){const A=O.clone();M._attachedSubEmitters.push(A),A.particleSystem.start()}}}_onDispose(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),M&&this.particles)for(const O of this.particles)if(O._attachedSubEmitters)for(let M=O._attachedSubEmitters.length-1;M>=0;M-=1)O._attachedSubEmitters[M].dispose();if(A&&this.activeSubSystems)for(let O=this.activeSubSystems.length-1;O>=0;O-=1)this.activeSubSystems[O].dispose();if(this._subEmitters&&this._subEmitters.length){for(let M=0;M<this._subEmitters.length;M++)for(const A of this._subEmitters[M])A.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.SA&&this.SA.dispose&&this.SA.dispose(!0)}static _Parse(M,A,O,z){var Q,j,B;let g;g=O instanceof mA.e?null:O;const Y=(0,c.c)("BABYLON.Texture");if(Y&&g&&(M.texture?A.particleTexture=Y.Parse(M.texture,g,z):M.textureName&&(A.particleTexture=new Y(z+M.textureName,g,!1,void 0===M.invertY||M.invertY),A.particleTexture.name=M.textureName)),M.emitterId||0===M.emitterId||void 0!==M.SA?M.emitterId&&g?A.SA=g.getLastMeshById(M.emitterId):A.SA=S.GA.sA(M.SA):A.SA=S.GA.Zero(),A.isLocal=!!M.isLocal,void 0!==M.renderingGroupId&&(A.renderingGroupId=M.renderingGroupId),void 0!==M.isBillboardBased&&(A.isBillboardBased=M.isBillboardBased),void 0!==M.billboardMode&&(A.billboardMode=M.billboardMode),void 0!==M.useLogarithmicDepth&&(A.useLogarithmicDepth=M.useLogarithmicDepth),M.animations){for(let O=0;O<M.animations.length;O++){const S=M.animations[O],z=(0,c.c)("BABYLON.Animation");z&&A.animations.push(z.Parse(S))}A.beginAnimationOnStart=M.beginAnimationOnStart,A.beginAnimationFrom=M.beginAnimationFrom,A.beginAnimationTo=M.beginAnimationTo,A.beginAnimationLoop=M.beginAnimationLoop}if(M.autoAnimate&&g&&g.beginAnimation(A,M.autoAnimateFrom,M.autoAnimateTo,M.autoAnimateLoop,M.autoAnimateSpeed||1),A.startDelay=0|M.startDelay,A.minAngularSpeed=M.minAngularSpeed,A.maxAngularSpeed=M.maxAngularSpeed,A.minSize=M.minSize,A.maxSize=M.maxSize,M.minScaleX&&(A.minScaleX=M.minScaleX,A.maxScaleX=M.maxScaleX,A.minScaleY=M.minScaleY,A.maxScaleY=M.maxScaleY),void 0!==M.preWarmCycles&&(A.preWarmCycles=M.preWarmCycles,A.preWarmStepOffset=M.preWarmStepOffset),void 0!==M.minInitialRotation&&(A.minInitialRotation=M.minInitialRotation,A.maxInitialRotation=M.maxInitialRotation),A.minLifeTime=M.minLifeTime,A.maxLifeTime=M.maxLifeTime,A.minEmitPower=M.minEmitPower,A.maxEmitPower=M.maxEmitPower,A.emitRate=M.emitRate,A.gravity=S.GA.sA(M.gravity),M.noiseStrength&&(A.noiseStrength=S.GA.sA(M.noiseStrength)),A.color1=X.Cc.sA(M.color1),A.color2=X.Cc.sA(M.color2),A.colorDead=X.Cc.sA(M.colorDead),A.updateSpeed=M.updateSpeed,A.targetStopDuration=M.targetStopDuration,A.blendMode=M.blendMode,M.colorGradients)for(const S of M.colorGradients)A.addColorGradient(S.gradient,X.Cc.sA(S.color1),S.color2?X.Cc.sA(S.color2):void 0);if(M.rampGradients){for(const O of M.rampGradients)A.addRampGradient(O.gradient,X.bA.sA(O.color));A.useRampGradients=M.useRampGradients}if(M.colorRemapGradients)for(const S of M.colorRemapGradients)A.addColorRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.alphaRemapGradients)for(const S of M.alphaRemapGradients)A.addAlphaRemapGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.sizeGradients)for(const S of M.sizeGradients)A.addSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.angularSpeedGradients)for(const S of M.angularSpeedGradients)A.addAngularSpeedGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.velocityGradients)for(const S of M.velocityGradients)A.addVelocityGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.dragGradients)for(const S of M.dragGradients)A.addDragGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.emitRateGradients)for(const S of M.emitRateGradients)A.addEmitRateGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.startSizeGradients)for(const S of M.startSizeGradients)A.addStartSizeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.lifeTimeGradients)for(const S of M.lifeTimeGradients)A.addLifeTimeGradient(S.gradient,void 0!==S.factor1?S.factor1:S.factor,S.factor2);if(M.limitVelocityGradients){for(const O of M.limitVelocityGradients)A.addLimitVelocityGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2);A.limitVelocityDamping=M.limitVelocityDamping}if(M.noiseTexture&&g){const O=(0,c.c)("BABYLON.ProceduralTexture");A.noiseTexture=O.Parse(M.noiseTexture,g,z)}let H;if(M.particleEmitterType){switch(M.particleEmitterType.type){case"SphereParticleEmitter":H=new I;break;case"SphereDirectedParticleEmitter":H=new b;break;case"ConeEmitter":case"ConeParticleEmitter":H=new T;break;case"ConeDirectedParticleEmitter":H=new J;break;case"CylinderParticleEmitter":H=new K;break;case"CylinderDirectedParticleEmitter":H=new G;break;case"HemisphericParticleEmitter":H=new d;break;case"PointParticleEmitter":H=new w;break;case"MeshParticleEmitter":H=new E;break;case"CustomParticleEmitter":H=new s;break;default:H=new e}H.parse(M.particleEmitterType,g)}else H=new e,H.parse(M,g);A.particleEmitterType=H,A.startSpriteCellID=M.startSpriteCellID,A.endSpriteCellID=M.endSpriteCellID,A.spriteCellLoop=null===(Q=M.spriteCellLoop)||void 0===Q||Q,A.spriteCellWidth=M.spriteCellWidth,A.spriteCellHeight=M.spriteCellHeight,A.spriteCellChangeSpeed=M.spriteCellChangeSpeed,A.spriteRandomStartCell=M.spriteRandomStartCell,A.disposeOnStop=null!==(j=M.disposeOnStop)&&void 0!==j&&j,A.manualEmitCount=null!==(B=M.manualEmitCount)&&void 0!==B?B:-1}static Parse(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0;const c=M.name;let j,B,g=null,e=null;if(A instanceof mA.e?j=A:(B=A,j=B.getEngine()),M.customShader&&j.createEffectForParticles){e=M.customShader;const A=e.shaderOptions.defines.length>0?e.shaderOptions.defines.join("\n"):"";g=j.createEffectForParticles(e.shaderPath.fragmentElement,e.shaderOptions.uniforms,e.shaderOptions.samplers,A)}const T=new jA(c,Q||M.wO,A,g,M.isAnimationSheetEnabled);if(T.customShader=e,T._rootUrl=O,M.id&&(T.id=M.id),M.subEmitters){T.subEmitters=[];for(const S of M.subEmitters){const M=[];for(const z of S)M.push(PM.Parse(z,A,O));T.subEmitters.push(M)}}if(M.attractors)for(const X of M.attractors){const M=new cA;M.position=S.GA.sA(X.position),M.strength=X.strength,T.addAttractor(M)}return jA._Parse(M,T,A,O),M.textureMask&&(T.textureMask=X.Cc.sA(M.textureMask)),M.lB&&(T.lB=S.GA.sA(M.lB)),M.preventAutoStart&&(T.preventAutoStart=M.preventAutoStart),z||T.preventAutoStart||T.start(),T}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};if(jA._Serialize(A,this,M),A.textureMask=this.textureMask.gc(),A.customShader=this.customShader,A.preventAutoStart=this.preventAutoStart,A.lB=this.lB.gc(),this.subEmitters){A.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const O of this._subEmitters){const S=[];for(const A of O)S.push(A.serialize(M));A.subEmitters.push(S)}}if(this._attractors&&this._attractors.length){A.attractors=[];for(const M of this._attractors)A.attractors.push(M.serialize())}return A}static _Serialize(M,A,O){if(M.name=A.name,M.id=A.id,M.wO=A.getCapacity(),M.disposeOnStop=A.disposeOnStop,M.manualEmitCount=A.manualEmitCount,A.SA.position){const O=A.SA;M.emitterId=O.id}else{const O=A.SA;M.SA=O.gc()}A.particleEmitterType&&(M.particleEmitterType=A.particleEmitterType.serialize()),A.particleTexture&&(O?M.texture=A.particleTexture.serialize():(M.textureName=A.particleTexture.name,M.invertY=!!A.particleTexture._invertY)),M.isLocal=A.isLocal,U.e.AppendSerializedAnimations(A,M),M.beginAnimationOnStart=A.beginAnimationOnStart,M.beginAnimationFrom=A.beginAnimationFrom,M.beginAnimationTo=A.beginAnimationTo,M.beginAnimationLoop=A.beginAnimationLoop,M.startDelay=A.startDelay,M.renderingGroupId=A.renderingGroupId,M.isBillboardBased=A.isBillboardBased,M.billboardMode=A.billboardMode,M.minAngularSpeed=A.minAngularSpeed,M.maxAngularSpeed=A.maxAngularSpeed,M.minSize=A.minSize,M.maxSize=A.maxSize,M.minScaleX=A.minScaleX,M.maxScaleX=A.maxScaleX,M.minScaleY=A.minScaleY,M.maxScaleY=A.maxScaleY,M.minEmitPower=A.minEmitPower,M.maxEmitPower=A.maxEmitPower,M.minLifeTime=A.minLifeTime,M.maxLifeTime=A.maxLifeTime,M.emitRate=A.emitRate,M.gravity=A.gravity.gc(),M.noiseStrength=A.noiseStrength.gc(),M.color1=A.color1.gc(),M.color2=A.color2.gc(),M.colorDead=A.colorDead.gc(),M.updateSpeed=A.updateSpeed,M.targetStopDuration=A.targetStopDuration,M.blendMode=A.blendMode,M.preWarmCycles=A.preWarmCycles,M.preWarmStepOffset=A.preWarmStepOffset,M.minInitialRotation=A.minInitialRotation,M.maxInitialRotation=A.maxInitialRotation,M.startSpriteCellID=A.startSpriteCellID,M.spriteCellLoop=A.spriteCellLoop,M.endSpriteCellID=A.endSpriteCellID,M.spriteCellChangeSpeed=A.spriteCellChangeSpeed,M.spriteCellWidth=A.spriteCellWidth,M.spriteCellHeight=A.spriteCellHeight,M.spriteRandomStartCell=A.spriteRandomStartCell,M.isAnimationSheetEnabled=A.isAnimationSheetEnabled,M.useLogarithmicDepth=A.useLogarithmicDepth;const S=A.getColorGradients();if(S){M.colorGradients=[];for(const A of S){const O={gradient:A.gradient,color1:A.color1.gc()};A.color2?O.color2=A.color2.gc():O.color2=A.color1.gc(),M.colorGradients.push(O)}}const z=A.getRampGradients();if(z){M.rampGradients=[];for(const A of z){const O={gradient:A.gradient,color:A.color.gc()};M.rampGradients.push(O)}M.useRampGradients=A.useRampGradients}const Q=A.getColorRemapGradients();if(Q){M.colorRemapGradients=[];for(const A of Q){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.colorRemapGradients.push(O)}}const X=A.getAlphaRemapGradients();if(X){M.alphaRemapGradients=[];for(const A of X){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.alphaRemapGradients.push(O)}}const c=A.getSizeGradients();if(c){M.sizeGradients=[];for(const A of c){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.sizeGradients.push(O)}}const j=A.getAngularSpeedGradients();if(j){M.angularSpeedGradients=[];for(const A of j){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.angularSpeedGradients.push(O)}}const B=A.getVelocityGradients();if(B){M.velocityGradients=[];for(const A of B){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.velocityGradients.push(O)}}const g=A.getDragGradients();if(g){M.dragGradients=[];for(const A of g){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.dragGradients.push(O)}}const e=A.getEmitRateGradients();if(e){M.emitRateGradients=[];for(const A of e){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.emitRateGradients.push(O)}}const T=A.getStartSizeGradients();if(T){M.startSizeGradients=[];for(const A of T){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.startSizeGradients.push(O)}}const J=A.getLifeTimeGradients();if(J){M.lifeTimeGradients=[];for(const A of J){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.lifeTimeGradients.push(O)}}const K=A.getLimitVelocityGradients();if(K){M.limitVelocityGradients=[];for(const A of K){const O={gradient:A.gradient,factor1:A.factor1};void 0!==A.factor2?O.factor2=A.factor2:O.factor2=A.factor1,M.limitVelocityGradients.push(O)}M.limitVelocityDamping=A.limitVelocityDamping}A.noiseTexture&&(M.noiseTexture=A.noiseTexture.serialize())}clone(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=(0,h.d)({},this._customWrappers);let z=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){z=this.customShader;const M=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",A=Q.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,M);S[0]?S[0].effect=A:this.setCustomEffect(A,0)}const X=this.serialize(O),c=jA.Parse(X,this._scene||this._engine,this._rootUrl);return c.name=M,c.customShader=z,c._customWrappers=S,void 0===A&&(A=this.SA),this.noiseTexture&&(c.noiseTexture=this.noiseTexture.clone()),c.SA=A,this.preventAutoStart||c.start(),c}}jA.BILLBOARDMODE_Y=2,jA.BILLBOARDMODE_ALL=7,jA.BILLBOARDMODE_STRETCHED=8,jA.BILLBOARDMODE_STRETCHED_LOCAL=9,PM._ParseParticleSystem=jA.Parse;var BA=O(13217),gA=O(13214),eA=O(13110);eA.b.prototype.createTransformFeedback=function(){const M=this._gl.createTransformFeedback();if(!M)throw new Error("Unable to create Transform Feedback");return M},eA.b.prototype.deleteTransformFeedback=function(M){this._gl.deleteTransformFeedback(M)},eA.b.prototype.bindTransformFeedback=function(M){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,M)},eA.b.prototype.beginTransformFeedback=function(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(M?this._gl.POINTS:this._gl.TRIANGLES)},eA.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},eA.b.prototype.setTranformFeedbackVaryings=function(M,A){this._gl.transformFeedbackVaryings(M,A,this._gl.INTERLEAVED_ATTRIBS)},eA.b.prototype.bindTransformFeedbackBuffer=function(M){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M?M.underlyingResource:null)},eA.b.prototype.readTransformFeedbackBuffer=function(M){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,M)};const TA="clipPlaneFragmentDeclaration2",JA="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";C.c.IncludesShadersStore[TA]||(C.c.IncludesShadersStore[TA]=JA);O(13866),O(13869),O(13876),O(13880),O(13886),O(13895),O(13900),O(13907);const KA="gpuRenderParticlesPixelShader",GA="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";C.c.ShadersStore[KA]||(C.c.ShadersStore[KA]=GA);const dA="clipPlaneVertexDeclaration2",wA="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";C.c.IncludesShadersStore[dA]||(C.c.IncludesShadersStore[dA]=wA);O(13914),O(13922),O(13924),O(13926);const IA="gpuRenderParticlesVertexShader",bA="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";C.c.ShadersStore[IA]||(C.c.ShadersStore[IA]=bA);class sA extends j{static get IsSupported(){if(!l.d.LastCreatedEngine)return!1;const M=l.d.LastCreatedEngine.getCaps();return M.supportTransformFeedbacks||M.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(M){this._maxActiveParticleCount=Math.min(M,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(M){this.maxActiveParticleCount=M}createPointEmitter(M,A){const O=RM(M,A);return this.particleEmitterType=O,O}createHemisphericEmitter(){const M=kM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createSphereEmitter(){const M=WM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=M,M}createDirectedSphereEmitter(){const M=lM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S.GA(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createCylinderEmitter(){const M=MA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=M,M}createDirectedCylinderEmitter(){const M=AA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createConeEmitter(){const M=OA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=M,M}createDirectedConeEmitter(){const M=SA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new S.GA(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.GA(0,1,0));return this.particleEmitterType=M,M}createBoxEmitter(M,A,O,S){const z=new e;return this.particleEmitterType=z,this.direction1=M,this.direction2=A,this.minEmitBox=O,this.maxEmitBox=S,z}get flowMap(){return this._flowMap}set flowMap(M){this._flowMap!==M&&(this._flowMap=M)}isReady(){if(!this.SA||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==jA.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(jA.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(jA.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";M?setTimeout((()=>{this.start(0)}),M):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var M,A;let O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(M=null===(A=this._customWrappers[O])||void 0===A?void 0:A.effect)&&void 0!==M?M:this._customWrappers[0].effect}_getCustomDrawWrapper(){var M;let A=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!==(M=this._customWrappers[A])&&void 0!==M?M:this._customWrappers[0]}setCustomEffect(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[A]=new AM.c(this._engine),this._customWrappers[A].effect=M}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(M,A,O){return super._removeGradientAndTexture(M,A,O),this._releaseBuffers(),this}addColorGradient(M,A){this._colorGradients||(this._colorGradients=[]);const O=new Z(M,A);return this._colorGradients.push(O),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(M&&this._colorGradients.sort(((M,A)=>M.gradient<A.gradient?-1:M.gradient>A.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(M){return this._removeGradientAndTexture(M,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const A in this._drawWrappers){var M;null===(M=this._drawWrappers[A].drawContext)||void 0===M||M.reset()}}_addFactorGradient(M,A,O){const S=new mM(A,O);M.push(S),this._releaseBuffers()}addSizeGradient(M,A){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,M,A),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(M){return this._removeGradientAndTexture(M,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(M,A){if(!M)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&M.sort(((M,A)=>M.gradient<A.gradient?-1:M.gradient>A.gradient?1:0));const O=this;O[A]&&(O[A].dispose(),O[A]=null)}addAngularSpeedGradient(M,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,M,A),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(M){return this._removeGradientAndTexture(M,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(M,A){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,M,A),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(M){return this._removeGradientAndTexture(M,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(M,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,M,A),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(M){return this._removeGradientAndTexture(M,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(M,A){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,M,A),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(M){return this._removeGradientAndTexture(M,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(M){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(M,A,O){var z;let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(M),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ac=new k.c,this.onStoppedObservable=new k.c,this.onStartedObservable=new k.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,O&&"Scene"!==O.getClassName()?(this._engine=O,this.defaultProjectionMatrix=S.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=O||l.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.TJ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,c.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,c.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,c.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,c.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new AM.c(this._engine)},this._customWrappers[0].effect=Q,this._drawWrappers={0:new AM.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(A=null!==(z=A)&&void 0!==z?z:{}).randomTextureSize||delete A.randomTextureSize;const j=(0,h.d)({wO:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize},A),B=A;isFinite(B)&&(j.wO=B),this._capacity=j.wO,this._maxActiveParticleCount=j.wO,this._currentActiveCount=0,this._isAnimationSheetEnabled=X,this.particleEmitterType=new e;const g=Math.min(this._engine.getCaps().maxTextureSize,j.randomTextureSize);let T=[];for(let S=0;S<g;++S)T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random());this._randomTexture=new W.d(new Float32Array(T),g,1,5,O,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,T=[];for(let S=0;S<g;++S)T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random());this._randomTexture2=new W.d(new Float32Array(T),g,1,5,O,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=g}_reset(){this._releaseBuffers()}_createVertexBuffers(M,A,O){const S={};S.position=A.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let z=3;S.age=A.createVertexBuffer("age",z,1,this._attributesStrideSize,!0),z+=1,S.size=A.createVertexBuffer("size",z,3,this._attributesStrideSize,!0),z+=3,S.life=A.createVertexBuffer("life",z,1,this._attributesStrideSize,!0),z+=1,z+=4,this.billboardMode===jA.BILLBOARDMODE_STRETCHED&&(S.direction=A.createVertexBuffer("direction",z,3,this._attributesStrideSize,!0)),z+=3,this._platform.alignDataInBuffer&&(z+=1),this.particleEmitterType instanceof s&&(z+=3,this._platform.alignDataInBuffer&&(z+=1)),this._colorGradientsTexture||(S.color=A.createVertexBuffer("color",z,4,this._attributesStrideSize,!0),z+=4),this._isBillboardBased||(S.initialDirection=A.createVertexBuffer("initialDirection",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),this.noiseTexture&&(S.noiseCoordinates1=A.createVertexBuffer("noiseCoordinates1",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1),S.noiseCoordinates2=A.createVertexBuffer("noiseCoordinates2",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),S.angle=A.createVertexBuffer("angle",z,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?z++:z+=2,this._isAnimationSheetEnabled&&(S.cellIndex=A.createVertexBuffer("cellIndex",z,1,this._attributesStrideSize,!0),z+=1,this.spriteRandomStartCell&&(S.cellStartOffset=A.createVertexBuffer("cellStartOffset",z,1,this._attributesStrideSize,!0),z+=1)),S.offset=O.createVertexBuffer("offset",0,2),S.uv=O.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(S),this._platform.createVertexBuffers(M,S),this.resetDrawCache()}_initialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!M)return;const A=this._engine,O=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof s&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const z=this.particleEmitterType instanceof s,Q=S.TmpVectors.GA[0];let X=0;for(let S=0;S<this._capacity;S++)if(O.push(0),O.push(0),O.push(0),O.push(0),O.push(0),O.push(0),O.push(0),O.push(0),O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),z?(this.particleEmitterType.particleDestinationGenerator(S,null,Q),O.push(Q.x),O.push(Q.y),O.push(Q.z)):(O.push(0),O.push(0),O.push(0)),this._platform.alignDataInBuffer&&O.push(0),X+=16,z&&(this.particleEmitterType.particlePositionGenerator(S,null,Q),O.push(Q.x),O.push(Q.y),O.push(Q.z),this._platform.alignDataInBuffer&&O.push(0),X+=4),this._colorGradientsTexture||(O.push(0),O.push(0),O.push(0),O.push(0),X+=4),this.isBillboardBased||(O.push(0),O.push(0),O.push(0),this._platform.alignDataInBuffer&&O.push(0),X+=4),this.noiseTexture&&(O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),this._platform.alignDataInBuffer&&O.push(0),O.push(Math.random()),O.push(Math.random()),O.push(Math.random()),this._platform.alignDataInBuffer&&O.push(0),X+=8),O.push(0),X+=1,this._angularSpeedGradientsTexture||(O.push(0),X+=1),this._isAnimationSheetEnabled&&(O.push(0),X+=1,this.spriteRandomStartCell&&(O.push(0),X+=1)),this._platform.alignDataInBuffer){let M=3-(X+3&3);for(X+=M;M-- >0;)O.push(0)}const c=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),j=this._platform.createParticleBuffer(O),B=this._platform.createParticleBuffer(O);this._buffer0=new Y.b(A,j,!1,this._attributesStrideSize),this._buffer1=new Y.b(A,B,!1,this._attributesStrideSize),this._spriteBuffer=new Y.b(A,c,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let M=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(M+="\n#define BILLBOARD"),this._colorGradientsTexture&&(M+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(M+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(M+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(M+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(M+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(M+="\n#define DRAGGRADIENTS"),this._flowMap&&(M+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(M+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(M+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(M+="\n#define NOISE"),this.isLocal&&(M+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===M||(this._cachedUpdateDefines=M,this._updateBuffer=this._platform.createUpdateBuffer(M)),this._platform.isUpdateBufferReady()}_getWrapper(M){const A=this._getCustomDrawWrapper(M);if(null!==A&&void 0!==A&&A.effect)return A;const O=[];this.fillDefines(O,M);let S=this._drawWrappers[M];S||(S=new AM.c(this._engine),S.drawContext&&(S.drawContext.useInstancing=!0),this._drawWrappers[M]=S);const z=O.join("\n");if(S.defines!==z){const M=[],A=[],O=[];this.fillUniformsAttributesAndSamplerNames(A,M,O),S.setEffect(this._engine.createEffect("gpuRenderParticles",M,A,O,z),z)}return S}static _GetAttributeNamesOrOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=[Y.c.PositionKind,"age","life","size","angle"];return M||z.push(Y.c.ColorKind),A&&z.push("cellIndex"),O||z.push("initialDirection"),S&&z.push("direction"),z.push("offset",Y.c.UVKind),z}static _GetEffectCreationOptions(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=["emitterWM","lB","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,OM.b)(S),M&&S.push("sheetInfos"),A&&S.push("logarithmicDepthConstant"),O&&(S.push("vFogInfos"),S.push("vFogColor")),S}fillDefines(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,OM.f)(this,this._scene,M),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==gA.b.FOGMODE_NONE&&M.push("#define FOG")),A===jA.BLENDMODE_MULTIPLY&&M.push("#define BLENDMULTIPLYMODE"),this.isLocal&&M.push("#define LOCAL"),this.useLogarithmicDepth&&M.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(M.push("#define BILLBOARD"),this.billboardMode){case jA.BILLBOARDMODE_Y:M.push("#define BILLBOARDY");break;case jA.BILLBOARDMODE_STRETCHED:M.push("#define BILLBOARDSTRETCHED");break;case jA.BILLBOARDMODE_ALL:M.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&M.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&M.push("#define ANIMATESHEET"),O&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),M.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(M,A,O){A.push(...sA._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===jA.BILLBOARDMODE_STRETCHED)),M.push(...sA._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),O.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(BA.b.PrepareUniforms(M,this._imageProcessingConfigurationDefines),BA.b.PrepareSamplers(O,this._imageProcessingConfigurationDefines))}animate(){var M;let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(A?this.preWarmStepOffset:(null===(M=this._scene)||void 0===M?void 0:M.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(M,A){const O=this[A];if(!M||!M.length||O)return;const S=new Float32Array(this._rawTextureWidth);for(let z=0;z<this._rawTextureWidth;z++){const A=z/this._rawTextureWidth;R.GetCurrentGradient(A,M,((M,A,O)=>{S[z]=(0,B.Lerp)(M.factor1,A.factor1,O)}))}this[A]=W.d.CreateRTexture(S,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[A].name=A.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const M=new Uint8Array(4*this._rawTextureWidth),A=X.TmpColors.Cc[0];for(let O=0;O<this._rawTextureWidth;O++){const S=O/this._rawTextureWidth;R.GetCurrentGradient(S,this._colorGradients,((S,z,Q)=>{X.Cc.LerpToRef(S.color1,z.color1,Q,A),M[4*O]=255*A.r,M[4*O+1]=255*A.g,M[4*O+2]=255*A.b,M[4*O+3]=255*A.a}))}this._colorGradientsTexture=W.d.CreateRGBATexture(M,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(M,A){var O,z,Q,X,c;const j=this._getWrapper(M),B=j.effect;this._engine.enableEffect(j);const g=(null===(O=this._scene)||void 0===O?void 0:O.getViewMatrix())||S.Matrix.IdentityReadOnly;if(B.setMatrix("view",g),B.setMatrix("projection",null!==(z=this.defaultProjectionMatrix)&&void 0!==z?z:this._scene.getProjectionMatrix()),B.setTexture("diffuseSampler",this.particleTexture),B.setVector2("translationPivot",this.translationPivot),B.setVector3("lB",this.lB),this.isLocal&&B.setMatrix("emitterWM",A),this._colorGradientsTexture?B.setTexture("colorGradientSampler",this._colorGradientsTexture):B.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const M=this.particleTexture.getBaseSize();B.setFloat3("sheetInfos",this.spriteCellWidth/M.width,this.spriteCellHeight/M.height,M.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const M=this._scene.activeCamera;B.setVector3("eyePosition",M.globalPosition)}const e=B.defines;if(this._scene&&((0,OM.d)(B,this,this._scene),this.applyFog&&(0,SM.d)(this._scene,void 0,B)),e.indexOf("#define BILLBOARDMODE_ALL")>=0){const M=g.clone();M.invert(),B.setMatrix("invView",M)}return this.useLogarithmicDepth&&this._scene&&(0,SM.g)(e,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(M),this._platform.bindDrawBuffers(this._targetIndex,B,null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(c=this._scene)&&void 0!==c&&c.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(M){if(!this.SA||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!M)if(this.SA.position){M=this.SA.getWorldMatrix()}else{const A=this.SA;M=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(A.x,A.y,A.z,M)}const A=this._engine,O=A.getDepthWrite();if(A.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const M=this.HM();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",M.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",M),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=z,A.setDepthWrite(O)}render(){let M,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0],O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!A&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let M=0;M<this.preWarmCycles;M++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const M=0|this._accumulatedCount;this._accumulatedCount-=M,this._currentActiveCount+=M}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.SA.position){M=this.SA.getWorldMatrix()}else{const A=this.SA;M=S.TmpVectors.Matrix[0],S.Matrix.TranslationToRef(A.x,A.y,A.z,M)}const z=this._engine;this.updateInAnimate||this._update(M);let Q=0;return A||O||(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0),Q=this.blendMode===jA.BLENDMODE_MULTIPLYADD?this._render(jA.BLENDMODE_MULTIPLY,M)+this._render(jA.BLENDMODE_ADD,M):this._render(this.blendMode,M),this._engine.setAlphaMode(0)),Q}rebuild(){const M=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(M,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,M()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const A in this._drawWrappers){this._drawWrappers[A].dispose()}if(this._drawWrappers={},this._scene){const M=this._scene.TJ.indexOf(this);M>-1&&this._scene.TJ.splice(M,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let A=0;A<this._renderVertexBuffers.length;++A){const M=this._renderVertexBuffers[A];for(const A in M)M[A].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),M&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),M&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ac.notifyObservers(this),this.Ac.clear()}clone(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=(0,h.d)({},this._customWrappers);let z=null;const Q=this._engine;if(Q.createEffectForParticles&&null!=this.customShader){z=this.customShader;const M=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";S[0]=Q.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,M,void 0,void 0,void 0,this)}const X=this.serialize(O),c=sA.Parse(X,this._scene||this._engine,this._rootUrl);return c.name=M,c.customShader=z,c._customWrappers=S,void 0===A&&(A=this.SA),this.noiseTexture&&(c.noiseTexture=this.noiseTexture.clone()),c.SA=A,c}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={};return jA._Serialize(A,this,M),A.activeParticleCount=this.activeParticleCount,A.randomTextureSize=this._randomTextureSize,A.customShader=this.customShader,A}static Parse(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const Q=M.name;let X,c;A instanceof mA.e?X=A:(c=A,X=c.getEngine());const j=new sA(Q,{wO:z||M.wO,randomTextureSize:M.randomTextureSize},A,null,M.isAnimationSheetEnabled);if(j._rootUrl=O,M.customShader&&X.createEffectForParticles){const A=M.customShader,O=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"",S=X.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,O,void 0,void 0,void 0,j);j.setCustomEffect(S,0),j.customShader=A}return M.id&&(j.id=M.id),M.activeParticleCount&&(j.activeParticleCount=M.activeParticleCount),jA._Parse(M,j,A,O),M.preventAutoStart&&(j.preventAutoStart=M.preventAutoStart),S||j.preventAutoStart||j.start(),j}}var YA=O(12768),EA=O(13932),HA=O(13338);class CA{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(M){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const A of this.systems)A.SA=M;this._emitterNode=M}setEmitterAsSphere(M,A,O){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:M,renderingGroupId:A};const S=(0,EA.d)("emitterSphere",{diameter:M.diameter,segments:M.segments},O);S.renderingGroupId=A;const z=new HA.IA("emitterSphereMaterial",O);z.emissiveColor=M.color,S.material=z;for(const Q of this.systems)Q.SA=S;this._emitterNode=S}start(M){for(const A of this.systems)M&&(A.SA=M),A.start()}dispose(){for(const M of this.systems)M.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A={systems:[]};for(const O of this.systems)A.systems.push(O.serialize(M));return this._emitterNode&&(A.SA=this._emitterCreationOptions),A}static Parse(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;const z=new CA,Q=this.BaseAssetsUrl+"/textures/";A=A||l.d.LastCreatedScene;for(const X of M.systems)z.systems.push(O?sA.Parse(X,A,Q,!0,S):jA.Parse(X,A,Q,!0,S));if(M.SA){const O=M.SA.options;if("Sphere"===M.SA.kind)z.setEmitterAsSphere({diameter:O.diameter,segments:O.segments,color:X.bA.sA(O.color)},M.SA.renderingGroupId,A)}return z}}CA.BaseAssetsUrl="https://assets.babylonjs.com/particles";var fA=O(12804);class DA{static CreateDefault(M){let A,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,S=arguments.length>2?arguments[2]:void 0;A=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new sA("default system",{wO:O},S):new jA("default system",O,S),A.SA=M;const z=YA.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return A.particleTexture=new L.c(z,A.HM()),A.createConeEmitter(.1,Math.PI/4),A.color1=new X.Cc(1,1,1,1),A.color2=new X.Cc(1,1,1,1),A.colorDead=new X.Cc(1,1,1,0),A.minSize=.1,A.maxSize=.1,A.minEmitPower=2,A.maxEmitPower=2,A.updateSpeed=1/60,A.emitRate=30,A}static CreateAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;A||(A=l.d.LastCreatedScene);const z={};return A.addPendingData(z),new Promise(((Q,X)=>{if(O&&!sA.IsSupported)return A.removePendingData(z),X("Particle system with GPU is not supported.");YA.Tools.LoadFile("".concat(DA.BaseAssetsUrl,"/systems/").concat(M,".json"),(M=>{A.removePendingData(z);const X=JSON.parse(M.toString());return Q(CA.Parse(X,A,O,S))}),void 0,void 0,void 0,(()=>(A.removePendingData(z),X("An error occurred with the creation of your particle system. Check if your type '".concat(M,"' exists.")))))}))}static ExportSet(M){const A=new CA;for(const O of M)A.systems.push(O);return A}static ParseFromFileAsync(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Q=arguments.length>5?arguments[5]:void 0;return new Promise(((X,c)=>{const j=new fA.b;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const A=JSON.parse(j.responseText);let c;c=S?sA.Parse(A,O,z,!1,Q):jA.Parse(A,O,z,!1,Q),M&&(c.name=M),X(c)}else c("Unable to load the particle system")})),j.open("GET",A),j.send()}))}static ParseFromSnippetAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0;if("_BLANK"===M){const M=this.CreateDefault(null);return M.start(),Promise.resolve(M)}return new Promise(((Q,X)=>{const c=new fA.b;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const X=JSON.parse(JSON.parse(c.responseText).jsonPayload),j=JSON.parse(X.particleSystem);let B;B=O?sA.Parse(j,A,S,!1,z):jA.Parse(j,A,S,!1,z),B.snippetId=M,Q(B)}else X("Unable to load the snippet "+M)})),c.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),c.send()}))}}DA.BaseAssetsUrl=CA.BaseAssetsUrl,DA.SnippetUrl="https://snippet.babylonjs.com",DA.CreateFromSnippetAsync=DA.ParseFromSnippetAsync;var FA=O(13422),NA=O(13241),yA=O(13936);(0,yA.f)(NA.b.NAME_PARTICLESYSTEM,((M,A,O,S)=>{const z=(0,yA.i)(NA.b.NAME_PARTICLESYSTEM);if(z&&void 0!==M.TJ&&null!==M.TJ)for(let Q=0,X=M.TJ.length;Q<X;Q++){const X=M.TJ[Q];O.TJ.push(z(X,A,S))}})),(0,yA.c)(NA.b.NAME_PARTICLESYSTEM,((M,A,O)=>{if(M.activeParticleCount){return sA.Parse(M,A,O)}return jA.Parse(M,A,O)})),mA.e.prototype.createEffectForParticles=function(M){var A;let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",X=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,e=arguments.length>9?arguments[9]:void 0,T=[],J=[];const K=[];return B?B.fillUniformsAttributesAndSamplerNames(J,T,K):(T=jA._GetAttributeNamesOrOptions(),J=jA._GetEffectCreationOptions()),-1===Q.indexOf(" BILLBOARD")&&(Q+="\n#define BILLBOARD\n"),null!==B&&void 0!==B&&B.isAnimationSheetEnabled&&-1===Q.indexOf(" ANIMATESHEET")&&(Q+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:null!==(A=null!==e&&void 0!==e?e:null===B||void 0===B?void 0:B.vertexShaderName)&&void 0!==A?A:"particles",fragmentElement:M},T,J.concat(S),K.concat(z),Q,X,c,j,void 0,g,(async()=>{0===g?await Promise.resolve().then(O.bind(O,13965)):await Promise.resolve().then(O.bind(O,14028))}))},FA.d.prototype.getEmittedParticleSystems=function(){const M=[];for(let A=0;A<this.HM().TJ.length;A++){const O=this.HM().TJ[A];O.SA===this&&M.push(O)}return M},FA.d.prototype.getHierarchyEmittedParticleSystems=function(){const M=[],A=this.getDescendants();A.push(this);for(let O=0;O<this.HM().TJ.length;O++){const S=this.HM().TJ[O],z=S.SA;z.position&&-1!==A.indexOf(z)&&M.push(S)}return M};O(13301),O(13311),O(13398);O(13405),O(13938),O(13181),O(13292),O(13440);O(13179);var hA;O(13945),O(12986);!function(M){M[M.Color=2]="Color",M[M.UV=1]="UV",M[M.Random=0]="Random",M[M.Stated=3]="Stated"}(hA||(hA={}));var uA=O(13203);const iA=new S.GA(0,0,0),UA=new S.GA(0,0,0),LA=new S.GA(0,0,0);class tA{constructor(M,A,O){this.width=M,this.height=A,this.data=O}processFlowable(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2?arguments[2]:void 0;if(!O)return;O instanceof S.Matrix?S.GA.TransformCoordinatesToRef(M.position,O,LA):(LA.x=O.x,LA.y=O.y,LA.z=O.z);const z=.5*LA.x+.5,Q=1-(.5*LA.y+.5),X=Math.floor(z*this.width),c=Math.floor(Q*this.height);if(X<0||X>=this.width||c<0||c>=this.height)return;const j=4*(c*this.width+X),B=this.data[j]/255*2-1,g=this.data[j+1]/255*2-1,e=this.data[j+2]/255*2-1,T=this.data[j+3]/255;iA.set(B,g,e),iA.scaleToRef(A*T,UA),M.direction.addInPlace(UA)}_processParticle(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,O=arguments.length>2?arguments[2]:void 0;this.processFlowable(M,A,O)}static async FromUrlAsync(M){return await new Promise(((A,O)=>{const S=document.createElement("canvas"),z=S.getContext("2d");let Q=null;const X=new Image;X.crossOrigin="anonymous",X.src=M,X.onerror=A=>{O(new Error("Failed to load image: ".concat(M," : ").concat(A)))},X.onload=()=>{S.width=X.width,S.height=X.height,z.drawImage(X,0,0),Q=z.getImageData(0,0,S.width,S.height),A(new tA(S.width,S.height,Q.data))}}))}static async ExtractFromTextureAsync(M){return await new Promise(((A,O)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{const O=await this.ExtractFromTextureAsync(M);A(O)}catch(S){O(S)}}));const S=M.getSize();uA.m.GetTextureDataAsync(M,S.width,S.height).then((M=>{A(new tA(S.width,S.height,new Uint8ClampedArray(M)))})).catch(O)}))}}var xA,oA,pA,vA,qA,rA,nA,aA,VA;!function(M){M[M.Int=1]="Int",M[M.Float=2]="Float",M[M.Vector2=4]="Vector2",M[M.GA=8]="GA",M[M.Matrix=16]="Matrix",M[M.Particle=32]="Particle",M[M.Texture=64]="Texture",M[M.Cc=128]="Cc",M[M.FloatGradient=256]="FloatGradient",M[M.Vector2Gradient=512]="Vector2Gradient",M[M.Vector3Gradient=1024]="Vector3Gradient",M[M.Color4Gradient=2048]="Color4Gradient",M[M.System=4096]="System",M[M.AutoDetect=8192]="AutoDetect",M[M.BasedOnInput=16384]="BasedOnInput",M[M.Undefined=32768]="Undefined",M[M.All=65535]="All"}(xA||(xA={})),function(M){M[M.Compatible=0]="Compatible",M[M.TypeIncompatible=1]="TypeIncompatible",M[M.HierarchyIssue=2]="HierarchyIssue"}(oA||(oA={})),function(M){M[M.Input=0]="Input",M[M.Output=1]="Output"}(pA||(pA={}));class ZA{get direction(){return this._direction}get type(){if(this._type===xA.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===xA.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(M){this._type=M}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((M=>M.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(M,A,O){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=xA.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new k.c,this.onDisconnectionObservable=new k.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=A,this.name=M,this._direction=O}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(M){var A;return this.isConnected?null!==(A=this._connectedPoint)&&void 0!==A&&A._storedFunction?this._connectedPoint._storedFunction(M):this._connectedPoint._storedValue:this.value}canConnectTo(M){return 0===this.checkCompatibilityState(M)}checkCompatibilityState(M){const A=this._ownerBlock,O=M.ownerBlock;if(this.type!==M.type&&M.innerType!==xA.AutoDetect)return M.acceptedConnectionPointTypes&&-1!==M.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(M.excludedConnectionPointTypes&&-1!==M.excludedConnectionPointTypes.indexOf(this.type))return 1;let S=O,z=A;return 0===this.direction&&(S=A,z=O),S.isAnAncestorOf(z)?2:0}connectTo(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(M))throw'Cannot connect these two connectors. source: "'.concat(this.ownerBlock.name,'".').concat(this.name,', target: "').concat(M.ownerBlock.name,'".').concat(M.name);return this._endpoints.push(M),M._connectedPoint=this,this.onConnectionObservable.notifyObservers(M),M.onConnectionObservable.notifyObservers(this),this}disconnectFrom(M){const A=this._endpoints.indexOf(M);return-1===A||(this._endpoints.splice(A,1),M._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(M),M.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(M){let A=1;for(;A<xA.All;)M&A||this.excludedConnectionPointTypes.push(A),A<<=1}serialize(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const A={};return A.name=this.name,A.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.gc?(A.valueType="BABYLON."+this.value.getClassName(),A.value=this.value.gc()):(A.valueType="number",A.value=this.value)),M&&this.connectedPoint&&(A.inputName=this.name,A.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,A.targetConnectionName=this.connectedPoint.name,A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(A.isExposedOnFrame=!0,A.exposedPortPosition=this.exposedPortPosition),A}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class PA{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(M){this._name=M}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(M){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new k.c,this.Ac=new k.c,this.onInputChangedObservable=new k.c,this.visibleOnFrame=!1,this._name=M,this.uniqueId=t.b.UniqueId}_inputRename(M){return M}_outputRename(M){return M}isAnAncestorOf(M){for(const A of this._outputs)if(A.hasEndpoints)for(const O of A.endpoints){if(O.ownerBlock===M)return!0;if(O.ownerBlock.isAnAncestorOf(M))return!0}return!1}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const A of this._outputs)if(A.hasEndpoints)for(const O of A.endpoints)if(O.ownerBlock.isAnAncestorOfType(M))return!0;return!1}getInputByName(M){const A=this._inputs.filter((A=>A.name===M));return A.length?A[0]:null}_linkConnectionTypes(M,A){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[A]._acceptedConnectionPointType=this._inputs[M]:(this._inputs[M]._linkedConnectionSource=this._inputs[A],this._inputs[M]._isMainLinkSource=!0),this._inputs[A]._linkedConnectionSource=this._inputs[M]}registerInput(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5?arguments[5]:void 0;const X=new ZA(M,this,0);return X.type=A,X.isOptional=O,X.defaultValue=S,X.value=S,X.valueMin=z,X.valueMax=Q,this._inputs.push(X),this.onInputChangedObservable.notifyObservers(X),this}registerOutput(M,A,O){var S;return(O=null!==(S=O)&&void 0!==S?S:new ZA(M,this,1)).type=A,this._outputs.push(O),this}_build(M){}_customBuildStep(M){}build(M){if(this._buildId===M.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((M=>M.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=M.buildId;for(const A of this._inputs){if(!A.connectedPoint){A.isOptional||M.notConnectedNonOptionalInputs.push(A);continue}const O=A.connectedPoint.ownerBlock;O&&O!==this&&!O.isSystem&&O.build(M)}return this._customBuildStep(M),M.verbose&&x.c.Log("Building ".concat(this.name," [").concat(this.getClassName(),"]")),this._build(M),this.onBuildObservable.notifyObservers(this),!1}serialize(){const M={};M.customType="BABYLON."+this.getClassName(),M.id=this.uniqueId,M.name=this.name,M.visibleOnFrame=this.visibleOnFrame,M.inputs=[],M.outputs=[];for(const A of this.inputs)M.inputs.push(A.serialize());for(const A of this.outputs)M.outputs.push(A.serialize(!1));return M}_deserialize(M){this._name=M.name,this.comments=M.comments,this.visibleOnFrame=!!M.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(M)}_deserializePortDisplayNamesAndExposedOnFrame(M){const A=M.inputs,O=M.outputs;if(A)for(const S of A){const M=this.inputs.find((M=>M.name===S.name));if(!M)return;if(S.displayName&&(M.displayName=S.displayName),S.isExposedOnFrame&&(M.isExposedOnFrame=S.isExposedOnFrame,M.exposedPortPosition=S.exposedPortPosition),void 0!==S.value&&null!==S.value)if("number"===S.valueType)M.value=S.value;else{const A=(0,c.c)(S.valueType);A&&(M.value=A.sA(S.value))}}if(O)for(let S=0;S<O.length;S++){const M=O[S];M.displayName&&(this.outputs[S].displayName=M.displayName),M.isExposedOnFrame&&(this.outputs[S].isExposedOnFrame=M.isExposedOnFrame,this.outputs[S].exposedPortPosition=M.exposedPortPosition)}}clone(){const M=this.serialize(),A=(0,c.c)(M.customType);if(A){const O=new A;return O._deserialize(M),O}return null}dispose(){this.Ac.notifyObservers(this),this.Ac.clear();for(const M of this.inputs)M.dispose();for(const M of this.outputs)M.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function mO(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",S=arguments.length>3?arguments[3]:void 0;return(z,Q)=>{let X=z._propStore;X||(X=[],z._propStore=X),X.push({propertyName:Q,displayName:M,type:A,groupName:O,options:null!==S&&void 0!==S?S:{},className:z.getClassName()})}}(0,u.d)([(0,i.H)("comment")],PA.prototype,"comments",void 0),function(M){M[M.Boolean=0]="Boolean",M[M.Float=1]="Float",M[M.Int=2]="Int",M[M.Vector2=3]="Vector2",M[M.List=4]="List",M[M.Cc=5]="Cc",M[M.SamplingMode=6]="SamplingMode",M[M.TextureFormat=7]="TextureFormat",M[M.TextureType=8]="TextureType"}(vA||(vA={})),function(M){M[M.None=0]="None",M[M.Position=1]="Position",M[M.Direction=2]="Direction",M[M.Age=3]="Age",M[M.Lifetime=4]="Lifetime",M[M.Color=5]="Color",M[M.ScaledDirection=6]="ScaledDirection",M[M.Scale=7]="Scale",M[M.AgeGradient=8]="AgeGradient",M[M.Angle=9]="Angle",M[M.SpriteCellIndex=16]="SpriteCellIndex",M[M.SpriteCellStart=17]="SpriteCellStart",M[M.SpriteCellEnd=18]="SpriteCellEnd"}(qA||(qA={})),function(M){M[M.None=0]="None",M[M.Time=1]="Time",M[M.Delta=2]="Delta",M[M.Emitter=3]="Emitter"}(rA||(rA={}));class RA{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let M="";for(const A of this.notConnectedNonOptionalInputs)M+="input ".concat(A.name," from block ").concat(A.ownerBlock.name,"[").concat(A.ownerBlock.getClassName(),"] is not connected and is not optional.\n");if(M)throw"Build of Node Particle System Set failed:\n"+M}adapt(M,A){const O=M.getConnectedValue(this)||0;if(M.type===A)return O;switch(A){case xA.Vector2:return new S.Vector2(O,O);case xA.GA:return new S.GA(O,O,O);case xA.Cc:return new X.Cc(O,O,O,O)}return null}getContextualValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case qA.Position:return this.particleContext.position;case qA.Direction:return this.particleContext.direction;case qA.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case qA.Color:return this.particleContext.color;case qA.Age:return this.particleContext.age;case qA.Lifetime:return this.particleContext.lifeTime;case qA.Angle:return this.particleContext.angle;case qA.Scale:return this.particleContext.scale;case qA.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case qA.SpriteCellEnd:return this.systemContext.endSpriteCellID;case qA.SpriteCellIndex:return this.particleContext.cellIndex;case qA.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.SA.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.SA.absolutePosition:this.systemContext.SA:null}getSystemValue(M){if(!this.particleContext||!this.systemContext)return null;switch(M){case rA.Time:return this.systemContext._actualFrame;case rA.Delta:return this.systemContext._scaledUpdateSpeed;case rA.Emitter:if(this.isEmitterTransformNode){return this.systemContext.SA.absolutePosition}return this.systemContext.SA}return null}}function kA(M,A,O){const S=new RA;S.wA=A;const z=M.createSystem(S);return z.canStart=()=>!0,z.SA=O.clone(),z.disposeOnStop=!0,z.start(),z}class WA extends PA{constructor(M){super(M),this.blendMode=j.BLENDMODE_ONEONE,this.wO=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",xA.Particle),this.registerInput("texture",xA.Texture),this.registerInput("onStart",xA.System,!0),this.registerInput("onEnd",xA.System,!0),this.registerOutput("system",xA.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(M){M.wO=this.wO,M.buildId=this._buildId++,this.build(M);const A=this.particle.getConnectedValue(M);return A.particleTexture=this.texture.getConnectedValue(M),A.emitRate=this.emitRate,A.blendMode=this.blendMode,A.name=this.name,A._nodeGenerated=!0,A._targetStopDuration=this.targetStopDuration,A.startDelay=this.startDelay,this.system._storedValue=this,A.canStart=()=>!this.doNoStart,A.onStartedObservable.add((O=>{const S=this.onStart.getConnectedValue(M);S&&O.onStartedObservable.addOnce((()=>{M.systemContext=A;const O=kA(S,M.wA,M.emitterPosition);this.Ac.addOnce((()=>{O.dispose()}))}));const z=this.onEnd.getConnectedValue(M);z&&O.onStoppedObservable.addOnce((()=>{M.systemContext=A;const O=kA(z,M.wA,M.emitterPosition);this.Ac.addOnce((()=>{O.dispose()}))}))})),this.Ac.addOnce((()=>{A.dispose()})),A}serialize(){const M=super.serialize();return M.wO=this.wO,M.emitRate=this.emitRate,M.blendMode=this.blendMode,M.doNoStart=this.doNoStart,M.targetStopDuration=this.targetStopDuration,M.startDelay=this.startDelay,M}_deserialize(M){super._deserialize(M),this.wO=M.wO,this.emitRate=M.emitRate,this.doNoStart=!!M.doNoStart,void 0!==M.blendMode&&(this.blendMode=M.blendMode),void 0!==M.targetStopDuration&&(this.targetStopDuration=M.targetStopDuration),void 0!==M.startDelay&&(this.startDelay=M.startDelay)}}(0,u.d)([mO("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:j.BLENDMODE_ONEONE},{label:"Standard",value:j.BLENDMODE_STANDARD},{label:"Add",value:j.BLENDMODE_ADD},{label:"Multiply",value:j.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:j.BLENDMODE_MULTIPLYADD}]})],WA.prototype,"blendMode",void 0),(0,u.d)([mO("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],WA.prototype,"wO",void 0),(0,u.d)([mO("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WA.prototype,"emitRate",void 0),(0,u.d)([mO("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WA.prototype,"targetStopDuration",void 0),(0,u.d)([mO("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WA.prototype,"startDelay",void 0),(0,u.d)([mO("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WA.prototype,"doNoStart",void 0),(0,c.g)("BABYLON.SystemBlock",WA);class lA extends PA{get type(){if(this._type===xA.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=xA.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=xA.Vector2,this._type;case"GA":return this._type=xA.GA,this._type;case"Cc":return this._type=xA.Cc,this._type;case"Matrix":return this._type=xA.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===qA.None&&this._systemSource!==rA.None}get systemSource(){return this._systemSource}set systemSource(M){if(this._systemSource=M,M!==rA.None){switch(this._contextualSource=qA.None,this._type=xA.Float,M){case rA.Time:case rA.Delta:this._type=xA.Float;break;case rA.Emitter:this._type=xA.GA}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==qA.None}get contextualValue(){return this._contextualSource}set contextualValue(M){if(this._contextualSource=M,M!==qA.None){switch(this._systemSource=rA.None,M){case qA.Scale:this._type=xA.Vector2;break;case qA.Position:case qA.Direction:case qA.ScaledDirection:this._type=xA.GA;break;case qA.Color:this._type=xA.Cc;break;case qA.Age:case qA.Lifetime:case qA.Angle:case qA.AgeGradient:this._type=xA.Float;break;case qA.SpriteCellEnd:case qA.SpriteCellStart:case qA.SpriteCellIndex:this._type=xA.Int}this.output&&(this.output.type=this._type)}}constructor(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xA.AutoDetect;super(M),this._type=xA.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new k.c,this._systemSource=rA.None,this._contextualSource=qA.None,this._type=A,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",A)}get value(){return this._storedValue}set value(M){this.type===xA.Float&&this.min!==this.max&&(M=Math.max(this.min,M),M=Math.min(this.max,M)),this._storedValue=M,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(M){this._valueCallback=M}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case xA.Int:case xA.Float:this.value=0;break;case xA.Vector2:this.value=S.Vector2.Zero();break;case xA.GA:this.value=S.GA.Zero();break;case xA.Cc:this.value=new X.Cc(1,1,1,1);break;case xA.Matrix:this.value=S.Matrix.Identity()}}_build(M){super._build(M),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=M=>M.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=M=>M.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const M=super.serialize();return M.type=this.type,M.contextualValue=this.contextualValue,M.systemSource=this.systemSource,M.min=this.min,M.max=this.max,M.groupInInspector=this.groupInInspector,M.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.gc?(M.valueType="BABYLON."+this._storedValue.getClassName(),M.value=this._storedValue.gc()):(M.valueType="number",M.value=this._storedValue)),M}_deserialize(M){if(super._deserialize(M),this._type=M.type,this.contextualValue=M.contextualValue,this.systemSource=M.systemSource||rA.None,this.min=M.min||0,this.max=M.max||0,this.groupInInspector=M.groupInInspector||"",void 0!==M.displayInInspector&&(this.displayInInspector=M.displayInInspector),M.valueType)if("number"===M.valueType)this._storedValue=M.value;else{const A=(0,c.c)(M.valueType);A&&(this._storedValue=A.sA(M.value))}}}(0,c.g)("BABYLON.ParticleInputBlock",lA);class MO extends PA{get url(){return this._url}set url(M){this._url!==M&&(this._cachedData=null,this._url=M,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(M){this._textureDataUrl!==M&&(this._cachedData=null,this._textureDataUrl=M,this._url="",this._sourceTexture=null)}set sourceTexture(M){this._sourceTexture!==M&&(this._cachedData=null,this._sourceTexture=M,this._url="",this._textureDataUrl="")}constructor(M){super(M),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",xA.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const M=this.texture._storedValue;return await new Promise(((A,O)=>{if(!M.isReady())return void M.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),A(this._cachedData)}catch(M){O(M)}}));const S=M.getSize();uA.m.GetTextureDataAsync(M,S.width,S.height).then((O=>{this._cachedData={width:S.width,height:S.height,data:new Uint8ClampedArray(O)},M.dispose(),A(this._cachedData)})).catch(O)}))}_build(M){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new L.c(this._textureDataUrl,M.wA):this.texture._storedValue=new L.c(this._url,M.wA):this.texture._storedValue=null}serialize(){const M=super.serialize();return M.url=this.url,M.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(M.textureDataUrl=this.textureDataUrl),M}_deserialize(M){super._deserialize(M),this.url=M.url,this.serializedCachedData=!!M.serializedCachedData,M.textureDataUrl&&(this.textureDataUrl=M.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,c.g)("BABYLON.ParticleTextureSourceBlock",MO);class AO extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("position",xA.GA),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.position.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.position.S(this.position.getConnectedValue(M))},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}}(0,c.g)("BABYLON.UpdatePositionBlock",AO),function(M){M[M.Add=0]="Add",M[M.Subtract=1]="Subtract",M[M.Multiply=2]="Multiply",M[M.Divide=3]="Divide",M[M.Max=4]="Max",M[M.Min=5]="Min"}(nA||(nA={}));class OO extends PA{constructor(M){super(M),this.operation=nA.Add,this.registerInput("left",xA.AutoDetect),this.registerInput("right",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this.output._typeConnectionSource=this.left;const A=[xA.Matrix,xA.Particle,xA.Texture,xA.System,xA.FloatGradient,xA.Color4Gradient,xA.Vector2Gradient,xA.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...A),this.right.excludedConnectionPointTypes.push(...A),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(M){let A;const O=this.left,z=this.right;if(!O.isConnected||!z.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Q=O.type===xA.Float||O.type===xA.Int,c=z.type===xA.Float||z.type===xA.Int,j=Q&&c;switch(this.operation){case nA.Add:A=j?M=>O.getConnectedValue(M)+z.getConnectedValue(M):Q?M=>M.adapt(O,z.type).add(z.getConnectedValue(M)):M=>O.getConnectedValue(M).add(M.adapt(z,O.type));break;case nA.Subtract:A=j?M=>O.getConnectedValue(M)-z.getConnectedValue(M):Q?M=>M.adapt(O,z.type).dA(z.getConnectedValue(M)):M=>O.getConnectedValue(M).dA(M.adapt(z,O.type));break;case nA.Multiply:A=j?M=>O.getConnectedValue(M)*z.getConnectedValue(M):Q?M=>M.adapt(O,z.type).multiply(z.getConnectedValue(M)):M=>O.getConnectedValue(M).multiply(M.adapt(z,O.type));break;case nA.Divide:A=j?M=>O.getConnectedValue(M)/z.getConnectedValue(M):Q?M=>M.adapt(O,z.type).divide(z.getConnectedValue(M)):M=>O.getConnectedValue(M).divide(M.adapt(z,O.type));break;case nA.Min:if(j)A=M=>Math.min(O.getConnectedValue(M),z.getConnectedValue(M));else{const[M,c]=Q?[z,O]:[O,z];switch(M.type){case xA.Vector2:A=A=>S.Vector2.Minimize(M.getConnectedValue(A),A.adapt(c,M.type));break;case xA.GA:A=A=>S.GA.Minimize(M.getConnectedValue(A),A.adapt(c,M.type));break;case xA.Cc:A=A=>{const O=M.getConnectedValue(A),{r:S,g:z,b:Q,a:j}=A.adapt(c,M.type);return new X.Cc(Math.min(O.r,S),Math.min(O.g,z),Math.min(O.b,Q),Math.min(O.a,j))}}}break;case nA.Max:if(!j){const[M,c]=Q?[z,O]:[O,z];switch(M.type){case xA.Vector2:A=A=>S.Vector2.Maximize(M.getConnectedValue(A),A.adapt(c,M.type));break;case xA.GA:A=A=>S.GA.Maximize(M.getConnectedValue(A),A.adapt(c,M.type));break;case xA.Cc:A=A=>{const O=M.getConnectedValue(A),{r:S,g:z,b:Q,a:j}=A.adapt(c,M.type);return new X.Cc(Math.max(O.r,S),Math.min(O.g,z),Math.min(O.b,Q),Math.min(O.a,j))}}break}A=M=>Math.max(O.getConnectedValue(M),z.getConnectedValue(M))}this.output._storedFunction=M=>O.type===xA.Int?0|A(M):A(M)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===xA.Int||this.left.type===xA.Float&&this.right.type!==xA.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[M,A]of[[this.left,this.right],[this.right,this.left]])M.acceptedConnectionPointTypes=[xA.Int,xA.Float],A.isConnected&&(M.acceptedConnectionPointTypes.push(A.type),A.type!==xA.Int&&A.type!==xA.Float||M.acceptedConnectionPointTypes.push(xA.Vector2,xA.GA,xA.Cc))}dispose(){super.dispose();for(const M of this._connectionObservers)M.remove();this._connectionObservers.length=0}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,u.d)([mO("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:nA.Add},{label:"Subtract",value:nA.Subtract},{label:"Multiply",value:nA.Multiply},{label:"Divide",value:nA.Divide},{label:"Max",value:nA.Max},{label:"Min",value:nA.Min}]})],OO.prototype,"operation",void 0),(0,c.g)("BABYLON.ParticleMathBlock",OO);class SO extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("direction1",xA.GA,!0,new S.GA(0,1,0)),this.registerInput("direction2",xA.GA,!0,new S.GA(0,1,0)),this.registerInput("minEmitBox",xA.GA,!0,new S.GA(-.5,-.5,-.5)),this.registerInput("maxEmitBox",xA.GA,!0,new S.GA(.5,.5,.5)),this.registerOutput("output",xA.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const A=this.particle.getConnectedValue(M);A._directionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.direction1.getConnectedValue(M),Q=this.direction2.getConnectedValue(M),X=(0,B.RandomRange)(z.x,Q.x),c=(0,B.RandomRange)(z.y,Q.y),j=(0,B.RandomRange)(z.z,Q.z);M.isEmitterTransformNode?S.GA.TransformNormalFromFloatsToRef(X,c,j,M.emitterWorldMatrix,O.direction):O.direction.Yc(X,c,j)},A._positionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.minEmitBox.getConnectedValue(M),Q=this.maxEmitBox.getConnectedValue(M),X=(0,B.RandomRange)(z.x,Q.x),c=(0,B.RandomRange)(z.y,Q.y),j=(0,B.RandomRange)(z.z,Q.z);M.isEmitterTransformNode?S.GA.TransformCoordinatesFromFloatsToRef(X,c,j,M.emitterWorldMatrix,O.position):(O.position.Yc(X,c,j),O.position.addInPlace(M.emitterPosition))},this.output._storedValue=A}}(0,c.g)("BABYLON.BoxShapeBlock",SO);class zO extends PA{constructor(M){super(M),this.registerInput("emitPower",xA.Float,!0,1),this.registerInput("lifeTime",xA.Float,!0,1),this.registerInput("color",xA.Cc,!0,new X.Cc(1,1,1,1)),this.registerInput("scale",xA.Vector2,!0,new S.Vector2(1,1)),this.registerInput("angle",xA.Float,!0,0),this.registerOutput("particle",xA.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(M){const A=new jA(this.name,M.wO,M.wA,null,!1,void 0,!0);A.particleEmitterType=new w,A._lifeTimeCreation.process=(A,O)=>{M.particleContext=A,A.lifeTime=this.lifeTime.getConnectedValue(M),O._emitPower=this.emitPower.getConnectedValue(M)},A._colorCreation.process=A=>{M.particleContext=A,A.color.S(this.color.getConnectedValue(M))},A._sizeCreation.process=A=>{M.particleContext=A,A.size=1,A.scale.S(this.scale.getConnectedValue(M))},A._angleCreation.process=A=>{M.particleContext=A,A.angle=this.angle.getConnectedValue(M)},this.particle._storedValue=A}}(0,c.g)("BABYLON.CreateParticleBlock",zO);class QO{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const M=[];for(const A of this.attachedBlocks)A.isInput&&M.push(A);return M}constructor(M){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new k.c,this.name=M}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(M)&&this.attachedBlocks.push(M);for(const O of M.inputs){const S=O.connectedPoint;if(S){const O=S.ownerBlock;O!==M&&this._initializeBlock(O,A)}}}async buildAsync(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((O=>{const S=new CA;for(const M of this._systemBlocks)this._initializeBlock(M);for(const z of this.systemBlocks){const O=new RA;O.buildId=this._buildId++,O.wA=M,O.verbose=A;const Q=z.createSystem(O);O.emitErrors(),S.systems.push(Q)}this.onBuildObservable.notifyObservers(this),O(S)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const M=new WA("Particle system"),A=new AO("Update position");A.output.connectTo(M.particle);const O=new lA("Position");O.contextualValue=qA.Position;const S=new lA("Scaled direction");S.contextualValue=qA.ScaledDirection;const z=new OO("Add");z.operation=nA.Add,O.output.connectTo(z.left),S.output.connectTo(z.right),z.output.connectTo(A.position);const Q=new zO("Create particle"),X=new SO("Box shape");Q.particle.connectTo(X.particle),X.output.connectTo(A.particle);const c=new MO("Texture");c.texture.connectTo(M.texture),c.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(M)}removeBlock(M){const A=this.attachedBlocks.indexOf(M);if(A>-1&&this.attachedBlocks.splice(A,1),M.isSystem){const A=this._systemBlocks.indexOf(M);A>-1&&this._systemBlocks.splice(A,1)}}parseSerializedObject(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];A||this.clear();const O={};for(const S of M.we){const M=(0,c.c)(S.customType);if(M){const A=new M;A._deserialize(S),O[S.id]=A,this.attachedBlocks.push(A),A.isSystem&&this._systemBlocks.push(A)}}for(const S of this.attachedBlocks)if(S.isTeleportOut){const M=S,A=M._tempEntryPointUniqueId;if(A){const S=O[A];S&&S.attachToEndpoint(M)}}for(let S=0;S<M.we.length;S++){const z=M.we[S],Q=O[z.id];Q&&(Q.inputs.length&&z.inputs.some((M=>M.targetConnectionName))&&!A||this._restoreConnections(Q,M,O))}if(M.locations||M.editorData&&M.editorData.locations){const S=M.locations||M.editorData.locations;for(const M of S)O[M.pS]&&(M.pS=O[M.pS].uniqueId);A&&this.editorData&&this.editorData.locations&&S.concat(this.editorData.locations),M.locations?this.editorData={locations:S}:(this.editorData=M.editorData,this.editorData.locations=S);const z=[];for(const M in O)z[M]=O[M].uniqueId;this.editorData.map=z}this.comment=M.comment}_restoreConnections(M,A,O){for(const S of M.outputs)for(const z of A.we){const Q=O[z.id];if(Q)for(const X of z.inputs)if(O[X.targetBlockId]!==M||X.targetConnectionName!==S.name);else{const M=Q.getInputByName(X.inputName);if(!M||M.isConnected)continue;S.connectTo(M,!0),this._restoreConnections(Q,A,O)}}}serialize(M){const A=M?{}:U.e.Serialize(this);A.editorData=JSON.parse(JSON.stringify(this.editorData));let O=[];M?O=M:A.customType="BABYLON.NodeParticleSystemSet",A.we=[];for(const S of O)A.we.push(S.serialize());if(!M)for(const S of this.attachedBlocks)-1===O.indexOf(S)&&A.we.push(S.serialize());return A}dispose(){for(const M of this.attachedBlocks)M.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(M){const A=new QO(M);return A.setToDefault(),A}static Parse(M){const A=U.e.Parse((()=>new QO(M.name)),M,null);return A.parseSerializedObject(M),A}static ParseFromSnippetAsync(M,A){return"_BLANK"===M?Promise.resolve(QO.CreateDefault("blank")):new Promise(((O,S)=>{const z=new fA.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const X=JSON.parse(JSON.parse(z.responseText).jsonPayload),c=JSON.parse(X.nodeParticle);A||(A=U.e.Parse((()=>new QO(M)),c,null)),A.parseSerializedObject(c),A.snippetId=M;try{O(A)}catch(Q){S(Q)}}else S("Unable to load the snippet "+M)})),z.open("GET",this.SnippetUrl+"/"+M.replace(/#/g,"/")),z.send()}))}}QO.EditorURL="".concat(YA.Tools._DefaultCdnUrl,"/v").concat(mA.e.Version,"/nodeParticleEditor/babylon.nodeParticleEditor.js"),QO.SnippetUrl="https://snippet.babylonjs.com",(0,u.d)([(0,i.H)()],QO.prototype,"name",void 0),(0,u.d)([(0,i.H)("comment")],QO.prototype,"comment",void 0),function(M){M[M.None=0]="None",M[M.PerParticle=1]="PerParticle",M[M.PerSystem=2]="PerSystem"}(aA||(aA={}));class XO extends PA{constructor(M){super(M),this._currentLockId=-2,this.lockMode=aA.PerParticle,this.registerInput("min",xA.AutoDetect,!0,0),this.registerInput("max",xA.AutoDetect,!0,1),this.registerOutput("output",xA.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xA.Float|xA.Int|xA.Vector2|xA.GA|xA.Cc),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xA.Float|xA.Int|xA.Vector2|xA.GA|xA.Cc),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=xA.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case xA.AutoDetect:case xA.Int:case xA.Float:M=M=>{const A=this.min.getConnectedValue(M)||0,O=this.max.getConnectedValue(M)||1;return A+Math.random()*(O-A)};break;case xA.Vector2:M=M=>{const A=this.min.getConnectedValue(M)||S.Vector2.Zero(),O=this.max.getConnectedValue(M)||S.Vector2.One();return new S.Vector2(A.x+Math.random()*(O.x-A.x),A.y+Math.random()*(O.y-A.y))};break;case xA.GA:M=M=>{const A=this.min.getConnectedValue(M)||S.GA.Zero(),O=this.max.getConnectedValue(M)||S.GA.One();return new S.GA(A.x+Math.random()*(O.x-A.x),A.y+Math.random()*(O.y-A.y),A.z+Math.random()*(O.z-A.z))};break;case xA.Cc:M=M=>{const A=this.min.getConnectedValue(M)||new X.Cc(0,0,0,0),O=this.max.getConnectedValue(M)||new X.Cc(1,1,1,1);return new X.Cc(A.x+Math.random()*(O.x-A.x),A.y+Math.random()*(O.y-A.y),A.z+Math.random()*(O.z-A.z),A.w+Math.random()*(O.w-A.w))}}this.output._storedFunction=A=>{var O;let S=0;switch(this.lockMode){case aA.PerParticle:S=(null===(O=A.particleContext)||void 0===O?void 0:O.id)||-1;break;case aA.PerSystem:S=A.buildId||0}return this._currentLockId!==S&&(this.lockMode!==aA.None&&(this._currentLockId=S),this.output._storedValue=M(A)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),this.lockMode=M.lockMode}}(0,u.d)([mO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:aA.None},{label:"Per particle",value:aA.PerParticle},{label:"Per system",value:aA.PerSystem}]})],XO.prototype,"lockMode",void 0),(0,c.g)("BABYLON.ParticleRandomBlock",XO);class cO extends PA{constructor(M){super(M),this._currentLockId=-2,this.lockMode=aA.PerParticle,this.registerInput("min",xA.AutoDetect),this.registerInput("max",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const A=[xA.Matrix,xA.Particle,xA.Texture,xA.System,xA.FloatGradient,xA.Color4Gradient,xA.Vector2Gradient,xA.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...A),this.max.excludedConnectionPointTypes.push(...A)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let M=null;switch(this._currentLockId=-2,this.min.type){case xA.Float:case xA.Int:M=M=>{const A=this.min.getConnectedValue(M),O=this.max.getConnectedValue(M);return Math.random()*(O-A)+A};break;case xA.Vector2:M=M=>{const A=this.min.getConnectedValue(M),O=this.max.getConnectedValue(M);return new S.Vector2(Math.random()*(O.x-A.x)+A.x,Math.random()*(O.y-A.y)+A.y)};break;case xA.GA:M=M=>{const A=this.min.getConnectedValue(M),O=this.max.getConnectedValue(M);return new S.GA(Math.random()*(O.x-A.x)+A.x,Math.random()*(O.y-A.y)+A.y,Math.random()*(O.z-A.z)+A.z)};break;case xA.Cc:M=M=>{const A=this.min.getConnectedValue(M),O=this.max.getConnectedValue(M);return new X.Cc(Math.random()*(O.r-A.r)+A.r,Math.random()*(O.g-A.g)+A.g,Math.random()*(O.b-A.b)+A.b,Math.random()*(O.a-A.a)+A.a)}}this.output._storedFunction=A=>{var O;let S=0;switch(this.lockMode){case aA.PerParticle:S=(null===(O=A.particleContext)||void 0===O?void 0:O.id)||-1;break;case aA.PerSystem:S=A.buildId||0}return this._currentLockId!==S&&(this.lockMode!==aA.None&&(this._currentLockId=S),this.output._storedValue=M(A)),this.output._storedValue}}serialize(){const M=super.serialize();return M.lockMode=this.lockMode,M}_deserialize(M){super._deserialize(M),void 0!==M.lockMode&&(this.lockMode=M.lockMode)}}(0,u.d)([mO("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:aA.None},{label:"Per particle",value:aA.PerParticle},{label:"Per system",value:aA.PerSystem}]})],cO.prototype,"lockMode",void 0),(0,c.g)("BABYLON.RandomRangeBlock",cO);(0,c.g)("BABYLON.ParticleLerpBlock",class extends PA{constructor(M){super(M),this.registerInput("left",xA.AutoDetect),this.registerInput("right",xA.AutoDetect),this.registerInput("gradient",xA.Float,!0,0,0,1),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xA.Float|xA.Int|xA.Vector2|xA.GA|xA.Cc)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const M=(M,A,O)=>(1-M)*A+M*O;this.output._storedFunction=A=>{const O=this.left.getConnectedValue(A),z=this.right.getConnectedValue(A),Q=this.gradient.getConnectedValue(A);switch(this.left.type){case xA.Int:case xA.Float:return M(Q,O,z);case xA.Vector2:return new S.Vector2(M(Q,O.x,z.x),M(Q,O.y,z.y));case xA.GA:return new S.GA(M(Q,O.x,z.x),M(Q,O.y,z.y),M(Q,O.z,z.z));case xA.Cc:return new X.Cc(M(Q,O.r,z.r),M(Q,O.g,z.g),M(Q,O.b,z.b),M(Q,O.a,z.a))}return 0}}});(0,c.g)("BABYLON.UpdateDirectionBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("direction",xA.GA),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.direction.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.direction.S(this.direction.getConnectedValue(M))},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}});(0,c.g)("BABYLON.UpdateColorBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("color",xA.Cc),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.color.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.color.S(this.color.getConnectedValue(M))},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}});(0,c.g)("BABYLON.UpdateScaleBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("scale",xA.Vector2),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.scale.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.scale.S(this.scale.getConnectedValue(M))},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}});(0,c.g)("BABYLON.UpdateAngleBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("angle",xA.Float),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.angle.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.angle=this.angle.getConnectedValue(M)},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}});(0,c.g)("BABYLON.BasicPositionUpdateBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(M){const A=this.particle.getConnectedValue(M),O={process:O=>{M.particleContext=O,M.systemContext=A,O.direction.scaleToRef(A._directionScale,A._scaledDirection),O.position.addInPlace(A._scaledDirection)},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O,this.output._storedValue=A}});(0,c.g)("BABYLON.BasicSpriteUpdateBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(M){const A=this.particle.getConnectedValue(M),O={process:O=>{M.particleContext=O,M.systemContext=A,O.updateCellIndex()},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O,this.output._storedValue=A}});(0,c.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("cellIndex",xA.Int),this.registerOutput("output",xA.Particle),this.cellIndex.acceptedConnectionPointTypes=[xA.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(M){const A=this.particle.getConnectedValue(M);if(this.output._storedValue=A,!this.cellIndex.isConnected)return;const O={process:O=>{M.particleContext=O,M.systemContext=A,O.cellIndex=Math.floor(this.cellIndex.getConnectedValue(M))},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O}});class jO extends PA{constructor(M){super(M),this.strength=1,this.registerInput("particle",xA.Particle),this.registerInput("flowMap",xA.Texture),this.registerOutput("output",xA.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(M){var A;const O=this.particle.getConnectedValue(M),S=M.wA;let z;(null===(A=this.flowMap.connectedPoint)||void 0===A?void 0:A.ownerBlock).extractTextureContentAsync().then((M=>{M&&(z=new tA(M.width,M.height,M.data))}));const Q={process:M=>{const A=S.getTransformMatrix();z&&z._processParticle(M,this.strength*O._tempScaledUpdateSpeed,A)},previousItem:null,nextItem:null};O._updateQueueStart?rM(Q,O._updateQueueStart):O._updateQueueStart=Q,this.output._storedValue=O}serialize(){const M=super.serialize();return M.strength=this.strength,M}_deserialize(M){super._deserialize(M),this.strength=M.strength}}(0,u.d)([mO("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jO.prototype,"strength",void 0),(0,c.g)("BABYLON.UpdateFlowMapBlock",jO);(0,c.g)("BABYLON.SphereShapeBlock",class extends PA{constructor(M){super(M),this.registerInput("input",xA.Particle),this.registerInput("radius",xA.Float,!0,1),this.registerInput("radiusRange",xA.Float,!0,1,0,1),this.registerInput("directionRandomizer",xA.Float,!0,0,0,1),this.registerOutput("output",xA.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(M){const A=this.input.getConnectedValue(M);A._directionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.directionRandomizer.getConnectedValue(M),Q=O.position.dA(M.emitterPosition).normalize(),X=(0,B.RandomRange)(0,z),c=(0,B.RandomRange)(0,z),j=(0,B.RandomRange)(0,z);Q.x+=X,Q.y+=c,Q.z+=j,Q.normalize(),M.isEmitterTransformNode?S.GA.TransformNormalFromFloatsToRef(X,c,j,M.emitterWorldMatrix,O.direction):O.direction.Yc(X,c,j)},A._positionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.radius.getConnectedValue(M),Q=this.radiusRange.getConnectedValue(M),X=z-(0,B.RandomRange)(0,z*Q),c=(0,B.RandomRange)(0,1),j=(0,B.RandomRange)(0,2*Math.PI),g=Math.acos(2*c-1),e=X*Math.cos(j)*Math.sin(g),T=X*Math.cos(g),J=X*Math.sin(j)*Math.sin(g);M.isEmitterTransformNode?S.GA.TransformCoordinatesFromFloatsToRef(e,T,J,M.emitterWorldMatrix,O.position):(O.position.Yc(e,T,J),O.position.addInPlace(M.emitterPosition))},this.output._storedValue=A}});(0,c.g)("BABYLON.PointShapeBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("direction1",xA.GA,!0,new S.GA(0,1,0)),this.registerInput("direction2",xA.GA,!0,new S.GA(0,1,0)),this.registerOutput("output",xA.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const A=this.particle.getConnectedValue(M);A._directionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.direction1.getConnectedValue(M),Q=this.direction2.getConnectedValue(M),X=(0,B.RandomRange)(z.x,Q.x),c=(0,B.RandomRange)(z.y,Q.y),j=(0,B.RandomRange)(z.z,Q.z);M.isEmitterTransformNode?S.GA.TransformNormalFromFloatsToRef(X,c,j,M.emitterWorldMatrix,O.direction):O.direction.Yc(X,c,j)},A._positionCreation.process=O=>{M.systemContext=A,M.isEmitterTransformNode?S.GA.TransformCoordinatesFromFloatsToRef(0,0,0,M.emitterWorldMatrix,O.position):O.position.S(M.emitterPosition)},this.output._storedValue=A}});(0,c.g)("BABYLON.CustomShapeBlock",class extends PA{constructor(M){super(M),this.registerInput("particle",xA.Particle),this.registerInput("position",xA.GA,!0,new S.GA(0,0,0)),this.registerInput("direction",xA.GA,!0,new S.GA(0,1,0)),this.registerOutput("output",xA.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){const A=this.particle.getConnectedValue(M);A._directionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.direction.getConnectedValue(M);M.isEmitterTransformNode?S.GA.TransformNormalToRef(z,M.emitterWorldMatrix,O.direction):O.direction.S(z)},A._positionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.position.getConnectedValue(M);M.isEmitterTransformNode?S.GA.TransformCoordinatesToRef(z,M.emitterWorldMatrix,O.position):(O.position.S(z),O.position.addInPlace(M.emitterPosition))},this.output._storedValue=A}});(0,c.g)("BABYLON.CylinderShapeBlock",class extends PA{constructor(M){super(M),this._tempVector=S.GA.Zero(),this.registerInput("particle",xA.Particle),this.registerInput("radius",xA.Float,!0,1),this.registerInput("height",xA.Float,!0,1,0),this.registerInput("radiusRange",xA.Float,!0,1,0,1),this.registerInput("directionRandomizer",xA.Float,!0,0,0,1),this.registerOutput("output",xA.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(M){const A=this.particle.getConnectedValue(M);A._directionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.directionRandomizer.getConnectedValue(M);O.position.subtractToRef(M.emitterPosition,this._tempVector),this._tempVector.normalize(),M.isEmitterTransformNode&&S.GA.TransformNormalToRef(this._tempVector,M.emitterInverseWorldMatrix,this._tempVector);const Q=(0,B.RandomRange)(-z/2,z/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,B.RandomRange)(-Math.PI/2,Math.PI/2)*z,this._tempVector.y=Q,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),M.isEmitterTransformNode?S.GA.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,M.emitterWorldMatrix,O.direction):O.direction.S(this._tempVector)},A._positionCreation.process=O=>{M.particleContext=O,M.systemContext=A;const z=this.height.getConnectedValue(M),Q=this.radiusRange.getConnectedValue(M),X=this.radius.getConnectedValue(M),c=(0,B.RandomRange)(-z/2,z/2),j=(0,B.RandomRange)(0,2*Math.PI),g=(0,B.RandomRange)((1-Q)*(1-Q),1),e=Math.sqrt(g)*X,T=e*Math.cos(j),J=e*Math.sin(j);M.isEmitterTransformNode?S.GA.TransformCoordinatesFromFloatsToRef(T,c,J,M.emitterWorldMatrix,O.position):(O.position.Yc(T,c,J),O.position.addInPlace(M.emitterPosition))},this.output._storedValue=A}});class BO extends PA{constructor(M){super(M),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",xA.Particle),this.registerOutput("output",xA.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const A=this.particle.getConnectedValue(M);A._isAnimationSheetEnabled=!0,A.spriteCellWidth=this.width,A.spriteCellHeight=this.height,A.startSpriteCellID=this.start,A.endSpriteCellID=this.end,A.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=A}serialize(){const M=super.serialize();return M.width=this.width,M.height=this.height,M.start=this.start,M.end=this.end,M.randomStartCell=this.randomStartCell,M}_deserialize(M){super._deserialize(M),this.width=M.width,this.height=M.height,this.start=M.start,this.end=M.end,this.randomStartCell=M.randomStartCell}}(0,u.d)([mO("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BO.prototype,"start",void 0),(0,u.d)([mO("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BO.prototype,"end",void 0),(0,u.d)([mO("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BO.prototype,"width",void 0),(0,u.d)([mO("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BO.prototype,"height",void 0),(0,u.d)([mO("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BO.prototype,"loop",void 0),(0,u.d)([mO("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],BO.prototype,"randomStartCell",void 0),(0,c.g)("BABYLON.SetupSpriteSheetBlock",BO);class gO extends PA{constructor(M){super(M),this.reference=0,this.registerInput("value",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case xA.Float:return xA.FloatGradient;case xA.Vector2:return xA.Vector2Gradient;case xA.GA:return xA.Vector3Gradient;case xA.Cc:return xA.Color4Gradient}return M},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xA.Float|xA.Vector2|xA.GA|xA.Cc)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=M=>null}serialize(){const M=super.serialize();return M.reference=this.reference,M}_deserialize(M){super._deserialize(M),this.reference=M.reference}}(0,u.d)([mO("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],gO.prototype,"reference",void 0),(0,c.g)("BABYLON.ParticleGradientValueBlock",gO);(0,c.g)("BABYLON.ParticleGradientBlock",class extends PA{constructor(M){super(M),this._entryCount=1,this.registerInput("gradient",xA.Float,!0,1,0,1),this.registerInput("value0",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=M=>{switch(M){case xA.FloatGradient:return xA.Float;case xA.Vector2Gradient:return xA.Vector2;case xA.Vector3Gradient:return xA.GA;case xA.Color4Gradient:return xA.Cc}return M},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(xA.FloatGradient|xA.Vector2Gradient|xA.Vector3Gradient|xA.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(M){this._inputs[M].onConnectionObservable.add((()=>{this._entryCount>M||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),xA.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const M=[];for(let O=1;O<this._inputs.length;O++){var A;if(this._inputs[O].isConnected)M.push(null===(A=this._inputs[O].connectedPoint)||void 0===A?void 0:A.ownerBlock)}M.sort(((M,A)=>M.reference-A.reference)),this.output._storedFunction=A=>{const O=this.gradient.getConnectedValue(A);if(1===M.length)return M[0].value.getConnectedValue(A);let z=null;for(let Q=M.length-1;Q>=0;Q--){const c=M[Q];if(c.reference<=O){const M=c.value.getConnectedValue(A);if(z){const Q=z.value.getConnectedValue(A),j=z.reference,g=c.reference,e=Math.max(0,Math.min(1,(O-g)/(j-g)));switch(this.output.type){case xA.Float:return(0,B.Lerp)(M,Q,e);case xA.Vector2:return S.Vector2.Lerp(M,Q,e);case xA.GA:return S.GA.Lerp(M,Q,e);case xA.Cc:return X.Cc.Lerp(M,Q,e)}}return M}z=c}return 0}}});(0,c.g)("BABYLON.ParticleConverterBlock",class extends PA{constructor(M){super(M),this.registerInput("color ",xA.Cc,!0),this.registerInput("xyz ",xA.GA,!0),this.registerInput("xy ",xA.Vector2,!0),this.registerInput("zw ",xA.Vector2,!0),this.registerInput("x ",xA.Float,!0),this.registerInput("y ",xA.Float,!0),this.registerInput("z ",xA.Float,!0),this.registerInput("w ",xA.Float,!0),this.registerOutput("color",xA.Cc),this.registerOutput("xyz",xA.GA),this.registerOutput("xy",xA.Vector2),this.registerOutput("zw",xA.Vector2),this.registerOutput("x",xA.Float),this.registerOutput("y",xA.Float),this.registerOutput("z",xA.Float),this.registerOutput("w",xA.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(M){return"color "===M?"colorIn":"xyz "===M?"xyzIn":"xy "===M?"xyIn":"zw "===M?"zwIn":"x "===M?"xIn":"y "===M?"yIn":"z "===M?"zIn":"w "===M?"wIn":M}_outputRename(M){switch(M){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return M}}_build(M){super._build(M);const A=this.xIn,O=this.yIn,z=this.zIn,Q=this.wIn,c=this.xyIn,j=this.zwIn,B=this.xyzIn,g=this.colorIn,e=this.colorOut,T=this.xyzOut,J=this.xyOut,K=this.zwOut,G=this.xOut,d=this.yOut,w=this.zOut,I=this.wOut,b=M=>{if(g.isConnected)return g.getConnectedValue(M);let S=0,e=0,T=0,J=0;if(A.isConnected&&(S=A.getConnectedValue(M)),O.isConnected&&(e=O.getConnectedValue(M)),z.isConnected&&(T=z.getConnectedValue(M)),Q.isConnected&&(J=Q.getConnectedValue(M)),c.isConnected){const A=c.getConnectedValue(M);A&&(S=A.x,e=A.y)}if(j.isConnected){const A=j.getConnectedValue(M);A&&(T=A.x,J=A.y)}if(B.isConnected){const A=B.getConnectedValue(M);A&&(S=A.x,e=A.y,T=A.z)}return new X.Cc(S,e,T,J)};e._storedFunction=M=>b(M),T._storedFunction=M=>{const A=b(M);return new S.GA(A.r,A.g,A.b)},J._storedFunction=M=>{const A=b(M);return new S.Vector2(A.r,A.g)},K._storedFunction=M=>{const A=b(M);return new S.Vector2(A.b,A.a)},G._storedFunction=M=>b(M).r,d._storedFunction=M=>b(M).g,w._storedFunction=M=>b(M).b,I._storedFunction=M=>b(M).a}}),function(M){M[M.Cos=0]="Cos",M[M.Sin=1]="Sin",M[M.Abs=2]="Abs",M[M.Exp=3]="Exp",M[M.Exp2=4]="Exp2",M[M.Round=5]="Round",M[M.Floor=6]="Floor",M[M.Ceiling=7]="Ceiling",M[M.Sqrt=8]="Sqrt",M[M.Log=9]="Log",M[M.Tan=10]="Tan",M[M.ArcTan=11]="ArcTan",M[M.ArcCos=12]="ArcCos",M[M.ArcSin=13]="ArcSin",M[M.Sign=14]="Sign",M[M.Negate=15]="Negate",M[M.OneMinus=16]="OneMinus",M[M.Reciprocal=17]="Reciprocal",M[M.ToDegrees=18]="ToDegrees",M[M.ToRadians=19]="ToRadians",M[M.Fract=20]="Fract"}(VA||(VA={}));class eO extends PA{constructor(M){super(M),this.operation=VA.Cos,this.registerInput("input",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(xA.Float|xA.Int|xA.Vector2|xA.GA|xA.Cc)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);let A=null;switch(this.operation){case VA.Cos:A=M=>Math.cos(M);break;case VA.Sin:A=M=>Math.sin(M);break;case VA.Abs:A=M=>Math.abs(M);break;case VA.Exp:A=M=>Math.exp(M);break;case VA.Exp2:A=M=>Math.pow(2,M);break;case VA.Round:A=M=>Math.round(M);break;case VA.Floor:A=M=>Math.floor(M);break;case VA.Ceiling:A=M=>Math.ceil(M);break;case VA.Sqrt:A=M=>Math.sqrt(M);break;case VA.Log:A=M=>Math.log(M);break;case VA.Tan:A=M=>Math.tan(M);break;case VA.ArcTan:A=M=>Math.atan(M);break;case VA.ArcCos:A=M=>Math.acos(M);break;case VA.ArcSin:A=M=>Math.asin(M);break;case VA.Sign:A=M=>Math.sign(M);break;case VA.Negate:A=M=>-M;break;case VA.OneMinus:A=M=>1-M;break;case VA.Reciprocal:A=M=>1/M;break;case VA.ToRadians:A=M=>M*Math.PI/180;break;case VA.ToDegrees:A=M=>180*M/Math.PI;break;case VA.Fract:A=M=>M>=0?M-Math.floor(M):M-Math.ceil(M)}if(!A)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case xA.Int:case xA.Float:this.output._storedFunction=M=>{const O=this.input.getConnectedValue(M);return A(O)};break;case xA.Vector2:this.output._storedFunction=M=>{const O=this.input.getConnectedValue(M);return new S.Vector2(A(O.x),A(O.y))};break;case xA.GA:this.output._storedFunction=M=>{const O=this.input.getConnectedValue(M);return new S.GA(A(O.x),A(O.y),A(O.z))};break;case xA.Cc:this.output._storedFunction=M=>{const O=this.input.getConnectedValue(M);return new X.Cc(A(O.r),A(O.g),A(O.b),A(O.a))}}return this}serialize(){const M=super.serialize();return M.operation=this.operation,M}_deserialize(M){super._deserialize(M),this.operation=M.operation}}(0,u.d)([mO("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:VA.Cos},{label:"Sin",value:VA.Sin},{label:"Abs",value:VA.Abs},{label:"Exp",value:VA.Exp},{label:"Exp2",value:VA.Exp2},{label:"Round",value:VA.Round},{label:"Floor",value:VA.Floor},{label:"Ceiling",value:VA.Ceiling},{label:"Sqrt",value:VA.Sqrt},{label:"Log",value:VA.Log},{label:"Tan",value:VA.Tan},{label:"ArcTan",value:VA.ArcTan},{label:"ArcCos",value:VA.ArcCos},{label:"ArcSin",value:VA.ArcSin},{label:"Sign",value:VA.Sign},{label:"Negate",value:VA.Negate},{label:"OneMinus",value:VA.OneMinus},{label:"Reciprocal",value:VA.Reciprocal},{label:"ToDegrees",value:VA.ToDegrees},{label:"ToRadians",value:VA.ToRadians},{label:"Fract",value:VA.Fract}]})],eO.prototype,"operation",void 0),(0,c.g)("BABYLON.ParticleTrigonometryBlock",eO);var TO,JO=O(13949);class KO extends PA{constructor(M){super(M),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(xA.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(xA.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(xA.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(xA.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(xA.System),this._inputs[0].excludedConnectionPointTypes.push(xA.Particle),this._inputs[0].excludedConnectionPointTypes.push(xA.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const A=M=>{const A=this.input.getConnectedValue(M);if(this.log.length>=this.stackSize)return A;if(null===A||void 0===A)return this.log.push(["null",""]),A;switch(this.input.type){case xA.Vector2:this.log.push([(0,JO.j)(A,4),A.toString()]);break;case xA.GA:this.log.push([(0,JO.m)(A,4),A.toString()]);break;case xA.Cc:this.log.push(["{R: ".concat(A.r.toFixed(4)," G: ").concat(A.g.toFixed(4)," B: ").concat(A.b.toFixed(4)," A: ").concat(A.a.toFixed(4),"}"),A.toString()]);break;default:this.log.push([A.toString(),A.toString()])}return A};this.output.isConnected?this.output._storedFunction=A:this.output._storedValue=A(M)}serialize(){const M=super.serialize();return M.stackSize=this.stackSize,M}_deserialize(M){super._deserialize(M),this.stackSize=M.stackSize}}(0,u.d)([mO("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],KO.prototype,"stackSize",void 0),(0,c.g)("BABYLON.ParticleDebugBlock",KO);(0,c.g)("BABYLON.ParticleElbowBlock",class extends PA{constructor(M){super(M),this.registerInput("input",xA.AutoDetect),this.registerOutput("output",xA.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(M){super._build(M);const A=this._outputs[0],O=this._inputs[0];A._storedFunction=M=>O.getConnectedValue(M)}});(0,c.g)("BABYLON.ParticleTeleportInBlock",class extends PA{get endpoints(){return this._endpoints}constructor(M){super(M),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",xA.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(M){if(this.getClassName()===M)return!0;for(const A of this.endpoints)if(A.isAnAncestorOfType(M))return!0;return!1}isAnAncestorOf(M){for(const A of this.endpoints){if(A===M)return!0;if(A.isAnAncestorOf(M))return!0}return!1}attachToEndpoint(M){M.detach(),this._endpoints.push(M),M._entryPoint=this,M._outputs[0]._typeConnectionSource=this._inputs[0],M._tempEntryPointUniqueId=null,M.name="> "+this.name}detachFromEndpoint(M){const A=this._endpoints.indexOf(M);-1!==A&&(this._endpoints.splice(A,1),M._outputs[0]._typeConnectionSource=null,M._entryPoint=null)}_build(){for(const M of this._endpoints)M.output._storedFunction=M=>this.input.getConnectedValue(M)}});(0,c.g)("BABYLON.ParticleTeleportOutBlock",class extends PA{constructor(M){super(M),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",xA.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(M){this.entryPoint&&this.entryPoint.build(M)}clone(){const M=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(M),M}serialize(){var M,A;const O=super.serialize();return O.entryPoint=null!==(M=null===(A=this.entryPoint)||void 0===A?void 0:A.uniqueId)&&void 0!==M?M:"",O}_deserialize(M){super._deserialize(M),this._tempEntryPointUniqueId=M.entryPoint}}),function(M){M[M.Equal=0]="Equal",M[M.NotEqual=1]="NotEqual",M[M.LessThan=2]="LessThan",M[M.GreaterThan=3]="GreaterThan",M[M.LessOrEqual=4]="LessOrEqual",M[M.GreaterOrEqual=5]="GreaterOrEqual",M[M.Xor=6]="Xor",M[M.Or=7]="Or",M[M.And=8]="And"}(TO||(TO={}));class GO extends PA{constructor(M){super(M),this.test=TO.Equal,this.epsilon=0,this.registerInput("left",xA.Float),this.registerInput("right",xA.Float,!0,0),this.registerInput("ifTrue",xA.AutoDetect,!0,1),this.registerInput("ifFalse",xA.AutoDetect,!0,0),this.registerOutput("output",xA.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=xA.Float,this._inputs[0].acceptedConnectionPointTypes.push(xA.Int),this._inputs[1].acceptedConnectionPointTypes.push(xA.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const M=M=>{const A=this.left.getConnectedValue(M),O=this.right.getConnectedValue(M);let S=!1;switch(this.test){case TO.Equal:S=(0,B.WithinEpsilon)(A,O,this.epsilon);break;case TO.NotEqual:S=!(0,B.WithinEpsilon)(A,O,this.epsilon);break;case TO.LessThan:S=A<O+this.epsilon;break;case TO.GreaterThan:S=A>O-this.epsilon;break;case TO.LessOrEqual:S=A<=O+this.epsilon;break;case TO.GreaterOrEqual:S=A>=O-this.epsilon;break;case TO.Xor:S=!!A&&!O||!A&&!!O;break;case TO.Or:S=!!A||!!O;break;case TO.And:S=!!A&&!!O}return S};this.output._storedFunction=A=>M(A)?this.ifTrue.getConnectedValue(A):this.ifFalse.getConnectedValue(A)}serialize(){const M=super.serialize();return M.test=this.test,M.epsilon=this.epsilon,M}_deserialize(M){super._deserialize(M),this.test=M.test,void 0!==M.epsilon&&(this.epsilon=M.epsilon)}}(0,u.d)([mO("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:TO.Equal},{label:"NotEqual",value:TO.NotEqual},{label:"LessThan",value:TO.LessThan},{label:"GreaterThan",value:TO.GreaterThan},{label:"LessOrEqual",value:TO.LessOrEqual},{label:"GreaterOrEqual",value:TO.GreaterOrEqual},{label:"Xor",value:TO.Xor},{label:"Or",value:TO.Or},{label:"And",value:TO.And}]})],GO.prototype,"test",void 0),(0,u.d)([mO("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],GO.prototype,"epsilon",void 0),(0,c.g)("BABYLON.ParticleConditionBlock",GO);class dO extends PA{constructor(M){super(M),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",xA.Particle),this.registerInput("condition",xA.Float,!0,0),this.registerInput("system",xA.System),this.registerOutput("output",xA.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(M){this._triggerCount=0;const A=this.input.getConnectedValue(M),O={process:O=>{if(M.particleContext=O,M.systemContext=A,0!==this.condition.getConnectedValue(M)&&(0===this.limit||this._triggerCount<this.limit)){const S=(new Date).getTime();if(this._previousOne&&S-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=S;const z=this.system.getConnectedValue(M);if(z){const S=kA(z,M.wA,O.position);S.Ac.addOnce((()=>{this._triggerCount--})),A.Ac.addOnce((()=>{S.dispose()}))}}},previousItem:null,nextItem:null};A._updateQueueStart?rM(O,A._updateQueueStart):A._updateQueueStart=O,this.output._storedValue=A}serialize(){const M=super.serialize();return M.limit=this.limit,M.delay=this.delay,M}_deserialize(M){super._deserialize(M),void 0!==M.limit&&(this.limit=M.limit),void 0!==M.delay&&(this.delay=M.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,u.d)([mO("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dO.prototype,"limit",void 0),(0,u.d)([mO("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dO.prototype,"delay",void 0),(0,c.g)("BABYLON.ParticleTriggerBlock",dO);O(13952),O(13965),O(13976),O(14028)},14015:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},13980:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14047:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneVertex",Q="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14036:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14023:(M,A,O)=>{"use strict";var S=O(12864);const z="fogFragment",Q="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14007:(M,A,O)=>{"use strict";var S=O(12864);const z="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14051:(M,A,O)=>{"use strict";var S=O(12864);const z="fogVertex",Q="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14043:(M,A,O)=>{"use strict";var S=O(12864);const z="fogVertexDeclaration",Q="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},13995:(M,A,O)=>{"use strict";var S=O(12864);const z="helperFunctions",Q="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},13988:(M,A,O)=>{"use strict";var S=O(12864);const z="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14001:(M,A,O)=>{"use strict";var S=O(12864);const z="imageProcessingFunctions",Q="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},13991:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14020:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},14056:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";S.c.IncludesShadersStoreWGSL[z]||(S.c.IncludesShadersStoreWGSL[z]=Q)},13976:(M,A,O)=>{"use strict";O.r(A),O.d(A,{particlesPixelShaderWGSL:()=>X});var S=O(12864);O(13980),O(13988),O(13991),O(13995),O(14001),O(14007),O(14015),O(14020),O(14023);const z="particlesPixelShader",Q="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStoreWGSL[z]||(S.c.ShadersStoreWGSL[z]=Q);const X={name:z,shader:Q}},14028:(M,A,O)=>{"use strict";O.r(A),O.d(A,{particlesVertexShaderWGSL:()=>X});var S=O(12864);O(14036),O(14043),O(13991),O(14047),O(14051),O(14056);const z="particlesVertexShader",Q="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStoreWGSL[z]||(S.c.ShadersStoreWGSL[z]=Q);const X={name:z,shader:Q}},13895:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneFragment",Q="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13956:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneFragmentDeclaration",Q="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13922:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneVertex",Q="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13972:(M,A,O)=>{"use strict";var S=O(12864);const z="clipPlaneVertexDeclaration",Q="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13907:(M,A,O)=>{"use strict";var S=O(12864);const z="fogFragment",Q="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13886:(M,A,O)=>{"use strict";var S=O(12864);const z="fogFragmentDeclaration",Q="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13924:(M,A,O)=>{"use strict";var S=O(12864);const z="fogVertex",Q="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13914:(M,A,O)=>{"use strict";var S=O(12864);const z="fogVertexDeclaration",Q="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13876:(M,A,O)=>{"use strict";var S=O(12864);const z="helperFunctions",Q="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13866:(M,A,O)=>{"use strict";var S=O(12864);const z="imageProcessingDeclaration",Q="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13880:(M,A,O)=>{"use strict";var S=O(12864);const z="imageProcessingFunctions",Q="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13869:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthDeclaration",Q="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13900:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthFragment",Q="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13926:(M,A,O)=>{"use strict";var S=O(12864);const z="logDepthVertex",Q="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";S.c.IncludesShadersStore[z]||(S.c.IncludesShadersStore[z]=Q)},13952:(M,A,O)=>{"use strict";O.r(A),O.d(A,{particlesPixelShader:()=>X});var S=O(12864);O(13956),O(13866),O(13869),O(13876),O(13880),O(13886),O(13895),O(13900),O(13907);const z="particlesPixelShader",Q="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";S.c.ShadersStore[z]||(S.c.ShadersStore[z]=Q);const X={name:z,shader:Q}},13965:(M,A,O)=>{"use strict";O.r(A),O.d(A,{particlesVertexShader:()=>X});var S=O(12864);O(13972),O(13914),O(13869),O(13922),O(13924),O(13926);const z="particlesVertexShader",Q="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";S.c.ShadersStore[z]||(S.c.ShadersStore[z]=Q);const X={name:z,shader:Q}},14293:(M,A,O)=>{"use strict";O.r(A),O.d(A,{FlowGraphGLTFDataProvider:()=>Q});var S=O(14255),z=O(14238);class Q extends S.c{constructor(M){var A,O;super();const S=M.glTF,Q=(null===(A=S.animations)||void 0===A?void 0:A.map((M=>M._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",z.b,Q);const X=(null===(O=S.nodes)||void 0===O?void 0:O.map((M=>M._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",z.b,X)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14180:(M,A,O)=>{"use strict";O.d(A,{b:()=>d,e:()=>K,i:()=>J,l:()=>G});var S=O(12970),z=O(13455),Q=O(13010),X=O(14186);const c=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class j{constructor(M,A){this._gltf=M,this._infoTree=A}convert(M){let A,O=this._gltf,S=this._infoTree;if(!M.startsWith("/"))throw new Error("Path must start with a /");const z=M.split("/");if(z.shift(),z[z.length-1].includes(".length")){const M=z[z.length-1].split(".");z.pop(),z.push(...M)}let Q=!1;for(const j of z){const z="length"===j;if(z&&!S.__array__)throw new Error("Path ".concat(M," is invalid"));if(S.__ignoreObjectTree__&&(Q=!0),S.__array__&&!z)S=S.__array__;else if(S=S[j],!S)throw new Error("Path ".concat(M," is invalid"));if(!Q)if(void 0===O){if(!c.find((A=>A.regex.test(M))))throw new Error("Path ".concat(M," is invalid"))}else if(!z){var X;O=null===(X=O)||void 0===X?void 0:X[j]}(S.__target__||z)&&(A=O)}return{object:A,info:S}}}function B(M,A,O,S){const z=g(M,A);return S?z[O][S]:z[O]}function g(M,A,O){var S,Q,X;return null===(S=M._data)||void 0===S||null===(Q=S[null!==(X=null===O||void 0===O?void 0:O.fillMode)&&void 0!==X?X:z.d.MATERIAL_TriangleFillMode])||void 0===Q?void 0:Q.babylonMaterial}function e(M,A){return{offset:{componentsCount:2,type:"Vector2",get:(O,z,Q)=>{const X=B(O,Q,M,A);return new S.Vector2(null===X||void 0===X?void 0:X.uOffset,null===X||void 0===X?void 0:X.vOffset)},getTarget:g,set:(O,S,z,Q)=>{const X=B(S,Q,M,A);X.uOffset=O.x,X.vOffset=O.y},getPropertyName:[()=>"".concat(M).concat(A?"."+A:"",".uOffset"),()=>"".concat(M).concat(A?"."+A:"",".vOffset")]},rotation:{type:"number",get:(O,S,z)=>{var Q;return null===(Q=B(O,z,M,A))||void 0===Q?void 0:Q.wAng},getTarget:g,set:(O,S,z,Q)=>B(S,Q,M,A).wAng=O,getPropertyName:[()=>"".concat(M).concat(A?"."+A:"",".wAng")]},scale:{componentsCount:2,type:"Vector2",get:(O,z,Q)=>{const X=B(O,Q,M,A);return new S.Vector2(null===X||void 0===X?void 0:X.uScale,null===X||void 0===X?void 0:X.vScale)},getTarget:g,set:(O,S,z,Q)=>{const X=B(S,Q,M,A);X.uScale=O.x,X.vScale=O.y},getPropertyName:[()=>"".concat(M).concat(A?"."+A:"",".uScale"),()=>"".concat(M).concat(A?"."+A:"",".vScale")]}}}const T={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:M=>{var A,O,z,Q;return new S.Vector2(null!==(A=null===(O=M._babylonCamera)||void 0===O?void 0:O.orthoLeft)&&void 0!==A?A:0,null!==(z=null===(Q=M._babylonCamera)||void 0===Q?void 0:Q.orthoRight)&&void 0!==z?z:0)},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.orthoLeft=M.x,A._babylonCamera.orthoRight=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:M=>{var A,O,z,Q;return new S.Vector2(null!==(A=null===(O=M._babylonCamera)||void 0===O?void 0:O.orthoBottom)&&void 0!==A?A:0,null!==(z=null===(Q=M._babylonCamera)||void 0===Q?void 0:Q.orthoTop)&&void 0!==z?z:0)},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.orthoBottom=M.x,A._babylonCamera.orthoTop=M.y)},getTarget:M=>M,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.maxZ},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.Tc},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.Tc=M)},getTarget:M=>M,getPropertyName:[()=>"Tc"]}},perspective:{aspectRatio:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.getEngine().getAspectRatio(M._babylonCamera)},getTarget:M=>M,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.fov},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.fov=M)},getTarget:M=>M,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.maxZ},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.maxZ=M)},getTarget:M=>M,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:M=>{var A;return null===(A=M._babylonCamera)||void 0===A?void 0:A.Tc},set:(M,A)=>{A._babylonCamera&&(A._babylonCamera.Tc=M)},getTarget:M=>M,getPropertyName:[()=>"Tc"]}}}},nodes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"GA",get:M=>{var A;return null===(A=M._babylonTransformNode)||void 0===A?void 0:A.position},set:(M,A)=>{var O;return null===(O=A._babylonTransformNode)||void 0===O?void 0:O.position.S(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:M=>{var A;return null===(A=M._babylonTransformNode)||void 0===A?void 0:A.rotationQuaternion},set:(M,A)=>{var O,S;return null===(O=A._babylonTransformNode)||void 0===O||null===(S=O.rotationQuaternion)||void 0===S?void 0:S.S(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"GA",get:M=>{var A;return null===(A=M._babylonTransformNode)||void 0===A?void 0:A.Ec},set:(M,A)=>{var O;return null===(O=A._babylonTransformNode)||void 0===O?void 0:O.Ec.S(M)},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"Ec"]},weights:{length:{type:"number",get:M=>M._numMorphTargets,getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(M,A)=>{var O,S;return void 0!==A?null===(O=M._primitiveBabylonMeshes)||void 0===O||null===(S=O[0].morphTargetManager)||void 0===S?void 0:S.getTarget(A).influence:void 0},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(M,A)=>[0],getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:M=>{var A,O,z;return S.Matrix.Compose(null===(A=M._babylonTransformNode)||void 0===A?void 0:A.Ec,null===(O=M._babylonTransformNode)||void 0===O?void 0:O.rotationQuaternion,null===(z=M._babylonTransformNode)||void 0===z?void 0:z.position)},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:M=>{var A,O,z,Q;const X=S.Matrix.Identity();let c=M.parent;for(;c&&c.parent;)c=c.parent;const j=(null===(A=M._babylonTransformNode)||void 0===A?void 0:A.position._isDirty)||(null===(O=M._babylonTransformNode)||void 0===O||null===(z=O.rotationQuaternion)||void 0===z?void 0:z._isDirty)||(null===(Q=M._babylonTransformNode)||void 0===Q?void 0:Q.Ec._isDirty);if(c){var B;const A=null===(B=c._babylonTransformNode)||void 0===B?void 0:B.Gc(!0).invert();var g,e;if(A)null===(g=M._babylonTransformNode)||void 0===g||null===(e=g.Gc(j))||void 0===e||e.multiplyToRef(A,X)}else M._babylonTransformNode&&X.S(M._babylonTransformNode.Gc(j));return X},getTarget:M=>M._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:M=>{var A,O;return null===(A=M._babylonTransformNode)||void 0===A||null===(O=A.getChildren((M=>M instanceof X.c),!0)[0])||void 0===O?void 0:O.Fc},getTarget:M=>{var A;return null===(A=M._babylonTransformNode)||void 0===A?void 0:A.getChildren((M=>M instanceof X.c),!0)[0]},set:(M,A)=>{if(A._babylonTransformNode){const O=A._babylonTransformNode.getChildren((M=>M instanceof X.c),!0)[0];O&&(O.Fc=M)}}},color:{type:"bA",get:M=>{var A,O;return null===(A=M._babylonTransformNode)||void 0===A||null===(O=A.getChildren((M=>M instanceof X.c),!0)[0])||void 0===O?void 0:O.Nc},getTarget:M=>{var A;return null===(A=M._babylonTransformNode)||void 0===A?void 0:A.getChildren((M=>M instanceof X.c),!0)[0]},set:(M,A)=>{if(A._babylonTransformNode){const O=A._babylonTransformNode.getChildren((M=>M instanceof X.c),!0)[0];O&&(O.Nc=M)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"bA",get:(M,A,O)=>g(M,A,O).emissiveColor,set:(M,A,O,S)=>g(A,O,S).emissiveColor.S(M),getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:e("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(M,A,O)=>{var S;return null===(S=B(M,O,"bumpTexture"))||void 0===S?void 0:S.level},set:(M,A,O,S)=>{const z=B(A,S,"bumpTexture");z&&(z.level=M)},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:e("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(M,A,O)=>g(M,A,O).ambientTextureStrength,set:(M,A,O,S)=>{const z=g(A,O,S);z&&(z.ambientTextureStrength=M)},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:e("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Cc",get:(M,A,O)=>{const S=g(M,A,O);return Q.Cc.FromColor3(S.albedoColor,S.alpha)},set:(M,A,O,S)=>{const z=g(A,O,S);z.albedoColor.set(M.r,M.g,M.b),z.alpha=M.a},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:e("albedoTexture")}},metallicFactor:{type:"number",get:(M,A,O)=>g(M,A,O).metallic,set:(M,A,O,S)=>{const z=g(A,O,S);z&&(z.metallic=M)},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(M,A,O)=>g(M,A,O).roughness,set:(M,A,O,S)=>{const z=g(A,O,S);z&&(z.roughness=M)},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:e("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(M,A,O)=>g(M,A,O).anisotropy.Fc,set:(M,A,O,S)=>{g(A,O,S).anisotropy.Fc=M},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(M,A,O)=>g(M,A,O).anisotropy.angle,set:(M,A,O,S)=>{g(A,O,S).anisotropy.angle=M},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:e("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(M,A,O)=>g(M,A,O).clearCoat.Fc,set:(M,A,O,S)=>{g(A,O,S).clearCoat.Fc=M},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(M,A,O)=>g(M,A,O).clearCoat.roughness,set:(M,A,O,S)=>{g(A,O,S).clearCoat.roughness=M},getTarget:(M,A,O)=>g(M,A,O),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:e("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(M,A,O)=>{var S;return null===(S=g(M,A,O).clearCoat.bumpTexture)||void 0===S?void 0:S.level},getTarget:g,set:(M,A,O,S)=>g(A,O,S).clearCoat.bumpTexture.level=M},extensions:{KHR_texture_transform:e("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:e("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(M,A,O)=>g(M,A,O).subSurface.dispersion,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.dispersion=M}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(M,A,O)=>g(M,A,O).emissiveIntensity,getTarget:g,set:(M,A,O,S)=>g(A,O,S).emissiveIntensity=M}},KHR_materials_ior:{ior:{type:"number",get:(M,A,O)=>g(M,A,O).indexOfRefraction,getTarget:g,set:(M,A,O,S)=>g(A,O,S).indexOfRefraction=M}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(M,A,O)=>g(M,A,O).iridescence.Fc,getTarget:g,set:(M,A,O,S)=>g(A,O,S).iridescence.Fc=M},iridescenceIor:{type:"number",get:(M,A,O)=>g(M,A,O).iridescence.indexOfRefraction,getTarget:g,set:(M,A,O,S)=>g(A,O,S).iridescence.indexOfRefraction=M},iridescenceTexture:{extensions:{KHR_texture_transform:e("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(M,A,O)=>g(M,A,O).iridescence.maximumThickness,getTarget:g,set:(M,A,O,S)=>g(A,O,S).iridescence.maximumThickness=M},iridescenceThicknessMinimum:{type:"number",get:(M,A,O)=>g(M,A,O).iridescence.minimumThickness,getTarget:g,set:(M,A,O,S)=>g(A,O,S).iridescence.minimumThickness=M},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:e("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"bA",get:(M,A,O)=>g(M,A,O).sheen.color,getTarget:g,set:(M,A,O,S)=>g(A,O,S).sheen.color.S(M)},sheenColorTexture:{extensions:{KHR_texture_transform:e("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(M,A,O)=>g(M,A,O).sheen.Fc,getTarget:g,set:(M,A,O,S)=>g(A,O,S).sheen.Fc=M},sheenRoughnessTexture:{extensions:{KHR_texture_transform:e("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(M,A,O)=>g(M,A,O).metallicF0Factor,getTarget:g,set:(M,A,O,S)=>g(A,O,S).metallicF0Factor=M,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"bA",get:(M,A,O)=>g(M,A,O).metallicReflectanceColor,getTarget:g,set:(M,A,O,S)=>g(A,O,S).metallicReflectanceColor.S(M),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:e("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:e("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(M,A,O)=>g(M,A,O).subSurface.refractionIntensity,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.refractionIntensity=M,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:e("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(M,A,O)=>g(M,A,O).subSurface.translucencyIntensity,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.translucencyIntensity=M},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:e("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"bA",get:(M,A,O)=>g(M,A,O).subSurface.translucencyColor,getTarget:g,set:(M,A,O,S)=>{var z;return M&&(null===(z=g(A,O,S).subSurface.translucencyColor)||void 0===z?void 0:z.S(M))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:e("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"bA",get:(M,A,O)=>g(M,A,O).subSurface.tintColor,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.tintColor.S(M)},attenuationDistance:{type:"number",get:(M,A,O)=>g(M,A,O).subSurface.tintColorAtDistance,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.tintColorAtDistance=M},thicknessFactor:{type:"number",get:(M,A,O)=>g(M,A,O).subSurface.maximumThickness,getTarget:g,set:(M,A,O,S)=>g(A,O,S).subSurface.maximumThickness=M},thicknessTexture:{extensions:{KHR_texture_transform:e("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,color:{type:"bA",get:M=>{var A;return null===(A=M._babylonLight)||void 0===A?void 0:A.Nc},set:(M,A)=>{var O;return null===(O=A._babylonLight)||void 0===O?void 0:O.Nc.S(M)},getTarget:M=>M._babylonLight,getPropertyName:[M=>"diffuse"]},Fc:{type:"number",get:M=>{var A;return null===(A=M._babylonLight)||void 0===A?void 0:A.Fc},set:(M,A)=>A._babylonLight?A._babylonLight.Fc=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"intensity"]},range:{type:"number",get:M=>{var A;return null===(A=M._babylonLight)||void 0===A?void 0:A.range},set:(M,A)=>A._babylonLight?A._babylonLight.range=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"range"]},spot:{innerConeAngle:{type:"number",get:M=>{var A;return null===(A=M._babylonLight)||void 0===A?void 0:A.innerAngle},set:(M,A)=>A._babylonLight?A._babylonLight.innerAngle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"innerConeAngle"]},outerConeAngle:{type:"number",get:M=>{var A;return null===(A=M._babylonLight)||void 0===A?void 0:A.angle},set:(M,A)=>A._babylonLight?A._babylonLight.angle=M:void 0,getTarget:M=>M._babylonLight,getPropertyName:[M=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonLight)),getPropertyName:[M=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonTexture)),getPropertyName:[M=>"length"]},__array__:{__target__:!0,Fc:{type:"number",get:M=>{var A;return null===(A=M._babylonTexture)||void 0===A?void 0:A.level},set:(M,A)=>{A._babylonTexture&&(A._babylonTexture.level=M)},getTarget:M=>M._babylonTexture},rotation:{type:"Quaternion",get:M=>{var A;return M._babylonTexture&&S.Quaternion.FromRotationMatrix(null===(A=M._babylonTexture)||void 0===A?void 0:A.getReflectionTextureMatrix())},set:(M,A)=>{var O;A._babylonTexture&&(null!==(O=A._babylonTexture.HM())&&void 0!==O&&O.useRightHandedSystem||(M=S.Quaternion.Inverse(M)),S.Matrix.FromQuaternionToRef(M,A._babylonTexture.getReflectionTextureMatrix()))},getTarget:M=>M._babylonTexture}}}}},animations:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>M._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:M=>M.length,getTarget:M=>M.map((M=>{var A;return null===(A=M.primitives[0]._instanceData)||void 0===A?void 0:A.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function J(M){return new j(M,T)}function K(M){const A=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let O=T;for(const S of A)S&&(O=O[S]);if(O&&O.type&&O.get)return O}function G(M,A){const O=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let S=T;for(const z of O)z&&(S=S[z]);S&&S.type&&S.get&&(S.interpolation=A)}function d(M,A){const O=M.split("/").map((M=>M.replace(/{}/g,"__array__")));let S=T;for(const z of O)if(z){if(!S[z]){if("?"===z){S.__ignoreObjectTree__=!0;continue}S[z]={},"__array__"===z&&(S[z].__target__=!0)}S=S[z]}Object.assign(S,A)}},14188:(M,A,O)=>{"use strict";O.r(A),O.d(A,{AnimationPropertyInfo:()=>B,TransformNodeAnimationPropertyInfo:()=>g,WeightAnimationPropertyInfo:()=>e,getQuaternion:()=>c,getVector3:()=>X,getWeights:()=>j});var S=O(13499),z=O(12970),Q=O(14180);function X(M,A,O,S){return z.GA.sA(A,O).scaleInPlace(S)}function c(M,A,O,S){return z.Quaternion.sA(A,O).scaleInPlace(S)}function j(M,A,O,S){const z=new Array(M._numMorphTargets);for(let Q=0;Q<z.length;Q++)z[Q]=A[O++]*S;return z}class B{constructor(M,A,O,S){this.type=M,this.name=A,this.getValue=O,this.getStride=S}_buildAnimation(M,A,O){const z=new S.b(M,this.name,A,this.type);return z.setKeys(O),z}}class g extends B{buildAnimations(M,A,O,S){const z=[];return z.push({babylonAnimatable:M._babylonTransformNode,babylonAnimation:this._buildAnimation(A,O,S)}),z}}class e extends B{buildAnimations(M,A,O,z){const Q=[];if(M._numMorphTargets)for(let X=0;X<M._numMorphTargets;X++){const c=new S.b("".concat(A,"_").concat(X),this.name,O,this.type);if(c.setKeys(z.map((M=>({frame:M.frame,inTangent:M.inTangent?M.inTangent[X]:void 0,value:M.value[X],outTangent:M.outTangent?M.outTangent[X]:void 0,interpolation:M.interpolation})))),M._primitiveBabylonMeshes)for(const A of M._primitiveBabylonMeshes)if(A.morphTargetManager){const M=A.morphTargetManager.getTarget(X),O=c.clone();M.animations.push(O),Q.push({babylonAnimatable:M,babylonAnimation:O})}}return Q}}(0,Q.l)("/nodes/{}/translation",[new g(S.b.ANIMATIONTYPE_VECTOR3,"position",X,(()=>3))]),(0,Q.l)("/nodes/{}/rotation",[new g(S.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",c,(()=>4))]),(0,Q.l)("/nodes/{}/scale",[new g(S.b.ANIMATIONTYPE_VECTOR3,"Ec",X,(()=>3))]),(0,Q.l)("/nodes/{}/weights",[new e(S.b.ANIMATIONTYPE_FLOAT,"influence",j,(M=>M._numMorphTargets))])},14154:(M,A,O)=>{"use strict";class S{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((M,A)=>{this._resolve=M,this._reject=A}))}}var z=O(12970),Q=O(13010),X=O(12768),c=O(13428),j=O(14157),B=O(14162),g=O(12776),e=O(13447),T=O(13499),J=O(13508),K=O(12811),G=O(12783),d=O(12786);class w{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(M){this._useTextureToStoreBoneMatrices=M,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(M){this._animationPropertiesOverride=M}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(M,A,O){this.name=M,this.id=A,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=z.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new g.c,this.bones=[],this._scene=O||K.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const S=this._scene.getEngine().getCaps();this._canUseTextureForBones=S.textureFloat&&S.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((M=>!M.getParent()))}getTransformMatrices(M){if(this.needInitialSkinMatrix){if(!M)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return M._bonesTransformMatrices||this.prepare(!0),M._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(M){return this.needInitialSkinMatrix&&M._transformMatrixTexture?M._transformMatrixTexture:this._transformMatrixTexture}HM(){return this._scene}toString(M){let A="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);if(A+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none"),M){A+=", Ranges: {";let M=!0;for(const O in this._ranges)M&&(A+=", ",M=!1),A+=O;A+="}"}return A}getBoneIndexByName(M){for(let A=0,O=this.bones.length;A<O;A++)if(this.bones[A].name===M)return A;return-1}createAnimationRange(M,A,O){if(!this._ranges[M]){this._ranges[M]=new J.b(M,A,O);for(let S=0,z=this.bones.length;S<z;S++)this.bones[S].animations[0]&&this.bones[S].animations[0].createRange(M,A,O)}}deleteAnimationRange(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let O=0,S=this.bones.length;O<S;O++)this.bones[O].animations[0]&&this.bones[O].animations[0].deleteRange(M,A);this._ranges[M]=null}getAnimationRange(M){return this._ranges[M]||null}getAnimationRanges(){const M=[];let A;for(A in this._ranges)M.push(this._ranges[A]);return M}copyAnimationRange(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[A]||!M.getAnimationRange(A))return!1;let S=!0;const z=this._getHighestAnimationFrame()+1,Q={},X=M.bones;let c,j;for(j=0,c=X.length;j<c;j++)Q[X[j].name]=X[j];this.bones.length!==X.length&&(G.c.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(X.length)),S=!1);const B=O&&this.dimensionsAtRest&&M.dimensionsAtRest?this.dimensionsAtRest.divide(M.dimensionsAtRest):null;for(j=0,c=this.bones.length;j<c;j++){const M=this.bones[j].name,X=Q[M];X?S=S&&this.bones[j].copyAnimationRange(X,A,z,O,B):(G.c.Warn("copyAnimationRange: not same rig, missing source bone "+M),S=!1)}const g=M.getAnimationRange(A);return g&&(this._ranges[A]=new J.b(A,g.from+z,g.to+z)),S}returnToRest(){for(const M of this.bones)-1!==M._index&&M.returnToRest()}_getHighestAnimationFrame(){let M=0;for(let A=0,O=this.bones.length;A<O;A++)if(this.bones[A].animations[0]){const O=this.bones[A].animations[0].getHighestFrame();M<O&&(M=O)}return M}beginAnimation(M,A,O,S){const z=this.getAnimationRange(M);return z?this._scene.beginAnimation(this,z.from,z.to,A,O,S):null}static MakeAnimationAdditive(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,O=arguments.length>2?arguments[2]:void 0;const S=M.getAnimationRange(O);if(!S)return null;const z=M._scene.getAllAnimatablesByTarget(M);let Q=null;for(let c=0;c<z.length;c++){const M=z[c];if(M.fromFrame===(null===S||void 0===S?void 0:S.from)&&M.toFrame===(null===S||void 0===S?void 0:S.to)){Q=M;break}}const X=M.getAnimatables();for(let c=0;c<X.length;c++){const M=X[c].animations;if(M)for(let S=0;S<M.length;S++)T.b.MakeAnimationAdditive(M[S],A,O)}return Q&&(Q.isAdditive=!0),M}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(M){this._meshesWithPoseMatrix.push(M)}_unregisterMeshWithPoseMatrix(M){const A=this._meshesWithPoseMatrix.indexOf(M);A>-1&&this._meshesWithPoseMatrix.splice(A,1)}_computeTransformMatrices(M,A){this.onBeforeComputeObservable.notifyObservers(this);for(let O=0;O<this.bones.length;O++){const S=this.bones[O];S._childUpdateId++;const z=S.getParent();if(z?S.getLocalMatrix().multiplyToRef(z.getFinalMatrix(),S.getFinalMatrix()):A?S.getLocalMatrix().multiplyToRef(A,S.getFinalMatrix()):S.getFinalMatrix().S(S.getLocalMatrix()),-1!==S._index){const A=null===S._index?O:S._index;S.getAbsoluteInverseBindMatrix().multiplyToArray(S.getFinalMatrix(),M,16*A)}}this._identity.copyToArray(M,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const M=this.HM().getRenderId();if(this._currentRenderId===M)return;this._currentRenderId=M}if(this._numBonesWithLinkedTransformNode>0)for(const M of this.bones)if(M._linkedTransformNode){const A=M._linkedTransformNode;M.position=A.position,A.rotationQuaternion?M.rotationQuaternion=A.rotationQuaternion:M.rotation=A.rotation,M.Ec=A.Ec}if(this.needInitialSkinMatrix)for(const M of this._meshesWithPoseMatrix){const A=M.getPoseMatrix();let O=this._isDirty;if(M._bonesTransformMatrices&&M._bonesTransformMatrices.length===16*(this.bones.length+1)||(M._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),O=!0),O){if(this._synchronizedWithMesh!==M){this._synchronizedWithMesh=M;for(const M of this.bones)if(!M.getParent()){M.getBindMatrix().multiplyToRef(A,z.TmpVectors.Matrix[1]),M._updateAbsoluteBindMatrices(z.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const A=4*(this.bones.length+1);M._transformMatrixTexture&&M._transformMatrixTexture.getSize().width===A||(M._transformMatrixTexture&&M._transformMatrixTexture.dispose(),M._transformMatrixTexture=e.d.CreateRGBATexture(M._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(M._bonesTransformMatrices,A),this.isUsingTextureForMatrices&&M._transformMatrixTexture&&M._transformMatrixTexture.update(M._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=e.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let M=0;M<this.bones.length;M++)this._animatables.push(this.bones[M])}return this._animatables}clone(M,A){const O=new w(M,A||M,this._scene);O.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let S=0;S<this.bones.length;S++){const M=this.bones[S];let A=null;const z=M.getParent();if(z){const M=this.bones.indexOf(z);A=O.bones[M]}const Q=new B.e(M.name,O,A,M.getBindMatrix().clone(),M.getRestMatrix().clone());Q._index=M._index,M._linkedTransformNode&&Q.linkTransformNode(M._linkedTransformNode),d.c.DeepCopy(M.animations,Q.animations)}if(this._ranges){O._ranges={};for(const M in this._ranges){const A=this._ranges[M];A&&(O._ranges[M]=A.clone())}}return this._isDirty=!0,O.prepare(!0),O}enableBlending(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const A of this.bones)for(const O of A.animations)O.enableBlending=!0,O.blendingSpeed=M}dispose(){if(this._meshesWithPoseMatrix.length=0,this.HM().stopAnimation(this),this.HM().removeSkeleton(this),this._parentContainer){const M=this._parentContainer.skeletons.indexOf(this);M>-1&&this._parentContainer.skeletons.splice(M,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const M={};M.name=this.name,M.id=this.id,this.dimensionsAtRest&&(M.dimensionsAtRest=this.dimensionsAtRest.gc()),M.bones=[],M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let O=0;O<this.bones.length;O++){var A;const S=this.bones[O],z=S.getParent(),Q={parentBoneIndex:z?this.bones.indexOf(z):-1,index:S.getIndex(),name:S.name,id:S.id,matrix:S.getBindMatrix().gc(),rest:S.getRestMatrix().gc(),linkedTransformNodeId:null===(A=S.getTransformNode())||void 0===A?void 0:A.id};M.bones.push(Q),S.length&&(Q.length=S.length),S.metadata&&(Q.metadata=S.metadata),S.animations&&S.animations.length>0&&(Q.animation=S.animations[0].serialize()),M.ranges=[];for(const A in this._ranges){const O=this._ranges[A];if(!O)continue;const S={};S.name=A,S.from=O.from,S.to=O.to,M.ranges.push(S)}}return M}static Parse(M,A){const O=new w(M.name,M.id,A);let S;for(M.dimensionsAtRest&&(O.dimensionsAtRest=z.GA.sA(M.dimensionsAtRest)),O.needInitialSkinMatrix=M.needInitialSkinMatrix,S=0;S<M.bones.length;S++){const A=M.bones[S],Q=M.bones[S].index;let X=null;A.parentBoneIndex>-1&&(X=O.bones[A.parentBoneIndex]);const c=A.rest?z.Matrix.sA(A.rest):null,j=new B.e(A.name,O,X,z.Matrix.sA(A.matrix),c,null,Q);void 0!==A.id&&null!==A.id&&(j.id=A.id),A.length&&(j.length=A.length),A.metadata&&(j.metadata=A.metadata),A.animation&&j.animations.push(T.b.Parse(A.animation)),void 0!==A.linkedTransformNodeId&&null!==A.linkedTransformNodeId&&(O._hasWaitingData=!0,j._waitingTransformNodeId=A.linkedTransformNodeId)}if(M.ranges)for(S=0;S<M.ranges.length;S++){const A=M.ranges[S];O.createAnimationRange(A.name,A.from,A.to)}return O}computeAbsoluteMatrices(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||M)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(M)}getPoseMatrix(){let M=null;return this._meshesWithPoseMatrix.length>0&&(M=this._meshesWithPoseMatrix[0].getPoseMatrix()),M}sortBones(){const M=[],A=new Array(this.bones.length);for(let O=0;O<this.bones.length;O++)this._sortBones(O,M,A);this.bones=M}_sortBones(M,A,O){if(O[M])return;O[M]=!0;const S=this.bones[M];if(!S)return;void 0===S._index&&(S._index=M);const z=S.getParent();z&&this._sortBones(this.bones.indexOf(z),A,O),A.push(S)}setCurrentPoseAsRest(){for(const M of this.bones)M.setCurrentPoseAsRest()}}var I=O(13286),b=O(13467),s=O(12949),Y=O(13385),E=O(13043),H=O(13432),C=O(13398),f=O(13422),D=O(13513),F=O(13075),N=O(14126);class y{set areUpdatesFrozen(M){M?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new F.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,M||(M=K.d.LastCreatedScene),this._scene=M,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const M=this._scene.getEngine().getCaps();this._canUseTextureForTargets=M.canUseGLVertexID&&M.textureFloat&&M.maxVertexTextureImageUnits>0&&M.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return y.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?y.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(M){this._numMaxInfluencers!==M&&(this._numMaxInfluencers=M,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(M){this._useTextureToStoreTargets!==M&&(this._useTextureToStoreTargets=M,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var M;return y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(M=this._scene)&&void 0!==M&&M.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(M){return this._activeTargets.data[M]}getTarget(M){return this._targets[M]}getTargetByName(M){for(const A of this._targets)if(A.name===M)return A;return null}addTarget(M){this._targets.push(M),this._targetInfluenceChangedObservers.push(M.onInfluenceChanged.add((M=>{this.areUpdatesFrozen&&M&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(M)}))),this._targetDataLayoutChangedObservers.push(M._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(M){const A=this._targets.indexOf(M);A>=0&&(this._targets.splice(A,1),M.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(A,1)[0]),M._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(A,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(M)}_bind(M){M.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),M.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),M.setTexture("morphTargets",this._targetStoreTexture),M.setInt("morphTargetCount",this.numInfluencers)}clone(){const M=new y(this._scene);for(const A of this._targets)M.addTarget(A.clone());return M.enablePositionMorphing=this.enablePositionMorphing,M.enableNormalMorphing=this.enableNormalMorphing,M.enableTangentMorphing=this.enableTangentMorphing,M.enableUVMorphing=this.enableUVMorphing,M.enableUV2Morphing=this.enableUV2Morphing,M.enableColorMorphing=this.enableColorMorphing,M}serialize(){const M={};M.id=this.uniqueId,M.targets=[];for(const A of this._targets)M.targets.push(A.serialize());return M}_syncActiveTargets(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const A=!!this._targetStoreTexture,O=this.isUsingTextureForTargets;(this._mustSynchronize||A!==O)&&(this._mustSynchronize=!1,this.synchronize());let S=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let z=-1;for(const Q of this._targets)if(z++,0!==Q.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(Q),this._morphTargetTextureIndices[S]=z,this._tempInfluences[S++]=Q.influence}this._morphTargetTextureIndices.length!==S&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,S)),this._influences&&this._influences.length===S||(this._influences=new Float32Array(S));for(let Q=0;Q<S;Q++)this._influences[Q]=this._tempInfluences[Q];if(M&&this._scene)for(const Q of this._scene.meshes)Q.morphTargetManager===this&&(O?Q._markSubMeshesAsAttributesDirty():Q._syncGeometryWithMorphTargetManager())}synchronize(){var M;if(!this._scene||this.areUpdatesFrozen)return;const A=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(M=this._targetStoreTexture)||void 0===M||M.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>A.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const O of this._targets){this._supportsPositions=this._supportsPositions&&O.hasPositions,this._supportsNormals=this._supportsNormals&&O.hasNormals,this._supportsTangents=this._supportsTangents&&O.hasTangents,this._supportsUVs=this._supportsUVs&&O.hasUVs,this._supportsUV2s=this._supportsUV2s&&O.hasUV2s,this._supportsColors=this._supportsColors&&O.hasColors;const M=O.vertexCount;if(0===this._vertexCount)this._vertexCount=M;else if(this._vertexCount!==M)return void G.c.Error("Incompatible target. Targets must all have the same vertices count. Current vertex count: ".concat(this._vertexCount,', vertex count for target "').concat(O.name,'": ').concat(M))}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const M=A.getCaps().maxTextureSize;this._textureWidth>M&&(this._textureHeight=Math.ceil(this._textureWidth/M),this._textureWidth=M);const O=this._targets.length,S=new Float32Array(O*this._textureWidth*this._textureHeight*4);let z=0;for(let A=0;A<O;A++){const M=this._targets[A],O=M.getPositions(),Q=M.getNormals(),X=M.getUVs(),c=M.getTangents(),j=M.getUV2s(),B=M.getColors();z=A*this._textureWidth*this._textureHeight*4;for(let A=0;A<this._vertexCount;A++)this._supportsPositions&&O&&(S[z]=O[3*A],S[z+1]=O[3*A+1],S[z+2]=O[3*A+2],z+=4),this._supportsNormals&&Q&&(S[z]=Q[3*A],S[z+1]=Q[3*A+1],S[z+2]=Q[3*A+2],z+=4),this._supportsUVs&&X&&(S[z]=X[2*A],S[z+1]=X[2*A+1],z+=4),this._supportsTangents&&c&&(S[z]=c[3*A],S[z+1]=c[3*A+1],S[z+2]=c[3*A+2],z+=4),this._supportsUV2s&&j&&(S[z]=j[2*A],S[z+1]=j[2*A+1],z+=4),this._supportsColors&&B&&(S[z]=B[4*A],S[z+1]=B[4*A+1],S[z+2]=B[4*A+2],S[z+3]=B[4*A+3],z+=4)}this._targetStoreTexture=N.b.CreateRGBATexture(S,this._textureWidth,this._textureHeight,O,this._scene,!1,!1,1,1),this._targetStoreTexture.name="Morph texture_".concat(this.uniqueId)}for(const O of this._scene.meshes)O.morphTargetManager===this&&O._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const M=this._parentContainer.morphTargetManagers.indexOf(this);M>-1&&this._parentContainer.morphTargetManagers.splice(M,1),this._parentContainer=null}for(const M of this._targets)this._scene.stopAnimation(M)}}static Parse(M,A){const O=new y(A);for(const S of M.targets)O.addTarget(D.c.Parse(S,A));return O}}y.EnableTextureStorage=!0,y.MaxActiveMorphTargetsInVertexAttributeMode=8,y.ConstantTargetCountForTextureMode=0;var h=O(14166),u=O(12813),i=O(13301);const U=new Map,L=U;function t(M,A,O){x(M)&&G.c.Warn("Extension with the name '".concat(M,"' already exists")),U.set(M,{isGLTFExtension:A,factory:O})}function x(M){return U.delete(M)}var o=O(14180),p=O(13563),v=O(13059);class q{static Get(M,A,O){if(!A||void 0==O||!A[O])throw new Error("".concat(M,": Failed to find index (").concat(O,")"));return A[O]}static TryGet(M,A){return M&&void 0!=A&&M[A]?M[A]:null}static Assign(M){if(M)for(let A=0;A<M.length;A++)M[A].index=A}}function r(M){if(M.min&&M.max){const A=M.min,O=M.max,S=z.TmpVectors.GA[0].Yc(A[0],A[1],A[2]),Q=z.TmpVectors.GA[1].Yc(O[0],O[1],O[2]);if(M.normalized&&5126!==M.componentType){let A=1;switch(M.componentType){case 5120:A=127;break;case 5121:A=255;break;case 5122:A=32767;break;case 5123:A=65535}const O=1/A;S.scaleInPlace(O),Q.scaleInPlace(O)}return new i.b(S,Q)}return null}class n{static RegisterExtension(M,A){t(M,!1,A)}static UnregisterExtension(M){return x(M)}get Xc(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(M){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=M}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((M=>M.dispose&&M.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(M,A,O,S,z,Q){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=A,this._assetContainer=O,this._loadData(S);let Q=null;if(M){const A={};if(this._gltf.nodes)for(const M of this._gltf.nodes)M.name&&(A[M.name]=M.index);Q=(M instanceof Array?M:[M]).map((M=>{const O=A[M];if(void 0===O)throw new Error("Failed to find node '".concat(M,"'"));return O}))}return await this._loadAsync(z,X,Q,(()=>({meshes:this._getMeshes(),TJ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=M,this._loadData(A),await this._loadAsync(O,z,null,(()=>{}))}async _loadAsync(M,A,O,S){return await Promise.resolve().then((async()=>{this._rootUrl=M,this._uniqueRootUrl=!M.startsWith("file:")&&A?M:"".concat(M).concat(Date.now(),"/"),this._fileName=A,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const z="".concat(h.l[h.l.LOADING]," => ").concat(h.l[h.l.READY]),Q="".concat(h.l[h.l.LOADING]," => ").concat(h.l[h.l.COMPLETE]);this._parent._startPerformanceCounter(z),this._parent._startPerformanceCounter(Q),this._parent._setState(h.l.LOADING),this._extensionsOnLoading();const c=new Array;if(!this.parent.loadOnlyMaterials)if(O)c.push(this.loadSceneAsync("/nodes",{nodes:O,index:-1}));else if(void 0!=this._gltf.wA||this._gltf.scenes&&this._gltf.scenes[0]){const M=q.Get("/scene",this._gltf.scenes,this._gltf.wA||0);c.push(this.loadSceneAsync("/scenes/".concat(M.index),M))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let M=0;M<this._gltf.materials.length;++M){const A=this._gltf.materials[M],O="/materials/"+M,S=I.b.TriangleFillMode;c.push(this._loadMaterialAsync(O,A,null,S,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&c.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&c.push(this._compileShadowGeneratorsAsync());const j=Promise.all(c).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.yj(!0);for(const M of this._babylonScene.materials){const A=M;void 0!==A.maxSimultaneousLights&&(A.maxSimultaneousLights=Math.max(A.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(h.l.READY),this._skipStartAnimationStep||this._startAnimations(),S()}));return await j.then((M=>(this._parent._endPerformanceCounter(z),X.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Q),this._parent._setState(h.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(M=>{this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()}))})),M)))})).catch((M=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(M),this._parent.onErrorObservable.clear(),this.dispose()),M}))}_loadData(M){if(this._gltf=M.json,this._setupData(),M.bin){const A=this._gltf.buffers;if(A&&A[0]&&!A[0].uri){const O=A[0];(O.byteLength<M.bin.byteLength-3||O.byteLength>M.bin.byteLength)&&G.c.Warn("Binary buffer length (".concat(O.byteLength,") from JSON does not match chunk length (").concat(M.bin.byteLength,")")),this._bin=M.bin}else G.c.Warn("Unexpected BIN chunk")}}_setupData(){if(q.Assign(this._gltf.accessors),q.Assign(this._gltf.animations),q.Assign(this._gltf.buffers),q.Assign(this._gltf.bufferViews),q.Assign(this._gltf.cameras),q.Assign(this._gltf.images),q.Assign(this._gltf.materials),q.Assign(this._gltf.meshes),q.Assign(this._gltf.nodes),q.Assign(this._gltf.samplers),q.Assign(this._gltf.scenes),q.Assign(this._gltf.skins),q.Assign(this._gltf.textures),this._gltf.nodes){const M={};for(const O of this._gltf.nodes)if(O.children)for(const A of O.children)M[A]=O.index;const A=this._createRootNode();for(const O of this._gltf.nodes){const S=M[O.index];O.parent=void 0===S?A:this._gltf.nodes[S]}}}async _loadExtensionsAsync(){const M=[];if(L.forEach(((A,O)=>{var S;!1===(null===(S=this.parent.extensionOptions[O])||void 0===S?void 0:S.enabled)?A.isGLTFExtension&&this.isExtensionUsed(O)&&G.c.Warn("Extension ".concat(O," is used but has been explicitly disabled.")):A.isGLTFExtension&&!this.isExtensionUsed(O)||M.push((async()=>{const M=await A.factory(this);return M.name!==O&&G.c.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(M.name," !== ").concat(O)),this._parent.onExtensionLoadedObservable.notifyObservers(M),M})())})),this._extensions.push(...await Promise.all(M)),this._extensions.sort(((M,A)=>(M.order||Number.MAX_VALUE)-(A.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const O of this._gltf.extensionsRequired){if(!this._extensions.some((M=>M.name===O&&M.enabled))){var A;if(!1===(null===(A=this.parent.extensionOptions[O])||void 0===A?void 0:A.enabled))throw new Error("Required extension ".concat(O," is disabled"));throw new Error("Required extension ".concat(O," is not available"))}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new f.d("__root__",this._babylonScene);this._rootBabylonMesh=M,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.yj(!1);const A={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case h.j.AUTO:this._babylonScene.useRightHandedSystem||(A.rotation=[0,1,0,0],A.scale=[1,1,-1],n._LoadTransform(A,this._rootBabylonMesh));break;case h.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(M),A}loadSceneAsync(M,A){const O=this._extensionsLoadSceneAsync(M,A);if(O)return O;const S=new Array;if(this.logOpen("".concat(M," ").concat(A.name||"")),A.nodes)for(const z of A.nodes){const A=q.Get("".concat(M,"/nodes/").concat(z),this._gltf.nodes,z);S.push(this.loadNodeAsync("/nodes/".concat(A.index),A,(M=>{M.parent=this._rootBabylonMesh})))}for(const z of this._postSceneLoadActions)z();return S.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(S).then((()=>{}))}_forEachPrimitive(M,A){if(M._primitiveBabylonMeshes)for(const O of M._primitiveBabylonMeshes)A(O)}_getGeometries(){const M=[],A=this._gltf.nodes;if(A)for(const O of A)this._forEachPrimitive(O,(A=>{const O=A.wc;O&&-1===M.indexOf(O)&&M.push(O)}));return M}_getMeshes(){const M=[];this._rootBabylonMesh instanceof C.d&&M.push(this._rootBabylonMesh);const A=this._gltf.nodes;if(A)for(const O of A)this._forEachPrimitive(O,(A=>{M.push(A)}));return M}_getTransformNodes(){const M=[],A=this._gltf.nodes;if(A)for(const O of A)O._babylonTransformNode&&"iT"===O._babylonTransformNode.getClassName()&&M.push(O._babylonTransformNode),O._babylonTransformNodeForSkin&&M.push(O._babylonTransformNodeForSkin);return M}_getSkeletons(){const M=[],A=this._gltf.skins;if(A)for(const O of A)O._data&&M.push(O._data.babylonSkeleton);return M}_getAnimationGroups(){const M=[],A=this._gltf.animations;if(A)for(const O of A)O._babylonAnimationGroup&&M.push(O._babylonAnimationGroup);return M}_startAnimations(){switch(this._parent.animationStartMode){case h.f.NONE:break;case h.f.FIRST:{const M=this._getAnimationGroups();0!==M.length&&M[0].start(!0);break}case h.f.ALL:{const M=this._getAnimationGroups();for(const A of M)A.start(!0);break}default:return void G.c.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}}loadNodeAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadNodeAsync(M,A,O);if(S)return S;if(A._babylonTransformNode)throw new Error("".concat(M,": Invalid recursive node hierarchy"));const z=new Array;this.logOpen("".concat(M," ").concat(A.name||""));const Q=S=>{if(n.AddPointerMetadata(S,M),n._LoadTransform(A,S),void 0!=A.camera){const O=q.Get("".concat(M,"/camera"),this._gltf.cameras,A.camera);z.push(this.loadCameraAsync("/cameras/".concat(O.index),O,(M=>{M.parent=S,this._babylonScene.useRightHandedSystem||(S.Ec.x=-1)})))}if(A.children)for(const O of A.children){const A=q.Get("".concat(M,"/children/").concat(O),this._gltf.nodes,O);z.push(this.loadNodeAsync("/nodes/".concat(A.index),A,(M=>{M.parent=S})))}O(S)},X=void 0!=A.mesh,c=this._parent.loadSkins&&void 0!=A.skin;if(!X||c){const M=A.name||"node".concat(A.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new Y.e(M,this._babylonScene);O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==A.mesh?A._babylonTransformNode=O:A._babylonTransformNodeForSkin=O,Q(O)}if(X)if(c){const O=q.Get("".concat(M,"/mesh"),this._gltf.meshes,A.mesh);z.push(this._loadMeshAsync("/meshes/".concat(O.index),A,O,(O=>{const S=A._babylonTransformNodeForSkin;O.metadata=(0,p.d)(S.metadata,O.metadata||{});const Q=q.Get("".concat(M,"/skin"),this._gltf.skins,A.skin);z.push(this._loadSkinAsync("/skins/".concat(Q.index),A,Q,(M=>{this._forEachPrimitive(A,(A=>{A.skeleton=M})),this._postSceneLoadActions.push((()=>{if(void 0!=Q.skeleton){const M=q.Get("/skins/".concat(Q.index,"/skeleton"),this._gltf.nodes,Q.skeleton).parent;A.index===M.index?O.parent=S.parent:O.parent=M._babylonTransformNode}else O.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:S,skinnedNode:O})}))})))})))}else{const O=q.Get("".concat(M,"/mesh"),this._gltf.meshes,A.mesh);z.push(this._loadMeshAsync("/meshes/".concat(O.index),A,O,Q))}return this.logClose(),Promise.all(z).then((()=>(this._forEachPrimitive(A,(M=>{const A=M;!A.isAnInstance&&A.wc&&A.wc.useBoundingInfoFromGeometry?M.iM():M.refreshBoundingInfo(!0,!0)})),A._babylonTransformNode)))}_loadMeshAsync(M,A,O,S){const z=O.primitives;if(!z||!z.length)throw new Error("".concat(M,": Primitives are missing"));void 0==z[0].index&&q.Assign(z);const Q=new Array;this.logOpen("".concat(M," ").concat(O.name||""));const X=A.name||"node".concat(A.index);if(1===z.length){const S=O.primitives[0];Q.push(this._loadMeshPrimitiveAsync("".concat(M,"/primitives/").concat(S.index),X,A,O,S,(M=>{A._babylonTransformNode=M,A._primitiveBabylonMeshes=[M]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,A._babylonTransformNode=new Y.e(X,this._babylonScene),A._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._primitiveBabylonMeshes=[];for(const S of z)Q.push(this._loadMeshPrimitiveAsync("".concat(M,"/primitives/").concat(S.index),"".concat(X,"_primitive").concat(S.index),A,O,S,(M=>{M.parent=A._babylonTransformNode,A._primitiveBabylonMeshes.push(M)})))}return S(A._babylonTransformNode),this.logClose(),Promise.all(Q).then((()=>A._babylonTransformNode))}_loadMeshPrimitiveAsync(M,A,O,S,z,Q){const X=this._extensionsLoadMeshPrimitiveAsync(M,A,O,S,z,Q);if(X)return X;this.logOpen("".concat(M));const c=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==O.skin&&!S.primitives[0].targets;let j,B;if(c&&z._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,j=z._instanceData.babylonSourceMesh.createInstance(A),j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B=z._instanceData.promise;else{const Q=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new f.d(A,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.sideOrientation=this._babylonScene.useRightHandedSystem?I.b.CounterClockWiseSideOrientation:I.b.ClockWiseSideOrientation,this._createMorphTargets(M,O,S,z,X),Q.push(this._loadVertexDataAsync(M,z,X).then((async A=>await this._loadMorphTargetsAsync(M,z,X,A).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,A.hM(X),A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const g=n._GetDrawMode(M,z.mode);if(void 0==z.material){let M=this._defaultBabylonMaterialData[g];M||(M=this._createDefaultMaterial("__GLTFLoader._default",g),this._parent.onMaterialLoadedObservable.notifyObservers(M),this._defaultBabylonMaterialData[g]=M),X.material=M}else if(!this.parent.skipMaterials){const A=q.Get("".concat(M,"/material"),this._gltf.materials,z.material);Q.push(this._loadMaterialAsync("/materials/".concat(A.index),A,X,g,(M=>{X.material=M})))}B=Promise.all(Q),c&&(z._instanceData={babylonSourceMesh:X,promise:B}),j=X}return n.AddPointerMetadata(j,M),this._parent.onMeshLoadedObservable.notifyObservers(j),Q(j),this.logClose(),B.then((()=>j))}_loadVertexDataAsync(M,A,O){const S=this._extensionsLoadVertexDataAsync(M,A,O);if(S)return S;const z=A.attributes;if(!z)throw new Error("".concat(M,": Attributes are missing"));const Q=new Array,X=new H.d(O.name,this._babylonScene);if(void 0==A.indices)O.isUnIndexed=!0;else{const O=q.Get("".concat(M,"/indices"),this._gltf.accessors,A.indices);Q.push(this._loadIndicesAccessorAsync("/accessors/".concat(O.index),O).then((M=>{X.setIndices(M)})))}const c=(A,S,c)=>{if(void 0==z[A])return;O._delayInfo=O._delayInfo||[],-1===O._delayInfo.indexOf(S)&&O._delayInfo.push(S);const j=q.Get("".concat(M,"/attributes/").concat(A),this._gltf.accessors,z[A]);Q.push(this._loadVertexAccessorAsync("/accessors/".concat(j.index),j,S).then((M=>{if(M.getKind()===E.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!O.skeleton){const M=r(j);M&&(X._boundingInfo=M,X.useBoundingInfoFromGeometry=!0)}X.setVerticesBuffer(M,j.count)}))),S==E.c.MatricesIndicesExtraKind&&(O.numBoneInfluencers=8),c&&c(j)};return c("POSITION",E.c.PositionKind),c("NORMAL",E.c.NormalKind),c("TANGENT",E.c.TangentKind),c("TEXCOORD_0",E.c.UVKind),c("TEXCOORD_1",E.c.UV2Kind),c("TEXCOORD_2",E.c.UV3Kind),c("TEXCOORD_3",E.c.UV4Kind),c("TEXCOORD_4",E.c.UV5Kind),c("TEXCOORD_5",E.c.UV6Kind),c("JOINTS_0",E.c.MatricesIndicesKind),c("WEIGHTS_0",E.c.MatricesWeightsKind),c("JOINTS_1",E.c.MatricesIndicesExtraKind),c("WEIGHTS_1",E.c.MatricesWeightsExtraKind),c("COLOR_0",E.c.ColorKind,(M=>{"VEC4"===M.type&&(O.hasVertexAlpha=!0)})),Promise.all(Q).then((()=>X))}_createMorphTargets(M,A,O,S,z){if(!S.targets||!this._parent.loadMorphTargets)return;if(void 0==A._numMorphTargets)A._numMorphTargets=S.targets.length;else if(S.targets.length!==A._numMorphTargets)throw new Error("".concat(M,": Primitives do not have the same number of targets"));const Q=O.extras?O.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,z.morphTargetManager=new y(this._babylonScene),z.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.morphTargetManager.areUpdatesFrozen=!0;for(let X=0;X<S.targets.length;X++){const M=A.weights?A.weights[X]:O.weights?O.weights[X]:0,S=Q?Q[X]:"morphTarget".concat(X);z.morphTargetManager.addTarget(new D.c(S,M,z.HM()))}}_loadMorphTargetsAsync(M,A,O,S){if(!A.targets||!this._parent.loadMorphTargets)return Promise.resolve();const z=new Array,Q=O.morphTargetManager;for(let X=0;X<Q.numTargets;X++){const O=Q.getTarget(X);z.push(this._loadMorphTargetVertexDataAsync("".concat(M,"/targets/").concat(X),S,A.targets[X],O))}return Promise.all(z).then((()=>{Q.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(M,A,O,S){const z=new Array,Q=(S,Q,X)=>{if(void 0==O[S])return;const c=A.getVertexBuffer(Q);if(!c)return;const j=q.Get("".concat(M,"/").concat(S),this._gltf.accessors,O[S]);z.push(this._loadFloatAccessorAsync("/accessors/".concat(j.index),j).then((M=>{X(c,M)})))};return Q("POSITION",E.c.PositionKind,((M,A)=>{const O=new Float32Array(A.length);M.forEach(A.length,((M,S)=>{O[S]=A[S]+M})),S.setPositions(O)})),Q("NORMAL",E.c.NormalKind,((M,A)=>{const O=new Float32Array(A.length);M.forEach(O.length,((M,S)=>{O[S]=A[S]+M})),S.setNormals(O)})),Q("TANGENT",E.c.TangentKind,((M,A)=>{const O=new Float32Array(A.length/3*4);let z=0;M.forEach(A.length/3*4,((M,S)=>{(S+1)%4!==0&&(O[z]=A[z]+M,z++)})),S.setTangents(O)})),Q("TEXCOORD_0",E.c.UVKind,((M,A)=>{const O=new Float32Array(A.length);M.forEach(A.length,((M,S)=>{O[S]=A[S]+M})),S.setUVs(O)})),Q("TEXCOORD_1",E.c.UV2Kind,((M,A)=>{const O=new Float32Array(A.length);M.forEach(A.length,((M,S)=>{O[S]=A[S]+M})),S.setUV2s(O)})),Q("COLOR_0",E.c.ColorKind,((A,O)=>{let z=null;const Q=A.getSize();if(3===Q){z=new Float32Array(O.length/3*4),A.forEach(O.length,((M,A)=>{const S=Math.floor(A/3),Q=A%3;z[4*S+Q]=O[3*S+Q]+M}));for(let M=0;M<O.length/3;++M)z[4*M+3]=1}else{if(4!==Q)throw new Error("".concat(M,": Invalid number of components (").concat(Q,") for COLOR_0 attribute"));z=new Float32Array(O.length),A.forEach(O.length,((M,A)=>{z[A]=O[A]+M}))}S.setColors(z)})),await Promise.all(z).then((()=>{}))}static _LoadTransform(M,A){if(void 0!=M.skin)return;let O=z.GA.Zero(),S=z.Quaternion.Identity(),Q=z.GA.One();if(M.matrix){z.Matrix.sA(M.matrix).decompose(Q,S,O)}else M.translation&&(O=z.GA.sA(M.translation)),M.rotation&&(S=z.Quaternion.sA(M.rotation)),M.scale&&(Q=z.GA.sA(M.scale));A.position=O,A.rotationQuaternion=S,A.Ec=Q}_loadSkinAsync(M,A,O,S){if(!this._parent.loadSkins)return Promise.resolve();const z=this._extensionsLoadSkinAsync(M,A,O);if(z)return z;if(O._data)return S(O._data.babylonSkeleton),O._data.promise;const Q="skeleton".concat(O.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new w(O.name||Q,Q,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(M,O,X);const c=this._loadSkinInverseBindMatricesDataAsync(M,O).then((M=>{this._updateBoneMatrices(X,M)}));return O._data={babylonSkeleton:X,promise:c},S(X),c}_loadBones(M,A,O){if(void 0==A.skeleton||this._parent.alwaysComputeSkeletonRootNode){const O=this._findSkeletonRootNode("".concat(M,"/joints"),A.joints);if(O)if(void 0===A.skeleton)A.skeleton=O.index;else{const S=(M,A)=>{for(;A.parent;A=A.parent)if(A.parent===M)return!0;return!1},z=q.Get("".concat(M,"/skeleton"),this._gltf.nodes,A.skeleton);z===O||S(z,O)||(G.c.Warn("".concat(M,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),A.skeleton=O.index)}else G.c.Warn("".concat(M,": Failed to find common root"))}const S={};for(const z of A.joints){const Q=q.Get("".concat(M,"/joints/").concat(z),this._gltf.nodes,z);this._loadBone(Q,A,O,S)}}_findSkeletonRootNode(M,A){if(0===A.length)return null;const O={};for(const z of A){const A=[];let S=q.Get("".concat(M,"/").concat(z),this._gltf.nodes,z);for(;-1!==S.index;)A.unshift(S),S=S.parent;O[z]=A}let S=null;for(let z=0;;++z){let M=O[A[0]];if(z>=M.length)return S;const Q=M[z];for(let X=1;X<A.length;++X)if(M=O[A[X]],z>=M.length||Q!==M[z])return S;S=Q}}_loadBone(M,A,O,S){M._isJoint=!0;let z=S[M.index];if(z)return z;let Q=null;M.index!==A.skeleton&&(M.parent&&-1!==M.parent.index?Q=this._loadBone(M.parent,A,O,S):void 0!==A.skeleton&&G.c.Warn("/skins/".concat(A.index,"/skeleton: Skeleton node is not a common root")));const X=A.joints.indexOf(M.index);return z=new B.e(M.name||"joint".concat(M.index),O,Q,this._getNodeMatrix(M),null,null,X),S[M.index]=z,this._postSceneLoadActions.push((()=>{z.linkTransformNode(M._babylonTransformNode)})),z}_loadSkinInverseBindMatricesDataAsync(M,A){if(void 0==A.inverseBindMatrices)return Promise.resolve(null);const O=q.Get("".concat(M,"/inverseBindMatrices"),this._gltf.accessors,A.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(O.index),O)}_updateBoneMatrices(M,A){for(const O of M.bones){const M=z.Matrix.Identity(),S=O._index;A&&-1!==S&&(z.Matrix.FromArrayToRef(A,16*S,M),M.invertToRef(M));const Q=O.getParent();Q&&M.multiplyToRef(Q.getAbsoluteInverseBindMatrix(),M),O.Kc(M,!1,!1),O._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(M){return M.matrix?z.Matrix.sA(M.matrix):z.Matrix.Compose(M.scale?z.GA.sA(M.scale):z.GA.One(),M.rotation?z.Quaternion.sA(M.rotation):z.Quaternion.Identity(),M.translation?z.GA.sA(M.translation):z.GA.Zero())}loadCameraAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadCameraAsync(M,A,O);if(S)return S;const Q=new Array;this.logOpen("".concat(M," ").concat(A.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new j.e(A.name||"camera".concat(A.index),z.GA.Zero(),this._babylonScene,!1);switch(X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonCamera=X,X.setTarget(new z.GA(0,0,-1)),A.type){case"perspective":{const O=A.perspective;if(!O)throw new Error("".concat(M,": Camera perspective properties are missing"));X.fov=O.yfov,X.Tc=O.znear,X.maxZ=O.zfar||0;break}case"orthographic":if(!A.orthographic)throw new Error("".concat(M,": Camera orthographic properties are missing"));X.mode=c.c.ORTHOGRAPHIC_CAMERA,X.orthoLeft=-A.orthographic.xmag,X.orthoRight=A.orthographic.xmag,X.orthoBottom=-A.orthographic.ymag,X.orthoTop=A.orthographic.ymag,X.Tc=A.orthographic.znear,X.maxZ=A.orthographic.zfar;break;default:throw new Error("".concat(M,": Invalid camera type (").concat(A.type,")"))}return n.AddPointerMetadata(X,M),this._parent.onCameraLoadedObservable.notifyObservers(X),O(X),this.logClose(),Promise.all(Q).then((()=>X))}_loadAnimationsAsync(){const M=this._gltf.animations;if(!M)return Promise.resolve();const A=new Array;for(let O=0;O<M.length;O++){const S=M[O];A.push(this.loadAnimationAsync("/animations/".concat(S.index),S).then((M=>{0===M.targetedAnimations.length&&M.dispose()})))}return Promise.all(A).then((()=>{}))}loadAnimationAsync(M,A){const S=this._extensionsLoadAnimationAsync(M,A);return S||O.e(78).then(O.bind(O,15778)).then((O=>{let{AnimationGroup:S}=O;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new S(A.name||"animation".concat(A.index),this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A._babylonAnimationGroup=z;const Q=new Array;q.Assign(A.channels),q.Assign(A.samplers);for(const X of A.channels)Q.push(this._loadAnimationChannelAsync("".concat(M,"/channels/").concat(X.index),M,A,X,((M,A)=>{M.animations=M.animations||[],M.animations.push(A),z.addTargetedAnimation(A,M)})));return Promise.all(Q).then((()=>(z.normalize(0),z)))}))}async _loadAnimationChannelAsync(M,A,S,z,Q){const X=this._extensionsLoadAnimationChannelAsync(M,A,S,z,Q);if(X)return await X;if(void 0==z.target.node)return await Promise.resolve();const c=q.Get("".concat(M,"/target/node"),this._gltf.nodes,z.target.node),j=z.target.path,B="weights"===j;if(B&&!c._numMorphTargets||!B&&!c._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!B&&!c._isJoint)return await Promise.resolve();let g;switch(await Promise.resolve().then(O.bind(O,14188)),j){case"translation":var e;g=null===(e=(0,o.e)("/nodes/{}/translation"))||void 0===e?void 0:e.interpolation;break;case"rotation":var T;g=null===(T=(0,o.e)("/nodes/{}/rotation"))||void 0===T?void 0:T.interpolation;break;case"scale":var J;g=null===(J=(0,o.e)("/nodes/{}/scale"))||void 0===J?void 0:J.interpolation;break;case"weights":var K;g=null===(K=(0,o.e)("/nodes/{}/weights"))||void 0===K?void 0:K.interpolation;break;default:throw new Error("".concat(M,"/target/path: Invalid value (").concat(z.target.path,")"))}if(!g)throw new Error("".concat(M,"/target/path: Could not find interpolation properties for target path (").concat(z.target.path,")"));const G={object:c,info:g};return await this._loadAnimationChannelFromTargetInfoAsync(M,A,S,z,G,Q)}_loadAnimationChannelFromTargetInfoAsync(M,A,O,S,z,Q){const X=this.parent.targetFps,c=1/X,j=q.Get("".concat(M,"/sampler"),O.samplers,S.sampler);return this._loadAnimationSamplerAsync("".concat(A,"/samplers/").concat(S.sampler),j).then((M=>{let A=0;const j=z.object,B=z.info;for(const z of B){const B=z.getStride(j),g=M.input,e=M.output,T=new Array(g.length);let J=0;switch(M.interpolation){case"STEP":for(let M=0;M<g.length;M++){const A=z.getValue(j,e,J,1);J+=B,T[M]={frame:g[M]*X,value:A,interpolation:1}}break;case"CUBICSPLINE":for(let M=0;M<g.length;M++){const A=z.getValue(j,e,J,c);J+=B;const O=z.getValue(j,e,J,1);J+=B;const S=z.getValue(j,e,J,c);J+=B,T[M]={frame:g[M]*X,inTangent:A,value:O,outTangent:S}}break;case"LINEAR":for(let M=0;M<g.length;M++){const A=z.getValue(j,e,J,1);J+=B,T[M]={frame:g[M]*X,value:A}}}if(J>0){const M="".concat(O.name||"animation".concat(O.index),"_channel").concat(S.index,"_").concat(A),c=z.buildAnimations(j,M,X,T);for(const O of c)A++,Q(O.babylonAnimatable,O.babylonAnimation)}}}))}_loadAnimationSamplerAsync(M,A){if(A._data)return A._data;const O=A.interpolation||"LINEAR";switch(O){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(M,"/interpolation: Invalid value (").concat(A.interpolation,")"))}const S=q.Get("".concat(M,"/input"),this._gltf.accessors,A.input),z=q.Get("".concat(M,"/output"),this._gltf.accessors,A.output);return A._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(S.index),S),this._loadFloatAccessorAsync("/accessors/".concat(z.index),z)]).then((M=>{let[A,S]=M;return{input:A,interpolation:O,output:S}})),A._data}loadBufferAsync(M,A,O,S){const z=this._extensionsLoadBufferAsync(M,A,O,S);if(z)return z;if(!A._data)if(A.uri)A._data=this.loadUriAsync("".concat(M,"/uri"),A,A.uri);else{if(!this._bin)throw new Error("".concat(M,": Uri is missing or the binary glTF is missing its binary chunk"));A._data=this._bin.readAsync(0,A.byteLength)}return A._data.then((A=>{try{return new Uint8Array(A.buffer,A.byteOffset+O,S)}catch(z){throw new Error("".concat(M,": ").concat(z.message))}}))}loadBufferViewAsync(M,A){const O=this._extensionsLoadBufferViewAsync(M,A);if(O)return O;if(A._data)return A._data;const S=q.Get("".concat(M,"/buffer"),this._gltf.buffers,A.buffer);return A._data=this.loadBufferAsync("/buffers/".concat(S.index),S,A.byteOffset||0,A.byteLength),A._data}_loadAccessorAsync(M,A,O){if(A._data)return A._data;const S=n._GetNumComponents(M,A.type),z=S*E.c.GetTypeByteLength(A.componentType),Q=S*A.count;if(void 0==A.bufferView)A._data=Promise.resolve(new O(Q));else{const X=q.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync("/bufferViews/".concat(X.index),X).then((c=>{if(5126!==A.componentType||A.normalized||X.byteStride&&X.byteStride!==z){const M=new O(Q);return E.c.ForEach(c,A.byteOffset||0,X.byteStride||z,S,A.componentType,M.length,A.normalized||!1,((A,O)=>{M[O]=A})),M}return n._GetTypedArray(M,A.componentType,c,A.byteOffset,Q)}))}if(A.sparse){const Q=A.sparse;A._data=A._data.then((X=>{const c=X,j=q.Get("".concat(M,"/sparse/indices/bufferView"),this._gltf.bufferViews,Q.indices.bufferView),B=q.Get("".concat(M,"/sparse/values/bufferView"),this._gltf.bufferViews,Q.values.bufferView);return Promise.all([this.loadBufferViewAsync("/bufferViews/".concat(j.index),j),this.loadBufferViewAsync("/bufferViews/".concat(B.index),B)]).then((X=>{let[j,B]=X;const g=n._GetTypedArray("".concat(M,"/sparse/indices"),Q.indices.componentType,j,Q.indices.byteOffset,Q.count),e=S*Q.count;let T;if(5126!==A.componentType||A.normalized){const X=n._GetTypedArray("".concat(M,"/sparse/values"),A.componentType,B,Q.values.byteOffset,e);T=new O(e),E.c.ForEach(X,0,z,S,A.componentType,T.length,A.normalized||!1,((M,A)=>{T[A]=M}))}else T=n._GetTypedArray("".concat(M,"/sparse/values"),A.componentType,B,Q.values.byteOffset,e);let J=0;for(let M=0;M<g.length;M++){let A=g[M]*S;for(let M=0;M<S;M++)c[A++]=T[J++]}return c}))}))}return A._data}_loadFloatAccessorAsync(M,A){return this._loadAccessorAsync(M,A,Float32Array)}_loadIndicesAccessorAsync(M,A){if("SCALAR"!==A.type)throw new Error("".concat(M,"/type: Invalid value ").concat(A.type));if(5121!==A.componentType&&5123!==A.componentType&&5125!==A.componentType)throw new Error("".concat(M,"/componentType: Invalid value ").concat(A.componentType));if(A._data)return A._data;if(A.sparse){const O=n._GetTypedArrayConstructor("".concat(M,"/componentType"),A.componentType);A._data=this._loadAccessorAsync(M,A,O)}else{const O=q.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync("/bufferViews/".concat(O.index),O).then((O=>n._GetTypedArray(M,A.componentType,O,A.byteOffset,A.count)))}return A._data}_loadVertexBufferViewAsync(M){if(M._babylonBuffer)return M._babylonBuffer;const A=this._babylonScene.getEngine();return M._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(M.index),M).then((M=>new E.b(A,M,!1))),M._babylonBuffer}_loadVertexAccessorAsync(M,A,O){var S;if(null!==(S=A._babylonVertexBuffer)&&void 0!==S&&S[O])return A._babylonVertexBuffer[O];A._babylonVertexBuffer||(A._babylonVertexBuffer={});const z=this._babylonScene.getEngine();if(A.sparse||void 0==A.bufferView)A._babylonVertexBuffer[O]=this._loadFloatAccessorAsync(M,A).then((M=>new E.c(z,M,O,!1)));else{const S=q.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,A.bufferView);A._babylonVertexBuffer[O]=this._loadVertexBufferViewAsync(S).then((Q=>{const X=n._GetNumComponents(M,A.type);return new E.c(z,Q,O,!1,void 0,S.byteStride,void 0,A.byteOffset,X,A.componentType,A.normalized,!0,void 0,!0)}))}return A._babylonVertexBuffer[O]}_loadMaterialMetallicRoughnessPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return A&&(A.baseColorFactor?(O.albedoColor=Q.bA.sA(A.baseColorFactor),O.alpha=A.baseColorFactor[3]):O.albedoColor=Q.bA.White(),O.metallic=void 0==A.metallicFactor?1:A.metallicFactor,O.roughness=void 0==A.roughnessFactor?1:A.roughnessFactor,A.baseColorTexture&&S.push(this.loadTextureInfoAsync("".concat(M,"/baseColorTexture"),A.baseColorTexture,(M=>{M.name="".concat(O.name," (Base Color)"),O.albedoTexture=M}))),A.metallicRoughnessTexture&&(A.metallicRoughnessTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync("".concat(M,"/metallicRoughnessTexture"),A.metallicRoughnessTexture,(M=>{M.name="".concat(O.name," (Metallic Roughness)"),O.metallicTexture=M}))),O.useMetallnessFromMetallicTextureBlue=!0,O.useRoughnessFromMetallicTextureGreen=!0,O.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(S).then((()=>{}))}_loadMaterialAsync(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Q=this._extensionsLoadMaterialAsync(M,A,O,S,z);if(Q)return Q;A._data=A._data||{};let X=A._data[S];if(!X){this.logOpen("".concat(M," ").concat(A.name||""));const O=this.createMaterial(M,A,S);X={babylonMaterial:O,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(M,A,O)},A._data[S]=X,n.AddPointerMetadata(O,M),this._parent.onMaterialLoadedObservable.notifyObservers(O),this.logClose()}return O&&(X.babylonMeshes.push(O),O.Ac.addOnce((()=>{const M=X.babylonMeshes.indexOf(O);-1!==M&&X.babylonMeshes.splice(M,1)}))),z(X.babylonMaterial),X.promise.then((()=>X.babylonMaterial))}_createDefaultMaterial(M,A){this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new b.e(M,this._babylonScene);return O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.fillMode=A,O.enableSpecularAntiAliasing=!0,O.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,O.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,O.transparencyMode=b.e.PBRMATERIAL_OPAQUE,O.metallic=1,O.roughness=1,O}createMaterial(M,A,O){const S=this._extensionsCreateMaterial(M,A,O);if(S)return S;const z=A.name||"material".concat(A.index);return this._createDefaultMaterial(z,O)}loadMaterialPropertiesAsync(M,A,O){const S=this._extensionsLoadMaterialPropertiesAsync(M,A,O);if(S)return S;const z=new Array;return z.push(this.loadMaterialBasePropertiesAsync(M,A,O)),A.pbrMetallicRoughness&&z.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(M,"/pbrMetallicRoughness"),A.pbrMetallicRoughness,O)),this.loadMaterialAlphaProperties(M,A,O),Promise.all(z).then((()=>{}))}loadMaterialBasePropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return O.emissiveColor=A.emissiveFactor?Q.bA.sA(A.emissiveFactor):new Q.bA(0,0,0),A.doubleSided&&(O.bc=!1,O.twoSidedLighting=!0),A.normalTexture&&(A.normalTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync("".concat(M,"/normalTexture"),A.normalTexture,(M=>{M.name="".concat(O.name," (Normal)"),O.bumpTexture=M}))),O.invertNormalMapX=!this._babylonScene.useRightHandedSystem,O.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=A.normalTexture.scale&&O.bumpTexture&&(O.bumpTexture.level=A.normalTexture.scale),O.forceIrradianceInFragment=!0),A.occlusionTexture&&(A.occlusionTexture.nonColorData=!0,S.push(this.loadTextureInfoAsync("".concat(M,"/occlusionTexture"),A.occlusionTexture,(M=>{M.name="".concat(O.name," (Occlusion)"),O.ambientTexture=M}))),O.useAmbientInGrayScale=!0,void 0!=A.occlusionTexture.strength&&(O.ambientTextureStrength=A.occlusionTexture.strength)),A.emissiveTexture&&S.push(this.loadTextureInfoAsync("".concat(M,"/emissiveTexture"),A.emissiveTexture,(M=>{M.name="".concat(O.name," (Emissive)"),O.emissiveTexture=M}))),Promise.all(S).then((()=>{}))}loadMaterialAlphaProperties(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));switch(A.alphaMode||"OPAQUE"){case"OPAQUE":O.transparencyMode=b.e.PBRMATERIAL_OPAQUE,O.alpha=1;break;case"MASK":O.transparencyMode=b.e.PBRMATERIAL_ALPHATEST,O.alphaCutOff=void 0==A.alphaCutoff?.5:A.alphaCutoff,O.albedoTexture&&(O.albedoTexture.ec=!0);break;case"BLEND":O.transparencyMode=b.e.PBRMATERIAL_ALPHABLEND,O.albedoTexture&&(O.albedoTexture.ec=!0,O.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(M,"/alphaMode: Invalid value (").concat(A.alphaMode,")"))}}loadTextureInfoAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureInfoAsync(M,A,O);if(S)return S;if(this.logOpen("".concat(M)),A.texCoord>=6)throw new Error("".concat(M,"/texCoord: Invalid value (").concat(A.texCoord,")"));const z=q.Get("".concat(M,"/index"),this._gltf.textures,A.index);z._textureInfo=A;const Q=this._loadTextureAsync("/textures/".concat(A.index),z,(S=>{S.coordinatesIndex=A.texCoord||0,n.AddPointerMetadata(S,M),this._parent.onTextureLoadedObservable.notifyObservers(S),O(S)}));return this.logClose(),Q}_loadTextureAsync(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const S=this._extensionsLoadTextureAsync(M,A,O);if(S)return S;this.logOpen("".concat(M," ").concat(A.name||""));const z=void 0==A.sampler?n.DefaultSampler:q.Get("".concat(M,"/sampler"),this._gltf.samplers,A.sampler),Q=q.Get("".concat(M,"/source"),this._gltf.images,A.source),X=this._createTextureAsync(M,z,Q,O,void 0,!A._textureInfo.nonColorData);return this.logClose(),X}_createTextureAsync(M,A,O){var z,Q;let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},c=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;const B=this._loadSampler("/samplers/".concat(A.index),A),g=new Array,e=new S;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T={noMipmap:B.noMipMaps,invertY:!1,samplingMode:B.samplingMode,R:()=>{this._disposed||e.resolve()},onError:(A,O)=>{this._disposed||e.reject(new Error("".concat(M,": ").concat(O&&O.message?O.message:A||"Failed to load texture")))},mimeType:null!==(z=O.mimeType)&&void 0!==z?z:(0,u.j)(null!==(Q=O.uri)&&void 0!==Q?Q:""),loaderOptions:c,useSRGBBuffer:!!j&&this._parent.useSRGBBuffers},J=new s.c(null,this._babylonScene,T);return J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.push(e.promise),g.push(this.loadImageAsync("/images/".concat(O.index),O).then((M=>{const A=O.uri||"".concat(this._fileName,"#image").concat(O.index),S="data:".concat(this._uniqueRootUrl).concat(A);J.updateURL(S,M);const z=J.getInternalTexture();z&&(z.label=O.name)}))),J.wrapU=B.wrapU,J.wrapV=B.wrapV,X(J),this._parent.useGltfTextureNames&&(J.name=O.name||O.uri||"image".concat(O.index)),Promise.all(g).then((()=>J))}_loadSampler(M,A){return A._data||(A._data={noMipMaps:9728===A.minFilter||9729===A.minFilter,samplingMode:n._GetTextureSamplingMode(M,A),wrapU:n._GetTextureWrapMode("".concat(M,"/wrapS"),A.wrapS),wrapV:n._GetTextureWrapMode("".concat(M,"/wrapT"),A.wrapT)}),A._data}loadImageAsync(M,A){if(!A._data){if(this.logOpen("".concat(M," ").concat(A.name||"")),A.uri)A._data=this.loadUriAsync("".concat(M,"/uri"),A,A.uri);else{const O=q.Get("".concat(M,"/bufferView"),this._gltf.bufferViews,A.bufferView);A._data=this.loadBufferViewAsync("/bufferViews/".concat(O.index),O)}this.logClose()}return A._data}loadUriAsync(M,A,O){const S=this._extensionsLoadUriAsync(M,A,O);if(S)return S;if(!n._ValidateUri(O))throw new Error("".concat(M,": '").concat(O,"' is invalid"));if((0,u.l)(O)){const A=new Uint8Array((0,u.b)(O));return this.log("".concat(M,": Decoded ").concat(O.substring(0,64),"... (").concat(A.length," bytes)")),Promise.resolve(A)}return this.log("".concat(M,": Loading ").concat(O)),this._parent.preprocessUrlAsync(this._rootUrl+O).then((A=>new Promise(((S,z)=>{this._parent._loadFile(this._babylonScene,A,(A=>{this._disposed||(this.log("".concat(M,": Loaded ").concat(O," (").concat(A.byteLength," bytes)")),S(new Uint8Array(A)))}),!0,(A=>{z(new u.n("".concat(M,": Failed to load '").concat(O,"'").concat(A?": "+A.status+" "+A.statusText:""),A))}))}))))}static AddPointerMetadata(M,A){M.metadata=M.metadata||{};const O=M._internalMetadata=M._internalMetadata||{},S=O.Xc=O.Xc||{};(S.pointers=S.pointers||[]).push(A)}static _GetTextureWrapMode(M,A){switch(A=void 0==A?10497:A){case 33071:return s.c.CLAMP_ADDRESSMODE;case 33648:return s.c.MIRROR_ADDRESSMODE;case 10497:return s.c.WRAP_ADDRESSMODE;default:return G.c.Warn("".concat(M,": Invalid value (").concat(A,")")),s.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(M,A){const O=void 0==A.magFilter?9729:A.magFilter,S=void 0==A.minFilter?9987:A.minFilter;if(9729===O)switch(S){case 9728:return s.c.LINEAR_NEAREST;case 9729:return s.c.LINEAR_LINEAR;case 9984:return s.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return s.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return s.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return s.c.LINEAR_LINEAR_MIPLINEAR;default:return G.c.Warn("".concat(M,"/minFilter: Invalid value (").concat(S,")")),s.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==O&&G.c.Warn("".concat(M,"/magFilter: Invalid value (").concat(O,")")),S){case 9728:return s.c.NEAREST_NEAREST;case 9729:return s.c.NEAREST_LINEAR;case 9984:return s.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return s.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return s.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return s.c.NEAREST_LINEAR_MIPLINEAR;default:return G.c.Warn("".concat(M,"/minFilter: Invalid value (").concat(S,")")),s.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(M,A){try{return(0,v.p)(A)}catch(O){throw new Error("".concat(M,": ").concat(O.message))}}static _GetTypedArray(M,A,O,S,z){const Q=O.buffer;S=O.byteOffset+(S||0);const X=n._GetTypedArrayConstructor("".concat(M,"/componentType"),A),c=E.c.GetTypeByteLength(A);return S%c!==0?(G.c.Warn("".concat(M,": Copying buffer as byte offset (").concat(S,") is not a multiple of component type byte length (").concat(c,")")),new X(Q.slice(S,S+z*c),0)):new X(Q,S,z)}static _GetNumComponents(M,A){switch(A){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(M,": Invalid type (").concat(A,")"))}static _ValidateUri(M){return X.Tools.IsBase64(M)||-1===M.indexOf("..")}static _GetDrawMode(M,A){switch(void 0==A&&(A=4),A){case 0:return I.b.PointListDrawMode;case 1:return I.b.LineListDrawMode;case 2:return I.b.LineLoopDrawMode;case 3:return I.b.LineStripDrawMode;case 4:return I.b.TriangleFillMode;case 5:return I.b.TriangleStripDrawMode;case 6:return I.b.TriangleFanDrawMode}throw new Error("".concat(M,": Invalid mesh primitive mode (").concat(A,")"))}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const M=new Array;if(this._gltf.materials)for(const A of this._gltf.materials)if(A._data)for(const O in A._data){const S=A._data[O];for(const A of S.babylonMeshes){A.Gc(!0);const O=S.babylonMaterial;M.push(O.forceCompilationAsync(A)),M.push(O.forceCompilationAsync(A,{useInstances:!0})),this._parent.useClipPlane&&(M.push(O.forceCompilationAsync(A,{clipPlane:!0})),M.push(O.forceCompilationAsync(A,{clipPlane:!0,useInstances:!0})))}}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const M=new Array,A=this._babylonScene.lights;for(const O of A){const A=O.getShadowGenerator();A&&M.push(A.forceCompilationAsync())}return Promise.all(M).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(M){for(const A of this._extensions)A.enabled&&M(A)}_applyExtensions(M,A,O){for(const S of this._extensions)if(S.enabled){const z="".concat(S.name,".").concat(A),Q=M;Q._activeLoaderExtensionFunctions=Q._activeLoaderExtensionFunctions||{};const X=Q._activeLoaderExtensionFunctions;if(!X[z]){X[z]=!0;try{const M=O(S);if(M)return M}finally{delete X[z]}}}return null}_extensionsOnLoading(){this._forEachExtensions((M=>M.onLoading&&M.onLoading()))}_extensionsOnReady(){this._forEachExtensions((M=>M.onReady&&M.onReady()))}_extensionsLoadSceneAsync(M,A){return this._applyExtensions(A,"loadScene",(O=>O.loadSceneAsync&&O.loadSceneAsync(M,A)))}_extensionsLoadNodeAsync(M,A,O){return this._applyExtensions(A,"loadNode",(S=>S.loadNodeAsync&&S.loadNodeAsync(M,A,O)))}_extensionsLoadCameraAsync(M,A,O){return this._applyExtensions(A,"loadCamera",(S=>S.loadCameraAsync&&S.loadCameraAsync(M,A,O)))}_extensionsLoadVertexDataAsync(M,A,O){return this._applyExtensions(A,"loadVertexData",(S=>S._loadVertexDataAsync&&S._loadVertexDataAsync(M,A,O)))}_extensionsLoadMeshPrimitiveAsync(M,A,O,S,z,Q){return this._applyExtensions(z,"loadMeshPrimitive",(X=>X._loadMeshPrimitiveAsync&&X._loadMeshPrimitiveAsync(M,A,O,S,z,Q)))}_extensionsLoadMaterialAsync(M,A,O,S,z){return this._applyExtensions(A,"loadMaterial",(Q=>Q._loadMaterialAsync&&Q._loadMaterialAsync(M,A,O,S,z)))}_extensionsCreateMaterial(M,A,O){return this._applyExtensions(A,"createMaterial",(S=>S.createMaterial&&S.createMaterial(M,A,O)))}_extensionsLoadMaterialPropertiesAsync(M,A,O){return this._applyExtensions(A,"loadMaterialProperties",(S=>S.loadMaterialPropertiesAsync&&S.loadMaterialPropertiesAsync(M,A,O)))}_extensionsLoadTextureInfoAsync(M,A,O){return this._applyExtensions(A,"loadTextureInfo",(S=>S.loadTextureInfoAsync&&S.loadTextureInfoAsync(M,A,O)))}_extensionsLoadTextureAsync(M,A,O){return this._applyExtensions(A,"loadTexture",(S=>S._loadTextureAsync&&S._loadTextureAsync(M,A,O)))}_extensionsLoadAnimationAsync(M,A){return this._applyExtensions(A,"loadAnimation",(O=>O.loadAnimationAsync&&O.loadAnimationAsync(M,A)))}_extensionsLoadAnimationChannelAsync(M,A,O,S,z){return this._applyExtensions(O,"loadAnimationChannel",(Q=>Q._loadAnimationChannelAsync&&Q._loadAnimationChannelAsync(M,A,O,S,z)))}_extensionsLoadSkinAsync(M,A,O){return this._applyExtensions(O,"loadSkin",(S=>S._loadSkinAsync&&S._loadSkinAsync(M,A,O)))}_extensionsLoadUriAsync(M,A,O){return this._applyExtensions(A,"loadUri",(S=>S._loadUriAsync&&S._loadUriAsync(M,A,O)))}_extensionsLoadBufferViewAsync(M,A){return this._applyExtensions(A,"loadBufferView",(O=>O.loadBufferViewAsync&&O.loadBufferViewAsync(M,A)))}_extensionsLoadBufferAsync(M,A,O,S){return this._applyExtensions(A,"loadBuffer",(z=>z.loadBufferAsync&&z.loadBufferAsync(M,A,O,S)))}static LoadExtensionAsync(M,A,O,S){if(!A.extensions)return null;const z=A.extensions[O];return z?S("".concat(M,"/extensions/").concat(O),z):null}static LoadExtraAsync(M,A,O,S){if(!A.extras)return null;const z=A.extras[O];return z?S("".concat(M,"/extras/").concat(O),z):null}isExtensionUsed(M){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(M)}logOpen(M){this._parent._logOpen(M)}logClose(){this._parent._logClose()}log(M){this._parent._log(M)}startPerformanceCounter(M){this._parent._startPerformanceCounter(M)}endPerformanceCounter(M){this._parent._endPerformanceCounter(M)}}n.DefaultSampler={index:-1},h.b._CreateGLTF2Loader=M=>new n(M);var a=O(14188),V=O(13177),Z=O(12998),P=O(14193),mM=O(14197);class R extends mM.b{constructor(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",M),this._texture=M.getEngine().createRawCubeTexture(A,O,S,z,Q,X,c,j)}update(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,M,A,O,S,z)}updateRGBDAsync(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.j)(this._texture,M,A,O,S).then((()=>{}))}clone(){return Z.e.Clone((()=>{const M=this.HM(),A=this._texture,O=new R(M,A._bufferViewArray,A.width,A.format,A.type,A.generateMipMaps,A.invertY,A.samplingMode,A._compression);return 13===A.source&&O.updateRGBDAsync(A._bufferViewArrayArray,A._sphericalPolynomial,A._lodGenerationScale,A._lodGenerationOffset),O}),this)}}const k="EXT_lights_image_based";class W{constructor(M){this.name=k,this._loader=M,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Xc.extensions;if(M&&M[this.name]){const A=M[this.name];this._lights=A.lights}}loadSceneAsync(M,A){return n.LoadExtensionAsync(M,A,this.name,(async(O,S)=>{this._loader._allMaterialsDirtyRequired=!0;const z=new Array;z.push(this._loader.loadSceneAsync(M,A)),this._loader.logOpen("".concat(O));const Q=q.Get("".concat(O,"/light"),this._lights,S.nz);return z.push(this._loadLightAsync("/extensions/".concat(this.name,"/lights/").concat(S.nz),Q).then((M=>{this._loader.babylonScene.environmentTexture=M}))),this._loader.logClose(),await Promise.all(z).then((()=>{}))}))}_loadLightAsync(M,A){if(!A._loaded){const O=new Array;this._loader.logOpen("".concat(M));const S=new Array(A.specularImages.length);for(let z=0;z<A.specularImages.length;z++){const Q=A.specularImages[z];S[z]=new Array(Q.length);for(let A=0;A<Q.length;A++){const X="".concat(M,"/specularImages/").concat(z,"/").concat(A);this._loader.logOpen("".concat(X));const c=Q[A],j=q.Get(X,this._loader.Xc.images,c);O.push(this._loader.loadImageAsync("/images/".concat(c),j).then((M=>{S[z][A]=M}))),this._loader.logClose()}}this._loader.logClose(),A._loaded=Promise.all(O).then((async()=>{const O=new R(this._loader.babylonScene,null,A.specularImageSize);if(O.name=A.name||"environment",A._babylonTexture=O,void 0!=A.Fc&&(O.level=A.Fc),A.rotation){let M=z.Quaternion.sA(A.rotation);this._loader.babylonScene.useRightHandedSystem||(M=z.Quaternion.Inverse(M)),z.Matrix.FromQuaternionToRef(M,O.getReflectionTextureMatrix())}if(!A.irradianceCoefficients)throw new Error("".concat(M,": Irradiance coefficients are missing"));const Q=V.e.sA(A.irradianceCoefficients);Q.scaleInPlace(A.Fc),Q.convertIrradianceToLambertianRadiance();const X=V.g.FromHarmonics(Q),c=(S.length-1)/Math.log2(A.specularImageSize);return await O.updateRGBDAsync(S,X,c)}))}return A._loaded.then((()=>A._babylonTexture))}}x(k),t(k,!0,(M=>new W(M)));O(13537);const l="EXT_mesh_gpu_instancing";class MM{constructor(M){this.name=l,this._loader=M,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null}loadNodeAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(M,S)=>{this._loader._disableInstancedMesh++;const Q=this._loader.loadNodeAsync("/nodes/".concat(A.index),A,O);if(this._loader._disableInstancedMesh--,!A._primitiveBabylonMeshes)return await Q;const X=new Array;let c=0;const j=A=>{if(void 0==S.attributes[A])return void X.push(Promise.resolve(null));const O=q.Get("".concat(M,"/attributes/").concat(A),this._loader.Xc.accessors,S.attributes[A]);if(X.push(this._loader._loadFloatAccessorAsync("/accessors/".concat(O.bufferView),O)),0===c)c=O.count;else if(c!==O.count)throw new Error("".concat(M,"/attributes: Instance buffer accessors do not have the same count."))};return j("TRANSLATION"),j("ROTATION"),j("SCALE"),await Q.then((async M=>{const[O,S,Q]=await Promise.all(X),j=new Float32Array(16*c);z.TmpVectors.GA[0].Yc(0,0,0),z.TmpVectors.Quaternion[0].Yc(0,0,0,1),z.TmpVectors.GA[1].Yc(1,1,1);for(let A=0;A<c;++A)O&&z.GA.FromArrayToRef(O,3*A,z.TmpVectors.GA[0]),S&&z.Quaternion.FromArrayToRef(S,4*A,z.TmpVectors.Quaternion[0]),Q&&z.GA.FromArrayToRef(Q,3*A,z.TmpVectors.GA[1]),z.Matrix.ComposeToRef(z.TmpVectors.GA[1],z.TmpVectors.Quaternion[0],z.TmpVectors.GA[0],z.TmpVectors.Matrix[0]),z.TmpVectors.Matrix[0].copyToArray(j,16*A);for(const z of A._primitiveBabylonMeshes)z.hT("matrix",j,16,!0);return M}))}))}}x(l),t(l,!0,(M=>new MM(M)));let AM=0,OM=null;class SM{static get Default(){return SM._Default||(SM._Default=new SM),SM._Default}constructor(){const M=SM.Configuration.decoder;this._decoderModulePromise=X.Tools.LoadBabylonScriptAsync(M.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(M,A,O,S,z){await this._decoderModulePromise,0===AM&&(MeshoptDecoder.useWorkers(1),AM=1);const Q=await MeshoptDecoder.decodeGltfBufferAsync(A,O,M,S,z);return null!==OM&&clearTimeout(OM),OM=setTimeout((()=>{MeshoptDecoder.useWorkers(0),AM=0,OM=null}),1e3),Q}}SM.Configuration={decoder:{url:"".concat(X.Tools._DefaultCdnUrl,"/meshopt_decoder.js")}},SM._Default=null;const zM="EXT_meshopt_compression";class QM{constructor(M){this.name=zM,this.enabled=M.isExtensionUsed(zM),this._loader=M}dispose(){this._loader=null}loadBufferViewAsync(M,A){return n.LoadExtensionAsync(M,A,this.name,(async(O,S)=>{const z=A;if(z._meshOptData)return await z._meshOptData;const Q=q.Get("".concat(M,"/buffer"),this._loader.Xc.buffers,S.buffer);return z._meshOptData=this._loader.loadBufferAsync("/buffers/".concat(Q.index),Q,S.byteOffset||0,S.byteLength).then((async M=>await SM.Default.decodeGltfBufferAsync(M,S.count,S.byteStride,S.mode,S.filter))),await z._meshOptData}))}}x(zM),t(zM,!0,(M=>new QM(M)));const XM="EXT_texture_webp";class cM{constructor(M){this.name=XM,this._loader=M,this.enabled=M.isExtensionUsed(XM)}dispose(){this._loader=null}_loadTextureAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=void 0==A.sampler?n.DefaultSampler:q.Get("".concat(M,"/sampler"),this._loader.Xc.samplers,A.sampler),X=q.Get("".concat(S,"/source"),this._loader.Xc.images,z.source);return await this._loader._createTextureAsync(M,Q,X,(M=>{O(M)}),void 0,!A._textureInfo.nonColorData)}))}}x(XM),t(XM,!0,(M=>new cM(M)));const jM="EXT_texture_avif";class BM{constructor(M){this.name=jM,this._loader=M,this.enabled=M.isExtensionUsed(jM)}dispose(){this._loader=null}_loadTextureAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=void 0==A.sampler?n.DefaultSampler:q.Get("".concat(M,"/sampler"),this._loader.Xc.samplers,A.sampler),X=q.Get("".concat(S,"/source"),this._loader.Xc.images,z.source);return await this._loader._createTextureAsync(M,Q,X,(M=>{O(M)}),void 0,!A._textureInfo.nonColorData)}))}}x(jM),t(jM,!0,(M=>new BM(M)));var gM=O(14186),eM=O(13522);const TM="EXT_lights_ies";class JM{constructor(M){this.name=TM,this._loader=M,this.enabled=this._loader.isExtensionUsed(TM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Xc.extensions;if(M&&M[this.name]){const A=M[this.name];this._lights=A.lights,q.Assign(this._lights)}}loadNodeAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,X)=>{let c,j;this._loader._allMaterialsDirtyRequired=!0;const B=await this._loader.loadNodeAsync(M,A,(M=>{j=q.Get(S,this._lights,X.nz);const A=j.name||M.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,c=new gM.c(A,z.GA.Zero(),z.GA.Backward(),0,1,this._loader.babylonScene),c.angle=Math.PI/2,c.innerAngle=0,c._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,j._babylonLight=c,c.falloffType=eM.d.FALLOFF_GLTF,c.Nc=X.color?Q.bA.sA(X.color):Q.bA.White(),c.Fc=X.multiplier||1,c.range=Number.MAX_VALUE,c.parent=M,this._loader._babylonLights.push(c),n.AddPointerMetadata(c,S),O(M)}));let g;if(j.uri)g=await this._loader.loadUriAsync(M,j,j.uri);else{const A=q.Get("".concat(M,"/bufferView"),this._loader.Xc.bufferViews,j.bufferView);g=await this._loader.loadBufferViewAsync("/bufferViews/".concat(A.index),A)}return c.iesProfileTexture=new s.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,g,!0,void 0,void 0,void 0,void 0,".ies"),B}))}}x(TM),t(TM,!0,(M=>new JM(M)));var KM=O(14210);const GM="KHR_draco_mesh_compression";class dM{constructor(M){this.name=GM,this.useNormalizedFlagFromAccessor=!0,this._loader=M,this.enabled=KM.d.DefaultAvailable&&this._loader.isExtensionUsed(GM)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{if(void 0!=A.mode&&4!==A.mode&&5!==A.mode)throw new Error("".concat(M,": Unsupported mode ").concat(A.mode));const Q={},X={},c=(M,S)=>{const c=z.attributes[M];if(void 0!=c&&(O._delayInfo=O._delayInfo||[],-1===O._delayInfo.indexOf(S)&&O._delayInfo.push(S),Q[S]=c,this.useNormalizedFlagFromAccessor)){const O=q.TryGet(this._loader.Xc.accessors,A.attributes[M]);O&&(X[S]=O.normalized||!1)}};c("POSITION",E.c.PositionKind),c("NORMAL",E.c.NormalKind),c("TANGENT",E.c.TangentKind),c("TEXCOORD_0",E.c.UVKind),c("TEXCOORD_1",E.c.UV2Kind),c("TEXCOORD_2",E.c.UV3Kind),c("TEXCOORD_3",E.c.UV4Kind),c("TEXCOORD_4",E.c.UV5Kind),c("TEXCOORD_5",E.c.UV6Kind),c("JOINTS_0",E.c.MatricesIndicesKind),c("WEIGHTS_0",E.c.MatricesWeightsKind),c("COLOR_0",E.c.ColorKind);const j=q.Get(S,this._loader.Xc.bufferViews,z.bufferView);return j._dracoBabylonGeometry||(j._dracoBabylonGeometry=this._loader.loadBufferViewAsync("/bufferViews/".concat(j.index),j).then((async S=>{const z=this.dracoDecoder||KM.d.Default,c=q.TryGet(this._loader.Xc.accessors,A.attributes.POSITION),j=this._loader.parent.alwaysComputeBoundingBox||O.skeleton||!c?null:r(c);return await z._decodeMeshToGeometryForGltfAsync(O.name,this._loader.babylonScene,S,Q,X,j).catch((A=>{throw new Error("".concat(M,": ").concat(A.message))}))}))),await j._dracoBabylonGeometry}))}}x(GM),t(GM,!0,(M=>new dM(M)));var wM=O(14217),IM=O(12958),bM=O(12964),sM=O(13393),YM=O(13568),EM=O(12919);sM.e.AddNodeConstructor("Light_Type_0",((M,A)=>()=>new HM(M,z.GA.Zero(),A)));class HM extends YM.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(M){this._shadowAngle=M,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(M){const A=this.needCube();if(this._direction=M,this.needCube()!==A&&this._shadowGenerators){const M=this._shadowGenerators.values();for(let A=M.next();!0!==A.done;A=M.next()){A.value.recreateShadowMap()}}}constructor(M,A,O){super(M,O),this._shadowAngle=Math.PI/2,this.position=A}getClassName(){return"PointLight"}getTypeID(){return eM.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(M){if(this.direction)return super.getShadowDirection(M);switch(M){case 0:return new z.GA(1,0,0);case 1:return new z.GA(-1,0,0);case 2:return new z.GA(0,-1,0);case 3:return new z.GA(0,1,0);case 4:return new z.GA(0,0,1);case 5:return new z.GA(0,0,-1)}return z.GA.Zero()}_setDefaultShadowProjectionMatrix(M,A,O){const S=this.HM().activeCamera;if(!S)return;const Q=void 0!==this.shadowMinZ?this.shadowMinZ:S.Tc,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,c=this.HM().getEngine().QQ;z.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,c?X:Q,c?Q:X,M,!0,this._scene.getEngine().isNDCHalfZRange,void 0,c)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(M,A){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,A):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,A),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,A),this}transferToNodeMaterialEffect(M,A){return this.computeTransformedInformation()?M.setFloat3(A,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):M.setFloat3(A,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(M,A){M["POINTLIGHT"+A]=!0}}(0,IM.d)([(0,bM.H)()],HM.prototype,"shadowAngle",null),(0,EM.g)("BABYLON.PointLight",HM);const CM="KHR_lights_punctual";class fM{constructor(M){this.name=CM,this._loader=M,this.enabled=this._loader.isExtensionUsed(CM)}dispose(){this._loader=null,delete this._lights}onLoading(){const M=this._loader.Xc.extensions;if(M&&M[this.name]){const A=M[this.name];this._lights=A.lights,q.Assign(this._lights)}}loadNodeAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,X)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(M,A,(M=>{let A;const c=q.Get(S,this._lights,X.nz),j=c.name||M.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,c.type){case"directional":{const M=new wM.c(j,z.GA.Backward(),this._loader.babylonScene);M.position.Hc(0),A=M;break}case"point":A=new HM(j,z.GA.Zero(),this._loader.babylonScene);break;case"spot":{const M=new gM.c(j,z.GA.Zero(),z.GA.Backward(),0,1,this._loader.babylonScene);M.angle=2*(c.spot&&c.spot.outerConeAngle||Math.PI/4),M.innerAngle=2*(c.spot&&c.spot.innerConeAngle||0),A=M;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(S,": Invalid light type (").concat(c.type,")"))}A._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,c._babylonLight=A,A.falloffType=eM.d.FALLOFF_GLTF,A.Nc=c.color?Q.bA.sA(c.color):Q.bA.White(),A.Fc=void 0==c.Fc?1:c.Fc,A.range=void 0==c.range?Number.MAX_VALUE:c.range,A.parent=M,this._loader._babylonLights.push(A),n.AddPointerMetadata(A,S),O(M)})))))}}x(CM),t(CM,!0,(M=>new fM(M)));const DM="KHR_materials_pbrSpecularGlossiness";class FM{constructor(M){this.name=DM,this.order=200,this._loader=M,this.enabled=this._loader.isExtensionUsed(DM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialBasePropertiesAsync(M,A,O)),Q.push(this._loadSpecularGlossinessPropertiesAsync(S,z,O)),this._loader.loadMaterialAlphaProperties(M,A,O),await Promise.all(Q).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return O.metallic=null,O.roughness=null,A.diffuseFactor?(O.albedoColor=Q.bA.sA(A.diffuseFactor),O.alpha=A.diffuseFactor[3]):O.albedoColor=Q.bA.White(),O.reflectivityColor=A.specularFactor?Q.bA.sA(A.specularFactor):Q.bA.White(),O.microSurface=void 0==A.glossinessFactor?1:A.glossinessFactor,A.diffuseTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/diffuseTexture"),A.diffuseTexture,(M=>{M.name="".concat(O.name," (Diffuse)"),O.albedoTexture=M}))),A.specularGlossinessTexture&&(S.push(this._loader.loadTextureInfoAsync("".concat(M,"/specularGlossinessTexture"),A.specularGlossinessTexture,(M=>{M.name="".concat(O.name," (Specular Glossiness)"),O.reflectivityTexture=M,O.reflectivityTexture.ec=!0}))),O.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(S).then((()=>{}))}}x(DM),t(DM,!0,(M=>new FM(M)));const NM="KHR_materials_unlit";class yM{constructor(M){this.name=NM,this.order=210,this._loader=M,this.enabled=this._loader.isExtensionUsed(NM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async()=>await this._loadUnlitPropertiesAsync(M,A,O)))}_loadUnlitPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;O.unlit=!0;const z=A.pbrMetallicRoughness;return z&&(z.baseColorFactor?(O.albedoColor=Q.bA.sA(z.baseColorFactor),O.alpha=z.baseColorFactor[3]):O.albedoColor=Q.bA.White(),z.baseColorTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/baseColorTexture"),z.baseColorTexture,(M=>{M.name="".concat(O.name," (Base Color)"),O.albedoTexture=M})))),A.doubleSided&&(O.bc=!1,O.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(M,A,O),Promise.all(S).then((()=>{}))}}x(NM),t(NM,!0,(M=>new yM(M)));const hM="KHR_materials_clearcoat";class uM{constructor(M){this.name=hM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(hM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadClearCoatPropertiesAsync(S,z,O)),await Promise.all(Q)}))}_loadClearCoatPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return O.clearCoat.isEnabled=!0,O.clearCoat.useRoughnessFromMainTexture=!1,O.clearCoat.remapF0OnInterfaceChange=!1,void 0!=A.clearcoatFactor?O.clearCoat.Fc=A.clearcoatFactor:O.clearCoat.Fc=0,A.clearcoatTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/clearcoatTexture"),A.clearcoatTexture,(M=>{M.name="".concat(O.name," (ClearCoat)"),O.clearCoat.texture=M}))),void 0!=A.clearcoatRoughnessFactor?O.clearCoat.roughness=A.clearcoatRoughnessFactor:O.clearCoat.roughness=0,A.clearcoatRoughnessTexture&&(A.clearcoatRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync("".concat(M,"/clearcoatRoughnessTexture"),A.clearcoatRoughnessTexture,(M=>{M.name="".concat(O.name," (ClearCoat Roughness)"),O.clearCoat.textureRoughness=M})))),A.clearcoatNormalTexture&&(A.clearcoatNormalTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync("".concat(M,"/clearcoatNormalTexture"),A.clearcoatNormalTexture,(M=>{M.name="".concat(O.name," (ClearCoat Normal)"),O.clearCoat.bumpTexture=M}))),O.invertNormalMapX=!O.HM().useRightHandedSystem,O.invertNormalMapY=O.HM().useRightHandedSystem,void 0!=A.clearcoatNormalTexture.scale&&(O.clearCoat.bumpTexture.level=A.clearcoatNormalTexture.scale)),Promise.all(S).then((()=>{}))}}x(hM),t(hM,!0,(M=>new uM(M)));const iM="KHR_materials_iridescence";class UM{constructor(M){this.name=iM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(iM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadIridescencePropertiesAsync(S,z,O)),await Promise.all(Q).then((()=>{}))}))}_loadIridescencePropertiesAsync(M,A,O){var S,z,Q,X,c;if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const j=new Array;return O.iridescence.isEnabled=!0,O.iridescence.Fc=null!==(S=A.iridescenceFactor)&&void 0!==S?S:0,O.iridescence.indexOfRefraction=null!==(z=null!==(Q=A.iridescenceIor)&&void 0!==Q?Q:A.iridescenceIOR)&&void 0!==z?z:1.3,O.iridescence.minimumThickness=null!==(X=A.iridescenceThicknessMinimum)&&void 0!==X?X:100,O.iridescence.maximumThickness=null!==(c=A.iridescenceThicknessMaximum)&&void 0!==c?c:400,A.iridescenceTexture&&j.push(this._loader.loadTextureInfoAsync("".concat(M,"/iridescenceTexture"),A.iridescenceTexture,(M=>{M.name="".concat(O.name," (Iridescence)"),O.iridescence.texture=M}))),A.iridescenceThicknessTexture&&j.push(this._loader.loadTextureInfoAsync("".concat(M,"/iridescenceThicknessTexture"),A.iridescenceThicknessTexture,(M=>{M.name="".concat(O.name," (Iridescence Thickness)"),O.iridescence.thicknessTexture=M}))),Promise.all(j).then((()=>{}))}}x(iM),t(iM,!0,(M=>new UM(M)));const LM="KHR_materials_anisotropy";class tM{constructor(M){this.name=LM,this.order=195,this._loader=M,this.enabled=this._loader.isExtensionUsed(LM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadIridescencePropertiesAsync(S,z,O)),await Promise.all(Q)}))}async _loadIridescencePropertiesAsync(M,A,O){var S,z;if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const Q=new Array;O.anisotropy.isEnabled=!0,O.anisotropy.Fc=null!==(S=A.anisotropyStrength)&&void 0!==S?S:0,O.anisotropy.angle=null!==(z=A.anisotropyRotation)&&void 0!==z?z:0,A.anisotropyTexture&&(A.anisotropyTexture.nonColorData=!0,Q.push(this._loader.loadTextureInfoAsync("".concat(M,"/anisotropyTexture"),A.anisotropyTexture,(M=>{M.name="".concat(O.name," (Anisotropy Intensity)"),O.anisotropy.texture=M})))),await Promise.all(Q)}}x(LM),t(LM,!0,(M=>new tM(M)));const xM="KHR_materials_emissive_strength";class oM{constructor(M){this.name=xM,this.order=170,this._loader=M,this.enabled=this._loader.isExtensionUsed(xM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>await this._loader.loadMaterialPropertiesAsync(M,A,O).then((()=>{this._loadEmissiveProperties(S,z,O)}))))}_loadEmissiveProperties(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));void 0!==A.emissiveStrength&&(O.emissiveIntensity=A.emissiveStrength)}}x(xM),t(xM,!0,(M=>new oM(M)));const pM="KHR_materials_sheen";class vM{constructor(M){this.name=pM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(pM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadSheenPropertiesAsync(S,z,O)),await Promise.all(Q).then((()=>{}))}))}_loadSheenPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return O.sheen.isEnabled=!0,O.sheen.Fc=1,void 0!=A.sheenColorFactor?O.sheen.color=Q.bA.sA(A.sheenColorFactor):O.sheen.color=Q.bA.Black(),A.sheenColorTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/sheenColorTexture"),A.sheenColorTexture,(M=>{M.name="".concat(O.name," (Sheen Color)"),O.sheen.texture=M}))),void 0!==A.sheenRoughnessFactor?O.sheen.roughness=A.sheenRoughnessFactor:O.sheen.roughness=0,A.sheenRoughnessTexture&&(A.sheenRoughnessTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync("".concat(M,"/sheenRoughnessTexture"),A.sheenRoughnessTexture,(M=>{M.name="".concat(O.name," (Sheen Roughness)"),O.sheen.textureRoughness=M})))),O.sheen.albedoScaling=!0,O.sheen.useRoughnessFromMainTexture=!1,Promise.all(S).then((()=>{}))}}x(pM),t(pM,!0,(M=>new vM(M)));var qM=O(13455);const rM="KHR_materials_specular";class nM{constructor(M){this.name=rM,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(rM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;if(Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadSpecularPropertiesAsync(S,z,O)),z.extensions&&z.extensions.EXT_materials_specular_edge_color&&O instanceof b.e){z.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(O.brdf.dielectricSpecularModel=qM.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,O.brdf.conductorSpecularModel=qM.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(Q).then((()=>{}))}))}_loadSpecularPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return void 0!==A.specularFactor&&(O.metallicF0Factor=A.specularFactor),void 0!==A.specularColorFactor&&(O.metallicReflectanceColor=Q.bA.sA(A.specularColorFactor)),A.specularTexture&&(A.specularTexture.nonColorData=!0,S.push(this._loader.loadTextureInfoAsync("".concat(M,"/specularTexture"),A.specularTexture,(M=>{M.name="".concat(O.name," (Specular)"),O.metallicReflectanceTexture=M,O.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),A.specularColorTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/specularColorTexture"),A.specularColorTexture,(M=>{M.name="".concat(O.name," (Specular Color)"),O.reflectanceTexture=M}))),Promise.all(S).then((()=>{}))}}x(rM),t(rM,!0,(M=>new nM(M)));const aM="KHR_materials_ior";class VM{constructor(M){this.name=aM,this.order=180,this._loader=M,this.enabled=this._loader.isExtensionUsed(aM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadIorPropertiesAsync(S,z,O)),await Promise.all(Q).then((()=>{}))}))}_loadIorPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));return void 0!==A.ior?O.indexOfRefraction=A.ior:O.indexOfRefraction=VM._DEFAULT_IOR,Promise.resolve()}}VM._DEFAULT_IOR=1.5,x(aM),t(aM,!0,(M=>new VM(M)));const ZM="KHR_materials_variants";class PM{constructor(M){this.name=ZM,this._loader=M,this.enabled=this._loader.isExtensionUsed(ZM)}dispose(){this._loader=null}static GetAvailableVariants(M){const A=this._GetExtensionMetadata(M);return A?Object.keys(A.variants):[]}getAvailableVariants(M){return PM.GetAvailableVariants(M)}static SelectVariant(M,A){const O=this._GetExtensionMetadata(M);if(!O)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(ZM," extension"));const S=M=>{const A=O.variants[M];if(A)for(const O of A)O.mesh.material=O.material};if(A instanceof Array)for(const z of A)S(z);else S(A);O.lastSelected=A}selectVariant(M,A){PM.SelectVariant(M,A)}static Reset(M){const A=this._GetExtensionMetadata(M);if(!A)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(ZM," extension"));for(const O of A.original)O.mesh.material=O.material;A.lastSelected=null}reset(M){PM.Reset(M)}static GetLastSelectedVariant(M){const A=this._GetExtensionMetadata(M);if(!A)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(ZM," extension"));return A.lastSelected}getLastSelectedVariant(M){return PM.GetLastSelectedVariant(M)}static _GetExtensionMetadata(M){var A,O;return(null===M||void 0===M||null===(A=M._internalMetadata)||void 0===A||null===(O=A.Xc)||void 0===O?void 0:O[ZM])||null}onLoading(){const M=this._loader.Xc.extensions;if(M&&M[this.name]){const A=M[this.name];this._variants=A.variants}}onReady(){const M=this._loader.rootBabylonMesh;if(M){var A;const O=this._loader.parent.extensionOptions[ZM];null!==O&&void 0!==O&&O.defaultVariant&&PM.SelectVariant(M,O.defaultVariant),null===O||void 0===O||null===(A=O.onLoaded)||void 0===A||A.call(O,{get variants(){return PM.GetAvailableVariants(M)},get selectedVariant(){const A=PM.GetLastSelectedVariant(M);return A?Array.isArray(A)?A[0]:A:PM.GetAvailableVariants(M)[0]},set selectedVariant(A){PM.SelectVariant(M,A)}})}}_loadMeshPrimitiveAsync(M,A,O,S,z,Q){return n.LoadExtensionAsync(M,z,this.name,(async(X,c)=>{const j=new Array;return j.push(this._loader._loadMeshPrimitiveAsync(M,A,O,S,z,(A=>{if(Q(A),A instanceof f.d){const O=n._GetDrawMode(M,z.mode),S=this._loader.rootBabylonMesh,Q=S?S._internalMetadata=S._internalMetadata||{}:{},B=Q.Xc=Q.Xc||{},g=B[ZM]=B[ZM]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:A,material:A.material});for(let M=0;M<c.mappings.length;++M){const z=c.mappings[M],Q=q.Get("".concat(X,"/mappings/").concat(M,"/material"),this._loader.Xc.materials,z.material);j.push(this._loader._loadMaterialAsync("#/materials/".concat(z.material),Q,A,O,(M=>{for(let O=0;O<z.variants.length;++O){const Q=z.variants[O],X=q.Get("/extensions/".concat(ZM,"/variants/").concat(Q),this._variants,Q);g.variants[X.name]=g.variants[X.name]||[],g.variants[X.name].push({mesh:A,material:M}),A.onClonedObservable.add((M=>{const O=M;let z=null,Q=O;do{if(Q=Q.parent,!Q)return;z=PM._GetExtensionMetadata(Q)}while(null===z);if(S&&z===PM._GetExtensionMetadata(S)){Q._internalMetadata={};for(const M in S._internalMetadata)Q._internalMetadata[M]=S._internalMetadata[M];Q._internalMetadata.Xc=[];for(const M in S._internalMetadata.Xc)Q._internalMetadata.Xc[M]=S._internalMetadata.Xc[M];Q._internalMetadata.Xc[ZM]={lastSelected:null,original:[],variants:{}};for(const M of z.original)Q._internalMetadata.Xc[ZM].original.push({mesh:M.mesh,material:M.material});for(const M in z.variants)if(Object.prototype.hasOwnProperty.call(z.variants,M)){Q._internalMetadata.Xc[ZM].variants[M]=[];for(const A of z.variants[M])Q._internalMetadata.Xc[ZM].variants[M].push({mesh:A.mesh,material:A.material})}z=Q._internalMetadata.Xc[ZM]}for(const S of z.original)S.mesh===A&&(S.mesh=O);for(const S of z.variants[X.name])S.mesh===A&&(S.mesh=O)}))}})))}}}))),await Promise.all(j).then((M=>{let[A]=M;return A}))}))}}x(ZM),t(ZM,!0,(M=>new PM(M)));var mA=O(22),RM=O(13033);class kM{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:qM.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(M,A){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,mA.d)((0,mA.d)({},kM._GetDefaultOptions()),M),this._scene=A,this._scene._transmissionHelper=this,this.onErrorObservable=new g.c,this._scene.Ac.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(M){if(!Object.keys(M).filter((A=>this._options[A]!==M[A])).length)return;const A=(0,mA.d)((0,mA.d)({},this._options),M),O=this._options;this._options=A,A.renderSize===O.renderSize&&A.renderTargetTextureType===O.renderTargetTextureType&&A.generateMipmaps===O.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=A.samples,this._opaqueRenderTarget.lodGenerationScale=A.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=A.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(M){return!!M&&!!(M instanceof b.e&&M.subSurface.isRefractionEnabled)}_addMesh(M){this._materialObservers[M.uniqueId]=M.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),X.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(M.material)?(M.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(M)&&this._transparentMeshesCache.push(M)):-1===this._opaqueMeshesCache.indexOf(M)&&this._opaqueMeshesCache.push(M)}))}_removeMesh(M){M.onMaterialChangedObservable.remove(this._materialObservers[M.uniqueId]),delete this._materialObservers[M.uniqueId];let A=this._transparentMeshesCache.indexOf(M);-1!==A&&this._transparentMeshesCache.splice(A,1),A=this._opaqueMeshesCache.indexOf(M),-1!==A&&this._opaqueMeshesCache.splice(A,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(M){const A=this._transparentMeshesCache.indexOf(M),O=this._opaqueMeshesCache.indexOf(M);this._shouldRenderAsTransmission(M.material)?(M.material instanceof b.e&&(M.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==O?(this._opaqueMeshesCache.splice(O,1),this._transparentMeshesCache.push(M)):-1===A&&this._transparentMeshesCache.push(M)):-1!==A?(this._transparentMeshesCache.splice(A,1),this._opaqueMeshesCache.push(M)):-1===O&&this._opaqueMeshesCache.push(M)}_isRenderTargetValid(){var M;return null!==(null===(M=this._opaqueRenderTarget)||void 0===M?void 0:M.getInternalTexture())}_setupRenderTargets(){var M,A;let O;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new RM.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(M=null===(A=this._options.clearColor)||void 0===A?void 0:A.clone())&&void 0!==M?M:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((M=>{O=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?M.clearColor.S(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(M.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=O}));for(const S of this._transparentMeshesCache)this._shouldRenderAsTransmission(S.material)&&(S.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const WM="KHR_materials_transmission";class lM{constructor(M){this.name=WM,this.order=175,this._loader=M,this.enabled=this._loader.isExtensionUsed(WM),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadTransparentPropertiesAsync(S,A,O,z)),await Promise.all(Q).then((()=>{}))}))}_loadTransparentPropertiesAsync(M,A,O,S){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const z=O;if(z.subSurface.isRefractionEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.useAlbedoToTintRefraction=!0,void 0===S.transmissionFactor)return z.subSurface.refractionIntensity=0,z.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Q;z.subSurface.refractionIntensity=S.transmissionFactor;const M=z.HM();if(z.subSurface.refractionIntensity&&!M._transmissionHelper)new kM({},z.HM());else if(z.subSurface.refractionIntensity&&(null===(Q=M._transmissionHelper)||void 0===Q||!Q._isRenderTargetValid())){var X;null===(X=M._transmissionHelper)||void 0===X||X._setupRenderTargets()}}return z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,S.transmissionTexture?(S.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(M,"/transmissionTexture"),S.transmissionTexture,void 0).then((M=>{M.name="".concat(O.name," (Transmission)"),z.subSurface.refractionIntensityTexture=M,z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(WM),t(WM,!0,(M=>new lM(M)));const MA="KHR_materials_diffuse_transmission";class AA{constructor(M){this.name=MA,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(MA),this.enabled&&(M.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadTranslucentPropertiesAsync(S,A,O,z)),await Promise.all(Q).then((()=>{}))}))}_loadTranslucentPropertiesAsync(M,A,O,S){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const z=O;if(z.subSurface.isTranslucencyEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,z.subSurface.useAlbedoToTintTranslucency=!1,void 0===S.diffuseTransmissionFactor)return z.subSurface.translucencyIntensity=0,z.subSurface.isTranslucencyEnabled=!1,Promise.resolve();z.subSurface.translucencyIntensity=S.diffuseTransmissionFactor;const X=new Array;return z.subSurface.useGltfStyleTextures=!0,S.diffuseTransmissionTexture&&(S.diffuseTransmissionTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync("".concat(M,"/diffuseTransmissionTexture"),S.diffuseTransmissionTexture).then((M=>{M.name="".concat(O.name," (Diffuse Transmission)"),z.subSurface.translucencyIntensityTexture=M})))),void 0!==S.diffuseTransmissionColorFactor?z.subSurface.translucencyColor=Q.bA.sA(S.diffuseTransmissionColorFactor):z.subSurface.translucencyColor=Q.bA.White(),S.diffuseTransmissionColorTexture&&X.push(this._loader.loadTextureInfoAsync("".concat(M,"/diffuseTransmissionColorTexture"),S.diffuseTransmissionColorTexture).then((M=>{M.name="".concat(O.name," (Diffuse Transmission Color)"),z.subSurface.translucencyColorTexture=M}))),Promise.all(X).then((()=>{}))}}x(MA),t(MA,!0,(M=>new AA(M)));const OA="KHR_materials_volume";class SA{constructor(M){this.name=OA,this.order=173,this._loader=M,this.enabled=this._loader.isExtensionUsed(OA),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadVolumePropertiesAsync(S,A,O,z)),await Promise.all(Q).then((()=>{}))}))}_loadVolumePropertiesAsync(M,A,O,S){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));if(!O.subSurface.isRefractionEnabled&&!O.subSurface.isTranslucencyEnabled||!S.thicknessFactor)return Promise.resolve();O.subSurface.volumeIndexOfRefraction=O.indexOfRefraction;const z=void 0!==S.attenuationDistance?S.attenuationDistance:Number.MAX_VALUE;return O.subSurface.tintColorAtDistance=z,void 0!==S.attenuationColor&&3==S.attenuationColor.length&&O.subSurface.tintColor.Yc(S.attenuationColor[0],S.attenuationColor[1],S.attenuationColor[2]),O.subSurface.minimumThickness=0,O.subSurface.maximumThickness=S.thicknessFactor,O.subSurface.useThicknessAsDepth=!0,S.thicknessTexture?(S.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(M,"/thicknessTexture"),S.thicknessTexture).then((M=>{M.name="".concat(O.name," (Thickness)"),O.subSurface.thicknessTexture=M,O.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(OA),t(OA,!0,(M=>new SA(M)));const zA="KHR_materials_dispersion";class QA{constructor(M){this.name=zA,this.order=174,this._loader=M,this.enabled=this._loader.isExtensionUsed(zA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadDispersionPropertiesAsync(S,A,O,z)),await Promise.all(Q).then((()=>{}))}))}_loadDispersionPropertiesAsync(M,A,O,S){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));return O.subSurface.isRefractionEnabled&&S.dispersion?(O.subSurface.isDispersionEnabled=!0,O.subSurface.dispersion=S.dispersion,Promise.resolve()):Promise.resolve()}}x(zA),t(zA,!0,(M=>new QA(M)));const XA="EXT_materials_diffuse_roughness";class cA{constructor(M){this.name=XA,this.order=190,this._loader=M,this.enabled=this._loader.isExtensionUsed(XA)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=new Array;return Q.push(this._loader.loadMaterialPropertiesAsync(M,A,O)),Q.push(this._loadDiffuseRoughnessPropertiesAsync(S,z,O)),await Promise.all(Q).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(M,A,O){if(!(O instanceof b.e))throw new Error("".concat(M,": Material type not supported"));const S=new Array;return O.brdf.baseDiffuseModel=qM.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=A.diffuseRoughnessFactor?O.baseDiffuseRoughness=A.diffuseRoughnessFactor:O.baseDiffuseRoughness=0,A.diffuseRoughnessTexture&&S.push(this._loader.loadTextureInfoAsync("".concat(M,"/diffuseRoughnessTexture"),A.diffuseRoughnessTexture,(M=>{M.name="".concat(O.name," (Diffuse Roughness)"),O.baseDiffuseRoughnessTexture=M}))),Promise.all(S).then((()=>{}))}}x(XA),t(XA,!0,(M=>new cA(M)));const jA="KHR_mesh_quantization";class BA{constructor(M){this.name=jA,this.enabled=M.isExtensionUsed(jA)}dispose(){}}x(jA),t(jA,!0,(M=>new BA(M)));const gA="KHR_texture_basisu";class eA{constructor(M){this.name=gA,this._loader=M,this.enabled=M.isExtensionUsed(gA)}dispose(){this._loader=null}_loadTextureAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>{const Q=void 0==A.sampler?n.DefaultSampler:q.Get("".concat(M,"/sampler"),this._loader.Xc.samplers,A.sampler),X=q.Get("".concat(S,"/source"),this._loader.Xc.images,z.source);return await this._loader._createTextureAsync(M,Q,X,(M=>{O(M)}),A._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!A._textureInfo.nonColorData)}))}}x(gA),t(gA,!0,(M=>new eA(M)));const TA="KHR_texture_transform";class JA{constructor(M){this.name=TA,this._loader=M,this.enabled=this._loader.isExtensionUsed(TA)}dispose(){this._loader=null}loadTextureInfoAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(S,z)=>await this._loader.loadTextureInfoAsync(M,A,(M=>{if(!(M instanceof s.c))throw new Error("".concat(S,": Texture type not supported"));z.offset&&(M.uOffset=z.offset[0],M.vOffset=z.offset[1]),M.uRotationCenter=0,M.vRotationCenter=0,z.rotation&&(M.wAng=-z.rotation),z.scale&&(M.uScale=z.scale[0],M.vScale=z.scale[1]),void 0!=z.texCoord&&(M.coordinatesIndex=z.texCoord),O(M)}))))}}x(TA),t(TA,!0,(M=>new JA(M)));const KA="KHR_xmp_json_ld";class GA{constructor(M){this.name=KA,this.order=100,this._loader=M,this.enabled=this._loader.isExtensionUsed(KA)}dispose(){this._loader=null}onLoading(){var M,A,O;if(null===this._loader.rootBabylonMesh)return;const S=null===(M=this._loader.Xc.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld,z=null===(A=this._loader.Xc.asset)||void 0===A||null===(O=A.extensions)||void 0===O?void 0:O.KHR_xmp_json_ld;if(S&&z){const M=+z.packet;S.packets&&M<S.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=S.packets[M])}}}function dA(M,A,O,S){return Q.bA.sA(A,O).scale(S)}function wA(M,A,O,S){return A[O]*S}function IA(M,A,O,S){return-A[O]*S}function bA(M,A,O,S){return A[O+1]*S}function sA(M,A,O,S){return A[O]*S*2}function YA(M){return{scale:[new HA(T.b.ANIMATIONTYPE_FLOAT,"".concat(M,".uScale"),wA,(()=>2)),new HA(T.b.ANIMATIONTYPE_FLOAT,"".concat(M,".vScale"),bA,(()=>2))],offset:[new HA(T.b.ANIMATIONTYPE_FLOAT,"".concat(M,".uOffset"),wA,(()=>2)),new HA(T.b.ANIMATIONTYPE_FLOAT,"".concat(M,".vOffset"),bA,(()=>2))],rotation:[new HA(T.b.ANIMATIONTYPE_FLOAT,"".concat(M,".wAng"),IA,(()=>1))]}}x(KA),t(KA,!0,(M=>new GA(M)));class EA extends a.AnimationPropertyInfo{buildAnimations(M,A,O,S){return[{babylonAnimatable:M._babylonCamera,babylonAnimation:this._buildAnimation(A,O,S)}]}}class HA extends a.AnimationPropertyInfo{buildAnimations(M,A,O,S){const z=[];for(const Q in M._data)z.push({babylonAnimatable:M._data[Q].babylonMaterial,babylonAnimation:this._buildAnimation(A,O,S)});return z}}class CA extends a.AnimationPropertyInfo{buildAnimations(M,A,O,S){return[{babylonAnimatable:M._babylonLight,babylonAnimation:this._buildAnimation(A,O,S)}]}}(0,o.l)("/cameras/{}/orthographic/xmag",[new EA(T.b.ANIMATIONTYPE_FLOAT,"orthoLeft",IA,(()=>1)),new EA(T.b.ANIMATIONTYPE_FLOAT,"orthoRight",bA,(()=>1))]),(0,o.l)("/cameras/{}/orthographic/ymag",[new EA(T.b.ANIMATIONTYPE_FLOAT,"orthoBottom",IA,(()=>1)),new EA(T.b.ANIMATIONTYPE_FLOAT,"orthoTop",bA,(()=>1))]),(0,o.l)("/cameras/{}/orthographic/zfar",[new EA(T.b.ANIMATIONTYPE_FLOAT,"maxZ",wA,(()=>1))]),(0,o.l)("/cameras/{}/orthographic/znear",[new EA(T.b.ANIMATIONTYPE_FLOAT,"Tc",wA,(()=>1))]),(0,o.l)("/cameras/{}/perspective/yfov",[new EA(T.b.ANIMATIONTYPE_FLOAT,"fov",wA,(()=>1))]),(0,o.l)("/cameras/{}/perspective/zfar",[new EA(T.b.ANIMATIONTYPE_FLOAT,"maxZ",wA,(()=>1))]),(0,o.l)("/cameras/{}/perspective/znear",[new EA(T.b.ANIMATIONTYPE_FLOAT,"Tc",wA,(()=>1))]),(0,o.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"albedoColor",dA,(()=>4)),new HA(T.b.ANIMATIONTYPE_FLOAT,"alpha",(function(M,A,O,S){return A[O+3]*S}),(()=>4))]),(0,o.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"metallic",wA,(()=>1))]),(0,o.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"roughness",wA,(()=>1))]);const fA=YA("albedoTexture");(0,o.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",fA.scale),(0,o.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",fA.offset),(0,o.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",fA.rotation);const DA=YA("metallicTexture");(0,o.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",DA.scale),(0,o.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",DA.offset),(0,o.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",DA.rotation),(0,o.l)("/materials/{}/emissiveFactor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"emissiveColor",dA,(()=>3))]);const FA=YA("bumpTexture");(0,o.l)("/materials/{}/normalTexture/scale",[new HA(T.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",wA,(()=>1))]),(0,o.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",FA.scale),(0,o.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",FA.offset),(0,o.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",FA.rotation),(0,o.l)("/materials/{}/occlusionTexture/strength",[new HA(T.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",wA,(()=>1))]);const NA=YA("ambientTexture");(0,o.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",NA.scale),(0,o.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",NA.offset),(0,o.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",NA.rotation);const yA=YA("emissiveTexture");(0,o.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",yA.scale),(0,o.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",yA.offset),(0,o.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",yA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new HA(T.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new HA(T.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",wA,(()=>1))]);const hA=YA("anisotropy.texture");(0,o.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",hA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",hA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",hA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",wA,(()=>1))]);const uA=YA("clearCoat.texture");(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",uA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",uA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",uA.rotation);const iA=YA("clearCoat.bumpTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new HA(T.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",iA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",iA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",iA.rotation);const UA=YA("clearCoat.textureRoughness");(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",UA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",UA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",UA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new HA(T.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new HA(T.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new HA(T.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new HA(T.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",wA,(()=>1))]);const LA=YA("iridescence.texture");(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",LA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",LA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",LA.rotation);const tA=YA("iridescence.thicknessTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",tA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",tA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",tA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"sheen.color",dA,(()=>3))]),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",wA,(()=>1))]);const xA=YA("sheen.texture");(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",xA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",xA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",xA.rotation);const oA=YA("sheen.textureRoughness");(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",oA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",oA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",oA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",dA,(()=>3))]);const pA=YA("metallicReflectanceTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",pA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",pA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",pA.rotation);const vA=YA("reflectanceTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",vA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",vA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",vA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",wA,(()=>1))]);const qA=YA("subSurface.refractionIntensityTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",qA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",qA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",qA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",dA,(()=>3))]),(0,o.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new HA(T.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",wA,(()=>1))]),(0,o.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",wA,(()=>1))]);const rA=YA("subSurface.thicknessTexture");(0,o.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",rA.scale),(0,o.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",rA.offset),(0,o.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",rA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new HA(T.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",wA,(()=>1))]);const nA=YA("subSurface.translucencyIntensityTexture");(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",nA.scale),(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",nA.offset),(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",nA.rotation),(0,o.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new HA(T.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",dA,(()=>3))]);const aA=YA("subSurface.translucencyColorTexture");(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",aA.scale),(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",aA.offset),(0,o.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",aA.rotation),(0,o.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new CA(T.b.ANIMATIONTYPE_COLOR3,"diffuse",dA,(()=>3))]),(0,o.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new CA(T.b.ANIMATIONTYPE_FLOAT,"intensity",wA,(()=>1))]),(0,o.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new CA(T.b.ANIMATIONTYPE_FLOAT,"range",wA,(()=>1))]),(0,o.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new CA(T.b.ANIMATIONTYPE_FLOAT,"innerAngle",sA,(()=>1))]),(0,o.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new CA(T.b.ANIMATIONTYPE_FLOAT,"angle",sA,(()=>1))]),(0,o.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new CA(T.b.ANIMATIONTYPE_COLOR3,"diffuse",dA,(()=>3))]),(0,o.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new CA(T.b.ANIMATIONTYPE_FLOAT,"intensity",wA,(()=>1))]);const VA="KHR_animation_pointer";class ZA{constructor(M){this.name=VA,this._loader=M,this._pathToObjectConverter=(0,o.i)(this._loader.Xc)}get enabled(){return this._loader.isExtensionUsed(VA)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(M,A,O,S,z){var Q;const X=null===(Q=S.target.extensions)||void 0===Q?void 0:Q.KHR_animation_pointer;if(!X||!this._pathToObjectConverter)return null;"pointer"!==S.target.path&&G.c.Warn("".concat(M,"/target/path: Value (").concat(S.target.path,") must be (","pointer",") when using the ").concat(this.name," extension")),void 0!=S.target.node&&G.c.Warn("".concat(M,"/target/node: Value (").concat(S.target.node,") must not be present when using the ").concat(this.name," extension"));const c="".concat(M,"/extensions/").concat(this.name),j=X.pointer;if(!j)throw new Error("".concat(c,": Pointer is missing"));try{const Q=this._pathToObjectConverter.convert(j);if(!Q.info.interpolation)throw new Error("".concat(c,"/pointer: Interpolation is missing"));return this._loader._loadAnimationChannelFromTargetInfoAsync(M,A,O,S,{object:Q.object,info:Q.info.interpolation},z)}catch(B){return G.c.Warn("".concat(c,"/pointer: Invalid pointer (").concat(j,") skipped")),null}}}x(VA),t(VA,!0,(M=>new ZA(M)));class PA{constructor(M,A,O){this.frame=M,this.action=A,this.onlyOnce=O,this.isDone=!1}_clone(){return new PA(this.frame,this.action,this.onlyOnce)}}var mO=O(12799),RA=O(12852),kA=O(12848);class WA{get loop(){return this._loop}set loop(M){M!==this._loop&&(this._loop=M,this.updateOptions({loop:M}))}get currentTime(){var M;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(M=RA.e.audioEngine)&&void 0!==M&&M.audioContext&&(this.isPlaying||this.isPaused)){const M=this.isPaused?0:RA.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+M}return 0}get spatialSound(){return this._spatialSound}set spatialSound(M){if(M==this._spatialSound)return;const A=this.isPlaying;this.pause(),M?(this._spatialSound=M,this._updateSpatialParameters()):this._disableSpatialSound(),A&&this.play()}constructor(M,A,O){var S;let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new g.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=z.GA.Zero(),this._localDirection=new z.GA(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=M,O=O||K.d.LastCreatedScene){var j,B,e,T;if(this._scene=O,WA._SceneComponentInitialization(O),this._readyToPlayCallback=Q,this._customAttenuationFunction=(M,A,O,S,z)=>A<O?M*(1-A/O):0,c)this.autoplay=c.autoplay||!1,this._loop=c.loop||!1,void 0!==c.volume&&(this._volume=c.volume),this._spatialSound=null!==(j=c.spatialSound)&&void 0!==j&&j,this.maxDistance=null!==(B=c.maxDistance)&&void 0!==B?B:100,this.useCustomAttenuation=null!==(e=c.useCustomAttenuation)&&void 0!==e&&e,this.rolloffFactor=c.rolloffFactor||1,this.refDistance=c.refDistance||1,this.distanceModel=c.distanceModel||"linear",this._playbackRate=c.playbackRate||1,this._streaming=null!==(T=c.streaming)&&void 0!==T&&T,this._length=c.length,this._offset=c.offset;if(null!==(S=RA.e.audioEngine)&&void 0!==S&&S.canUseWebAudio&&RA.e.audioEngine.audioContext){this._soundGain=RA.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let M=!0;if(A)try{"string"===typeof A?(this._urlType="String",this._url=A):A instanceof ArrayBuffer?this._urlType="ArrayBuffer":A instanceof HTMLMediaElement?this._urlType="MediaElement":A instanceof MediaStream?this._urlType="MediaStream":A instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(A)&&(this._urlType="Array");let O=[],S=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RA.e.audioEngine.audioContext.createMediaElementSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RA.e.audioEngine.audioContext.createMediaStreamSource(A),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":A.byteLength>0&&(S=!0,this._soundLoaded(A));break;case"AudioBuffer":this._audioBufferLoaded(A);break;case"String":O.push(A);case"Array":0===O.length&&(O=A);for(let M=0;M<O.length;M++){const A=O[M];if(S=c&&c.skipCodecCheck||-1!==A.indexOf(".mp3",A.length-4)&&RA.e.audioEngine.isMP3supported||-1!==A.indexOf(".ogg",A.length-4)&&RA.e.audioEngine.isOGGsupported||-1!==A.indexOf(".wav",A.length-4)||-1!==A.indexOf(".m4a",A.length-4)||-1!==A.indexOf(".mp4",A.length-4)||-1!==A.indexOf("blob:"),S){this._streaming?(this._htmlAudioElement=new Audio(A),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,X.Tools.SetCorsBehavior(A,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(A,(M=>{this._soundLoaded(M)}),void 0,!0,!0,(M=>{M&&G.c.Error("XHR "+M.status+" error on: "+A+"."),G.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:M=!1}M?S||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):G.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){G.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),RA.e.audioEngine&&!RA.e.audioEngine.WarnedWebAudioUnsupported&&(G.c.Error("Web Audio is not supported by your browser."),RA.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}}dispose(){var M;null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(M){var A;null!==(A=RA.e.audioEngine)&&void 0!==A&&A.audioContext&&(this._audioBuffer=M,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(M){var A;null!==(A=RA.e.audioEngine)&&void 0!==A&&A.audioContext&&RA.e.audioEngine.audioContext.decodeAudioData(M,(M=>{this._audioBufferLoaded(M)}),(M=>{G.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+M)}))}setAudioBuffer(M){var A;null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&(this._audioBuffer=M,this._isReadyToPlay=!0)}updateOptions(M){var A,O,S,z,Q,X,c,j,B,g,e;M&&(this.loop=null!==(A=M.loop)&&void 0!==A?A:this.loop,this.maxDistance=null!==(O=M.maxDistance)&&void 0!==O?O:this.maxDistance,this.useCustomAttenuation=null!==(S=M.useCustomAttenuation)&&void 0!==S?S:this.useCustomAttenuation,this.rolloffFactor=null!==(z=M.rolloffFactor)&&void 0!==z?z:this.rolloffFactor,this.refDistance=null!==(Q=M.refDistance)&&void 0!==Q?Q:this.refDistance,this.distanceModel=null!==(X=M.distanceModel)&&void 0!==X?X:this.distanceModel,this._playbackRate=null!==(c=M.playbackRate)&&void 0!==c?c:this._playbackRate,this._length=null!==(j=M.length)&&void 0!==j?j:void 0,this.spatialSound=null!==(B=M.spatialSound)&&void 0!==B?B:this._spatialSound,this._setOffset(null!==(g=M.offset)&&void 0!==g?g:void 0),this.setVolume(null!==(e=M.volume)&&void 0!==e?e:this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var M,A;null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&RA.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=null!==(A=this._soundPanner)&&void 0!==A?A:RA.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var M;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(M=this._soundPanner)||void 0===M||M.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var M;null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(M){var A;null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(M),this._isOutputConnected=!0)}setDirectionalCone(M,A,O){A<M?G.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=M,this._coneOuterAngle=A,this._coneOuterGain=O,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!=this._coneInnerAngle){var A;if(this._coneOuterAngle<M)return void G.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M,null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!=this._coneOuterAngle){var A;if(M<this._coneInnerAngle)return void G.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M,null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(M){var A;M.equals(this._position)||(this._position.S(M),null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(M){var A;this._localDirection=M,null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const M=this._connectedTransformNode.getWorldMatrix(),A=z.GA.TransformNormal(this._localDirection,M);A.normalize(),this._soundPanner.orientationX.value=A.x,this._soundPanner.orientationY.value=A.y,this._soundPanner.orientationZ.value=A.z}updateDistanceFromListener(){var M;if(null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const M=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.dA(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,M,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(M){this._customAttenuationFunction=M}play(M,A,O){var S;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(S=RA.e.audioEngine)&&void 0!==S&&S.audioContext)try{var z,Q;this._clearTimeoutsAndObservers();let S=M?(null===(z=RA.e.audioEngine)||void 0===z?void 0:z.audioContext.currentTime)+M:null===(Q=RA.e.audioEngine)||void 0===Q?void 0:Q.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=RA.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const M=()=>{var O;if(null!==(O=RA.e.audioEngine)&&void 0!==O&&O.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=null!==A&&void 0!==A?A:0;const O=this._htmlAudioElement.play();void 0!==O&&O.catch((()=>{var A,O;(null===(A=RA.e.audioEngine)||void 0===A||A.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(O=RA.e.audioEngine)||void 0===O?void 0:O.onAudioUnlockedObservable.addOnce((()=>{M()})))}))}else{var S;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(S=RA.e.audioEngine)||void 0===S?void 0:S.onAudioUnlockedObservable.addOnce((()=>{M()}))}};M()}}else{var X;const z=()=>{var z;if(null!==(z=RA.e.audioEngine)&&void 0!==z&&z.audioContext){var Q;if(O=O||this._length,void 0!==A&&this._setOffset(A),this._soundSource){const M=this._soundSource;M.onended=()=>{M.disconnect()}}if(this._soundSource=null===(Q=RA.e.audioEngine)||void 0===Q?void 0:Q.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var X,c;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==A&&(this._soundSource.loopStart=A),void 0!==O&&(this._soundSource.loopEnd=(0|A)+O),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},S=M?(null===(X=RA.e.audioEngine)||void 0===X?void 0:X.audioContext.currentTime)+M:RA.e.audioEngine.audioContext.currentTime;const z=((this.isPaused?this.currentTime:0)+(null!==(c=this._offset)&&void 0!==c?c:0))%this._soundSource.buffer.duration;this._soundSource.start(S,z,this.loop?void 0:O)}}};"suspended"===(null===(X=RA.e.audioEngine)||void 0===X?void 0:X.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var M;"suspended"===(null===(M=RA.e.audioEngine)||void 0===M?void 0:M.audioContext.state)?(RA.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=RA.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{z()})))):z()}),500):z()}this._startTime=S,this.isPlaying=!0,this.isPaused=!1}catch(c){G.c.Error("Error while trying to play audio: "+this.name+", "+c.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(M){var A;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var O;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(O=this._streamingSource)||void 0===O||O.disconnect();this.isPlaying=!1}else if(null!==(A=RA.e.audioEngine)&&void 0!==A&&A.audioContext&&this._soundSource){const A=M?RA.e.audioEngine.audioContext.currentTime+M:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(A)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var M;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(M=RA.e.audioEngine)&&void 0!==M&&M.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=RA.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(M,A){var O;null!==(O=RA.e.audioEngine)&&void 0!==O&&O.canUseWebAudio&&this._soundGain&&(A&&RA.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(RA.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,RA.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(M,RA.e.audioEngine.audioContext.currentTime+A)):this._soundGain.gain.value=M),this._volume=M}setPlaybackRate(M){this._playbackRate=M,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(M){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=M,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=M=>this._onRegisterAfterWorldMatrixUpdate(M),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(M){var A;if(M.getBoundingInfo){const A=M.getBoundingInfo();this.setPosition(A.boundingSphere.centerWorld)}else this.setPosition(M.absolutePosition);null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const M=()=>{(0,kA.c)((()=>this._isReadyToPlay),(()=>{O._audioBuffer=this.getAudioBuffer(),O._isReadyToPlay=!0,O.autoplay&&O.play(0,this._offset,this._length)}),void 0,300)},A={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},O=new WA(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,A);return this.useCustomAttenuation&&O.setAttenuationFunction(this._customAttenuationFunction),O.setPosition(this._position),O.setPlaybackRate(this._playbackRate),M(),O}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const M={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(M.connectedMeshId=this._connectedTransformNode.id),M.position=this._position.gc(),M.refDistance=this.refDistance,M.distanceModel=this.distanceModel,M.isDirectional=this._isDirectional,M.localDirectionToMesh=this._localDirection.gc(),M.coneInnerAngle=this._coneInnerAngle,M.coneOuterAngle=this._coneOuterAngle,M.coneOuterGain=this._coneOuterGain),M}static Parse(M,A,O,S){const Q=M.name;let X;X=M.url?O+M.url:O+Q;const c={autoplay:M.autoplay,loop:M.loop,volume:M.volume,spatialSound:M.spatialSound,maxDistance:M.maxDistance,rolloffFactor:M.rolloffFactor,refDistance:M.refDistance,distanceModel:M.distanceModel,playbackRate:M.playbackRate};let j;if(S){const M=()=>{(0,kA.c)((()=>S._isReadyToPlay),(()=>{j._audioBuffer=S.getAudioBuffer(),j._isReadyToPlay=!0,j.autoplay&&j.play(0,j._offset,j._length)}),void 0,300)};j=new WA(Q,new ArrayBuffer(0),A,null,c),M()}else j=new WA(Q,X,A,(()=>{A.removePendingData(j)}),c),A.addPendingData(j);if(M.position){const A=z.GA.sA(M.position);j.setPosition(A)}if(M.isDirectional&&(j.setDirectionalCone(M.coneInnerAngle||360,M.coneOuterAngle||360,M.coneOuterGain||0),M.localDirectionToMesh)){const A=z.GA.sA(M.localDirectionToMesh);j.setLocalDirectionToMesh(A)}if(M.connectedMeshId){const O=A.getMeshById(M.connectedMeshId);O&&j.attachToMesh(O)}return M.metadata&&(j.metadata=M.metadata),j}_setOffset(M){this._offset!==M&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=M)}_clearTimeoutsAndObservers(){var M;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(M=RA.e.audioEngine)||void 0===M||M.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}WA._SceneComponentInitialization=M=>{throw(0,mO.d)("AudioSceneComponent")},(0,EM.g)("BABYLON.Sound",WA);class lA{constructor(M,A,O){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],A.length!==O.length)throw new Error("Sounds length does not equal weights length");this.loop=M,this._weights=O;let S=0;for(const Q of O)S+=Q;const z=S>0?1/S:0;for(let Q=0;Q<this._weights.length;Q++)this._weights[Q]*=z;this._sounds=A;for(const Q of this._sounds)Q.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(M){if(M!==this._coneInnerAngle){if(this._coneOuterAngle<M)return void G.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=M;for(const A of this._sounds)A.directionalConeInnerAngle=M}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(M){if(M!==this._coneOuterAngle){if(M<this._coneInnerAngle)return void G.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=M;for(const A of this._sounds)A.directionalConeOuterAngle=M}}get volume(){return this._volume}set volume(M){if(M!==this._volume)for(const A of this._sounds)A.setVolume(M)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(M){var A;if(!this.isPaused){this.stop();const M=Math.random();let A=0;for(let O=0;O<this._weights.length;O++)if(A+=this._weights[O],M<=A){this._currentIndex=O;break}}const O=this._sounds[null!==(A=this._currentIndex)&&void 0!==A?A:0];O.isReady()?O.play(0,this.isPaused?void 0:M):O.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class MO{constructor(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(M=M||K.d.LastCreatedScene)&&(this._scene=M,this.soundCollection=[],this._options=A,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var M;null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&RA.e.audioEngine.audioContext&&(this._outputAudioNode=RA.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(RA.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(RA.e.audioEngine&&RA.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(M){var A;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&M.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==M.soundTrackId&&(-1===M.soundTrackId?this._scene.mainSoundTrack.removeSound(M):this._scene.soundTracks&&this._scene.soundTracks[M.soundTrackId].removeSound(M)),this.soundCollection.push(M),M.soundTrackId=this.id}removeSound(M){const A=this.soundCollection.indexOf(M);-1!==A&&this.soundCollection.splice(A,1)}setVolume(M){var A;null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=M)}switchPanningModelToHRTF(){var M;if(null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var M;if(null!==(M=RA.e.audioEngine)&&void 0!==M&&M.canUseWebAudio)for(let A=0;A<this.soundCollection.length;A++)this.soundCollection[A].switchPanningModelToEqualPower()}connectToAnalyser(M){var A;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=M,null!==(A=RA.e.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,RA.e.audioEngine.masterGain))}}var AO=O(13241),OO=O(13214),SO=O(12778);RA.e.AudioEngineFactory=(M,A,O)=>new zO(M,A,O);class zO{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new g.c,this.onAudioLockedObservable=new g.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,SO.m)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const S=document.createElement("audio");this._hostElement=M,this._audioContext=A,this._audioDestination=O;try{S&&S.canPlayType&&(S.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||S.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(z){}try{S&&S.canPlayType&&S.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(z){}}lock(){this._triggerSuspendedState()}unlock(){var M,A;if("running"===(null===(M=this._audioContext)||void 0===M?void 0:M.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(A=this._audioContext)||void 0===A||A.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{G.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var M;null===(M=this._audioContext)||void 0===M||M.addEventListener("statechange",(()=>{var M;this.unlocked&&"running"!==(null===(M=this._audioContext)||void 0===M?void 0:M.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var M;return null!==(M=this._audioContext)&&void 0!==M&&M.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(M){this.canUseWebAudio=!1,G.c.Error("Web Audio: "+M.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(M){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const M=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",A=document.createElement("style");A.appendChild(document.createTextNode(M)),document.getElementsByTagName("head")[0].appendChild(A),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var M;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(M=this._audioContext)||void 0===M||M.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(M){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=M)}connectToAnalyser(M){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=M,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var QO=O(12793);(0,O(13936).f)(AO.b.NAME_AUDIO,((M,A,O,S)=>{let z,Q=[];if(O.ZJ=O.ZJ||[],void 0!==M.ZJ&&null!==M.ZJ)for(let c=0,j=M.ZJ.length;c<j;c++){var X;const j=M.ZJ[c];null!==(X=RA.e.audioEngine)&&void 0!==X&&X.canUseWebAudio?(j.url||(j.url=j.name),Q[j.url]?O.ZJ.push(WA.Parse(j,A,S,Q[j.url])):(z=WA.Parse(j,A,S),Q[j.url]=z,O.ZJ.push(z))):O.ZJ.push(new WA(j.name,null,A))}Q=[]})),Object.defineProperty(OO.b.prototype,"mainSoundTrack",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),this._mainSoundTrack||(this._mainSoundTrack=new MO(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),OO.b.prototype.getSoundByName=function(M){let A;for(A=0;A<this.mainSoundTrack.soundCollection.length;A++)if(this.mainSoundTrack.soundCollection[A].name===M)return this.mainSoundTrack.soundCollection[A];if(this.soundTracks)for(let O=0;O<this.soundTracks.length;O++)for(A=0;A<this.soundTracks[O].soundCollection.length;A++)if(this.soundTracks[O].soundCollection[A].name===M)return this.soundTracks[O].soundCollection[A];return null},Object.defineProperty(OO.b.prototype,"audioEnabled",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),M.audioEnabled},set:function(M){let A=this._getComponent(AO.b.NAME_AUDIO);A||(A=new XO(this),this.o(A)),M?A.enableAudio():A.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(OO.b.prototype,"headphone",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),M.headphone},set:function(M){let A=this._getComponent(AO.b.NAME_AUDIO);A||(A=new XO(this),this.o(A)),M?A.switchAudioModeForHeadphones():A.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(OO.b.prototype,"audioListenerPositionProvider",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),M.audioListenerPositionProvider},set:function(M){let A=this._getComponent(AO.b.NAME_AUDIO);if(A||(A=new XO(this),this.o(A)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");A.audioListenerPositionProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(OO.b.prototype,"audioListenerRotationProvider",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),M.audioListenerRotationProvider},set:function(M){let A=this._getComponent(AO.b.NAME_AUDIO);if(A||(A=new XO(this),this.o(A)),M&&"function"!==typeof M)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");A.audioListenerRotationProvider=M},enumerable:!0,configurable:!0}),Object.defineProperty(OO.b.prototype,"audioPositioningRefreshRate",{get:function(){let M=this._getComponent(AO.b.NAME_AUDIO);return M||(M=new XO(this),this.o(M)),M.audioPositioningRefreshRate},set:function(M){let A=this._getComponent(AO.b.NAME_AUDIO);A||(A=new XO(this),this.o(A)),A.audioPositioningRefreshRate=M},enumerable:!0,configurable:!0});class XO{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(M){this.name=AO.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new z.GA,this._cachedCameraPosition=new z.GA,this._lastCheck=0,this._invertMatrixTemp=new z.Matrix,this._cameraDirectionTemp=new z.GA,(M=M||K.d.LastCreatedScene)&&(this.wA=M,M.soundTracks=[],M.ZJ=[])}register(){this.wA._afterRenderStage.registerStep(AO.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(M){if(M.ZJ=[],this.wA.soundTracks)for(let A=0;A<this.wA.soundTracks.length;A++){const O=this.wA.soundTracks[A];for(let A=0;A<O.soundCollection.length;A++)M.ZJ.push(O.soundCollection[A].serialize())}}addFromContainer(M){if(M.ZJ)for(const A of M.ZJ)A.play(),A.autoplay=!0,this.wA.mainSoundTrack.addSound(A)}removeFromContainer(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(M.ZJ)for(const O of M.ZJ)O.stop(),O.autoplay=!1,this.wA.mainSoundTrack.removeSound(O),A&&O.dispose()}dispose(){const M=this.wA;if(M._mainSoundTrack&&M.mainSoundTrack.dispose(),M.soundTracks)for(let A=0;A<M.soundTracks.length;A++)M.soundTracks[A].dispose()}disableAudio(){const M=this.wA;let A;for(this._audioEnabled=!1,RA.e.audioEngine&&RA.e.audioEngine.audioContext&&RA.e.audioEngine.audioContext.suspend(),A=0;A<M.mainSoundTrack.soundCollection.length;A++)M.mainSoundTrack.soundCollection[A].pause();if(M.soundTracks)for(A=0;A<M.soundTracks.length;A++)for(let O=0;O<M.soundTracks[A].soundCollection.length;O++)M.soundTracks[A].soundCollection[O].pause()}enableAudio(){const M=this.wA;let A;for(this._audioEnabled=!0,RA.e.audioEngine&&RA.e.audioEngine.audioContext&&RA.e.audioEngine.audioContext.resume(),A=0;A<M.mainSoundTrack.soundCollection.length;A++)M.mainSoundTrack.soundCollection[A].isPaused&&M.mainSoundTrack.soundCollection[A].play();if(M.soundTracks)for(A=0;A<M.soundTracks.length;A++)for(let O=0;O<M.soundTracks[A].soundCollection.length;O++)M.soundTracks[A].soundCollection[O].isPaused&&M.soundTracks[A].soundCollection[O].play()}switchAudioModeForHeadphones(){const M=this.wA;if(this._headphone=!0,M.mainSoundTrack.switchPanningModelToHRTF(),M.soundTracks)for(let A=0;A<M.soundTracks.length;A++)M.soundTracks[A].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const M=this.wA;if(this._headphone=!1,M.mainSoundTrack.switchPanningModelToEqualPower(),M.soundTracks)for(let A=0;A<M.soundTracks.length;A++)M.soundTracks[A].switchPanningModelToEqualPower()}_afterRender(){const M=QO.d.Now;if(this._lastCheck&&M-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=M;const A=this.wA;if(!this._audioEnabled||!A._mainSoundTrack||!A.soundTracks||0===A._mainSoundTrack.soundCollection.length&&1===A.soundTracks.length)return;const O=RA.e.audioEngine;if(O&&O.audioContext){let M,S=A.activeCamera;if(A.activeCameras&&A.activeCameras.length>0&&(S=A.activeCameras[0]),this.audioListenerPositionProvider){const M=this.audioListenerPositionProvider();O.audioContext.listener.setPosition(M.x||0,M.y||0,M.z||0)}else S?this._cachedCameraPosition.equals(S.globalPosition)||(this._cachedCameraPosition.S(S.globalPosition),O.audioContext.listener.setPosition(S.globalPosition.x,S.globalPosition.y,S.globalPosition.z)):O.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const M=this.audioListenerRotationProvider();O.audioContext.listener.setOrientation(M.x||0,M.y||0,M.z||0,0,1,0)}else S?(S.rigCameras&&S.rigCameras.length>0&&(S=S.rigCameras[0]),S.getViewMatrix().invertToRef(this._invertMatrixTemp),z.GA.TransformNormalToRef(XO._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.S(this._cameraDirectionTemp),O.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):O.audioContext.listener.setOrientation(0,0,0,0,1,0);for(M=0;M<A.mainSoundTrack.soundCollection.length;M++){const O=A.mainSoundTrack.soundCollection[M];O.useCustomAttenuation&&O.updateDistanceFromListener()}if(A.soundTracks)for(M=0;M<A.soundTracks.length;M++)for(let O=0;O<A.soundTracks[M].soundCollection.length;O++){const S=A.soundTracks[M].soundCollection[O];S.useCustomAttenuation&&S.updateDistanceFromListener()}}}}XO._CameraDirection=new z.GA(0,0,-1),WA._SceneComponentInitialization=M=>{let A=M._getComponent(AO.b.NAME_AUDIO);A||(A=new XO(M),M.o(A))};const cO="MSFT_audio_emitter";class jO{constructor(M){this.name=cO,this._loader=M,this.enabled=this._loader.isExtensionUsed(cO)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const M=this._loader.Xc.extensions;if(M&&M[this.name]){const A=M[this.name];this._clips=A.clips,this._emitters=A.emitters,q.Assign(this._clips),q.Assign(this._emitters)}}loadSceneAsync(M,A){return n.LoadExtensionAsync(M,A,this.name,(async(O,S)=>{const z=new Array;z.push(this._loader.loadSceneAsync(M,A));for(const M of S.emitters){const A=q.Get("".concat(O,"/emitters"),this._emitters,M);if(void 0!=A.refDistance||void 0!=A.maxDistance||void 0!=A.rolloffFactor||void 0!=A.distanceModel||void 0!=A.innerAngle||void 0!=A.outerAngle)throw new Error("".concat(O,": Direction or Distance properties are not allowed on emitters attached to a scene"));z.push(this._loadEmitterAsync("".concat(O,"/emitters/").concat(A.index),A))}await Promise.all(z)}))}loadNodeAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(M,S)=>{const Q=new Array,c=await this._loader.loadNodeAsync(M,A,(A=>{for(const O of S.emitters){const S=q.Get("".concat(M,"/emitters"),this._emitters,O);Q.push(this._loadEmitterAsync("".concat(M,"/emitters/").concat(S.index),S).then((()=>{for(const M of S._babylonSounds)M.attachToMesh(A),void 0==S.innerAngle&&void 0==S.outerAngle||(M.setLocalDirectionToMesh(z.GA.Forward()),M.setDirectionalCone(2*X.Tools.ToDegrees(void 0==S.innerAngle?Math.PI:S.innerAngle),2*X.Tools.ToDegrees(void 0==S.outerAngle?Math.PI:S.outerAngle),0))})))}O(A)}));return await Promise.all(Q),c}))}loadAnimationAsync(M,A){return n.LoadExtensionAsync(M,A,this.name,(async(O,S)=>{const z=await this._loader.loadAnimationAsync(M,A),Q=new Array;q.Assign(S.events);for(const X of S.events)Q.push(this._loadAnimationEventAsync("".concat(O,"/events/").concat(X.index),M,A,X,z));return await Promise.all(Q),z}))}_loadClipAsync(M,A){if(A._objectURL)return A._objectURL;let O;if(A.uri)O=this._loader.loadUriAsync(M,A,A.uri);else{const S=q.Get("".concat(M,"/bufferView"),this._loader.Xc.bufferViews,A.bufferView);O=this._loader.loadBufferViewAsync("/bufferViews/".concat(S.index),S)}return A._objectURL=O.then((M=>URL.createObjectURL(new Blob([M],{type:A.mimeType})))),A._objectURL}_loadEmitterAsync(M,A){if(A._babylonSounds=A._babylonSounds||[],!A._babylonData){const M=new Array,O=A.name||"SA".concat(A.index),S={loop:!1,autoplay:!1,volume:void 0==A.volume?1:A.volume};for(let Q=0;Q<A.clips.length;Q++){const z="/extensions/".concat(this.name,"/clips"),X=q.Get(z,this._clips,A.clips[Q].clip);M.push(this._loadClipAsync("".concat(z,"/").concat(A.clips[Q].clip),X).then((M=>{const z=A._babylonSounds[Q]=new WA(O,M,this._loader.babylonScene,null,S);z.refDistance=A.refDistance||1,z.maxDistance=A.maxDistance||256,z.rolloffFactor=A.rolloffFactor||1,z.distanceModel=A.distanceModel||"exponential"})))}const z=Promise.all(M).then((()=>{const M=A.clips.map((M=>M.weight||1)),O=new lA(A.loop||!1,A._babylonSounds,M);A.innerAngle&&(O.directionalConeInnerAngle=2*X.Tools.ToDegrees(A.innerAngle)),A.outerAngle&&(O.directionalConeOuterAngle=2*X.Tools.ToDegrees(A.outerAngle)),A.volume&&(O.volume=A.volume),A._babylonData.sound=O}));A._babylonData={loaded:z}}return A._babylonData.loaded}_getEventAction(M,A,O,S,z){switch(O){case"play":return M=>{const O=(z||0)+(M-S);A.play(O)};case"stop":return()=>{A.stop()};case"pause":return()=>{A.pause()};default:throw new Error("".concat(M,": Unsupported action ").concat(O))}}_loadAnimationEventAsync(M,A,O,S,z){if(0==z.targetedAnimations.length)return Promise.resolve();const Q=z.targetedAnimations[0],X=S.SA,c=q.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,X);return this._loadEmitterAsync(M,c).then((()=>{const A=c._babylonData.sound;if(A){const O=new PA(S.time,this._getEventAction(M,A,S.action,S.time,S.startOffset));Q.animation.addEvent(O),z.onAnimationGroupEndObservable.add((()=>{A.stop()})),z.onAnimationGroupPauseObservable.add((()=>{A.pause()}))}}))}}x(cO),t(cO,!0,(M=>new jO(M)));const BO="MSFT_lod";class gO{constructor(M){var A,O;this.name=BO,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new g.c,this.onMaterialLODsLoadedObservable=new g.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=M,this.maxLODsToLoad=null!==(A=null===(O=this._loader.parent.extensionOptions[BO])||void 0===O?void 0:O.maxLODsToLoad)&&void 0!==A?A:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(BO)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let M=0;M<this._nodePromiseLODs.length;M++){const A=Promise.all(this._nodePromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter("Node LOD ".concat(M)),this._loader.log("Loaded node LOD ".concat(M))),this.onNodeLODsLoadedObservable.notifyObservers(M),M!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter("Node LOD ".concat(M+1)),this._loadBufferLOD(this._nodeBufferLODs,M+1),this._nodeSignalLODs[M]&&this._nodeSignalLODs[M].resolve())}));this._loader._completePromises.push(A)}for(let M=0;M<this._materialPromiseLODs.length;M++){const A=Promise.all(this._materialPromiseLODs[M]).then((()=>{0!==M&&(this._loader.endPerformanceCounter("Material LOD ".concat(M)),this._loader.log("Loaded material LOD ".concat(M))),this.onMaterialLODsLoadedObservable.notifyObservers(M),M!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter("Material LOD ".concat(M+1)),this._loadBufferLOD(this._materialBufferLODs,M+1),this._materialSignalLODs[M]&&this._materialSignalLODs[M].resolve())}));this._loader._completePromises.push(A)}}loadSceneAsync(M,A){const O=this._loader.loadSceneAsync(M,A);return this._loadBufferLOD(this._bufferLODs,0),O}loadNodeAsync(M,A,O){return n.LoadExtensionAsync(M,A,this.name,(async(M,z)=>{let Q;const X=this._getLODs(M,A,this._loader.Xc.nodes,z.ids);this._loader.logOpen("".concat(M));for(let A=0;A<X.length;A++){const M=X[A];0!==A&&(this._nodeIndexLOD=A,this._nodeSignalLODs[A]=this._nodeSignalLODs[A]||new S);const z=M=>{O(M),M.yj(!1)},c=this._loader.loadNodeAsync("/nodes/".concat(M.index),M,z).then((M=>{if(0!==A){const M=X[A-1];M._babylonTransformNode&&(this._disposeTransformNode(M._babylonTransformNode),delete M._babylonTransformNode)}return M.yj(!0),M}));this._nodePromiseLODs[A]=this._nodePromiseLODs[A]||[],0===A?Q=c:(this._nodeIndexLOD=null,this._nodePromiseLODs[A].push(c))}return this._loader.logClose(),await Q}))}_loadMaterialAsync(M,A,O,S,z){return this._nodeIndexLOD?null:n.LoadExtensionAsync(M,A,this.name,(async(M,Q)=>{let X;const c=this._getLODs(M,A,this._loader.Xc.materials,Q.ids);this._loader.logOpen("".concat(M));for(let A=0;A<c.length;A++){const M=c[A];0!==A&&(this._materialIndexLOD=A);const Q=this._loader._loadMaterialAsync("/materials/".concat(M.index),M,O,S,(M=>{0===A&&z(M)})).then((M=>{if(0!==A){z(M);const O=c[A-1]._data;O[S]&&(this._disposeMaterials([O[S].babylonMaterial]),delete O[S])}return M}));this._materialPromiseLODs[A]=this._materialPromiseLODs[A]||[],0===A?X=Q:(this._materialIndexLOD=null,this._materialPromiseLODs[A].push(Q))}return this._loader.logClose(),await X}))}_loadUriAsync(M,A,O){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const z=this._nodeIndexLOD-1;return this._nodeSignalLODs[z]=this._nodeSignalLODs[z]||new S,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(M,A,O)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const z=this._materialIndexLOD-1;return this._materialSignalLODs[z]=this._materialSignalLODs[z]||new S,this._materialSignalLODs[z].promise.then((async()=>await this._loader.loadUriAsync(M,A,O)))}return null}loadBufferAsync(M,A,O,z){if(this._loader.parent.useRangeRequests&&!A.uri){if(!this._loader.bin)throw new Error("".concat(M,": Uri is missing or the binary glTF is missing its binary chunk"));const A=async(M,A)=>{const Q=O,X=Q+z-1;let c=M[A];return c?(c.start=Math.min(c.start,Q),c.end=Math.max(c.end,X)):(c={start:Q,end:X,loaded:new S},M[A]=c),await c.loaded.promise.then((M=>new Uint8Array(M.buffer,M.byteOffset+O-c.start,z)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?A(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?A(this._materialBufferLODs,this._materialIndexLOD):A(this._bufferLODs,0)}return null}_loadBufferLOD(M,A){const O=M[A];O&&(this._loader.log("Loading buffer range [".concat(O.start,"-").concat(O.end,"]")),this._loader.bin.readAsync(O.start,O.end-O.start+1).then((M=>{O.loaded.resolve(M)}),(M=>{O.loaded.reject(M)})))}_getLODs(M,A,O,S){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const z=[];for(let Q=S.length-1;Q>=0;Q--)if(z.push(q.Get("".concat(M,"/ids/").concat(S[Q]),O,S[Q])),z.length===this.maxLODsToLoad)return z;return z.push(A),z}_disposeTransformNode(M){const A=[],O=M.material;O&&A.push(O);for(const z of M.getChildMeshes())z.material&&A.push(z.material);M.dispose();const S=A.filter((M=>this._loader.babylonScene.meshes.every((A=>A.material!=M))));this._disposeMaterials(S)}_disposeMaterials(M){const A={};for(const O of M){for(const M of O.getActiveTextures())A[M.uniqueId]=M;O.dispose()}for(const O in A)for(const M of this._loader.babylonScene.materials)M.hasTexture(A[O])&&delete A[O];for(const O in A)A[O].dispose()}}x(BO),t(BO,!0,(M=>new gO(M)));const eO="MSFT_minecraftMesh";class TO{constructor(M){this.name=eO,this._loader=M,this.enabled=this._loader.isExtensionUsed(eO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtraAsync(M,A,this.name,(async(S,z)=>{if(z){if(!(O instanceof b.e))throw new Error("".concat(S,": Material type not supported"));const z=this._loader.loadMaterialPropertiesAsync(M,A,O);return O.needAlphaBlending()&&(O.forceDepthWrite=!0,O.separateCullingPass=!0),O.bc=O.forceDepthWrite,O.twoSidedLighting=!0,await z}}))}}x(eO),t(eO,!0,(M=>new TO(M)));const JO="MSFT_sRGBFactors";class KO{constructor(M){this.name=JO,this._loader=M,this.enabled=this._loader.isExtensionUsed(JO)}dispose(){this._loader=null}loadMaterialPropertiesAsync(M,A,O){return n.LoadExtraAsync(M,A,this.name,(async(S,z)=>{if(z){if(!(O instanceof b.e))throw new Error("".concat(S,": Material type not supported"));const z=this._loader.loadMaterialPropertiesAsync(M,A,O),Q=O.HM().getEngine().useExactSrgbConversions;return O.albedoTexture||O.albedoColor.toLinearSpaceToRef(O.albedoColor,Q),O.reflectivityTexture||O.reflectivityColor.toLinearSpaceToRef(O.reflectivityColor,Q),await z}}))}}x(JO),t(JO,!0,(M=>new KO(M)));var GO=O(14223);const dO={};var wO=O(14280),IO=O(14248),bO=O(14228),sO=O(14238);function YO(M,A){for(const O of M)for(const M of O.dataOutputs)if(M.uniqueId===A)return M;throw new Error("Could not find data out connection with unique id "+A)}function EO(M,A){for(const O of M)if(O instanceof IO.d)for(const M of O.signalInputs)if(M.uniqueId===A)return M;throw new Error("Could not find signal in connection with unique id "+A)}async function HO(M,A){const S=await Promise.all(M.allBlocks.map((async M=>{const A=function(M){switch(M){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([O.e(78),O.e(79)]).then(O.bind(O,15782))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await O.e(80).then(O.bind(O,15785))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await O.e(81).then(O.bind(O,15790))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await O.e(82).then(O.bind(O,15799))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await O.e(83).then(O.bind(O,15808))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await O.e(84).then(O.bind(O,15813))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await O.e(85).then(O.bind(O,15816))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await O.e(86).then(O.bind(O,15825))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await O.e(87).then(O.bind(O,15828))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await O.e(95).then(O.bind(O,15872))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await O.e(96).then(O.bind(O,15879))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await O.e(97).then(O.bind(O,15881))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await O.e(98).then(O.bind(O,15889))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await O.e(99).then(O.bind(O,15895))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await O.e(100).then(O.bind(O,15898))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await O.e(101).then(O.bind(O,15905))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await O.e(102).then(O.bind(O,15907))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await O.e(103).then(O.bind(O,15911))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await O.e(104).then(O.bind(O,15914))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await O.e(105).then(O.bind(O,15922))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await O.e(106).then(O.bind(O,15931))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await O.e(107).then(O.bind(O,15937))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await O.e(108).then(O.bind(O,15942))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await O.e(109).then(O.bind(O,15949))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await O.e(110).then(O.bind(O,15953))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await O.e(111).then(O.bind(O,15957))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await O.e(112).then(O.bind(O,15964))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await O.e(113).then(O.bind(O,15972))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await O.e(92).then(O.bind(O,15975))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await O.e(114).then(O.bind(O,15981))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await O.e(115).then(O.bind(O,15984))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await O.e(116).then(O.bind(O,15989))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await O.e(93).then(O.bind(O,15991))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await O.e(88).then(O.bind(O,15837))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await O.e(94).then(O.bind(O,15999))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await O.e(89).then(O.bind(O,15861))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await O.e(90).then(O.bind(O,15869))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await O.e(91).then(O.bind(O,16006))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await O.e(117).then(O.bind(O,16011))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await O.e(118).then(O.bind(O,16015))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await O.e(119).then(O.bind(O,16019))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await O.e(120).then(O.bind(O,16027))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await O.e(121).then(O.bind(O,16036))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await O.e(122).then(O.bind(O,16043))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await O.e(123).then(O.bind(O,16051))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await O.e(124).then(O.bind(O,16060))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await O.e(125).then(O.bind(O,16065))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await O.e(126).then(O.bind(O,16074))).FlowGraphDataSwitchBlock;default:if(dO[M])return dO[M];throw new Error("Unknown block name ".concat(M))}}(M.className);return await A()})));return function(M,A,O){var S;const z=A.coordinator.createGraph(),Q=[],X=null!==(S=A.valueParseFunction)&&void 0!==S?S:bO.c;for(let c=0;c<M.allBlocks.length;c++){const S=fO(M.allBlocks[c],{wA:A.coordinator.config.wA,pathConverter:A.pathConverter,assetsContainer:A.coordinator.config.wA,valueParseFunction:X},O[c]);Q.push(S),S instanceof wO.e&&z.addEventBlock(S)}for(const c of Q){for(const M of c.dataInputs)for(const A of M.connectedPointIds){const O=YO(Q,A);M.connectTo(O)}if(c instanceof IO.d)for(const M of c.signalOutputs)for(const A of M.connectedPointIds){const O=EO(Q,A);M.connectTo(O)}}for(const c of M.executionContexts)CO(c,{graph:z,valueParseFunction:X},M.rightHanded);return z}(M,A,S)}function CO(M,A,O){var S;const z=A.graph.createContext();M.enableLogging&&(z.enableLogging=!0),z.treatDataAsRightHanded=O||!1;const Q=null!==(S=A.valueParseFunction)&&void 0!==S?S:bO.c;z.uniqueId=M.uniqueId;const X=z.HM();if(M._assetsContext){var c,j,B,g,e,T,J,K,G,d;const A=M._assetsContext,O={meshes:null===(c=A.meshes)||void 0===c?void 0:c.map((M=>X.getMeshById(M))),lights:null===(j=A.lights)||void 0===j?void 0:j.map((M=>X.getLightByName(M))),cameras:null===(B=A.cameras)||void 0===B?void 0:B.map((M=>X.getCameraByName(M))),materials:null===(g=A.materials)||void 0===g?void 0:g.map((M=>X.getMaterialById(M))),textures:null===(e=A.textures)||void 0===e?void 0:e.map((M=>X.getTextureByName(M))),animations:null===(T=A.animations)||void 0===T?void 0:T.map((M=>X.animations.find((A=>A.name===M)))),skeletons:null===(J=A.skeletons)||void 0===J?void 0:J.map((M=>X.getSkeletonByName(M))),TJ:null===(K=A.TJ)||void 0===K?void 0:K.map((M=>X.getParticleSystemById(M))),animationGroups:null===(G=A.animationGroups)||void 0===G?void 0:G.map((M=>X.getAnimationGroupByName(M))),transformNodes:null===(d=A.transformNodes)||void 0===d?void 0:d.map((M=>X.getTransformNodeById(M))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ZJ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};z.assetsContext=O}for(const w in M._userVariables){const A=Q(w,M._userVariables,z.assetsContext,X);z.userVariables[w]=A}for(const w in M._connectionValues){const A=Q(w,M._connectionValues,z.assetsContext,X);z._setConnectionValueByKey(w,A)}return z}function fO(M,A,O){var S;const z={},Q=null!==(S=A.valueParseFunction)&&void 0!==S?S:bO.c;if(M.config)for(const c in M.config)z[c]=Q(c,M.config,A.assetsContainer||A.wA,A.wA);if((0,bO.g)(M.className)){if(!A.pathConverter)throw new Error("Path converter is required for this block");z.pathConverter=A.pathConverter}const X=new O(z);X.uniqueId=M.uniqueId;for(let c=0;c<M.dataInputs.length;c++){const A=X.getDataInput(M.dataInputs[c].name);if(!A)throw new Error("Could not find data input with name "+M.dataInputs[c].name+" in block "+M.className);A.deserialize(M.dataInputs[c])}for(let c=0;c<M.dataOutputs.length;c++){const A=X.getDataOutput(M.dataOutputs[c].name);if(!A)throw new Error("Could not find data output with name "+M.dataOutputs[c].name+" in block "+M.className);A.deserialize(M.dataOutputs[c])}return X.metadata=M.metadata,X.deserialize&&X.deserialize(M),X}function DO(M){const[A,O]=M.split(":");return FO({op:A,extension:O})}function FO(M){var A;let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const S=M.extension?null===(A=yO[M.extension])||void 0===A?void 0:A[M.op]:hO[M.op];if(!S&&(G.c.Warn("No mapping found for operation ".concat(M.op," and extension ").concat(M.extension||"KHR_interactivity")),O)){const A={},O={flows:{}};if(M.inputValueSockets){A.values={};for(const O in M.inputValueSockets)A.values[O]={name:O}}return M.outputValueSockets&&(O.values={},Object.keys(M.outputValueSockets).forEach((M=>{O.values[M]={name:M}}))),{we:[],inputs:A,outputs:O}}return S}function NO(M,A,O){yO[A]||(yO[A]={}),yO[A][M]=O}const yO={BABYLON:{"flow/log":{we:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},hO={"event/onStart":{we:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{we:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{we:["FlowGraphSendCustomEventBlock"],extraProcessor(M,A,O,S,z){if("event/send"!==A.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=M.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const X=S.arrays.events[Q],c=z[0];return c.config||(c.config={}),c.config.eventId=X.eventId,c.config.eventData=X.eventData,z}},"event/receive":{we:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(M,A){var O;if(!M.configuration)return G.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const S=M.configuration.event;if(!S)return G.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const z=S.value[0];if("number"!==typeof z)return G.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(O=A.events)||void 0===O?void 0:O[z])?{valid:!0}:(G.c.Error("Event with id ".concat(z," not found")),{valid:!1,error:"Event with id ".concat(z," not found")})},extraProcessor(M,A,O,S,z){if("event/receive"!==A.op||!M.configuration||1!==Object.keys(M.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const Q=M.configuration.event.value[0];if("number"!==typeof Q)throw new Error("Event id should be a number");const X=S.arrays.events[Q],c=z[0];return c.config||(c.config={}),c.config.eventId=X.eventId,c.config.eventData=X.eventData,z}},"math/e":uO("FlowGraphEBlock"),"math/pi":uO("FlowGraphPIBlock"),"math/inf":uO("FlowGraphInfBlock"),"math/nan":uO("FlowGraphNaNBlock"),"math/abs":uO("FlowGraphAbsBlock"),"math/sign":uO("FlowGraphSignBlock"),"math/trunc":uO("FlowGraphTruncBlock"),"math/floor":uO("FlowGraphFloorBlock"),"math/ceil":uO("FlowGraphCeilBlock"),"math/round":{we:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z){var Q;return(Q=z[0]).config||(Q.config={}),z[0].config.roundHalfAwayFromZero=!0,z}},"math/fract":uO("FlowGraphFractBlock"),"math/neg":uO("FlowGraphNegationBlock"),"math/add":uO("FlowGraphAddBlock",["a","b"],!0),"math/sub":uO("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{we:["FlowGraphMultiplyBlock"],extraProcessor(M,A,O,S,z){var Q;(Q=z[0]).config||(Q.config={}),z[0].config.useMatrixPerComponent=!0,z[0].config.preventIntegerFloatArithmetic=!0;let X=-1;return Object.keys(M.values||{}).find((A=>{var O;return void 0!==(null===(O=M.values)||void 0===O?void 0:O[A].type)&&(X=M.values[A].type,!0)})),-1!==X&&(z[0].config.type=S.arrays.types[X].flowGraphType),z},validation:M=>M.values?iO(M):{valid:!0}},"math/div":uO("FlowGraphDivideBlock",["a","b"],!0),"math/rem":uO("FlowGraphModuloBlock",["a","b"]),"math/min":uO("FlowGraphMinBlock",["a","b"]),"math/max":uO("FlowGraphMaxBlock",["a","b"]),"math/clamp":uO("FlowGraphClampBlock",["a","b","c"]),"math/saturate":uO("FlowGraphSaturateBlock"),"math/mix":uO("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":uO("FlowGraphEqualityBlock",["a","b"]),"math/lt":uO("FlowGraphLessThanBlock",["a","b"]),"math/le":uO("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":uO("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":uO("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":uO("FlowGraphIsNaNBlock"),"math/isinf":uO("FlowGraphIsInfBlock"),"math/select":{we:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{we:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":uO("FlowGraphSinBlock"),"math/cos":uO("FlowGraphCosBlock"),"math/tan":uO("FlowGraphTanBlock"),"math/asin":uO("FlowGraphASinBlock"),"math/acos":uO("FlowGraphACosBlock"),"math/atan":uO("FlowGraphATanBlock"),"math/atan2":uO("FlowGraphATan2Block",["a","b"]),"math/sinh":uO("FlowGraphSinhBlock"),"math/cosh":uO("FlowGraphCoshBlock"),"math/tanh":uO("FlowGraphTanhBlock"),"math/asinh":uO("FlowGraphASinhBlock"),"math/acosh":uO("FlowGraphACoshBlock"),"math/atanh":uO("FlowGraphATanhBlock"),"math/exp":uO("FlowGraphExponentialBlock"),"math/log":uO("FlowGraphLogBlock"),"math/log2":uO("FlowGraphLog2Block"),"math/log10":uO("FlowGraphLog10Block"),"math/sqrt":uO("FlowGraphSquareRootBlock"),"math/cbrt":uO("FlowGraphCubeRootBlock"),"math/pow":uO("FlowGraphPowerBlock",["a","b"]),"math/length":uO("FlowGraphLengthBlock"),"math/normalize":uO("FlowGraphNormalizeBlock"),"math/dot":uO("FlowGraphDotBlock",["a","b"]),"math/cross":uO("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":uO("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":uO("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{we:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{we:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{we:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{we:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{we:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{we:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{we:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":uO("FlowGraphTransposeBlock"),"math/determinant":uO("FlowGraphDeterminantBlock"),"math/inverse":uO("FlowGraphInvertMatrixBlock"),"math/matmul":uO("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{we:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ec",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z,Q){const X=z[0].dataInputs.find((M=>"rotationQuaternion"===M.name));if(!X)throw new Error("Rotation quaternion input not found");return Q._connectionValues[X.uniqueId]&&(Q._connectionValues[X.uniqueId].type="Quaternion"),z}},"math/matDecompose":{we:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ec"}}}},"math/quatConjugate":uO("FlowGraphConjugateBlock",["a"]),"math/quatMul":{we:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z){var Q;return(Q=z[0]).config||(Q.config={}),z[0].config.type="Quaternion",z}},"math/quatAngleBetween":uO("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{we:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":uO("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":uO("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{we:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z){var Q;return(Q=z[0]).config||(Q.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract2x2":{we:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{we:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z){var Q;return(Q=z[0]).config||(Q.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract3x3":{we:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{we:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z){var Q;return(Q=z[0]).config||(Q.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract4x4":{we:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{we:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z,Q){var X,c,j;(j=z[0]).config||(j.config={});const B=z[0].dataInputs[0];return z[0].config.valueType=null!==(X=null===(c=Q._connectionValues[B.uniqueId])||void 0===c?void 0:c.type)&&void 0!==X?X:"FlowGraphInteger",z}},"math/and":{we:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z,Q){var X,c,j,B,g;(g=z[0]).config||(g.config={});const e=z[0].dataInputs[0],T=z[0].dataInputs[1];return z[0].config.valueType=null!==(X=null!==(c=null===(j=Q._connectionValues[e.uniqueId])||void 0===j?void 0:j.type)&&void 0!==c?c:null===(B=Q._connectionValues[T.uniqueId])||void 0===B?void 0:B.type)&&void 0!==X?X:"FlowGraphInteger",z}},"math/or":{we:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z,Q){var X,c,j,B,g;(g=z[0]).config||(g.config={});const e=z[0].dataInputs[0],T=z[0].dataInputs[1];return z[0].config.valueType=null!==(X=null!==(c=null===(j=Q._connectionValues[e.uniqueId])||void 0===j?void 0:j.type)&&void 0!==c?c:null===(B=Q._connectionValues[T.uniqueId])||void 0===B?void 0:B.type)&&void 0!==X?X:"FlowGraphInteger",z}},"math/xor":{we:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(M,A,O,S,z,Q){var X,c,j,B,g;(g=z[0]).config||(g.config={});const e=z[0].dataInputs[0],T=z[0].dataInputs[1];return z[0].config.valueType=null!==(X=null!==(c=null===(j=Q._connectionValues[e.uniqueId])||void 0===j?void 0:j.type)&&void 0!==c?c:null===(B=Q._connectionValues[T.uniqueId])||void 0===B?void 0:B.type)&&void 0!==X?X:"FlowGraphInteger",z}},"math/asr":uO("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":uO("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":uO("FlowGraphLeadingZerosBlock"),"math/ctz":uO("FlowGraphTrailingZerosBlock"),"math/popcnt":uO("FlowGraphOneBitsCounterBlock"),"math/rad":uO("FlowGraphDegToRadBlock"),"math/deg":uO("FlowGraphRadToDegBlock"),"type/boolToInt":uO("FlowGraphBooleanToInt"),"type/boolToFloat":uO("FlowGraphBooleanToFloat"),"type/intToBool":uO("FlowGraphIntToBoolean"),"type/intToFloat":uO("FlowGraphIntToFloat"),"type/floatToInt":uO("FlowGraphFloatToInt"),"type/floatToBool":uO("FlowGraphFloatToBoolean"),"flow/sequence":{we:["FlowGraphSequenceBlock"],extraProcessor(M,A,O,S,z){const Q=z[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(M.flows||[]).length,Q.signalOutputs.forEach(((M,A)=>{M.name="out_"+A})),z}},"flow/branch":{we:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{we:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(M){if(M.configuration&&M.configuration.cases){const A=M.configuration.cases.value;if(!A.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return G.c.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const O=new Set(A);M.configuration.cases.value=Array.from(O)}return{valid:!0}},extraProcessor(M,A,O,S,z){if("flow/switch"!==A.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return z[0].signalOutputs.forEach((M=>{"default"!==M.name&&(M.name="out_"+M.name)})),z}},"flow/while":{we:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{we:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(M,A,O,S,z){const Q=z[0];return Q.config||(Q.config={}),Q.config.incrementIndexWhenLoopDone=!0,z}},"flow/doN":{we:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{we:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(M,A,O,S,z){if("flow/multiGate"!==A.op||!M.flows||0===Object.keys(M.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const Q=z[0];return Q.config||(Q.config={}),Q.config.outputSignalCount=Object.keys(M.flows).length,Q.signalOutputs.forEach(((M,A)=>{M.name="out_"+A})),z}},"flow/waitAll":{we:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(M){var A,O;return"number"!==typeof(null===(A=M.configuration)||void 0===A||null===(O=A.inputFlows)||void 0===O?void 0:O.value[0])&&(M.configuration=M.configuration||{inputFlows:{value:[0]}},M.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{we:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{we:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{we:["FlowGraphCancelDelayBlock"]},"variable/get":{we:["FlowGraphGetVariableBlock"],validation(M){var A,O;return null!==(A=M.configuration)&&void 0!==A&&null!==(O=A.variable)&&void 0!==O&&O.value?{valid:!0}:(G.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,A)=>[A.getVariableName(M[0])]}}},"variable/set":{we:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(M,A)=>[A.getVariableName(M[0])]}}},"variable/setMultiple":{we:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(M,A)=>[M[0].map((M=>A.getVariableName(M)))]}},extraProcessor:(M,A,O,S,z)=>(z[0].dataInputs.forEach((M=>{M.name=S.getVariableName(+M.name)})),z)},"variable/interpolate":{we:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(M,A)=>[A.getVariableName(M[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:M=>!0===M[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",sO:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",sO:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",sO:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",sO:"FlowGraphPlayAnimationBlock"},out:{name:"out",sO:"FlowGraphPlayAnimationBlock"},done:{name:"done",sO:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(M,A,O,S,z){var Q,X,c;const j=z[0],B=null===(Q=M.configuration)||void 0===Q?void 0:Q.variable.value[0];if("number"!==typeof B)throw G.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const g=S.arrays.staticVariables[B];"undefined"===typeof j.config.animationType.value&&(S.arrays.staticVariables,j.config.animationType.value=(0,sO.H)(g.type));const e=z[4];return e.config||(e.config={}),(X=e.config).variable||(X.variable={}),e.config.variable.value=S.getVariableName(B),(c=z[3]).config||(c.config={}),z}},"pointer/get":{we:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",sO:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",sO:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,A,O,S,z)=>(z.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),z)},"pointer/set":{we:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",sO:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",sO:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,A,O,S,z)=>(z.forEach((M=>{"FlowGraphJsonPointerParserBlock"===M.className&&(M.config||(M.config={}),M.config.outputValue=!0)})),z)},"pointer/interpolate":{we:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",sO:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",sO:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",sO:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",sO:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",sO:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",sO:"FlowGraphPlayAnimationBlock"},out:{name:"out",sO:"FlowGraphPlayAnimationBlock"},done:{name:"done",sO:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(M,A,O,S,z)=>(z.forEach((A=>{"FlowGraphJsonPointerParserBlock"===A.className?(A.config||(A.config={}),A.config.outputValue=!0):"FlowGraphInterpolationBlock"===A.className&&(A.config||(A.config={}),Object.keys(M.values||[]).forEach((O=>{var z;const Q=null===(z=M.values)||void 0===z?void 0:z[O];if("value"===O&&Q){const M=Q.type;void 0!==M&&(A.config.animationType=S.arrays.types[M].flowGraphType)}})))})),z)},"animation/start":{we:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",sO:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(M,A)=>[M[0]*A._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(M,A)=>[M[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){const c=z[z.length-1];return c.config||(c.config={}),c.config.glTF=X,z}},"animation/stop":{we:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",sO:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){const c=z[z.length-1];return c.config||(c.config={}),c.config.glTF=X,z}},"animation/stopAt":{we:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",sO:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(M,A)=>[M[0]*A._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){const c=z[z.length-1];return c.config||(c.config={}),c.config.glTF=X,z}},"math/switch":{we:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(M){if(M.configuration&&M.configuration.cases){const A=M.configuration.cases.value;if(!A.every((M=>"number"===typeof M&&/^-?\d+$/.test(M.toString()))))return G.c.Warn("Switch cases should be integers. Using empty array instead."),M.configuration.cases.value=[],{valid:!0};const O=new Set(A);M.configuration.cases.value=Array.from(O)}return{valid:!0}},extraProcessor(M,A,O,S,z){const Q=z[0];return Q.dataInputs.forEach((M=>{"default"!==M.name&&"case"!==M.name&&(M.name="in_"+M.name)})),Q.config||(Q.config={}),Q.config.treatCasesAsIntegers=!0,z}},"debug/log":{we:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function uO(M){let A=arguments.length>2?arguments[2]:void 0;return{we:[M],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((M,A)=>(M[A]={name:A},M)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(M,O,S,z,Q){var X;if(A){(X=Q[0]).config||(X.config={}),Q[0].config.preventIntegerFloatArithmetic=!0;let A=-1;Object.keys(M.values||{}).find((O=>{var S;return void 0!==(null===(S=M.values)||void 0===S?void 0:S[O].type)&&(A=M.values[O].type,!0)})),-1!==A&&(Q[0].config.type=z.arrays.types[A].flowGraphType)}return Q},validation:M=>A?iO(M):{valid:!0}}}function iO(M){if(M.values){const A=Object.keys(M.values).map((A=>M.values[A].type)).filter((M=>void 0!==M));if(!A.every((M=>M===A[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}hO["math/compose"]=hO["math/matCompose"],hO["math/decompose"]=hO["math/matDecompose"];var UO=O(12927);const LO={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"GA",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class tO{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=M,this._gltf=A,this._animationTargetFps=O,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const M of this._interactivityGraph.types)this._types.push(LO[M.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const M of this._interactivityGraph.declarations){const A=FO(M);if(!A)throw G.c.Error(["No mapping found for declaration",M]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:A,fullOperationName:M.extension?M.op+":"+M.extension:M.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const M of this._interactivityGraph.variables){const A=this._parseVariable(M);this._staticVariables.push(A)}}_parseVariable(M,A){const O=this._types[M.type];if(!O)throw G.c.Error(["No type found for variable",M]),new Error("Error parsing variables");if(M.value&&M.value.length!==O.length)throw G.c.Error(["Invalid value length for variable",M,O]),new Error("Error parsing variables");const S=M.value||[];if(!S.length)switch(O.flowGraphType){case"boolean":S.push(!1);break;case"FlowGraphInteger":S.push(0);break;case"number":S.push(NaN);break;case"Vector2":S.push(NaN,NaN);break;case"GA":S.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":S.fill(NaN,0,4);break;case"Matrix":S.fill(NaN,0,16);break;case"Matrix3D":S.fill(NaN,0,9)}return"number"===O.elementType&&"string"===typeof S[0]&&(S[0]=parseFloat(S[0])),{type:O.flowGraphType,value:A?A(S,this):S}}_parseEvents(){if(this._interactivityGraph.events)for(const M of this._interactivityGraph.events){const A={eventId:M.id||"internalEvent_"+this._internalEventsCounter++};M.values&&(A.eventData=Object.keys(M.values).map((A=>{var O;const S=null===(O=M.values)||void 0===O?void 0:O[A];if(!S)throw G.c.Error(["No value found for event key",A]),new Error("Error parsing events");const z=this._types[S.type];if(!z)throw G.c.Error(["No type found for event value",S]),new Error("Error parsing events");const Q="undefined"!==typeof S.value?this._parseVariable(S):void 0;return{id:A,type:z.flowGraphType,eventData:!0,value:Q}}))),this._events.push(A)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const A of this._interactivityGraph.nodes){if("number"!==typeof A.declaration)throw G.c.Error(["No declaration found for node",A]),new Error("Error parsing nodes");const O=this._mappings[A.declaration];if(!O)throw G.c.Error(["No mapping found for node",A]),new Error("Error parsing nodes");if(O.flowGraphMapping.validation){const S=O.flowGraphMapping.validation(A,this._interactivityGraph,this._gltf);var M;if(!S.valid)throw new Error("Error validating interactivity node ".concat(null===(M=this._interactivityGraph.declarations)||void 0===M?void 0:M[A.declaration].op," - ").concat(S.error))}const S=[];for(const M of O.flowGraphMapping.we){const z=this._getEmptyBlock(M,O.fullOperationName);this._parseNodeConfiguration(A,z,O.flowGraphMapping,M),S.push(z)}this._nodes.push({we:S,fullOperationName:O.fullOperationName})}}_getEmptyBlock(M,A){return{uniqueId:(0,UO.b)(),className:M,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:A,metadata:{}}}_parseNodeConfiguration(M,A,O,S){const z=A.config;if(M.configuration){const A=Object.keys(M.configuration);for(const c of A){var Q,X;const A=null===(Q=M.configuration)||void 0===Q?void 0:Q[c];if(!A)throw G.c.Error(["No value found for node configuration",c]),new Error("Error parsing node configuration");const j=null===(X=O.configuration)||void 0===X?void 0:X[c];if(j&&j.sO?j.sO===S:0===O.we.indexOf(S)){const M=(null===j||void 0===j?void 0:j.name)||c;A&&"undefined"!==typeof A.value||"undefined"===typeof(null===j||void 0===j?void 0:j.defaultValue)?A.value.length>=0?z[M]={value:1===A.value.length?A.value[0]:A.value}:G.c.Warn(["Invalid value for node configuration",A]):z[M]={value:j.defaultValue},j&&j.dataTransformer&&(z[M].value=j.dataTransformer([z[M].value],this)[0])}}}}_parseNodeConnections(M){for(let E=0;E<this._nodes.length;E++){var A;const H=null===(A=this._interactivityGraph.nodes)||void 0===A?void 0:A[E];if(!H)throw G.c.Error(["No node found for interactivity node",this._nodes[E]]),new Error("Error parsing node connections");const C=this._nodes[E],f=this._mappings[H.declaration];if(!f)throw G.c.Error(["No mapping found for node",H]),new Error("Error parsing node connections");const D=H.flows||{},F=Object.keys(D).sort();for(const M of F){var O,S,z,Q;const A=D[M],B=null===(O=f.flowGraphMapping.outputs)||void 0===O||null===(S=O.flows)||void 0===S?void 0:S[M],g=(null===B||void 0===B?void 0:B.name)||M,e=this._createNewSocketConnection(g,!0);(B&&B.sO&&C.we.find((M=>M.className===B.sO))||C.we[0]).signalOutputs.push(e);const T=A.node,J=this._nodes[T];if(!J)throw G.c.Error(["No node found for input node id",T]),new Error("Error parsing node connections");const K=DO(J.fullOperationName);if(!K)throw G.c.Error(["No mapping found for input node",J]),new Error("Error parsing node connections");let d=null===(z=K.inputs)||void 0===z||null===(Q=z.flows)||void 0===Q?void 0:Q[A.socket||"in"],w=!1;if(!d)for(const M in null===(X=K.inputs)||void 0===X?void 0:X.flows){var X,c,j;if(M.startsWith("[")&&M.endsWith("]"))w=!0,d=null===(c=K.inputs)||void 0===c||null===(j=c.flows)||void 0===j?void 0:j[M]}const I=d?w?d.name.replace("$1",A.socket||""):d.name:A.socket||"in",b=d&&d.sO&&J.we.find((M=>M.className===d.sO))||J.we[0];let s=b.signalInputs.find((M=>M.name===I));s||(s=this._createNewSocketConnection(I),b.signalInputs.push(s)),s.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(s.uniqueId)}const N=H.values||{},y=Object.keys(N);for(const A of y){var B,g;const O=N[A];let S=null===(B=f.flowGraphMapping.inputs)||void 0===B||null===(g=B.values)||void 0===g?void 0:g[A],z=!1;if(!S)for(const M in null===(e=f.flowGraphMapping.inputs)||void 0===e?void 0:e.values){var e,T,J;if(M.startsWith("[")&&M.endsWith("]"))z=!0,S=null===(T=f.flowGraphMapping.inputs)||void 0===T||null===(J=T.values)||void 0===J?void 0:J[M]}const Q=S?z?S.name.replace("$1",A):S.name:A,X=this._createNewSocketConnection(Q);if((S&&S.sO&&C.we.find((M=>M.className===S.sO))||C.we[0]).dataInputs.push(X),void 0!==O.value){const A=this._parseVariable(O,S&&S.dataTransformer);M._connectionValues[X.uniqueId]=A}else{if("undefined"===typeof O.node)throw G.c.Error(["Invalid value for value connection",O]),new Error("Error parsing node connections");{var K,d,w;const M=O.node,A=O.socket||"value",S=this._nodes[M];if(!S)throw G.c.Error(["No node found for output socket reference",O]),new Error("Error parsing node connections");const z=DO(S.fullOperationName);if(!z)throw G.c.Error(["No mapping found for output socket reference",O]),new Error("Error parsing node connections");let Q=null===(K=z.outputs)||void 0===K||null===(d=K.values)||void 0===d?void 0:d[A],c=!1;if(!Q)for(const O in null===(I=z.outputs)||void 0===I?void 0:I.values){var I,b,s;if(O.startsWith("[")&&O.endsWith("]"))c=!0,Q=null===(b=z.outputs)||void 0===b||null===(s=b.values)||void 0===s?void 0:s[O]}const j=Q?c?Q.name.replace("$1",A):null===(w=Q)||void 0===w?void 0:w.name:A,B=Q&&Q.sO&&S.we.find((M=>M.className===Q.sO))||S.we[0];let g=B.dataOutputs.find((M=>M.name===j));g||(g=this._createNewSocketConnection(j,!0),B.dataOutputs.push(g)),X.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(X.uniqueId)}}}if(f.flowGraphMapping.interBlockConnectors)for(const M of f.flowGraphMapping.interBlockConnectors){const A=M.input,O=M.output,S=M.isVariable;this._connectFlowGraphNodes(A,O,C.we[M.inputBlockIndex],C.we[M.outputBlockIndex],S)}if(f.flowGraphMapping.extraProcessor){var Y;const A=null===(Y=this._interactivityGraph.declarations)||void 0===Y?void 0:Y[H.declaration];if(!A)throw G.c.Error(["No declaration found for extra processor",H]),new Error("Error parsing node connections");C.we=f.flowGraphMapping.extraProcessor(H,A,f.flowGraphMapping,this,C.we,M,this._gltf)}}}_createNewSocketConnection(M,A){return{uniqueId:(0,UO.b)(),name:M,_connectionType:A?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(M,A,O,S,z){const Q=z?O.dataInputs:O.signalInputs,X=z?S.dataOutputs:S.signalOutputs,c=Q.find((A=>A.name===M))||this._createNewSocketConnection(M),j=X.find((M=>M.name===A))||this._createNewSocketConnection(A,!0);Q.find((A=>A.name===M))||Q.push(c),X.find((M=>M.name===A))||X.push(j),c.connectedPointIds.push(j.uniqueId),j.connectedPointIds.push(c.uniqueId)}getVariableName(M){return"staticVariable_"+M}serializeToFlowGraph(){const M={uniqueId:(0,UO.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(M);for(let A=0;A<this._staticVariables.length;A++){const O=this._staticVariables[A];M._userVariables[this.getVariableName(A)]=O}return{rightHanded:!0,allBlocks:this._nodes.reduce(((M,A)=>M.concat(A.we)),[]),executionContexts:[M]}}}const xO="KHR_interactivity";class oO{constructor(M){this._loader=M,this.name=xO,this.enabled=this._loader.isExtensionUsed(xO),this._pathConverter=(0,o.i)(this._loader.Xc),M._skipStartAnimationStep=!0;const A=M.babylonScene;A&&function(M){(0,o.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!M.activeCamera)return new z.Quaternion(NaN,NaN,NaN,NaN);const A=z.Quaternion.FromRotationMatrix(M.activeCamera.getWorldMatrix()).normalize();return M.useRightHandedSystem||(A.w*=-1,A.x*=-1),A},type:"Quaternion",getTarget:()=>M.activeCamera}),(0,o.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!M.activeCamera)return new z.GA(NaN,NaN,NaN);const A=M.activeCamera.getWorldMatrix().getTranslation();return M.useRightHandedSystem||(A.x*=-1),A},type:"GA",getTarget:()=>M.activeCamera}),(0,o.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:M=>{var A,O;return null!==(A=null===(O=M._babylonAnimationGroup)||void 0===O?void 0:O.isPlaying)&&void 0!==A&&A},type:"boolean",getTarget:M=>M._babylonAnimationGroup}),(0,o.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:M=>{var A,O;return(null!==(A=null===(O=M._babylonAnimationGroup)||void 0===O?void 0:O.from)&&void 0!==A?A:0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,o.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:M=>{var A,O;return(null!==(A=null===(O=M._babylonAnimationGroup)||void 0===O?void 0:O.to)&&void 0!==A?A:0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,o.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:M=>{var A,O;return(null!==(A=null===(O=M._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())&&void 0!==A?A:0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup}),(0,o.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:M=>{var A,O;return(null!==(A=null===(O=M._babylonAnimationGroup)||void 0===O?void 0:O.getCurrentFrame())&&void 0!==A?A:0)/60},type:"number",getTarget:M=>M._babylonAnimationGroup})}(A)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var M;if(!this._loader.babylonScene||!this._pathConverter)return;const A=this._loader.babylonScene,O=null===(M=this._loader.Xc.extensions)||void 0===M?void 0:M.KHR_interactivity;if(!O)return;const S=new GO.e({wA:A});S.dispatchEventsSynchronously=!1;const z=O.graphs.map((M=>new tO(M,this._loader.Xc,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(z.map((async M=>await HO(M,{coordinator:S,pathConverter:this._pathConverter})))),S.start()}}var pO,vO;pO="FlowGraphGLTFDataProvider",vO=async()=>(await Promise.resolve().then(O.bind(O,14293))).FlowGraphGLTFDataProvider,dO["".concat(xO,"/").concat(pO)]=vO,x(xO),t(xO,!0,(M=>new oO(M)));const qO="KHR_node_visibility";(0,o.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:M=>{const A=M._babylonTransformNode;return!A||void 0===A.isVisible||A.isVisible},set:(M,A)=>{var O,S;null===(O=A._primitiveBabylonMeshes)||void 0===O||O.forEach((M=>{M.inheritVisibility=!0})),A._babylonTransformNode&&(A._babylonTransformNode.isVisible=M),null===(S=A._primitiveBabylonMeshes)||void 0===S||S.forEach((A=>{A.isVisible=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class rO{constructor(M){this.name=qO,this._loader=M,this.enabled=M.isExtensionUsed(qO)}async onReady(){var M;null===(M=this._loader.Xc.nodes)||void 0===M||M.forEach((M=>{var A,O,S,z;(null===(A=M._primitiveBabylonMeshes)||void 0===A||A.forEach((M=>{M.inheritVisibility=!0})),null!==(O=M.extensions)&&void 0!==O&&O.KHR_node_visibility)&&(!1===(null===(S=M.extensions)||void 0===S?void 0:S.KHR_node_visibility.visible)&&(M._babylonTransformNode&&(M._babylonTransformNode.isVisible=!1),null===(z=M._primitiveBabylonMeshes)||void 0===z||z.forEach((M=>{M.isVisible=!1}))))}))}dispose(){this._loader=null}}x(qO),t(qO,!0,(M=>new rO(M)));const nO="KHR_node_selectability";NO("event/onSelect",nO,{we:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sO:"FlowGraphGetVariableBlock",dataTransformer:M=>["pickedMesh_"+M[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",sO:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){var c,j,B,g,e,T;const J=z[z.length-1];J.config=J.config||{},J.config.glTF=X;const K=null===(c=M.configuration)||void 0===c||null===(j=c.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const G="pickedMesh_"+K;return z[1].config.variable=G,Q._userVariables[G]={className:"Mesh",id:null===X||void 0===X||null===(B=X.nodes)||void 0===B||null===(g=B[K]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===X||void 0===X||null===(e=X.nodes)||void 0===e||null===(T=e[K]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},z}}),(0,o.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:M=>{const A=M._babylonTransformNode;return!A||void 0===A.EB||A.EB},set:(M,A)=>{var O;null===(O=A._primitiveBabylonMeshes)||void 0===O||O.forEach((A=>{A.EB=M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"EB"],type:"boolean"});class aO{constructor(M){this.name=nO,this._loader=M,this.enabled=M.isExtensionUsed(nO)}async onReady(){var M;null===(M=this._loader.Xc.nodes)||void 0===M||M.forEach((M=>{var A,O,S;null!==(A=M.extensions)&&void 0!==A&&A.KHR_node_selectability&&!1===(null===(O=M.extensions)||void 0===O?void 0:O.KHR_node_selectability.selectable)&&(null===(S=M._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((M=>{M.EB=!1})))}))}dispose(){this._loader=null}}x(nO),t(nO,!0,(M=>new aO(M)));const VO="KHR_node_hoverability",ZO="targetMeshPointerOver_";NO("event/onHoverIn",VO,{we:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sO:"FlowGraphGetVariableBlock",dataTransformer:M=>[ZO+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",sO:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){var c,j,B,g,e,T;const J=z[z.length-1];J.config=J.config||{},J.config.glTF=X;const K=null===(c=M.configuration)||void 0===c||null===(j=c.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const G=ZO+K;return z[1].config.variable=G,Q._userVariables[G]={className:"Mesh",id:null===X||void 0===X||null===(B=X.nodes)||void 0===B||null===(g=B[K]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===X||void 0===X||null===(e=X.nodes)||void 0===e||null===(T=e[K]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},z}});const PO="targetMeshPointerOut_";NO("event/onHoverOut",VO,{we:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",sO:"FlowGraphGetVariableBlock",dataTransformer:M=>[PO+M[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",sO:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(M,A,O,S,z,Q,X){var c,j,B,g,e,T;const J=z[z.length-1];J.config=J.config||{},J.config.glTF=X;const K=null===(c=M.configuration)||void 0===c||null===(j=c.nodeIndex)||void 0===j?void 0:j.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const G=PO+K;return z[1].config.variable=G,Q._userVariables[G]={className:"Mesh",id:null===X||void 0===X||null===(B=X.nodes)||void 0===B||null===(g=B[K]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===X||void 0===X||null===(e=X.nodes)||void 0===e||null===(T=e[K]._babylonTransformNode)||void 0===T?void 0:T.uniqueId},z}}),(0,o.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:M=>{const A=M._babylonTransformNode;return!A||void 0===A.pointerOverDisableMeshTesting||A.pointerOverDisableMeshTesting},set:(M,A)=>{var O;null===(O=A._primitiveBabylonMeshes)||void 0===O||O.forEach((A=>{A.pointerOverDisableMeshTesting=!M}))},getTarget:M=>M._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class mS{constructor(M){this.name=VO,this._loader=M,this.enabled=M.isExtensionUsed(VO)}async onReady(){var M;null===(M=this._loader.Xc.nodes)||void 0===M||M.forEach((M=>{var A,O,S;null!==(A=M.extensions)&&void 0!==A&&A.KHR_node_hoverability&&!1===(null===(O=M.extensions)||void 0===O?void 0:O.KHR_node_hoverability.hoverable)&&(null===(S=M._babylonTransformNode)||void 0===S||S.getChildMeshes().forEach((M=>{M.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}x(VO),t(VO,!0,(M=>new mS(M)));const RO="ExtrasAsMetadata";class kO{_assignExtras(M,A){if(A.extras&&Object.keys(A.extras).length>0){const O=M.metadata=M.metadata||{};(O.Xc=O.Xc||{}).extras=A.extras}}constructor(M){this.name=RO,this.enabled=!0,this._loader=M}dispose(){this._loader=null}loadNodeAsync(M,A,O){return this._loader.loadNodeAsync(M,A,(M=>{this._assignExtras(M,A),O(M)}))}loadCameraAsync(M,A,O){return this._loader.loadCameraAsync(M,A,(M=>{this._assignExtras(M,A),O(M)}))}createMaterial(M,A,O){const S=this._loader.createMaterial(M,A,O);return this._assignExtras(S,A),S}}x(RO),t(RO,!1,(M=>new kO(M)));O(14293)},14166:(M,A,O)=>{"use strict";O.d(A,{b:()=>i,f:()=>D,j:()=>f,l:()=>F});var S=O(12776),z=O(12768),Q=O(13840),X=O(22),c=O(13422),j=O(13385),B=O(13398),g=O(12783),e=O(12811),T=O(13415),J=O(13522),K=O(13428),G=O(13005);class d{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.TJ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ZJ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(M){this._environmentTexture=M}getNodes(){let M=[];M=M.concat(this.meshes),M=M.concat(this.lights),M=M.concat(this.cameras),M=M.concat(this.transformNodes);for(const A of this.skeletons)M=M.concat(A.bones);return M}}class w extends d{}class I{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const M=this.rootNodes;for(const S of M)S.dispose();M.length=0;const A=this.skeletons;for(const S of A)S.dispose();A.length=0;const O=this.animationGroups;for(const S of O)S.dispose();O.length=0}}class b extends d{constructor(M){super(),this._wasAddedToScene=!1,(M=M||e.d.LastCreatedScene)&&(this.wA=M,this.proceduralTextures=[],M.Ac.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=M.getEngine().onContextRestoredObservable.add((()=>{for(const M of this.geometries)M._rebuild();for(const M of this.meshes)M._rebuild();for(const M of this.TJ)M.rebuild();for(const M of this.textures)M._rebuild()})))}_topologicalSort(M){const A=new Map;for(const X of M)A.set(X.uniqueId,X);const O={dependsOn:new Map,dependedBy:new Map};for(const X of M){const M=X.uniqueId;O.dependsOn.set(M,new Set),O.dependedBy.set(M,new Set)}for(const X of M){const M=X.uniqueId,S=O.dependsOn.get(M);if(X instanceof T.e){const z=X.sourceMesh;A.has(z.uniqueId)&&(S.add(z.uniqueId),O.dependedBy.get(z.uniqueId).add(M))}const z=O.dependedBy.get(M);for(const Q of X.getDescendants()){const S=Q.uniqueId;if(A.has(S)){z.add(S);O.dependsOn.get(S).add(M)}}}const S=[],z=[];for(const X of M){const M=X.uniqueId;0===O.dependsOn.get(M).size&&(z.push(X),A.delete(M))}const Q=z;for(;Q.length>0;){const M=Q.shift();S.push(M);const z=O.dependedBy.get(M.uniqueId);for(const S of Array.from(z.values())){const z=O.dependsOn.get(S);z.delete(M.uniqueId),0===z.size&&A.get(S)&&(Q.push(A.get(S)),A.delete(S))}}return A.size>0&&(g.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),A.forEach((M=>{g.c.Error(M.name)}))),S}_addNodeAndDescendantsToList(M,A,O,S){if(O&&(!S||S(O))&&!A.has(O.uniqueId)){M.push(O),A.add(O.uniqueId);for(const z of O.getDescendants(!0))this._addNodeAndDescendantsToList(M,A,z,S)}}_isNodeInContainer(M){return M instanceof B.d&&-1!==this.meshes.indexOf(M)||(M instanceof j.e&&-1!==this.transformNodes.indexOf(M)||(M instanceof J.d&&-1!==this.lights.indexOf(M)||M instanceof K.c&&-1!==this.cameras.indexOf(M)))}_isValidHierarchy(){for(const M of this.meshes)if(M.parent&&!this._isNodeInContainer(M.parent))return g.c.Warn("Node ".concat(M.name," has a parent that is not in the container.")),!1;for(const M of this.transformNodes)if(M.parent&&!this._isNodeInContainer(M.parent))return g.c.Warn("Node ".concat(M.name," has a parent that is not in the container.")),!1;for(const M of this.lights)if(M.parent&&!this._isNodeInContainer(M.parent))return g.c.Warn("Node ".concat(M.name," has a parent that is not in the container.")),!1;for(const M of this.cameras)if(M.parent&&!this._isNodeInContainer(M.parent))return g.c.Warn("Node ".concat(M.name," has a parent that is not in the container.")),!1;return!0}instantiateModelsToScene(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const S={},Q={},j=new I,B=[],g=[],e=(0,X.d)({doNotInstantiate:!0},O),T=[],J=new Set;for(const z of this.transformNodes)null===z.parent&&this._addNodeAndDescendantsToList(T,J,z,e.predicate);for(const z of this.meshes)null===z.parent&&this._addNodeAndDescendantsToList(T,J,z,e.predicate);const K=this._topologicalSort(T),G=(O,z)=>{if(((A,O)=>{if(S[A.uniqueId]=O.uniqueId,Q[O.uniqueId]=O,M&&(O.name=M(A.name)),O instanceof c.d){const M=O;if(M.morphTargetManager){const O=A.morphTargetManager;M.morphTargetManager=O.clone();for(let A=0;A<O.numTargets;A++){const z=O.getTarget(A),X=M.morphTargetManager.getTarget(A);S[z.uniqueId]=X.uniqueId,Q[X.uniqueId]=X}}}})(O,z),O.parent){const M=S[O.parent.uniqueId],A=Q[M];z.parent=A||O.parent}if(z.position&&O.position&&z.position.S(O.position),z.rotationQuaternion&&O.rotationQuaternion&&z.rotationQuaternion.S(O.rotationQuaternion),z.rotation&&O.rotation&&z.rotation.S(O.rotation),z.Ec&&O.Ec&&z.Ec.S(O.Ec),z.material){const X=z;if(X.material)if(A){const A=O.material;if(-1===g.indexOf(A)){let O=A.clone(M?M(A.name):"Clone of "+A.name);if(g.push(A),S[A.uniqueId]=O.uniqueId,Q[O.uniqueId]=O,"MultiMaterial"===A.getClassName()){const z=A;for(const A of z.fc)A&&(O=A.clone(M?M(A.name):"Clone of "+A.name),g.push(A),S[A.uniqueId]=O.uniqueId,Q[O.uniqueId]=O);z.fc=z.fc.map((M=>M&&Q[S[M.uniqueId]]))}}"InstancedMesh"!==X.getClassName()&&(X.material=Q[S[A.uniqueId]])}else"MultiMaterial"===X.material.getClassName()?-1===this.wA.multiMaterials.indexOf(X.material)&&this.wA.addMultiMaterial(X.material):-1===this.wA.materials.indexOf(X.material)&&this.wA.addMaterial(X.material)}null===z.parent&&j.rootNodes.push(z)};for(const z of K)if("InstancedMesh"===z.getClassName()){const M=z,A=M.sourceMesh,O=S[A.uniqueId];G(M,("number"===typeof O?Q[O]:A).createInstance(M.name))}else{let M=!0;"iT"===z.getClassName()||"Node"===z.getClassName()||z.skeleton||!z.getTotalVertices||0===z.getTotalVertices()?M=!1:e.doNotInstantiate&&(M="function"===typeof e.doNotInstantiate?!e.doNotInstantiate(z):!e.doNotInstantiate);const A=M?z.createInstance("instance of ".concat(z.name)):z.clone("Clone of ".concat(z.name),null,!0);if(!A)throw new Error("Could not clone or instantiate node on Asset Container ".concat(z.name));G(z,A)}for(const z of this.skeletons){if(e.predicate&&!e.predicate(z))continue;const A=z.clone(M?M(z.name):"Clone of "+z.name);for(const M of this.meshes)if(M.skeleton===z&&!M.isAnInstance){const O=Q[S[M.uniqueId]];if(!O||O.isAnInstance)continue;if(O.skeleton=A,-1!==B.indexOf(A))continue;B.push(A);for(const M of A.bones)M._linkedTransformNode&&(M._linkedTransformNode=Q[S[M._linkedTransformNode.uniqueId]])}j.skeletons.push(A)}for(const z of this.animationGroups){if(e.predicate&&!e.predicate(z))continue;const A=z.clone(M?M(z.name):"Clone of "+z.name,(M=>Q[S[M.uniqueId]]||M));j.animationGroups.push(A)}return j}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.wA.environmentTexture=this.environmentTexture);for(const M of this.wA._serializableComponents)M.addFromContainer(this);this.wA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const A=[];for(const O of this.cameras)M&&!M(O)||(this.wA.addCamera(O),A.push(O));for(const O of this.lights)M&&!M(O)||(this.wA.addLight(O),A.push(O));for(const O of this.meshes)M&&!M(O)||(this.wA.Xe(O),A.push(O));for(const O of this.skeletons)M&&!M(O)||this.wA.addSkeleton(O);for(const O of this.animations)M&&!M(O)||this.wA.addAnimation(O);for(const O of this.animationGroups)M&&!M(O)||this.wA.addAnimationGroup(O);for(const O of this.multiMaterials)M&&!M(O)||this.wA.addMultiMaterial(O);for(const O of this.materials)M&&!M(O)||this.wA.addMaterial(O);for(const O of this.morphTargetManagers)M&&!M(O)||this.wA.addMorphTargetManager(O);for(const O of this.geometries)M&&!M(O)||this.wA.addGeometry(O);for(const O of this.transformNodes)M&&!M(O)||(this.wA.addTransformNode(O),A.push(O));for(const O of this.actionManagers)M&&!M(O)||this.wA.addActionManager(O);for(const O of this.textures)M&&!M(O)||this.wA.addTexture(O);for(const O of this.reflectionProbes)M&&!M(O)||this.wA.addReflectionProbe(O);for(const O of A)O.parent&&-1===this.wA.getNodes().indexOf(O.parent)&&(O.setParent?O.setParent(null):O.parent=null)}removeAllFromScene(){this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.wA.environmentTexture&&(this.wA.environmentTexture=null);for(const M of this.wA._serializableComponents)M.removeFromContainer(this)}removeFromScene(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const A of this.cameras)M&&!M(A)||this.wA.removeCamera(A);for(const A of this.lights)M&&!M(A)||this.wA.removeLight(A);for(const A of this.meshes)M&&!M(A)||this.wA.Qe(A,!0);for(const A of this.skeletons)M&&!M(A)||this.wA.removeSkeleton(A);for(const A of this.animations)M&&!M(A)||this.wA.removeAnimation(A);for(const A of this.animationGroups)M&&!M(A)||this.wA.removeAnimationGroup(A);for(const A of this.multiMaterials)M&&!M(A)||this.wA.removeMultiMaterial(A);for(const A of this.materials)M&&!M(A)||this.wA.removeMaterial(A);for(const A of this.morphTargetManagers)M&&!M(A)||this.wA.removeMorphTargetManager(A);for(const A of this.geometries)M&&!M(A)||this.wA.removeGeometry(A);for(const A of this.transformNodes)M&&!M(A)||this.wA.removeTransformNode(A);for(const A of this.actionManagers)M&&!M(A)||this.wA.removeActionManager(A);for(const A of this.textures)M&&!M(A)||this.wA.removeTexture(A);for(const A of this.reflectionProbes)M&&!M(A)||this.wA.removeReflectionProbe(A)}dispose(){const M=this.cameras.slice(0);for(const J of M)J.dispose();this.cameras.length=0;const A=this.lights.slice(0);for(const J of A)J.dispose();this.lights.length=0;const O=this.meshes.slice(0);for(const J of O)J.dispose();this.meshes.length=0;const S=this.skeletons.slice(0);for(const J of S)J.dispose();this.skeletons.length=0;const z=this.animationGroups.slice(0);for(const J of z)J.dispose();this.animationGroups.length=0;const Q=this.multiMaterials.slice(0);for(const J of Q)J.dispose();this.multiMaterials.length=0;const X=this.materials.slice(0);for(const J of X)J.dispose();this.materials.length=0;const c=this.geometries.slice(0);for(const J of c)J.dispose();this.geometries.length=0;const j=this.transformNodes.slice(0);for(const J of j)J.dispose();this.transformNodes.length=0;const B=this.actionManagers.slice(0);for(const J of B)J.dispose();this.actionManagers.length=0;const g=this.textures.slice(0);for(const J of g)J.dispose();this.textures.length=0;const e=this.reflectionProbes.slice(0);for(const J of e)J.dispose();this.reflectionProbes.length=0;const T=this.morphTargetManagers.slice(0);for(const J of T)J.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const J of this.wA._serializableComponents)J.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.wA.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(M,A,O){if(M&&A)for(const S of M){let M=!0;if(O)for(const A of O)if(S===A){M=!1;break}M&&(A.push(S),S._parentContainer=this)}}moveAllFromScene(M){this._wasAddedToScene=!1,void 0===M&&(M=new w);for(const A in this)Object.prototype.hasOwnProperty.call(this,A)&&(this[A]=this[A]||("_environmentTexture"===A?null:[]),this._moveAssets(this.wA[A],this[A],M[A]));this.environmentTexture=this.wA.environmentTexture,this.removeAllFromScene()}createRootMesh(){const M=new c.d("assetContainerRootMesh",this.wA);for(const A of this.meshes)A.parent||M.addChild(A);return this.meshes.unshift(M),M}mergeAnimationsTo(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.d.LastCreatedScene,A=arguments.length>1?arguments[1]:void 0,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!M)return g.c.Error("No scene available to merge animations to"),[];const S=O||(A=>{let O=null;const S=A.animations.length?A.animations[0].targetProperty:"",z=A.name.split(".").join("").split("_primitive")[0];switch(S){case"position":case"rotationQuaternion":O=M.getTransformNodeByName(A.name)||M.getTransformNodeByName(z);break;case"influence":O=M.getMorphTargetByName(A.name)||M.getMorphTargetByName(z);break;default:O=M.getNodeByName(A.name)||M.getNodeByName(z)}return O}),z=this.getNodes();for(const c of z){const M=S(c);if(null!==M){for(const A of c.animations){const O=M.animations.filter((M=>M.targetProperty===A.targetProperty));for(const A of O){const O=M.animations.indexOf(A,0);O>-1&&M.animations.splice(O,1)}}M.animations=M.animations.concat(c.animations)}}const Q=[],X=this.animationGroups.slice();for(const c of X){Q.push(c.clone(c.name,S));for(const M of c.animatables)M.stop()}for(const c of A){const A=S(c.target);A&&(M.beginAnimation(A,c.fromFrame,c.toFrame,c.loopAnimation,c.speedRatio,c.onAnimationEnd?c.onAnimationEnd:void 0,void 0,!0,void 0,c.onAnimationLoop?c.onAnimationLoop:void 0),M.stopAnimation(c.target))}return Q}populateRootNodes(){this.rootNodes.length=0;for(const M of this.meshes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.transformNodes)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.lights)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M);for(const M of this.cameras)M.parent||-1!==this.rootNodes.indexOf(M)||this.rootNodes.push(M)}addAllAssetsToContainer(M){if(!M)return;const A=[],O=new Set;for(A.push(M);A.length>0;){const M=A.pop();if(M instanceof c.d?(M.wc&&-1===this.geometries.indexOf(M.wc)&&this.geometries.push(M.wc),this.meshes.push(M)):M instanceof T.e?this.meshes.push(M):M instanceof j.e?this.transformNodes.push(M):M instanceof J.d?this.lights.push(M):M instanceof K.c&&this.cameras.push(M),M instanceof B.d){if(M.material&&-1===this.materials.indexOf(M.material)){this.materials.push(M.material);for(const A of M.material.getActiveTextures())-1===this.textures.indexOf(A)&&this.textures.push(A)}M.skeleton&&-1===this.skeletons.indexOf(M.skeleton)&&this.skeletons.push(M.skeleton),M.morphTargetManager&&-1===this.morphTargetManagers.indexOf(M.morphTargetManager)&&this.morphTargetManagers.push(M.morphTargetManager)}for(const S of M.getChildren())O.has(S)||A.push(S);O.add(M)}this.populateRootNodes()}_getByTags(M,A,O){if(void 0===A)return M;const S=[];for(const z in M){const Q=M[z];G.b&&G.b.MatchesQuery(Q,A)&&(!O||O(Q))&&S.push(Q)}return S}getMeshesByTags(M,A){return this._getByTags(this.meshes,M,A)}getCamerasByTags(M,A){return this._getByTags(this.cameras,M,A)}getLightsByTags(M,A){return this._getByTags(this.lights,M,A)}getMaterialsByTags(M,A){return this._getByTags(this.materials,M,A).concat(this._getByTags(this.multiMaterials,M,A))}getTransformNodesByTags(M,A){return this._getByTags(this.transformNodes,M,A)}}var s=O(12829);class Y{constructor(M){this.byteOffset=0,this.buffer=M}async loadAsync(M){const A=await this.buffer.readAsync(this.byteOffset,M);this._dataView=new DataView(A.buffer,A.byteOffset,A.byteLength),this._dataByteOffset=0}readUint32(){const M=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,M}readUint8Array(M){const A=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,M);return this._dataByteOffset+=M,this.byteOffset+=M,A}readString(M){return(0,s.f)(this.readUint8Array(M))}skipBytes(M){this._dataByteOffset+=M,this.byteOffset+=M}}var E=O(14175);const H="Z2xURg",C={name:"Xc",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:M=>-1!==M.indexOf("asset")&&-1!==M.indexOf("version")||M.startsWith("data:base64,"+H)||M.startsWith("data:;base64,"+H)||M.startsWith("data:application/octet-stream;base64,"+H)||M.startsWith("data:model/gltf-binary;base64,"+H)};var f,D,F,N=O(12813),y=O(12821);function h(M,A,O){try{return Promise.resolve(new Uint8Array(M,A,O))}catch(S){return Promise.reject(S)}}!function(M){M[M.AUTO=0]="AUTO",M[M.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(f||(f={})),function(M){M[M.NONE=0]="NONE",M[M.FIRST=1]="FIRST",M[M.ALL=2]="ALL"}(D||(D={})),function(M){M[M.LOADING=0]="LOADING",M[M.READY=1]="READY",M[M.COMPLETE=2]="COMPLETE"}(F||(F={}));class u{constructor(){this.coordinateSystemMode=f.AUTO,this.animationStartMode=D.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=M=>Promise.resolve(M),this.extensionOptions={}}S(M){var A,O,S,z,Q,X,c,j,B,g,e,T,J,K,G,d,w,I,b,s,Y;M&&(this.onParsed=M.onParsed,this.coordinateSystemMode=null!==(A=M.coordinateSystemMode)&&void 0!==A?A:this.coordinateSystemMode,this.animationStartMode=null!==(O=M.animationStartMode)&&void 0!==O?O:this.animationStartMode,this.loadNodeAnimations=null!==(S=M.loadNodeAnimations)&&void 0!==S?S:this.loadNodeAnimations,this.loadSkins=null!==(z=M.loadSkins)&&void 0!==z?z:this.loadSkins,this.loadMorphTargets=null!==(Q=M.loadMorphTargets)&&void 0!==Q?Q:this.loadMorphTargets,this.compileMaterials=null!==(X=M.compileMaterials)&&void 0!==X?X:this.compileMaterials,this.useClipPlane=null!==(c=M.useClipPlane)&&void 0!==c?c:this.useClipPlane,this.compileShadowGenerators=null!==(j=M.compileShadowGenerators)&&void 0!==j?j:this.compileShadowGenerators,this.transparencyAsCoverage=null!==(B=M.transparencyAsCoverage)&&void 0!==B?B:this.transparencyAsCoverage,this.useRangeRequests=null!==(g=M.useRangeRequests)&&void 0!==g?g:this.useRangeRequests,this.createInstances=null!==(e=M.createInstances)&&void 0!==e?e:this.createInstances,this.alwaysComputeBoundingBox=null!==(T=M.alwaysComputeBoundingBox)&&void 0!==T?T:this.alwaysComputeBoundingBox,this.loadAllMaterials=null!==(J=M.loadAllMaterials)&&void 0!==J?J:this.loadAllMaterials,this.loadOnlyMaterials=null!==(K=M.loadOnlyMaterials)&&void 0!==K?K:this.loadOnlyMaterials,this.skipMaterials=null!==(G=M.skipMaterials)&&void 0!==G?G:this.skipMaterials,this.useSRGBBuffers=null!==(d=M.useSRGBBuffers)&&void 0!==d?d:this.useSRGBBuffers,this.targetFps=null!==(w=M.targetFps)&&void 0!==w?w:this.targetFps,this.alwaysComputeSkeletonRootNode=null!==(I=M.alwaysComputeSkeletonRootNode)&&void 0!==I?I:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=null!==(b=M.useGltfTextureNames)&&void 0!==b?b:this.useGltfTextureNames,this.preprocessUrlAsync=null!==(s=M.preprocessUrlAsync)&&void 0!==s?s:this.preprocessUrlAsync,this.customRootNode=M.customRootNode,this.onMeshLoaded=M.onMeshLoaded,this.onSkinLoaded=M.onSkinLoaded,this.onTextureLoaded=M.onTextureLoaded,this.onMaterialLoaded=M.onMaterialLoaded,this.onCameraLoaded=M.onCameraLoaded,this.extensionOptions=null!==(Y=M.extensionOptions)&&void 0!==Y?Y:this.extensionOptions)}}class i extends u{constructor(M){super(),this.onParsedObservable=new S.c,this.onMeshLoadedObservable=new S.c,this.onSkinLoadedObservable=new S.c,this.onTextureLoadedObservable=new S.c,this.onMaterialLoadedObservable=new S.c,this.onCameraLoadedObservable=new S.c,this.onCompleteObservable=new S.c,this.onErrorObservable=new S.c,this.Ac=new S.c,this.onExtensionLoadedObservable=new S.c,this.validate=!1,this.onValidatedObservable=new S.c,this._loader=null,this._state=null,this._requests=new Array,this.name=C.name,this.extensions=C.extensions,this.onLoaderStateChangedObservable=new S.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.S(M)}set onParsed(M){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),M&&(this._onParsedObserver=this.onParsedObservable.add(M))}set onMeshLoaded(M){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),M&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(M))}set onSkinLoaded(M){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),M&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((A=>M(A.node,A.skinnedNode))))}set onTextureLoaded(M){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),M&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(M))}set onMaterialLoaded(M){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),M&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(M))}set onCameraLoaded(M){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),M&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(M))}set onComplete(M){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(M)}set onError(M){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(M)}set onDispose(M){this._onDisposeObserver&&this.Ac.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ac.add(M)}set onExtensionLoaded(M){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(M)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(M){this._loggingEnabled!==M&&(this._loggingEnabled=M,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(M){this._capturePerformanceCounters!==M&&(this._capturePerformanceCounters=M,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(M){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(M)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const M of this._requests)M.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=M=>Promise.resolve(M),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ac.notifyObservers(void 0),this.Ac.clear()}loadFile(M,A,O,Q,X,c,j,B){if(ArrayBuffer.isView(A))return this._loadBinary(M,A,O,Q,j,B),null;this._progressCallback=X;const e=A.name||z.Tools.GetFilename(A);if(c){if(this.useRangeRequests){this.validate&&g.c.Warn("glTF validation is not supported when range requests are enabled");const O={abort:()=>{},onCompleteObservable:new S.c},z={readAsync:(O,S)=>new Promise(((z,Q)=>{this._loadFile(M,A,(M=>{z(new Uint8Array(M))}),!0,(M=>{Q(M)}),(M=>{M.setRequestHeader("Range","bytes=".concat(O,"-").concat(O+S-1))}))})),byteLength:0};return this._unpackBinaryAsync(new Y(z)).then((M=>{O.onCompleteObservable.notifyObservers(O),Q(M)}),j?M=>j(void 0,M):void 0),O}return this._loadFile(M,A,(A=>{this._validate(M,new Uint8Array(A,0,A.byteLength),O,e),this._unpackBinaryAsync(new Y({readAsync:(M,O)=>h(A,M,O),byteLength:A.byteLength})).then((M=>{Q(M)}),j?M=>j(void 0,M):void 0)}),!0,j)}return this._loadFile(M,A,(A=>{try{this._validate(M,A,O,e),Q({json:this._parseJson(A)})}catch(S){j&&j()}}),!1,j)}_loadBinary(M,A,O,S,z,Q){this._validate(M,new Uint8Array(A.buffer,A.byteOffset,A.byteLength),O,Q),this._unpackBinaryAsync(new Y({readAsync:(M,O)=>function(M,A,O){try{if(A<0||A>=M.byteLength)throw new RangeError("Offset is out of range.");if(A+O>M.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(M.buffer,M.byteOffset+A,O))}catch(S){return Promise.reject(S)}}(A,M,O),byteLength:A.byteLength})).then((M=>{S(M)}),z?M=>z(void 0,M):void 0)}importMeshAsync(M,A,O,S,z,Q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(O),this.onParsedObservable.clear(),this._log("Loading ".concat(Q||"")),this._loader=this._getLoader(O),this._loader.importMeshAsync(M,A,null,O,S,z,Q))))}loadAsync(M,A,O,S,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log("Loading ".concat(z||"")),this._loader=this._getLoader(A),this._loader.loadAsync(M,A,O,S,z))))}loadAssetContainerAsync(M,A,O,S,z){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log("Loading ".concat(z||"")),this._loader=this._getLoader(A);const Q=new b(M),X=[];this.onMaterialLoadedObservable.add((M=>{X.push(M)}));const c=[];this.onTextureLoadedObservable.add((M=>{c.push(M)}));const j=[];this.onCameraLoadedObservable.add((M=>{j.push(M)}));const B=[];return this.onMeshLoadedObservable.add((M=>{M.morphTargetManager&&B.push(M.morphTargetManager)})),this._loader.importMeshAsync(null,M,Q,A,O,S,z).then((M=>(Array.prototype.push.apply(Q.geometries,M.geometries),Array.prototype.push.apply(Q.meshes,M.meshes),Array.prototype.push.apply(Q.TJ,M.TJ),Array.prototype.push.apply(Q.skeletons,M.skeletons),Array.prototype.push.apply(Q.animationGroups,M.animationGroups),Array.prototype.push.apply(Q.materials,X),Array.prototype.push.apply(Q.textures,c),Array.prototype.push.apply(Q.lights,M.lights),Array.prototype.push.apply(Q.transformNodes,M.transformNodes),Array.prototype.push.apply(Q.cameras,j),Array.prototype.push.apply(Q.morphTargetManagers,B),Q)))}))}canDirectLoad(M){return C.canDirectLoad(M)}directLoad(M,A){if(A.startsWith("base64,"+H)||A.startsWith(";base64,"+H)||A.startsWith("application/octet-stream;base64,"+H)||A.startsWith("model/gltf-binary;base64,"+H)){const O=(0,N.b)(A);return this._validate(M,new Uint8Array(O,0,O.byteLength)),this._unpackBinaryAsync(new Y({readAsync:(M,A)=>h(O,M,A),byteLength:O.byteLength}))}return this._validate(M,A),Promise.resolve({json:this._parseJson(A)})}createPlugin(M){return new i(M[C.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((M,A)=>{this.onCompleteObservable.addOnce((()=>{M()})),this.onErrorObservable.addOnce((M=>{A(M)}))}))}_setState(M){this._state!==M&&(this._state=M,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))}_loadFile(M,A,O,S,z,Q){const X=M._loadFile(A,O,(M=>{this._onProgress(M,X)}),!0,S,z,Q);return X.onCompleteObservable.add((()=>{X._lengthComputable=!0,X._total=X._loaded})),this._requests.push(X),X}_onProgress(M,A){if(!this._progressCallback)return;A._lengthComputable=M.lengthComputable,A._loaded=M.loaded,A._total=M.total;let O=!0,S=0,z=0;for(const Q of this._requests){if(void 0===Q._lengthComputable||void 0===Q._loaded||void 0===Q._total)return;O=O&&Q._lengthComputable,S+=Q._loaded,z+=Q._total}this._progressCallback({lengthComputable:O,loaded:S,total:O?z:0})}_validate(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),E.e.ValidateAsync(A,O,S,(A=>this.preprocessUrlAsync(O+A).then((A=>M._loadFileAsync(A,void 0,!0,!0).then((M=>new Uint8Array(M,0,M.byteLength))))))).then((M=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(M),this.onValidatedObservable.clear()}),(M=>{this._endPerformanceCounter("Validate JSON"),z.Tools.Warn("Failed to validate: ".concat(M.message)),this.onValidatedObservable.clear()})))}_getLoader(M){const A=M.json.asset||{};this._log("Asset version: ".concat(A.version)),A.minVersion&&this._log("Asset minimum version: ".concat(A.minVersion)),A.generator&&this._log("Asset generator: ".concat(A.generator));const O=i._parseVersion(A.version);if(!O)throw new Error("Invalid version: "+A.version);if(void 0!==A.minVersion){const M=i._parseVersion(A.minVersion);if(!M)throw new Error("Invalid minimum version: "+A.minVersion);if(i._compareVersion(M,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+A.minVersion)}const S={1:i._CreateGLTF1Loader,2:i._CreateGLTF2Loader}[O.major];if(!S)throw new Error("Unsupported version: "+A.version);return S(this)}_parseJson(M){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(M.length));const A=JSON.parse(M);return this._endPerformanceCounter("Parse JSON"),A}_unpackBinaryAsync(M){return this._startPerformanceCounter("Unpack Binary"),M.loadAsync(20).then((()=>{const A=M.readUint32();if(1179937895!==A)throw new y.i("Unexpected magic: "+A,y.e.GLTFLoaderUnexpectedMagicError);const O=M.readUint32();this.loggingEnabled&&this._log("Binary version: ".concat(O));const S=M.readUint32();let z;switch(this.useRangeRequests||S===M.buffer.byteLength||g.c.Warn("Length in header does not match actual data length: ".concat(S," != ").concat(M.buffer.byteLength)),O){case 1:z=this._unpackBinaryV1Async(M,S);break;case 2:z=this._unpackBinaryV2Async(M,S);break;default:throw new Error("Unsupported version: "+O)}return this._endPerformanceCounter("Unpack Binary"),z}))}_unpackBinaryV1Async(M,A){const O=M.readUint32(),S=M.readUint32();if(0!==S)throw new Error("Unexpected content format: ".concat(S));const z=A-M.byteOffset,Q={json:this._parseJson(M.readString(O)),bin:null};if(0!==z){const A=M.byteOffset;Q.bin={readAsync:(O,S)=>M.buffer.readAsync(A+O,S),byteLength:z}}return Promise.resolve(Q)}_unpackBinaryV2Async(M,A){const O=1313821514,S=5130562,z=M.readUint32();if(M.readUint32()!==O)throw new Error("First chunk format is not JSON");return M.byteOffset+z===A?M.loadAsync(z).then((()=>({json:this._parseJson(M.readString(z)),bin:null}))):M.loadAsync(z+8).then((()=>{const Q={json:this._parseJson(M.readString(z)),bin:null},X=()=>{const z=M.readUint32();switch(M.readUint32()){case O:throw new Error("Unexpected JSON chunk");case S:{const A=M.byteOffset;Q.bin={readAsync:(O,S)=>M.buffer.readAsync(A+O,S),byteLength:z},M.skipBytes(z);break}default:M.skipBytes(z)}return M.byteOffset!==A?M.loadAsync(8).then(X):Promise.resolve(Q)};return X()}))}static _parseVersion(M){if("1.0"===M||"1.0.1"===M)return{major:1,minor:0};const A=(M+"").match(/^(\d+)\.(\d+)/);return A?{major:parseInt(A[1]),minor:parseInt(A[2])}:null}static _compareVersion(M,A){return M.major>A.major?1:M.major<A.major?-1:M.minor>A.minor?1:M.minor<A.minor?-1:0}_logOpen(M){this._log(M),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(M){const A=i._logSpaces.substring(0,2*this._logIndentLevel);g.c.Log("".concat(A).concat(M))}_logDisabled(M){}_startPerformanceCounterEnabled(M){z.Tools.StartPerformanceCounter(M)}_startPerformanceCounterDisabled(M){}_endPerformanceCounterEnabled(M){z.Tools.EndPerformanceCounter(M)}_endPerformanceCounterDisabled(M){}}i.IncrementalLoading=!0,i.HomogeneousCoordinates=!1,i._logSpaces="                                ",(0,Q.c)(new i)},14175:(M,A,O)=>{"use strict";O.d(A,{e:()=>X});var S=O(12768);function z(M,A,O,S){const z={externalResourceFunction:S};return O&&(z.uri="file:"===A?O:A+O),ArrayBuffer.isView(M)?GLTFValidator.validateBytes(M,z):GLTFValidator.validateString(M,z)}function Q(){const M=[];onmessage=A=>{const O=A.data;switch(O.id){case"init":importScripts(O.url);break;case"validate":z(O.data,O.rootUrl,O.fileName,(A=>new Promise(((O,S)=>{const z=M.length;M.push({resolve:O,reject:S}),postMessage({id:"getExternalResource",index:z,uri:A})})))).then((M=>{postMessage({id:"validate.resolve",value:M})}),(M=>{postMessage({id:"validate.reject",reason:M})}));break;case"getExternalResource.resolve":M[O.index].resolve(O.value);break;case"getExternalResource.reject":M[O.index].reject(O.reason)}}}class X{static ValidateAsync(M,A,O,X){return"function"===typeof Worker?new Promise(((c,j)=>{const B="".concat(z,"(").concat(Q,")()"),g=URL.createObjectURL(new Blob([B],{type:"application/javascript"})),e=new Worker(g),T=M=>{e.removeEventListener("error",T),e.removeEventListener("message",J),j(M)},J=M=>{const A=M.data;switch(A.id){case"getExternalResource":X(A.uri).then((M=>{e.postMessage({id:"getExternalResource.resolve",index:A.index,value:M},[M.buffer])}),(M=>{e.postMessage({id:"getExternalResource.reject",index:A.index,reason:M})}));break;case"validate.resolve":e.removeEventListener("error",T),e.removeEventListener("message",J),c(A.value),e.terminate();break;case"validate.reject":e.removeEventListener("error",T),e.removeEventListener("message",J),j(A.reason),e.terminate()}};if(e.addEventListener("error",T),e.addEventListener("message",J),e.postMessage({id:"init",url:S.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(M)){const S=M.slice();e.postMessage({id:"validate",data:S,rootUrl:A,fileName:O},[S.buffer])}else e.postMessage({id:"validate",data:M,rootUrl:A,fileName:O})})):(this._LoadScriptPromise||(this._LoadScriptPromise=S.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>z(M,A,O,X))))}}X.Configuration={url:"".concat(S.Tools._DefaultCdnUrl,"/gltf_validator.js")}},14783:(M,A,O)=>{"use strict";O.d(A,{b:()=>H});var S=O(12958),z=O(12964),Q=O(12998),X=O(12970),c=O(13350),j=O(13278),B=O(13043),g=O(13214),e=O(12919),T=O(12864);O(13956),O(13869),O(13886),O(13876),O(13895),O(13900),O(13907);const J="imageProcessingCompatibility",K="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";T.c.IncludesShadersStore[J]||(T.c.IncludesShadersStore[J]=K);const G="skyPixelShader",d="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";T.c.ShadersStore[G]||(T.c.ShadersStore[G]=d);O(13972),O(13914),O(13922),O(13926),O(13924);const w="skyVertexShader",I="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";T.c.ShadersStore[w]||(T.c.ShadersStore[w]=I);var b=O(13271),s=O(13329),Y=O(13322);class E extends c.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class H extends j.e{constructor(M,A){super(M,A),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new X.GA(0,100,0),this.useSunPosition=!1,this.cameraOffset=X.GA.Zero(),this.up=X.GA.Up(),this.dithering=!1,this._cameraPosition=X.GA.Zero(),this._skyOrientation=new X.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(M,A){const O=A._drawWrapper;if(this.isFrozen&&O.effect&&O._wasPreviouslyReady)return!0;A.materialDefines||(A.materialDefines=new E);const S=A.materialDefines,z=this.HM();if(this._isReadyForSubMesh(A))return!0;if((0,Y.W)(M,z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,S),(0,Y.K)(M,S,!0,!1),S.IMAGEPROCESSINGPOSTPROCESS!==z.imageProcessingConfiguration.applyByPostProcess&&S.markAsMiscDirty(),S.DITHER!==this.dithering&&S.markAsMiscDirty(),S.isDirty){S.markAsProcessed(),z.resetCachedMaterial();const M=new b.b;S.FOG&&M.addFallback(1,"FOG"),S.IMAGEPROCESSINGPOSTPROCESS=z.imageProcessingConfiguration.applyByPostProcess,S.DITHER=this.dithering;const O=[B.c.PositionKind];S.VERTEXCOLOR&&O.push(B.c.ColorKind);const Q="sky",X=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,s.b)(X);const c=S.toString();A.setEffect(z.getEngine().createEffect(Q,O,X,[],c,M,this.onCompiled,this.onError),S,this._materialContext)}return!(!A.effect||!A.effect.isReady())&&(S._renderId=z.getRenderId(),O._wasPreviouslyReady=!0,!0)}bindForSubMesh(M,A,O){const S=this.HM(),z=O.materialDefines;if(!z)return;const Q=O.effect;if(!Q)return;this._activeEffect=Q,this.bindOnlyWorldMatrix(M),this._activeEffect.setMatrix("viewProjection",S.getTransformMatrix()),this._mustRebind(S,Q,O)&&((0,s.d)(Q,this,S),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Y.g)(z,Q,S)),S.fogEnabled&&A.applyFog&&S.fogMode!==g.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",S.getViewMatrix()),(0,Y.d)(S,A,this._activeEffect);const c=S.activeCamera;if(c){const M=c.getWorldMatrix();this._cameraPosition.x=M.m[12],this._cameraPosition.y=M.m[13],this._cameraPosition.z=M.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const M=Math.PI*(this.inclination-.5),A=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(A)*Math.cos(M),this.sunPosition.y=this.distance*Math.sin(-M),this.sunPosition.z=this.distance*Math.sin(A)*Math.cos(M),X.Quaternion.FromUnitVectorsToRef(X.GA.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(A,this._activeEffect,O)}getAnimatables(){return[]}dispose(M){super.dispose(M)}clone(M){return Q.e.Clone((()=>new H(M,this.HM())),this)}serialize(){const M=super.serialize();return M.customType="BABYLON.SkyMaterial",M}getClassName(){return"SkyMaterial"}static Parse(M,A,O){return Q.e.Parse((()=>new H(M.name,A)),M,A,O)}}(0,S.d)([(0,z.H)()],H.prototype,"luminance",void 0),(0,S.d)([(0,z.H)()],H.prototype,"turbidity",void 0),(0,S.d)([(0,z.H)()],H.prototype,"rayleigh",void 0),(0,S.d)([(0,z.H)()],H.prototype,"mieCoefficient",void 0),(0,S.d)([(0,z.H)()],H.prototype,"mieDirectionalG",void 0),(0,S.d)([(0,z.H)()],H.prototype,"distance",void 0),(0,S.d)([(0,z.H)()],H.prototype,"inclination",void 0),(0,S.d)([(0,z.H)()],H.prototype,"azimuth",void 0),(0,S.d)([(0,z.D)()],H.prototype,"sunPosition",void 0),(0,S.d)([(0,z.H)()],H.prototype,"useSunPosition",void 0),(0,S.d)([(0,z.D)()],H.prototype,"cameraOffset",void 0),(0,S.d)([(0,z.D)()],H.prototype,"up",void 0),(0,S.d)([(0,z.H)()],H.prototype,"dithering",void 0),(0,e.g)("BABYLON.SkyMaterial",H)},13654:(M,A,O)=>{"use strict";function S(M,A){A.headers=M.headers||{},A.statusMessage=M.statusText,A.statusCode=M.status,A.data=M.response}function z(M,A,O){return new Promise((function(z,Q){O=O||{};var X,c,j,B=new XMLHttpRequest,g=O.body,e=O.headers||{};for(X in O.timeout&&(B.timeout=O.timeout),B.ontimeout=B.onerror=function(M){M.timeout="timeout"==M.type,Q(M)},B.open(M,A.href||A),B.onload=function(){for(j=B.getAllResponseHeaders().trim().split(/[\r\n]+/),S(B,B);c=j.shift();)c=c.split(": "),B.headers[c.shift().toLowerCase()]=c.join(": ");if((c=B.headers["content-type"])&&~c.indexOf("application/json"))try{B.data=JSON.parse(B.data,O.reviver)}catch(M){return S(B,M),Q(M)}(B.status>=400?Q:z)(B)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(e["content-type"]="application/json",g=JSON.stringify(g)),B.withCredentials=!!O.withCredentials,e)B.setRequestHeader(X,e[X]);B.send(g)}))}O.r(A),O.d(A,{del:()=>j,get:()=>Q,patch:()=>c,post:()=>X,put:()=>B,send:()=>z});var Q=z.bind(z,"GET"),X=z.bind(z,"POST"),c=z.bind(z,"PATCH"),j=z.bind(z,"DELETE"),B=z.bind(z,"PUT")},14898:(M,A,O)=>{"use strict";O.d(A,{b:()=>e});const S=.5*(Math.sqrt(3)-1),z=(3-Math.sqrt(3))/6,Q=1/3,X=1/6,c=(Math.sqrt(5)-1)/4,j=(5-Math.sqrt(5))/20,B=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),g=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const e=class{constructor(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const A="function"==typeof M?M:function(M){let A=0,O=0,S=0,z=1;const Q=function(){let M=4022871197;return function(A){A=A.toString();for(let O=0;O<A.length;O++){M+=A.charCodeAt(O);let S=.02519603282416938*M;M=S>>>0,S-=M,S*=M,M=S>>>0,S-=M,M+=4294967296*S}return 2.3283064365386963e-10*(M>>>0)}}();A=Q(" "),O=Q(" "),S=Q(" "),A-=Q(M),A<0&&(A+=1);O-=Q(M),O<0&&(O+=1);S-=Q(M),S<0&&(S+=1);return function(){const M=2091639*A+2.3283064365386963e-10*z;return A=O,O=S,S=M-(z=0|M)}}(M);this.p=function(M){const A=new Uint8Array(256);for(let O=0;O<256;O++)A[O]=O;for(let O=0;O<255;O++){const S=O+~~(M()*(256-O)),z=A[O];A[O]=A[S],A[S]=z}return A}(A),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let O=0;O<512;O++)this.perm[O]=this.p[255&O],this.permMod12[O]=this.perm[O]%12}noise2D(M,A){const O=this.permMod12,Q=this.perm;let X=0,c=0,j=0;const g=(M+A)*S,e=Math.floor(M+g),T=Math.floor(A+g),J=(e+T)*z,K=M-(e-J),G=A-(T-J);let d,w;K>G?(d=1,w=0):(d=0,w=1);const I=K-d+z,b=G-w+z,s=K-1+2*z,Y=G-1+2*z,E=255&e,H=255&T;let C=.5-K*K-G*G;if(C>=0){const M=3*O[E+Q[H]];C*=C,X=C*C*(B[M]*K+B[M+1]*G)}let f=.5-I*I-b*b;if(f>=0){const M=3*O[E+d+Q[H+w]];f*=f,c=f*f*(B[M]*I+B[M+1]*b)}let D=.5-s*s-Y*Y;if(D>=0){const M=3*O[E+1+Q[H+1]];D*=D,j=D*D*(B[M]*s+B[M+1]*Y)}return 70*(X+c+j)}noise3D(M,A,O){const S=this.permMod12,z=this.perm;let c,j,g,e;const T=(M+A+O)*Q,J=Math.floor(M+T),K=Math.floor(A+T),G=Math.floor(O+T),d=(J+K+G)*X,w=M-(J-d),I=A-(K-d),b=O-(G-d);let s,Y,E,H,C,f;w>=I?I>=b?(s=1,Y=0,E=0,H=1,C=1,f=0):w>=b?(s=1,Y=0,E=0,H=1,C=0,f=1):(s=0,Y=0,E=1,H=1,C=0,f=1):I<b?(s=0,Y=0,E=1,H=0,C=1,f=1):w<b?(s=0,Y=1,E=0,H=0,C=1,f=1):(s=0,Y=1,E=0,H=1,C=1,f=0);const D=w-s+X,F=I-Y+X,N=b-E+X,y=w-H+2*X,h=I-C+2*X,u=b-f+2*X,i=w-1+.5,U=I-1+.5,L=b-1+.5,t=255&J,x=255&K,o=255&G;let p=.6-w*w-I*I-b*b;if(p<0)c=0;else{const M=3*S[t+z[x+z[o]]];p*=p,c=p*p*(B[M]*w+B[M+1]*I+B[M+2]*b)}let v=.6-D*D-F*F-N*N;if(v<0)j=0;else{const M=3*S[t+s+z[x+Y+z[o+E]]];v*=v,j=v*v*(B[M]*D+B[M+1]*F+B[M+2]*N)}let q=.6-y*y-h*h-u*u;if(q<0)g=0;else{const M=3*S[t+H+z[x+C+z[o+f]]];q*=q,g=q*q*(B[M]*y+B[M+1]*h+B[M+2]*u)}let r=.6-i*i-U*U-L*L;if(r<0)e=0;else{const M=3*S[t+1+z[x+1+z[o+1]]];r*=r,e=r*r*(B[M]*i+B[M+1]*U+B[M+2]*L)}return 32*(c+j+g+e)}noise4D(M,A,O,S){const z=this.perm;let Q,X,B,e,T;const J=(M+A+O+S)*c,K=Math.floor(M+J),G=Math.floor(A+J),d=Math.floor(O+J),w=Math.floor(S+J),I=(K+G+d+w)*j,b=M-(K-I),s=A-(G-I),Y=O-(d-I),E=S-(w-I);let H=0,C=0,f=0,D=0;b>s?H++:C++,b>Y?H++:f++,b>E?H++:D++,s>Y?C++:f++,s>E?C++:D++,Y>E?f++:D++;const F=H>=3?1:0,N=C>=3?1:0,y=f>=3?1:0,h=D>=3?1:0,u=H>=2?1:0,i=C>=2?1:0,U=f>=2?1:0,L=D>=2?1:0,t=H>=1?1:0,x=C>=1?1:0,o=f>=1?1:0,p=D>=1?1:0,v=b-F+j,q=s-N+j,r=Y-y+j,n=E-h+j,a=b-u+2*j,V=s-i+2*j,Z=Y-U+2*j,P=E-L+2*j,mM=b-t+3*j,R=s-x+3*j,k=Y-o+3*j,W=E-p+3*j,l=b-1+4*j,MM=s-1+4*j,AM=Y-1+4*j,OM=E-1+4*j,SM=255&K,zM=255&G,QM=255&d,XM=255&w;let cM=.6-b*b-s*s-Y*Y-E*E;if(cM<0)Q=0;else{const M=z[SM+z[zM+z[QM+z[XM]]]]%32*4;cM*=cM,Q=cM*cM*(g[M]*b+g[M+1]*s+g[M+2]*Y+g[M+3]*E)}let jM=.6-v*v-q*q-r*r-n*n;if(jM<0)X=0;else{const M=z[SM+F+z[zM+N+z[QM+y+z[XM+h]]]]%32*4;jM*=jM,X=jM*jM*(g[M]*v+g[M+1]*q+g[M+2]*r+g[M+3]*n)}let BM=.6-a*a-V*V-Z*Z-P*P;if(BM<0)B=0;else{const M=z[SM+u+z[zM+i+z[QM+U+z[XM+L]]]]%32*4;BM*=BM,B=BM*BM*(g[M]*a+g[M+1]*V+g[M+2]*Z+g[M+3]*P)}let gM=.6-mM*mM-R*R-k*k-W*W;if(gM<0)e=0;else{const M=z[SM+t+z[zM+x+z[QM+o+z[XM+p]]]]%32*4;gM*=gM,e=gM*gM*(g[M]*mM+g[M+1]*R+g[M+2]*k+g[M+3]*W)}let eM=.6-l*l-MM*MM-AM*AM-OM*OM;if(eM<0)T=0;else{const M=z[SM+1+z[zM+1+z[QM+1+z[XM+1]]]]%32*4;eM*=eM,T=eM*eM*(g[M]*l+g[M+1]*MM+g[M+2]*AM+g[M+3]*OM)}return 27*(Q+X+B+e+T)}}}}]);