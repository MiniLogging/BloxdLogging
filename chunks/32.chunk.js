/*! For license information please see evjp7s.32.679c208d.chunk.js.LICENSE.txt */
(self.ex92n20nlz8=self.ex92n20nlz8||[]).push([[32],{14551:(I,g,b)=>{"use strict";var e=b(14556),c=b(14560),z=b(14567);b.g.__TYPEDARRAY_POOL||(b.g.__TYPEDARRAY_POOL={UINT8:c([32,0]),UINT16:c([32,0]),UINT32:c([32,0]),INT8:c([32,0]),INT16:c([32,0]),INT32:c([32,0]),FLOAT:c([32,0]),DOUBLE:c([32,0]),DATA:c([32,0]),UINT8C:c([32,0]),BUFFER:c([32,0])});var M="undefined"!==typeof Uint8ClampedArray,J=b.g.__TYPEDARRAY_POOL;J.UINT8C||(J.UINT8C=c([32,0])),J.BUFFER||(J.BUFFER=c([32,0]));var o=J.DATA,n=J.BUFFER;function G(I){if(I){var g=I.length||I.byteLength,b=e.log2(g);o[b].push(I)}}function D(I){I=e.nextPow2(I);var g=e.log2(I),b=o[g];return b.length>0?b.pop():new ArrayBuffer(I)}function p(I){return new Uint8Array(D(I),0,I)}function x(I){return new Uint16Array(D(2*I),0,I)}function Z(I){return new Uint32Array(D(4*I),0,I)}function k(I){return new Int8Array(D(I),0,I)}function S(I){return new Int16Array(D(2*I),0,I)}function f(I){return new Int32Array(D(4*I),0,I)}function V(I){return new Float32Array(D(4*I),0,I)}function a(I){return new Float64Array(D(8*I),0,I)}function v(I){return M?new Uint8ClampedArray(D(I),0,I):p(I)}function X(I){return new DataView(D(I),0,I)}g.free=function(I){if(z(I))n[e.log2(I.length)].push(I);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(I)&&(I=I.buffer),!I)return;var g=I.length||I.byteLength,b=0|e.log2(g);o[b].push(I)}},g.freeUint8=g.freeUint16=g.freeUint32=g.freeInt8=g.freeInt16=g.freeInt32=g.freeFloat32=g.freeFloat=g.freeFloat64=g.freeDouble=g.freeUint8Clamped=g.freeDataView=function(I){G(I.buffer)},g.freeArrayBuffer=G,g.freeBuffer=function(I){n[e.log2(I.length)].push(I)},g.malloc=function(I,g){if(void 0===g||"arraybuffer"===g)return D(I);switch(g){case"uint8":return p(I);case"uint16":return x(I);case"uint32":return Z(I);case"int8":return k(I);case"int16":return S(I);case"int32":return f(I);case"float":case"float32":return V(I);case"double":case"float64":return a(I);case"uint8_clamped":return v(I);case"buffer":throw"Buffer not supported";case"data":case"dataview":return X(I);default:return null}return null},g.mallocArrayBuffer=D,g.mallocUint8=p,g.mallocUint16=x,g.mallocUint32=Z,g.mallocInt8=k,g.mallocInt16=S,g.mallocInt32=f,g.mallocFloat32=g.mallocFloat=V,g.mallocFloat64=g.mallocDouble=a,g.mallocUint8Clamped=v,g.mallocDataView=X,g.clearCache=function(){for(var I=0;I<32;++I)J.UINT8[I].length=0,J.UINT16[I].length=0,J.UINT32[I].length=0,J.INT8[I].length=0,J.INT16[I].length=0,J.INT32[I].length=0,J.FLOAT[I].length=0,J.DOUBLE[I].length=0,J.UINT8C[I].length=0,o[I].length=0,n[I].length=0}},14650:(I,g,b)=>{I.exports=c;var e=b(13385);function c(I,g){if(!(this instanceof c))return new c(I,g);var b=e.create();e.add(b,I,g),this.base=e.min(e.create(),I,b),this.CD=e.clone(g),this.max=e.max(e.create(),I,b),this.mag=e.length(this.CD)}var z=c.prototype;z.width=function(){return this.CD[0]},z.height=function(){return this.CD[1]},z.depth=function(){return this.CD[2]},z.x0=function(){return this.base[0]},z.y0=function(){return this.base[1]},z.z0=function(){return this.base[2]},z.x1=function(){return this.max[0]},z.y1=function(){return this.max[1]},z.z1=function(){return this.max[2]},z.translate=function(I){return e.add(this.max,this.max,I),e.add(this.base,this.base,I),this},z.setPosition=function(I){return e.add(this.max,I,this.CD),e.j(this.base,I),this},z.expand=function(I){var g=e.create(),b=e.create();return e.max(g,I.max,this.max),e.min(b,I.base,this.base),e.ag(g,g,b),new c(b,g)},z.intersects=function(I){return!(I.base[0]>this.max[0])&&(!(I.base[1]>this.max[1])&&(!(I.base[2]>this.max[2])&&(!(I.max[0]<this.base[0])&&(!(I.max[1]<this.base[1])&&!(I.max[2]<this.base[2])))))},z.touches=function(I){var g=this.union(I);return null!==g&&(0==g.width()||0==g.height()||0==g.depth())},z.union=function(I){if(!this.intersects(I))return null;var g=Math.max(I.base[0],this.base[0]),b=Math.max(I.base[1],this.base[1]),e=Math.max(I.base[2],this.base[2]);return new c([g,b,e],[Math.min(I.max[0],this.max[0])-g,Math.min(I.max[1],this.max[1])-b,Math.min(I.max[2],this.max[2])-e])}},14556:(I,g)=>{"use strict";function b(I){var g=32;return(I&=-I)&&g--,65535&I&&(g-=16),16711935&I&&(g-=8),252645135&I&&(g-=4),858993459&I&&(g-=2),1431655765&I&&(g-=1),g}g.INT_BITS=32,g.INT_MAX=2147483647,g.INT_MIN=-1<<31,g.sign=function(I){return(I>0)-(I<0)},g.abs=function(I){var g=I>>31;return(I^g)-g},g.min=function(I,g){return g^(I^g)&-(I<g)},g.max=function(I,g){return I^(I^g)&-(I<g)},g.isPow2=function(I){return!(I&I-1)&&!!I},g.log2=function(I){var g,b;return g=(I>65535)<<4,g|=b=((I>>>=g)>255)<<3,g|=b=((I>>>=b)>15)<<2,(g|=b=((I>>>=b)>3)<<1)|(I>>>=b)>>1},g.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},g.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},g.countTrailingZeros=b,g.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},g.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},g.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var e=new Array(256);!function(I){for(var g=0;g<256;++g){var b=g,e=g,c=7;for(b>>>=1;b;b>>>=1)e<<=1,e|=1&b,--c;I[g]=e<<c&255}}(e),g.reverse=function(I){return e[255&I]<<24|e[I>>>8&255]<<16|e[I>>>16&255]<<8|e[I>>>24&255]},g.interleave2=function(I,g){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))<<1},g.deinterleave2=function(I,g){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>g&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},g.interleave3=function(I,g,b){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},g.deinterleave3=function(I,g){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>g&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},g.nextCombination=function(I){var g=I|I-1;return g+1|(~g&-~g)-1>>>b(I)+1}},14547:(I,g,b)=>{"use strict";I.exports=function(I,g,b){switch(arguments.length){case 1:return e=[],n(c=I,c,G,!0),e;case 2:return"function"===typeof g?n(I,I,g,!0):function(I,g){return e=[],n(I,g,G,!1),e}(I,g);case 3:return n(I,g,b,!1);default:throw new Error("box-intersect: Invalid arguments")}var c};var e,c=b(14551),z=b(14570),M=b(14582);function J(I,g){for(var b=0;b<I;++b)if(!(g[b]<=g[b+I]))return!0;return!1}function o(I,g,b,e){for(var c=0,z=0,M=0,o=I.length;M<o;++M){var n=I[M];if(!J(g,n)){for(var G=0;G<2*g;++G)b[c++]=n[G];e[z++]=M}}return z}function n(I,g,b,e){var J=I.length,n=g.length;if(!(J<=0||n<=0)){var G=I[0].length>>>1;if(!(G<=0)){var D,p=c.mallocDouble(2*G*J),x=c.mallocInt32(J);if((J=o(I,G,p,x))>0){if(1===G&&e)z.init(J),D=z.sweepComplete(G,b,0,J,p,x,0,J,p,x);else{var Z=c.mallocDouble(2*G*n),k=c.mallocInt32(n);(n=o(g,G,Z,k))>0&&(z.init(J+n),D=1===G?z.sweepBipartite(G,b,0,J,p,x,0,n,Z,k):M(G,b,e,J,p,x,n,Z,k),c.free(Z),c.free(k))}c.free(p),c.free(x)}return D}}}function G(I,g){e.push([I,g])}},14591:(I,g)=>{"use strict";var b="d",e="ax",c="fp",z="es",M="rs",J="re",o="rb",n="bs",G="be",D="bb",p=[b,e,"vv",M,J,o,"ri",n,G,D,"bi"];function x(I){var g="bruteForce"+(I?"Full":"Partial"),e=[],M=p.slice();I||M.splice(3,0,c);var J=["function "+g+"("+M.join()+"){"];function o(g,c){var M=function(I,g,e){var c="bruteForce"+(I?"Red":"Blue")+(g?"Flip":"")+(e?"Full":""),M=["function ",c,"(",p.join(),"){","var ",z,"=2*",b,";"],J="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",o="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(e?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return I?M.push(J,"Q",":",o):M.push(o,"Q",":",J),e?M.push("if(y1<x0||x1<y0)continue;"):g?M.push("if(y0<=x0||x1<y0)continue;"):M.push("if(y0<x0||x1<y0)continue;"),M.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),g?M.push("yi,xi"):M.push("xi,yi"),M.push(");if(rv!==void 0)return rv;}}}"),{name:c,code:M.join("")}}(g,c,I);e.push(M.code),J.push("return "+M.name+"("+p.join()+");")}J.push("if(re-rs>be-bs){"),I?(o(!0,!1),J.push("}else{"),o(!1,!1)):(J.push("if(fp){"),o(!0,!0),J.push("}else{"),o(!0,!1),J.push("}}else{if(fp){"),o(!1,!0),J.push("}else{"),o(!1,!1),J.push("}")),J.push("}}return "+g);var n=e.join("")+J.join("");return new Function(n)()}g.partial=x(!1),g.full=x(!0)},14582:(I,g,b)=>{"use strict";I.exports=function(I,g,b,z,G,Y,d,C,r){!function(I,g){var b=8*c.log2(g+1)*(I+1)|0,z=c.nextPow2(v*b);R.length<z&&(e.free(R),R=e.mallocInt32(z));var M=c.nextPow2(X*b);E.length<M&&(e.free(E),E=e.mallocDouble(M))}(I,z+d);var O,H=0,i=2*I;mI(H++,0,0,z,0,d,b?16:0,-1/0,1/0),b||mI(H++,0,0,d,0,z,1,-1/0,1/0);for(;H>0;){var U=(H-=1)*v,h=R[U],A=R[U+1],j=R[U+2],Q=R[U+3],L=R[U+4],N=R[U+5],K=H*X,B=E[K],P=E[K+1],u=1&N,t=!!(16&N),y=G,q=Y,l=C,w=r;if(u&&(y=C,q=r,l=G,w=Y),!(2&N&&A>=(j=S(I,h,A,j,y,q,P)))&&!(4&N&&(A=f(I,h,A,j,y,q,B))>=j)){var T=j-A,W=L-Q;if(t){if(I*T*(T+W)<x){if(void 0!==(O=o.scanComplete(I,h,g,A,j,y,q,Q,L,l,w)))return O;continue}}else{if(I*Math.min(T,W)<D){if(void 0!==(O=M(I,h,g,u,A,j,y,q,Q,L,l,w)))return O;continue}if(I*T*W<p){if(void 0!==(O=o.scanBipartite(I,h,g,u,A,j,y,q,Q,L,l,w)))return O;continue}}var II=Z(I,h,A,j,y,q,B,P);if(A<II)if(I*(II-A)<D){if(void 0!==(O=J(I,h+1,g,A,II,y,q,Q,L,l,w)))return O}else if(h===I-2){if(void 0!==(O=u?o.sweepBipartite(I,g,Q,L,l,w,A,II,y,q):o.sweepBipartite(I,g,A,II,y,q,Q,L,l,w)))return O}else mI(H++,h+1,A,II,Q,L,u,-1/0,1/0),mI(H++,h+1,Q,L,A,II,1^u,-1/0,1/0);if(II<j){var gI=n(I,h,Q,L,l,w),bI=l[i*gI+h],eI=k(I,h,gI,L,l,w,bI);if(eI<L&&mI(H++,h,II,j,eI,L,(4|u)+(t?16:0),bI,P),Q<gI&&mI(H++,h,II,j,Q,gI,(2|u)+(t?16:0),B,bI),gI+1===eI){if(void 0!==(O=t?F(I,h,g,II,j,y,q,gI,l,w[gI]):s(I,h,g,u,II,j,y,q,gI,l,w[gI])))return O}else if(gI<eI){var cI;if(t){if(II<(cI=V(I,h,II,j,y,q,bI))){var zI=k(I,h,II,cI,y,q,bI);if(h===I-2){if(II<zI&&void 0!==(O=o.sweepComplete(I,g,II,zI,y,q,gI,eI,l,w)))return O;if(zI<cI&&void 0!==(O=o.sweepBipartite(I,g,zI,cI,y,q,gI,eI,l,w)))return O}else II<zI&&mI(H++,h+1,II,zI,gI,eI,16,-1/0,1/0),zI<cI&&(mI(H++,h+1,zI,cI,gI,eI,0,-1/0,1/0),mI(H++,h+1,gI,eI,zI,cI,1,-1/0,1/0))}}else II<(cI=u?a(I,h,II,j,y,q,bI):V(I,h,II,j,y,q,bI))&&(h===I-2?O=u?o.sweepBipartite(I,g,gI,eI,l,w,II,cI,y,q):o.sweepBipartite(I,g,II,cI,y,q,gI,eI,l,w):(mI(H++,h+1,II,cI,gI,eI,u,-1/0,1/0),mI(H++,h+1,gI,eI,II,cI,1^u,-1/0,1/0)))}}}}};var e=b(14551),c=b(14556),z=b(14591),M=z.partial,J=z.full,o=b(14570),n=b(14600),G=b(14605),D=128,p=1<<22,x=1<<22,Z=G("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),k=G("lo===p0",["p0"]),S=G("lo<p0",["p0"]),f=G("hi<=p0",["p0"]),V=G("lo<=p0&&p0<=hi",["p0"]),a=G("lo<p0&&p0<=hi",["p0"]),v=6,X=2,R=e.mallocInt32(1024),E=e.mallocDouble(1024);function mI(I,g,b,e,c,z,M,J,o){var n=v*I;R[n]=g,R[n+1]=b,R[n+2]=e,R[n+3]=c,R[n+4]=z,R[n+5]=M;var G=X*I;E[G]=J,E[G+1]=o}function s(I,g,b,e,c,z,M,J,o,n,G){var D=2*I,p=o*D,x=n[p+g];I:for(var Z=c,k=c*D;Z<z;++Z,k+=D){var S=M[k+g],f=M[k+g+I];if(!(x<S||f<x)&&(!e||x!==S)){for(var V,a=J[Z],v=g+1;v<I;++v){S=M[k+v],f=M[k+v+I];var X=n[p+v],R=n[p+v+I];if(f<X||R<S)continue I}if(void 0!==(V=e?b(G,a):b(a,G)))return V}}}function F(I,g,b,e,c,z,M,J,o,n){var G=2*I,D=J*G,p=o[D+g];I:for(var x=e,Z=e*G;x<c;++x,Z+=G){var k=M[x];if(k!==n){var S=z[Z+g],f=z[Z+g+I];if(!(p<S||f<p)){for(var V=g+1;V<I;++V){S=z[Z+V],f=z[Z+V+I];var a=o[D+V],v=o[D+V+I];if(f<a||v<S)continue I}var X=b(k,n);if(void 0!==X)return X}}}}},14600:(I,g,b)=>{"use strict";I.exports=function(I,g,b,M,J,o){if(M<=b+1)return b;var n=b,G=M,D=M+b>>>1,p=2*I,x=D,Z=J[p*D+g];for(;n<G;){if(G-n<c){z(I,g,n,G,J,o),Z=J[p*D+g];break}var k=G-n,S=Math.random()*k+n|0,f=J[p*S+g],V=Math.random()*k+n|0,a=J[p*V+g],v=Math.random()*k+n|0,X=J[p*v+g];f<=a?X>=a?(x=V,Z=a):f>=X?(x=S,Z=f):(x=v,Z=X):a>=X?(x=V,Z=a):X>=f?(x=S,Z=f):(x=v,Z=X);for(var R=p*(G-1),E=p*x,mI=0;mI<p;++mI,++R,++E){var s=J[R];J[R]=J[E],J[E]=s}var F=o[G-1];o[G-1]=o[x],o[x]=F;for(R=p*(G-1),E=p*(x=e(I,g,n,G-1,J,o,Z)),mI=0;mI<p;++mI,++R,++E){s=J[R];J[R]=J[E],J[E]=s}F=o[G-1];if(o[G-1]=o[x],o[x]=F,D<x){for(G=x-1;n<G&&J[p*(G-1)+g]===Z;)G-=1;G+=1}else{if(!(x<D))break;for(n=x+1;n<G&&J[p*n+g]===Z;)n+=1}}return e(I,g,b,D,J,o,J[p*D+g])};var e=b(14605)("lo<p0",["p0"]),c=8;function z(I,g,b,e,c,z){for(var M=2*I,J=M*(b+1)+g,o=b+1;o<e;++o,J+=M)for(var n=c[J],G=o,D=M*(o-1);G>b&&c[D+g]>n;--G,D-=M){for(var p=D,x=D+M,Z=0;Z<M;++Z,++p,++x){var k=c[p];c[p]=c[x],c[x]=k}var S=z[G];z[G]=z[G-1],z[G-1]=S}}},14605:I=>{"use strict";I.exports=function(I,b){var e="abcdef".split("").concat(b),c=[];I.indexOf("lo")>=0&&c.push("lo=e[k+n]");I.indexOf("hi")>=0&&c.push("hi=e[k+o]");return e.push(g.replace("_",c.join()).replace("$",I)),Function.apply(void 0,e)};var g="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14574:I=>{"use strict";I.exports=function(I,e){e<=4*g?b(0,e-1,I):n(0,e-1,I)};var g=32;function b(I,g,b){for(var e=2*(I+1),c=I+1;c<=g;++c){for(var z=b[e++],M=b[e++],J=c,o=e-2;J-- >I;){var n=b[o-2],G=b[o-1];if(n<z)break;if(n===z&&G<M)break;b[o]=n,b[o+1]=G,o-=2}b[o]=z,b[o+1]=M}}function e(I,g,b){g*=2;var e=b[I*=2],c=b[I+1];b[I]=b[g],b[I+1]=b[g+1],b[g]=e,b[g+1]=c}function c(I,g,b){g*=2,b[I*=2]=b[g],b[I+1]=b[g+1]}function z(I,g,b,e){g*=2,b*=2;var c=e[I*=2],z=e[I+1];e[I]=e[g],e[I+1]=e[g+1],e[g]=e[b],e[g+1]=e[b+1],e[b]=c,e[b+1]=z}function M(I,g,b,e,c){g*=2,c[I*=2]=c[g],c[g]=b,c[I+1]=c[g+1],c[g+1]=e}function J(I,g,b){g*=2;var e=b[I*=2],c=b[g];return!(e<c)&&(e!==c||b[I+1]>b[g+1])}function o(I,g,b,e){var c=e[I*=2];return c<g||c===g&&e[I+1]<b}function n(I,G,D){var p=(G-I+1)/6|0,x=I+p,Z=G-p,k=I+G>>1,S=k-p,f=k+p,V=x,a=S,v=k,X=f,R=Z,E=I+1,mI=G-1,s=0;J(V,a,D)&&(s=V,V=a,a=s),J(X,R,D)&&(s=X,X=R,R=s),J(V,v,D)&&(s=V,V=v,v=s),J(a,v,D)&&(s=a,a=v,v=s),J(V,X,D)&&(s=V,V=X,X=s),J(v,X,D)&&(s=v,v=X,X=s),J(a,R,D)&&(s=a,a=R,R=s),J(a,v,D)&&(s=a,a=v,v=s),J(X,R,D)&&(s=X,X=R,R=s);for(var F=D[2*a],Y=D[2*a+1],d=D[2*X],C=D[2*X+1],r=2*V,O=2*v,H=2*R,i=2*x,U=2*k,h=2*Z,A=0;A<2;++A){var j=D[r+A],Q=D[O+A],L=D[H+A];D[i+A]=j,D[U+A]=Q,D[h+A]=L}c(S,I,D),c(f,G,D);for(var N=E;N<=mI;++N)if(o(N,F,Y,D))N!==E&&e(N,E,D),++E;else if(!o(N,d,C,D))for(;;){if(o(mI,d,C,D)){o(mI,F,Y,D)?(z(N,E,mI,D),++E,--mI):(e(N,mI,D),--mI);break}if(--mI<N)break}M(I,E-1,F,Y,D),M(G,mI+1,d,C,D),E-2-I<=g?b(I,E-2,D):n(I,E-2,D),G-(mI+2)<=g?b(mI+2,G,D):n(mI+2,G,D),mI-E<=g?b(E,mI,D):n(E,mI,D)}},14570:(I,g,b)=>{"use strict";I.exports={init:function(I){var g=c.nextPow2(I);o.length<g&&(e.free(o),o=e.mallocInt32(g));n.length<g&&(e.free(n),n=e.mallocInt32(g));G.length<g&&(e.free(G),G=e.mallocInt32(g));D.length<g&&(e.free(D),D=e.mallocInt32(g));p.length<g&&(e.free(p),p=e.mallocInt32(g));x.length<g&&(e.free(x),x=e.mallocInt32(g));var b=8*g;Z.length<b&&(e.free(Z),Z=e.mallocDouble(b))},sweepBipartite:function(I,g,b,e,c,J,p,x,f,V){for(var a=0,v=2*I,X=I-1,R=v-1,E=b;E<e;++E){var mI=J[E],s=v*E;Z[a++]=c[s+X],Z[a++]=-(mI+1),Z[a++]=c[s+R],Z[a++]=mI}for(E=p;E<x;++E){mI=V[E]+M;var F=v*E;Z[a++]=f[F+X],Z[a++]=-mI,Z[a++]=f[F+R],Z[a++]=mI}var Y=a>>>1;z(Z,Y);var d=0,C=0;for(E=0;E<Y;++E){var r=0|Z[2*E+1];if(r>=M)k(G,D,C--,r=r-M|0);else if(r>=0)k(o,n,d--,r);else if(r<=-M){r=-r-M|0;for(var O=0;O<d;++O){if(void 0!==(H=g(o[O],r)))return H}S(G,D,C++,r)}else{r=-r-1|0;for(O=0;O<C;++O){var H;if(void 0!==(H=g(r,G[O])))return H}S(o,n,d++,r)}}},sweepComplete:function(I,g,b,e,c,M,J,f,V,a){for(var v=0,X=2*I,R=I-1,E=X-1,mI=b;mI<e;++mI){var s=M[mI]+1<<1,F=X*mI;Z[v++]=c[F+R],Z[v++]=-s,Z[v++]=c[F+E],Z[v++]=s}for(mI=J;mI<f;++mI){s=a[mI]+1<<1;var Y=X*mI;Z[v++]=V[Y+R],Z[v++]=1|-s,Z[v++]=V[Y+E],Z[v++]=1|s}var d=v>>>1;z(Z,d);var C=0,r=0,O=0;for(mI=0;mI<d;++mI){var H=0|Z[2*mI+1],i=1&H;if(mI<d-1&&H>>1===Z[2*mI+3]>>1&&(i=2,mI+=1),H<0){for(var U=-(H>>1)-1,h=0;h<O;++h){if(void 0!==(A=g(p[h],U)))return A}if(0!==i)for(h=0;h<C;++h){if(void 0!==(A=g(o[h],U)))return A}if(1!==i)for(h=0;h<r;++h){var A;if(void 0!==(A=g(G[h],U)))return A}0===i?S(o,n,C++,U):1===i?S(G,D,r++,U):2===i&&S(p,x,O++,U)}else{U=(H>>1)-1;0===i?k(o,n,C--,U):1===i?k(G,D,r--,U):2===i&&k(p,x,O--,U)}}},scanBipartite:function(I,g,b,e,c,J,G,D,p,x,f,V){var a=0,v=2*I,X=g,R=g+I,E=1,mI=1;e?mI=M:E=M;for(var s=c;s<J;++s){var F=s+E,Y=v*s;Z[a++]=G[Y+X],Z[a++]=-F,Z[a++]=G[Y+R],Z[a++]=F}for(s=p;s<x;++s){F=s+mI;var d=v*s;Z[a++]=f[d+X],Z[a++]=-F}var C=a>>>1;z(Z,C);var r=0;for(s=0;s<C;++s){var O=0|Z[2*s+1];if(O<0){var H=!1;if((F=-O)>=M?(H=!e,F-=M):(H=!!e,F-=1),H)S(o,n,r++,F);else{var i=V[F],U=v*F,h=f[U+g+1],A=f[U+g+1+I];I:for(var j=0;j<r;++j){var Q=o[j],L=v*Q;if(!(A<G[L+g+1]||G[L+g+1+I]<h)){for(var N=g+2;N<I;++N)if(f[U+N+I]<G[L+N]||G[L+N+I]<f[U+N])continue I;var K,B=D[Q];if(void 0!==(K=e?b(i,B):b(B,i)))return K}}}}else k(o,n,r--,O-E)}},scanComplete:function(I,g,b,e,c,J,n,G,D,p,x){for(var k=0,S=2*I,f=g,V=g+I,a=e;a<c;++a){var v=a+M,X=S*a;Z[k++]=J[X+f],Z[k++]=-v,Z[k++]=J[X+V],Z[k++]=v}for(a=G;a<D;++a){v=a+1;var R=S*a;Z[k++]=p[R+f],Z[k++]=-v}var E=k>>>1;z(Z,E);var mI=0;for(a=0;a<E;++a){var s=0|Z[2*a+1];if(s<0){if((v=-s)>=M)o[mI++]=v-M;else{var F=x[v-=1],Y=S*v,d=p[Y+g+1],C=p[Y+g+1+I];I:for(var r=0;r<mI;++r){var O=o[r],H=n[O];if(H===F)break;var i=S*O;if(!(C<J[i+g+1]||J[i+g+1+I]<d)){for(var U=g+2;U<I;++U)if(p[Y+U+I]<J[i+U]||J[i+U+I]<p[Y+U])continue I;var h=b(H,F);if(void 0!==h)return h}}}}else{for(v=s-M,r=mI-1;r>=0;--r)if(o[r]===v){for(U=r+1;U<mI;++U)o[U-1]=o[U];break}--mI}}}};var e=b(14551),c=b(14556),z=b(14574),M=1<<28,J=1024,o=e.mallocInt32(J),n=e.mallocInt32(J),G=e.mallocInt32(J),D=e.mallocInt32(J),p=e.mallocInt32(J),x=e.mallocInt32(J),Z=e.mallocDouble(8192);function k(I,g,b,e){var c=g[e],z=I[b-1];I[c]=z,g[z]=c}function S(I,g,b,e){I[b]=e,g[e]=b}},14560:I=>{"use strict";function g(I,b,e){var c=0|I[e];if(c<=0)return[];var z,M=new Array(c);if(e===I.length-1)for(z=0;z<c;++z)M[z]=b;else for(z=0;z<c;++z)M[z]=g(I,b,e+1);return M}I.exports=function(I,b){switch("undefined"===typeof b&&(b=0),typeof I){case"number":if(I>0)return function(I,g){var b,e;for(b=new Array(I),e=0;e<I;++e)b[e]=g;return b}(0|I,b);break;case"object":if("number"===typeof I.length)return g(I,b,0)}return[]}},14509:(I,g,b)=>{I.exports=function(){var I=this;this.components={},this.comps=this.components;var g=this.components,b=1,c={},z=[],M=[],J={timeout:!1,removals:[],multiComps:[]};function o(I,b){var e=g[b],z=c[b],M=z.hash[I];M&&(z.remove(I),e.og&&(e.multi?(M.forEach((g=>{g&&e.og(I,g)})),M.length=0):e.og(I,M)),J.removals.push(z),n())}function n(){J.timeout||(J.timeout=!0,setTimeout(G,1))}function G(){J.timeout=!1,D()}function D(){J.multiComps.length&&function(I){for(var g=0;g<I.length;g++){var{entID:b,data:e}=I[g],c=e.hash[b];if(c){for(var z=0;z<c.length;z++)c[z]||(c.splice(z,1),z--);0===c.length&&(e.remove(b),J.removals.push(e))}}I.length=0}(J.multiComps),J.removals.length&&function(I){for(var g=0;g<I.length;g++){I[g].flush()}I.length=0}(J.removals)}this.upI=c,this._systems=z,this._renderSystems=M,this.HD=function(g){var e=b++;return Array.isArray(g)&&g.forEach((g=>I.kG(e,g))),e},this.deleteEntity=function(g){return Object.keys(c).forEach((I=>{c[I].hash[g]&&o(g,I)})),I},this.qD=function(I){if(!I)throw new Error("Missing component definition");var b=I.name;if(!b)throw new Error("Component definition must have a name property.");if("string"!==typeof b)throw new Error("Component name must be a string.");if(""===b)throw new Error("Component name must be a non-empty string.");if(c[b])throw new Error(`Component ${b} already exists.`);var J={};return J.name=b,J.multi=!!I.multi,J.order=isNaN(I.order)?99:I.order,J.stateConstructor=I.stateConstructor||null,J.state=I.state||{},J.Ee=I.Ee||null,J.og=I.og||null,J.system=I.system||null,J.Qc=I.Qc||null,g[b]=J,c[b]=new e,c[b]._pendingMultiCleanup=!1,c[b]._multiCleanupIDs=J.multi?[]:null,J.system&&(z.push(b),z.sort(((I,b)=>g[I].order-g[b].order))),J.Qc&&(M.push(b),M.sort(((I,b)=>g[I].order-g[b].order))),b},this.overwriteComponent=function(I,b){var e=g[I];if(!e)throw new Error(`Unknown component: ${I}`);if(!b)throw new Error("Missing component definition");if(e.name!==b.name)throw new Error("Overwriting component must use the same name property.");var J={};J.name=I,J.multi=!!b.multi,J.order=isNaN(b.order)?99:b.order,J.state=b.state||{},J.Ee=b.Ee||null,J.og=b.og||null,J.system=b.system||null,J.Qc=b.Qc||null,g[I]=J,c[I]._pendingMultiCleanup=!1,c[I]._multiCleanupIDs=J.multi?[]:null;var o=z.indexOf(I);J.system&&o<0&&z.push(I),!J.system&&o>=0&&z.splice(o,1),z.sort(((I,b)=>g[I].order-g[b].order));var n=M.indexOf(I);J.Qc&&n<0&&M.push(I),!J.Qc&&n>=0&&M.splice(n,1),M.sort(((I,b)=>g[I].order-g[b].order));var G=J.state;return this.ZD(I).forEach((I=>{for(var g in G)g in I||(I[g]=G[g]);J.Ee&&J.Ee(I.Zc,I)})),I},this.deleteComponent=function(b){var e=c[b];if(!e)throw new Error(`Unknown component: ${b}`);e.flush(),e.list.forEach((I=>{I&&o(I.Zc||I[0].Zc,b)}));var J=z.indexOf(b),n=M.indexOf(b);return J>-1&&z.splice(J,1),n>-1&&M.splice(n,1),c[b].dispose(),delete c[b],delete g[b],I},this.kG=function(I,b,e){var z,M=g[b],J=c[b];if(!J)throw new Error(`Unknown component: ${b}.`);if(J.hash[I]&&!M.multi)throw new Error(`Entity ${I} already has component: ${b}.`);if(M.stateConstructor){if(!(z=new M.stateConstructor).hasOwnProperty("Zc"))throw new Error(`Component ${M.name} stateConstructor type does not have property __id`)}else z=Object.assign({},{Zc:I},M.state,e);if(z.Zc=I,M.multi){var o=J.hash[I];o||(o=[],J.add(I,o)),o.push(z)}else J.add(I,z);return M.Ee&&M.Ee(I,z),this},this.FG=function(I,g){var b=c[g];if(!b)throw new Error(`Unknown component: ${g}.`);return!!b.hash[I]},this.aG=function(g,b){if(!c[b])throw new Error(`Unknown component: ${b}.`);return o(g,b),I},this.getState=function(I,g){var b=c[g];if(!b)throw new Error(`Unknown component: ${g}.`);return b.hash[I]},this.ZD=function(I){var g=c[I];if(!g)throw new Error(`Unknown component: ${I}.`);return D(),g.list},this.KZ=function(I){if(!c[I])throw new Error(`Unknown component: ${I}.`);var g=c[I].hash;return I=>g[I]},this.uZ=function(I){if(!c[I])throw new Error(`Unknown component: ${I}.`);var g=c[I].hash;return I=>!!g[I]},this.sn=function(b){D();for(var e=0;e<z.length;e++){var M=z[e],J=g[M],o=c[M];J.system(b,o.list),D()}return I},this.render=function(b){D();for(var e=0;e<M.length;e++){var z=M[e],J=g[z],o=c[z];J.Qc(b,o.list),D()}return I},this.removeMultiComponent=function(b,e,z){var M=g[e],o=c[e];if(!o)throw new Error(`Unknown component: ${e}.`);if(!M.multi)throw new Error("removeMultiComponent called on non-multi component");return function(I,g,b,e){var c=b.hash[I];if(c){var z=c[e];z&&(c[e]=null,g.og&&g.og(I,z),J.multiComps.push({entID:I,data:b}),n())}}(b,M,o,z),I}};var e=b(14515)},14515:I=>{function g(I,g){var b=I._map[g];if(delete I.hash[g],delete I._map[g],b===I.list.length-1)I.list.pop();else{var e=I.list.pop();if(I.list[b]=e,null===e||null===e[0]){var c=I.list.length;for(var z in I._map)if(I._map[z]===c)return void(I._map[z]=b)}else{var M=e.Zc||e[0].Zc;I._map[M]=b}}}I.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(I,g){if("number"===typeof this._map[I]){var b=this._map[I];this.hash[I]=g,this.list[b]=g}else this._map[I]=this.list.length,this.hash[I]=g,this.list.push(g)}remove(I){var g=this._map[I];this.hash[I]=null,this.list[g]=null,this._pendingRemovals.push(I)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var I=0;I<this._pendingRemovals.length;I++){var b=this._pendingRemovals[I];null===this.hash[b]&&g(this,b)}this._pendingRemovals.length=0}}},14472:I=>{"use strict";var g,b="object"===typeof Reflect?Reflect:null,e=function(I,g,b){return Function.prototype.apply.call(I,g,b)};g=b&&"function"===typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:function(I){return Object.getOwnPropertyNames(I)};var c=Number.isNaN||function(I){return I!==I};function z(){z.init.call(this)}I.exports=z,I.exports.once=function(I,g){return new Promise((function(b,e){function c(b){I.removeListener(g,z),e(b)}function z(){"function"===typeof I.removeListener&&I.removeListener("error",c),b([].slice.call(arguments))}k(I,g,z,{once:!0}),"error"!==g&&function(I,g,b){"function"===typeof I.on&&k(I,"error",g,b)}(I,c,{once:!0})}))},z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var M=10;function J(I){if("function"!==typeof I)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}function o(I){return void 0===I._maxListeners?z.defaultMaxListeners:I._maxListeners}function n(I,g,b,e){var c,z,M,n;if(J(b),void 0===(z=I._events)?(z=I._events=Object.create(null),I._eventsCount=0):(void 0!==z.newListener&&(I.emit("newListener",g,b.listener?b.listener:b),z=I._events),M=z[g]),void 0===M)M=z[g]=b,++I._eventsCount;else if("function"===typeof M?M=z[g]=e?[b,M]:[M,b]:e?M.unshift(b):M.push(b),(c=o(I))>0&&M.length>c&&!M.warned){M.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.cg=I,G.type=g,G.count=M.length,n=G,console&&console.warn&&console.warn(n)}return I}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function D(I,g,b){var e={fired:!1,wrapFn:void 0,target:I,type:g,listener:b},c=G.bind(e);return c.listener=b,e.wrapFn=c,c}function p(I,g,b){var e=I._events;if(void 0===e)return[];var c=e[g];return void 0===c?[]:"function"===typeof c?b?[c.listener||c]:[c]:b?function(I){for(var g=new Array(I.length),b=0;b<g.length;++b)g[b]=I[b].listener||I[b];return g}(c):Z(c,c.length)}function x(I){var g=this._events;if(void 0!==g){var b=g[I];if("function"===typeof b)return 1;if(void 0!==b)return b.length}return 0}function Z(I,g){for(var b=new Array(g),e=0;e<g;++e)b[e]=I[e];return b}function k(I,g,b,e){if("function"===typeof I.on)e.once?I.once(g,b):I.on(g,b);else{if("function"!==typeof I.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I);I.addEventListener(g,(function c(z){e.once&&I.removeEventListener(g,c),b(z)}))}}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(I){if("number"!==typeof I||I<0||c(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");M=I}}),z.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(I){if("number"!==typeof I||I<0||c(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this},z.prototype.getMaxListeners=function(){return o(this)},z.prototype.emit=function(I){for(var g=[],b=1;b<arguments.length;b++)g.push(arguments[b]);var c="error"===I,z=this._events;if(void 0!==z)c=c&&void 0===z.error;else if(!c)return!1;if(c){var M;if(g.length>0&&(M=g[0]),M instanceof Error)throw M;var J=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw J.context=M,J}var o=z[I];if(void 0===o)return!1;if("function"===typeof o)e(o,this,g);else{var n=o.length,G=Z(o,n);for(b=0;b<n;++b)e(G[b],this,g)}return!0},z.prototype.addListener=function(I,g){return n(this,I,g,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(I,g){return n(this,I,g,!0)},z.prototype.once=function(I,g){return J(g),this.on(I,D(this,I,g)),this},z.prototype.prependOnceListener=function(I,g){return J(g),this.prependListener(I,D(this,I,g)),this},z.prototype.removeListener=function(I,g){var b,e,c,z,M;if(J(g),void 0===(e=this._events))return this;if(void 0===(b=e[I]))return this;if(b===g||b.listener===g)0===--this._eventsCount?this._events=Object.create(null):(delete e[I],e.removeListener&&this.emit("removeListener",I,b.listener||g));else if("function"!==typeof b){for(c=-1,z=b.length-1;z>=0;z--)if(b[z]===g||b[z].listener===g){M=b[z].listener,c=z;break}if(c<0)return this;0===c?b.shift():function(I,g){for(;g+1<I.length;g++)I[g]=I[g+1];I.pop()}(b,c),1===b.length&&(e[I]=b[0]),void 0!==e.removeListener&&this.emit("removeListener",I,M||g)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.zg=function(I){var g,b,e;if(void 0===(b=this._events))return this;if(void 0===b.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==b[I]&&(0===--this._eventsCount?this._events=Object.create(null):delete b[I]),this;if(0===arguments.length){var c,z=Object.keys(b);for(e=0;e<z.length;++e)"removeListener"!==(c=z[e])&&this.zg(c);return this.zg("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(g=b[I]))this.removeListener(I,g);else if(void 0!==g)for(e=g.length-1;e>=0;e--)this.removeListener(I,g[e]);return this},z.prototype.listeners=function(I){return p(this,I,!0)},z.prototype.rawListeners=function(I){return p(this,I,!1)},z.listenerCount=function(I,g){return"function"===typeof I.listenerCount?I.listenerCount(g):x.call(I,g)},z.prototype.listenerCount=x,z.prototype.eventNames=function(){return this._eventsCount>0?g(this._events):[]}},14768:I=>{"use strict";I.exports=function(I,g,b,e,c,z){var M=+g[0],J=+g[1],o=+g[2],n=+b[0],G=+b[1],D=+b[2],p=Math.sqrt(n*n+G*G+D*D);if(0===p)throw new Error("Can't raycast along a zero vector");return function(I,g,b,e,c,z,M,J,o,n){for(var G=0,D=Math.floor,p=0|D(g),x=0|D(b),Z=0|D(e),k=c>0?1:-1,S=z>0?1:-1,f=M>0?1:-1,V=Math.abs(1/c),a=Math.abs(1/z),v=Math.abs(1/M),X=V<1/0?V*(k>0?p+1-g:g-p):1/0,R=a<1/0?a*(S>0?x+1-b:b-x):1/0,E=v<1/0?v*(f>0?Z+1-e:e-Z):1/0,mI=-1;G<=J;){var s=I(p,x,Z);if(s)return o&&(o[0]=g+G*c,o[1]=b+G*z,o[2]=e+G*M),n&&(n[0]=n[1]=n[2]=0,0===mI&&(n[0]=-k),1===mI&&(n[1]=-S),2===mI&&(n[2]=-f)),s;X<R?X<E?(p+=k,G=X,X+=V,mI=0):(Z+=f,G=E,E+=v,mI=2):R<E?(x+=S,G=R,R+=a,mI=1):(Z+=f,G=E,E+=v,mI=2)}return o&&(o[0]=g+G*c,o[1]=b+G*z,o[2]=e+G*M),n&&(n[0]=n[1]=n[2]=0),0}(I,M,J,o,n/=p,G/=p,D/=p,e="undefined"===typeof e?64:+e,c,z)}},14795:(I,g,b)=>{"use strict";b.d(g,{c:()=>z});var e=b(14472);function c(){this.Kx=!1,this.stopPropagation=!1,this.Bx=!1,this.disabled=!1}class z{constructor(I,g){this.version="0.7.0";var b=Object.assign({},new c,g||{});this.element=I||document,this.Kx=!!b.Kx,this.stopPropagation=!!b.stopPropagation,this.Bx=!!b.Bx,this.disabled=!!b.disabled,this.filterEvents=(I,g)=>!0,this.down=new e.EventEmitter,this.up=new e.EventEmitter,this.state={},this.oD={dx:0,dy:0,HZ:0,JD:0,iZ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?J(this):document.addEventListener("DOMContentLoaded",(I=>{J(this)}),{once:!0})}bind(I){for(var g=arguments.length,b=new Array(g>1?g-1:0),e=1;e<g;e++)b[e-1]=arguments[e];b.forEach((g=>{var b=this._keyBindmap[g]||[];b.includes(I)||(b.push(I),this._keyBindmap[g]=b)})),this.state[I]=!!this.state[I],this.pressCount[I]=this.pressCount[I]||0,this.releaseCount[I]=this.releaseCount[I]||0}unbind(I){for(var g in this._keyBindmap){var b=this._keyBindmap[g],e=b.indexOf(I);e>-1&&b.splice(e,1)}}getBindings(){var I={};for(var g in this._keyBindmap){this._keyBindmap[g].forEach((b=>{I[b]=I[b]||[],I[b].push(g)}))}return I}sn(){M(this.oD),M(this.pressCount),M(this.releaseCount)}}function M(I){for(var g in I)I[g]=0}function J(I){window.addEventListener("keydown",Z.bind(null,I,!0),!1),window.addEventListener("keyup",Z.bind(null,I,!1),!1);var g={passive:!0};I.element.addEventListener("touchstart",D.bind(void 0,I),{passive:!1}),I.element.addEventListener("touchend",x.bind(void 0,I),g),I.element.addEventListener("mousedown",k.bind(null,I,!0),g),window.document.addEventListener("mouseup",k.bind(null,I,!1),g),I.element.addEventListener("touchmove",S.bind(null,I),g),I.element.addEventListener("mousemove",S.bind(null,I),g),window.PointerEvent,I.element.addEventListener("wheel",f.bind(null,I),g),I.element.addEventListener("contextmenu",V.bind(null,I),!1),window.addEventListener("blur",a.bind(null,I),!1)}var o=0,n=0,G=null;function D(I,g){g.preventDefault(),p(g)}function p(I){let g=!1;for(let b=0;b<I.touches.length;++b)if(I.touches[b].identifier===G){g=!0;break}if(!g){const g=I.changedTouches[0];o=g.clientX,n=g.clientY,G=g.identifier}}function x(I,g){for(var b=g.changedTouches,e=0;e<b.length;++e)b[e].identifier===G&&(G=null)}function Z(I,g,b){v(b.code,g,I,b)}function k(I,g,b){if("pointerId"in b)if(g){if(null!==I._touches.currID)return;I._touches.currID=b.pointerId}else{if(I._touches.currID!==b.pointerId)return;I._touches.currID=null}return v("Mouse"+("button"in b?b.button+1:1),g,I,b),!1}function S(I,g){var b=g.movementX||g.mozMovementX||0,e=g.movementY||g.mozMovementY||0;if(g.touches&&0===(b|e)){var c=function(I){p(I);for(let g=0;g<I.changedTouches.length;++g)if(I.changedTouches[g].identifier==G){const b=I.changedTouches[g],e=[b.clientX-o,b.clientY-n];return o=b.clientX,n=b.clientY,e}return console.error(`Did not find touch id ${G}`),[0,0]}(g);b=c[0],e=c[1]}I.oD.dx+=b,I.oD.dy+=e}function f(I,g){var b=1;switch(g.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=I.element.clientHeight||window.innerHeight}I.oD.HZ+=(g.deltaX||0)*b,I.oD.JD+=(g.deltaY||0)*b,I.oD.iZ+=(g.deltaZ||0)*b}function V(I,g){if(!I.Bx)return g.preventDefault(),!1}function a(I){for(var g in I._keyStates)I._keyStates[g]&&(/^Mouse\d/.test(g)||v(g,!1,I,{code:g,note:"blnntph52i",preventDefault:()=>{},stopPropagation:()=>{}}))}function v(I,g,b,e){var c=b._keyBindmap[I];c&&(X(b._keyStates[I],g)&&(b._keyStates[I]=g,c.forEach((I=>{(!b.filterEvents||b.filterEvents(e,I))&&function(I,g,b,e){var c=g?b.pressCount:b.releaseCount;c[I]=(c[I]||0)+1;var z=b._bindPressCount[I]||0;(z+=g?1:-1)<0&&(z=0);b._bindPressCount[I]=z;var M=b.state[I];if(X(M,z)){b.state[I]=z>0;var J=g?b.down:b.up;b.disabled||J.emit(I,e)}}(I,g,b,e)}))),"button"in e||(b.Kx&&!e.defaultPrevented&&e.preventDefault(),b.stopPropagation&&e.stopPropagation()))}function X(I,g){return I?!g:g}},13460:I=>{I.exports=function(I,g,b){return I[0]=g[0]+b[0],I[1]=g[1]+b[1],I[2]=g[2]+b[2],I}},13408:(I,g,b)=>{I.exports=function(I,g){var b=e(I[0],I[1],I[2]),M=e(g[0],g[1],g[2]);c(b,b),c(M,M);var J=z(b,M);return J>1?0:Math.acos(J)};var e=b(13414),c=b(13421),z=b(13429)},13521:I=>{I.exports=function(I,g){return I[0]=Math.ceil(g[0]),I[1]=Math.ceil(g[1]),I[2]=Math.ceil(g[2]),I}},13400:I=>{I.exports=function(I){var g=new Float32Array(3);return g[0]=I[0],g[1]=I[1],g[2]=I[2],g}},13432:I=>{I.exports=function(I,g){return I[0]=g[0],I[1]=g[1],I[2]=g[2],I}},13398:I=>{I.exports=function(){var I=new Float32Array(3);return I[0]=0,I[1]=0,I[2]=0,I}},13603:I=>{I.exports=function(I,g,b){var e=g[0],c=g[1],z=g[2],M=b[0],J=b[1],o=b[2];return I[0]=c*o-z*J,I[1]=z*M-e*o,I[2]=e*J-c*M,I}},13550:(I,g,b)=>{I.exports=b(13541)},13541:I=>{I.exports=function(I,g){var b=g[0]-I[0],e=g[1]-I[1],c=g[2]-I[2];return Math.sqrt(b*b+e*e+c*c)}},13496:(I,g,b)=>{I.exports=b(13491)},13491:I=>{I.exports=function(I,g,b){return I[0]=g[0]/b[0],I[1]=g[1]/b[1],I[2]=g[2]/b[2],I}},13429:I=>{I.exports=function(I,g){return I[0]*g[0]+I[1]*g[1]+I[2]*g[2]}},13394:I=>{I.exports=1e-6},13443:(I,g,b)=>{I.exports=function(I,g){var b=I[0],c=I[1],z=I[2],M=g[0],J=g[1],o=g[2];return Math.abs(b-M)<=e*Math.max(1,Math.abs(b),Math.abs(M))&&Math.abs(c-J)<=e*Math.max(1,Math.abs(c),Math.abs(J))&&Math.abs(z-o)<=e*Math.max(1,Math.abs(z),Math.abs(o))};var e=b(13394)},13451:I=>{I.exports=function(I,g){return I[0]===g[0]&&I[1]===g[1]&&I[2]===g[2]}},13516:I=>{I.exports=function(I,g){return I[0]=Math.floor(g[0]),I[1]=Math.floor(g[1]),I[2]=Math.floor(g[2]),I}},13663:(I,g,b)=>{I.exports=function(I,g,b,c,z,M){var J,o;g||(g=3);b||(b=0);o=c?Math.min(c*g+b,I.length):I.length;for(J=b;J<o;J+=g)e[0]=I[J],e[1]=I[J+1],e[2]=I[J+2],z(e,e,M),I[J]=e[0],I[J+1]=e[1],I[J+2]=e[2];return I};var e=b(13398)()},13414:I=>{I.exports=function(I,g,b){var e=new Float32Array(3);return e[0]=I,e[1]=g,e[2]=b,e}},13385:(I,g,b)=>{I.exports={EPSILON:b(13394),create:b(13398),clone:b(13400),angle:b(13408),Sn:b(13414),j:b(13432),set:b(13437),equals:b(13443),exactEquals:b(13451),add:b(13460),ag:b(13468),sub:b(13473),multiply:b(13481),mul:b(13487),divide:b(13491),div:b(13496),min:b(13501),max:b(13507),floor:b(13516),ceil:b(13521),round:b(13524),scale:b(13529),fn:b(13538),distance:b(13541),k:b(13550),squaredDistance:b(13559),sqrDist:b(13568),length:b(13574),len:b(13577),squaredLength:b(13580),Vn:b(13587),negate:b(13593),inverse:b(13601),normalize:b(13421),dot:b(13429),cross:b(13603),xn:b(13608),random:b(13616),transformMat4:b(13625),transformMat3:b(13633),transformQuat:b(13637),an:b(13645),vn:b(13651),Xn:b(13659),forEach:b(13663)}},13601:I=>{I.exports=function(I,g){return I[0]=1/g[0],I[1]=1/g[1],I[2]=1/g[2],I}},13577:(I,g,b)=>{I.exports=b(13574)},13574:I=>{I.exports=function(I){var g=I[0],b=I[1],e=I[2];return Math.sqrt(g*g+b*b+e*e)}},13608:I=>{I.exports=function(I,g,b,e){var c=g[0],z=g[1],M=g[2];return I[0]=c+e*(b[0]-c),I[1]=z+e*(b[1]-z),I[2]=M+e*(b[2]-M),I}},13507:I=>{I.exports=function(I,g,b){return I[0]=Math.max(g[0],b[0]),I[1]=Math.max(g[1],b[1]),I[2]=Math.max(g[2],b[2]),I}},13501:I=>{I.exports=function(I,g,b){return I[0]=Math.min(g[0],b[0]),I[1]=Math.min(g[1],b[1]),I[2]=Math.min(g[2],b[2]),I}},13487:(I,g,b)=>{I.exports=b(13481)},13481:I=>{I.exports=function(I,g,b){return I[0]=g[0]*b[0],I[1]=g[1]*b[1],I[2]=g[2]*b[2],I}},13593:I=>{I.exports=function(I,g){return I[0]=-g[0],I[1]=-g[1],I[2]=-g[2],I}},13421:I=>{I.exports=function(I,g){var b=g[0],e=g[1],c=g[2],z=b*b+e*e+c*c;z>0&&(z=1/Math.sqrt(z),I[0]=g[0]*z,I[1]=g[1]*z,I[2]=g[2]*z);return I}},13616:I=>{I.exports=function(I,g){g=g||1;var b=2*Math.random()*Math.PI,e=2*Math.random()-1,c=Math.sqrt(1-e*e)*g;return I[0]=Math.cos(b)*c,I[1]=Math.sin(b)*c,I[2]=e*g,I}},13645:I=>{I.exports=function(I,g,b,e){var c=b[1],z=b[2],M=g[1]-c,J=g[2]-z,o=Math.sin(e),n=Math.cos(e);return I[0]=g[0],I[1]=c+M*n-J*o,I[2]=z+M*o+J*n,I}},13651:I=>{I.exports=function(I,g,b,e){var c=b[0],z=b[2],M=g[0]-c,J=g[2]-z,o=Math.sin(e),n=Math.cos(e);return I[0]=c+J*o+M*n,I[1]=g[1],I[2]=z+J*n-M*o,I}},13659:I=>{I.exports=function(I,g,b,e){var c=b[0],z=b[1],M=g[0]-c,J=g[1]-z,o=Math.sin(e),n=Math.cos(e);return I[0]=c+M*n-J*o,I[1]=z+M*o+J*n,I[2]=g[2],I}},13524:I=>{I.exports=function(I,g){return I[0]=Math.round(g[0]),I[1]=Math.round(g[1]),I[2]=Math.round(g[2]),I}},13529:I=>{I.exports=function(I,g,b){return I[0]=g[0]*b,I[1]=g[1]*b,I[2]=g[2]*b,I}},13538:I=>{I.exports=function(I,g,b,e){return I[0]=g[0]+b[0]*e,I[1]=g[1]+b[1]*e,I[2]=g[2]+b[2]*e,I}},13437:I=>{I.exports=function(I,g,b,e){return I[0]=g,I[1]=b,I[2]=e,I}},13568:(I,g,b)=>{I.exports=b(13559)},13587:(I,g,b)=>{I.exports=b(13580)},13559:I=>{I.exports=function(I,g){var b=g[0]-I[0],e=g[1]-I[1],c=g[2]-I[2];return b*b+e*e+c*c}},13580:I=>{I.exports=function(I){var g=I[0],b=I[1],e=I[2];return g*g+b*b+e*e}},13473:(I,g,b)=>{I.exports=b(13468)},13468:I=>{I.exports=function(I,g,b){return I[0]=g[0]-b[0],I[1]=g[1]-b[1],I[2]=g[2]-b[2],I}},13633:I=>{I.exports=function(I,g,b){var e=g[0],c=g[1],z=g[2];return I[0]=e*b[0]+c*b[3]+z*b[6],I[1]=e*b[1]+c*b[4]+z*b[7],I[2]=e*b[2]+c*b[5]+z*b[8],I}},13625:I=>{I.exports=function(I,g,b){var e=g[0],c=g[1],z=g[2],M=b[3]*e+b[7]*c+b[11]*z+b[15];return M=M||1,I[0]=(b[0]*e+b[4]*c+b[8]*z+b[12])/M,I[1]=(b[1]*e+b[5]*c+b[9]*z+b[13])/M,I[2]=(b[2]*e+b[6]*c+b[10]*z+b[14])/M,I}},13637:I=>{I.exports=function(I,g,b){var e=g[0],c=g[1],z=g[2],M=b[0],J=b[1],o=b[2],n=b[3],G=n*e+J*z-o*c,D=n*c+o*e-M*z,p=n*z+M*c-J*e,x=-M*e-J*c-o*z;return I[0]=G*n+x*-M+D*-o-p*-J,I[1]=D*n+x*-J+p*-M-G*-o,I[2]=p*n+x*-o+G*-J-D*-M,I}},14493:I=>{"use strict";I.exports=function(I){for(var g=new Array(I),b=0;b<I;++b)g[b]=b;return g}},14567:I=>{I.exports=function(I){return null!=I&&null!=I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}},14777:(I,g,b)=>{"use strict";b.d(g,{d:()=>e});class e{constructor(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.kp=!1,this.Sp=!1,this.xp=30,this.Zp=0,this.mx=!1,this.fullscreen=!1,this.Vp=function(I){},this.ap=function(){},this.Rp=function(){},this.Sg=function(){},this.vp=function(I){},this.onFullscreenChanged=function(I){},n((()=>{!function(I,g){I._nowObject=performance||Date,I._lastTick=0,I._renderAccum=0,I._rt=0,I._frameCB=J.bind(null,I),requestAnimationFrame(I._frameCB),g>0&&(I._intervalCB=M.bind(null,I),I._interval=setInterval(I._intervalCB,Math.max(g,1e3/I.xp/2)))}(this,g),function(I,g){if(!g)return;var b=!1,e=!1;document.addEventListener("pointerlockchange",(e=>{b=document.pointerLockElement===g,I.vp(b)})),document.addEventListener("fullscreenchange",(b=>{e=document.fullscreenElement===g,I.onFullscreenChanged(e)})),Object.defineProperty(I,"mx",{get:()=>b,set:I=>{I&&!b?o(g):b&&!I&&function(I){I.exitPointerLock&&I.exitPointerLock()}(document)}}),Object.defineProperty(I,"fullscreen",{get:()=>e,set:I=>{I&&!e?g.requestFullscreen():e&&!I&&document.exitFullscreen()}}),g.addEventListener("click",(c=>{I.kp&&!b&&o(g),I.Sp&&!e&&g.requestFullscreen()}));var c=()=>I.Sg();if(window.ResizeObserver){new ResizeObserver(c).observe(g)}else window.addEventListener("resize",c)}(this,I),this.Rp()}))}}var c=3,z=20;function M(I){for(var g=1e3/I.xp,b=I._nowObject.now()+z,e=0;I._nowObject.now()>=I._lastTick+g&&I._nowObject.now()<b&&++e<=c;)I.Vp(g),I._lastTick+=g;var M=5*(g+5),J=I._nowObject.now();if(J-I._lastTick>M)for(;J>=I._lastTick+g;)I._lastTick+=g}function J(I){requestAnimationFrame(I._frameCB),M(I);var g=I._nowObject.now(),b=g-I._rt;if(I._rt=g,I.Zp>0){I._renderAccum+=b;var e=1e3/I.Zp;if(I._renderAccum<e)return;I._renderAccum=Math.min(I._renderAccum-e,e)}var c=1e3/I.xp,z=(g-I._lastTick)/c;I.ap(b,z,c)}function o(I){I.requestPointerLock&&I.requestPointerLock()}var n=I=>{if("loading"===document.readyState){var g=()=>{document.removeEventListener("readystatechange",g),I()};document.addEventListener("readystatechange",g)}else setTimeout(I,1)}},14488:(I,g,b)=>{var e=b(14493),c=b(14497),z="undefined"!==typeof Float64Array;function M(I,g){return I[0]-g[0]}function J(){var I,g=this.stride,b=new Array(g.length);for(I=0;I<b.length;++I)b[I]=[Math.abs(g[I]),I];b.sort(M);var e=new Array(b.length);for(I=0;I<e.length;++I)e[I]=b[I][1];return e}function o(I,g){var b=["View",g,"d",I].join("");g<0&&(b="View_Nil"+I);var c="generic"===I;if(-1===g){var z="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(z)()}if(0===g){z="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",z)(n[I][0])}z=["'use strict'"];var M=e(g),o=M.map((function(I){return"i"+I})),G="this.offset+"+M.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),D=M.map((function(I){return"b"+I})).join(","),p=M.map((function(I){return"c"+I})).join(",");z.push("function "+b+"(a,"+D+","+p+",d){this.data=a","this.shape=["+D+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+I+"'","proto.dimension="+g),z.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+M.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===g?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),g<4?(z.push("function "+b+"_order(){"),2===g?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===g&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+b+"_set("+o.join(",")+",v){"),c?z.push("return this.data.set("+G+",v)}"):z.push("return this.data["+G+"]=v}"),z.push("proto.get=function "+b+"_get("+o.join(",")+"){"),c?z.push("return this.data.get("+G+")}"):z.push("return this.data["+G+"]}"),z.push("proto.index=function "+b+"_index(",o.join(),"){return "+G+"}"),z.push("proto.hi=function "+b+"_hi("+o.join(",")+"){return new "+b+"(this.data,"+M.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+M.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var x=M.map((function(I){return"a"+I+"=this.shape["+I+"]"})),Z=M.map((function(I){return"c"+I+"=this.stride["+I+"]"}));z.push("proto.lo=function "+b+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+Z.join(","));for(var k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'&&i"+k+">=0){d=i"+k+"|0;b+=c"+k+"*d;a"+k+"-=d}");z.push("return new "+b+"(this.data,"+M.map((function(I){return"a"+I})).join(",")+","+M.map((function(I){return"c"+I})).join(",")+",b)}"),z.push("proto.step=function "+b+"_step("+o.join(",")+"){var "+M.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+M.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'){d=i"+k+"|0;if(d<0){c+=b"+k+"*(a"+k+"-1);a"+k+"=ceil(-a"+k+"/d)}else{a"+k+"=ceil(a"+k+"/d)}b"+k+"*=d}");z.push("return new "+b+"(this.data,"+M.map((function(I){return"a"+I})).join(",")+","+M.map((function(I){return"b"+I})).join(",")+",c)}");var S=new Array(g),f=new Array(g);for(k=0;k<g;++k)S[k]="a[i"+k+"]",f[k]="b[i"+k+"]";z.push("proto.transpose=function "+b+"_transpose("+o+"){"+o.map((function(I,g){return I+"=("+I+"===undefined?"+g+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+S.join(",")+","+f.join(",")+",this.offset)}"),z.push("proto.pick=function "+b+"_pick("+o+"){var a=[],b=[],c=this.offset");for(k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'&&i"+k+">=0){c=(c+this.stride["+k+"]*i"+k+")|0}else{a.push(this.shape["+k+"]);b.push(this.stride["+k+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+M.map((function(I){return"shape["+I+"]"})).join(",")+","+M.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(n[I],J)}var n={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,g,b,e){if(void 0===I)return(0,n.array[0])([]);"number"===typeof I&&(I=[I]),void 0===g&&(g=[I.length]);var M=g.length;if(void 0===b){b=new Array(M);for(var J=M-1,G=1;J>=0;--J)b[J]=G,G*=g[J]}if(void 0===e){e=0;for(J=0;J<M;++J)b[J]<0&&(e-=(g[J]-1)*b[J])}for(var D=function(I){if(c(I))return"buffer";if(z)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),p=n[D];p.length<=M+1;)p.push(o(D,p.length-1));return(0,p[M+1])(I,g,b,e)}},14497:I=>{function g(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(g(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&g(I.slice(0,0))}(I)||!!I._isBuffer)}},14656:I=>{"use strict";var g=[],b=[],e=[],c=[],z=[],M=[],J=[],o=[],n=[],G=[],D=[],p=[];I.exports=function(I,x,Z,k,S,f){for(var V=J,a=n,v=G,X=p,R=0;R<3;R++)V[R]=+Z[R],v[R]=+x.max[R],a[R]=+x.base[R];f||(f=1e-10);var E=function(I,J,n,G,p,x){var Z=g,k=b,S=e,f=c,V=z,a=M,v=o,X=Math.floor,R=0,E=0,mI=0,s=0,F=0;if(Y(),0===mI)return 0;for(s=r();E<=mI;){if(d(s)&&C())return R;s=r()}for(R+=mI,F=0;F<3;F++)G[F]+=n[F],p[F]+=n[F];return R;function Y(){if(E=0,0!==(mI=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])))for(var I=0;I<3;I++){var g=n[I]>=0;f[I]=g?1:-1;var b=g?p[I]:G[I];Z[I]=g?G[I]:p[I],k[I]=O(b,f[I]),S[I]=H(Z[I],f[I]),v[I]=n[I]/mI,V[I]=Math.abs(1/v[I]);var e=g?k[I]+1-b:b-k[I];a[I]=V[I]<1/0?V[I]*e:1/0}}function d(g){for(var b=f[0],e=0===g?k[0]:S[0],c=k[0]+b,z=f[1],M=1===g?k[1]:S[1],J=k[1]+z,o=f[2],n=2===g?k[2]:S[2],G=k[2]+o,D=e;D!=c;D+=b)for(var p=M;p!=J;p+=z)for(var x=n;x!=G;x+=o)if(I(D,p,x))return!0;return!1}function C(){R+=E;var I=f[s],g=E/mI,b=D;for(F=0;F<3;F++){var e=n[F]*g;G[F]+=e,p[F]+=e,b[F]=n[F]-e}if(I>0?p[s]=Math.round(p[s]):G[s]=Math.round(G[s]),J(R,s,I,b))return!0;for(F=0;F<3;F++)n[F]=b[F];return Y(),0===mI}function r(){var I=a[0]<a[1]?a[0]<a[2]?0:2:a[1]<a[2]?1:2,g=a[I]-E;for(E=a[I],k[I]+=f[I],a[I]+=V[I],F=0;F<3;F++)Z[F]+=g*v[F],S[F]=H(Z[F],f[F]);return I}function O(I,g){return X(I-g*x)}function H(I,g){return X(I+g*x)}}(I,k,V,a,v,f);if(!S){for(R=0;R<3;R++)X[R]=Z[R]>0?v[R]-x.max[R]:a[R]-x.base[R];x.translate(X)}return E}},14802:(I,g,b)=>{"use strict";b.d(g,{e:()=>D});var e=b(14650),c=b(13385);class z{constructor(I,g,b,z,M,J,o){this.xD=new e(I.base,I.CD),this.OM=g,this.friction=b,this.restitution=z,this.zn=M,this.Ik=J,this.Mn=!!o,this.dD=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Nk=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.KG=c.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=c.create(),this._impulses=c.create(),this._sleepFrameCount=10}loadFromCopy(I){c.j(this.xD.base,I.xD.base),c.j(this.xD.CD,I.xD.CD),c.j(this.xD.max,I.xD.max),this.xD.mag=I.xD.mag,this.OM=I.OM,this.friction=I.friction,this.restitution=I.restitution,this.zn=I.zn,this.Ik=I.Ik,this.Mn=I.Mn,this.dD=I.dD,this.fluidDrag=I.fluidDrag,this.Nk=I.Nk,this.preventFallOffEdge=I.preventFallOffEdge,this.rolledBackLastTick=I.rolledBackLastTick,c.j(this.KG,I.KG),c.j(this.resting,I.resting),this.inFluid=I.inFluid,this._ratioInFluid=I._ratioInFluid,c.j(this._forces,I._forces),c.j(this._impulses,I._impulses),this._sleepFrameCount=I._sleepFrameCount}setPosition(I){M(I),c.ag(I,I,this.xD.base),this.xD.translate(I),this.uG()}fg(){return c.clone(this.xD.base)}applyForce(I){M(I),c.add(this._forces,this._forces,I),this.uG()}applyImpulse(I){M(I),c.add(this._impulses,this._impulses,I),this.uG()}uG(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var M=I=>{};var J=b(14650),o=b(13385),n=b(14656);function G(){this.dD=.1,this.fluidDrag=.4,this.pn=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function D(I,g,b){I=Object.assign(new G,I),this.gravity=I.gravity||[0,-10,0],this.dD=I.dD||.1,this.pn=I.pn||2,this.fluidDrag=I.fluidDrag||.4,this.minBounceImpulse=I.minBounceImpulse,this.bodies=[],this.XZ=I.XZ,this.testSolid=g,this.testFluid=b}D.prototype.Jk=function(I,g,b,e,c,M){I=I||new J([0,0,0],[1,1,1]),"undefined"==typeof g&&(g=1),"undefined"==typeof b&&(b=1),"undefined"==typeof e&&(e=0),"undefined"==typeof c&&(c=1);var o=new z(I,g,b,e,c,M);return this.bodies.push(o),o},D.prototype.nk=function(I){var g=this.bodies.indexOf(I);g<0||(this.bodies.splice(g,1),I.xD=I.Ik=null)};var p=o.create(),x=o.create(),Z=o.create(),k=o.create(),S=o.create(),f=o.create(),V=o.create(),a=new J([0,0,0],[1,1,1]),v=new z(a,1,1,0,1,(()=>{}),!1);function X(I,g,b){return g=b,g*=1-(1-I.ratioInFluid)**2}D.prototype.sn=function(I){I/=1e3;var g=j(0,o.squaredLength(this.gravity));this.bodies.forEach((b=>function(I,g,b,e){o.j(S,g.resting),I.XZ&&v.loadFromCopy(g);if(g.OM<=0)return o.set(g.KG,0,0,0),o.set(g._forces,0,0,0),void o.set(g._impulses,0,0,0);var c=e||0===g.zn;if(function(I,g,b,e){if(g._sleepFrameCount>0)return!1;if(e)return!0;var c=!1,z=.5*b*b*g.zn;return o.scale(A,I.gravity,z),n(I.testSolid,g.xD,A,(function(){return c=!0,!0}),!0),c}(I,g,b,c))return;g._sleepFrameCount--,function(I,g){var b=g.xD,e=Math.floor(b.base[0]),c=Math.floor(b.base[2]),z=Math.floor(b.base[1]),M=Math.floor(b.max[1]);if(!I.testFluid(e,z,c))return g.inFluid=!1,void(g.ratioInFluid=0);var J=1,n=z+1;for(;n<=M&&I.testFluid(e,n,c);)J++,n++;var G=(z+J-b.base[1])/b.CD[1];G>1&&(G=1);var D=b.CD[0]*b.CD[1]*b.CD[2]*G,p=E;o.scale(p,I.gravity,-I.pn*D*g.zn),g.applyForce(p),g.inFluid=!0,g.ratioInFluid=G}(I,g),L(g._forces),L(g._impulses),L(g.KG),L(g.resting),o.scale(p,g._forces,1/g.OM),o.fn(p,p,I.gravity,g.zn),o.scale(x,g._impulses,1/g.OM),o.fn(x,x,p,b),o.add(g.KG,g.KG,x),g.friction&&(mI(I,0,g,x,b),mI(I,1,g,x,b),mI(I,2,g,x,b));var z=g.fluidDrag>=0?g.fluidDrag:I.fluidDrag,M=g.dD>=0?g.dD:I.dD,J=M,G=M;g.inFluid&&(J=X(g,J,g.fluidDragHoriz>=0?g.fluidDragHoriz:z),G=X(g,G,g.fluidDragVert>=0?g.fluidDragVert:z));J=Math.max(1-J*b/g.OM,0),G=Math.max(1-G*b/g.OM,0),o.set(R,J,G,J),o.multiply(g.KG,g.KG,R),o.scale(Z,g.KG,b),o.set(g._forces,0,0,0),o.set(g._impulses,0,0,0),g.Mn&&Q(Y,g.xD);o.j(f,Z),o.set(V,0,0,0),g.preventFallOffEdge&&function(I,g,b,e){if(!g.resting[1]||b[1]>0)return;var c=i;Q(c,g.xD);for(var z=0;z<3;z+=2){o.set(H,0,0,0),H[z]=b[z];var M=!0;(M=(M=(M=(M=M&&!h(I,c.base[0]+H[0]+1e-5,c.base[1],c.base[2]+H[2]+1e-5))&&!h(I,c.max[0]+H[0]-1e-5,c.base[1],c.base[2]+H[2]+1e-5))&&!h(I,c.base[0]+H[0]+1e-5,c.base[1],c.max[2]+H[2]-1e-5))&&!h(I,c.max[0]+H[0]-1e-5,c.base[1],c.max[2]+H[2]-1e-5))?(e[z]=b[z]>0?1:-1,b[z]=0):0===z&&(o.set(U,b[0],0,0),F(I,c,U,e,g.slideOnCollision))}}(I,g,Z,V);F(I,g.xD,Z,g.resting,g.slideOnCollision),g.Mn&&function(I,g,b,e){if(g.resting[1]>=0&&!g.inFluid)return;var c=0!==g.resting[0],z=0!==g.resting[2];if(!c&&!z)return;var M=Math.abs(e[0]/e[2]),J=4;if(!c&&M>J)return;if(!z&&M<1/J)return;o.add(C,b.base,e);var G=I.testSolid;n(G,b,e,(function(I,g,b,e){if(1!==g)return!0;e[g]=0}));var D=b.base[1],p=g.inFluid?1.951:1.001,x=Math.floor(D+p)-D;o.set(r,0,x,0);var Z=!1;if(n(G,b,r,(function(I,g,b,e){return Z=!0,!0})),Z)return;o.ag(O,C,b.base),O[1]=0,F(I,b,O,d,!0);var k=j(b.base[0],C[0]),S=j(b.base[2],C[2]);if(c&&!k&&(!S||!z))return;if(z&&(!k||!c)&&!S)return;var f=!0;if(f=f&&!h(I,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),f=f&&!h(I,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),f=f&&!h(I,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),f=f&&!h(I,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),f)return;Q(g.xD,b),g.resting[0]=d[0],g.resting[2]=d[2],g.Nk&&g.Nk()}(I,g,Y,f);for(var D=0;D<3;++D)g.resting[D]=g.resting[D]||V[D],k[D]=0,g.resting[D]&&(S[D]||(k[D]=-g.KG[D]),g.KG[D]=0);var a=o.length(k);a>.001&&(o.scale(k,k,g.OM),g.Ik&&g.Ik(k),g.restitution>0&&a>I.minBounceImpulse&&(o.scale(k,k,g.restitution),g.applyImpulse(k)));var s=o.squaredLength(g.KG);s>1e-5&&g.uG();I.XZ&&I.XZ(g)?(g.loadFromCopy(v),g.rolledBackLastTick=!0):g.rolledBackLastTick=!1}(this,b,I,g)))};var R=o.create([0,0,0]);var E=o.create();function mI(I,g,b,e,c){var z=b.resting[g],M=e[g];if(!b.alwaysApplyHorizFriction||1!==g){if(0===z)return;if(z*M<=0)return}o.j(s,b.KG),s[g]=0;var J=o.length(s);if(!j(J,0)){var n=Math.abs(b.friction*I.gravity[g]*c),G=J>n?(J-n)/J:0;b.KG[(g+1)%3]*=G,b.KG[(g+2)%3]*=G}}var s=o.create();function F(I,g,b,e,c){return o.set(e,0,0,0),n(I.testSolid,g,b,(function(I,g,b,z){e[g]=b,z[g]=0,c||(z[0]=0,z[1]=0,z[2]=0)}))}var Y=new J([],[]),d=o.create(),C=o.create(),r=o.create(),O=o.create();var H=o.create(),i=new J([],[]),U=o.create();function h(I,g,b,e){return I.testSolid(Math.floor(g),Math.floor(b-1),Math.floor(e))}var A=o.create();function j(I,g){return Math.abs(I-g)<1e-5}function Q(I,g){for(var b=0;b<3;b++)I.base[b]=g.base[b],I.max[b]=g.max[b],I.CD[b]=g.CD[b]}var L=function(I){}},13248:function(I,g){!function(I){"use strict";var g=function(I,b){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,g){I.__proto__=g}||function(I,g){for(var b in g)Object.prototype.hasOwnProperty.call(g,b)&&(I[b]=g[b])},g(I,b)};function b(I,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function e(){this.constructor=I}g(I,b),I.prototype=null===b?Object.create(b):(e.prototype=b.prototype,new e)}function e(I,g,b,e){var c,z=arguments.length,M=z<3?g:null===e?e=Object.getOwnPropertyDescriptor(g,b):e;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)M=Reflect.decorate(I,g,b,e);else for(var J=I.length-1;J>=0;J--)(c=I[J])&&(M=(z<3?c(M):z>3?c(g,b,M):c(g,b))||M);return z>3&&M&&Object.defineProperty(g,b,M),M}function c(I,g,b){if(b||2===arguments.length)for(var e,c=0,z=g.length;c<z;c++)!e&&c in g||(e||(e=Array.prototype.slice.call(g,0,c)),e[c]=g[c]);return I.concat(e||Array.prototype.slice.call(g))}var z,M=255,J=213;I.OPERATION=void 0,(z=I.OPERATION||(I.OPERATION={}))[z.ADD=128]="ADD",z[z.REPLACE=0]="REPLACE",z[z.DELETE=64]="DELETE",z[z.DELETE_AND_ADD=192]="DELETE_AND_ADD",z[z.TOUCH=1]="TOUCH",z[z.CLEAR=10]="CLEAR";var o=function(){function g(I,g,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=I,this.setParent(g,b)}return g.prototype.setParent=function(I,g,b){var e=this;if(this.indexes||(this.indexes=this.ref instanceof OI?this.ref._definition.indexes:{}),this.parent=I,this.parentIndex=b,g)if(this.root=g,this.ref instanceof OI){var c=this.ref._definition;for(var z in c.schema){var M=this.ref[z];if(M&&M.$changes){var J=c.indexes[z];M.$changes.setParent(this.ref,g,J)}}}else"object"===typeof this.ref&&this.ref.forEach((function(I,g){if(I instanceof OI){var b=I.$changes,c=e.ref.$changes.indexes[g];b.setParent(e.ref,e.root,c)}}))},g.prototype.operation=function(I){this.changes.set(--this.currentCustomOperation,I)},g.prototype.change=function(g,b){void 0===b&&(b=I.OPERATION.ADD);var e="number"===typeof g?g:this.indexes[g];this.assertValidIndex(e,g);var c=this.changes.get(e);c&&c.op!==I.OPERATION.DELETE&&c.op!==I.OPERATION.TOUCH||this.changes.set(e,{op:c&&c.op===I.OPERATION.DELETE?I.OPERATION.DELETE_AND_ADD:b,index:e}),this.allChanges.add(e),this.changed=!0,this.touchParents()},g.prototype.touch=function(g){var b="number"===typeof g?g:this.indexes[g];this.assertValidIndex(b,g),this.changes.has(b)||this.changes.set(b,{op:I.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},g.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},g.prototype.getType=function(I){if(this.ref._definition)return(g=this.ref._definition).schema[g.fieldsByIndex[I]];var g,b=(g=this.parent._definition).schema[g.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},g.prototype.getChildrenFilter=function(){var I=this.parent._definition.childFilters;return I&&I[this.parentIndex]},g.prototype.getValue=function(I){return this.ref.getByIndex(I)},g.prototype.delete=function(g){var b="number"===typeof g?g:this.indexes[g];if(void 0!==b){var e=this.getValue(b);this.changes.set(b,{op:I.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],e&&e.$changes&&(e.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(g," (").concat(b,")"))},g.prototype.discard=function(g,b){var e=this;void 0===g&&(g=!1),void 0===b&&(b=!1),this.ref instanceof OI||this.changes.forEach((function(g){if(g.op===I.OPERATION.DELETE){var b=e.ref.getIndex(g.index);delete e.indexes[b]}})),this.changes.clear(),this.changed=g,b&&this.allChanges.clear(),this.currentCustomOperation=0},g.prototype.discardAll=function(){var I=this;this.changes.forEach((function(g){var b=I.getValue(g.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},g.prototype.cache=function(I,g){this.caches[I]=g},g.prototype.clone=function(){return new g(this.ref,this.parent,this.root)},g.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},g.prototype.assertValidIndex=function(I,g){if(void 0===I)throw new Error('ChangeTree: missing index for field "'.concat(g,'"'))},g}();function n(I,g,b,e){return I[g]||(I[g]=[]),I[g].push(b),null===e||void 0===e||e.forEach((function(I,g){return b(I,g)})),function(){return D(I[g],I[g].indexOf(b))}}function G(g){var b=this,e="string"!==typeof this.$changes.getType();this.$items.forEach((function(c,z){g.push({refId:b.$changes.refId,op:I.OPERATION.DELETE,field:z,value:void 0,previousValue:c}),e&&b.$changes.root.removeRef(c.$changes.refId)}))}function D(I,g){if(-1===g||g>=I.length)return!1;for(var b=I.length-1,e=g;e<b;e++)I[e]=I[e+1];return I.length=b,!0}var p=function(I,g){var b=I.toString(),e=g.toString();return b<e?-1:b>e?1:0};function x(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,g){return"symbol"===typeof g||isNaN(g)?I[g]:I.at(g)},set:function(I,g,b){if("symbol"===typeof g||isNaN(g))I[g]=b;else{var e=Array.from(I.$items.keys()),c=parseInt(e[g]||g);void 0===b||null===b?I.deleteAt(c):I.setAt(c,b)}return!0},deleteProperty:function(I,g){return"number"===typeof g?I.deleteAt(g):delete I[g],!0}})}var Z=function(){function g(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,I)}return g.prototype.Ee=function(g,b){return void 0===b&&(b=!0),n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,g,b?this.$items:void 0)},g.prototype.og=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,g)},g.is=function(I){return Array.isArray(I)||void 0!==I.array},Object.defineProperty(g.prototype,"length",{get:function(){return this.$items.size},set:function(I){0===I?this.clear():this.splice(I,this.length-I)},enumerable:!1,configurable:!0}),g.prototype.push=function(){for(var I,g=this,b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];return b.forEach((function(b){I=g.$refId++,g.setAt(I,b)})),I},g.prototype.pop=function(){var I=Array.from(this.$indexes.values()).pop();if(void 0!==I){this.$changes.delete(I),this.$indexes.delete(I);var g=this.$items.get(I);return this.$items.delete(I),g}},g.prototype.at=function(I){var g=Array.from(this.$items.keys())[I];return this.$items.get(g)},g.prototype.setAt=function(g,b){var e,c;if(void 0!==b&&null!==b){if(this.$items.get(g)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,g);var z=null!==(c=null===(e=this.$changes.indexes[g])||void 0===e?void 0:e.op)&&void 0!==c?c:I.OPERATION.ADD;this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,b),this.$changes.change(g,z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},g.prototype.deleteAt=function(I){var g=Array.from(this.$items.keys())[I];return void 0!==g&&this.$deleteAt(g)},g.prototype.$deleteAt=function(I){return this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I)},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&G.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.concat=function(){for(var I,b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];return new(g.bind.apply(g,c([void 0],(I=Array.from(this.$items.values())).concat.apply(I,b),!1)))},g.prototype.join=function(I){return Array.from(this.$items.values()).join(I)},g.prototype.reverse=function(){var I=this,g=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,e){I.setAt(g[e],b)})),this},g.prototype.shift=function(){var I=Array.from(this.$items.keys()).shift();if(void 0!==I){var g=this.$items.get(I);return this.$deleteAt(I),g}},g.prototype.slice=function(I,b){var e=new g;return e.push.apply(e,Array.from(this.$items.values()).slice(I,b)),e},g.prototype.sort=function(I){var g=this;void 0===I&&(I=p);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(I).forEach((function(I,e){g.setAt(b[e],I)})),this},g.prototype.splice=function(I,g){void 0===g&&(g=this.length-I);for(var b=Array.from(this.$items.keys()),e=[],c=I;c<I+g;c++)e.push(this.$items.get(b[c])),this.$deleteAt(b[c]);return e},g.prototype.unshift=function(){for(var I=this,g=[],b=0;b<arguments.length;b++)g[b]=arguments[b];var e=this.length,c=g.length,z=Array.from(this.$items.values());return g.forEach((function(g,b){I.setAt(b,g)})),z.forEach((function(g,b){I.setAt(c+b,g)})),e+c},g.prototype.indexOf=function(I,g){return Array.from(this.$items.values()).indexOf(I,g)},g.prototype.lastIndexOf=function(I,g){return void 0===g&&(g=this.length-1),Array.from(this.$items.values()).lastIndexOf(I,g)},g.prototype.every=function(I,g){return Array.from(this.$items.values()).every(I,g)},g.prototype.some=function(I,g){return Array.from(this.$items.values()).some(I,g)},g.prototype.forEach=function(I,g){Array.from(this.$items.values()).forEach(I,g)},g.prototype.map=function(I,g){return Array.from(this.$items.values()).map(I,g)},g.prototype.filter=function(I,g){return Array.from(this.$items.values()).filter(I,g)},g.prototype.reduce=function(I,g){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},g.prototype.reduceRight=function(I,g){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},g.prototype.find=function(I,g){return Array.from(this.$items.values()).find(I,g)},g.prototype.findIndex=function(I,g){return Array.from(this.$items.values()).findIndex(I,g)},g.prototype.fill=function(I,g,b){throw new Error("ArraySchema#fill() not implemented")},g.prototype.copyWithin=function(I,g,b){throw new Error("ArraySchema#copyWithin() not implemented")},g.prototype.toString=function(){return this.$items.toString()},g.prototype.toLocaleString=function(){return this.$items.toLocaleString()},g.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(g,Symbol.species,{get:function(){return g},enumerable:!1,configurable:!0}),g.prototype.entries=function(){return this.$items.entries()},g.prototype.keys=function(){return this.$items.keys()},g.prototype.values=function(){return this.$items.values()},g.prototype.includes=function(I,g){return Array.from(this.$items.values()).includes(I,g)},g.prototype.flatMap=function(I,g){throw new Error("ArraySchema#flatMap() is not supported.")},g.prototype.flat=function(I){throw new Error("ArraySchema#flat() is not supported.")},g.prototype.findLast=function(){var I=Array.from(this.$items.values());return I.findLast.apply(I,arguments)},g.prototype.findLastIndex=function(){var I=Array.from(this.$items.values());return I.findLastIndex.apply(I,arguments)},g.prototype.setIndex=function(I,g){this.$indexes.set(I,g)},g.prototype.getIndex=function(I){return this.$indexes.get(I)},g.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},g.prototype.deleteByIndex=function(I){var g=this.$indexes.get(I);this.$items.delete(g),this.$indexes.delete(I)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){return this.toArray().map((function(I){return"function"===typeof I.toJSON?I.toJSON():I}))},g.prototype.clone=function(I){return I?new(g.bind.apply(g,c([void 0],Array.from(this.$items.values()),!1))):new(g.bind.apply(g,c([void 0],this.map((function(I){return I.$changes?I.clone():I})),!1)))},g}();function k(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,g){return"symbol"!==typeof g&&"undefined"===typeof I[g]?I.get(g):I[g]},set:function(I,g,b){return"symbol"!==typeof g&&-1===g.indexOf("$")&&"Ee"!==g&&"og"!==g&&"onChange"!==g?I.set(g,b):I[g]=b,!0},deleteProperty:function(I,g){return I.delete(g),!0}})}var S=function(){function g(I){var b=this;if(this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I)if(I instanceof Map||I instanceof g)I.forEach((function(I,g){return b.set(g,I)}));else for(var e in I)this.set(e,I[e])}return g.prototype.Ee=function(g,b){return void 0===b&&(b=!0),n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,g,b?this.$items:void 0)},g.prototype.og=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,g)},g.is=function(I){return void 0!==I.map},g.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(g.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(g,Symbol.species,{get:function(){return g},enumerable:!1,configurable:!0}),g.prototype.set=function(g,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(g,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(g,"'."));g=g.toString();var e="undefined"!==typeof this.$changes.indexes[g],c=e?this.$changes.indexes[g]:this.$refId++,z=e?I.OPERATION.REPLACE:I.OPERATION.ADD,M=void 0!==b.$changes;if(M&&b.$changes.setParent(this,this.$changes.root,c),e){if(!M&&this.$items.get(g)===b)return;M&&this.$items.get(g)!==b&&(z=I.OPERATION.ADD)}else this.$changes.indexes[g]=c,this.$indexes.set(c,g);return this.$items.set(g,b),this.$changes.change(g,z),this},g.prototype.get=function(I){return this.$items.get(I)},g.prototype.delete=function(I){return this.$changes.delete(I),this.$items.delete(I)},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&G.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(I){return this.$items.has(I)},g.prototype.forEach=function(I){this.$items.forEach(I)},g.prototype.entries=function(){return this.$items.entries()},g.prototype.keys=function(){return this.$items.keys()},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(I,g){this.$indexes.set(I,g)},g.prototype.getIndex=function(I){return this.$indexes.get(I)},g.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},g.prototype.deleteByIndex=function(I){var g=this.$indexes.get(I);this.$items.delete(g),this.$indexes.delete(I)},g.prototype.toJSON=function(){var I={};return this.forEach((function(g,b){I[b]="function"===typeof g.toJSON?g.toJSON():g})),I},g.prototype.clone=function(I){var b;return I?b=Object.assign(new g,this):(b=new g,this.forEach((function(I,g){I.$changes?b.set(g,I.clone()):b.set(g,I)}))),b},g}(),f={};function V(I,g){f[I]=g}function a(I){return f[I]}var v=function(){function I(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return I.create=function(g){var b=new I;return b.schema=Object.assign({},g&&g.schema||{}),b.indexes=Object.assign({},g&&g.indexes||{}),b.fieldsByIndex=Object.assign({},g&&g.fieldsByIndex||{}),b.descriptors=Object.assign({},g&&g.descriptors||{}),b.deprecated=Object.assign({},g&&g.deprecated||{}),b},I.prototype.addField=function(I,g){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=I,this.indexes[I]=b,this.schema[I]=Array.isArray(g)?{array:g[0]}:g},I.prototype.hasField=function(I){return void 0!==this.indexes[I]},I.prototype.addFilter=function(I,g){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[I]]=g,this.indexesWithFilters.push(this.indexes[I]),!0},I.prototype.addChildrenFilter=function(I,g){var b=this.indexes[I],e=this.schema[I];if(a(Object.keys(e)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=g,!0;console.warn("@filterChildren: field '".concat(I,"' can't have children. Ignoring filter."))},I.prototype.getChildrenFilter=function(I){return this.childFilters&&this.childFilters[this.indexes[I]]},I.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},I}();function X(I){return I._context&&I._context.useFilters}var R=function(){function I(){this.types={},this.schemas=new Map,this.useFilters=!1}return I.prototype.has=function(I){return this.schemas.has(I)},I.prototype.get=function(I){return this.types[I]},I.prototype.add=function(I,g){void 0===g&&(g=this.schemas.size),I._definition=v.create(I._definition),I._typeid=g,this.types[g]=I,this.schemas.set(I,g)},I.create=function(g){return void 0===g&&(g={}),function(b){return g.context||(g.context=new I),mI(b,g)}},I}(),E=new R;function mI(I,g){return void 0===g&&(g={}),function(b,e){var z=g.context||E,M=b.constructor;if(M._context=z,!I)throw new Error("".concat(M.name,': @type() reference provided for "').concat(e,"\" is undefined. Make sure you don't have any circular dependencies."));z.has(M)||z.add(M);var J=M._definition;if(J.addField(e,I),J.descriptors[e]){if(J.deprecated[e])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(e,"' definition on '").concat(M.name,"'.\nCheck @type() annotation"))}catch(f){var o=f.stack.split("\n")[4].trim();throw new Error("".concat(f.message," ").concat(o))}}var n=Z.is(I),G=!n&&S.is(I);if("string"!==typeof I&&!OI.is(I)){var D=Object.values(I)[0];"string"===typeof D||z.has(D)||z.add(D)}if(g.manual)J.descriptors[e]={enumerable:!0,configurable:!0,writable:!0};else{var p="_".concat(e);J.descriptors[p]={enumerable:!1,configurable:!1,writable:!0},J.descriptors[e]={get:function(){return this[p]},set:function(I){I!==this[p]&&(void 0!==I&&null!==I?(!n||I instanceof Z||(I=new(Z.bind.apply(Z,c([void 0],I,!1)))),!G||I instanceof S||(I=new S(I)),void 0===I.$proxy&&(G?I=k(I):n&&(I=x(I))),this.$changes.change(e),I.$changes&&I.$changes.setParent(this,this.$changes.root,this._definition.indexes[e])):this[p]&&this.$changes.delete(e),this[p]=I)},enumerable:!0,configurable:!0}}}}function s(I){return function(g,b){var e=g.constructor;e._definition.addFilter(b,I)&&(e._context.useFilters=!0)}}function F(I){return function(g,b){var e=g.constructor;e._definition.addChildrenFilter(b,I)&&(e._context.useFilters=!0)}}function Y(I){return void 0===I&&(I=!0),function(g,b){var e=g.constructor._definition;e.deprecated[b]=!0,I&&(e.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(I){},enumerable:!1,configurable:!0})}}function d(I,g,b){for(var e in void 0===b&&(b={}),b.context||(b.context=I._context||b.context||E),g)mI(g[e],b)(I.prototype,e);return I}function C(I){for(var g=0,b=0,e=0,c=I.length;e<c;e++)(g=I.charCodeAt(e))<128?b+=1:g<2048?b+=2:g<55296||g>=57344?b+=3:(e++,b+=4);return b}function r(I,g,b){for(var e=0,c=0,z=b.length;c<z;c++)(e=b.charCodeAt(c))<128?I[g++]=e:e<2048?(I[g++]=192|e>>6,I[g++]=128|63&e):e<55296||e>=57344?(I[g++]=224|e>>12,I[g++]=128|e>>6&63,I[g++]=128|63&e):(c++,e=65536+((1023&e)<<10|1023&b.charCodeAt(c)),I[g++]=240|e>>18,I[g++]=128|e>>12&63,I[g++]=128|e>>6&63,I[g++]=128|63&e)}function O(I,g){I.push(255&g)}function H(I,g){I.push(255&g)}function i(I,g){I.push(255&g),I.push(g>>8&255)}function U(I,g){I.push(255&g),I.push(g>>8&255)}function h(I,g){I.push(255&g),I.push(g>>8&255),I.push(g>>16&255),I.push(g>>24&255)}function A(I,g){var b=g>>24,e=g>>16,c=g>>8,z=g;I.push(255&z),I.push(255&c),I.push(255&e),I.push(255&b)}function j(I,g){var b=Math.floor(g/Math.pow(2,32));A(I,g>>>0),A(I,b)}function Q(I,g){var b=g/Math.pow(2,32)|0;A(I,g>>>0),A(I,b)}function L(I,g){u(I,g)}function N(I,g){t(I,g)}var K=new Int32Array(2),B=new Float32Array(K.buffer),P=new Float64Array(K.buffer);function u(I,g){B[0]=g,h(I,K[0])}function t(I,g){P[0]=g,h(I,K[0]),h(I,K[1])}function y(I,g){return H(I,g?1:0)}function q(I,g){g||(g="");var b=C(g),e=0;if(b<32)I.push(160|b),e=1;else if(b<256)I.push(217),H(I,b),e=2;else if(b<65536)I.push(218),U(I,b),e=3;else{if(!(b<4294967296))throw new Error("String too long");I.push(219),A(I,b),e=5}return r(I,I.length,g),e+b}function l(I,g){return isNaN(g)?l(I,0):isFinite(g)?g!==(0|g)?(I.push(203),t(I,g),9):g>=0?g<128?(H(I,g),1):g<256?(I.push(204),H(I,g),2):g<65536?(I.push(205),U(I,g),3):g<4294967296?(I.push(206),A(I,g),5):(I.push(207),Q(I,g),9):g>=-32?(I.push(224|g+32),1):g>=-128?(I.push(208),O(I,g),2):g>=-32768?(I.push(209),i(I,g),3):g>=-2147483648?(I.push(210),h(I,g),5):(I.push(211),j(I,g),9):l(I,g>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var w=Object.freeze({__proto__:null,utf8Write:r,int8:O,uint8:H,int16:i,uint16:U,int32:h,uint32:A,int64:j,uint64:Q,float32:L,float64:N,writeFloat32:u,writeFloat64:t,boolean:y,string:q,number:l});function T(I,g,b){for(var e="",c=0,z=g,M=g+b;z<M;z++){var J=I[z];0!==(128&J)?192!==(224&J)?224!==(240&J)?240!==(248&J)?console.error("Invalid byte "+J.toString(16)):(c=(7&J)<<18|(63&I[++z])<<12|(63&I[++z])<<6|63&I[++z])>=65536?(c-=65536,e+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):e+=String.fromCharCode(c):e+=String.fromCharCode((15&J)<<12|(63&I[++z])<<6|63&I[++z]):e+=String.fromCharCode((31&J)<<6|63&I[++z]):e+=String.fromCharCode(J)}return e}function W(I,g){return II(I,g)<<24>>24}function II(I,g){return I[g.offset++]}function gI(I,g){return bI(I,g)<<16>>16}function bI(I,g){return I[g.offset++]|I[g.offset++]<<8}function eI(I,g){return I[g.offset++]|I[g.offset++]<<8|I[g.offset++]<<16|I[g.offset++]<<24}function cI(I,g){return eI(I,g)>>>0}function zI(I,g){return pI(I,g)}function MI(I,g){return xI(I,g)}function JI(I,g){var b=cI(I,g);return eI(I,g)*Math.pow(2,32)+b}function oI(I,g){var b=cI(I,g);return cI(I,g)*Math.pow(2,32)+b}var nI=new Int32Array(2),GI=new Float32Array(nI.buffer),DI=new Float64Array(nI.buffer);function pI(I,g){return nI[0]=eI(I,g),GI[0]}function xI(I,g){return nI[0]=eI(I,g),nI[1]=eI(I,g),DI[0]}function ZI(I,g){return II(I,g)>0}function kI(I,g){var b,e=I[g.offset++];e<192?b=31&e:217===e?b=II(I,g):218===e?b=bI(I,g):219===e&&(b=cI(I,g));var c=T(I,g.offset,b);return g.offset+=b,c}function SI(I,g){var b=I[g.offset];return b<192&&b>160||217===b||218===b||219===b}function fI(I,g){var b=I[g.offset++];return b<128?b:202===b?pI(I,g):203===b?xI(I,g):204===b?II(I,g):205===b?bI(I,g):206===b?cI(I,g):207===b?oI(I,g):208===b?W(I,g):209===b?gI(I,g):210===b?eI(I,g):211===b?JI(I,g):b>223?-1*(255-b+1):void 0}function VI(I,g){var b=I[g.offset];return b<128||b>=202&&b<=211}function aI(I,g){return I[g.offset]<160}function vI(I,g){return I[g.offset-1]===M&&(I[g.offset]<128||I[g.offset]>=202&&I[g.offset]<=211)}var XI=Object.freeze({__proto__:null,int8:W,uint8:II,int16:gI,uint16:bI,int32:eI,uint32:cI,float32:zI,float64:MI,int64:JI,uint64:oI,readFloat32:pI,readFloat64:xI,boolean:ZI,string:kI,stringCheck:SI,number:fI,numberCheck:VI,arrayCheck:aI,switchStructureCheck:vI}),RI=function(){function g(I){var g=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return g.add(I)}))}return g.prototype.Ee=function(g,b){return void 0===b&&(b=!0),n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,g,b?this.$items:void 0)},g.prototype.og=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,g)},g.is=function(I){return void 0!==I.collection},g.prototype.add=function(I){var g=this.$refId++;return void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,g),this.$changes.indexes[g]=g,this.$indexes.set(g,g),this.$items.set(g,I),this.$changes.change(g),g},g.prototype.at=function(I){var g=Array.from(this.$items.keys())[I];return this.$items.get(g)},g.prototype.entries=function(){return this.$items.entries()},g.prototype.delete=function(I){for(var g,b,e=this.$items.entries();(b=e.next())&&!b.done;)if(I===b.value[1]){g=b.value[0];break}return void 0!==g&&(this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g))},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&G.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(I){return Array.from(this.$items.values()).some((function(g){return g===I}))},g.prototype.forEach=function(I){var g=this;this.$items.forEach((function(b,e,c){return I(b,e,g)}))},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(I,g){this.$indexes.set(I,g)},g.prototype.getIndex=function(I){return this.$indexes.get(I)},g.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},g.prototype.deleteByIndex=function(I){var g=this.$indexes.get(I);this.$items.delete(g),this.$indexes.delete(I)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){var I=[];return this.forEach((function(g,b){I.push("function"===typeof g.toJSON?g.toJSON():g)})),I},g.prototype.clone=function(I){var b;return I?b=Object.assign(new g,this):(b=new g,this.forEach((function(I){I.$changes?b.add(I.clone()):b.add(I)}))),b},g}(),EI=function(){function g(I){var g=this;this.$changes=new o(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return g.add(I)}))}return g.prototype.Ee=function(g,b){return void 0===b&&(b=!0),n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,g,b?this.$items:void 0)},g.prototype.og=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,g)},g.prototype.onChange=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,g)},g.is=function(I){return void 0!==I.set},g.prototype.add=function(g){var b,e;if(this.has(g))return!1;var c=this.$refId++;void 0!==g.$changes&&g.$changes.setParent(this,this.$changes.root,c);var z=null!==(e=null===(b=this.$changes.indexes[c])||void 0===b?void 0:b.op)&&void 0!==e?e:I.OPERATION.ADD;return this.$changes.indexes[c]=c,this.$indexes.set(c,c),this.$items.set(c,g),this.$changes.change(c,z),c},g.prototype.entries=function(){return this.$items.entries()},g.prototype.delete=function(I){for(var g,b,e=this.$items.entries();(b=e.next())&&!b.done;)if(I===b.value[1]){g=b.value[0];break}return void 0!==g&&(this.$changes.delete(g),this.$indexes.delete(g),this.$items.delete(g))},g.prototype.clear=function(g){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),g&&G.call(this,g),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},g.prototype.has=function(I){for(var g,b=this.$items.values(),e=!1;(g=b.next())&&!g.done;)if(I===g.value){e=!0;break}return e},g.prototype.forEach=function(I){var g=this;this.$items.forEach((function(b,e,c){return I(b,e,g)}))},g.prototype.values=function(){return this.$items.values()},Object.defineProperty(g.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),g.prototype.setIndex=function(I,g){this.$indexes.set(I,g)},g.prototype.getIndex=function(I){return this.$indexes.get(I)},g.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},g.prototype.deleteByIndex=function(I){var g=this.$indexes.get(I);this.$items.delete(g),this.$indexes.delete(I)},g.prototype.toArray=function(){return Array.from(this.$items.values())},g.prototype.toJSON=function(){var I=[];return this.forEach((function(g,b){I.push("function"===typeof g.toJSON?g.toJSON():g)})),I},g.prototype.clone=function(I){var b;return I?b=Object.assign(new g,this):(b=new g,this.forEach((function(I){I.$changes?b.add(I.clone()):b.add(I)}))),b},g}(),mg=function(){function I(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return I.prototype.addRefId=function(I){this.refIds.has(I)||(this.refIds.add(I),this.containerIndexes.set(I,new Set))},I.get=function(g){return void 0===g.$filterState&&(g.$filterState=new I),g.$filterState},I}(),sI=function(){function I(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return I.prototype.getNextUniqueId=function(){return this.nextUniqueId++},I.prototype.addRef=function(I,g,b){void 0===b&&(b=!0),this.refs.set(I,g),b&&(this.refCounts[I]=(this.refCounts[I]||0)+1)},I.prototype.removeRef=function(I){this.refCounts[I]=this.refCounts[I]-1,this.deletedRefs.add(I)},I.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},I.prototype.garbageCollectDeletedRefs=function(){var I=this;this.deletedRefs.forEach((function(g){if(!(I.refCounts[g]>0)){var b=I.refs.get(g);if(b instanceof OI)for(var e in b._definition.schema)"string"!==typeof b._definition.schema[e]&&b[e]&&b[e].$changes&&I.removeRef(b[e].$changes.refId);else{var c=b.$changes.parent._definition,z=c.schema[c.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(z)[0]&&Array.from(b.values()).forEach((function(g){return I.removeRef(g.$changes.refId)}))}I.refs.delete(g),delete I.refCounts[g]}})),this.deletedRefs.clear()},I}(),FI=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return b(g,I),g}(Error);function YI(I,g,b,e){var c,z=!1;switch(g){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":c="number",isNaN(I)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(e));break;case"string":c="string",z=!0;break;case"boolean":return}if(typeof I!==c&&(!z||z&&null!==I)){var M="'".concat(JSON.stringify(I),"'").concat(I&&I.constructor&&" (".concat(I.constructor.name,")")||"");throw new FI("a '".concat(c,"' was expected, but ").concat(M," was provided in ").concat(b.constructor.name,"#").concat(e))}}function dI(I,g,b,e){if(!(I instanceof g))throw new FI("a '".concat(g.name,"' was expected, but '").concat(I.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(e))}function CI(I,g,b,e,c){YI(b,I,e,c);var z=w[I];if(!z)throw new FI("a '".concat(I,"' was expected, but ").concat(b," was provided in ").concat(e.constructor.name,"#").concat(c));z(g,b)}function rI(I,g,b){return XI[I](g,b)}var OI=function(){function g(){for(var I=[],g=0;g<arguments.length;g++)I[g]=arguments[g];Object.defineProperties(this,{$changes:{value:new o(this,void 0,new sI),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),I[0]&&this.assign(I[0])}return g.onError=function(I){console.error(I)},g.is=function(I){return I._definition&&void 0!==I._definition.schema},g.prototype.onChange=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,g)},g.prototype.og=function(g){return n(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,g)},g.prototype.assign=function(I){return Object.assign(this,I),this},Object.defineProperty(g.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),g.prototype.setDirty=function(I,g){this.$changes.change(I,g)},g.prototype.listen=function(I,g,b){var e=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[I]||(this.$callbacks[I]=[]),this.$callbacks[I].push(g),b&&void 0!==this[I]&&g(this[I],void 0),function(){return D(e.$callbacks[I],e.$callbacks[I].indexOf(g))}},g.prototype.decode=function(b,e,c){var z;void 0===e&&(e={offset:0}),void 0===c&&(c=this);var J=[],o=this.$changes.root,n=b.length,G=0;for(o.refs.set(G,this);e.offset<n;){var D=b[e.offset++];if(D!=M){var p=c.$changes,x=void 0!==c._definition,k=x?D>>6<<6:D;if(k!==I.OPERATION.CLEAR){var f=x?D%(k||255):fI(b,e),V=x?c._definition.fieldsByIndex[f]:"",v=p.getType(f),X=void 0,R=void 0,E=void 0;if(x?R=c["_".concat(V)]:(R=c.getByIndex(f),(k&I.OPERATION.ADD)===I.OPERATION.ADD?(E=c instanceof S?kI(b,e):f,c.setIndex(f,E)):E=c.getIndex(f)),(k&I.OPERATION.DELETE)===I.OPERATION.DELETE&&(k!==I.OPERATION.DELETE_AND_ADD&&c.deleteByIndex(f),R&&R.$changes&&o.removeRef(R.$changes.refId),X=null),void 0!==V){if(k===I.OPERATION.DELETE);else if(g.is(v)){var mI=fI(b,e);if(X=o.refs.get(mI),k!==I.OPERATION.REPLACE){var s=this.getSchemaType(b,e,v);X||((X=this.createTypeInstance(s)).$changes.refId=mI,R&&(X.$callbacks=R.$callbacks,R.$changes.refId&&mI!==R.$changes.refId&&o.removeRef(R.$changes.refId))),o.addRef(mI,X,X!==R)}}else if("string"===typeof v)X=rI(v,b,e);else{var F=a(Object.keys(v)[0]),Y=fI(b,e),d=o.refs.has(Y)?R||o.refs.get(Y):new F.constructor;if((X=d.clone(!0)).$changes.refId=Y,R&&(X.$callbacks=R.$callbacks,R.$changes.refId&&Y!==R.$changes.refId)){o.removeRef(R.$changes.refId);for(var C=R.entries(),r=void 0;(r=C.next())&&!r.done;){var O=(z=r.value)[0],H=z[1];J.push({refId:Y,op:I.OPERATION.DELETE,field:O,value:void 0,previousValue:H})}}o.addRef(Y,X,d!==R)}if(null!==X&&void 0!==X)if(X.$changes&&X.$changes.setParent(p.ref,p.root,f),c instanceof g)c[V]=X;else if(c instanceof S)O=E,c.$items.set(O,X),c.$changes.allChanges.add(f);else if(c instanceof Z)c.setAt(f,X);else if(c instanceof RI){var i=c.add(X);c.setIndex(f,i)}else c instanceof EI&&!1!==(i=c.add(X))&&c.setIndex(f,i);R!==X&&J.push({refId:G,op:k,field:V,dynamicIndex:E,value:X,previousValue:R})}else{console.warn("@colyseus/schema: definition mismatch");for(var U={offset:e.offset};e.offset<n&&(!vI(b,e)||(U.offset=e.offset+1,!o.refs.has(fI(b,U))));)e.offset++}}else c.clear(J)}else{G=fI(b,e);var h=o.refs.get(G);if(!h)throw new Error('"refId" not found: '.concat(G));c=h}}return this._triggerChanges(J),o.garbageCollectDeletedRefs(),J},g.prototype.encode=function(b,e,c){void 0===b&&(b=!1),void 0===e&&(e=[]),void 0===c&&(c=!1);for(var z=this.$changes,J=new WeakSet,o=[z],n=1,G=0;G<n;G++){var D=o[G],p=D.ref,x=p instanceof g;D.ensureRefId(),J.add(D),D!==z&&(D.changed||b)&&(H(e,M),l(e,D.refId));for(var Z=b?Array.from(D.allChanges):Array.from(D.changes.values()),k=0,f=Z.length;k<f;k++){var V=b?{op:I.OPERATION.ADD,index:Z[k]}:Z[k],v=V.index,X=x?p._definition.fieldsByIndex&&p._definition.fieldsByIndex[v]:v,R=e.length;if(V.op!==I.OPERATION.TOUCH)if(x)H(e,v|V.op);else{if(H(e,V.op),V.op===I.OPERATION.CLEAR)continue;l(e,v)}if(x||(V.op&I.OPERATION.ADD)!=I.OPERATION.ADD||p instanceof S&&q(e,D.ref.$indexes.get(v)),V.op!==I.OPERATION.DELETE){var E=D.getType(v),mI=D.getValue(v);if(mI&&mI.$changes&&!J.has(mI.$changes)&&(o.push(mI.$changes),mI.$changes.ensureRefId(),n++),V.op!==I.OPERATION.TOUCH){if(g.is(E))dI(mI,E,p,X),l(e,mI.$changes.refId),(V.op&I.OPERATION.ADD)===I.OPERATION.ADD&&this.tryEncodeTypeId(e,E,mI.constructor);else if("string"===typeof E)CI(E,e,mI,p,X);else{var s=a(Object.keys(E)[0]);dI(p["_".concat(X)],s.constructor,p,X),l(e,mI.$changes.refId)}c&&D.cache(v,e.slice(R))}}}b||c||D.discard()}return e},g.prototype.encodeAll=function(I){return this.encode(!0,[],I)},g.prototype.applyFilters=function(b,e){var c,z;void 0===e&&(e=!1);for(var J=this,o=new Set,n=mg.get(b),G=[this.$changes],D=1,p=[],x=function(x){var Z=G[x];if(o.has(Z.refId))return"continue";var k=Z.ref,f=k instanceof g;H(p,M),l(p,Z.refId);var V=n.refIds.has(Z),a=e||!V;n.addRefId(Z);var v=n.containerIndexes.get(Z),X=a?Array.from(Z.allChanges):Array.from(Z.changes.values());!e&&f&&k._definition.indexesWithFilters&&k._definition.indexesWithFilters.forEach((function(g){!v.has(g)&&Z.allChanges.has(g)&&(a?X.push(g):X.push({op:I.OPERATION.ADD,index:g}))}));for(var R=0,E=X.length;R<E;R++){var mI=a?{op:I.OPERATION.ADD,index:X[R]}:X[R];if(mI.op!==I.OPERATION.CLEAR){var s=mI.index;if(mI.op!==I.OPERATION.DELETE){var F=Z.getValue(s),Y=Z.getType(s);if(f){if((d=k._definition.filters&&k._definition.filters[s])&&!d.call(k,b,F,J)){F&&F.$changes&&o.add(F.$changes.refId);continue}}else{var d,C=Z.parent;if((d=Z.getChildrenFilter())&&!d.call(C,b,k.$indexes.get(s),F,J)){F&&F.$changes&&o.add(F.$changes.refId);continue}}if(F.$changes&&(G.push(F.$changes),D++),mI.op!==I.OPERATION.TOUCH)if(mI.op===I.OPERATION.ADD||f)p.push.apply(p,null!==(c=Z.caches[s])&&void 0!==c?c:[]),v.add(s);else if(v.has(s))p.push.apply(p,null!==(z=Z.caches[s])&&void 0!==z?z:[]);else{if(v.add(s),H(p,I.OPERATION.ADD),l(p,s),k instanceof S){var r=Z.ref.$indexes.get(s);q(p,r)}F.$changes?l(p,F.$changes.refId):w[Y](p,F)}else F.$changes&&!f&&(H(p,I.OPERATION.ADD),l(p,s),k instanceof S&&(r=Z.ref.$indexes.get(s),q(p,r)),l(p,F.$changes.refId))}else f?H(p,mI.op|s):(H(p,mI.op),l(p,s))}else H(p,mI.op)}},Z=0;Z<D;Z++)x(Z);return p},g.prototype.clone=function(){var I,g=new this.constructor,b=this._definition.schema;for(var e in b)"object"===typeof this[e]&&"function"===typeof(null===(I=this[e])||void 0===I?void 0:I.clone)?g[e]=this[e].clone():g[e]=this[e];return g},g.prototype.toJSON=function(){var I=this._definition.schema,g=this._definition.deprecated,b={};for(var e in I)g[e]||null===this[e]||"undefined"===typeof this[e]||(b[e]="function"===typeof this[e].toJSON?this[e].toJSON():this["_".concat(e)]);return b},g.prototype.discardAllChanges=function(){this.$changes.discardAll()},g.prototype.getByIndex=function(I){return this[this._definition.fieldsByIndex[I]]},g.prototype.deleteByIndex=function(I){this[this._definition.fieldsByIndex[I]]=void 0},g.prototype.tryEncodeTypeId=function(I,g,b){g._typeid!==b._typeid&&(H(I,J),l(I,b._typeid))},g.prototype.getSchemaType=function(I,g,b){var e;return I[g.offset]===J&&(g.offset++,e=this.constructor._context.get(fI(I,g))),e||b},g.prototype.createTypeInstance=function(I){var g=new I;return g.$changes.root=this.$changes.root,g},g.prototype._triggerChanges=function(b){for(var e,c,z,M,J,o,n,G,D,p=new Set,x=this.$changes.root.refs,Z=function(Z){var k=b[Z],S=k.refId,f=x.get(S),V=f.$callbacks;if((k.op&I.OPERATION.DELETE)===I.OPERATION.DELETE&&k.previousValue instanceof g&&(null===(c=null===(e=k.previousValue.$callbacks)||void 0===e?void 0:e[I.OPERATION.DELETE])||void 0===c||c.forEach((function(I){return I()}))),!V)return"continue";if(f instanceof g){if(!p.has(S))try{null===(z=null===V||void 0===V?void 0:V[I.OPERATION.REPLACE])||void 0===z||z.forEach((function(I){return I()}))}catch(a){g.onError(a)}try{V.hasOwnProperty(k.field)&&(null===(M=V[k.field])||void 0===M||M.forEach((function(I){return I(k.value,k.previousValue)})))}catch(a){g.onError(a)}}else k.op===I.OPERATION.ADD&&void 0===k.previousValue?null===(J=V[I.OPERATION.ADD])||void 0===J||J.forEach((function(I){var g;return I(k.value,null!==(g=k.dynamicIndex)&&void 0!==g?g:k.field)})):k.op===I.OPERATION.DELETE?void 0!==k.previousValue&&(null===(o=V[I.OPERATION.DELETE])||void 0===o||o.forEach((function(I){var g;return I(k.previousValue,null!==(g=k.dynamicIndex)&&void 0!==g?g:k.field)}))):k.op===I.OPERATION.DELETE_AND_ADD&&(void 0!==k.previousValue&&(null===(n=V[I.OPERATION.DELETE])||void 0===n||n.forEach((function(I){var g;return I(k.previousValue,null!==(g=k.dynamicIndex)&&void 0!==g?g:k.field)}))),null===(G=V[I.OPERATION.ADD])||void 0===G||G.forEach((function(I){var g;return I(k.value,null!==(g=k.dynamicIndex)&&void 0!==g?g:k.field)}))),k.value!==k.previousValue&&(null===(D=V[I.OPERATION.REPLACE])||void 0===D||D.forEach((function(I){var g;return I(k.value,null!==(g=k.dynamicIndex)&&void 0!==g?g:k.field)})));p.add(S)},k=0;k<b.length;k++)Z(k)},g._definition=v.create(),g}();function HI(I){for(var g=[I.$changes],b=1,e={},c=e,z=function(I){var b=g[I];b.changes.forEach((function(I){var g=b.ref,e=I.index,z=g._definition?g._definition.fieldsByIndex[e]:g.$indexes.get(e);c[z]=b.getValue(e)}))},M=0;M<b;M++)z(M);return e}var iI={context:new R},UI=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return b(g,I),e([mI("string",iI)],g.prototype,"name",void 0),e([mI("string",iI)],g.prototype,"type",void 0),e([mI("number",iI)],g.prototype,"referencedType",void 0),g}(OI),hI=function(I){function g(){var g=null!==I&&I.apply(this,arguments)||this;return g.fields=new Z,g}return b(g,I),e([mI("number",iI)],g.prototype,"id",void 0),e([mI([UI],iI)],g.prototype,"fields",void 0),g}(OI),AI=function(I){function g(){var g=null!==I&&I.apply(this,arguments)||this;return g.types=new Z,g}return b(g,I),g.encode=function(I){var b=I.constructor,e=new g;e.rootType=b._typeid;var c=function(I,g){for(var b in g){var c=new UI;c.name=b;var z=void 0;if("string"===typeof g[b])z=g[b];else{var M=g[b],J=void 0;OI.is(M)?(z="ref",J=g[b]):"string"===typeof M[z=Object.keys(M)[0]]?z+=":"+M[z]:J=M[z],c.referencedType=J?J._typeid:-1}c.type=z,I.fields.push(c)}e.types.push(I)},z=b._context.types;for(var M in z){var J=new hI;J.id=Number(M),c(J,z[M]._definition.schema)}return e.encodeAll()},g.decode=function(I,e){var c=new R,z=new g;z.decode(I,e);var M=z.types.reduce((function(I,g){var e=function(I){function g(){return null!==I&&I.apply(this,arguments)||this}return b(g,I),g}(OI),z=g.id;return I[z]=e,c.add(e,z),I}),{});z.types.forEach((function(I){var g=M[I.id];I.fields.forEach((function(I){var b;if(void 0!==I.referencedType){var e=I.type,z=M[I.referencedType];if(!z){var J=I.type.split(":");e=J[0],z=J[1]}"ref"===e?mI(z,{context:c})(g.prototype,I.name):mI(((b={})[e]=z,b),{context:c})(g.prototype,I.name)}else mI(I.type,{context:c})(g.prototype,I.name)}))}));var J=M[z.rootType],o=new J;for(var n in J._definition.schema){var G=J._definition.schema[n];"string"!==typeof G&&(o[n]="function"===typeof G?new G:new(a(Object.keys(G)[0]).constructor))}return o},e([mI([hI],iI)],g.prototype,"types",void 0),e([mI("number",iI)],g.prototype,"rootType",void 0),g}(OI);V("map",{constructor:S}),V("array",{constructor:Z}),V("set",{constructor:EI}),V("collection",{constructor:RI}),I.ArraySchema=Z,I.CollectionSchema=RI,I.Context=R,I.MapSchema=S,I.Reflection=AI,I.ReflectionField=UI,I.ReflectionType=hI,I.Schema=OI,I.SchemaDefinition=v,I.SetSchema=EI,I.decode=XI,I.defineTypes=d,I.deprecated=Y,I.dumpChanges=HI,I.encode=w,I.filter=s,I.filterChildren=F,I.hasFilter=X,I.registerType=V,I.type=mI,Object.defineProperty(I,"__esModule",{value:!0})}(g)},14688:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14685:(I,g,b)=>{var e=b(14688),c=b(14691),z=Object.hasOwnProperty,M=Object.create(null);for(var J in e)z.call(e,J)&&(M[e[J]]=J);var o=I.exports={to:{},get:{}};function n(I,g,b){return Math.min(Math.max(g,I),b)}function G(I){var g=Math.round(I).toString(16).toUpperCase();return g.length<2?"0"+g:g}o.get=function(I){var g,b;switch(I.substring(0,3).toLowerCase()){case"hsl":g=o.get.hsl(I),b="hsl";break;case"hwb":g=o.get.hwb(I),b="hwb";break;default:g=o.get.rgb(I),b="rgb"}return g?{model:b,value:g}:null},o.get.rgb=function(I){if(!I)return null;var g,b,c,M=[0,0,0,1];if(g=I.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(c=g[2],g=g[1],b=0;b<3;b++){var J=2*b;M[b]=parseInt(g.slice(J,J+2),16)}c&&(M[3]=parseInt(c,16)/255)}else if(g=I.match(/^#([a-f0-9]{3,4})$/i)){for(c=(g=g[1])[3],b=0;b<3;b++)M[b]=parseInt(g[b]+g[b],16);c&&(M[3]=parseInt(c+c,16)/255)}else if(g=I.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)M[b]=parseInt(g[b+1],0);g[4]&&(g[5]?M[3]=.01*parseFloat(g[4]):M[3]=parseFloat(g[4]))}else{if(!(g=I.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(g=I.match(/^(\w+)$/))?"transparent"===g[1]?[0,0,0,0]:z.call(e,g[1])?((M=e[g[1]])[3]=1,M):null:null;for(b=0;b<3;b++)M[b]=Math.round(2.55*parseFloat(g[b+1]));g[4]&&(g[5]?M[3]=.01*parseFloat(g[4]):M[3]=parseFloat(g[4]))}for(b=0;b<3;b++)M[b]=n(M[b],0,255);return M[3]=n(M[3],0,1),M},o.get.hsl=function(I){if(!I)return null;var g=I.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(g){var b=parseFloat(g[4]);return[(parseFloat(g[1])%360+360)%360,n(parseFloat(g[2]),0,100),n(parseFloat(g[3]),0,100),n(isNaN(b)?1:b,0,1)]}return null},o.get.hwb=function(I){if(!I)return null;var g=I.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(g){var b=parseFloat(g[4]);return[(parseFloat(g[1])%360+360)%360,n(parseFloat(g[2]),0,100),n(parseFloat(g[3]),0,100),n(isNaN(b)?1:b,0,1)]}return null},o.to.hex=function(){var I=c(arguments);return"#"+G(I[0])+G(I[1])+G(I[2])+(I[3]<1?G(Math.round(255*I[3])):"")},o.to.rgb=function(){var I=c(arguments);return I.length<4||1===I[3]?"rgb("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+")":"rgba("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+", "+I[3]+")"},o.to.rgb.percent=function(){var I=c(arguments),g=Math.round(I[0]/255*100),b=Math.round(I[1]/255*100),e=Math.round(I[2]/255*100);return I.length<4||1===I[3]?"rgb("+g+"%, "+b+"%, "+e+"%)":"rgba("+g+"%, "+b+"%, "+e+"%, "+I[3]+")"},o.to.hsl=function(){var I=c(arguments);return I.length<4||1===I[3]?"hsl("+I[0]+", "+I[1]+"%, "+I[2]+"%)":"hsla("+I[0]+", "+I[1]+"%, "+I[2]+"%, "+I[3]+")"},o.to.hwb=function(){var I=c(arguments),g="";return I.length>=4&&1!==I[3]&&(g=", "+I[3]),"hwb("+I[0]+", "+I[1]+"%, "+I[2]+"%"+g+")"},o.to.keyword=function(I){return M[I.slice(0,3)]}},14680:(I,g,b)=>{const e=b(14685),c=b(14703),z=["keyword","gray","hex"],M={};for(const x of Object.keys(c))M[[...c[x].labels].sort().join("")]=x;const J={};function o(I,g){if(!(this instanceof o))return new o(I,g);if(g&&g in z&&(g=null),g&&!(g in c))throw new Error("Unknown model: "+g);let b,n;if(null==I)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(I instanceof o)this.model=I.model,this.color=[...I.color],this.valpha=I.valpha;else if("string"===typeof I){const g=e.get(I);if(null===g)throw new Error("Unable to parse color from string: "+I);this.model=g.model,n=c[this.model].channels,this.color=g.value.slice(0,n),this.valpha="number"===typeof g.value[n]?g.value[n]:1}else if(I.length>0){this.model=g||"rgb",n=c[this.model].channels;const b=Array.prototype.slice.call(I,0,n);this.color=p(b,n),this.valpha="number"===typeof I[n]?I[n]:1}else if("number"===typeof I)this.model="rgb",this.color=[I>>16&255,I>>8&255,255&I],this.valpha=1;else{this.valpha=1;const g=Object.keys(I);"alpha"in I&&(g.splice(g.indexOf("alpha"),1),this.valpha="number"===typeof I.alpha?I.alpha:0);const e=g.sort().join("");if(!(e in M))throw new Error("Unable to parse color from object: "+JSON.stringify(I));this.model=M[e];const{labels:z}=c[this.model],J=[];for(b=0;b<z.length;b++)J.push(I[z[b]]);this.color=p(J)}if(J[this.model])for(n=c[this.model].channels,b=0;b<n;b++){const I=J[this.model][b];I&&(this.color[b]=I(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}o.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(I){let g=this.model in e.to?this:this.rgb();g=g.round("number"===typeof I?I:1);const b=1===g.valpha?g.color:[...g.color,this.valpha];return e.to[g.model](b)},percentString(I){const g=this.rgb().round("number"===typeof I?I:1),b=1===g.valpha?g.color:[...g.color,this.valpha];return e.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const I={},{channels:g}=c[this.model],{labels:b}=c[this.model];for(let e=0;e<g;e++)I[b[e]]=this.color[e];return 1!==this.valpha&&(I.alpha=this.valpha),I},unitArray(){const I=this.rgb().color;return I[0]/=255,I[1]/=255,I[2]/=255,1!==this.valpha&&I.push(this.valpha),I},unitObject(){const I=this.rgb().object();return I.r/=255,I.g/=255,I.b/=255,1!==this.valpha&&(I.alpha=this.valpha),I},round(I){return I=Math.max(I||0,0),new o([...this.color.map(n(I)),this.valpha],this.model)},alpha(I){return void 0!==I?new o([...this.color,Math.max(0,Math.min(1,I))],this.model):this.valpha},red:G("rgb",0,D(255)),green:G("rgb",1,D(255)),blue:G("rgb",2,D(255)),hue:G(["hsl","hsv","hsl","hwb","hcg"],0,(I=>(I%360+360)%360)),saturationl:G("hsl",1,D(100)),lightness:G("hsl",2,D(100)),saturationv:G("hsv",1,D(100)),value:G("hsv",2,D(100)),chroma:G("hcg",1,D(100)),gray:G("hcg",2,D(100)),white:G("hwb",1,D(100)),wblack:G("hwb",2,D(100)),cyan:G("cmyk",0,D(100)),magenta:G("cmyk",1,D(100)),yellow:G("cmyk",2,D(100)),black:G("cmyk",3,D(100)),x:G("xyz",0,D(95.047)),y:G("xyz",1,D(100)),z:G("xyz",2,D(108.833)),l:G("lab",0,D(100)),a:G("lab",1),b:G("lab",2),keyword(I){return void 0!==I?new o(I):c[this.model].keyword(this.color)},hex(I){return void 0!==I?new o(I):e.to.hex(this.rgb().round().color)},hexa(I){if(void 0!==I)return new o(I);const g=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),e.to.hex(g)+b},rgbNumber(){const I=this.rgb().color;return(255&I[0])<<16|(255&I[1])<<8|255&I[2]},luminosity(){const I=this.rgb().color,g=[];for(const[b,e]of I.entries()){const I=e/255;g[b]=I<=.04045?I/12.92:((I+.055)/1.055)**2.4}return.2126*g[0]+.7152*g[1]+.0722*g[2]},contrast(I){const g=this.luminosity(),b=I.luminosity();return g>b?(g+.05)/(b+.05):(b+.05)/(g+.05)},level(I){const g=this.contrast(I);return g>=7?"AAA":g>=4.5?"AA":""},isDark(){const I=this.rgb().color;return(2126*I[0]+7152*I[1]+722*I[2])/1e4<128},isLight(){return!this.isDark()},negate(){const I=this.rgb();for(let g=0;g<3;g++)I.color[g]=255-I.color[g];return I},lighten(I){const g=this.hsl();return g.color[2]+=g.color[2]*I,g},darken(I){const g=this.hsl();return g.color[2]-=g.color[2]*I,g},saturate(I){const g=this.hsl();return g.color[1]+=g.color[1]*I,g},desaturate(I){const g=this.hsl();return g.color[1]-=g.color[1]*I,g},whiten(I){const g=this.hwb();return g.color[1]+=g.color[1]*I,g},blacken(I){const g=this.hwb();return g.color[2]+=g.color[2]*I,g},grayscale(){const I=this.rgb().color,g=.3*I[0]+.59*I[1]+.11*I[2];return o.rgb(g,g,g)},fade(I){return this.alpha(this.valpha-this.valpha*I)},opaquer(I){return this.alpha(this.valpha+this.valpha*I)},rotate(I){const g=this.hsl();let b=g.color[0];return b=(b+I)%360,b=b<0?360+b:b,g.color[0]=b,g},mix(I,g){if(!I||!I.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof I);const b=I.rgb(),e=this.rgb(),c=void 0===g?.5:g,z=2*c-1,M=b.alpha()-e.alpha(),J=((z*M===-1?z:(z+M)/(1+z*M))+1)/2,n=1-J;return o.rgb(J*b.red()+n*e.red(),J*b.green()+n*e.green(),J*b.blue()+n*e.blue(),b.alpha()*c+e.alpha()*(1-c))}};for(const x of Object.keys(c)){if(z.includes(x))continue;const{channels:I}=c[x];o.prototype[x]=function(){if(this.model===x)return new o(this);for(var I=arguments.length,g=new Array(I),b=0;b<I;b++)g[b]=arguments[b];return g.length>0?new o(g,x):new o([...(e=c[this.model][x].raw(this.color),Array.isArray(e)?e:[e]),this.valpha],x);var e},o[x]=function(){for(var g=arguments.length,b=new Array(g),e=0;e<g;e++)b[e]=arguments[e];let c=b[0];return"number"===typeof c&&(c=p(b,I)),new o(c,x)}}function n(I){return function(g){return function(I,g){return Number(I.toFixed(g))}(g,I)}}function G(I,g,b){I=Array.isArray(I)?I:[I];for(const e of I)(J[e]||(J[e]=[]))[g]=b;return I=I[0],function(e){let c;return void 0!==e?(b&&(e=b(e)),c=this[I](),c.color[g]=e,c):(c=this[I]().color[g],b&&(c=b(c)),c)}}function D(I){return function(g){return Math.max(0,Math.min(I,g))}}function p(I,g){for(let b=0;b<g;b++)"number"!==typeof I[b]&&(I[b]=0);return I}I.exports=o},14708:(I,g,b)=>{const e=b(14717),c={};for(const M of Object.keys(e))c[e[M]]=M;const z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};I.exports=z;for(const M of Object.keys(z)){if(!("channels"in z[M]))throw new Error("missing channels property: "+M);if(!("labels"in z[M]))throw new Error("missing channel labels property: "+M);if(z[M].labels.length!==z[M].channels)throw new Error("channel and label counts mismatch: "+M);const{channels:I,labels:g}=z[M];delete z[M].channels,delete z[M].labels,Object.defineProperty(z[M],"channels",{value:I}),Object.defineProperty(z[M],"labels",{value:g})}z.rgb.hsl=function(I){const g=I[0]/255,b=I[1]/255,e=I[2]/255,c=Math.min(g,b,e),z=Math.max(g,b,e),M=z-c;let J,o;z===c?J=0:g===z?J=(b-e)/M:b===z?J=2+(e-g)/M:e===z&&(J=4+(g-b)/M),J=Math.min(60*J,360),J<0&&(J+=360);const n=(c+z)/2;return o=z===c?0:n<=.5?M/(z+c):M/(2-z-c),[J,100*o,100*n]},z.rgb.hsv=function(I){let g,b,e,c,z;const M=I[0]/255,J=I[1]/255,o=I[2]/255,n=Math.max(M,J,o),G=n-Math.min(M,J,o),D=function(I){return(n-I)/6/G+.5};return 0===G?(c=0,z=0):(z=G/n,g=D(M),b=D(J),e=D(o),M===n?c=e-b:J===n?c=1/3+g-e:o===n&&(c=2/3+b-g),c<0?c+=1:c>1&&(c-=1)),[360*c,100*z,100*n]},z.rgb.hwb=function(I){const g=I[0],b=I[1];let e=I[2];const c=z.rgb.hsl(I)[0],M=1/255*Math.min(g,Math.min(b,e));return e=1-1/255*Math.max(g,Math.max(b,e)),[c,100*M,100*e]},z.rgb.cmyk=function(I){const g=I[0]/255,b=I[1]/255,e=I[2]/255,c=Math.min(1-g,1-b,1-e);return[100*((1-g-c)/(1-c)||0),100*((1-b-c)/(1-c)||0),100*((1-e-c)/(1-c)||0),100*c]},z.rgb.keyword=function(I){const g=c[I];if(g)return g;let b,z=1/0;for(const c of Object.keys(e)){const g=e[c],o=(J=g,((M=I)[0]-J[0])**2+(M[1]-J[1])**2+(M[2]-J[2])**2);o<z&&(z=o,b=c)}var M,J;return b},z.keyword.rgb=function(I){return e[I]},z.rgb.xyz=function(I){let g=I[0]/255,b=I[1]/255,e=I[2]/255;g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92;return[100*(.4124*g+.3576*b+.1805*e),100*(.2126*g+.7152*b+.0722*e),100*(.0193*g+.1192*b+.9505*e)]},z.rgb.lab=function(I){const g=z.rgb.xyz(I);let b=g[0],e=g[1],c=g[2];b/=95.047,e/=100,c/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,c=c>.008856?c**(1/3):7.787*c+16/116;return[116*e-16,500*(b-e),200*(e-c)]},z.hsl.rgb=function(I){const g=I[0]/360,b=I[1]/100,e=I[2]/100;let c,z,M;if(0===b)return M=255*e,[M,M,M];c=e<.5?e*(1+b):e+b-e*b;const J=2*e-c,o=[0,0,0];for(let n=0;n<3;n++)z=g+1/3*-(n-1),z<0&&z++,z>1&&z--,M=6*z<1?J+6*(c-J)*z:2*z<1?c:3*z<2?J+(c-J)*(2/3-z)*6:J,o[n]=255*M;return o},z.hsl.hsv=function(I){const g=I[0];let b=I[1]/100,e=I[2]/100,c=b;const z=Math.max(e,.01);e*=2,b*=e<=1?e:2-e,c*=z<=1?z:2-z;return[g,100*(0===e?2*c/(z+c):2*b/(e+b)),100*((e+b)/2)]},z.hsv.rgb=function(I){const g=I[0]/60,b=I[1]/100;let e=I[2]/100;const c=Math.floor(g)%6,z=g-Math.floor(g),M=255*e*(1-b),J=255*e*(1-b*z),o=255*e*(1-b*(1-z));switch(e*=255,c){case 0:return[e,o,M];case 1:return[J,e,M];case 2:return[M,e,o];case 3:return[M,J,e];case 4:return[o,M,e];case 5:return[e,M,J]}},z.hsv.hsl=function(I){const g=I[0],b=I[1]/100,e=I[2]/100,c=Math.max(e,.01);let z,M;M=(2-b)*e;const J=(2-b)*c;return z=b*c,z/=J<=1?J:2-J,z=z||0,M/=2,[g,100*z,100*M]},z.hwb.rgb=function(I){const g=I[0]/360;let b=I[1]/100,e=I[2]/100;const c=b+e;let z;c>1&&(b/=c,e/=c);const M=Math.floor(6*g),J=1-e;z=6*g-M,0!==(1&M)&&(z=1-z);const o=b+z*(J-b);let n,G,D;switch(M){default:case 6:case 0:n=J,G=o,D=b;break;case 1:n=o,G=J,D=b;break;case 2:n=b,G=J,D=o;break;case 3:n=b,G=o,D=J;break;case 4:n=o,G=b,D=J;break;case 5:n=J,G=b,D=o}return[255*n,255*G,255*D]},z.cmyk.rgb=function(I){const g=I[0]/100,b=I[1]/100,e=I[2]/100,c=I[3]/100;return[255*(1-Math.min(1,g*(1-c)+c)),255*(1-Math.min(1,b*(1-c)+c)),255*(1-Math.min(1,e*(1-c)+c))]},z.xyz.rgb=function(I){const g=I[0]/100,b=I[1]/100,e=I[2]/100;let c,z,M;return c=3.2406*g+-1.5372*b+-.4986*e,z=-.9689*g+1.8758*b+.0415*e,M=.0557*g+-.204*b+1.057*e,c=c>.0031308?1.055*c**(1/2.4)-.055:12.92*c,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,c=Math.min(Math.max(0,c),1),z=Math.min(Math.max(0,z),1),M=Math.min(Math.max(0,M),1),[255*c,255*z,255*M]},z.xyz.lab=function(I){let g=I[0],b=I[1],e=I[2];g/=95.047,b/=100,e/=108.883,g=g>.008856?g**(1/3):7.787*g+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,e=e>.008856?e**(1/3):7.787*e+16/116;return[116*b-16,500*(g-b),200*(b-e)]},z.lab.xyz=function(I){let g,b,e;b=(I[0]+16)/116,g=I[1]/500+b,e=b-I[2]/200;const c=b**3,z=g**3,M=e**3;return b=c>.008856?c:(b-16/116)/7.787,g=z>.008856?z:(g-16/116)/7.787,e=M>.008856?M:(e-16/116)/7.787,g*=95.047,b*=100,e*=108.883,[g,b,e]},z.lab.lch=function(I){const g=I[0],b=I[1],e=I[2];let c;c=360*Math.atan2(e,b)/2/Math.PI,c<0&&(c+=360);return[g,Math.sqrt(b*b+e*e),c]},z.lch.lab=function(I){const g=I[0],b=I[1],e=I[2]/360*2*Math.PI;return[g,b*Math.cos(e),b*Math.sin(e)]},z.rgb.ansi16=function(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,e,c]=I;let M=null===g?z.rgb.hsv(I)[2]:g;if(M=Math.round(M/50),0===M)return 30;let J=30+(Math.round(c/255)<<2|Math.round(e/255)<<1|Math.round(b/255));return 2===M&&(J+=60),J},z.hsv.ansi16=function(I){return z.rgb.ansi16(z.hsv.rgb(I),I[2])},z.rgb.ansi256=function(I){const g=I[0],b=I[1],e=I[2];if(g===b&&b===e)return g<8?16:g>248?231:Math.round((g-8)/247*24)+232;return 16+36*Math.round(g/255*5)+6*Math.round(b/255*5)+Math.round(e/255*5)},z.ansi16.rgb=function(I){let g=I%10;if(0===g||7===g)return I>50&&(g+=3.5),g=g/10.5*255,[g,g,g];const b=.5*(1+~~(I>50));return[(1&g)*b*255,(g>>1&1)*b*255,(g>>2&1)*b*255]},z.ansi256.rgb=function(I){if(I>=232){const g=10*(I-232)+8;return[g,g,g]}let g;I-=16;return[Math.floor(I/36)/5*255,Math.floor((g=I%36)/6)/5*255,g%6/5*255]},z.rgb.hex=function(I){const g=(((255&Math.round(I[0]))<<16)+((255&Math.round(I[1]))<<8)+(255&Math.round(I[2]))).toString(16).toUpperCase();return"000000".substring(g.length)+g},z.hex.rgb=function(I){const g=I.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!g)return[0,0,0];let b=g[0];3===g[0].length&&(b=b.split("").map((I=>I+I)).join(""));const e=parseInt(b,16);return[e>>16&255,e>>8&255,255&e]},z.rgb.hcg=function(I){const g=I[0]/255,b=I[1]/255,e=I[2]/255,c=Math.max(Math.max(g,b),e),z=Math.min(Math.min(g,b),e),M=c-z;let J,o;return J=M<1?z/(1-M):0,o=M<=0?0:c===g?(b-e)/M%6:c===b?2+(e-g)/M:4+(g-b)/M,o/=6,o%=1,[360*o,100*M,100*J]},z.hsl.hcg=function(I){const g=I[1]/100,b=I[2]/100,e=b<.5?2*g*b:2*g*(1-b);let c=0;return e<1&&(c=(b-.5*e)/(1-e)),[I[0],100*e,100*c]},z.hsv.hcg=function(I){const g=I[1]/100,b=I[2]/100,e=g*b;let c=0;return e<1&&(c=(b-e)/(1-e)),[I[0],100*e,100*c]},z.hcg.rgb=function(I){const g=I[0]/360,b=I[1]/100,e=I[2]/100;if(0===b)return[255*e,255*e,255*e];const c=[0,0,0],z=g%1*6,M=z%1,J=1-M;let o=0;switch(Math.floor(z)){case 0:c[0]=1,c[1]=M,c[2]=0;break;case 1:c[0]=J,c[1]=1,c[2]=0;break;case 2:c[0]=0,c[1]=1,c[2]=M;break;case 3:c[0]=0,c[1]=J,c[2]=1;break;case 4:c[0]=M,c[1]=0,c[2]=1;break;default:c[0]=1,c[1]=0,c[2]=J}return o=(1-b)*e,[255*(b*c[0]+o),255*(b*c[1]+o),255*(b*c[2]+o)]},z.hcg.hsv=function(I){const g=I[1]/100,b=g+I[2]/100*(1-g);let e=0;return b>0&&(e=g/b),[I[0],100*e,100*b]},z.hcg.hsl=function(I){const g=I[1]/100,b=I[2]/100*(1-g)+.5*g;let e=0;return b>0&&b<.5?e=g/(2*b):b>=.5&&b<1&&(e=g/(2*(1-b))),[I[0],100*e,100*b]},z.hcg.hwb=function(I){const g=I[1]/100,b=g+I[2]/100*(1-g);return[I[0],100*(b-g),100*(1-b)]},z.hwb.hcg=function(I){const g=I[1]/100,b=1-I[2]/100,e=b-g;let c=0;return e<1&&(c=(b-e)/(1-e)),[I[0],100*e,100*c]},z.apple.rgb=function(I){return[I[0]/65535*255,I[1]/65535*255,I[2]/65535*255]},z.rgb.apple=function(I){return[I[0]/255*65535,I[1]/255*65535,I[2]/255*65535]},z.gray.rgb=function(I){return[I[0]/100*255,I[0]/100*255,I[0]/100*255]},z.gray.hsl=function(I){return[0,0,I[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(I){return[0,100,I[0]]},z.gray.cmyk=function(I){return[0,0,0,I[0]]},z.gray.lab=function(I){return[I[0],0,0]},z.gray.hex=function(I){const g=255&Math.round(I[0]/100*255),b=((g<<16)+(g<<8)+g).toString(16).toUpperCase();return"000000".substring(b.length)+b},z.rgb.gray=function(I){return[(I[0]+I[1]+I[2])/3/255*100]}},14703:(I,g,b)=>{const e=b(14708),c=b(14721),z={};Object.keys(e).forEach((I=>{z[I]={},Object.defineProperty(z[I],"channels",{value:e[I].channels}),Object.defineProperty(z[I],"labels",{value:e[I].labels});const g=c(I);Object.keys(g).forEach((b=>{const e=g[b];z[I][b]=function(I){const g=function(){for(var g=arguments.length,b=new Array(g),e=0;e<g;e++)b[e]=arguments[e];const c=b[0];if(void 0===c||null===c)return c;c.length>1&&(b=c);const z=I(b);if("object"===typeof z)for(let I=z.length,M=0;M<I;M++)z[M]=Math.round(z[M]);return z};return"conversion"in I&&(g.conversion=I.conversion),g}(e),z[I][b].raw=function(I){const g=function(){for(var g=arguments.length,b=new Array(g),e=0;e<g;e++)b[e]=arguments[e];const c=b[0];return void 0===c||null===c?c:(c.length>1&&(b=c),I(b))};return"conversion"in I&&(g.conversion=I.conversion),g}(e)}))})),I.exports=z},14721:(I,g,b)=>{const e=b(14708);function c(I){const g=function(){const I={},g=Object.keys(e);for(let b=g.length,e=0;e<b;e++)I[g[e]]={distance:-1,parent:null};return I}(),b=[I];for(g[I].distance=0;b.length;){const I=b.pop(),c=Object.keys(e[I]);for(let e=c.length,z=0;z<e;z++){const e=c[z],M=g[e];-1===M.distance&&(M.distance=g[I].distance+1,M.parent=I,b.unshift(e))}}return g}function z(I,g){return function(b){return g(I(b))}}function M(I,g){const b=[g[I].parent,I];let c=e[g[I].parent][I],M=g[I].parent;for(;g[M].parent;)b.unshift(g[M].parent),c=z(e[g[M].parent][M],c),M=g[M].parent;return c.conversion=b,c}I.exports=function(I){const g=c(I),b={},e=Object.keys(g);for(let c=e.length,z=0;z<c;z++){const I=e[z];null!==g[I].parent&&(b[I]=M(I,g))}return b}},14717:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13271:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.discordURLBuilder=void 0,g.discordURLBuilder=function(I){var g;const b=(null===(g=null===window||void 0===window?void 0:window.location)||void 0===g?void 0:g.hostname)||"localhost",e=I.hostname.split("."),c=!I.hostname.includes("trycloudflare.com")&&!I.hostname.includes("discordsays.com")&&e.length>2?`/${e[0]}`:"";return I.pathname.startsWith("/.proxy")?`${I.protocol}//${b}${c}${I.pathname}${I.search}`:`${I.protocol}//${b}/.proxy/colyseus${c}${I.pathname}${I.search}`}},13262:function(I,g,b){"use strict";var e,c,z,M,J=this&&this.__awaiter||function(I,g,b,e){return new(b||(b=Promise))((function(c,z){function M(I){try{o(e.next(I))}catch(g){z(g)}}function J(I){try{o(e.throw(I))}catch(g){z(g)}}function o(I){var g;I.done?c(I.value):(g=I.value,g instanceof b?g:new b((function(I){I(g)}))).then(M,J)}o((e=e.apply(I,g||[])).next())}))},o=this&&this.__classPrivateFieldGet||function(I,g,b,e){if("a"===b&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof g?I!==g||!e:!g.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===b?e:"a"===b?e.call(I):e?e.value:g.get(I)},n=this&&this.__classPrivateFieldSet||function(I,g,b,e,c){if("m"===e)throw new TypeError("Private method is not writable");if("a"===e&&!c)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof g?I!==g||!c:!g.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?c.call(I,b):c?c.value=b:g.set(I,b),b};Object.defineProperty(g,"__esModule",{value:!0}),g.Auth=void 0;const G=b(13264),D=b(13235);g.Auth=class{constructor(I){this.http=I,this.settings={path:"/auth",key:"colyseus-auth-token"},e.set(this,!1),c.set(this,void 0),z.set(this,void 0),M.set(this,(0,D.createNanoEvents)()),(0,G.getItem)(this.settings.key,(I=>this.token=I))}set token(I){this.http.authToken=I}get token(){return this.http.authToken}onChange(I){const g=o(this,M,"f").on("change",I);return o(this,e,"f")||n(this,c,new Promise(((I,g)=>{this.getUserData().then((I=>{this.emitChange(Object.assign(Object.assign({},I),{token:this.token}))})).catch((I=>{this.emitChange({user:null,token:void 0})})).finally((()=>{I()}))})),"f"),n(this,e,!0,"f"),g}getUserData(){return J(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(I,g,b){return J(this,void 0,void 0,(function*(){const e=(yield this.http.post(`${this.settings.path}/register`,{body:{email:I,password:g,options:b}})).data;return this.emitChange(e),e}))}signInWithEmailAndPassword(I,g){return J(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/login`,{body:{email:I,password:g}})).data;return this.emitChange(b),b}))}signInAnonymously(I){return J(this,void 0,void 0,(function*(){const g=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:I}})).data;return this.emitChange(g),g}))}sendPasswordResetEmail(I){return J(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:I}})).data}))}signInWithProvider(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,(function*(){return new Promise(((b,e)=>{const c=g.width||480,M=g.height||768,J=this.token?`?token=${this.token}`:"",G=`Login with ${I[0].toUpperCase()+I.substring(1)}`,D=this.http.client.getHttpEndpoint(`${g.prefix||`${this.settings.path}/provider`}/${I}${J}`),p=screen.width/2-c/2,x=screen.height/2-M/2;n(this,z,window.open(D,G,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+c+", height="+M+", top="+x+", left="+p),"f");const Z=I=>{void 0===I.data.user&&void 0===I.data.token||(clearInterval(k),o(this,z,"f").close(),n(this,z,void 0,"f"),window.removeEventListener("message",Z),void 0!==I.data.error?e(I.data.error):(b(I.data),this.emitChange(I.data)))},k=setInterval((()=>{o(this,z,"f")&&!o(this,z,"f").closed||(n(this,z,void 0,"f"),e("gn"),window.removeEventListener("message",Z))}),200);window.addEventListener("message",Z)}))}))}signOut(){return J(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(I){void 0!==I.token&&(this.token=I.token,null===I.token?(0,G.removeItem)(this.settings.key):(0,G.setItem)(this.settings.key,I.token)),o(this,M,"f").emit("change",I)}},e=new WeakMap,c=new WeakMap,z=new WeakMap,M=new WeakMap},13183:function(I,g,b){"use strict";var e,c=this&&this.__awaiter||function(I,g,b,e){return new(b||(b=Promise))((function(c,z){function M(I){try{o(e.next(I))}catch(g){z(g)}}function J(I){try{o(e.throw(I))}catch(g){z(g)}}function o(I){var g;I.done?c(I.value):(g=I.value,g instanceof b?g:new b((function(I){I(g)}))).then(M,J)}o((e=e.apply(I,g||[])).next())}))};Object.defineProperty(g,"__esModule",{value:!0}),g.Client=g.MatchMakeError=void 0;const z=b(13190),M=b(13192),J=b(13255),o=b(13262),n=b(13271);class G extends Error{constructor(I,g){super(I),this.code=g,Object.setPrototypeOf(this,G.prototype)}}g.MatchMakeError=G;const D="undefined"!==typeof window&&"undefined"!==typeof(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";g.Client=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,g=arguments.length>1?arguments[1]:void 0;var b,e;if("string"===typeof I){const g=I.startsWith("/")?new URL(I,D):new URL(I),b="https:"===g.protocol||"wss:"===g.protocol,e=Number(g.port||(b?443:80));this.settings={hostname:g.hostname,pathname:g.pathname,port:e,secure:b}}else void 0===I.port&&(I.port=I.secure?443:80),void 0===I.pathname&&(I.pathname=""),this.settings=I;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new J.HTTP(this,(null===g||void 0===g?void 0:g.headers)||{}),this.auth=new o.Auth(this.http),this.urlBuilder=null===g||void 0===g?void 0:g.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(e=null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||void 0===e?void 0:e.includes("discordsays.com"))&&(this.urlBuilder=n.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",I,g,b)}))}create(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",I,g,b)}))}join(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",I,g,b)}))}joinById(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return c(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",I,g,b)}))}reconnect(I,g){return c(this,void 0,void 0,(function*(){if("string"===typeof I&&"string"===typeof g)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,e]=I.split(":");if(!b||!e)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:e},g)}))}getAvailableRooms(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return c(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${I}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(I,g,b){return c(this,void 0,void 0,(function*(){const e=this.createRoom(I.room.name,g);e.roomId=I.room.roomId,e.sessionId=I.sessionId;const M={sessionId:e.sessionId};I.reconnectionToken&&(M.reconnectionToken=I.reconnectionToken);const J=b||e;return e.connect(this.buildEndpoint(I.room,M),I.devMode&&(()=>c(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${e.roomId}'...`);let b=0;const z=()=>c(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(I,g,J),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${e.roomId}'`)}catch(c){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(z,2e3)}))),J,this.http.headers),new Promise(((I,g)=>{const b=(I,b)=>g(new z.ServerError(I,b));J.onError.once(b),J.onJoin.once((()=>{J.onError.remove(b),setTimeout((()=>{try{J.pG(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),I(J)}))}))}))}createMatchMakeRequest(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;return c(this,void 0,void 0,(function*(){const c=(yield this.http.post(`matchmake/${I}/${g}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(c.error)throw new G(c.error,c.code);return"reconnect"===I&&(c.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(c,e,z)}))}createRoom(I,g){return new M.Room(I,g)}buildEndpoint(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const z in g)g.hasOwnProperty(z)&&b.push(`${z}=${g[z]}`);let e=this.settings.secure?"wss://":"ws://";I.publicAddress?e+=`${I.publicAddress}`:e+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const c=`${e}/${I.processId}/${I.roomId}?${b.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(c)):c}getHttpEndpoint(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const g=I.startsWith("/")?I:`/${I}`,b=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${g}`;return this.urlBuilder?this.urlBuilder(new URL(b)):b}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13208:(I,g,b)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.Connection=void 0;const e=b(13211);g.Connection=class{constructor(){this.events={},this.transport=new e.WebSocketTransport(this.events)}send(I){this.transport.send(I)}connect(I,g){this.transport.connect(I,g)}close(I,g){this.transport.close(I,g)}get isOpen(){return this.transport.isOpen}}},13255:function(I,g,b){"use strict";var e=this&&this.__createBinding||(Object.create?function(I,g,b,e){void 0===e&&(e=b);var c=Object.getOwnPropertyDescriptor(g,b);c&&!("get"in c?!g.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return g[b]}}),Object.defineProperty(I,e,c)}:function(I,g,b,e){void 0===e&&(e=b),I[e]=g[b]}),c=this&&this.__setModuleDefault||(Object.create?function(I,g){Object.defineProperty(I,"default",{enumerable:!0,value:g})}:function(I,g){I.default=g}),z=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var g={};if(null!=I)for(var b in I)"default"!==b&&Object.prototype.hasOwnProperty.call(I,b)&&e(g,I,b);return c(g,I),g};Object.defineProperty(g,"__esModule",{value:!0}),g.HTTP=void 0;const M=b(13190),J=z(b(13257));g.HTTP=class{constructor(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=I,this.headers=g}get(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",I,g)}post(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",I,g)}del(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",I,g)}put(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",I,g)}request(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J[I](this.client.getHttpEndpoint(g),this.getOptions(b)).catch((I=>{var g;const b=I.statusCode,e=(null===(g=I.data)||void 0===g?void 0:g.error)||I.statusMessage||I.message;if(!b&&!e)throw I;throw new M.ServerError(b,e)}))}getOptions(I){return I.headers=Object.assign({},this.headers,I.headers),this.authToken&&(I.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(I.withCredentials=!0),I}}},13224:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.utf8Length=g.utf8Read=g.ErrorCode=g.Protocol=void 0,function(I){I[I.HANDSHAKE=9]="HANDSHAKE",I[I.JOIN_ROOM=10]="JOIN_ROOM",I[I.ERROR=11]="ERROR",I[I.LEAVE_ROOM=12]="LEAVE_ROOM",I[I.ROOM_DATA=13]="ROOM_DATA",I[I.ROOM_STATE=14]="ROOM_STATE",I[I.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",I[I.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I[I.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(g.Protocol||(g.Protocol={})),function(I){I[I.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",I[I.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",I[I.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",I[I.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",I[I.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",I[I.AUTH_FAILED=4215]="AUTH_FAILED",I[I.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(g.ErrorCode||(g.ErrorCode={})),g.utf8Read=function(I,g){const b=I[g++];for(var e="",c=0,z=g,M=g+b;z<M;z++){var J=I[z];if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(c=(7&J)<<18|(63&I[++z])<<12|(63&I[++z])<<6|63&I[++z])>=65536?(c-=65536,e+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):e+=String.fromCharCode(c)}else e+=String.fromCharCode((15&J)<<12|(63&I[++z])<<6|63&I[++z]);else e+=String.fromCharCode((31&J)<<6|63&I[++z]);else e+=String.fromCharCode(J)}return e},g.utf8Length=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",g=0,b=0;for(let e=0,c=I.length;e<c;e++)g=I.charCodeAt(e),g<128?b+=1:g<2048?b+=2:g<55296||g>=57344?b+=3:(e++,b+=4);return b+1}},13192:function(I,g,b){"use strict";var e=this&&this.__createBinding||(Object.create?function(I,g,b,e){void 0===e&&(e=b);var c=Object.getOwnPropertyDescriptor(g,b);c&&!("get"in c?!g.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return g[b]}}),Object.defineProperty(I,e,c)}:function(I,g,b,e){void 0===e&&(e=b),I[e]=g[b]}),c=this&&this.__setModuleDefault||(Object.create?function(I,g){Object.defineProperty(I,"default",{enumerable:!0,value:g})}:function(I,g){I.default=g}),z=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var g={};if(null!=I)for(var b in I)"default"!==b&&Object.prototype.hasOwnProperty.call(I,b)&&e(g,I,b);return c(g,I),g};Object.defineProperty(g,"__esModule",{value:!0}),g.Room=void 0;const M=z(b(13199)),J=b(13208),o=b(13224),n=b(13228),G=b(13235),D=b(13242),p=b(13248),x=b(13190);class Z{constructor(I,g){this.onStateChange=(0,D.createSignal)(),this.onError=(0,D.createSignal)(),this.onLeave=(0,D.createSignal)(),this.onJoin=(0,D.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,G.createNanoEvents)(),this.roomId=null,this.name=I,g&&(this.serializer=new((0,n.getSerializer)("schema")),this.rootSchema=g,this.serializer.state=new g),this.onError(((I,g)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${I}) ${g}`)})),this.onLeave((()=>this.zg()))}get id(){return this.roomId}connect(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,e=arguments.length>3?arguments[3]:void 0;const c=new J.Connection;b.connection=c,c.events.onmessage=Z.prototype.onMessageCallback.bind(b),c.events.onclose=function(I){var e;if(!b.hasJoined)return null===(e=console.warn)||void 0===e||e.call(console,`Room connection was closed unexpectedly (${I.code}): ${I.reason}`),void b.onError.invoke(I.code,I.reason);I.code===x.CloseCode.DEVMODE_RESTART&&g?g():(b.onLeave.invoke(I.code,I.reason),b.destroy())},c.events.onerror=function(I){var g;null===(g=console.warn)||void 0===g||g.call(console,`Room, onError (${I.code}): ${I.reason}`),b.onError.invoke(I.code,I.reason)},c.connect(I,e)}En(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((g=>{this.onLeave((I=>g(I))),this.connection?I?this.connection.send([o.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(x.CloseCode.CONSENTED)}))}yg(I,g){return this.onMessageHandlers.on(this.getMessageHandlerKey(I),g)}send(I,g){const b=[o.Protocol.ROOM_DATA];let e;if("string"===typeof I?p.encode.string(b,I):p.encode.number(b,I),void 0!==g){const I=M.encode(g);e=new Uint8Array(b.length+I.byteLength),e.set(new Uint8Array(b),0),e.set(new Uint8Array(I),b.length)}else e=new Uint8Array(b);this.connection.send(e.buffer)}pG(I,g){const b=[o.Protocol.ROOM_DATA_BYTES];let e;"string"===typeof I?p.encode.string(b,I):p.encode.number(b,I),e=new Uint8Array(b.length+(g.byteLength||g.length)),e.set(new Uint8Array(b),0),e.set(new Uint8Array(g),b.length),this.connection.send(e.buffer)}get state(){return this.serializer.getState()}zg(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(I){const g=Array.from(new Uint8Array(I.data)),b=g[0];if(b===o.Protocol.JOIN_ROOM){let I=1;const b=(0,o.utf8Read)(g,I);if(I+=(0,o.utf8Length)(b),this.serializerId=(0,o.utf8Read)(g,I),I+=(0,o.utf8Length)(this.serializerId),!this.serializer){const I=(0,n.getSerializer)(this.serializerId);this.serializer=new I}g.length>I&&this.serializer.handshake&&this.serializer.handshake(g,{offset:I}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([o.Protocol.JOIN_ROOM])}else if(b===o.Protocol.ERROR){const I={offset:1},b=p.decode.number(g,I),e=p.decode.string(g,I);this.onError.invoke(b,e)}else if(b===o.Protocol.LEAVE_ROOM)this.En();else if(b===o.Protocol.ROOM_DATA_SCHEMA){const I={offset:1},b=this.serializer.getState().constructor._context.get(p.decode.number(g,I)),e=new b;e.decode(g,I),this.dispatchMessage(b,e)}else if(b===o.Protocol.ROOM_STATE)g.shift(),this.setState(g);else if(b===o.Protocol.ROOM_STATE_PATCH)g.shift(),this.patch(g);else if(b===o.Protocol.ROOM_DATA){const b={offset:1},e=p.decode.stringCheck(g,b)?p.decode.string(g,b):p.decode.number(g,b),c=g.length>b.offset?M.decode(I.data,b.offset):void 0;this.dispatchMessage(e,c)}else if(b===o.Protocol.ROOM_DATA_BYTES){const I={offset:1},b=p.decode.stringCheck(g,I)?p.decode.string(g,I):p.decode.number(g,I);this.dispatchMessage(b,new Uint8Array(g.slice(I.offset)))}}setState(I){this.serializer.setState(I),this.onStateChange.invoke(this.serializer.getState())}patch(I){this.serializer.patch(I),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(I,g){var b;const e=this.getMessageHandlerKey(I);this.onMessageHandlers.events[e]?this.onMessageHandlers.emit(e,g):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",I,g):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${I}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(I){switch(typeof I){case"function":return`$${I._typeid}`;case"string":return I;case"number":return`i${I}`;default:throw new Error("invalid message type.")}}}g.Room=Z},13264:(I,g)=>{"use strict";let b;function e(){if(!b)try{b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(I){}return b||(b={cache:{},setItem:function(I,g){this.cache[I]=g},getItem:function(I){this.cache[I]},removeItem:function(I){delete this.cache[I]}}),b}Object.defineProperty(g,"__esModule",{value:!0}),g.getItem=g.removeItem=g.setItem=void 0,g.setItem=function(I,g){e().setItem(I,g)},g.removeItem=function(I){e().removeItem(I)},g.getItem=function(I,g){const b=e().getItem(I);"undefined"!==typeof Promise&&b instanceof Promise?b.then((I=>g(I))):g(b)}},13235:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.createNanoEvents=void 0;g.createNanoEvents=()=>({emit(I){let g=this.events[I]||[];for(var b=arguments.length,e=new Array(b>1?b-1:0),c=1;c<b;c++)e[c-1]=arguments[c];for(let z=0,M=g.length;z<M;z++)g[z](...e)},events:{},on(I,g){var b;return(null===(b=this.events[I])||void 0===b?void 0:b.push(g))||(this.events[I]=[g]),()=>{var b;this.events[I]=null===(b=this.events[I])||void 0===b?void 0:b.filter((I=>g!==I))}}})},13242:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.createSignal=g.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(I){return this.handlers.push(I),this}invoke(){for(var I=arguments.length,g=new Array(I),b=0;b<I;b++)g[b]=arguments[b];this.handlers.forEach((I=>I.apply(this,g)))}invokeAsync(){for(var I=arguments.length,g=new Array(I),b=0;b<I;b++)g[b]=arguments[b];return Promise.all(this.handlers.map((I=>I.apply(this,g))))}remove(I){const g=this.handlers.indexOf(I);this.handlers[g]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}g.EventEmitter=b,g.createSignal=function(){const I=new b;function g(g){return I.register(g,null===this)}return g.once=g=>{const b=function(){for(var e=arguments.length,c=new Array(e),z=0;z<e;z++)c[z]=arguments[z];g.apply(this,c),I.remove(b)};I.register(b)},g.remove=g=>I.remove(g),g.invoke=function(){return I.invoke(...arguments)},g.invokeAsync=function(){return I.invokeAsync(...arguments)},g.clear=()=>I.clear(),g}},13190:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.ServerError=g.CloseCode=void 0,function(I){I[I.CONSENTED=4e3]="CONSENTED",I[I.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(g.CloseCode||(g.CloseCode={}));class b extends Error{constructor(I,g){super(g),this.name="ServerError",this.code=I}}g.ServerError=b},13171:(I,g,b)=>{"use strict";g.b=void 0,b(13175);var e=b(13183);Object.defineProperty(g,"b",{enumerable:!0,get:function(){return e.Client}});var c=b(13224);var z=b(13192);var M=b(13262);const J=b(13277);const o=b(13286),n=b(13228);(0,n.registerSerializer)("schema",J.SchemaSerializer),(0,n.registerSerializer)("none",o.NoneSerializer)},13175:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=I=>null!==I&&"object"===typeof I&&I.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13199:(I,g)=>{"use strict";function b(I,g){if(this._offset=g,I instanceof ArrayBuffer)this._buffer=I,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(I))throw new Error("Invalid argument");this._buffer=I.buffer,this._view=new DataView(this._buffer,I.byteOffset,I.byteLength)}}Object.defineProperty(g,"__esModule",{value:!0}),g.decode=g.encode=void 0,b.prototype._array=function(I){for(var g=new Array(I),b=0;b<I;b++)g[b]=this._parse();return g},b.prototype._map=function(I){for(var g={},b=0;b<I;b++)g[this._parse()]=this._parse();return g},b.prototype._str=function(I){var g=function(I,g,b){for(var e="",c=0,z=g,M=g+b;z<M;z++){var J=I.getUint8(z);if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(c=(7&J)<<18|(63&I.getUint8(++z))<<12|(63&I.getUint8(++z))<<6|63&I.getUint8(++z))>=65536?(c-=65536,e+=String.fromCharCode(55296+(c>>>10),56320+(1023&c))):e+=String.fromCharCode(c)}else e+=String.fromCharCode((15&J)<<12|(63&I.getUint8(++z))<<6|63&I.getUint8(++z));else e+=String.fromCharCode((31&J)<<6|63&I.getUint8(++z));else e+=String.fromCharCode(J)}return e}(this._view,this._offset,I);return this._offset+=I,g},b.prototype._bin=function(I){var g=this._buffer.slice(this._offset,this._offset+I);return this._offset+=I,g},b.prototype._parse=function(){var I,g=this._view.getUint8(this._offset++),b=0,e=0,c=0,z=0;if(g<192)return g<128?g:g<144?this._map(15&g):g<160?this._array(15&g):this._str(31&g);if(g>223)return-1*(255-g+1);switch(g){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),e=this._view.getInt8(this._offset+1),this._offset+=2,-1===e){var M=this._view.getUint32(this._offset);return c=this._view.getInt32(this._offset+4),z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*c+z)+M/1e6)}return[e,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),e=this._view.getInt8(this._offset+2),this._offset+=3,[e,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),e=this._view.getInt8(this._offset+4),this._offset+=5,[e,this._bin(b)];case 202:return I=this._view.getFloat32(this._offset),this._offset+=4,I;case 203:return I=this._view.getFloat64(this._offset),this._offset+=8,I;case 204:return I=this._view.getUint8(this._offset),this._offset+=1,I;case 205:return I=this._view.getUint16(this._offset),this._offset+=2,I;case 206:return I=this._view.getUint32(this._offset),this._offset+=4,I;case 207:return c=this._view.getUint32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,c+z;case 208:return I=this._view.getInt8(this._offset),this._offset+=1,I;case 209:return I=this._view.getInt16(this._offset),this._offset+=2,I;case 210:return I=this._view.getInt32(this._offset),this._offset+=4,I;case 211:return c=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,c+z;case 212:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?void(this._offset+=1):[e,this._bin(1)];case 213:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(2)];case 214:return e=this._view.getInt8(this._offset),this._offset+=1,-1===e?(I=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*I)):[e,this._bin(4)];case 215:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?(c=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(c+z)):-1===e?(c=this._view.getUint32(this._offset),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&c)+z)+(c>>>2)/1e6)):[e,this._bin(8)];case 216:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},g.decode=function(I){var g=new b(I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),e=g._parse();if(g._offset!==I.byteLength)throw new Error(I.byteLength-g._offset+" trailing bytes");return e};function e(I,g,b){for(var e=0,c=0,z=b.length;c<z;c++)(e=b.charCodeAt(c))<128?I.setUint8(g++,e):e<2048?(I.setUint8(g++,192|e>>6),I.setUint8(g++,128|63&e)):e<55296||e>=57344?(I.setUint8(g++,224|e>>12),I.setUint8(g++,128|e>>6&63),I.setUint8(g++,128|63&e)):(c++,e=65536+((1023&e)<<10|1023&b.charCodeAt(c)),I.setUint8(g++,240|e>>18),I.setUint8(g++,128|e>>12&63),I.setUint8(g++,128|e>>6&63),I.setUint8(g++,128|63&e))}function c(I,g,b){var e=typeof b,z=0,M=0,J=0,o=0,n=0,G=0;if("string"===e){if(n=function(I){for(var g=0,b=0,e=0,c=I.length;e<c;e++)(g=I.charCodeAt(e))<128?b+=1:g<2048?b+=2:g<55296||g>=57344?b+=3:(e++,b+=4);return b}(b),n<32)I.push(160|n),G=1;else if(n<256)I.push(217,n),G=2;else if(n<65536)I.push(218,n>>8,n),G=3;else{if(!(n<4294967296))throw new Error("String too long");I.push(219,n>>24,n>>16,n>>8,n),G=5}return g.push({_str:b,_length:n,_offset:I.length}),G+n}if("number"===e)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(I.push(b),1):b<256?(I.push(204,b),2):b<65536?(I.push(205,b>>8,b),3):b<4294967296?(I.push(206,b>>24,b>>16,b>>8,b),5):(J=b/Math.pow(2,32)|0,o=b>>>0,I.push(207,J>>24,J>>16,J>>8,J,o>>24,o>>16,o>>8,o),9):b>=-32?(I.push(b),1):b>=-128?(I.push(208,b),2):b>=-32768?(I.push(209,b>>8,b),3):b>=-2147483648?(I.push(210,b>>24,b>>16,b>>8,b),5):(J=Math.floor(b/Math.pow(2,32)),o=b>>>0,I.push(211,J>>24,J>>16,J>>8,J,o>>24,o>>16,o>>8,o),9):(I.push(203),g.push({_float:b,_length:8,_offset:I.length}),9);if("object"===e){if(null===b)return I.push(192),1;if(Array.isArray(b)){if((n=b.length)<16)I.push(144|n),G=1;else if(n<65536)I.push(220,n>>8,n),G=3;else{if(!(n<4294967296))throw new Error("Array too large");I.push(221,n>>24,n>>16,n>>8,n),G=5}for(z=0;z<n;z++)G+=c(I,g,b[z]);return G}if(b instanceof Date){var D=b.getTime(),p=Math.floor(D/1e3),x=1e6*(D-1e3*p);return p>=0&&x>=0&&p<=17179869183?0===x&&p<=4294967295?(I.push(214,255,p>>24,p>>16,p>>8,p),6):(J=p/4294967296,o=4294967295&p,I.push(215,255,x>>22,x>>14,x>>6,J,o>>24,o>>16,o>>8,o),10):(J=Math.floor(p/4294967296),o=p>>>0,I.push(199,12,255,x>>24,x>>16,x>>8,x,J>>24,J>>16,J>>8,J,o>>24,o>>16,o>>8,o),15)}if(b instanceof ArrayBuffer){if((n=b.byteLength)<256)I.push(196,n),G=2;else if(n<65536)I.push(197,n>>8,n),G=3;else{if(!(n<4294967296))throw new Error("Buffer too large");I.push(198,n>>24,n>>16,n>>8,n),G=5}return g.push({_bin:b,_length:n,_offset:I.length}),G+n}if("function"===typeof b.toJSON)return c(I,g,b.toJSON());var Z=[],k="",S=Object.keys(b);for(z=0,M=S.length;z<M;z++)void 0!==b[k=S[z]]&&"function"!==typeof b[k]&&Z.push(k);if((n=Z.length)<16)I.push(128|n),G=1;else if(n<65536)I.push(222,n>>8,n),G=3;else{if(!(n<4294967296))throw new Error("Object too large");I.push(223,n>>24,n>>16,n>>8,n),G=5}for(z=0;z<n;z++)G+=c(I,g,k=Z[z]),G+=c(I,g,b[k]);return G}if("boolean"===e)return I.push(b?195:194),1;if("undefined"===e)return I.push(192),1;if("function"===typeof b.toJSON)return c(I,g,b.toJSON());throw new Error("Could not encode")}g.encode=function(I){var g=[],b=[],z=c(g,b,I),M=new ArrayBuffer(z),J=new DataView(M),o=0,n=0,G=-1;b.length>0&&(G=b[0]._offset);for(var D,p=0,x=0,Z=0,k=g.length;Z<k;Z++)if(J.setUint8(n+Z,g[Z]),Z+1===G){if(p=(D=b[o])._length,x=n+G,D._bin)for(var S=new Uint8Array(D._bin),f=0;f<p;f++)J.setUint8(x+f,S[f]);else D._str?e(J,x,D._str):void 0!==D._float&&J.setFloat64(x,D._float);n+=p,b[++o]&&(G=b[o]._offset)}return M}},13286:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.NoneSerializer=void 0;g.NoneSerializer=class{setState(I){}getState(){return null}patch(I){}teardown(){}handshake(I){}}},13277:(I,g,b)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.SchemaSerializer=void 0;const e=b(13248);g.SchemaSerializer=class{setState(I){return this.state.decode(I)}getState(){return this.state}patch(I){return this.state.decode(I)}teardown(){var I,g;null===(g=null===(I=this.state)||void 0===I?void 0:I.$changes)||void 0===g||g.root.clearRefs()}handshake(I,g){if(this.state){(new e.Reflection).decode(I,g)}else this.state=e.Reflection.decode(I,g)}}},13228:(I,g)=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0}),g.getSerializer=g.registerSerializer=void 0;const b={};g.registerSerializer=function(I,g){b[I]=g},g.getSerializer=function(I){const g=b[I];if(!g)throw new Error("missing serializer: "+I);return g}},13211:function(I,g,b){"use strict";var e=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(g,"__esModule",{value:!0}),g.WebSocketTransport=void 0;const c=e(b(13218)),z=globalThis.WebSocket||c.default;g.WebSocketTransport=class{constructor(I){this.events=I}send(I){I instanceof ArrayBuffer?this.ws.send(I):Array.isArray(I)&&this.ws.send(new Uint8Array(I).buffer)}connect(I,g){try{this.ws=new z(I,{headers:g,protocols:this.protocols})}catch(b){this.ws=new z(I,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(I,g){this.ws.close(I,g)}get isOpen(){return this.ws.readyState===z.OPEN}}},13218:I=>{"use strict";I.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13689:I=>{"use strict";I.exports=function(I){for(var g=new Array(I),b=0;b<I;++b)g[b]=b;return g}},13691:I=>{function g(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(g(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&g(I.slice(0,0))}(I)||!!I._isBuffer)}},13683:(I,g,b)=>{var e=b(13689),c=b(13691),z="undefined"!==typeof Float64Array;function M(I,g){return I[0]-g[0]}function J(){var I,g=this.stride,b=new Array(g.length);for(I=0;I<b.length;++I)b[I]=[Math.abs(g[I]),I];b.sort(M);var e=new Array(b.length);for(I=0;I<e.length;++I)e[I]=b[I][1];return e}function o(I,g){var b=["View",g,"d",I].join("");g<0&&(b="View_Nil"+I);var c="generic"===I;if(-1===g){var z="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(z)()}if(0===g){z="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(c?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(c?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",z)(n[I][0])}z=["'use strict'"];var M=e(g),o=M.map((function(I){return"i"+I})),G="this.offset+"+M.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),D=M.map((function(I){return"b"+I})).join(","),p=M.map((function(I){return"c"+I})).join(",");z.push("function "+b+"(a,"+D+","+p+",d){this.data=a","this.shape=["+D+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+I+"'","proto.dimension="+g),z.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+M.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===g?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),g<4?(z.push("function "+b+"_order(){"),2===g?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===g&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+b+"_set("+o.join(",")+",v){"),c?z.push("return this.data.set("+G+",v)}"):z.push("return this.data["+G+"]=v}"),z.push("proto.get=function "+b+"_get("+o.join(",")+"){"),c?z.push("return this.data.get("+G+")}"):z.push("return this.data["+G+"]}"),z.push("proto.index=function "+b+"_index(",o.join(),"){return "+G+"}"),z.push("proto.hi=function "+b+"_hi("+o.join(",")+"){return new "+b+"(this.data,"+M.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+M.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var x=M.map((function(I){return"a"+I+"=this.shape["+I+"]"})),Z=M.map((function(I){return"c"+I+"=this.stride["+I+"]"}));z.push("proto.lo=function "+b+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+Z.join(","));for(var k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'&&i"+k+">=0){d=i"+k+"|0;b+=c"+k+"*d;a"+k+"-=d}");z.push("return new "+b+"(this.data,"+M.map((function(I){return"a"+I})).join(",")+","+M.map((function(I){return"c"+I})).join(",")+",b)}"),z.push("proto.step=function "+b+"_step("+o.join(",")+"){var "+M.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+M.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'){d=i"+k+"|0;if(d<0){c+=b"+k+"*(a"+k+"-1);a"+k+"=ceil(-a"+k+"/d)}else{a"+k+"=ceil(a"+k+"/d)}b"+k+"*=d}");z.push("return new "+b+"(this.data,"+M.map((function(I){return"a"+I})).join(",")+","+M.map((function(I){return"b"+I})).join(",")+",c)}");var S=new Array(g),f=new Array(g);for(k=0;k<g;++k)S[k]="a[i"+k+"]",f[k]="b[i"+k+"]";z.push("proto.transpose=function "+b+"_transpose("+o+"){"+o.map((function(I,g){return I+"=("+I+"===undefined?"+g+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+S.join(",")+","+f.join(",")+",this.offset)}"),z.push("proto.pick=function "+b+"_pick("+o+"){var a=[],b=[],c=this.offset");for(k=0;k<g;++k)z.push("if(typeof i"+k+"==='number'&&i"+k+">=0){c=(c+this.stride["+k+"]*i"+k+")|0}else{a.push(this.shape["+k+"]);b.push(this.stride["+k+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+M.map((function(I){return"shape["+I+"]"})).join(",")+","+M.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(n[I],J)}var n={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,g,b,e){if(void 0===I)return(0,n.array[0])([]);"number"===typeof I&&(I=[I]),void 0===g&&(g=[I.length]);var M=g.length;if(void 0===b){b=new Array(M);for(var J=M-1,G=1;J>=0;--J)b[J]=G,G*=g[J]}if(void 0===e){e=0;for(J=0;J<M;++J)b[J]<0&&(e-=(g[J]-1)*b[J])}for(var D=function(I){if(c(I))return"buffer";if(z)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),p=n[D];p.length<=M+1;)p.push(o(D,p.length-1));return(0,p[M+1])(I,g,b,e)}},14662:I=>{var g;self,g=()=>(()=>{"use strict";var I={d:(g,b)=>{for(var e in b)I.o(b,e)&&!I.o(g,e)&&Object.defineProperty(g,e,{enumerable:!0,get:b[e]})},o:(I,g)=>Object.prototype.hasOwnProperty.call(I,g)},g={};I.d(g,{default:()=>H});var b,e=function(I,g){var b=g.x-I.x,e=g.y-I.y;return Math.sqrt(b*b+e*e)},c=function(I){return I*(Math.PI/180)},z=new Map,M=function(I){z.has(I)&&clearTimeout(z.get(I)),z.set(I,setTimeout(I,100))},J=function(I,g,b){for(var e,c=g.split(/[ ,]+/g),z=0;z<c.length;z+=1)e=c[z],I.addEventListener?I.addEventListener(e,b,!1):I.attachEvent&&I.attachEvent(e,b)},o=function(I,g,b){for(var e,c=g.split(/[ ,]+/g),z=0;z<c.length;z+=1)e=c[z],I.removeEventListener?I.removeEventListener(e,b):I.detachEvent&&I.detachEvent(e,b)},n=function(I){return I.preventDefault(),I.type.match(/^touch/)?I.changedTouches:I},G=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},D=function(I,g){g.top||g.right||g.bottom||g.left?(I.style.top=g.top,I.style.right=g.right,I.style.bottom=g.bottom,I.style.left=g.left):(I.style.left=g.x+"px",I.style.top=g.y+"px")},p=function(I,g,b){var e=x(I);for(var c in e)if(e.hasOwnProperty(c))if("string"==typeof g)e[c]=g+" "+b;else{for(var z="",M=0,J=g.length;M<J;M+=1)z+=g[M]+" "+b+", ";e[c]=z.slice(0,-2)}return e},x=function(I){var g={};return g[I]="",["webkit","Moz","o"].forEach((function(b){g[b+I.charAt(0).toUpperCase()+I.slice(1)]=""})),g},Z=function(I,g){for(var b in g)g.hasOwnProperty(b)&&(I[b]=g[b]);return I},k=function(I,g){if(I.length)for(var b=0,e=I.length;b<e;b+=1)g(I[b]);else g(I)},S="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,f=window.matchMedia("(any-hover: none)").matches,V=!!("ontouchstart"in window),a=!!window.PointerEvent,v=!!window.MSPointerEvent,X={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},R={start:"mousedown",move:"mousemove",end:"mouseup"},E={};function mI(){}S&&!f?b=X:a?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:v?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:V?(b=X,E=R):b=R,mI.prototype.on=function(I,g){var b,e=this,c=I.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var z=0;z<c.length;z+=1)b=c[z],e._handlers_[b]=e._handlers_[b]||[],e._handlers_[b].push(g);return e},mI.prototype.off=function(I,g){var b=this;return b._handlers_=b._handlers_||{},void 0===I?b._handlers_={}:void 0===g?b._handlers_[I]=null:b._handlers_[I]&&b._handlers_[I].indexOf(g)>=0&&b._handlers_[I].splice(b._handlers_[I].indexOf(g),1),b},mI.prototype.trigger=function(I,g){var b,e=this,c=I.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var z=0;z<c.length;z+=1)b=c[z],e._handlers_[b]&&e._handlers_[b].length&&e._handlers_[b].forEach((function(I){I.call(e,{type:b,target:e},g)}))},mI.prototype.config=function(I){var g=this;g.options=g.defaults||{},I&&(g.options=function(I,g){var b={};for(var e in I)I.hasOwnProperty(e)&&g.hasOwnProperty(e)?b[e]=g[e]:I.hasOwnProperty(e)&&(b[e]=I[e]);return b}(g.options,I))},mI.prototype.bindEvt=function(I,g){var e=this;return e._domHandlers_=e._domHandlers_||{},e._domHandlers_[g]=function(){"function"==typeof e["on"+g]?e["on"+g].apply(e,arguments):console.warn('[WARNING] : Missing "on'+g+'" handler.')},J(I,b[g],e._domHandlers_[g]),E[g]&&J(I,E[g],e._domHandlers_[g]),e},mI.prototype.unbindEvt=function(I,g){var e=this;return e._domHandlers_=e._domHandlers_||{},o(I,b[g],e._domHandlers_[g]),E[g]&&o(I,E[g],e._domHandlers_[g]),delete e._domHandlers_[g],this};const s=mI;function F(I,g){return this.identifier=g.identifier,this.position=g.position,this.frontPosition=g.frontPosition,this.collection=I,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(g),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=F.id,F.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}F.prototype=new s,F.constructor=F,F.id=0,F.prototype.buildEl=function(I){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},F.prototype.stylize=function(){if(this.options.dataOnly)return this;var I=this.options.fadeTime+"ms",g=function(){var I=x("borderRadius");for(var g in I)I.hasOwnProperty(g)&&(I[g]="50%");return I}(),b=p("transition","opacity",I),e={};return e.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},e.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},e.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Z(e.el,b),"circle"===this.options.shape&&Z(e.back,g),Z(e.front,g),this.applyStyles(e),this},F.prototype.applyStyles=function(I){for(var g in this.ui)if(this.ui.hasOwnProperty(g))for(var b in I[g])this.ui[g].style[b]=I[g][b];return this},F.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},F.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},F.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},F.prototype.show=function(I){var g=this;return g.options.dataOnly||(clearTimeout(g.removeTimeout),clearTimeout(g.showTimeout),clearTimeout(g.restTimeout),g.addToDom(),g.restCallback(),setTimeout((function(){g.ui.el.style.opacity=1}),0),g.showTimeout=setTimeout((function(){g.trigger("shown",g.instance),"function"==typeof I&&I.call(this)}),g.options.fadeTime)),g},F.prototype.hide=function(I){var g=this;if(g.options.dataOnly)return g;if(g.ui.el.style.opacity=g.options.restOpacity,clearTimeout(g.removeTimeout),clearTimeout(g.showTimeout),clearTimeout(g.restTimeout),g.removeTimeout=setTimeout((function(){var b="dynamic"===g.options.mode?"none":"block";g.ui.el.style.display=b,"function"==typeof I&&I.call(g),g.trigger("hidden",g.instance)}),g.options.fadeTime),g.options.restJoystick){var b=g.options.restJoystick,e={};e.x=!0===b||!1!==b.x?0:g.instance.frontPosition.x,e.y=!0===b||!1!==b.y?0:g.instance.frontPosition.y,g.setPosition(I,e)}return g},F.prototype.setPosition=function(I,g){var b=this;b.frontPosition={x:g.x,y:g.y};var e=b.options.fadeTime+"ms",c={};c.front=p("transition",["transform"],e);var z={front:{}};z.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(c),b.applyStyles(z),b.restTimeout=setTimeout((function(){"function"==typeof I&&I.call(b),b.restCallback()}),b.options.fadeTime)},F.prototype.restCallback=function(){var I=this,g={};g.front=p("transition","none",""),I.applyStyles(g),I.trigger("rested",I.instance)},F.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},F.prototype.computeDirection=function(I){var g,b,e,c=I.angle.radian,z=Math.PI/4,M=Math.PI/2;if(c>z&&c<3*z&&!I.lockX?g="up":c>-z&&c<=z&&!I.lockY?g="left":c>3*-z&&c<=-z&&!I.lockX?g="down":I.lockY||(g="right"),I.lockY||(b=c>-M&&c<M?"left":"right"),I.lockX||(e=c>0?"up":"down"),I.force>this.options.threshold){var J,o={};for(J in this.direction)this.direction.hasOwnProperty(J)&&(o[J]=this.direction[J]);var n={};for(J in this.direction={x:b,y:e,angle:g},I.direction=this.direction,o)o[J]===this.direction[J]&&(n[J]=!0);if(n.x&&n.y&&n.angle)return I;n.x&&n.y||this.trigger("plain",I),n.x||this.trigger("plain:"+b,I),n.y||this.trigger("plain:"+e,I),n.angle||this.trigger("dir dir:"+g,I)}else this.resetDirection();return I};const Y=F;function d(I,g){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=I,b.id=d.id,d.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(g),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var e=getComputedStyle(b.options.zone.parentElement);return e&&"flex"===e.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.Px(),b.begin(),b.nipples}d.prototype=new s,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var I=this,g=I.nipples;g.on=I.on.bind(I),g.off=I.off.bind(I),g.options=I.options,g.destroy=I.destroy.bind(I),g.ids=I.ids,g.id=I.id,g.processOnMove=I.processOnMove.bind(I),g.processOnEnd=I.processOnEnd.bind(I),g.get=function(I){if(void 0===I)return g[0];for(var b=0,e=g.length;b<e;b+=1)if(g[b].identifier===I)return g[b];return!1}},d.prototype.Px=function(){var I=this;I.bindEvt(I.options.zone,"start"),I.options.zone.style.touchAction="none",I.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var I=this,g=I.options;if("static"===g.mode){var b=I.createNipple(g.position,I.manager.getIdentifier());b.add(),I.idles.push(b)}},d.prototype.createNipple=function(I,g){var b=this,e=b.manager.scroll,c={},z=b.options,M=b.parentIsFlex?e.x:e.x+b.box.left,J=b.parentIsFlex?e.y:e.y+b.box.top;if(I.x&&I.y)c={x:I.x-M,y:I.y-J};else if(I.top||I.right||I.bottom||I.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=I.top,o.style.right=I.right,o.style.bottom=I.bottom,o.style.left=I.left,o.style.position="absolute",z.zone.appendChild(o);var n=o.getBoundingClientRect();z.zone.removeChild(o),c=I,I={x:n.left+e.x,y:n.top+e.y}}var G=new Y(b,{color:z.color,size:z.size,threshold:z.threshold,fadeTime:z.fadeTime,dataOnly:z.dataOnly,restJoystick:z.restJoystick,restOpacity:z.restOpacity,mode:z.mode,identifier:g,position:I,zone:z.zone,frontPosition:{x:0,y:0},shape:z.shape});return z.dataOnly||(D(G.ui.el,c),D(G.ui.front,G.frontPosition)),b.nipples.push(G),b.trigger("added "+G.identifier+":added",G),b.manager.trigger("added "+G.identifier+":added",G),b.bindNipple(G),G},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(I){var g,b=this,e=function(I,e){g=I.type+" "+e.id+":"+I.type,b.trigger(g,e)};I.on("destroyed",b.onDestroyed.bind(b)),I.on("shown hidden rested dir plain",e),I.on("dir:up dir:right dir:down dir:left",e),I.on("plain:up plain:right plain:down plain:left",e)},d.prototype.pressureFn=function(I,g,b){var e=this,c=0;clearInterval(e.pressureIntervals[b]),e.pressureIntervals[b]=setInterval(function(){var b=I.force||I.pressure||I.webkitForce||0;b!==c&&(g.trigger("pressure",b),e.trigger("pressure "+g.identifier+":pressure",b),c=b)}.bind(e),100)},d.prototype.onstart=function(I){var g=this,b=g.options,e=I;return I=n(I),g.updateBox(),k(I,(function(c){g.actives.length<b.maxNumberOfNipples?g.processOnStart(c):e.type.match(/^touch/)&&(Object.keys(g.manager.ids).forEach((function(b){if(Object.values(e.touches).findIndex((function(I){return I.identifier===b}))<0){var c=[I[0]];c.identifier=b,g.processOnEnd(c)}})),g.actives.length<b.maxNumberOfNipples&&g.processOnStart(c))})),g.manager.bindDocument(),!1},d.prototype.processOnStart=function(I){var g,b=this,c=b.options,z=b.manager.getIdentifier(I),M=I.force||I.pressure||I.webkitForce||0,J={x:I.pageX,y:I.pageY},o=b.getOrCreate(z,J);o.identifier!==z&&b.manager.removeIdentifier(o.identifier),o.identifier=z;var n=function(g){g.trigger("start",g),b.trigger("start "+g.id+":start",g),g.show(),M>0&&b.pressureFn(I,g,g.identifier),b.processOnMove(I)};if((g=b.idles.indexOf(o))>=0&&b.idles.splice(g,1),b.actives.push(o),b.ids.push(o.identifier),"semi"!==c.mode)n(o);else{if(!(e(J,o.position)<=c.catchDistance))return o.destroy(),void b.processOnStart(I);n(o)}return o},d.prototype.getOrCreate=function(I,g){var b,e=this,c=e.options;return/(semi|static)/.test(c.mode)?(b=e.idles[0])?(e.idles.splice(0,1),b):"semi"===c.mode?e.createNipple(g,I):(console.warn("Coudln't find the needed nipple."),!1):b=e.createNipple(g,I)},d.prototype.processOnMove=function(I){var g=this,b=g.options,z=g.manager.getIdentifier(I),M=g.nipples.get(z),J=g.manager.scroll;if(function(I){return isNaN(I.buttons)?0!==I.pressure:0!==I.buttons}(I)){if(!M)return console.error("Found zombie joystick with ID "+z),void g.manager.removeIdentifier(z);if(b.dynamicPage){var o=M.el.getBoundingClientRect();M.position={x:J.x+o.left,y:J.y+o.top}}M.identifier=z;var n=M.options.size/2,G={x:I.pageX,y:I.pageY};b.lockX&&(G.y=M.position.y),b.lockY&&(G.x=M.position.x);var D,p,x,Z,k,S,f,V,a,v,X=e(G,M.position),R=(D=G,x=(p=M.position).x-D.x,Z=p.y-D.y,function(I){return I*(180/Math.PI)}(Math.atan2(Z,x))),E=c(R),mI=X/n,s={distance:X,position:G};if("circle"===M.options.shape?(k=Math.min(X,n),f=M.position,V=k,v={x:0,y:0},a=c(a=R),v.x=f.x-V*Math.cos(a),v.y=f.y-V*Math.sin(a),S=v):(S=function(I,g,b){return{x:Math.min(Math.max(I.x,g.x-b),g.x+b),y:Math.min(Math.max(I.y,g.y-b),g.y+b)}}(G,M.position,n),k=e(S,M.position)),b.follow){if(X>n){var F=G.x-S.x,Y=G.y-S.y;M.position.x+=F,M.position.y+=Y,M.el.style.top=M.position.y-(g.box.top+J.y)+"px",M.el.style.left=M.position.x-(g.box.left+J.x)+"px",X=e(G,M.position)}}else G=S,X=k;var d=G.x-M.position.x,C=G.y-M.position.y;M.frontPosition={x:d,y:C},b.dataOnly||(M.ui.front.style.transform="translate("+d+"px,"+C+"px)");var r={identifier:M.identifier,position:G,force:mI,pressure:I.force||I.pressure||I.webkitForce||0,distance:X,angle:{radian:E,degree:R},vector:{x:d/n,y:-C/n},raw:s,instance:M,lockX:b.lockX,lockY:b.lockY};(r=M.computeDirection(r)).angle={radian:c(180-R),degree:180-R},M.trigger("move",r),g.trigger("move "+M.id+":move",r)}else this.processOnEnd(I)},d.prototype.processOnEnd=function(I){var g=this,b=g.options,e=g.manager.getIdentifier(I),c=g.nipples.get(e),z=g.manager.removeIdentifier(c.identifier);c&&(b.dataOnly||c.hide((function(){"dynamic"===b.mode&&(c.trigger("removed",c),g.trigger("removed "+c.id+":removed",c),g.manager.trigger("removed "+c.id+":removed",c),c.destroy())})),clearInterval(g.pressureIntervals[c.identifier]),c.resetDirection(),c.trigger("end",c),g.trigger("end "+c.id+":end",c),g.ids.indexOf(c.identifier)>=0&&g.ids.splice(g.ids.indexOf(c.identifier),1),g.actives.indexOf(c)>=0&&g.actives.splice(g.actives.indexOf(c),1),/(semi|static)/.test(b.mode)?g.idles.push(c):g.nipples.indexOf(c)>=0&&g.nipples.splice(g.nipples.indexOf(c),1),g.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(g.manager.ids[z.id]=z.identifier))},d.prototype.onDestroyed=function(I,g){var b=this;b.nipples.indexOf(g)>=0&&b.nipples.splice(b.nipples.indexOf(g),1),b.actives.indexOf(g)>=0&&b.actives.splice(b.actives.indexOf(g),1),b.idles.indexOf(g)>=0&&b.idles.splice(b.idles.indexOf(g),1),b.ids.indexOf(g.identifier)>=0&&b.ids.splice(b.ids.indexOf(g.identifier),1),b.manager.removeIdentifier(g.identifier),b.manager.unbindDocument()},d.prototype.destroy=function(){var I=this;for(var g in I.unbindEvt(I.options.zone,"start"),I.nipples.forEach((function(I){I.destroy()})),I.pressureIntervals)I.pressureIntervals.hasOwnProperty(g)&&clearInterval(I.pressureIntervals[g]);I.trigger("destroyed",I.nipples),I.manager.unbindDocument(),I.off()};const C=d;function r(I){var g=this;g.ids={},g.index=0,g.collections=[],g.scroll=G(),g.config(I),g.prepareCollections();var b=function(){var I;g.collections.forEach((function(b){b.forEach((function(b){I=b.el.getBoundingClientRect(),b.position={x:g.scroll.x+I.left,y:g.scroll.y+I.top}}))}))};J(window,"resize",(function(){M(b)}));var e=function(){g.scroll=G()};return J(window,"scroll",(function(){M(e)})),g.collections}r.prototype=new s,r.constructor=r,r.prototype.prepareCollections=function(){var I=this;I.collections.create=I.create.bind(I),I.collections.on=I.on.bind(I),I.collections.off=I.off.bind(I),I.collections.destroy=I.destroy.bind(I),I.collections.get=function(g){var b;return I.collections.every((function(I){return!(b=I.get(g))})),b}},r.prototype.create=function(I){return this.createCollection(I)},r.prototype.createCollection=function(I){var g=this,b=new C(g,I);return g.bindCollection(b),g.collections.push(b),b},r.prototype.bindCollection=function(I){var g,b=this,e=function(I,e){g=I.type+" "+e.id+":"+I.type,b.trigger(g,e)};I.on("destroyed",b.onDestroyed.bind(b)),I.on("shown hidden rested dir plain",e),I.on("dir:up dir:right dir:down dir:left",e),I.on("plain:up plain:right plain:down plain:left",e)},r.prototype.bindDocument=function(){var I=this;I.binded||(I.bindEvt(document,"move").bindEvt(document,"end"),I.binded=!0)},r.prototype.unbindDocument=function(I){var g=this;Object.keys(g.ids).length&&!0!==I||(g.unbindEvt(document,"move").unbindEvt(document,"end"),g.binded=!1)},r.prototype.getIdentifier=function(I){var g;return I?void 0===(g=void 0===I.identifier?I.pointerId:I.identifier)&&(g=this.latest||0):g=this.index,void 0===this.ids[g]&&(this.ids[g]=this.index,this.index+=1),this.latest=g,this.ids[g]},r.prototype.removeIdentifier=function(I){var g={};for(var b in this.ids)if(this.ids[b]===I){g.id=b,g.identifier=this.ids[b],delete this.ids[b];break}return g},r.prototype.onmove=function(I){return this.onAny("move",I),!1},r.prototype.onend=function(I){return this.onAny("end",I),!1},r.prototype.oncancel=function(I){return this.onAny("end",I),!1},r.prototype.onAny=function(I,g){var b,e=this,c="processOn"+I.charAt(0).toUpperCase()+I.slice(1);g=n(g);var z=function(I,g,b){b.ids.indexOf(g)>=0&&(b[c](I),I._found_=!0)};return k(g,(function(I){b=e.getIdentifier(I),k(e.collections,z.bind(null,I,b)),I._found_||e.removeIdentifier(b)})),!1},r.prototype.destroy=function(){var I=this;I.unbindDocument(!0),I.ids={},I.index=0,I.collections.forEach((function(I){I.destroy()})),I.off()},r.prototype.onDestroyed=function(I,g){var b=this;if(b.collections.indexOf(g)<0)return!1;b.collections.splice(b.collections.indexOf(g),1)};var O=new r;const H={create:function(I){return O.create(I)},factory:O};return g.default})(),I.exports=g()},13708:(I,g,b)=>{"use strict";const{Deflate:e,deflate:c,deflateRaw:z,gzip:M}=b(13710),{Inflate:J,inflate:o,inflateRaw:n,ungzip:G}=b(13757),D=b(13745);I.exports.Deflate=e,I.exports.deflate=c,I.exports.deflateRaw=z,I.exports.gzip=M,I.exports.Inflate=J,I.exports.inflate=o,I.exports.inflateRaw=n,I.exports.ungzip=G,I.exports.constants=D},13710:(I,g,b)=>{"use strict";const e=b(13712),c=b(13747),z=b(13750),M=b(13737),J=b(13752),o=Object.prototype.toString,{Z_NO_FLUSH:n,Z_SYNC_FLUSH:G,Z_FULL_FLUSH:D,Z_FINISH:p,Z_OK:x,Z_STREAM_END:Z,Z_DEFAULT_COMPRESSION:k,Z_DEFAULT_STRATEGY:S,Z_DEFLATED:f}=b(13745);function V(I){this.options=c.assign({level:k,method:f,jI:16384,windowBits:15,memLevel:8,strategy:S},I||{});let g=this.options;g.raw&&g.windowBits>0?g.windowBits=-g.windowBits:g.gzip&&g.windowBits>0&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.Dg="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let b=e.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(b!==x)throw new Error(M[b]);if(g.header&&e.deflateSetHeader(this.strm,g.header),g.dictionary){let I;if(I="string"===typeof g.dictionary?z.string2buf(g.dictionary):"[object ArrayBuffer]"===o.call(g.dictionary)?new Uint8Array(g.dictionary):g.dictionary,b=e.deflateSetDictionary(this.strm,I),b!==x)throw new Error(M[b]);this._dict_set=!0}}function a(I,g){const b=new V(g);if(b.push(I,!0),b.err)throw b.Dg||M[b.err];return b.result}V.prototype.push=function(I,g){const b=this.strm,c=this.options.jI;let M,J;if(this.ended)return!1;for(J=g===~~g?g:!0===g?p:n,"string"===typeof I?b.input=z.string2buf(I):"[object ArrayBuffer]"===o.call(I)?b.input=new Uint8Array(I):b.input=I,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(c),b.next_out=0,b.avail_out=c),(J===G||J===D)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(M=e.deflate(b,J),M===Z)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),M=e.deflateEnd(this.strm),this.onEnd(M),this.ended=!0,M===x;if(0!==b.avail_out){if(J>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},V.prototype.onData=function(I){this.chunks.push(I)},V.prototype.onEnd=function(I){I===x&&(this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.Dg=this.strm.Dg},I.exports.Deflate=V,I.exports.deflate=a,I.exports.deflateRaw=function(I,g){return(g=g||{}).raw=!0,a(I,g)},I.exports.gzip=function(I,g){return(g=g||{}).gzip=!0,a(I,g)},I.exports.constants=b(13745)},13757:(I,g,b)=>{"use strict";const e=b(13759),c=b(13747),z=b(13750),M=b(13737),J=b(13752),o=b(13774),n=Object.prototype.toString,{Z_NO_FLUSH:G,Z_FINISH:D,Z_OK:p,Z_STREAM_END:x,Z_NEED_DICT:Z,Z_STREAM_ERROR:k,Z_DATA_ERROR:S,Z_MEM_ERROR:f}=b(13745);function V(I){this.options=c.assign({jI:65536,windowBits:15,to:""},I||{});const g=this.options;g.raw&&g.windowBits>=0&&g.windowBits<16&&(g.windowBits=-g.windowBits,0===g.windowBits&&(g.windowBits=-15)),!(g.windowBits>=0&&g.windowBits<16)||I&&I.windowBits||(g.windowBits+=32),g.windowBits>15&&g.windowBits<48&&0===(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.Dg="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let b=e.inflateInit2(this.strm,g.windowBits);if(b!==p)throw new Error(M[b]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),g.dictionary&&("string"===typeof g.dictionary?g.dictionary=z.string2buf(g.dictionary):"[object ArrayBuffer]"===n.call(g.dictionary)&&(g.dictionary=new Uint8Array(g.dictionary)),g.raw&&(b=e.inflateSetDictionary(this.strm,g.dictionary),b!==p)))throw new Error(M[b])}function a(I,g){const b=new V(g);if(b.push(I),b.err)throw b.Dg||M[b.err];return b.result}V.prototype.push=function(I,g){const b=this.strm,c=this.options.jI,M=this.options.dictionary;let J,o,V;if(this.ended)return!1;for(o=g===~~g?g:!0===g?D:G,"[object ArrayBuffer]"===n.call(I)?b.input=new Uint8Array(I):b.input=I,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(c),b.next_out=0,b.avail_out=c),J=e.inflate(b,o),J===Z&&M&&(J=e.inflateSetDictionary(b,M),J===p?J=e.inflate(b,o):J===S&&(J=Z));b.avail_in>0&&J===x&&b.state.wrap>0&&0!==I[b.next_in];)e.inflateReset(b),J=e.inflate(b,o);switch(J){case k:case S:case Z:case f:return this.onEnd(J),this.ended=!0,!1}if(V=b.avail_out,b.next_out&&(0===b.avail_out||J===x))if("string"===this.options.to){let I=z.utf8border(b.output,b.next_out),g=b.next_out-I,e=z.buf2string(b.output,I);b.next_out=g,b.avail_out=c-g,g&&b.output.set(b.output.subarray(I,I+g),0),this.onData(e)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(J!==p||0!==V){if(J===x)return J=e.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},V.prototype.onData=function(I){this.chunks.push(I)},V.prototype.onEnd=function(I){I===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.Dg=this.strm.Dg},I.exports.Inflate=V,I.exports.inflate=a,I.exports.inflateRaw=function(I,g){return(g=g||{}).raw=!0,a(I,g)},I.exports.ungzip=a,I.exports.constants=b(13745)},13747:I=>{"use strict";const g=(I,g)=>Object.prototype.hasOwnProperty.call(I,g);I.exports.assign=function(I){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const e=b.shift();if(e){if("object"!==typeof e)throw new TypeError(e+"must be non-object");for(const b in e)g(e,b)&&(I[b]=e[b])}}return I},I.exports.flattenChunks=I=>{let g=0;for(let e=0,c=I.length;e<c;e++)g+=I[e].length;const b=new Uint8Array(g);for(let e=0,c=0,z=I.length;e<z;e++){let g=I[e];b.set(g,c),c+=g.length}return b}},13750:I=>{"use strict";let g=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){g=!1}const b=new Uint8Array(256);for(let c=0;c<256;c++)b[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;b[254]=b[254]=1,I.exports.string2buf=I=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(I);let g,b,e,c,z,M=I.length,J=0;for(c=0;c<M;c++)b=I.charCodeAt(c),55296===(64512&b)&&c+1<M&&(e=I.charCodeAt(c+1),56320===(64512&e)&&(b=65536+(b-55296<<10)+(e-56320),c++)),J+=b<128?1:b<2048?2:b<65536?3:4;for(g=new Uint8Array(J),z=0,c=0;z<J;c++)b=I.charCodeAt(c),55296===(64512&b)&&c+1<M&&(e=I.charCodeAt(c+1),56320===(64512&e)&&(b=65536+(b-55296<<10)+(e-56320),c++)),b<128?g[z++]=b:b<2048?(g[z++]=192|b>>>6,g[z++]=128|63&b):b<65536?(g[z++]=224|b>>>12,g[z++]=128|b>>>6&63,g[z++]=128|63&b):(g[z++]=240|b>>>18,g[z++]=128|b>>>12&63,g[z++]=128|b>>>6&63,g[z++]=128|63&b);return g};I.exports.buf2string=(I,e)=>{const c=e||I.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(I.subarray(0,e));let z,M;const J=new Array(2*c);for(M=0,z=0;z<c;){let g=I[z++];if(g<128){J[M++]=g;continue}let e=b[g];if(e>4)J[M++]=65533,z+=e-1;else{for(g&=2===e?31:3===e?15:7;e>1&&z<c;)g=g<<6|63&I[z++],e--;e>1?J[M++]=65533:g<65536?J[M++]=g:(g-=65536,J[M++]=55296|g>>10&1023,J[M++]=56320|1023&g)}}return((I,b)=>{if(b<65534&&I.subarray&&g)return String.fromCharCode.apply(null,I.length===b?I:I.subarray(0,b));let e="";for(let g=0;g<b;g++)e+=String.fromCharCode(I[g]);return e})(J,M)},I.exports.utf8border=(I,g)=>{(g=g||I.length)>I.length&&(g=I.length);let e=g-1;for(;e>=0&&128===(192&I[e]);)e--;return e<0||0===e?g:e+b[I[e]]>g?e:g}},13727:I=>{"use strict";I.exports=(I,g,b,e)=>{let c=65535&I,z=I>>>16&65535,M=0;for(;0!==b;){M=b>2e3?2e3:b,b-=M;do{c=c+g[e++]|0,z=z+c|0}while(--M);c%=65521,z%=65521}return c|z<<16}},13745:I=>{"use strict";I.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13731:I=>{"use strict";const g=new Uint32Array((()=>{let I,g=[];for(var b=0;b<256;b++){I=b;for(var e=0;e<8;e++)I=1&I?3988292384^I>>>1:I>>>1;g[b]=I}return g})());I.exports=(I,b,e,c)=>{const z=g,M=c+e;I^=-1;for(let g=c;g<M;g++)I=I>>>8^z[255&(I^b[g])];return~I}},13712:(I,g,b)=>{"use strict";const{_tr_init:e,_tr_stored_block:c,_tr_flush_block:z,_tr_tally:M,_tr_align:J}=b(13718),o=b(13727),n=b(13731),G=b(13737),{Z_NO_FLUSH:D,Z_PARTIAL_FLUSH:p,Z_FULL_FLUSH:x,Z_FINISH:Z,Z_BLOCK:k,Z_OK:S,Z_STREAM_END:f,Z_STREAM_ERROR:V,Z_DATA_ERROR:a,Z_BUF_ERROR:v,Z_DEFAULT_COMPRESSION:X,Z_FILTERED:R,Z_HUFFMAN_ONLY:E,Z_RLE:mI,Z_FIXED:s,Z_DEFAULT_STRATEGY:F,Z_UNKNOWN:Y,Z_DEFLATED:d}=b(13745),C=258,r=262,O=103,H=113,i=666,U=(I,g)=>(I.Dg=G[g],g),h=I=>(I<<1)-(I>4?9:0),A=I=>{let g=I.length;for(;--g>=0;)I[g]=0};let j=(I,g,b)=>(g<<I.hash_shift^b)&I.hash_mask;const Q=I=>{const g=I.state;let b=g.pending;b>I.avail_out&&(b=I.avail_out),0!==b&&(I.output.set(g.pending_buf.subarray(g.pending_out,g.pending_out+b),I.next_out),I.next_out+=b,g.pending_out+=b,I.total_out+=b,I.avail_out-=b,g.pending-=b,0===g.pending&&(g.pending_out=0))},L=(I,g)=>{z(I,I.block_start>=0?I.block_start:-1,I.strstart-I.block_start,g),I.block_start=I.strstart,Q(I.strm)},N=(I,g)=>{I.pending_buf[I.pending++]=g},K=(I,g)=>{I.pending_buf[I.pending++]=g>>>8&255,I.pending_buf[I.pending++]=255&g},B=(I,g,b,e)=>{let c=I.avail_in;return c>e&&(c=e),0===c?0:(I.avail_in-=c,g.set(I.input.subarray(I.next_in,I.next_in+c),b),1===I.state.wrap?I.adler=o(I.adler,g,c,b):2===I.state.wrap&&(I.adler=n(I.adler,g,c,b)),I.next_in+=c,I.total_in+=c,c)},P=(I,g)=>{let b,e,c=I.max_chain_length,z=I.strstart,M=I.prev_length,J=I.nice_match;const o=I.strstart>I.w_size-r?I.strstart-(I.w_size-r):0,n=I.window,G=I.w_mask,D=I.prev,p=I.strstart+C;let x=n[z+M-1],Z=n[z+M];I.prev_length>=I.good_match&&(c>>=2),J>I.lookahead&&(J=I.lookahead);do{if(b=g,n[b+M]===Z&&n[b+M-1]===x&&n[b]===n[z]&&n[++b]===n[z+1]){z+=2,b++;do{}while(n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&n[++z]===n[++b]&&z<p);if(e=C-(p-z),z=p-C,e>M){if(I.match_start=g,M=e,e>=J)break;x=n[z+M-1],Z=n[z+M]}}}while((g=D[g&G])>o&&0!==--c);return M<=I.lookahead?M:I.lookahead},u=I=>{const g=I.w_size;let b,e,c,z,M;do{if(z=I.window_size-I.lookahead-I.strstart,I.strstart>=g+(g-r)){I.window.set(I.window.subarray(g,g+g),0),I.match_start-=g,I.strstart-=g,I.block_start-=g,e=I.hash_size,b=e;do{c=I.head[--b],I.head[b]=c>=g?c-g:0}while(--e);e=g,b=e;do{c=I.prev[--b],I.prev[b]=c>=g?c-g:0}while(--e);z+=g}if(0===I.strm.avail_in)break;if(e=B(I.strm,I.window,I.strstart+I.lookahead,z),I.lookahead+=e,I.lookahead+I.insert>=3)for(M=I.strstart-I.insert,I.ins_h=I.window[M],I.ins_h=j(I,I.ins_h,I.window[M+1]);I.insert&&(I.ins_h=j(I,I.ins_h,I.window[M+3-1]),I.prev[M&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=M,M++,I.insert--,!(I.lookahead+I.insert<3)););}while(I.lookahead<r&&0!==I.strm.avail_in)},t=(I,g)=>{let b,e;for(;;){if(I.lookahead<r){if(u(I),I.lookahead<r&&g===D)return 1;if(0===I.lookahead)break}if(b=0,I.lookahead>=3&&(I.ins_h=j(I,I.ins_h,I.window[I.strstart+3-1]),b=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),0!==b&&I.strstart-b<=I.w_size-r&&(I.match_length=P(I,b)),I.match_length>=3)if(e=M(I,I.strstart-I.match_start,I.match_length-3),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=3){I.match_length--;do{I.strstart++,I.ins_h=j(I,I.ins_h,I.window[I.strstart+3-1]),b=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart}while(0!==--I.match_length);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=j(I,I.ins_h,I.window[I.strstart+1]);else e=M(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(e&&(L(I,!1),0===I.strm.avail_out))return 1}return I.insert=I.strstart<2?I.strstart:2,g===Z?(L(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(L(I,!1),0===I.strm.avail_out)?1:2},y=(I,g)=>{let b,e,c;for(;;){if(I.lookahead<r){if(u(I),I.lookahead<r&&g===D)return 1;if(0===I.lookahead)break}if(b=0,I.lookahead>=3&&(I.ins_h=j(I,I.ins_h,I.window[I.strstart+3-1]),b=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=2,0!==b&&I.prev_length<I.max_lazy_match&&I.strstart-b<=I.w_size-r&&(I.match_length=P(I,b),I.match_length<=5&&(I.strategy===R||3===I.match_length&&I.strstart-I.match_start>4096)&&(I.match_length=2)),I.prev_length>=3&&I.match_length<=I.prev_length){c=I.strstart+I.lookahead-3,e=M(I,I.strstart-1-I.prev_match,I.prev_length-3),I.lookahead-=I.prev_length-1,I.prev_length-=2;do{++I.strstart<=c&&(I.ins_h=j(I,I.ins_h,I.window[I.strstart+3-1]),b=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart)}while(0!==--I.prev_length);if(I.match_available=0,I.match_length=2,I.strstart++,e&&(L(I,!1),0===I.strm.avail_out))return 1}else if(I.match_available){if(e=M(I,0,I.window[I.strstart-1]),e&&L(I,!1),I.strstart++,I.lookahead--,0===I.strm.avail_out)return 1}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(e=M(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<2?I.strstart:2,g===Z?(L(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(L(I,!1),0===I.strm.avail_out)?1:2};function q(I,g,b,e,c){this.good_length=I,this.max_lazy=g,this.nice_length=b,this.max_chain=e,this.func=c}const l=[new q(0,0,0,0,((I,g)=>{let b=65535;for(b>I.pending_buf_size-5&&(b=I.pending_buf_size-5);;){if(I.lookahead<=1){if(u(I),0===I.lookahead&&g===D)return 1;if(0===I.lookahead)break}I.strstart+=I.lookahead,I.lookahead=0;const e=I.block_start+b;if((0===I.strstart||I.strstart>=e)&&(I.lookahead=I.strstart-e,I.strstart=e,L(I,!1),0===I.strm.avail_out))return 1;if(I.strstart-I.block_start>=I.w_size-r&&(L(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,g===Z?(L(I,!0),0===I.strm.avail_out?3:4):(I.strstart>I.block_start&&(L(I,!1),I.strm.avail_out),1)})),new q(4,4,8,4,t),new q(4,5,16,8,t),new q(4,6,32,32,t),new q(4,4,16,16,y),new q(8,16,32,32,y),new q(8,16,128,128,y),new q(8,32,128,256,y),new q(32,128,258,1024,y),new q(32,258,258,4096,y)];function w(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),A(this.dyn_ltree),A(this.dyn_dtree),A(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),A(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),A(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const T=I=>{if(!I||!I.state)return U(I,V);I.total_in=I.total_out=0,I.data_type=Y;const g=I.state;return g.pending=0,g.pending_out=0,g.wrap<0&&(g.wrap=-g.wrap),g.status=g.wrap?42:H,I.adler=2===g.wrap?0:1,g.last_flush=D,e(g),S},W=I=>{const g=T(I);var b;return g===S&&((b=I.state).window_size=2*b.w_size,A(b.head),b.max_lazy_match=l[b.level].max_lazy,b.good_match=l[b.level].good_length,b.nice_match=l[b.level].nice_length,b.max_chain_length=l[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),g},II=(I,g,b,e,c,z)=>{if(!I)return V;let M=1;if(g===X&&(g=6),e<0?(M=0,e=-e):e>15&&(M=2,e-=16),c<1||c>9||b!==d||e<8||e>15||g<0||g>9||z<0||z>s)return U(I,V);8===e&&(e=9);const J=new w;return I.state=J,J.strm=I,J.wrap=M,J.gzhead=null,J.w_bits=e,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=c+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+3-1)/3),J.window=new Uint8Array(2*J.w_size),J.head=new Uint16Array(J.hash_size),J.prev=new Uint16Array(J.w_size),J.lit_bufsize=1<<c+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new Uint8Array(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=g,J.strategy=z,J.method=b,W(I)};I.exports.deflateInit=(I,g)=>II(I,g,d,15,8,F),I.exports.deflateInit2=II,I.exports.deflateReset=W,I.exports.deflateResetKeep=T,I.exports.deflateSetHeader=(I,g)=>I&&I.state?2!==I.state.wrap?V:(I.state.gzhead=g,S):V,I.exports.deflate=(I,g)=>{let b,e;if(!I||!I.state||g>k||g<0)return I?U(I,V):V;const z=I.state;if(!I.output||!I.input&&0!==I.avail_in||z.status===i&&g!==Z)return U(I,0===I.avail_out?v:V);z.strm=I;const o=z.last_flush;if(z.last_flush=g,42===z.status)if(2===z.wrap)I.adler=0,N(z,31),N(z,139),N(z,8),z.gzhead?(N(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),N(z,255&z.gzhead.time),N(z,z.gzhead.time>>8&255),N(z,z.gzhead.time>>16&255),N(z,z.gzhead.time>>24&255),N(z,9===z.level?2:z.strategy>=E||z.level<2?4:0),N(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(N(z,255&z.gzhead.extra.length),N(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(I.adler=n(I.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(N(z,0),N(z,0),N(z,0),N(z,0),N(z,0),N(z,9===z.level?2:z.strategy>=E||z.level<2?4:0),N(z,3),z.status=H);else{let g=d+(z.w_bits-8<<4)<<8,b=-1;b=z.strategy>=E||z.level<2?0:z.level<6?1:6===z.level?2:3,g|=b<<6,0!==z.strstart&&(g|=32),g+=31-g%31,z.status=H,K(z,g),0!==z.strstart&&(K(z,I.adler>>>16),K(z,65535&I.adler)),I.adler=1}if(69===z.status)if(z.gzhead.extra){for(b=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),Q(I),b=z.pending,z.pending!==z.pending_buf_size));)N(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(73===z.status)if(z.gzhead.name){b=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),Q(I),b=z.pending,z.pending===z.pending_buf_size)){e=1;break}e=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,N(z,e)}while(0!==e);z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),0===e&&(z.gzindex=0,z.status=91)}else z.status=91;if(91===z.status)if(z.gzhead.comment){b=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),Q(I),b=z.pending,z.pending===z.pending_buf_size)){e=1;break}e=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,N(z,e)}while(0!==e);z.gzhead.hcrc&&z.pending>b&&(I.adler=n(I.adler,z.pending_buf,z.pending-b,b)),0===e&&(z.status=O)}else z.status=O;if(z.status===O&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&Q(I),z.pending+2<=z.pending_buf_size&&(N(z,255&I.adler),N(z,I.adler>>8&255),I.adler=0,z.status=H)):z.status=H),0!==z.pending){if(Q(I),0===I.avail_out)return z.last_flush=-1,S}else if(0===I.avail_in&&h(g)<=h(o)&&g!==Z)return U(I,v);if(z.status===i&&0!==I.avail_in)return U(I,v);if(0!==I.avail_in||0!==z.lookahead||g!==D&&z.status!==i){let b=z.strategy===E?((I,g)=>{let b;for(;;){if(0===I.lookahead&&(u(I),0===I.lookahead)){if(g===D)return 1;break}if(I.match_length=0,b=M(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,b&&(L(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,g===Z?(L(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(L(I,!1),0===I.strm.avail_out)?1:2})(z,g):z.strategy===mI?((I,g)=>{let b,e,c,z;const J=I.window;for(;;){if(I.lookahead<=C){if(u(I),I.lookahead<=C&&g===D)return 1;if(0===I.lookahead)break}if(I.match_length=0,I.lookahead>=3&&I.strstart>0&&(c=I.strstart-1,e=J[c],e===J[++c]&&e===J[++c]&&e===J[++c])){z=I.strstart+C;do{}while(e===J[++c]&&e===J[++c]&&e===J[++c]&&e===J[++c]&&e===J[++c]&&e===J[++c]&&e===J[++c]&&e===J[++c]&&c<z);I.match_length=C-(z-c),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=3?(b=M(I,1,I.match_length-3),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(b=M(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),b&&(L(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,g===Z?(L(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(L(I,!1),0===I.strm.avail_out)?1:2})(z,g):l[z.level].func(z,g);if(3!==b&&4!==b||(z.status=i),1===b||3===b)return 0===I.avail_out&&(z.last_flush=-1),S;if(2===b&&(g===p?J(z):g!==k&&(c(z,0,0,!1),g===x&&(A(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),Q(I),0===I.avail_out))return z.last_flush=-1,S}return g!==Z?S:z.wrap<=0?f:(2===z.wrap?(N(z,255&I.adler),N(z,I.adler>>8&255),N(z,I.adler>>16&255),N(z,I.adler>>24&255),N(z,255&I.total_in),N(z,I.total_in>>8&255),N(z,I.total_in>>16&255),N(z,I.total_in>>24&255)):(K(z,I.adler>>>16),K(z,65535&I.adler)),Q(I),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?S:f)},I.exports.deflateEnd=I=>{if(!I||!I.state)return V;const g=I.state.status;return 42!==g&&69!==g&&73!==g&&91!==g&&g!==O&&g!==H&&g!==i?U(I,V):(I.state=null,g===H?U(I,a):S)},I.exports.deflateSetDictionary=(I,g)=>{let b=g.length;if(!I||!I.state)return V;const e=I.state,c=e.wrap;if(2===c||1===c&&42!==e.status||e.lookahead)return V;if(1===c&&(I.adler=o(I.adler,g,b,0)),e.wrap=0,b>=e.w_size){0===c&&(A(e.head),e.strstart=0,e.block_start=0,e.insert=0);let I=new Uint8Array(e.w_size);I.set(g.subarray(b-e.w_size,b),0),g=I,b=e.w_size}const z=I.avail_in,M=I.next_in,J=I.input;for(I.avail_in=b,I.next_in=0,I.input=g,u(e);e.lookahead>=3;){let I=e.strstart,g=e.lookahead-2;do{e.ins_h=j(e,e.ins_h,e.window[I+3-1]),e.prev[I&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=I,I++}while(--g);e.strstart=I,e.lookahead=2,u(e)}return e.strstart+=e.lookahead,e.block_start=e.strstart,e.insert=e.lookahead,e.lookahead=0,e.match_length=e.prev_length=2,e.match_available=0,I.next_in=M,I.input=J,I.avail_in=z,e.wrap=c,S},I.exports.deflateInfo="pako deflate (from Nodeca project)"},13774:I=>{"use strict";I.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13763:I=>{"use strict";I.exports=function(I,g){let b,e,c,z,M,J,o,n,G,D,p,x,Z,k,S,f,V,a,v,X,R,E,mI,s;const F=I.state;b=I.next_in,mI=I.input,e=b+(I.avail_in-5),c=I.next_out,s=I.output,z=c-(g-I.avail_out),M=c+(I.avail_out-257),J=F.dmax,o=F.wsize,n=F.whave,G=F.wnext,D=F.window,p=F.hold,x=F.bits,Z=F.lencode,k=F.distcode,S=(1<<F.lenbits)-1,f=(1<<F.distbits)-1;I:do{x<15&&(p+=mI[b++]<<x,x+=8,p+=mI[b++]<<x,x+=8),V=Z[p&S];g:for(;;){if(a=V>>>24,p>>>=a,x-=a,a=V>>>16&255,0===a)s[c++]=65535&V;else{if(!(16&a)){if(0===(64&a)){V=Z[(65535&V)+(p&(1<<a)-1)];continue g}if(32&a){F.mode=12;break I}I.Dg="invalid literal/length code",F.mode=30;break I}v=65535&V,a&=15,a&&(x<a&&(p+=mI[b++]<<x,x+=8),v+=p&(1<<a)-1,p>>>=a,x-=a),x<15&&(p+=mI[b++]<<x,x+=8,p+=mI[b++]<<x,x+=8),V=k[p&f];b:for(;;){if(a=V>>>24,p>>>=a,x-=a,a=V>>>16&255,!(16&a)){if(0===(64&a)){V=k[(65535&V)+(p&(1<<a)-1)];continue b}I.Dg="invalid distance code",F.mode=30;break I}if(X=65535&V,a&=15,x<a&&(p+=mI[b++]<<x,x+=8,x<a&&(p+=mI[b++]<<x,x+=8)),X+=p&(1<<a)-1,X>J){I.Dg="invalid distance too far back",F.mode=30;break I}if(p>>>=a,x-=a,a=c-z,X>a){if(a=X-a,a>n&&F.sane){I.Dg="invalid distance too far back",F.mode=30;break I}if(R=0,E=D,0===G){if(R+=o-a,a<v){v-=a;do{s[c++]=D[R++]}while(--a);R=c-X,E=s}}else if(G<a){if(R+=o+G-a,a-=G,a<v){v-=a;do{s[c++]=D[R++]}while(--a);if(R=0,G<v){a=G,v-=a;do{s[c++]=D[R++]}while(--a);R=c-X,E=s}}}else if(R+=G-a,a<v){v-=a;do{s[c++]=D[R++]}while(--a);R=c-X,E=s}for(;v>2;)s[c++]=E[R++],s[c++]=E[R++],s[c++]=E[R++],v-=3;v&&(s[c++]=E[R++],v>1&&(s[c++]=E[R++]))}else{R=c-X;do{s[c++]=s[R++],s[c++]=s[R++],s[c++]=s[R++],v-=3}while(v>2);v&&(s[c++]=s[R++],v>1&&(s[c++]=s[R++]))}break}}break}}while(b<e&&c<M);v=x>>3,b-=v,x-=v<<3,p&=(1<<x)-1,I.next_in=b,I.next_out=c,I.avail_in=b<e?e-b+5:5-(b-e),I.avail_out=c<M?M-c+257:257-(c-M),F.hold=p,F.bits=x}},13759:(I,g,b)=>{"use strict";const e=b(13727),c=b(13731),z=b(13763),M=b(13765),{Z_FINISH:J,Z_BLOCK:o,Z_TREES:n,Z_OK:G,Z_STREAM_END:D,Z_NEED_DICT:p,Z_STREAM_ERROR:x,Z_DATA_ERROR:Z,Z_MEM_ERROR:k,Z_BUF_ERROR:S,Z_DEFLATED:f}=b(13745),V=12,a=30,v=I=>(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24);function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const R=I=>{if(!I||!I.state)return x;const g=I.state;return I.total_in=I.total_out=g.total=0,I.Dg="",g.wrap&&(I.adler=1&g.wrap),g.mode=1,g.last=0,g.havedict=0,g.dmax=32768,g.head=null,g.hold=0,g.bits=0,g.lencode=g.lendyn=new Int32Array(852),g.distcode=g.distdyn=new Int32Array(592),g.sane=1,g.back=-1,G},E=I=>{if(!I||!I.state)return x;const g=I.state;return g.wsize=0,g.whave=0,g.wnext=0,R(I)},mI=(I,g)=>{let b;if(!I||!I.state)return x;const e=I.state;return g<0?(b=0,g=-g):(b=1+(g>>4),g<48&&(g&=15)),g&&(g<8||g>15)?x:(null!==e.window&&e.wbits!==g&&(e.window=null),e.wrap=b,e.wbits=g,E(I))},s=(I,g)=>{if(!I)return x;const b=new X;I.state=b,b.window=null;const e=mI(I,g);return e!==G&&(I.state=null),e};let F,Y,d=!0;const C=I=>{if(d){F=new Int32Array(512),Y=new Int32Array(32);let g=0;for(;g<144;)I.lens[g++]=8;for(;g<256;)I.lens[g++]=9;for(;g<280;)I.lens[g++]=7;for(;g<288;)I.lens[g++]=8;for(M(1,I.lens,0,288,F,0,I.work,{bits:9}),g=0;g<32;)I.lens[g++]=5;M(2,I.lens,0,32,Y,0,I.work,{bits:5}),d=!1}I.lencode=F,I.lenbits=9,I.distcode=Y,I.distbits=5},r=(I,g,b,e)=>{let c;const z=I.state;return null===z.window&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new Uint8Array(z.wsize)),e>=z.wsize?(z.window.set(g.subarray(b-z.wsize,b),0),z.wnext=0,z.whave=z.wsize):(c=z.wsize-z.wnext,c>e&&(c=e),z.window.set(g.subarray(b-e,b-e+c),z.wnext),(e-=c)?(z.window.set(g.subarray(b-e,b),0),z.wnext=e,z.whave=z.wsize):(z.wnext+=c,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=c))),0};I.exports.inflateReset=E,I.exports.inflateReset2=mI,I.exports.inflateResetKeep=R,I.exports.inflateInit=I=>s(I,15),I.exports.inflateInit2=s,I.exports.inflate=(I,g)=>{let b,X,R,E,mI,s,F,Y,d,O,H,i,U,h,A,j,Q,L,N,K,B,P,u=0;const t=new Uint8Array(4);let y,q;const l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!I||!I.state||!I.output||!I.input&&0!==I.avail_in)return x;b=I.state,b.mode===V&&(b.mode=13),mI=I.next_out,R=I.output,F=I.avail_out,E=I.next_in,X=I.input,s=I.avail_in,Y=b.hold,d=b.bits,O=s,H=F,P=G;I:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;d<16;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(2&b.wrap&&35615===Y){b.check=0,t[0]=255&Y,t[1]=Y>>>8&255,b.check=c(b.check,t,2,0),Y=0,d=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&Y)<<8)+(Y>>8))%31){I.Dg="incorrect header check",b.mode=a;break}if((15&Y)!==f){I.Dg="unknown compression method",b.mode=a;break}if(Y>>>=4,d-=4,B=8+(15&Y),0===b.wbits)b.wbits=B;else if(B>b.wbits){I.Dg="invalid window size",b.mode=a;break}b.dmax=1<<b.wbits,I.adler=b.check=1,b.mode=512&Y?10:V,Y=0,d=0;break;case 2:for(;d<16;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(b.flags=Y,(255&b.flags)!==f){I.Dg="unknown compression method",b.mode=a;break}if(57344&b.flags){I.Dg="unknown header flags set",b.mode=a;break}b.head&&(b.head.text=Y>>8&1),512&b.flags&&(t[0]=255&Y,t[1]=Y>>>8&255,b.check=c(b.check,t,2,0)),Y=0,d=0,b.mode=3;case 3:for(;d<32;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.head&&(b.head.time=Y),512&b.flags&&(t[0]=255&Y,t[1]=Y>>>8&255,t[2]=Y>>>16&255,t[3]=Y>>>24&255,b.check=c(b.check,t,4,0)),Y=0,d=0,b.mode=4;case 4:for(;d<16;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.head&&(b.head.xflags=255&Y,b.head.os=Y>>8),512&b.flags&&(t[0]=255&Y,t[1]=Y>>>8&255,b.check=c(b.check,t,2,0)),Y=0,d=0,b.mode=5;case 5:if(1024&b.flags){for(;d<16;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.length=Y,b.head&&(b.head.extra_len=Y),512&b.flags&&(t[0]=255&Y,t[1]=Y>>>8&255,b.check=c(b.check,t,2,0)),Y=0,d=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(i=b.length,i>s&&(i=s),i&&(b.head&&(B=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(X.subarray(E,E+i),B)),512&b.flags&&(b.check=c(b.check,X,i,E)),s-=i,E+=i,b.length-=i),b.length))break I;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===s)break I;i=0;do{B=X[E+i++],b.head&&B&&b.length<65536&&(b.head.name+=String.fromCharCode(B))}while(B&&i<s);if(512&b.flags&&(b.check=c(b.check,X,i,E)),s-=i,E+=i,B)break I}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===s)break I;i=0;do{B=X[E+i++],b.head&&B&&b.length<65536&&(b.head.comment+=String.fromCharCode(B))}while(B&&i<s);if(512&b.flags&&(b.check=c(b.check,X,i,E)),s-=i,E+=i,B)break I}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;d<16;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(Y!==(65535&b.check)){I.Dg="header crc mismatch",b.mode=a;break}Y=0,d=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),I.adler=b.check=0,b.mode=V;break;case 10:for(;d<32;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}I.adler=b.check=v(Y),Y=0,d=0,b.mode=11;case 11:if(0===b.havedict)return I.next_out=mI,I.avail_out=F,I.next_in=E,I.avail_in=s,b.hold=Y,b.bits=d,p;I.adler=b.check=1,b.mode=V;case V:if(g===o||g===n)break I;case 13:if(b.last){Y>>>=7&d,d-=7&d,b.mode=27;break}for(;d<3;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}switch(b.last=1&Y,Y>>>=1,d-=1,3&Y){case 0:b.mode=14;break;case 1:if(C(b),b.mode=20,g===n){Y>>>=2,d-=2;break I}break;case 2:b.mode=17;break;case 3:I.Dg="invalid block type",b.mode=a}Y>>>=2,d-=2;break;case 14:for(Y>>>=7&d,d-=7&d;d<32;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if((65535&Y)!==(Y>>>16^65535)){I.Dg="invalid stored block lengths",b.mode=a;break}if(b.length=65535&Y,Y=0,d=0,b.mode=15,g===n)break I;case 15:b.mode=16;case 16:if(i=b.length,i){if(i>s&&(i=s),i>F&&(i=F),0===i)break I;R.set(X.subarray(E,E+i),mI),s-=i,E+=i,F-=i,mI+=i,b.length-=i;break}b.mode=V;break;case 17:for(;d<14;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(b.nlen=257+(31&Y),Y>>>=5,d-=5,b.ndist=1+(31&Y),Y>>>=5,d-=5,b.ncode=4+(15&Y),Y>>>=4,d-=4,b.nlen>286||b.ndist>30){I.Dg="too many length or distance symbols",b.mode=a;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;d<3;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.lens[l[b.have++]]=7&Y,Y>>>=3,d-=3}for(;b.have<19;)b.lens[l[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,y={bits:b.lenbits},P=M(0,b.lens,0,19,b.lencode,0,b.work,y),b.lenbits=y.bits,P){I.Dg="invalid code lengths set",b.mode=a;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;u=b.lencode[Y&(1<<b.lenbits)-1],A=u>>>24,j=u>>>16&255,Q=65535&u,!(A<=d);){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(Q<16)Y>>>=A,d-=A,b.lens[b.have++]=Q;else{if(16===Q){for(q=A+2;d<q;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(Y>>>=A,d-=A,0===b.have){I.Dg="invalid bit length repeat",b.mode=a;break}B=b.lens[b.have-1],i=3+(3&Y),Y>>>=2,d-=2}else if(17===Q){for(q=A+3;d<q;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}Y>>>=A,d-=A,B=0,i=3+(7&Y),Y>>>=3,d-=3}else{for(q=A+7;d<q;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}Y>>>=A,d-=A,B=0,i=11+(127&Y),Y>>>=7,d-=7}if(b.have+i>b.nlen+b.ndist){I.Dg="invalid bit length repeat",b.mode=a;break}for(;i--;)b.lens[b.have++]=B}}if(b.mode===a)break;if(0===b.lens[256]){I.Dg="invalid code -- missing end-of-block",b.mode=a;break}if(b.lenbits=9,y={bits:b.lenbits},P=M(1,b.lens,0,b.nlen,b.lencode,0,b.work,y),b.lenbits=y.bits,P){I.Dg="invalid literal/lengths set",b.mode=a;break}if(b.distbits=6,b.distcode=b.distdyn,y={bits:b.distbits},P=M(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,y),b.distbits=y.bits,P){I.Dg="invalid distances set",b.mode=a;break}if(b.mode=20,g===n)break I;case 20:b.mode=21;case 21:if(s>=6&&F>=258){I.next_out=mI,I.avail_out=F,I.next_in=E,I.avail_in=s,b.hold=Y,b.bits=d,z(I,H),mI=I.next_out,R=I.output,F=I.avail_out,E=I.next_in,X=I.input,s=I.avail_in,Y=b.hold,d=b.bits,b.mode===V&&(b.back=-1);break}for(b.back=0;u=b.lencode[Y&(1<<b.lenbits)-1],A=u>>>24,j=u>>>16&255,Q=65535&u,!(A<=d);){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(j&&0===(240&j)){for(L=A,N=j,K=Q;u=b.lencode[K+((Y&(1<<L+N)-1)>>L)],A=u>>>24,j=u>>>16&255,Q=65535&u,!(L+A<=d);){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}Y>>>=L,d-=L,b.back+=L}if(Y>>>=A,d-=A,b.back+=A,b.length=Q,0===j){b.mode=26;break}if(32&j){b.back=-1,b.mode=V;break}if(64&j){I.Dg="invalid literal/length code",b.mode=a;break}b.extra=15&j,b.mode=22;case 22:if(b.extra){for(q=b.extra;d<q;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.length+=Y&(1<<b.extra)-1,Y>>>=b.extra,d-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;u=b.distcode[Y&(1<<b.distbits)-1],A=u>>>24,j=u>>>16&255,Q=65535&u,!(A<=d);){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(0===(240&j)){for(L=A,N=j,K=Q;u=b.distcode[K+((Y&(1<<L+N)-1)>>L)],A=u>>>24,j=u>>>16&255,Q=65535&u,!(L+A<=d);){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}Y>>>=L,d-=L,b.back+=L}if(Y>>>=A,d-=A,b.back+=A,64&j){I.Dg="invalid distance code",b.mode=a;break}b.offset=Q,b.extra=15&j,b.mode=24;case 24:if(b.extra){for(q=b.extra;d<q;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}b.offset+=Y&(1<<b.extra)-1,Y>>>=b.extra,d-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){I.Dg="invalid distance too far back",b.mode=a;break}b.mode=25;case 25:if(0===F)break I;if(i=H-F,b.offset>i){if(i=b.offset-i,i>b.whave&&b.sane){I.Dg="invalid distance too far back",b.mode=a;break}i>b.wnext?(i-=b.wnext,U=b.wsize-i):U=b.wnext-i,i>b.length&&(i=b.length),h=b.window}else h=R,U=mI-b.offset,i=b.length;i>F&&(i=F),F-=i,b.length-=i;do{R[mI++]=h[U++]}while(--i);0===b.length&&(b.mode=21);break;case 26:if(0===F)break I;R[mI++]=b.length,F--,b.mode=21;break;case 27:if(b.wrap){for(;d<32;){if(0===s)break I;s--,Y|=X[E++]<<d,d+=8}if(H-=F,I.total_out+=H,b.total+=H,H&&(I.adler=b.check=b.flags?c(b.check,R,H,mI-H):e(b.check,R,H,mI-H)),H=F,(b.flags?Y:v(Y))!==b.check){I.Dg="incorrect data check",b.mode=a;break}Y=0,d=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;d<32;){if(0===s)break I;s--,Y+=X[E++]<<d,d+=8}if(Y!==(4294967295&b.total)){I.Dg="incorrect length check",b.mode=a;break}Y=0,d=0}b.mode=29;case 29:P=D;break I;case a:P=Z;break I;case 31:return k;default:return x}return I.next_out=mI,I.avail_out=F,I.next_in=E,I.avail_in=s,b.hold=Y,b.bits=d,(b.wsize||H!==I.avail_out&&b.mode<a&&(b.mode<27||g!==J))&&r(I,I.output,I.next_out,H-I.avail_out)?(b.mode=31,k):(O-=I.avail_in,H-=I.avail_out,I.total_in+=O,I.total_out+=H,b.total+=H,b.wrap&&H&&(I.adler=b.check=b.flags?c(b.check,R,H,I.next_out-H):e(b.check,R,H,I.next_out-H)),I.data_type=b.bits+(b.last?64:0)+(b.mode===V?128:0)+(20===b.mode||15===b.mode?256:0),(0===O&&0===H||g===J)&&P===G&&(P=S),P)},I.exports.inflateEnd=I=>{if(!I||!I.state)return x;let g=I.state;return g.window&&(g.window=null),I.state=null,G},I.exports.inflateGetHeader=(I,g)=>{if(!I||!I.state)return x;const b=I.state;return 0===(2&b.wrap)?x:(b.head=g,g.done=!1,G)},I.exports.inflateSetDictionary=(I,g)=>{const b=g.length;let c,z,M;return I&&I.state?(c=I.state,0!==c.wrap&&11!==c.mode?x:11===c.mode&&(z=1,z=e(z,g,b,0),z!==c.check)?Z:(M=r(I,g,b,b),M?(c.mode=31,k):(c.havedict=1,G))):x},I.exports.inflateInfo="pako inflate (from Nodeca project)"},13765:I=>{"use strict";const g=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),c=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);I.exports=(I,M,J,o,n,G,D,p)=>{const x=p.bits;let Z,k,S,f,V,a,v=0,X=0,R=0,E=0,mI=0,s=0,F=0,Y=0,d=0,C=0,r=null,O=0;const H=new Uint16Array(16),i=new Uint16Array(16);let U,h,A,j=null,Q=0;for(v=0;v<=g;v++)H[v]=0;for(X=0;X<o;X++)H[M[J+X]]++;for(mI=x,E=g;E>=1&&0===H[E];E--);if(mI>E&&(mI=E),0===E)return n[G++]=20971520,n[G++]=20971520,p.bits=1,0;for(R=1;R<E&&0===H[R];R++);for(mI<R&&(mI=R),Y=1,v=1;v<=g;v++)if(Y<<=1,Y-=H[v],Y<0)return-1;if(Y>0&&(0===I||1!==E))return-1;for(i[1]=0,v=1;v<g;v++)i[v+1]=i[v]+H[v];for(X=0;X<o;X++)0!==M[J+X]&&(D[i[M[J+X]]++]=X);if(0===I?(r=j=D,a=19):1===I?(r=b,O-=257,j=e,Q-=257,a=256):(r=c,j=z,a=-1),C=0,X=0,v=R,V=G,s=mI,F=0,S=-1,d=1<<mI,f=d-1,1===I&&d>852||2===I&&d>592)return 1;for(;;){U=v-F,D[X]<a?(h=0,A=D[X]):D[X]>a?(h=j[Q+D[X]],A=r[O+D[X]]):(h=96,A=0),Z=1<<v-F,k=1<<s,R=k;do{k-=Z,n[V+(C>>F)+k]=U<<24|h<<16|A}while(0!==k);for(Z=1<<v-1;C&Z;)Z>>=1;if(0!==Z?(C&=Z-1,C+=Z):C=0,X++,0===--H[v]){if(v===E)break;v=M[J+D[X]]}if(v>mI&&(C&f)!==S){for(0===F&&(F=mI),V+=R,s=v-F,Y=1<<s;s+F<E&&(Y-=H[s+F],!(Y<=0));)s++,Y<<=1;if(d+=1<<s,1===I&&d>852||2===I&&d>592)return 1;S=C&f,n[S]=mI<<24|s<<16|V-G}}return 0!==C&&(n[V+C]=v-F<<24|64<<16),p.bits=mI,0}},13737:I=>{"use strict";I.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13718:I=>{"use strict";function g(I){let g=I.length;for(;--g>=0;)I[g]=0}const b=256,e=286,c=30,z=15,M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),o=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),G=new Array(576);g(G);const D=new Array(60);g(D);const p=new Array(512);g(p);const x=new Array(256);g(x);const Z=new Array(29);g(Z);const k=new Array(c);function S(I,g,b,e,c){this.static_tree=I,this.extra_bits=g,this.extra_base=b,this.elems=e,this.max_length=c,this.has_stree=I&&I.length}let f,V,a;function v(I,g){this.dyn_tree=I,this.max_code=0,this.stat_desc=g}g(k);const X=I=>I<256?p[I]:p[256+(I>>>7)],R=(I,g)=>{I.pending_buf[I.pending++]=255&g,I.pending_buf[I.pending++]=g>>>8&255},E=(I,g,b)=>{I.bi_valid>16-b?(I.bi_buf|=g<<I.bi_valid&65535,R(I,I.bi_buf),I.bi_buf=g>>16-I.bi_valid,I.bi_valid+=b-16):(I.bi_buf|=g<<I.bi_valid&65535,I.bi_valid+=b)},mI=(I,g,b)=>{E(I,b[2*g],b[2*g+1])},s=(I,g)=>{let b=0;do{b|=1&I,I>>>=1,b<<=1}while(--g>0);return b>>>1},F=(I,g,b)=>{const e=new Array(16);let c,M,J=0;for(c=1;c<=z;c++)e[c]=J=J+b[c-1]<<1;for(M=0;M<=g;M++){let g=I[2*M+1];0!==g&&(I[2*M]=s(e[g]++,g))}},Y=I=>{let g;for(g=0;g<e;g++)I.dyn_ltree[2*g]=0;for(g=0;g<c;g++)I.dyn_dtree[2*g]=0;for(g=0;g<19;g++)I.bl_tree[2*g]=0;I.dyn_ltree[512]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0},d=I=>{I.bi_valid>8?R(I,I.bi_buf):I.bi_valid>0&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0},C=(I,g,b,e)=>{const c=2*g,z=2*b;return I[c]<I[z]||I[c]===I[z]&&e[g]<=e[b]},r=(I,g,b)=>{const e=I.heap[b];let c=b<<1;for(;c<=I.heap_len&&(c<I.heap_len&&C(g,I.heap[c+1],I.heap[c],I.depth)&&c++,!C(g,e,I.heap[c],I.depth));)I.heap[b]=I.heap[c],b=c,c<<=1;I.heap[b]=e},O=(I,g,e)=>{let c,z,o,n,G=0;if(0!==I.last_lit)do{c=I.pending_buf[I.d_buf+2*G]<<8|I.pending_buf[I.d_buf+2*G+1],z=I.pending_buf[I.l_buf+G],G++,0===c?mI(I,z,g):(o=x[z],mI(I,o+b+1,g),n=M[o],0!==n&&(z-=Z[o],E(I,z,n)),c--,o=X(c),mI(I,o,e),n=J[o],0!==n&&(c-=k[o],E(I,c,n)))}while(G<I.last_lit);mI(I,256,g)},H=(I,g)=>{const b=g.dyn_tree,e=g.stat_desc.static_tree,c=g.stat_desc.has_stree,M=g.stat_desc.elems;let J,o,n,G=-1;for(I.heap_len=0,I.heap_max=573,J=0;J<M;J++)0!==b[2*J]?(I.heap[++I.heap_len]=G=J,I.depth[J]=0):b[2*J+1]=0;for(;I.heap_len<2;)n=I.heap[++I.heap_len]=G<2?++G:0,b[2*n]=1,I.depth[n]=0,I.opt_len--,c&&(I.static_len-=e[2*n+1]);for(g.max_code=G,J=I.heap_len>>1;J>=1;J--)r(I,b,J);n=M;do{J=I.heap[1],I.heap[1]=I.heap[I.heap_len--],r(I,b,1),o=I.heap[1],I.heap[--I.heap_max]=J,I.heap[--I.heap_max]=o,b[2*n]=b[2*J]+b[2*o],I.depth[n]=(I.depth[J]>=I.depth[o]?I.depth[J]:I.depth[o])+1,b[2*J+1]=b[2*o+1]=n,I.heap[1]=n++,r(I,b,1)}while(I.heap_len>=2);I.heap[--I.heap_max]=I.heap[1],((I,g)=>{const b=g.dyn_tree,e=g.max_code,c=g.stat_desc.static_tree,M=g.stat_desc.has_stree,J=g.stat_desc.extra_bits,o=g.stat_desc.extra_base,n=g.stat_desc.max_length;let G,D,p,x,Z,k,S=0;for(x=0;x<=z;x++)I.bl_count[x]=0;for(b[2*I.heap[I.heap_max]+1]=0,G=I.heap_max+1;G<573;G++)D=I.heap[G],x=b[2*b[2*D+1]+1]+1,x>n&&(x=n,S++),b[2*D+1]=x,D>e||(I.bl_count[x]++,Z=0,D>=o&&(Z=J[D-o]),k=b[2*D],I.opt_len+=k*(x+Z),M&&(I.static_len+=k*(c[2*D+1]+Z)));if(0!==S){do{for(x=n-1;0===I.bl_count[x];)x--;I.bl_count[x]--,I.bl_count[x+1]+=2,I.bl_count[n]--,S-=2}while(S>0);for(x=n;0!==x;x--)for(D=I.bl_count[x];0!==D;)p=I.heap[--G],p>e||(b[2*p+1]!==x&&(I.opt_len+=(x-b[2*p+1])*b[2*p],b[2*p+1]=x),D--)}})(I,g),F(b,G,I.bl_count)},i=(I,g,b)=>{let e,c,z=-1,M=g[1],J=0,o=7,n=4;for(0===M&&(o=138,n=3),g[2*(b+1)+1]=65535,e=0;e<=b;e++)c=M,M=g[2*(e+1)+1],++J<o&&c===M||(J<n?I.bl_tree[2*c]+=J:0!==c?(c!==z&&I.bl_tree[2*c]++,I.bl_tree[32]++):J<=10?I.bl_tree[34]++:I.bl_tree[36]++,J=0,z=c,0===M?(o=138,n=3):c===M?(o=6,n=3):(o=7,n=4))},U=(I,g,b)=>{let e,c,z=-1,M=g[1],J=0,o=7,n=4;for(0===M&&(o=138,n=3),e=0;e<=b;e++)if(c=M,M=g[2*(e+1)+1],!(++J<o&&c===M)){if(J<n)do{mI(I,c,I.bl_tree)}while(0!==--J);else 0!==c?(c!==z&&(mI(I,c,I.bl_tree),J--),mI(I,16,I.bl_tree),E(I,J-3,2)):J<=10?(mI(I,17,I.bl_tree),E(I,J-3,3)):(mI(I,18,I.bl_tree),E(I,J-11,7));J=0,z=c,0===M?(o=138,n=3):c===M?(o=6,n=3):(o=7,n=4)}};let h=!1;const A=(I,g,b,e)=>{E(I,0+(e?1:0),3),((I,g,b,e)=>{d(I),e&&(R(I,b),R(I,~b)),I.pending_buf.set(I.window.subarray(g,g+b),I.pending),I.pending+=b})(I,g,b,!0)};I.exports._tr_init=I=>{h||((()=>{let I,g,b,n,v;const X=new Array(16);for(b=0,n=0;n<28;n++)for(Z[n]=b,I=0;I<1<<M[n];I++)x[b++]=n;for(x[b-1]=n,v=0,n=0;n<16;n++)for(k[n]=v,I=0;I<1<<J[n];I++)p[v++]=n;for(v>>=7;n<c;n++)for(k[n]=v<<7,I=0;I<1<<J[n]-7;I++)p[256+v++]=n;for(g=0;g<=z;g++)X[g]=0;for(I=0;I<=143;)G[2*I+1]=8,I++,X[8]++;for(;I<=255;)G[2*I+1]=9,I++,X[9]++;for(;I<=279;)G[2*I+1]=7,I++,X[7]++;for(;I<=287;)G[2*I+1]=8,I++,X[8]++;for(F(G,287,X),I=0;I<c;I++)D[2*I+1]=5,D[2*I]=s(I,5);f=new S(G,M,257,e,z),V=new S(D,J,0,c,z),a=new S(new Array(0),o,0,19,7)})(),h=!0),I.l_desc=new v(I.dyn_ltree,f),I.d_desc=new v(I.dyn_dtree,V),I.bl_desc=new v(I.bl_tree,a),I.bi_buf=0,I.bi_valid=0,Y(I)},I.exports._tr_stored_block=A,I.exports._tr_flush_block=(I,g,e,c)=>{let z,M,J=0;I.level>0?(2===I.strm.data_type&&(I.strm.data_type=(I=>{let g,e=4093624447;for(g=0;g<=31;g++,e>>>=1)if(1&e&&0!==I.dyn_ltree[2*g])return 0;if(0!==I.dyn_ltree[18]||0!==I.dyn_ltree[20]||0!==I.dyn_ltree[26])return 1;for(g=32;g<b;g++)if(0!==I.dyn_ltree[2*g])return 1;return 0})(I)),H(I,I.l_desc),H(I,I.d_desc),J=(I=>{let g;for(i(I,I.dyn_ltree,I.l_desc.max_code),i(I,I.dyn_dtree,I.d_desc.max_code),H(I,I.bl_desc),g=18;g>=3&&0===I.bl_tree[2*n[g]+1];g--);return I.opt_len+=3*(g+1)+5+5+4,g})(I),z=I.opt_len+3+7>>>3,M=I.static_len+3+7>>>3,M<=z&&(z=M)):z=M=e+5,e+4<=z&&-1!==g?A(I,g,e,c):4===I.strategy||M===z?(E(I,2+(c?1:0),3),O(I,G,D)):(E(I,4+(c?1:0),3),((I,g,b,e)=>{let c;for(E(I,g-257,5),E(I,b-1,5),E(I,e-4,4),c=0;c<e;c++)E(I,I.bl_tree[2*n[c]+1],3);U(I,I.dyn_ltree,g-1),U(I,I.dyn_dtree,b-1)})(I,I.l_desc.max_code+1,I.d_desc.max_code+1,J+1),O(I,I.dyn_ltree,I.dyn_dtree)),Y(I),c&&d(I)},I.exports._tr_tally=(I,g,e)=>(I.pending_buf[I.d_buf+2*I.last_lit]=g>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&g,I.pending_buf[I.l_buf+I.last_lit]=255&e,I.last_lit++,0===g?I.dyn_ltree[2*e]++:(I.matches++,g--,I.dyn_ltree[2*(x[e]+b+1)]++,I.dyn_dtree[2*X(g)]++),I.last_lit===I.lit_bufsize-1),I.exports._tr_align=I=>{E(I,2,3),mI(I,256,G),(I=>{16===I.bi_valid?(R(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):I.bi_valid>=8&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)})(I)}},13752:I=>{"use strict";I.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Dg="",this.state=null,this.data_type=2,this.adler=0}},13376:I=>{function g(I,g,b){for(var e=I.length,c=-1/0,z=1/0,M=0;M<e;M++){var J=(b[0][M]-I[M])/g[M],o=(b[1][M]-I[M])/g[M];if(J>o){var n=J;J=o,o=n}if(o<c||J>z)return 1/0;J>c&&(c=J),o<z&&(z=o)}return c>z?1/0:c}I.exports=function(I,b,e,c){var z=g(b,e,c);if(z===1/0)I=null;else{I=I||[];for(var M=0;M<b.length;M++)I[M]=b[M]+e[M]*z}return I},I.exports.distance=g},14742:(I,g,b)=>{"use strict";b.d(g,{b:()=>M});var e=b(35);const c=e.useLayoutEffect;const z=function(I){var g=(0,e.useRef)(I);return c((function(){g.current=I})),g};var M=function(I){var g=z(I);(0,e.Jg)((function(){var I=function(I){var b;if(null!=g.current&&(b=g.current(I)),I.defaultPrevented&&(I.returnValue=""),"string"===typeof b)return I.returnValue=b,b};return window.addEventListener("beforeunload",I),function(){window.removeEventListener("beforeunload",I)}}),[])}},14691:(I,g,b)=>{"use strict";var e=b(14700),c=Array.prototype.concat,z=Array.prototype.slice,M=I.exports=function(I){for(var g=[],b=0,M=I.length;b<M;b++){var J=I[b];e(J)?g=c.call(g,z.call(J)):g.push(J)}return g};M.wrap=function(I){return function(){return I(M(arguments))}}},14700:I=>{I.exports=function(I){return!(!I||"string"===typeof I)&&(I instanceof Array||Array.isArray(I)||I.length>=0&&(I.splice instanceof Function||Object.getOwnPropertyDescriptor(I,I.length-1)&&"String"!==I.constructor.name))}},13674:(I,g,b)=>{var e=b(13677);function c(I){for(var g,b,c=0,z=I.length,M=0;M<I.length;){for(g=I[M],b=0;M<z&&I[M]===g;)++M,++b;c+=e.log2(b)/7|0,c+=e.log2(g>>>0)/7|0,c+=2}return c}g.size=c,g.encode=function(I,g){g||(g=new Uint8Array(c(I)));for(var b,e,z=0,M=g.length,J=0;J<I.length;){for(b=I[J],e=0;J<I.length&&I[J]===b;)++J,++e;for(;z<M&&e>=128;)g[z++]=128+(127&e),e>>>=7;if(z>=M)throw new Error("RLE buffer overflow");for(g[z++]=e,b>>>=0;z<M&&b>=128;)g[z++]=128+(127&b),b>>>=7;if(z>=M)throw new Error("RLE buffer overflow");g[z++]=b}return g},g.decode=function(I,g){for(var b,e,c,z,M=g.length,J=I.length,o=0,n=0;n<J;){for(b=0,e=0;n<J&&I[n]>=128;)b+=(127&I[n++])<<e,e+=7;if(b+=I[n++]<<e,n>=J)throw new Error("RLE buffer underrun");if(o+b>M)throw new Error("Chunk buffer overflow");for(c=0,e=0;n<J&&I[n]>=128;)c+=(127&I[n++])<<e,e+=7;if(n>=J)throw new Error("RLE buffer underrun");for(c+=I[n++]<<e,z=0;z<b;++z)g[o++]=c}return g}},13677:(I,g)=>{"use strict";function b(I){var g=32;return(I&=-I)&&g--,65535&I&&(g-=16),16711935&I&&(g-=8),252645135&I&&(g-=4),858993459&I&&(g-=2),1431655765&I&&(g-=1),g}g.INT_BITS=32,g.INT_MAX=2147483647,g.INT_MIN=-1<<31,g.sign=function(I){return(I>0)-(I<0)},g.abs=function(I){var g=I>>31;return(I^g)-g},g.min=function(I,g){return g^(I^g)&-(I<g)},g.max=function(I,g){return I^(I^g)&-(I<g)},g.isPow2=function(I){return!(I&I-1)&&!!I},g.log2=function(I){var g,b;return g=(I>65535)<<4,g|=b=((I>>>=g)>255)<<3,g|=b=((I>>>=b)>15)<<2,(g|=b=((I>>>=b)>3)<<1)|(I>>>=b)>>1},g.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},g.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},g.countTrailingZeros=b,g.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},g.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},g.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var e=new Array(256);!function(I){for(var g=0;g<256;++g){var b=g,e=g,c=7;for(b>>>=1;b;b>>>=1)e<<=1,e|=1&b,--c;I[g]=e<<c&255}}(e),g.reverse=function(I){return e[255&I]<<24|e[I>>>8&255]<<16|e[I>>>16&255]<<8|e[I>>>24&255]},g.interleave2=function(I,g){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))<<1},g.deinterleave2=function(I,g){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>g&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},g.interleave3=function(I,g,b){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(g=1227133513&((g=3272356035&((g=251719695&((g=4278190335&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},g.deinterleave3=function(I,g){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>g&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},g.nextCombination=function(I){var g=I|I-1;return g+1|(~g&-~g)-1>>>b(I)+1}},13699:I=>{"use strict";I.exports=function(I,g,b,e){var c=self||window;try{try{var z;try{z=new c.Blob([I])}catch(n){(z=new(c.BlobBuilder||c.WebKitBlobBuilder||c.MozBlobBuilder||c.MSBlobBuilder)).append(I),z=z.getBlob()}var M=c.URL||c.webkitURL,J=M.createObjectURL(z),o=new c[g](J,b);return M.revokeObjectURL(J),o}catch(n){return new c[g]("data:application/javascript,".concat(encodeURIComponent(I)),b)}}catch(n){if(!e)throw Error("Inline worker is not supported");return new c[g](e,b)}}},13358:(I,g,b)=>{"use strict";function e(I,g,b,e,c){var z={};return Object.keys(e).forEach((function(I){z[I]=e[I]})),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=b.slice().reverse().reduce((function(b,e){return e(I,g,b)||b}),z),c&&void 0!==z.initializer&&(z.value=z.initializer?z.initializer.call(c):void 0,z.initializer=void 0),void 0===z.initializer&&(Object.defineProperty(I,g,z),z=null),z}b.d(g,{b:()=>e})},13356:(I,g,b)=>{"use strict";function e(I,g,b,e){b&&Object.defineProperty(I,g,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(e):void 0})}b.d(g,{e:()=>e})},14726:(I,g,b)=>{"use strict";b.d(g,{b:()=>M,c:()=>D,e:()=>J,h:()=>z,l:()=>o,m:()=>c,n:()=>n,r:()=>G});var e=b(12791);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(I){const g=Math.min(Math.max(I,0),2);this._easingMode=g}getEasingMode(){return this._easingMode}easeInCore(I){throw new Error("You must implement this method")}ease(I){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(I);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-I)}return I>=.5?.5*(1-this.easeInCore(2*(1-I)))+.5:.5*this.easeInCore(2*I)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;class z extends c{easeInCore(I){return I=Math.max(0,Math.min(1,I)),1-Math.sqrt(1-I*I)}}class M extends c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=I}easeInCore(I){const g=Math.max(0,this.amplitude);return Math.pow(I,3)-I*g*Math.sin(3.141592653589793*I)}}class J extends c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=I,this.bounciness=g}easeInCore(I){const g=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const e=Math.pow(b,g),c=1-b,z=(1-e)/c+.5*e,M=I*z,J=Math.log(-M*(1-b)+1)/Math.log(b),o=Math.floor(J),n=o+1,G=(1-Math.pow(b,o))/(c*z),D=.5*(G+(1-Math.pow(b,n))/(c*z)),p=I-D,x=D-G;return-Math.pow(1/b,g-o)/(x*x)*(p-x)*(p+x)}}class o extends c{easeInCore(I){return I*I*I}}class n extends c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=I,this.springiness=g}easeInCore(I){let g;const b=Math.max(0,this.oscillations),e=Math.max(0,this.springiness);return g=0==e?I:(Math.exp(e*I)-1)/(Math.exp(e)-1),g*Math.sin((6.283185307179586*b+1.5707963267948966)*I)}}class G extends c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=I}easeInCore(I){return this.exponent<=0?I:(Math.exp(this.exponent*I)-1)/(Math.exp(this.exponent)-1)}}class D extends c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=I,this.y1=g,this.x2=b,this.y2=e}easeInCore(I){return e.d.Interpolate(I,this.x1,this.y1,this.x2,this.y2)}}},14198:(I,g,b)=>{"use strict";b.d(g,{e:()=>M});var e=b(12590),c=b(12604),z=b(13002);class M extends z.b{get _matrix(){return this._compose(),this.MZ}set _matrix(I){(I.updateFlag!==this.MZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.MZ.G(I),this._markAsDirtyAndDecompose())}constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(I,g.EI(),!1),this.name=I,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=g,this.MZ=(null===c||void 0===c?void 0:c.clone())??e.Matrix.Identity(),this._restMatrix=z??this.MZ.clone(),this._bindMatrix=M??this.MZ.clone(),this._index=J,this._absoluteMatrix=new e.Matrix,this._absoluteBindMatrix=new e.Matrix,this._absoluteInverseBindMatrix=new e.Matrix,this._finalMatrix=new e.Matrix,g.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(I){this.setParent(I)}setParent(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==I){if(this.parent){const I=this.parent.children.indexOf(this);-1!==I&&this.parent.children.splice(I,1)}this._parentNode=I,this.parent&&this.parent.children.push(this),g&&this._updateAbsoluteBindMatrices(),this.XD()}}getLocalMatrix(){return this._compose(),this.MZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(I){this._restMatrix.G(I)}setRestPose(I){this.setRestMatrix(I)}getBindPose(){return this.getBindMatrix()}setBindMatrix(I){this.zb(I)}setBindPose(I){this.setBindMatrix(I)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const I=e.TmpVectors.Vg[0],g=e.TmpVectors.Quaternion[0],b=e.TmpVectors.Vg[1];this.getRestMatrix().decompose(I,g,b),this._linkedTransformNode.position.G(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??e.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.G(g),this._linkedTransformNode.pb.G(I)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(I){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=I,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.CM}set position(I){this._decompose(),this.CM.G(I),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(I){this.setRotation(I)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(I){this.setRotationQuaternion(I)}get pb(){return this.getScale()}set pb(I){this.setScale(I)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=e.Vg.Zero(),this._localRotation=e.Quaternion.Zero(),this.CM=e.Vg.Zero()),this.MZ.decompose(this._localScaling,this._localRotation,this.CM))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,e.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.CM,this.MZ)):this._needToCompose=!1)}zb(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.G(I),g&&this._updateAbsoluteBindMatrices(),b?this._matrix=I:this.XD()}_updateAbsoluteBindMatrices(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(I||(I=this._bindMatrix),this.parent?I.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.G(I),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),g)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}XD(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.XD(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.XD(),this._needToDecompose=!0}_updatePosition(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this.getLocalMatrix();if(0==g)c?(z.addAtIndex(12,I.x),z.addAtIndex(13,I.y),z.addAtIndex(14,I.z)):z.setTranslationFromFloats(I.x,I.y,I.z);else{let g=null;b&&(g=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=M._TmpMats[0],o=M._TmpVecs[0];this.parent?b&&g?(J.G(this.parent.getAbsoluteMatrix()),J.multiplyToRef(g,J)):J.G(this.parent.getAbsoluteMatrix()):e.Matrix.IdentityToRef(J),c&&J.setTranslationFromFloats(0,0,0),J.invert(),e.Vg.TransformCoordinatesToRef(I,J,o),c?(z.addAtIndex(12,o.x),z.addAtIndex(13,o.y),z.addAtIndex(14,o.z)):z.setTranslationFromFloats(o.x,o.y,o.z)}this._markAsDirtyAndDecompose()}translate(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,g,b,!0)}setPosition(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,g,b,!1)}setAbsolutePosition(I,g){this.setPosition(I,1,g)}scale(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getLocalMatrix(),J=M._TmpMats[0];e.Matrix.ScalingToRef(I,g,b,J),J.multiplyToRef(z,z),J.invert();for(const e of this.children){const c=e.getLocalMatrix();c.multiplyToRef(J,c),c.multiplyAtIndex(12,I),c.multiplyAtIndex(13,g),c.multiplyAtIndex(14,b),e._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),c)for(const e of this.children)e.scale(I,g,b,c)}setScale(I){this._decompose(),this._localScaling.G(I),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(I){this._decompose(),I.G(this._localScaling)}setYawPitchRoll(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0;if(0===c){const J=M._TmpQuat;return e.Quaternion.RotationYawPitchRollToRef(I,g,b,J),void this.setRotationQuaternion(J,c,z)}const J=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,z))return;const o=M._TmpMats[1];e.Matrix.RotationYawPitchRollToRef(I,g,b,o),J.multiplyToRef(o,o),this._rotateWithMatrix(o,c,z)}rotate(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;const z=M._TmpMats[0];z.setTranslationFromFloats(0,0,0),e.Matrix.RotationAxisToRef(I,g,z),this._rotateWithMatrix(z,b,c)}setAxisAngle(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0;if(0===b){const z=M._TmpQuat;return e.Quaternion.RotationAxisToRef(I,g,z),void this.setRotationQuaternion(z,b,c)}const z=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,c))return;const J=M._TmpMats[1];e.Matrix.RotationAxisToRef(I,g,J),z.multiplyToRef(J,J),this._rotateWithMatrix(J,b,c)}setRotation(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(I.y,I.x,I.z,g,b)}setRotationQuaternion(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===g)return this._decompose(),this._localRotation.G(I),void this._markAsDirtyAndCompose();const c=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,b))return;const z=M._TmpMats[1];e.Matrix.FromQuaternionToRef(I,z),c.multiplyToRef(z,z),this._rotateWithMatrix(z,g,b)}setRotationMatrix(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===g){const c=M._TmpQuat;return e.Quaternion.FromRotationMatrixToRef(I,c),void this.setRotationQuaternion(c,g,b)}const c=M._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(c,b))return;const z=M._TmpMats[1];z.G(I),c.multiplyToRef(I,z),this._rotateWithMatrix(z,g,b)}_rotateWithMatrix(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const e=this.getLocalMatrix(),c=e.m[12],z=e.m[13],J=e.m[14],o=this.getParent(),n=M._TmpMats[3],G=M._TmpMats[4];o&&1==g?(b?(n.G(b.getWorldMatrix()),o.getAbsoluteMatrix().multiplyToRef(n,n)):n.G(o.getAbsoluteMatrix()),G.G(n),G.invert(),e.multiplyToRef(n,e),e.multiplyToRef(I,e),e.multiplyToRef(G,e)):1==g&&b?(n.G(b.getWorldMatrix()),G.G(n),G.invert(),e.multiplyToRef(n,e),e.multiplyToRef(I,e),e.multiplyToRef(G,e)):e.multiplyToRef(I,e),e.setTranslationFromFloats(c,z,J),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(I,g){const b=M._TmpMats[2];return I.G(this.getAbsoluteMatrix()),g?(I.multiplyToRef(g.getWorldMatrix(),I),e.Matrix.ScalingToRef(g.pb.x,g.pb.y,g.pb.z,b)):e.Matrix.IdentityToRef(b),I.invert(),!isNaN(I.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyToRef(b,I),!0)}fg(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Vg.Zero();return this.getPositionToRef(I,g,b),b}getPositionToRef(){let I=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const I=this.getLocalMatrix();g.x=I.m[12],g.y=I.m[13],g.z=I.m[14]}else{let b=null;I&&(b=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let e=M._TmpMats[0];I&&b?(e.G(this.getAbsoluteMatrix()),e.multiplyToRef(b,e)):e=this.getAbsoluteMatrix(),g.x=e.m[12],g.y=e.m[13],g.z=e.m[14]}}getAbsolutePosition(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const g=e.Vg.Zero();return this.getPositionToRef(1,I,g),g}getAbsolutePositionToRef(I,g){this.getPositionToRef(1,I,g)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.MZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.G(this.MZ);const I=this._skeleton.getPoseMatrix();I&&this._absoluteMatrix.multiplyToRef(I,this._absoluteMatrix)}const I=this.children,g=I.length;for(let b=0;b<g;b++)I[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}IG(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Vg.Zero();return this.getDirectionToRef(I,g,b),b}getDirectionToRef(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,c=null;g&&(c=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=M._TmpMats[0];z.G(this.getAbsoluteMatrix()),g&&c&&z.multiplyToRef(c,z),e.Vg.TransformNormalToRef(I,z,b),b.normalize()}getRotation(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Vg.Zero();return this.getRotationToRef(I,g,b),b}getRotationToRef(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const e=M._TmpQuat;this.getRotationQuaternionToRef(I,g,e),e.toEulerAnglesToRef(b)}getRotationQuaternion(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Quaternion.Identity();return this.getRotationQuaternionToRef(I,g,b),b}getRotationQuaternionToRef(){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),g.G(this._localRotation);else{const b=M._TmpMats[0],e=this.getAbsoluteMatrix();I?e.multiplyToRef(I.getWorldMatrix(),b):b.G(e),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,g,void 0)}}getRotationMatrix(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1?arguments[1]:void 0;const b=e.Matrix.Identity();return this.getRotationMatrixToRef(I,g,b),b}getRotationMatrixToRef(){let I=arguments.length>1?arguments[1]:void 0,g=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(g);else{const b=M._TmpMats[0],e=this.getAbsoluteMatrix();I?e.multiplyToRef(I.getWorldMatrix(),b):b.G(e),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(g)}}getAbsolutePositionFromLocal(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Vg.Zero();return this.getAbsolutePositionFromLocalToRef(I,g,b),b}getAbsolutePositionFromLocalToRef(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,c=null;g&&(c=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=M._TmpMats[0];z.G(this.getAbsoluteMatrix()),g&&c&&z.multiplyToRef(c,z),e.Vg.TransformCoordinatesToRef(I,z,b)}getLocalPositionFromAbsolute(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=e.Vg.Zero();return this.getLocalPositionFromAbsoluteToRef(I,g,b),b}getLocalPositionFromAbsoluteToRef(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,c=null;g&&(c=g.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=M._TmpMats[0];z.G(this.getAbsoluteMatrix()),g&&c&&z.multiplyToRef(c,z),z.invert(),e.Vg.TransformCoordinatesToRef(I,z,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const I=this._skeleton.bones.indexOf(this);if(-1!==I&&this._skeleton.bones.splice(I,1),this._parentNode&&this._parentNode.children){const I=this._parentNode.children,g=I.indexOf(this);-1!==g&&I.splice(g,1)}super.dispose()}}M._TmpVecs=(0,c.e)(2,e.Vg.Zero),M._TmpQuat=e.Quaternion.Identity(),M._TmpMats=(0,c.e)(5,e.Matrix.Identity)},14723:(I,g,b)=>{"use strict";b.d(g,{b:()=>H});var e=b(12577),c=b(12584),z=b(12412),M=b(12590),J=b(12610),o=b(13002),n=b(13027),G=b(12854),D=b(12433),p=b(12597);class x{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(I){this._idleRotationSpeed=I}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(I){this._idleRotationWaitTime=I}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(I){this._idleRotationSpinupTime=I}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(I){this._attachedCamera=I;const g=this._attachedCamera.EI();this._onPrePointerObservableObserver=g.onPrePointerObservable.add((I=>{I.type!==G.e.POINTERDOWN?I.type===G.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const I=D.b.Now;let g=0;null!=this._lastFrameTime&&(g=I-this._lastFrameTime),this._lastFrameTime=I,this._applyUserInteraction();const b=I-this._lastInteractionTime-this._idleRotationWaitTime,e=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*e,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(g/1e3))}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.EI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(I){this._lastInteractionTime=I??D.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<p.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let I=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(I=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?I:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=D.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var Z=b(14726),k=b(13097);class S{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(I){if(this._autoTransitionRange===I)return;this._autoTransitionRange=I;const g=this._attachedCamera;g&&(I?this._onMeshTargetChangedObserver=g.onMeshTargetChangedObservable.add((I=>{if(I&&(I.Mb(!0),I.getBoundingInfo)){const g=I.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*g,this.upperRadiusTransitionRange=.05*g}})):this._onMeshTargetChangedObserver&&g.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(I){this._attachedCamera=I,this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(I){return!!this._attachedCamera&&(this._attachedCamera.radius===I&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(I){if(!this._attachedCamera)return;this._radiusBounceTransition||(S.EasingFunction.setEasingMode(S.EasingMode),this._radiusBounceTransition=k.e.CreateAnimation("radius",k.e.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const g=k.e.TransitionTo("radius",this._attachedCamera.radius+I,this._attachedCamera,this._attachedCamera.EI(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));g&&this._animatables.push(g)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}S.EasingFunction=new Z.b(.3),S.EasingMode=Z.m.EASINGMODE_EASEOUT;class f{constructor(){this.onTargetFramingAnimationEndObservable=new z.c,this._mode=f.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(I){this._mode=I}get mode(){return this._mode}set radiusScale(I){this._radiusScale=I}get radiusScale(){return this._radiusScale}set positionScale(I){this._positionScale=I}get positionScale(){return this._positionScale}set defaultElevation(I){this._defaultElevation=I}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(I){this._elevationReturnTime=I}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(I){this._elevationReturnWaitTime=I}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(I){this._framingTime=I}get framingTime(){return this._framingTime}init(){}attach(I){this._attachedCamera=I;const g=this._attachedCamera.EI();f.EasingFunction.setEasingMode(f.EasingMode),this._onPrePointerObservableObserver=g.onPrePointerObservable.add((I=>{I.type!==G.e.POINTERDOWN?I.type===G.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((I=>{I&&I.getBoundingInfo&&this.zoomOnMesh(I,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.EI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.Mb(!0);const e=I.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(e.minimumWorld,e.maximumWorld,g,b)}zoomOnMeshHierarchy(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.Mb(!0);const e=I.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(e.min,e.max,g,b)}zoomOnMeshesHierarchy(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new M.Vg(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new M.Vg(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let z=0;z<I.length;z++){const g=I[z].getHierarchyBoundingVectors(!0);M.Vg.CheckExtends(g.min,e,c),M.Vg.CheckExtends(g.max,e,c)}this.zoomOnBoundingInfo(e,c,g,b)}zoomOnBoundingInfo(I,g){let b,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const z=I.y,J=z+(g.y-z)*this._positionScale,o=g.ag(I).scale(.5);if(!isFinite(J))return!1;if(e)b=new M.Vg(0,J,0);else{const g=I.add(o);b=new M.Vg(g.x,J,g.z)}this._vectorTransition||(this._vectorTransition=k.e.CreateAnimation("target",k.e.ANIMATIONTYPE_VECTOR3,60,f.EasingFunction)),this._betaIsAnimating=!0;let n=k.e.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.EI(),60,this._vectorTransition,this._framingTime);n&&this._animatables.push(n);let G=0;if(this._mode===f.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(I,g);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=o.length()+this._attachedCamera.cb),G=b}else this._mode===f.IgnoreBoundsSizeMode&&(G=this._calculateLowerRadiusFromModelBoundingSphere(I,g),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.cb));if(this.autoCorrectCameraLimitsAndSensibility){const b=g.ag(I).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/G}return this._radiusTransition||(this._radiusTransition=k.e.CreateAnimation("radius",k.e.ANIMATIONTYPE_FLOAT,60,f.EasingFunction)),n=k.e.TransitionTo("radius",G,this._attachedCamera,this._attachedCamera.EI(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),c&&c(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),n&&this._animatables.push(n),!0}_calculateLowerRadiusFromModelBoundingSphere(I,g){const b=this._attachedCamera;if(!b)return 0;let e=b._calculateLowerRadiusFromModelBoundingSphere(I,g,this._radiusScale);return b.lowerRadiusLimit&&this._mode===f.IgnoreBoundsSizeMode&&(e=e<b.lowerRadiusLimit?b.lowerRadiusLimit:e),b.upperRadiusLimit&&(e=e>b.upperRadiusLimit?b.upperRadiusLimit:e),e}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const I=D.b.Now-this._lastInteractionTime,g=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&I>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=k.e.CreateAnimation("beta",k.e.ANIMATIONTYPE_FLOAT,60,f.EasingFunction));const I=k.e.TransitionTo("beta",g,this._attachedCamera,this._attachedCamera.EI(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));I&&this._animatables.push(I)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=D.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}f.EasingFunction=new Z.r,f.EasingMode=Z.m.EASINGMODE_EASEINOUT,f.IgnoreBoundsSizeMode=0,f.FitFrustumSidesMode=1;var V=b(13031),a=b(13062),v=b(14196),X=b(12409);class R{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(I){I=X.Tools.BackCompatCameraNoPreventDefault(arguments);const g=this.camera.getEngine(),b=g.getInputElement();let e=0,c=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=z=>{var M,J;const o=z.event,n="touch"===o.pointerType;if(z.type!==G.e.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const D=o.target;if(this._altKey=o.altKey,this._ctrlKey=o.ctrlKey,this._metaKey=o.metaKey,this._shiftKey=o.shiftKey,this._buttonsPressed=o.buttons,g.isPointerLock){const I=o.movementX,g=o.movementY;this.onTouch(null,I,g),this._pointA=null,this._pointB=null}else{if(z.type!==G.e.POINTERDOWN&&z.type!==G.e.POINTERDOUBLETAP&&n&&(null===(M=this._pointA)||void 0===M?void 0:M.pointerId)!==o.pointerId&&(null===(J=this._pointB)||void 0===J?void 0:J.pointerId)!==o.pointerId)return;if(z.type!==G.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!n)if(z.type===G.e.POINTERDOUBLETAP)this.onDoubleTap(o.pointerType);else if(z.type!==G.e.POINTERUP||this._currentMousePointerIdDown!==o.pointerId&&!n){if(z.type===G.e.POINTERMOVE)if(I||o.preventDefault(),this._pointA&&null===this._pointB){const I=o.clientX-this._pointA.x,g=o.clientY-this._pointA.y;this._pointA.x=o.clientX,this._pointA.y=o.clientY,this.onTouch(this._pointA,I,g)}else if(this._pointA&&this._pointB){const I=this._pointA.pointerId===o.pointerId?this._pointA:this._pointB;I.x=o.clientX,I.y=o.clientY;const g=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,M=g*g+b*b,J={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:o.pointerId,type:z.type};this.onMultiTouch(this._pointA,this._pointB,e,M,c,J),c=J,e=M}}else{try{null===D||void 0===D||D.releasePointerCapture(o.pointerId)}catch(p){}n||(this._pointB=null),g._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==o.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==o.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==e||c)&&(this.onMultiTouch(this._pointA,this._pointB,e,0,c,null),e=0,c=null),this._currentMousePointerIdDown=-1,this.onButtonUp(o),I||o.preventDefault()}else{try{null===D||void 0===D||D.setPointerCapture(o.pointerId)}catch(p){}if(null===this._pointA)this._pointA={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType};else{if(null!==this._pointB)return;this._pointB={x:o.clientX,y:o.clientY,pointerId:o.pointerId,type:o.pointerType}}-1!==this._currentMousePointerIdDown||n||(this._currentMousePointerIdDown=o.pointerId),this.onButtonDown(o),I||(o.preventDefault(),b&&b.focus())}}},this._observer=this.camera.EI()._inputManager._addCameraPointerObserver(this._pointerInput,G.e.POINTERDOWN|G.e.POINTERUP|G.e.POINTERMOVE|G.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,e=0,c=null,this.onLostFocus()},this._contextMenuBind=I=>this.onContextMenu(I),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const z=this.camera.EI().getEngine().getHostWindow();z&&X.Tools.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}xx(){if(this._onLostFocus){const I=this.camera.EI().getEngine().getHostWindow();I&&X.Tools.UnregisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.EI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const I=this.camera.EI().getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(I){}onTouch(I,g,b){}onMultiTouch(I,g,b,e,c,z){}onContextMenu(I){I.preventDefault()}onButtonDown(I){}onButtonUp(I){}onLostFocus(){}}(0,e.d)([(0,c.E)()],R.prototype,"buttons",void 0);class E extends R{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(I,g){if(0!==this.panningSensibility&&I&&g){const b=g.x-I.x,e=g.y-I.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility}}_computePinchZoom(I,g){const b=this.camera.radius||E.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(I)/Math.sqrt(g):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(g-I)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(g-I)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(I,g,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-g/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=g/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(I,g,b,e,c,z){0===b&&null===c||0===e&&null===z||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,e),this._computeMultiTouchPanning(c,z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(e)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,e),this._isPinching=!0):this._computeMultiTouchPanning(c,z)):this.multiTouchPanning?this._computeMultiTouchPanning(c,z):this.pinchZoom&&this._computePinchZoom(b,e))}onButtonDown(I){this._isPanClick=I.button===this.camera._panningMouseButton}onButtonUp(I){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}E.MinimumRadiusForPinch=.001,(0,e.d)([(0,c.E)()],E.prototype,"buttons",void 0),(0,e.d)([(0,c.E)()],E.prototype,"angularSensibilityX",void 0),(0,e.d)([(0,c.E)()],E.prototype,"angularSensibilityY",void 0),(0,e.d)([(0,c.E)()],E.prototype,"pinchPrecision",void 0),(0,e.d)([(0,c.E)()],E.prototype,"pinchDeltaPercentage",void 0),(0,e.d)([(0,c.E)()],E.prototype,"useNaturalPinchZoom",void 0),(0,e.d)([(0,c.E)()],E.prototype,"pinchZoom",void 0),(0,e.d)([(0,c.E)()],E.prototype,"panningSensibility",void 0),(0,e.d)([(0,c.E)()],E.prototype,"multiTouchPanning",void 0),(0,e.d)([(0,c.E)()],E.prototype,"multiTouchPanAndZoom",void 0),v.d.ArcRotateCameraPointersInput=E;var mI=b(12859);class s{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(I){I=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.EI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((g=>{const b=g.event;if(!b.metaKey)if(g.type===mI.c.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(I||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const g=this._keys.indexOf(b.keyCode);g>=0&&this._keys.splice(g,1),b.preventDefault&&(I||b.preventDefault())}})))}xx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let g=0;g<this._keys.length;g++){const b=this._keys[g];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX-=1/this.panningSensibility:I.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset+=1/this.zoomingSensibility:I.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX+=1/this.panningSensibility:I.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset-=1/this.zoomingSensibility:I.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&I.useInputToRestoreState&&I.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,e.d)([(0,c.E)()],s.prototype,"keysUp",void 0),(0,e.d)([(0,c.E)()],s.prototype,"keysDown",void 0),(0,e.d)([(0,c.E)()],s.prototype,"keysLeft",void 0),(0,e.d)([(0,c.E)()],s.prototype,"keysRight",void 0),(0,e.d)([(0,c.E)()],s.prototype,"keysReset",void 0),(0,e.d)([(0,c.E)()],s.prototype,"panningSensibility",void 0),(0,e.d)([(0,c.E)()],s.prototype,"zoomingSensibility",void 0),(0,e.d)([(0,c.E)()],s.prototype,"useAltToZoom",void 0),(0,e.d)([(0,c.E)()],s.prototype,"angularSpeed",void 0),v.d.ArcRotateCameraKeyboardMoveInput=s;var F=b(12646),Y=b(12863);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new M.Vg(0,0,0),this._globalOffset=new M.Vg(0,0,0),this._inertialPanning=M.Vg.Zero()}_computeDeltaFromMouseWheelLegacyEvent(I,g){let b=0;const e=.01*I*this.wheelDeltaPercentage*g;return b=I>0?e/(1+this.wheelDeltaPercentage):e*(1+this.wheelDeltaPercentage),b}attachControl(I){I=X.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=g=>{if(g.type!==G.e.POINTERWHEEL)return;const b=g.event;let e=0;const c=b.deltaMode===Y.b.DOM_DELTA_LINE?40:1,z=-b.deltaY*c;if(this.customComputeDeltaFromMouseWheel)e=this.customComputeDeltaFromMouseWheel(z,this,b);else if(this.wheelDeltaPercentage){if(e=this._computeDeltaFromMouseWheelLegacyEvent(z,this.camera.radius),e>0){let I=this.camera.radius,g=this.camera.inertialRadiusOffset+e;for(let b=0;b<20&&!(I<=g)&&!(Math.abs(g*this.camera.inertia)<.001);b++)I-=g,g*=this.camera.inertia;I=(0,J.Clamp)(I,0,Number.MAX_VALUE),e=this._computeDeltaFromMouseWheelLegacyEvent(z,I)}}else e=z/(40*this.wheelPrecision);e&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(e)):this.camera.inertialRadiusOffset+=e),b.preventDefault&&(I||b.preventDefault())},this._observer=this.camera.EI()._inputManager._addCameraPointerObserver(this._wheel,G.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.kb(0)}xx(){this._observer&&(this.camera.EI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const I=this.camera;0+I.inertialAlphaOffset+I.inertialBetaOffset+I.inertialRadiusOffset&&(this._updateHitPlane(),I.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(I.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const I=this.camera,g=I.target.ag(I.position);this._hitPlane=F.b.FromPositionAndNormal(I.target,g)}_getPosition(){const I=this.camera,g=I.EI(),b=g.createPickingRay(g.pointerX,g.pointerY,M.Matrix.Identity(),I,!1);0===I.targetScreenOffset.x&&0===I.targetScreenOffset.y||(this._viewOffset.set(I.targetScreenOffset.x,I.targetScreenOffset.y,0),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),this._globalOffset=M.Vg.TransformNormal(this._viewOffset,I._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let e=0;return this._hitPlane&&(e=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(e))}_zoomToMouse(I){const g=this.camera,b=1-g.inertia;if(g.lowerRadiusLimit){const e=g.lowerRadiusLimit??0;g.radius-(g.inertialRadiusOffset+I)/b<e&&(I=(g.radius-e)*b-g.inertialRadiusOffset)}if(g.upperRadiusLimit){const e=g.upperRadiusLimit??0;g.radius-(g.inertialRadiusOffset+I)/b>e&&(I=(g.radius-e)*b-g.inertialRadiusOffset)}const e=I/b/g.radius,c=this._getPosition(),z=M.TmpVectors.Vg[6];c.subtractToRef(g.target,z),z.scaleInPlace(e),z.scaleInPlace(b),this._inertialPanning.addInPlace(z),g.inertialRadiusOffset+=I}_zeroIfClose(I){Math.abs(I.x)<p.b&&(I.x=0),Math.abs(I.y)<p.b&&(I.y=0),Math.abs(I.z)<p.b&&(I.z=0)}}(0,e.d)([(0,c.E)()],d.prototype,"wheelPrecision",void 0),(0,e.d)([(0,c.E)()],d.prototype,"zoomToMouseLocation",void 0),(0,e.d)([(0,c.E)()],d.prototype,"wheelDeltaPercentage",void 0),v.d.ArcRotateCameraMouseWheelInput=d;class C extends v.g{constructor(I){super(I)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new E),this}addKeyboard(){return this.add(new s),this}}var r=b(12558);function O(I,g){return isNaN(I)?g:I}o.b.AddNodeConstructor("ArcRotateCamera",((I,g)=>()=>new H(I,0,0,1,M.Vg.Zero(),g)));class H extends a.d{get target(){return this._target}set target(I){this.setTarget(I)}get targetHost(){return this._targetHost}set targetHost(I){I&&this.setTarget(I)}getTarget(){return this.target}get position(){return this._position}set position(I){this.setPosition(I)}set upVector(I){this._upToYMatrix||(this._yToUpMatrix=new M.Matrix,this._upToYMatrix=new M.Matrix,this._upVector=M.Vg.Zero()),I.normalize(),this._upVector.G(I),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){M.Matrix.RotationAlignToRef(M.Vg.UpReadOnly,this._upVector,this._yToUpMatrix),M.Matrix.RotationAlignToRef(this._upVector,M.Vg.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityX:0}set angularSensibilityX(I){const g=this.inputs.attached.pointers;g&&(g.angularSensibilityX=I)}get angularSensibilityY(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityY:0}set angularSensibilityY(I){const g=this.inputs.attached.pointers;g&&(g.angularSensibilityY=I)}get pinchPrecision(){const I=this.inputs.attached.pointers;return I?I.pinchPrecision:0}set pinchPrecision(I){const g=this.inputs.attached.pointers;g&&(g.pinchPrecision=I)}get pinchDeltaPercentage(){const I=this.inputs.attached.pointers;return I?I.pinchDeltaPercentage:0}set pinchDeltaPercentage(I){const g=this.inputs.attached.pointers;g&&(g.pinchDeltaPercentage=I)}get useNaturalPinchZoom(){const I=this.inputs.attached.pointers;return!!I&&I.useNaturalPinchZoom}set useNaturalPinchZoom(I){const g=this.inputs.attached.pointers;g&&(g.useNaturalPinchZoom=I)}get panningSensibility(){const I=this.inputs.attached.pointers;return I?I.panningSensibility:0}set panningSensibility(I){const g=this.inputs.attached.pointers;g&&(g.panningSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const g=this.inputs.attached.keyboard;g&&(g.keysUp=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const g=this.inputs.attached.keyboard;g&&(g.keysDown=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const g=this.inputs.attached.keyboard;g&&(g.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const g=this.inputs.attached.keyboard;g&&(g.keysRight=I)}get wheelPrecision(){const I=this.inputs.attached.mousewheel;return I?I.wheelPrecision:0}set wheelPrecision(I){const g=this.inputs.attached.mousewheel;g&&(g.wheelPrecision=I)}get zoomToMouseLocation(){const I=this.inputs.attached.mousewheel;return!!I&&I.zoomToMouseLocation}set zoomToMouseLocation(I){const g=this.inputs.attached.mousewheel;g&&(g.zoomToMouseLocation=I)}get wheelDeltaPercentage(){const I=this.inputs.attached.mousewheel;return I?I.wheelDeltaPercentage:0}set wheelDeltaPercentage(I){const g=this.inputs.attached.mousewheel;g&&(g.wheelDeltaPercentage=I)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(I){I!==this.useBouncingBehavior&&(I?(this._bouncingBehavior=new S,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(I){I!==this.useFramingBehavior&&(I?(this._framingBehavior=new f,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(I){I!==this.useAutoRotationBehavior&&(I?(this._autoRotationBehavior=new x,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(I,g,b,e,c,J){var o;let n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(I,M.Vg.Zero(),J,n),o=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=M.Vg.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=M.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new M.Matrix,this.panningAxis=new M.Vg(1,1,0),this._transformedDirection=new M.Vg,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new z.c,this.checkCollisions=!1,this.collisionRadius=new M.Vg(.5,.5,.5),this._previousPosition=M.Vg.Zero(),this._collisionVelocity=M.Vg.Zero(),this._newPosition=M.Vg.Zero(),this._computationVector=M.Vg.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new M.Vg(NaN,NaN,NaN),this._goalTargetScreenOffset=new M.Vector2(NaN,NaN),this._onCollisionPositionChange=function(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(o.setPosition(g),o.Ik&&o.Ik(b)):o._previousPosition.G(o._position);const e=Math.cos(o.alpha),c=Math.sin(o.alpha),z=Math.cos(o.beta);let M=Math.sin(o.beta);0===M&&(M=1e-4);const J=o._getTargetPosition();o._computationVector.Db(o.radius*e*M,o.radius*z,o.radius*c*M),J.addToRef(o._computationVector,o._newPosition),o._position.G(o._newPosition);let n=o.upVector;o.allowUpsideDown&&o.beta<0&&(n=n.clone(),n=n.negate()),o._computeViewMatrix(o._position,J,n),o._viewMatrix.addAtIndex(12,o.targetScreenOffset.x),o._viewMatrix.addAtIndex(13,o.targetScreenOffset.y),o._collisionTriggered=!1},this._target=M.Vg.Zero(),c&&this.setTarget(c),this.alpha=g,this.beta=b,this.radius=e,this.getViewMatrix(),this.inputs=new C(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new M.Vg(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=M.Vector2.Zero()}_updateCache(I){I||super._updateCache(),this._cache._target.G(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.G(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const I=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?I.addToRef(this._targetBoundingCenter,this._target):this._target.G(I)}const I=this._getLockedTargetPosition();return I||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>p.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=z?this._currentInterpolationFactor=z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=O(I,this._goalAlpha),this._goalBeta=O(g,this._goalBeta),this._goalRadius=O(b,this._goalRadius),this._goalTarget.set(O(e.x,this._goalTarget.x),O(e.y,this._goalTarget.y),O(e.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(O(c.x,this._goalTargetScreenOffset.x),O(c.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,J.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,J.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,J.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,J.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(I,g){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const c=arguments;g=X.Tools.BackCompatCameraNoPreventDefault(c),this._useCtrlForPanning=b,this._panningMouseButton=e,"boolean"===typeof c[0]&&(c.length>1&&(this._useCtrlForPanning=c[1]),c.length>2&&(this._panningMouseButton=c[2])),this.inputs.attachElement(g),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}xx(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let I=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){I=!0;const g=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let e=this.inertialAlphaOffset*b;this.beta<0&&(e*=-1),this.alpha+=e*g,this.beta+=this.inertialBetaOffset*g,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<p.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<p.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*p.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){I=!0;const g=new M.Vg(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),g.multiplyInPlace(this.panningAxis),M.Vg.TransformNormalToRef(g,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const I=this.upVector,g=M.Vg.CrossToRef(this._transformedDirection,I,this._transformedDirection);M.Vg.CrossToRef(I,g,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);M.Vg.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.G(this._transformedDirection)}else{if(this.parent){const I=M.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.transposeToRef(I),M.Vg.TransformCoordinatesToRef(this._transformedDirection,I,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*p.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*p.b&&(this.inertialPanningY=0)}if(I)this.stopInterpolation();else if(this._isInterpolating){let I=!1;const g=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-g/this._currentInterpolationFactor),e=O(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const g=M.TmpVectors.Vg[0].set(O(this._goalTarget.x,this._target.x),O(this._goalTarget.y,this._target.y),O(this._goalTarget.z,this._target.z));M.Vg.LerpToRef(this.target,g,b,this._target),10*M.Vg.Distance(this.target,g)/e<p.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.G(g),this.setTarget(this.target,!1,!0,!0)):I=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const g=M.Quaternion.RotationAlphaBetaGammaToRef(O(this._goalAlpha,this.alpha),O(this._goalBeta,this.beta),0,M.TmpVectors.Quaternion[0]),e=M.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,M.TmpVectors.Quaternion[1]),c=M.Quaternion.SlerpToRef(e,g,b,M.TmpVectors.Quaternion[2]);c.normalize();const z=c.toAlphaBetaGammaToRef(M.TmpVectors.Vg[0]);if(this.alpha=z.x,this.beta=z.y,c.isApprox(g,p.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const I=g.toAlphaBetaGammaToRef(M.TmpVectors.Vg[0]);this.alpha=I.x,this.beta=I.y}else I=!0}if(isNaN(this._goalRadius)||(this.radius+=(e-this.radius)*b,Math.abs(e/this.radius-1)<p.b?(this._goalRadius=NaN,this.radius=e):I=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const g=M.TmpVectors.Vector2[0].set(O(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),O(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));M.Vector2.LerpToRef(this.targetScreenOffset,g,b,this.targetScreenOffset),M.Vector2.Distance(this.targetScreenOffset,g)<p.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.G(g)):I=!0}this._isInterpolating=I}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.Vg.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const I=this.alpha;var g,b;this.alpha=function(I){let g=Math.PI/2;return 0===I.x&&0===I.z||(g=Math.acos(I.x/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.z,2)))),I.z<0&&(g=2*Math.PI-g),g}(this._computationVector),this.beta=(g=this._computationVector.y,b=this.radius,Math.acos(g/b));const e=Math.round((I-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this._checkLimits()}setPosition(I){this._position.equals(I)||(this._position.G(I),this.rebuildAnglesAndRadius())}setTarget(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e=this.overrideCloneAlphaBetaRadius??e,I.Mb)g&&I.getBoundingInfo?this._targetBoundingCenter=I.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,I.Mb(),this._targetHost=I,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const g=I,e=this._getTargetPosition();if(e&&!b&&e.equals(g))return;this._targetHost=null,this._target=g,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}e||this.rebuildAnglesAndRadius()}_getViewMatrix(){const I=Math.cos(this.alpha),g=Math.sin(this.alpha),b=Math.cos(this.beta);let e=Math.sin(this.beta);0===e&&(e=1e-4),0===this.radius&&(this.radius=1e-4);const c=this._getTargetPosition();if(this._computationVector.Db(this.radius*I*e,this.radius*b,this.radius*g*e),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||M.Vg.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),c.addToRef(this._computationVector,this._newPosition),this.EI().collisionsEnabled&&this.checkCollisions){const I=this.EI().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,I.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.G(this._newPosition);let I=this.upVector;this.allowUpsideDown&&e<0&&(I=I.negate()),this._computeViewMatrix(this._position,c,I),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.G(c),this._viewMatrix}zoomOn(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I||this.EI().meshes;const b=n.e.MinMax(I);let e=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(e=Math.max(Math.min(e,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=e*this.zoomOnFactor,this.mode===V.b.ORTHOGRAPHIC_CAMERA){const I=this.EI().getEngine().getAspectRatio(this),g=e*this.zoomOnFactor/2;this.orthoLeft=-g*I,this.orthoRight=g*I,this.orthoBottom=-g,this.orthoTop=g}this.focusOn({min:b.min,max:b.max,distance:e},g)}focusOn(I){let g,b,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===I.min){const e=I||this.EI().meshes;g=n.e.MinMax(e),b=M.Vg.Distance(g.min,g.max)}else{g=I,b=I.distance}this._target=n.e.Center(g),e||(this.maxZ=2*b)}createRigCamera(I,g){let b=0;switch(this.cameraRigMode){case V.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.b.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===g?1:-1);break;case V.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===g?-1:1)}const e=new H(I,this.alpha+b,this.beta,this.radius,this._target,this.EI());return e._cameraRigParams={},e.isRigCamera=!0,e.rigParent=this,e.upVector=this.upVector,e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoBottom=this.orthoBottom,e.orthoTop=this.orthoTop,e}_updateRigCameras(){const I=this._rigCameras[0],g=this._rigCameras[1];switch(I.beta=g.beta=this.beta,this.cameraRigMode){case V.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.b.RIG_MODE_VR:I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const e=M.Vg.Distance(I,g),c=this.EI().getEngine().getAspectRatio(this),z=Math.tan(this.fov/2),J=z*c,o=.5*e*b,n=o*Math.sqrt(1+1/(J*J)),G=o*Math.sqrt(1+1/(z*z));return Math.max(n,G)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,e.d)([(0,c.E)()],H.prototype,"alpha",void 0),(0,e.d)([(0,c.E)()],H.prototype,"beta",void 0),(0,e.d)([(0,c.E)()],H.prototype,"radius",void 0),(0,e.d)([(0,c.E)()],H.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,e.d)([(0,c.A)("target")],H.prototype,"_target",void 0),(0,e.d)([(0,c.s)("targetHost")],H.prototype,"_targetHost",void 0),(0,e.d)([(0,c.E)()],H.prototype,"inertialAlphaOffset",void 0),(0,e.d)([(0,c.E)()],H.prototype,"inertialBetaOffset",void 0),(0,e.d)([(0,c.E)()],H.prototype,"inertialRadiusOffset",void 0),(0,e.d)([(0,c.E)()],H.prototype,"lowerAlphaLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"upperAlphaLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"lowerBetaLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"upperBetaLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"lowerRadiusLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"upperRadiusLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"lowerTargetYLimit",void 0),(0,e.d)([(0,c.E)()],H.prototype,"inertialPanningX",void 0),(0,e.d)([(0,c.E)()],H.prototype,"inertialPanningY",void 0),(0,e.d)([(0,c.E)()],H.prototype,"pinchToPanMaxDistance",void 0),(0,e.d)([(0,c.E)()],H.prototype,"panningDistanceLimit",void 0),(0,e.d)([(0,c.A)()],H.prototype,"panningOriginTarget",void 0),(0,e.d)([(0,c.E)()],H.prototype,"panningInertia",void 0),(0,e.d)([(0,c.E)()],H.prototype,"zoomToMouseLocation",null),(0,e.d)([(0,c.E)()],H.prototype,"zoomOnFactor",void 0),(0,e.d)([(0,c.x)()],H.prototype,"targetScreenOffset",void 0),(0,e.d)([(0,c.E)()],H.prototype,"allowUpsideDown",void 0),(0,e.d)([(0,c.E)()],H.prototype,"useInputToRestoreState",void 0),(0,e.d)([(0,c.E)()],H.prototype,"restoreStateInterpolationFactor",void 0),(0,r.g)("BABYLON.ArcRotateCamera",H)},14196:(I,g,b)=>{"use strict";b.d(g,{d:()=>M,g:()=>J});var e=b(12420),c=b(12622),z=b(13031),M={};class J{constructor(I){this.attachedToElement=!1,this.attached={},this.camera=I,this.checkInputs=()=>{}}add(I){const g=I.getSimpleName();this.attached[g]?e.b.Warn("camera input of type "+g+" already exists on camera"):(this.attached[g]=I,I.camera=this.camera,I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I))),this.attachedToElement&&I.attachControl(this.noPreventDefault))}remove(I){for(const g in this.attached){const b=this.attached[g];if(b===I)return b.xx(),b.camera=null,delete this.attached[g],void this.rebuildInputCheck()}}removeByType(I){for(const g in this.attached){const b=this.attached[g];b.getClassName()===I&&(b.xx(),b.camera=null,delete this.attached[g],this.rebuildInputCheck())}}_addCheckInputs(I){const g=this.checkInputs;return()=>{g(),I()}}attachInput(I){this.attachedToElement&&I.attachControl(this.noPreventDefault)}attachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){I=!z.b.ForceAttachControlToAlwaysPreventDefault&&I,this.attachedToElement=!0,this.noPreventDefault=I;for(const g in this.attached)this.attached[g].attachControl(I)}}detachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const g in this.attached)this.attached[g].xx(),I&&(this.attached[g].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const I in this.attached){const g=this.attached[I];g.checkInputs&&(this.checkInputs=this._addCheckInputs(g.checkInputs.bind(g)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(I){const g={};for(const b in this.attached){const I=this.attached[b],e=c.b.Serialize(I);g[I.getClassName()]=e}I.inputsmgr=g}parse(I){const g=I.inputsmgr;if(g){this.clear();for(const I in g){const b=M[I];if(b){const e=g[I],z=c.b.Parse((()=>new b),e,null);this.add(z)}}}else for(const b in this.attached){const g=M[this.attached[b].getClassName()];if(g){const e=c.b.Parse((()=>new g),I,null);this.remove(this.attached[b]),this.add(e)}}}}},14193:(I,g,b)=>{"use strict";b.d(g,{b:()=>R});var e=b(12577),c=b(12584),z=b(12590),M=b(13062),J=b(14196),o=b(12859),n=b(12409);class G{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(I){I=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.EI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((g=>{const b=g.event;if(!b.metaKey)if(g.type===o.c.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),I||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const g=this._keys.indexOf(b.keyCode);g>=0&&this._keys.splice(g,1),I||b.preventDefault()}})))}xx(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let g=0;g<this._keys.length;g++){const b=this._keys[g],e=I._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?I._localDirection.Db(-e,0,0):-1!==this.keysUp.indexOf(b)?I._localDirection.Db(0,0,e):-1!==this.keysRight.indexOf(b)?I._localDirection.Db(e,0,0):-1!==this.keysDown.indexOf(b)?I._localDirection.Db(0,0,-e):-1!==this.keysUpward.indexOf(b)?I._localDirection.Db(0,e,0):-1!==this.keysDownward.indexOf(b)?I._localDirection.Db(0,-e,0):-1!==this.keysRotateLeft.indexOf(b)?(I._localDirection.Db(0,0,0),I.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(I._localDirection.Db(0,0,0),I.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(I._localDirection.Db(0,0,0),I.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(I._localDirection.Db(0,0,0),I.cameraRotation.x+=this._getLocalRotation()),I.EI().useRightHandedSystem&&(I._localDirection.z*=-1),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),z.Vg.TransformNormalToRef(I._localDirection,I._cameraTransformMatrix,I._transformedDirection),I.cameraDirection.addInPlace(I._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const I=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*I}}(0,e.d)([(0,c.E)()],G.prototype,"keysUp",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysUpward",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysDown",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysDownward",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysLeft",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysRight",void 0),(0,e.d)([(0,c.E)()],G.prototype,"rotationSpeed",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysRotateLeft",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysRotateRight",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysRotateUp",void 0),(0,e.d)([(0,c.E)()],G.prototype,"keysRotateDown",void 0),J.d.FreeCameraKeyboardMoveInput=G;var D=b(12412),p=b(12854);class x{constructor(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=I,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new D.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(I){I=n.Tools.BackCompatCameraNoPreventDefault(arguments);const g=this.camera.getEngine(),b=g.getInputElement();this._pointerInput||(this._pointerInput=e=>{const c=e.event,z="touch"===c.pointerType;if(!this.touchEnabled&&z)return;if(e.type!==p.e.POINTERMOVE&&-1===this.buttons.indexOf(c.button))return;const M=c.target;if(e.type===p.e.POINTERDOWN){if(z&&-1!==this._activePointerId||!z&&-1!==this._currentActiveButton)return;this._activePointerId=c.pointerId;try{null===M||void 0===M||M.setPointerCapture(c.pointerId)}catch(J){}-1===this._currentActiveButton&&(this._currentActiveButton=c.button),this._previousPosition={x:c.clientX,y:c.clientY},I||(c.preventDefault(),b&&b.focus()),g.isPointerLock&&this._onMouseMove&&this._onMouseMove(e.event)}else if(e.type===p.e.POINTERUP){if(z&&this._activePointerId!==c.pointerId||!z&&this._currentActiveButton!==c.button)return;try{null===M||void 0===M||M.releasePointerCapture(c.pointerId)}catch(J){}this._currentActiveButton=-1,this._previousPosition=null,I||c.preventDefault(),this._activePointerId=-1}else if(e.type===p.e.POINTERMOVE&&(this._activePointerId===c.pointerId||!z))if(g.isPointerLock&&this._onMouseMove)this._onMouseMove(e.event);else if(this._previousPosition){const g=this.camera._calculateHandednessMultiplier(),b=(c.clientX-this._previousPosition.x)*g,e=c.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=e/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:e}),this._previousPosition={x:c.clientX,y:c.clientY},I||c.preventDefault()}}),this._onMouseMove=b=>{if(!g.isPointerLock)return;const e=this.camera._calculateHandednessMultiplier(),c=b.movementX*e;this.camera.cameraRotation.y+=c/this.angularSensibility;const z=b.movementY;this.camera.cameraRotation.x+=z/this.angularSensibility,this._previousPosition=null,I||b.preventDefault()},this._observer=this.camera.EI()._inputManager._addCameraPointerObserver(this._pointerInput,p.e.POINTERDOWN|p.e.POINTERUP|p.e.POINTERMOVE),b&&(this._contextMenuBind=I=>this.onContextMenu(I),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(I){I.preventDefault()}xx(){if(this._observer){if(this.camera.EI()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,e.d)([(0,c.E)()],x.prototype,"buttons",void 0),(0,e.d)([(0,c.E)()],x.prototype,"angularSensibility",void 0),J.d.FreeCameraMouseInput=x;var Z,k=b(12863);class S{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new D.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(I){I=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=g=>{if(g.type!==p.e.POINTERWHEEL)return;const b=g.event,e=b.deltaMode===k.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*e*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*e*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*e*b.deltaZ/this._normalize,b.preventDefault&&(I||b.preventDefault())},this._observer=this.camera.EI()._inputManager._addCameraPointerObserver(this._wheel,p.e.POINTERWHEEL)}xx(){this._observer&&(this.camera.EI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,e.d)([(0,c.E)()],S.prototype,"wheelPrecisionX",void 0),(0,e.d)([(0,c.E)()],S.prototype,"wheelPrecisionY",void 0),(0,e.d)([(0,c.E)()],S.prototype,"wheelPrecisionZ",void 0),function(I){I[I.MoveRelative=0]="MoveRelative",I[I.RotateRelative=1]="RotateRelative",I[I.MoveScene=2]="MoveScene"}(Z||(Z={}));class f extends S{constructor(){super(...arguments),this._moveRelative=z.Vg.Zero(),this._rotateRelative=z.Vg.Zero(),this._moveScene=z.Vg.Zero(),this._wheelXAction=Z.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Z.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(I){null===I&&this._wheelXAction!==Z.MoveRelative||(this._wheelXAction=Z.MoveRelative,this._wheelXActionCoordinate=I)}get wheelXMoveRelative(){return this._wheelXAction!==Z.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(I){null===I&&this._wheelYAction!==Z.MoveRelative||(this._wheelYAction=Z.MoveRelative,this._wheelYActionCoordinate=I)}get wheelYMoveRelative(){return this._wheelYAction!==Z.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(I){null===I&&this._wheelZAction!==Z.MoveRelative||(this._wheelZAction=Z.MoveRelative,this._wheelZActionCoordinate=I)}get wheelZMoveRelative(){return this._wheelZAction!==Z.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(I){null===I&&this._wheelXAction!==Z.RotateRelative||(this._wheelXAction=Z.RotateRelative,this._wheelXActionCoordinate=I)}get wheelXRotateRelative(){return this._wheelXAction!==Z.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(I){null===I&&this._wheelYAction!==Z.RotateRelative||(this._wheelYAction=Z.RotateRelative,this._wheelYActionCoordinate=I)}get wheelYRotateRelative(){return this._wheelYAction!==Z.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(I){null===I&&this._wheelZAction!==Z.RotateRelative||(this._wheelZAction=Z.RotateRelative,this._wheelZActionCoordinate=I)}get wheelZRotateRelative(){return this._wheelZAction!==Z.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(I){null===I&&this._wheelXAction!==Z.MoveScene||(this._wheelXAction=Z.MoveScene,this._wheelXActionCoordinate=I)}get wheelXMoveScene(){return this._wheelXAction!==Z.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(I){null===I&&this._wheelYAction!==Z.MoveScene||(this._wheelYAction=Z.MoveScene,this._wheelYActionCoordinate=I)}get wheelYMoveScene(){return this._wheelYAction!==Z.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(I){null===I&&this._wheelZAction!==Z.MoveScene||(this._wheelZAction=Z.MoveScene,this._wheelZActionCoordinate=I)}get wheelZMoveScene(){return this._wheelZAction!==Z.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.kb(0),this._rotateRelative.kb(0),this._moveScene.kb(0),this._updateCamera(),this.camera.EI().useRightHandedSystem&&(this._moveRelative.z*=-1);const I=z.Matrix.Zero();this.camera.getViewMatrix().invertToRef(I);const g=z.Vg.Zero();z.Vg.TransformNormalToRef(this._moveRelative,I,g),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(g),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(I,g,b){if(0===I)return;if(null===g||null===b)return;let e=null;switch(g){case Z.MoveRelative:e=this._moveRelative;break;case Z.RotateRelative:e=this._rotateRelative;break;case Z.MoveScene:e=this._moveScene}switch(b){case 0:e.set(I,0,0);break;case 1:e.set(0,I,0);break;case 2:e.set(0,0,I)}}}(0,e.d)([(0,c.E)()],f.prototype,"wheelXMoveRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelYMoveRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelZMoveRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelXRotateRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelYRotateRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelZRotateRelative",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelXMoveScene",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelYMoveScene",null),(0,e.d)([(0,c.E)()],f.prototype,"wheelZMoveScene",null),J.d.FreeCameraMouseWheelInput=f;class V{constructor(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=I,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=n.Tools.IsSafari()}attachControl(I){I=n.Tools.BackCompatCameraNoPreventDefault(arguments);let g=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const e=b.event,c="mouse"===e.pointerType||this._isSafari&&"undefined"===typeof e.pointerType;if(this.allowMouse||!c)if(b.type===p.e.POINTERDOWN){if(I||e.preventDefault(),this._pointerPressed.push(e.pointerId),1!==this._pointerPressed.length)return;g={x:e.clientX,y:e.clientY}}else if(b.type===p.e.POINTERUP){I||e.preventDefault();const b=this._pointerPressed.indexOf(e.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;g=null,this._offsetX=null,this._offsetY=null}else if(b.type===p.e.POINTERMOVE){if(I||e.preventDefault(),!g)return;if(0!=this._pointerPressed.indexOf(e.pointerId))return;this._offsetX=e.clientX-g.x,this._offsetY=-(e.clientY-g.y)}}),this._observer=this.camera.EI()._inputManager._addCameraPointerObserver(this._pointerInput,p.e.POINTERDOWN|p.e.POINTERUP|p.e.POINTERMOVE),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.addEventListener("blur",this._onLostFocus)}}xx(){if(this._pointerInput){if(this._observer&&(this.camera.EI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const I=this.camera,g=I._calculateHandednessMultiplier();I.cameraRotation.y=g*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)I.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const g=I._computeLocalCameraSpeed(),b=new z.Vg(0,0,0!==this.touchMoveSensibility?g*this._offsetY/this.touchMoveSensibility:0);z.Matrix.RotationYawPitchRollToRef(I.rotation.y,I.rotation.x,0,I._cameraRotationMatrix),I.cameraDirection.addInPlace(z.Vg.TransformCoordinates(b,I._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,e.d)([(0,c.E)()],V.prototype,"touchAngularSensibility",void 0),(0,e.d)([(0,c.E)()],V.prototype,"touchMoveSensibility",void 0),J.d.FreeCameraTouchInput=V;class a extends J.g{constructor(I){super(I),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new G),this}addMouse(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new x(I),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new f,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new V),this}clear(){super.clear(),this._mouseInput=null}}var v=b(12558),X=b(12497);class R extends M.d{get angularSensibility(){const I=this.inputs.attached.mouse;return I?I.angularSensibility:0}set angularSensibility(I){const g=this.inputs.attached.mouse;g&&(g.angularSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const g=this.inputs.attached.keyboard;g&&(g.keysUp=I)}get keysUpward(){const I=this.inputs.attached.keyboard;return I?I.keysUpward:[]}set keysUpward(I){const g=this.inputs.attached.keyboard;g&&(g.keysUpward=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const g=this.inputs.attached.keyboard;g&&(g.keysDown=I)}get keysDownward(){const I=this.inputs.attached.keyboard;return I?I.keysDownward:[]}set keysDownward(I){const g=this.inputs.attached.keyboard;g&&(g.keysDownward=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const g=this.inputs.attached.keyboard;g&&(g.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const g=this.inputs.attached.keyboard;g&&(g.keysRight=I)}get keysRotateLeft(){const I=this.inputs.attached.keyboard;return I?I.keysRotateLeft:[]}set keysRotateLeft(I){const g=this.inputs.attached.keyboard;g&&(g.keysRotateLeft=I)}get keysRotateRight(){const I=this.inputs.attached.keyboard;return I?I.keysRotateRight:[]}set keysRotateRight(I){const g=this.inputs.attached.keyboard;g&&(g.keysRotateRight=I)}get keysRotateUp(){const I=this.inputs.attached.keyboard;return I?I.keysRotateUp:[]}set keysRotateUp(I){const g=this.inputs.attached.keyboard;g&&(g.keysRotateUp=I)}get keysRotateDown(){const I=this.inputs.attached.keyboard;return I?I.keysRotateDown:[]}set keysRotateDown(I){const g=this.inputs.attached.keyboard;g&&(g.keysRotateDown=I)}constructor(I,g,b){var e;super(I,g,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),e=this,this.ellipsoid=new z.Vg(.5,1,.5),this.ellipsoidOffset=new z.Vg(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=z.Vg.Zero(),this._diffPosition=z.Vg.Zero(),this._newPosition=z.Vg.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e._newPosition.G(g),e._newPosition.subtractToRef(e._oldPosition,e._diffPosition),e._diffPosition.length()>X.c.CollisionsEpsilon&&(e.position.addToRef(e._diffPosition,e._deferredPositionUpdate),e._deferOnly?e._deferredUpdated=!0:e.position.G(e._deferredPositionUpdate),e.Ik&&b&&e.Ik(b))},this.inputs=new a(this),this.inputs.addKeyboard().addMouse()}attachControl(I,g){g=n.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(g)}xx(){this.inputs.detachElement(),this.cameraDirection=new z.Vg(0,0,0),this.cameraRotation=new z.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(I){this._collisionMask=isNaN(I)?-1:I}_collideWithWorld(I){let g;g=this.parent?z.Vg.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,g.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.EI().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let e=I;this.applyGravity&&(e=I.add(this.EI().gravity)),b.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=z.Vg.Zero(),this._transformedDirection=z.Vg.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(I){this._needMoveForGravity=I}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.EI().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Fb"}}(0,e.d)([(0,c.A)()],R.prototype,"ellipsoid",void 0),(0,e.d)([(0,c.A)()],R.prototype,"ellipsoidOffset",void 0),(0,e.d)([(0,c.E)()],R.prototype,"checkCollisions",void 0),(0,e.d)([(0,c.E)()],R.prototype,"applyGravity",void 0),(0,v.g)("BABYLON.FreeCamera",R)},14780:(I,g,b)=>{"use strict";b.d(g,{b:()=>z});var e=b(12682),c=b(14783);class z{constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.Yp=[],this._maxBlockCapacity=g||64,this._selectionContent=new e.e(1024),this._creationFunc=I}update(I,g,b){c.d._CreateBlocks(I,g,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}UD(I){for(let g=0;g<this.yD.length;g++){this.yD[g].addEntry(I)}}iD(I){for(let g=0;g<this.yD.length;g++){this.yD[g].removeEntry(I)}}select(I,g){this._selectionContent.reset();for(let b=0;b<this.yD.length;b++){this.yD[b].select(I,this._selectionContent,g)}return g?this._selectionContent.concat(this.Yp):this._selectionContent.concatWithNoDuplicate(this.Yp),this._selectionContent}intersects(I,g,b){this._selectionContent.reset();for(let e=0;e<this.yD.length;e++){this.yD[e].intersects(I,g,this._selectionContent,b)}return b?this._selectionContent.concat(this.Yp):this._selectionContent.concatWithNoDuplicate(this.Yp),this._selectionContent}intersectsRay(I){this._selectionContent.reset();for(let g=0;g<this.yD.length;g++){this.yD[g].intersectsRay(I,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Yp),this._selectionContent}}z.CreationFuncForMeshes=(I,g)=>{const b=I.getBoundingInfo();!I.isBlocked&&b.boundingBox.intersectsMinMax(g.Hp,g.Up)&&g.entries.push(I)},z.CreationFuncForSubMeshes=(I,g)=>{I.getBoundingInfo().boundingBox.intersectsMinMax(g.Hp,g.Up)&&g.entries.push(I)}},14783:(I,g,b)=>{"use strict";b.d(g,{d:()=>z});var e=b(12590),c=b(12925);class z{constructor(I,g,b,e,c,z){this.entries=[],this.hp=new Array,this._capacity=b,this._depth=e,this._maxDepth=c,this._creationFunc=z,this._minPoint=I,this._maxPoint=g,this.hp.push(I.clone()),this.hp.push(g.clone()),this.hp.push(I.clone()),this.hp[2].x=g.x,this.hp.push(I.clone()),this.hp[3].y=g.y,this.hp.push(I.clone()),this.hp[4].z=g.z,this.hp.push(g.clone()),this.hp[5].z=I.z,this.hp.push(g.clone()),this.hp[6].x=I.x,this.hp.push(g.clone()),this.hp[7].y=I.y}get He(){return this._capacity}get Hp(){return this._minPoint}get Up(){return this._maxPoint}addEntry(I){if(this.yD)for(let g=0;g<this.yD.length;g++){this.yD[g].addEntry(I)}else this._creationFunc(I,this),this.entries.length>this.He&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(I){if(this.yD){for(let g=0;g<this.yD.length;g++){this.yD[g].removeEntry(I)}return}const g=this.entries.indexOf(I);g>-1&&this.entries.splice(g,1)}addEntries(I){for(let g=0;g<I.length;g++){const b=I[g];this.addEntry(b)}}select(I,g,b){if(c.d.IsInFrustum(this.hp,I)){if(this.yD){for(let e=0;e<this.yD.length;e++){this.yD[e].select(I,g,b)}return}b?g.concat(this.entries):g.concatWithNoDuplicate(this.entries)}}intersects(I,g,b,e){if(c.d.IntersectsSphere(this._minPoint,this._maxPoint,I,g)){if(this.yD){for(let c=0;c<this.yD.length;c++){this.yD[c].intersects(I,g,b,e)}return}e?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(I,g){if(I.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.yD){for(let b=0;b<this.yD.length;b++){this.yD[b].intersectsRay(I,g)}return}g.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(I,g,b,c,M,J,o,n){o.yD=new Array;const G=new e.Vg((g.x-I.x)/2,(g.y-I.y)/2,(g.z-I.z)/2);for(let e=0;e<2;e++)for(let g=0;g<2;g++)for(let D=0;D<2;D++){const p=I.add(G.multiplyByFloats(e,g,D)),x=I.add(G.multiplyByFloats(e+1,g+1,D+1)),Z=new z(p,x,c,M+1,J,n);Z.addEntries(b),o.yD.push(Z)}}}},14786:(I,g,b)=>{"use strict";b.d(g,{e:()=>G});var e=b(12814),c=b(12590),z=b(13006),M=b(13965),J=b(12849),o=b(14780),n=b(12449);e.c.prototype.createOrUpdateSelectionOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(J.b.NAME_OCTREE);b||(b=new G(this),this.sg(b)),this.sp||(this.sp=new o.b(o.b.CreationFuncForMeshes,I,g));const e=this.getWorldExtends();return this.sp.update(e.min,e.max,this.meshes),this.sp},Object.defineProperty(e.c.prototype,"selectionOctree",{get:function(){return this.sp},enumerable:!0,configurable:!0}),z.e.prototype.createOrUpdateSubmeshesOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.EI();let e=b._getComponent(J.b.NAME_OCTREE);e||(e=new G(b),b.sg(e)),this._submeshesOctree||(this._submeshesOctree=new o.b(o.b.CreationFuncForSubMeshes,I,g)),this.Mb(!0);const c=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(c.minimumWorld,c.maximumWorld,this.Ib),this._submeshesOctree};class G{constructor(I){this.name=J.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new M.d(c.Vg.Zero(),new c.Vg(1,1,1)),(I=I||n.b.LastCreatedScene)&&(this.Xg=I,this.Xg.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Xg.getActiveSubMeshCandidates=I=>this.getActiveSubMeshCandidates(I),this.Xg.getCollidingSubMeshCandidates=(I,g)=>this.getCollidingSubMeshCandidates(I,g),this.Xg.getIntersectingSubMeshCandidates=(I,g)=>this.getIntersectingSubMeshCandidates(I,g))}register(){this.Xg.onMeshRemovedObservable.add((I=>{const g=this.Xg.selectionOctree;if(void 0!==g&&null!==g){const b=g.Yp.indexOf(I);-1!==b&&g.Yp.splice(b,1)}})),this.Xg.onMeshImportedObservable.add((I=>{const g=this.Xg.selectionOctree;void 0!==g&&null!==g&&g.UD(I)}))}getActiveMeshCandidates(){var I;return(null===(I=this.Xg.sp)||void 0===I?void 0:I.select(this.Xg.frustumPlanes))||this.Xg._getDefaultMeshCandidates()}getActiveSubMeshCandidates(I){if(I._submeshesOctree&&I.useOctreeForRenderingSelection){return I._submeshesOctree.select(this.Xg.frustumPlanes)}return this.Xg._getDefaultSubMeshCandidates(I)}getIntersectingSubMeshCandidates(I,g){if(I._submeshesOctree&&I.useOctreeForPicking){M.d.TransformToRef(g,I.getWorldMatrix(),this._tempRay);return I._submeshesOctree.intersectsRay(this._tempRay)}return this.Xg._getDefaultSubMeshCandidates(I)}getCollidingSubMeshCandidates(I,g){if(I._submeshesOctree&&I.useOctreeForCollisions){const b=g._velocityWorldLength+Math.max(g._radius.x,g._radius.y,g._radius.z);return I._submeshesOctree.intersects(g._basePointWorld,b)}return this.Xg._getDefaultSubMeshCandidates(I)}rebuild(){}dispose(){}}},13965:(I,g,b)=>{"use strict";b.d(g,{d:()=>x});var e=b(12814),c=b(13031),z=b(12597),M=b(12590),J=b(12604),o=b(12908),n=b(12842),G=b(12449),D=b(12870);const p={internalPickerForMesh:void 0};class x{constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.b;this.origin=I,this.direction=g,this.length=b,this.epsilon=e}clone(){return new x(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const e=x._TmpVector3[0].Db(I.x-b,I.y-b,I.z-b),c=x._TmpVector3[1].Db(g.x+b,g.y+b,g.z+b);let z,M,J,o,n=0,G=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>c.x)return!1}else if(z=1/this.direction.x,M=(e.x-this.origin.x)*z,J=(c.x-this.origin.x)*z,J===-1/0&&(J=1/0),M>J&&(o=M,M=J,J=o),n=Math.max(M,n),G=Math.min(J,G),n>G)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>c.y)return!1}else if(z=1/this.direction.y,M=(e.y-this.origin.y)*z,J=(c.y-this.origin.y)*z,J===-1/0&&(J=1/0),M>J&&(o=M,M=J,J=o),n=Math.max(M,n),G=Math.min(J,G),n>G)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>c.z)return!1}else if(z=1/this.direction.z,M=(e.z-this.origin.z)*z,J=(c.z-this.origin.z)*z,J===-1/0&&(J=1/0),M>J&&(o=M,M=J,J=o),n=Math.max(M,n),G=Math.min(J,G),n>G)return!1;return!0}intersectsBox(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(I.minimum,I.maximum,g)}intersectsSphere(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=I.center.x-this.origin.x,e=I.center.y-this.origin.y,c=I.center.z-this.origin.z,z=b*b+e*e+c*c,M=I.radius+g,J=M*M;if(z<=J)return!0;const o=b*this.direction.x+e*this.direction.y+c*this.direction.z;if(o<0)return!1;return z-o*o<=J}intersectsTriangle(I,g,b){const e=x._TmpVector3[0],c=x._TmpVector3[1],z=x._TmpVector3[2],J=x._TmpVector3[3],n=x._TmpVector3[4];g.subtractToRef(I,e),b.subtractToRef(I,c),M.Vg.CrossToRef(this.direction,c,z);const G=M.Vg.Dot(e,z);if(0===G)return null;const D=1/G;this.origin.subtractToRef(I,J);const p=M.Vg.Dot(J,z)*D;if(p<-this.epsilon||p>1+this.epsilon)return null;M.Vg.CrossToRef(J,e,n);const Z=M.Vg.Dot(this.direction,n)*D;if(Z<-this.epsilon||p+Z>1+this.epsilon)return null;const k=M.Vg.Dot(c,n)*D;return k>this.length?null:new o.b(1-p-Z,p,k)}intersectsPlane(I){let g;const b=M.Vg.Dot(I.normal,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const e=M.Vg.Dot(I.normal,this.origin);return g=(-I.d-e)/b,g<0?g<-9.99999997475243e-7?null:0:g}}intersectsAxis(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(I){case"y":{const I=(this.origin.y-g)/this.direction.y;return I>0?null:new M.Vg(this.origin.x+this.direction.x*-I,g,this.origin.z+this.direction.z*-I)}case"x":{const I=(this.origin.x-g)/this.direction.x;return I>0?null:new M.Vg(g,this.origin.y+this.direction.y*-I,this.origin.z+this.direction.z*-I)}case"z":{const I=(this.origin.z-g)/this.direction.z;return I>0?null:new M.Vg(this.origin.x+this.direction.x*-I,this.origin.y+this.direction.y*-I,g)}default:return null}}intersectsMesh(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=M.TmpVectors.Matrix[0];return I.getWorldMatrix().invertToRef(J),this._tmpRay?x.TransformToRef(this,J,this._tmpRay):this._tmpRay=x.Transform(this,J),I.intersects(this._tmpRay,g,b,e,c,z)}intersectsMeshes(I,g,b){b?b.length=0:b=[];for(let e=0;e<I.length;e++){const c=this.intersectsMesh(I[e],g);c.hit&&b.push(c)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(I,g){return I.distance<g.distance?-1:I.distance>g.distance?1:0}intersectionSegment(I,g,b){const e=this.origin,c=M.TmpVectors.Vg[0],z=M.TmpVectors.Vg[1],J=M.TmpVectors.Vg[2],o=M.TmpVectors.Vg[3];g.subtractToRef(I,c),this.direction.scaleToRef(x._Rayl,J),e.addToRef(J,z),I.subtractToRef(e,o);const n=M.Vg.Dot(c,c),G=M.Vg.Dot(c,J),D=M.Vg.Dot(J,J),p=M.Vg.Dot(c,o),Z=M.Vg.Dot(J,o),k=n*D-G*G;let S,f,V=k,a=k;k<x._Smallnum?(S=0,V=1,f=Z,a=D):(S=G*Z-D*p,f=n*Z-G*p,S<0?(S=0,f=Z,a=D):S>V&&(S=V,f=Z+G,a=D)),f<0?(f=0,-p<0?S=0:-p>n?S=V:(S=-p,V=n)):f>a&&(f=a,-p+G<0?S=0:-p+G>n?S=V:(S=-p+G,V=n));const v=Math.abs(S)<x._Smallnum?0:S/V,X=Math.abs(f)<x._Smallnum?0:f/a,R=M.TmpVectors.Vg[4];J.scaleToRef(X,R);const E=M.TmpVectors.Vg[5];c.scaleToRef(v,E),E.addInPlace(o);const mI=M.TmpVectors.Vg[6];E.subtractToRef(R,mI);return X>0&&X<=this.length&&mI.lengthSquared()<b*b?E.length():-1}update(I,g,b,e,c,z,J){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){x._RayDistant||(x._RayDistant=x.Zero()),x._RayDistant.unprojectRayToRef(I,g,b,e,M.Matrix.IdentityReadOnly,z,J);const o=M.TmpVectors.Matrix[0];c.invertToRef(o),x.TransformToRef(x._RayDistant,o,this)}else this.unprojectRayToRef(I,g,b,e,c,z,J);return this}static Zero(){return new x(M.Vg.Zero(),M.Vg.Zero())}static CreateNew(I,g,b,e,c,z,M){return x.Zero().update(I,g,b,e,c,z,M)}static CreateNewFromTo(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.Matrix.IdentityReadOnly;const e=new x(new M.Vg(0,0,0),new M.Vg(0,0,0));return x.CreateFromToToRef(I,g,e,b)}static CreateFromToToRef(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.Matrix.IdentityReadOnly;b.origin.G(I);const c=g.subtractToRef(I,b.direction),z=Math.sqrt(c.x*c.x+c.y*c.y+c.z*c.z);return b.length=z,b.direction.normalize(),x.TransformToRef(b,e,b)}static Transform(I,g){const b=new x(new M.Vg(0,0,0),new M.Vg(0,0,0));return x.TransformToRef(I,g,b),b}static TransformToRef(I,g,b){M.Vg.TransformCoordinatesToRef(I.origin,g,b.origin),M.Vg.TransformNormalToRef(I.direction,g,b.direction),b.length=I.length,b.epsilon=I.epsilon;const e=b.direction,c=e.length();if(0!==c&&1!==c){const I=1/c;e.x*=I,e.y*=I,e.z*=I,b.length*=c}return b}unprojectRayToRef(I,g,b,e,c,z,J){const o=M.TmpVectors.Matrix[0];c.multiplyToRef(z,o),o.multiplyToRef(J,o),o.invert();const n=G.b.LastCreatedEngine,D=M.TmpVectors.Vg[0];D.x=I/b*2-1,D.y=-(g/e*2-1),D.z=null!==n&&void 0!==n&&n.Fg?1:null!==n&&void 0!==n&&n.isNDCHalfZRange?0:-1;const p=M.TmpVectors.Vg[1].Db(D.x,D.y,1-1e-8),x=M.TmpVectors.Vg[2],Z=M.TmpVectors.Vg[3];M.Vg._UnprojectFromInvertedMatrixToRef(D,o,x),M.Vg._UnprojectFromInvertedMatrixToRef(p,o,Z),this.origin.G(x),Z.subtractToRef(x,this.direction),this.direction.normalize()}}function Z(I,g,b,e,c){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const M=x.Zero();return k(I,g,b,e,M,c,z),M}function k(I,g,b,e,c,z){let J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const n=I.getEngine();if(!z&&!(z=I.activeCamera))return I;const G=z.viewport,D=n.getRenderHeight(),{x:p,y:x,width:Z,height:k}=G.toGlobal(n.getRenderWidth(),D),S=1/n.getHardwareScalingLevel();return g=g*S-p,b=b*S-(D-x-k),c.update(g,b,Z,k,e||M.Matrix.IdentityReadOnly,J?M.Matrix.IdentityReadOnly:z.getViewMatrix(),z.getProjectionMatrix(),o),I}function S(I,g,b,e,c){if(!n.c)return I;const z=I.getEngine();if(!c&&!(c=I.activeCamera))throw new Error("Active camera not set");const J=c.viewport,o=z.getRenderHeight(),{x:G,y:D,width:p,height:x}=J.toGlobal(z.getRenderWidth(),o),Z=M.Matrix.Identity(),k=1/z.getHardwareScalingLevel();return g=g*k-G,b=b*k-(o-D-x),e.update(g,b,p,x,Z,Z,c.getProjectionMatrix()),I}function f(I,g,b,e,c,z,M,J){const o=g(e,b.enableDistantPicking),n=b.intersects(o,c,M,z,e,J);return n&&n.hit?!c&&null!=I&&n.distance>=I.distance?null:n:null}function V(I,g,b,e,c,z){let J=null;const o=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),G=I.cameraToUseForPointers||I.activeCamera,D=p.internalPickerForMesh||f;for(let n=0;n<I.meshes.length;n++){const p=I.meshes[n];if(b){if(!b(p,-1))continue}else if(!p.isEnabled()||!p.isVisible||!p.fG)continue;const x=o&&p.isWorldMatrixCameraDependent(),Z=p.Mb(x,G);if(p.hasThinInstances&&p.TG){const I=D(J,g,p,Z,!0,!0,z);if(I){if(c)return I;const o=M.TmpVectors.Matrix[1],n=p.thinInstanceGetWorldMatrices();for(let I=0;I<n.length;I++){if(b&&!b(p,I))continue;n[I].multiplyToRef(Z,o);const M=D(J,g,p,o,e,c,z,!0);if(M&&(J=M,J.thinInstanceIndex=I,e))return J}}}else{const I=D(J,g,p,Z,e,c,z);if(I&&(J=I,e))return J}}return J||new n.c}function a(I,g,b,e){if(!n.c)return null;const c=[],z=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),J=I.cameraToUseForPointers||I.activeCamera,o=p.internalPickerForMesh||f;for(let n=0;n<I.meshes.length;n++){const G=I.meshes[n];if(b){if(!b(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.fG)continue;const D=z&&G.isWorldMatrixCameraDependent(),p=G.Mb(D,J);if(G.hasThinInstances&&G.TG){if(o(null,g,G,p,!0,!0,e)){const I=M.TmpVectors.Matrix[1],z=G.thinInstanceGetWorldMatrices();for(let M=0;M<z.length;M++){if(b&&!b(G,M))continue;z[M].multiplyToRef(p,I);const J=o(null,g,G,I,!1,!1,e,!0);J&&(J.thinInstanceIndex=M,c.push(J))}}}else{const I=o(null,g,G,p,!1,!1,e);I&&c.push(I)}}return c}function v(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,e=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;e||(e=I.getWorldMatrix()),g.length=b,c?g.origin.G(c):g.origin.G(I.position);const z=M.TmpVectors.Vg[2];z.set(0,0,I._scene.useRightHandedSystem?-1:1);const J=M.TmpVectors.Vg[3];return M.Vg.TransformNormalToRef(z,e,J),M.Vg.NormalizeToRef(J,g.direction),g}var X,R;x._TmpVector3=(0,J.e)(6,M.Vg.Zero),x._RayDistant=x.Zero(),x._Smallnum=1e-8,x._Rayl=1e9,X=e.c,(R=c.b)&&(R.prototype.getForwardRay=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,g=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return v(this,new x(M.Vg.Zero(),M.Vg.Zero(),I),I,g,b)},R.prototype.getForwardRayToRef=function(I){return v(this,I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),X&&(D.d._IsPickingAvailable=!0,X.prototype.createPickingRay=function(I,g,b,e){return Z(this,I,g,b,e,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),e.c.prototype.createPickingRayToRef=function(I,g,b,e,c){return k(this,I,g,b,e,c,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},e.c.prototype.createPickingRayInCameraSpace=function(I,g,b){return function(I,g,b,e){const c=x.Zero();return S(I,g,b,c,e),c}(this,I,g,b)},e.c.prototype.createPickingRayInCameraSpaceToRef=function(I,g,b,e){return S(this,I,g,b,e)},e.c.prototype.pickWithBoundingInfo=function(I,g,b,e,c){return function(I,g,b,e,c,z){if(!n.c)return null;const J=V(I,(e=>(I._tempPickingRay||(I._tempPickingRay=x.Zero()),k(I,g,b,e,I._tempPickingRay,z||null),I._tempPickingRay)),e,c,!0);return J&&(J.ray=Z(I,g,b,M.Matrix.Identity(),z||null)),J}(this,I,g,b,e,c)},e.c.prototype.Qe=function(I,g,b,e,c,z){return function(I,g,b,e,c,z,J){const o=V(I,((e,c)=>(I._tempPickingRay||(I._tempPickingRay=x.Zero()),k(I,g,b,e,I._tempPickingRay,z||null,!1,c),I._tempPickingRay)),e,c,!1,J);return o&&(o.ray=Z(I,g,b,M.Matrix.Identity(),z||null)),o}(this,I,g,b,e,c,z)},e.c.prototype.pickWithRay=function(I,g,b,e){return function(I,g,b,e,c){const z=V(I,(b=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=M.Matrix.Identity()),b.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=x.Zero()),x.TransformToRef(g,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),b,e,!1,c);return z&&(z.ray=g),z}(this,I,g,b,e)},e.c.prototype.multiPick=function(I,g,b,e,c){return function(I,g,b,e,c,z){return a(I,(e=>Z(I,g,b,e,c||null)),e,z)}(this,I,g,b,e,c)},e.c.prototype.multiPickWithRay=function(I,g,b){return function(I,g,b,e){return a(I,(b=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=M.Matrix.Identity()),b.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=x.Zero()),x.TransformToRef(g,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),b,e)}(this,I,g,b)}},14250:(I,g,b)=>{"use strict";var e=b(12529),c=b(12420),z=b(12456),M=b(12561),J=b(12497),o=b(12544);J.c.prototype._partialLoadFile=function(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(I,(I=>{b[g]=I,b._internalCount++,6===b._internalCount&&e(b)}),void 0,void 0,!0,((I,g)=>{c&&I&&c(I.status+" "+I.statusText,g)}))},J.c.prototype._cascadeLoadFiles=function(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const c=[];c._internalCount=0;for(let z=0;z<6;z++)this._partialLoadFile(b[z],z,c,g,e)},J.c.prototype._cascadeLoadImgs=function(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5?arguments[5]:void 0;const M=[];M._internalCount=0;for(let J=0;J<6;J++)this._partialLoadImg(e[J],J,M,I,g,b,c,z)},J.c.prototype._partialLoadImg=function(I,g,b,e,c,J){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7?arguments[7]:void 0;const G=(0,M.e)();(0,z.u)(I,(I=>{b[g]=I,b._internalCount++,e&&e.removePendingData(G),6===b._internalCount&&J&&J(c,b)}),((I,g)=>{e&&e.removePendingData(G),o&&o(I,g)}),e?e.offlineProvider:null,n),e&&e.addPendingData(G)},J.c.prototype.createCubeTextureBase=function(I,g,b,z){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,f=arguments.length>14&&void 0!==arguments[14]&&arguments[14],V=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const a=Z||new e.e(this,7);a.isCube=!0,a.url=I,a.generateMipMaps=!z,a._lodGenerationScale=p,a._lodGenerationOffset=x,a._useSRGBBuffer=!!f&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!z),a!==Z&&(a.label=I.substring(0,60)),this._doNotHandleContextLost||(a._extension=G,a._files=b,a._buffer=V);const v=I;this._transformTextureUrl&&!Z&&(I=this._transformTextureUrl(I));const X=G??function(I){const g=I.split("?")[0],b=g.lastIndexOf(".");return b>-1?g.substring(b).toLowerCase():""}(I),R=(0,o.b)(X),E=(I,g)=>{a.dispose(),J?J(I,g):I&&c.b.Warn(I)},mI=(e,J)=>{I===v?e&&E(e.status+" "+e.statusText,J):(c.b.Warn(`Failed to load ${I}, falling back to the ${v}`),this.createCubeTextureBase(v,g,b,!!z,M,E,n,G,D,p,x,a,k,S,f,V))};if(R)R.then((e=>{const c=I=>{k&&k(a,I),e.loadCubeData(I,a,D,M,((I,g)=>{E(I,g)}))};V?c(V):b&&6===b.length?e.supportCascades?this._cascadeLoadFiles(g,(I=>c(I.map((I=>new Uint8Array(I))))),b,E):E("Textures type does not support cascades."):this._loadFile(I,(I=>c(new Uint8Array(I))),void 0,void 0,!0,mI)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(g,a,((I,g)=>{S&&S(I,g)}),b,E)}return this._internalTexturesCache.push(a),a}},14788:(I,g,b)=>{"use strict";b(12420);var e=b(12718);b(12529),b(12667),b(12526),b(12758),b(12728);e.c},14278:(I,g,b)=>{"use strict";b.d(g,{d:()=>c});var e=b(12558);class c{constructor(I){this.value=this._toInt(I)}_toInt(I){return 0|I}add(I){return new c(this.value+I.value)}ag(I){return new c(this.value-I.value)}multiply(I){return new c(Math.imul(this.value,I.value))}divide(I){return new c(this.value/I.value)}getClassName(){return c.ClassName}equals(I){return this.value===I.value}static FromValue(I){return new c(I)}toString(){return this.value.toString()}}c.ClassName="FlowGraphInteger",(0,e.g)("FlowGraphInteger",c)},14284:(I,g,b)=>{"use strict";b.d(g,{d:()=>c,e:()=>z});var e=b(12590);class c{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ug=I}get m(){return this.Ug}transformVector(I){return this.transformVectorToRef(I,new e.Vector2)}transformVectorToRef(I,g){return g.x=I.x*this.Ug[0]+I.y*this.Ug[1],g.y=I.x*this.Ug[2]+I.y*this.Ug[3],g}bb(){return this.toArray()}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let g=0;g<4;g++)I[g]=this.Ug[g];return I}Le(I){for(let g=0;g<4;g++)this.Ug[g]=I[g];return this}multiplyToRef(I,g){const b=I.Ug,e=this.Ug,c=g.Ug;return c[0]=b[0]*e[0]+b[1]*e[2],c[1]=b[0]*e[1]+b[1]*e[3],c[2]=b[2]*e[0]+b[3]*e[2],c[3]=b[2]*e[1]+b[3]*e[3],g}multiply(I){return this.multiplyToRef(I,new c)}divideToRef(I,g){const b=this.Ug,e=I.Ug,c=g.Ug;return c[0]=b[0]/e[0],c[1]=b[1]/e[1],c[2]=b[2]/e[2],c[3]=b[3]/e[3],g}divide(I){return this.divideToRef(I,new c)}addToRef(I,g){const b=this.Ug,e=I.m,c=g.m;return c[0]=b[0]+e[0],c[1]=b[1]+e[1],c[2]=b[2]+e[2],c[3]=b[3]+e[3],g}add(I){return this.addToRef(I,new c)}subtractToRef(I,g){const b=this.Ug,e=I.m,c=g.m;return c[0]=b[0]-e[0],c[1]=b[1]-e[1],c[2]=b[2]-e[2],c[3]=b[3]-e[3],g}ag(I){return this.subtractToRef(I,new c)}transpose(){const I=this.Ug;return new c([I[0],I[2],I[1],I[3]])}determinant(){const I=this.Ug;return I[0]*I[3]-I[1]*I[2]}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const g=this.Ug,b=1/I;return new c([g[3]*b,-g[1]*b,-g[2]*b,g[0]*b])}equals(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Ug,e=I.m;return 0===g?b[0]===e[0]&&b[1]===e[1]&&b[2]===e[2]&&b[3]===e[3]:Math.abs(b[0]-e[0])<g&&Math.abs(b[1]-e[1])<g&&Math.abs(b[2]-e[2])<g&&Math.abs(b[3]-e[3])<g}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ug.join(", ")})`}}class z{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ug=I}get m(){return this.Ug}transformVector(I){return this.transformVectorToRef(I,new e.Vg)}transformVectorToRef(I,g){const b=this.Ug;return g.x=I.x*b[0]+I.y*b[1]+I.z*b[2],g.y=I.x*b[3]+I.y*b[4]+I.z*b[5],g.z=I.x*b[6]+I.y*b[7]+I.z*b[8],g}multiplyToRef(I,g){const b=I.Ug,e=this.Ug,c=g.m;return c[0]=b[0]*e[0]+b[1]*e[3]+b[2]*e[6],c[1]=b[0]*e[1]+b[1]*e[4]+b[2]*e[7],c[2]=b[0]*e[2]+b[1]*e[5]+b[2]*e[8],c[3]=b[3]*e[0]+b[4]*e[3]+b[5]*e[6],c[4]=b[3]*e[1]+b[4]*e[4]+b[5]*e[7],c[5]=b[3]*e[2]+b[4]*e[5]+b[5]*e[8],c[6]=b[6]*e[0]+b[7]*e[3]+b[8]*e[6],c[7]=b[6]*e[1]+b[7]*e[4]+b[8]*e[7],c[8]=b[6]*e[2]+b[7]*e[5]+b[8]*e[8],g}multiply(I){return this.multiplyToRef(I,new z)}divideToRef(I,g){const b=this.Ug,e=I.m,c=g.m;return c[0]=b[0]/e[0],c[1]=b[1]/e[1],c[2]=b[2]/e[2],c[3]=b[3]/e[3],c[4]=b[4]/e[4],c[5]=b[5]/e[5],c[6]=b[6]/e[6],c[7]=b[7]/e[7],c[8]=b[8]/e[8],g}divide(I){return this.divideToRef(I,new z)}addToRef(I,g){const b=this.Ug,e=I.m,c=g.m;return c[0]=b[0]+e[0],c[1]=b[1]+e[1],c[2]=b[2]+e[2],c[3]=b[3]+e[3],c[4]=b[4]+e[4],c[5]=b[5]+e[5],c[6]=b[6]+e[6],c[7]=b[7]+e[7],c[8]=b[8]+e[8],g}add(I){return this.addToRef(I,new z)}subtractToRef(I,g){const b=this.Ug,e=I.m,c=g.m;return c[0]=b[0]-e[0],c[1]=b[1]-e[1],c[2]=b[2]-e[2],c[3]=b[3]-e[3],c[4]=b[4]-e[4],c[5]=b[5]-e[5],c[6]=b[6]-e[6],c[7]=b[7]-e[7],c[8]=b[8]-e[8],g}ag(I){return this.subtractToRef(I,new z)}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let g=0;g<9;g++)I[g]=this.Ug[g];return I}bb(){return this.toArray()}Le(I){for(let g=0;g<9;g++)this.Ug[g]=I[g];return this}transpose(){const I=this.Ug;return new z([I[0],I[3],I[6],I[1],I[4],I[7],I[2],I[5],I[8]])}determinant(){const I=this.Ug;return I[0]*(I[4]*I[8]-I[5]*I[7])-I[1]*(I[3]*I[8]-I[5]*I[6])+I[2]*(I[3]*I[7]-I[4]*I[6])}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const g=this.Ug,b=1/I;return new z([(g[4]*g[8]-g[5]*g[7])*b,(g[2]*g[7]-g[1]*g[8])*b,(g[1]*g[5]-g[2]*g[4])*b,(g[5]*g[6]-g[3]*g[8])*b,(g[0]*g[8]-g[2]*g[6])*b,(g[2]*g[3]-g[0]*g[5])*b,(g[3]*g[7]-g[4]*g[6])*b,(g[1]*g[6]-g[0]*g[7])*b,(g[0]*g[4]-g[1]*g[3])*b])}equals(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.Ug,e=I.m;return 0===g?b[0]===e[0]&&b[1]===e[1]&&b[2]===e[2]&&b[3]===e[3]&&b[4]===e[4]&&b[5]===e[5]&&b[6]===e[6]&&b[7]===e[7]&&b[8]===e[8]:Math.abs(b[0]-e[0])<g&&Math.abs(b[1]-e[1])<g&&Math.abs(b[2]-e[2])<g&&Math.abs(b[3]-e[3])<g&&Math.abs(b[4]-e[4])<g&&Math.abs(b[5]-e[5])<g&&Math.abs(b[6]-e[6])<g&&Math.abs(b[7]-e[7])<g&&Math.abs(b[8]-e[8])<g}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ug.join(", ")})`}}},14287:(I,g,b)=>{"use strict";var e;function c(I,g,b,e){switch(g){case"Animation":return e?I.animations.find((I=>I.uniqueId===b))??null:I.animations[b]??null;case"AnimationGroup":return e?I.animationGroups.find((I=>I.uniqueId===b))??null:I.animationGroups[b]??null;case"Mesh":return e?I.meshes.find((I=>I.uniqueId===b))??null:I.meshes[b]??null;case"Material":return e?I.materials.find((I=>I.uniqueId===b))??null:I.materials[b]??null;case"BD":return e?I.cameras.find((I=>I.uniqueId===b))??null:I.cameras[b]??null;case"Light":return e?I.lights.find((I=>I.uniqueId===b))??null:I.lights[b]??null;default:return null}}b.d(g,{b:()=>c}),function(I){I.Animation="Animation",I.AnimationGroup="AnimationGroup",I.Mesh="Mesh",I.Material="Material",I.BD="BD",I.Light="Light"}(e||(e={}))},14311:(I,g,b)=>{"use strict";b.d(g,{c:()=>c});var e=b(14320);class c extends e.c{constructor(I,g){if(super(I),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),g)for(const b of g)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(I){}_startPendingTasks(I){I._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(I),this._resetAfterCanceled(I)),this._preparePendingTasks(I),I._addPendingBlock(this),this.out._activateSignal(I),I._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(I){I._deleteExecutionVariable(this,"_initialized"),I._removePendingBlock(this)}}},14295:(I,g,b)=>{"use strict";b.d(g,{d:()=>n});var e=b(12561),c=b(12558),z=b(14298),M=b(12412),J=b(14269);class o extends z.c{constructor(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.defaultValue,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(I,g,b),this.richType=e,this._defaultValue=c,this._optional=z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new M.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(I){this._isDisabled!==I&&(this._isDisabled=I,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(I,g){g._getConnectionValue(this)!==I&&(g._setConnectionValue(this,I),this.onValueChangedObservable.notifyObservers(I))}resetToDefaultValue(I){I._setConnectionValue(this,this._defaultValue)}connectTo(I){this._isDisabled||super.connectTo(I)}_getValueOrDefault(I){const g=I._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(g):g}getValue(I){if(1===this.connectionType){I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(I);const g=this._getValueOrDefault(I);return this._lastValue=g,this.richType.typeTransformer?this.richType.typeTransformer(g):g}const g=this.isConnected()?this._connectedPoint[0].getValue(I):this._getValueOrDefault(I);return this._lastValue=g,this.richType.typeTransformer?this.richType.typeTransformer(g):g}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.richType={},this.richType.serialize(I.richType),I.optional=this._optional,(0,J.h)("defaultValue",this._defaultValue,I)}}(0,c.g)("FlowGraphDataConnection",o);class n{constructor(I){var g;this.config=I,this.uniqueId=(0,e.e)(),this.name=(null===(g=this.config)||void 0===g?void 0:g.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(I){}registerDataInput(I,g,b){const e=new o(I,0,this,g,b);return this.dataInputs.push(e),e}registerDataOutput(I,g,b){const e=new o(I,1,this,g,b);return this.dataOutputs.push(e),e}getDataInput(I){return this.dataInputs.find((g=>g.name===I))}getDataOutput(I){return this.dataOutputs.find((g=>g.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.h;if(I.uniqueId=this.uniqueId,I.config={},this.config){const b=this.config,e=Object.keys(b);for(const c of e)g(c,b[c],I.config)}I.dataInputs=[],I.dataOutputs=[],I.className=this.getClassName();for(const b of this.dataInputs){const g={};b.serialize(g),I.dataInputs.push(g)}for(const b of this.dataOutputs){const g={};b.serialize(g),I.dataOutputs.push(g)}}deserialize(I){}_log(I,g,b){var e;null===(e=I.logger)||void 0===e||e.addLogItem({action:g,Ne:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14298:(I,g,b)=>{"use strict";b.d(g,{c:()=>z});var e,c=b(12561);!function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(e||(e={}));class z{constructor(I,g,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,c.e)(),this.connectedPointIds=[],this.name=I,this._connectionType=g}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(I){if(this._connectionType===I._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||I._isSingularConnection()&&I._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(I),I._connectedPoint.push(this)}disconnectFrom(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(I),e=I._connectedPoint.indexOf(this);-1!==b&&-1!==e&&(g&&this._connectedPoint.splice(b,1),I._connectedPoint.splice(e,1))}disconnectFromAll(){for(const I of this._connectedPoint)this.disconnectFrom(I,!1);this._connectedPoint.length=0}dispose(){for(const I of this._connectedPoint)this.disconnectFrom(I)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.uniqueId=this.uniqueId,I.name=this.name,I._connectionType=this._connectionType,I.connectedPointIds=[],I.className=this.getClassName();for(const g of this._connectedPoint)I.connectedPointIds.push(g.uniqueId)}getClassName(){return"FGConnection"}deserialize(I){this.uniqueId=I.uniqueId,this.name=I.name,this._connectionType=I._connectionType,this.connectedPointIds=I.connectedPointIds}}},14267:(I,g,b)=>{"use strict";b.d(g,{c:()=>a});var e,c=b(12412),z=b(12577),M=b(12584),J=b(12561),o=b(14269),n=b(14287),G=b(12420);!function(I){I.ExecuteBlock="ExecuteBlock",I.ExecuteEvent="ExecuteEvent",I.TriggerConnection="TriggerConnection",I.ContextVariableSet="ContextVariableSet",I.GlobalVariableSet="GlobalVariableSet",I.GlobalVariableDelete="GlobalVariableDelete",I.GlobalVariableGet="GlobalVariableGet",I.AddConnection="AddConnection",I.GetConnectionValue="GetConnectionValue",I.SetConnectionValue="SetConnectionValue",I.ActivateSignal="ActivateSignal",I.ContextVariableGet="ContextVariableGet"}(e||(e={}));class D{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(I){if(I.time||(I.time=Date.now()),this.log.push(I),this.logToConsole){var g;const b=null===(g=I.Ne)||void 0===g?void 0:g.value;"object"===typeof b&&b.getClassName?G.b.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):G.b.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(I.Ne)}`)}}getItemsOfType(I){return this.log.filter((g=>g.action===I))}}class p{get enableLogging(){return this._enableLogging}set enableLogging(I){this._enableLogging!==I&&(this._enableLogging=I,this._enableLogging?(this.logger=new D,this.logger.logToConsole=!0):this.logger=null)}constructor(I){this.uniqueId=(0,J.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new c.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=I,this.assetsContext=I.assetsContext??I.Xg}hasVariable(I){return I in this._userVariables}setVariable(I,g){var b;this._userVariables[I]=g,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Ne:{name:I,value:g}})}getAsset(I,g){return(0,n.b)(this.assetsContext,I,g)}getVariable(I){var g;return null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Ne:{name:I,value:this._userVariables[I]}}),this._userVariables[I]}get userVariables(){return this._userVariables}EI(){return this._configuration.Xg}_getUniqueIdPrefixedName(I,g){return`${I.uniqueId}_${g}`}_getGlobalContextVariable(I,g){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Ne:{name:I,defaultValue:g,possibleValue:this._globalContextVariables[I]}}),this._hasGlobalContextVariable(I)?this._globalContextVariables[I]:g}_setGlobalContextVariable(I,g){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Ne:{name:I,value:g}}),this._globalContextVariables[I]=g}_deleteGlobalContextVariable(I){var g;null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Ne:{name:I}}),delete this._globalContextVariables[I]}_hasGlobalContextVariable(I){return I in this._globalContextVariables}_setExecutionVariable(I,g,b){this._executionVariables[this._getUniqueIdPrefixedName(I,g)]=b}_getExecutionVariable(I,g,b){return this._hasExecutionVariable(I,g)?this._executionVariables[this._getUniqueIdPrefixedName(I,g)]:b}_deleteExecutionVariable(I,g){delete this._executionVariables[this._getUniqueIdPrefixedName(I,g)]}_hasExecutionVariable(I,g){return this._getUniqueIdPrefixedName(I,g)in this._executionVariables}_hasConnectionValue(I){return I.uniqueId in this._connectionValues}_setConnectionValue(I,g){var b;this._connectionValues[I.uniqueId]=g,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Ne:{connectionPointId:I.uniqueId,value:g}})}_setConnectionValueByKey(I,g){this._connectionValues[I]=g}_getConnectionValue(I){var g;return null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Ne:{connectionPointId:I.uniqueId,value:this._connectionValues[I.uniqueId]}}),this._connectionValues[I.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(I){this._pendingBlocks.includes(I)||(this._pendingBlocks.push(I),this._pendingBlocks.sort(((I,g)=>I.priority-g.priority)))}_removePendingBlock(I){const g=this._pendingBlocks.indexOf(I);-1!==g&&this._pendingBlocks.splice(g,1)}_clearPendingBlocks(){for(const I of this._pendingBlocks)I._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(I){var g;this.onNodeExecutedObservable.notifyObservers(I),null===(g=this.logger)||void 0===g||g.addLogItem({time:Date.now(),className:I.getClassName(),uniqueId:I.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(I){this._setGlobalContextVariable("timeSinceStart",I.timeSinceStart),this._setGlobalContextVariable("deltaTime",I.deltaTime);for(const b of this._pendingBlocks){var g;null===(g=b._executeOnTick)||void 0===g||g.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.h;I.uniqueId=this.uniqueId,I._userVariables={};for(const e in this._userVariables)g(e,this._userVariables[e],I._userVariables);I._connectionValues={};for(const e in this._connectionValues)g(e,this._connectionValues[e],I._connectionValues);var b;this.assetsContext!==this.EI()&&(I._assetsContext={meshes:this.assetsContext.meshes.map((I=>I.id)),materials:this.assetsContext.materials.map((I=>I.id)),textures:this.assetsContext.textures.map((I=>I.name)),animations:this.assetsContext.animations.map((I=>I.name)),lights:this.assetsContext.lights.map((I=>I.id)),cameras:this.assetsContext.cameras.map((I=>I.id)),fZ:null===(b=this.assetsContext.fZ)||void 0===b?void 0:b.map((I=>I.name)),skeletons:this.assetsContext.skeletons.map((I=>I.id)),Ax:this.assetsContext.Ax.map((I=>I.name)),geometries:this.assetsContext.geometries.map((I=>I.id)),multiMaterials:this.assetsContext.multiMaterials.map((I=>I.id)),transformNodes:this.assetsContext.transformNodes.map((I=>I.id))})}getClassName(){return"FlowGraphContext"}}(0,z.d)([(0,M.E)()],p.prototype,"uniqueId",void 0);var x=b(14291),Z=b(12854);class k{constructor(I){this.onEventTriggeredObservable=new c.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=I,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Og.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const I=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Ne:{timeSinceStart:this._startingTime,deltaTime:I}}),this._startingTime+=I})),this._meshPickedObserver=this._scene.onPointerObservable.add((I=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Ne:I})}),Z.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((I=>{const g=I.pointerId,b=I.mesh,e=this._pointerUnderMeshState[g];!e&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ne:{pointerId:g,mesh:b}}):e&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ne:{pointerId:g,mesh:e}}):e&&b&&e!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Ne:{pointerId:g,mesh:e,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Ne:{pointerId:g,mesh:b,out:e}})),this._pointerUnderMeshState[g]=b}),Z.e.POINTERMOVE)}dispose(){var I,g,b,e,c;null===(I=this._sceneDisposeObserver)||void 0===I||I.remove(),null===(g=this._sceneReadyObserver)||void 0===g||g.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(e=this._meshPickedObserver)||void 0===e||e.remove(),null===(c=this._meshUnderPointerObserver)||void 0===c||c.remove(),this.onEventTriggeredObservable.clear()}}var S,f=b(14302);!function(I){I[I.Stopped=0]="Stopped",I[I.Started=1]="Started"}(S||(S={}));class V{get state(){return this._state}set state(I){this._state=I,this.onStateChangedObservable.notifyObservers(I)}constructor(I){this.onStateChangedObservable=new c.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=I.Xg,this._sceneEventCoordinator=new k(this._scene),this._coordinator=I.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((I=>{for(const g of this._executionContexts){const b=this._getContextualOrder(I.type,g);for(const e of b)if(!e._executeEvent(g,I.Ne))break}switch(I.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const g of this._executionContexts)g._notifyOnTick(I.Ne);break;case"SceneDispose":this.dispose()}}))}createContext(){const I=new p({Xg:this._scene,coordinator:this._coordinator});return this._executionContexts.push(I),I}getContext(I){return this._executionContexts[I]}addEventBlock(I){if("PointerOver"!==I.type&&"PointerOut"!==I.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==I.type&&this._eventBlocks[I.type].push(I),1===this.state)for(const g of this._executionContexts)I._startPendingTasks(g);else this.onStateChangedObservable.addOnce((g=>{if(1===g)for(const b of this._executionContexts)I._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((I=>{1===I&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const I of this._executionContexts)for(const g in this._eventBlocks){const b=this._getContextualOrder(g,I);for(const g of b)g._startPendingTasks(I)}}_getContextualOrder(I,g){const b=this._eventBlocks[I].sort(((I,g)=>g.initPriority-I.initPriority));if("MeshPick"===I){const I=[];for(const e of b){const c=e.asset.getValue(g);let z=0;for(;z<b.length;z++){const I=b[z].asset.getValue(g);if(c&&I&&(0,f.l)(c,I))break}I.splice(z,0,e)}return I}return b}dispose(){var I;if(0!==this.state){this.state=0;for(const I of this._executionContexts)I._clearPendingBlocks();this._executionContexts.length=0;for(const I in this._eventBlocks)this._eventBlocks[I].length=0;null===(I=this._eventObserver)||void 0===I||I.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(I){const g=[],b=new Set;for(const e in this._eventBlocks)for(const I of this._eventBlocks[e])g.push(I),b.add(I.uniqueId);for(;g.length>0;){const e=g.pop();I(e);for(const I of e.dataInputs)for(const e of I._connectedPoint)b.has(e._ownerBlock.uniqueId)||(g.push(e._ownerBlock),b.add(e._ownerBlock.uniqueId));if(e instanceof x.e)for(const I of e.signalOutputs)for(const e of I._connectedPoint)b.has(e._ownerBlock.uniqueId)||(g.push(e._ownerBlock),b.add(e._ownerBlock.uniqueId))}}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},g=arguments.length>1?arguments[1]:void 0;I.allBlocks=[],this.visitAllBlocks((g=>{const b={};g.serialize(b),I.allBlocks.push(b)})),I.executionContexts=[];for(const b of this._executionContexts){const e={};b.serialize(e,g),I.executionContexts.push(e)}}}class a{constructor(I){this.config=I,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Xg.Og.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Xg.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const I=this._executeOnNextFrame.slice(0);if(I.length)for(const g of I){this.notifyCustomEvent(g.id,g.data,!1);const I=this._executeOnNextFrame.findIndex((I=>I.uniqueId===g.uniqueId));-1!==I&&this._executeOnNextFrame.splice(I,1)}}));(a.SceneCoordinators.get(this.config.Xg)??[]).push(this)}createGraph(){const I=new V({Xg:this.config.Xg,coordinator:this});return this._flowGraphs.push(I),I}removeGraph(I){const g=this._flowGraphs.indexOf(I);-1!==g&&(I.dispose(),this._flowGraphs.splice(g,1))}start(){for(const I of this._flowGraphs)I.start()}dispose(){var I,g;for(const c of this._flowGraphs)c.dispose();this._flowGraphs.length=0,null===(I=this._disposeObserver)||void 0===I||I.remove(),null===(g=this._onBeforeRenderObserver)||void 0===g||g.remove();const b=a.SceneCoordinators.get(this.config.Xg)??[],e=b.indexOf(this);-1!==e&&b.splice(e,1)}serialize(I,g){I._flowGraphs=[];for(const b of this._flowGraphs){const e={};b.serialize(e,g),I._flowGraphs.push(e)}I.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(I){let g=this._customEventsMap.get(I);return g||(g=new c.c,this._customEventsMap.set(I,g)),g}notifyCustomEvent(I,g){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:I,data:g,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(I)){const g=this._eventExecutionCounter.get(I);if(this._eventExecutionCounter.set(I,g+1),g>=a.MaxEventTypeExecutionPerFrame)return void(g===a.MaxEventTypeExecutionPerFrame&&G.b.Warn(`FlowGraphCoordinator: Too many executions of event "${I}".`))}else this._eventExecutionCounter.set(I,1);const b=this._customEventsMap.get(I);b&&b.notifyObservers(g)}}a.MaxEventsPerType=30,a.MaxEventTypeExecutionPerFrame=30,a.SceneCoordinators=new Map},14306:(I,g,b)=>{"use strict";b.d(g,{d:()=>c});var e=b(14311);class c extends e.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(I){I._notifyExecuteNode(this),this.done._activateSignal(I)}}},14291:(I,g,b)=>{"use strict";b.d(g,{e:()=>J});var e=b(14295),c=b(14298),z=b(12558);class M extends c.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(I){super.connectTo(I),this._connectedPoint.sort(((I,g)=>g.priority-I.priority))}_activateSignal(I){var g;if(null===(g=I.logger)||void 0===g||g.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Ne:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(I,this),I._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(I)}}(0,z.g)("FlowGraphSignalConnection",M);class J extends e.d{constructor(I){super(I),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(I){const g=new M(I,0,this);return this.signalInputs.push(g),g}_registerSignalOutput(I){const g=new M(I,1,this);return this.signalOutputs.push(g),g}_unregisterSignalInput(I){const g=this.signalInputs.findIndex((g=>g.name===I));-1!==g&&(this.signalInputs[g].dispose(),this.signalInputs.splice(g,1))}_unregisterSignalOutput(I){const g=this.signalOutputs.findIndex((g=>g.name===I));-1!==g&&(this.signalOutputs[g].dispose(),this.signalOutputs.splice(g,1))}_reportError(I,g){this.error.Ne="string"===typeof g?new Error(g):g,this.error._activateSignal(I)}getSignalInput(I){return this.signalInputs.find((g=>g.name===I))}getSignalOutput(I){return this.signalOutputs.find((g=>g.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.signalInputs=[],I.signalOutputs=[];for(const g of this.signalInputs){const b={};g.serialize(b),I.signalInputs.push(b)}for(const g of this.signalOutputs){const b={};g.serialize(b),I.signalOutputs.push(b)}}deserialize(I){for(let g=0;g<I.signalInputs.length;g++){const b=this.getSignalInput(I.signalInputs[g].name);if(!b)throw new Error("Could not find signal input with name "+I.signalInputs[g].name+" in block "+I.className);b.deserialize(I.signalInputs[g])}for(let g=0;g<I.signalOutputs.length;g++){const b=this.getSignalOutput(I.signalOutputs[g].name);if(!b)throw new Error("Could not find signal output with name "+I.signalOutputs[g].name+" in block "+I.className);b.deserialize(I.signalOutputs[g])}}getClassName(){return"FlowGraphExecutionBlock"}}},14320:(I,g,b)=>{"use strict";b.d(g,{c:()=>c});var e=b(14291);class c extends e.e{constructor(I){super(I),this.out=this._registerSignalOutput("out")}}},14282:(I,g,b)=>{"use strict";b.d(g,{A:()=>x,C:()=>Z,D:()=>k,E:()=>s,G:()=>F,I:()=>mI,K:()=>E,c:()=>n,g:()=>p,h:()=>R,l:()=>S,p:()=>f,q:()=>V,t:()=>D,u:()=>X,y:()=>G});var e,c=b(12590),z=b(12637),M=b(14278),J=b(14284);!function(I){I.Any="any",I.String="string",I.Number="number",I.Boolean="boolean",I.Object="object",I.Integer="FlowGraphInteger",I.Vector2="Vector2",I.Vg="Vg",I.Vector4="Vector4",I.Quaternion="Quaternion",I.Matrix="Matrix",I.Matrix2D="Matrix2D",I.Matrix3D="Matrix3D",I.Eg="Eg",I.Sb="Sb"}(e||(e={}));class o{constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=I,this.defaultValue=g,this.animationType=b}serialize(I){I.typeName=this.typeName,I.defaultValue=this.defaultValue}}const n=new o("any",void 0),G=new o("string",""),D=new o("number",0,0),p=new o("boolean",!1),x=new o("Vector2",c.Vector2.Zero(),5),Z=new o("Vg",c.Vg.Zero(),1),k=new o("Vector4",c.Vector4.Zero()),S=new o("Matrix",c.Matrix.Identity(),3),f=new o("Matrix2D",new J.d),V=new o("Matrix3D",new J.e),a=new o("Eg",z.Eg.Black(),4),v=new o("Sb",new z.Sb(0,0,0,0),7),X=new o("Quaternion",c.Quaternion.Identity(),2);X.typeTransformer=I=>{if(I.getClassName){if("Vector4"===I.getClassName())return c.Quaternion.mb(I.bb());if("Vg"===I.getClassName())return c.Quaternion.FromEulerVector(I);if("Matrix"===I.getClassName())return c.Quaternion.FromRotationMatrix(I)}return I};const R=new o("FlowGraphInteger",new M.d(0),0);function E(I){const g=I;switch(typeof I){case"string":return G;case"number":return D;case"boolean":return p;case"object":if(g.getClassName)switch(g.getClassName()){case"Vector2":return x;case"Vg":return Z;case"Vector4":return k;case"Matrix":return S;case"Eg":return a;case"Sb":return v;case"Quaternion":return X;case"FlowGraphInteger":return R;case"Matrix2D":return f;case"Matrix3D":return V}return n;default:return n}}function mI(I){switch(I){case"string":return G;case"number":return D;case"boolean":return p;case"Vector2":return x;case"Vg":return Z;case"Vector4":return k;case"Matrix":return S;case"Eg":return a;case"Sb":return v;case"Quaternion":return X;case"FlowGraphInteger":return R;case"Matrix2D":return f;case"Matrix3D":return V;default:return n}}function s(I){switch(I){case"number":default:return 0;case"Vector2":return 5;case"Vg":return 1;case"Matrix":return 3;case"Eg":return 4;case"Sb":return 7;case"Quaternion":return 2}}function F(I){switch(I){case 0:return D;case 5:return x;case 1:return Z;case 3:return S;case 4:return a;case 7:return v;case 2:return X;default:return n}}},14269:(I,g,b)=>{"use strict";b.d(g,{e:()=>G,h:()=>n,i:()=>D});var e=b(12637),c=b(12590),z=b(14278),M=b(14282),J=b(14284);function o(I){return"Vector2"===I||"Vg"===I||"Vector4"===I||"Quaternion"===I||"Eg"===I||"Sb"===I}function n(I,g,b){var e;const c=(null===g||void 0===g||null===(e=g.getClassName)||void 0===e?void 0:e.call(g))??"";if(o(c)||function(I){return"Matrix"===I||"Matrix2D"===I||"Matrix3D"===I}(c))b[I]={value:g.bb(),className:c};else if("FlowGraphInteger"===c)b[I]={value:g.value,className:c};else if(c&&(g.id||g.name))b[I]={id:g.id,name:g.name,className:c};else{if("object"===typeof g)throw new Error(`Could not serialize value ${g}`);b[I]=g}}function G(I,g,b,n){const D=g[I];let p;const x=(null===D||void 0===D?void 0:D.type)??(null===D||void 0===D?void 0:D.className);if(function(I){return"Mesh"===I||"AbstractMesh"===I||"GroundMesh"===I||"InstanceMesh"===I||"LinesMesh"===I||"GoldbergMesh"===I||"GreasedLineMesh"===I||"TrailMesh"===I}(x)){let I=n.meshes.filter((I=>D.id?I.id===D.id:I.name===D.name));0===I.length&&(I=n.transformNodes.filter((I=>D.id?I.id===D.id:I.name===D.name))),p=D.uniqueId?I.find((I=>I.uniqueId===D.uniqueId)):I[0]}else if(o(x))p=function(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===I)return c.Vector2.mb(g);if("Vg"===I)return b&&(g[2]*=-1),c.Vg.mb(g);if("Vector4"===I)return c.Vector4.mb(g);if("Quaternion"===I)return b&&(g[2]*=-1,g[3]*=-1),c.Quaternion.mb(g);if("Eg"===I)return new e.Eg(g[0],g[1],g[2]);if("Sb"===I)return new e.Sb(g[0],g[1],g[2],g[3]);throw new Error(`Unknown vector class name ${I}`)}(x,D.value);else if(function(I){return"AnimationGroup"===I}(x)){const I=n.animationGroups.filter((I=>I.name===D.name));p=1===I.length?I[0]:I.find((I=>I.uniqueId===D.uniqueId))}else p="Matrix"===x?c.Matrix.mb(D.value):"Matrix2D"===x?new J.d(D.value):"Matrix3D"===x?new J.e(D.value):"FlowGraphInteger"===x?z.d.FromValue(D.value):"number"===x||"string"===x||"boolean"===x?D.value[0]:D&&void 0!==D.value?D.value:Array.isArray(D)?D.reduce(((I,g)=>g.eventData?(I[g.id]={type:(0,M.I)(g.type)},"undefined"!==typeof g.value&&(I[g.id].value=G("value",g,b,n)),I):I),{}):D;return p}function D(I){return"FlowGraphJsonPointerParserBlock"===I}},14302:(I,g,b)=>{"use strict";function e(I,g){return!(!I.parent||I.parent!==g&&!e(I.parent,g))}function c(I){if(I.getClassName)return I.getClassName()}function z(I,g){return I===g&&("Vector2"===I||"Vg"===I||"Vector4"===I||"Quaternion"===I)}function M(I,g){return I===g&&("Matrix"===I||"Matrix2D"===I||"Matrix3D"===I)}function J(I,g){return"FlowGraphInteger"===I&&"FlowGraphInteger"===g}function o(I,g){const b="number"===typeof I||"number"===typeof(null===I||void 0===I?void 0:I.value);return b&&!g?!isNaN(n(I)):b}function n(I){return"number"===typeof I?I:I.value}b.d(g,{b:()=>J,e:()=>M,f:()=>z,j:()=>c,l:()=>e,p:()=>n,q:()=>o})},13693:(I,g,b)=>{"use strict";b.r(g),b.d(g,{SceneInstrumentation:()=>z});var e=b(12409),c=b(12794);class z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(I){I!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=I,I?(this._onBeforeActiveMeshesEvaluationObserver=this.Xg.onBeforeActiveMeshesEvaluationObservable.add((()=>{e.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Xg.onAfterActiveMeshesEvaluationObservable.add((()=>{e.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Xg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(I){I!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=I,I?(this._onBeforeRenderTargetsRenderObserver=this.Xg.onBeforeRenderTargetsRenderObservable.add((()=>{e.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Xg.onAfterRenderTargetsRenderObservable.add((()=>{e.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Xg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(I){I!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=I,I?(this._onBeforeParticlesRenderingObserver=this.Xg.onBeforeParticlesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Xg.onAfterParticlesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Xg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(I){I!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=I,this.Xg.spriteManagers&&(I?(this._onBeforeSpritesRenderingObserver=this.Xg.onBeforeSpritesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Xg.onAfterSpritesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Xg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Xg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(I){I!==this._capturePhysicsTime&&this.Xg.onBeforePhysicsObservable&&(this._capturePhysicsTime=I,I?(this._onBeforePhysicsObserver=this.Xg.onBeforePhysicsObservable.add((()=>{e.Tools.StartPerformanceCounter("Yb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Xg.onAfterPhysicsObservable.add((()=>{e.Tools.EndPerformanceCounter("Yb"),this._physicsTime.endMonitoring()}))):(this.Xg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Xg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(I){I!==this._captureAnimationsTime&&(this._captureAnimationsTime=I,I?this._onAfterAnimationsObserver=this.Xg.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Xg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(I){this._captureFrameTime=I}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(I){this._captureInterFrameTime=I}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(I){I!==this._captureRenderTime&&(this._captureRenderTime=I,I?(this._onBeforeDrawPhaseObserver=this.Xg.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Xg.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Main render")}))):(this.Xg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(I){I!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=I,I?(this._onBeforeCameraRenderObserver=this.Xg.onBeforeCameraRenderObservable.add((I=>{this._cameraRenderTime.beginMonitoring(),e.Tools.StartPerformanceCounter(`Rendering camera ${I.name}`)})),this._onAfterCameraRenderObserver=this.Xg.onAfterCameraRenderObservable.add((I=>{this._cameraRenderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter(`Rendering camera ${I.name}`)}))):(this.Xg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Xg.getEngine()._drawCalls}constructor(I){this.Xg=I,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new c.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new c.d,this._captureFrameTime=!1,this._frameTime=new c.d,this._captureRenderTime=!1,this._renderTime=new c.d,this._captureInterFrameTime=!1,this._interFrameTime=new c.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new c.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new c.d,this._capturePhysicsTime=!1,this._physicsTime=new c.d,this._captureAnimationsTime=!1,this._animationsTime=new c.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new c.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=I.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(e.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Xg.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=I.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(e.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Cg(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Cg(),this._captureParticlesRenderTime&&this._particlesRenderTime.Cg(),this._captureSpritesRenderTime&&this._spritesRenderTime.Cg(),this._captureRenderTime&&this._renderTime.Cg(),this._captureCameraRenderTime&&this._cameraRenderTime.Cg()}))}dispose(){this._disposed||(this.Xg.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Xg.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Xg.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Xg.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Xg.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Xg.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Xg.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Xg.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Xg.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Xg.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Xg.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Xg.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Xg.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Xg.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Xg.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Xg.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Xg.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Xg=null,this._disposed=!0)}}},14261:(I,g,b)=>{"use strict";b.d(g,{e:()=>G});var e=b(12577),c=b(12584),z=b(12590),M=b(13002),J=b(13114),o=b(13161),n=b(12558);M.b.AddNodeConstructor("Light_Type_1",((I,g)=>()=>new G(I,z.Vg.Zero(),g)));class G extends o.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(I){this._shadowFrustumSize=I,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(I){this._shadowOrthoScale=I,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(I){this._orthoLeft=I}get orthoRight(){return this._orthoRight}set orthoRight(I){this._orthoRight=I}get orthoTop(){return this._orthoTop}set orthoTop(I){this._orthoTop=I}get orthoBottom(){return this._orthoBottom}set orthoBottom(I){this._orthoBottom=I}constructor(I,g,b){super(I,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=g.scale(-1),this.direction=g}getClassName(){return"Cb"}getTypeID(){return J.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(I,g,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(I):this._setDefaultAutoExtendShadowProjectionMatrix(I,g,b)}_setDefaultFixedFrustumShadowProjectionMatrix(I){const g=this.EI().activeCamera;g&&z.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:g.cb,void 0!==this.shadowMaxZ?this.shadowMaxZ:g.maxZ,I,this.EI().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(I,g,b){const e=this.EI().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const I=z.Vg.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let e=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(let M=0;M<b.length;M++){const J=b[M];if(!J)continue;const o=J.getBoundingInfo().boundingBox;for(let b=0;b<o.vectorsWorld.length;b++)z.Vg.TransformCoordinatesToRef(o.vectorsWorld[b],g,I),I.x<this._orthoLeft&&(this._orthoLeft=I.x),I.y<this._orthoBottom&&(this._orthoBottom=I.y),I.x>this._orthoRight&&(this._orthoRight=I.x),I.y>this._orthoTop&&(this._orthoTop=I.y),this.autoCalcShadowZBounds&&(I.z<e&&(e=I.z),I.z>c&&(c=I.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=e,this._shadowMaxZ=c)}const c=this._orthoRight-this._orthoLeft,M=this._orthoTop-this._orthoBottom,J=void 0!==this.shadowMinZ?this.shadowMinZ:(null===e||void 0===e?void 0:e.cb)||0,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===e||void 0===e?void 0:e.maxZ)||1e4,n=this.EI().getEngine().Fg;z.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-M*this.shadowOrthoScale,this._orthoTop+M*this.shadowOrthoScale,n?o:J,n?J:o,I,this.EI().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,g){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,g),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,g),this)}transferToNodeMaterialEffect(I,g){return this.computeTransformedInformation()?(I.setFloat3(g,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(I.setFloat3(g,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(I){const g=this._scene.getEngine();return!g.Fg&&g.isNDCHalfZRange?0:1}getDepthMaxZ(I){const g=this._scene.getEngine();return g.Fg&&g.isNDCHalfZRange?0:1}prepareLightSpecificDefines(I,g){I["DIRLIGHT"+g]=!0}}(0,e.d)([(0,c.E)()],G.prototype,"shadowFrustumSize",null),(0,e.d)([(0,c.E)()],G.prototype,"shadowOrthoScale",null),(0,e.d)([(0,c.E)()],G.prototype,"autoUpdateExtends",void 0),(0,e.d)([(0,c.E)()],G.prototype,"autoCalcShadowZBounds",void 0),(0,e.d)([(0,c.E)("orthoLeft")],G.prototype,"_orthoLeft",void 0),(0,e.d)([(0,c.E)("orthoRight")],G.prototype,"_orthoRight",void 0),(0,e.d)([(0,c.E)("orthoTop")],G.prototype,"_orthoTop",void 0),(0,e.d)([(0,c.E)("orthoBottom")],G.prototype,"_orthoBottom",void 0),(0,n.g)("BABYLON.DirectionalLight",G)},14734:(I,g,b)=>{"use strict";b.d(g,{d:()=>G});var e=b(12577),c=b(12584),z=b(12590),M=b(12637),J=b(13002),o=b(13114),n=b(12558);J.b.AddNodeConstructor("Light_Type_3",((I,g)=>()=>new G(I,z.Vg.Zero(),g)));class G extends o.d{constructor(I,g,b){super(I,b),this.groundColor=new M.Eg(0,0,0),this.direction=g||z.Vg.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Ob"}setDirectionToTarget(I){return this.direction=z.Vg.Normalize(I.ag(z.Vg.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(I,g){const b=z.Vg.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,g),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Xb),g),this}transferToNodeMaterialEffect(I,g){const b=z.Vg.Normalize(this.direction);return I.setFloat3(g,b.x,b.y,b.z),this}Mb(){return this._worldMatrix||(this._worldMatrix=z.Matrix.Identity()),this._worldMatrix}getTypeID(){return o.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(I,g){I["HEMILIGHT"+g]=!0}}(0,e.d)([(0,c.k)()],G.prototype,"groundColor",void 0),(0,e.d)([(0,c.A)()],G.prototype,"direction",void 0),(0,n.g)("BABYLON.HemisphericLight",G)},14228:(I,g,b)=>{"use strict";b.d(g,{d:()=>D});var e=b(12577),c=b(12584),z=b(12590),M=b(13002),J=b(13114),o=b(13161),n=b(12572),G=b(12558);M.b.AddNodeConstructor("Light_Type_2",((I,g)=>()=>new D(I,z.Vg.Zero(),z.Vg.Zero(),0,0,g)));class D extends o.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(I){this._iesProfileTexture!==I&&(this._iesProfileTexture=I,this._iesProfileTexture&&D._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(I){this._angle=I,this._cosHalfAngle=Math.cos(.5*I),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(I){this._innerAngle=I,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(I){this._shadowAngleScale=I,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(I){this._projectionTextureLightNear=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(I){this._projectionTextureLightFar=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(I){this._projectionTextureUpDirection=I,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(I){this._projectionTexture!==I&&(this._projectionTexture=I,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(D._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):D._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(I){return void 0!==I.onGeneratedObservable}static _IsTexture(I){return void 0!==I.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(I){this._projectionTextureProjectionLightMatrix=I,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(I,g,b,e,c,M){super(I,M),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=z.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=z.Vg.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=z.Vg.Zero(),this._projectionTextureViewLightMatrix=z.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=z.Matrix.Zero(),this._projectionTextureScalingMatrix=z.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=g,this.direction=b,this.angle=e,this.exponent=c}getClassName(){return"SpotLight"}getTypeID(){return J.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(I){super._setDirection(I),this._projectionTextureViewLightDirty=!0}_setPosition(I){super._setPosition(I),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(I,g,b){const e=this.EI().activeCamera;if(!e)return;this._shadowAngleScale=this._shadowAngleScale||1;const c=this._shadowAngleScale*this._angle,M=void 0!==this.shadowMinZ?this.shadowMinZ:e.cb,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,o=this.EI().getEngine().Fg;z.Matrix.PerspectiveFovLHToRef(c,1,o?J:M,o?M:J,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),z.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const I=this.projectionTextureLightFar,g=this.projectionTextureLightNear,b=I/(I-g),e=-b*g,c=1/Math.tan(this._angle/2);z.Matrix.FromValuesToRef(c/1,0,0,0,0,c,0,0,0,0,b,1,0,0,e,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof n.b){const I=this._projectionTexture.uScale/2,g=this._projectionTexture.vScale/2;z.Matrix.FromValuesToRef(I,0,0,0,0,g,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(I,g){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),I.setMatrix("textureProjectionMatrix"+g,this._projectionTextureMatrix),I.setTexture("projectionLightTexture"+g,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&I.setTexture("iesLightTexture"+g,this._iesProfileTexture),this}transferToEffect(I,g){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,g),b=z.Vg.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,g),b=z.Vg.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,g),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,g),this}transferToNodeMaterialEffect(I,g){let b;return b=this.computeTransformedInformation()?z.Vg.Normalize(this.transformedDirection):z.Vg.Normalize(this.direction),this.EI().useRightHandedSystem?I.setFloat3(g,-b.x,-b.y,-b.z):I.setFloat3(g,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(I){const g=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===I||void 0===I?void 0:I.cb)??0;return g.Fg&&g.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(I){const g=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===I||void 0===I?void 0:I.maxZ)??1e4;return g.Fg&&g.isNDCHalfZRange?0:b}prepareLightSpecificDefines(I,g){I["SPOTLIGHT"+g]=!0,I["PROJECTEDLIGHTTEXTURE"+g]=!(!this.projectionTexture||!this.projectionTexture.isReady()),I["IESLIGHTTEXTURE"+g]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,e.d)([(0,c.E)()],D.prototype,"angle",null),(0,e.d)([(0,c.E)()],D.prototype,"innerAngle",null),(0,e.d)([(0,c.E)()],D.prototype,"shadowAngleScale",null),(0,e.d)([(0,c.E)()],D.prototype,"exponent",void 0),(0,e.d)([(0,c.E)()],D.prototype,"projectionTextureLightNear",null),(0,e.d)([(0,c.E)()],D.prototype,"projectionTextureLightFar",null),(0,e.d)([(0,c.E)()],D.prototype,"projectionTextureUpDirection",null),(0,e.d)([(0,c.v)("projectedLightTexture")],D.prototype,"_projectionTexture",void 0),(0,G.g)("BABYLON.SpotLight",D)},13953:(I,g,b)=>{"use strict";b.d(g,{e:()=>M,g:()=>z,j:()=>J});const e={},c={};function z(I,g){e[I]=g}function M(I,g){c[I]=g}function J(I){return c[I]?c[I]:null}},13857:(I,g,b)=>{"use strict";b.d(g,{e:()=>E,i:()=>U});var e,c=b(12409),z=b(12412),M=b(12814),J=b(12449),o=b(12420),n=b(13039),G=b(12456),D=b(12465),p=b(12561),x=b(12497),Z=b(12443);!function(I){I[I.Clean=0]="Clean",I[I.Stop=1]="Stop",I[I.Sync=2]="Sync",I[I.NoSync=3]="NoSync"}(e||(e={}));const k=new z.c,S={};let f=!1;function V(){return S[".babylon"]}function a(I,g){const b=S[I];return b||(o.b.Warn("Unable to find a plugin to load "+I+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),g?V():void 0)}function v(I,g,b){let e="Unable to load from "+(I.rawData?"binary data":I.url);return g?e+=`: ${g}`:b&&(e+=`: ${b}`),e}async function X(I,g,b,e,c,z,M,J,o){var n;const D="data:"===(p=I.url).substring(0,5)?p.substring(5):null;var p;if(I.rawData&&!M)throw"When using ArrayBufferView to load data the file extension must be provided.";const f=D||M?"":function(I){const g=I.indexOf("?");-1!==g&&(I=I.substring(0,g));const b=I.lastIndexOf(".");return I.substring(b,I.length).toLowerCase()}(I.url);let v=M?a(M,!0):D?function(I){for(const g in S){const b=S[g].plugin;if(b.canDirectLoad&&b.canDirectLoad(I))return S[g]}return V()}(I.url):a(f,!1);if(!v&&f){if(I.url&&!I.url.startsWith("blob:")){const g=await async function(I,g){const b=g.method||"GET";return await new Promise(((e,c)=>{const z=new Z.d;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const I={};if(g.responseHeaders)for(const b of g.responseHeaders)I[b]=z.getResponseHeader(b)||"";e({response:z.response,headerValues:I})}else c(`Unable to fetch data from ${I}. Error code: ${z.status}`)})),z.open(b,I),z.send()}))}(I.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=g.headerValues?g.headerValues["Content-Type"]:"";b&&(v=function(I){for(const g in S){const b=S[g];if(b.mimeType===I)return b}}(b))}v||(v=V())}if(!v)throw new Error(`No plugin or fallback for ${M??I.url}`);if(!1===(null===o||void 0===o||null===(n=o[v.plugin.name])||void 0===n?void 0:n.enabled))throw new Error(`The '${v.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(I.rawData&&!v.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(I=>{if(v.plugin.createPlugin){const g=v.plugin.createPlugin(o??{});return g instanceof Promise?(g.then(I).catch((I=>{c("Error instantiating plugin.",I)})),null):(I(g),g)}return I(v.plugin),v.plugin})((o=>{var n;if(!o)throw`The loader plugin corresponding to the '${M}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(k.notifyObservers(o),D&&(o.canDirectLoad&&o.canDirectLoad(I.url)||!(0,G.l)(I.url))){if(o.directLoad){const I=o.directLoad(g,D);I instanceof Promise?I.then((I=>{b(o,I)})).catch((I=>{c("Error in directLoad of _loadData: "+I,I)})):b(o,I)}else b(o,D);return}const p=v.isBinary,Z=(I,e)=>{g.Z?c("Scene has been disposed"):b(o,I,e)};let S=null,f=!1;null===(n=o.Og)||void 0===n||n.add((()=>{f=!0,S&&(S.abort(),S=null),z()}));const V=()=>{if(f)return;const b=(I,g)=>{c(null===I||void 0===I?void 0:I.statusText,g)};if(!o.loadFile&&I.rawData)throw"Plugin does not support loading ArrayBufferView.";S=o.loadFile?o.loadFile(g,I.rawData||I.file||I.url,I.rootUrl,Z,e,p,b,J):g._loadFile(I.file||I.url,Z,e,!0,p,b)},a=g.getEngine();let X=a.enableOfflineSupport;if(X){let b=!1;for(const e of g.disableOfflineSupportExceptionRules)if(e.test(I.url)){b=!0;break}X=!b}X&&x.c.OfflineProviderFactory?g.offlineProvider=x.c.OfflineProviderFactory(I.url,V,a.disableManifestCheck):V()}))}function R(I,g){let b,e,z=null,M=null;if(g)if(g.name)b=`file:${g.name}`,e=g.name,z=g;else if(ArrayBuffer.isView(g))b="",e=(0,p.e)(),M=g;else if(g.startsWith("data:"))b=g,e="";else if(I){const z=g;if("/"===z.substring(0,1))return c.Tools.Error("Wrong sceneFilename parameter"),null;b=I+z,e=z}else b=g,e=c.Tools.GetFilename(g),I=c.Tools.GetFolderPath(g);else b=I,e=c.Tools.GetFilename(I),I=c.Tools.GetFolderPath(I);return{url:b,rootUrl:I,name:e,file:z,rawData:M}}function E(I){if("string"===typeof I.extensions){const g=I.extensions;S[g.toLowerCase()]={plugin:I,isBinary:!1}}else{const g=I.extensions,b=Object.keys(g);for(const e of b)S[e.toLowerCase()]={plugin:I,isBinary:g[e].isBinary,mimeType:g[e].mimeType}}}async function mI(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.b.LastCreatedScene,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!e)return o.b.Error("No scene available to import mesh to"),null;const x=R(g,b);if(!x)return null;const Z={};e.addPendingData(Z);const k=()=>{e.removePendingData(Z)},S=(I,g)=>{const b=v(x,I,g);M?M(e,b,new D.m(b,D.i.SceneLoaderError,g)):o.b.Error(b),k()},f=z?I=>{try{z(I)}catch(g){S("Error in onProgress callback: "+g,g)}}:void 0,V=(I,g,b,z,M,J,o,n)=>{if(e.importedMeshesFiles.push(x.url),c)try{c(I,g,b,z,M,J,o,n)}catch(G){S("Error in onSuccess callback: "+G,G)}e.removePendingData(Z)};return await X(x,e,((g,b,c)=>{if(g.rewriteRootURL&&(x.rootUrl=g.rewriteRootURL(x.rootUrl,c)),g.importMesh){const c=[],z=[],M=[];if(!g.importMesh(I,e,b,x.rootUrl,c,z,M,S))return;e.loadingPluginName=g.name,V(c,z,M,[],[],[],[],[])}else{g.importMeshAsync(I,e,b,x.rootUrl,f,x.name).then((I=>{e.loadingPluginName=g.name,V(I.meshes,I.Ax,I.skeletons,I.animationGroups,I.transformNodes,I.geometries,I.lights,I.spriteManagers)})).catch((I=>{S(I.message,I)}))}}),f,S,k,n,G,p)}async function s(I,g,b,e,c,z,M,J){return await new Promise(((o,n)=>{try{mI(I,g,b,e,((I,g,b,e,c,z,M,J)=>{o({meshes:I,Ax:g,skeletons:b,animationGroups:e,transformNodes:c,geometries:z,lights:M,spriteManagers:J})}),c,((I,g,b)=>{n(b||new Error(g))}),z,M,J).catch(n)}catch(D){n(D)}}))}async function F(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedEngine,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await d(I,g,new M.c(b),e,z,o,n,G,D):c.Tools.Error("No engine available")}async function Y(I,g,b,e,c,z,M){return await new Promise(((J,o)=>{F(I,g,b,(I=>{J(I)}),e,((I,g,b)=>{o(b||new Error(g))}),c,z,M)}))}async function d(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return o.b.Error("No scene available to append to"),null;const x=R(I,g);if(!x)return null;const Z={};b.addPendingData(Z);const k=()=>{b.removePendingData(Z)};n.d.ShowLoadingScreen&&!f&&(f=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),f=!1})));const S=(I,g)=>{const e=v(x,I,g);z?z(b,e,new D.m(e,D.i.SceneLoaderError,g)):o.b.Error(e),k()},V=c?I=>{try{c(I)}catch(g){S("Error in onProgress callback",g)}}:void 0,a=()=>{if(e)try{e(b)}catch(I){S("Error in onSuccess callback",I)}b.removePendingData(Z)};return await X(x,b,((I,g)=>{if(I.load){if(!I.load(b,g,x.rootUrl,S))return;b.loadingPluginName=I.name,a()}else{I.loadAsync(b,g,x.rootUrl,V,x.name).then((()=>{b.loadingPluginName=I.name,a()})).catch((I=>{S(I.message,I)}))}}),V,S,k,M,G,p)}async function C(I,g,b,e,c,z,M){return await new Promise(((J,o)=>{try{d(I,g,b,(I=>{J(I)}),e,((I,g,b)=>{o(b||new Error(g))}),c,z,M).catch(o)}catch(D){o(D)}}))}async function r(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return o.b.Error("No scene available to load asset container to"),null;const p=R(I,g);if(!p)return null;const x={};b.addPendingData(x);const Z=()=>{b.removePendingData(x)},k=(I,g)=>{const e=v(p,I,g);z?z(b,e,new D.m(e,D.i.SceneLoaderError,g)):o.b.Error(e),Z()},S=c?I=>{try{c(I)}catch(g){k("Error in onProgress callback",g)}}:void 0,f=I=>{if(e)try{e(I)}catch(g){k("Error in onSuccess callback",g)}b.removePendingData(x)};return await X(p,b,((I,g)=>{if(I.loadAssetContainer){const e=I.loadAssetContainer(b,g,p.rootUrl,k);if(!e)return;e.populateRootNodes(),b.loadingPluginName=I.name,f(e)}else if(I.loadAssetContainerAsync){I.loadAssetContainerAsync(b,g,p.rootUrl,S,p.name).then((g=>{g.populateRootNodes(),b.loadingPluginName=I.name,f(g)})).catch((I=>{k(I.message,I)}))}else k("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),S,k,Z,M,n,G)}async function O(I,g,b,e,c,z,M){return await new Promise(((J,o)=>{try{r(I,g,b,(I=>{J(I)}),e,((I,g,b)=>{o(b||new Error(g))}),c,z,M).catch(o)}catch(D){o(D)}}))}async function H(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.b.LastCreatedScene,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void o.b.Error("No scene available to load animations to");if(e){for(const e of b.animatables)e.reset();b.stopAllAnimations();const I=b.animationGroups.slice();for(const b of I)b.dispose();const g=b.getNodes();for(const b of g)b.animations&&(b.animations=[])}else switch(c){case 0:const I=b.animationGroups.slice();for(const g of I)g.dispose();break;case 1:for(const g of b.animationGroups)g.stop();break;case 2:for(const g of b.animationGroups)g.reset(),g.restart();break;case 3:break;default:return void o.b.Error("Unknown animation group loading mode value '"+c+"'")}const Z=b.animatables.length;await r(I,g,b,(I=>{I.mergeAnimationsTo(b,b.animatables.slice(Z),z),I.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),M&&M(b)}),n,G,D,p,x)}async function i(I,g,b,e,c,z,M,J,o,n){return await new Promise(((G,p)=>{try{H(I,g,b,e,c,z,(I=>{G(I)}),M,((I,g,b)=>{p(b||new Error(g))}),J,o,n).catch(p)}catch(D){p(D)}}))}class U{static get ForceFullSceneLoadingForIncremental(){return n.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(I){n.d.ForceFullSceneLoadingForIncremental=I}static get ShowLoadingScreen(){return n.d.ShowLoadingScreen}static set ShowLoadingScreen(I){n.d.ShowLoadingScreen=I}static get loggingLevel(){return n.d.loggingLevel}static set loggingLevel(I){n.d.loggingLevel=I}static get CleanBoneMatrixWeights(){return n.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(I){n.d.CleanBoneMatrixWeights=I}static GetDefaultPlugin(){return V()}static GetPluginForExtension(I){var g;return null===(g=a(I,!0))||void 0===g?void 0:g.plugin}static IsPluginForExtensionAvailable(I){return function(I){return!!S[I]}(I)}static RegisterPlugin(I){E(I)}static ImportMesh(I,g,b,e,c,z,M,o,n){mI(I,g,b,e,c,z,M,o,n).catch((I=>null===M||void 0===M?void 0:M(J.b.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportMeshAsync(I,g,b,e,c,z,M){return await s(I,g,b,e,c,z,M)}static Load(I,g,b,e,c,z,M,o){F(I,g,b,e,c,z,M,o).catch((I=>null===z||void 0===z?void 0:z(J.b.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAsync(I,g,b,e,c,z){return await Y(I,g,b,e,c,z)}static Append(I,g,b,e,c,z,M,o){d(I,g,b,e,c,z,M,o).catch((I=>null===z||void 0===z?void 0:z(b??J.b.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async AppendAsync(I,g,b,e,c,z){return await C(I,g,b,e,c,z)}static LoadAssetContainer(I,g,b,e,c,z,M,o){r(I,g,b,e,c,z,M,o).catch((I=>null===z||void 0===z?void 0:z(b??J.b.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAssetContainerAsync(I,g,b,e,c,z){return await O(I,g,b,e,c,z)}static ImportAnimations(I,g,b,e,c,z,M,o,n,G,D){H(I,g,b,e,c,z,M,o,n,G,D).catch((I=>null===n||void 0===n?void 0:n(b??J.b.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportAnimationsAsync(I,g,b,e,c,z,M,J,o,n,G){return await i(I,g,b,e,c,z,J,n,G)}}U.NO_LOGGING=0,U.MINIMAL_LOGGING=1,U.SUMMARY_LOGGING=2,U.DETAILED_LOGGING=3,U.OnPluginActivatedObservable=k},14243:(I,g,b)=>{"use strict";b.d(g,{d:()=>p});var e=b(12577),c=b(12584),z=b(12409),M=b(12590),J=b(12614),o=b(12572),n=b(12558),G=b(12412),D=b(12622);b(14250);class p extends J.b{set boundingBoxSize(I){if(this._boundingBoxSize&&this._boundingBoxSize.equals(I))return;this._boundingBoxSize=I;const g=this.EI();g&&g.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(I){this._rotationY=I,this.setReflectionTextureMatrix(M.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(I,g,b){let e="";for(const c of I)e+=c;return new p(e,g,null,b,I)}static CreateFromPrefilteredData(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const c=g.useDelayedTextureLoading;g.useDelayedTextureLoading=!1;const z=new p(I,g,null,!1,null,null,null,void 0,!0,b,e);return g.useDelayedTextureLoading=c,z}constructor(I,g){var b;let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,p=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0;super(g),this.onLoadObservable=new G.c,this.boundingBoxPosition=M.Vg.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new M.Matrix,this._buffer=null,this.name=I,this.url=I,this._noMipmap=c,this.eb=!1,this.isCube=!0,this._textureMatrix=M.Matrix.Identity(),this.coordinatesMode=o.b.CUBIC_MODE;let a=null,v=null;null===e||Array.isArray(e)?(this._noMipmap=c,this._format=D,this._createPolynomials=Z,a=e,this._loaderOptions=f,this._useSRGBBuffer=V,this._lodScale=k,this._lodOffset=S):(a=e.extensions??null,this._noMipmap=e.noMipmap??!1,z=e.files??null,v=e.buffer??null,this._format=e.format??5,p=e.prefiltered??!1,x=e.forcedExtension??null,this._createPolynomials=e.createPolynomials??!1,this._lodScale=e.lodScale??.8,this._lodOffset=e.lodOffset??0,this._loaderOptions=e.loaderOptions,this._useSRGBBuffer=e.useSRGBBuffer,J=e.l??null,n=e.onError??null),(I||z)&&this.updateURL(I,x,J,p,n,a,null===(b=this.EI())||void 0===b?void 0:b.useDelayedTextureLoading,z,v)}getClassName(){return"CubeTexture"}updateURL(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=I),this.url=I,g&&(this._forcedExtension=g);const n=I.lastIndexOf("."),G=g||(n>-1?I.substring(n).toLowerCase():""),D=0===G.indexOf(".dds"),p=0===G.indexOf(".env"),x=0===G.indexOf(".basis");if(p?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=e,e&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),J)this._files=J;else if(x||p||D||z||(z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,z){for(let g=0;g<z.length;g++)this._files.push(I+z[g]);this._extensions=z}this._buffer=o,M?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=c):this._loadTexture(b,c)}delayLoad(I){4===this.delayLoadState&&(I&&(this._forcedExtension=I),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(I){var g,b;if(I.updateFlag===this._textureMatrix.updateFlag)return;I.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.EI())||void 0===b||b.markAllMaterialsAsDirty(1,(I=>-1!==I.getActiveTextures().indexOf(this))));if(this._textureMatrix=I,null===(g=this.EI())||void 0===g||!g.useRightHandedSystem)return;const e=M.TmpVectors.Vg[0],c=M.TmpVectors.Quaternion[0],z=M.TmpVectors.Vg[1];this._textureMatrix.decompose(e,c,z),c.z*=-1,c.w*=-1,M.Matrix.ComposeToRef(e,c,z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var I;return null!==(I=this.EI())&&void 0!==I&&I.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.EI(),e=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const c=()=>{var g;(this.onLoadObservable.notifyObservers(this),e)&&(e.dispose(),null===(g=this.EI())||void 0===g||g.markAllMaterialsAsDirty(1));I&&I()},M=(I,b)=>{this._loadingError=!0,this._errorObject={message:I,exception:b},g&&g(I,b),o.b.OnTextureLoadErrorObservable.notifyObservers(this)};var J;this._texture?this._texture.isReady?z.Tools.SetImmediate((()=>c())):this._texture.onLoadedObservable.add((()=>c())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,I,M,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,I,M,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(J=this._texture)||void 0===J||J.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(I,g,b){const e=D.b.Parse((()=>{let e=!1;return I.prefiltered&&(e=I.prefiltered),new p(b+(I.url??I.name),g,I.extensions,!1,I.files||null,null,null,void 0,e,I.forcedExtension)}),I,g);if(I.boundingBoxPosition&&(e.boundingBoxPosition=M.Vg.mb(I.boundingBoxPosition)),I.boundingBoxSize&&(e.boundingBoxSize=M.Vg.mb(I.boundingBoxSize)),I.animations)for(let c=0;c<I.animations.length;c++){const g=I.animations[c],b=(0,n.d)("BABYLON.Animation");b&&e.animations.push(b.Parse(g))}return e}clone(){let I=0;const g=D.b.Clone((()=>{const g=new p(this.url,this.EI()||this._getEngine(),this._extensions,this._noMipmap,this._files);return I=g.uniqueId,g}),this);return g.uniqueId=I,g}}(0,e.d)([(0,c.E)()],p.prototype,"url",void 0),(0,e.d)([(0,c.A)()],p.prototype,"boundingBoxPosition",void 0),(0,e.d)([(0,c.A)()],p.prototype,"boundingBoxSize",null),(0,e.d)([(0,c.E)("rotationY")],p.prototype,"rotationY",null),(0,e.d)([(0,c.E)("files")],p.prototype,"_files",void 0),(0,e.d)([(0,c.E)("forcedExtension")],p.prototype,"_forcedExtension",void 0),(0,e.d)([(0,c.E)("extensions")],p.prototype,"_extensions",void 0),(0,e.d)([(0,c.r)("textureMatrix")],p.prototype,"_textureMatrix",void 0),(0,e.d)([(0,c.r)("textureMatrixRefraction")],p.prototype,"_textureMatrixRefraction",void 0),o.b._CubeTextureParser=p.Parse,(0,n.g)("BABYLON.CubeTexture",p)},14745:(I,g,b)=>{"use strict";b.d(g,{d:()=>o});var e=b(12420),c=b(12572),z=b(12566),M=b(12726),J=b(12529);M.ThinEngine.prototype.createDynamicTexture=function(I,g,b,e){const c=new J.e(this,4);return c.baseWidth=I,c.baseHeight=g,b&&(I=this.needPOTTextures?(0,z.g)(I,this._caps.maxTextureSize):I,g=this.needPOTTextures?(0,z.g)(g,this._caps.maxTextureSize):g),c.width=I,c.height=g,c.isReady=!1,c.generateMipMaps=b,c.samplingMode=e,this.updateTextureSamplingMode(e,c),this._internalTexturesCache.push(c),c},M.ThinEngine.prototype.updateDynamicTexture=function(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!I)return;const M=this._gl,J=M.TEXTURE_2D,o=this._bindTextureDirectly(J,I,!0,z);this._unpackFlipY(void 0===b?I.invertY:b),e&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const n=this._getWebGLTextureType(I.type),G=this._getInternalFormat(c||I.format),D=this._getRGBABufferInternalSizedFormat(I.type,G);M.texImage2D(J,0,D,G,n,g),I.generateMipMaps&&M.generateMipmap(J),o||this._bindTextureDirectly(J,null),e&&M.pixelStorei(M.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),c&&(I.format=c),I._dynamicTextureSource=g,I._premulAlpha=e,I.invertY=b||!1,I.isReady=!0};class o extends c.b{constructor(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,J=arguments.length>6?arguments[6]:void 0;const o=!b||b._isScene;super(null,o?b:null===b||void 0===b?void 0:b.Xg,o?!e:b,J,z,void 0,void 0,void 0,void 0,M),this.name=I,this.wrapU=c.b.CLAMP_ADDRESSMODE,this.wrapV=c.b.CLAMP_ADDRESSMODE,this._generateMipMaps=e;const n=this._getEngine();if(!n)return;if(g.getContext)this._canvas=g,this._ownCanvas=!1,this._texture=n.createDynamicTexture(this._canvas.width,this._canvas.height,e,z);else{this._canvas=n.createCanvas(1,1),this._ownCanvas=!0;const I=g;I.width||0===I.width?this._texture=n.createDynamicTexture(I.width,I.height,e,z):this._texture=n.createDynamicTexture(g,g,e,z)}const G=this.getSize();this._canvas.width!==G.width&&(this._canvas.width=G.width),this._canvas.height!==G.height&&(this._canvas.height=G.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(I){this._canvas.width=I.width,this._canvas.height=I.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(I.width,I.height,this._generateMipMaps,this.samplingMode)}scale(I){const g=this.getSize();g.width*=I,g.height*=I,this._recreate(g)}scaleTo(I,g){const b=this.getSize();b.width=I,b.height=g,this._recreate(b)}getContext(){return this._context}clear(I){const g=this.getSize();I&&(this._context.fillStyle=I),this._context.clearRect(0,0,g.width,g.height)}update(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===I||I,g,this._format||void 0,void 0,b)}drawText(I,g,b,e,c,z,M){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const o=this.getSize();if(z&&(this._context.fillStyle=z,this._context.fillRect(0,0,o.width,o.height)),this._context.font=e,null===g||void 0===g){const b=this._context.measureText(I);g=(o.width-b.width)/2}if(null===b||void 0===b){const I=parseInt(e.replace(/\D/g,""));b=o.height/2+I/3.65}this._context.fillStyle=c||"",this._context.fillText(I,g,b),J&&this.update(M)}dispose(){var I,g;(super.dispose(),this._ownCanvas)&&(null===(I=this._canvas)||void 0===I||null===(g=I.remove)||void 0===g||g.call(I));this._canvas=null,this._context=null}clone(){const I=this.EI();if(!I)return this;const g=this.getSize(),b=new o(this.name,g,I,this._generateMipMaps);return b.eb=this.eb,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const I=this.EI();I&&!I.isReady()&&e.b.Warn("The scene must be ready before serializing the dynamic texture");const g=super.serialize();return o._IsCanvasElement(this._canvas)&&(g.base64String=this._canvas.toDataURL()),g.invertY=this._invertY,g.samplingMode=this.samplingMode,g}static _IsCanvasElement(I){return void 0!==I.toDataURL}_rebuild(){this.update()}}},14152:(I,g,b)=>{"use strict";b.d(g,{e:()=>c});var e=b(12572);class c extends e.b{get depth(){return this._depth}constructor(I,g,b,c,z,M){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.b.TRILINEAR_SAMPLINGMODE,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,D=arguments.length>10?arguments[10]:void 0;super(null,M,!J,o),this.format=z,this._texture=M.getEngine().createRawTexture2DArray(I,g,b,c,z,J,o,n,null,G,D),this._depth=c,this.is2DArray=!0}update(I){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,I,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(I,g,b,e,z){return new c(I,g,b,e,5,z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13968:(I,g,b)=>{"use strict";b.d(g,{d:()=>J,g:()=>o,i:()=>z,j:()=>M});var e=b(12610),c=b(12590);function z(I,g){return`{X: ${I.x.toFixed(g)} Y: ${I.y.toFixed(g)}}`}function M(I,g){return`{X: ${I._x.toFixed(g)} Y: ${I._y.toFixed(g)} Z: ${I._z.toFixed(g)}}`}function J(I,g){return 2*Math.acos((0,e.Clamp)(c.Quaternion.Dot(I,g)))}function o(I,g){const b=new c.Quaternion;return function(I,g,b){const z=c.Vg.Cross(I,g),M=Math.acos((0,e.Clamp)(c.Vg.Dot(I,g),-1,1));c.Quaternion.RotationAxisToRef(z,M,b)}(I,g,b),b}},13804:(I,g,b)=>{"use strict";b.d(g,{c:()=>n});var e=b(12590),c=b(12637),z=b(13027),M=b(13013),J=b(12648);b(13811);function o(I){let g=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],z=[];let o=[];const n=I.width||I.size||1,G=I.height||I.size||1,D=I.depth||I.size||1,p=I.wrap||!1;let x=void 0===I.topBaseAt?1:I.topBaseAt,Z=void 0===I.bottomBaseAt?0:I.bottomBaseAt;x=(x+4)%4,Z=(Z+4)%4;let k=[2,0,3,1][x],S=[2,0,1,3][Z],f=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(p){g=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],f=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let I=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const e=[17,18,19,16],c=[22,23,20,21];for(;k>0;)I.unshift(I.pop()),e.unshift(e.pop()),k--;for(;S>0;)b.unshift(b.pop()),c.unshift(c.pop()),S--;I=I.flat(),b=b.flat(),f=f.concat(I).concat(b),g.push(e[0],e[2],e[3],e[0],e[1],e[2]),g.push(c[0],c[2],c[3],c[0],c[1],c[2])}const V=[n/2,G/2,D/2];o=f.reduce(((I,g,b)=>I.concat(g*V[b%3])),[]);const a=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,v=I.faceUV||new Array(6),X=I.faceColors,R=[];for(let M=0;M<6;M++)void 0===v[M]&&(v[M]=new e.Vector4(0,0,1,1)),X&&void 0===X[M]&&(X[M]=new c.Sb(1,1,1,1));for(let e=0;e<6;e++)if(z.push(v[e].z,J.d?1-v[e].w:v[e].w),z.push(v[e].x,J.d?1-v[e].w:v[e].w),z.push(v[e].x,J.d?1-v[e].y:v[e].y),z.push(v[e].z,J.d?1-v[e].y:v[e].y),X)for(let I=0;I<4;I++)R.push(X[e].r,X[e].g,X[e].b,X[e].a);M.d._ComputeSides(a,o,g,b,z,I.frontUVs,I.backUVs);const E=new M.d;if(E.indices=g,E.sI=o,E.FI=b,E.dI=z,X){const I=a===M.d.DOUBLESIDE?R.concat(R):R;E.YI=I}return E}function n(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.e(I,b);g.sideOrientation=z.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return o(g).rI(e,g.updatable),e}M.d.CreateBox=o,z.e.CreateBox=function(I,g){return n(I,{size:g,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13957:(I,g,b)=>{"use strict";b.d(g,{c:()=>J});var e=b(13027),c=b(13013),z=b(12648);function M(I){const g=[],b=[],e=[],M=[],J=I.radius||.5,o=I.tessellation||64,n=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,G=0===I.sideOrientation?0:I.sideOrientation||c.d.DEFAULTSIDE;g.push(0,0,0),M.push(.5,.5);const D=2*Math.PI*n,p=1===n?D/o:D/(o-1);let x=0;for(let c=0;c<o;c++){const I=Math.cos(x),b=Math.sin(x),e=(I+1)/2,c=(1-b)/2;g.push(J*I,J*b,0),M.push(e,z.d?1-c:c),x+=p}1===n&&(g.push(g[3],g[4],g[5]),M.push(M[2],z.d?1-M[3]:M[3]));const Z=g.length/3;for(let c=1;c<Z-1;c++)b.push(c+1,0,c);c.d.ComputeNormals(g,b,e),c.d._ComputeSides(G,g,b,e,M,I.frontUVs,I.backUVs);const k=new c.d;return k.indices=b,k.sI=g,k.FI=e,k.dI=M,k}function J(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new e.e(I,b);g.sideOrientation=e.e._GetDefaultSideOrientation(g.sideOrientation),c._originalBuilderSideOrientation=g.sideOrientation;return M(g).rI(c,g.updatable),c}c.d.CreateDisc=M,e.e.CreateDisc=function(I,g,b){return J(I,{radius:g,tessellation:b,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13811:(I,g,b)=>{"use strict";b.d(g,{h:()=>S,e:()=>V,k:()=>f});var e=b(12590),c=b(12637),z=b(13027),M=b(13013),J=b(12659);z.e._GroundMeshParser=(I,g)=>o.Parse(I,g);class o extends z.e{constructor(I,g){super(I,g),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=I,this._subdivisionsY=I,this.subdivide(I);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(g)}getHeightAtCoordinates(I,g){const b=this.getWorldMatrix(),c=e.TmpVectors.Matrix[5];b.invertToRef(c);const z=e.TmpVectors.Vg[8];if(e.Vg.TransformCoordinatesFromFloatsToRef(I,0,g,c,z),I=z.x,g=z.z,I<this._minX||I>=this._maxX||g<=this._minZ||g>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const M=this._getFacetAt(I,g),J=-(M.x*I+M.z*g+M.w)/M.y;return e.Vg.TransformCoordinatesFromFloatsToRef(0,J,0,b,z),z.y}getNormalAtCoordinates(I,g){const b=new e.Vg(0,1,0);return this.getNormalAtCoordinatesToRef(I,g,b),b}getNormalAtCoordinatesToRef(I,g,b){const c=this.getWorldMatrix(),z=e.TmpVectors.Matrix[5];c.invertToRef(z);const M=e.TmpVectors.Vg[8];if(e.Vg.TransformCoordinatesFromFloatsToRef(I,0,g,z,M),I=M.x,g=M.z,I<this._minX||I>this._maxX||g<this._minZ||g>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const J=this._getFacetAt(I,g);return e.Vg.TransformNormalFromFloatsToRef(J.x,J.y,J.z,c,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(I,g){const b=Math.floor((I+this._maxX)*this._subdivisionsX/this._width),e=Math.floor(-(g+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),c=this._heightQuads[e*this._subdivisionsX+b];let z;return z=g<c.slope.x*I+c.slope.y?c.facet1:c.facet2,z}_initHeightQuads(){const I=this._subdivisionsX,g=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<g;b++)for(let g=0;g<I;g++){const c={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[b*I+g]=c}return this}_computeHeightQuads(){const I=this.getVerticesData(J.f.PositionKind);if(!I)return this;const g=e.TmpVectors.Vg[3],b=e.TmpVectors.Vg[2],c=e.TmpVectors.Vg[1],z=e.TmpVectors.Vg[0],M=e.TmpVectors.Vg[4],o=e.TmpVectors.Vg[5],n=e.TmpVectors.Vg[6],G=e.TmpVectors.Vg[7],D=e.TmpVectors.Vg[8];let p=0,x=0,Z=0,k=0,S=0,f=0,V=0;const a=this._subdivisionsX,v=this._subdivisionsY;for(let J=0;J<v;J++)for(let v=0;v<a;v++){p=3*v,x=J*(a+1)*3,Z=(J+1)*(a+1)*3,g.x=I[x+p],g.y=I[x+p+1],g.z=I[x+p+2],b.x=I[x+p+3],b.y=I[x+p+4],b.z=I[x+p+5],c.x=I[Z+p],c.y=I[Z+p+1],c.z=I[Z+p+2],z.x=I[Z+p+3],z.y=I[Z+p+4],z.z=I[Z+p+5],k=(z.z-g.z)/(z.x-g.x),S=g.z-k*g.x,b.subtractToRef(g,M),c.subtractToRef(g,o),z.subtractToRef(g,n),e.Vg.CrossToRef(n,o,G),e.Vg.CrossToRef(M,n,D),G.normalize(),D.normalize(),f=-(G.x*g.x+G.y*g.y+G.z*g.z),V=-(D.x*b.x+D.y*b.y+D.z*b.z);const X=this._heightQuads[J*a+v];X.slope.Db(k,S),X.facet1.Db(G.x,G.y,G.z,f),X.facet2.Db(D.x,D.y,D.z,V)}return this}serialize(I){super.serialize(I),I.subdivisionsX=this._subdivisionsX,I.subdivisionsY=this._subdivisionsY,I.minX=this._minX,I.maxX=this._maxX,I.cb=this._minZ,I.maxZ=this._maxZ,I.width=this._width,I.height=this._height}static Parse(I,g){const b=new o(I.name,g);return b._subdivisionsX=I.subdivisionsX||1,b._subdivisionsY=I.subdivisionsY||1,b._minX=I.minX,b._maxX=I.maxX,b._minZ=I.cb,b._maxZ=I.maxZ,b._width=I.width,b._height=I.height,b}}var n=b(12409),G=b(12449),D=b(12597),p=b(12648);function x(I){const g=[],b=[],c=[],z=[];let J,o;const n=I.width||I.size||1,G=I.height||I.size||1,D=0|(I.subdivisionsX||I.subdivisions||1),x=0|(I.subdivisionsY||I.subdivisions||1);for(J=0;J<=x;J++)for(o=0;o<=D;o++){const I=new e.Vg(o*n/D-n/2,0,(x-J)*G/x-G/2),g=new e.Vg(0,1,0);b.push(I.x,I.y,I.z),c.push(g.x,g.y,g.z),z.push(o/D,p.d?J/x:1-J/x)}for(J=0;J<x;J++)for(o=0;o<D;o++)g.push(o+1+(J+1)*(D+1)),g.push(o+1+J*(D+1)),g.push(o+J*(D+1)),g.push(o+(J+1)*(D+1)),g.push(o+1+(J+1)*(D+1)),g.push(o+J*(D+1));const Z=new M.d;return Z.indices=g,Z.sI=b,Z.FI=c,Z.dI=z,Z}function Z(I){const g=void 0!==I.xmin&&null!==I.xmin?I.xmin:-1,b=void 0!==I.zmin&&null!==I.zmin?I.zmin:-1,c=void 0!==I.xmax&&null!==I.xmax?I.xmax:1,z=void 0!==I.zmax&&null!==I.zmax?I.zmax:1,J=I.subdivisions||{w:1,h:1},o=I.precision||{w:1,h:1},n=[],G=[],D=[],p=[];let x,Z,k,S;J.h=J.h<1?1:J.h,J.w=J.w<1?1:J.w,o.w=o.w<1?1:o.w,o.h=o.h<1?1:o.h;const f=(c-g)/J.w,V=(z-b)/J.h;function a(I,g,b,c){const z=G.length/3,M=o.w+1;for(x=0;x<o.h;x++)for(Z=0;Z<o.w;Z++){const I=[z+Z+x*M,z+(Z+1)+x*M,z+(Z+1)+(x+1)*M,z+Z+(x+1)*M];n.push(I[1]),n.push(I[2]),n.push(I[3]),n.push(I[0]),n.push(I[1]),n.push(I[3])}const J=e.Vg.Zero(),k=new e.Vg(0,1,0);for(x=0;x<=o.h;x++)for(J.z=x*(c-g)/o.h+g,Z=0;Z<=o.w;Z++)J.x=Z*(b-I)/o.w+I,J.y=0,G.push(J.x,J.y,J.z),D.push(k.x,k.y,k.z),p.push(Z/o.w,x/o.h)}for(k=0;k<J.h;k++)for(S=0;S<J.w;S++)a(g+S*f,b+k*V,g+(S+1)*f,b+(k+1)*V);const v=new M.d;return v.indices=n,v.sI=G,v.FI=D,v.dI=p,v}function k(I){const g=[],b=[],z=[],J=[];let o,n;const G=I.colorFilter||new c.Eg(.3,.59,.11),p=I.alphaFilter||0;let x=!1;if(I.minHeight>I.maxHeight){x=!0;const g=I.maxHeight;I.maxHeight=I.minHeight,I.minHeight=g}for(o=0;o<=I.subdivisions;o++)for(n=0;n<=I.subdivisions;n++){const g=new e.Vg(n*I.width/I.subdivisions-I.width/2,0,(I.subdivisions-o)*I.height/I.subdivisions-I.height/2),c=4*(((g.x+I.width/2)/I.width*(I.bufferWidth-1)|0)+((1-(g.z+I.height/2)/I.height)*(I.bufferHeight-1)|0)*I.bufferWidth);let M=I.buffer[c]/255,Z=I.buffer[c+1]/255,k=I.buffer[c+2]/255;const S=I.buffer[c+3]/255;x&&(M=1-M,Z=1-Z,k=1-k);const f=M*G.r+Z*G.g+k*G.b;g.y=S>=p?I.minHeight+(I.maxHeight-I.minHeight)*f:I.minHeight-D.b,I.heightBuffer&&(I.heightBuffer[o*(I.subdivisions+1)+n]=g.y),b.push(g.x,g.y,g.z),z.push(0,0,0),J.push(n/I.subdivisions,1-o/I.subdivisions)}for(o=0;o<I.subdivisions;o++)for(n=0;n<I.subdivisions;n++){const e=n+1+(o+1)*(I.subdivisions+1),c=n+1+o*(I.subdivisions+1),z=n+o*(I.subdivisions+1),M=n+(o+1)*(I.subdivisions+1),J=b[3*e+1]>=I.minHeight,G=b[3*c+1]>=I.minHeight,D=b[3*z+1]>=I.minHeight;J&&G&&D&&(g.push(e),g.push(c),g.push(z));b[3*M+1]>=I.minHeight&&J&&D&&(g.push(M),g.push(e),g.push(z))}M.d.ComputeNormals(b,g,z);const Z=new M.d;return Z.indices=g,Z.sI=b,Z.FI=z,Z.dI=J,Z}function S(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new o(I,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=g.subdivisionsX||g.subdivisions||1,b._subdivisionsY=g.subdivisionsY||g.subdivisions||1,b._width=g.width||1,b._height=g.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return x(g).rI(b,g.updatable),b._setReady(!0),b}function f(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.e(I,b);return Z(g).rI(e,g.updatable),e}function V(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=b.width||10,M=b.height||10,J=b.subdivisions||1,D=b.minHeight||0,p=b.maxHeight||1,x=b.colorFilter||new c.Eg(.3,.59,.11),Z=b.alphaFilter||0,S=b.updatable,f=b.onReady;e=e||G.b.LastCreatedScene;const V=new o(I,e);let a;V._subdivisionsX=J,V._subdivisionsY=J,V._width=z,V._height=M,V._maxX=V._width/2,V._maxZ=V._height/2,V._minX=-V._maxX,V._minZ=-V._maxZ,V._setReady(!1),b.passHeightBufferInCallback&&(a=new Float32Array((J+1)*(J+1)));const v=(I,g,b)=>{k({width:z,height:M,subdivisions:J,minHeight:D,maxHeight:p,colorFilter:x,buffer:I,bufferWidth:g,bufferHeight:b,alphaFilter:Z,heightBuffer:a}).rI(V,S),f&&f(V,a),V._setReady(!0)};if("string"===typeof g){const I=I=>{var g;const b=I.width,c=I.height;if(e.Z)return;const z=null===(g=e)||void 0===g?void 0:g.getEngine().resizeImageBitmap(I,b,c);v(z,b,c)};n.Tools.LoadImage(g,I,b.onError?b.onError:()=>{},e.offlineProvider)}else v(g.data,g.width,g.height);return V}M.d.CreateGround=x,M.d.CreateTiledGround=Z,M.d.CreateGroundFromHeightMap=k,z.e.CreateGround=(I,g,b,e,c,z)=>S(I,{width:g,height:b,subdivisions:e,updatable:z},c),z.e.CreateTiledGround=(I,g,b,e,c,z,M,J,o)=>f(I,{xmin:g,zmin:b,xmax:e,zmax:c,subdivisions:z,precision:M,updatable:o},J),z.e.CreateGroundFromHeightMap=(I,g,b,e,c,z,M,J,o,n,G)=>V(I,g,{width:b,height:e,subdivisions:c,minHeight:z,maxHeight:M,updatable:o,onReady:n,alphaFilter:G},J)},14457:(I,g,b)=>{"use strict";b.d(g,{d:()=>x,g:()=>D,i:()=>p});var e=b(12590),c=b(13027),z=b(13013),M=b(13119),J=b(12659),o=b(12420);function n(I){const g=[],b=[],e=I.lines,c=I.YI,M=[];let J=0;for(let z=0;z<e.length;z++){const I=e[z];for(let e=0;e<I.length;e++){const{x:o,y:n,z:G}=I[e];if(b.push(o,n,G),c){const I=c[z],{r:g,g:b,b:J,a:o}=I[e];M.push(g,b,J,o)}e>0&&(g.push(J-1),g.push(J)),J++}}const o=new z.d;return o.indices=g,o.sI=b,c&&(o.YI=M),o}function G(I){const g=I.dashSize||3,b=I.gapSize||1,c=I.dashNb||200,M=I.points,J=[],o=[],n=e.Vg.Zero();let G=0,D=0,p=0,x=0,Z=0,k=0,S=0;for(S=0;S<M.length-1;S++)M[S+1].subtractToRef(M[S],n),G+=n.length();for(p=G/c,x=g*p/(g+b),S=0;S<M.length-1;S++){M[S+1].subtractToRef(M[S],n),D=Math.floor(n.length()/p),n.normalize();for(let I=0;I<D;I++)Z=p*I,J.push(M[S].x+Z*n.x,M[S].y+Z*n.y,M[S].z+Z*n.z),J.push(M[S].x+(Z+x)*n.x,M[S].y+(Z+x)*n.y,M[S].z+(Z+x)*n.z),o.push(k,k+1),k+=2}const f=new z.d;return f.sI=J,f.indices=o,f}function D(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=g.instance,c=g.lines,z=g.YI;if(e){const I=e.getVerticesData(J.f.PositionKind);let g,b;z&&(g=e.getVerticesData(J.f.ColorKind));let M=0,o=0;for(let e=0;e<c.length;e++){const J=c[e];for(let c=0;c<J.length;c++)I[M]=J[c].x,I[M+1]=J[c].y,I[M+2]=J[c].z,z&&g&&(b=z[e],g[o]=b[c].r,g[o+1]=b[c].g,g[o+2]=b[c].b,g[o+3]=b[c].a,o+=4),M+=3}return e.updateVerticesData(J.f.PositionKind,I,!1,!1),z&&g&&e.updateVerticesData(J.f.ColorKind,g,!1,!1),e.refreshBoundingInfo(),e}const o=!!z,G=new M.b(I,b,null,void 0,void 0,o,g.useVertexAlpha,g.material);return n(g).rI(G,g.updatable),G}function p(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=g.YI?[g.YI]:null;return D(I,{lines:[g.points],updatable:g.updatable,instance:g.instance,YI:e,useVertexAlpha:g.useVertexAlpha,material:g.material},b)}function x(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=g.points,J=g.instance,n=g.gapSize||1,D=g.dashSize||3;if(J){const I=I=>{const g=e.Vg.Zero(),b=I.length/6;let c=0,M=0,o=0,n=0,G=0,D=0,p=0,x=0;for(p=0;p<z.length-1;p++)z[p+1].subtractToRef(z[p],g),c+=g.length();o=c/b;const Z=J._creationDataStorage.dashSize;for(n=Z*o/(Z+J._creationDataStorage.gapSize),p=0;p<z.length-1;p++)for(z[p+1].subtractToRef(z[p],g),M=Math.floor(g.length()/o),g.normalize(),x=0;x<M&&D<I.length;)G=o*x,I[D]=z[p].x+G*g.x,I[D+1]=z[p].y+G*g.y,I[D+2]=z[p].z+G*g.z,I[D+3]=z[p].x+(G+n)*g.x,I[D+4]=z[p].y+(G+n)*g.y,I[D+5]=z[p].z+(G+n)*g.z,D+=6,x++;for(;D<I.length;)I[D]=z[p].x,I[D+1]=z[p].y,I[D+2]=z[p].z,D+=3};return(g.dashNb||g.dashSize||g.gapSize||g.useVertexAlpha||g.material)&&o.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),J.updateMeshPositions(I,!1),J}const p=new M.b(I,b,null,void 0,void 0,void 0,g.useVertexAlpha,g.material);return G(g).rI(p,g.updatable),p._creationDataStorage=new c.f,p._creationDataStorage.dashSize=D,p._creationDataStorage.gapSize=n,p}z.d.CreateLineSystem=n,z.d.CreateDashedLines=G,c.e.wG=function(I,g){return p(I,{points:g,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},c.e.CreateDashedLines=function(I,g,b,e,c){return x(I,{points:g,dashSize:b,gapSize:e,dashNb:c,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13865:(I,g,b)=>{"use strict";b.d(g,{c:()=>J,d:()=>o});var e=b(13027),c=b(13013),z=b(12648);function M(I){const g=[],b=[],e=[],M=[],J=void 0!==I.width?I.width:void 0!==I.size?I.size:1,o=void 0!==I.height?I.height:void 0!==I.size?I.size:1,n=0===I.sideOrientation?0:I.sideOrientation||c.d.DEFAULTSIDE,G=J/2,D=o/2;b.push(-G,-D,0),e.push(0,0,-1),M.push(0,z.d?1:0),b.push(G,-D,0),e.push(0,0,-1),M.push(1,z.d?1:0),b.push(G,D,0),e.push(0,0,-1),M.push(1,z.d?0:1),b.push(-G,D,0),e.push(0,0,-1),M.push(0,z.d?0:1),g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),c.d._ComputeSides(n,b,g,e,M,I.frontUVs,I.backUVs);const p=new c.d;return p.indices=g,p.sI=b,p.FI=e,p.dI=M,p}function J(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=new e.e(I,b);g.sideOrientation=e.e._GetDefaultSideOrientation(g.sideOrientation),c._originalBuilderSideOrientation=g.sideOrientation;return M(g).rI(c,g.updatable),g.sourcePlane&&(c.translate(g.sourcePlane.normal,-g.sourcePlane.d),c.setDirection(g.sourcePlane.normal.scale(-1))),c}const o={ID:J};c.d.ID=M,e.e.ID=(I,g,b,e,c)=>J(I,{size:g,width:g,height:g,sideOrientation:c,updatable:e},b)},13947:(I,g,b)=>{"use strict";b.d(g,{c:()=>o});var e=b(12590),c=b(13027),z=b(13013),M=b(12648);function J(I){const g=0|(I.segments||32),b=I.diameterX||I.diameter||1,c=I.diameterY||I.diameter||1,J=I.diameterZ||I.diameter||1,o=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,n=I.slice&&I.slice<=0?1:I.slice||1,G=0===I.sideOrientation?0:I.sideOrientation||z.d.DEFAULTSIDE,D=!!I.dedupTopBottomIndices,p=new e.Vg(b/2,c/2,J/2),x=2+g,Z=2*x,k=[],S=[],f=[],V=[];for(let z=0;z<=x;z++){const I=z/x,g=I*Math.PI*n;for(let b=0;b<=Z;b++){const c=b/Z,z=c*Math.PI*2*o,J=e.Matrix.RotationZ(-g),n=e.Matrix.RotationY(z),G=e.Vg.TransformCoordinates(e.Vg.Up(),J),D=e.Vg.TransformCoordinates(G,n),x=D.multiply(p),k=D.divide(p).normalize();S.push(x.x,x.y,x.z),f.push(k.x,k.y,k.z),V.push(c,M.d?1-I:I)}if(z>0){const I=S.length/3;for(let g=I-2*(Z+1);g+Z+2<I;g++)D?(z>1&&(k.push(g),k.push(g+1),k.push(g+Z+1)),(z<x||n<1)&&(k.push(g+Z+1),k.push(g+1),k.push(g+Z+2))):(k.push(g),k.push(g+1),k.push(g+Z+1),k.push(g+Z+1),k.push(g+1),k.push(g+Z+2))}}z.d._ComputeSides(G,S,k,f,V,I.frontUVs,I.backUVs);const a=new z.d;return a.indices=k,a.sI=S,a.FI=f,a.dI=V,a}function o(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return J(g).rI(e,g.updatable),e}z.d.CreateSphere=J,c.e.CreateSphere=(I,g,b,e,c,z)=>o(I,{segments:g,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:z,updatable:c},e)},14756:(I,g,b)=>{"use strict";b.d(g,{b:()=>J});var e=b(13138),c=b(14257),z=b(13152),M=b(13013);class J{static get Configuration(){return{get decoder(){return c.c.DefaultConfiguration},set decoder(I){c.c.DefaultConfiguration=I}}}static set Configuration(I){c.c.DefaultConfiguration=I.decoder}static get DecoderAvailable(){return(0,e.i)(c.c.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(I){J._Default&&(I||J._Default.dispose(),J._Default=null)}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultNumWorkers;const g="number"===typeof I?{...c.c.DefaultConfiguration,numWorkers:I}:{...c.c.DefaultConfiguration,...I};this._decoder=new c.c(g)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(I,g,b){return this._decoder.decodeMeshToMeshDataAsync(I,g,b)}async decodeMeshToGeometryAsync(I,g,b,e){return await this._decoder.decodeMeshToGeometryAsync(I,g,b,e)}async _decodeMeshToGeometryForGltfAsync(I,g,b,e,c,z){return await this._decoder._decodeMeshToGeometryForGltfAsync(I,g,b,e,c,z)}async decodeMeshAsync(I,g){const b=await this._decoder.decodeMeshToMeshDataAsync(I,g),e=new M.d;b.indices&&(e.indices=b.indices);for(const c of b.attributes){const I=z.b.GetFloatData(c.data,c.size,z.b.GetDataType(c.data),c.byteOffset,c.byteStride,c.normalized,b.totalVertices);e.set(I,c.kind)}return e}}J.DefaultNumWorkers=(0,e.f)(),J._Default=null},14257:(I,g,b)=>{"use strict";b.d(g,{c:()=>n});var e=b(13138),c=b(12409),z=b(13037),M=b(13152),J=b(12420),o=b(13145);class n extends e.c{static get DefaultAvailable(){return(0,e.i)(n.DefaultConfiguration)}static get Default(){return n._Default??(n._Default=new n),n._Default}static ResetDefault(I){n._Default&&(I||n._Default.dispose(),n._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(I,g){return{module:await(g||DracoDecoderModule)({wasmBinary:I})}}_getWorkerContent(){return`${o.e}(${o.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DefaultConfiguration)}decodeMeshToMeshDataAsync(I,g,b){const e=I instanceof ArrayBuffer?new Int8Array(I):new Int8Array(I.buffer,I.byteOffset,I.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async I=>await new Promise(((c,z)=>{I.push(((I,M)=>{let o=null;const n=[],G=g=>{I.removeEventListener("error",G),I.removeEventListener("message",D),z(g),M()},D=g=>{const e=g.data;switch(e.id){case"indices":o=e.data;break;case"attribute":n.push({kind:e.kind,data:e.data,size:e.size,byteOffset:e.byteOffset,byteStride:e.byteStride,normalized:(z=e.kind,p=e.normalized,b&&void 0!==b[z]?(p!==b[z]&&J.b.Warn(`Normalized flag from Draco data (${p}) does not match normalized flag from glTF accessor (${b[z]}). Using flag from glTF accessor.`),b[z]):p)});break;case"decodeMeshDone":I.removeEventListener("error",G),I.removeEventListener("message",D),c({indices:o,attributes:n,totalVertices:e.totalVertices}),M()}var z,p};I.addEventListener("error",G),I.addEventListener("message",D);const p=e.slice();I.postMessage({id:"decodeMesh",dataView:p,attributes:g},[p.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((I=>{let b=null;const c=[],z=(0,o.e)(I.module,e,g,(I=>{b=I}),((I,g,b,e,z,M)=>{c.push({kind:I,data:g,size:b,byteOffset:e,byteStride:z,normalized:M})}));return{indices:b,attributes:c,totalVertices:z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(I,g,b,e){const c=await this.decodeMeshToMeshDataAsync(b,e),J=new z.d(I,g);c.indices&&J.setIndices(c.indices);for(const z of c.attributes)J.setVerticesBuffer(new M.b(g.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),c.totalVertices);return J}async _decodeMeshToGeometryForGltfAsync(I,g,b,e,c,J){const o=await this.decodeMeshToMeshDataAsync(b,e,c),n=new z.d(I,g);J&&(n._boundingInfo=J,n.useBoundingInfoFromGeometry=!0),o.indices&&n.setIndices(o.indices);for(const z of o.attributes)n.setVerticesBuffer(new M.b(g.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),o.totalVertices);return n}}n.DefaultConfiguration={wasmUrl:`${c.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${c.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},n._Default=null},14451:(I,g,b)=>{"use strict";b.d(g,{e:()=>JI});var e=b(12590),c=b(13027),z=b(12659),M=b(13013),J=b(12648);function o(I){let g=I.pathArray;const b=I.closeArray||!1,e=I.closePath||!1,c=I.invertUV||!1,o=Math.floor(g[0].length/2);let n=I.offset||o;n=n>o?o:Math.floor(n);const G=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,D=I.dI,p=I.YI,x=[],Z=[],k=[],S=[],f=[],V=[],a=[],v=[];let X;const R=[],E=[];let mI,s,F;if(g.length<2){const I=[],b=[];for(s=0;s<g[0].length-n;s++)I.push(g[0][s]),b.push(g[0][s+n]);g=[I,b]}let Y=0;const d=e?1:0,C=b?1:0;let r,O,H,i,U,h;for(X=g[0].length,mI=0;mI<g.length+C;mI++){for(a[mI]=0,f[mI]=[0],r=mI===g.length?g[0]:g[mI],O=r.length,X=X<O?X:O,F=0;F<O;)x.push(r[F].x,r[F].y,r[F].z),F>0&&(H=r[F].ag(r[F-1]).length(),i=H+a[mI],f[mI].push(i),a[mI]=i),F++;e&&(F--,x.push(r[0].x,r[0].y,r[0].z),H=r[F].ag(r[0]).length(),i=H+a[mI],f[mI].push(i),a[mI]=i),R[mI]=O+d,E[mI]=Y,Y+=O+d}let A,j,Q=null,L=null;for(s=0;s<X+d;s++)for(v[s]=0,V[s]=[0],mI=0;mI<g.length-1+C;mI++)U=g[mI],h=mI===g.length-1?g[0]:g[mI+1],s===X?(Q=U[0],L=h[0]):(Q=U[s],L=h[s]),H=L.ag(Q).length(),i=H+v[s],V[s].push(i),v[s]=i;if(D)for(mI=0;mI<D.length;mI++)S.push(D[mI].x,J.d?1-D[mI].y:D[mI].y);else for(mI=0;mI<g.length+C;mI++)for(s=0;s<X+d;s++)A=0!=a[mI]?f[mI][s]/a[mI]:0,j=0!=v[s]?V[s][mI]/v[s]:0,c?S.push(j,A):S.push(A,J.d?1-j:j);mI=0;let N=0,K=R[mI]-1,B=R[mI+1]-1,P=K<B?K:B,u=E[1]-E[0];const t=R.length-1;for(;N<=P&&mI<t;)Z.push(N,N+u,N+1),Z.push(N+u+1,N+1,N+u),N+=1,N===P&&(mI++,u=E[mI+1]-E[mI],K=R[mI]-1,B=R[mI+1]-1,N=E[mI],P=K<B?K+N:B+N);if(M.d.ComputeNormals(x,Z,k),e){let I=0,b=0;for(mI=0;mI<g.length;mI++){I=3*E[mI],b=mI+1<g.length?3*(E[mI+1]-1):k.length-3,k[I]=.5*(k[I]+k[b]),k[I+1]=.5*(k[I+1]+k[b+1]),k[I+2]=.5*(k[I+2]+k[b+2]);const e=Math.sqrt(k[I]*k[I]+k[I+1]*k[I+1]+k[I+2]*k[I+2]);k[I]/=e,k[I+1]/=e,k[I+2]/=e,k[b]=k[I],k[b+1]=k[I+1],k[b+2]=k[I+2]}}if(b){let I=3*E[0],b=3*E[g.length];for(s=0;s<X+d;s++){k[I]=.5*(k[I]+k[b]),k[I+1]=.5*(k[I+1]+k[b+1]),k[I+2]=.5*(k[I+2]+k[b+2]);const g=Math.sqrt(k[I]*k[I]+k[I+1]*k[I+1]+k[I+2]*k[I+2]);k[I]/=g,k[I+1]/=g,k[I+2]/=g,k[b]=k[I],k[b+1]=k[I+1],k[b+2]=k[I+2],I+=3,b+=3}}M.d._ComputeSides(G,x,Z,k,S,I.frontUVs,I.backUVs);let y=null;if(p){y=new Float32Array(4*p.length);for(let I=0;I<p.length;I++)y[4*I]=p[I].r,y[4*I+1]=p[I].g,y[4*I+2]=p[I].b,y[4*I+3]=p[I].a}const q=new M.d,l=new Float32Array(x),w=new Float32Array(k),T=new Float32Array(S);return q.indices=Z,q.sI=l,q.FI=w,q.dI=T,y&&q.set(y,z.f.ColorKind),e&&(q._idx=E),q}function n(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=g.pathArray,G=g.closeArray,D=g.closePath,p=c.e._GetDefaultSideOrientation(g.sideOrientation),x=g.instance,Z=g.updatable;if(x){const I=e.TmpVectors.Vg[0].kb(Number.MAX_VALUE),b=e.TmpVectors.Vg[1].kb(-Number.MAX_VALUE),o=g=>{let e=n[0].length;const z=x;let M=0;const J=z._originalBuilderSideOrientation===c.e.DOUBLESIDE?2:1;for(let c=1;c<=J;++c)for(let J=0;J<n.length;++J){const c=n[J],o=c.length;e=e<o?e:o;for(let z=0;z<e;++z){const e=c[z];g[M]=e.x,g[M+1]=e.y,g[M+2]=e.z,I.minimizeInPlaceFromFloats(e.x,e.y,e.z),b.maximizeInPlaceFromFloats(e.x,e.y,e.z),M+=3}if(z._creationDataStorage&&z._creationDataStorage.closePath){const I=c[0];g[M]=I.x,g[M+1]=I.y,g[M+2]=I.z,M+=3}}},G=x.getVerticesData(z.f.PositionKind);if(o(G),x.hasBoundingInfo?x.getBoundingInfo().reConstruct(I,b,x._worldMatrix):x.buildBoundingInfo(I,b,x._worldMatrix),x.updateVerticesData(z.f.PositionKind,G,!1,!1),g.YI){const I=x.getVerticesData(z.f.ColorKind);for(let b=0,e=0;b<g.YI.length;b++,e+=4){const c=g.YI[b];I[e]=c.r,I[e+1]=c.g,I[e+2]=c.b,I[e+3]=c.a}x.updateVerticesData(z.f.ColorKind,I,!1,!1)}if(g.dI){const I=x.getVerticesData(z.f.UVKind);for(let b=0;b<g.dI.length;b++)I[2*b]=g.dI[b].x,I[2*b+1]=J.d?1-g.dI[b].y:g.dI[b].y;x.updateVerticesData(z.f.UVKind,I,!1,!1)}if(!x.areNormalsFrozen||x.isFacetDataEnabled){const I=x.nb(),g=x.getVerticesData(z.f.NormalKind),b=x.isFacetDataEnabled?x.getFacetDataParameters():null;if(M.d.ComputeNormals(G,I,g,b),x._creationDataStorage&&x._creationDataStorage.closePath){let I=0,b=0;for(let e=0;e<n.length;e++)I=3*x._creationDataStorage.idx[e],b=e+1<n.length?3*(x._creationDataStorage.idx[e+1]-1):g.length-3,g[I]=.5*(g[I]+g[b]),g[I+1]=.5*(g[I+1]+g[b+1]),g[I+2]=.5*(g[I+2]+g[b+2]),g[b]=g[I],g[b+1]=g[I+1],g[b+2]=g[I+2]}x.areNormalsFrozen||x.updateVerticesData(z.f.NormalKind,g,!1,!1)}return x}{const e=new c.e(I,b);e._originalBuilderSideOrientation=p,e._creationDataStorage=new c.f;const z=o(g);return D&&(e._creationDataStorage.idx=z._idx),e._creationDataStorage.closePath=D,e._creationDataStorage.closeArray=G,z.rI(e,Z),e}}M.d.CreateRibbon=o,c.e.CreateRibbon=function(I,g){return n(I,{pathArray:g,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var G=b(13957),D=b(13804),p=b(12637);function x(I){const g=I.pattern||c.e.NO_FLIP,b=I.tileWidth||I.tileSize||1,e=I.tileHeight||I.tileSize||1,z=I.alignHorizontal||0,J=I.alignVertical||0,o=I.width||I.size||1,n=Math.floor(o/b);let G=o-n*b;const D=I.height||I.size||1,p=Math.floor(D/e);let x=D-p*e;const Z=b*n/2,k=e*p/2;let S=0,f=0,V=0,a=0,v=0,X=0;if(G>0||x>0){switch(V=-Z,a=-k,v=Z,X=k,z){case c.e.CENTER:G/=2,V-=G,v+=G;break;case c.e.LEFT:v+=G,S=-G/2;break;case c.e.RIGHT:V-=G,S=G/2}switch(J){case c.e.CENTER:x/=2,a-=x,X+=x;break;case c.e.BOTTOM:X+=x,f=-x/2;break;case c.e.TOP:a-=x,f=x/2}}const R=[],E=[],mI=[];mI[0]=[0,0,1,0,1,1,0,1],mI[1]=[0,0,1,0,1,1,0,1],g!==c.e.ROTATE_TILE&&g!==c.e.ROTATE_ROW||(mI[1]=[1,1,0,1,0,0,1,0]),g!==c.e.FLIP_TILE&&g!==c.e.FLIP_ROW||(mI[1]=[1,0,0,0,0,1,1,1]),g!==c.e.FLIP_N_ROTATE_TILE&&g!==c.e.FLIP_N_ROTATE_ROW||(mI[1]=[0,1,1,1,1,0,0,0]);let s=[];const F=[],Y=[];let d=0;for(let M=0;M<p;M++)for(let I=0;I<n;I++)R.push(I*b-Z+S,M*e-k+f,0),R.push((I+1)*b-Z+S,M*e-k+f,0),R.push((I+1)*b-Z+S,(M+1)*e-k+f,0),R.push(I*b-Z+S,(M+1)*e-k+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),s=g===c.e.FLIP_TILE||g===c.e.ROTATE_TILE||g===c.e.FLIP_N_ROTATE_TILE?s.concat(mI[(I%2+M%2)%2]):g===c.e.FLIP_ROW||g===c.e.ROTATE_ROW||g===c.e.FLIP_N_ROTATE_ROW?s.concat(mI[M%2]):s.concat(mI[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(G>0||x>0){const I=x>0&&(J===c.e.CENTER||J===c.e.TOP),M=x>0&&(J===c.e.CENTER||J===c.e.BOTTOM),o=G>0&&(z===c.e.CENTER||z===c.e.RIGHT),D=G>0&&(z===c.e.CENTER||z===c.e.LEFT);let mI,C,r,O,H=[];if(I&&o&&(R.push(V+S,a+f,0),R.push(-Z+S,a+f,0),R.push(-Z+S,a+x+f,0),R.push(V+S,a+x+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,mI=1-G/b,C=1-x/e,r=1,O=1,H=[mI,C,r,C,r,O,mI,O],g===c.e.ROTATE_ROW&&(H=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),g===c.e.FLIP_ROW&&(H=[1-mI,C,1-r,C,1-r,O,1-mI,O]),g===c.e.FLIP_N_ROTATE_ROW&&(H=[mI,1-C,r,1-C,r,1-O,mI,1-O]),s=s.concat(H),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&D&&(R.push(Z+S,a+f,0),R.push(v+S,a+f,0),R.push(v+S,a+x+f,0),R.push(Z+S,a+x+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,mI=0,C=1-x/e,r=G/b,O=1,H=[mI,C,r,C,r,O,mI,O],(g===c.e.ROTATE_ROW||g===c.e.ROTATE_TILE&&n%2===0)&&(H=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),(g===c.e.FLIP_ROW||g===c.e.FLIP_TILE&&n%2===0)&&(H=[1-mI,C,1-r,C,1-r,O,1-mI,O]),(g===c.e.FLIP_N_ROTATE_ROW||g===c.e.FLIP_N_ROTATE_TILE&&n%2===0)&&(H=[mI,1-C,r,1-C,r,1-O,mI,1-O]),s=s.concat(H),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&o&&(R.push(V+S,k+f,0),R.push(-Z+S,k+f,0),R.push(-Z+S,X+f,0),R.push(V+S,X+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,mI=1-G/b,C=0,r=1,O=x/e,H=[mI,C,r,C,r,O,mI,O],(g===c.e.ROTATE_ROW&&p%2===1||g===c.e.ROTATE_TILE&&p%1===0)&&(H=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),(g===c.e.FLIP_ROW&&p%2===1||g===c.e.FLIP_TILE&&p%2===0)&&(H=[1-mI,C,1-r,C,1-r,O,1-mI,O]),(g===c.e.FLIP_N_ROTATE_ROW&&p%2===1||g===c.e.FLIP_N_ROTATE_TILE&&p%2===0)&&(H=[mI,1-C,r,1-C,r,1-O,mI,1-O]),s=s.concat(H),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),M&&D&&(R.push(Z+S,k+f,0),R.push(v+S,k+f,0),R.push(v+S,X+f,0),R.push(Z+S,X+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,mI=0,C=0,r=G/b,O=x/e,H=[mI,C,r,C,r,O,mI,O],(g===c.e.ROTATE_ROW&&p%2===1||g===c.e.ROTATE_TILE&&(p+n)%2===1)&&(H=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),(g===c.e.FLIP_ROW&&p%2===1||g===c.e.FLIP_TILE&&(p+n)%2===1)&&(H=[1-mI,C,1-r,C,1-r,O,1-mI,O]),(g===c.e.FLIP_N_ROTATE_ROW&&p%2===1||g===c.e.FLIP_N_ROTATE_TILE&&(p+n)%2===1)&&(H=[mI,1-C,r,1-C,r,1-O,mI,1-O]),s=s.concat(H),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I){const I=[];mI=0,C=1-x/e,r=1,O=1,I[0]=[mI,C,r,C,r,O,mI,O],I[1]=[mI,C,r,C,r,O,mI,O],g!==c.e.ROTATE_TILE&&g!==c.e.ROTATE_ROW||(I[1]=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),g!==c.e.FLIP_TILE&&g!==c.e.FLIP_ROW||(I[1]=[1-mI,C,1-r,C,1-r,O,1-mI,O]),g!==c.e.FLIP_N_ROTATE_TILE&&g!==c.e.FLIP_N_ROTATE_ROW||(I[1]=[mI,1-C,r,1-C,r,1-O,mI,1-O]);for(let e=0;e<n;e++)R.push(e*b-Z+S,a+f,0),R.push((e+1)*b-Z+S,a+f,0),R.push((e+1)*b-Z+S,a+x+f,0),R.push(e*b-Z+S,a+x+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,s=g===c.e.FLIP_TILE||g===c.e.ROTATE_TILE||g===c.e.FLIP_N_ROTATE_TILE?s.concat(I[(e+1)%2]):g===c.e.FLIP_ROW||g===c.e.ROTATE_ROW||g===c.e.FLIP_N_ROTATE_ROW?s.concat(I[1]):s.concat(I[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const I=[];mI=0,C=0,r=1,O=x/e,I[0]=[mI,C,r,C,r,O,mI,O],I[1]=[mI,C,r,C,r,O,mI,O],g!==c.e.ROTATE_TILE&&g!==c.e.ROTATE_ROW||(I[1]=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),g!==c.e.FLIP_TILE&&g!==c.e.FLIP_ROW||(I[1]=[1-mI,C,1-r,C,1-r,O,1-mI,O]),g!==c.e.FLIP_N_ROTATE_TILE&&g!==c.e.FLIP_N_ROTATE_ROW||(I[1]=[mI,1-C,r,1-C,r,1-O,mI,1-O]);for(let e=0;e<n;e++)R.push(e*b-Z+S,X-x+f,0),R.push((e+1)*b-Z+S,X-x+f,0),R.push((e+1)*b-Z+S,X+f,0),R.push(e*b-Z+S,X+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,s=g===c.e.FLIP_TILE||g===c.e.ROTATE_TILE||g===c.e.FLIP_N_ROTATE_TILE?s.concat(I[(e+p)%2]):g===c.e.FLIP_ROW||g===c.e.ROTATE_ROW||g===c.e.FLIP_N_ROTATE_ROW?s.concat(I[p%2]):s.concat(I[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const I=[];mI=1-G/b,C=0,r=1,O=1,I[0]=[mI,C,r,C,r,O,mI,O],I[1]=[mI,C,r,C,r,O,mI,O],g!==c.e.ROTATE_TILE&&g!==c.e.ROTATE_ROW||(I[1]=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),g!==c.e.FLIP_TILE&&g!==c.e.FLIP_ROW||(I[1]=[1-mI,C,1-r,C,1-r,O,1-mI,O]),g!==c.e.FLIP_N_ROTATE_TILE&&g!==c.e.FLIP_N_ROTATE_ROW||(I[1]=[mI,1-C,r,1-C,r,1-O,mI,1-O]);for(let b=0;b<p;b++)R.push(V+S,b*e-k+f,0),R.push(V+G+S,b*e-k+f,0),R.push(V+G+S,(b+1)*e-k+f,0),R.push(V+S,(b+1)*e-k+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,s=g===c.e.FLIP_TILE||g===c.e.ROTATE_TILE||g===c.e.FLIP_N_ROTATE_TILE?s.concat(I[(b+1)%2]):g===c.e.FLIP_ROW||g===c.e.ROTATE_ROW||g===c.e.FLIP_N_ROTATE_ROW?s.concat(I[b%2]):s.concat(I[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(D){const I=[];mI=0,C=0,r=G/e,O=1,I[0]=[mI,C,r,C,r,O,mI,O],I[1]=[mI,C,r,C,r,O,mI,O],g!==c.e.ROTATE_TILE&&g!==c.e.ROTATE_ROW||(I[1]=[1-mI,1-C,1-r,1-C,1-r,1-O,1-mI,1-O]),g!==c.e.FLIP_TILE&&g!==c.e.FLIP_ROW||(I[1]=[1-mI,C,1-r,C,1-r,O,1-mI,O]),g!==c.e.FLIP_N_ROTATE_TILE&&g!==c.e.FLIP_N_ROTATE_ROW||(I[1]=[mI,1-C,r,1-C,r,1-O,mI,1-O]);for(let b=0;b<p;b++)R.push(v-G+S,b*e-k+f,0),R.push(v+S,b*e-k+f,0),R.push(v+S,(b+1)*e-k+f,0),R.push(v-G+S,(b+1)*e-k+f,0),Y.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,s=g===c.e.FLIP_TILE||g===c.e.ROTATE_TILE||g===c.e.FLIP_N_ROTATE_TILE?s.concat(I[(b+n)%2]):g===c.e.FLIP_ROW||g===c.e.ROTATE_ROW||g===c.e.FLIP_N_ROTATE_ROW?s.concat(I[b%2]):s.concat(I[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),E.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const C=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE;M.d._ComputeSides(C,R,Y,E,s,I.frontUVs,I.backUVs);const r=new M.d;r.indices=Y,r.sI=R,r.FI=E,r.dI=s;const O=C===M.d.DOUBLESIDE?F.concat(F):F;return r.YI=O,r}function Z(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return x(g).rI(e,g.updatable),e}function k(I){const g=I.faceUV||new Array(6),b=I.faceColors,z=I.pattern||c.e.NO_FLIP,o=I.width||I.size||1,n=I.height||I.size||1,G=I.depth||I.size||1,D=I.tileWidth||I.tileSize||1,Z=I.tileHeight||I.tileSize||1,k=I.alignHorizontal||0,S=I.alignVertical||0,f=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE;for(let c=0;c<6;c++)void 0===g[c]&&(g[c]=new e.Vector4(0,0,1,1)),b&&void 0===b[c]&&(b[c]=new p.Sb(1,1,1,1));const V=o/2,a=n/2,v=G/2,X=[];for(let e=0;e<2;e++)X[e]=x({pattern:z,tileWidth:D,tileHeight:Z,width:o,height:n,alignVertical:S,alignHorizontal:k,sideOrientation:f});for(let e=2;e<4;e++)X[e]=x({pattern:z,tileWidth:D,tileHeight:Z,width:G,height:n,alignVertical:S,alignHorizontal:k,sideOrientation:f});let R=S;S===c.e.BOTTOM?R=c.e.TOP:S===c.e.TOP&&(R=c.e.BOTTOM);for(let e=4;e<6;e++)X[e]=x({pattern:z,tileWidth:D,tileHeight:Z,width:o,height:G,alignVertical:R,alignHorizontal:k,sideOrientation:f});let E=[],mI=[],s=[],F=[];const Y=[],d=[],C=[],r=[];let O=0,H=0;for(let c=0;c<6;c++){const I=X[c].sI.length;d[c]=[],C[c]=[];for(let g=0;g<I/3;g++)d[c].push(new e.Vg(X[c].sI[3*g],X[c].sI[3*g+1],X[c].sI[3*g+2])),C[c].push(new e.Vg(X[c].FI[3*g],X[c].FI[3*g+1],X[c].FI[3*g+2]));O=X[c].dI.length,r[c]=[];for(let b=0;b<O;b+=2)r[c][b]=g[c].x+(g[c].z-g[c].x)*X[c].dI[b],r[c][b+1]=g[c].y+(g[c].w-g[c].y)*X[c].dI[b+1],J.d&&(r[c][b+1]=1-r[c][b+1]);if(s=s.concat(r[c]),F=F.concat(X[c].indices.map((I=>I+H))),H+=d[c].length,b)for(let g=0;g<4;g++)Y.push(b[c].r,b[c].g,b[c].b,b[c].a)}const i=new e.Vg(0,0,v),U=e.Matrix.RotationY(Math.PI);E=d[0].map((I=>e.Vg.TransformNormal(I,U).add(i))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]),mI=C[0].map((I=>e.Vg.TransformNormal(I,U))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]),E=E.concat(d[1].map((I=>I.ag(i))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),mI=mI.concat(C[1].map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]));const h=new e.Vg(V,0,0),A=e.Matrix.RotationY(-Math.PI/2);E=E.concat(d[2].map((I=>e.Vg.TransformNormal(I,A).add(h))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),mI=mI.concat(C[2].map((I=>e.Vg.TransformNormal(I,A))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]));const j=e.Matrix.RotationY(Math.PI/2);E=E.concat(d[3].map((I=>e.Vg.TransformNormal(I,j).ag(h))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),mI=mI.concat(C[3].map((I=>e.Vg.TransformNormal(I,j))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]));const Q=new e.Vg(0,a,0),L=e.Matrix.RotationX(Math.PI/2);E=E.concat(d[4].map((I=>e.Vg.TransformNormal(I,L).add(Q))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),mI=mI.concat(C[4].map((I=>e.Vg.TransformNormal(I,L))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[]));const N=e.Matrix.RotationX(-Math.PI/2);E=E.concat(d[5].map((I=>e.Vg.TransformNormal(I,N).ag(Q))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),mI=mI.concat(C[5].map((I=>e.Vg.TransformNormal(I,N))).map((I=>[I.x,I.y,I.z])).reduce(((I,g)=>I.concat(g)),[])),M.d._ComputeSides(f,E,F,mI,s);const K=new M.d;if(K.indices=F,K.sI=E,K.FI=mI,K.dI=s,b){const I=f===M.d.DOUBLESIDE?Y.concat(Y):Y;K.YI=I}return K}function S(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return k(g).rI(e,g.updatable),e}M.d.CreateTiledPlane=x;M.d.CreateTiledBox=k;var f=b(13947),V=b(12814),a=b(12782);function v(I){const g=I.height||2;let b=0===I.diameterTop?0:I.diameterTop||I.diameter||1,z=0===I.diameterBottom?0:I.diameterBottom||I.diameter||1;b=b||1e-5,z=z||1e-5;const o=0|(I.tessellation||24),n=0|(I.subdivisions||1),G=!!I.hasRings,D=!!I.enclose,x=0===I.cap?0:I.cap||c.e.CAP_ALL,Z=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,k=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,S=I.faceUV||new Array(3),f=I.faceColors,V=2+(1+(1!==Z&&D?2:0))*(G?n:1);let v;for(v=0;v<V;v++)f&&void 0===f[v]&&(f[v]=new p.Sb(1,1,1,1));for(v=0;v<V;v++)S&&void 0===S[v]&&(S[v]=new e.Vector4(0,0,1,1));const X=[],R=[],E=[],mI=[],s=[],F=2*Math.PI*Z/o;let Y,d,C;const r=(z-b)/2/g,O=e.Vg.Zero(),H=e.Vg.Zero(),i=e.Vg.Zero(),U=e.Vg.Zero(),h=e.Vg.Zero(),A=a.c.Y;let j,Q,L,N=1,K=1,B=0,P=0;for(j=0;j<=n;j++)for(d=j/n,C=(d*(b-z)+z)/2,N=G&&0!==j&&j!==n?2:1,L=0;L<N;L++){for(G&&(K+=L),D&&(K+=2*L),Q=0;Q<=o;Q++)Y=Q*F,O.x=Math.cos(-Y)*C,O.y=-g/2+d*g,O.z=Math.sin(-Y)*C,0===b&&j===n?(H.x=E[E.length-3*(o+1)],H.y=E[E.length-3*(o+1)+1],H.z=E[E.length-3*(o+1)+2]):(H.x=O.x,H.z=O.z,H.y=Math.sqrt(H.x*H.x+H.z*H.z)*r,H.normalize()),0===Q&&(i.G(O),U.G(H)),R.push(O.x,O.y,O.z),E.push(H.x,H.y,H.z),P=G?B!==K?S[K].y:S[K].w:S[K].y+(S[K].w-S[K].y)*d,mI.push(S[K].x+(S[K].z-S[K].x)*Q/o,J.d?1-P:P),f&&s.push(f[K].r,f[K].g,f[K].b,f[K].a);1!==Z&&D&&(R.push(O.x,O.y,O.z),R.push(0,O.y,0),R.push(0,O.y,0),R.push(i.x,i.y,i.z),e.Vg.CrossToRef(A,H,h),h.normalize(),E.push(h.x,h.y,h.z,h.x,h.y,h.z),e.Vg.CrossToRef(U,A,h),h.normalize(),E.push(h.x,h.y,h.z,h.x,h.y,h.z),P=G?B!==K?S[K+1].y:S[K+1].w:S[K+1].y+(S[K+1].w-S[K+1].y)*d,mI.push(S[K+1].x,J.d?1-P:P),mI.push(S[K+1].z,J.d?1-P:P),P=G?B!==K?S[K+2].y:S[K+2].w:S[K+2].y+(S[K+2].w-S[K+2].y)*d,mI.push(S[K+2].x,J.d?1-P:P),mI.push(S[K+2].z,J.d?1-P:P),f&&(s.push(f[K+1].r,f[K+1].g,f[K+1].b,f[K+1].a),s.push(f[K+1].r,f[K+1].g,f[K+1].b,f[K+1].a),s.push(f[K+2].r,f[K+2].g,f[K+2].b,f[K+2].a),s.push(f[K+2].r,f[K+2].g,f[K+2].b,f[K+2].a))),B!==K&&(B=K)}const u=1!==Z&&D?o+4:o;for(j=0,K=0;K<n;K++){let I=0,g=0,b=0,e=0;for(Q=0;Q<o;Q++)I=j*(u+1)+Q,g=(j+1)*(u+1)+Q,b=j*(u+1)+(Q+1),e=(j+1)*(u+1)+(Q+1),X.push(I,g,b),X.push(e,b,g);1!==Z&&D&&(X.push(I+2,g+2,b+2),X.push(e+2,b+2,g+2),X.push(I+4,g+4,b+4),X.push(e+4,b+4,g+4)),j=G?j+2:j+1}const t=I=>{const c=I?b/2:z/2;if(0===c)return;let M,n,G;const D=I?S[V-1]:S[0];let p=null;f&&(p=I?f[V-1]:f[0]);const x=R.length/3,k=I?g/2:-g/2,a=new e.Vg(0,k,0);R.push(a.x,a.y,a.z),E.push(0,I?1:-1,0);const v=D.y+.5*(D.w-D.y);mI.push(D.x+.5*(D.z-D.x),J.d?1-v:v),p&&s.push(p.r,p.g,p.b,p.a);const F=new e.Vector2(.5,.5);for(G=0;G<=o;G++){M=2*Math.PI*G*Z/o;const g=Math.cos(-M),b=Math.sin(-M);n=new e.Vg(g*c,k,b*c);const z=new e.Vector2(g*F.x+.5,b*F.y+.5);R.push(n.x,n.y,n.z),E.push(0,I?1:-1,0);const x=D.y+(D.w-D.y)*z.y;mI.push(D.x+(D.z-D.x)*z.x,J.d?1-x:x),p&&s.push(p.r,p.g,p.b,p.a)}for(G=0;G<o;G++)I?(X.push(x),X.push(x+(G+2)),X.push(x+(G+1))):(X.push(x),X.push(x+(G+1)),X.push(x+(G+2)))};x!==c.e.CAP_START&&x!==c.e.CAP_ALL||t(!1),x!==c.e.CAP_END&&x!==c.e.CAP_ALL||t(!0),M.d._ComputeSides(k,R,X,E,mI,I.frontUVs,I.backUVs);const y=new M.d;return y.indices=X,y.sI=R,y.FI=E,y.dI=mI,f&&(y.YI=s),y}function X(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return v(g).rI(e,g.updatable),e}function R(I){const g=[],b=[],c=[],z=[],o=I.diameter||1,n=I.thickness||.5,G=0|(I.tessellation||16),D=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,p=G+1;for(let M=0;M<=G;M++){const I=M/G,D=M*Math.PI*2/G-Math.PI/2,x=e.Matrix.Translation(o/2,0,0).multiply(e.Matrix.RotationY(D));for(let o=0;o<=G;o++){const D=1-o/G,Z=o*Math.PI*2/G+Math.PI,k=Math.cos(Z),S=Math.sin(Z);let f=new e.Vg(k,S,0),V=f.scale(n/2);const a=new e.Vector2(I,D);V=e.Vg.TransformCoordinates(V,x),f=e.Vg.TransformNormal(f,x),b.push(V.x,V.y,V.z),c.push(f.x,f.y,f.z),z.push(a.x,J.d?1-a.y:a.y);const v=(M+1)%p,X=(o+1)%p;g.push(M*p+o),g.push(M*p+X),g.push(v*p+o),g.push(M*p+X),g.push(v*p+X),g.push(v*p+o)}}M.d._ComputeSides(D,b,g,c,z,I.frontUVs,I.backUVs);const x=new M.d;return x.indices=g,x.sI=b,x.FI=c,x.dI=z,x}function E(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return R(g).rI(e,g.updatable),e}M.d.CreateCylinder=v,c.e.CreateCylinder=(I,g,b,e,z,M,J,o,n)=>{void 0!==J&&J instanceof V.c||(void 0!==J&&(n=o||c.e.DEFAULTSIDE,o=J),J=M,M=1);return X(I,{height:g,diameterTop:b,diameterBottom:e,tessellation:z,subdivisions:M,sideOrientation:n,updatable:o},J)};function mI(I){const g=[],b=[],c=[],z=[],o=I.radius||2,n=I.tube||.5,G=I.radialSegments||32,D=I.tubularSegments||32,p=I.p||2,x=I.q||3,Z=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,k=I=>{const g=Math.cos(I),b=Math.sin(I),c=x/p*I,z=Math.cos(c),M=o*(2+z)*.5*g,J=o*(2+z)*b*.5,n=o*Math.sin(c)*.5;return new e.Vg(M,J,n)};let S,f;for(S=0;S<=G;S++){const I=S%G/G*2*p*Math.PI,g=k(I),c=k(I+.01),M=c.ag(g);let o=c.add(g);const x=e.Vg.Cross(M,o);for(o=e.Vg.Cross(x,M),x.normalize(),o.normalize(),f=0;f<D;f++){const I=f%D/D*2*Math.PI,e=-n*Math.cos(I),c=n*Math.sin(I);b.push(g.x+e*o.x+c*x.x),b.push(g.y+e*o.y+c*x.y),b.push(g.z+e*o.z+c*x.z),z.push(S/G),z.push(J.d?1-f/D:f/D)}}for(S=0;S<G;S++)for(f=0;f<D;f++){const I=(f+1)%D,b=S*D+f,e=(S+1)*D+f,c=(S+1)*D+I,z=S*D+I;g.push(z),g.push(e),g.push(b),g.push(z),g.push(c),g.push(e)}M.d.ComputeNormals(b,g,c),M.d._ComputeSides(Z,b,g,c,z,I.frontUVs,I.backUVs);const V=new M.d;return V.indices=g,V.sI=b,V.FI=c,V.dI=z,V}function s(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return mI(g).rI(e,g.updatable),e}M.d.CreateTorus=R,c.e.CreateTorus=(I,g,b,e,c,z,M)=>E(I,{diameter:g,thickness:b,tessellation:e,sideOrientation:M,updatable:z},c);M.d.CreateTorusKnot=mI,c.e.CreateTorusKnot=(I,g,b,e,c,z,M,J,o,n)=>s(I,{radius:g,tube:b,radialSegments:e,tubularSegments:c,p:z,q:M,sideOrientation:n,updatable:o},J);var F=b(14457),Y=b(13129),d=b(12791);function C(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=g.path,z=g.shape,M=g.scale||1,J=g.rotation||0,o=0===g.cap?0:g.cap||c.e.NO_CAP,n=g.updatable,G=c.e._GetDefaultSideOrientation(g.sideOrientation),D=g.instance||null,p=g.invertUV||!1,x=g.closeShape||!1,Z=g.closePath||!1,k=g.capFunction||null;return O(I,z,e,M,J,null,null,Z,x,o,!1,b,!!n,G,D,p,g.frontUVs||null,g.backUVs||null,g.firstNormal||null,!!g.adjustFrame,k)}function r(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=g.path,z=g.shape,M=g.scaleFunction||(()=>1),J=g.rotationFunction||(()=>0),o=g.closePath||g.ribbonCloseArray||!1,n=g.closeShape||g.ribbonClosePath||!1,G=0===g.cap?0:g.cap||c.e.NO_CAP,D=g.updatable,p=g.firstNormal||null,x=g.adjustFrame||!1,Z=c.e._GetDefaultSideOrientation(g.sideOrientation),k=g.instance,S=g.invertUV||!1,f=g.capFunction||null;return O(I,z,e,null,null,M,J,o,n,G,!0,b,!!D,Z,k||null,S,g.frontUVs||null,g.backUVs||null,p,x,f||null)}function O(I,g,b,z,M,J,o,G,D,p,x,Z,k,S,f,V,a,v,X,R,E){const mI=(I,g,b,z,M,J,o,n,G,D,p)=>{const x=b.getTangents(),Z=b.getNormals(),k=b.getBinormals(),S=b.getDistances();if(p)for(let c=0;c<x.length;c++)if(0==x[c].x&&0==x[c].y&&0==x[c].z&&x[c].G(x[c-1]),0==Z[c].x&&0==Z[c].y&&0==Z[c].z&&Z[c].G(Z[c-1]),0==k[c].x&&0==k[c].y&&0==k[c].z&&k[c].G(k[c-1]),c>0){let I=x[c-1];e.Vg.Dot(I,x[c])<0&&x[c].scaleInPlace(-1),I=Z[c-1],e.Vg.Dot(I,Z[c])<0&&Z[c].scaleInPlace(-1),I=k[c-1],e.Vg.Dot(I,k[c])<0&&k[c].scaleInPlace(-1)}let f=0;const V=D&&n?n:()=>null!==J?J:0,a=D&&o?o:()=>null!==M?M:1;let v=G===c.e.NO_CAP||G===c.e.CAP_END?0:2;const X=e.TmpVectors.Matrix[0];for(let c=0;c<g.length;c++){const b=[],M=V(c,S[c]),J=a(c,S[c]);e.Matrix.RotationAxisToRef(x[c],f,X);for(let z=0;z<I.length;z++){const M=x[c].scale(I[z].z).add(Z[c].scale(I[z].x)).add(k[c].scale(I[z].y)),o=e.Vg.Zero();e.Vg.TransformCoordinatesToRef(M,X,o),o.scaleInPlace(J).addInPlace(g[c]),b[z]=o}z[v]=b,f+=M,v++}const R=E||(I=>{const g=Array(),b=e.Vg.Zero();let c;for(c=0;c<I.length;c++)b.addInPlace(I[c]);for(b.scaleInPlace(1/I.length),c=0;c<I.length;c++)g.push(b);return g});switch(G){case c.e.NO_CAP:break;case c.e.CAP_START:z[0]=R(z[2]),z[1]=z[2];break;case c.e.CAP_END:z[v]=z[v-1],z[v+1]=R(z[v-1]);break;case c.e.CAP_ALL:z[0]=R(z[2]),z[1]=z[2],z[v]=z[v-1],z[v+1]=R(z[v-1])}return z};let s,F;if(f){const I=f._creationDataStorage;return s=X?I.path3D.update(b,X):I.path3D.update(b),F=mI(g,b,I.path3D,I.pathArray,z,M,J,o,I.cap,x,R),f=n("",{pathArray:F,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},Z||void 0)}s=X?new d.l(b,X):new d.l(b);F=mI(g,b,s,new Array,z,M,J,o,p=p<0||p>3?0:p,x,R);const Y=n(I,{pathArray:F,closeArray:G,closePath:D,updatable:k,sideOrientation:S,invertUV:V,frontUVs:a||void 0,backUVs:v||void 0},Z);return Y._creationDataStorage.pathArray=F,Y._creationDataStorage.path3D=s,Y._creationDataStorage.cap=p,Y}function H(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=g.arc?g.arc<=0||g.arc>1?1:g.arc:1,M=void 0===g.closed||g.closed,J=g.shape,o=g.radius||1,G=g.tessellation||64,D=g.clip||0,p=g.updatable,x=c.e._GetDefaultSideOrientation(g.sideOrientation),Z=g.cap||c.e.NO_CAP,k=2*Math.PI,S=[],f=g.invertUV||!1;let V=0,a=0;const v=k/G*z;let X,R;for(V=0;V<=G-D;V++){for(R=[],Z!=c.e.CAP_START&&Z!=c.e.CAP_ALL||(R.push(new e.Vg(0,J[0].y,0)),R.push(new e.Vg(Math.cos(V*v)*J[0].x*o,J[0].y,Math.sin(V*v)*J[0].x*o))),a=0;a<J.length;a++)X=new e.Vg(Math.cos(V*v)*J[a].x*o,J[a].y,Math.sin(V*v)*J[a].x*o),R.push(X);Z!=c.e.CAP_END&&Z!=c.e.CAP_ALL||(R.push(new e.Vg(Math.cos(V*v)*J[J.length-1].x*o,J[J.length-1].y,Math.sin(V*v)*J[J.length-1].x*o)),R.push(new e.Vg(0,J[J.length-1].y,0))),S.push(R)}return n(I,{pathArray:S,closeArray:M,sideOrientation:x,updatable:p,invertUV:f,frontUVs:g.frontUVs,backUVs:g.backUVs},b)}c.e.ExtrudeShape=function(I,g,b,e,z,M){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7?arguments[7]:void 0,n=arguments.length>8?arguments[8]:void 0,G=arguments.length>9?arguments[9]:void 0;return C(I,{shape:g,path:b,scale:e,rotation:z,cap:0===M?0:M||c.e.NO_CAP,sideOrientation:n,instance:G,updatable:o},J)},c.e.ExtrudeShapeCustom=(I,g,b,e,z,M,J,o,n,G,D,p)=>r(I,{shape:g,path:b,scaleFunction:e,rotationFunction:z,ribbonCloseArray:M,ribbonClosePath:J,cap:0===o?0:o||c.e.NO_CAP,sideOrientation:D,instance:p,updatable:G},n);c.e.CreateLathe=(I,g,b,e,c,z,M)=>H(I,{shape:g,radius:b,tessellation:e,sideOrientation:M,updatable:z},c);var i=b(13865),U=b(13811);function h(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=g.path;let M=g.instance,J=1;void 0!==g.radius?J=g.radius:M&&(J=M._creationDataStorage.radius);const o=g.tessellation||64,G=g.radiusFunction||null;let D=g.cap||c.e.NO_CAP;const p=g.invertUV||!1,x=g.updatable,Z=c.e._GetDefaultSideOrientation(g.sideOrientation);g.arc=g.arc&&(g.arc<=0||g.arc>1)?1:g.arc||1;const k=(I,g,b,z,M,J,o,n)=>{const G=g.getTangents(),D=g.getNormals(),p=g.getDistances(),x=2*Math.PI/M*n,Z=J||(()=>z);let k,S,f,V;const a=e.TmpVectors.Matrix[0];let v=o===c.e.NO_CAP||o===c.e.CAP_END?0:2;for(let c=0;c<I.length;c++){S=Z(c,p[c]),k=Array(),f=D[c];for(let g=0;g<M;g++)e.Matrix.RotationAxisToRef(G[c],x*g,a),V=k[g]?k[g]:e.Vg.Zero(),e.Vg.TransformCoordinatesToRef(f,a,V),V.scaleInPlace(S).addInPlace(I[c]),k[g]=V;b[v]=k,v++}const X=(g,b)=>{const e=Array();for(let c=0;c<g;c++)e.push(I[b]);return e};switch(o){case c.e.NO_CAP:break;case c.e.CAP_START:b[0]=X(M,0),b[1]=b[2].slice(0);break;case c.e.CAP_END:b[v]=b[v-1].slice(0),b[v+1]=X(M,I.length-1);break;case c.e.CAP_ALL:b[0]=X(M,0),b[1]=b[2].slice(0),b[v]=b[v-1].slice(0),b[v+1]=X(M,I.length-1)}return b};let S,f;if(M){const I=M._creationDataStorage,b=g.arc||I.arc;return S=I.path3D.update(z),f=k(z,S,I.pathArray,J,I.tessellation,G,I.cap,b),M=n("",{pathArray:f,instance:M}),I.path3D=S,I.pathArray=f,I.arc=b,I.radius=J,M}S=new d.l(z);D=D<0||D>3?0:D,f=k(z,S,new Array,J,o,G,D,g.arc);const V=n(I,{pathArray:f,closePath:!0,closeArray:!1,updatable:x,sideOrientation:Z,invertUV:p,frontUVs:g.frontUVs,backUVs:g.backUVs},b);return V._creationDataStorage.pathArray=f,V._creationDataStorage.path3D=S,V._creationDataStorage.tessellation=o,V._creationDataStorage.cap=D,V._creationDataStorage.arc=g.arc,V._creationDataStorage.radius=J,V}function A(I){const g=[];g[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},g[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},g[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},g[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},g[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},g[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},g[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},g[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},g[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},g[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},g[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},g[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},g[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},g[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},g[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=I.type&&(I.type<0||I.type>=g.length)?0:I.type||0,c=I.size,z=I.sizeX||c||1,o=I.sizeY||c||1,n=I.sizeZ||c||1,G=I.custom||g[b],D=G.face.length,x=I.faceUV||new Array(D),Z=I.faceColors,k=void 0===I.flat||I.flat,S=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,f=[],V=[],a=[],v=[],X=[];let R=0,E=0;const mI=[];let s,F,Y,d,C,r,O=0,H=0;if(k)for(H=0;H<D;H++)Z&&void 0===Z[H]&&(Z[H]=new p.Sb(1,1,1,1)),x&&void 0===x[H]&&(x[H]=new e.Vector4(0,0,1,1));if(k)for(H=0;H<D;H++){const I=G.face[H].length;for(Y=2*Math.PI/I,d=.5*Math.tan(Y/2),C=.5,O=0;O<I;O++)f.push(G.vertex[G.face[H][O]][0]*z,G.vertex[G.face[H][O]][1]*o,G.vertex[G.face[H][O]][2]*n),mI.push(R),R++,s=x[H].x+(x[H].z-x[H].x)*(.5+d),F=x[H].y+(x[H].w-x[H].y)*(C-.5),v.push(s,J.d?1-F:F),r=d*Math.cos(Y)-C*Math.sin(Y),C=d*Math.sin(Y)+C*Math.cos(Y),d=r,Z&&X.push(Z[H].r,Z[H].g,Z[H].b,Z[H].a);for(O=0;O<I-2;O++)V.push(mI[0+E],mI[O+2+E],mI[O+1+E]);E+=I}else{for(O=0;O<G.vertex.length;O++)f.push(G.vertex[O][0]*z,G.vertex[O][1]*o,G.vertex[O][2]*n),v.push(0,J.d?1:0);for(H=0;H<D;H++)for(O=0;O<G.face[H].length-2;O++)V.push(G.face[H][0],G.face[H][O+2],G.face[H][O+1])}M.d.ComputeNormals(f,V,a),M.d._ComputeSides(S,f,V,a,v,I.frontUVs,I.backUVs);const i=new M.d;return i.sI=f,i.indices=V,i.FI=a,i.dI=v,Z&&k&&(i.YI=X),i}function j(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return A(g).rI(e,g.updatable),e}c.e.CreateTube=(I,g,b,e,c,z,M,J,o,n)=>h(I,{path:g,radius:b,tessellation:e,radiusFunction:c,arc:1,cap:z,updatable:J,sideOrientation:o,instance:n},M);function Q(I){const g=I.sideOrientation||M.d.DEFAULTSIDE,b=I.radius||1,c=void 0===I.flat||I.flat,z=0|(I.subdivisions||4),o=I.radiusX||b,n=I.radiusY||b,G=I.radiusZ||b,D=(1+Math.sqrt(5))/2,p=[-1,D,-0,1,D,0,-1,-D,0,1,-D,0,0,-1,-D,0,1,-D,0,-1,D,0,1,D,D,0,1,D,0,-1,-D,0,1,-D,0,-1],x=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Z=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],k=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],S=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],f=[],V=[],a=[],v=[];let X=0;const R=new Array(3),E=new Array(3);let mI;for(mI=0;mI<3;mI++)R[mI]=e.Vg.Zero(),E[mI]=e.Vector2.Zero();for(let M=0;M<20;M++){for(mI=0;mI<3;mI++){const I=x[3*M+mI];R[mI].Db(p[3*Z[I]],p[3*Z[I]+1],p[3*Z[I]+2]),R[mI].normalize(),E[mI].Db(.134765625*k[2*I]+.05859375+-.0390625*S[M],.2333984375*k[2*I+1]+.025390625+.01953125*S[M])}const I=(I,g,b,M)=>{const D=e.Vg.Lerp(R[0],R[2],g/z),p=e.Vg.Lerp(R[1],R[2],g/z),x=z===g?R[2]:e.Vg.Lerp(D,p,I/(z-g));let Z;if(x.normalize(),c){const I=e.Vg.Lerp(R[0],R[2],M/z),g=e.Vg.Lerp(R[1],R[2],M/z);Z=e.Vg.Lerp(I,g,b/(z-M))}else Z=new e.Vg(x.x,x.y,x.z);Z.x/=o,Z.y/=n,Z.z/=G,Z.normalize();const k=e.Vector2.Lerp(E[0],E[2],g/z),S=e.Vector2.Lerp(E[1],E[2],g/z),mI=z===g?E[2]:e.Vector2.Lerp(k,S,I/(z-g));V.push(x.x*o,x.y*n,x.z*G),a.push(Z.x,Z.y,Z.z),v.push(mI.x,J.d?1-mI.y:mI.y),f.push(X),X++};for(let g=0;g<z;g++)for(let b=0;b+g<z;b++)I(b,g,b+1/3,g+1/3),I(b+1,g,b+1/3,g+1/3),I(b,g+1,b+1/3,g+1/3),b+g+1<z&&(I(b+1,g,b+2/3,g+2/3),I(b+1,g+1,b+2/3,g+2/3),I(b,g+1,b+2/3,g+2/3))}M.d._ComputeSides(g,V,f,a,v,I.frontUVs,I.backUVs);const s=new M.d;return s.indices=f,s.sI=V,s.FI=a,s.dI=v,s}function L(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new c.e(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),e._originalBuilderSideOrientation=g.sideOrientation;return Q(g).rI(e,g.updatable),e}M.d.CreatePolyhedron=A,c.e.CreatePolyhedron=(I,g,b)=>j(I,g,b);M.d.CreateIcoSphere=Q,c.e.CreateIcoSphere=(I,g,b)=>L(I,g,b);var N=b(12610);const K=new e.Vg(1,0,0),B=new e.Vg(-1,0,0),P=new e.Vg(0,1,0),u=new e.Vg(0,-1,0),t=new e.Vg(0,0,1),y=new e.Vg(0,0,-1);class q{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.Vg.Zero(),g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Vg.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Vector2.Zero(),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=I,this.normal=g,this.uv=b,this.vertexIdx=c,this.vertexIdxForBones=z,this.localPositionOverride=M,this.localNormalOverride=J,this.matrixIndicesOverride=o,this.matrixWeightsOverride=n}clone(){var I,g,b,e;return new q(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(I=this.localPositionOverride)||void 0===I?void 0:I.slice(),null===(g=this.localNormalOverride)||void 0===g?void 0:g.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(e=this.matrixWeightsOverride)||void 0===e?void 0:e.slice())}}function l(I,g,b){var o,n,G,D,p;const x=!!g.skeleton,Z=!(null===(o=g.morphTargetManager)||void 0===o||!o.numTargets),k=b.localMode||x,S=g.nb(),f=x||Z?g.Ic(!0,!0):g.getVerticesData(z.f.PositionKind),V=x||Z?g.getNormalsData(!0,!0):g.getVerticesData(z.f.NormalKind),a=k?x?g.getVerticesData(z.f.PositionKind):f:null,v=k?x?g.getVerticesData(z.f.NormalKind):V:null,X=g.getVerticesData(z.f.UVKind),R=x?g.getVerticesData(z.f.MatricesIndicesKind):null,E=x?g.getVerticesData(z.f.MatricesWeightsKind):null,mI=x?g.getVerticesData(z.f.MatricesIndicesExtraKind):null,s=x?g.getVerticesData(z.f.MatricesWeightsExtraKind):null,F=b.position||e.Vg.Zero();let Y=b.normal||e.Vg.Up();const d=b.size||e.Vg.One(),C=b.angle||0;if(!Y){const I=new e.Vg(0,0,1),b=g.EI().activeCamera,c=e.Vg.TransformCoordinates(I,b.getWorldMatrix());Y=b.globalPosition.ag(c)}const r=-Math.atan2(Y.z,Y.x)-Math.PI/2,O=Math.sqrt(Y.x*Y.x+Y.z*Y.z),H=Math.atan2(Y.y,O),i=new M.d;i.indices=[],i.sI=[],i.FI=[],i.dI=[],i.matricesIndices=x?[]:null,i.matricesWeights=x?[]:null,i.matricesIndicesExtra=mI?[]:null,i.matricesWeightsExtra=s?[]:null;let U=0;const h=(I,g)=>{const c=new q;if(!S||!f||!V)return c;const z=S[I];if(c.vertexIdx=3*z,c.vertexIdxForBones=4*z,c.position=new e.Vg(f[3*z],f[3*z+1],f[3*z+2]),e.Vg.TransformCoordinatesToRef(c.position,g,c.position),c.normal=new e.Vg(V[3*z],V[3*z+1],V[3*z+2]),e.Vg.TransformNormalToRef(c.normal,g,c.normal),b.captureUVS&&X){const I=X[2*z+1];c.uv=new e.Vector2(X[2*z],J.d?1-I:I)}return c},A=[0,0,0,0],j=(I,g)=>{if(0===I.length)return I;const b=.5*Math.abs(e.Vg.Dot(d,g)),c=(I,g,b,e)=>{for(let c=0;c<e;++c)if(I[b+c]===g)return b+c;return-1},z=(I,z)=>{const M=e.Vg.GetClipFactor(I.position,z.position,g,b);let J=A,o=A;if(R&&E){const g=I.matrixIndicesOverride?0:I.vertexIdxForBones,b=I.matrixIndicesOverride??R,e=I.matrixWeightsOverride??E,n=z.matrixIndicesOverride?0:z.vertexIdxForBones,G=z.matrixIndicesOverride??R,D=z.matrixWeightsOverride??E;J=[0,0,0,0],o=[0,0,0,0];let p=0;for(let I=0;I<4;++I)if(e[g+I]>0){const z=c(G,b[g+I],n,4);J[p]=b[g+I],o[p]=(0,N.Lerp)(e[g+I],z>=0?D[z]:0,M),p++}for(let I=0;I<4&&p<4;++I){const e=G[n+I];-1===c(b,e,g,4)&&(J[p]=e,o[p]=(0,N.Lerp)(0,D[n+I],M),p++)}const x=o[0]+o[1]+o[2]+o[3];o[0]/=x,o[1]/=x,o[2]/=x,o[3]/=x}const n=I.localPositionOverride?I.localPositionOverride[0]:(null===a||void 0===a?void 0:a[I.vertexIdx])??0,G=I.localPositionOverride?I.localPositionOverride[1]:(null===a||void 0===a?void 0:a[I.vertexIdx+1])??0,D=I.localPositionOverride?I.localPositionOverride[2]:(null===a||void 0===a?void 0:a[I.vertexIdx+2])??0,p=z.localPositionOverride?z.localPositionOverride[0]:(null===a||void 0===a?void 0:a[z.vertexIdx])??0,x=z.localPositionOverride?z.localPositionOverride[1]:(null===a||void 0===a?void 0:a[z.vertexIdx+1])??0,Z=z.localPositionOverride?z.localPositionOverride[2]:(null===a||void 0===a?void 0:a[z.vertexIdx+2])??0,k=I.localNormalOverride?I.localNormalOverride[0]:(null===v||void 0===v?void 0:v[I.vertexIdx])??0,S=I.localNormalOverride?I.localNormalOverride[1]:(null===v||void 0===v?void 0:v[I.vertexIdx+1])??0,f=I.localNormalOverride?I.localNormalOverride[2]:(null===v||void 0===v?void 0:v[I.vertexIdx+2])??0,V=k+((z.localNormalOverride?z.localNormalOverride[0]:(null===v||void 0===v?void 0:v[z.vertexIdx])??0)-k)*M,X=S+((z.localNormalOverride?z.localNormalOverride[1]:(null===v||void 0===v?void 0:v[z.vertexIdx+1])??0)-S)*M,mI=f+((z.localNormalOverride?z.localNormalOverride[2]:(null===v||void 0===v?void 0:v[z.vertexIdx+2])??0)-f)*M,s=Math.sqrt(V*V+X*X+mI*mI);return new q(e.Vg.Lerp(I.position,z.position,M),e.Vg.Lerp(I.normal,z.normal,M).normalize(),e.Vector2.Lerp(I.uv,z.uv,M),-1,-1,a?[n+(p-n)*M,G+(x-G)*M,D+(Z-D)*M]:null,v?[V/s,X/s,mI/s]:null,J,o)};let M=null;I.length>3&&(M=[]);for(let J=0;J<I.length;J+=3){let c=0,o=null,n=null,G=null,D=null;const p=e.Vg.Dot(I[J].position,g)-b>0,x=e.Vg.Dot(I[J+1].position,g)-b>0,Z=e.Vg.Dot(I[J+2].position,g)-b>0;switch(c=(p?1:0)+(x?1:0)+(Z?1:0),c){case 0:I.length>3?(M.push(I[J]),M.push(I[J+1]),M.push(I[J+2])):M=I;break;case 1:if(M=M??new Array,p&&(o=I[J+1],n=I[J+2],G=z(I[J],o),D=z(I[J],n)),x){o=I[J],n=I[J+2],G=z(I[J+1],o),D=z(I[J+1],n),M.push(G),M.push(n.clone()),M.push(o.clone()),M.push(n.clone()),M.push(G.clone()),M.push(D);break}Z&&(o=I[J],n=I[J+1],G=z(I[J+2],o),D=z(I[J+2],n)),o&&n&&G&&D&&(M.push(o.clone()),M.push(n.clone()),M.push(G),M.push(D),M.push(G.clone()),M.push(n.clone()));break;case 2:M=M??new Array,p||(o=I[J].clone(),n=z(o,I[J+1]),G=z(o,I[J+2]),M.push(o),M.push(n),M.push(G)),x||(o=I[J+1].clone(),n=z(o,I[J+2]),G=z(o,I[J]),M.push(o),M.push(n),M.push(G)),Z||(o=I[J+2].clone(),n=z(o,I[J]),G=z(o,I[J+1]),M.push(o),M.push(n),M.push(G))}}return M},Q=g instanceof c.e?g:null,L=null===Q||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData,l=(null===Q||void 0===Q?void 0:Q.ab)||1,w=e.TmpVectors.Matrix[0];w.G(e.Matrix.IdentityReadOnly);for(let c=0;c<l;++c){if(null!==Q&&void 0!==Q&&Q.hasThinInstances&&L){const I=16*c;w.setRowFromFloats(0,L[I+0],L[I+1],L[I+2],L[I+3]),w.setRowFromFloats(1,L[I+4],L[I+5],L[I+6],L[I+7]),w.setRowFromFloats(2,L[I+8],L[I+9],L[I+10],L[I+11]),w.setRowFromFloats(3,L[I+12],L[I+13],L[I+14],L[I+15])}const I=e.Matrix.RotationYawPitchRoll(r,H,C).multiply(e.Matrix.Translation(F.x,F.y,F.z)),z=e.Matrix.Invert(I),M=g.getWorldMatrix(),o=w.multiply(M).multiply(z),n=new Array(3);for(let g=0;g<S.length;g+=3){let I=n;if(I[0]=h(g,o),I[1]=h(g+1,o),I[2]=h(g+2,o),!(b.cullBackFaces&&-I[0].normal.z<=0&&-I[1].normal.z<=0&&-I[2].normal.z<=0)&&(I=j(I,K),I&&(I=j(I,B),I&&(I=j(I,P),I&&(I=j(I,u),I&&(I=j(I,t),I&&(I=j(I,y),I)))))))for(let g=0;g<I.length;g++){const e=I[g];if(i.indices.push(U),k?(e.localPositionOverride?(i.sI[3*U]=e.localPositionOverride[0],i.sI[3*U+1]=e.localPositionOverride[1],i.sI[3*U+2]=e.localPositionOverride[2]):a&&(i.sI[3*U]=a[e.vertexIdx],i.sI[3*U+1]=a[e.vertexIdx+1],i.sI[3*U+2]=a[e.vertexIdx+2]),e.localNormalOverride?(i.FI[3*U]=e.localNormalOverride[0],i.FI[3*U+1]=e.localNormalOverride[1],i.FI[3*U+2]=e.localNormalOverride[2]):v&&(i.FI[3*U]=v[e.vertexIdx],i.FI[3*U+1]=v[e.vertexIdx+1],i.FI[3*U+2]=v[e.vertexIdx+2])):(e.position.toArray(i.sI,3*U),e.normal.toArray(i.FI,3*U)),i.matricesIndices&&i.matricesWeights&&(e.matrixIndicesOverride?(i.matricesIndices[4*U]=e.matrixIndicesOverride[0],i.matricesIndices[4*U+1]=e.matrixIndicesOverride[1],i.matricesIndices[4*U+2]=e.matrixIndicesOverride[2],i.matricesIndices[4*U+3]=e.matrixIndicesOverride[3]):(R&&(i.matricesIndices[4*U]=R[e.vertexIdxForBones],i.matricesIndices[4*U+1]=R[e.vertexIdxForBones+1],i.matricesIndices[4*U+2]=R[e.vertexIdxForBones+2],i.matricesIndices[4*U+3]=R[e.vertexIdxForBones+3]),mI&&i.matricesIndicesExtra&&(i.matricesIndicesExtra[4*U]=mI[e.vertexIdxForBones],i.matricesIndicesExtra[4*U+1]=mI[e.vertexIdxForBones+1],i.matricesIndicesExtra[4*U+2]=mI[e.vertexIdxForBones+2],i.matricesIndicesExtra[4*U+3]=mI[e.vertexIdxForBones+3])),e.matrixWeightsOverride?(i.matricesWeights[4*U]=e.matrixWeightsOverride[0],i.matricesWeights[4*U+1]=e.matrixWeightsOverride[1],i.matricesWeights[4*U+2]=e.matrixWeightsOverride[2],i.matricesWeights[4*U+3]=e.matrixWeightsOverride[3]):(E&&(i.matricesWeights[4*U]=E[e.vertexIdxForBones],i.matricesWeights[4*U+1]=E[e.vertexIdxForBones+1],i.matricesWeights[4*U+2]=E[e.vertexIdxForBones+2],i.matricesWeights[4*U+3]=E[e.vertexIdxForBones+3]),s&&i.matricesWeightsExtra&&(i.matricesWeightsExtra[4*U]=s[e.vertexIdxForBones],i.matricesWeightsExtra[4*U+1]=s[e.vertexIdxForBones+1],i.matricesWeightsExtra[4*U+2]=s[e.vertexIdxForBones+2],i.matricesWeightsExtra[4*U+3]=s[e.vertexIdxForBones+3]))),b.captureUVS)e.uv.toArray(i.dI,2*U);else{i.dI.push(.5+e.position.x/d.x);const I=.5+e.position.y/d.y;i.dI.push(J.d?1-I:I)}U++}}}0===i.indices.length&&(i.indices=null),0===i.sI.length&&(i.sI=null),0===i.FI.length&&(i.FI=null),0===i.dI.length&&(i.dI=null),0===(null===(n=i.matricesIndices)||void 0===n?void 0:n.length)&&(i.matricesIndices=null),0===(null===(G=i.matricesWeights)||void 0===G?void 0:G.length)&&(i.matricesWeights=null),0===(null===(D=i.matricesIndicesExtra)||void 0===D?void 0:D.length)&&(i.matricesIndicesExtra=null),0===(null===(p=i.matricesWeightsExtra)||void 0===p?void 0:p.length)&&(i.matricesWeightsExtra=null);const T=new c.e(I,g.EI());return i.rI(T),k?(T.skeleton=g.skeleton,T.parent=g):(T.position=F.clone(),T.rotation=new e.Vg(H,r,C)),T.Mb(!0),T.refreshBoundingInfo(!0,!0),T}function w(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const g=0|Math.max(I.subdivisions?I.subdivisions:2,1),b=0|Math.max(I.tessellation?I.tessellation:16,3),c=Math.max(I.height?I.height:1,0),z=Math.max(I.radius?I.radius:.25,0),o=0|Math.max(I.capSubdivisions?I.capSubdivisions:6,1),n=b,G=g,D=Math.max(I.radiusTop?I.radiusTop:z,0),p=Math.max(I.radiusBottom?I.radiusBottom:z,0),x=c-(D+p),Z=2*Math.PI,k=Math.max(I.topCapSubdivisions?I.topCapSubdivisions:o,1),S=Math.max(I.bottomCapSubdivisions?I.bottomCapSubdivisions:o,1),f=Math.acos((p-D)/c);let V=[];const a=[],v=[],X=[];let R=0;const E=[],mI=.5*x,s=.5*Math.PI;let F,Y;const d=e.Vg.Zero(),C=e.Vg.Zero(),r=Math.cos(f),O=Math.sin(f),H=new e.Vector2(D*O,mI+D*r).ag(new e.Vector2(p*O,p*r-mI)).length(),i=D*f+H+p*(s-f);let U=0;for(Y=0;Y<=k;Y++){const I=[],g=s-f*(Y/k);U+=D*f/k;const b=Math.cos(g),e=Math.sin(g),c=b*D;for(F=0;F<=n;F++){const g=F/n,z=g*Z+0,M=Math.sin(z),o=Math.cos(z);C.x=c*M,C.y=mI+e*D,C.z=c*o,a.push(C.x,C.y,C.z),d.set(b*M,e,b*o),v.push(d.x,d.y,d.z),X.push(g,J.d?U/i:1-U/i),I.push(R),R++}E.push(I)}const h=c-D-p+r*D-r*p,A=O*(p-D)/h;for(Y=1;Y<=G;Y++){const I=[];U+=H/G;const g=O*(Y*(p-D)/G+D);for(F=0;F<=n;F++){const b=F/n,e=b*Z+0,c=Math.sin(e),z=Math.cos(e);C.x=g*c,C.y=mI+r*D-Y*h/G,C.z=g*z,a.push(C.x,C.y,C.z),d.set(c,A,z).normalize(),v.push(d.x,d.y,d.z),X.push(b,J.d?U/i:1-U/i),I.push(R),R++}E.push(I)}for(Y=1;Y<=S;Y++){const I=[],g=s-f-(Math.PI-f)*(Y/S);U+=p*f/S;const b=Math.cos(g),e=Math.sin(g),c=b*p;for(F=0;F<=n;F++){const g=F/n,z=g*Z+0,M=Math.sin(z),o=Math.cos(z);C.x=c*M,C.y=e*p-mI,C.z=c*o,a.push(C.x,C.y,C.z),d.set(b*M,e,b*o),v.push(d.x,d.y,d.z),X.push(g,J.d?U/i:1-U/i),I.push(R),R++}E.push(I)}for(F=0;F<n;F++)for(Y=0;Y<k+G+S;Y++){const I=E[Y][F],g=E[Y+1][F],b=E[Y+1][F+1],e=E[Y][F+1];V.push(I),V.push(g),V.push(e),V.push(g),V.push(b),V.push(e)}if(V=V.reverse(),I.orientation&&!I.orientation.equals(e.Vg.Up())){const g=new e.Matrix;I.orientation.clone().scale(.5*Math.PI).cross(e.Vg.Up()).toQuaternion().toRotationMatrix(g);const b=e.Vg.Zero();for(let I=0;I<a.length;I+=3)b.set(a[I],a[I+1],a[I+2]),e.Vg.TransformCoordinatesToRef(b.clone(),g,b),a[I]=b.x,a[I+1]=b.y,a[I+2]=b.z}const j=new M.d;return j.sI=a,j.FI=v,j.dI=X,j.indices=V,j}function T(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:e.Vg.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new c.e(I,b);return w(g).rI(z,g.updatable),z}c.e.CreateDecal=(I,g,b,e,c,z)=>l(I,g,{position:b,normal:e,size:c,angle:z});c.e.CreateCapsule=(I,g,b)=>T(I,g,b),M.d.CreateCapsule=w;var W=b(12420),II=b(12597);class gI{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=I,this.y=g,I!==Math.floor(I)&&(I=Math.floor(I),W.b.Warn("x is not an integer, floor(x) used")),g!==Math.floor(g)&&(g=Math.floor(g),W.b.Warn("y is not an integer, floor(y) used"))}clone(){return new gI(this.x,this.y)}rotate60About(I){const g=this.x;return this.x=I.x+I.y-this.y,this.y=g+this.y-I.x,this}rotateNeg60About(I){const g=this.x;return this.x=g+this.y-I.y,this.y=I.x+I.y-g,this}rotate120(I,g){I!==Math.floor(I)&&(I=Math.floor(I),W.b.Warn("m not an integer only floor(m) used")),g!==Math.floor(g)&&(g=Math.floor(g),W.b.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=I-b-this.y,this.y=g+b,this}rotateNeg120(I,g){I!==Math.floor(I)&&(I=Math.floor(I),W.b.Warn("m is not an integer, floor(m) used")),g!==Math.floor(g)&&(g=Math.floor(g),W.b.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-g,this.y=I+g-b-this.y,this}toCartesianOrigin(I,g){const b=e.Vg.Zero();return b.x=I.x+2*this.x*g+this.y*g,b.y=I.y+Math.sqrt(3)*this.y*g,b}static Zero(){return new gI(0,0)}}class bI{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new eI("icosahedron","Regular",[[0,II.e,-1],[-II.e,1,0],[-1,0,-II.e],[1,0,-II.e],[II.e,1,0],[0,II.e,1],[-1,0,II.e],[-II.e,-1,0],[0,-II.e,-1],[II.e,-1,0],[1,0,II.e],[0,-II.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let I=12;const g={},b=this.m,e=this.n;let c,z,M,J,o,n=b,G=1,D=0;0!==e&&(n=(0,N.HighestCommonFactor)(b,e)),G=b/n,D=e/n;const p=gI.Zero(),x=new gI(b,e),Z=new gI(-e,b+e),k=gI.Zero(),S=gI.Zero(),f=gI.Zero();let V,a,v,X,R=[];const E=[],mI=this.vertByDist,s=(b,e,c,z)=>{V=b+"|"+c,a=e+"|"+z,V in g||a in g?V in g&&!(a in g)?g[a]=g[V]:a in g&&!(V in g)&&(g[V]=g[a]):(g[V]=I,g[a]=I,I++),mI[c][0]>2?E[g[V]]=[-mI[c][0],mI[c][1],g[V]]:E[g[V]]=[R[mI[c][0]],mI[c][1],g[V]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let F=0;F<20;F++){if(R=this.IDATA.face[F],M=R[2],J=R[1],o=R[0],v=p.x+"|"+p.y,V=F+"|"+v,V in g||(g[V]=M,E[M]=[R[mI[v][0]],mI[v][1]]),v=x.x+"|"+x.y,V=F+"|"+v,V in g||(g[V]=J,E[J]=[R[mI[v][0]],mI[v][1]]),v=Z.x+"|"+Z.y,V=F+"|"+v,V in g||(g[V]=o,E[o]=[R[mI[v][0]],mI[v][1]]),c=this.IDATA.edgematch[F][0],z=this.IDATA.edgematch[F][1],"B"===z)for(let I=1;I<n;I++)S.x=b-I*(G+D),S.y=e+I*G,f.x=-I*D,f.y=I*(G+D),v=S.x+"|"+S.y,X=f.x+"|"+f.y,s(F,c,v,X);if("O"===z)for(let I=1;I<n;I++)f.x=-I*D,f.y=I*(G+D),k.x=I*G,k.y=I*D,v=f.x+"|"+f.y,X=k.x+"|"+k.y,s(F,c,v,X);if(c=this.IDATA.edgematch[F][2],z=this.IDATA.edgematch[F][3],z&&"A"===z)for(let I=1;I<n;I++)k.x=I*G,k.y=I*D,S.x=b-(n-I)*(G+D),S.y=e+(n-I)*G,v=k.x+"|"+k.y,X=S.x+"|"+S.y,s(F,c,v,X);for(let b=0;b<this.vertices.length;b++)v=this.vertices[b].x+"|"+this.vertices[b].y,V=F+"|"+v,V in g||(g[V]=I++,mI[v][0]>2?E[g[V]]=[-mI[v][0],mI[v][1],g[V]]:E[g[V]]=[R[mI[v][0]],mI[v][1],g[V]])}this.closestTo=E,this.vecToidx=g}calcCoeffs(){const I=this.m,g=this.n,b=Math.sqrt(3)/3,e=I*I+g*g+I*g;this.coau=(I+g)/e,this.cobu=-g/e,this.coav=-b*(I-g)/e,this.cobv=b*(2*I+g)/e}createInnerFacets(){const I=this.m,g=this.n;for(let b=0;b<g+I+1;b++)for(let I=this.min[b];I<this.max[b]+1;I++)I<this.max[b]&&I<this.max[b+1]+1&&this.innerFacets.push(["|"+I+"|"+b,"|"+I+"|"+(b+1),"|"+(I+1)+"|"+b]),b>0&&I<this.max[b-1]&&I+1<this.max[b]+1&&this.innerFacets.push(["|"+I+"|"+b,"|"+(I+1)+"|"+b,"|"+(I+1)+"|"+(b-1)])}edgeVecsABOB(){const I=this.m,g=this.n,b=new gI(-g,I+g);for(let e=1;e<I+g;e++){const I=new gI(this.min[e],e),g=new gI(this.min[e-1],e-1),c=new gI(this.min[e+1],e+1),z=I.clone(),M=g.clone(),J=c.clone();z.rotate60About(b),M.rotate60About(b),J.rotate60About(b);const o=new gI(this.max[z.y],z.y),n=new gI(this.max[z.y-1],z.y-1),G=new gI(this.max[z.y-1]-1,z.y-1);z.x===o.x&&z.y===o.y||(z.x!==n.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,n,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,G,o])):z.y===J.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,g,n]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([I,n,c])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,g,n]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,n,o])))}}mapABOBtoOBOA(){const I=new gI(0,0);for(let g=0;g<this.isoVecsABOB.length;g++){const b=[];for(let e=0;e<3;e++)I.x=this.isoVecsABOB[g][e].x,I.y=this.isoVecsABOB[g][e].y,0===this.vertexTypes[g][e]&&I.rotateNeg120(this.m,this.n),b.push(I.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const I=new gI(0,0);for(let g=0;g<this.isoVecsABOB.length;g++){const b=[];for(let e=0;e<3;e++)I.x=this.isoVecsABOB[g][e].x,I.y=this.isoVecsABOB[g][e].y,1===this.vertexTypes[g][e]&&I.rotate120(this.m,this.n),b.push(I.clone());this.isoVecsBAOA.push(b)}}MapToFace(I,g){const b=this.IDATA.face[I],c=b[2],z=b[1],M=b[0],J=e.Vg.mb(this.IDATA.vertex[c]),o=e.Vg.mb(this.IDATA.vertex[z]),n=e.Vg.mb(this.IDATA.vertex[M]),G=o.ag(J),D=n.ag(J),p=G.scale(this.coau).add(D.scale(this.cobu)),x=G.scale(this.coav).add(D.scale(this.cobv)),Z=[];let k,S=e.TmpVectors.Vg[0];for(let e=0;e<this.cartesian.length;e++)S=p.scale(this.cartesian[e].x).add(x.scale(this.cartesian[e].y)).add(J),Z[e]=[S.x,S.y,S.z],k=I+"|"+this.vertices[e].x+"|"+this.vertices[e].y,g.vertex[this.vecToidx[k]]=[S.x,S.y,S.z]}build(I,g){const b=[],e=gI.Zero(),c=new gI(I,g),z=new gI(-g,I+g);b.push(e,c,z);for(let v=g;v<I+1;v++)for(let g=0;g<I+1-v;g++)b.push(new gI(g,v));if(g>0){const e=(0,N.HighestCommonFactor)(I,g),c=I/e,z=g/e;for(let J=1;J<e;J++)b.push(new gI(J*c,J*z)),b.push(new gI(-J*z,J*(c+z))),b.push(new gI(I-J*(c+z),g+J*c));const M=I/g;for(let J=1;J<g;J++)for(let e=0;e<J*M;e++)b.push(new gI(e,J)),b.push(new gI(e,J).rotate120(I,g)),b.push(new gI(e,J).rotateNeg120(I,g))}b.sort(((I,g)=>I.x-g.x)),b.sort(((I,g)=>I.y-g.y));const M=new Array(I+g+1),J=new Array(I+g+1);for(let v=0;v<M.length;v++)M[v]=1/0,J[v]=-1/0;let o=0,n=0;const G=b.length;for(let v=0;v<G;v++)n=b[v].x,o=b[v].y,M[o]=Math.min(n,M[o]),J[o]=Math.max(n,J[o]);const D=(b,e)=>{const c=b.clone();return"A"===e&&c.rotateNeg120(I,g),"B"===e&&c.rotate120(I,g),c.x<0?c.y:c.x+c.y},p=[],x=[],Z=[],k=[],S={},f=[];let V=-1,a=-1;for(let v=0;v<G;v++)p[v]=b[v].toCartesianOrigin(new gI(0,0),.5),x[v]=D(b[v],"O"),Z[v]=D(b[v],"A"),k[v]=D(b[v],"B"),x[v]===Z[v]&&Z[v]===k[v]?(V=3,a=x[v]):x[v]===Z[v]?(V=4,a=x[v]):Z[v]===k[v]?(V=5,a=Z[v]):k[v]===x[v]&&(V=6,a=x[v]),x[v]<Z[v]&&x[v]<k[v]&&(V=2,a=x[v]),Z[v]<x[v]&&Z[v]<k[v]&&(V=1,a=Z[v]),k[v]<Z[v]&&k[v]<x[v]&&(V=0,a=k[v]),f.push([V,a,b[v].x,b[v].y]);f.sort(((I,g)=>I[2]-g[2])),f.sort(((I,g)=>I[3]-g[3])),f.sort(((I,g)=>I[1]-g[1])),f.sort(((I,g)=>I[0]-g[0]));for(let v=0;v<f.length;v++)S[f[v][2]+"|"+f[v][3]]=[f[v][0],f[v][1],v];return this.m=I,this.n=g,this.vertices=b,this.vertByDist=S,this.cartesian=p,this.min=M,this.max=J,this}}class eI{constructor(I,g,b,e){this.name=I,this.category=g,this.vertex=b,this.face=e}}class cI extends eI{innerToData(I,g){for(let b=0;b<g.innerFacets.length;b++)this.face.push(g.innerFacets[b].map((b=>g.vecToidx[I+b])))}mapABOBtoDATA(I,g){const b=g.IDATA.edgematch[I][0];for(let e=0;e<g.isoVecsABOB.length;e++){const c=[];for(let z=0;z<3;z++)0===g.vertexTypes[e][z]?c.push(I+"|"+g.isoVecsABOB[e][z].x+"|"+g.isoVecsABOB[e][z].y):c.push(b+"|"+g.isoVecsABOB[e][z].x+"|"+g.isoVecsABOB[e][z].y);this.face.push([g.vecToidx[c[0]],g.vecToidx[c[1]],g.vecToidx[c[2]]])}}mapOBOAtoDATA(I,g){const b=g.IDATA.edgematch[I][0];for(let e=0;e<g.isoVecsOBOA.length;e++){const c=[];for(let z=0;z<3;z++)1===g.vertexTypes[e][z]?c.push(I+"|"+g.isoVecsOBOA[e][z].x+"|"+g.isoVecsOBOA[e][z].y):c.push(b+"|"+g.isoVecsOBOA[e][z].x+"|"+g.isoVecsOBOA[e][z].y);this.face.push([g.vecToidx[c[0]],g.vecToidx[c[1]],g.vecToidx[c[2]]])}}mapBAOAtoDATA(I,g){const b=g.IDATA.edgematch[I][2];for(let e=0;e<g.isoVecsBAOA.length;e++){const c=[];for(let z=0;z<3;z++)1===g.vertexTypes[e][z]?c.push(I+"|"+g.isoVecsBAOA[e][z].x+"|"+g.isoVecsBAOA[e][z].y):c.push(b+"|"+g.isoVecsBAOA[e][z].x+"|"+g.isoVecsBAOA[e][z].y);this.face.push([g.vecToidx[c[0]],g.vecToidx[c[1]],g.vecToidx[c[2]]])}}orderData(I){const g=[];for(let z=0;z<13;z++)g[z]=[];const b=I.closestTo;for(let z=0;z<b.length;z++)b[z][0]>-1?b[z][1]>0&&g[b[z][0]].push([z,b[z][1]]):g[12].push([z,b[z][0]]);const e=[];for(let z=0;z<12;z++)e[z]=z;let c=12;for(let z=0;z<12;z++){g[z].sort(((I,g)=>I[1]-g[1]));for(let I=0;I<g[z].length;I++)e[g[z][I][0]]=c++}for(let z=0;z<g[12].length;z++)e[g[12][z][0]]=c++;for(let z=0;z<this.vertex.length;z++)this.vertex[z].push(e[z]);this.vertex.sort(((I,g)=>I[3]-g[3]));for(let z=0;z<this.vertex.length;z++)this.vertex[z].pop();for(let z=0;z<this.face.length;z++)for(let I=0;I<this.face[z].length;I++)this.face[z][I]=e[this.face[z][I]];this.sharedNodes=g[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(I,g){const b=[],e=[];let c=g.pop();e.push(c);let z=this.face[c].indexOf(I);z=(z+2)%3;let M=this.face[c][z];b.push(M);let J=0;for(;g.length>0;)c=g[J],this.face[c].indexOf(M)>-1?(z=(this.face[c].indexOf(M)+1)%3,M=this.face[c][z],b.push(M),e.push(c),g.splice(J,1),J=0):J++;return this.adjacentFaces.push(b),e}toGoldbergPolyhedronData(){const I=new eI("GeoDual","Goldberg",[],[]);I.name="GD dual";const g=this.vertex.length,b=new Array(g);for(let o=0;o<g;o++)b[o]=[];for(let o=0;o<this.face.length;o++)for(let I=0;I<3;I++)b[this.face[o][I]].push(o);let e=0,c=0,z=0,M=[],J=[];this.adjacentFaces=[];for(let o=0;o<b.length;o++){I.face[o]=this.setOrder(o,b[o].concat([]));for(const g of b[o]){e=0,c=0,z=0,M=this.face[g];for(let I=0;I<3;I++)J=this.vertex[M[I]],e+=J[0],c+=J[1],z+=J[2];I.vertex[g]=[e/3,c/3,z/3]}}return I}static BuildGeodesicData(I){const g=new cI("Geodesic-m-n","Geodesic",[[0,II.e,-1],[-II.e,1,0],[-1,0,-II.e],[1,0,-II.e],[II.e,1,0],[0,II.e,1],[-1,0,II.e],[-II.e,-1,0],[0,-II.e,-1],[II.e,-1,0],[1,0,II.e],[0,-II.e,1]],[]);I.setIndices(),I.calcCoeffs(),I.createInnerFacets(),I.edgeVecsABOB(),I.mapABOBtoOBOA(),I.mapABOBtoBAOA();for(let b=0;b<I.IDATA.face.length;b++)I.MapToFace(b,g),g.innerToData(b,I),"B"===I.IDATA.edgematch[b][1]&&g.mapABOBtoDATA(b,I),"O"===I.IDATA.edgematch[b][1]&&g.mapOBOAtoDATA(b,I),"A"===I.IDATA.edgematch[b][3]&&g.mapBAOAtoDATA(b,I);g.orderData(I);return g.vertex=g.vertex.map((function(I){const g=I[0],b=I[1],e=I[2],c=Math.sqrt(g*g+b*b+e*e);return I[0]*=1/c,I[1]*=1/c,I[2]*=1/c,I})),g}}c.e._GoldbergMeshParser=(I,g)=>zI.Parse(I,g);class zI extends c.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(I,g){return void 0===g?(I>this.goldbergData.nbUnsharedFaces-1&&(W.b.Warn("Maximum number of unshared faces used"),I=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+I):(I>11&&(W.b.Warn("Last pole used"),I=11),g>this.goldbergData.nbFacesAtPole-1&&(W.b.Warn("Maximum number of faces at a pole used"),g=this.goldbergData.nbFacesAtPole-1),12+I*this.goldbergData.nbFacesAtPole+g)}_changeGoldbergFaceColors(I){for(let b=0;b<I.length;b++){const g=I[b][0],e=I[b][1],c=I[b][2];for(let I=g;I<e+1;I++)this.goldbergData.faceColors[I]=c}const g=[];for(let b=0;b<12;b++)for(let I=0;I<5;I++)g.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let I=0;I<6;I++)g.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return g}setGoldbergFaceColors(I){const g=this._changeGoldbergFaceColors(I);this.UI(z.f.ColorKind,g)}updateGoldbergFaceColors(I){const g=this._changeGoldbergFaceColors(I);this.updateVerticesData(z.f.ColorKind,g)}_changeGoldbergFaceUVs(I){const g=this.getVerticesData(z.f.UVKind);for(let b=0;b<I.length;b++){const e=I[b][0],c=I[b][1],z=I[b][2],M=I[b][3],J=I[b][4],o=[],n=[];let G,D;for(let I=0;I<5;I++)G=z.x+M*Math.cos(J+I*Math.PI/2.5),D=z.y+M*Math.sin(J+I*Math.PI/2.5),G<0&&(G=0),G>1&&(G=1),o.push(G,D);for(let I=0;I<6;I++)G=z.x+M*Math.cos(J+I*Math.PI/3),D=z.y+M*Math.sin(J+I*Math.PI/3),G<0&&(G=0),G>1&&(G=1),n.push(G,D);for(let I=e;I<Math.min(12,c+1);I++)for(let b=0;b<5;b++)g[10*I+2*b]=o[2*b],g[10*I+2*b+1]=o[2*b+1];for(let I=Math.max(12,e);I<c+1;I++)for(let b=0;b<6;b++)g[12*I-24+2*b]=n[2*b],g[12*I-23+2*b]=n[2*b+1]}return g}setGoldbergFaceUVs(I){const g=this._changeGoldbergFaceUVs(I);this.UI(z.f.UVKind,g)}updateGoldbergFaceUVs(I){const g=this._changeGoldbergFaceUVs(I);this.updateVerticesData(z.f.UVKind,g)}placeOnGoldbergFaceAt(I,g,b){const c=e.Vg.RotationFromAxis(this.goldbergData.faceXaxis[g],this.goldbergData.faceYaxis[g],this.goldbergData.faceZaxis[g]);I.rotation=c,I.position=this.goldbergData.faceCenters[g].add(this.goldbergData.faceXaxis[g].scale(b.x)).add(this.goldbergData.faceYaxis[g].scale(b.y)).add(this.goldbergData.faceZaxis[g].scale(b.z))}serialize(I){super.serialize(I),I.type="GoldbergMesh";const g={};if(g.adjacentFaces=this.goldbergData.adjacentFaces,g.nbSharedFaces=this.goldbergData.nbSharedFaces,g.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,g.nbFaces=this.goldbergData.nbFaces,g.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){g.faceColors=[];for(const I of this.goldbergData.faceColors)g.faceColors.push(I.bb())}if(this.goldbergData.faceCenters){g.faceCenters=[];for(const I of this.goldbergData.faceCenters)g.faceCenters.push(I.bb())}if(this.goldbergData.faceZaxis){g.faceZaxis=[];for(const I of this.goldbergData.faceZaxis)g.faceZaxis.push(I.bb())}if(this.goldbergData.faceYaxis){g.faceYaxis=[];for(const I of this.goldbergData.faceYaxis)g.faceYaxis.push(I.bb())}if(this.goldbergData.faceXaxis){g.faceXaxis=[];for(const I of this.goldbergData.faceXaxis)g.faceXaxis.push(I.bb())}I.goldbergData=g}static Parse(I,g){const b=I.goldbergData;b.faceColors=b.faceColors.map((I=>p.Sb.mb(I))),b.faceCenters=b.faceCenters.map((I=>e.Vg.mb(I))),b.faceZaxis=b.faceZaxis.map((I=>e.Vg.mb(I))),b.faceXaxis=b.faceXaxis.map((I=>e.Vg.mb(I))),b.faceYaxis=b.faceYaxis.map((I=>e.Vg.mb(I)));const c=new zI(I.name,g);return c.goldbergData=b,c}}var MI=b(13121);const JI={CreateBox:D.c,CreateTiledBox:S,CreateSphere:f.c,CreateDisc:G.c,CreateIcoSphere:L,CreateRibbon:n,CreateCylinder:X,CreateTorus:E,CreateTorusKnot:s,CreateLineSystem:F.g,wG:F.i,CreateDashedLines:F.d,ExtrudeShape:C,ExtrudeShapeCustom:r,CreateLathe:H,CreateTiledPlane:Z,ID:i.c,CreateGround:U.h,CreateTiledGround:U.k,CreateGroundFromHeightMap:U.e,CreatePolygon:Y.e,ExtrudePolygon:Y.i,CreateTube:h,CreatePolyhedron:j,CreateGeodesic:function(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=g.m||1;e!==Math.floor(e)&&(e=Math.floor(e),W.b.Warn("m not an integer only floor(m) used"));let c=g.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),W.b.Warn("n not an integer only floor(n) used")),c>e){const I=c;c=e,e=I,W.b.Warn("n > m therefore m and n swapped")}const z=new bI;return z.build(e,c),j(I,{custom:cI.BuildGeodesicData(z),size:g.size,sizeX:g.sizeX,sizeY:g.sizeY,sizeZ:g.sizeZ,faceUV:g.faceUV,faceColors:g.faceColors,flat:g.flat,updatable:g.updatable,sideOrientation:g.sideOrientation,frontUVs:g.frontUVs,backUVs:g.backUVs},b)},CreateGoldberg:function(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=g.size,o=g.sizeX||z||1,n=g.sizeY||z||1,G=g.sizeZ||z||1;let D=g.m||1;D!==Math.floor(D)&&(D=Math.floor(D),W.b.Warn("m not an integer only floor(m) used"));let x=g.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),W.b.Warn("n not an integer only floor(n) used")),x>D){const I=x;x=D,D=I,W.b.Warn("n > m therefore m and n swapped")}const Z=new bI;Z.build(D,x);const k=cI.BuildGeodesicData(Z),S=k.toGoldbergPolyhedronData(),f=new zI(I,b);g.sideOrientation=c.e._GetDefaultSideOrientation(g.sideOrientation),f._originalBuilderSideOrientation=g.sideOrientation;(function(I,g){const b=I.size,c=I.sizeX||b||1,z=I.sizeY||b||1,o=I.sizeZ||b||1,n=0===I.sideOrientation?0:I.sideOrientation||M.d.DEFAULTSIDE,G=[],D=[],p=[],x=[];let Z=1/0,k=-1/0,S=1/0,f=-1/0;for(let e=0;e<g.vertex.length;e++)Z=Math.min(Z,g.vertex[e][0]*c),k=Math.max(k,g.vertex[e][0]*c),S=Math.min(S,g.vertex[e][1]*z),f=Math.max(f,g.vertex[e][1]*z);let V=0;for(let M=0;M<g.face.length;M++){const I=g.face[M],b=e.Vg.mb(g.vertex[I[0]]),n=e.Vg.mb(g.vertex[I[2]]),a=e.Vg.mb(g.vertex[I[1]]),v=n.ag(b),X=a.ag(b),R=e.Vg.Cross(X,v).normalize();for(let e=0;e<I.length;e++){p.push(R.x,R.y,R.z);const b=g.vertex[I[e]];G.push(b[0]*c,b[1]*z,b[2]*o);const M=(b[1]*z-S)/(f-S);x.push((b[0]*c-Z)/(k-Z),J.d?1-M:M)}for(let g=0;g<I.length-2;g++)D.push(V,V+g+2,V+g+1);V+=I.length}M.d._ComputeSides(n,G,D,p,x);const a=new M.d;return a.sI=G,a.indices=D,a.FI=p,a.dI=x,a})(g,S).rI(f,g.updatable),f.goldbergData.nbSharedFaces=k.sharedNodes,f.goldbergData.nbUnsharedFaces=k.poleNodes,f.goldbergData.adjacentFaces=k.adjacentFaces,f.goldbergData.nbFaces=f.goldbergData.nbSharedFaces+f.goldbergData.nbUnsharedFaces,f.goldbergData.nbFacesAtPole=(f.goldbergData.nbUnsharedFaces-12)/12;for(let c=0;c<k.vertex.length;c++)f.goldbergData.faceCenters.push(e.Vg.mb(k.vertex[c])),f.goldbergData.faceCenters[c].x*=o,f.goldbergData.faceCenters[c].y*=n,f.goldbergData.faceCenters[c].z*=G,f.goldbergData.faceColors.push(new p.Sb(1,1,1,1));for(let c=0;c<S.face.length;c++){const I=S.face[c],g=e.Vg.mb(S.vertex[I[0]]),b=e.Vg.mb(S.vertex[I[2]]),z=e.Vg.mb(S.vertex[I[1]]),M=b.ag(g),J=z.ag(g),o=e.Vg.Cross(J,M).normalize(),n=e.Vg.Cross(J,o).normalize();f.goldbergData.faceXaxis.push(J.normalize()),f.goldbergData.faceYaxis.push(o),f.goldbergData.faceZaxis.push(n)}return f},CreateDecal:l,CreateCapsule:T,CreateText:MI.e}},13876:(I,g,b)=>{"use strict";b.d(g,{d:()=>Jg});var e=b(12590),c=b(12966);class z extends c.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var M=b(12637),J=(b(12751),b(12558));class o{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this._targetStopDuration!==I&&(this._targetStopDuration=I)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){this._noiseTexture!==I&&(this._noiseTexture=I,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(I){this._isAnimationSheetEnabled!=I&&(this._isAnimationSheetEnabled=I,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){this._useLogarithmicDepth=I&&this.EI().getEngine().getCaps().fragmentDepthSupported}EI(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(I){switch(I){case o.BLENDMODE_MULTIPLYADD:return;case o.BLENDMODE_ADD:I=1;break;case o.BLENDMODE_ONEONE:I=6;break;case o.BLENDMODE_STANDARD:I=2;break;case o.BLENDMODE_MULTIPLY:I=4;break;case o.BLENDMODE_SUBTRACT:I=3}this._engine.setAlphaMode(I)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:e.Vg.Zero()}set direction1(I){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=I)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:e.Vg.Zero()}set direction2(I){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=I)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:e.Vg.Zero()}set minEmitBox(I){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=I)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:e.Vg.Zero()}set maxEmitBox(I){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=I)}get billboardMode(){return this._billboardMode}set billboardMode(I){this._billboardMode!==I&&(this._billboardMode=I,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(I){this._isBillboardBased!==I&&(this._isBillboardBased=I,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(I){this._attachImageProcessingConfiguration(I)}_attachImageProcessingConfiguration(I){I!==this._imageProcessingConfiguration&&(!I&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=I)}_reset(){}_removeGradientAndTexture(I,g,b){if(!g)return this;let e=0;for(const c of g){if(c.gradient===I){g.splice(e,1);break}e++}return b&&b.dispose(),this}constructor(I){this.animations=[],this.renderingGroupId=0,this.cg=e.Vg.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new e.Vg(10,10,10),this.onAnimationEnd=null,this.blendMode=o.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new e.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.yG=new e.Vg(0,0,0),this._useLogarithmicDepth=!1,this.gravity=e.Vg.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new M.Sb(1,1,1,1),this.color2=new M.Sb(1,1,1,1),this.colorDead=new M.Sb(0,0,0,1),this.textureMask=new M.Sb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new z,this.id=I,this.name=I}createPointEmitter(I,g){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new e.Vg(0,1,0),arguments.length>2&&void 0!==arguments[2]||new e.Vg(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new e.Vg(0,1,0),arguments.length>4&&void 0!==arguments[4]||new e.Vg(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new e.Vg(0,1,0),arguments.length>3&&void 0!==arguments[3]||new e.Vg(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(I,g,b,e){throw new Error("Method not implemented.")}}o.BLENDMODE_ONEONE=0,o.BLENDMODE_STANDARD=1,o.BLENDMODE_ADD=2,o.BLENDMODE_MULTIPLY=3,o.BLENDMODE_MULTIPLYADD=4,o.BLENDMODE_SUBTRACT=-1,(0,J.g)("BABYLON.BaseParticleSystem",o);var n=b(12610),G=b(12426);class D{constructor(){this.direction1=new e.Vg(0,1,0),this.direction2=new e.Vg(0,1,0),this.minEmitBox=new e.Vg(-.5,-.5,-.5),this.maxEmitBox=new e.Vg(.5,.5,.5)}startDirectionFunction(I,g,b,c){const z=(0,n.RandomRange)(this.direction1.x,this.direction2.x),M=(0,n.RandomRange)(this.direction1.y,this.direction2.y),J=(0,n.RandomRange)(this.direction1.z,this.direction2.z);if(c)return g.x=z,g.y=M,void(g.z=J);e.Vg.TransformNormalFromFloatsToRef(z,M,J,I,g)}startPositionFunction(I,g,b,c){const z=(0,n.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),M=(0,n.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),J=(0,n.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(c)return g.x=z,g.y=M,void(g.z=J);e.Vg.TransformCoordinatesFromFloatsToRef(z,M,J,I,g)}clone(){const I=new D;return G.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2),I.setVector3("minEmitBox",this.minEmitBox),I.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3),I.addUniform("minEmitBox",3),I.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.bb(),I.direction2=this.direction2.bb(),I.minEmitBox=this.minEmitBox.bb(),I.maxEmitBox=this.maxEmitBox.bb(),I}parse(I){e.Vg.FromArrayToRef(I.direction1,0,this.direction1),e.Vg.FromArrayToRef(I.direction2,0,this.direction2),e.Vg.FromArrayToRef(I.minEmitBox,0,this.minEmitBox),e.Vg.FromArrayToRef(I.maxEmitBox,0,this.maxEmitBox)}}class p{get radius(){return this._radius}set radius(I){this._radius=I,this._buildHeight()}get angle(){return this._angle}set angle(I){this._angle=I,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=g,this.radius=I}startDirectionFunction(I,g,b,c){c?e.TmpVectors.Vg[0].G(b.CM).normalize():b.position.subtractToRef(I.getTranslation(),e.TmpVectors.Vg[0]).normalize();const z=(0,n.RandomRange)(0,this.directionRandomizer),M=(0,n.RandomRange)(0,this.directionRandomizer),J=(0,n.RandomRange)(0,this.directionRandomizer);g.x=e.TmpVectors.Vg[0].x+z,g.y=e.TmpVectors.Vg[0].y+M,g.z=e.TmpVectors.Vg[0].z+J,g.normalize()}startPositionFunction(I,g,b,c){const z=(0,n.RandomRange)(0,2*Math.PI);let M;this.emitFromSpawnPointOnly?M=1e-4:(M=(0,n.RandomRange)(0,this.heightRange),M=1-M*M);let J=this._radius-(0,n.RandomRange)(0,this._radius*this.radiusRange);J*=M;const o=J*Math.sin(z),G=J*Math.cos(z),D=M*this._height;if(c)return g.x=o,g.y=D,void(g.z=G);e.Vg.TransformCoordinatesFromFloatsToRef(o,D,G,I,g)}clone(){const I=new p(this._radius,this._angle,this.directionRandomizer);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat2("radius",this._radius,this.radiusRange),I.setFloat("coneAngle",this._angle),I.setFloat2("height",this._height,this.heightRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",2),I.addUniform("coneAngle",1),I.addUniform("height",2),I.addUniform("directionRandomizer",1)}getEffectDefines(){let I="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(I+="\n#define CONEEMITTERSPAWNPOINT"),I}getClassName(){return"ConeParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this._radius,I.angle=this._angle,I.directionRandomizer=this.directionRandomizer,I.radiusRange=this.radiusRange,I.heightRange=this.heightRange,I.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,I}parse(I){this.radius=I.radius,this.angle=I.angle,this.directionRandomizer=I.directionRandomizer,this.radiusRange=void 0!==I.radiusRange?I.radiusRange:1,this.heightRange=void 0!==I.radiusRange?I.heightRange:1,this.emitFromSpawnPointOnly=void 0!==I.emitFromSpawnPointOnly&&I.emitFromSpawnPointOnly}}class x extends p{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0);super(I,g),this.direction1=b,this.direction2=c}startDirectionFunction(I,g){const b=(0,n.RandomRange)(this.direction1.x,this.direction2.x),c=(0,n.RandomRange)(this.direction1.y,this.direction2.y),z=(0,n.RandomRange)(this.direction1.z,this.direction2.z);e.Vg.TransformNormalFromFloatsToRef(b,c,z,I,g)}clone(){const I=new x(this.radius,this.angle,this.direction1,this.direction2);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.bb(),I.direction2=this.direction2.bb(),I}parse(I){super.parse(I),this.direction1.G(I.direction1),this.direction2.G(I.direction2)}}class Z{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=I,this.height=g,this.radiusRange=b,this.directionRandomizer=c,this._tempVector=e.Vg.Zero()}startDirectionFunction(I,g,b,c,z){b.position.subtractToRef(I.getTranslation(),this._tempVector),this._tempVector.normalize(),e.Vg.TransformNormalToRef(this._tempVector,z,this._tempVector);const M=(0,n.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let J=Math.atan2(this._tempVector.x,this._tempVector.z);J+=(0,n.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=M,this._tempVector.x=Math.sin(J),this._tempVector.z=Math.cos(J),this._tempVector.normalize(),c?g.G(this._tempVector):e.Vg.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I,g)}startPositionFunction(I,g,b,c){const z=(0,n.RandomRange)(-this.height/2,this.height/2),M=(0,n.RandomRange)(0,2*Math.PI),J=(0,n.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),o=Math.sqrt(J)*this.radius,G=o*Math.cos(M),D=o*Math.sin(M);c?g.Db(G,z,D):e.Vg.TransformCoordinatesFromFloatsToRef(G,z,D,I,g)}clone(){const I=new Z(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.height=this.height,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.height=I.height,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class k extends Z{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.Vg(0,1,0);super(I,g,b),this.direction1=c,this.direction2=z}startDirectionFunction(I,g,b,c){const z=(0,n.RandomRange)(this.direction1.x,this.direction2.x),M=(0,n.RandomRange)(this.direction1.y,this.direction2.y),J=(0,n.RandomRange)(this.direction1.z,this.direction2.z);c?g.Db(z,M,J):e.Vg.TransformNormalFromFloatsToRef(z,M,J,I,g)}clone(){const I=new k(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.bb(),I.direction2=this.direction2.bb(),I}parse(I){super.parse(I),e.Vg.FromArrayToRef(I.direction1,0,this.direction1),e.Vg.FromArrayToRef(I.direction2,0,this.direction2)}}class S{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=g,this.directionRandomizer=b}startDirectionFunction(I,g,b,c){const z=b.position.ag(I.getTranslation()).normalize(),M=(0,n.RandomRange)(0,this.directionRandomizer),J=(0,n.RandomRange)(0,this.directionRandomizer),o=(0,n.RandomRange)(0,this.directionRandomizer);z.x+=M,z.y+=J,z.z+=o,z.normalize(),c?g.G(z):e.Vg.TransformNormalFromFloatsToRef(z.x,z.y,z.z,I,g)}startPositionFunction(I,g,b,c){const z=this.radius-(0,n.RandomRange)(0,this.radius*this.radiusRange),M=(0,n.RandomRange)(0,1),J=(0,n.RandomRange)(0,2*Math.PI),o=Math.acos(2*M-1),G=z*Math.cos(J)*Math.sin(o),D=z*Math.cos(o),p=z*Math.sin(J)*Math.sin(o);c?g.Db(G,Math.abs(D),p):e.Vg.TransformCoordinatesFromFloatsToRef(G,Math.abs(D),p,I,g)}clone(){const I=new S(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class f{constructor(){this.direction1=new e.Vg(0,1,0),this.direction2=new e.Vg(0,1,0)}startDirectionFunction(I,g,b,c){const z=(0,n.RandomRange)(this.direction1.x,this.direction2.x),M=(0,n.RandomRange)(this.direction1.y,this.direction2.y),J=(0,n.RandomRange)(this.direction1.z,this.direction2.z);c?g.Db(z,M,J):e.Vg.TransformNormalFromFloatsToRef(z,M,J,I,g)}startPositionFunction(I,g,b,c){c?g.Db(0,0,0):e.Vg.TransformCoordinatesFromFloatsToRef(0,0,0,I,g)}clone(){const I=new f;return G.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.bb(),I.direction2=this.direction2.bb(),I}parse(I){e.Vg.FromArrayToRef(I.direction1,0,this.direction1),e.Vg.FromArrayToRef(I.direction2,0,this.direction2)}}class V{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=g,this.directionRandomizer=b}startDirectionFunction(I,g,b,c){const z=b.position.ag(I.getTranslation()).normalize(),M=(0,n.RandomRange)(0,this.directionRandomizer),J=(0,n.RandomRange)(0,this.directionRandomizer),o=(0,n.RandomRange)(0,this.directionRandomizer);z.x+=M,z.y+=J,z.z+=o,z.normalize(),c?g.G(z):e.Vg.TransformNormalFromFloatsToRef(z.x,z.y,z.z,I,g)}startPositionFunction(I,g,b,c){const z=this.radius-(0,n.RandomRange)(0,this.radius*this.radiusRange),M=(0,n.RandomRange)(0,1),J=(0,n.RandomRange)(0,2*Math.PI),o=Math.acos(2*M-1),G=z*Math.cos(J)*Math.sin(o),D=z*Math.cos(o),p=z*Math.sin(J)*Math.sin(o);c?g.Db(G,D,p):e.Vg.TransformCoordinatesFromFloatsToRef(G,D,p,I,g)}clone(){const I=new V(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class a extends V{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.Vg(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0);super(I),this.direction1=g,this.direction2=b}startDirectionFunction(I,g){const b=(0,n.RandomRange)(this.direction1.x,this.direction2.x),c=(0,n.RandomRange)(this.direction1.y,this.direction2.y),z=(0,n.RandomRange)(this.direction1.z,this.direction2.z);e.Vg.TransformNormalFromFloatsToRef(b,c,z,I,g)}clone(){const I=new a(this.radius,this.direction1,this.direction2);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.bb(),I.direction2=this.direction2.bb(),I}parse(I){super.parse(I),this.direction1.G(I.direction1),this.direction2.G(I.direction2)}}class v{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(I,g,b,c){const z=e.TmpVectors.Vg[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,z);const I=e.TmpVectors.Vg[1];z.subtractToRef(b.position,I),I.scaleToRef(1/b.lifeTime,z)}else z.set(0,0,0);c?g.G(z):e.Vg.TransformNormalToRef(z,I,g)}startPositionFunction(I,g,b,c){const z=e.TmpVectors.Vg[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,z):z.set(0,0,0),c?g.G(z):e.Vg.TransformCoordinatesToRef(z,I,g)}clone(){const I=new v;return G.b.DeepCopy(this,I),I}applyToShader(I){}buildUniformLayout(I){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.particlePositionGenerator=this.particlePositionGenerator,I.particleDestinationGenerator=this.particleDestinationGenerator,I}parse(I){I.particlePositionGenerator&&(this.particlePositionGenerator=I.particlePositionGenerator),I.particleDestinationGenerator&&(this.particleDestinationGenerator=I.particleDestinationGenerator)}}var X=b(12659);class R{get mesh(){return this._mesh}set mesh(I){this._mesh!==I&&(this._mesh=I,I?(this._indices=I.nb(),this._positions=I.getVerticesData(X.f.PositionKind),this._normals=I.getVerticesData(X.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=e.Vg.Zero(),this._mesh=null,this.direction1=new e.Vg(0,1,0),this.direction2=new e.Vg(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=I}startDirectionFunction(I,g,b,c){if(this.useMeshNormalsForDirection&&this._normals)return void e.Vg.TransformNormalToRef(this._storedNormal,I,g);const z=(0,n.RandomRange)(this.direction1.x,this.direction2.x),M=(0,n.RandomRange)(this.direction1.y,this.direction2.y),J=(0,n.RandomRange)(this.direction1.z,this.direction2.z);c?g.Db(z,M,J):e.Vg.TransformNormalFromFloatsToRef(z,M,J,I,g)}startPositionFunction(I,g,b,c){if(!this._indices||!this._positions)return;const z=3*(Math.random()*(this._indices.length/3)|0),M=Math.random(),J=Math.random()*(1-M),o=1-M-J,n=this._indices[z],G=this._indices[z+1],D=this._indices[z+2],p=e.TmpVectors.Vg[0],x=e.TmpVectors.Vg[1],Z=e.TmpVectors.Vg[2],k=e.TmpVectors.Vg[3];e.Vg.FromArrayToRef(this._positions,3*n,p),e.Vg.FromArrayToRef(this._positions,3*G,x),e.Vg.FromArrayToRef(this._positions,3*D,Z),k.x=M*p.x+J*x.x+o*Z.x,k.y=M*p.y+J*x.y+o*Z.y,k.z=M*p.z+J*x.z+o*Z.z,c?g.Db(k.x,k.y,k.z):e.Vg.TransformCoordinatesFromFloatsToRef(k.x,k.y,k.z,I,g),this.useMeshNormalsForDirection&&this._normals&&(e.Vg.FromArrayToRef(this._normals,3*n,p),e.Vg.FromArrayToRef(this._normals,3*G,x),e.Vg.FromArrayToRef(this._normals,3*D,Z),this._storedNormal.x=M*p.x+J*x.x+o*Z.x,this._storedNormal.y=M*p.y+J*x.y+o*Z.y,this._storedNormal.z=M*p.z+J*x.z+o*Z.z)}clone(){const I=new R(this.mesh);return G.b.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var I;const g={};return g.type=this.getClassName(),g.direction1=this.direction1.bb(),g.direction2=this.direction2.bb(),g.meshId=null===(I=this.mesh)||void 0===I?void 0:I.id,g.useMeshNormalsForDirection=this.useMeshNormalsForDirection,g}parse(I,g){e.Vg.FromArrayToRef(I.direction1,0,this.direction1),e.Vg.FromArrayToRef(I.direction2,0,this.direction2),I.meshId&&g&&(this.mesh=g.getLastMeshById(I.meshId)),this.useMeshNormalsForDirection=I.useMeshNormalsForDirection}}class E{_isUbo(I){return void 0!==I.addUniform}constructor(I){this._isUbo(I)?(this.setMatrix3x3=I.updateMatrix3x3.bind(I),this.setMatrix2x2=I.updateMatrix2x2.bind(I),this.setFloat=I.updateFloat.bind(I),this.setFloat2=I.updateFloat2.bind(I),this.setFloat3=I.updateFloat3.bind(I),this.setFloat4=I.updateFloat4.bind(I),this.setFloatArray=I.updateFloatArray.bind(I),this.setArray=I.updateArray.bind(I),this.setIntArray=I.updateIntArray.bind(I),this.setMatrix=I.zb.bind(I),this.setMatrices=I.updateMatrices.bind(I),this.setVector3=I.updateVector3.bind(I),this.setVector4=I.updateVector4.bind(I),this.setColor3=I.updateColor3.bind(I),this.setColor4=I.updateColor4.bind(I),this.setDirectColor4=I.updateDirectColor4.bind(I),this.setInt=I.updateInt.bind(I),this.setInt2=I.updateInt2.bind(I),this.setInt3=I.updateInt3.bind(I),this.setInt4=I.updateInt4.bind(I)):(this.setMatrix3x3=I.setMatrix3x3.bind(I),this.setMatrix2x2=I.setMatrix2x2.bind(I),this.setFloat=I.setFloat.bind(I),this.setFloat2=I.setFloat2.bind(I),this.setFloat3=I.setFloat3.bind(I),this.setFloat4=I.setFloat4.bind(I),this.setFloatArray=I.setFloatArray.bind(I),this.setArray=I.setArray.bind(I),this.setIntArray=I.setIntArray.bind(I),this.setMatrix=I.setMatrix.bind(I),this.setMatrices=I.setMatrices.bind(I),this.setVector3=I.setVector3.bind(I),this.setVector4=I.setVector4.bind(I),this.setColor3=I.setColor3.bind(I),this.setColor4=I.setColor4.bind(I),this.setDirectColor4=I.setDirectColor4.bind(I),this.setInt=I.setInt.bind(I),this.setInt2=I.setInt2.bind(I),this.setInt3=I.setInt3.bind(I),this.setInt4=I.setInt4.bind(I))}}var mI=b(12509);const s="gpuUpdateParticlesPixelShader",F="#version 300 es\nvoid main() {discard;}\n";mI.c.ShadersStore[s]||(mI.c.ShadersStore[s]=F);const Y="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";mI.c.ShadersStore[Y]||(mI.c.ShadersStore[Y]=d);(0,J.g)("BABYLON.WebGL2ParticleSystem",class{constructor(I,g){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=I,this._engine=g,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var I;return(null===(I=this._updateEffect)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof v&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=I,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new E(this._updateEffect)}createVertexBuffers(I,g){this._updateVAO.push(this._createUpdateVAO(I)),this._renderVAO.push(this._engine.recordVertexArrayObject(g,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=g}createParticleBuffer(I){return I}bindDrawBuffers(I,g,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,g):this._engine.bindVertexArrayObject(this._renderVAO[I],null)}preUpdateParticleBuffer(){const I=this._engine;if(this._engine.enableEffect(this._updateEffect),!I.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(I,g,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[I],null);const e=this._engine;e.bindTransformFeedbackBuffer(g.getBuffer()),e.setRasterizerState(!1),e.beginTransformFeedback(!0),e.drawArraysType(3,0,b),e.endTransformFeedback(),e.setRasterizerState(!0),e.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let I=0;I<this._updateVAO.length;I++)this._engine.releaseVertexArrayObject(this._updateVAO[I]);this._updateVAO.length=0;for(let I=0;I<this._renderVAO.length;I++)this._engine.releaseVertexArrayObject(this._renderVAO[I]);this._renderVAO.length=0}_createUpdateVAO(I){const g={};g.position=I.createVertexBuffer("position",0,3);let b=3;g.age=I.createVertexBuffer("age",b,1),b+=1,g.size=I.createVertexBuffer("size",b,3),b+=3,g.life=I.createVertexBuffer("life",b,1),b+=1,g.seed=I.createVertexBuffer("seed",b,4),b+=4,g.direction=I.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof v&&(g.initialPosition=I.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(g.color=I.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(g.initialDirection=I.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(g.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",b,3),b+=3,g.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(g.angle=I.createVertexBuffer("angle",b,1),b+=1):(g.angle=I.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(g.cellIndex=I.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(g.cellStartOffset=I.createVertexBuffer("cellStartOffset",b,1),b+=1));const e=this._engine.recordVertexArrayObject(g,null,this._updateEffect);return this._engine.bindArrayBuffer(null),e}});class C{constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,e=arguments.length>3?arguments[3]:void 0;this._engine=I,this._label=e,this._engine._storageBuffers.push(this),this._create(g,b)}_create(I,g){this._bufferSize=I,this._creationFlags=g,this._buffer=this._engine.createStorageBuffer(I,g,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(I,g,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,I,g,b)}async read(I,g,b,e){return await this._engine.readFromStorageBuffer(this._buffer,I,g,b,e)}dispose(){const I=this._engine._storageBuffers,g=I.indexOf(this);-1!==g&&(I[g]=I[I.length-1],I.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var r=b(12577),O=b(12584),H=b(12622),i=b(12572),U=b(12876),h=b(12420),A=b(12538),j=b(12794);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.d}_addDuration(I,g){I<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==I?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(g,!1),this._gpuTimeInFrameId=I):this.counter.addCount(g,!1))}}var L=b(12488);class N{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=I,this._engine=g,this.uniqueId=U.b.UniqueId,g.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?e.bindingsMapping?(this._context=g.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...e}):h.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):h.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(I,g){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const e=this._bindings[I];this._bindings[I]={type:b?0:4,object:g,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!e||e.object!==g||e.type!==this._bindings[I].type)}setStorageTexture(I,g){const b=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==g),this._bindings[I]={type:1,object:g,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(I,g){const b=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==g),this._bindings[I]={type:6,object:g,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(I,g){return!!g.externalTexture&&(this.setExternalTexture(I,g.externalTexture),!0)}setUniformBuffer(I,g){const b=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==g),this._bindings[I]={type:N._BufferIsDataBuffer(g)?7:2,object:g,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(I,g){const b=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==g),this._bindings[I]={type:N._BufferIsDataBuffer(g)?7:3,object:g,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(I,g){const b=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!b||!g.compareSampler(b.object)),this._bindings[I]={type:5,object:g,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let I=this._effect;for(const c in this._bindings){const I=this._bindings[c],g=I.type,b=I.object;switch(g){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const g=[],b=this._shaderPath;if(this._options.defines)for(let c=0;c<this._options.defines.length;c++)g.push(this._options.defines[c]);const e=g.join("\n");return this._cachedDefines!==e&&(this._cachedDefines=e,I=this._engine.createComputeEffect(b,{defines:e,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=I),!!I.isReady()}dispatch(I,g,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,I,g,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=N._BufferIsDataBuffer(I)?I:I.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,g,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const g in this._bindings){const b=this._bindings[g];if(!this._options.bindingsMapping[g])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+g+"'");switch(b.type){case 0:{const e=this._samplers[g],c=b.object;var I;if(!e||!c._texture||!e.compareSampler(c._texture))this._samplers[g]=(new A.b).setParameters(c.wrapU,c.wrapV,c.wrapR,c.anisotropicFilteringLevel,c._texture.samplingMode,null===(I=c._texture)||void 0===I?void 0:I._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const I=b.object;I.getBuffer()!==b.buffer&&(b.buffer=I.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((c=>{(0,L.e)((()=>this.dispatch(I,g,b)),c,void 0,e)}))}serialize(){const I=H.b.Serialize(this);I.options=this._options,I.shaderPath=this._shaderPath,I.Px={},I.textures={};for(const g in this._bindings){const b=this._bindings[g],e=b.object;switch(b.type){case 0:case 4:case 1:{const c=e.serialize();c&&(I.textures[g]=c,I.Px[g]={type:b.type});break}}}return I}static Parse(I,g,b){const e=H.b.Parse((()=>new N(I.name,g.getEngine(),I.shaderPath,I.options)),I,g,b);for(const c in I.textures){const z=I.Px[c],M=i.b.Parse(I.textures[c],g,b);0===z.type?e.setTexture(c,M):4===z.type?e.setTexture(c,M,!1):e.setStorageTexture(c,M)}return e}static _BufferIsDataBuffer(I){return void 0!==I.underlyingResource}}(0,r.d)([(0,O.E)()],N.prototype,"name",void 0),(0,r.d)([(0,O.E)()],N.prototype,"fastMode",void 0),(0,J.g)("BABYLON.ComputeShader",N);var K=b(12837);const B="gpuUpdateParticlesComputeShader",P="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";mI.c.ShadersStoreWGSL[B]||(mI.c.ShadersStoreWGSL[B]=P);(0,J.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(I,g){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=I,this._engine=g}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var I;return(null===(I=this._updateComputeShader)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){var g;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new N("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:I.split("\n")}),null===(g=this._simParamsComputeShader)||void 0===g||g.dispose(),this._simParamsComputeShader=new K.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new E(this._simParamsComputeShader)}createVertexBuffers(I,g){this._renderVertexBuffers.push(g)}createParticleBuffer(I){const g=new C(this._engine,4*I.length,11,"ComputeShaderParticleSystemBuffer");return g.update(I),this._bufferComputeShader.push(g),g.getBuffer()}bindDrawBuffers(I,g,b){this._engine.bindBuffers(this._renderVertexBuffers[I],b,g)}preUpdateParticleBuffer(){}updateParticleBuffer(I,g,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[I]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^I]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var I;for(let g=0;g<this._bufferComputeShader.length;++g)this._bufferComputeShader[g].dispose();this._bufferComputeShader.length=0,null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class u{constructor(I,g,b){this.gradient=I,this.color1=g,this.color2=b}getColorToRef(I){this.color2?M.Sb.LerpToRef(this.color1,this.color2,Math.random(),I):I.G(this.color1)}}class t{constructor(I,g){this.gradient=I,this.color=g}}class y{constructor(I,g,b){this.gradient=I,this.factor1=g,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class q{static GetCurrentGradient(I,g,b){if(g[0].gradient>I)return void b(g[0],g[0],1);for(let c=0;c<g.length-1;c++){const e=g[c],z=g[c+1];if(I>=e.gradient&&I<=z.gradient){return void b(e,z,(I-e.gradient)/(z.gradient-e.gradient))}}const e=g.length-1;b(g[e],g[e],1)}}var l=b(12412),w=b(13050),T=b(12449);class W{constructor(I){this.particleSystem=I,this.position=e.Vg.Zero(),this.direction=e.Vg.Zero(),this.color=new M.Sb(0,0,0,0),this.colorStep=new M.Sb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new e.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new M.Sb(0,0,0,0),this._currentColor2=new M.Sb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=W._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let I=this.age,g=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===g?(g=1,I=this._randomCellOffset):I+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let e;e=this._initialSpriteCellLoop?(0,n.Clamp)(I*g%this.lifeTime/this.lifeTime):(0,n.Clamp)(I*g/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+e*b|0}_inheritParticleInfoToSubEmitter(I){if(I.particleSystem.cg.position){const g=I.particleSystem.cg;if(g.position.G(this.position),I.inheritDirection){const I=e.TmpVectors.Vg[0];this.direction.normalizeToRef(I),g.setDirection(I,0,Math.PI/2)}}else{I.particleSystem.cg.G(this.position)}this.direction.scaleToRef(I.inheritedVelocityAmount/2,e.TmpVectors.Vg[0]),I.particleSystem._inheritedVelocityOffset.G(e.TmpVectors.Vg[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const I of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(I)}_reset(){this.age=0,this.id=W._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(I){I.position.G(this.position),this._initialDirection?I._initialDirection?I._initialDirection.G(this._initialDirection):I._initialDirection=this._initialDirection.clone():I._initialDirection=null,I.direction.G(this.direction),this.CM&&(I.CM?I.CM.G(this.CM):I.CM=this.CM.clone()),I.color.G(this.color),I.colorStep.G(this.colorStep),I.lifeTime=this.lifeTime,I.age=this.age,I._randomCellOffset=this._randomCellOffset,I.size=this.size,I.scale.G(this.scale),I.angle=this.angle,I.angularSpeed=this.angularSpeed,I.particleSystem=this.particleSystem,I.cellIndex=this.cellIndex,I.id=this.id,I._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(I._currentColorGradient=this._currentColorGradient,I._currentColor1.G(this._currentColor1),I._currentColor2.G(this._currentColor2)),this._currentSizeGradient&&(I._currentSizeGradient=this._currentSizeGradient,I._currentSize1=this._currentSize1,I._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(I._currentAngularSpeedGradient=this._currentAngularSpeedGradient,I._currentAngularSpeed1=this._currentAngularSpeed1,I._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(I._currentVelocityGradient=this._currentVelocityGradient,I._currentVelocity1=this._currentVelocity1,I._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(I._currentLimitVelocityGradient=this._currentLimitVelocityGradient,I._currentLimitVelocity1=this._currentLimitVelocity1,I._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(I._currentDragGradient=this._currentDragGradient,I._currentDrag1=this._currentDrag1,I._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(I._initialStartSpriteCellId=this._initialStartSpriteCellId,I._initialEndSpriteCellId=this._initialEndSpriteCellId,I._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(I.remapData&&this.remapData?I.remapData.G(this.remapData):I.remapData=new e.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.G(this._randomNoiseCoordinates1),I._randomNoiseCoordinates2.G(this._randomNoiseCoordinates2)):(I._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),I._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}W._Count=0;var II=b(12704),gI=(b(12745),b(12952)),bI=b(12943),eI=b(12831);function cI(I,g){const b=(0,n.RandomRange)(0,1);M.Sb.LerpToRef(g.color1,g.color2,b,I.color),g.colorDead.subtractToRef(I.color,g._colorDiff),g._colorDiff.scaleToRef(1/I.lifeTime,I.colorStep)}function zI(I,g){I._currentColorGradient=g._colorGradients[0],I._currentColorGradient.getColorToRef(I.color),I._currentColor1.G(I.color),g._colorGradients.length>1?g._colorGradients[1].getColorToRef(I._currentColor2):I._currentColor2.G(I.color)}function MI(I,g){const b=g._colorGradients;q.GetCurrentGradient(g._ratio,b,((g,b,e)=>{g!==I._currentColorGradient&&(I._currentColor1.G(I._currentColor2),b.getColorToRef(I._currentColor2),I._currentColorGradient=g),M.Sb.LerpToRef(I._currentColor1,I._currentColor2,e,I.color)}))}function JI(I,g){I.colorStep.scaleToRef(g._scaledUpdateSpeed,g._scaledColorStep),I.color.addInPlace(g._scaledColorStep),I.color.a<0&&(I.color.a=0)}function oI(I,g){q.GetCurrentGradient(g._ratio,g._angularSpeedGradients,((g,b,e)=>{g!==I._currentAngularSpeedGradient&&(I._currentAngularSpeed1=I._currentAngularSpeed2,I._currentAngularSpeed2=b.getFactor(),I._currentAngularSpeedGradient=g),I.angularSpeed=(0,n.Lerp)(I._currentAngularSpeed1,I._currentAngularSpeed2,e)}))}function nI(I,g){I.angle+=I.angularSpeed*g._scaledUpdateSpeed}function GI(I,g){g.particleEmitterType.startDirectionFunction(g._emitterWorldMatrix,I.direction,I,g.isLocal,g._emitterInverseWorldMatrix)}function DI(I,g){g.startDirectionFunction(g._emitterWorldMatrix,I.direction,I,g.isLocal)}function pI(I,g){I._currentVelocityGradient=g._velocityGradients[0],I._currentVelocity1=I._currentVelocityGradient.getFactor(),g._velocityGradients.length>1?I._currentVelocity2=g._velocityGradients[1].getFactor():I._currentVelocity2=I._currentVelocity1}function xI(I,g){I._currentLimitVelocityGradient=g._limitVelocityGradients[0],I._currentLimitVelocity1=I._currentLimitVelocityGradient.getFactor(),g._limitVelocityGradients.length>1?I._currentLimitVelocity2=g._limitVelocityGradients[1].getFactor():I._currentLimitVelocity2=I._currentLimitVelocity1}function ZI(I,g){q.GetCurrentGradient(g._ratio,g._velocityGradients,((b,e,c)=>{b!==I._currentVelocityGradient&&(I._currentVelocity1=I._currentVelocity2,I._currentVelocity2=e.getFactor(),I._currentVelocityGradient=b),g._directionScale*=(0,n.Lerp)(I._currentVelocity1,I._currentVelocity2,c)}))}function kI(I,g){q.GetCurrentGradient(g._ratio,g._limitVelocityGradients,((b,e,c)=>{b!==I._currentLimitVelocityGradient&&(I._currentLimitVelocity1=I._currentLimitVelocity2,I._currentLimitVelocity2=e.getFactor(),I._currentLimitVelocityGradient=b);const z=(0,n.Lerp)(I._currentLimitVelocity1,I._currentLimitVelocity2,c);I.direction.length()>z&&I.direction.scaleInPlace(g.limitVelocityDamping)}))}function SI(I,g){I.direction.scaleToRef(g._directionScale,g._scaledDirection)}function fI(I,g){g.particleEmitterType.startPositionFunction(g._emitterWorldMatrix,I.position,I,g.isLocal)}function VI(I,g){g.startPositionFunction(g._emitterWorldMatrix,I.position,I,g.isLocal)}function aI(I,g){I.CM?I.CM.G(I.position):I.CM=I.position.clone(),e.Vg.TransformCoordinatesToRef(I.CM,g._emitterWorldMatrix,I.position)}function vI(I,g){g.isLocal&&I.CM?(I.CM.addInPlace(g._scaledDirection),e.Vg.TransformCoordinatesToRef(I.CM,g._emitterWorldMatrix,I.position)):I.position.addInPlace(g._scaledDirection)}function XI(I,g){I._currentDragGradient=g._dragGradients[0],I._currentDrag1=I._currentDragGradient.getFactor(),g._dragGradients.length>1?I._currentDrag2=g._dragGradients[1].getFactor():I._currentDrag2=I._currentDrag1}function RI(I,g){q.GetCurrentGradient(g._ratio,g._dragGradients,((b,e,c)=>{b!==I._currentDragGradient&&(I._currentDrag1=I._currentDrag2,I._currentDrag2=e.getFactor(),I._currentDragGradient=b);const z=(0,n.Lerp)(I._currentDrag1,I._currentDrag2,c);g._scaledDirection.scaleInPlace(1-z)}))}function EI(I,g){I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.Db(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2.Db(Math.random(),Math.random(),Math.random())):(I._randomNoiseCoordinates1=new e.Vg(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2=new e.Vg(Math.random(),Math.random(),Math.random()))}function mg(I,g){const b=g._noiseTextureData,c=g._noiseTextureSize;if(b&&c&&I._randomNoiseCoordinates1){const z=g._fetchR(I._randomNoiseCoordinates1.x,I._randomNoiseCoordinates1.y,c.width,c.height,b),M=g._fetchR(I._randomNoiseCoordinates1.z,I._randomNoiseCoordinates2.x,c.width,c.height,b),J=g._fetchR(I._randomNoiseCoordinates2.y,I._randomNoiseCoordinates2.z,c.width,c.height,b),o=e.TmpVectors.Vg[0],n=e.TmpVectors.Vg[1];o.Db((2*z-1)*g.noiseStrength.x,(2*M-1)*g.noiseStrength.y,(2*J-1)*g.noiseStrength.z),o.scaleToRef(g._tempScaledUpdateSpeed,n),I.direction.addInPlace(n)}}function sI(I,g){g.gravity.scaleToRef(g._tempScaledUpdateSpeed,g._scaledGravity),I.direction.addInPlace(g._scaledGravity)}function FI(I,g){I.size=(0,n.RandomRange)(g.minSize,g.maxSize),I.scale.Db((0,n.RandomRange)(g.minScaleX,g.maxScaleX),(0,n.RandomRange)(g.minScaleY,g.maxScaleY))}function YI(I,g){I._currentSizeGradient=g._sizeGradients[0],I._currentSize1=I._currentSizeGradient.getFactor(),I.size=I._currentSize1,g._sizeGradients.length>1?I._currentSize2=g._sizeGradients[1].getFactor():I._currentSize2=I._currentSize1,I.scale.Db((0,n.RandomRange)(g.minScaleX,g.maxScaleX),(0,n.RandomRange)(g.minScaleY,g.maxScaleY))}function dI(I,g){const b=g._actualFrame/g.targetStopDuration;q.GetCurrentGradient(b,g._startSizeGradients,((b,e,c)=>{b!==g._currentStartSizeGradient&&(g._currentStartSize1=g._currentStartSize2,g._currentStartSize2=e.getFactor(),g._currentStartSizeGradient=b);const z=(0,n.Lerp)(g._currentStartSize1,g._currentStartSize2,c);I.scale.scaleInPlace(z)}))}function CI(I,g){q.GetCurrentGradient(g._ratio,g._sizeGradients,((g,b,e)=>{g!==I._currentSizeGradient&&(I._currentSize1=I._currentSize2,I._currentSize2=b.getFactor(),I._currentSizeGradient=g),I.size=(0,n.Lerp)(I._currentSize1,I._currentSize2,e)}))}function rI(I,g){I.remapData=new e.Vector4(0,1,0,1)}function OI(I,g){g._colorRemapGradients&&g._colorRemapGradients.length>0&&q.GetCurrentGradient(g._ratio,g._colorRemapGradients,((g,b,e)=>{const c=(0,n.Lerp)(g.factor1,b.factor1,e),z=(0,n.Lerp)(g.factor2,b.factor2,e);I.remapData.x=c,I.remapData.y=z-c})),g._alphaRemapGradients&&g._alphaRemapGradients.length>0&&q.GetCurrentGradient(g._ratio,g._alphaRemapGradients,((g,b,e)=>{const c=(0,n.Lerp)(g.factor1,b.factor1,e),z=(0,n.Lerp)(g.factor2,b.factor2,e);I.remapData.z=c,I.remapData.w=z-c}))}function HI(I,g){const b=(0,n.Clamp)(g._actualFrame/g.targetStopDuration);q.GetCurrentGradient(b,g._lifeTimeGradients,((g,e)=>{const c=g,z=e,M=c.getFactor(),J=z.getFactor(),o=(b-c.gradient)/(z.gradient-c.gradient);I.lifeTime=(0,n.Lerp)(M,J,o)})),g._emitPower=(0,n.RandomRange)(g.minEmitPower,g.maxEmitPower)}function iI(I,g){I.lifeTime=(0,n.RandomRange)(g.minLifeTime,g.maxLifeTime),g._emitPower=(0,n.RandomRange)(g.minEmitPower,g.maxEmitPower)}function UI(I,g){0===g._emitPower?(I._initialDirection?I._initialDirection.G(I.direction):I._initialDirection=I.direction.clone(),I.direction.set(0,0,0)):(I._initialDirection=null,I.direction.scaleInPlace(g._emitPower)),I.direction.addInPlace(g._inheritedVelocityOffset)}function hI(I,g){I.angularSpeed=(0,n.RandomRange)(g.minAngularSpeed,g.maxAngularSpeed),I.angle=(0,n.RandomRange)(g.minInitialRotation,g.maxInitialRotation)}function AI(I,g){I._currentAngularSpeedGradient=g._angularSpeedGradients[0],I.angularSpeed=I._currentAngularSpeedGradient.getFactor(),I._currentAngularSpeed1=I.angularSpeed,g._angularSpeedGradients.length>1?I._currentAngularSpeed2=g._angularSpeedGradients[1].getFactor():I._currentAngularSpeed2=I._currentAngularSpeed1,I.angle=(0,n.RandomRange)(g.minInitialRotation,g.maxInitialRotation)}function jI(I,g){I._initialStartSpriteCellId=g.startSpriteCellID,I._initialEndSpriteCellId=g.endSpriteCellID,I._initialSpriteCellLoop=g.spriteCellLoop}function QI(I,g){I.previousItem=g.previousItem,I.nextItem=g,g.previousItem&&(g.previousItem.nextItem=I),g.previousItem=I}function LI(I,g){I.previousItem=g,I.nextItem=g.nextItem,g.nextItem&&(g.nextItem.previousItem=I),g.nextItem=I}function NI(I,g){let b=g;for(;b.nextItem;)b=b.nextItem;I.previousItem=b,I.nextItem=b.nextItem,b.nextItem=I}function KI(I){I.previousItem&&(I.previousItem.nextItem=I.nextItem),I.nextItem&&(I.nextItem.previousItem=I.previousItem)}class BI extends o{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(I){this._startDirectionFunction!==I&&(this._startDirectionFunction=I,this._directionProcessing.process=I?DI:GI)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(I){this._startPositionFunction!==I&&(this._startPositionFunction=I,this._positionCreation.process=I?VI:fI)}set onDispose(I){this._onDisposeObserver&&this.Og.remove(this._onDisposeObserver),this._onDisposeObserver=this.Og.add(I)}get Z(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(I){this._useRampGradients!==I&&(this._useRampGradients=I,this._resetEffect(),I?(this._rampCreation={process:rI,previousItem:null,nextItem:null},LI(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:OI,previousItem:null,nextItem:null},LI(this._remapGradientProcessing,this._gravityProcessing)):(KI(this._rampCreation),KI(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(I){this._isLocal!==I&&(this._isLocal=I,I?(this._isLocalCreation={process:aI,previousItem:null,nextItem:null},LI(this._isLocalCreation,this._positionCreation)):KI(this._isLocalCreation))}get particles(){return this.Qx}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I,I?(this._sheetCreation={process:jI,previousItem:null,nextItem:null},LI(this._sheetCreation,this._colorCreation)):KI(this._sheetCreation),this._reset())}getActiveCount(){return this.Qx.length}getClassName(){return"Eb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var I;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[g])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[g]=new II.e(this._engine),this._customWrappers[g].effect=I,this._customWrappers[g].drawContext&&(this._customWrappers[g].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){if(this.noiseTexture!==I){if(this._noiseTexture=I,!I)return KI(this._noiseCreation),void KI(this._noiseProcessing);this._noiseCreation={process:EI,previousItem:null,nextItem:null},LI(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:mg,previousItem:null,nextItem:null},LI(this._noiseProcessing,this._positionProcessing)}}constructor(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(I),this._emitterInverseWorldMatrix=e.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new e.Vg,this.Og=new l.c,this.onStoppedObservable=new l.c,this.onStartedObservable=new l.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.Qx=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new M.Sb(0,0,0,0),this._colorDiff=new M.Sb(0,0,0,0),this._scaledDirection=e.Vg.Zero(),this._scaledGravity=e.Vg.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=I=>{},this.recycleParticle=I=>{const g=this.Qx.pop();g!==I&&g.copyTo(I),this._stockParticles.push(g)},this._createParticle=()=>{let I;return 0!==this._stockParticles.length?(I=this._stockParticles.pop(),I._reset()):I=new W(this),this._prepareParticle(I),I},this.paused=!1,this._shadersLoaded=!1,this._capacity=g,this._epsilon=J,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||T.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ax.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:iI,previousItem:null,nextItem:null},this._positionCreation={process:fI,previousItem:null,nextItem:null},LI(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:GI,previousItem:null,nextItem:null},LI(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:UI,previousItem:null,nextItem:null},LI(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:FI,previousItem:null,nextItem:null},LI(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:hI,previousItem:null,nextItem:null},LI(this._angleCreation,this._sizeCreation),this._colorCreation={process:cI,previousItem:null,nextItem:null},LI(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,o||(this._colorProcessing={process:JI,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:nI,previousItem:null,nextItem:null},LI(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:SI,previousItem:null,nextItem:null},LI(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:vI,previousItem:null,nextItem:null},LI(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:sI,previousItem:null,nextItem:null},LI(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new II.e(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new D,this.updateFunction=I=>{var g;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(g=this.noiseTexture.getContent())||void 0===g||g.then((I=>{this._noiseTextureData=I})));const b=I===this.Qx;for(let e=0;e<I.length;e++){const g=I[e];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const c=g.age;if(g.age+=this._tempScaledUpdateSpeed,g.age>g.lifeTime){const I=g.age-c,b=g.lifeTime-c;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/I,g.age=g.lifeTime}this._ratio=g.age/g.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let z=this._updateQueueStart;for(;z;)z.process(g,this),z=z.nextItem;if(this._isAnimationSheetEnabled&&!o&&g.updateCellIndex(),g._inheritParticleInfoToSubEmitters(),g.age>=g.lifeTime){if(this._emitFromParticle(g),g._attachedSubEmitters){for(const I of g._attachedSubEmitters)I.particleSystem.disposeOnStop=!0,I.particleSystem.stop();g._attachedSubEmitters=null}this.recycleParticle(g),b&&e--}else;}}}serialize(I){throw new Error("Method not implemented.")}clone(I,g){throw new Error("Method not implemented.")}_addFactorGradient(I,g,b,e){const c=new y(g,b,e);I.push(c),I.sort(((I,g)=>I.gradient<g.gradient?-1:I.gradient>g.gradient?1:0))}_removeFactorGradient(I,g){if(!I)return;let b=0;for(const e of I){if(e.gradient===g){I.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=HI:this._lifeTimeCreation.process=iI}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:dI,previousItem:null,nextItem:null},LI(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(KI(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this.targetStopDuration!==I&&(this._targetStopDuration=I,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(I,g,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,I,g,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(I){return this._removeFactorGradient(this._lifeTimeGradients,I),this._syncLifeTimeCreation(),this}addSizeGradient(I,g,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=YI,this._sizeGradientProcessing={process:CI,previousItem:null,nextItem:null},QI(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,I,g,b),this}removeSizeGradient(I){var g;return this._removeFactorGradient(this._sizeGradients,I),0===(null===(g=this._sizeGradients)||void 0===g?void 0:g.length)&&(KI(this._sizeGradientProcessing),this._sizeCreation.process=FI),this}addColorRemapGradient(I,g,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,I,g,b),this}removeColorRemapGradient(I){return this._removeFactorGradient(this._colorRemapGradients,I),this}addAlphaRemapGradient(I,g,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,I,g,b),this}removeAlphaRemapGradient(I){return this._removeFactorGradient(this._alphaRemapGradients,I),this}addAngularSpeedGradient(I,g,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=AI,this._angularSpeedGradientProcessing={process:oI,previousItem:null,nextItem:null},QI(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,I,g,b),this}removeAngularSpeedGradient(I){var g;return this._removeFactorGradient(this._angularSpeedGradients,I),0===(null===(g=this._angularSpeedGradients)||void 0===g?void 0:g.length)&&(this._angleCreation.process=hI,KI(this._angularSpeedGradientProcessing)),this}addVelocityGradient(I,g,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:pI,previousItem:null,nextItem:null},LI(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:ZI,previousItem:null,nextItem:null},QI(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,I,g,b),this}removeVelocityGradient(I){var g;return this._removeFactorGradient(this._velocityGradients,I),0===(null===(g=this._velocityGradients)||void 0===g?void 0:g.length)&&(KI(this._velocityCreation),KI(this._velocityGradientProcessing)),this}addLimitVelocityGradient(I,g,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:xI,previousItem:null,nextItem:null},LI(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:kI,previousItem:null,nextItem:null},LI(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,I,g,b),this}removeLimitVelocityGradient(I){var g;return this._removeFactorGradient(this._limitVelocityGradients,I),0===(null===(g=this._limitVelocityGradients)||void 0===g?void 0:g.length)&&(KI(this._limitVelocityCreation),KI(this._limitVelocityGradientProcessing)),this}addDragGradient(I,g,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:XI,previousItem:null,nextItem:null},QI(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:RI,previousItem:null,nextItem:null},QI(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,I,g,b),this}removeDragGradient(I){var g;return this._removeFactorGradient(this._dragGradients,I),0===(null===(g=this._dragGradients)||void 0===g?void 0:g.length)&&(KI(this._dragCreation),KI(this._dragGradientProcessing)),this}addEmitRateGradient(I,g,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,I,g,b),this}removeEmitRateGradient(I){return this._removeFactorGradient(this._emitRateGradients,I),this}addStartSizeGradient(I,g,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,I,g,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(I){return this._removeFactorGradient(this._startSizeGradients,I),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const I=new Uint8Array(4*this._rawTextureWidth),g=M.TmpColors.Eg[0];for(let b=0;b<this._rawTextureWidth;b++){const e=b/this._rawTextureWidth;q.GetCurrentGradient(e,this._rampGradients,((e,c,z)=>{M.Eg.LerpToRef(e.color,c.color,z,g),I[4*b]=255*g.r,I[4*b+1]=255*g.g,I[4*b+2]=255*g.b,I[4*b+3]=255}))}this._rampGradientsTexture=w.b.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((I,g)=>I.gradient<g.gradient?-1:I.gradient>g.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(I,g){this._rampGradients||(this._rampGradients=[]);const b=new t(I,g);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(I){return this._removeGradientAndTexture(I,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(I,g,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=zI,this._colorProcessing.process=MI);const e=new u(I,g,b);return this._colorGradients.push(e),this._colorGradients.sort(((I,g)=>I.gradient<g.gradient?-1:I.gradient>g.gradient?1:0)),this}removeColorGradient(I){if(!this._colorGradients)return this;let g=0;for(const b of this._colorGradients){if(b.gradient===I){this._colorGradients.splice(g,1);break}g++}return 0===this._colorGradients.length&&(this._colorCreation.process=cI,this._colorProcessing.process=JI),this}resetDrawCache(){if(this._drawWrappers){for(const I of this._drawWrappers)if(I)for(const g of I)null===g||void 0===g||g.dispose();this._drawWrappers=[]}}_fetchR(I,g,b,e,c){return c[4*(((I=.5*Math.abs(I)+.5)*b%b|0)+((g=.5*Math.abs(g)+.5)*e%e|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const I=this._engine,g=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*g),this._vertexBuffer=new X.d(I,this._vertexData,!0,g);let b=0;const e=this._vertexBuffer.createVertexBuffer(X.f.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.f.PositionKind]=e,b+=3;const c=this._vertexBuffer.createVertexBuffer(X.f.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[X.f.ColorKind]=c,b+=4;const z=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=z,b+=1;const M=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=M,b+=2,this._isAnimationSheetEnabled){const I=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=I,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const I=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=I,b+=3}if(this._useRampGradients){const I=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=I,b+=4}let J;if(this._useInstancing){const g=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new X.d(I,g,!1,2),J=this._spriteBuffer.createVertexBuffer("offset",0,2)}else J=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=J,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const I=[],g=[];let b=0;for(let e=0;e<this._capacity;e++)I.push(b),I.push(b+1),I.push(b+2),I.push(b),I.push(b+2),I.push(b+3),g.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(I),this._linesIndexBuffer=this._engine.createIndexBuffer(g)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(I)setTimeout((()=>{this.start(0)}),I);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var g;-1!==(null===(g=this.cg)||void 0===g?void 0:g.getClassName().indexOf("Mesh"))&&this.cg.Mb(!0);const I=this.noiseTexture;if(I&&I.onGeneratedObservable)I.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let g=0;g<this.preWarmCycles;g++)this.animate(!0),I.render()}))}));else for(let g=0;g<this.preWarmCycles;g++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(I))}_postStop(I){}reset(){this._stockParticles.length=0,this.Qx.length=0}_appendParticleVertex(I,g,b,c){let z=I*this._vertexBufferSize;if(this._vertexData[z++]=g.position.x+this.yG.x,this._vertexData[z++]=g.position.y+this.yG.y,this._vertexData[z++]=g.position.z+this.yG.z,this._vertexData[z++]=g.color.r,this._vertexData[z++]=g.color.g,this._vertexData[z++]=g.color.b,this._vertexData[z++]=g.color.a,this._vertexData[z++]=g.angle,this._vertexData[z++]=g.scale.x*g.size,this._vertexData[z++]=g.scale.y*g.size,this._isAnimationSheetEnabled&&(this._vertexData[z++]=g.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[z++]=g.direction.x,this._vertexData[z++]=g.direction.y,this._vertexData[z++]=g.direction.z);else if(g._initialDirection){let I=g._initialDirection;this.isLocal&&(e.Vg.TransformNormalToRef(I,this._emitterWorldMatrix,e.TmpVectors.Vg[0]),I=e.TmpVectors.Vg[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[z++]=I.x,this._vertexData[z++]=I.y,this._vertexData[z++]=I.z}else{let I=g.direction;this.isLocal&&(e.Vg.TransformNormalToRef(I,this._emitterWorldMatrix,e.TmpVectors.Vg[0]),I=e.TmpVectors.Vg[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[z++]=I.x,this._vertexData[z++]=I.y,this._vertexData[z++]=I.z}this._useRampGradients&&g.remapData&&(this._vertexData[z++]=g.remapData.x,this._vertexData[z++]=g.remapData.y,this._vertexData[z++]=g.remapData.z,this._vertexData[z++]=g.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===c?c=this._epsilon:1===c&&(c=1-this._epsilon)),this._vertexData[z++]=b,this._vertexData[z++]=c)}_prepareParticle(I){}_createNewOnes(I){let g;for(let b=0;b<I&&this.Qx.length!==this._capacity;b++){g=this._createParticle(),this.Qx.push(g);let I=this._createQueueStart;for(;I;)I.process(g,this),I=I.nextItem;g._inheritParticleInfoToSubEmitters()}}_update(I){if(this._alive=this.Qx.length>0,this.cg.position){const I=this.cg;this._emitterWorldMatrix=I.getWorldMatrix()}else{const I=this.cg;this._emitterWorldMatrix=e.Matrix.Translation(I.x,I.y,I.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Qx),this._createNewOnes(I)}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=[X.f.PositionKind,X.f.ColorKind,"angle","offset","size"];return I&&e.push("cellIndex"),g||e.push("direction"),b&&e.push("remapData"),e}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,gI.b)(e),I&&e.push("particlesInfos"),g&&e.push("logarithmicDepthConstant"),b&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(I,g){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,gI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&I.push("#define FOG")),this._isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),g===o.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&I.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case 2:I.push("#define BILLBOARDY");break;case 8:case 9:I.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&I.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:I.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,g,b){g.push(...BI._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),I.push(...BI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,eI.e)(I,this._imageProcessingConfigurationDefines),(0,eI.d)(b,this._imageProcessingConfigurationDefines))}_getWrapper(I){const g=this._getCustomDrawWrapper(I);if(null!==g&&void 0!==g&&g.effect)return g;const b=[];this.fillDefines(b,I);const e=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let c=this._drawWrappers[e];c||(c=this._drawWrappers[e]=[]);let z=c[I];z||(z=new II.e(this._engine),z.drawContext&&(z.drawContext.useInstancing=this._useInstancing),c[I]=z);const M=b.join("\n");if(z.defines!==M){const I=[],g=[],b=[];this.fillUniformsAttributesAndSamplerNames(g,I,b),z.setEffect(this._engine.createEffect("particles",I,g,b,M,void 0,void 0,void 0,void 0,this._shaderLanguage),M)}return z}animate(){var I;let g,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this.manualEmitCount>-1)g=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let I=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const g=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(g,this._emitRateGradients,((g,b,e)=>{g!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=g),I=(0,n.Lerp)(this._currentEmitRate1,this._currentEmitRate2,e)}))}g=I*this._scaledUpdateSpeed|0,this._newPartsExcess+=I*this._scaledUpdateSpeed-g}if(this._newPartsExcess>1&&(g+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?g=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(g),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let I=0;for(let g=0;g<this.Qx.length;g++){const b=this.Qx[g];this._appendParticleVertices(I,b),I+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Qx.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(I,g){this._appendParticleVertex(I++,g,0,0),this._useInstancing||(this._appendParticleVertex(I++,g,1,0),this._appendParticleVertex(I++,g,1,1),this._appendParticleVertex(I++,g,0,1))}rebuild(){var I;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(I=this._spriteBuffer)||void 0===I||I._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!BI.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,14048)),Promise.resolve().then(b.bind(b,14006))])):await Promise.all([Promise.resolve().then(b.bind(b,13990)),Promise.resolve().then(b.bind(b,13977))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.cg||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==o.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(o.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(o.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(I){const g=this._getWrapper(I),b=g.effect,c=this._engine;c.enableEffect(g);const z=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",z),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,this.spriteCellWidth/I.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;b.setVector3("eyePosition",I.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const M=b.defines;var J,o,n,G,D,p;(this._scene&&((0,gI.f)(b,this,this._scene),this.applyFog&&(0,bI.d)(this._scene,void 0,b)),M.indexOf("#define BILLBOARDMODE_ALL")>=0&&(z.invertToRef(e.TmpVectors.Matrix[0]),b.setMatrix("invView",e.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?c.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?c.bindBuffers(this._vertexBuffers,null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):c.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bI.j)(M,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?c.drawElementsType(6,0,10,this.Qx.length):c.drawArraysType(7,0,4,this.Qx.length):null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?c.drawElementsType(1,0,10*this.Qx.length):c.drawElementsType(0,0,6*this.Qx.length);return this.Qx.length}render(){if(!this.isReady()||!this.Qx.length)return 0;const I=this._engine;I.setState&&(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0));let g=0;return g=this.blendMode===o.BLENDMODE_MULTIPLYADD?this._render(o.BLENDMODE_MULTIPLY)+this._render(o.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),g}_onDispose(){}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(g,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const I=this._scene.Ax.indexOf(this);I>-1&&this._scene.Ax.splice(I,1),this._scene._activeParticleSystems.dispose()}this.Og.notifyObservers(this),this.Og.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}BI.ForceGLSL=!1;var PI,uI=b(12437);!function(I){I[I.ATTACHED=0]="ATTACHED",I[I.END=1]="END"}(PI||(PI={}));class tI{constructor(I){if(this.particleSystem=I,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!I.cg||!I.cg.dispose){const g=(0,J.d)("BABYLON.AbstractMesh");I.cg=new g("SubemitterSystemEmitter",I.EI()),I._disposeEmitterOnDispose=!0}}clone(){let I=this.particleSystem.cg;if(I){if(I instanceof e.Vg)I=I.clone();else if(-1!==I.getClassName().indexOf("Mesh")){I=new((0,J.d)("BABYLON.Mesh"))("",I.EI()),I.isVisible=!1}}else I=new e.Vg;const g=new tI(this.particleSystem.clone(this.particleSystem.name,I));return g.particleSystem.name+="Clone",g.type=this.type,g.inheritDirection=this.inheritDirection,g.inheritedVelocityAmount=this.inheritedVelocityAmount,g.particleSystem._disposeEmitterOnDispose=!0,g.particleSystem.disposeOnStop=!0,g}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};return g.type=this.type,g.inheritDirection=this.inheritDirection,g.inheritedVelocityAmount=this.inheritedVelocityAmount,g.particleSystem=this.particleSystem.serialize(I),g}static _ParseParticleSystem(I,g,b){throw(0,uI.c)("ParseParticle")}static Parse(I,g,b){const e=I.particleSystem,c=new tI(tI._ParseParticleSystem(e,g,b,!0));return c.type=I.type,c.inheritDirection=I.inheritDirection,c.inheritedVelocityAmount=I.inheritedVelocityAmount,c.particleSystem._isSubEmitter=!0,c}dispose(){this.particleSystem.dispose()}}var yI=b(12497);function qI(I,g){const b=new f;return b.direction1=I,b.direction2=g,b}function lI(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function wI(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function TI(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.Vg(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0);return new a(I,g,b)}function WI(){return new Z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Ig(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.Vg(0,1,0);return new k(I,g,b,c,z)}function gg(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new p(I,g)}function bg(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0),c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0);return new x(I,g,b,c)}const eg=e.Vg.Zero(),cg=e.Vg.Zero(),zg=e.Vg.Zero();class Mg{constructor(){this.strength=0,this.position=e.Vg.Zero()}_processParticle(I,g){this.position.subtractToRef(I.position,eg);const b=eg.lengthSquared()+1;eg.normalize().scaleToRef(this.strength/b,cg),cg.scaleToRef(g._tempScaledUpdateSpeed,zg),I.direction.addInPlace(zg)}serialize(){return{position:this.position.bb(),strength:this.strength}}}class Jg extends BI{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=I=>{if(!this._subEmitters||0===this._subEmitters.length)return;const g=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[g])if(1===b.type){const g=b.clone();I._inheritParticleInfoToSubEmitter(g),g.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(g.particleSystem),g.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(I,g){const b=qI(I,g);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I,this._flowMapUpdate&&(KI(this._flowMapUpdate),this._flowMapUpdate=null),I&&(this._flowMapUpdate={process:I=>{var g;const b=null===(g=this.EI())||void 0===g?void 0:g.getTransformMatrix();this._flowMap._processParticle(I,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},LI(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(I){this._attractors.push(I),1===this._attractors.length&&(this._attractorUpdate={process:I=>{for(const g of this._attractors)g._processParticle(I,this)},previousItem:null,nextItem:null},LI(this._attractorUpdate,this._directionProcessing))}removeAttractor(I){const g=this._attractors.indexOf(I);-1!==g&&this._attractors.splice(g,1),0===this._attractors.length&&KI(this._attractorUpdate)}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(I)}createHemisphericEmitter(){const I=lI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=wI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=TI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.Vg(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=WI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=Ig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=gg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=bg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,g,b,e){const c=new D;return this.particleEmitterType=c,this.direction1=I,this.direction2=g,this.minEmitBox=b,this.maxEmitBox=e,c}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const I of this.subEmitters)I instanceof Jg?this._subEmitters.push([new tI(I)]):I instanceof tI?this._subEmitters.push([I]):I instanceof Array&&this._subEmitters.push(I)}_stopSubEmitters(){if(this.activeSubSystems){for(const I of this.activeSubSystems)I.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const I=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==I&&this._rootParticleSystem.activeSubSystems.splice(I,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(I){I&&this._stopSubEmitters()}_prepareParticle(I){if(this._subEmitters&&this._subEmitters.length>0){const g=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];I._attachedSubEmitters=[];for(const b of g)if(0===b.type){const g=b.clone();I._attachedSubEmitters.push(g),g.particleSystem.start()}}}_onDispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),I&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let I=b._attachedSubEmitters.length-1;I>=0;I-=1)b._attachedSubEmitters[I].dispose();if(g&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let I=0;I<this._subEmitters.length;I++)for(const g of this._subEmitters[I])g.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.cg&&this.cg.dispose&&this.cg.dispose(!0)}static _Parse(I,g,b,c){let z;z=b instanceof yI.c?null:b;const o=(0,J.d)("BABYLON.Texture");if(o&&z&&(I.texture?g.particleTexture=o.Parse(I.texture,z,c):I.textureName&&(g.particleTexture=new o(c+I.textureName,z,!1,void 0===I.invertY||I.invertY),g.particleTexture.name=I.textureName)),I.emitterId||0===I.emitterId||void 0!==I.cg?I.emitterId&&z?g.cg=z.getLastMeshById(I.emitterId):g.cg=e.Vg.mb(I.cg):g.cg=e.Vg.Zero(),g.isLocal=!!I.isLocal,void 0!==I.renderingGroupId&&(g.renderingGroupId=I.renderingGroupId),void 0!==I.isBillboardBased&&(g.isBillboardBased=I.isBillboardBased),void 0!==I.billboardMode&&(g.billboardMode=I.billboardMode),void 0!==I.useLogarithmicDepth&&(g.useLogarithmicDepth=I.useLogarithmicDepth),I.animations){for(let b=0;b<I.animations.length;b++){const e=I.animations[b],c=(0,J.d)("BABYLON.Animation");c&&g.animations.push(c.Parse(e))}g.beginAnimationOnStart=I.beginAnimationOnStart,g.beginAnimationFrom=I.beginAnimationFrom,g.beginAnimationTo=I.beginAnimationTo,g.beginAnimationLoop=I.beginAnimationLoop}if(I.autoAnimate&&z&&z.beginAnimation(g,I.autoAnimateFrom,I.autoAnimateTo,I.autoAnimateLoop,I.autoAnimateSpeed||1),g.startDelay=0|I.startDelay,g.minAngularSpeed=I.minAngularSpeed,g.maxAngularSpeed=I.maxAngularSpeed,g.minSize=I.minSize,g.maxSize=I.maxSize,I.minScaleX&&(g.minScaleX=I.minScaleX,g.maxScaleX=I.maxScaleX,g.minScaleY=I.minScaleY,g.maxScaleY=I.maxScaleY),void 0!==I.preWarmCycles&&(g.preWarmCycles=I.preWarmCycles,g.preWarmStepOffset=I.preWarmStepOffset),void 0!==I.minInitialRotation&&(g.minInitialRotation=I.minInitialRotation,g.maxInitialRotation=I.maxInitialRotation),g.minLifeTime=I.minLifeTime,g.maxLifeTime=I.maxLifeTime,g.minEmitPower=I.minEmitPower,g.maxEmitPower=I.maxEmitPower,g.emitRate=I.emitRate,g.gravity=e.Vg.mb(I.gravity),I.noiseStrength&&(g.noiseStrength=e.Vg.mb(I.noiseStrength)),g.color1=M.Sb.mb(I.color1),g.color2=M.Sb.mb(I.color2),g.colorDead=M.Sb.mb(I.colorDead),g.updateSpeed=I.updateSpeed,g.targetStopDuration=I.targetStopDuration,g.blendMode=I.blendMode,I.colorGradients)for(const e of I.colorGradients)g.addColorGradient(e.gradient,M.Sb.mb(e.color1),e.color2?M.Sb.mb(e.color2):void 0);if(I.rampGradients){for(const b of I.rampGradients)g.addRampGradient(b.gradient,M.Eg.mb(b.color));g.useRampGradients=I.useRampGradients}if(I.colorRemapGradients)for(const e of I.colorRemapGradients)g.addColorRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.alphaRemapGradients)for(const e of I.alphaRemapGradients)g.addAlphaRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.sizeGradients)for(const e of I.sizeGradients)g.addSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.angularSpeedGradients)for(const e of I.angularSpeedGradients)g.addAngularSpeedGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.velocityGradients)for(const e of I.velocityGradients)g.addVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.dragGradients)for(const e of I.dragGradients)g.addDragGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.emitRateGradients)for(const e of I.emitRateGradients)g.addEmitRateGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.startSizeGradients)for(const e of I.startSizeGradients)g.addStartSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.lifeTimeGradients)for(const e of I.lifeTimeGradients)g.addLifeTimeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.limitVelocityGradients){for(const b of I.limitVelocityGradients)g.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);g.limitVelocityDamping=I.limitVelocityDamping}if(I.noiseTexture&&z){const b=(0,J.d)("BABYLON.ProceduralTexture");g.noiseTexture=b.Parse(I.noiseTexture,z,c)}let n;if(I.particleEmitterType){switch(I.particleEmitterType.type){case"SphereParticleEmitter":n=new V;break;case"SphereDirectedParticleEmitter":n=new a;break;case"ConeEmitter":case"ConeParticleEmitter":n=new p;break;case"ConeDirectedParticleEmitter":n=new x;break;case"CylinderParticleEmitter":n=new Z;break;case"CylinderDirectedParticleEmitter":n=new k;break;case"HemisphericParticleEmitter":n=new S;break;case"PointParticleEmitter":n=new f;break;case"MeshParticleEmitter":n=new R;break;case"CustomParticleEmitter":n=new v;break;default:n=new D}n.parse(I.particleEmitterType,z)}else n=new D,n.parse(I,z);g.particleEmitterType=n,g.startSpriteCellID=I.startSpriteCellID,g.endSpriteCellID=I.endSpriteCellID,g.spriteCellLoop=I.spriteCellLoop??!0,g.spriteCellWidth=I.spriteCellWidth,g.spriteCellHeight=I.spriteCellHeight,g.spriteCellChangeSpeed=I.spriteCellChangeSpeed,g.spriteRandomStartCell=I.spriteRandomStartCell,g.disposeOnStop=I.disposeOnStop??!1,g.manualEmitCount=I.manualEmitCount??-1}static Parse(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const J=I.name;let o,n,G=null,D=null;if(g instanceof yI.c?o=g:(n=g,o=n.getEngine()),I.customShader&&o.createEffectForParticles){D=I.customShader;const g=D.shaderOptions.defines.length>0?D.shaderOptions.defines.join("\n"):"";G=o.createEffectForParticles(D.shaderPath.fragmentElement,D.shaderOptions.uniforms,D.shaderOptions.samplers,g)}const p=new Jg(J,z||I.He,g,G,I.isAnimationSheetEnabled);if(p.customShader=D,p._rootUrl=b,I.id&&(p.id=I.id),I.subEmitters){p.subEmitters=[];for(const e of I.subEmitters){const I=[];for(const c of e)I.push(tI.Parse(c,g,b));p.subEmitters.push(I)}}if(I.attractors)for(const M of I.attractors){const I=new Mg;I.position=e.Vg.mb(M.position),I.strength=M.strength,p.addAttractor(I)}return Jg._Parse(I,p,g,b),I.textureMask&&(p.textureMask=M.Sb.mb(I.textureMask)),I.yG&&(p.yG=e.Vg.mb(I.yG)),I.preventAutoStart&&(p.preventAutoStart=I.preventAutoStart),c||p.preventAutoStart||p.start(),p}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};if(Jg._Serialize(g,this,I),g.textureMask=this.textureMask.bb(),g.customShader=this.customShader,g.preventAutoStart=this.preventAutoStart,g.yG=this.yG.bb(),this.subEmitters){g.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const e=[];for(const g of b)e.push(g.serialize(I));g.subEmitters.push(e)}}if(this._attractors&&this._attractors.length){g.attractors=[];for(const I of this._attractors)g.attractors.push(I.serialize())}return g}static _Serialize(I,g,b){if(I.name=g.name,I.id=g.id,I.He=g.getCapacity(),I.disposeOnStop=g.disposeOnStop,I.manualEmitCount=g.manualEmitCount,g.cg.position){const b=g.cg;I.emitterId=b.id}else{const b=g.cg;I.cg=b.bb()}g.particleEmitterType&&(I.particleEmitterType=g.particleEmitterType.serialize()),g.particleTexture&&(b?I.texture=g.particleTexture.serialize():(I.textureName=g.particleTexture.name,I.invertY=!!g.particleTexture._invertY)),I.isLocal=g.isLocal,H.b.AppendSerializedAnimations(g,I),I.beginAnimationOnStart=g.beginAnimationOnStart,I.beginAnimationFrom=g.beginAnimationFrom,I.beginAnimationTo=g.beginAnimationTo,I.beginAnimationLoop=g.beginAnimationLoop,I.startDelay=g.startDelay,I.renderingGroupId=g.renderingGroupId,I.isBillboardBased=g.isBillboardBased,I.billboardMode=g.billboardMode,I.minAngularSpeed=g.minAngularSpeed,I.maxAngularSpeed=g.maxAngularSpeed,I.minSize=g.minSize,I.maxSize=g.maxSize,I.minScaleX=g.minScaleX,I.maxScaleX=g.maxScaleX,I.minScaleY=g.minScaleY,I.maxScaleY=g.maxScaleY,I.minEmitPower=g.minEmitPower,I.maxEmitPower=g.maxEmitPower,I.minLifeTime=g.minLifeTime,I.maxLifeTime=g.maxLifeTime,I.emitRate=g.emitRate,I.gravity=g.gravity.bb(),I.noiseStrength=g.noiseStrength.bb(),I.color1=g.color1.bb(),I.color2=g.color2.bb(),I.colorDead=g.colorDead.bb(),I.updateSpeed=g.updateSpeed,I.targetStopDuration=g.targetStopDuration,I.blendMode=g.blendMode,I.preWarmCycles=g.preWarmCycles,I.preWarmStepOffset=g.preWarmStepOffset,I.minInitialRotation=g.minInitialRotation,I.maxInitialRotation=g.maxInitialRotation,I.startSpriteCellID=g.startSpriteCellID,I.spriteCellLoop=g.spriteCellLoop,I.endSpriteCellID=g.endSpriteCellID,I.spriteCellChangeSpeed=g.spriteCellChangeSpeed,I.spriteCellWidth=g.spriteCellWidth,I.spriteCellHeight=g.spriteCellHeight,I.spriteRandomStartCell=g.spriteRandomStartCell,I.isAnimationSheetEnabled=g.isAnimationSheetEnabled,I.useLogarithmicDepth=g.useLogarithmicDepth;const e=g.getColorGradients();if(e){I.colorGradients=[];for(const g of e){const b={gradient:g.gradient,color1:g.color1.bb()};g.color2?b.color2=g.color2.bb():b.color2=g.color1.bb(),I.colorGradients.push(b)}}const c=g.getRampGradients();if(c){I.rampGradients=[];for(const g of c){const b={gradient:g.gradient,color:g.color.bb()};I.rampGradients.push(b)}I.useRampGradients=g.useRampGradients}const z=g.getColorRemapGradients();if(z){I.colorRemapGradients=[];for(const g of z){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.colorRemapGradients.push(b)}}const M=g.getAlphaRemapGradients();if(M){I.alphaRemapGradients=[];for(const g of M){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.alphaRemapGradients.push(b)}}const J=g.getSizeGradients();if(J){I.sizeGradients=[];for(const g of J){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.sizeGradients.push(b)}}const o=g.getAngularSpeedGradients();if(o){I.angularSpeedGradients=[];for(const g of o){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.angularSpeedGradients.push(b)}}const n=g.getVelocityGradients();if(n){I.velocityGradients=[];for(const g of n){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.velocityGradients.push(b)}}const G=g.getDragGradients();if(G){I.dragGradients=[];for(const g of G){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.dragGradients.push(b)}}const D=g.getEmitRateGradients();if(D){I.emitRateGradients=[];for(const g of D){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.emitRateGradients.push(b)}}const p=g.getStartSizeGradients();if(p){I.startSizeGradients=[];for(const g of p){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.startSizeGradients.push(b)}}const x=g.getLifeTimeGradients();if(x){I.lifeTimeGradients=[];for(const g of x){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.lifeTimeGradients.push(b)}}const Z=g.getLimitVelocityGradients();if(Z){I.limitVelocityGradients=[];for(const g of Z){const b={gradient:g.gradient,factor1:g.factor1};void 0!==g.factor2?b.factor2=g.factor2:b.factor2=g.factor1,I.limitVelocityGradients.push(b)}I.limitVelocityDamping=g.limitVelocityDamping}g.noiseTexture&&(I.noiseTexture=g.noiseTexture.serialize())}clone(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let c=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){c=this.customShader;const I=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"",g=z.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,I);e[0]?e[0].effect=g:this.setCustomEffect(g,0)}const M=this.serialize(b),J=Jg.Parse(M,this._scene||this._engine,this._rootUrl);return J.name=I,J.customShader=c,J._customWrappers=e,void 0===g&&(g=this.cg),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.cg=g,this.preventAutoStart||J.start(),J}}Jg.BILLBOARDMODE_Y=2,Jg.BILLBOARDMODE_ALL=7,Jg.BILLBOARDMODE_STRETCHED=8,Jg.BILLBOARDMODE_STRETCHED_LOCAL=9,tI._ParseParticleSystem=Jg.Parse;var og=b(12823),ng=b(12814),Gg=b(12718);Gg.c.prototype.createTransformFeedback=function(){const I=this._gl.createTransformFeedback();if(!I)throw new Error("Unable to create Transform Feedback");return I},Gg.c.prototype.deleteTransformFeedback=function(I){this._gl.deleteTransformFeedback(I)},Gg.c.prototype.bindTransformFeedback=function(I){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,I)},Gg.c.prototype.beginTransformFeedback=function(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(I?this._gl.POINTS:this._gl.TRIANGLES)},Gg.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Gg.c.prototype.setTranformFeedbackVaryings=function(I,g){this._gl.transformFeedbackVaryings(I,g,this._gl.INTERLEAVED_ATTRIBS)},Gg.c.prototype.bindTransformFeedbackBuffer=function(I){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I?I.underlyingResource:null)},Gg.c.prototype.readTransformFeedbackBuffer=function(I){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I)};const Dg="clipPlaneFragmentDeclaration2",pg="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";mI.c.IncludesShadersStore[Dg]||(mI.c.IncludesShadersStore[Dg]=pg);b(13883),b(13888),b(13896),b(13902),b(13904),b(13909),b(13913),b(13918);const xg="gpuRenderParticlesPixelShader",Zg="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";mI.c.ShadersStore[xg]||(mI.c.ShadersStore[xg]=Zg);const kg="clipPlaneVertexDeclaration2",Sg="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";mI.c.IncludesShadersStore[kg]||(mI.c.IncludesShadersStore[kg]=Sg);b(13927),b(13931),b(13936),b(13943);const fg="gpuRenderParticlesVertexShader",Vg="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";mI.c.ShadersStore[fg]||(mI.c.ShadersStore[fg]=Vg);class ag extends o{static get IsSupported(){if(!T.b.LastCreatedEngine)return!1;const I=T.b.LastCreatedEngine.getCaps();return I.supportTransformFeedbacks||I.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(I){this._maxActiveParticleCount=Math.min(I,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(I){this.maxActiveParticleCount=I}createPointEmitter(I,g){const b=qI(I,g);return this.particleEmitterType=b,b}createHemisphericEmitter(){const I=lI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=wI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=TI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.Vg(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=WI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=Ig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=gg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=bg(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.Vg(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.Vg(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,g,b,e){const c=new D;return this.particleEmitterType=c,this.direction1=I,this.direction2=g,this.minEmitBox=b,this.maxEmitBox=e,c}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I)}isReady(){if(!this.cg||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Jg.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Jg.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Jg.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";I?setTimeout((()=>{this.start(0)}),I):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var I;let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[g])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[g]=new II.e(this._engine),this._customWrappers[g].effect=I}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new l.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(I,g,b){return super._removeGradientAndTexture(I,g,b),this._releaseBuffers(),this}addColorGradient(I,g){this._colorGradients||(this._colorGradients=[]);const b=new u(I,g);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(I&&this._colorGradients.sort(((I,g)=>I.gradient<g.gradient?-1:I.gradient>g.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(I){return this._removeGradientAndTexture(I,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const g in this._drawWrappers){var I;null===(I=this._drawWrappers[g].drawContext)||void 0===I||I.reset()}}_addFactorGradient(I,g,b){const e=new y(g,b);I.push(e),this._releaseBuffers()}addSizeGradient(I,g){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,I,g),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(I){return this._removeGradientAndTexture(I,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(I,g){if(!I)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&I.sort(((I,g)=>I.gradient<g.gradient?-1:I.gradient>g.gradient?1:0));const b=this;b[g]&&(b[g].dispose(),b[g]=null)}addAngularSpeedGradient(I,g){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,I,g),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(I){return this._removeGradientAndTexture(I,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(I,g){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,I,g),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(I){return this._removeGradientAndTexture(I,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(I,g){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,I,g),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(I){return this._removeGradientAndTexture(I,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(I,g){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,I,g),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(I){return this._removeGradientAndTexture(I,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(I){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(I),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Og=new l.c,this.onStoppedObservable=new l.c,this.onStartedObservable=new l.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||T.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ax.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,J.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,J.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new II.e(this._engine)},this._customWrappers[0].effect=c,this._drawWrappers={0:new II.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(g=g??{}).randomTextureSize||delete g.randomTextureSize;const M={He:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...g},o=g;isFinite(o)&&(M.He=o),this._capacity=M.He,this._maxActiveParticleCount=M.He,this._currentActiveCount=0,this._isAnimationSheetEnabled=z,this.particleEmitterType=new D;const n=Math.min(this._engine.getCaps().maxTextureSize,M.randomTextureSize);let G=[];for(let e=0;e<n;++e)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture=new w.b(new Float32Array(G),n,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,G=[];for(let e=0;e<n;++e)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture2=new w.b(new Float32Array(G),n,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=n}_reset(){this._releaseBuffers()}_createVertexBuffers(I,g,b){const e={};e.position=g.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let c=3;e.age=g.createVertexBuffer("age",c,1,this._attributesStrideSize,!0),c+=1,e.size=g.createVertexBuffer("size",c,3,this._attributesStrideSize,!0),c+=3,e.life=g.createVertexBuffer("life",c,1,this._attributesStrideSize,!0),c+=1,c+=4,this.billboardMode===Jg.BILLBOARDMODE_STRETCHED&&(e.direction=g.createVertexBuffer("direction",c,3,this._attributesStrideSize,!0)),c+=3,this._platform.alignDataInBuffer&&(c+=1),this.particleEmitterType instanceof v&&(c+=3,this._platform.alignDataInBuffer&&(c+=1)),this._colorGradientsTexture||(e.color=g.createVertexBuffer("color",c,4,this._attributesStrideSize,!0),c+=4),this._isBillboardBased||(e.initialDirection=g.createVertexBuffer("initialDirection",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),this.noiseTexture&&(e.noiseCoordinates1=g.createVertexBuffer("noiseCoordinates1",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1),e.noiseCoordinates2=g.createVertexBuffer("noiseCoordinates2",c,3,this._attributesStrideSize,!0),c+=3,this._platform.alignDataInBuffer&&(c+=1)),e.angle=g.createVertexBuffer("angle",c,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?c++:c+=2,this._isAnimationSheetEnabled&&(e.cellIndex=g.createVertexBuffer("cellIndex",c,1,this._attributesStrideSize,!0),c+=1,this.spriteRandomStartCell&&(e.cellStartOffset=g.createVertexBuffer("cellStartOffset",c,1,this._attributesStrideSize,!0),c+=1)),e.offset=b.createVertexBuffer("offset",0,2),e.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(e),this._platform.createVertexBuffers(I,e),this.resetDrawCache()}_initialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!I)return;const g=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof v&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const c=this.particleEmitterType instanceof v,z=e.TmpVectors.Vg[0];let M=0;for(let e=0;e<this._capacity;e++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),c?(this.particleEmitterType.particleDestinationGenerator(e,null,z),b.push(z.x),b.push(z.y),b.push(z.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),M+=16,c&&(this.particleEmitterType.particlePositionGenerator(e,null,z),b.push(z.x),b.push(z.y),b.push(z.z),this._platform.alignDataInBuffer&&b.push(0),M+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),M+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),M+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),M+=8),b.push(0),M+=1,this._angularSpeedGradientsTexture||(b.push(0),M+=1),this._isAnimationSheetEnabled&&(b.push(0),M+=1,this.spriteRandomStartCell&&(b.push(0),M+=1)),this._platform.alignDataInBuffer){let I=3-(M+3&3);for(M+=I;I-- >0;)b.push(0)}const J=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),o=this._platform.createParticleBuffer(b),n=this._platform.createParticleBuffer(b);this._buffer0=new X.d(g,o,!1,this._attributesStrideSize),this._buffer1=new X.d(g,n,!1,this._attributesStrideSize),this._spriteBuffer=new X.d(g,J,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let I=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(I+="\n#define BILLBOARD"),this._colorGradientsTexture&&(I+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(I+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(I+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(I+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(I+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(I+="\n#define DRAGGRADIENTS"),this._flowMap&&(I+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(I+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(I+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(I+="\n#define NOISE"),this.isLocal&&(I+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===I||(this._cachedUpdateDefines=I,this._updateBuffer=this._platform.createUpdateBuffer(I)),this._platform.isUpdateBufferReady()}_getWrapper(I){const g=this._getCustomDrawWrapper(I);if(null!==g&&void 0!==g&&g.effect)return g;const b=[];this.fillDefines(b,I);let e=this._drawWrappers[I];e||(e=new II.e(this._engine),e.drawContext&&(e.drawContext.useInstancing=!0),this._drawWrappers[I]=e);const c=b.join("\n");if(e.defines!==c){const I=[],g=[],b=[];this.fillUniformsAttributesAndSamplerNames(g,I,b),e.setEffect(this._engine.createEffect("gpuRenderParticles",I,g,b,c),c)}return e}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const c=[X.f.PositionKind,"age","life","size","angle"];return I||c.push(X.f.ColorKind),g&&c.push("cellIndex"),b||c.push("initialDirection"),e&&c.push("direction"),c.push("offset",X.f.UVKind),c}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["emitterWM","yG","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,gI.b)(e),I&&e.push("sheetInfos"),g&&e.push("logarithmicDepthConstant"),b&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,gI.j)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==ng.c.FOGMODE_NONE&&I.push("#define FOG")),g===Jg.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this.isLocal&&I.push("#define LOCAL"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case Jg.BILLBOARDMODE_Y:I.push("#define BILLBOARDY");break;case Jg.BILLBOARDMODE_STRETCHED:I.push("#define BILLBOARDSTRETCHED");break;case Jg.BILLBOARDMODE_ALL:I.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&I.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,g,b){g.push(...ag._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Jg.BILLBOARDMODE_STRETCHED)),I.push(...ag._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(og.e.PrepareUniforms(I,this._imageProcessingConfigurationDefines),og.e.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var I;let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(g?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(I,g){const b=this[g];if(!I||!I.length||b)return;const e=new Float32Array(this._rawTextureWidth);for(let c=0;c<this._rawTextureWidth;c++){const g=c/this._rawTextureWidth;q.GetCurrentGradient(g,I,((I,g,b)=>{e[c]=(0,n.Lerp)(I.factor1,g.factor1,b)}))}this[g]=w.b.CreateRTexture(e,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[g].name=g.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const I=new Uint8Array(4*this._rawTextureWidth),g=M.TmpColors.Sb[0];for(let b=0;b<this._rawTextureWidth;b++){const e=b/this._rawTextureWidth;q.GetCurrentGradient(e,this._colorGradients,((e,c,z)=>{M.Sb.LerpToRef(e.color1,c.color1,z,g),I[4*b]=255*g.r,I[4*b+1]=255*g.g,I[4*b+2]=255*g.b,I[4*b+3]=255*g.a}))}this._colorGradientsTexture=w.b.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(I,g){var b,c,z,M;const J=this._getWrapper(I),o=J.effect;this._engine.enableEffect(J);const n=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||e.Matrix.IdentityReadOnly;if(o.setMatrix("view",n),o.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),o.setTexture("diffuseSampler",this.particleTexture),o.setVector2("translationPivot",this.translationPivot),o.setVector3("yG",this.yG),this.isLocal&&o.setMatrix("emitterWM",g),this._colorGradientsTexture?o.setTexture("colorGradientSampler",this._colorGradientsTexture):o.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();o.setFloat3("sheetInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,I.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;o.setVector3("eyePosition",I.globalPosition)}const G=o.defines;if(this._scene&&((0,gI.f)(o,this,this._scene),this.applyFog&&(0,bI.d)(this._scene,void 0,o)),G.indexOf("#define BILLBOARDMODE_ALL")>=0){const I=n.clone();I.invert(),o.setMatrix("invView",I)}return this.useLogarithmicDepth&&this._scene&&(0,bI.j)(G,o,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(o),this._setEngineBasedOnBlendMode(I),this._platform.bindDrawBuffers(this._targetIndex,o,null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(o),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(I){if(!this.cg||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!I)if(this.cg.position){I=this.cg.getWorldMatrix()}else{const g=this.cg;I=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(g.x,g.y,g.z,I)}const g=this._engine,b=g.getDepthWrite();if(g.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const I=this.EI();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",I.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",I),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const c=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,g.setDepthWrite(b)}render(){let I,g=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!g&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const I=0|this._accumulatedCount;this._accumulatedCount-=I,this._currentActiveCount+=I}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.cg.position){I=this.cg.getWorldMatrix()}else{const g=this.cg;I=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(g.x,g.y,g.z,I)}const c=this._engine;this.updateInAnimate||this._update(I);let z=0;return g||b||(c.setState(!1),this.forceDepthWrite&&c.setDepthWrite(!0),z=this.blendMode===Jg.BLENDMODE_MULTIPLYADD?this._render(Jg.BLENDMODE_MULTIPLY,I)+this._render(Jg.BLENDMODE_ADD,I):this._render(this.blendMode,I),this._engine.setAlphaMode(0)),z}rebuild(){const I=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(I,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,I()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const g in this._drawWrappers){this._drawWrappers[g].dispose()}if(this._drawWrappers={},this._scene){const I=this._scene.Ax.indexOf(this);I>-1&&this._scene.Ax.splice(I,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let g=0;g<this._renderVertexBuffers.length;++g){const I=this._renderVertexBuffers[g];for(const g in I)I[g].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Og.notifyObservers(this),this.Og.clear()}clone(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let c=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){c=this.customShader;const I=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";e[0]=z.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,I,void 0,void 0,void 0,this)}const M=this.serialize(b),J=ag.Parse(M,this._scene||this._engine,this._rootUrl);return J.name=I,J.customShader=c,J._customWrappers=e,void 0===g&&(g=this.cg),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.cg=g,J}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={};return Jg._Serialize(g,this,I),g.activeParticleCount=this.activeParticleCount,g.randomTextureSize=this._randomTextureSize,g.customShader=this.customShader,g}static Parse(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4?arguments[4]:void 0;const z=I.name;let M,J;g instanceof yI.c?M=g:(J=g,M=J.getEngine());const o=new ag(z,{He:c||I.He,randomTextureSize:I.randomTextureSize},g,null,I.isAnimationSheetEnabled);if(o._rootUrl=b,I.customShader&&M.createEffectForParticles){const g=I.customShader,b=g.shaderOptions.defines.length>0?g.shaderOptions.defines.join("\n"):"",e=M.createEffectForParticles(g.shaderPath.fragmentElement,g.shaderOptions.uniforms,g.shaderOptions.samplers,b,void 0,void 0,void 0,o);o.setCustomEffect(e,0),o.customShader=g}return I.id&&(o.id=I.id),I.activeParticleCount&&(o.activeParticleCount=I.activeParticleCount),Jg._Parse(I,o,g,b),I.preventAutoStart&&(o.preventAutoStart=I.preventAutoStart),e||o.preventAutoStart||o.start(),o}}var vg=b(12409),Xg=b(13947),Rg=b(12954);class Eg{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(I){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const g of this.systems)g.cg=I;this._emitterNode=I}setEmitterAsSphere(I,g,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:I,renderingGroupId:g};const e=(0,Xg.c)("emitterSphere",{diameter:I.diameter,segments:I.segments},b);e.renderingGroupId=g;const c=new Rg.Rg("emitterSphereMaterial",b);c.emissiveColor=I.color,e.material=c;for(const z of this.systems)z.cg=e;this._emitterNode=e}start(I){for(const g of this.systems)I&&(g.cg=I),g.start()}dispose(){for(const I of this.systems)I.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const g={systems:[]};for(const b of this.systems)g.systems.push(b.serialize(I));return this._emitterNode&&(g.cg=this._emitterCreationOptions),g}static Parse(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;const c=new Eg,z=this.BaseAssetsUrl+"/textures/";g=g||T.b.LastCreatedScene;for(const M of I.systems)c.systems.push(b?ag.Parse(M,g,z,!0,e):Jg.Parse(M,g,z,!0,e));if(I.cg){const b=I.cg.options;if("Sphere"===I.cg.kind)c.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:M.Eg.mb(b.color)},I.cg.renderingGroupId,g)}return c}}Eg.BaseAssetsUrl="https://assets.babylonjs.com/particles";var mb=b(12443);class sg{static CreateDefault(I){let g,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,e=arguments.length>2?arguments[2]:void 0;g=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ag("default system",{He:b},e):new Jg("default system",b,e),g.cg=I;const c=vg.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return g.particleTexture=new i.b(c,g.EI()),g.createConeEmitter(.1,Math.PI/4),g.color1=new M.Sb(1,1,1,1),g.color2=new M.Sb(1,1,1,1),g.colorDead=new M.Sb(1,1,1,0),g.minSize=.1,g.maxSize=.1,g.minEmitPower=2,g.maxEmitPower=2,g.updateSpeed=1/60,g.emitRate=30,g}static CreateAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;g||(g=T.b.LastCreatedScene);const c={};return g.addPendingData(c),new Promise(((z,M)=>{if(b&&!ag.IsSupported)return g.removePendingData(c),M("Particle system with GPU is not supported.");vg.Tools.LoadFile(`${sg.BaseAssetsUrl}/systems/${I}.json`,(I=>{g.removePendingData(c);const M=JSON.parse(I.toString());return z(Eg.Parse(M,g,b,e))}),void 0,void 0,void 0,(()=>(g.removePendingData(c),M(`An error occurred with the creation of your particle system. Check if your type '${I}' exists.`))))}))}static ExportSet(I){const g=new Eg;for(const b of I)g.systems.push(b);return g}static ParseFromFileAsync(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;return new Promise(((M,J)=>{const o=new mb.d;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const g=JSON.parse(o.responseText);let J;J=e?ag.Parse(g,b,c,!1,z):Jg.Parse(g,b,c,!1,z),I&&(J.name=I),M(J)}else J("Unable to load the particle system")})),o.open("GET",g),o.send()}))}static ParseFromSnippetAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",c=arguments.length>4?arguments[4]:void 0;if("_BLANK"===I){const I=this.CreateDefault(null);return I.start(),Promise.resolve(I)}return new Promise(((z,M)=>{const J=new mb.d;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const M=JSON.parse(JSON.parse(J.responseText).jsonPayload),o=JSON.parse(M.particleSystem);let n;n=b?ag.Parse(o,g,e,!1,c):Jg.Parse(o,g,e,!1,c),n.snippetId=I,z(n)}else M("Unable to load the snippet "+I)})),J.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),J.send()}))}}sg.BaseAssetsUrl=Eg.BaseAssetsUrl,sg.SnippetUrl="https://snippet.babylonjs.com",sg.CreateFromSnippetAsync=sg.ParseFromSnippetAsync;var Fg=b(13027),Yg=b(12849),dg=b(13953);(0,dg.g)(Yg.b.NAME_PARTICLESYSTEM,((I,g,b,e)=>{const c=(0,dg.j)(Yg.b.NAME_PARTICLESYSTEM);if(c&&void 0!==I.Ax&&null!==I.Ax)for(let z=0,M=I.Ax.length;z<M;z++){const M=I.Ax[z];b.Ax.push(c(M,g,e))}})),(0,dg.e)(Yg.b.NAME_PARTICLESYSTEM,((I,g,b)=>{if(I.activeParticleCount){return ag.Parse(I,g,b)}return Jg.Parse(I,g,b)})),yI.c.prototype.createEffectForParticles=function(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9?arguments[9]:void 0,D=[],p=[];const x=[];return o?o.fillUniformsAttributesAndSamplerNames(p,D,x):(D=Jg._GetAttributeNamesOrOptions(),p=Jg._GetEffectCreationOptions()),-1===c.indexOf(" BILLBOARD")&&(c+="\n#define BILLBOARD\n"),null!==o&&void 0!==o&&o.isAnimationSheetEnabled&&-1===c.indexOf(" ANIMATESHEET")&&(c+="\n#define ANIMATESHEET\n"),-1===e.indexOf("diffuseSampler")&&e.push("diffuseSampler"),this.createEffect({vertex:G??(null===o||void 0===o?void 0:o.vertexShaderName)??"particles",fragmentElement:I},D,p.concat(g),x.concat(e),c,z,M,J,void 0,n,(async()=>{0===n?await Promise.resolve().then(b.bind(b,13990)):await Promise.resolve().then(b.bind(b,14048))}))},Fg.e.prototype.getEmittedParticleSystems=function(){const I=[];for(let g=0;g<this.EI().Ax.length;g++){const b=this.EI().Ax[g];b.cg===this&&I.push(b)}return I},Fg.e.prototype.getHierarchyEmittedParticleSystems=function(){const I=[],g=this.getDescendants();g.push(this);for(let b=0;b<this.EI().Ax.length;b++){const e=this.EI().Ax[b],c=e.cg;c.position&&-1!==g.indexOf(c)&&I.push(e)}return I};b(12916),b(12932),b(13006);b(13013),b(13957),b(12782),b(12905),b(13045);b(12773);var Cg;b(13965),b(12614);!function(I){I[I.Color=2]="Color",I[I.UV=1]="UV",I[I.Random=0]="Random",I[I.Stated=3]="Stated"}(Cg||(Cg={}));var rg=b(12803);const Og=new e.Vg(0,0,0),Hg=new e.Vg(0,0,0),ig=new e.Vg(0,0,0);class Ug{constructor(I,g,b){this.width=I,this.height=g,this.data=b}processFlowable(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof e.Matrix?e.Vg.TransformCoordinatesToRef(I.position,b,ig):(ig.x=b.x,ig.y=b.y,ig.z=b.z);const c=.5*ig.x+.5,z=1-(.5*ig.y+.5),M=Math.floor(c*this.width),J=Math.floor(z*this.height);if(M<0||M>=this.width||J<0||J>=this.height)return;const o=4*(J*this.width+M),n=this.data[o]/255*2-1,G=this.data[o+1]/255*2-1,D=this.data[o+2]/255*2-1,p=this.data[o+3]/255;Og.set(n,G,D),Og.scaleToRef(g*p,Hg),I.direction.addInPlace(Hg)}_processParticle(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(I,g,b)}static async FromUrlAsync(I){return await new Promise(((g,b)=>{const e=document.createElement("canvas"),c=e.getContext("2d");let z=null;const M=new Image;M.crossOrigin="anonymous",M.src=I,M.onerror=g=>{b(new Error(`Failed to load image: ${I} : ${g}`))},M.onload=()=>{e.width=M.width,e.height=M.height,c.drawImage(M,0,0),z=c.getImageData(0,0,e.width,e.height),g(new Ug(e.width,e.height,z.data))}}))}static async ExtractFromTextureAsync(I){return await new Promise(((g,b)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(I);g(b)}catch(e){b(e)}}));const e=I.getSize();rg.l.GetTextureDataAsync(I,e.width,e.height).then((I=>{g(new Ug(e.width,e.height,new Uint8ClampedArray(I)))})).catch(b)}))}}var hg,Ag,jg,Qg,Lg,Ng,Kg,Bg,Pg;!function(I){I[I.Int=1]="Int",I[I.Float=2]="Float",I[I.Vector2=4]="Vector2",I[I.Vg=8]="Vg",I[I.Matrix=16]="Matrix",I[I.Particle=32]="Particle",I[I.Texture=64]="Texture",I[I.Sb=128]="Sb",I[I.FloatGradient=256]="FloatGradient",I[I.Vector2Gradient=512]="Vector2Gradient",I[I.Vector3Gradient=1024]="Vector3Gradient",I[I.Color4Gradient=2048]="Color4Gradient",I[I.System=4096]="System",I[I.AutoDetect=8192]="AutoDetect",I[I.BasedOnInput=16384]="BasedOnInput",I[I.Undefined=32768]="Undefined",I[I.All=65535]="All"}(hg||(hg={})),function(I){I[I.Compatible=0]="Compatible",I[I.TypeIncompatible=1]="TypeIncompatible",I[I.HierarchyIssue=2]="HierarchyIssue"}(Ag||(Ag={})),function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(jg||(jg={}));class ug{get direction(){return this._direction}get type(){if(this._type===hg.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===hg.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(I){this._type=I}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((I=>I.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(I,g,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=hg.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new l.c,this.onDisconnectionObservable=new l.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=g,this.name=I,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(I){var g;return this.isConnected?null!==(g=this._connectedPoint)&&void 0!==g&&g._storedFunction?this._connectedPoint._storedFunction(I):this._connectedPoint._storedValue:this.value}canConnectTo(I){return 0===this.checkCompatibilityState(I)}checkCompatibilityState(I){const g=this._ownerBlock,b=I.ownerBlock;if(this.type!==I.type&&I.innerType!==hg.AutoDetect)return I.acceptedConnectionPointTypes&&-1!==I.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(I.excludedConnectionPointTypes&&-1!==I.excludedConnectionPointTypes.indexOf(this.type))return 1;let e=b,c=g;return 0===this.direction&&(e=g,c=b),e.isAnAncestorOf(c)?2:0}connectTo(I){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(I))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${I.ownerBlock.name}".${I.name}`;return this._endpoints.push(I),I._connectedPoint=this,this.onConnectionObservable.notifyObservers(I),I.onConnectionObservable.notifyObservers(this),this}disconnectFrom(I){const g=this._endpoints.indexOf(I);return-1===g||(this._endpoints.splice(g,1),I._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(I),I.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(I){let g=1;for(;g<hg.All;)I&g||this.excludedConnectionPointTypes.push(g),g<<=1}serialize(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const g={};return g.name=this.name,g.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.bb?(g.valueType="BABYLON."+this.value.getClassName(),g.value=this.value.bb()):(g.valueType="number",g.value=this.value)),I&&this.connectedPoint&&(g.inputName=this.name,g.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,g.targetConnectionName=this.connectedPoint.name,g.isExposedOnFrame=!0,g.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(g.isExposedOnFrame=!0,g.exposedPortPosition=this.exposedPortPosition),g}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class tg{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(I){this._name=I}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(I){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new l.c,this.Og=new l.c,this.onInputChangedObservable=new l.c,this.visibleOnFrame=!1,this._name=I,this.uniqueId=U.b.UniqueId}_inputRename(I){return I}_outputRename(I){return I}isAnAncestorOf(I){for(const g of this._outputs)if(g.hasEndpoints)for(const b of g.endpoints){if(b.ownerBlock===I)return!0;if(b.ownerBlock.isAnAncestorOf(I))return!0}return!1}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const g of this._outputs)if(g.hasEndpoints)for(const b of g.endpoints)if(b.ownerBlock.isAnAncestorOfType(I))return!0;return!1}getInputByName(I){const g=this._inputs.filter((g=>g.name===I));return g.length?g[0]:null}_linkConnectionTypes(I,g){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[g]._acceptedConnectionPointType=this._inputs[I]:(this._inputs[I]._linkedConnectionSource=this._inputs[g],this._inputs[I]._isMainLinkSource=!0),this._inputs[g]._linkedConnectionSource=this._inputs[I]}registerInput(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const M=new ug(I,this,0);return M.type=g,M.isOptional=b,M.defaultValue=e,M.value=e,M.valueMin=c,M.valueMax=z,this._inputs.push(M),this.onInputChangedObservable.notifyObservers(M),this}registerOutput(I,g,b){return(b=b??new ug(I,this,1)).type=g,this._outputs.push(b),this}_build(I){}_customBuildStep(I){}build(I){if(this._buildId===I.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((I=>I.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=I.buildId;for(const g of this._inputs){if(!g.connectedPoint){g.isOptional||I.notConnectedNonOptionalInputs.push(g);continue}const b=g.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(I)}return this._customBuildStep(I),I.verbose&&h.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(I),this.onBuildObservable.notifyObservers(this),!1}serialize(){const I={};I.customType="BABYLON."+this.getClassName(),I.id=this.uniqueId,I.name=this.name,I.visibleOnFrame=this.visibleOnFrame,I.inputs=[],I.outputs=[];for(const g of this.inputs)I.inputs.push(g.serialize());for(const g of this.outputs)I.outputs.push(g.serialize(!1));return I}_deserialize(I){this._name=I.name,this.comments=I.comments,this.visibleOnFrame=!!I.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(I)}_deserializePortDisplayNamesAndExposedOnFrame(I){const g=I.inputs,b=I.outputs;if(g)for(const e of g){const I=this.inputs.find((I=>I.name===e.name));if(!I)return;if(e.displayName&&(I.displayName=e.displayName),e.isExposedOnFrame&&(I.isExposedOnFrame=e.isExposedOnFrame,I.exposedPortPosition=e.exposedPortPosition),void 0!==e.value&&null!==e.value)if("number"===e.valueType)I.value=e.value;else{const g=(0,J.d)(e.valueType);g&&(I.value=g.mb(e.value))}}if(b)for(let e=0;e<b.length;e++){const I=b[e];I.displayName&&(this.outputs[e].displayName=I.displayName),I.isExposedOnFrame&&(this.outputs[e].isExposedOnFrame=I.isExposedOnFrame,this.outputs[e].exposedPortPosition=I.exposedPortPosition)}}clone(){const I=this.serialize(),g=(0,J.d)(I.customType);if(g){const b=new g;return b._deserialize(I),b}return null}dispose(){this.Og.notifyObservers(this),this.Og.clear();for(const I of this.inputs)I.dispose();for(const I of this.outputs)I.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function yg(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",e=arguments.length>3?arguments[3]:void 0;return(c,z)=>{let M=c._propStore;M||(M=[],c._propStore=M),M.push({propertyName:z,displayName:I,type:g,groupName:b,options:e??{},className:c.getClassName()})}}(0,r.d)([(0,O.E)("comment")],tg.prototype,"comments",void 0),function(I){I[I.Boolean=0]="Boolean",I[I.Float=1]="Float",I[I.Int=2]="Int",I[I.Vector2=3]="Vector2",I[I.List=4]="List",I[I.Sb=5]="Sb",I[I.SamplingMode=6]="SamplingMode",I[I.TextureFormat=7]="TextureFormat",I[I.TextureType=8]="TextureType"}(Qg||(Qg={})),function(I){I[I.None=0]="None",I[I.Position=1]="Position",I[I.Direction=2]="Direction",I[I.Age=3]="Age",I[I.Lifetime=4]="Lifetime",I[I.Color=5]="Color",I[I.ScaledDirection=6]="ScaledDirection",I[I.Scale=7]="Scale",I[I.AgeGradient=8]="AgeGradient",I[I.Angle=9]="Angle",I[I.SpriteCellIndex=16]="SpriteCellIndex",I[I.SpriteCellStart=17]="SpriteCellStart",I[I.SpriteCellEnd=18]="SpriteCellEnd"}(Lg||(Lg={})),function(I){I[I.None=0]="None",I[I.Time=1]="Time",I[I.Delta=2]="Delta",I[I.Emitter=3]="Emitter"}(Ng||(Ng={}));class qg{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let I="";for(const g of this.notConnectedNonOptionalInputs)I+=`input ${g.name} from block ${g.ownerBlock.name}[${g.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(I)throw"Build of Node Particle System Set failed:\n"+I}adapt(I,g){const b=I.getConnectedValue(this)||0;if(I.type===g)return b;switch(g){case hg.Vector2:return new e.Vector2(b,b);case hg.Vg:return new e.Vg(b,b,b);case hg.Sb:return new M.Sb(b,b,b,b)}return null}getContextualValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case Lg.Position:return this.particleContext.position;case Lg.Direction:return this.particleContext.direction;case Lg.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Lg.Color:return this.particleContext.color;case Lg.Age:return this.particleContext.age;case Lg.Lifetime:return this.particleContext.lifeTime;case Lg.Angle:return this.particleContext.angle;case Lg.Scale:return this.particleContext.scale;case Lg.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Lg.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Lg.SpriteCellIndex:return this.particleContext.cellIndex;case Lg.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.cg.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.cg.absolutePosition:this.systemContext.cg:null}getSystemValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case Ng.Time:return this.systemContext._actualFrame;case Ng.Delta:return this.systemContext._scaledUpdateSpeed;case Ng.Emitter:if(this.isEmitterTransformNode){return this.systemContext.cg.absolutePosition}return this.systemContext.cg}return null}}function lg(I,g,b){const e=new qg;e.Xg=g;const c=I.createSystem(e);return c.canStart=()=>!0,c.cg=b.clone(),c.disposeOnStop=!0,c.start(),c}class wg extends tg{constructor(I){super(I),this.blendMode=o.BLENDMODE_ONEONE,this.He=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",hg.Particle),this.registerInput("texture",hg.Texture),this.registerInput("onStart",hg.System,!0),this.registerInput("onEnd",hg.System,!0),this.registerOutput("system",hg.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(I){I.He=this.He,I.buildId=this._buildId++,this.build(I);const g=this.particle.getConnectedValue(I);return g.particleTexture=this.texture.getConnectedValue(I),g.emitRate=this.emitRate,g.blendMode=this.blendMode,g.name=this.name,g._nodeGenerated=!0,g._targetStopDuration=this.targetStopDuration,g.startDelay=this.startDelay,this.system._storedValue=this,g.canStart=()=>!this.doNoStart,g.onStartedObservable.add((b=>{const e=this.onStart.getConnectedValue(I);e&&b.onStartedObservable.addOnce((()=>{I.systemContext=g;const b=lg(e,I.Xg,I.emitterPosition);this.Og.addOnce((()=>{b.dispose()}))}));const c=this.onEnd.getConnectedValue(I);c&&b.onStoppedObservable.addOnce((()=>{I.systemContext=g;const b=lg(c,I.Xg,I.emitterPosition);this.Og.addOnce((()=>{b.dispose()}))}))})),this.Og.addOnce((()=>{g.dispose()})),g}serialize(){const I=super.serialize();return I.He=this.He,I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.doNoStart=this.doNoStart,I.targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,I}_deserialize(I){super._deserialize(I),this.He=I.He,this.emitRate=I.emitRate,this.doNoStart=!!I.doNoStart,void 0!==I.blendMode&&(this.blendMode=I.blendMode),void 0!==I.targetStopDuration&&(this.targetStopDuration=I.targetStopDuration),void 0!==I.startDelay&&(this.startDelay=I.startDelay)}}(0,r.d)([yg("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:o.BLENDMODE_ONEONE},{label:"Standard",value:o.BLENDMODE_STANDARD},{label:"Add",value:o.BLENDMODE_ADD},{label:"Multiply",value:o.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:o.BLENDMODE_MULTIPLYADD}]})],wg.prototype,"blendMode",void 0),(0,r.d)([yg("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],wg.prototype,"He",void 0),(0,r.d)([yg("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wg.prototype,"emitRate",void 0),(0,r.d)([yg("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wg.prototype,"targetStopDuration",void 0),(0,r.d)([yg("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wg.prototype,"startDelay",void 0),(0,r.d)([yg("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wg.prototype,"doNoStart",void 0),(0,J.g)("BABYLON.SystemBlock",wg);class Tg extends tg{get type(){if(this._type===hg.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=hg.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=hg.Vector2,this._type;case"Vg":return this._type=hg.Vg,this._type;case"Sb":return this._type=hg.Sb,this._type;case"Matrix":return this._type=hg.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Lg.None&&this._systemSource!==Ng.None}get systemSource(){return this._systemSource}set systemSource(I){if(this._systemSource=I,I!==Ng.None){switch(this._contextualSource=Lg.None,this._type=hg.Float,I){case Ng.Time:case Ng.Delta:this._type=hg.Float;break;case Ng.Emitter:this._type=hg.Vg}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Lg.None}get contextualValue(){return this._contextualSource}set contextualValue(I){if(this._contextualSource=I,I!==Lg.None){switch(this._systemSource=Ng.None,I){case Lg.Scale:this._type=hg.Vector2;break;case Lg.Position:case Lg.Direction:case Lg.ScaledDirection:this._type=hg.Vg;break;case Lg.Color:this._type=hg.Sb;break;case Lg.Age:case Lg.Lifetime:case Lg.Angle:case Lg.AgeGradient:this._type=hg.Float;break;case Lg.SpriteCellEnd:case Lg.SpriteCellStart:case Lg.SpriteCellIndex:this._type=hg.Int}this.output&&(this.output.type=this._type)}}constructor(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hg.AutoDetect;super(I),this._type=hg.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new l.c,this._systemSource=Ng.None,this._contextualSource=Lg.None,this._type=g,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",g)}get value(){return this._storedValue}set value(I){this.type===hg.Float&&this.min!==this.max&&(I=Math.max(this.min,I),I=Math.min(this.max,I)),this._storedValue=I,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(I){this._valueCallback=I}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case hg.Int:case hg.Float:this.value=0;break;case hg.Vector2:this.value=e.Vector2.Zero();break;case hg.Vg:this.value=e.Vg.Zero();break;case hg.Sb:this.value=new M.Sb(1,1,1,1);break;case hg.Matrix:this.value=e.Matrix.Identity()}}_build(I){super._build(I),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=I=>I.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=I=>I.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const I=super.serialize();return I.type=this.type,I.contextualValue=this.contextualValue,I.systemSource=this.systemSource,I.min=this.min,I.max=this.max,I.groupInInspector=this.groupInInspector,I.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.bb?(I.valueType="BABYLON."+this._storedValue.getClassName(),I.value=this._storedValue.bb()):(I.valueType="number",I.value=this._storedValue)),I}_deserialize(I){if(super._deserialize(I),this._type=I.type,this.contextualValue=I.contextualValue,this.systemSource=I.systemSource||Ng.None,this.min=I.min||0,this.max=I.max||0,this.groupInInspector=I.groupInInspector||"",void 0!==I.displayInInspector&&(this.displayInInspector=I.displayInInspector),I.valueType)if("number"===I.valueType)this._storedValue=I.value;else{const g=(0,J.d)(I.valueType);g&&(this._storedValue=g.mb(I.value))}}}(0,J.g)("BABYLON.ParticleInputBlock",Tg);class Wg extends tg{get url(){return this._url}set url(I){this._url!==I&&(this._cachedData=null,this._url=I,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(I){this._textureDataUrl!==I&&(this._cachedData=null,this._textureDataUrl=I,this._url="",this._sourceTexture=null)}set sourceTexture(I){this._sourceTexture!==I&&(this._cachedData=null,this._sourceTexture=I,this._url="",this._textureDataUrl="")}constructor(I){super(I),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",hg.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const I=this.texture._storedValue;return await new Promise(((g,b)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),g(this._cachedData)}catch(I){b(I)}}));const e=I.getSize();rg.l.GetTextureDataAsync(I,e.width,e.height).then((b=>{this._cachedData={width:e.width,height:e.height,data:new Uint8ClampedArray(b)},I.dispose(),g(this._cachedData)})).catch(b)}))}_build(I){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new i.b(this._textureDataUrl,I.Xg):this.texture._storedValue=new i.b(this._url,I.Xg):this.texture._storedValue=null}serialize(){const I=super.serialize();return I.url=this.url,I.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(I.textureDataUrl=this.textureDataUrl),I}_deserialize(I){super._deserialize(I),this.url=I.url,this.serializedCachedData=!!I.serializedCachedData,I.textureDataUrl&&(this.textureDataUrl=I.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,J.g)("BABYLON.ParticleTextureSourceBlock",Wg);class Ib extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("position",hg.Vg),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.position.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.position.G(this.position.getConnectedValue(I))},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}}(0,J.g)("BABYLON.UpdatePositionBlock",Ib),function(I){I[I.Add=0]="Add",I[I.Subtract=1]="Subtract",I[I.Multiply=2]="Multiply",I[I.Divide=3]="Divide",I[I.Max=4]="Max",I[I.Min=5]="Min"}(Kg||(Kg={}));class gb extends tg{constructor(I){super(I),this.operation=Kg.Add,this.registerInput("left",hg.AutoDetect),this.registerInput("right",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this.output._typeConnectionSource=this.left;const g=[hg.Matrix,hg.Particle,hg.Texture,hg.System,hg.FloatGradient,hg.Color4Gradient,hg.Vector2Gradient,hg.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...g),this.right.excludedConnectionPointTypes.push(...g),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(I){let g;const b=this.left,c=this.right;if(!b.isConnected||!c.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=b.type===hg.Float||b.type===hg.Int,J=c.type===hg.Float||c.type===hg.Int,o=z&&J;switch(this.operation){case Kg.Add:g=o?I=>b.getConnectedValue(I)+c.getConnectedValue(I):z?I=>I.adapt(b,c.type).add(c.getConnectedValue(I)):I=>b.getConnectedValue(I).add(I.adapt(c,b.type));break;case Kg.Subtract:g=o?I=>b.getConnectedValue(I)-c.getConnectedValue(I):z?I=>I.adapt(b,c.type).ag(c.getConnectedValue(I)):I=>b.getConnectedValue(I).ag(I.adapt(c,b.type));break;case Kg.Multiply:g=o?I=>b.getConnectedValue(I)*c.getConnectedValue(I):z?I=>I.adapt(b,c.type).multiply(c.getConnectedValue(I)):I=>b.getConnectedValue(I).multiply(I.adapt(c,b.type));break;case Kg.Divide:g=o?I=>b.getConnectedValue(I)/c.getConnectedValue(I):z?I=>I.adapt(b,c.type).divide(c.getConnectedValue(I)):I=>b.getConnectedValue(I).divide(I.adapt(c,b.type));break;case Kg.Min:if(o)g=I=>Math.min(b.getConnectedValue(I),c.getConnectedValue(I));else{const[I,J]=z?[c,b]:[b,c];switch(I.type){case hg.Vector2:g=g=>e.Vector2.Minimize(I.getConnectedValue(g),g.adapt(J,I.type));break;case hg.Vg:g=g=>e.Vg.Minimize(I.getConnectedValue(g),g.adapt(J,I.type));break;case hg.Sb:g=g=>{const b=I.getConnectedValue(g),{r:e,g:c,b:z,a:o}=g.adapt(J,I.type);return new M.Sb(Math.min(b.r,e),Math.min(b.g,c),Math.min(b.b,z),Math.min(b.a,o))}}}break;case Kg.Max:if(!o){const[I,J]=z?[c,b]:[b,c];switch(I.type){case hg.Vector2:g=g=>e.Vector2.Maximize(I.getConnectedValue(g),g.adapt(J,I.type));break;case hg.Vg:g=g=>e.Vg.Maximize(I.getConnectedValue(g),g.adapt(J,I.type));break;case hg.Sb:g=g=>{const b=I.getConnectedValue(g),{r:e,g:c,b:z,a:o}=g.adapt(J,I.type);return new M.Sb(Math.max(b.r,e),Math.min(b.g,c),Math.min(b.b,z),Math.min(b.a,o))}}break}g=I=>Math.max(b.getConnectedValue(I),c.getConnectedValue(I))}this.output._storedFunction=I=>b.type===hg.Int?0|g(I):g(I)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===hg.Int||this.left.type===hg.Float&&this.right.type!==hg.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[I,g]of[[this.left,this.right],[this.right,this.left]])I.acceptedConnectionPointTypes=[hg.Int,hg.Float],g.isConnected&&(I.acceptedConnectionPointTypes.push(g.type),g.type!==hg.Int&&g.type!==hg.Float||I.acceptedConnectionPointTypes.push(hg.Vector2,hg.Vg,hg.Sb))}dispose(){super.dispose();for(const I of this._connectionObservers)I.remove();this._connectionObservers.length=0}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,r.d)([yg("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Kg.Add},{label:"Subtract",value:Kg.Subtract},{label:"Multiply",value:Kg.Multiply},{label:"Divide",value:Kg.Divide},{label:"Max",value:Kg.Max},{label:"Min",value:Kg.Min}]})],gb.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleMathBlock",gb);class bb extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("direction1",hg.Vg,!0,new e.Vg(0,1,0)),this.registerInput("direction2",hg.Vg,!0,new e.Vg(0,1,0)),this.registerInput("minEmitBox",hg.Vg,!0,new e.Vg(-.5,-.5,-.5)),this.registerInput("maxEmitBox",hg.Vg,!0,new e.Vg(.5,.5,.5)),this.registerOutput("output",hg.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const g=this.particle.getConnectedValue(I);g._directionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.direction1.getConnectedValue(I),z=this.direction2.getConnectedValue(I),M=(0,n.RandomRange)(c.x,z.x),J=(0,n.RandomRange)(c.y,z.y),o=(0,n.RandomRange)(c.z,z.z);I.isEmitterTransformNode?e.Vg.TransformNormalFromFloatsToRef(M,J,o,I.emitterWorldMatrix,b.direction):b.direction.Db(M,J,o)},g._positionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.minEmitBox.getConnectedValue(I),z=this.maxEmitBox.getConnectedValue(I),M=(0,n.RandomRange)(c.x,z.x),J=(0,n.RandomRange)(c.y,z.y),o=(0,n.RandomRange)(c.z,z.z);I.isEmitterTransformNode?e.Vg.TransformCoordinatesFromFloatsToRef(M,J,o,I.emitterWorldMatrix,b.position):(b.position.Db(M,J,o),b.position.addInPlace(I.emitterPosition))},this.output._storedValue=g}}(0,J.g)("BABYLON.BoxShapeBlock",bb);class eb extends tg{constructor(I){super(I),this.registerInput("emitPower",hg.Float,!0,1),this.registerInput("lifeTime",hg.Float,!0,1),this.registerInput("color",hg.Sb,!0,new M.Sb(1,1,1,1)),this.registerInput("scale",hg.Vector2,!0,new e.Vector2(1,1)),this.registerInput("angle",hg.Float,!0,0),this.registerOutput("particle",hg.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(I){const g=new Jg(this.name,I.He,I.Xg,null,!1,void 0,!0);g.particleEmitterType=new f,g._lifeTimeCreation.process=(g,b)=>{I.particleContext=g,g.lifeTime=this.lifeTime.getConnectedValue(I),b._emitPower=this.emitPower.getConnectedValue(I)},g._colorCreation.process=g=>{I.particleContext=g,g.color.G(this.color.getConnectedValue(I))},g._sizeCreation.process=g=>{I.particleContext=g,g.size=1,g.scale.G(this.scale.getConnectedValue(I))},g._angleCreation.process=g=>{I.particleContext=g,g.angle=this.angle.getConnectedValue(I)},this.particle._storedValue=g}}(0,J.g)("BABYLON.CreateParticleBlock",eb);class cb{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const I=[];for(const g of this.attachedBlocks)g.isInput&&I.push(g);return I}constructor(I){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new l.c,this.name=I}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(I)&&this.attachedBlocks.push(I);for(const b of I.inputs){const e=b.connectedPoint;if(e){const b=e.ownerBlock;b!==I&&this._initializeBlock(b,g)}}}async buildAsync(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const e=new Eg;for(const I of this._systemBlocks)this._initializeBlock(I);for(const c of this.systemBlocks){const b=new qg;b.buildId=this._buildId++,b.Xg=I,b.verbose=g;const z=c.createSystem(b);b.emitErrors(),e.systems.push(z)}this.onBuildObservable.notifyObservers(this),b(e)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const I=new wg("Particle system"),g=new Ib("Update position");g.output.connectTo(I.particle);const b=new Tg("Position");b.contextualValue=Lg.Position;const e=new Tg("Scaled direction");e.contextualValue=Lg.ScaledDirection;const c=new gb("Add");c.operation=Kg.Add,b.output.connectTo(c.left),e.output.connectTo(c.right),c.output.connectTo(g.position);const z=new eb("Create particle"),M=new bb("Box shape");z.particle.connectTo(M.particle),M.output.connectTo(g.particle);const J=new Wg("Texture");J.texture.connectTo(I.texture),J.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(I)}removeBlock(I){const g=this.attachedBlocks.indexOf(I);if(g>-1&&this.attachedBlocks.splice(g,1),I.isSystem){const g=this._systemBlocks.indexOf(I);g>-1&&this._systemBlocks.splice(g,1)}}parseSerializedObject(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];g||this.clear();const b={};for(const e of I.yD){const I=(0,J.d)(e.customType);if(I){const g=new I;g._deserialize(e),b[e.id]=g,this.attachedBlocks.push(g),g.isSystem&&this._systemBlocks.push(g)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const I=e,g=I._tempEntryPointUniqueId;if(g){const e=b[g];e&&e.attachToEndpoint(I)}}for(let e=0;e<I.yD.length;e++){const c=I.yD[e],z=b[c.id];z&&(z.inputs.length&&c.inputs.some((I=>I.targetConnectionName))&&!g||this._restoreConnections(z,I,b))}if(I.locations||I.editorData&&I.editorData.locations){const e=I.locations||I.editorData.locations;for(const I of e)b[I.IJ]&&(I.IJ=b[I.IJ].uniqueId);g&&this.editorData&&this.editorData.locations&&e.concat(this.editorData.locations),I.locations?this.editorData={locations:e}:(this.editorData=I.editorData,this.editorData.locations=e);const c=[];for(const I in b)c[I]=b[I].uniqueId;this.editorData.map=c}this.comment=I.comment}_restoreConnections(I,g,b){for(const e of I.outputs)for(const c of g.yD){const z=b[c.id];if(z)for(const M of c.inputs)if(b[M.targetBlockId]!==I||M.targetConnectionName!==e.name);else{const I=z.getInputByName(M.inputName);if(!I||I.isConnected)continue;e.connectTo(I,!0),this._restoreConnections(z,g,b)}}}serialize(I){const g=I?{}:H.b.Serialize(this);g.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];I?b=I:g.customType="BABYLON.NodeParticleSystemSet",g.yD=[];for(const e of b)g.yD.push(e.serialize());if(!I)for(const e of this.attachedBlocks)-1===b.indexOf(e)&&g.yD.push(e.serialize());return g}dispose(){for(const I of this.attachedBlocks)I.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(I){const g=new cb(I);return g.setToDefault(),g}static Parse(I){const g=H.b.Parse((()=>new cb(I.name)),I,null);return g.parseSerializedObject(I),g}static ParseFromSnippetAsync(I,g){return"_BLANK"===I?Promise.resolve(cb.CreateDefault("blank")):new Promise(((b,e)=>{const c=new mb.d;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const M=JSON.parse(JSON.parse(c.responseText).jsonPayload),J=JSON.parse(M.nodeParticle);g||(g=H.b.Parse((()=>new cb(I)),J,null)),g.parseSerializedObject(J),g.snippetId=I;try{b(g)}catch(z){e(z)}}else e("Unable to load the snippet "+I)})),c.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),c.send()}))}}cb.EditorURL=`${vg.Tools._DefaultCdnUrl}/v${yI.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,cb.SnippetUrl="https://snippet.babylonjs.com",(0,r.d)([(0,O.E)()],cb.prototype,"name",void 0),(0,r.d)([(0,O.E)("comment")],cb.prototype,"comment",void 0),function(I){I[I.None=0]="None",I[I.PerParticle=1]="PerParticle",I[I.PerSystem=2]="PerSystem"}(Bg||(Bg={}));class zb extends tg{constructor(I){super(I),this._currentLockId=-2,this.lockMode=Bg.PerParticle,this.registerInput("min",hg.AutoDetect,!0,0),this.registerInput("max",hg.AutoDetect,!0,1),this.registerOutput("output",hg.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(hg.Float|hg.Int|hg.Vector2|hg.Vg|hg.Sb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(hg.Float|hg.Int|hg.Vector2|hg.Vg|hg.Sb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=hg.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case hg.AutoDetect:case hg.Int:case hg.Float:I=I=>{const g=this.min.getConnectedValue(I)||0,b=this.max.getConnectedValue(I)||1;return g+Math.random()*(b-g)};break;case hg.Vector2:I=I=>{const g=this.min.getConnectedValue(I)||e.Vector2.Zero(),b=this.max.getConnectedValue(I)||e.Vector2.One();return new e.Vector2(g.x+Math.random()*(b.x-g.x),g.y+Math.random()*(b.y-g.y))};break;case hg.Vg:I=I=>{const g=this.min.getConnectedValue(I)||e.Vg.Zero(),b=this.max.getConnectedValue(I)||e.Vg.One();return new e.Vg(g.x+Math.random()*(b.x-g.x),g.y+Math.random()*(b.y-g.y),g.z+Math.random()*(b.z-g.z))};break;case hg.Sb:I=I=>{const g=this.min.getConnectedValue(I)||new M.Sb(0,0,0,0),b=this.max.getConnectedValue(I)||new M.Sb(1,1,1,1);return new M.Sb(g.x+Math.random()*(b.x-g.x),g.y+Math.random()*(b.y-g.y),g.z+Math.random()*(b.z-g.z),g.w+Math.random()*(b.w-g.w))}}this.output._storedFunction=g=>{var b;let e=0;switch(this.lockMode){case Bg.PerParticle:e=(null===(b=g.particleContext)||void 0===b?void 0:b.id)||-1;break;case Bg.PerSystem:e=g.buildId||0}return this._currentLockId!==e&&(this.lockMode!==Bg.None&&(this._currentLockId=e),this.output._storedValue=I(g)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),this.lockMode=I.lockMode}}(0,r.d)([yg("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Bg.None},{label:"Per particle",value:Bg.PerParticle},{label:"Per system",value:Bg.PerSystem}]})],zb.prototype,"lockMode",void 0),(0,J.g)("BABYLON.ParticleRandomBlock",zb);class Mb extends tg{constructor(I){super(I),this._currentLockId=-2,this.lockMode=Bg.PerParticle,this.registerInput("min",hg.AutoDetect),this.registerInput("max",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const g=[hg.Matrix,hg.Particle,hg.Texture,hg.System,hg.FloatGradient,hg.Color4Gradient,hg.Vector2Gradient,hg.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...g),this.max.excludedConnectionPointTypes.push(...g)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case hg.Float:case hg.Int:I=I=>{const g=this.min.getConnectedValue(I),b=this.max.getConnectedValue(I);return Math.random()*(b-g)+g};break;case hg.Vector2:I=I=>{const g=this.min.getConnectedValue(I),b=this.max.getConnectedValue(I);return new e.Vector2(Math.random()*(b.x-g.x)+g.x,Math.random()*(b.y-g.y)+g.y)};break;case hg.Vg:I=I=>{const g=this.min.getConnectedValue(I),b=this.max.getConnectedValue(I);return new e.Vg(Math.random()*(b.x-g.x)+g.x,Math.random()*(b.y-g.y)+g.y,Math.random()*(b.z-g.z)+g.z)};break;case hg.Sb:I=I=>{const g=this.min.getConnectedValue(I),b=this.max.getConnectedValue(I);return new M.Sb(Math.random()*(b.r-g.r)+g.r,Math.random()*(b.g-g.g)+g.g,Math.random()*(b.b-g.b)+g.b,Math.random()*(b.a-g.a)+g.a)}}this.output._storedFunction=g=>{var b;let e=0;switch(this.lockMode){case Bg.PerParticle:e=(null===(b=g.particleContext)||void 0===b?void 0:b.id)||-1;break;case Bg.PerSystem:e=g.buildId||0}return this._currentLockId!==e&&(this.lockMode!==Bg.None&&(this._currentLockId=e),this.output._storedValue=I(g)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),void 0!==I.lockMode&&(this.lockMode=I.lockMode)}}(0,r.d)([yg("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Bg.None},{label:"Per particle",value:Bg.PerParticle},{label:"Per system",value:Bg.PerSystem}]})],Mb.prototype,"lockMode",void 0),(0,J.g)("BABYLON.RandomRangeBlock",Mb);(0,J.g)("BABYLON.ParticleLerpBlock",class extends tg{constructor(I){super(I),this.registerInput("left",hg.AutoDetect),this.registerInput("right",hg.AutoDetect),this.registerInput("gradient",hg.Float,!0,0,0,1),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(hg.Float|hg.Int|hg.Vector2|hg.Vg|hg.Sb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=(I,g,b)=>(1-I)*g+I*b;this.output._storedFunction=g=>{const b=this.left.getConnectedValue(g),c=this.right.getConnectedValue(g),z=this.gradient.getConnectedValue(g);switch(this.left.type){case hg.Int:case hg.Float:return I(z,b,c);case hg.Vector2:return new e.Vector2(I(z,b.x,c.x),I(z,b.y,c.y));case hg.Vg:return new e.Vg(I(z,b.x,c.x),I(z,b.y,c.y),I(z,b.z,c.z));case hg.Sb:return new M.Sb(I(z,b.r,c.r),I(z,b.g,c.g),I(z,b.b,c.b),I(z,b.a,c.a))}return 0}}});(0,J.g)("BABYLON.UpdateDirectionBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("direction",hg.Vg),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.direction.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.direction.G(this.direction.getConnectedValue(I))},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}});(0,J.g)("BABYLON.UpdateColorBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("color",hg.Sb),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.color.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.color.G(this.color.getConnectedValue(I))},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}});(0,J.g)("BABYLON.UpdateScaleBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("scale",hg.Vector2),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.scale.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.scale.G(this.scale.getConnectedValue(I))},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}});(0,J.g)("BABYLON.UpdateAngleBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("angle",hg.Float),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.angle.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.angle=this.angle.getConnectedValue(I)},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}});(0,J.g)("BABYLON.BasicPositionUpdateBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(I){const g=this.particle.getConnectedValue(I),b={process:b=>{I.particleContext=b,I.systemContext=g,b.direction.scaleToRef(g._directionScale,g._scaledDirection),b.position.addInPlace(g._scaledDirection)},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b,this.output._storedValue=g}});(0,J.g)("BABYLON.BasicSpriteUpdateBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(I){const g=this.particle.getConnectedValue(I),b={process:b=>{I.particleContext=b,I.systemContext=g,b.updateCellIndex()},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b,this.output._storedValue=g}});(0,J.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("cellIndex",hg.Int),this.registerOutput("output",hg.Particle),this.cellIndex.acceptedConnectionPointTypes=[hg.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(I){const g=this.particle.getConnectedValue(I);if(this.output._storedValue=g,!this.cellIndex.isConnected)return;const b={process:b=>{I.particleContext=b,I.systemContext=g,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(I))},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b}});class Jb extends tg{constructor(I){super(I),this.strength=1,this.registerInput("particle",hg.Particle),this.registerInput("flowMap",hg.Texture),this.registerOutput("output",hg.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(I){var g;const b=this.particle.getConnectedValue(I),e=I.Xg;let c;(null===(g=this.flowMap.connectedPoint)||void 0===g?void 0:g.ownerBlock).extractTextureContentAsync().then((I=>{I&&(c=new Ug(I.width,I.height,I.data))}));const z={process:I=>{const g=e.getTransformMatrix();c&&c._processParticle(I,this.strength*b._tempScaledUpdateSpeed,g)},previousItem:null,nextItem:null};b._updateQueueStart?NI(z,b._updateQueueStart):b._updateQueueStart=z,this.output._storedValue=b}serialize(){const I=super.serialize();return I.strength=this.strength,I}_deserialize(I){super._deserialize(I),this.strength=I.strength}}(0,r.d)([yg("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Jb.prototype,"strength",void 0),(0,J.g)("BABYLON.UpdateFlowMapBlock",Jb);(0,J.g)("BABYLON.SphereShapeBlock",class extends tg{constructor(I){super(I),this.registerInput("input",hg.Particle),this.registerInput("radius",hg.Float,!0,1),this.registerInput("radiusRange",hg.Float,!0,1,0,1),this.registerInput("directionRandomizer",hg.Float,!0,0,0,1),this.registerOutput("output",hg.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(I){const g=this.input.getConnectedValue(I);g._directionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.directionRandomizer.getConnectedValue(I),z=b.position.ag(I.emitterPosition).normalize(),M=(0,n.RandomRange)(0,c),J=(0,n.RandomRange)(0,c),o=(0,n.RandomRange)(0,c);z.x+=M,z.y+=J,z.z+=o,z.normalize(),I.isEmitterTransformNode?e.Vg.TransformNormalFromFloatsToRef(M,J,o,I.emitterWorldMatrix,b.direction):b.direction.Db(M,J,o)},g._positionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.radius.getConnectedValue(I),z=this.radiusRange.getConnectedValue(I),M=c-(0,n.RandomRange)(0,c*z),J=(0,n.RandomRange)(0,1),o=(0,n.RandomRange)(0,2*Math.PI),G=Math.acos(2*J-1),D=M*Math.cos(o)*Math.sin(G),p=M*Math.cos(G),x=M*Math.sin(o)*Math.sin(G);I.isEmitterTransformNode?e.Vg.TransformCoordinatesFromFloatsToRef(D,p,x,I.emitterWorldMatrix,b.position):(b.position.Db(D,p,x),b.position.addInPlace(I.emitterPosition))},this.output._storedValue=g}});(0,J.g)("BABYLON.PointShapeBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("direction1",hg.Vg,!0,new e.Vg(0,1,0)),this.registerInput("direction2",hg.Vg,!0,new e.Vg(0,1,0)),this.registerOutput("output",hg.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const g=this.particle.getConnectedValue(I);g._directionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.direction1.getConnectedValue(I),z=this.direction2.getConnectedValue(I),M=(0,n.RandomRange)(c.x,z.x),J=(0,n.RandomRange)(c.y,z.y),o=(0,n.RandomRange)(c.z,z.z);I.isEmitterTransformNode?e.Vg.TransformNormalFromFloatsToRef(M,J,o,I.emitterWorldMatrix,b.direction):b.direction.Db(M,J,o)},g._positionCreation.process=b=>{I.systemContext=g,I.isEmitterTransformNode?e.Vg.TransformCoordinatesFromFloatsToRef(0,0,0,I.emitterWorldMatrix,b.position):b.position.G(I.emitterPosition)},this.output._storedValue=g}});(0,J.g)("BABYLON.CustomShapeBlock",class extends tg{constructor(I){super(I),this.registerInput("particle",hg.Particle),this.registerInput("position",hg.Vg,!0,new e.Vg(0,0,0)),this.registerInput("direction",hg.Vg,!0,new e.Vg(0,1,0)),this.registerOutput("output",hg.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const g=this.particle.getConnectedValue(I);g._directionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.direction.getConnectedValue(I);I.isEmitterTransformNode?e.Vg.TransformNormalToRef(c,I.emitterWorldMatrix,b.direction):b.direction.G(c)},g._positionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.position.getConnectedValue(I);I.isEmitterTransformNode?e.Vg.TransformCoordinatesToRef(c,I.emitterWorldMatrix,b.position):(b.position.G(c),b.position.addInPlace(I.emitterPosition))},this.output._storedValue=g}});(0,J.g)("BABYLON.CylinderShapeBlock",class extends tg{constructor(I){super(I),this._tempVector=e.Vg.Zero(),this.registerInput("particle",hg.Particle),this.registerInput("radius",hg.Float,!0,1),this.registerInput("height",hg.Float,!0,1,0),this.registerInput("radiusRange",hg.Float,!0,1,0,1),this.registerInput("directionRandomizer",hg.Float,!0,0,0,1),this.registerOutput("output",hg.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const g=this.particle.getConnectedValue(I);g._directionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.directionRandomizer.getConnectedValue(I);b.position.subtractToRef(I.emitterPosition,this._tempVector),this._tempVector.normalize(),I.isEmitterTransformNode&&e.Vg.TransformNormalToRef(this._tempVector,I.emitterInverseWorldMatrix,this._tempVector);const z=(0,n.RandomRange)(-c/2,c/2);let M=Math.atan2(this._tempVector.x,this._tempVector.z);M+=(0,n.RandomRange)(-Math.PI/2,Math.PI/2)*c,this._tempVector.y=z,this._tempVector.x=Math.sin(M),this._tempVector.z=Math.cos(M),this._tempVector.normalize(),I.isEmitterTransformNode?e.Vg.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I.emitterWorldMatrix,b.direction):b.direction.G(this._tempVector)},g._positionCreation.process=b=>{I.particleContext=b,I.systemContext=g;const c=this.height.getConnectedValue(I),z=this.radiusRange.getConnectedValue(I),M=this.radius.getConnectedValue(I),J=(0,n.RandomRange)(-c/2,c/2),o=(0,n.RandomRange)(0,2*Math.PI),G=(0,n.RandomRange)((1-z)*(1-z),1),D=Math.sqrt(G)*M,p=D*Math.cos(o),x=D*Math.sin(o);I.isEmitterTransformNode?e.Vg.TransformCoordinatesFromFloatsToRef(p,J,x,I.emitterWorldMatrix,b.position):(b.position.Db(p,J,x),b.position.addInPlace(I.emitterPosition))},this.output._storedValue=g}});class ob extends tg{constructor(I){super(I),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",hg.Particle),this.registerOutput("output",hg.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const g=this.particle.getConnectedValue(I);g._isAnimationSheetEnabled=!0,g.spriteCellWidth=this.width,g.spriteCellHeight=this.height,g.startSpriteCellID=this.start,g.endSpriteCellID=this.end,g.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=g}serialize(){const I=super.serialize();return I.width=this.width,I.height=this.height,I.start=this.start,I.end=this.end,I.randomStartCell=this.randomStartCell,I}_deserialize(I){super._deserialize(I),this.width=I.width,this.height=I.height,this.start=I.start,this.end=I.end,this.randomStartCell=I.randomStartCell}}(0,r.d)([yg("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ob.prototype,"start",void 0),(0,r.d)([yg("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ob.prototype,"end",void 0),(0,r.d)([yg("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ob.prototype,"width",void 0),(0,r.d)([yg("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ob.prototype,"height",void 0),(0,r.d)([yg("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ob.prototype,"loop",void 0),(0,r.d)([yg("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ob.prototype,"randomStartCell",void 0),(0,J.g)("BABYLON.SetupSpriteSheetBlock",ob);class nb extends tg{constructor(I){super(I),this.reference=0,this.registerInput("value",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case hg.Float:return hg.FloatGradient;case hg.Vector2:return hg.Vector2Gradient;case hg.Vg:return hg.Vector3Gradient;case hg.Sb:return hg.Color4Gradient}return I},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(hg.Float|hg.Vector2|hg.Vg|hg.Sb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=I=>null}serialize(){const I=super.serialize();return I.reference=this.reference,I}_deserialize(I){super._deserialize(I),this.reference=I.reference}}(0,r.d)([yg("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],nb.prototype,"reference",void 0),(0,J.g)("BABYLON.ParticleGradientValueBlock",nb);(0,J.g)("BABYLON.ParticleGradientBlock",class extends tg{constructor(I){super(I),this._entryCount=1,this.registerInput("gradient",hg.Float,!0,1,0,1),this.registerInput("value0",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case hg.FloatGradient:return hg.Float;case hg.Vector2Gradient:return hg.Vector2;case hg.Vector3Gradient:return hg.Vg;case hg.Color4Gradient:return hg.Sb}return I},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(hg.FloatGradient|hg.Vector2Gradient|hg.Vector3Gradient|hg.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(I){this._inputs[I].onConnectionObservable.add((()=>{this._entryCount>I||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),hg.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const I=[];for(let b=1;b<this._inputs.length;b++){var g;if(this._inputs[b].isConnected)I.push(null===(g=this._inputs[b].connectedPoint)||void 0===g?void 0:g.ownerBlock)}I.sort(((I,g)=>I.reference-g.reference)),this.output._storedFunction=g=>{const b=this.gradient.getConnectedValue(g);if(1===I.length)return I[0].value.getConnectedValue(g);let c=null;for(let z=I.length-1;z>=0;z--){const J=I[z];if(J.reference<=b){const I=J.value.getConnectedValue(g);if(c){const z=c.value.getConnectedValue(g),o=c.reference,G=J.reference,D=Math.max(0,Math.min(1,(b-G)/(o-G)));switch(this.output.type){case hg.Float:return(0,n.Lerp)(I,z,D);case hg.Vector2:return e.Vector2.Lerp(I,z,D);case hg.Vg:return e.Vg.Lerp(I,z,D);case hg.Sb:return M.Sb.Lerp(I,z,D)}}return I}c=J}return 0}}});(0,J.g)("BABYLON.ParticleConverterBlock",class extends tg{constructor(I){super(I),this.registerInput("color ",hg.Sb,!0),this.registerInput("xyz ",hg.Vg,!0),this.registerInput("xy ",hg.Vector2,!0),this.registerInput("zw ",hg.Vector2,!0),this.registerInput("x ",hg.Float,!0),this.registerInput("y ",hg.Float,!0),this.registerInput("z ",hg.Float,!0),this.registerInput("w ",hg.Float,!0),this.registerOutput("color",hg.Sb),this.registerOutput("xyz",hg.Vg),this.registerOutput("xy",hg.Vector2),this.registerOutput("zw",hg.Vector2),this.registerOutput("x",hg.Float),this.registerOutput("y",hg.Float),this.registerOutput("z",hg.Float),this.registerOutput("w",hg.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(I){return"color "===I?"colorIn":"xyz "===I?"xyzIn":"xy "===I?"xyIn":"zw "===I?"zwIn":"x "===I?"xIn":"y "===I?"yIn":"z "===I?"zIn":"w "===I?"wIn":I}_outputRename(I){switch(I){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return I}}_build(I){super._build(I);const g=this.xIn,b=this.yIn,c=this.zIn,z=this.wIn,J=this.xyIn,o=this.zwIn,n=this.xyzIn,G=this.colorIn,D=this.colorOut,p=this.xyzOut,x=this.xyOut,Z=this.zwOut,k=this.xOut,S=this.yOut,f=this.zOut,V=this.wOut,a=I=>{if(G.isConnected)return G.getConnectedValue(I);let e=0,D=0,p=0,x=0;if(g.isConnected&&(e=g.getConnectedValue(I)),b.isConnected&&(D=b.getConnectedValue(I)),c.isConnected&&(p=c.getConnectedValue(I)),z.isConnected&&(x=z.getConnectedValue(I)),J.isConnected){const g=J.getConnectedValue(I);g&&(e=g.x,D=g.y)}if(o.isConnected){const g=o.getConnectedValue(I);g&&(p=g.x,x=g.y)}if(n.isConnected){const g=n.getConnectedValue(I);g&&(e=g.x,D=g.y,p=g.z)}return new M.Sb(e,D,p,x)};D._storedFunction=I=>a(I),p._storedFunction=I=>{const g=a(I);return new e.Vg(g.r,g.g,g.b)},x._storedFunction=I=>{const g=a(I);return new e.Vector2(g.r,g.g)},Z._storedFunction=I=>{const g=a(I);return new e.Vector2(g.b,g.a)},k._storedFunction=I=>a(I).r,S._storedFunction=I=>a(I).g,f._storedFunction=I=>a(I).b,V._storedFunction=I=>a(I).a}}),function(I){I[I.Cos=0]="Cos",I[I.Sin=1]="Sin",I[I.Abs=2]="Abs",I[I.Exp=3]="Exp",I[I.Exp2=4]="Exp2",I[I.Round=5]="Round",I[I.Floor=6]="Floor",I[I.Ceiling=7]="Ceiling",I[I.Sqrt=8]="Sqrt",I[I.Log=9]="Log",I[I.Tan=10]="Tan",I[I.ArcTan=11]="ArcTan",I[I.ArcCos=12]="ArcCos",I[I.ArcSin=13]="ArcSin",I[I.Sign=14]="Sign",I[I.Negate=15]="Negate",I[I.OneMinus=16]="OneMinus",I[I.Reciprocal=17]="Reciprocal",I[I.ToDegrees=18]="ToDegrees",I[I.ToRadians=19]="ToRadians",I[I.Fract=20]="Fract"}(Pg||(Pg={}));class Gb extends tg{constructor(I){super(I),this.operation=Pg.Cos,this.registerInput("input",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(hg.Float|hg.Int|hg.Vector2|hg.Vg|hg.Sb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);let g=null;switch(this.operation){case Pg.Cos:g=I=>Math.cos(I);break;case Pg.Sin:g=I=>Math.sin(I);break;case Pg.Abs:g=I=>Math.abs(I);break;case Pg.Exp:g=I=>Math.exp(I);break;case Pg.Exp2:g=I=>Math.pow(2,I);break;case Pg.Round:g=I=>Math.round(I);break;case Pg.Floor:g=I=>Math.floor(I);break;case Pg.Ceiling:g=I=>Math.ceil(I);break;case Pg.Sqrt:g=I=>Math.sqrt(I);break;case Pg.Log:g=I=>Math.log(I);break;case Pg.Tan:g=I=>Math.tan(I);break;case Pg.ArcTan:g=I=>Math.atan(I);break;case Pg.ArcCos:g=I=>Math.acos(I);break;case Pg.ArcSin:g=I=>Math.asin(I);break;case Pg.Sign:g=I=>Math.sign(I);break;case Pg.Negate:g=I=>-I;break;case Pg.OneMinus:g=I=>1-I;break;case Pg.Reciprocal:g=I=>1/I;break;case Pg.ToRadians:g=I=>I*Math.PI/180;break;case Pg.ToDegrees:g=I=>180*I/Math.PI;break;case Pg.Fract:g=I=>I>=0?I-Math.floor(I):I-Math.ceil(I)}if(!g)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case hg.Int:case hg.Float:this.output._storedFunction=I=>{const b=this.input.getConnectedValue(I);return g(b)};break;case hg.Vector2:this.output._storedFunction=I=>{const b=this.input.getConnectedValue(I);return new e.Vector2(g(b.x),g(b.y))};break;case hg.Vg:this.output._storedFunction=I=>{const b=this.input.getConnectedValue(I);return new e.Vg(g(b.x),g(b.y),g(b.z))};break;case hg.Sb:this.output._storedFunction=I=>{const b=this.input.getConnectedValue(I);return new M.Sb(g(b.r),g(b.g),g(b.b),g(b.a))}}return this}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,r.d)([yg("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Pg.Cos},{label:"Sin",value:Pg.Sin},{label:"Abs",value:Pg.Abs},{label:"Exp",value:Pg.Exp},{label:"Exp2",value:Pg.Exp2},{label:"Round",value:Pg.Round},{label:"Floor",value:Pg.Floor},{label:"Ceiling",value:Pg.Ceiling},{label:"Sqrt",value:Pg.Sqrt},{label:"Log",value:Pg.Log},{label:"Tan",value:Pg.Tan},{label:"ArcTan",value:Pg.ArcTan},{label:"ArcCos",value:Pg.ArcCos},{label:"ArcSin",value:Pg.ArcSin},{label:"Sign",value:Pg.Sign},{label:"Negate",value:Pg.Negate},{label:"OneMinus",value:Pg.OneMinus},{label:"Reciprocal",value:Pg.Reciprocal},{label:"ToDegrees",value:Pg.ToDegrees},{label:"ToRadians",value:Pg.ToRadians},{label:"Fract",value:Pg.Fract}]})],Gb.prototype,"operation",void 0),(0,J.g)("BABYLON.ParticleTrigonometryBlock",Gb);var Db,pb=b(13968);class xb extends tg{constructor(I){super(I),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(hg.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(hg.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(hg.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(hg.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(hg.System),this._inputs[0].excludedConnectionPointTypes.push(hg.Particle),this._inputs[0].excludedConnectionPointTypes.push(hg.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const g=I=>{const g=this.input.getConnectedValue(I);if(this.log.length>=this.stackSize)return g;if(null===g||void 0===g)return this.log.push(["null",""]),g;switch(this.input.type){case hg.Vector2:this.log.push([(0,pb.i)(g,4),g.toString()]);break;case hg.Vg:this.log.push([(0,pb.j)(g,4),g.toString()]);break;case hg.Sb:this.log.push([`{R: ${g.r.toFixed(4)} G: ${g.g.toFixed(4)} B: ${g.b.toFixed(4)} A: ${g.a.toFixed(4)}}`,g.toString()]);break;default:this.log.push([g.toString(),g.toString()])}return g};this.output.isConnected?this.output._storedFunction=g:this.output._storedValue=g(I)}serialize(){const I=super.serialize();return I.stackSize=this.stackSize,I}_deserialize(I){super._deserialize(I),this.stackSize=I.stackSize}}(0,r.d)([yg("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],xb.prototype,"stackSize",void 0),(0,J.g)("BABYLON.ParticleDebugBlock",xb);(0,J.g)("BABYLON.ParticleElbowBlock",class extends tg{constructor(I){super(I),this.registerInput("input",hg.AutoDetect),this.registerOutput("output",hg.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const g=this._outputs[0],b=this._inputs[0];g._storedFunction=I=>b.getConnectedValue(I)}});(0,J.g)("BABYLON.ParticleTeleportInBlock",class extends tg{get endpoints(){return this._endpoints}constructor(I){super(I),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",hg.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const g of this.endpoints)if(g.isAnAncestorOfType(I))return!0;return!1}isAnAncestorOf(I){for(const g of this.endpoints){if(g===I)return!0;if(g.isAnAncestorOf(I))return!0}return!1}attachToEndpoint(I){I.detach(),this._endpoints.push(I),I._entryPoint=this,I._outputs[0]._typeConnectionSource=this._inputs[0],I._tempEntryPointUniqueId=null,I.name="> "+this.name}detachFromEndpoint(I){const g=this._endpoints.indexOf(I);-1!==g&&(this._endpoints.splice(g,1),I._outputs[0]._typeConnectionSource=null,I._entryPoint=null)}_build(){for(const I of this._endpoints)I.output._storedFunction=I=>this.input.getConnectedValue(I)}});(0,J.g)("BABYLON.ParticleTeleportOutBlock",class extends tg{constructor(I){super(I),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",hg.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(I){this.entryPoint&&this.entryPoint.build(I)}clone(){const I=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(I),I}serialize(){var I;const g=super.serialize();return g.entryPoint=(null===(I=this.entryPoint)||void 0===I?void 0:I.uniqueId)??"",g}_deserialize(I){super._deserialize(I),this._tempEntryPointUniqueId=I.entryPoint}}),function(I){I[I.Equal=0]="Equal",I[I.NotEqual=1]="NotEqual",I[I.LessThan=2]="LessThan",I[I.GreaterThan=3]="GreaterThan",I[I.LessOrEqual=4]="LessOrEqual",I[I.GreaterOrEqual=5]="GreaterOrEqual",I[I.Xor=6]="Xor",I[I.Or=7]="Or",I[I.And=8]="And"}(Db||(Db={}));class Zb extends tg{constructor(I){super(I),this.test=Db.Equal,this.epsilon=0,this.registerInput("left",hg.Float),this.registerInput("right",hg.Float,!0,0),this.registerInput("ifTrue",hg.AutoDetect,!0,1),this.registerInput("ifFalse",hg.AutoDetect,!0,0),this.registerOutput("output",hg.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=hg.Float,this._inputs[0].acceptedConnectionPointTypes.push(hg.Int),this._inputs[1].acceptedConnectionPointTypes.push(hg.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const I=I=>{const g=this.left.getConnectedValue(I),b=this.right.getConnectedValue(I);let e=!1;switch(this.test){case Db.Equal:e=(0,n.WithinEpsilon)(g,b,this.epsilon);break;case Db.NotEqual:e=!(0,n.WithinEpsilon)(g,b,this.epsilon);break;case Db.LessThan:e=g<b+this.epsilon;break;case Db.GreaterThan:e=g>b-this.epsilon;break;case Db.LessOrEqual:e=g<=b+this.epsilon;break;case Db.GreaterOrEqual:e=g>=b-this.epsilon;break;case Db.Xor:e=!!g&&!b||!g&&!!b;break;case Db.Or:e=!!g||!!b;break;case Db.And:e=!!g&&!!b}return e};this.output._storedFunction=g=>I(g)?this.ifTrue.getConnectedValue(g):this.ifFalse.getConnectedValue(g)}serialize(){const I=super.serialize();return I.test=this.test,I.epsilon=this.epsilon,I}_deserialize(I){super._deserialize(I),this.test=I.test,void 0!==I.epsilon&&(this.epsilon=I.epsilon)}}(0,r.d)([yg("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Db.Equal},{label:"NotEqual",value:Db.NotEqual},{label:"LessThan",value:Db.LessThan},{label:"GreaterThan",value:Db.GreaterThan},{label:"LessOrEqual",value:Db.LessOrEqual},{label:"GreaterOrEqual",value:Db.GreaterOrEqual},{label:"Xor",value:Db.Xor},{label:"Or",value:Db.Or},{label:"And",value:Db.And}]})],Zb.prototype,"test",void 0),(0,r.d)([yg("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Zb.prototype,"epsilon",void 0),(0,J.g)("BABYLON.ParticleConditionBlock",Zb);class kb extends tg{constructor(I){super(I),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",hg.Particle),this.registerInput("condition",hg.Float,!0,0),this.registerInput("system",hg.System),this.registerOutput("output",hg.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){this._triggerCount=0;const g=this.input.getConnectedValue(I),b={process:b=>{if(I.particleContext=b,I.systemContext=g,0!==this.condition.getConnectedValue(I)&&(0===this.limit||this._triggerCount<this.limit)){const e=(new Date).getTime();if(this._previousOne&&e-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=e;const c=this.system.getConnectedValue(I);if(c){const e=lg(c,I.Xg,b.position);e.Og.addOnce((()=>{this._triggerCount--})),g.Og.addOnce((()=>{e.dispose()}))}}},previousItem:null,nextItem:null};g._updateQueueStart?NI(b,g._updateQueueStart):g._updateQueueStart=b,this.output._storedValue=g}serialize(){const I=super.serialize();return I.limit=this.limit,I.delay=this.delay,I}_deserialize(I){super._deserialize(I),void 0!==I.limit&&(this.limit=I.limit),void 0!==I.delay&&(this.delay=I.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,r.d)([yg("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kb.prototype,"limit",void 0),(0,r.d)([yg("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],kb.prototype,"delay",void 0),(0,J.g)("BABYLON.ParticleTriggerBlock",kb);b(13977),b(13990),b(14006),b(14048)},14031:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14012:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14067:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneVertex",z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14054:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14044:(I,g,b)=>{"use strict";var e=b(12509);const c="fogFragment",z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14029:(I,g,b)=>{"use strict";var e=b(12509);const c="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14074:(I,g,b)=>{"use strict";var e=b(12509);const c="fogVertex",z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14063:(I,g,b)=>{"use strict";var e=b(12509);const c="fogVertexDeclaration",z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14022:(I,g,b)=>{"use strict";var e=b(12509);const c="helperFunctions",z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14015:(I,g,b)=>{"use strict";var e=b(12509);const c="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14026:(I,g,b)=>{"use strict";var e=b(12509);const c="imageProcessingFunctions",z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14018:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14035:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14081:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";e.c.IncludesShadersStoreWGSL[c]||(e.c.IncludesShadersStoreWGSL[c]=z)},14006:(I,g,b)=>{"use strict";b.r(g),b.d(g,{particlesPixelShaderWGSL:()=>M});var e=b(12509);b(14012),b(14015),b(14018),b(14022),b(14026),b(14029),b(14031),b(14035),b(14044);const c="particlesPixelShader",z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.c.ShadersStoreWGSL[c]||(e.c.ShadersStoreWGSL[c]=z);const M={name:c,shader:z}},14048:(I,g,b)=>{"use strict";b.r(g),b.d(g,{particlesVertexShaderWGSL:()=>M});var e=b(12509);b(14054),b(14063),b(14018),b(14067),b(14074),b(14081);const c="particlesVertexShader",z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.c.ShadersStoreWGSL[c]||(e.c.ShadersStoreWGSL[c]=z);const M={name:c,shader:z}},13909:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13985:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13931:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneVertex",z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13999:(I,g,b)=>{"use strict";var e=b(12509);const c="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13918:(I,g,b)=>{"use strict";var e=b(12509);const c="fogFragment",z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13904:(I,g,b)=>{"use strict";var e=b(12509);const c="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13936:(I,g,b)=>{"use strict";var e=b(12509);const c="fogVertex",z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13927:(I,g,b)=>{"use strict";var e=b(12509);const c="fogVertexDeclaration",z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13896:(I,g,b)=>{"use strict";var e=b(12509);const c="helperFunctions",z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13883:(I,g,b)=>{"use strict";var e=b(12509);const c="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13902:(I,g,b)=>{"use strict";var e=b(12509);const c="imageProcessingFunctions",z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13888:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13913:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13943:(I,g,b)=>{"use strict";var e=b(12509);const c="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";e.c.IncludesShadersStore[c]||(e.c.IncludesShadersStore[c]=z)},13977:(I,g,b)=>{"use strict";b.r(g),b.d(g,{particlesPixelShader:()=>M});var e=b(12509);b(13985),b(13883),b(13888),b(13896),b(13902),b(13904),b(13909),b(13913),b(13918);const c="particlesPixelShader",z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.c.ShadersStore[c]||(e.c.ShadersStore[c]=z);const M={name:c,shader:z}},13990:(I,g,b)=>{"use strict";b.r(g),b.d(g,{particlesVertexShader:()=>M});var e=b(12509);b(13999),b(13927),b(13888),b(13931),b(13936),b(13943);const c="particlesVertexShader",z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.c.ShadersStore[c]||(e.c.ShadersStore[c]=z);const M={name:c,shader:z}},14326:(I,g,b)=>{"use strict";b.r(g),b.d(g,{FlowGraphGLTFDataProvider:()=>z});var e=b(14295),c=b(14282);class z extends e.d{constructor(I){var g,b;super();const e=I.glTF,z=(null===(g=e.animations)||void 0===g?void 0:g.map((I=>I._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",c.c,z);const M=(null===(b=e.nodes)||void 0===b?void 0:b.map((I=>I._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",c.c,M)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14221:(I,g,b)=>{"use strict";b.d(g,{c:()=>S,g:()=>Z,h:()=>x,l:()=>k});var e=b(12590),c=b(13058),z=b(12637),M=b(14228);const J=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class o{constructor(I,g){this._gltf=I,this._infoTree=g}convert(I){let g,b=this._gltf,e=this._infoTree;if(!I.startsWith("/"))throw new Error("Path must start with a /");const c=I.split("/");if(c.shift(),c[c.length-1].includes(".length")){const I=c[c.length-1].split(".");c.pop(),c.push(...I)}let z=!1;for(const o of c){const c="length"===o;if(c&&!e.__array__)throw new Error(`Path ${I} is invalid`);if(e.__ignoreObjectTree__&&(z=!0),e.__array__&&!c)e=e.__array__;else if(e=e[o],!e)throw new Error(`Path ${I} is invalid`);if(!z)if(void 0===b){if(!J.find((g=>g.regex.test(I))))throw new Error(`Path ${I} is invalid`)}else if(!c){var M;b=null===(M=b)||void 0===M?void 0:M[o]}(e.__target__||c)&&(g=b)}return{object:g,info:e}}}function n(I,g,b,e){const c=G(I,g);return e?c[b][e]:c[b]}function G(I,g,b){var e,z;return null===(e=I._data)||void 0===e||null===(z=e[(null===b||void 0===b?void 0:b.fillMode)??c.e.MATERIAL_TriangleFillMode])||void 0===z?void 0:z.babylonMaterial}function D(I,g){return{offset:{componentsCount:2,type:"Vector2",get:(b,c,z)=>{const M=n(b,z,I,g);return new e.Vector2(null===M||void 0===M?void 0:M.uOffset,null===M||void 0===M?void 0:M.vOffset)},getTarget:G,set:(b,e,c,z)=>{const M=n(e,z,I,g);M.uOffset=b.x,M.vOffset=b.y},getPropertyName:[()=>`${I}${g?"."+g:""}.uOffset`,()=>`${I}${g?"."+g:""}.vOffset`]},rotation:{type:"number",get:(b,e,c)=>{var z;return null===(z=n(b,c,I,g))||void 0===z?void 0:z.wAng},getTarget:G,set:(b,e,c,z)=>n(e,z,I,g).wAng=b,getPropertyName:[()=>`${I}${g?"."+g:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,c,z)=>{const M=n(b,z,I,g);return new e.Vector2(null===M||void 0===M?void 0:M.uScale,null===M||void 0===M?void 0:M.vScale)},getTarget:G,set:(b,e,c,z)=>{const M=n(e,z,I,g);M.uScale=b.x,M.vScale=b.y},getPropertyName:[()=>`${I}${g?"."+g:""}.uScale`,()=>`${I}${g?"."+g:""}.vScale`]}}}const p={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:I=>{var g,b;return new e.Vector2((null===(g=I._babylonCamera)||void 0===g?void 0:g.orthoLeft)??0,(null===(b=I._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.orthoLeft=I.x,g._babylonCamera.orthoRight=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:I=>{var g,b;return new e.Vector2((null===(g=I._babylonCamera)||void 0===g?void 0:g.orthoBottom)??0,(null===(b=I._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.orthoBottom=I.x,g._babylonCamera.orthoTop=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.maxZ},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.cb},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.cb=I)},getTarget:I=>I,getPropertyName:[()=>"cb"]}},perspective:{aspectRatio:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.getEngine().getAspectRatio(I._babylonCamera)},getTarget:I=>I,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.fov},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.fov=I)},getTarget:I=>I,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.maxZ},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var g;return null===(g=I._babylonCamera)||void 0===g?void 0:g.cb},set:(I,g)=>{g._babylonCamera&&(g._babylonCamera.cb=I)},getTarget:I=>I,getPropertyName:[()=>"cb"]}}}},nodes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vg",get:I=>{var g;return null===(g=I._babylonTransformNode)||void 0===g?void 0:g.position},set:(I,g)=>{var b;return null===(b=g._babylonTransformNode)||void 0===b?void 0:b.position.G(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:I=>{var g;return null===(g=I._babylonTransformNode)||void 0===g?void 0:g.rotationQuaternion},set:(I,g)=>{var b,e;return null===(b=g._babylonTransformNode)||void 0===b||null===(e=b.rotationQuaternion)||void 0===e?void 0:e.G(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vg",get:I=>{var g;return null===(g=I._babylonTransformNode)||void 0===g?void 0:g.pb},set:(I,g)=>{var b;return null===(b=g._babylonTransformNode)||void 0===b?void 0:b.pb.G(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pb"]},weights:{length:{type:"number",get:I=>I._numMorphTargets,getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(I,g)=>{var b,e;return void 0!==g?null===(b=I._primitiveBabylonMeshes)||void 0===b||null===(e=b[0].morphTargetManager)||void 0===e?void 0:e.getTarget(g).influence:void 0},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(I,g)=>[0],getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:I=>{var g,b,c;return e.Matrix.Compose(null===(g=I._babylonTransformNode)||void 0===g?void 0:g.pb,null===(b=I._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(c=I._babylonTransformNode)||void 0===c?void 0:c.position)},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:I=>{var g,b,c,z;const M=e.Matrix.Identity();let J=I.parent;for(;J&&J.parent;)J=J.parent;const o=(null===(g=I._babylonTransformNode)||void 0===g?void 0:g.position._isDirty)||(null===(b=I._babylonTransformNode)||void 0===b||null===(c=b.rotationQuaternion)||void 0===c?void 0:c._isDirty)||(null===(z=I._babylonTransformNode)||void 0===z?void 0:z.pb._isDirty);if(J){var n;const g=null===(n=J._babylonTransformNode)||void 0===n?void 0:n.Mb(!0).invert();var G,D;if(g)null===(G=I._babylonTransformNode)||void 0===G||null===(D=G.Mb(o))||void 0===D||D.multiplyToRef(g,M)}else I._babylonTransformNode&&M.G(I._babylonTransformNode.Mb(o));return M},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:I=>{var g,b;return null===(g=I._babylonTransformNode)||void 0===g||null===(b=g.getChildren((I=>I instanceof M.d),!0)[0])||void 0===b?void 0:b.Xb},getTarget:I=>{var g;return null===(g=I._babylonTransformNode)||void 0===g?void 0:g.getChildren((I=>I instanceof M.d),!0)[0]},set:(I,g)=>{if(g._babylonTransformNode){const b=g._babylonTransformNode.getChildren((I=>I instanceof M.d),!0)[0];b&&(b.Xb=I)}}},color:{type:"Eg",get:I=>{var g,b;return null===(g=I._babylonTransformNode)||void 0===g||null===(b=g.getChildren((I=>I instanceof M.d),!0)[0])||void 0===b?void 0:b.Rb},getTarget:I=>{var g;return null===(g=I._babylonTransformNode)||void 0===g?void 0:g.getChildren((I=>I instanceof M.d),!0)[0]},set:(I,g)=>{if(g._babylonTransformNode){const b=g._babylonTransformNode.getChildren((I=>I instanceof M.d),!0)[0];b&&(b.Rb=I)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Eg",get:(I,g,b)=>G(I,g,b).emissiveColor,set:(I,g,b,e)=>G(g,b,e).emissiveColor.G(I),getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:D("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(I,g,b)=>{var e;return null===(e=n(I,b,"bumpTexture"))||void 0===e?void 0:e.level},set:(I,g,b,e)=>{const c=n(g,e,"bumpTexture");c&&(c.level=I)},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:D("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(I,g,b)=>G(I,g,b).ambientTextureStrength,set:(I,g,b,e)=>{const c=G(g,b,e);c&&(c.ambientTextureStrength=I)},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:D("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Sb",get:(I,g,b)=>{const e=G(I,g,b);return z.Sb.FromColor3(e.albedoColor,e.alpha)},set:(I,g,b,e)=>{const c=G(g,b,e);c.albedoColor.set(I.r,I.g,I.b),c.alpha=I.a},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:D("albedoTexture")}},metallicFactor:{type:"number",get:(I,g,b)=>G(I,g,b).metallic,set:(I,g,b,e)=>{const c=G(g,b,e);c&&(c.metallic=I)},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(I,g,b)=>G(I,g,b).roughness,set:(I,g,b,e)=>{const c=G(g,b,e);c&&(c.roughness=I)},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:D("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(I,g,b)=>G(I,g,b).anisotropy.Xb,set:(I,g,b,e)=>{G(g,b,e).anisotropy.Xb=I},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(I,g,b)=>G(I,g,b).anisotropy.angle,set:(I,g,b,e)=>{G(g,b,e).anisotropy.angle=I},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:D("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(I,g,b)=>G(I,g,b).clearCoat.Xb,set:(I,g,b,e)=>{G(g,b,e).clearCoat.Xb=I},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(I,g,b)=>G(I,g,b).clearCoat.roughness,set:(I,g,b,e)=>{G(g,b,e).clearCoat.roughness=I},getTarget:(I,g,b)=>G(I,g,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:D("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(I,g,b)=>{var e;return null===(e=G(I,g,b).clearCoat.bumpTexture)||void 0===e?void 0:e.level},getTarget:G,set:(I,g,b,e)=>G(g,b,e).clearCoat.bumpTexture.level=I},extensions:{KHR_texture_transform:D("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:D("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(I,g,b)=>G(I,g,b).subSurface.dispersion,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.dispersion=I}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(I,g,b)=>G(I,g,b).emissiveIntensity,getTarget:G,set:(I,g,b,e)=>G(g,b,e).emissiveIntensity=I}},KHR_materials_ior:{ior:{type:"number",get:(I,g,b)=>G(I,g,b).indexOfRefraction,getTarget:G,set:(I,g,b,e)=>G(g,b,e).indexOfRefraction=I}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(I,g,b)=>G(I,g,b).iridescence.Xb,getTarget:G,set:(I,g,b,e)=>G(g,b,e).iridescence.Xb=I},iridescenceIor:{type:"number",get:(I,g,b)=>G(I,g,b).iridescence.indexOfRefraction,getTarget:G,set:(I,g,b,e)=>G(g,b,e).iridescence.indexOfRefraction=I},iridescenceTexture:{extensions:{KHR_texture_transform:D("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(I,g,b)=>G(I,g,b).iridescence.maximumThickness,getTarget:G,set:(I,g,b,e)=>G(g,b,e).iridescence.maximumThickness=I},iridescenceThicknessMinimum:{type:"number",get:(I,g,b)=>G(I,g,b).iridescence.minimumThickness,getTarget:G,set:(I,g,b,e)=>G(g,b,e).iridescence.minimumThickness=I},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:D("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Eg",get:(I,g,b)=>G(I,g,b).sheen.color,getTarget:G,set:(I,g,b,e)=>G(g,b,e).sheen.color.G(I)},sheenColorTexture:{extensions:{KHR_texture_transform:D("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(I,g,b)=>G(I,g,b).sheen.Xb,getTarget:G,set:(I,g,b,e)=>G(g,b,e).sheen.Xb=I},sheenRoughnessTexture:{extensions:{KHR_texture_transform:D("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(I,g,b)=>G(I,g,b).metallicF0Factor,getTarget:G,set:(I,g,b,e)=>G(g,b,e).metallicF0Factor=I,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Eg",get:(I,g,b)=>G(I,g,b).metallicReflectanceColor,getTarget:G,set:(I,g,b,e)=>G(g,b,e).metallicReflectanceColor.G(I),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:D("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:D("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(I,g,b)=>G(I,g,b).subSurface.refractionIntensity,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.refractionIntensity=I,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:D("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(I,g,b)=>G(I,g,b).subSurface.translucencyIntensity,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.translucencyIntensity=I},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:D("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Eg",get:(I,g,b)=>G(I,g,b).subSurface.translucencyColor,getTarget:G,set:(I,g,b,e)=>{var c;return I&&(null===(c=G(g,b,e).subSurface.translucencyColor)||void 0===c?void 0:c.G(I))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:D("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Eg",get:(I,g,b)=>G(I,g,b).subSurface.tintColor,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.tintColor.G(I)},attenuationDistance:{type:"number",get:(I,g,b)=>G(I,g,b).subSurface.tintColorAtDistance,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.tintColorAtDistance=I},thicknessFactor:{type:"number",get:(I,g,b)=>G(I,g,b).subSurface.maximumThickness,getTarget:G,set:(I,g,b,e)=>G(g,b,e).subSurface.maximumThickness=I},thicknessTexture:{extensions:{KHR_texture_transform:D("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,color:{type:"Eg",get:I=>{var g;return null===(g=I._babylonLight)||void 0===g?void 0:g.Rb},set:(I,g)=>{var b;return null===(b=g._babylonLight)||void 0===b?void 0:b.Rb.G(I)},getTarget:I=>I._babylonLight,getPropertyName:[I=>"diffuse"]},Xb:{type:"number",get:I=>{var g;return null===(g=I._babylonLight)||void 0===g?void 0:g.Xb},set:(I,g)=>g._babylonLight?g._babylonLight.Xb=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"intensity"]},range:{type:"number",get:I=>{var g;return null===(g=I._babylonLight)||void 0===g?void 0:g.range},set:(I,g)=>g._babylonLight?g._babylonLight.range=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"range"]},spot:{innerConeAngle:{type:"number",get:I=>{var g;return null===(g=I._babylonLight)||void 0===g?void 0:g.innerAngle},set:(I,g)=>g._babylonLight?g._babylonLight.innerAngle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"innerConeAngle"]},outerConeAngle:{type:"number",get:I=>{var g;return null===(g=I._babylonLight)||void 0===g?void 0:g.angle},set:(I,g)=>g._babylonLight?g._babylonLight.angle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTexture)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,Xb:{type:"number",get:I=>{var g;return null===(g=I._babylonTexture)||void 0===g?void 0:g.level},set:(I,g)=>{g._babylonTexture&&(g._babylonTexture.level=I)},getTarget:I=>I._babylonTexture},rotation:{type:"Quaternion",get:I=>{var g;return I._babylonTexture&&e.Quaternion.FromRotationMatrix(null===(g=I._babylonTexture)||void 0===g?void 0:g.getReflectionTextureMatrix())},set:(I,g)=>{var b;g._babylonTexture&&(null!==(b=g._babylonTexture.EI())&&void 0!==b&&b.useRightHandedSystem||(I=e.Quaternion.Inverse(I)),e.Matrix.FromQuaternionToRef(I,g._babylonTexture.getReflectionTextureMatrix()))},getTarget:I=>I._babylonTexture}}}}},animations:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>{var g;return null===(g=I.primitives[0]._instanceData)||void 0===g?void 0:g.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function x(I){return new o(I,p)}function Z(I){const g=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let b=p;for(const e of g)e&&(b=b[e]);if(b&&b.type&&b.get)return b}function k(I,g){const b=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let e=p;for(const c of b)c&&(e=e[c]);e&&e.type&&e.get&&(e.interpolation=g)}function S(I,g){const b=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let e=p;for(const c of b)if(c){if(!e[c]){if("?"===c){e.__ignoreObjectTree__=!0;continue}e[c]={},"__array__"===c&&(e[c].__target__=!0)}e=e[c]}Object.assign(e,g)}},14230:(I,g,b)=>{"use strict";b.r(g),b.d(g,{AnimationPropertyInfo:()=>n,TransformNodeAnimationPropertyInfo:()=>G,WeightAnimationPropertyInfo:()=>D,getQuaternion:()=>J,getVector3:()=>M,getWeights:()=>o});var e=b(13097),c=b(12590),z=b(14221);function M(I,g,b,e){return c.Vg.mb(g,b).scaleInPlace(e)}function J(I,g,b,e){return c.Quaternion.mb(g,b).scaleInPlace(e)}function o(I,g,b,e){const c=new Array(I._numMorphTargets);for(let z=0;z<c.length;z++)c[z]=g[b++]*e;return c}class n{constructor(I,g,b,e){this.type=I,this.name=g,this.getValue=b,this.getStride=e}_buildAnimation(I,g,b){const c=new e.e(I,this.name,g,this.type);return c.setKeys(b),c}}class G extends n{buildAnimations(I,g,b,e){const c=[];return c.push({babylonAnimatable:I._babylonTransformNode,babylonAnimation:this._buildAnimation(g,b,e)}),c}}class D extends n{buildAnimations(I,g,b,c){const z=[];if(I._numMorphTargets)for(let M=0;M<I._numMorphTargets;M++){const J=new e.e(`${g}_${M}`,this.name,b,this.type);if(J.setKeys(c.map((I=>({frame:I.frame,inTangent:I.inTangent?I.inTangent[M]:void 0,value:I.value[M],outTangent:I.outTangent?I.outTangent[M]:void 0,interpolation:I.interpolation})))),I._primitiveBabylonMeshes)for(const g of I._primitiveBabylonMeshes)if(g.morphTargetManager){const I=g.morphTargetManager.getTarget(M),b=J.clone();I.animations.push(b),z.push({babylonAnimatable:I,babylonAnimation:b})}}return z}}(0,z.l)("/nodes/{}/translation",[new G(e.e.ANIMATIONTYPE_VECTOR3,"position",M,(()=>3))]),(0,z.l)("/nodes/{}/rotation",[new G(e.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",J,(()=>4))]),(0,z.l)("/nodes/{}/scale",[new G(e.e.ANIMATIONTYPE_VECTOR3,"pb",M,(()=>3))]),(0,z.l)("/nodes/{}/weights",[new D(e.e.ANIMATIONTYPE_FLOAT,"influence",o,(I=>I._numMorphTargets))])},14188:(I,g,b)=>{"use strict";class e{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((I,g)=>{this._resolve=I,this._reject=g}))}}var c=b(12590),z=b(12637),M=b(12409),J=b(13031),o=b(14193),n=b(14198),G=b(12412),D=b(13050),p=b(13097),x=b(13104),Z=b(12449),k=b(12420),S=b(12426);class f{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(I){this._useTextureToStoreBoneMatrices=I,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(I){this._animationPropertiesOverride=I}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(I,g,b){this.name=I,this.id=g,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=c.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new G.c,this.bones=[],this._scene=b||Z.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const e=this._scene.getEngine().getCaps();this._canUseTextureForBones=e.textureFloat&&e.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((I=>!I.getParent()))}getTransformMatrices(I){if(this.needInitialSkinMatrix){if(!I)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return I._bonesTransformMatrices||this.prepare(!0),I._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(I){return this.needInitialSkinMatrix&&I._transformMatrixTexture?I._transformMatrixTexture:this._transformMatrixTexture}EI(){return this._scene}toString(I){let g=`Name: ${this.name}, nBones: ${this.bones.length}`;if(g+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,I){g+=", Ranges: {";let I=!0;for(const b in this._ranges)I&&(g+=", ",I=!1),g+=b;g+="}"}return g}getBoneIndexByName(I){for(let g=0,b=this.bones.length;g<b;g++)if(this.bones[g].name===I)return g;return-1}createAnimationRange(I,g,b){if(!this._ranges[I]){this._ranges[I]=new x.d(I,g,b);for(let e=0,c=this.bones.length;e<c;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(I,g,b)}}deleteAnimationRange(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,e=this.bones.length;b<e;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(I,g);this._ranges[I]=null}getAnimationRange(I){return this._ranges[I]||null}getAnimationRanges(){const I=[];let g;for(g in this._ranges)I.push(this._ranges[g]);return I}copyAnimationRange(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[g]||!I.getAnimationRange(g))return!1;let e=!0;const c=this._getHighestAnimationFrame()+1,z={},M=I.bones;let J,o;for(o=0,J=M.length;o<J;o++)z[M[o].name]=M[o];this.bones.length!==M.length&&(k.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${M.length}`),e=!1);const n=b&&this.dimensionsAtRest&&I.dimensionsAtRest?this.dimensionsAtRest.divide(I.dimensionsAtRest):null;for(o=0,J=this.bones.length;o<J;o++){const I=this.bones[o].name,M=z[I];M?e=e&&this.bones[o].copyAnimationRange(M,g,c,b,n):(k.b.Warn("copyAnimationRange: not same rig, missing source bone "+I),e=!1)}const G=I.getAnimationRange(g);return G&&(this._ranges[g]=new x.d(g,G.from+c,G.to+c)),e}returnToRest(){for(const I of this.bones)-1!==I._index&&I.returnToRest()}_getHighestAnimationFrame(){let I=0;for(let g=0,b=this.bones.length;g<b;g++)if(this.bones[g].animations[0]){const b=this.bones[g].animations[0].getHighestFrame();I<b&&(I=b)}return I}beginAnimation(I,g,b,e){const c=this.getAnimationRange(I);return c?this._scene.beginAnimation(this,c.from,c.to,g,b,e):null}static MakeAnimationAdditive(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const e=I.getAnimationRange(b);if(!e)return null;const c=I._scene.getAllAnimatablesByTarget(I);let z=null;for(let J=0;J<c.length;J++){const I=c[J];if(I.fromFrame===(null===e||void 0===e?void 0:e.from)&&I.toFrame===(null===e||void 0===e?void 0:e.to)){z=I;break}}const M=I.getAnimatables();for(let J=0;J<M.length;J++){const I=M[J].animations;if(I)for(let e=0;e<I.length;e++)p.e.MakeAnimationAdditive(I[e],g,b)}return z&&(z.isAdditive=!0),I}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(I){this._meshesWithPoseMatrix.push(I)}_unregisterMeshWithPoseMatrix(I){const g=this._meshesWithPoseMatrix.indexOf(I);g>-1&&this._meshesWithPoseMatrix.splice(g,1)}_computeTransformMatrices(I,g){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const e=this.bones[b];e._childUpdateId++;const c=e.getParent();if(c?e.getLocalMatrix().multiplyToRef(c.getFinalMatrix(),e.getFinalMatrix()):g?e.getLocalMatrix().multiplyToRef(g,e.getFinalMatrix()):e.getFinalMatrix().G(e.getLocalMatrix()),-1!==e._index){const g=null===e._index?b:e._index;e.getAbsoluteInverseBindMatrix().multiplyToArray(e.getFinalMatrix(),I,16*g)}}this._identity.copyToArray(I,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const I=this.EI().getRenderId();if(this._currentRenderId===I)return;this._currentRenderId=I}if(this._numBonesWithLinkedTransformNode>0)for(const I of this.bones)if(I._linkedTransformNode){const g=I._linkedTransformNode;I.position=g.position,g.rotationQuaternion?I.rotationQuaternion=g.rotationQuaternion:I.rotation=g.rotation,I.pb=g.pb}if(this.needInitialSkinMatrix)for(const I of this._meshesWithPoseMatrix){const g=I.getPoseMatrix();let b=this._isDirty;if(I._bonesTransformMatrices&&I._bonesTransformMatrices.length===16*(this.bones.length+1)||(I._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==I){this._synchronizedWithMesh=I;for(const I of this.bones)if(!I.getParent()){I.getBindMatrix().multiplyToRef(g,c.TmpVectors.Matrix[1]),I._updateAbsoluteBindMatrices(c.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const g=4*(this.bones.length+1);I._transformMatrixTexture&&I._transformMatrixTexture.getSize().width===g||(I._transformMatrixTexture&&I._transformMatrixTexture.dispose(),I._transformMatrixTexture=D.b.CreateRGBATexture(I._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(I._bonesTransformMatrices,g),this.isUsingTextureForMatrices&&I._transformMatrixTexture&&I._transformMatrixTexture.update(I._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=D.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let I=0;I<this.bones.length;I++)this._animatables.push(this.bones[I])}return this._animatables}clone(I,g){const b=new f(I,g||I,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const I=this.bones[e];let g=null;const c=I.getParent();if(c){const I=this.bones.indexOf(c);g=b.bones[I]}const z=new n.e(I.name,b,g,I.getBindMatrix().clone(),I.getRestMatrix().clone());z._index=I._index,I._linkedTransformNode&&z.linkTransformNode(I._linkedTransformNode),S.b.DeepCopy(I.animations,z.animations)}if(this._ranges){b._ranges={};for(const I in this._ranges){const g=this._ranges[I];g&&(b._ranges[I]=g.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const g of this.bones)for(const b of g.animations)b.enableBlending=!0,b.blendingSpeed=I}dispose(){if(this._meshesWithPoseMatrix.length=0,this.EI().stopAnimation(this),this.EI().removeSkeleton(this),this._parentContainer){const I=this._parentContainer.skeletons.indexOf(this);I>-1&&this._parentContainer.skeletons.splice(I,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const I={};I.name=this.name,I.id=this.id,this.dimensionsAtRest&&(I.dimensionsAtRest=this.dimensionsAtRest.bb()),I.bones=[],I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var g;const e=this.bones[b],c=e.getParent(),z={parentBoneIndex:c?this.bones.indexOf(c):-1,index:e.getIndex(),name:e.name,id:e.id,matrix:e.getBindMatrix().bb(),rest:e.getRestMatrix().bb(),linkedTransformNodeId:null===(g=e.getTransformNode())||void 0===g?void 0:g.id};I.bones.push(z),e.length&&(z.length=e.length),e.metadata&&(z.metadata=e.metadata),e.animations&&e.animations.length>0&&(z.animation=e.animations[0].serialize()),I.ranges=[];for(const g in this._ranges){const b=this._ranges[g];if(!b)continue;const e={};e.name=g,e.from=b.from,e.to=b.to,I.ranges.push(e)}}return I}static Parse(I,g){const b=new f(I.name,I.id,g);let e;for(I.dimensionsAtRest&&(b.dimensionsAtRest=c.Vg.mb(I.dimensionsAtRest)),b.needInitialSkinMatrix=I.needInitialSkinMatrix,e=0;e<I.bones.length;e++){const g=I.bones[e],z=I.bones[e].index;let M=null;g.parentBoneIndex>-1&&(M=b.bones[g.parentBoneIndex]);const J=g.rest?c.Matrix.mb(g.rest):null,o=new n.e(g.name,b,M,c.Matrix.mb(g.matrix),J,null,z);void 0!==g.id&&null!==g.id&&(o.id=g.id),g.length&&(o.length=g.length),g.metadata&&(o.metadata=g.metadata),g.animation&&o.animations.push(p.e.Parse(g.animation)),void 0!==g.linkedTransformNodeId&&null!==g.linkedTransformNodeId&&(b._hasWaitingData=!0,o._waitingTransformNodeId=g.linkedTransformNodeId)}if(I.ranges)for(e=0;e<I.ranges.length;e++){const g=I.ranges[e];b.createAnimationRange(g.name,g.from,g.to)}return b}computeAbsoluteMatrices(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||I)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(I)}getPoseMatrix(){let I=null;return this._meshesWithPoseMatrix.length>0&&(I=this._meshesWithPoseMatrix[0].getPoseMatrix()),I}sortBones(){const I=[],g=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,I,g);this.bones=I}_sortBones(I,g,b){if(b[I])return;b[I]=!0;const e=this.bones[I];if(!e)return;void 0===e._index&&(e._index=I);const c=e.getParent();c&&this._sortBones(this.bones.indexOf(c),g,b),g.push(e)}setCurrentPoseAsRest(){for(const I of this.bones)I.setCurrentPoseAsRest()}}var V=b(12901),a=b(13068),v=b(12572),X=b(12995),R=b(12659),E=b(13037),mI=b(13006),s=b(13027),F=b(13109),Y=b(12682),d=b(14152);class C{set areUpdatesFrozen(I){I?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Y.i(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,I||(I=Z.b.LastCreatedScene),this._scene=I,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const I=this._scene.getEngine().getCaps();this._canUseTextureForTargets=I.canUseGLVertexID&&I.textureFloat&&I.maxVertexTextureImageUnits>0&&I.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return C.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?C.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(I){this._numMaxInfluencers!==I&&(this._numMaxInfluencers=I,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(I){this._useTextureToStoreTargets!==I&&(this._useTextureToStoreTargets=I,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var I;return C.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(I=this._scene)&&void 0!==I&&I.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(I){return this._activeTargets.data[I]}getTarget(I){return this._targets[I]}getTargetByName(I){for(const g of this._targets)if(g.name===I)return g;return null}addTarget(I){this._targets.push(I),this._targetInfluenceChangedObservers.push(I.onInfluenceChanged.add((I=>{this.areUpdatesFrozen&&I&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(I)}))),this._targetDataLayoutChangedObservers.push(I._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(I){const g=this._targets.indexOf(I);g>=0&&(this._targets.splice(g,1),I.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(g,1)[0]),I._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(g,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(I)}_bind(I){I.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),I.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),I.setTexture("morphTargets",this._targetStoreTexture),I.setInt("morphTargetCount",this.numInfluencers)}clone(){const I=new C(this._scene);for(const g of this._targets)I.addTarget(g.clone());return I.enablePositionMorphing=this.enablePositionMorphing,I.enableNormalMorphing=this.enableNormalMorphing,I.enableTangentMorphing=this.enableTangentMorphing,I.enableUVMorphing=this.enableUVMorphing,I.enableUV2Morphing=this.enableUV2Morphing,I.enableColorMorphing=this.enableColorMorphing,I}serialize(){const I={};I.id=this.uniqueId,I.targets=[];for(const g of this._targets)I.targets.push(g.serialize());return I}_syncActiveTargets(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const g=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||g!==b)&&(this._mustSynchronize=!1,this.synchronize());let e=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let c=-1;for(const z of this._targets)if(c++,0!==z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=C.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[e]=c,this._tempInfluences[e++]=z.influence}this._morphTargetTextureIndices.length!==e&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,e)),this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(let z=0;z<e;z++)this._influences[z]=this._tempInfluences[z];if(I&&this._scene)for(const z of this._scene.meshes)z.morphTargetManager===this&&(b?z._markSubMeshesAsAttributesDirty():z._syncGeometryWithMorphTargetManager())}synchronize(){var I;if(!this._scene||this.areUpdatesFrozen)return;const g=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(I=this._targetStoreTexture)||void 0===I||I.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>g.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const I=b.vertexCount;if(0===this._vertexCount)this._vertexCount=I;else if(this._vertexCount!==I)return void k.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${I}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const I=g.getCaps().maxTextureSize;this._textureWidth>I&&(this._textureHeight=Math.ceil(this._textureWidth/I),this._textureWidth=I);const b=this._targets.length,e=new Float32Array(b*this._textureWidth*this._textureHeight*4);let c=0;for(let g=0;g<b;g++){const I=this._targets[g],b=I.getPositions(),z=I.getNormals(),M=I.getUVs(),J=I.getTangents(),o=I.getUV2s(),n=I.getColors();c=g*this._textureWidth*this._textureHeight*4;for(let g=0;g<this._vertexCount;g++)this._supportsPositions&&b&&(e[c]=b[3*g],e[c+1]=b[3*g+1],e[c+2]=b[3*g+2],c+=4),this._supportsNormals&&z&&(e[c]=z[3*g],e[c+1]=z[3*g+1],e[c+2]=z[3*g+2],c+=4),this._supportsUVs&&M&&(e[c]=M[2*g],e[c+1]=M[2*g+1],c+=4),this._supportsTangents&&J&&(e[c]=J[3*g],e[c+1]=J[3*g+1],e[c+2]=J[3*g+2],c+=4),this._supportsUV2s&&o&&(e[c]=o[2*g],e[c+1]=o[2*g+1],c+=4),this._supportsColors&&n&&(e[c]=n[4*g],e[c+1]=n[4*g+1],e[c+2]=n[4*g+2],e[c+3]=n[4*g+3],c+=4)}this._targetStoreTexture=d.e.CreateRGBATexture(e,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const I=this._parentContainer.morphTargetManagers.indexOf(this);I>-1&&this._parentContainer.morphTargetManagers.splice(I,1),this._parentContainer=null}for(const I of this._targets)this._scene.stopAnimation(I)}}static Parse(I,g){const b=new C(g);for(const e of I.targets)b.addTarget(F.c.Parse(e,g));return b}}C.EnableTextureStorage=!0,C.MaxActiveMorphTargetsInVertexAttributeMode=8,C.ConstantTargetCountForTextureMode=0;var r=b(14207),O=b(12456),H=b(12916);const i=new Map,U=i;function h(I,g,b){A(I)&&k.b.Warn(`Extension with the name '${I}' already exists`),i.set(I,{isGLTFExtension:g,factory:b})}function A(I){return i.delete(I)}var j=b(14221),Q=b(13158),L=b(12670);class N{static Get(I,g,b){if(!g||void 0==b||!g[b])throw new Error(`${I}: Failed to find index (${b})`);return g[b]}static TryGet(I,g){return I&&void 0!=g&&I[g]?I[g]:null}static Assign(I){if(I)for(let g=0;g<I.length;g++)I[g].index=g}}function K(I){if(I.min&&I.max){const g=I.min,b=I.max,e=c.TmpVectors.Vg[0].Db(g[0],g[1],g[2]),z=c.TmpVectors.Vg[1].Db(b[0],b[1],b[2]);if(I.normalized&&5126!==I.componentType){let g=1;switch(I.componentType){case 5120:g=127;break;case 5121:g=255;break;case 5122:g=32767;break;case 5123:g=65535}const b=1/g;e.scaleInPlace(b),z.scaleInPlace(b)}return new H.d(e,z)}return null}class B{static RegisterExtension(I,g){h(I,!1,g)}static UnregisterExtension(I){return A(I)}get Lg(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(I){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=I}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((I=>I.dispose&&I.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(I,g,b,e,c,z){let M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=g,this._assetContainer=b,this._loadData(e);let z=null;if(I){const g={};if(this._gltf.nodes)for(const I of this._gltf.nodes)I.name&&(g[I.name]=I.index);z=(I instanceof Array?I:[I]).map((I=>{const b=g[I];if(void 0===b)throw new Error(`Failed to find node '${I}'`);return b}))}return await this._loadAsync(c,M,z,(()=>({meshes:this._getMeshes(),Ax:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=I,this._loadData(g),await this._loadAsync(b,c,null,(()=>{}))}async _loadAsync(I,g,b,e){return await Promise.resolve().then((async()=>{this._rootUrl=I,this._uniqueRootUrl=!I.startsWith("file:")&&g?I:`${I}${Date.now()}/`,this._fileName=g,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const c=`${r.l[r.l.LOADING]} => ${r.l[r.l.READY]}`,z=`${r.l[r.l.LOADING]} => ${r.l[r.l.COMPLETE]}`;this._parent._startPerformanceCounter(c),this._parent._startPerformanceCounter(z),this._parent._setState(r.l.LOADING),this._extensionsOnLoading();const J=new Array;if(!this.parent.loadOnlyMaterials)if(b)J.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.Xg||this._gltf.scenes&&this._gltf.scenes[0]){const I=N.Get("/scene",this._gltf.scenes,this._gltf.Xg||0);J.push(this.loadSceneAsync(`/scenes/${I.index}`,I))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let I=0;I<this._gltf.materials.length;++I){const g=this._gltf.materials[I],b="/materials/"+I,e=V.b.TriangleFillMode;J.push(this._loadMaterialAsync(b,g,null,e,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&J.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&J.push(this._compileShadowGeneratorsAsync());const o=Promise.all(J).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.tz(!0);for(const I of this._babylonScene.materials){const g=I;void 0!==g.maxSimultaneousLights&&(g.maxSimultaneousLights=Math.max(g.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(r.l.READY),this._skipStartAnimationStep||this._startAnimations(),e()}));return await o.then((I=>(this._parent._endPerformanceCounter(c),M.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(z),this._parent._setState(r.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(I=>{this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()}))})),I)))})).catch((I=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()),I}))}_loadData(I){if(this._gltf=I.json,this._setupData(),I.bin){const g=this._gltf.buffers;if(g&&g[0]&&!g[0].uri){const b=g[0];(b.byteLength<I.bin.byteLength-3||b.byteLength>I.bin.byteLength)&&k.b.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${I.bin.byteLength})`),this._bin=I.bin}else k.b.Warn("Unexpected BIN chunk")}}_setupData(){if(N.Assign(this._gltf.accessors),N.Assign(this._gltf.animations),N.Assign(this._gltf.buffers),N.Assign(this._gltf.bufferViews),N.Assign(this._gltf.cameras),N.Assign(this._gltf.images),N.Assign(this._gltf.materials),N.Assign(this._gltf.meshes),N.Assign(this._gltf.nodes),N.Assign(this._gltf.samplers),N.Assign(this._gltf.scenes),N.Assign(this._gltf.skins),N.Assign(this._gltf.textures),this._gltf.nodes){const I={};for(const b of this._gltf.nodes)if(b.children)for(const g of b.children)I[g]=b.index;const g=this._createRootNode();for(const b of this._gltf.nodes){const e=I[b.index];b.parent=void 0===e?g:this._gltf.nodes[e]}}}async _loadExtensionsAsync(){const I=[];if(U.forEach(((g,b)=>{var e;!1===(null===(e=this.parent.extensionOptions[b])||void 0===e?void 0:e.enabled)?g.isGLTFExtension&&this.isExtensionUsed(b)&&k.b.Warn(`Extension ${b} is used but has been explicitly disabled.`):g.isGLTFExtension&&!this.isExtensionUsed(b)||I.push((async()=>{const I=await g.factory(this);return I.name!==b&&k.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${I.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(I),I})())})),this._extensions.push(...await Promise.all(I)),this._extensions.sort(((I,g)=>(I.order||Number.MAX_VALUE)-(g.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((I=>I.name===b&&I.enabled))){var g;if(!1===(null===(g=this.parent.extensionOptions[b])||void 0===g?void 0:g.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new s.e("__root__",this._babylonScene);this._rootBabylonMesh=I,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.tz(!1);const g={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case r.k.AUTO:this._babylonScene.useRightHandedSystem||(g.rotation=[0,1,0,0],g.scale=[1,1,-1],B._LoadTransform(g,this._rootBabylonMesh));break;case r.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(I),g}loadSceneAsync(I,g){const b=this._extensionsLoadSceneAsync(I,g);if(b)return b;const e=new Array;if(this.logOpen(`${I} ${g.name||""}`),g.nodes)for(const c of g.nodes){const g=N.Get(`${I}/nodes/${c}`,this._gltf.nodes,c);e.push(this.loadNodeAsync(`/nodes/${g.index}`,g,(I=>{I.parent=this._rootBabylonMesh})))}for(const c of this._postSceneLoadActions)c();return e.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(e).then((()=>{}))}_forEachPrimitive(I,g){if(I._primitiveBabylonMeshes)for(const b of I._primitiveBabylonMeshes)g(b)}_getGeometries(){const I=[],g=this._gltf.nodes;if(g)for(const b of g)this._forEachPrimitive(b,(g=>{const b=g.ob;b&&-1===I.indexOf(b)&&I.push(b)}));return I}_getMeshes(){const I=[];this._rootBabylonMesh instanceof mI.e&&I.push(this._rootBabylonMesh);const g=this._gltf.nodes;if(g)for(const b of g)this._forEachPrimitive(b,(g=>{I.push(g)}));return I}_getTransformNodes(){const I=[],g=this._gltf.nodes;if(g)for(const b of g)b._babylonTransformNode&&"sb"===b._babylonTransformNode.getClassName()&&I.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&I.push(b._babylonTransformNodeForSkin);return I}_getSkeletons(){const I=[],g=this._gltf.skins;if(g)for(const b of g)b._data&&I.push(b._data.babylonSkeleton);return I}_getAnimationGroups(){const I=[],g=this._gltf.animations;if(g)for(const b of g)b._babylonAnimationGroup&&I.push(b._babylonAnimationGroup);return I}_startAnimations(){switch(this._parent.animationStartMode){case r.h.NONE:break;case r.h.FIRST:{const I=this._getAnimationGroups();0!==I.length&&I[0].start(!0);break}case r.h.ALL:{const I=this._getAnimationGroups();for(const g of I)g.start(!0);break}default:return void k.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadNodeAsync(I,g,b);if(e)return e;if(g._babylonTransformNode)throw new Error(`${I}: Invalid recursive node hierarchy`);const c=new Array;this.logOpen(`${I} ${g.name||""}`);const z=e=>{if(B.AddPointerMetadata(e,I),B._LoadTransform(g,e),void 0!=g.camera){const b=N.Get(`${I}/camera`,this._gltf.cameras,g.camera);c.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(I=>{I.parent=e,this._babylonScene.useRightHandedSystem||(e.pb.x=-1)})))}if(g.children)for(const b of g.children){const g=N.Get(`${I}/children/${b}`,this._gltf.nodes,b);c.push(this.loadNodeAsync(`/nodes/${g.index}`,g,(I=>{I.parent=e})))}b(e)},M=void 0!=g.mesh,J=this._parent.loadSkins&&void 0!=g.skin;if(!M||J){const I=g.name||`node${g.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new X.d(I,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==g.mesh?g._babylonTransformNode=b:g._babylonTransformNodeForSkin=b,z(b)}if(M)if(J){const b=N.Get(`${I}/mesh`,this._gltf.meshes,g.mesh);c.push(this._loadMeshAsync(`/meshes/${b.index}`,g,b,(b=>{const e=g._babylonTransformNodeForSkin;b.metadata=(0,Q.e)(e.metadata,b.metadata||{});const z=N.Get(`${I}/skin`,this._gltf.skins,g.skin);c.push(this._loadSkinAsync(`/skins/${z.index}`,g,z,(I=>{this._forEachPrimitive(g,(g=>{g.skeleton=I})),this._postSceneLoadActions.push((()=>{if(void 0!=z.skeleton){const I=N.Get(`/skins/${z.index}/skeleton`,this._gltf.nodes,z.skeleton).parent;g.index===I.index?b.parent=e.parent:b.parent=I._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:e,skinnedNode:b})}))})))})))}else{const b=N.Get(`${I}/mesh`,this._gltf.meshes,g.mesh);c.push(this._loadMeshAsync(`/meshes/${b.index}`,g,b,z))}return this.logClose(),Promise.all(c).then((()=>(this._forEachPrimitive(g,(I=>{const g=I;!g.isAnInstance&&g.ob&&g.ob.useBoundingInfoFromGeometry?I.HI():I.refreshBoundingInfo(!0,!0)})),g._babylonTransformNode)))}_loadMeshAsync(I,g,b,e){const c=b.primitives;if(!c||!c.length)throw new Error(`${I}: Primitives are missing`);void 0==c[0].index&&N.Assign(c);const z=new Array;this.logOpen(`${I} ${b.name||""}`);const M=g.name||`node${g.index}`;if(1===c.length){const e=b.primitives[0];z.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${e.index}`,M,g,b,e,(I=>{g._babylonTransformNode=I,g._primitiveBabylonMeshes=[I]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,g._babylonTransformNode=new X.d(M,this._babylonScene),g._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g._primitiveBabylonMeshes=[];for(const e of c)z.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${e.index}`,`${M}_primitive${e.index}`,g,b,e,(I=>{I.parent=g._babylonTransformNode,g._primitiveBabylonMeshes.push(I)})))}return e(g._babylonTransformNode),this.logClose(),Promise.all(z).then((()=>g._babylonTransformNode))}_loadMeshPrimitiveAsync(I,g,b,e,c,z){const M=this._extensionsLoadMeshPrimitiveAsync(I,g,b,e,c,z);if(M)return M;this.logOpen(`${I}`);const J=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!e.primitives[0].targets;let o,n;if(J&&c._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,o=c._instanceData.babylonSourceMesh.createInstance(g),o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n=c._instanceData.promise;else{const z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new s.e(g,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.sideOrientation=this._babylonScene.useRightHandedSystem?V.b.CounterClockWiseSideOrientation:V.b.ClockWiseSideOrientation,this._createMorphTargets(I,b,e,c,M),z.push(this._loadVertexDataAsync(I,c,M).then((async g=>await this._loadMorphTargetsAsync(I,c,M,g).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,g.rI(M),g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const G=B._GetDrawMode(I,c.mode);if(void 0==c.material){let I=this._defaultBabylonMaterialData[G];I||(I=this._createDefaultMaterial("__GLTFLoader._default",G),this._parent.onMaterialLoadedObservable.notifyObservers(I),this._defaultBabylonMaterialData[G]=I),M.material=I}else if(!this.parent.skipMaterials){const g=N.Get(`${I}/material`,this._gltf.materials,c.material);z.push(this._loadMaterialAsync(`/materials/${g.index}`,g,M,G,(I=>{M.material=I})))}n=Promise.all(z),J&&(c._instanceData={babylonSourceMesh:M,promise:n}),o=M}return B.AddPointerMetadata(o,I),this._parent.onMeshLoadedObservable.notifyObservers(o),z(o),this.logClose(),n.then((()=>o))}_loadVertexDataAsync(I,g,b){const e=this._extensionsLoadVertexDataAsync(I,g,b);if(e)return e;const c=g.attributes;if(!c)throw new Error(`${I}: Attributes are missing`);const z=new Array,M=new E.d(b.name,this._babylonScene);if(void 0==g.indices)b.isUnIndexed=!0;else{const b=N.Get(`${I}/indices`,this._gltf.accessors,g.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((I=>{M.setIndices(I)})))}const J=(g,e,J)=>{if(void 0==c[g])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(e)&&b._delayInfo.push(e);const o=N.Get(`${I}/attributes/${g}`,this._gltf.accessors,c[g]);z.push(this._loadVertexAccessorAsync(`/accessors/${o.index}`,o,e).then((I=>{if(I.getKind()===R.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const I=K(o);I&&(M._boundingInfo=I,M.useBoundingInfoFromGeometry=!0)}M.setVerticesBuffer(I,o.count)}))),e==R.f.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),J&&J(o)};return J("POSITION",R.f.PositionKind),J("NORMAL",R.f.NormalKind),J("TANGENT",R.f.TangentKind),J("TEXCOORD_0",R.f.UVKind),J("TEXCOORD_1",R.f.UV2Kind),J("TEXCOORD_2",R.f.UV3Kind),J("TEXCOORD_3",R.f.UV4Kind),J("TEXCOORD_4",R.f.UV5Kind),J("TEXCOORD_5",R.f.UV6Kind),J("JOINTS_0",R.f.MatricesIndicesKind),J("WEIGHTS_0",R.f.MatricesWeightsKind),J("JOINTS_1",R.f.MatricesIndicesExtraKind),J("WEIGHTS_1",R.f.MatricesWeightsExtraKind),J("COLOR_0",R.f.ColorKind,(I=>{"VEC4"===I.type&&(b.hasVertexAlpha=!0)})),Promise.all(z).then((()=>M))}_createMorphTargets(I,g,b,e,c){if(!e.targets||!this._parent.loadMorphTargets)return;if(void 0==g._numMorphTargets)g._numMorphTargets=e.targets.length;else if(e.targets.length!==g._numMorphTargets)throw new Error(`${I}: Primitives do not have the same number of targets`);const z=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,c.morphTargetManager=new C(this._babylonScene),c.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.morphTargetManager.areUpdatesFrozen=!0;for(let M=0;M<e.targets.length;M++){const I=g.weights?g.weights[M]:b.weights?b.weights[M]:0,e=z?z[M]:`morphTarget${M}`;c.morphTargetManager.addTarget(new F.c(e,I,c.EI()))}}_loadMorphTargetsAsync(I,g,b,e){if(!g.targets||!this._parent.loadMorphTargets)return Promise.resolve();const c=new Array,z=b.morphTargetManager;for(let M=0;M<z.numTargets;M++){const b=z.getTarget(M);c.push(this._loadMorphTargetVertexDataAsync(`${I}/targets/${M}`,e,g.targets[M],b))}return Promise.all(c).then((()=>{z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(I,g,b,e){const c=new Array,z=(e,z,M)=>{if(void 0==b[e])return;const J=g.getVertexBuffer(z);if(!J)return;const o=N.Get(`${I}/${e}`,this._gltf.accessors,b[e]);c.push(this._loadFloatAccessorAsync(`/accessors/${o.index}`,o).then((I=>{M(J,I)})))};return z("POSITION",R.f.PositionKind,((I,g)=>{const b=new Float32Array(g.length);I.forEach(g.length,((I,e)=>{b[e]=g[e]+I})),e.setPositions(b)})),z("NORMAL",R.f.NormalKind,((I,g)=>{const b=new Float32Array(g.length);I.forEach(b.length,((I,e)=>{b[e]=g[e]+I})),e.setNormals(b)})),z("TANGENT",R.f.TangentKind,((I,g)=>{const b=new Float32Array(g.length/3*4);let c=0;I.forEach(g.length/3*4,((I,e)=>{(e+1)%4!==0&&(b[c]=g[c]+I,c++)})),e.setTangents(b)})),z("TEXCOORD_0",R.f.UVKind,((I,g)=>{const b=new Float32Array(g.length);I.forEach(g.length,((I,e)=>{b[e]=g[e]+I})),e.setUVs(b)})),z("TEXCOORD_1",R.f.UV2Kind,((I,g)=>{const b=new Float32Array(g.length);I.forEach(g.length,((I,e)=>{b[e]=g[e]+I})),e.setUV2s(b)})),z("COLOR_0",R.f.ColorKind,((g,b)=>{let c=null;const z=g.getSize();if(3===z){c=new Float32Array(b.length/3*4),g.forEach(b.length,((I,g)=>{const e=Math.floor(g/3),z=g%3;c[4*e+z]=b[3*e+z]+I}));for(let I=0;I<b.length/3;++I)c[4*I+3]=1}else{if(4!==z)throw new Error(`${I}: Invalid number of components (${z}) for COLOR_0 attribute`);c=new Float32Array(b.length),g.forEach(b.length,((I,g)=>{c[g]=b[g]+I}))}e.setColors(c)})),await Promise.all(c).then((()=>{}))}static _LoadTransform(I,g){if(void 0!=I.skin)return;let b=c.Vg.Zero(),e=c.Quaternion.Identity(),z=c.Vg.One();if(I.matrix){c.Matrix.mb(I.matrix).decompose(z,e,b)}else I.translation&&(b=c.Vg.mb(I.translation)),I.rotation&&(e=c.Quaternion.mb(I.rotation)),I.scale&&(z=c.Vg.mb(I.scale));g.position=b,g.rotationQuaternion=e,g.pb=z}_loadSkinAsync(I,g,b,e){if(!this._parent.loadSkins)return Promise.resolve();const c=this._extensionsLoadSkinAsync(I,g,b);if(c)return c;if(b._data)return e(b._data.babylonSkeleton),b._data.promise;const z=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new f(b.name||z,z,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(I,b,M);const J=this._loadSkinInverseBindMatricesDataAsync(I,b).then((I=>{this._updateBoneMatrices(M,I)}));return b._data={babylonSkeleton:M,promise:J},e(M),J}_loadBones(I,g,b){if(void 0==g.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${I}/joints`,g.joints);if(b)if(void 0===g.skeleton)g.skeleton=b.index;else{const e=(I,g)=>{for(;g.parent;g=g.parent)if(g.parent===I)return!0;return!1},c=N.Get(`${I}/skeleton`,this._gltf.nodes,g.skeleton);c===b||e(c,b)||(k.b.Warn(`${I}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),g.skeleton=b.index)}else k.b.Warn(`${I}: Failed to find common root`)}const e={};for(const c of g.joints){const z=N.Get(`${I}/joints/${c}`,this._gltf.nodes,c);this._loadBone(z,g,b,e)}}_findSkeletonRootNode(I,g){if(0===g.length)return null;const b={};for(const c of g){const g=[];let e=N.Get(`${I}/${c}`,this._gltf.nodes,c);for(;-1!==e.index;)g.unshift(e),e=e.parent;b[c]=g}let e=null;for(let c=0;;++c){let I=b[g[0]];if(c>=I.length)return e;const z=I[c];for(let M=1;M<g.length;++M)if(I=b[g[M]],c>=I.length||z!==I[c])return e;e=z}}_loadBone(I,g,b,e){I._isJoint=!0;let c=e[I.index];if(c)return c;let z=null;I.index!==g.skeleton&&(I.parent&&-1!==I.parent.index?z=this._loadBone(I.parent,g,b,e):void 0!==g.skeleton&&k.b.Warn(`/skins/${g.index}/skeleton: Skeleton node is not a common root`));const M=g.joints.indexOf(I.index);return c=new n.e(I.name||`joint${I.index}`,b,z,this._getNodeMatrix(I),null,null,M),e[I.index]=c,this._postSceneLoadActions.push((()=>{c.linkTransformNode(I._babylonTransformNode)})),c}_loadSkinInverseBindMatricesDataAsync(I,g){if(void 0==g.inverseBindMatrices)return Promise.resolve(null);const b=N.Get(`${I}/inverseBindMatrices`,this._gltf.accessors,g.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(I,g){for(const b of I.bones){const I=c.Matrix.Identity(),e=b._index;g&&-1!==e&&(c.Matrix.FromArrayToRef(g,16*e,I),I.invertToRef(I));const z=b.getParent();z&&I.multiplyToRef(z.getAbsoluteInverseBindMatrix(),I),b.zb(I,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(I){return I.matrix?c.Matrix.mb(I.matrix):c.Matrix.Compose(I.scale?c.Vg.mb(I.scale):c.Vg.One(),I.rotation?c.Quaternion.mb(I.rotation):c.Quaternion.Identity(),I.translation?c.Vg.mb(I.translation):c.Vg.Zero())}loadCameraAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadCameraAsync(I,g,b);if(e)return e;const z=new Array;this.logOpen(`${I} ${g.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new o.b(g.name||`camera${g.index}`,c.Vg.Zero(),this._babylonScene,!1);switch(M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g._babylonCamera=M,M.setTarget(new c.Vg(0,0,-1)),g.type){case"perspective":{const b=g.perspective;if(!b)throw new Error(`${I}: Camera perspective properties are missing`);M.fov=b.yfov,M.cb=b.znear,M.maxZ=b.zfar||0;break}case"orthographic":if(!g.orthographic)throw new Error(`${I}: Camera orthographic properties are missing`);M.mode=J.b.ORTHOGRAPHIC_CAMERA,M.orthoLeft=-g.orthographic.xmag,M.orthoRight=g.orthographic.xmag,M.orthoBottom=-g.orthographic.ymag,M.orthoTop=g.orthographic.ymag,M.cb=g.orthographic.znear,M.maxZ=g.orthographic.zfar;break;default:throw new Error(`${I}: Invalid camera type (${g.type})`)}return B.AddPointerMetadata(M,I),this._parent.onCameraLoadedObservable.notifyObservers(M),b(M),this.logClose(),Promise.all(z).then((()=>M))}_loadAnimationsAsync(){const I=this._gltf.animations;if(!I)return Promise.resolve();const g=new Array;for(let b=0;b<I.length;b++){const e=I[b];g.push(this.loadAnimationAsync(`/animations/${e.index}`,e).then((I=>{0===I.targetedAnimations.length&&I.dispose()})))}return Promise.all(g).then((()=>{}))}loadAnimationAsync(I,g){const e=this._extensionsLoadAnimationAsync(I,g);return e||b.e(78).then(b.bind(b,15696)).then((b=>{let{AnimationGroup:e}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new e(g.name||`animation${g.index}`,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g._babylonAnimationGroup=c;const z=new Array;N.Assign(g.channels),N.Assign(g.samplers);for(const M of g.channels)z.push(this._loadAnimationChannelAsync(`${I}/channels/${M.index}`,I,g,M,((I,g)=>{I.animations=I.animations||[],I.animations.push(g),c.addTargetedAnimation(g,I)})));return Promise.all(z).then((()=>(c.normalize(0),c)))}))}async _loadAnimationChannelAsync(I,g,e,c,z){const M=this._extensionsLoadAnimationChannelAsync(I,g,e,c,z);if(M)return await M;if(void 0==c.target.node)return await Promise.resolve();const J=N.Get(`${I}/target/node`,this._gltf.nodes,c.target.node),o=c.target.path,n="weights"===o;if(n&&!J._numMorphTargets||!n&&!J._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!n&&!J._isJoint)return await Promise.resolve();let G;switch(await Promise.resolve().then(b.bind(b,14230)),o){case"translation":var D;G=null===(D=(0,j.g)("/nodes/{}/translation"))||void 0===D?void 0:D.interpolation;break;case"rotation":var p;G=null===(p=(0,j.g)("/nodes/{}/rotation"))||void 0===p?void 0:p.interpolation;break;case"scale":var x;G=null===(x=(0,j.g)("/nodes/{}/scale"))||void 0===x?void 0:x.interpolation;break;case"weights":var Z;G=null===(Z=(0,j.g)("/nodes/{}/weights"))||void 0===Z?void 0:Z.interpolation;break;default:throw new Error(`${I}/target/path: Invalid value (${c.target.path})`)}if(!G)throw new Error(`${I}/target/path: Could not find interpolation properties for target path (${c.target.path})`);const k={object:J,info:G};return await this._loadAnimationChannelFromTargetInfoAsync(I,g,e,c,k,z)}_loadAnimationChannelFromTargetInfoAsync(I,g,b,e,c,z){const M=this.parent.targetFps,J=1/M,o=N.Get(`${I}/sampler`,b.samplers,e.sampler);return this._loadAnimationSamplerAsync(`${g}/samplers/${e.sampler}`,o).then((I=>{let g=0;const o=c.object,n=c.info;for(const c of n){const n=c.getStride(o),G=I.input,D=I.output,p=new Array(G.length);let x=0;switch(I.interpolation){case"STEP":for(let I=0;I<G.length;I++){const g=c.getValue(o,D,x,1);x+=n,p[I]={frame:G[I]*M,value:g,interpolation:1}}break;case"CUBICSPLINE":for(let I=0;I<G.length;I++){const g=c.getValue(o,D,x,J);x+=n;const b=c.getValue(o,D,x,1);x+=n;const e=c.getValue(o,D,x,J);x+=n,p[I]={frame:G[I]*M,inTangent:g,value:b,outTangent:e}}break;case"LINEAR":for(let I=0;I<G.length;I++){const g=c.getValue(o,D,x,1);x+=n,p[I]={frame:G[I]*M,value:g}}}if(x>0){const I=`${b.name||`animation${b.index}`}_channel${e.index}_${g}`,J=c.buildAnimations(o,I,M,p);for(const b of J)g++,z(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(I,g){if(g._data)return g._data;const b=g.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${I}/interpolation: Invalid value (${g.interpolation})`)}const e=N.Get(`${I}/input`,this._gltf.accessors,g.input),c=N.Get(`${I}/output`,this._gltf.accessors,g.output);return g._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${e.index}`,e),this._loadFloatAccessorAsync(`/accessors/${c.index}`,c)]).then((I=>{let[g,e]=I;return{input:g,interpolation:b,output:e}})),g._data}loadBufferAsync(I,g,b,e){const c=this._extensionsLoadBufferAsync(I,g,b,e);if(c)return c;if(!g._data)if(g.uri)g._data=this.loadUriAsync(`${I}/uri`,g,g.uri);else{if(!this._bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);g._data=this._bin.readAsync(0,g.byteLength)}return g._data.then((g=>{try{return new Uint8Array(g.buffer,g.byteOffset+b,e)}catch(c){throw new Error(`${I}: ${c.message}`)}}))}loadBufferViewAsync(I,g){const b=this._extensionsLoadBufferViewAsync(I,g);if(b)return b;if(g._data)return g._data;const e=N.Get(`${I}/buffer`,this._gltf.buffers,g.buffer);return g._data=this.loadBufferAsync(`/buffers/${e.index}`,e,g.byteOffset||0,g.byteLength),g._data}_loadAccessorAsync(I,g,b){if(g._data)return g._data;const e=B._GetNumComponents(I,g.type),c=e*R.f.GetTypeByteLength(g.componentType),z=e*g.count;if(void 0==g.bufferView)g._data=Promise.resolve(new b(z));else{const M=N.Get(`${I}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((J=>{if(5126!==g.componentType||g.normalized||M.byteStride&&M.byteStride!==c){const I=new b(z);return R.f.ForEach(J,g.byteOffset||0,M.byteStride||c,e,g.componentType,I.length,g.normalized||!1,((g,b)=>{I[b]=g})),I}return B._GetTypedArray(I,g.componentType,J,g.byteOffset,z)}))}if(g.sparse){const z=g.sparse;g._data=g._data.then((M=>{const J=M,o=N.Get(`${I}/sparse/indices/bufferView`,this._gltf.bufferViews,z.indices.bufferView),n=N.Get(`${I}/sparse/values/bufferView`,this._gltf.bufferViews,z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${o.index}`,o),this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)]).then((M=>{let[o,n]=M;const G=B._GetTypedArray(`${I}/sparse/indices`,z.indices.componentType,o,z.indices.byteOffset,z.count),D=e*z.count;let p;if(5126!==g.componentType||g.normalized){const M=B._GetTypedArray(`${I}/sparse/values`,g.componentType,n,z.values.byteOffset,D);p=new b(D),R.f.ForEach(M,0,c,e,g.componentType,p.length,g.normalized||!1,((I,g)=>{p[g]=I}))}else p=B._GetTypedArray(`${I}/sparse/values`,g.componentType,n,z.values.byteOffset,D);let x=0;for(let I=0;I<G.length;I++){let g=G[I]*e;for(let I=0;I<e;I++)J[g++]=p[x++]}return J}))}))}return g._data}_loadFloatAccessorAsync(I,g){return this._loadAccessorAsync(I,g,Float32Array)}_loadIndicesAccessorAsync(I,g){if("SCALAR"!==g.type)throw new Error(`${I}/type: Invalid value ${g.type}`);if(5121!==g.componentType&&5123!==g.componentType&&5125!==g.componentType)throw new Error(`${I}/componentType: Invalid value ${g.componentType}`);if(g._data)return g._data;if(g.sparse){const b=B._GetTypedArrayConstructor(`${I}/componentType`,g.componentType);g._data=this._loadAccessorAsync(I,g,b)}else{const b=N.Get(`${I}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>B._GetTypedArray(I,g.componentType,b,g.byteOffset,g.count)))}return g._data}_loadVertexBufferViewAsync(I){if(I._babylonBuffer)return I._babylonBuffer;const g=this._babylonScene.getEngine();return I._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>new R.d(g,I,!1))),I._babylonBuffer}_loadVertexAccessorAsync(I,g,b){var e;if(null!==(e=g._babylonVertexBuffer)&&void 0!==e&&e[b])return g._babylonVertexBuffer[b];g._babylonVertexBuffer||(g._babylonVertexBuffer={});const c=this._babylonScene.getEngine();if(g.sparse||void 0==g.bufferView)g._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(I,g).then((I=>new R.f(c,I,b,!1)));else{const e=N.Get(`${I}/bufferView`,this._gltf.bufferViews,g.bufferView);g._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(e).then((z=>{const M=B._GetNumComponents(I,g.type);return new R.f(c,z,b,!1,void 0,e.byteStride,void 0,g.byteOffset,M,g.componentType,g.normalized,!0,void 0,!0)}))}return g._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return g&&(g.baseColorFactor?(b.albedoColor=z.Eg.mb(g.baseColorFactor),b.alpha=g.baseColorFactor[3]):b.albedoColor=z.Eg.White(),b.metallic=void 0==g.metallicFactor?1:g.metallicFactor,b.roughness=void 0==g.roughnessFactor?1:g.roughnessFactor,g.baseColorTexture&&e.push(this.loadTextureInfoAsync(`${I}/baseColorTexture`,g.baseColorTexture,(I=>{I.name=`${b.name} (Base Color)`,b.albedoTexture=I}))),g.metallicRoughnessTexture&&(g.metallicRoughnessTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/metallicRoughnessTexture`,g.metallicRoughnessTexture,(I=>{I.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=I}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(e).then((()=>{}))}_loadMaterialAsync(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const z=this._extensionsLoadMaterialAsync(I,g,b,e,c);if(z)return z;g._data=g._data||{};let M=g._data[e];if(!M){this.logOpen(`${I} ${g.name||""}`);const b=this.createMaterial(I,g,e);M={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,g,b)},g._data[e]=M,B.AddPointerMetadata(b,I),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(M.babylonMeshes.push(b),b.Og.addOnce((()=>{const I=M.babylonMeshes.indexOf(b);-1!==I&&M.babylonMeshes.splice(I,1)}))),c(M.babylonMaterial),M.promise.then((()=>M.babylonMaterial))}_createDefaultMaterial(I,g){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new a.b(I,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=g,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=a.b.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(I,g,b){const e=this._extensionsCreateMaterial(I,g,b);if(e)return e;const c=g.name||`material${g.index}`;return this._createDefaultMaterial(c,b)}loadMaterialPropertiesAsync(I,g,b){const e=this._extensionsLoadMaterialPropertiesAsync(I,g,b);if(e)return e;const c=new Array;return c.push(this.loadMaterialBasePropertiesAsync(I,g,b)),g.pbrMetallicRoughness&&c.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${I}/pbrMetallicRoughness`,g.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(I,g,b),Promise.all(c).then((()=>{}))}loadMaterialBasePropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.emissiveColor=g.emissiveFactor?z.Eg.mb(g.emissiveFactor):new z.Eg(0,0,0),g.doubleSided&&(b.Gb=!1,b.twoSidedLighting=!0),g.normalTexture&&(g.normalTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/normalTexture`,g.normalTexture,(I=>{I.name=`${b.name} (Normal)`,b.bumpTexture=I}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=g.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=g.normalTexture.scale),b.forceIrradianceInFragment=!0),g.occlusionTexture&&(g.occlusionTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/occlusionTexture`,g.occlusionTexture,(I=>{I.name=`${b.name} (Occlusion)`,b.ambientTexture=I}))),b.useAmbientInGrayScale=!0,void 0!=g.occlusionTexture.strength&&(b.ambientTextureStrength=g.occlusionTexture.strength)),g.emissiveTexture&&e.push(this.loadTextureInfoAsync(`${I}/emissiveTexture`,g.emissiveTexture,(I=>{I.name=`${b.name} (Emissive)`,b.emissiveTexture=I}))),Promise.all(e).then((()=>{}))}loadMaterialAlphaProperties(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);switch(g.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=a.b.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=a.b.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==g.alphaCutoff?.5:g.alphaCutoff,b.albedoTexture&&(b.albedoTexture.eb=!0);break;case"BLEND":b.transparencyMode=a.b.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.eb=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${I}/alphaMode: Invalid value (${g.alphaMode})`)}}loadTextureInfoAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureInfoAsync(I,g,b);if(e)return e;if(this.logOpen(`${I}`),g.texCoord>=6)throw new Error(`${I}/texCoord: Invalid value (${g.texCoord})`);const c=N.Get(`${I}/index`,this._gltf.textures,g.index);c._textureInfo=g;const z=this._loadTextureAsync(`/textures/${g.index}`,c,(e=>{e.coordinatesIndex=g.texCoord||0,B.AddPointerMetadata(e,I),this._parent.onTextureLoadedObservable.notifyObservers(e),b(e)}));return this.logClose(),z}_loadTextureAsync(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureAsync(I,g,b);if(e)return e;this.logOpen(`${I} ${g.name||""}`);const c=void 0==g.sampler?B.DefaultSampler:N.Get(`${I}/sampler`,this._gltf.samplers,g.sampler),z=N.Get(`${I}/source`,this._gltf.images,g.source),M=this._createTextureAsync(I,c,z,b,void 0,!g._textureInfo.nonColorData);return this.logClose(),M}_createTextureAsync(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},z=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;const J=this._loadSampler(`/samplers/${g.index}`,g),o=new Array,n=new e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G={noMipmap:J.noMipMaps,invertY:!1,samplingMode:J.samplingMode,l:()=>{this._disposed||n.resolve()},onError:(g,b)=>{this._disposed||n.reject(new Error(`${I}: ${b&&b.message?b.message:g||"Failed to load texture"}`))},mimeType:b.mimeType??(0,O.h)(b.uri??""),loaderOptions:z,useSRGBBuffer:!!M&&this._parent.useSRGBBuffers},D=new v.b(null,this._babylonScene,G);return D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.push(n.promise),o.push(this.loadImageAsync(`/images/${b.index}`,b).then((I=>{const g=b.uri||`${this._fileName}#image${b.index}`,e=`data:${this._uniqueRootUrl}${g}`;D.updateURL(e,I);const c=D.getInternalTexture();c&&(c.label=b.name)}))),D.wrapU=J.wrapU,D.wrapV=J.wrapV,c(D),this._parent.useGltfTextureNames&&(D.name=b.name||b.uri||`image${b.index}`),Promise.all(o).then((()=>D))}_loadSampler(I,g){return g._data||(g._data={noMipMaps:9728===g.minFilter||9729===g.minFilter,samplingMode:B._GetTextureSamplingMode(I,g),wrapU:B._GetTextureWrapMode(`${I}/wrapS`,g.wrapS),wrapV:B._GetTextureWrapMode(`${I}/wrapT`,g.wrapT)}),g._data}loadImageAsync(I,g){if(!g._data){if(this.logOpen(`${I} ${g.name||""}`),g.uri)g._data=this.loadUriAsync(`${I}/uri`,g,g.uri);else{const b=N.Get(`${I}/bufferView`,this._gltf.bufferViews,g.bufferView);g._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return g._data}loadUriAsync(I,g,b){const e=this._extensionsLoadUriAsync(I,g,b);if(e)return e;if(!B._ValidateUri(b))throw new Error(`${I}: '${b}' is invalid`);if((0,O.l)(b)){const g=new Uint8Array((0,O.e)(b));return this.log(`${I}: Decoded ${b.substring(0,64)}... (${g.length} bytes)`),Promise.resolve(g)}return this.log(`${I}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((g=>new Promise(((e,c)=>{this._parent._loadFile(this._babylonScene,g,(g=>{this._disposed||(this.log(`${I}: Loaded ${b} (${g.byteLength} bytes)`),e(new Uint8Array(g)))}),!0,(g=>{c(new O.p(`${I}: Failed to load '${b}'${g?": "+g.status+" "+g.statusText:""}`,g))}))}))))}static AddPointerMetadata(I,g){I.metadata=I.metadata||{};const b=I._internalMetadata=I._internalMetadata||{},e=b.Lg=b.Lg||{};(e.pointers=e.pointers||[]).push(g)}static _GetTextureWrapMode(I,g){switch(g=void 0==g?10497:g){case 33071:return v.b.CLAMP_ADDRESSMODE;case 33648:return v.b.MIRROR_ADDRESSMODE;case 10497:return v.b.WRAP_ADDRESSMODE;default:return k.b.Warn(`${I}: Invalid value (${g})`),v.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(I,g){const b=void 0==g.magFilter?9729:g.magFilter,e=void 0==g.minFilter?9987:g.minFilter;if(9729===b)switch(e){case 9728:return v.b.LINEAR_NEAREST;case 9729:return v.b.LINEAR_LINEAR;case 9984:return v.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return v.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return v.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return v.b.LINEAR_LINEAR_MIPLINEAR;default:return k.b.Warn(`${I}/minFilter: Invalid value (${e})`),v.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&k.b.Warn(`${I}/magFilter: Invalid value (${b})`),e){case 9728:return v.b.NEAREST_NEAREST;case 9729:return v.b.NEAREST_LINEAR;case 9984:return v.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return v.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return v.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return v.b.NEAREST_LINEAR_MIPLINEAR;default:return k.b.Warn(`${I}/minFilter: Invalid value (${e})`),v.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(I,g){try{return(0,L.s)(g)}catch(b){throw new Error(`${I}: ${b.message}`)}}static _GetTypedArray(I,g,b,e,c){const z=b.buffer;e=b.byteOffset+(e||0);const M=B._GetTypedArrayConstructor(`${I}/componentType`,g),J=R.f.GetTypeByteLength(g);return e%J!==0?(k.b.Warn(`${I}: Copying buffer as byte offset (${e}) is not a multiple of component type byte length (${J})`),new M(z.slice(e,e+c*J),0)):new M(z,e,c)}static _GetNumComponents(I,g){switch(g){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${I}: Invalid type (${g})`)}static _ValidateUri(I){return M.Tools.IsBase64(I)||-1===I.indexOf("..")}static _GetDrawMode(I,g){switch(void 0==g&&(g=4),g){case 0:return V.b.PointListDrawMode;case 1:return V.b.LineListDrawMode;case 2:return V.b.LineLoopDrawMode;case 3:return V.b.LineStripDrawMode;case 4:return V.b.TriangleFillMode;case 5:return V.b.TriangleStripDrawMode;case 6:return V.b.TriangleFanDrawMode}throw new Error(`${I}: Invalid mesh primitive mode (${g})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const I=new Array;if(this._gltf.materials)for(const g of this._gltf.materials)if(g._data)for(const b in g._data){const e=g._data[b];for(const g of e.babylonMeshes){g.Mb(!0);const b=e.babylonMaterial;I.push(b.forceCompilationAsync(g)),I.push(b.forceCompilationAsync(g,{useInstances:!0})),this._parent.useClipPlane&&(I.push(b.forceCompilationAsync(g,{clipPlane:!0})),I.push(b.forceCompilationAsync(g,{clipPlane:!0,useInstances:!0})))}}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const I=new Array,g=this._babylonScene.lights;for(const b of g){const g=b.getShadowGenerator();g&&I.push(g.forceCompilationAsync())}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(I){for(const g of this._extensions)g.enabled&&I(g)}_applyExtensions(I,g,b){for(const e of this._extensions)if(e.enabled){const c=`${e.name}.${g}`,z=I;z._activeLoaderExtensionFunctions=z._activeLoaderExtensionFunctions||{};const M=z._activeLoaderExtensionFunctions;if(!M[c]){M[c]=!0;try{const I=b(e);if(I)return I}finally{delete M[c]}}}return null}_extensionsOnLoading(){this._forEachExtensions((I=>I.onLoading&&I.onLoading()))}_extensionsOnReady(){this._forEachExtensions((I=>I.onReady&&I.onReady()))}_extensionsLoadSceneAsync(I,g){return this._applyExtensions(g,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(I,g)))}_extensionsLoadNodeAsync(I,g,b){return this._applyExtensions(g,"loadNode",(e=>e.loadNodeAsync&&e.loadNodeAsync(I,g,b)))}_extensionsLoadCameraAsync(I,g,b){return this._applyExtensions(g,"loadCamera",(e=>e.loadCameraAsync&&e.loadCameraAsync(I,g,b)))}_extensionsLoadVertexDataAsync(I,g,b){return this._applyExtensions(g,"loadVertexData",(e=>e._loadVertexDataAsync&&e._loadVertexDataAsync(I,g,b)))}_extensionsLoadMeshPrimitiveAsync(I,g,b,e,c,z){return this._applyExtensions(c,"loadMeshPrimitive",(M=>M._loadMeshPrimitiveAsync&&M._loadMeshPrimitiveAsync(I,g,b,e,c,z)))}_extensionsLoadMaterialAsync(I,g,b,e,c){return this._applyExtensions(g,"loadMaterial",(z=>z._loadMaterialAsync&&z._loadMaterialAsync(I,g,b,e,c)))}_extensionsCreateMaterial(I,g,b){return this._applyExtensions(g,"createMaterial",(e=>e.createMaterial&&e.createMaterial(I,g,b)))}_extensionsLoadMaterialPropertiesAsync(I,g,b){return this._applyExtensions(g,"loadMaterialProperties",(e=>e.loadMaterialPropertiesAsync&&e.loadMaterialPropertiesAsync(I,g,b)))}_extensionsLoadTextureInfoAsync(I,g,b){return this._applyExtensions(g,"loadTextureInfo",(e=>e.loadTextureInfoAsync&&e.loadTextureInfoAsync(I,g,b)))}_extensionsLoadTextureAsync(I,g,b){return this._applyExtensions(g,"loadTexture",(e=>e._loadTextureAsync&&e._loadTextureAsync(I,g,b)))}_extensionsLoadAnimationAsync(I,g){return this._applyExtensions(g,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(I,g)))}_extensionsLoadAnimationChannelAsync(I,g,b,e,c){return this._applyExtensions(b,"loadAnimationChannel",(z=>z._loadAnimationChannelAsync&&z._loadAnimationChannelAsync(I,g,b,e,c)))}_extensionsLoadSkinAsync(I,g,b){return this._applyExtensions(b,"loadSkin",(e=>e._loadSkinAsync&&e._loadSkinAsync(I,g,b)))}_extensionsLoadUriAsync(I,g,b){return this._applyExtensions(g,"loadUri",(e=>e._loadUriAsync&&e._loadUriAsync(I,g,b)))}_extensionsLoadBufferViewAsync(I,g){return this._applyExtensions(g,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(I,g)))}_extensionsLoadBufferAsync(I,g,b,e){return this._applyExtensions(g,"loadBuffer",(c=>c.loadBufferAsync&&c.loadBufferAsync(I,g,b,e)))}static LoadExtensionAsync(I,g,b,e){if(!g.extensions)return null;const c=g.extensions[b];return c?e(`${I}/extensions/${b}`,c):null}static LoadExtraAsync(I,g,b,e){if(!g.extras)return null;const c=g.extras[b];return c?e(`${I}/extras/${b}`,c):null}isExtensionUsed(I){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(I)}logOpen(I){this._parent._logOpen(I)}logClose(){this._parent._logClose()}log(I){this._parent._log(I)}startPerformanceCounter(I){this._parent._startPerformanceCounter(I)}endPerformanceCounter(I){this._parent._endPerformanceCounter(I)}}B.DefaultSampler={index:-1},r.d._CreateGLTF2Loader=I=>new B(I);var P=b(14230),u=b(12769),t=b(12622),y=b(14234),q=b(14243);class l extends q.d{constructor(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",I),this._texture=I.getEngine().createRawCubeTexture(g,b,e,c,z,M,J,o)}update(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,I,g,b,e,c)}updateRGBDAsync(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.l)(this._texture,I,g,b,e).then((()=>{}))}clone(){return t.b.Clone((()=>{const I=this.EI(),g=this._texture,b=new l(I,g._bufferViewArray,g.width,g.format,g.type,g.generateMipMaps,g.invertY,g.samplingMode,g._compression);return 13===g.source&&b.updateRGBDAsync(g._bufferViewArrayArray,g._sphericalPolynomial,g._lodGenerationScale,g._lodGenerationOffset),b}),this)}}const w="EXT_lights_image_based";class T{constructor(I){this.name=w,this._loader=I,this.enabled=this._loader.isExtensionUsed(w)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Lg.extensions;if(I&&I[this.name]){const g=I[this.name];this._lights=g.lights}}loadSceneAsync(I,g){return B.LoadExtensionAsync(I,g,this.name,(async(b,e)=>{this._loader._allMaterialsDirtyRequired=!0;const c=new Array;c.push(this._loader.loadSceneAsync(I,g)),this._loader.logOpen(`${b}`);const z=N.Get(`${b}/light`,this._lights,e.vg);return c.push(this._loadLightAsync(`/extensions/${this.name}/lights/${e.vg}`,z).then((I=>{this._loader.babylonScene.environmentTexture=I}))),this._loader.logClose(),await Promise.all(c).then((()=>{}))}))}_loadLightAsync(I,g){if(!g._loaded){const b=new Array;this._loader.logOpen(`${I}`);const e=new Array(g.specularImages.length);for(let c=0;c<g.specularImages.length;c++){const z=g.specularImages[c];e[c]=new Array(z.length);for(let g=0;g<z.length;g++){const M=`${I}/specularImages/${c}/${g}`;this._loader.logOpen(`${M}`);const J=z[g],o=N.Get(M,this._loader.Lg.images,J);b.push(this._loader.loadImageAsync(`/images/${J}`,o).then((I=>{e[c][g]=I}))),this._loader.logClose()}}this._loader.logClose(),g._loaded=Promise.all(b).then((async()=>{const b=new l(this._loader.babylonScene,null,g.specularImageSize);if(b.name=g.name||"environment",g._babylonTexture=b,void 0!=g.Xb&&(b.level=g.Xb),g.rotation){let I=c.Quaternion.mb(g.rotation);this._loader.babylonScene.useRightHandedSystem||(I=c.Quaternion.Inverse(I)),c.Matrix.FromQuaternionToRef(I,b.getReflectionTextureMatrix())}if(!g.irradianceCoefficients)throw new Error(`${I}: Irradiance coefficients are missing`);const z=u.e.mb(g.irradianceCoefficients);z.scaleInPlace(g.Xb),z.convertIrradianceToLambertianRadiance();const M=u.f.FromHarmonics(z),J=(e.length-1)/Math.log2(g.specularImageSize);return await b.updateRGBDAsync(e,M,J)}))}return g._loaded.then((()=>g._babylonTexture))}}A(w),h(w,!0,(I=>new T(I)));b(13135);const W="EXT_mesh_gpu_instancing";class II{constructor(I){this.name=W,this._loader=I,this.enabled=this._loader.isExtensionUsed(W)}dispose(){this._loader=null}loadNodeAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(I,e)=>{this._loader._disableInstancedMesh++;const z=this._loader.loadNodeAsync(`/nodes/${g.index}`,g,b);if(this._loader._disableInstancedMesh--,!g._primitiveBabylonMeshes)return await z;const M=new Array;let J=0;const o=g=>{if(void 0==e.attributes[g])return void M.push(Promise.resolve(null));const b=N.Get(`${I}/attributes/${g}`,this._loader.Lg.accessors,e.attributes[g]);if(M.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===J)J=b.count;else if(J!==b.count)throw new Error(`${I}/attributes: Instance buffer accessors do not have the same count.`)};return o("TRANSLATION"),o("ROTATION"),o("SCALE"),await z.then((async I=>{const[b,e,z]=await Promise.all(M),o=new Float32Array(16*J);c.TmpVectors.Vg[0].Db(0,0,0),c.TmpVectors.Quaternion[0].Db(0,0,0,1),c.TmpVectors.Vg[1].Db(1,1,1);for(let g=0;g<J;++g)b&&c.Vg.FromArrayToRef(b,3*g,c.TmpVectors.Vg[0]),e&&c.Quaternion.FromArrayToRef(e,4*g,c.TmpVectors.Quaternion[0]),z&&c.Vg.FromArrayToRef(z,3*g,c.TmpVectors.Vg[1]),c.Matrix.ComposeToRef(c.TmpVectors.Vg[1],c.TmpVectors.Quaternion[0],c.TmpVectors.Vg[0],c.TmpVectors.Matrix[0]),c.TmpVectors.Matrix[0].copyToArray(o,16*g);for(const c of g._primitiveBabylonMeshes)c.lp("matrix",o,16,!0);return I}))}))}}A(W),h(W,!0,(I=>new II(I)));let gI=0,bI=null;class eI{static get Default(){return eI._Default||(eI._Default=new eI),eI._Default}constructor(){const I=eI.Configuration.decoder;this._decoderModulePromise=M.Tools.LoadBabylonScriptAsync(I.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(I,g,b,e,c){await this._decoderModulePromise,0===gI&&(MeshoptDecoder.useWorkers(1),gI=1);const z=await MeshoptDecoder.decodeGltfBufferAsync(g,b,I,e,c);return null!==bI&&clearTimeout(bI),bI=setTimeout((()=>{MeshoptDecoder.useWorkers(0),gI=0,bI=null}),1e3),z}}eI.Configuration={decoder:{url:`${M.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},eI._Default=null;const cI="EXT_meshopt_compression";class zI{constructor(I){this.name=cI,this.enabled=I.isExtensionUsed(cI),this._loader=I}dispose(){this._loader=null}loadBufferViewAsync(I,g){return B.LoadExtensionAsync(I,g,this.name,(async(b,e)=>{const c=g;if(c._meshOptData)return await c._meshOptData;const z=N.Get(`${I}/buffer`,this._loader.Lg.buffers,e.buffer);return c._meshOptData=this._loader.loadBufferAsync(`/buffers/${z.index}`,z,e.byteOffset||0,e.byteLength).then((async I=>await eI.Default.decodeGltfBufferAsync(I,e.count,e.byteStride,e.mode,e.filter))),await c._meshOptData}))}}A(cI),h(cI,!0,(I=>new zI(I)));const MI="EXT_texture_webp";class JI{constructor(I){this.name=MI,this._loader=I,this.enabled=I.isExtensionUsed(MI)}dispose(){this._loader=null}_loadTextureAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=void 0==g.sampler?B.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Lg.samplers,g.sampler),M=N.Get(`${e}/source`,this._loader.Lg.images,c.source);return await this._loader._createTextureAsync(I,z,M,(I=>{b(I)}),void 0,!g._textureInfo.nonColorData)}))}}A(MI),h(MI,!0,(I=>new JI(I)));const oI="EXT_texture_avif";class nI{constructor(I){this.name=oI,this._loader=I,this.enabled=I.isExtensionUsed(oI)}dispose(){this._loader=null}_loadTextureAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=void 0==g.sampler?B.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Lg.samplers,g.sampler),M=N.Get(`${e}/source`,this._loader.Lg.images,c.source);return await this._loader._createTextureAsync(I,z,M,(I=>{b(I)}),void 0,!g._textureInfo.nonColorData)}))}}A(oI),h(oI,!0,(I=>new nI(I)));var GI=b(14228),DI=b(13114);const pI="EXT_lights_ies";class xI{constructor(I){this.name=pI,this._loader=I,this.enabled=this._loader.isExtensionUsed(pI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Lg.extensions;if(I&&I[this.name]){const g=I[this.name];this._lights=g.lights,N.Assign(this._lights)}}loadNodeAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,M)=>{let J,o;this._loader._allMaterialsDirtyRequired=!0;const n=await this._loader.loadNodeAsync(I,g,(I=>{o=N.Get(e,this._lights,M.vg);const g=o.name||I.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J=new GI.d(g,c.Vg.Zero(),c.Vg.Backward(),0,1,this._loader.babylonScene),J.angle=Math.PI/2,J.innerAngle=0,J._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=J,J.falloffType=DI.d.FALLOFF_GLTF,J.Rb=M.color?z.Eg.mb(M.color):z.Eg.White(),J.Xb=M.multiplier||1,J.range=Number.MAX_VALUE,J.parent=I,this._loader._babylonLights.push(J),B.AddPointerMetadata(J,e),b(I)}));let G;if(o.uri)G=await this._loader.loadUriAsync(I,o,o.uri);else{const g=N.Get(`${I}/bufferView`,this._loader.Lg.bufferViews,o.bufferView);G=await this._loader.loadBufferViewAsync(`/bufferViews/${g.index}`,g)}return J.iesProfileTexture=new v.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,G,!0,void 0,void 0,void 0,void 0,".ies"),n}))}}A(pI),h(pI,!0,(I=>new xI(I)));var ZI=b(14257);const kI="KHR_draco_mesh_compression";class SI{constructor(I){this.name=kI,this.useNormalizedFlagFromAccessor=!0,this._loader=I,this.enabled=ZI.c.DefaultAvailable&&this._loader.isExtensionUsed(kI)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{if(void 0!=g.mode&&4!==g.mode&&5!==g.mode)throw new Error(`${I}: Unsupported mode ${g.mode}`);const z={},M={},J=(I,e)=>{const J=c.attributes[I];if(void 0!=J&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(e)&&b._delayInfo.push(e),z[e]=J,this.useNormalizedFlagFromAccessor)){const b=N.TryGet(this._loader.Lg.accessors,g.attributes[I]);b&&(M[e]=b.normalized||!1)}};J("POSITION",R.f.PositionKind),J("NORMAL",R.f.NormalKind),J("TANGENT",R.f.TangentKind),J("TEXCOORD_0",R.f.UVKind),J("TEXCOORD_1",R.f.UV2Kind),J("TEXCOORD_2",R.f.UV3Kind),J("TEXCOORD_3",R.f.UV4Kind),J("TEXCOORD_4",R.f.UV5Kind),J("TEXCOORD_5",R.f.UV6Kind),J("JOINTS_0",R.f.MatricesIndicesKind),J("WEIGHTS_0",R.f.MatricesWeightsKind),J("COLOR_0",R.f.ColorKind);const o=N.Get(e,this._loader.Lg.bufferViews,c.bufferView);return o._dracoBabylonGeometry||(o._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((async e=>{const c=this.dracoDecoder||ZI.c.Default,J=N.TryGet(this._loader.Lg.accessors,g.attributes.POSITION),o=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!J?null:K(J);return await c._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,e,z,M,o).catch((g=>{throw new Error(`${I}: ${g.message}`)}))}))),await o._dracoBabylonGeometry}))}}A(kI),h(kI,!0,(I=>new SI(I)));var fI=b(14261),VI=b(12577),aI=b(12584),vI=b(13002),XI=b(13161),RI=b(12558);vI.b.AddNodeConstructor("Light_Type_0",((I,g)=>()=>new EI(I,c.Vg.Zero(),g)));class EI extends XI.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(I){this._shadowAngle=I,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(I){const g=this.needCube();if(this._direction=I,this.needCube()!==g&&this._shadowGenerators){const I=this._shadowGenerators.values();for(let g=I.next();!0!==g.done;g=I.next()){g.value.recreateShadowMap()}}}constructor(I,g,b){super(I,b),this._shadowAngle=Math.PI/2,this.position=g}getClassName(){return"PointLight"}getTypeID(){return DI.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(I){if(this.direction)return super.getShadowDirection(I);switch(I){case 0:return new c.Vg(1,0,0);case 1:return new c.Vg(-1,0,0);case 2:return new c.Vg(0,-1,0);case 3:return new c.Vg(0,1,0);case 4:return new c.Vg(0,0,1);case 5:return new c.Vg(0,0,-1)}return c.Vg.Zero()}_setDefaultShadowProjectionMatrix(I,g,b){const e=this.EI().activeCamera;if(!e)return;const z=void 0!==this.shadowMinZ?this.shadowMinZ:e.cb,M=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,J=this.EI().getEngine().Fg;c.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,J?M:z,J?z:M,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,g){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,g):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,g),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,g),this}transferToNodeMaterialEffect(I,g){return this.computeTransformedInformation()?I.setFloat3(g,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):I.setFloat3(g,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(I,g){I["POINTLIGHT"+g]=!0}}(0,VI.d)([(0,aI.E)()],EI.prototype,"shadowAngle",null),(0,RI.g)("BABYLON.PointLight",EI);const mg="KHR_lights_punctual";class sI{constructor(I){this.name=mg,this._loader=I,this.enabled=this._loader.isExtensionUsed(mg)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.Lg.extensions;if(I&&I[this.name]){const g=I[this.name];this._lights=g.lights,N.Assign(this._lights)}}loadNodeAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,M)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(I,g,(I=>{let g;const J=N.Get(e,this._lights,M.vg),o=J.name||I.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J.type){case"directional":{const I=new fI.e(o,c.Vg.Backward(),this._loader.babylonScene);I.position.kb(0),g=I;break}case"point":g=new EI(o,c.Vg.Zero(),this._loader.babylonScene);break;case"spot":{const I=new GI.d(o,c.Vg.Zero(),c.Vg.Backward(),0,1,this._loader.babylonScene);I.angle=2*(J.spot&&J.spot.outerConeAngle||Math.PI/4),I.innerAngle=2*(J.spot&&J.spot.innerConeAngle||0),g=I;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${e}: Invalid light type (${J.type})`)}g._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=g,g.falloffType=DI.d.FALLOFF_GLTF,g.Rb=J.color?z.Eg.mb(J.color):z.Eg.White(),g.Xb=void 0==J.Xb?1:J.Xb,g.range=void 0==J.range?Number.MAX_VALUE:J.range,g.parent=I,this._loader._babylonLights.push(g),B.AddPointerMetadata(g,e),b(I)})))))}}A(mg),h(mg,!0,(I=>new sI(I)));const FI="KHR_materials_pbrSpecularGlossiness";class YI{constructor(I){this.name=FI,this.order=200,this._loader=I,this.enabled=this._loader.isExtensionUsed(FI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialBasePropertiesAsync(I,g,b)),z.push(this._loadSpecularGlossinessPropertiesAsync(e,c,b)),this._loader.loadMaterialAlphaProperties(I,g,b),await Promise.all(z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.metallic=null,b.roughness=null,g.diffuseFactor?(b.albedoColor=z.Eg.mb(g.diffuseFactor),b.alpha=g.diffuseFactor[3]):b.albedoColor=z.Eg.White(),b.reflectivityColor=g.specularFactor?z.Eg.mb(g.specularFactor):z.Eg.White(),b.microSurface=void 0==g.glossinessFactor?1:g.glossinessFactor,g.diffuseTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTexture`,g.diffuseTexture,(I=>{I.name=`${b.name} (Diffuse)`,b.albedoTexture=I}))),g.specularGlossinessTexture&&(e.push(this._loader.loadTextureInfoAsync(`${I}/specularGlossinessTexture`,g.specularGlossinessTexture,(I=>{I.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=I,b.reflectivityTexture.eb=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(e).then((()=>{}))}}A(FI),h(FI,!0,(I=>new YI(I)));const dI="KHR_materials_unlit";class CI{constructor(I){this.name=dI,this.order=210,this._loader=I,this.enabled=this._loader.isExtensionUsed(dI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async()=>await this._loadUnlitPropertiesAsync(I,g,b)))}_loadUnlitPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;b.unlit=!0;const c=g.pbrMetallicRoughness;return c&&(c.baseColorFactor?(b.albedoColor=z.Eg.mb(c.baseColorFactor),b.alpha=c.baseColorFactor[3]):b.albedoColor=z.Eg.White(),c.baseColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/baseColorTexture`,c.baseColorTexture,(I=>{I.name=`${b.name} (Base Color)`,b.albedoTexture=I})))),g.doubleSided&&(b.Gb=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(I,g,b),Promise.all(e).then((()=>{}))}}A(dI),h(dI,!0,(I=>new CI(I)));const rI="KHR_materials_clearcoat";class OI{constructor(I){this.name=rI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(rI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadClearCoatPropertiesAsync(e,c,b)),await Promise.all(z)}))}_loadClearCoatPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=g.clearcoatFactor?b.clearCoat.Xb=g.clearcoatFactor:b.clearCoat.Xb=0,g.clearcoatTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatTexture`,g.clearcoatTexture,(I=>{I.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=I}))),void 0!=g.clearcoatRoughnessFactor?b.clearCoat.roughness=g.clearcoatRoughnessFactor:b.clearCoat.roughness=0,g.clearcoatRoughnessTexture&&(g.clearcoatRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatRoughnessTexture`,g.clearcoatRoughnessTexture,(I=>{I.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=I})))),g.clearcoatNormalTexture&&(g.clearcoatNormalTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatNormalTexture`,g.clearcoatNormalTexture,(I=>{I.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=I}))),b.invertNormalMapX=!b.EI().useRightHandedSystem,b.invertNormalMapY=b.EI().useRightHandedSystem,void 0!=g.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=g.clearcoatNormalTexture.scale)),Promise.all(e).then((()=>{}))}}A(rI),h(rI,!0,(I=>new OI(I)));const HI="KHR_materials_iridescence";class iI{constructor(I){this.name=HI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(HI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadIridescencePropertiesAsync(e,c,b)),await Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.iridescence.isEnabled=!0,b.iridescence.Xb=g.iridescenceFactor??0,b.iridescence.indexOfRefraction=g.iridescenceIor??g.iridescenceIOR??1.3,b.iridescence.minimumThickness=g.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=g.iridescenceThicknessMaximum??400,g.iridescenceTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceTexture`,g.iridescenceTexture,(I=>{I.name=`${b.name} (Iridescence)`,b.iridescence.texture=I}))),g.iridescenceThicknessTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceThicknessTexture`,g.iridescenceThicknessTexture,(I=>{I.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=I}))),Promise.all(e).then((()=>{}))}}A(HI),h(HI,!0,(I=>new iI(I)));const UI="KHR_materials_anisotropy";class hI{constructor(I){this.name=UI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(UI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadIridescencePropertiesAsync(e,c,b)),await Promise.all(z)}))}async _loadIridescencePropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.Xb=g.anisotropyStrength??0,b.anisotropy.angle=g.anisotropyRotation??0,g.anisotropyTexture&&(g.anisotropyTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/anisotropyTexture`,g.anisotropyTexture,(I=>{I.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=I})))),await Promise.all(e)}}A(UI),h(UI,!0,(I=>new hI(I)));const AI="KHR_materials_emissive_strength";class jI{constructor(I){this.name=AI,this.order=170,this._loader=I,this.enabled=this._loader.isExtensionUsed(AI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>await this._loader.loadMaterialPropertiesAsync(I,g,b).then((()=>{this._loadEmissiveProperties(e,c,b)}))))}_loadEmissiveProperties(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);void 0!==g.emissiveStrength&&(b.emissiveIntensity=g.emissiveStrength)}}A(AI),h(AI,!0,(I=>new jI(I)));const QI="KHR_materials_sheen";class LI{constructor(I){this.name=QI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(QI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadSheenPropertiesAsync(e,c,b)),await Promise.all(z).then((()=>{}))}))}_loadSheenPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.sheen.isEnabled=!0,b.sheen.Xb=1,void 0!=g.sheenColorFactor?b.sheen.color=z.Eg.mb(g.sheenColorFactor):b.sheen.color=z.Eg.Black(),g.sheenColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/sheenColorTexture`,g.sheenColorTexture,(I=>{I.name=`${b.name} (Sheen Color)`,b.sheen.texture=I}))),void 0!==g.sheenRoughnessFactor?b.sheen.roughness=g.sheenRoughnessFactor:b.sheen.roughness=0,g.sheenRoughnessTexture&&(g.sheenRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/sheenRoughnessTexture`,g.sheenRoughnessTexture,(I=>{I.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=I})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(e).then((()=>{}))}}A(QI),h(QI,!0,(I=>new LI(I)));var NI=b(13058);const KI="KHR_materials_specular";class BI{constructor(I){this.name=KI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(KI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;if(z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadSpecularPropertiesAsync(e,c,b)),c.extensions&&c.extensions.EXT_materials_specular_edge_color&&b instanceof a.b){c.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=NI.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=NI.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(z).then((()=>{}))}))}_loadSpecularPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return void 0!==g.specularFactor&&(b.metallicF0Factor=g.specularFactor),void 0!==g.specularColorFactor&&(b.metallicReflectanceColor=z.Eg.mb(g.specularColorFactor)),g.specularTexture&&(g.specularTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/specularTexture`,g.specularTexture,(I=>{I.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=I,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),g.specularColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/specularColorTexture`,g.specularColorTexture,(I=>{I.name=`${b.name} (Specular Color)`,b.reflectanceTexture=I}))),Promise.all(e).then((()=>{}))}}A(KI),h(KI,!0,(I=>new BI(I)));const PI="KHR_materials_ior";class uI{constructor(I){this.name=PI,this.order=180,this._loader=I,this.enabled=this._loader.isExtensionUsed(PI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadIorPropertiesAsync(e,c,b)),await Promise.all(z).then((()=>{}))}))}_loadIorPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);return void 0!==g.ior?b.indexOfRefraction=g.ior:b.indexOfRefraction=uI._DEFAULT_IOR,Promise.resolve()}}uI._DEFAULT_IOR=1.5,A(PI),h(PI,!0,(I=>new uI(I)));const tI="KHR_materials_variants";class yI{constructor(I){this.name=tI,this._loader=I,this.enabled=this._loader.isExtensionUsed(tI)}dispose(){this._loader=null}static GetAvailableVariants(I){const g=this._GetExtensionMetadata(I);return g?Object.keys(g.variants):[]}getAvailableVariants(I){return yI.GetAvailableVariants(I)}static SelectVariant(I,g){const b=this._GetExtensionMetadata(I);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${tI} extension`);const e=I=>{const g=b.variants[I];if(g)for(const b of g)b.mesh.material=b.material};if(g instanceof Array)for(const c of g)e(c);else e(g);b.lastSelected=g}selectVariant(I,g){yI.SelectVariant(I,g)}static Reset(I){const g=this._GetExtensionMetadata(I);if(!g)throw new Error(`Cannot reset on a glTF mesh that does not have the ${tI} extension`);for(const b of g.original)b.mesh.material=b.material;g.lastSelected=null}reset(I){yI.Reset(I)}static GetLastSelectedVariant(I){const g=this._GetExtensionMetadata(I);if(!g)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tI} extension`);return g.lastSelected}getLastSelectedVariant(I){return yI.GetLastSelectedVariant(I)}static _GetExtensionMetadata(I){var g,b;return(null===I||void 0===I||null===(g=I._internalMetadata)||void 0===g||null===(b=g.Lg)||void 0===b?void 0:b[tI])||null}onLoading(){const I=this._loader.Lg.extensions;if(I&&I[this.name]){const g=I[this.name];this._variants=g.variants}}onReady(){const I=this._loader.rootBabylonMesh;if(I){var g;const b=this._loader.parent.extensionOptions[tI];null!==b&&void 0!==b&&b.defaultVariant&&yI.SelectVariant(I,b.defaultVariant),null===b||void 0===b||null===(g=b.onLoaded)||void 0===g||g.call(b,{get variants(){return yI.GetAvailableVariants(I)},get selectedVariant(){const g=yI.GetLastSelectedVariant(I);return g?Array.isArray(g)?g[0]:g:yI.GetAvailableVariants(I)[0]},set selectedVariant(g){yI.SelectVariant(I,g)}})}}_loadMeshPrimitiveAsync(I,g,b,e,c,z){return B.LoadExtensionAsync(I,c,this.name,(async(M,J)=>{const o=new Array;return o.push(this._loader._loadMeshPrimitiveAsync(I,g,b,e,c,(g=>{if(z(g),g instanceof s.e){const b=B._GetDrawMode(I,c.mode),e=this._loader.rootBabylonMesh,z=e?e._internalMetadata=e._internalMetadata||{}:{},n=z.Lg=z.Lg||{},G=n[tI]=n[tI]||{lastSelected:null,original:[],variants:{}};G.original.push({mesh:g,material:g.material});for(let I=0;I<J.mappings.length;++I){const c=J.mappings[I],z=N.Get(`${M}/mappings/${I}/material`,this._loader.Lg.materials,c.material);o.push(this._loader._loadMaterialAsync(`#/materials/${c.material}`,z,g,b,(I=>{for(let b=0;b<c.variants.length;++b){const z=c.variants[b],M=N.Get(`/extensions/${tI}/variants/${z}`,this._variants,z);G.variants[M.name]=G.variants[M.name]||[],G.variants[M.name].push({mesh:g,material:I}),g.onClonedObservable.add((I=>{const b=I;let c=null,z=b;do{if(z=z.parent,!z)return;c=yI._GetExtensionMetadata(z)}while(null===c);if(e&&c===yI._GetExtensionMetadata(e)){z._internalMetadata={};for(const I in e._internalMetadata)z._internalMetadata[I]=e._internalMetadata[I];z._internalMetadata.Lg=[];for(const I in e._internalMetadata.Lg)z._internalMetadata.Lg[I]=e._internalMetadata.Lg[I];z._internalMetadata.Lg[tI]={lastSelected:null,original:[],variants:{}};for(const I of c.original)z._internalMetadata.Lg[tI].original.push({mesh:I.mesh,material:I.material});for(const I in c.variants)if(Object.prototype.hasOwnProperty.call(c.variants,I)){z._internalMetadata.Lg[tI].variants[I]=[];for(const g of c.variants[I])z._internalMetadata.Lg[tI].variants[I].push({mesh:g.mesh,material:g.material})}c=z._internalMetadata.Lg[tI]}for(const e of c.original)e.mesh===g&&(e.mesh=b);for(const e of c.variants[M.name])e.mesh===g&&(e.mesh=b)}))}})))}}}))),await Promise.all(o).then((I=>{let[g]=I;return g}))}))}}A(tI),h(tI,!0,(I=>new yI(I)));var qI=b(12650);class lI{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:NI.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(I,g){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...lI._GetDefaultOptions(),...I},this._scene=g,this._scene._transmissionHelper=this,this.onErrorObservable=new G.c,this._scene.Og.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(I){if(!Object.keys(I).filter((g=>this._options[g]!==I[g])).length)return;const g={...this._options,...I},b=this._options;this._options=g,g.renderSize===b.renderSize&&g.renderTargetTextureType===b.renderTargetTextureType&&g.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=g.samples,this._opaqueRenderTarget.lodGenerationScale=g.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=g.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(I){return!!I&&!!(I instanceof a.b&&I.subSurface.isRefractionEnabled)}_addMesh(I){this._materialObservers[I.uniqueId]=I.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),M.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(I.material)?(I.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(I)&&this._transparentMeshesCache.push(I)):-1===this._opaqueMeshesCache.indexOf(I)&&this._opaqueMeshesCache.push(I)}))}_removeMesh(I){I.onMaterialChangedObservable.remove(this._materialObservers[I.uniqueId]),delete this._materialObservers[I.uniqueId];let g=this._transparentMeshesCache.indexOf(I);-1!==g&&this._transparentMeshesCache.splice(g,1),g=this._opaqueMeshesCache.indexOf(I),-1!==g&&this._opaqueMeshesCache.splice(g,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(I){const g=this._transparentMeshesCache.indexOf(I),b=this._opaqueMeshesCache.indexOf(I);this._shouldRenderAsTransmission(I.material)?(I.material instanceof a.b&&(I.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(I)):-1===g&&this._transparentMeshesCache.push(I)):-1!==g?(this._transparentMeshesCache.splice(g,1),this._opaqueMeshesCache.push(I)):-1===b&&this._opaqueMeshesCache.push(I)}_isRenderTargetValid(){var I;return null!==(null===(I=this._opaqueRenderTarget)||void 0===I?void 0:I.getInternalTexture())}_setupRenderTargets(){var I;let g;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new qI.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(I=this._options.clearColor)||void 0===I?void 0:I.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((I=>{g=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?I.clearColor.G(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(I.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=g}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const wI="KHR_materials_transmission";class TI{constructor(I){this.name=wI,this.order=175,this._loader=I,this.enabled=this._loader.isExtensionUsed(wI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadTransparentPropertiesAsync(e,g,b,c)),await Promise.all(z).then((()=>{}))}))}_loadTransparentPropertiesAsync(I,g,b,e){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const c=b;if(c.subSurface.isRefractionEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.useAlbedoToTintRefraction=!0,void 0===e.transmissionFactor)return c.subSurface.refractionIntensity=0,c.subSurface.isRefractionEnabled=!1,Promise.resolve();{var z;c.subSurface.refractionIntensity=e.transmissionFactor;const I=c.EI();if(c.subSurface.refractionIntensity&&!I._transmissionHelper)new lI({},c.EI());else if(c.subSurface.refractionIntensity&&(null===(z=I._transmissionHelper)||void 0===z||!z._isRenderTargetValid())){var M;null===(M=I._transmissionHelper)||void 0===M||M._setupRenderTargets()}}return c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,e.transmissionTexture?(e.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/transmissionTexture`,e.transmissionTexture,void 0).then((I=>{I.name=`${b.name} (Transmission)`,c.subSurface.refractionIntensityTexture=I,c.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}A(wI),h(wI,!0,(I=>new TI(I)));const WI="KHR_materials_diffuse_transmission";class Ig{constructor(I){this.name=WI,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(WI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadTranslucentPropertiesAsync(e,g,b,c)),await Promise.all(z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(I,g,b,e){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const c=b;if(c.subSurface.isTranslucencyEnabled=!0,c.subSurface.volumeIndexOfRefraction=1,c.subSurface.minimumThickness=0,c.subSurface.maximumThickness=0,c.subSurface.useAlbedoToTintTranslucency=!1,void 0===e.diffuseTransmissionFactor)return c.subSurface.translucencyIntensity=0,c.subSurface.isTranslucencyEnabled=!1,Promise.resolve();c.subSurface.translucencyIntensity=e.diffuseTransmissionFactor;const M=new Array;return c.subSurface.useGltfStyleTextures=!0,e.diffuseTransmissionTexture&&(e.diffuseTransmissionTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionTexture`,e.diffuseTransmissionTexture).then((I=>{I.name=`${b.name} (Diffuse Transmission)`,c.subSurface.translucencyIntensityTexture=I})))),void 0!==e.diffuseTransmissionColorFactor?c.subSurface.translucencyColor=z.Eg.mb(e.diffuseTransmissionColorFactor):c.subSurface.translucencyColor=z.Eg.White(),e.diffuseTransmissionColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionColorTexture`,e.diffuseTransmissionColorTexture).then((I=>{I.name=`${b.name} (Diffuse Transmission Color)`,c.subSurface.translucencyColorTexture=I}))),Promise.all(M).then((()=>{}))}}A(WI),h(WI,!0,(I=>new Ig(I)));const gg="KHR_materials_volume";class bg{constructor(I){this.name=gg,this.order=173,this._loader=I,this.enabled=this._loader.isExtensionUsed(gg),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadVolumePropertiesAsync(e,g,b,c)),await Promise.all(z).then((()=>{}))}))}_loadVolumePropertiesAsync(I,g,b,e){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!e.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const c=void 0!==e.attenuationDistance?e.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=c,void 0!==e.attenuationColor&&3==e.attenuationColor.length&&b.subSurface.tintColor.Db(e.attenuationColor[0],e.attenuationColor[1],e.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=e.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,e.thicknessTexture?(e.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/thicknessTexture`,e.thicknessTexture).then((I=>{I.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=I,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}A(gg),h(gg,!0,(I=>new bg(I)));const eg="KHR_materials_dispersion";class cg{constructor(I){this.name=eg,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(eg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadDispersionPropertiesAsync(e,g,b,c)),await Promise.all(z).then((()=>{}))}))}_loadDispersionPropertiesAsync(I,g,b,e){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);return b.subSurface.isRefractionEnabled&&e.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=e.dispersion,Promise.resolve()):Promise.resolve()}}A(eg),h(eg,!0,(I=>new cg(I)));const zg="EXT_materials_diffuse_roughness";class Mg{constructor(I){this.name=zg,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(zg)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,g,b)),z.push(this._loadDiffuseRoughnessPropertiesAsync(e,c,b)),await Promise.all(z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(I,g,b){if(!(b instanceof a.b))throw new Error(`${I}: Material type not supported`);const e=new Array;return b.brdf.baseDiffuseModel=NI.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=g.diffuseRoughnessFactor?b.baseDiffuseRoughness=g.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,g.diffuseRoughnessTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/diffuseRoughnessTexture`,g.diffuseRoughnessTexture,(I=>{I.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=I}))),Promise.all(e).then((()=>{}))}}A(zg),h(zg,!0,(I=>new Mg(I)));const Jg="KHR_mesh_quantization";class og{constructor(I){this.name=Jg,this.enabled=I.isExtensionUsed(Jg)}dispose(){}}A(Jg),h(Jg,!0,(I=>new og(I)));const ng="KHR_texture_basisu";class Gg{constructor(I){this.name=ng,this._loader=I,this.enabled=I.isExtensionUsed(ng)}dispose(){this._loader=null}_loadTextureAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>{const z=void 0==g.sampler?B.DefaultSampler:N.Get(`${I}/sampler`,this._loader.Lg.samplers,g.sampler),M=N.Get(`${e}/source`,this._loader.Lg.images,c.source);return await this._loader._createTextureAsync(I,z,M,(I=>{b(I)}),g._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!g._textureInfo.nonColorData)}))}}A(ng),h(ng,!0,(I=>new Gg(I)));const Dg="KHR_texture_transform";class pg{constructor(I){this.name=Dg,this._loader=I,this.enabled=this._loader.isExtensionUsed(Dg)}dispose(){this._loader=null}loadTextureInfoAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(e,c)=>await this._loader.loadTextureInfoAsync(I,g,(I=>{if(!(I instanceof v.b))throw new Error(`${e}: Texture type not supported`);c.offset&&(I.uOffset=c.offset[0],I.vOffset=c.offset[1]),I.uRotationCenter=0,I.vRotationCenter=0,c.rotation&&(I.wAng=-c.rotation),c.scale&&(I.uScale=c.scale[0],I.vScale=c.scale[1]),void 0!=c.texCoord&&(I.coordinatesIndex=c.texCoord),b(I)}))))}}A(Dg),h(Dg,!0,(I=>new pg(I)));const xg="KHR_xmp_json_ld";class Zg{constructor(I){this.name=xg,this.order=100,this._loader=I,this.enabled=this._loader.isExtensionUsed(xg)}dispose(){this._loader=null}onLoading(){var I,g,b;if(null===this._loader.rootBabylonMesh)return;const e=null===(I=this._loader.Lg.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld,c=null===(g=this._loader.Lg.asset)||void 0===g||null===(b=g.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(e&&c){const I=+c.packet;e.packets&&I<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[I])}}}function kg(I,g,b,e){return z.Eg.mb(g,b).scale(e)}function Sg(I,g,b,e){return g[b]*e}function fg(I,g,b,e){return-g[b]*e}function Vg(I,g,b,e){return g[b+1]*e}function ag(I,g,b,e){return g[b]*e*2}function vg(I){return{scale:[new Rg(p.e.ANIMATIONTYPE_FLOAT,`${I}.uScale`,Sg,(()=>2)),new Rg(p.e.ANIMATIONTYPE_FLOAT,`${I}.vScale`,Vg,(()=>2))],offset:[new Rg(p.e.ANIMATIONTYPE_FLOAT,`${I}.uOffset`,Sg,(()=>2)),new Rg(p.e.ANIMATIONTYPE_FLOAT,`${I}.vOffset`,Vg,(()=>2))],rotation:[new Rg(p.e.ANIMATIONTYPE_FLOAT,`${I}.wAng`,fg,(()=>1))]}}A(xg),h(xg,!0,(I=>new Zg(I)));class Xg extends P.AnimationPropertyInfo{buildAnimations(I,g,b,e){return[{babylonAnimatable:I._babylonCamera,babylonAnimation:this._buildAnimation(g,b,e)}]}}class Rg extends P.AnimationPropertyInfo{buildAnimations(I,g,b,e){const c=[];for(const z in I._data)c.push({babylonAnimatable:I._data[z].babylonMaterial,babylonAnimation:this._buildAnimation(g,b,e)});return c}}class Eg extends P.AnimationPropertyInfo{buildAnimations(I,g,b,e){return[{babylonAnimatable:I._babylonLight,babylonAnimation:this._buildAnimation(g,b,e)}]}}(0,j.l)("/cameras/{}/orthographic/xmag",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"orthoLeft",fg,(()=>1)),new Xg(p.e.ANIMATIONTYPE_FLOAT,"orthoRight",Vg,(()=>1))]),(0,j.l)("/cameras/{}/orthographic/ymag",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"orthoBottom",fg,(()=>1)),new Xg(p.e.ANIMATIONTYPE_FLOAT,"orthoTop",Vg,(()=>1))]),(0,j.l)("/cameras/{}/orthographic/zfar",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"maxZ",Sg,(()=>1))]),(0,j.l)("/cameras/{}/orthographic/znear",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"cb",Sg,(()=>1))]),(0,j.l)("/cameras/{}/perspective/yfov",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"fov",Sg,(()=>1))]),(0,j.l)("/cameras/{}/perspective/zfar",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"maxZ",Sg,(()=>1))]),(0,j.l)("/cameras/{}/perspective/znear",[new Xg(p.e.ANIMATIONTYPE_FLOAT,"cb",Sg,(()=>1))]),(0,j.l)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"albedoColor",kg,(()=>4)),new Rg(p.e.ANIMATIONTYPE_FLOAT,"alpha",(function(I,g,b,e){return g[b+3]*e}),(()=>4))]),(0,j.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"metallic",Sg,(()=>1))]),(0,j.l)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"roughness",Sg,(()=>1))]);const mb=vg("albedoTexture");(0,j.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",mb.scale),(0,j.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",mb.offset),(0,j.l)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",mb.rotation);const sg=vg("metallicTexture");(0,j.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",sg.scale),(0,j.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",sg.offset),(0,j.l)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",sg.rotation),(0,j.l)("/materials/{}/emissiveFactor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"emissiveColor",kg,(()=>3))]);const Fg=vg("bumpTexture");(0,j.l)("/materials/{}/normalTexture/scale",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Sg,(()=>1))]),(0,j.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Fg.scale),(0,j.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Fg.offset),(0,j.l)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Fg.rotation),(0,j.l)("/materials/{}/occlusionTexture/strength",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Sg,(()=>1))]);const Yg=vg("ambientTexture");(0,j.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Yg.scale),(0,j.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Yg.offset),(0,j.l)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Yg.rotation);const dg=vg("emissiveTexture");(0,j.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",dg.scale),(0,j.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",dg.offset),(0,j.l)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",dg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Sg,(()=>1))]);const Cg=vg("anisotropy.texture");(0,j.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Cg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Cg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Cg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Sg,(()=>1))]);const rg=vg("clearCoat.texture");(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",rg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",rg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",rg.rotation);const Og=vg("clearCoat.bumpTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Og.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Og.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Og.rotation);const Hg=vg("clearCoat.textureRoughness");(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Hg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Hg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Hg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_ior/ior",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Sg,(()=>1))]);const ig=vg("iridescence.texture");(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",ig.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",ig.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",ig.rotation);const Ug=vg("iridescence.thicknessTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ug.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ug.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ug.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"sheen.color",kg,(()=>3))]),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Sg,(()=>1))]);const hg=vg("sheen.texture");(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",hg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",hg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",hg.rotation);const Ag=vg("sheen.textureRoughness");(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Ag.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Ag.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Ag.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",kg,(()=>3))]);const jg=vg("metallicReflectanceTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",jg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",jg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",jg.rotation);const Qg=vg("reflectanceTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Qg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Qg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Qg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Sg,(()=>1))]);const Lg=vg("subSurface.refractionIntensityTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Lg.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Lg.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Lg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",kg,(()=>3))]),(0,j.l)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Sg,(()=>1))]),(0,j.l)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Sg,(()=>1))]);const Ng=vg("subSurface.thicknessTexture");(0,j.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ng.scale),(0,j.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ng.offset),(0,j.l)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ng.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Rg(p.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Sg,(()=>1))]);const Kg=vg("subSurface.translucencyIntensityTexture");(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Kg.scale),(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Kg.offset),(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Kg.rotation),(0,j.l)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Rg(p.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",kg,(()=>3))]);const Bg=vg("subSurface.translucencyColorTexture");(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Bg.scale),(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Bg.offset),(0,j.l)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Bg.rotation),(0,j.l)("/extensions/KHR_lights_punctual/lights/{}/color",[new Eg(p.e.ANIMATIONTYPE_COLOR3,"diffuse",kg,(()=>3))]),(0,j.l)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Eg(p.e.ANIMATIONTYPE_FLOAT,"intensity",Sg,(()=>1))]),(0,j.l)("/extensions/KHR_lights_punctual/lights/{}/range",[new Eg(p.e.ANIMATIONTYPE_FLOAT,"range",Sg,(()=>1))]),(0,j.l)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Eg(p.e.ANIMATIONTYPE_FLOAT,"innerAngle",ag,(()=>1))]),(0,j.l)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Eg(p.e.ANIMATIONTYPE_FLOAT,"angle",ag,(()=>1))]),(0,j.l)("/nodes/{}/extensions/EXT_lights_ies/color",[new Eg(p.e.ANIMATIONTYPE_COLOR3,"diffuse",kg,(()=>3))]),(0,j.l)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Eg(p.e.ANIMATIONTYPE_FLOAT,"intensity",Sg,(()=>1))]);const Pg="KHR_animation_pointer";class ug{constructor(I){this.name=Pg,this._loader=I,this._pathToObjectConverter=(0,j.h)(this._loader.Lg)}get enabled(){return this._loader.isExtensionUsed(Pg)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(I,g,b,e,c){var z;const M=null===(z=e.target.extensions)||void 0===z?void 0:z.KHR_animation_pointer;if(!M||!this._pathToObjectConverter)return null;"pointer"!==e.target.path&&k.b.Warn(`${I}/target/path: Value (${e.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=e.target.node&&k.b.Warn(`${I}/target/node: Value (${e.target.node}) must not be present when using the ${this.name} extension`);const J=`${I}/extensions/${this.name}`,o=M.pointer;if(!o)throw new Error(`${J}: Pointer is missing`);try{const z=this._pathToObjectConverter.convert(o);if(!z.info.interpolation)throw new Error(`${J}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(I,g,b,e,{object:z.object,info:z.info.interpolation},c)}catch(n){return k.b.Warn(`${J}/pointer: Invalid pointer (${o}) skipped`),null}}}A(Pg),h(Pg,!0,(I=>new ug(I)));class tg{constructor(I,g,b){this.frame=I,this.action=g,this.onlyOnce=b,this.isDone=!1}_clone(){return new tg(this.frame,this.action,this.onlyOnce)}}var yg=b(12437),qg=b(12497),lg=b(12488);class wg{get loop(){return this._loop}set loop(I){I!==this._loop&&(this._loop=I,this.updateOptions({loop:I}))}get currentTime(){var I;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(I=qg.c.audioEngine)&&void 0!==I&&I.audioContext&&(this.isPlaying||this.isPaused)){const I=this.isPaused?0:qg.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+I}return 0}get spatialSound(){return this._spatialSound}set spatialSound(I){if(I==this._spatialSound)return;const g=this.isPlaying;this.pause(),I?(this._spatialSound=I,this._updateSpatialParameters()):this._disableSpatialSound(),g&&this.play()}constructor(I,g,b){var e;let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new G.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=c.Vg.Zero(),this._localDirection=new c.Vg(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=I,b=b||Z.b.LastCreatedScene)if(this._scene=b,wg._SceneComponentInitialization(b),this._readyToPlayCallback=z,this._customAttenuationFunction=(I,g,b,e,c)=>g<b?I*(1-g/b):0,J&&(this.autoplay=J.autoplay||!1,this._loop=J.loop||!1,void 0!==J.volume&&(this._volume=J.volume),this._spatialSound=J.spatialSound??!1,this.maxDistance=J.maxDistance??100,this.useCustomAttenuation=J.useCustomAttenuation??!1,this.rolloffFactor=J.rolloffFactor||1,this.refDistance=J.refDistance||1,this.distanceModel=J.distanceModel||"linear",this._playbackRate=J.playbackRate||1,this._streaming=J.streaming??!1,this._length=J.length,this._offset=J.offset),null!==(e=qg.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&qg.c.audioEngine.audioContext){this._soundGain=qg.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let I=!0;if(g)try{"string"===typeof g?(this._urlType="String",this._url=g):g instanceof ArrayBuffer?this._urlType="ArrayBuffer":g instanceof HTMLMediaElement?this._urlType="MediaElement":g instanceof MediaStream?this._urlType="MediaStream":g instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(g)&&(this._urlType="Array");let b=[],e=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qg.c.audioEngine.audioContext.createMediaElementSource(g),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qg.c.audioEngine.audioContext.createMediaStreamSource(g),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":g.byteLength>0&&(e=!0,this._soundLoaded(g));break;case"AudioBuffer":this._audioBufferLoaded(g);break;case"String":b.push(g);case"Array":0===b.length&&(b=g);for(let I=0;I<b.length;I++){const g=b[I];if(e=J&&J.skipCodecCheck||-1!==g.indexOf(".mp3",g.length-4)&&qg.c.audioEngine.isMP3supported||-1!==g.indexOf(".ogg",g.length-4)&&qg.c.audioEngine.isOGGsupported||-1!==g.indexOf(".wav",g.length-4)||-1!==g.indexOf(".m4a",g.length-4)||-1!==g.indexOf(".mp4",g.length-4)||-1!==g.indexOf("blob:"),e){this._streaming?(this._htmlAudioElement=new Audio(g),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,M.Tools.SetCorsBehavior(g,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(g,(I=>{this._soundLoaded(I)}),void 0,!0,!0,(I=>{I&&k.b.Error("XHR "+I.status+" error on: "+g+"."),k.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:I=!1}I?e||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):k.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(o){k.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),qg.c.audioEngine&&!qg.c.audioEngine.WarnedWebAudioUnsupported&&(k.b.Error("Web Audio is not supported by your browser."),qg.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var I;null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(I){var g;null!==(g=qg.c.audioEngine)&&void 0!==g&&g.audioContext&&(this._audioBuffer=I,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(I){var g;null!==(g=qg.c.audioEngine)&&void 0!==g&&g.audioContext&&qg.c.audioEngine.audioContext.decodeAudioData(I,(I=>{this._audioBufferLoaded(I)}),(I=>{k.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+I)}))}setAudioBuffer(I){var g;null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&(this._audioBuffer=I,this._isReadyToPlay=!0)}updateOptions(I){I&&(this.loop=I.loop??this.loop,this.maxDistance=I.maxDistance??this.maxDistance,this.useCustomAttenuation=I.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=I.rolloffFactor??this.rolloffFactor,this.refDistance=I.refDistance??this.refDistance,this.distanceModel=I.distanceModel??this.distanceModel,this._playbackRate=I.playbackRate??this._playbackRate,this._length=I.length??void 0,this.spatialSound=I.spatialSound??this._spatialSound,this._setOffset(I.offset??void 0),this.setVolume(I.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var I;null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&qg.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??qg.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var I;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(I=this._soundPanner)||void 0===I||I.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var I;null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(I){var g;null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(I),this._isOutputConnected=!0)}setDirectionalCone(I,g,b){g<I?k.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=I,this._coneOuterAngle=g,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!=this._coneInnerAngle){var g;if(this._coneOuterAngle<I)return void k.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I,null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!=this._coneOuterAngle){var g;if(I<this._coneInnerAngle)return void k.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I,null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(I){var g;I.equals(this._position)||(this._position.G(I),null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(I){var g;this._localDirection=I,null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const I=this._connectedTransformNode.getWorldMatrix(),g=c.Vg.TransformNormal(this._localDirection,I);g.normalize(),this._soundPanner.orientationX.value=g.x,this._soundPanner.orientationY.value=g.y,this._soundPanner.orientationZ.value=g.z}updateDistanceFromListener(){var I;if(null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const I=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.ag(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,I,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(I){this._customAttenuationFunction=I}play(I,g,b){var e;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(e=qg.c.audioEngine)&&void 0!==e&&e.audioContext)try{var c,z;this._clearTimeoutsAndObservers();let e=I?(null===(c=qg.c.audioEngine)||void 0===c?void 0:c.audioContext.currentTime)+I:null===(z=qg.c.audioEngine)||void 0===z?void 0:z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=qg.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const I=()=>{var b;if(null!==(b=qg.c.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=g??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var g,b;(null===(g=qg.c.audioEngine)||void 0===g||g.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=qg.c.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{I()})))}))}else{var e;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(e=qg.c.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{I()}))}};I()}}else{var M;const c=()=>{var c;if(null!==(c=qg.c.audioEngine)&&void 0!==c&&c.audioContext){var z;if(b=b||this._length,void 0!==g&&this._setOffset(g),this._soundSource){const I=this._soundSource;I.onended=()=>{I.disconnect()}}if(this._soundSource=null===(z=qg.c.audioEngine)||void 0===z?void 0:z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var M;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==g&&(this._soundSource.loopStart=g),void 0!==b&&(this._soundSource.loopEnd=(0|g)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},e=I?(null===(M=qg.c.audioEngine)||void 0===M?void 0:M.audioContext.currentTime)+I:qg.c.audioEngine.audioContext.currentTime;const c=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(e,c,this.loop?void 0:b)}}};"suspended"===(null===(M=qg.c.audioEngine)||void 0===M?void 0:M.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var I;"suspended"===(null===(I=qg.c.audioEngine)||void 0===I?void 0:I.audioContext.state)?(qg.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=qg.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{c()})))):c()}),500):c()}this._startTime=e,this.isPlaying=!0,this.isPaused=!1}catch(J){k.b.Error("Error while trying to play audio: "+this.name+", "+J.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(I){var g;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(g=qg.c.audioEngine)&&void 0!==g&&g.audioContext&&this._soundSource){const g=I?qg.c.audioEngine.audioContext.currentTime+I:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(g)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var g;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(g=this._streamingSource)||void 0===g||g.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(I=qg.c.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=qg.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(I,g){var b;null!==(b=qg.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(g&&qg.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(qg.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,qg.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(I,qg.c.audioEngine.audioContext.currentTime+g)):this._soundGain.gain.value=I),this._volume=I}setPlaybackRate(I){this._playbackRate=I,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(I){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=I,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=I=>this._onRegisterAfterWorldMatrixUpdate(I),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(I){var g;if(I.getBoundingInfo){const g=I.getBoundingInfo();this.setPosition(g.boundingSphere.centerWorld)}else this.setPosition(I.absolutePosition);null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const I=()=>{(0,lg.e)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},g={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new wg(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,g);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),I(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const I={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(I.connectedMeshId=this._connectedTransformNode.id),I.position=this._position.bb(),I.refDistance=this.refDistance,I.distanceModel=this.distanceModel,I.isDirectional=this._isDirectional,I.localDirectionToMesh=this._localDirection.bb(),I.coneInnerAngle=this._coneInnerAngle,I.coneOuterAngle=this._coneOuterAngle,I.coneOuterGain=this._coneOuterGain),I}static Parse(I,g,b,e){const z=I.name;let M;M=I.url?b+I.url:b+z;const J={autoplay:I.autoplay,loop:I.loop,volume:I.volume,spatialSound:I.spatialSound,maxDistance:I.maxDistance,rolloffFactor:I.rolloffFactor,refDistance:I.refDistance,distanceModel:I.distanceModel,playbackRate:I.playbackRate};let o;if(e){const I=()=>{(0,lg.e)((()=>e._isReadyToPlay),(()=>{o._audioBuffer=e.getAudioBuffer(),o._isReadyToPlay=!0,o.autoplay&&o.play(0,o._offset,o._length)}),void 0,300)};o=new wg(z,new ArrayBuffer(0),g,null,J),I()}else o=new wg(z,M,g,(()=>{g.removePendingData(o)}),J),g.addPendingData(o);if(I.position){const g=c.Vg.mb(I.position);o.setPosition(g)}if(I.isDirectional&&(o.setDirectionalCone(I.coneInnerAngle||360,I.coneOuterAngle||360,I.coneOuterGain||0),I.localDirectionToMesh)){const g=c.Vg.mb(I.localDirectionToMesh);o.setLocalDirectionToMesh(g)}if(I.connectedMeshId){const b=g.getMeshById(I.connectedMeshId);b&&o.attachToMesh(b)}return I.metadata&&(o.metadata=I.metadata),o}_setOffset(I){this._offset!==I&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=I)}_clearTimeoutsAndObservers(){var I;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(I=qg.c.audioEngine)||void 0===I||I.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}wg._SceneComponentInitialization=I=>{throw(0,yg.c)("AudioSceneComponent")},(0,RI.g)("BABYLON.Sound",wg);class Tg{constructor(I,g,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],g.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=I,this._weights=b;let e=0;for(const z of b)e+=z;const c=e>0?1/e:0;for(let z=0;z<this._weights.length;z++)this._weights[z]*=c;this._sounds=g;for(const z of this._sounds)z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!==this._coneInnerAngle){if(this._coneOuterAngle<I)return void k.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I;for(const g of this._sounds)g.directionalConeInnerAngle=I}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!==this._coneOuterAngle){if(I<this._coneInnerAngle)return void k.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I;for(const g of this._sounds)g.directionalConeOuterAngle=I}}get volume(){return this._volume}set volume(I){if(I!==this._volume)for(const g of this._sounds)g.setVolume(I)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(I){if(!this.isPaused){this.stop();const I=Math.random();let g=0;for(let b=0;b<this._weights.length;b++)if(g+=this._weights[b],I<=g){this._currentIndex=b;break}}const g=this._sounds[this._currentIndex??0];g.isReady()?g.play(0,this.isPaused?void 0:I):g.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Wg{constructor(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(I=I||Z.b.LastCreatedScene)&&(this._scene=I,this.soundCollection=[],this._options=g,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var I;null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&qg.c.audioEngine.audioContext&&(this._outputAudioNode=qg.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(qg.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(qg.c.audioEngine&&qg.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(I){var g;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&I.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==I.soundTrackId&&(-1===I.soundTrackId?this._scene.mainSoundTrack.removeSound(I):this._scene.soundTracks&&this._scene.soundTracks[I.soundTrackId].removeSound(I)),this.soundCollection.push(I),I.soundTrackId=this.id}removeSound(I){const g=this.soundCollection.indexOf(I);-1!==g&&this.soundCollection.splice(g,1)}setVolume(I){var g;null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=I)}switchPanningModelToHRTF(){var I;if(null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let g=0;g<this.soundCollection.length;g++)this.soundCollection[g].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var I;if(null!==(I=qg.c.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let g=0;g<this.soundCollection.length;g++)this.soundCollection[g].switchPanningModelToEqualPower()}connectToAnalyser(I){var g;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=I,null!==(g=qg.c.audioEngine)&&void 0!==g&&g.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,qg.c.audioEngine.masterGain))}}var Ib=b(12849),gb=b(12814),bb=b(12417);qg.c.AudioEngineFactory=(I,g,b)=>new eb(I,g,b);class eb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new G.c,this.onAudioLockedObservable=new G.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,bb.g)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const e=document.createElement("audio");this._hostElement=I,this._audioContext=g,this._audioDestination=b;try{e&&e.canPlayType&&(e.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||e.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(c){}try{e&&e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(c){}}lock(){this._triggerSuspendedState()}unlock(){var I,g;if("running"===(null===(I=this._audioContext)||void 0===I?void 0:I.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(g=this._audioContext)||void 0===g||g.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{k.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var I;null===(I=this._audioContext)||void 0===I||I.addEventListener("statechange",(()=>{var I;this.unlocked&&"running"!==(null===(I=this._audioContext)||void 0===I?void 0:I.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var I;return null!==(I=this._audioContext)&&void 0!==I&&I.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(I){this.canUseWebAudio=!1,k.b.Error("Web Audio: "+I.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(I){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const I=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",g=document.createElement("style");g.appendChild(document.createTextNode(I)),document.getElementsByTagName("head")[0].appendChild(g),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var I;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(I=this._audioContext)||void 0===I||I.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(I){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=I)}connectToAnalyser(I){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=I,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var cb=b(12433);(0,b(13953).g)(Ib.b.NAME_AUDIO,((I,g,b,e)=>{let c,z=[];if(b.fZ=b.fZ||[],void 0!==I.fZ&&null!==I.fZ)for(let J=0,o=I.fZ.length;J<o;J++){var M;const o=I.fZ[J];null!==(M=qg.c.audioEngine)&&void 0!==M&&M.canUseWebAudio?(o.url||(o.url=o.name),z[o.url]?b.fZ.push(wg.Parse(o,g,e,z[o.url])):(c=wg.Parse(o,g,e),z[o.url]=c,b.fZ.push(c))):b.fZ.push(new wg(o.name,null,g))}z=[]})),Object.defineProperty(gb.c.prototype,"mainSoundTrack",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),this._mainSoundTrack||(this._mainSoundTrack=new Wg(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),gb.c.prototype.getSoundByName=function(I){let g;for(g=0;g<this.mainSoundTrack.soundCollection.length;g++)if(this.mainSoundTrack.soundCollection[g].name===I)return this.mainSoundTrack.soundCollection[g];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(g=0;g<this.soundTracks[b].soundCollection.length;g++)if(this.soundTracks[b].soundCollection[g].name===I)return this.soundTracks[b].soundCollection[g];return null},Object.defineProperty(gb.c.prototype,"audioEnabled",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),I.audioEnabled},set:function(I){let g=this._getComponent(Ib.b.NAME_AUDIO);g||(g=new zb(this),this.sg(g)),I?g.enableAudio():g.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(gb.c.prototype,"headphone",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),I.headphone},set:function(I){let g=this._getComponent(Ib.b.NAME_AUDIO);g||(g=new zb(this),this.sg(g)),I?g.switchAudioModeForHeadphones():g.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(gb.c.prototype,"audioListenerPositionProvider",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),I.audioListenerPositionProvider},set:function(I){let g=this._getComponent(Ib.b.NAME_AUDIO);if(g||(g=new zb(this),this.sg(g)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");g.audioListenerPositionProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(gb.c.prototype,"audioListenerRotationProvider",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),I.audioListenerRotationProvider},set:function(I){let g=this._getComponent(Ib.b.NAME_AUDIO);if(g||(g=new zb(this),this.sg(g)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");g.audioListenerRotationProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(gb.c.prototype,"audioPositioningRefreshRate",{get:function(){let I=this._getComponent(Ib.b.NAME_AUDIO);return I||(I=new zb(this),this.sg(I)),I.audioPositioningRefreshRate},set:function(I){let g=this._getComponent(Ib.b.NAME_AUDIO);g||(g=new zb(this),this.sg(g)),g.audioPositioningRefreshRate=I},enumerable:!0,configurable:!0});class zb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(I){this.name=Ib.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new c.Vg,this._cachedCameraPosition=new c.Vg,this._lastCheck=0,this._invertMatrixTemp=new c.Matrix,this._cameraDirectionTemp=new c.Vg,(I=I||Z.b.LastCreatedScene)&&(this.Xg=I,I.soundTracks=[],I.fZ=[])}register(){this.Xg._afterRenderStage.registerStep(Ib.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(I){if(I.fZ=[],this.Xg.soundTracks)for(let g=0;g<this.Xg.soundTracks.length;g++){const b=this.Xg.soundTracks[g];for(let g=0;g<b.soundCollection.length;g++)I.fZ.push(b.soundCollection[g].serialize())}}addFromContainer(I){if(I.fZ)for(const g of I.fZ)g.play(),g.autoplay=!0,this.Xg.mainSoundTrack.addSound(g)}removeFromContainer(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(I.fZ)for(const b of I.fZ)b.stop(),b.autoplay=!1,this.Xg.mainSoundTrack.removeSound(b),g&&b.dispose()}dispose(){const I=this.Xg;if(I._mainSoundTrack&&I.mainSoundTrack.dispose(),I.soundTracks)for(let g=0;g<I.soundTracks.length;g++)I.soundTracks[g].dispose()}disableAudio(){const I=this.Xg;let g;for(this._audioEnabled=!1,qg.c.audioEngine&&qg.c.audioEngine.audioContext&&qg.c.audioEngine.audioContext.suspend(),g=0;g<I.mainSoundTrack.soundCollection.length;g++)I.mainSoundTrack.soundCollection[g].pause();if(I.soundTracks)for(g=0;g<I.soundTracks.length;g++)for(let b=0;b<I.soundTracks[g].soundCollection.length;b++)I.soundTracks[g].soundCollection[b].pause()}enableAudio(){const I=this.Xg;let g;for(this._audioEnabled=!0,qg.c.audioEngine&&qg.c.audioEngine.audioContext&&qg.c.audioEngine.audioContext.resume(),g=0;g<I.mainSoundTrack.soundCollection.length;g++)I.mainSoundTrack.soundCollection[g].isPaused&&I.mainSoundTrack.soundCollection[g].play();if(I.soundTracks)for(g=0;g<I.soundTracks.length;g++)for(let b=0;b<I.soundTracks[g].soundCollection.length;b++)I.soundTracks[g].soundCollection[b].isPaused&&I.soundTracks[g].soundCollection[b].play()}switchAudioModeForHeadphones(){const I=this.Xg;if(this._headphone=!0,I.mainSoundTrack.switchPanningModelToHRTF(),I.soundTracks)for(let g=0;g<I.soundTracks.length;g++)I.soundTracks[g].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const I=this.Xg;if(this._headphone=!1,I.mainSoundTrack.switchPanningModelToEqualPower(),I.soundTracks)for(let g=0;g<I.soundTracks.length;g++)I.soundTracks[g].switchPanningModelToEqualPower()}_afterRender(){const I=cb.b.Now;if(this._lastCheck&&I-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=I;const g=this.Xg;if(!this._audioEnabled||!g._mainSoundTrack||!g.soundTracks||0===g._mainSoundTrack.soundCollection.length&&1===g.soundTracks.length)return;const b=qg.c.audioEngine;if(b&&b.audioContext){let I,e=g.activeCamera;if(g.activeCameras&&g.activeCameras.length>0&&(e=g.activeCameras[0]),this.audioListenerPositionProvider){const I=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(I.x||0,I.y||0,I.z||0)}else e?this._cachedCameraPosition.equals(e.globalPosition)||(this._cachedCameraPosition.G(e.globalPosition),b.audioContext.listener.setPosition(e.globalPosition.x,e.globalPosition.y,e.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const I=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(I.x||0,I.y||0,I.z||0,0,1,0)}else e?(e.rigCameras&&e.rigCameras.length>0&&(e=e.rigCameras[0]),e.getViewMatrix().invertToRef(this._invertMatrixTemp),c.Vg.TransformNormalToRef(zb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.G(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(I=0;I<g.mainSoundTrack.soundCollection.length;I++){const b=g.mainSoundTrack.soundCollection[I];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(g.soundTracks)for(I=0;I<g.soundTracks.length;I++)for(let b=0;b<g.soundTracks[I].soundCollection.length;b++){const e=g.soundTracks[I].soundCollection[b];e.useCustomAttenuation&&e.updateDistanceFromListener()}}}}zb._CameraDirection=new c.Vg(0,0,-1),wg._SceneComponentInitialization=I=>{let g=I._getComponent(Ib.b.NAME_AUDIO);g||(g=new zb(I),I.sg(g))};const Mb="MSFT_audio_emitter";class Jb{constructor(I){this.name=Mb,this._loader=I,this.enabled=this._loader.isExtensionUsed(Mb)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const I=this._loader.Lg.extensions;if(I&&I[this.name]){const g=I[this.name];this._clips=g.clips,this._emitters=g.emitters,N.Assign(this._clips),N.Assign(this._emitters)}}loadSceneAsync(I,g){return B.LoadExtensionAsync(I,g,this.name,(async(b,e)=>{const c=new Array;c.push(this._loader.loadSceneAsync(I,g));for(const I of e.emitters){const g=N.Get(`${b}/emitters`,this._emitters,I);if(void 0!=g.refDistance||void 0!=g.maxDistance||void 0!=g.rolloffFactor||void 0!=g.distanceModel||void 0!=g.innerAngle||void 0!=g.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);c.push(this._loadEmitterAsync(`${b}/emitters/${g.index}`,g))}await Promise.all(c)}))}loadNodeAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(I,e)=>{const z=new Array,J=await this._loader.loadNodeAsync(I,g,(g=>{for(const b of e.emitters){const e=N.Get(`${I}/emitters`,this._emitters,b);z.push(this._loadEmitterAsync(`${I}/emitters/${e.index}`,e).then((()=>{for(const I of e._babylonSounds)I.attachToMesh(g),void 0==e.innerAngle&&void 0==e.outerAngle||(I.setLocalDirectionToMesh(c.Vg.Forward()),I.setDirectionalCone(2*M.Tools.ToDegrees(void 0==e.innerAngle?Math.PI:e.innerAngle),2*M.Tools.ToDegrees(void 0==e.outerAngle?Math.PI:e.outerAngle),0))})))}b(g)}));return await Promise.all(z),J}))}loadAnimationAsync(I,g){return B.LoadExtensionAsync(I,g,this.name,(async(b,e)=>{const c=await this._loader.loadAnimationAsync(I,g),z=new Array;N.Assign(e.events);for(const M of e.events)z.push(this._loadAnimationEventAsync(`${b}/events/${M.index}`,I,g,M,c));return await Promise.all(z),c}))}_loadClipAsync(I,g){if(g._objectURL)return g._objectURL;let b;if(g.uri)b=this._loader.loadUriAsync(I,g,g.uri);else{const e=N.Get(`${I}/bufferView`,this._loader.Lg.bufferViews,g.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}return g._objectURL=b.then((I=>URL.createObjectURL(new Blob([I],{type:g.mimeType})))),g._objectURL}_loadEmitterAsync(I,g){if(g._babylonSounds=g._babylonSounds||[],!g._babylonData){const I=new Array,b=g.name||`emitter${g.index}`,e={loop:!1,autoplay:!1,volume:void 0==g.volume?1:g.volume};for(let z=0;z<g.clips.length;z++){const c=`/extensions/${this.name}/clips`,M=N.Get(c,this._clips,g.clips[z].clip);I.push(this._loadClipAsync(`${c}/${g.clips[z].clip}`,M).then((I=>{const c=g._babylonSounds[z]=new wg(b,I,this._loader.babylonScene,null,e);c.refDistance=g.refDistance||1,c.maxDistance=g.maxDistance||256,c.rolloffFactor=g.rolloffFactor||1,c.distanceModel=g.distanceModel||"exponential"})))}const c=Promise.all(I).then((()=>{const I=g.clips.map((I=>I.weight||1)),b=new Tg(g.loop||!1,g._babylonSounds,I);g.innerAngle&&(b.directionalConeInnerAngle=2*M.Tools.ToDegrees(g.innerAngle)),g.outerAngle&&(b.directionalConeOuterAngle=2*M.Tools.ToDegrees(g.outerAngle)),g.volume&&(b.volume=g.volume),g._babylonData.sound=b}));g._babylonData={loaded:c}}return g._babylonData.loaded}_getEventAction(I,g,b,e,c){switch(b){case"play":return I=>{const b=(c||0)+(I-e);g.play(b)};case"stop":return()=>{g.stop()};case"pause":return()=>{g.pause()};default:throw new Error(`${I}: Unsupported action ${b}`)}}_loadAnimationEventAsync(I,g,b,e,c){if(0==c.targetedAnimations.length)return Promise.resolve();const z=c.targetedAnimations[0],M=e.cg,J=N.Get(`/extensions/${this.name}/emitters`,this._emitters,M);return this._loadEmitterAsync(I,J).then((()=>{const g=J._babylonData.sound;if(g){const b=new tg(e.time,this._getEventAction(I,g,e.action,e.time,e.startOffset));z.animation.addEvent(b),c.onAnimationGroupEndObservable.add((()=>{g.stop()})),c.onAnimationGroupPauseObservable.add((()=>{g.pause()}))}}))}}A(Mb),h(Mb,!0,(I=>new Jb(I)));const ob="MSFT_lod";class nb{constructor(I){var g;this.name=ob,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new G.c,this.onMaterialLODsLoadedObservable=new G.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=I,this.maxLODsToLoad=(null===(g=this._loader.parent.extensionOptions[ob])||void 0===g?void 0:g.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ob)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let I=0;I<this._nodePromiseLODs.length;I++){const g=Promise.all(this._nodePromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Node LOD ${I}`),this._loader.log(`Loaded node LOD ${I}`)),this.onNodeLODsLoadedObservable.notifyObservers(I),I!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${I+1}`),this._loadBufferLOD(this._nodeBufferLODs,I+1),this._nodeSignalLODs[I]&&this._nodeSignalLODs[I].resolve())}));this._loader._completePromises.push(g)}for(let I=0;I<this._materialPromiseLODs.length;I++){const g=Promise.all(this._materialPromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Material LOD ${I}`),this._loader.log(`Loaded material LOD ${I}`)),this.onMaterialLODsLoadedObservable.notifyObservers(I),I!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${I+1}`),this._loadBufferLOD(this._materialBufferLODs,I+1),this._materialSignalLODs[I]&&this._materialSignalLODs[I].resolve())}));this._loader._completePromises.push(g)}}loadSceneAsync(I,g){const b=this._loader.loadSceneAsync(I,g);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(I,g,b){return B.LoadExtensionAsync(I,g,this.name,(async(I,c)=>{let z;const M=this._getLODs(I,g,this._loader.Lg.nodes,c.ids);this._loader.logOpen(`${I}`);for(let g=0;g<M.length;g++){const I=M[g];0!==g&&(this._nodeIndexLOD=g,this._nodeSignalLODs[g]=this._nodeSignalLODs[g]||new e);const c=I=>{b(I),I.tz(!1)},J=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,c).then((I=>{if(0!==g){const I=M[g-1];I._babylonTransformNode&&(this._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return I.tz(!0),I}));this._nodePromiseLODs[g]=this._nodePromiseLODs[g]||[],0===g?z=J:(this._nodeIndexLOD=null,this._nodePromiseLODs[g].push(J))}return this._loader.logClose(),await z}))}_loadMaterialAsync(I,g,b,e,c){return this._nodeIndexLOD?null:B.LoadExtensionAsync(I,g,this.name,(async(I,z)=>{let M;const J=this._getLODs(I,g,this._loader.Lg.materials,z.ids);this._loader.logOpen(`${I}`);for(let g=0;g<J.length;g++){const I=J[g];0!==g&&(this._materialIndexLOD=g);const z=this._loader._loadMaterialAsync(`/materials/${I.index}`,I,b,e,(I=>{0===g&&c(I)})).then((I=>{if(0!==g){c(I);const b=J[g-1]._data;b[e]&&(this._disposeMaterials([b[e].babylonMaterial]),delete b[e])}return I}));this._materialPromiseLODs[g]=this._materialPromiseLODs[g]||[],0===g?M=z:(this._materialIndexLOD=null,this._materialPromiseLODs[g].push(z))}return this._loader.logClose(),await M}))}_loadUriAsync(I,g,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const c=this._nodeIndexLOD-1;return this._nodeSignalLODs[c]=this._nodeSignalLODs[c]||new e,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(I,g,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const c=this._materialIndexLOD-1;return this._materialSignalLODs[c]=this._materialSignalLODs[c]||new e,this._materialSignalLODs[c].promise.then((async()=>await this._loader.loadUriAsync(I,g,b)))}return null}loadBufferAsync(I,g,b,c){if(this._loader.parent.useRangeRequests&&!g.uri){if(!this._loader.bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);const g=async(I,g)=>{const z=b,M=z+c-1;let J=I[g];return J?(J.start=Math.min(J.start,z),J.end=Math.max(J.end,M)):(J={start:z,end:M,loaded:new e},I[g]=J),await J.loaded.promise.then((I=>new Uint8Array(I.buffer,I.byteOffset+b-J.start,c)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?g(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?g(this._materialBufferLODs,this._materialIndexLOD):g(this._bufferLODs,0)}return null}_loadBufferLOD(I,g){const b=I[g];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((I=>{b.loaded.resolve(I)}),(I=>{b.loaded.reject(I)})))}_getLODs(I,g,b,e){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const c=[];for(let z=e.length-1;z>=0;z--)if(c.push(N.Get(`${I}/ids/${e[z]}`,b,e[z])),c.length===this.maxLODsToLoad)return c;return c.push(g),c}_disposeTransformNode(I){const g=[],b=I.material;b&&g.push(b);for(const c of I.getChildMeshes())c.material&&g.push(c.material);I.dispose();const e=g.filter((I=>this._loader.babylonScene.meshes.every((g=>g.material!=I))));this._disposeMaterials(e)}_disposeMaterials(I){const g={};for(const b of I){for(const I of b.getActiveTextures())g[I.uniqueId]=I;b.dispose()}for(const b in g)for(const I of this._loader.babylonScene.materials)I.hasTexture(g[b])&&delete g[b];for(const b in g)g[b].dispose()}}A(ob),h(ob,!0,(I=>new nb(I)));const Gb="MSFT_minecraftMesh";class Db{constructor(I){this.name=Gb,this._loader=I,this.enabled=this._loader.isExtensionUsed(Gb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtraAsync(I,g,this.name,(async(e,c)=>{if(c){if(!(b instanceof a.b))throw new Error(`${e}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(I,g,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.Gb=b.forceDepthWrite,b.twoSidedLighting=!0,await c}}))}}A(Gb),h(Gb,!0,(I=>new Db(I)));const pb="MSFT_sRGBFactors";class xb{constructor(I){this.name=pb,this._loader=I,this.enabled=this._loader.isExtensionUsed(pb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,g,b){return B.LoadExtraAsync(I,g,this.name,(async(e,c)=>{if(c){if(!(b instanceof a.b))throw new Error(`${e}: Material type not supported`);const c=this._loader.loadMaterialPropertiesAsync(I,g,b),z=b.EI().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,z),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,z),await c}}))}}A(pb),h(pb,!0,(I=>new xb(I)));var Zb=b(14267);const kb={};var Sb=b(14306),fb=b(14291),Vb=b(14269),ab=b(14282);function vb(I,g){for(const b of I)for(const I of b.dataOutputs)if(I.uniqueId===g)return I;throw new Error("Could not find data out connection with unique id "+g)}function Xb(I,g){for(const b of I)if(b instanceof fb.e)for(const I of b.signalInputs)if(I.uniqueId===g)return I;throw new Error("Could not find signal in connection with unique id "+g)}async function Rb(I,g){const e=await Promise.all(I.allBlocks.map((async I=>{const g=function(I){switch(I){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(78),b.e(79)]).then(b.bind(b,15704))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(80).then(b.bind(b,15710))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(81).then(b.bind(b,15717))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(82).then(b.bind(b,15722))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(83).then(b.bind(b,15730))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(84).then(b.bind(b,15739))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(85).then(b.bind(b,15747))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(86).then(b.bind(b,15756))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(87).then(b.bind(b,15761))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(95).then(b.bind(b,15790))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(96).then(b.bind(b,15792))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(97).then(b.bind(b,15799))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(98).then(b.bind(b,15802))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(99).then(b.bind(b,15809))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(100).then(b.bind(b,15813))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(101).then(b.bind(b,15820))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(102).then(b.bind(b,15823))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(103).then(b.bind(b,15830))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(104).then(b.bind(b,15833))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(105).then(b.bind(b,15841))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(106).then(b.bind(b,15847))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(107).then(b.bind(b,15855))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(108).then(b.bind(b,15861))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(109).then(b.bind(b,15869))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(110).then(b.bind(b,15877))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(111).then(b.bind(b,15880))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(112).then(b.bind(b,15885))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(113).then(b.bind(b,15891))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(92).then(b.bind(b,15895))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(114).then(b.bind(b,15898))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(115).then(b.bind(b,15907))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(116).then(b.bind(b,15911))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(93).then(b.bind(b,15914))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(88).then(b.bind(b,15765))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,15923))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(89).then(b.bind(b,15780))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(90).then(b.bind(b,15787))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(91).then(b.bind(b,15927))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(117).then(b.bind(b,15932))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(118).then(b.bind(b,15941))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(119).then(b.bind(b,15946))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(120).then(b.bind(b,15951))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(121).then(b.bind(b,15957))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(122).then(b.bind(b,15962))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(123).then(b.bind(b,15964))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(124).then(b.bind(b,15967))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(125).then(b.bind(b,15974))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(126).then(b.bind(b,15983))).FlowGraphDataSwitchBlock;default:if(kb[I])return kb[I];throw new Error(`Unknown block name ${I}`)}}(I.className);return await g()})));return function(I,g,b){const e=g.coordinator.createGraph(),c=[],z=g.valueParseFunction??Vb.e;for(let M=0;M<I.allBlocks.length;M++){const J=me(I.allBlocks[M],{Xg:g.coordinator.config.Xg,pathConverter:g.pathConverter,assetsContainer:g.coordinator.config.Xg,valueParseFunction:z},b[M]);c.push(J),J instanceof Sb.d&&e.addEventBlock(J)}for(const M of c){for(const I of M.dataInputs)for(const g of I.connectedPointIds){const b=vb(c,g);I.connectTo(b)}if(M instanceof fb.e)for(const I of M.signalOutputs)for(const g of I.connectedPointIds){const b=Xb(c,g);I.connectTo(b)}}for(const M of I.executionContexts)Eb(M,{graph:e,valueParseFunction:z},I.rightHanded);return e}(I,g,e)}function Eb(I,g,b){const e=g.graph.createContext();I.enableLogging&&(e.enableLogging=!0),e.treatDataAsRightHanded=b||!1;const c=g.valueParseFunction??Vb.e;e.uniqueId=I.uniqueId;const z=e.EI();if(I._assetsContext){var M,J,o,n,G,D,p,x,Z,k;const g=I._assetsContext,b={meshes:null===(M=g.meshes)||void 0===M?void 0:M.map((I=>z.getMeshById(I))),lights:null===(J=g.lights)||void 0===J?void 0:J.map((I=>z.getLightByName(I))),cameras:null===(o=g.cameras)||void 0===o?void 0:o.map((I=>z.getCameraByName(I))),materials:null===(n=g.materials)||void 0===n?void 0:n.map((I=>z.getMaterialById(I))),textures:null===(G=g.textures)||void 0===G?void 0:G.map((I=>z.getTextureByName(I))),animations:null===(D=g.animations)||void 0===D?void 0:D.map((I=>z.animations.find((g=>g.name===I)))),skeletons:null===(p=g.skeletons)||void 0===p?void 0:p.map((I=>z.getSkeletonByName(I))),Ax:null===(x=g.Ax)||void 0===x?void 0:x.map((I=>z.getParticleSystemById(I))),animationGroups:null===(Z=g.animationGroups)||void 0===Z?void 0:Z.map((I=>z.getAnimationGroupByName(I))),transformNodes:null===(k=g.transformNodes)||void 0===k?void 0:k.map((I=>z.getTransformNodeById(I))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],fZ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};e.assetsContext=b}for(const S in I._userVariables){const g=c(S,I._userVariables,e.assetsContext,z);e.userVariables[S]=g}for(const S in I._connectionValues){const g=c(S,I._connectionValues,e.assetsContext,z);e._setConnectionValueByKey(S,g)}return e}function me(I,g,b){const e={},c=g.valueParseFunction??Vb.e;if(I.config)for(const M in I.config)e[M]=c(M,I.config,g.assetsContainer||g.Xg,g.Xg);if((0,Vb.i)(I.className)){if(!g.pathConverter)throw new Error("Path converter is required for this block");e.pathConverter=g.pathConverter}const z=new b(e);z.uniqueId=I.uniqueId;for(let M=0;M<I.dataInputs.length;M++){const g=z.getDataInput(I.dataInputs[M].name);if(!g)throw new Error("Could not find data input with name "+I.dataInputs[M].name+" in block "+I.className);g.deserialize(I.dataInputs[M])}for(let M=0;M<I.dataOutputs.length;M++){const g=z.getDataOutput(I.dataOutputs[M].name);if(!g)throw new Error("Could not find data output with name "+I.dataOutputs[M].name+" in block "+I.className);g.deserialize(I.dataOutputs[M])}return z.metadata=I.metadata,z.deserialize&&z.deserialize(I),z}function sb(I){const[g,b]=I.split(":");return Fb({op:g,extension:b})}function Fb(I){var g;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=I.extension?null===(g=db[I.extension])||void 0===g?void 0:g[I.op]:Cb[I.op];if(!e&&(k.b.Warn(`No mapping found for operation ${I.op} and extension ${I.extension||"KHR_interactivity"}`),b)){const g={},b={flows:{}};if(I.inputValueSockets){g.values={};for(const b in I.inputValueSockets)g.values[b]={name:b}}return I.outputValueSockets&&(b.values={},Object.keys(I.outputValueSockets).forEach((I=>{b.values[I]={name:I}}))),{yD:[],inputs:g,outputs:b}}return e}function Yb(I,g,b){db[g]||(db[g]={}),db[g][I]=b}const db={BABYLON:{"flow/log":{yD:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Cb={"event/onStart":{yD:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{yD:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{yD:["FlowGraphSendCustomEventBlock"],extraProcessor(I,g,b,e,c){if("event/send"!==g.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=I.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const M=e.arrays.events[z],J=c[0];return J.config||(J.config={}),J.config.eventId=M.eventId,J.config.eventData=M.eventData,c}},"event/receive":{yD:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(I,g){var b;if(!I.configuration)return k.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const e=I.configuration.event;if(!e)return k.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const c=e.value[0];if("number"!==typeof c)return k.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=g.events)||void 0===b?void 0:b[c])?{valid:!0}:(k.b.Error(`Event with id ${c} not found`),{valid:!1,error:`Event with id ${c} not found`})},extraProcessor(I,g,b,e,c){if("event/receive"!==g.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=I.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const M=e.arrays.events[z],J=c[0];return J.config||(J.config={}),J.config.eventId=M.eventId,J.config.eventData=M.eventData,c}},"math/e":rb("FlowGraphEBlock"),"math/pi":rb("FlowGraphPIBlock"),"math/inf":rb("FlowGraphInfBlock"),"math/nan":rb("FlowGraphNaNBlock"),"math/abs":rb("FlowGraphAbsBlock"),"math/sign":rb("FlowGraphSignBlock"),"math/trunc":rb("FlowGraphTruncBlock"),"math/floor":rb("FlowGraphFloorBlock"),"math/ceil":rb("FlowGraphCeilBlock"),"math/round":{yD:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c){var z;return(z=c[0]).config||(z.config={}),c[0].config.roundHalfAwayFromZero=!0,c}},"math/fract":rb("FlowGraphFractBlock"),"math/neg":rb("FlowGraphNegationBlock"),"math/add":rb("FlowGraphAddBlock",["a","b"],!0),"math/sub":rb("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{yD:["FlowGraphMultiplyBlock"],extraProcessor(I,g,b,e,c){var z;(z=c[0]).config||(z.config={}),c[0].config.useMatrixPerComponent=!0,c[0].config.preventIntegerFloatArithmetic=!0;let M=-1;return Object.keys(I.values||{}).find((g=>{var b;return void 0!==(null===(b=I.values)||void 0===b?void 0:b[g].type)&&(M=I.values[g].type,!0)})),-1!==M&&(c[0].config.type=e.arrays.types[M].flowGraphType),c},validation:I=>I.values?Ob(I):{valid:!0}},"math/div":rb("FlowGraphDivideBlock",["a","b"],!0),"math/rem":rb("FlowGraphModuloBlock",["a","b"]),"math/min":rb("FlowGraphMinBlock",["a","b"]),"math/max":rb("FlowGraphMaxBlock",["a","b"]),"math/clamp":rb("FlowGraphClampBlock",["a","b","c"]),"math/saturate":rb("FlowGraphSaturateBlock"),"math/mix":rb("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":rb("FlowGraphEqualityBlock",["a","b"]),"math/lt":rb("FlowGraphLessThanBlock",["a","b"]),"math/le":rb("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":rb("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":rb("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":rb("FlowGraphIsNaNBlock"),"math/isinf":rb("FlowGraphIsInfBlock"),"math/select":{yD:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{yD:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":rb("FlowGraphSinBlock"),"math/cos":rb("FlowGraphCosBlock"),"math/tan":rb("FlowGraphTanBlock"),"math/asin":rb("FlowGraphASinBlock"),"math/acos":rb("FlowGraphACosBlock"),"math/atan":rb("FlowGraphATanBlock"),"math/atan2":rb("FlowGraphATan2Block",["a","b"]),"math/sinh":rb("FlowGraphSinhBlock"),"math/cosh":rb("FlowGraphCoshBlock"),"math/tanh":rb("FlowGraphTanhBlock"),"math/asinh":rb("FlowGraphASinhBlock"),"math/acosh":rb("FlowGraphACoshBlock"),"math/atanh":rb("FlowGraphATanhBlock"),"math/exp":rb("FlowGraphExponentialBlock"),"math/log":rb("FlowGraphLogBlock"),"math/log2":rb("FlowGraphLog2Block"),"math/log10":rb("FlowGraphLog10Block"),"math/sqrt":rb("FlowGraphSquareRootBlock"),"math/cbrt":rb("FlowGraphCubeRootBlock"),"math/pow":rb("FlowGraphPowerBlock",["a","b"]),"math/length":rb("FlowGraphLengthBlock"),"math/normalize":rb("FlowGraphNormalizeBlock"),"math/dot":rb("FlowGraphDotBlock",["a","b"]),"math/cross":rb("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":rb("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":rb("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{yD:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{yD:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{yD:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{yD:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{yD:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{yD:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{yD:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":rb("FlowGraphTransposeBlock"),"math/determinant":rb("FlowGraphDeterminantBlock"),"math/inverse":rb("FlowGraphInvertMatrixBlock"),"math/matmul":rb("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{yD:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"pb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c,z){const M=c[0].dataInputs.find((I=>"rotationQuaternion"===I.name));if(!M)throw new Error("Rotation quaternion input not found");return z._connectionValues[M.uniqueId]&&(z._connectionValues[M.uniqueId].type="Quaternion"),c}},"math/matDecompose":{yD:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"pb"}}}},"math/quatConjugate":rb("FlowGraphConjugateBlock",["a"]),"math/quatMul":{yD:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c){var z;return(z=c[0]).config||(z.config={}),c[0].config.type="Quaternion",c}},"math/quatAngleBetween":rb("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{yD:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":rb("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":rb("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{yD:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c){var z;return(z=c[0]).config||(z.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract2x2":{yD:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{yD:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c){var z;return(z=c[0]).config||(z.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract3x3":{yD:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{yD:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c){var z;return(z=c[0]).config||(z.config={}),c[0].config.inputIsColumnMajor=!0,c}},"math/extract4x4":{yD:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{yD:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c,z){var M,J;(J=c[0]).config||(J.config={});const o=c[0].dataInputs[0];return c[0].config.valueType=(null===(M=z._connectionValues[o.uniqueId])||void 0===M?void 0:M.type)??"FlowGraphInteger",c}},"math/and":{yD:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c,z){var M,J,o;(o=c[0]).config||(o.config={});const n=c[0].dataInputs[0],G=c[0].dataInputs[1];return c[0].config.valueType=(null===(M=z._connectionValues[n.uniqueId])||void 0===M?void 0:M.type)??(null===(J=z._connectionValues[G.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",c}},"math/or":{yD:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c,z){var M,J,o;(o=c[0]).config||(o.config={});const n=c[0].dataInputs[0],G=c[0].dataInputs[1];return c[0].config.valueType=(null===(M=z._connectionValues[n.uniqueId])||void 0===M?void 0:M.type)??(null===(J=z._connectionValues[G.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",c}},"math/xor":{yD:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,g,b,e,c,z){var M,J,o;(o=c[0]).config||(o.config={});const n=c[0].dataInputs[0],G=c[0].dataInputs[1];return c[0].config.valueType=(null===(M=z._connectionValues[n.uniqueId])||void 0===M?void 0:M.type)??(null===(J=z._connectionValues[G.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",c}},"math/asr":rb("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":rb("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":rb("FlowGraphLeadingZerosBlock"),"math/ctz":rb("FlowGraphTrailingZerosBlock"),"math/popcnt":rb("FlowGraphOneBitsCounterBlock"),"math/rad":rb("FlowGraphDegToRadBlock"),"math/deg":rb("FlowGraphRadToDegBlock"),"type/boolToInt":rb("FlowGraphBooleanToInt"),"type/boolToFloat":rb("FlowGraphBooleanToFloat"),"type/intToBool":rb("FlowGraphIntToBoolean"),"type/intToFloat":rb("FlowGraphIntToFloat"),"type/floatToInt":rb("FlowGraphFloatToInt"),"type/floatToBool":rb("FlowGraphFloatToBoolean"),"flow/sequence":{yD:["FlowGraphSequenceBlock"],extraProcessor(I,g,b,e,c){const z=c[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(I.flows||[]).length,z.signalOutputs.forEach(((I,g)=>{I.name="out_"+g})),c}},"flow/branch":{yD:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{yD:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(I){if(I.configuration&&I.configuration.cases){const g=I.configuration.cases.value;if(!g.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return k.b.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const b=new Set(g);I.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(I,g,b,e,c){if("flow/switch"!==g.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return c[0].signalOutputs.forEach((I=>{"default"!==I.name&&(I.name="out_"+I.name)})),c}},"flow/while":{yD:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{yD:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(I,g,b,e,c){const z=c[0];return z.config||(z.config={}),z.config.incrementIndexWhenLoopDone=!0,c}},"flow/doN":{yD:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{yD:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(I,g,b,e,c){if("flow/multiGate"!==g.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const z=c[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(I.flows).length,z.signalOutputs.forEach(((I,g)=>{I.name="out_"+g})),c}},"flow/waitAll":{yD:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(I){var g,b;return"number"!==typeof(null===(g=I.configuration)||void 0===g||null===(b=g.inputFlows)||void 0===b?void 0:b.value[0])&&(I.configuration=I.configuration||{inputFlows:{value:[0]}},I.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{yD:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{yD:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{yD:["FlowGraphCancelDelayBlock"]},"variable/get":{yD:["FlowGraphGetVariableBlock"],validation(I){var g,b;return null!==(g=I.configuration)&&void 0!==g&&null!==(b=g.variable)&&void 0!==b&&b.value?{valid:!0}:(k.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,g)=>[g.getVariableName(I[0])]}}},"variable/set":{yD:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,g)=>[g.getVariableName(I[0])]}}},"variable/setMultiple":{yD:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(I,g)=>[I[0].map((I=>g.getVariableName(I)))]}},extraProcessor:(I,g,b,e,c)=>(c[0].dataInputs.forEach((I=>{I.name=e.getVariableName(+I.name)})),c)},"variable/interpolate":{yD:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(I,g)=>[g.getVariableName(I[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:I=>!0===I[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Te:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Te:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Te:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Te:"FlowGraphPlayAnimationBlock"},out:{name:"out",Te:"FlowGraphPlayAnimationBlock"},done:{name:"done",Te:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(I,g,b,e,c){var z,M,J;const o=c[0],n=null===(z=I.configuration)||void 0===z?void 0:z.variable.value[0];if("number"!==typeof n)throw k.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const G=e.arrays.staticVariables[n];"undefined"===typeof o.config.animationType.value&&(e.arrays.staticVariables,o.config.animationType.value=(0,ab.E)(G.type));const D=c[4];return D.config||(D.config={}),(M=D.config).variable||(M.variable={}),D.config.variable.value=e.getVariableName(n),(J=c[3]).config||(J.config={}),c}},"pointer/get":{yD:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Te:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Te:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,g,b,e,c)=>(c.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),c)},"pointer/set":{yD:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Te:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Te:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,g,b,e,c)=>(c.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),c)},"pointer/interpolate":{yD:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Te:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Te:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Te:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Te:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Te:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Te:"FlowGraphPlayAnimationBlock"},out:{name:"out",Te:"FlowGraphPlayAnimationBlock"},done:{name:"done",Te:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,g,b,e,c)=>(c.forEach((g=>{"FlowGraphJsonPointerParserBlock"===g.className?(g.config||(g.config={}),g.config.outputValue=!0):"FlowGraphInterpolationBlock"===g.className&&(g.config||(g.config={}),Object.keys(I.values||[]).forEach((b=>{var c;const z=null===(c=I.values)||void 0===c?void 0:c[b];if("value"===b&&z){const I=z.type;void 0!==I&&(g.config.animationType=e.arrays.types[I].flowGraphType)}})))})),c)},"animation/start":{yD:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Te:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(I,g)=>[I[0]*g._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(I,g)=>[I[0]*g._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){const J=c[c.length-1];return J.config||(J.config={}),J.config.glTF=M,c}},"animation/stop":{yD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Te:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){const J=c[c.length-1];return J.config||(J.config={}),J.config.glTF=M,c}},"animation/stopAt":{yD:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Te:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(I,g)=>[I[0]*g._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){const J=c[c.length-1];return J.config||(J.config={}),J.config.glTF=M,c}},"math/switch":{yD:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(I){if(I.configuration&&I.configuration.cases){const g=I.configuration.cases.value;if(!g.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return k.b.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const b=new Set(g);I.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(I,g,b,e,c){const z=c[0];return z.dataInputs.forEach((I=>{"default"!==I.name&&"case"!==I.name&&(I.name="in_"+I.name)})),z.config||(z.config={}),z.config.treatCasesAsIntegers=!0,c}},"debug/log":{yD:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function rb(I){let g=arguments.length>2?arguments[2]:void 0;return{yD:[I],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((I,g)=>(I[g]={name:g},I)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(I,b,e,c,z){var M;if(g){(M=z[0]).config||(M.config={}),z[0].config.preventIntegerFloatArithmetic=!0;let g=-1;Object.keys(I.values||{}).find((b=>{var e;return void 0!==(null===(e=I.values)||void 0===e?void 0:e[b].type)&&(g=I.values[b].type,!0)})),-1!==g&&(z[0].config.type=c.arrays.types[g].flowGraphType)}return z},validation:I=>g?Ob(I):{valid:!0}}}function Ob(I){if(I.values){const g=Object.keys(I.values).map((g=>I.values[g].type)).filter((I=>void 0!==I));if(!g.every((I=>I===g[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Cb["math/compose"]=Cb["math/matCompose"],Cb["math/decompose"]=Cb["math/matDecompose"];var Hb=b(12561);const ib={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vg",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Ub{constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=I,this._gltf=g,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const I of this._interactivityGraph.types)this._types.push(ib[I.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const I of this._interactivityGraph.declarations){const g=Fb(I);if(!g)throw k.b.Error(["No mapping found for declaration",I]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:g,fullOperationName:I.extension?I.op+":"+I.extension:I.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const I of this._interactivityGraph.variables){const g=this._parseVariable(I);this._staticVariables.push(g)}}_parseVariable(I,g){const b=this._types[I.type];if(!b)throw k.b.Error(["No type found for variable",I]),new Error("Error parsing variables");if(I.value&&I.value.length!==b.length)throw k.b.Error(["Invalid value length for variable",I,b]),new Error("Error parsing variables");const e=I.value||[];if(!e.length)switch(b.flowGraphType){case"boolean":e.push(!1);break;case"FlowGraphInteger":e.push(0);break;case"number":e.push(NaN);break;case"Vector2":e.push(NaN,NaN);break;case"Vg":e.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":e.fill(NaN,0,4);break;case"Matrix":e.fill(NaN,0,16);break;case"Matrix3D":e.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof e[0]&&(e[0]=parseFloat(e[0])),{type:b.flowGraphType,value:g?g(e,this):e}}_parseEvents(){if(this._interactivityGraph.events)for(const I of this._interactivityGraph.events){const g={eventId:I.id||"internalEvent_"+this._internalEventsCounter++};I.values&&(g.eventData=Object.keys(I.values).map((g=>{var b;const e=null===(b=I.values)||void 0===b?void 0:b[g];if(!e)throw k.b.Error(["No value found for event key",g]),new Error("Error parsing events");const c=this._types[e.type];if(!c)throw k.b.Error(["No type found for event value",e]),new Error("Error parsing events");const z="undefined"!==typeof e.value?this._parseVariable(e):void 0;return{id:g,type:c.flowGraphType,eventData:!0,value:z}}))),this._events.push(g)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const g of this._interactivityGraph.nodes){if("number"!==typeof g.declaration)throw k.b.Error(["No declaration found for node",g]),new Error("Error parsing nodes");const b=this._mappings[g.declaration];if(!b)throw k.b.Error(["No mapping found for node",g]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const e=b.flowGraphMapping.validation(g,this._interactivityGraph,this._gltf);var I;if(!e.valid)throw new Error(`Error validating interactivity node ${null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[g.declaration].op} - ${e.error}`)}const e=[];for(const I of b.flowGraphMapping.yD){const c=this._getEmptyBlock(I,b.fullOperationName);this._parseNodeConfiguration(g,c,b.flowGraphMapping,I),e.push(c)}this._nodes.push({yD:e,fullOperationName:b.fullOperationName})}}_getEmptyBlock(I,g){return{uniqueId:(0,Hb.e)(),className:I,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:g,metadata:{}}}_parseNodeConfiguration(I,g,b,e){const c=g.config;if(I.configuration){const g=Object.keys(I.configuration);for(const J of g){var z,M;const g=null===(z=I.configuration)||void 0===z?void 0:z[J];if(!g)throw k.b.Error(["No value found for node configuration",J]),new Error("Error parsing node configuration");const o=null===(M=b.configuration)||void 0===M?void 0:M[J];if(o&&o.Te?o.Te===e:0===b.yD.indexOf(e)){const I=(null===o||void 0===o?void 0:o.name)||J;g&&"undefined"!==typeof g.value||"undefined"===typeof(null===o||void 0===o?void 0:o.defaultValue)?g.value.length>=0?c[I]={value:1===g.value.length?g.value[0]:g.value}:k.b.Warn(["Invalid value for node configuration",g]):c[I]={value:o.defaultValue},o&&o.dataTransformer&&(c[I].value=o.dataTransformer([c[I].value],this)[0])}}}}_parseNodeConnections(I){for(let R=0;R<this._nodes.length;R++){var g;const E=null===(g=this._interactivityGraph.nodes)||void 0===g?void 0:g[R];if(!E)throw k.b.Error(["No node found for interactivity node",this._nodes[R]]),new Error("Error parsing node connections");const mI=this._nodes[R],s=this._mappings[E.declaration];if(!s)throw k.b.Error(["No mapping found for node",E]),new Error("Error parsing node connections");const F=E.flows||{},Y=Object.keys(F).sort();for(const I of Y){var b,e,c,z;const g=F[I],n=null===(b=s.flowGraphMapping.outputs)||void 0===b||null===(e=b.flows)||void 0===e?void 0:e[I],G=(null===n||void 0===n?void 0:n.name)||I,D=this._createNewSocketConnection(G,!0);(n&&n.Te&&mI.yD.find((I=>I.className===n.Te))||mI.yD[0]).signalOutputs.push(D);const p=g.node,x=this._nodes[p];if(!x)throw k.b.Error(["No node found for input node id",p]),new Error("Error parsing node connections");const Z=sb(x.fullOperationName);if(!Z)throw k.b.Error(["No mapping found for input node",x]),new Error("Error parsing node connections");let S=null===(c=Z.inputs)||void 0===c||null===(z=c.flows)||void 0===z?void 0:z[g.socket||"in"],f=!1;if(!S)for(const I in null===(M=Z.inputs)||void 0===M?void 0:M.flows){var M,J,o;if(I.startsWith("[")&&I.endsWith("]"))f=!0,S=null===(J=Z.inputs)||void 0===J||null===(o=J.flows)||void 0===o?void 0:o[I]}const V=S?f?S.name.replace("$1",g.socket||""):S.name:g.socket||"in",a=S&&S.Te&&x.yD.find((I=>I.className===S.Te))||x.yD[0];let v=a.signalInputs.find((I=>I.name===V));v||(v=this._createNewSocketConnection(V),a.signalInputs.push(v)),v.connectedPointIds.push(D.uniqueId),D.connectedPointIds.push(v.uniqueId)}const d=E.values||{},C=Object.keys(d);for(const g of C){var n,G;const b=d[g];let e=null===(n=s.flowGraphMapping.inputs)||void 0===n||null===(G=n.values)||void 0===G?void 0:G[g],c=!1;if(!e)for(const I in null===(D=s.flowGraphMapping.inputs)||void 0===D?void 0:D.values){var D,p,x;if(I.startsWith("[")&&I.endsWith("]"))c=!0,e=null===(p=s.flowGraphMapping.inputs)||void 0===p||null===(x=p.values)||void 0===x?void 0:x[I]}const z=e?c?e.name.replace("$1",g):e.name:g,M=this._createNewSocketConnection(z);if((e&&e.Te&&mI.yD.find((I=>I.className===e.Te))||mI.yD[0]).dataInputs.push(M),void 0!==b.value){const g=this._parseVariable(b,e&&e.dataTransformer);I._connectionValues[M.uniqueId]=g}else{if("undefined"===typeof b.node)throw k.b.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var Z,S,f;const I=b.node,g=b.socket||"value",e=this._nodes[I];if(!e)throw k.b.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const c=sb(e.fullOperationName);if(!c)throw k.b.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let z=null===(Z=c.outputs)||void 0===Z||null===(S=Z.values)||void 0===S?void 0:S[g],J=!1;if(!z)for(const b in null===(V=c.outputs)||void 0===V?void 0:V.values){var V,a,v;if(b.startsWith("[")&&b.endsWith("]"))J=!0,z=null===(a=c.outputs)||void 0===a||null===(v=a.values)||void 0===v?void 0:v[b]}const o=z?J?z.name.replace("$1",g):null===(f=z)||void 0===f?void 0:f.name:g,n=z&&z.Te&&e.yD.find((I=>I.className===z.Te))||e.yD[0];let G=n.dataOutputs.find((I=>I.name===o));G||(G=this._createNewSocketConnection(o,!0),n.dataOutputs.push(G)),M.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(M.uniqueId)}}}if(s.flowGraphMapping.interBlockConnectors)for(const I of s.flowGraphMapping.interBlockConnectors){const g=I.input,b=I.output,e=I.isVariable;this._connectFlowGraphNodes(g,b,mI.yD[I.inputBlockIndex],mI.yD[I.outputBlockIndex],e)}if(s.flowGraphMapping.extraProcessor){var X;const g=null===(X=this._interactivityGraph.declarations)||void 0===X?void 0:X[E.declaration];if(!g)throw k.b.Error(["No declaration found for extra processor",E]),new Error("Error parsing node connections");mI.yD=s.flowGraphMapping.extraProcessor(E,g,s.flowGraphMapping,this,mI.yD,I,this._gltf)}}}_createNewSocketConnection(I,g){return{uniqueId:(0,Hb.e)(),name:I,_connectionType:g?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(I,g,b,e,c){const z=c?b.dataInputs:b.signalInputs,M=c?e.dataOutputs:e.signalOutputs,J=z.find((g=>g.name===I))||this._createNewSocketConnection(I),o=M.find((I=>I.name===g))||this._createNewSocketConnection(g,!0);z.find((g=>g.name===I))||z.push(J),M.find((I=>I.name===g))||M.push(o),J.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(J.uniqueId)}getVariableName(I){return"staticVariable_"+I}serializeToFlowGraph(){const I={uniqueId:(0,Hb.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(I);for(let g=0;g<this._staticVariables.length;g++){const b=this._staticVariables[g];I._userVariables[this.getVariableName(g)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((I,g)=>I.concat(g.yD)),[]),executionContexts:[I]}}}const hb="KHR_interactivity";class Ab{constructor(I){this._loader=I,this.name=hb,this.enabled=this._loader.isExtensionUsed(hb),this._pathConverter=(0,j.h)(this._loader.Lg),I._skipStartAnimationStep=!0;const g=I.babylonScene;g&&function(I){(0,j.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!I.activeCamera)return new c.Quaternion(NaN,NaN,NaN,NaN);const g=c.Quaternion.FromRotationMatrix(I.activeCamera.getWorldMatrix()).normalize();return I.useRightHandedSystem||(g.w*=-1,g.x*=-1),g},type:"Quaternion",getTarget:()=>I.activeCamera}),(0,j.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!I.activeCamera)return new c.Vg(NaN,NaN,NaN);const g=I.activeCamera.getWorldMatrix().getTranslation();return I.useRightHandedSystem||(g.x*=-1),g},type:"Vg",getTarget:()=>I.activeCamera}),(0,j.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:I=>{var g;return(null===(g=I._babylonAnimationGroup)||void 0===g?void 0:g.isPlaying)??!1},type:"boolean",getTarget:I=>I._babylonAnimationGroup}),(0,j.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:I=>{var g;return((null===(g=I._babylonAnimationGroup)||void 0===g?void 0:g.from)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,j.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:I=>{var g;return((null===(g=I._babylonAnimationGroup)||void 0===g?void 0:g.to)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,j.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:I=>{var g;return((null===(g=I._babylonAnimationGroup)||void 0===g?void 0:g.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,j.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:I=>{var g;return((null===(g=I._babylonAnimationGroup)||void 0===g?void 0:g.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup})}(g)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var I;if(!this._loader.babylonScene||!this._pathConverter)return;const g=this._loader.babylonScene,b=null===(I=this._loader.Lg.extensions)||void 0===I?void 0:I.KHR_interactivity;if(!b)return;const e=new Zb.c({Xg:g});e.dispatchEventsSynchronously=!1;const c=b.graphs.map((I=>new Ub(I,this._loader.Lg,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(c.map((async I=>await Rb(I,{coordinator:e,pathConverter:this._pathConverter})))),e.start()}}var jb;jb=async()=>(await Promise.resolve().then(b.bind(b,14326))).FlowGraphGLTFDataProvider,kb[`${hb}/${"FlowGraphGLTFDataProvider"}`]=jb,A(hb),h(hb,!0,(I=>new Ab(I)));const Qb="KHR_node_visibility";(0,j.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:I=>{const g=I._babylonTransformNode;return!g||void 0===g.isVisible||g.isVisible},set:(I,g)=>{var b,e;null===(b=g._primitiveBabylonMeshes)||void 0===b||b.forEach((I=>{I.inheritVisibility=!0})),g._babylonTransformNode&&(g._babylonTransformNode.isVisible=I),null===(e=g._primitiveBabylonMeshes)||void 0===e||e.forEach((g=>{g.isVisible=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Lb{constructor(I){this.name=Qb,this._loader=I,this.enabled=I.isExtensionUsed(Qb)}async onReady(){var I;null===(I=this._loader.Lg.nodes)||void 0===I||I.forEach((I=>{var g,b,e,c;(null===(g=I._primitiveBabylonMeshes)||void 0===g||g.forEach((I=>{I.inheritVisibility=!0})),null!==(b=I.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(e=I.extensions)||void 0===e?void 0:e.KHR_node_visibility.visible)&&(I._babylonTransformNode&&(I._babylonTransformNode.isVisible=!1),null===(c=I._primitiveBabylonMeshes)||void 0===c||c.forEach((I=>{I.isVisible=!1}))))}))}dispose(){this._loader=null}}A(Qb),h(Qb,!0,(I=>new Lb(I)));const Nb="KHR_node_selectability";Yb("event/onSelect",Nb,{yD:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Te:"FlowGraphGetVariableBlock",dataTransformer:I=>["pickedMesh_"+I[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Te:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){var J,o,n,G,D,p;const x=c[c.length-1];x.config=x.config||{},x.config.glTF=M;const Z=null===(J=I.configuration)||void 0===J||null===(o=J.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const k="pickedMesh_"+Z;return c[1].config.variable=k,z._userVariables[k]={className:"Mesh",id:null===M||void 0===M||null===(n=M.nodes)||void 0===n||null===(G=n[Z]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===M||void 0===M||null===(D=M.nodes)||void 0===D||null===(p=D[Z]._babylonTransformNode)||void 0===p?void 0:p.uniqueId},c}}),(0,j.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:I=>{const g=I._babylonTransformNode;return!g||void 0===g.fG||g.fG},set:(I,g)=>{var b;null===(b=g._primitiveBabylonMeshes)||void 0===b||b.forEach((g=>{g.fG=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"fG"],type:"boolean"});class Kb{constructor(I){this.name=Nb,this._loader=I,this.enabled=I.isExtensionUsed(Nb)}async onReady(){var I;null===(I=this._loader.Lg.nodes)||void 0===I||I.forEach((I=>{var g,b,e;null!==(g=I.extensions)&&void 0!==g&&g.KHR_node_selectability&&!1===(null===(b=I.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(e=I._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((I=>{I.fG=!1})))}))}dispose(){this._loader=null}}A(Nb),h(Nb,!0,(I=>new Kb(I)));const Bb="KHR_node_hoverability",Pb="targetMeshPointerOver_";Yb("event/onHoverIn",Bb,{yD:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Te:"FlowGraphGetVariableBlock",dataTransformer:I=>[Pb+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Te:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){var J,o,n,G,D,p;const x=c[c.length-1];x.config=x.config||{},x.config.glTF=M;const Z=null===(J=I.configuration)||void 0===J||null===(o=J.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const k=Pb+Z;return c[1].config.variable=k,z._userVariables[k]={className:"Mesh",id:null===M||void 0===M||null===(n=M.nodes)||void 0===n||null===(G=n[Z]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===M||void 0===M||null===(D=M.nodes)||void 0===D||null===(p=D[Z]._babylonTransformNode)||void 0===p?void 0:p.uniqueId},c}});const ub="targetMeshPointerOut_";Yb("event/onHoverOut",Bb,{yD:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Te:"FlowGraphGetVariableBlock",dataTransformer:I=>[ub+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Te:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,g,b,e,c,z,M){var J,o,n,G,D,p;const x=c[c.length-1];x.config=x.config||{},x.config.glTF=M;const Z=null===(J=I.configuration)||void 0===J||null===(o=J.nodeIndex)||void 0===o?void 0:o.value[0];if(void 0===Z||"number"!==typeof Z)throw new Error("nodeIndex not found in configuration");const k=ub+Z;return c[1].config.variable=k,z._userVariables[k]={className:"Mesh",id:null===M||void 0===M||null===(n=M.nodes)||void 0===n||null===(G=n[Z]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===M||void 0===M||null===(D=M.nodes)||void 0===D||null===(p=D[Z]._babylonTransformNode)||void 0===p?void 0:p.uniqueId},c}}),(0,j.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:I=>{const g=I._babylonTransformNode;return!g||void 0===g.pointerOverDisableMeshTesting||g.pointerOverDisableMeshTesting},set:(I,g)=>{var b;null===(b=g._primitiveBabylonMeshes)||void 0===b||b.forEach((g=>{g.pointerOverDisableMeshTesting=!I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class tb{constructor(I){this.name=Bb,this._loader=I,this.enabled=I.isExtensionUsed(Bb)}async onReady(){var I;null===(I=this._loader.Lg.nodes)||void 0===I||I.forEach((I=>{var g,b,e;null!==(g=I.extensions)&&void 0!==g&&g.KHR_node_hoverability&&!1===(null===(b=I.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(e=I._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((I=>{I.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}A(Bb),h(Bb,!0,(I=>new tb(I)));const yb="ExtrasAsMetadata";class qb{_assignExtras(I,g){if(g.extras&&Object.keys(g.extras).length>0){const b=I.metadata=I.metadata||{};(b.Lg=b.Lg||{}).extras=g.extras}}constructor(I){this.name=yb,this.enabled=!0,this._loader=I}dispose(){this._loader=null}loadNodeAsync(I,g,b){return this._loader.loadNodeAsync(I,g,(I=>{this._assignExtras(I,g),b(I)}))}loadCameraAsync(I,g,b){return this._loader.loadCameraAsync(I,g,(I=>{this._assignExtras(I,g),b(I)}))}createMaterial(I,g,b){const e=this._loader.createMaterial(I,g,b);return this._assignExtras(e,g),e}}A(yb),h(yb,!1,(I=>new qb(I)));b(14326)},14207:(I,g,b)=>{"use strict";b.d(g,{d:()=>O,h:()=>s,k:()=>mI,l:()=>F});var e=b(12412),c=b(12409),z=b(13857),M=b(13027),J=b(12995),o=b(13006),n=b(12420),G=b(12449),D=b(13021),p=b(13114),x=b(13031),Z=b(12629);class k{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ax=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.fZ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(I){this._environmentTexture=I}getNodes(){let I=[];I=I.concat(this.meshes),I=I.concat(this.lights),I=I.concat(this.cameras),I=I.concat(this.transformNodes);for(const g of this.skeletons)I=I.concat(g.bones);return I}}class S extends k{}class f{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const I=this.rootNodes;for(const e of I)e.dispose();I.length=0;const g=this.skeletons;for(const e of g)e.dispose();g.length=0;const b=this.animationGroups;for(const e of b)e.dispose();b.length=0}}class V extends k{constructor(I){super(),this._wasAddedToScene=!1,(I=I||G.b.LastCreatedScene)&&(this.Xg=I,this.proceduralTextures=[],I.Og.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=I.getEngine().onContextRestoredObservable.add((()=>{for(const I of this.geometries)I._rebuild();for(const I of this.meshes)I._rebuild();for(const I of this.Ax)I.rebuild();for(const I of this.textures)I._rebuild()})))}_topologicalSort(I){const g=new Map;for(const M of I)g.set(M.uniqueId,M);const b={dependsOn:new Map,dependedBy:new Map};for(const M of I){const I=M.uniqueId;b.dependsOn.set(I,new Set),b.dependedBy.set(I,new Set)}for(const M of I){const I=M.uniqueId,e=b.dependsOn.get(I);if(M instanceof D.e){const c=M.sourceMesh;g.has(c.uniqueId)&&(e.add(c.uniqueId),b.dependedBy.get(c.uniqueId).add(I))}const c=b.dependedBy.get(I);for(const z of M.getDescendants()){const e=z.uniqueId;if(g.has(e)){c.add(e);b.dependsOn.get(e).add(I)}}}const e=[],c=[];for(const M of I){const I=M.uniqueId;0===b.dependsOn.get(I).size&&(c.push(M),g.delete(I))}const z=c;for(;z.length>0;){const I=z.shift();e.push(I);const c=b.dependedBy.get(I.uniqueId);for(const e of Array.from(c.values())){const c=b.dependsOn.get(e);c.delete(I.uniqueId),0===c.size&&g.get(e)&&(z.push(g.get(e)),g.delete(e))}}return g.size>0&&(n.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),g.forEach((I=>{n.b.Error(I.name)}))),e}_addNodeAndDescendantsToList(I,g,b,e){if(b&&(!e||e(b))&&!g.has(b.uniqueId)){I.push(b),g.add(b.uniqueId);for(const c of b.getDescendants(!0))this._addNodeAndDescendantsToList(I,g,c,e)}}_isNodeInContainer(I){return I instanceof o.e&&-1!==this.meshes.indexOf(I)||(I instanceof J.d&&-1!==this.transformNodes.indexOf(I)||(I instanceof p.d&&-1!==this.lights.indexOf(I)||I instanceof x.b&&-1!==this.cameras.indexOf(I)))}_isValidHierarchy(){for(const I of this.meshes)if(I.parent&&!this._isNodeInContainer(I.parent))return n.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.transformNodes)if(I.parent&&!this._isNodeInContainer(I.parent))return n.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.lights)if(I.parent&&!this._isNodeInContainer(I.parent))return n.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.cameras)if(I.parent&&!this._isNodeInContainer(I.parent))return n.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(I){let g=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const e={},z={},J=new f,o=[],n=[],G={doNotInstantiate:!0,...b},D=[],p=new Set;for(const c of this.transformNodes)null===c.parent&&this._addNodeAndDescendantsToList(D,p,c,G.predicate);for(const c of this.meshes)null===c.parent&&this._addNodeAndDescendantsToList(D,p,c,G.predicate);const x=this._topologicalSort(D),Z=(b,c)=>{if(((g,b)=>{if(e[g.uniqueId]=b.uniqueId,z[b.uniqueId]=b,I&&(b.name=I(g.name)),b instanceof M.e){const I=b;if(I.morphTargetManager){const b=g.morphTargetManager;I.morphTargetManager=b.clone();for(let g=0;g<b.numTargets;g++){const c=b.getTarget(g),M=I.morphTargetManager.getTarget(g);e[c.uniqueId]=M.uniqueId,z[M.uniqueId]=M}}}})(b,c),b.parent){const I=e[b.parent.uniqueId],g=z[I];c.parent=g||b.parent}if(c.position&&b.position&&c.position.G(b.position),c.rotationQuaternion&&b.rotationQuaternion&&c.rotationQuaternion.G(b.rotationQuaternion),c.rotation&&b.rotation&&c.rotation.G(b.rotation),c.pb&&b.pb&&c.pb.G(b.pb),c.material){const M=c;if(M.material)if(g){const g=b.material;if(-1===n.indexOf(g)){let b=g.clone(I?I(g.name):"Clone of "+g.name);if(n.push(g),e[g.uniqueId]=b.uniqueId,z[b.uniqueId]=b,"MultiMaterial"===g.getClassName()){const c=g;for(const g of c.fb)g&&(b=g.clone(I?I(g.name):"Clone of "+g.name),n.push(g),e[g.uniqueId]=b.uniqueId,z[b.uniqueId]=b);c.fb=c.fb.map((I=>I&&z[e[I.uniqueId]]))}}"InstancedMesh"!==M.getClassName()&&(M.material=z[e[g.uniqueId]])}else"MultiMaterial"===M.material.getClassName()?-1===this.Xg.multiMaterials.indexOf(M.material)&&this.Xg.addMultiMaterial(M.material):-1===this.Xg.materials.indexOf(M.material)&&this.Xg.addMaterial(M.material)}null===c.parent&&J.rootNodes.push(c)};for(const c of x)if("InstancedMesh"===c.getClassName()){const I=c,g=I.sourceMesh,b=e[g.uniqueId];Z(I,("number"===typeof b?z[b]:g).createInstance(I.name))}else{let I=!0;"sb"===c.getClassName()||"Node"===c.getClassName()||c.skeleton||!c.getTotalVertices||0===c.getTotalVertices()?I=!1:G.doNotInstantiate&&(I="function"===typeof G.doNotInstantiate?!G.doNotInstantiate(c):!G.doNotInstantiate);const g=I?c.createInstance(`instance of ${c.name}`):c.clone(`Clone of ${c.name}`,null,!0);if(!g)throw new Error(`Could not clone or instantiate node on Asset Container ${c.name}`);Z(c,g)}for(const c of this.skeletons){if(G.predicate&&!G.predicate(c))continue;const g=c.clone(I?I(c.name):"Clone of "+c.name);for(const I of this.meshes)if(I.skeleton===c&&!I.isAnInstance){const b=z[e[I.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=g,-1!==o.indexOf(g))continue;o.push(g);for(const I of g.bones)I._linkedTransformNode&&(I._linkedTransformNode=z[e[I._linkedTransformNode.uniqueId]])}J.skeletons.push(g)}for(const c of this.animationGroups){if(G.predicate&&!G.predicate(c))continue;const g=c.clone(I?I(c.name):"Clone of "+c.name,(I=>z[e[I.uniqueId]]||I));J.animationGroups.push(g)}return J}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Xg.environmentTexture=this.environmentTexture);for(const I of this.Xg._serializableComponents)I.addFromContainer(this);this.Xg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const g=[];for(const b of this.cameras)I&&!I(b)||(this.Xg.addCamera(b),g.push(b));for(const b of this.lights)I&&!I(b)||(this.Xg.addLight(b),g.push(b));for(const b of this.meshes)I&&!I(b)||(this.Xg.UD(b),g.push(b));for(const b of this.skeletons)I&&!I(b)||this.Xg.addSkeleton(b);for(const b of this.animations)I&&!I(b)||this.Xg.addAnimation(b);for(const b of this.animationGroups)I&&!I(b)||this.Xg.addAnimationGroup(b);for(const b of this.multiMaterials)I&&!I(b)||this.Xg.addMultiMaterial(b);for(const b of this.materials)I&&!I(b)||this.Xg.addMaterial(b);for(const b of this.morphTargetManagers)I&&!I(b)||this.Xg.addMorphTargetManager(b);for(const b of this.geometries)I&&!I(b)||this.Xg.addGeometry(b);for(const b of this.transformNodes)I&&!I(b)||(this.Xg.addTransformNode(b),g.push(b));for(const b of this.actionManagers)I&&!I(b)||this.Xg.addActionManager(b);for(const b of this.textures)I&&!I(b)||this.Xg.addTexture(b);for(const b of this.reflectionProbes)I&&!I(b)||this.Xg.addReflectionProbe(b);for(const b of g)b.parent&&-1===this.Xg.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||c.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Xg.environmentTexture&&(this.Xg.environmentTexture=null);for(const I of this.Xg._serializableComponents)I.removeFromContainer(this)}removeFromScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const g of this.cameras)I&&!I(g)||this.Xg.removeCamera(g);for(const g of this.lights)I&&!I(g)||this.Xg.removeLight(g);for(const g of this.meshes)I&&!I(g)||this.Xg.iD(g,!0);for(const g of this.skeletons)I&&!I(g)||this.Xg.removeSkeleton(g);for(const g of this.animations)I&&!I(g)||this.Xg.removeAnimation(g);for(const g of this.animationGroups)I&&!I(g)||this.Xg.removeAnimationGroup(g);for(const g of this.multiMaterials)I&&!I(g)||this.Xg.removeMultiMaterial(g);for(const g of this.materials)I&&!I(g)||this.Xg.removeMaterial(g);for(const g of this.morphTargetManagers)I&&!I(g)||this.Xg.removeMorphTargetManager(g);for(const g of this.geometries)I&&!I(g)||this.Xg.removeGeometry(g);for(const g of this.transformNodes)I&&!I(g)||this.Xg.removeTransformNode(g);for(const g of this.actionManagers)I&&!I(g)||this.Xg.removeActionManager(g);for(const g of this.textures)I&&!I(g)||this.Xg.removeTexture(g);for(const g of this.reflectionProbes)I&&!I(g)||this.Xg.removeReflectionProbe(g)}dispose(){const I=this.cameras.slice(0);for(const x of I)x.dispose();this.cameras.length=0;const g=this.lights.slice(0);for(const x of g)x.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const x of b)x.dispose();this.meshes.length=0;const e=this.skeletons.slice(0);for(const x of e)x.dispose();this.skeletons.length=0;const c=this.animationGroups.slice(0);for(const x of c)x.dispose();this.animationGroups.length=0;const z=this.multiMaterials.slice(0);for(const x of z)x.dispose();this.multiMaterials.length=0;const M=this.materials.slice(0);for(const x of M)x.dispose();this.materials.length=0;const J=this.geometries.slice(0);for(const x of J)x.dispose();this.geometries.length=0;const o=this.transformNodes.slice(0);for(const x of o)x.dispose();this.transformNodes.length=0;const n=this.actionManagers.slice(0);for(const x of n)x.dispose();this.actionManagers.length=0;const G=this.textures.slice(0);for(const x of G)x.dispose();this.textures.length=0;const D=this.reflectionProbes.slice(0);for(const x of D)x.dispose();this.reflectionProbes.length=0;const p=this.morphTargetManagers.slice(0);for(const x of p)x.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const x of this.Xg._serializableComponents)x.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Xg.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(I,g,b){if(I&&g)for(const e of I){let I=!0;if(b)for(const g of b)if(e===g){I=!1;break}I&&(g.push(e),e._parentContainer=this)}}moveAllFromScene(I){this._wasAddedToScene=!1,void 0===I&&(I=new S);for(const g in this)Object.prototype.hasOwnProperty.call(this,g)&&(this[g]=this[g]||("_environmentTexture"===g?null:[]),this._moveAssets(this.Xg[g],this[g],I[g]));this.environmentTexture=this.Xg.environmentTexture,this.removeAllFromScene()}createRootMesh(){const I=new M.e("assetContainerRootMesh",this.Xg);for(const g of this.meshes)g.parent||I.addChild(g);return this.meshes.unshift(I),I}mergeAnimationsTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.b.LastCreatedScene,g=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!I)return n.b.Error("No scene available to merge animations to"),[];const e=b||(g=>{let b=null;const e=g.animations.length?g.animations[0].targetProperty:"",c=g.name.split(".").join("").split("_primitive")[0];switch(e){case"position":case"rotationQuaternion":b=I.getTransformNodeByName(g.name)||I.getTransformNodeByName(c);break;case"influence":b=I.getMorphTargetByName(g.name)||I.getMorphTargetByName(c);break;default:b=I.getNodeByName(g.name)||I.getNodeByName(c)}return b}),c=this.getNodes();for(const J of c){const I=e(J);if(null!==I){for(const g of J.animations){const b=I.animations.filter((I=>I.targetProperty===g.targetProperty));for(const g of b){const b=I.animations.indexOf(g,0);b>-1&&I.animations.splice(b,1)}}I.animations=I.animations.concat(J.animations)}}const z=[],M=this.animationGroups.slice();for(const J of M){z.push(J.clone(J.name,e));for(const I of J.animatables)I.stop()}for(const J of g){const g=e(J.target);g&&(I.beginAnimation(g,J.fromFrame,J.toFrame,J.loopAnimation,J.speedRatio,J.onAnimationEnd?J.onAnimationEnd:void 0,void 0,!0,void 0,J.onAnimationLoop?J.onAnimationLoop:void 0),I.stopAnimation(J.target))}return z}populateRootNodes(){this.rootNodes.length=0;for(const I of this.meshes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.transformNodes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.lights)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.cameras)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I)}addAllAssetsToContainer(I){if(!I)return;const g=[],b=new Set;for(g.push(I);g.length>0;){const I=g.pop();if(I instanceof M.e?(I.ob&&-1===this.geometries.indexOf(I.ob)&&this.geometries.push(I.ob),this.meshes.push(I)):I instanceof D.e?this.meshes.push(I):I instanceof J.d?this.transformNodes.push(I):I instanceof p.d?this.lights.push(I):I instanceof x.b&&this.cameras.push(I),I instanceof o.e){if(I.material&&-1===this.materials.indexOf(I.material)){this.materials.push(I.material);for(const g of I.material.getActiveTextures())-1===this.textures.indexOf(g)&&this.textures.push(g)}I.skeleton&&-1===this.skeletons.indexOf(I.skeleton)&&this.skeletons.push(I.skeleton),I.morphTargetManager&&-1===this.morphTargetManagers.indexOf(I.morphTargetManager)&&this.morphTargetManagers.push(I.morphTargetManager)}for(const e of I.getChildren())b.has(e)||g.push(e);b.add(I)}this.populateRootNodes()}_getByTags(I,g,b){if(void 0===g)return I;const e=[];for(const c in I){const z=I[c];Z.d&&Z.d.MatchesQuery(z,g)&&(!b||b(z))&&e.push(z)}return e}getMeshesByTags(I,g){return this._getByTags(this.meshes,I,g)}getCamerasByTags(I,g){return this._getByTags(this.cameras,I,g)}getLightsByTags(I,g){return this._getByTags(this.lights,I,g)}getMaterialsByTags(I,g){return this._getByTags(this.materials,I,g).concat(this._getByTags(this.multiMaterials,I,g))}getTransformNodesByTags(I,g){return this._getByTags(this.transformNodes,I,g)}}var a=b(12468);class v{constructor(I){this.byteOffset=0,this.buffer=I}async loadAsync(I){const g=await this.buffer.readAsync(this.byteOffset,I);this._dataView=new DataView(g.buffer,g.byteOffset,g.byteLength),this._dataByteOffset=0}readUint32(){const I=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,I}readUint8Array(I){const g=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,I);return this._dataByteOffset+=I,this.byteOffset+=I,g}readString(I){return(0,a.j)(this.readUint8Array(I))}skipBytes(I){this._dataByteOffset+=I,this.byteOffset+=I}}var X=b(14216);const R="Z2xURg",E={name:"Lg",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:I=>-1!==I.indexOf("asset")&&-1!==I.indexOf("version")||I.startsWith("data:base64,"+R)||I.startsWith("data:;base64,"+R)||I.startsWith("data:application/octet-stream;base64,"+R)||I.startsWith("data:model/gltf-binary;base64,"+R)};var mI,s,F,Y=b(12456),d=b(12465);function C(I,g,b){try{return Promise.resolve(new Uint8Array(I,g,b))}catch(e){return Promise.reject(e)}}!function(I){I[I.AUTO=0]="AUTO",I[I.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(mI||(mI={})),function(I){I[I.NONE=0]="NONE",I[I.FIRST=1]="FIRST",I[I.ALL=2]="ALL"}(s||(s={})),function(I){I[I.LOADING=0]="LOADING",I[I.READY=1]="READY",I[I.COMPLETE=2]="COMPLETE"}(F||(F={}));class r{constructor(){this.coordinateSystemMode=mI.AUTO,this.animationStartMode=s.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=I=>Promise.resolve(I),this.extensionOptions={}}G(I){I&&(this.onParsed=I.onParsed,this.coordinateSystemMode=I.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=I.animationStartMode??this.animationStartMode,this.loadNodeAnimations=I.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=I.loadSkins??this.loadSkins,this.loadMorphTargets=I.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=I.compileMaterials??this.compileMaterials,this.useClipPlane=I.useClipPlane??this.useClipPlane,this.compileShadowGenerators=I.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=I.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=I.useRangeRequests??this.useRangeRequests,this.createInstances=I.createInstances??this.createInstances,this.alwaysComputeBoundingBox=I.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=I.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=I.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=I.skipMaterials??this.skipMaterials,this.useSRGBBuffers=I.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=I.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=I.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=I.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=I.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=I.customRootNode,this.onMeshLoaded=I.onMeshLoaded,this.onSkinLoaded=I.onSkinLoaded,this.onTextureLoaded=I.onTextureLoaded,this.onMaterialLoaded=I.onMaterialLoaded,this.onCameraLoaded=I.onCameraLoaded,this.extensionOptions=I.extensionOptions??this.extensionOptions)}}class O extends r{constructor(I){super(),this.onParsedObservable=new e.c,this.onMeshLoadedObservable=new e.c,this.onSkinLoadedObservable=new e.c,this.onTextureLoadedObservable=new e.c,this.onMaterialLoadedObservable=new e.c,this.onCameraLoadedObservable=new e.c,this.onCompleteObservable=new e.c,this.onErrorObservable=new e.c,this.Og=new e.c,this.onExtensionLoadedObservable=new e.c,this.validate=!1,this.onValidatedObservable=new e.c,this._loader=null,this._state=null,this._requests=new Array,this.name=E.name,this.extensions=E.extensions,this.onLoaderStateChangedObservable=new e.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.G(I)}set onParsed(I){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),I&&(this._onParsedObserver=this.onParsedObservable.add(I))}set onMeshLoaded(I){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),I&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(I))}set onSkinLoaded(I){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),I&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((g=>I(g.node,g.skinnedNode))))}set onTextureLoaded(I){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),I&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(I))}set onMaterialLoaded(I){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),I&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(I))}set onCameraLoaded(I){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),I&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(I))}set onComplete(I){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(I)}set onError(I){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(I)}set onDispose(I){this._onDisposeObserver&&this.Og.remove(this._onDisposeObserver),this._onDisposeObserver=this.Og.add(I)}set onExtensionLoaded(I){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(I)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(I){this._loggingEnabled!==I&&(this._loggingEnabled=I,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(I){this._capturePerformanceCounters!==I&&(this._capturePerformanceCounters=I,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(I){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(I)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const I of this._requests)I.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=I=>Promise.resolve(I),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Og.notifyObservers(void 0),this.Og.clear()}loadFile(I,g,b,z,M,J,o,G){if(ArrayBuffer.isView(g))return this._loadBinary(I,g,b,z,o,G),null;this._progressCallback=M;const D=g.name||c.Tools.GetFilename(g);if(J){if(this.useRangeRequests){this.validate&&n.b.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new e.c},c={readAsync:(b,e)=>new Promise(((c,z)=>{this._loadFile(I,g,(I=>{c(new Uint8Array(I))}),!0,(I=>{z(I)}),(I=>{I.setRequestHeader("Range",`bytes=${b}-${b+e-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new v(c)).then((I=>{b.onCompleteObservable.notifyObservers(b),z(I)}),o?I=>o(void 0,I):void 0),b}return this._loadFile(I,g,(g=>{this._validate(I,new Uint8Array(g,0,g.byteLength),b,D),this._unpackBinaryAsync(new v({readAsync:(I,b)=>C(g,I,b),byteLength:g.byteLength})).then((I=>{z(I)}),o?I=>o(void 0,I):void 0)}),!0,o)}return this._loadFile(I,g,(g=>{try{this._validate(I,g,b,D),z({json:this._parseJson(g)})}catch{o&&o()}}),!1,o)}_loadBinary(I,g,b,e,c,z){this._validate(I,new Uint8Array(g.buffer,g.byteOffset,g.byteLength),b,z),this._unpackBinaryAsync(new v({readAsync:(I,b)=>function(I,g,b){try{if(g<0||g>=I.byteLength)throw new RangeError("Offset is out of range.");if(g+b>I.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(I.buffer,I.byteOffset+g,b))}catch(e){return Promise.reject(e)}}(g,I,b),byteLength:g.byteLength})).then((I=>{e(I)}),c?I=>c(void 0,I):void 0)}importMeshAsync(I,g,b,e,c,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(I,g,null,b,e,c,z))))}loadAsync(I,g,b,e,c){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(g),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(g),this._loader.loadAsync(I,g,b,e,c))))}loadAssetContainerAsync(I,g,b,e,c){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(g),this.onParsedObservable.clear(),this._log(`Loading ${c||""}`),this._loader=this._getLoader(g);const z=new V(I),M=[];this.onMaterialLoadedObservable.add((I=>{M.push(I)}));const J=[];this.onTextureLoadedObservable.add((I=>{J.push(I)}));const o=[];this.onCameraLoadedObservable.add((I=>{o.push(I)}));const n=[];return this.onMeshLoadedObservable.add((I=>{I.morphTargetManager&&n.push(I.morphTargetManager)})),this._loader.importMeshAsync(null,I,z,g,b,e,c).then((I=>(Array.prototype.push.apply(z.geometries,I.geometries),Array.prototype.push.apply(z.meshes,I.meshes),Array.prototype.push.apply(z.Ax,I.Ax),Array.prototype.push.apply(z.skeletons,I.skeletons),Array.prototype.push.apply(z.animationGroups,I.animationGroups),Array.prototype.push.apply(z.materials,M),Array.prototype.push.apply(z.textures,J),Array.prototype.push.apply(z.lights,I.lights),Array.prototype.push.apply(z.transformNodes,I.transformNodes),Array.prototype.push.apply(z.cameras,o),Array.prototype.push.apply(z.morphTargetManagers,n),z)))}))}canDirectLoad(I){return E.canDirectLoad(I)}directLoad(I,g){if(g.startsWith("base64,"+R)||g.startsWith(";base64,"+R)||g.startsWith("application/octet-stream;base64,"+R)||g.startsWith("model/gltf-binary;base64,"+R)){const b=(0,Y.e)(g);return this._validate(I,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new v({readAsync:(I,g)=>C(b,I,g),byteLength:b.byteLength}))}return this._validate(I,g),Promise.resolve({json:this._parseJson(g)})}createPlugin(I){return new O(I[E.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((I,g)=>{this.onCompleteObservable.addOnce((()=>{I()})),this.onErrorObservable.addOnce((I=>{g(I)}))}))}_setState(I){this._state!==I&&(this._state=I,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(F[this._state]))}_loadFile(I,g,b,e,c,z){const M=I._loadFile(g,b,(I=>{this._onProgress(I,M)}),!0,e,c,z);return M.onCompleteObservable.add((()=>{M._lengthComputable=!0,M._total=M._loaded})),this._requests.push(M),M}_onProgress(I,g){if(!this._progressCallback)return;g._lengthComputable=I.lengthComputable,g._loaded=I.loaded,g._total=I.total;let b=!0,e=0,c=0;for(const z of this._requests){if(void 0===z._lengthComputable||void 0===z._loaded||void 0===z._total)return;b=b&&z._lengthComputable,e+=z._loaded,c+=z._total}this._progressCallback({lengthComputable:b,loaded:e,total:b?c:0})}_validate(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),X.c.ValidateAsync(g,b,e,(g=>this.preprocessUrlAsync(b+g).then((g=>I._loadFileAsync(g,void 0,!0,!0).then((I=>new Uint8Array(I,0,I.byteLength))))))).then((I=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(I),this.onValidatedObservable.clear()}),(I=>{this._endPerformanceCounter("Validate JSON"),c.Tools.Warn(`Failed to validate: ${I.message}`),this.onValidatedObservable.clear()})))}_getLoader(I){const g=I.json.asset||{};this._log(`Asset version: ${g.version}`),g.minVersion&&this._log(`Asset minimum version: ${g.minVersion}`),g.generator&&this._log(`Asset generator: ${g.generator}`);const b=O._parseVersion(g.version);if(!b)throw new Error("Invalid version: "+g.version);if(void 0!==g.minVersion){const I=O._parseVersion(g.minVersion);if(!I)throw new Error("Invalid minimum version: "+g.minVersion);if(O._compareVersion(I,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+g.minVersion)}const e={1:O._CreateGLTF1Loader,2:O._CreateGLTF2Loader}[b.major];if(!e)throw new Error("Unsupported version: "+g.version);return e(this)}_parseJson(I){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${I.length}`);const g=JSON.parse(I);return this._endPerformanceCounter("Parse JSON"),g}_unpackBinaryAsync(I){return this._startPerformanceCounter("Unpack Binary"),I.loadAsync(20).then((()=>{const g=I.readUint32();if(1179937895!==g)throw new d.m("Unexpected magic: "+g,d.i.GLTFLoaderUnexpectedMagicError);const b=I.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const e=I.readUint32();let c;switch(this.useRangeRequests||e===I.buffer.byteLength||n.b.Warn(`Length in header does not match actual data length: ${e} != ${I.buffer.byteLength}`),b){case 1:c=this._unpackBinaryV1Async(I,e);break;case 2:c=this._unpackBinaryV2Async(I,e);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),c}))}_unpackBinaryV1Async(I,g){const b=I.readUint32(),e=I.readUint32();if(0!==e)throw new Error(`Unexpected content format: ${e}`);const c=g-I.byteOffset,z={json:this._parseJson(I.readString(b)),bin:null};if(0!==c){const g=I.byteOffset;z.bin={readAsync:(b,e)=>I.buffer.readAsync(g+b,e),byteLength:c}}return Promise.resolve(z)}_unpackBinaryV2Async(I,g){const b=1313821514,e=5130562,c=I.readUint32();if(I.readUint32()!==b)throw new Error("First chunk format is not JSON");return I.byteOffset+c===g?I.loadAsync(c).then((()=>({json:this._parseJson(I.readString(c)),bin:null}))):I.loadAsync(c+8).then((()=>{const z={json:this._parseJson(I.readString(c)),bin:null},M=()=>{const c=I.readUint32();switch(I.readUint32()){case b:throw new Error("Unexpected JSON chunk");case e:{const g=I.byteOffset;z.bin={readAsync:(b,e)=>I.buffer.readAsync(g+b,e),byteLength:c},I.skipBytes(c);break}default:I.skipBytes(c)}return I.byteOffset!==g?I.loadAsync(8).then(M):Promise.resolve(z)};return M()}))}static _parseVersion(I){if("1.0"===I||"1.0.1"===I)return{major:1,minor:0};const g=(I+"").match(/^(\d+)\.(\d+)/);return g?{major:parseInt(g[1]),minor:parseInt(g[2])}:null}static _compareVersion(I,g){return I.major>g.major?1:I.major<g.major?-1:I.minor>g.minor?1:I.minor<g.minor?-1:0}_logOpen(I){this._log(I),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(I){const g=O._logSpaces.substring(0,2*this._logIndentLevel);n.b.Log(`${g}${I}`)}_logDisabled(I){}_startPerformanceCounterEnabled(I){c.Tools.StartPerformanceCounter(I)}_startPerformanceCounterDisabled(I){}_endPerformanceCounterEnabled(I){c.Tools.EndPerformanceCounter(I)}_endPerformanceCounterDisabled(I){}}O.IncrementalLoading=!0,O.HomogeneousCoordinates=!1,O._logSpaces="                                ",(0,z.e)(new O)},14216:(I,g,b)=>{"use strict";b.d(g,{c:()=>M});var e=b(12409);function c(I,g,b,e){const c={externalResourceFunction:e};return b&&(c.uri="file:"===g?b:g+b),ArrayBuffer.isView(I)?GLTFValidator.validateBytes(I,c):GLTFValidator.validateString(I,c)}function z(){const I=[];onmessage=g=>{const b=g.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":c(b.data,b.rootUrl,b.fileName,(g=>new Promise(((b,e)=>{const c=I.length;I.push({resolve:b,reject:e}),postMessage({id:"getExternalResource",index:c,uri:g})})))).then((I=>{postMessage({id:"validate.resolve",value:I})}),(I=>{postMessage({id:"validate.reject",reason:I})}));break;case"getExternalResource.resolve":I[b.index].resolve(b.value);break;case"getExternalResource.reject":I[b.index].reject(b.reason)}}}class M{static ValidateAsync(I,g,b,M){return"function"===typeof Worker?new Promise(((J,o)=>{const n=`${c}(${z})()`,G=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),D=new Worker(G),p=I=>{D.removeEventListener("error",p),D.removeEventListener("message",x),o(I)},x=I=>{const g=I.data;switch(g.id){case"getExternalResource":M(g.uri).then((I=>{D.postMessage({id:"getExternalResource.resolve",index:g.index,value:I},[I.buffer])}),(I=>{D.postMessage({id:"getExternalResource.reject",index:g.index,reason:I})}));break;case"validate.resolve":D.removeEventListener("error",p),D.removeEventListener("message",x),J(g.value),D.terminate();break;case"validate.reject":D.removeEventListener("error",p),D.removeEventListener("message",x),o(g.reason),D.terminate()}};if(D.addEventListener("error",p),D.addEventListener("message",x),D.postMessage({id:"init",url:e.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(I)){const e=I.slice();D.postMessage({id:"validate",data:e,rootUrl:g,fileName:b},[e.buffer])}else D.postMessage({id:"validate",data:I,rootUrl:g,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=e.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>c(I,g,b,M))))}}M.Configuration={url:`${e.Tools._DefaultCdnUrl}/gltf_validator.js`}},14748:(I,g,b)=>{"use strict";b.d(g,{d:()=>E});var e=b(12577),c=b(12584),z=b(12622),M=b(12590),J=b(12966),o=b(12899),n=b(12659),G=b(12814),D=b(12558),p=b(12509);b(13985),b(13888),b(13904),b(13896),b(13909),b(13913),b(13918);const x="imageProcessingCompatibility",Z="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";p.c.IncludesShadersStore[x]||(p.c.IncludesShadersStore[x]=Z);const k="skyPixelShader",S="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";p.c.ShadersStore[k]||(p.c.ShadersStore[k]=S);b(13999),b(13927),b(13931),b(13943),b(13936);const f="skyVertexShader",V="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";p.c.ShadersStore[f]||(p.c.ShadersStore[f]=V);var a=b(12892),v=b(12952),X=b(12943);class R extends J.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class E extends o.d{constructor(I,g){super(I,g),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new M.Vg(0,100,0),this.useSunPosition=!1,this.cameraOffset=M.Vg.Zero(),this.up=M.Vg.Up(),this.dithering=!1,this._cameraPosition=M.Vg.Zero(),this._skyOrientation=new M.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(I,g){const b=g._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;g.materialDefines||(g.materialDefines=new R);const e=g.materialDefines,c=this.EI();if(this._isReadyForSubMesh(g))return!0;if((0,X.V)(I,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,e),(0,X.J)(I,e,!0,!1),e.IMAGEPROCESSINGPOSTPROCESS!==c.imageProcessingConfiguration.applyByPostProcess&&e.markAsMiscDirty(),e.DITHER!==this.dithering&&e.markAsMiscDirty(),e.isDirty){e.markAsProcessed(),c.resetCachedMaterial();const I=new a.e;e.FOG&&I.addFallback(1,"FOG"),e.IMAGEPROCESSINGPOSTPROCESS=c.imageProcessingConfiguration.applyByPostProcess,e.DITHER=this.dithering;const b=[n.f.PositionKind];e.VERTEXCOLOR&&b.push(n.f.ColorKind);const z="sky",M=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,v.b)(M);const J=e.toString();g.setEffect(c.getEngine().createEffect(z,b,M,[],J,I,this.onCompiled,this.onError),e,this._materialContext)}return!(!g.effect||!g.effect.isReady())&&(e._renderId=c.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(I,g,b){const e=this.EI(),c=b.materialDefines;if(!c)return;const z=b.effect;if(!z)return;this._activeEffect=z,this.bindOnlyWorldMatrix(I),this._activeEffect.setMatrix("viewProjection",e.getTransformMatrix()),this._mustRebind(e,z,b)&&((0,v.f)(z,this,e),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,X.j)(c,z,e)),e.fogEnabled&&g.applyFog&&e.fogMode!==G.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",e.getViewMatrix()),(0,X.d)(e,g,this._activeEffect);const J=e.activeCamera;if(J){const I=J.getWorldMatrix();this._cameraPosition.x=I.m[12],this._cameraPosition.y=I.m[13],this._cameraPosition.z=I.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const I=Math.PI*(this.inclination-.5),g=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(g)*Math.cos(I),this.sunPosition.y=this.distance*Math.sin(-I),this.sunPosition.z=this.distance*Math.sin(g)*Math.cos(I),M.Quaternion.FromUnitVectorsToRef(M.Vg.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(g,this._activeEffect,b)}getAnimatables(){return[]}dispose(I){super.dispose(I)}clone(I){return z.b.Clone((()=>new E(I,this.EI())),this)}serialize(){const I=super.serialize();return I.customType="BABYLON.SkyMaterial",I}getClassName(){return"SkyMaterial"}static Parse(I,g,b){return z.b.Parse((()=>new E(I.name,g)),I,g,b)}}(0,e.d)([(0,c.E)()],E.prototype,"luminance",void 0),(0,e.d)([(0,c.E)()],E.prototype,"turbidity",void 0),(0,e.d)([(0,c.E)()],E.prototype,"rayleigh",void 0),(0,e.d)([(0,c.E)()],E.prototype,"mieCoefficient",void 0),(0,e.d)([(0,c.E)()],E.prototype,"mieDirectionalG",void 0),(0,e.d)([(0,c.E)()],E.prototype,"distance",void 0),(0,e.d)([(0,c.E)()],E.prototype,"inclination",void 0),(0,e.d)([(0,c.E)()],E.prototype,"azimuth",void 0),(0,e.d)([(0,c.A)()],E.prototype,"sunPosition",void 0),(0,e.d)([(0,c.E)()],E.prototype,"useSunPosition",void 0),(0,e.d)([(0,c.A)()],E.prototype,"cameraOffset",void 0),(0,e.d)([(0,c.A)()],E.prototype,"up",void 0),(0,e.d)([(0,c.E)()],E.prototype,"dithering",void 0),(0,D.g)("BABYLON.SkyMaterial",E)},13257:(I,g,b)=>{"use strict";function e(I,g){g.headers=I.headers||{},g.statusMessage=I.statusText,g.statusCode=I.status,g.data=I.response}function c(I,g,b){return new Promise((function(c,z){b=b||{};var M,J,o,n=new XMLHttpRequest,G=b.body,D=b.headers||{};for(M in b.timeout&&(n.timeout=b.timeout),n.ontimeout=n.onerror=function(I){I.timeout="timeout"==I.type,z(I)},n.open(I,g.href||g),n.onload=function(){for(o=n.getAllResponseHeaders().trim().split(/[\r\n]+/),e(n,n);J=o.shift();)J=J.split(": "),n.headers[J.shift().toLowerCase()]=J.join(": ");if((J=n.headers["content-type"])&&~J.indexOf("application/json"))try{n.data=JSON.parse(n.data,b.reviver)}catch(I){return e(n,I),z(I)}(n.status>=400?z:c)(n)},typeof FormData<"u"&&G instanceof FormData||G&&"object"==typeof G&&(D["content-type"]="application/json",G=JSON.stringify(G)),n.withCredentials=!!b.withCredentials,D)n.setRequestHeader(M,D[M]);n.send(G)}))}b.r(g),b.d(g,{del:()=>o,get:()=>z,patch:()=>J,post:()=>M,put:()=>n,send:()=>c});var z=c.bind(c,"GET"),M=c.bind(c,"POST"),J=c.bind(c,"PATCH"),o=c.bind(c,"DELETE"),n=c.bind(c,"PUT")},14865:(I,g,b)=>{"use strict";b.d(g,{e:()=>D});const e=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,z=1/3,M=1/6,J=(Math.sqrt(5)-1)/4,o=(5-Math.sqrt(5))/20,n=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),G=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const D=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const g="function"==typeof I?I:function(I){let g=0,b=0,e=0,c=1;const z=function(){let I=4022871197;return function(g){g=g.toString();for(let b=0;b<g.length;b++){I+=g.charCodeAt(b);let e=.02519603282416938*I;I=e>>>0,e-=I,e*=I,I=e>>>0,e-=I,I+=4294967296*e}return 2.3283064365386963e-10*(I>>>0)}}();g=z(" "),b=z(" "),e=z(" "),g-=z(I),g<0&&(g+=1);b-=z(I),b<0&&(b+=1);e-=z(I),e<0&&(e+=1);return function(){const I=2091639*g+2.3283064365386963e-10*c;return g=b,b=e,e=I-(c=0|I)}}(I);this.p=function(I){const g=new Uint8Array(256);for(let b=0;b<256;b++)g[b]=b;for(let b=0;b<255;b++){const e=b+~~(I()*(256-b)),c=g[b];g[b]=g[e],g[e]=c}return g}(g),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(I,g){const b=this.permMod12,z=this.perm;let M=0,J=0,o=0;const G=(I+g)*e,D=Math.floor(I+G),p=Math.floor(g+G),x=(D+p)*c,Z=I-(D-x),k=g-(p-x);let S,f;Z>k?(S=1,f=0):(S=0,f=1);const V=Z-S+c,a=k-f+c,v=Z-1+2*c,X=k-1+2*c,R=255&D,E=255&p;let mI=.5-Z*Z-k*k;if(mI>=0){const I=3*b[R+z[E]];mI*=mI,M=mI*mI*(n[I]*Z+n[I+1]*k)}let s=.5-V*V-a*a;if(s>=0){const I=3*b[R+S+z[E+f]];s*=s,J=s*s*(n[I]*V+n[I+1]*a)}let F=.5-v*v-X*X;if(F>=0){const I=3*b[R+1+z[E+1]];F*=F,o=F*F*(n[I]*v+n[I+1]*X)}return 70*(M+J+o)}noise3D(I,g,b){const e=this.permMod12,c=this.perm;let J,o,G,D;const p=(I+g+b)*z,x=Math.floor(I+p),Z=Math.floor(g+p),k=Math.floor(b+p),S=(x+Z+k)*M,f=I-(x-S),V=g-(Z-S),a=b-(k-S);let v,X,R,E,mI,s;f>=V?V>=a?(v=1,X=0,R=0,E=1,mI=1,s=0):f>=a?(v=1,X=0,R=0,E=1,mI=0,s=1):(v=0,X=0,R=1,E=1,mI=0,s=1):V<a?(v=0,X=0,R=1,E=0,mI=1,s=1):f<a?(v=0,X=1,R=0,E=0,mI=1,s=1):(v=0,X=1,R=0,E=1,mI=1,s=0);const F=f-v+M,Y=V-X+M,d=a-R+M,C=f-E+2*M,r=V-mI+2*M,O=a-s+2*M,H=f-1+.5,i=V-1+.5,U=a-1+.5,h=255&x,A=255&Z,j=255&k;let Q=.6-f*f-V*V-a*a;if(Q<0)J=0;else{const I=3*e[h+c[A+c[j]]];Q*=Q,J=Q*Q*(n[I]*f+n[I+1]*V+n[I+2]*a)}let L=.6-F*F-Y*Y-d*d;if(L<0)o=0;else{const I=3*e[h+v+c[A+X+c[j+R]]];L*=L,o=L*L*(n[I]*F+n[I+1]*Y+n[I+2]*d)}let N=.6-C*C-r*r-O*O;if(N<0)G=0;else{const I=3*e[h+E+c[A+mI+c[j+s]]];N*=N,G=N*N*(n[I]*C+n[I+1]*r+n[I+2]*O)}let K=.6-H*H-i*i-U*U;if(K<0)D=0;else{const I=3*e[h+1+c[A+1+c[j+1]]];K*=K,D=K*K*(n[I]*H+n[I+1]*i+n[I+2]*U)}return 32*(J+o+G+D)}noise4D(I,g,b,e){const c=this.perm;let z,M,n,D,p;const x=(I+g+b+e)*J,Z=Math.floor(I+x),k=Math.floor(g+x),S=Math.floor(b+x),f=Math.floor(e+x),V=(Z+k+S+f)*o,a=I-(Z-V),v=g-(k-V),X=b-(S-V),R=e-(f-V);let E=0,mI=0,s=0,F=0;a>v?E++:mI++,a>X?E++:s++,a>R?E++:F++,v>X?mI++:s++,v>R?mI++:F++,X>R?s++:F++;const Y=E>=3?1:0,d=mI>=3?1:0,C=s>=3?1:0,r=F>=3?1:0,O=E>=2?1:0,H=mI>=2?1:0,i=s>=2?1:0,U=F>=2?1:0,h=E>=1?1:0,A=mI>=1?1:0,j=s>=1?1:0,Q=F>=1?1:0,L=a-Y+o,N=v-d+o,K=X-C+o,B=R-r+o,P=a-O+2*o,u=v-H+2*o,t=X-i+2*o,y=R-U+2*o,q=a-h+3*o,l=v-A+3*o,w=X-j+3*o,T=R-Q+3*o,W=a-1+4*o,II=v-1+4*o,gI=X-1+4*o,bI=R-1+4*o,eI=255&Z,cI=255&k,zI=255&S,MI=255&f;let JI=.6-a*a-v*v-X*X-R*R;if(JI<0)z=0;else{const I=c[eI+c[cI+c[zI+c[MI]]]]%32*4;JI*=JI,z=JI*JI*(G[I]*a+G[I+1]*v+G[I+2]*X+G[I+3]*R)}let oI=.6-L*L-N*N-K*K-B*B;if(oI<0)M=0;else{const I=c[eI+Y+c[cI+d+c[zI+C+c[MI+r]]]]%32*4;oI*=oI,M=oI*oI*(G[I]*L+G[I+1]*N+G[I+2]*K+G[I+3]*B)}let nI=.6-P*P-u*u-t*t-y*y;if(nI<0)n=0;else{const I=c[eI+O+c[cI+H+c[zI+i+c[MI+U]]]]%32*4;nI*=nI,n=nI*nI*(G[I]*P+G[I+1]*u+G[I+2]*t+G[I+3]*y)}let GI=.6-q*q-l*l-w*w-T*T;if(GI<0)D=0;else{const I=c[eI+h+c[cI+A+c[zI+j+c[MI+Q]]]]%32*4;GI*=GI,D=GI*GI*(G[I]*q+G[I+1]*l+G[I+2]*w+G[I+3]*T)}let DI=.6-W*W-II*II-gI*gI-bI*bI;if(DI<0)p=0;else{const I=c[eI+1+c[cI+1+c[zI+1+c[MI+1]]]]%32*4;DI*=DI,p=DI*DI*(G[I]*W+G[I+1]*II+G[I+2]*gI+G[I+3]*bI)}return 27*(z+M+n+D+p)}}}}]);