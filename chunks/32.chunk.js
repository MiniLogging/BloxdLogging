/*! For license information please see 5sc22.32.c9083e4a.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13233:(Z,x,F)=>{"use strict";var u=F(13237),G=F(13241),f=F(13243);F.g.__TYPEDARRAY_POOL||(F.g.__TYPEDARRAY_POOL={UINT8:G([32,0]),UINT16:G([32,0]),UINT32:G([32,0]),INT8:G([32,0]),INT16:G([32,0]),INT32:G([32,0]),FLOAT:G([32,0]),DOUBLE:G([32,0]),DATA:G([32,0]),UINT8C:G([32,0]),BUFFER:G([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,j=F.g.__TYPEDARRAY_POOL;j.UINT8C||(j.UINT8C=G([32,0])),j.BUFFER||(j.BUFFER=G([32,0]));var d=j.DATA,t=j.BUFFER;function o(Z){if(Z){var x=Z.length||Z.byteLength,F=u.log2(x);d[F].push(Z)}}function c(Z){Z=u.nextPow2(Z);var x=u.log2(Z),F=d[x];return F.length>0?F.pop():new ArrayBuffer(Z)}function s(Z){return new Uint8Array(c(Z),0,Z)}function J(Z){return new Uint16Array(c(2*Z),0,Z)}function p(Z){return new Uint32Array(c(4*Z),0,Z)}function U(Z){return new Int8Array(c(Z),0,Z)}function k(Z){return new Int16Array(c(2*Z),0,Z)}function M(Z){return new Int32Array(c(4*Z),0,Z)}function m(Z){return new Float32Array(c(4*Z),0,Z)}function C(Z){return new Float64Array(c(8*Z),0,Z)}function L(Z){return Y?new Uint8ClampedArray(c(Z),0,Z):s(Z)}function H(Z){return new DataView(c(Z),0,Z)}x.free=function(Z){if(f(Z))t[u.log2(Z.length)].push(Z);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(Z)&&(Z=Z.buffer),!Z)return;var x=Z.length||Z.byteLength,F=0|u.log2(x);d[F].push(Z)}},x.freeUint8=x.freeUint16=x.freeUint32=x.freeInt8=x.freeInt16=x.freeInt32=x.freeFloat32=x.freeFloat=x.freeFloat64=x.freeDouble=x.freeUint8Clamped=x.freeDataView=function(Z){o(Z.buffer)},x.freeArrayBuffer=o,x.freeBuffer=function(Z){t[u.log2(Z.length)].push(Z)},x.malloc=function(Z,x){if(void 0===x||"arraybuffer"===x)return c(Z);switch(x){case"uint8":return s(Z);case"uint16":return J(Z);case"uint32":return p(Z);case"int8":return U(Z);case"int16":return k(Z);case"int32":return M(Z);case"float":case"float32":return m(Z);case"double":case"float64":return C(Z);case"uint8_clamped":return L(Z);case"buffer":throw"Buffer not supported";case"data":case"dataview":return H(Z);default:return null}return null},x.mallocArrayBuffer=c,x.mallocUint8=s,x.mallocUint16=J,x.mallocUint32=p,x.mallocInt8=U,x.mallocInt16=k,x.mallocInt32=M,x.mallocFloat32=x.mallocFloat=m,x.mallocFloat64=x.mallocDouble=C,x.mallocUint8Clamped=L,x.mallocDataView=H,x.clearCache=function(){for(var Z=0;Z<32;++Z)j.UINT8[Z].length=0,j.UINT16[Z].length=0,j.UINT32[Z].length=0,j.INT8[Z].length=0,j.INT16[Z].length=0,j.INT32[Z].length=0,j.FLOAT[Z].length=0,j.DOUBLE[Z].length=0,j.UINT8C[Z].length=0,d[Z].length=0,t[Z].length=0}},13322:(Z,x,F)=>{Z.exports=G;var u=F(12039);function G(Z,x){if(!(this instanceof G))return new G(Z,x);var F=u.create();u.add(F,Z,x),this.base=u.min(u.create(),Z,F),this.Go=u.clone(x),this.max=u.max(u.create(),Z,F),this.mag=u.length(this.Go)}var f=G.prototype;f.width=function(){return this.Go[0]},f.height=function(){return this.Go[1]},f.depth=function(){return this.Go[2]},f.x0=function(){return this.base[0]},f.y0=function(){return this.base[1]},f.z0=function(){return this.base[2]},f.x1=function(){return this.max[0]},f.y1=function(){return this.max[1]},f.z1=function(){return this.max[2]},f.translate=function(Z){return u.add(this.max,this.max,Z),u.add(this.base,this.base,Z),this},f.setPosition=function(Z){return u.add(this.max,Z,this.Go),u.k(this.base,Z),this},f.expand=function(Z){var x=u.create(),F=u.create();return u.max(x,Z.max,this.max),u.min(F,Z.base,this.base),u.Mx(x,x,F),new G(F,x)},f.intersects=function(Z){return!(Z.base[0]>this.max[0])&&(!(Z.base[1]>this.max[1])&&(!(Z.base[2]>this.max[2])&&(!(Z.max[0]<this.base[0])&&(!(Z.max[1]<this.base[1])&&!(Z.max[2]<this.base[2])))))},f.touches=function(Z){var x=this.union(Z);return null!==x&&(0==x.width()||0==x.height()||0==x.depth())},f.union=function(Z){if(!this.intersects(Z))return null;var x=Math.max(Z.base[0],this.base[0]),F=Math.max(Z.base[1],this.base[1]),u=Math.max(Z.base[2],this.base[2]);return new G([x,F,u],[Math.min(Z.max[0],this.max[0])-x,Math.min(Z.max[1],this.max[1])-F,Math.min(Z.max[2],this.max[2])-u])}},13237:(Z,x)=>{"use strict";function F(Z){var x=32;return(Z&=-Z)&&x--,65535&Z&&(x-=16),16711935&Z&&(x-=8),252645135&Z&&(x-=4),858993459&Z&&(x-=2),1431655765&Z&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(Z){return(Z>0)-(Z<0)},x.abs=function(Z){var x=Z>>31;return(Z^x)-x},x.min=function(Z,x){return x^(Z^x)&-(Z<x)},x.max=function(Z,x){return Z^(Z^x)&-(Z<x)},x.isPow2=function(Z){return!(Z&Z-1)&&!!Z},x.log2=function(Z){var x,F;return x=(Z>65535)<<4,x|=F=((Z>>>=x)>255)<<3,x|=F=((Z>>>=F)>15)<<2,(x|=F=((Z>>>=F)>3)<<1)|(Z>>>=F)>>1},x.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},x.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},x.countTrailingZeros=F,x.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},x.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},x.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var u=new Array(256);!function(Z){for(var x=0;x<256;++x){var F=x,u=x,G=7;for(F>>>=1;F;F>>>=1)u<<=1,u|=1&F,--G;Z[x]=u<<G&255}}(u),x.reverse=function(Z){return u[255&Z]<<24|u[Z>>>8&255]<<16|u[Z>>>16&255]<<8|u[Z>>>24&255]},x.interleave2=function(Z,x){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(Z,x){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>x&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},x.interleave3=function(Z,x,F){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},x.deinterleave3=function(Z,x){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>x&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},x.nextCombination=function(Z){var x=Z|Z-1;return x+1|(~x&-~x)-1>>>F(Z)+1}},13226:(Z,x,F)=>{"use strict";Z.exports=function(Z,x,F){switch(arguments.length){case 1:return u=[],t(G=Z,G,o,!0),u;case 2:return"function"===typeof x?t(Z,Z,x,!0):function(Z,x){return u=[],t(Z,x,o,!1),u}(Z,x);case 3:return t(Z,x,F,!1);default:throw new Error("box-intersect: Invalid arguments")}var G};var u,G=F(13233),f=F(13251),Y=F(13267);function j(Z,x){for(var F=0;F<Z;++F)if(!(x[F]<=x[F+Z]))return!0;return!1}function d(Z,x,F,u){for(var G=0,f=0,Y=0,d=Z.length;Y<d;++Y){var t=Z[Y];if(!j(x,t)){for(var o=0;o<2*x;++o)F[G++]=t[o];u[f++]=Y}}return f}function t(Z,x,F,u){var j=Z.length,t=x.length;if(!(j<=0||t<=0)){var o=Z[0].length>>>1;if(!(o<=0)){var c,s=G.mallocDouble(2*o*j),J=G.mallocInt32(j);if((j=d(Z,o,s,J))>0){if(1===o&&u)f.init(j),c=f.sweepComplete(o,F,0,j,s,J,0,j,s,J);else{var p=G.mallocDouble(2*o*t),U=G.mallocInt32(t);(t=d(x,o,p,U))>0&&(f.init(j+t),c=1===o?f.sweepBipartite(o,F,0,j,s,J,0,t,p,U):Y(o,F,u,j,s,J,t,p,U),G.free(p),G.free(U))}G.free(s),G.free(J)}return c}}}function o(Z,x){u.push([Z,x])}},13269:(Z,x)=>{"use strict";var F="d",u="ax",G="fp",f="es",Y="rs",j="re",d="rb",t="bs",o="be",c="bb",s=[F,u,"vv",Y,j,d,"ri",t,o,c,"bi"];function J(Z){var x="bruteForce"+(Z?"Full":"Partial"),u=[],Y=s.slice();Z||Y.splice(3,0,G);var j=["function "+x+"("+Y.join()+"){"];function d(x,G){var Y=function(Z,x,u){var G="bruteForce"+(Z?"Red":"Blue")+(x?"Flip":"")+(u?"Full":""),Y=["function ",G,"(",s.join(),"){","var ",f,"=2*",F,";"],j="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",d="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(u?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return Z?Y.push(j,"Q",":",d):Y.push(d,"Q",":",j),u?Y.push("if(y1<x0||x1<y0)continue;"):x?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),x?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:G,code:Y.join("")}}(x,G,Z);u.push(Y.code),j.push("return "+Y.name+"("+s.join()+");")}j.push("if(re-rs>be-bs){"),Z?(d(!0,!1),j.push("}else{"),d(!1,!1)):(j.push("if(fp){"),d(!0,!0),j.push("}else{"),d(!0,!1),j.push("}}else{if(fp){"),d(!1,!0),j.push("}else{"),d(!1,!1),j.push("}")),j.push("}}return "+x);var t=u.join("")+j.join("");return new Function(t)()}x.partial=J(!1),x.full=J(!0)},13267:(Z,x,F)=>{"use strict";Z.exports=function(Z,x,F,f,o,B,v,l,i){!function(Z,x){var F=8*G.log2(x+1)*(Z+1)|0,f=G.nextPow2(L*F);S.length<f&&(u.free(S),S=u.mallocInt32(f));var Y=G.nextPow2(H*F);K.length<Y&&(u.free(K),K=u.mallocDouble(Y))}(Z,f+v);var e,b=0,E=2*Z;y(b++,0,0,f,0,v,F?16:0,-1/0,1/0),F||y(b++,0,0,v,0,f,1,-1/0,1/0);for(;b>0;){var w=(b-=1)*L,T=S[w],N=S[w+1],W=S[w+2],A=S[w+3],h=S[w+4],X=S[w+5],D=b*H,Q=K[D],g=K[D+1],O=1&X,n=!!(16&X),V=o,a=B,I=l,r=i;if(O&&(V=l,a=i,I=o,r=B),!(2&X&&N>=(W=k(Z,T,N,W,V,a,g)))&&!(4&X&&(N=M(Z,T,N,W,V,a,Q))>=W)){var z=W-N,P=h-A;if(n){if(Z*z*(z+P)<J){if(void 0!==(e=d.scanComplete(Z,T,x,N,W,V,a,A,h,I,r)))return e;continue}}else{if(Z*Math.min(z,P)<c){if(void 0!==(e=Y(Z,T,x,O,N,W,V,a,A,h,I,r)))return e;continue}if(Z*z*P<s){if(void 0!==(e=d.scanBipartite(Z,T,x,O,N,W,V,a,A,h,I,r)))return e;continue}}var ZZ=p(Z,T,N,W,V,a,Q,g);if(N<ZZ)if(Z*(ZZ-N)<c){if(void 0!==(e=j(Z,T+1,x,N,ZZ,V,a,A,h,I,r)))return e}else if(T===Z-2){if(void 0!==(e=O?d.sweepBipartite(Z,x,A,h,I,r,N,ZZ,V,a):d.sweepBipartite(Z,x,N,ZZ,V,a,A,h,I,r)))return e}else y(b++,T+1,N,ZZ,A,h,O,-1/0,1/0),y(b++,T+1,A,h,N,ZZ,1^O,-1/0,1/0);if(ZZ<W){var xZ=t(Z,T,A,h,I,r),FZ=I[E*xZ+T],uZ=U(Z,T,xZ,h,I,r,FZ);if(uZ<h&&y(b++,T,ZZ,W,uZ,h,(4|O)+(n?16:0),FZ,g),A<xZ&&y(b++,T,ZZ,W,A,xZ,(2|O)+(n?16:0),Q,FZ),xZ+1===uZ){if(void 0!==(e=n?R(Z,T,x,ZZ,W,V,a,xZ,I,r[xZ]):q(Z,T,x,O,ZZ,W,V,a,xZ,I,r[xZ])))return e}else if(xZ<uZ){var GZ;if(n){if(ZZ<(GZ=m(Z,T,ZZ,W,V,a,FZ))){var fZ=U(Z,T,ZZ,GZ,V,a,FZ);if(T===Z-2){if(ZZ<fZ&&void 0!==(e=d.sweepComplete(Z,x,ZZ,fZ,V,a,xZ,uZ,I,r)))return e;if(fZ<GZ&&void 0!==(e=d.sweepBipartite(Z,x,fZ,GZ,V,a,xZ,uZ,I,r)))return e}else ZZ<fZ&&y(b++,T+1,ZZ,fZ,xZ,uZ,16,-1/0,1/0),fZ<GZ&&(y(b++,T+1,fZ,GZ,xZ,uZ,0,-1/0,1/0),y(b++,T+1,xZ,uZ,fZ,GZ,1,-1/0,1/0))}}else ZZ<(GZ=O?C(Z,T,ZZ,W,V,a,FZ):m(Z,T,ZZ,W,V,a,FZ))&&(T===Z-2?e=O?d.sweepBipartite(Z,x,xZ,uZ,I,r,ZZ,GZ,V,a):d.sweepBipartite(Z,x,ZZ,GZ,V,a,xZ,uZ,I,r):(y(b++,T+1,ZZ,GZ,xZ,uZ,O,-1/0,1/0),y(b++,T+1,xZ,uZ,ZZ,GZ,1^O,-1/0,1/0)))}}}}};var u=F(13233),G=F(13237),f=F(13269),Y=f.partial,j=f.full,d=F(13251),t=F(13276),o=F(13280),c=128,s=1<<22,J=1<<22,p=o("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),U=o("lo===p0",["p0"]),k=o("lo<p0",["p0"]),M=o("hi<=p0",["p0"]),m=o("lo<=p0&&p0<=hi",["p0"]),C=o("lo<p0&&p0<=hi",["p0"]),L=6,H=2,S=u.mallocInt32(1024),K=u.mallocDouble(1024);function y(Z,x,F,u,G,f,Y,j,d){var t=L*Z;S[t]=x,S[t+1]=F,S[t+2]=u,S[t+3]=G,S[t+4]=f,S[t+5]=Y;var o=H*Z;K[o]=j,K[o+1]=d}function q(Z,x,F,u,G,f,Y,j,d,t,o){var c=2*Z,s=d*c,J=t[s+x];Z:for(var p=G,U=G*c;p<f;++p,U+=c){var k=Y[U+x],M=Y[U+x+Z];if(!(J<k||M<J)&&(!u||J!==k)){for(var m,C=j[p],L=x+1;L<Z;++L){k=Y[U+L],M=Y[U+L+Z];var H=t[s+L],S=t[s+L+Z];if(M<H||S<k)continue Z}if(void 0!==(m=u?F(o,C):F(C,o)))return m}}}function R(Z,x,F,u,G,f,Y,j,d,t){var o=2*Z,c=j*o,s=d[c+x];Z:for(var J=u,p=u*o;J<G;++J,p+=o){var U=Y[J];if(U!==t){var k=f[p+x],M=f[p+x+Z];if(!(s<k||M<s)){for(var m=x+1;m<Z;++m){k=f[p+m],M=f[p+m+Z];var C=d[c+m],L=d[c+m+Z];if(M<C||L<k)continue Z}var H=F(U,t);if(void 0!==H)return H}}}}},13276:(Z,x,F)=>{"use strict";Z.exports=function(Z,x,F,Y,j,d){if(Y<=F+1)return F;var t=F,o=Y,c=Y+F>>>1,s=2*Z,J=c,p=j[s*c+x];for(;t<o;){if(o-t<G){f(Z,x,t,o,j,d),p=j[s*c+x];break}var U=o-t,k=Math.random()*U+t|0,M=j[s*k+x],m=Math.random()*U+t|0,C=j[s*m+x],L=Math.random()*U+t|0,H=j[s*L+x];M<=C?H>=C?(J=m,p=C):M>=H?(J=k,p=M):(J=L,p=H):C>=H?(J=m,p=C):H>=M?(J=k,p=M):(J=L,p=H);for(var S=s*(o-1),K=s*J,y=0;y<s;++y,++S,++K){var q=j[S];j[S]=j[K],j[K]=q}var R=d[o-1];d[o-1]=d[J],d[J]=R;for(S=s*(o-1),K=s*(J=u(Z,x,t,o-1,j,d,p)),y=0;y<s;++y,++S,++K){q=j[S];j[S]=j[K],j[K]=q}R=d[o-1];if(d[o-1]=d[J],d[J]=R,c<J){for(o=J-1;t<o&&j[s*(o-1)+x]===p;)o-=1;o+=1}else{if(!(J<c))break;for(t=J+1;t<o&&j[s*t+x]===p;)t+=1}}return u(Z,x,F,c,j,d,j[s*c+x])};var u=F(13280)("lo<p0",["p0"]),G=8;function f(Z,x,F,u,G,f){for(var Y=2*Z,j=Y*(F+1)+x,d=F+1;d<u;++d,j+=Y)for(var t=G[j],o=d,c=Y*(d-1);o>F&&G[c+x]>t;--o,c-=Y){for(var s=c,J=c+Y,p=0;p<Y;++p,++s,++J){var U=G[s];G[s]=G[J],G[J]=U}var k=f[o];f[o]=f[o-1],f[o-1]=k}}},13280:Z=>{"use strict";Z.exports=function(Z,F){var u="abcdef".split("").concat(F),G=[];Z.indexOf("lo")>=0&&G.push("lo=e[k+n]");Z.indexOf("hi")>=0&&G.push("hi=e[k+o]");return u.push(x.replace("_",G.join()).replace("$",Z)),Function.apply(void 0,u)};var x="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13258:Z=>{"use strict";Z.exports=function(Z,u){u<=4*x?F(0,u-1,Z):t(0,u-1,Z)};var x=32;function F(Z,x,F){for(var u=2*(Z+1),G=Z+1;G<=x;++G){for(var f=F[u++],Y=F[u++],j=G,d=u-2;j-- >Z;){var t=F[d-2],o=F[d-1];if(t<f)break;if(t===f&&o<Y)break;F[d]=t,F[d+1]=o,d-=2}F[d]=f,F[d+1]=Y}}function u(Z,x,F){x*=2;var u=F[Z*=2],G=F[Z+1];F[Z]=F[x],F[Z+1]=F[x+1],F[x]=u,F[x+1]=G}function G(Z,x,F){x*=2,F[Z*=2]=F[x],F[Z+1]=F[x+1]}function f(Z,x,F,u){x*=2,F*=2;var G=u[Z*=2],f=u[Z+1];u[Z]=u[x],u[Z+1]=u[x+1],u[x]=u[F],u[x+1]=u[F+1],u[F]=G,u[F+1]=f}function Y(Z,x,F,u,G){x*=2,G[Z*=2]=G[x],G[x]=F,G[Z+1]=G[x+1],G[x+1]=u}function j(Z,x,F){x*=2;var u=F[Z*=2],G=F[x];return!(u<G)&&(u!==G||F[Z+1]>F[x+1])}function d(Z,x,F,u){var G=u[Z*=2];return G<x||G===x&&u[Z+1]<F}function t(Z,o,c){var s=(o-Z+1)/6|0,J=Z+s,p=o-s,U=Z+o>>1,k=U-s,M=U+s,m=J,C=k,L=U,H=M,S=p,K=Z+1,y=o-1,q=0;j(m,C,c)&&(q=m,m=C,C=q),j(H,S,c)&&(q=H,H=S,S=q),j(m,L,c)&&(q=m,m=L,L=q),j(C,L,c)&&(q=C,C=L,L=q),j(m,H,c)&&(q=m,m=H,H=q),j(L,H,c)&&(q=L,L=H,H=q),j(C,S,c)&&(q=C,C=S,S=q),j(C,L,c)&&(q=C,C=L,L=q),j(H,S,c)&&(q=H,H=S,S=q);for(var R=c[2*C],B=c[2*C+1],v=c[2*H],l=c[2*H+1],i=2*m,e=2*L,b=2*S,E=2*J,w=2*U,T=2*p,N=0;N<2;++N){var W=c[i+N],A=c[e+N],h=c[b+N];c[E+N]=W,c[w+N]=A,c[T+N]=h}G(k,Z,c),G(M,o,c);for(var X=K;X<=y;++X)if(d(X,R,B,c))X!==K&&u(X,K,c),++K;else if(!d(X,v,l,c))for(;;){if(d(y,v,l,c)){d(y,R,B,c)?(f(X,K,y,c),++K,--y):(u(X,y,c),--y);break}if(--y<X)break}Y(Z,K-1,R,B,c),Y(o,y+1,v,l,c),K-2-Z<=x?F(Z,K-2,c):t(Z,K-2,c),o-(y+2)<=x?F(y+2,o,c):t(y+2,o,c),y-K<=x?F(K,y,c):t(K,y,c)}},13251:(Z,x,F)=>{"use strict";Z.exports={init:function(Z){var x=G.nextPow2(Z);d.length<x&&(u.free(d),d=u.mallocInt32(x));t.length<x&&(u.free(t),t=u.mallocInt32(x));o.length<x&&(u.free(o),o=u.mallocInt32(x));c.length<x&&(u.free(c),c=u.mallocInt32(x));s.length<x&&(u.free(s),s=u.mallocInt32(x));J.length<x&&(u.free(J),J=u.mallocInt32(x));var F=8*x;p.length<F&&(u.free(p),p=u.mallocDouble(F))},sweepBipartite:function(Z,x,F,u,G,j,s,J,M,m){for(var C=0,L=2*Z,H=Z-1,S=L-1,K=F;K<u;++K){var y=j[K],q=L*K;p[C++]=G[q+H],p[C++]=-(y+1),p[C++]=G[q+S],p[C++]=y}for(K=s;K<J;++K){y=m[K]+Y;var R=L*K;p[C++]=M[R+H],p[C++]=-y,p[C++]=M[R+S],p[C++]=y}var B=C>>>1;f(p,B);var v=0,l=0;for(K=0;K<B;++K){var i=0|p[2*K+1];if(i>=Y)U(o,c,l--,i=i-Y|0);else if(i>=0)U(d,t,v--,i);else if(i<=-Y){i=-i-Y|0;for(var e=0;e<v;++e){if(void 0!==(b=x(d[e],i)))return b}k(o,c,l++,i)}else{i=-i-1|0;for(e=0;e<l;++e){var b;if(void 0!==(b=x(i,o[e])))return b}k(d,t,v++,i)}}},sweepComplete:function(Z,x,F,u,G,Y,j,M,m,C){for(var L=0,H=2*Z,S=Z-1,K=H-1,y=F;y<u;++y){var q=Y[y]+1<<1,R=H*y;p[L++]=G[R+S],p[L++]=-q,p[L++]=G[R+K],p[L++]=q}for(y=j;y<M;++y){q=C[y]+1<<1;var B=H*y;p[L++]=m[B+S],p[L++]=1|-q,p[L++]=m[B+K],p[L++]=1|q}var v=L>>>1;f(p,v);var l=0,i=0,e=0;for(y=0;y<v;++y){var b=0|p[2*y+1],E=1&b;if(y<v-1&&b>>1===p[2*y+3]>>1&&(E=2,y+=1),b<0){for(var w=-(b>>1)-1,T=0;T<e;++T){if(void 0!==(N=x(s[T],w)))return N}if(0!==E)for(T=0;T<l;++T){if(void 0!==(N=x(d[T],w)))return N}if(1!==E)for(T=0;T<i;++T){var N;if(void 0!==(N=x(o[T],w)))return N}0===E?k(d,t,l++,w):1===E?k(o,c,i++,w):2===E&&k(s,J,e++,w)}else{w=(b>>1)-1;0===E?U(d,t,l--,w):1===E?U(o,c,i--,w):2===E&&U(s,J,e--,w)}}},scanBipartite:function(Z,x,F,u,G,j,o,c,s,J,M,m){var C=0,L=2*Z,H=x,S=x+Z,K=1,y=1;u?y=Y:K=Y;for(var q=G;q<j;++q){var R=q+K,B=L*q;p[C++]=o[B+H],p[C++]=-R,p[C++]=o[B+S],p[C++]=R}for(q=s;q<J;++q){R=q+y;var v=L*q;p[C++]=M[v+H],p[C++]=-R}var l=C>>>1;f(p,l);var i=0;for(q=0;q<l;++q){var e=0|p[2*q+1];if(e<0){var b=!1;if((R=-e)>=Y?(b=!u,R-=Y):(b=!!u,R-=1),b)k(d,t,i++,R);else{var E=m[R],w=L*R,T=M[w+x+1],N=M[w+x+1+Z];Z:for(var W=0;W<i;++W){var A=d[W],h=L*A;if(!(N<o[h+x+1]||o[h+x+1+Z]<T)){for(var X=x+2;X<Z;++X)if(M[w+X+Z]<o[h+X]||o[h+X+Z]<M[w+X])continue Z;var D,Q=c[A];if(void 0!==(D=u?F(E,Q):F(Q,E)))return D}}}}else U(d,t,i--,e-K)}},scanComplete:function(Z,x,F,u,G,j,t,o,c,s,J){for(var U=0,k=2*Z,M=x,m=x+Z,C=u;C<G;++C){var L=C+Y,H=k*C;p[U++]=j[H+M],p[U++]=-L,p[U++]=j[H+m],p[U++]=L}for(C=o;C<c;++C){L=C+1;var S=k*C;p[U++]=s[S+M],p[U++]=-L}var K=U>>>1;f(p,K);var y=0;for(C=0;C<K;++C){var q=0|p[2*C+1];if(q<0){if((L=-q)>=Y)d[y++]=L-Y;else{var R=J[L-=1],B=k*L,v=s[B+x+1],l=s[B+x+1+Z];Z:for(var i=0;i<y;++i){var e=d[i],b=t[e];if(b===R)break;var E=k*e;if(!(l<j[E+x+1]||j[E+x+1+Z]<v)){for(var w=x+2;w<Z;++w)if(s[B+w+Z]<j[E+w]||j[E+w+Z]<s[B+w])continue Z;var T=F(b,R);if(void 0!==T)return T}}}}else{for(L=q-Y,i=y-1;i>=0;--i)if(d[i]===L){for(w=i+1;w<y;++w)d[w-1]=d[w];break}--y}}}};var u=F(13233),G=F(13237),f=F(13258),Y=1<<28,j=1024,d=u.mallocInt32(j),t=u.mallocInt32(j),o=u.mallocInt32(j),c=u.mallocInt32(j),s=u.mallocInt32(j),J=u.mallocInt32(j),p=u.mallocDouble(8192);function U(Z,x,F,u){var G=x[u],f=Z[F-1];Z[G]=f,x[f]=G}function k(Z,x,F,u){Z[F]=u,x[u]=F}},13241:Z=>{"use strict";function x(Z,F,u){var G=0|Z[u];if(G<=0)return[];var f,Y=new Array(G);if(u===Z.length-1)for(f=0;f<G;++f)Y[f]=F;else for(f=0;f<G;++f)Y[f]=x(Z,F,u+1);return Y}Z.exports=function(Z,F){switch("undefined"===typeof F&&(F=0),typeof Z){case"number":if(Z>0)return function(Z,x){var F,u;for(F=new Array(Z),u=0;u<Z;++u)F[u]=x;return F}(0|Z,F);break;case"object":if("number"===typeof Z.length)return x(Z,F,0)}return[]}},13209:(Z,x,F)=>{Z.exports=function(){var Z=this;this.components={},this.comps=this.components;var x=this.components,F=1,G={},f=[],Y=[],j={timeout:!1,removals:[],multiComps:[]};function d(Z,F){var u=x[F],f=G[F],Y=f.hash[Z];Y&&(f.remove(Z),u.nx&&(u.multi?(Y.forEach((x=>{x&&u.nx(Z,x)})),Y.length=0):u.nx(Z,Y)),j.removals.push(f),t())}function t(){j.timeout||(j.timeout=!0,setTimeout(o,1))}function o(){j.timeout=!1,c()}function c(){j.multiComps.length&&function(Z){for(var x=0;x<Z.length;x++){var{entID:F,data:u}=Z[x],G=u.hash[F];if(G){for(var f=0;f<G.length;f++)G[f]||(G.splice(f,1),f--);0===G.length&&(u.remove(F),j.removals.push(u))}}Z.length=0}(j.multiComps),j.removals.length&&function(Z){for(var x=0;x<Z.length;x++){Z[x].flush()}Z.length=0}(j.removals)}this.ds=G,this._systems=f,this._renderSystems=Y,this.jo=function(x){var u=F++;return Array.isArray(x)&&x.forEach((x=>Z.Wd(u,x))),u},this.deleteEntity=function(x){return Object.keys(G).forEach((Z=>{G[Z].hash[x]&&d(x,Z)})),Z},this.Ko=function(Z){if(!Z)throw new Error("Missing component definition");var F=Z.name;if(!F)throw new Error("Component definition must have a name property.");if("string"!==typeof F)throw new Error("Component name must be a string.");if(""===F)throw new Error("Component name must be a non-empty string.");if(G[F])throw new Error(`Component ${F} already exists.`);var j={};return j.name=F,j.multi=!!Z.multi,j.order=isNaN(Z.order)?99:Z.order,j.stateConstructor=Z.stateConstructor||null,j.state=Z.state||{},j.Rj=Z.Rj||null,j.nx=Z.nx||null,j.system=Z.system||null,j.bj=Z.bj||null,x[F]=j,G[F]=new u,G[F]._pendingMultiCleanup=!1,G[F]._multiCleanupIDs=j.multi?[]:null,j.system&&(f.push(F),f.sort(((Z,F)=>x[Z].order-x[F].order))),j.bj&&(Y.push(F),Y.sort(((Z,F)=>x[Z].order-x[F].order))),F},this.overwriteComponent=function(Z,F){var u=x[Z];if(!u)throw new Error(`Unknown component: ${Z}`);if(!F)throw new Error("Missing component definition");if(u.name!==F.name)throw new Error("Overwriting component must use the same name property.");var j={};j.name=Z,j.multi=!!F.multi,j.order=isNaN(F.order)?99:F.order,j.state=F.state||{},j.Rj=F.Rj||null,j.nx=F.nx||null,j.system=F.system||null,j.bj=F.bj||null,x[Z]=j,G[Z]._pendingMultiCleanup=!1,G[Z]._multiCleanupIDs=j.multi?[]:null;var d=f.indexOf(Z);j.system&&d<0&&f.push(Z),!j.system&&d>=0&&f.splice(d,1),f.sort(((Z,F)=>x[Z].order-x[F].order));var t=Y.indexOf(Z);j.bj&&t<0&&Y.push(Z),!j.bj&&t>=0&&Y.splice(t,1),Y.sort(((Z,F)=>x[Z].order-x[F].order));var o=j.state;return this.Xt(Z).forEach((Z=>{for(var x in o)x in Z||(Z[x]=o[x]);j.Rj&&j.Rj(Z.ij,Z)})),Z},this.deleteComponent=function(F){var u=G[F];if(!u)throw new Error(`Unknown component: ${F}`);u.flush(),u.list.forEach((Z=>{Z&&d(Z.ij||Z[0].ij,F)}));var j=f.indexOf(F),t=Y.indexOf(F);return j>-1&&f.splice(j,1),t>-1&&Y.splice(t,1),G[F].dispose(),delete G[F],delete x[F],Z},this.Wd=function(Z,F,u){var f,Y=x[F],j=G[F];if(!j)throw new Error(`Unknown component: ${F}.`);if(j.hash[Z]&&!Y.multi)throw new Error(`Entity ${Z} already has component: ${F}.`);if(Y.stateConstructor){if(!(f=new Y.stateConstructor).hasOwnProperty("ij"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else f=Object.assign({},{ij:Z},Y.state,u);if(f.ij=Z,Y.multi){var d=j.hash[Z];d||(d=[],j.add(Z,d)),d.push(f)}else j.add(Z,f);return Y.Rj&&Y.Rj(Z,f),this},this.Pd=function(Z,x){var F=G[x];if(!F)throw new Error(`Unknown component: ${x}.`);return!!F.hash[Z]},this.gd=function(x,F){if(!G[F])throw new Error(`Unknown component: ${F}.`);return d(x,F),Z},this.getState=function(Z,x){var F=G[x];if(!F)throw new Error(`Unknown component: ${x}.`);return F.hash[Z]},this.Xt=function(Z){var x=G[Z];if(!x)throw new Error(`Unknown component: ${Z}.`);return c(),x.list},this.PJ=function(Z){if(!G[Z])throw new Error(`Unknown component: ${Z}.`);var x=G[Z].hash;return Z=>x[Z]},this.Fp=function(Z){if(!G[Z])throw new Error(`Unknown component: ${Z}.`);var x=G[Z].hash;return Z=>!!x[Z]},this.oj=function(F){c();for(var u=0;u<f.length;u++){var Y=f[u],j=x[Y],d=G[Y];j.system(F,d.list),c()}return Z},this.render=function(F){c();for(var u=0;u<Y.length;u++){var f=Y[u],j=x[f],d=G[f];j.bj(F,d.list),c()}return Z},this.removeMultiComponent=function(F,u,f){var Y=x[u],d=G[u];if(!d)throw new Error(`Unknown component: ${u}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(Z,x,F,u){var G=F.hash[Z];if(G){var f=G[u];f&&(G[u]=null,x.nx&&x.nx(Z,f),j.multiComps.push({entID:Z,data:F}),t())}}(F,Y,d,f),Z}};var u=F(13214)},13214:Z=>{function x(Z,x){var F=Z._map[x];if(delete Z.hash[x],delete Z._map[x],F===Z.list.length-1)Z.list.pop();else{var u=Z.list.pop();if(Z.list[F]=u,null===u||null===u[0]){var G=Z.list.length;for(var f in Z._map)if(Z._map[f]===G)return void(Z._map[f]=F)}else{var Y=u.ij||u[0].ij;Z._map[Y]=F}}}Z.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(Z,x){if("number"===typeof this._map[Z]){var F=this._map[Z];this.hash[Z]=x,this.list[F]=x}else this._map[Z]=this.list.length,this.hash[Z]=x,this.list.push(x)}remove(Z){var x=this._map[Z];this.hash[Z]=null,this.list[x]=null,this._pendingRemovals.push(Z)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var Z=0;Z<this._pendingRemovals.length;Z++){var F=this._pendingRemovals[Z];null===this.hash[F]&&x(this,F)}this._pendingRemovals.length=0}}},13167:Z=>{"use strict";var x,F="object"===typeof Reflect?Reflect:null,u=function(Z,x,F){return Function.prototype.apply.call(Z,x,F)};x=F&&"function"===typeof F.ownKeys?F.ownKeys:Object.getOwnPropertySymbols?function(Z){return Object.getOwnPropertyNames(Z).concat(Object.getOwnPropertySymbols(Z))}:function(Z){return Object.getOwnPropertyNames(Z)};var G=Number.isNaN||function(Z){return Z!==Z};function f(){f.init.call(this)}Z.exports=f,Z.exports.once=function(Z,x){return new Promise((function(F,u){function G(F){Z.removeListener(x,f),u(F)}function f(){"function"===typeof Z.removeListener&&Z.removeListener("error",G),F([].slice.call(arguments))}U(Z,x,f,{once:!0}),"error"!==x&&function(Z,x,F){"function"===typeof Z.on&&U(Z,"error",x,F)}(Z,G,{once:!0})}))},f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var Y=10;function j(Z){if("function"!==typeof Z)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Z)}function d(Z){return void 0===Z._maxListeners?f.defaultMaxListeners:Z._maxListeners}function t(Z,x,F,u){var G,f,Y,t;if(j(F),void 0===(f=Z._events)?(f=Z._events=Object.create(null),Z._eventsCount=0):(void 0!==f.newListener&&(Z.emit("newListener",x,F.listener?F.listener:F),f=Z._events),Y=f[x]),void 0===Y)Y=f[x]=F,++Z._eventsCount;else if("function"===typeof Y?Y=f[x]=u?[F,Y]:[Y,F]:u?Y.unshift(F):Y.push(F),(G=d(Z))>0&&Y.length>G&&!Y.warned){Y.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.i=Z,o.type=x,o.count=Y.length,t=o,console&&console.warn&&console.warn(t)}return Z}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(Z,x,F){var u={fired:!1,wrapFn:void 0,target:Z,type:x,listener:F},G=o.bind(u);return G.listener=F,u.wrapFn=G,G}function s(Z,x,F){var u=Z._events;if(void 0===u)return[];var G=u[x];return void 0===G?[]:"function"===typeof G?F?[G.listener||G]:[G]:F?function(Z){for(var x=new Array(Z.length),F=0;F<x.length;++F)x[F]=Z[F].listener||Z[F];return x}(G):p(G,G.length)}function J(Z){var x=this._events;if(void 0!==x){var F=x[Z];if("function"===typeof F)return 1;if(void 0!==F)return F.length}return 0}function p(Z,x){for(var F=new Array(x),u=0;u<x;++u)F[u]=Z[u];return F}function U(Z,x,F,u){if("function"===typeof Z.on)u.once?Z.once(x,F):Z.on(x,F);else{if("function"!==typeof Z.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Z);Z.addEventListener(x,(function G(f){u.once&&Z.removeEventListener(x,G),F(f)}))}}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(Z){if("number"!==typeof Z||Z<0||G(Z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Z+".");Y=Z}}),f.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(Z){if("number"!==typeof Z||Z<0||G(Z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Z+".");return this._maxListeners=Z,this},f.prototype.getMaxListeners=function(){return d(this)},f.prototype.emit=function(Z){for(var x=[],F=1;F<arguments.length;F++)x.push(arguments[F]);var G="error"===Z,f=this._events;if(void 0!==f)G=G&&void 0===f.error;else if(!G)return!1;if(G){var Y;if(x.length>0&&(Y=x[0]),Y instanceof Error)throw Y;var j=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw j.context=Y,j}var d=f[Z];if(void 0===d)return!1;if("function"===typeof d)u(d,this,x);else{var t=d.length,o=p(d,t);for(F=0;F<t;++F)u(o[F],this,x)}return!0},f.prototype.addListener=function(Z,x){return t(this,Z,x,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(Z,x){return t(this,Z,x,!0)},f.prototype.once=function(Z,x){return j(x),this.on(Z,c(this,Z,x)),this},f.prototype.prependOnceListener=function(Z,x){return j(x),this.prependListener(Z,c(this,Z,x)),this},f.prototype.removeListener=function(Z,x){var F,u,G,f,Y;if(j(x),void 0===(u=this._events))return this;if(void 0===(F=u[Z]))return this;if(F===x||F.listener===x)0===--this._eventsCount?this._events=Object.create(null):(delete u[Z],u.removeListener&&this.emit("removeListener",Z,F.listener||x));else if("function"!==typeof F){for(G=-1,f=F.length-1;f>=0;f--)if(F[f]===x||F[f].listener===x){Y=F[f].listener,G=f;break}if(G<0)return this;0===G?F.shift():function(Z,x){for(;x+1<Z.length;x++)Z[x]=Z[x+1];Z.pop()}(F,G),1===F.length&&(u[Z]=F[0]),void 0!==u.removeListener&&this.emit("removeListener",Z,Y||x)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(Z){var x,F,u;if(void 0===(F=this._events))return this;if(void 0===F.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==F[Z]&&(0===--this._eventsCount?this._events=Object.create(null):delete F[Z]),this;if(0===arguments.length){var G,f=Object.keys(F);for(u=0;u<f.length;++u)"removeListener"!==(G=f[u])&&this.removeAllListeners(G);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(x=F[Z]))this.removeListener(Z,x);else if(void 0!==x)for(u=x.length-1;u>=0;u--)this.removeListener(Z,x[u]);return this},f.prototype.listeners=function(Z){return s(this,Z,!0)},f.prototype.rawListeners=function(Z){return s(this,Z,!1)},f.listenerCount=function(Z,x){return"function"===typeof Z.listenerCount?Z.listenerCount(x):J.call(Z,x)},f.prototype.listenerCount=J,f.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]}},13452:Z=>{"use strict";Z.exports=function(Z,x,F,u,G,f){var Y=+x[0],j=+x[1],d=+x[2],t=+F[0],o=+F[1],c=+F[2],s=Math.sqrt(t*t+o*o+c*c);if(0===s)throw new Error("Can't raycast along a zero vector");return function(Z,x,F,u,G,f,Y,j,d,t){for(var o=0,c=Math.floor,s=0|c(x),J=0|c(F),p=0|c(u),U=G>0?1:-1,k=f>0?1:-1,M=Y>0?1:-1,m=Math.abs(1/G),C=Math.abs(1/f),L=Math.abs(1/Y),H=m<1/0?m*(U>0?s+1-x:x-s):1/0,S=C<1/0?C*(k>0?J+1-F:F-J):1/0,K=L<1/0?L*(M>0?p+1-u:u-p):1/0,y=-1;o<=j;){var q=Z(s,J,p);if(q)return d&&(d[0]=x+o*G,d[1]=F+o*f,d[2]=u+o*Y),t&&(t[0]=t[1]=t[2]=0,0===y&&(t[0]=-U),1===y&&(t[1]=-k),2===y&&(t[2]=-M)),q;H<S?H<K?(s+=U,o=H,H+=m,y=0):(p+=M,o=K,K+=L,y=2):S<K?(J+=k,o=S,S+=C,y=1):(p+=M,o=K,K+=L,y=2)}return d&&(d[0]=x+o*G,d[1]=F+o*f,d[2]=u+o*Y),t&&(t[0]=t[1]=t[2]=0),0}(Z,Y,j,d,t/=s,o/=s,c/=s,u="undefined"===typeof u?64:+u,G,f)}},13486:(Z,x,F)=>{"use strict";F.d(x,{d:()=>f});var u=F(13167);function G(){this.ZJ=!1,this.stopPropagation=!1,this.xJ=!1,this.disabled=!1}class f{constructor(Z,x){this.version="0.7.0";var F=Object.assign({},new G,x||{});this.element=Z||document,this.ZJ=!!F.ZJ,this.stopPropagation=!!F.stopPropagation,this.xJ=!!F.xJ,this.disabled=!!F.disabled,this.filterEvents=(Z,x)=>!0,this.down=new u.EventEmitter,this.up=new u.EventEmitter,this.state={},this.wt={dx:0,dy:0,QJ:0,Et:0,gJ:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?j(this):document.addEventListener("DOMContentLoaded",(Z=>{j(this)}),{once:!0})}bind(Z){for(var x=arguments.length,F=new Array(x>1?x-1:0),u=1;u<x;u++)F[u-1]=arguments[u];F.forEach((x=>{var F=this._keyBindmap[x]||[];F.includes(Z)||(F.push(Z),this._keyBindmap[x]=F)})),this.state[Z]=!!this.state[Z],this.pressCount[Z]=this.pressCount[Z]||0,this.releaseCount[Z]=this.releaseCount[Z]||0}unbind(Z){for(var x in this._keyBindmap){var F=this._keyBindmap[x],u=F.indexOf(Z);u>-1&&F.splice(u,1)}}getBindings(){var Z={};for(var x in this._keyBindmap){this._keyBindmap[x].forEach((F=>{Z[F]=Z[F]||[],Z[F].push(x)}))}return Z}oj(){Y(this.wt),Y(this.pressCount),Y(this.releaseCount)}}function Y(Z){for(var x in Z)Z[x]=0}function j(Z){window.addEventListener("keydown",p.bind(null,Z,!0),!1),window.addEventListener("keyup",p.bind(null,Z,!1),!1);var x={passive:!0};Z.element.addEventListener("touchstart",c.bind(void 0,Z),{passive:!1}),Z.element.addEventListener("touchend",J.bind(void 0,Z),x),Z.element.addEventListener("mousedown",U.bind(null,Z,!0),x),window.document.addEventListener("mouseup",U.bind(null,Z,!1),x),Z.element.addEventListener("touchmove",k.bind(null,Z),x),Z.element.addEventListener("mousemove",k.bind(null,Z),x),window.PointerEvent,Z.element.addEventListener("wheel",M.bind(null,Z),x),Z.element.addEventListener("contextmenu",m.bind(null,Z),!1),window.addEventListener("blur",C.bind(null,Z),!1)}var d=0,t=0,o=null;function c(Z,x){x.preventDefault(),s(x)}function s(Z){let x=!1;for(let F=0;F<Z.touches.length;++F)if(Z.touches[F].identifier===o){x=!0;break}if(!x){const x=Z.changedTouches[0];d=x.clientX,t=x.clientY,o=x.identifier}}function J(Z,x){for(var F=x.changedTouches,u=0;u<F.length;++u)F[u].identifier===o&&(o=null)}function p(Z,x,F){L(F.code,x,Z,F)}function U(Z,x,F){if("pointerId"in F)if(x){if(null!==Z._touches.currID)return;Z._touches.currID=F.pointerId}else{if(Z._touches.currID!==F.pointerId)return;Z._touches.currID=null}return L("Mouse"+("button"in F?F.button+1:1),x,Z,F),!1}function k(Z,x){var F=x.movementX||x.mozMovementX||0,u=x.movementY||x.mozMovementY||0;if(x.touches&&0===(F|u)){var G=function(Z){s(Z);for(let x=0;x<Z.changedTouches.length;++x)if(Z.changedTouches[x].identifier==o){const F=Z.changedTouches[x],u=[F.clientX-d,F.clientY-t];return d=F.clientX,t=F.clientY,u}return console.error(`Did not find touch id ${o}`),[0,0]}(x);F=G[0],u=G[1]}Z.wt.dx+=F,Z.wt.dy+=u}function M(Z,x){var F=1;switch(x.deltaMode){case 0:F=1;break;case 1:F=12;break;case 2:F=Z.element.clientHeight||window.innerHeight}Z.wt.QJ+=(x.deltaX||0)*F,Z.wt.Et+=(x.deltaY||0)*F,Z.wt.gJ+=(x.deltaZ||0)*F}function m(Z,x){if(!Z.xJ)return x.preventDefault(),!1}function C(Z){for(var x in Z._keyStates)Z._keyStates[x]&&(/^Mouse\d/.test(x)||L(x,!1,Z,{code:x,note:"5pp903fi30m",preventDefault:()=>{},stopPropagation:()=>{}}))}function L(Z,x,F,u){var G=F._keyBindmap[Z];G&&(H(F._keyStates[Z],x)&&(F._keyStates[Z]=x,G.forEach((Z=>{(!F.filterEvents||F.filterEvents(u,Z))&&function(Z,x,F,u){var G=x?F.pressCount:F.releaseCount;G[Z]=(G[Z]||0)+1;var f=F._bindPressCount[Z]||0;(f+=x?1:-1)<0&&(f=0);F._bindPressCount[Z]=f;var Y=F.state[Z];if(H(Y,f)){F.state[Z]=f>0;var j=x?F.down:F.up;F.disabled||j.emit(Z,u)}}(Z,x,F,u)}))),"button"in u||(F.ZJ&&!u.defaultPrevented&&u.preventDefault(),F.stopPropagation&&u.stopPropagation()))}function H(Z,x){return Z?!x:x}},12107:Z=>{Z.exports=function(Z,x,F){return Z[0]=x[0]+F[0],Z[1]=x[1]+F[1],Z[2]=x[2]+F[2],Z}},12061:(Z,x,F)=>{Z.exports=function(Z,x){var F=u(Z[0],Z[1],Z[2]),Y=u(x[0],x[1],x[2]);G(F,F),G(Y,Y);var j=f(F,Y);return j>1?0:Math.acos(j)};var u=F(12066),G=F(12069),f=F(12078)},12153:Z=>{Z.exports=function(Z,x){return Z[0]=Math.ceil(x[0]),Z[1]=Math.ceil(x[1]),Z[2]=Math.ceil(x[2]),Z}},12052:Z=>{Z.exports=function(Z){var x=new Float32Array(3);return x[0]=Z[0],x[1]=Z[1],x[2]=Z[2],x}},12084:Z=>{Z.exports=function(Z,x){return Z[0]=x[0],Z[1]=x[1],Z[2]=x[2],Z}},12045:Z=>{Z.exports=function(){var Z=new Float32Array(3);return Z[0]=0,Z[1]=0,Z[2]=0,Z}},12243:Z=>{Z.exports=function(Z,x,F){var u=x[0],G=x[1],f=x[2],Y=F[0],j=F[1],d=F[2];return Z[0]=G*d-f*j,Z[1]=f*Y-u*d,Z[2]=u*j-G*Y,Z}},12188:(Z,x,F)=>{Z.exports=F(12179)},12179:Z=>{Z.exports=function(Z,x){var F=x[0]-Z[0],u=x[1]-Z[1],G=x[2]-Z[2];return Math.sqrt(F*F+u*u+G*G)}},12139:(Z,x,F)=>{Z.exports=F(12136)},12136:Z=>{Z.exports=function(Z,x,F){return Z[0]=x[0]/F[0],Z[1]=x[1]/F[1],Z[2]=x[2]/F[2],Z}},12078:Z=>{Z.exports=function(Z,x){return Z[0]*x[0]+Z[1]*x[1]+Z[2]*x[2]}},12043:Z=>{Z.exports=1e-6},12097:(Z,x,F)=>{Z.exports=function(Z,x){var F=Z[0],G=Z[1],f=Z[2],Y=x[0],j=x[1],d=x[2];return Math.abs(F-Y)<=u*Math.max(1,Math.abs(F),Math.abs(Y))&&Math.abs(G-j)<=u*Math.max(1,Math.abs(G),Math.abs(j))&&Math.abs(f-d)<=u*Math.max(1,Math.abs(f),Math.abs(d))};var u=F(12043)},12100:Z=>{Z.exports=function(Z,x){return Z[0]===x[0]&&Z[1]===x[1]&&Z[2]===x[2]}},12150:Z=>{Z.exports=function(Z,x){return Z[0]=Math.floor(x[0]),Z[1]=Math.floor(x[1]),Z[2]=Math.floor(x[2]),Z}},12290:(Z,x,F)=>{Z.exports=function(Z,x,F,G,f,Y){var j,d;x||(x=3);F||(F=0);d=G?Math.min(G*x+F,Z.length):Z.length;for(j=F;j<d;j+=x)u[0]=Z[j],u[1]=Z[j+1],u[2]=Z[j+2],f(u,u,Y),Z[j]=u[0],Z[j+1]=u[1],Z[j+2]=u[2];return Z};var u=F(12045)()},12066:Z=>{Z.exports=function(Z,x,F){var u=new Float32Array(3);return u[0]=Z,u[1]=x,u[2]=F,u}},12039:(Z,x,F)=>{Z.exports={EPSILON:F(12043),create:F(12045),clone:F(12052),angle:F(12061),Fj:F(12066),k:F(12084),set:F(12090),equals:F(12097),exactEquals:F(12100),add:F(12107),Mx:F(12113),sub:F(12121),multiply:F(12126),mul:F(12130),divide:F(12136),div:F(12139),min:F(12144),max:F(12147),floor:F(12150),ceil:F(12153),round:F(12160),scale:F(12169),uj:F(12171),distance:F(12179),j:F(12188),squaredDistance:F(12197),sqrDist:F(12206),length:F(12212),len:F(12218),squaredLength:F(12220),Gj:F(12227),negate:F(12234),inverse:F(12241),normalize:F(12069),dot:F(12078),cross:F(12243),PY:F(12247),random:F(12250),transformMat4:F(12254),transformMat3:F(12262),transformQuat:F(12269),fj:F(12271),Yj:F(12273),jj:F(12282),forEach:F(12290)}},12241:Z=>{Z.exports=function(Z,x){return Z[0]=1/x[0],Z[1]=1/x[1],Z[2]=1/x[2],Z}},12218:(Z,x,F)=>{Z.exports=F(12212)},12212:Z=>{Z.exports=function(Z){var x=Z[0],F=Z[1],u=Z[2];return Math.sqrt(x*x+F*F+u*u)}},12247:Z=>{Z.exports=function(Z,x,F,u){var G=x[0],f=x[1],Y=x[2];return Z[0]=G+u*(F[0]-G),Z[1]=f+u*(F[1]-f),Z[2]=Y+u*(F[2]-Y),Z}},12147:Z=>{Z.exports=function(Z,x,F){return Z[0]=Math.max(x[0],F[0]),Z[1]=Math.max(x[1],F[1]),Z[2]=Math.max(x[2],F[2]),Z}},12144:Z=>{Z.exports=function(Z,x,F){return Z[0]=Math.min(x[0],F[0]),Z[1]=Math.min(x[1],F[1]),Z[2]=Math.min(x[2],F[2]),Z}},12130:(Z,x,F)=>{Z.exports=F(12126)},12126:Z=>{Z.exports=function(Z,x,F){return Z[0]=x[0]*F[0],Z[1]=x[1]*F[1],Z[2]=x[2]*F[2],Z}},12234:Z=>{Z.exports=function(Z,x){return Z[0]=-x[0],Z[1]=-x[1],Z[2]=-x[2],Z}},12069:Z=>{Z.exports=function(Z,x){var F=x[0],u=x[1],G=x[2],f=F*F+u*u+G*G;f>0&&(f=1/Math.sqrt(f),Z[0]=x[0]*f,Z[1]=x[1]*f,Z[2]=x[2]*f);return Z}},12250:Z=>{Z.exports=function(Z,x){x=x||1;var F=2*Math.random()*Math.PI,u=2*Math.random()-1,G=Math.sqrt(1-u*u)*x;return Z[0]=Math.cos(F)*G,Z[1]=Math.sin(F)*G,Z[2]=u*x,Z}},12271:Z=>{Z.exports=function(Z,x,F,u){var G=F[1],f=F[2],Y=x[1]-G,j=x[2]-f,d=Math.sin(u),t=Math.cos(u);return Z[0]=x[0],Z[1]=G+Y*t-j*d,Z[2]=f+Y*d+j*t,Z}},12273:Z=>{Z.exports=function(Z,x,F,u){var G=F[0],f=F[2],Y=x[0]-G,j=x[2]-f,d=Math.sin(u),t=Math.cos(u);return Z[0]=G+j*d+Y*t,Z[1]=x[1],Z[2]=f+j*t-Y*d,Z}},12282:Z=>{Z.exports=function(Z,x,F,u){var G=F[0],f=F[1],Y=x[0]-G,j=x[1]-f,d=Math.sin(u),t=Math.cos(u);return Z[0]=G+Y*t-j*d,Z[1]=f+Y*d+j*t,Z[2]=x[2],Z}},12160:Z=>{Z.exports=function(Z,x){return Z[0]=Math.round(x[0]),Z[1]=Math.round(x[1]),Z[2]=Math.round(x[2]),Z}},12169:Z=>{Z.exports=function(Z,x,F){return Z[0]=x[0]*F,Z[1]=x[1]*F,Z[2]=x[2]*F,Z}},12171:Z=>{Z.exports=function(Z,x,F,u){return Z[0]=x[0]+F[0]*u,Z[1]=x[1]+F[1]*u,Z[2]=x[2]+F[2]*u,Z}},12090:Z=>{Z.exports=function(Z,x,F,u){return Z[0]=x,Z[1]=F,Z[2]=u,Z}},12206:(Z,x,F)=>{Z.exports=F(12197)},12227:(Z,x,F)=>{Z.exports=F(12220)},12197:Z=>{Z.exports=function(Z,x){var F=x[0]-Z[0],u=x[1]-Z[1],G=x[2]-Z[2];return F*F+u*u+G*G}},12220:Z=>{Z.exports=function(Z){var x=Z[0],F=Z[1],u=Z[2];return x*x+F*F+u*u}},12121:(Z,x,F)=>{Z.exports=F(12113)},12113:Z=>{Z.exports=function(Z,x,F){return Z[0]=x[0]-F[0],Z[1]=x[1]-F[1],Z[2]=x[2]-F[2],Z}},12262:Z=>{Z.exports=function(Z,x,F){var u=x[0],G=x[1],f=x[2];return Z[0]=u*F[0]+G*F[3]+f*F[6],Z[1]=u*F[1]+G*F[4]+f*F[7],Z[2]=u*F[2]+G*F[5]+f*F[8],Z}},12254:Z=>{Z.exports=function(Z,x,F){var u=x[0],G=x[1],f=x[2],Y=F[3]*u+F[7]*G+F[11]*f+F[15];return Y=Y||1,Z[0]=(F[0]*u+F[4]*G+F[8]*f+F[12])/Y,Z[1]=(F[1]*u+F[5]*G+F[9]*f+F[13])/Y,Z[2]=(F[2]*u+F[6]*G+F[10]*f+F[14])/Y,Z}},12269:Z=>{Z.exports=function(Z,x,F){var u=x[0],G=x[1],f=x[2],Y=F[0],j=F[1],d=F[2],t=F[3],o=t*u+j*f-d*G,c=t*G+d*u-Y*f,s=t*f+Y*G-j*u,J=-Y*u-j*G-d*f;return Z[0]=o*t+J*-Y+c*-d-s*-j,Z[1]=c*t+J*-j+s*-Y-o*-d,Z[2]=s*t+J*-d+o*-j-c*-Y,Z}},13195:Z=>{"use strict";Z.exports=function(Z){for(var x=new Array(Z),F=0;F<Z;++F)x[F]=F;return x}},13243:Z=>{Z.exports=function(Z){return null!=Z&&null!=Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}},13455:(Z,x,F)=>{"use strict";F.d(x,{b:()=>u});class u{constructor(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.no=!1,this.Vo=!1,this.Qo=30,this.Oo=0,this.mc=!1,this.fullscreen=!1,this.Io=function(Z){},this.ro=function(){},this.dc=function(){},this.xf=function(){},this.zo=function(Z){},this.onFullscreenChanged=function(Z){},t((()=>{!function(Z,x){Z._nowObject=performance||Date,Z._lastTick=0,Z._renderAccum=0,Z._rt=0,Z._frameCB=j.bind(null,Z),requestAnimationFrame(Z._frameCB),x>0&&(Z._intervalCB=Y.bind(null,Z),Z._interval=setInterval(Z._intervalCB,Math.max(x,1e3/Z.Qo/2)))}(this,x),function(Z,x){if(!x)return;var F=!1,u=!1;document.addEventListener("pointerlockchange",(u=>{F=document.pointerLockElement===x,Z.zo(F)})),document.addEventListener("fullscreenchange",(F=>{u=document.fullscreenElement===x,Z.onFullscreenChanged(u)})),Object.defineProperty(Z,"mc",{get:()=>F,set:Z=>{Z&&!F?d(x):F&&!Z&&function(Z){Z.exitPointerLock&&Z.exitPointerLock()}(document)}}),Object.defineProperty(Z,"fullscreen",{get:()=>u,set:Z=>{Z&&!u?x.requestFullscreen():u&&!Z&&document.exitFullscreen()}}),x.addEventListener("click",(G=>{Z.no&&!F&&d(x),Z.Vo&&!u&&x.requestFullscreen()}));var G=()=>Z.xf();if(window.ResizeObserver){new ResizeObserver(G).observe(x)}else window.addEventListener("resize",G)}(this,Z),this.dc()}))}}var G=3,f=20;function Y(Z){for(var x=1e3/Z.Qo,F=Z._nowObject.now()+f,u=0;Z._nowObject.now()>=Z._lastTick+x&&Z._nowObject.now()<F&&++u<=G;)Z.Io(x),Z._lastTick+=x;var Y=5*(x+5),j=Z._nowObject.now();if(j-Z._lastTick>Y)for(;j>=Z._lastTick+x;)Z._lastTick+=x}function j(Z){requestAnimationFrame(Z._frameCB),Y(Z);var x=Z._nowObject.now(),F=x-Z._rt;if(Z._rt=x,Z.Oo>0){Z._renderAccum+=F;var u=1e3/Z.Oo;if(Z._renderAccum<u)return;Z._renderAccum=Math.min(Z._renderAccum-u,u)}var G=1e3/Z.Qo,f=(x-Z._lastTick)/G;Z.ro(F,f,G)}function d(Z){Z.requestPointerLock&&Z.requestPointerLock()}var t=Z=>{if("loading"===document.readyState){var x=()=>{document.removeEventListener("readystatechange",x),Z()};document.addEventListener("readystatechange",x)}else setTimeout(Z,1)}},13186:(Z,x,F)=>{var u=F(13195),G=F(13203),f="undefined"!==typeof Float64Array;function Y(Z,x){return Z[0]-x[0]}function j(){var Z,x=this.stride,F=new Array(x.length);for(Z=0;Z<F.length;++Z)F[Z]=[Math.abs(x[Z]),Z];F.sort(Y);var u=new Array(F.length);for(Z=0;Z<u.length;++Z)u[Z]=F[Z][1];return u}function d(Z,x){var F=["View",x,"d",Z].join("");x<0&&(F="View_Nil"+Z);var G="generic"===Z;if(-1===x){var f="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(f)()}if(0===x){f="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(G?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(G?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",f)(t[Z][0])}f=["'use strict'"];var Y=u(x),d=Y.map((function(Z){return"i"+Z})),o="this.offset+"+Y.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),c=Y.map((function(Z){return"b"+Z})).join(","),s=Y.map((function(Z){return"c"+Z})).join(",");f.push("function "+F+"(a,"+c+","+s+",d){this.data=a","this.shape=["+c+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+Z+"'","proto.dimension="+x),f.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+Y.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===x?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),x<4?(f.push("function "+F+"_order(){"),2===x?f.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&f.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+F+"_set("+d.join(",")+",v){"),G?f.push("return this.data.set("+o+",v)}"):f.push("return this.data["+o+"]=v}"),f.push("proto.get=function "+F+"_get("+d.join(",")+"){"),G?f.push("return this.data.get("+o+")}"):f.push("return this.data["+o+"]}"),f.push("proto.index=function "+F+"_index(",d.join(),"){return "+o+"}"),f.push("proto.hi=function "+F+"_hi("+d.join(",")+"){return new "+F+"(this.data,"+Y.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+Y.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var J=Y.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),p=Y.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));f.push("proto.lo=function "+F+"_lo("+d.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+p.join(","));for(var U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'&&i"+U+">=0){d=i"+U+"|0;b+=c"+U+"*d;a"+U+"-=d}");f.push("return new "+F+"(this.data,"+Y.map((function(Z){return"a"+Z})).join(",")+","+Y.map((function(Z){return"c"+Z})).join(",")+",b)}"),f.push("proto.step=function "+F+"_step("+d.join(",")+"){var "+Y.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+Y.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'){d=i"+U+"|0;if(d<0){c+=b"+U+"*(a"+U+"-1);a"+U+"=ceil(-a"+U+"/d)}else{a"+U+"=ceil(a"+U+"/d)}b"+U+"*=d}");f.push("return new "+F+"(this.data,"+Y.map((function(Z){return"a"+Z})).join(",")+","+Y.map((function(Z){return"b"+Z})).join(",")+",c)}");var k=new Array(x),M=new Array(x);for(U=0;U<x;++U)k[U]="a[i"+U+"]",M[U]="b[i"+U+"]";f.push("proto.transpose=function "+F+"_transpose("+d+"){"+d.map((function(Z,x){return Z+"=("+Z+"===undefined?"+x+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+k.join(",")+","+M.join(",")+",this.offset)}"),f.push("proto.pick=function "+F+"_pick("+d+"){var a=[],b=[],c=this.offset");for(U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'&&i"+U+">=0){c=(c+this.stride["+U+"]*i"+U+")|0}else{a.push(this.shape["+U+"]);b.push(this.stride["+U+"])}");return f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+Y.map((function(Z){return"shape["+Z+"]"})).join(",")+","+Y.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",f.join("\n"))(t[Z],j)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,x,F,u){if(void 0===Z)return(0,t.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===x&&(x=[Z.length]);var Y=x.length;if(void 0===F){F=new Array(Y);for(var j=Y-1,o=1;j>=0;--j)F[j]=o,o*=x[j]}if(void 0===u){u=0;for(j=0;j<Y;++j)F[j]<0&&(u-=(x[j]-1)*F[j])}for(var c=function(Z){if(G(Z))return"buffer";if(f)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),s=t[c];s.length<=Y+1;)s.push(d(c,s.length-1));return(0,s[Y+1])(Z,x,F,u)}},13203:Z=>{function x(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(x(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&x(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},13329:Z=>{"use strict";var x=[],F=[],u=[],G=[],f=[],Y=[],j=[],d=[],t=[],o=[],c=[],s=[];Z.exports=function(Z,J,p,U,k,M){for(var m=j,C=t,L=o,H=s,S=0;S<3;S++)m[S]=+p[S],L[S]=+J.max[S],C[S]=+J.base[S];M||(M=1e-10);var K=function(Z,j,t,o,s,J){var p=x,U=F,k=u,M=G,m=f,C=Y,L=d,H=Math.floor,S=0,K=0,y=0,q=0,R=0;if(B(),0===y)return 0;for(q=i();K<=y;){if(v(q)&&l())return S;q=i()}for(S+=y,R=0;R<3;R++)o[R]+=t[R],s[R]+=t[R];return S;function B(){if(K=0,0!==(y=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])))for(var Z=0;Z<3;Z++){var x=t[Z]>=0;M[Z]=x?1:-1;var F=x?s[Z]:o[Z];p[Z]=x?o[Z]:s[Z],U[Z]=e(F,M[Z]),k[Z]=b(p[Z],M[Z]),L[Z]=t[Z]/y,m[Z]=Math.abs(1/L[Z]);var u=x?U[Z]+1-F:F-U[Z];C[Z]=m[Z]<1/0?m[Z]*u:1/0}}function v(x){for(var F=M[0],u=0===x?U[0]:k[0],G=U[0]+F,f=M[1],Y=1===x?U[1]:k[1],j=U[1]+f,d=M[2],t=2===x?U[2]:k[2],o=U[2]+d,c=u;c!=G;c+=F)for(var s=Y;s!=j;s+=f)for(var J=t;J!=o;J+=d)if(Z(c,s,J))return!0;return!1}function l(){S+=K;var Z=M[q],x=K/y,F=c;for(R=0;R<3;R++){var u=t[R]*x;o[R]+=u,s[R]+=u,F[R]=t[R]-u}if(Z>0?s[q]=Math.round(s[q]):o[q]=Math.round(o[q]),j(S,q,Z,F))return!0;for(R=0;R<3;R++)t[R]=F[R];return B(),0===y}function i(){var Z=C[0]<C[1]?C[0]<C[2]?0:2:C[1]<C[2]?1:2,x=C[Z]-K;for(K=C[Z],U[Z]+=M[Z],C[Z]+=m[Z],R=0;R<3;R++)p[R]+=x*L[R],k[R]=b(p[R],M[R]);return Z}function e(Z,x){return H(Z-x*J)}function b(Z,x){return H(Z+x*J)}}(Z,U,m,C,L,M);if(!k){for(S=0;S<3;S++)H[S]=p[S]>0?L[S]-J.max[S]:C[S]-J.base[S];J.translate(H)}return K}},13490:(Z,x,F)=>{"use strict";F.d(x,{d:()=>c});var u=F(13322),G=F(12039);class f{constructor(Z,x,F,f,Y,j,d){this.ht=new u(Z.base,Z.Go),this.XG=x,this.friction=F,this.restitution=f,this.OY=Y,this.cp=j,this.nY=!!d,this.uo=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Pp=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ut=G.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=G.create(),this._impulses=G.create(),this._sleepFrameCount=10}loadFromCopy(Z){G.k(this.ht.base,Z.ht.base),G.k(this.ht.Go,Z.ht.Go),G.k(this.ht.max,Z.ht.max),this.ht.mag=Z.ht.mag,this.XG=Z.XG,this.friction=Z.friction,this.restitution=Z.restitution,this.OY=Z.OY,this.cp=Z.cp,this.nY=Z.nY,this.uo=Z.uo,this.fluidDrag=Z.fluidDrag,this.Pp=Z.Pp,this.preventFallOffEdge=Z.preventFallOffEdge,this.rolledBackLastTick=Z.rolledBackLastTick,G.k(this.Ut,Z.Ut),G.k(this.resting,Z.resting),this.inFluid=Z.inFluid,this._ratioInFluid=Z._ratioInFluid,G.k(this._forces,Z._forces),G.k(this._impulses,Z._impulses),this._sleepFrameCount=Z._sleepFrameCount}setPosition(Z){Y(Z),G.Mx(Z,Z,this.ht.base),this.ht.translate(Z),this.Ct()}Gf(){return G.clone(this.ht.base)}applyForce(Z){Y(Z),G.add(this._forces,this._forces,Z),this.Ct()}applyImpulse(Z){Y(Z),G.add(this._impulses,this._impulses,Z),this.Ct()}Ct(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=Z=>{};var j=F(13322),d=F(12039),t=F(13329);function o(){this.uo=.1,this.fluidDrag=.4,this.zY=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function c(Z,x,F){Z=Object.assign(new o,Z),this.gravity=Z.gravity||[0,-10,0],this.uo=Z.uo||.1,this.zY=Z.zY||2,this.fluidDrag=Z.fluidDrag||.4,this.minBounceImpulse=Z.minBounceImpulse,this.bodies=[],this.bJ=Z.bJ,this.testSolid=x,this.testFluid=F}c.prototype.mp=function(Z,x,F,u,G,Y){Z=Z||new j([0,0,0],[1,1,1]),"undefined"==typeof x&&(x=1),"undefined"==typeof F&&(F=1),"undefined"==typeof u&&(u=0),"undefined"==typeof G&&(G=1);var d=new f(Z,x,F,u,G,Y);return this.bodies.push(d),d},c.prototype.Cp=function(Z){var x=this.bodies.indexOf(Z);x<0||(this.bodies.splice(x,1),Z.ht=Z.cp=null)};var s=d.create(),J=d.create(),p=d.create(),U=d.create(),k=d.create(),M=d.create(),m=d.create(),C=new j([0,0,0],[1,1,1]),L=new f(C,1,1,0,1,(()=>{}),!1);function H(Z,x,F){return x=F,x*=1-(1-Z.ratioInFluid)**2}c.prototype.oj=function(Z){Z/=1e3;var x=W(0,d.squaredLength(this.gravity));this.bodies.forEach((F=>function(Z,x,F,u){d.k(k,x.resting),Z.bJ&&L.loadFromCopy(x);if(x.XG<=0)return d.set(x.Ut,0,0,0),d.set(x._forces,0,0,0),void d.set(x._impulses,0,0,0);var G=u||0===x.OY;if(function(Z,x,F,u){if(x._sleepFrameCount>0)return!1;if(u)return!0;var G=!1,f=.5*F*F*x.OY;return d.scale(N,Z.gravity,f),t(Z.testSolid,x.ht,N,(function(){return G=!0,!0}),!0),G}(Z,x,F,G))return;x._sleepFrameCount--,function(Z,x){var F=x.ht,u=Math.floor(F.base[0]),G=Math.floor(F.base[2]),f=Math.floor(F.base[1]),Y=Math.floor(F.max[1]);if(!Z.testFluid(u,f,G))return x.inFluid=!1,void(x.ratioInFluid=0);var j=1,t=f+1;for(;t<=Y&&Z.testFluid(u,t,G);)j++,t++;var o=(f+j-F.base[1])/F.Go[1];o>1&&(o=1);var c=F.Go[0]*F.Go[1]*F.Go[2]*o,s=K;d.scale(s,Z.gravity,-Z.zY*c*x.OY),x.applyForce(s),x.inFluid=!0,x.ratioInFluid=o}(Z,x),h(x._forces),h(x._impulses),h(x.Ut),h(x.resting),d.scale(s,x._forces,1/x.XG),d.uj(s,s,Z.gravity,x.OY),d.scale(J,x._impulses,1/x.XG),d.uj(J,J,s,F),d.add(x.Ut,x.Ut,J),x.friction&&(y(Z,0,x,J,F),y(Z,1,x,J,F),y(Z,2,x,J,F));var f=x.fluidDrag>=0?x.fluidDrag:Z.fluidDrag,Y=x.uo>=0?x.uo:Z.uo,j=Y,o=Y;x.inFluid&&(j=H(x,j,x.fluidDragHoriz>=0?x.fluidDragHoriz:f),o=H(x,o,x.fluidDragVert>=0?x.fluidDragVert:f));j=Math.max(1-j*F/x.XG,0),o=Math.max(1-o*F/x.XG,0),d.set(S,j,o,j),d.multiply(x.Ut,x.Ut,S),d.scale(p,x.Ut,F),d.set(x._forces,0,0,0),d.set(x._impulses,0,0,0),x.nY&&A(B,x.ht);d.k(M,p),d.set(m,0,0,0),x.preventFallOffEdge&&function(Z,x,F,u){if(!x.resting[1]||F[1]>0)return;var G=E;A(G,x.ht);for(var f=0;f<3;f+=2){d.set(b,0,0,0),b[f]=F[f];var Y=!0;(Y=(Y=(Y=(Y=Y&&!T(Z,G.base[0]+b[0]+1e-5,G.base[1],G.base[2]+b[2]+1e-5))&&!T(Z,G.max[0]+b[0]-1e-5,G.base[1],G.base[2]+b[2]+1e-5))&&!T(Z,G.base[0]+b[0]+1e-5,G.base[1],G.max[2]+b[2]-1e-5))&&!T(Z,G.max[0]+b[0]-1e-5,G.base[1],G.max[2]+b[2]-1e-5))?(u[f]=F[f]>0?1:-1,F[f]=0):0===f&&(d.set(w,F[0],0,0),R(Z,G,w,u,x.slideOnCollision))}}(Z,x,p,m);R(Z,x.ht,p,x.resting,x.slideOnCollision),x.nY&&function(Z,x,F,u){if(x.resting[1]>=0&&!x.inFluid)return;var G=0!==x.resting[0],f=0!==x.resting[2];if(!G&&!f)return;var Y=Math.abs(u[0]/u[2]),j=4;if(!G&&Y>j)return;if(!f&&Y<1/j)return;d.add(l,F.base,u);var o=Z.testSolid;t(o,F,u,(function(Z,x,F,u){if(1!==x)return!0;u[x]=0}));var c=F.base[1],s=x.inFluid?1.951:1.001,J=Math.floor(c+s)-c;d.set(i,0,J,0);var p=!1;if(t(o,F,i,(function(Z,x,F,u){return p=!0,!0})),p)return;d.Mx(e,l,F.base),e[1]=0,R(Z,F,e,v,!0);var U=W(F.base[0],l[0]),k=W(F.base[2],l[2]);if(G&&!U&&(!k||!f))return;if(f&&(!U||!G)&&!k)return;var M=!0;if(M=M&&!T(Z,F.base[0]+1e-5,F.base[1],F.base[2]+1e-5),M=M&&!T(Z,F.max[0]-1e-5,F.base[1],F.base[2]+1e-5),M=M&&!T(Z,F.base[0]+1e-5,F.base[1],F.max[2]-1e-5),M=M&&!T(Z,F.max[0]-1e-5,F.base[1],F.max[2]-1e-5),M)return;A(x.ht,F),x.resting[0]=v[0],x.resting[2]=v[2],x.Pp&&x.Pp()}(Z,x,B,M);for(var c=0;c<3;++c)x.resting[c]=x.resting[c]||m[c],U[c]=0,x.resting[c]&&(k[c]||(U[c]=-x.Ut[c]),x.Ut[c]=0);var C=d.length(U);C>.001&&(d.scale(U,U,x.XG),x.cp&&x.cp(U),x.restitution>0&&C>Z.minBounceImpulse&&(d.scale(U,U,x.restitution),x.applyImpulse(U)));var q=d.squaredLength(x.Ut);q>1e-5&&x.Ct();Z.bJ&&Z.bJ(x)?(x.loadFromCopy(L),x.rolledBackLastTick=!0):x.rolledBackLastTick=!1}(this,F,Z,x)))};var S=d.create([0,0,0]);var K=d.create();function y(Z,x,F,u,G){var f=F.resting[x],Y=u[x];if(!F.alwaysApplyHorizFriction||1!==x){if(0===f)return;if(f*Y<=0)return}d.k(q,F.Ut),q[x]=0;var j=d.length(q);if(!W(j,0)){var t=Math.abs(F.friction*Z.gravity[x]*G),o=j>t?(j-t)/j:0;F.Ut[(x+1)%3]*=o,F.Ut[(x+2)%3]*=o}}var q=d.create();function R(Z,x,F,u,G){return d.set(u,0,0,0),t(Z.testSolid,x,F,(function(Z,x,F,f){u[x]=F,f[x]=0,G||(f[0]=0,f[1]=0,f[2]=0)}))}var B=new j([],[]),v=d.create(),l=d.create(),i=d.create(),e=d.create();var b=d.create(),E=new j([],[]),w=d.create();function T(Z,x,F,u){return Z.testSolid(Math.floor(x),Math.floor(F-1),Math.floor(u))}var N=d.create();function W(Z,x){return Math.abs(Z-x)<1e-5}function A(Z,x){for(var F=0;F<3;F++)Z.base[F]=x.base[F],Z.max[F]=x.max[F],Z.Go[F]=x.Go[F]}var h=function(Z){}},11913:function(Z,x){!function(Z){"use strict";var x=function(Z,F){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Z,x){Z.__proto__=x}||function(Z,x){for(var F in x)Object.prototype.hasOwnProperty.call(x,F)&&(Z[F]=x[F])},x(Z,F)};function F(Z,F){if("function"!==typeof F&&null!==F)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function u(){this.constructor=Z}x(Z,F),Z.prototype=null===F?Object.create(F):(u.prototype=F.prototype,new u)}function u(Z,x,F,u){var G,f=arguments.length,Y=f<3?x:null===u?u=Object.getOwnPropertyDescriptor(x,F):u;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(Z,x,F,u);else for(var j=Z.length-1;j>=0;j--)(G=Z[j])&&(Y=(f<3?G(Y):f>3?G(x,F,Y):G(x,F))||Y);return f>3&&Y&&Object.defineProperty(x,F,Y),Y}function G(Z,x,F){if(F||2===arguments.length)for(var u,G=0,f=x.length;G<f;G++)!u&&G in x||(u||(u=Array.prototype.slice.call(x,0,G)),u[G]=x[G]);return Z.concat(u||Array.prototype.slice.call(x))}var f,Y=255,j=213;Z.OPERATION=void 0,(f=Z.OPERATION||(Z.OPERATION={}))[f.ADD=128]="ADD",f[f.REPLACE=0]="REPLACE",f[f.DELETE=64]="DELETE",f[f.DELETE_AND_ADD=192]="DELETE_AND_ADD",f[f.TOUCH=1]="TOUCH",f[f.CLEAR=10]="CLEAR";var d=function(){function x(Z,x,F){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=Z,this.setParent(x,F)}return x.prototype.setParent=function(Z,x,F){var u=this;if(this.indexes||(this.indexes=this.ref instanceof eZ?this.ref._definition.indexes:{}),this.parent=Z,this.parentIndex=F,x)if(this.root=x,this.ref instanceof eZ){var G=this.ref._definition;for(var f in G.schema){var Y=this.ref[f];if(Y&&Y.$changes){var j=G.indexes[f];Y.$changes.setParent(this.ref,x,j)}}}else"object"===typeof this.ref&&this.ref.forEach((function(Z,x){if(Z instanceof eZ){var F=Z.$changes,G=u.ref.$changes.indexes[x];F.setParent(u.ref,u.root,G)}}))},x.prototype.operation=function(Z){this.changes.set(--this.currentCustomOperation,Z)},x.prototype.change=function(x,F){void 0===F&&(F=Z.OPERATION.ADD);var u="number"===typeof x?x:this.indexes[x];this.assertValidIndex(u,x);var G=this.changes.get(u);G&&G.op!==Z.OPERATION.DELETE&&G.op!==Z.OPERATION.TOUCH||this.changes.set(u,{op:G&&G.op===Z.OPERATION.DELETE?Z.OPERATION.DELETE_AND_ADD:F,index:u}),this.allChanges.add(u),this.changed=!0,this.touchParents()},x.prototype.touch=function(x){var F="number"===typeof x?x:this.indexes[x];this.assertValidIndex(F,x),this.changes.has(F)||this.changes.set(F,{op:Z.OPERATION.TOUCH,index:F}),this.allChanges.add(F),this.touchParents()},x.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},x.prototype.getType=function(Z){if(this.ref._definition)return(x=this.ref._definition).schema[x.fieldsByIndex[Z]];var x,F=(x=this.parent._definition).schema[x.fieldsByIndex[this.parentIndex]];return Object.values(F)[0]},x.prototype.getChildrenFilter=function(){var Z=this.parent._definition.childFilters;return Z&&Z[this.parentIndex]},x.prototype.getValue=function(Z){return this.ref.getByIndex(Z)},x.prototype.delete=function(x){var F="number"===typeof x?x:this.indexes[x];if(void 0!==F){var u=this.getValue(F);this.changes.set(F,{op:Z.OPERATION.DELETE,index:F}),this.allChanges.delete(F),delete this.caches[F],u&&u.$changes&&(u.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(x," (").concat(F,")"))},x.prototype.discard=function(x,F){var u=this;void 0===x&&(x=!1),void 0===F&&(F=!1),this.ref instanceof eZ||this.changes.forEach((function(x){if(x.op===Z.OPERATION.DELETE){var F=u.ref.getIndex(x.index);delete u.indexes[F]}})),this.changes.clear(),this.changed=x,F&&this.allChanges.clear(),this.currentCustomOperation=0},x.prototype.discardAll=function(){var Z=this;this.changes.forEach((function(x){var F=Z.getValue(x.index);F&&F.$changes&&F.$changes.discardAll()})),this.discard()},x.prototype.cache=function(Z,x){this.caches[Z]=x},x.prototype.clone=function(){return new x(this.ref,this.parent,this.root)},x.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},x.prototype.assertValidIndex=function(Z,x){if(void 0===Z)throw new Error('ChangeTree: missing index for field "'.concat(x,'"'))},x}();function t(Z,x,F,u){return Z[x]||(Z[x]=[]),Z[x].push(F),null===u||void 0===u||u.forEach((function(Z,x){return F(Z,x)})),function(){return c(Z[x],Z[x].indexOf(F))}}function o(x){var F=this,u="string"!==typeof this.$changes.getType();this.$items.forEach((function(G,f){x.push({refId:F.$changes.refId,op:Z.OPERATION.DELETE,field:f,value:void 0,previousValue:G}),u&&F.$changes.root.removeRef(G.$changes.refId)}))}function c(Z,x){if(-1===x||x>=Z.length)return!1;for(var F=Z.length-1,u=x;u<F;u++)Z[u]=Z[u+1];return Z.length=F,!0}var s=function(Z,x){var F=Z.toString(),u=x.toString();return F<u?-1:F>u?1:0};function J(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,x){return"symbol"===typeof x||isNaN(x)?Z[x]:Z.at(x)},set:function(Z,x,F){if("symbol"===typeof x||isNaN(x))Z[x]=F;else{var u=Array.from(Z.$items.keys()),G=parseInt(u[x]||x);void 0===F||null===F?Z.deleteAt(G):Z.setAt(G,F)}return!0},deleteProperty:function(Z,x){return"number"===typeof x?Z.deleteAt(x):delete Z[x],!0}})}var p=function(){function x(){for(var Z=[],x=0;x<arguments.length;x++)Z[x]=arguments[x];this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,Z)}return x.prototype.Rj=function(x,F){return void 0===F&&(F=!0),t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,x,F?this.$items:void 0)},x.prototype.nx=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,x)},x.is=function(Z){return Array.isArray(Z)||void 0!==Z.array},Object.defineProperty(x.prototype,"length",{get:function(){return this.$items.size},set:function(Z){0===Z?this.clear():this.splice(Z,this.length-Z)},enumerable:!1,configurable:!0}),x.prototype.push=function(){for(var Z,x=this,F=[],u=0;u<arguments.length;u++)F[u]=arguments[u];return F.forEach((function(F){Z=x.$refId++,x.setAt(Z,F)})),Z},x.prototype.pop=function(){var Z=Array.from(this.$indexes.values()).pop();if(void 0!==Z){this.$changes.delete(Z),this.$indexes.delete(Z);var x=this.$items.get(Z);return this.$items.delete(Z),x}},x.prototype.at=function(Z){var x=Array.from(this.$items.keys())[Z];return this.$items.get(x)},x.prototype.setAt=function(x,F){var u,G;if(void 0!==F&&null!==F){if(this.$items.get(x)!==F){void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,x);var f=null!==(G=null===(u=this.$changes.indexes[x])||void 0===u?void 0:u.op)&&void 0!==G?G:Z.OPERATION.ADD;this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,F),this.$changes.change(x,f)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},x.prototype.deleteAt=function(Z){var x=Array.from(this.$items.keys())[Z];return void 0!==x&&this.$deleteAt(x)},x.prototype.$deleteAt=function(Z){return this.$changes.delete(Z),this.$indexes.delete(Z),this.$items.delete(Z)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&o.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.concat=function(){for(var Z,F=[],u=0;u<arguments.length;u++)F[u]=arguments[u];return new(x.bind.apply(x,G([void 0],(Z=Array.from(this.$items.values())).concat.apply(Z,F),!1)))},x.prototype.join=function(Z){return Array.from(this.$items.values()).join(Z)},x.prototype.reverse=function(){var Z=this,x=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(F,u){Z.setAt(x[u],F)})),this},x.prototype.shift=function(){var Z=Array.from(this.$items.keys()).shift();if(void 0!==Z){var x=this.$items.get(Z);return this.$deleteAt(Z),x}},x.prototype.slice=function(Z,F){var u=new x;return u.push.apply(u,Array.from(this.$items.values()).slice(Z,F)),u},x.prototype.sort=function(Z){var x=this;void 0===Z&&(Z=s);var F=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(Z).forEach((function(Z,u){x.setAt(F[u],Z)})),this},x.prototype.splice=function(Z,x){void 0===x&&(x=this.length-Z);for(var F=Array.from(this.$items.keys()),u=[],G=Z;G<Z+x;G++)u.push(this.$items.get(F[G])),this.$deleteAt(F[G]);return u},x.prototype.unshift=function(){for(var Z=this,x=[],F=0;F<arguments.length;F++)x[F]=arguments[F];var u=this.length,G=x.length,f=Array.from(this.$items.values());return x.forEach((function(x,F){Z.setAt(F,x)})),f.forEach((function(x,F){Z.setAt(G+F,x)})),u+G},x.prototype.indexOf=function(Z,x){return Array.from(this.$items.values()).indexOf(Z,x)},x.prototype.lastIndexOf=function(Z,x){return void 0===x&&(x=this.length-1),Array.from(this.$items.values()).lastIndexOf(Z,x)},x.prototype.every=function(Z,x){return Array.from(this.$items.values()).every(Z,x)},x.prototype.some=function(Z,x){return Array.from(this.$items.values()).some(Z,x)},x.prototype.forEach=function(Z,x){Array.from(this.$items.values()).forEach(Z,x)},x.prototype.map=function(Z,x){return Array.from(this.$items.values()).map(Z,x)},x.prototype.filter=function(Z,x){return Array.from(this.$items.values()).filter(Z,x)},x.prototype.reduce=function(Z,x){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},x.prototype.reduceRight=function(Z,x){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},x.prototype.find=function(Z,x){return Array.from(this.$items.values()).find(Z,x)},x.prototype.findIndex=function(Z,x){return Array.from(this.$items.values()).findIndex(Z,x)},x.prototype.fill=function(Z,x,F){throw new Error("ArraySchema#fill() not implemented")},x.prototype.copyWithin=function(Z,x,F){throw new Error("ArraySchema#copyWithin() not implemented")},x.prototype.toString=function(){return this.$items.toString()},x.prototype.toLocaleString=function(){return this.$items.toLocaleString()},x.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},x.prototype.includes=function(Z,x){return Array.from(this.$items.values()).includes(Z,x)},x.prototype.flatMap=function(Z,x){throw new Error("ArraySchema#flatMap() is not supported.")},x.prototype.flat=function(Z){throw new Error("ArraySchema#flat() is not supported.")},x.prototype.findLast=function(){var Z=Array.from(this.$items.values());return Z.findLast.apply(Z,arguments)},x.prototype.findLastIndex=function(){var Z=Array.from(this.$items.values());return Z.findLastIndex.apply(Z,arguments)},x.prototype.setIndex=function(Z,x){this.$indexes.set(Z,x)},x.prototype.getIndex=function(Z){return this.$indexes.get(Z)},x.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},x.prototype.deleteByIndex=function(Z){var x=this.$indexes.get(Z);this.$items.delete(x),this.$indexes.delete(Z)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){return this.toArray().map((function(Z){return"function"===typeof Z.toJSON?Z.toJSON():Z}))},x.prototype.clone=function(Z){return Z?new(x.bind.apply(x,G([void 0],Array.from(this.$items.values()),!1))):new(x.bind.apply(x,G([void 0],this.map((function(Z){return Z.$changes?Z.clone():Z})),!1)))},x}();function U(Z){return Z.$proxy=!0,Z=new Proxy(Z,{get:function(Z,x){return"symbol"!==typeof x&&"undefined"===typeof Z[x]?Z.get(x):Z[x]},set:function(Z,x,F){return"symbol"!==typeof x&&-1===x.indexOf("$")&&"Rj"!==x&&"nx"!==x&&"onChange"!==x?Z.set(x,F):Z[x]=F,!0},deleteProperty:function(Z,x){return Z.delete(x),!0}})}var k=function(){function x(Z){var F=this;if(this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z)if(Z instanceof Map||Z instanceof x)Z.forEach((function(Z,x){return F.set(x,Z)}));else for(var u in Z)this.set(u,Z[u])}return x.prototype.Rj=function(x,F){return void 0===F&&(F=!0),t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,x,F?this.$items:void 0)},x.prototype.nx=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,x)},x.is=function(Z){return void 0!==Z.map},x.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(x.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.set=function(x,F){if(void 0===F||null===F)throw new Error("MapSchema#set('".concat(x,"', ").concat(F,"): trying to set ").concat(F," value on '").concat(x,"'."));x=x.toString();var u="undefined"!==typeof this.$changes.indexes[x],G=u?this.$changes.indexes[x]:this.$refId++,f=u?Z.OPERATION.REPLACE:Z.OPERATION.ADD,Y=void 0!==F.$changes;if(Y&&F.$changes.setParent(this,this.$changes.root,G),u){if(!Y&&this.$items.get(x)===F)return;Y&&this.$items.get(x)!==F&&(f=Z.OPERATION.ADD)}else this.$changes.indexes[x]=G,this.$indexes.set(G,x);return this.$items.set(x,F),this.$changes.change(x,f),this},x.prototype.get=function(Z){return this.$items.get(Z)},x.prototype.delete=function(Z){return this.$changes.delete(Z),this.$items.delete(Z)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&o.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(Z){return this.$items.has(Z)},x.prototype.forEach=function(Z){this.$items.forEach(Z)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(Z,x){this.$indexes.set(Z,x)},x.prototype.getIndex=function(Z){return this.$indexes.get(Z)},x.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},x.prototype.deleteByIndex=function(Z){var x=this.$indexes.get(Z);this.$items.delete(x),this.$indexes.delete(Z)},x.prototype.toJSON=function(){var Z={};return this.forEach((function(x,F){Z[F]="function"===typeof x.toJSON?x.toJSON():x})),Z},x.prototype.clone=function(Z){var F;return Z?F=Object.assign(new x,this):(F=new x,this.forEach((function(Z,x){Z.$changes?F.set(x,Z.clone()):F.set(x,Z)}))),F},x}(),M={};function m(Z,x){M[Z]=x}function C(Z){return M[Z]}var L=function(){function Z(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return Z.create=function(x){var F=new Z;return F.schema=Object.assign({},x&&x.schema||{}),F.indexes=Object.assign({},x&&x.indexes||{}),F.fieldsByIndex=Object.assign({},x&&x.fieldsByIndex||{}),F.descriptors=Object.assign({},x&&x.descriptors||{}),F.deprecated=Object.assign({},x&&x.deprecated||{}),F},Z.prototype.addField=function(Z,x){var F=this.getNextFieldIndex();this.fieldsByIndex[F]=Z,this.indexes[Z]=F,this.schema[Z]=Array.isArray(x)?{array:x[0]}:x},Z.prototype.hasField=function(Z){return void 0!==this.indexes[Z]},Z.prototype.addFilter=function(Z,x){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[Z]]=x,this.indexesWithFilters.push(this.indexes[Z]),!0},Z.prototype.addChildrenFilter=function(Z,x){var F=this.indexes[Z],u=this.schema[Z];if(C(Object.keys(u)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[F]=x,!0;console.warn("@filterChildren: field '".concat(Z,"' can't have children. Ignoring filter."))},Z.prototype.getChildrenFilter=function(Z){return this.childFilters&&this.childFilters[this.indexes[Z]]},Z.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},Z}();function H(Z){return Z._context&&Z._context.useFilters}var S=function(){function Z(){this.types={},this.schemas=new Map,this.useFilters=!1}return Z.prototype.has=function(Z){return this.schemas.has(Z)},Z.prototype.get=function(Z){return this.types[Z]},Z.prototype.add=function(Z,x){void 0===x&&(x=this.schemas.size),Z._definition=L.create(Z._definition),Z._typeid=x,this.types[x]=Z,this.schemas.set(Z,x)},Z.create=function(x){return void 0===x&&(x={}),function(F){return x.context||(x.context=new Z),y(F,x)}},Z}(),K=new S;function y(Z,x){return void 0===x&&(x={}),function(F,u){var f=x.context||K,Y=F.constructor;if(Y._context=f,!Z)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(u,"\" is undefined. Make sure you don't have any circular dependencies."));f.has(Y)||f.add(Y);var j=Y._definition;if(j.addField(u,Z),j.descriptors[u]){if(j.deprecated[u])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(u,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(M){var d=M.stack.split("\n")[4].trim();throw new Error("".concat(M.message," ").concat(d))}}var t=p.is(Z),o=!t&&k.is(Z);if("string"!==typeof Z&&!eZ.is(Z)){var c=Object.values(Z)[0];"string"===typeof c||f.has(c)||f.add(c)}if(x.manual)j.descriptors[u]={enumerable:!0,configurable:!0,writable:!0};else{var s="_".concat(u);j.descriptors[s]={enumerable:!1,configurable:!1,writable:!0},j.descriptors[u]={get:function(){return this[s]},set:function(Z){Z!==this[s]&&(void 0!==Z&&null!==Z?(!t||Z instanceof p||(Z=new(p.bind.apply(p,G([void 0],Z,!1)))),!o||Z instanceof k||(Z=new k(Z)),void 0===Z.$proxy&&(o?Z=U(Z):t&&(Z=J(Z))),this.$changes.change(u),Z.$changes&&Z.$changes.setParent(this,this.$changes.root,this._definition.indexes[u])):this[s]&&this.$changes.delete(u),this[s]=Z)},enumerable:!0,configurable:!0}}}}function q(Z){return function(x,F){var u=x.constructor;u._definition.addFilter(F,Z)&&(u._context.useFilters=!0)}}function R(Z){return function(x,F){var u=x.constructor;u._definition.addChildrenFilter(F,Z)&&(u._context.useFilters=!0)}}function B(Z){return void 0===Z&&(Z=!0),function(x,F){var u=x.constructor._definition;u.deprecated[F]=!0,Z&&(u.descriptors[F]={get:function(){throw new Error("".concat(F," is deprecated."))},set:function(Z){},enumerable:!1,configurable:!0})}}function v(Z,x,F){for(var u in void 0===F&&(F={}),F.context||(F.context=Z._context||F.context||K),x)y(x[u],F)(Z.prototype,u);return Z}function l(Z){for(var x=0,F=0,u=0,G=Z.length;u<G;u++)(x=Z.charCodeAt(u))<128?F+=1:x<2048?F+=2:x<55296||x>=57344?F+=3:(u++,F+=4);return F}function i(Z,x,F){for(var u=0,G=0,f=F.length;G<f;G++)(u=F.charCodeAt(G))<128?Z[x++]=u:u<2048?(Z[x++]=192|u>>6,Z[x++]=128|63&u):u<55296||u>=57344?(Z[x++]=224|u>>12,Z[x++]=128|u>>6&63,Z[x++]=128|63&u):(G++,u=65536+((1023&u)<<10|1023&F.charCodeAt(G)),Z[x++]=240|u>>18,Z[x++]=128|u>>12&63,Z[x++]=128|u>>6&63,Z[x++]=128|63&u)}function e(Z,x){Z.push(255&x)}function b(Z,x){Z.push(255&x)}function E(Z,x){Z.push(255&x),Z.push(x>>8&255)}function w(Z,x){Z.push(255&x),Z.push(x>>8&255)}function T(Z,x){Z.push(255&x),Z.push(x>>8&255),Z.push(x>>16&255),Z.push(x>>24&255)}function N(Z,x){var F=x>>24,u=x>>16,G=x>>8,f=x;Z.push(255&f),Z.push(255&G),Z.push(255&u),Z.push(255&F)}function W(Z,x){var F=Math.floor(x/Math.pow(2,32));N(Z,x>>>0),N(Z,F)}function A(Z,x){var F=x/Math.pow(2,32)|0;N(Z,x>>>0),N(Z,F)}function h(Z,x){O(Z,x)}function X(Z,x){n(Z,x)}var D=new Int32Array(2),Q=new Float32Array(D.buffer),g=new Float64Array(D.buffer);function O(Z,x){Q[0]=x,T(Z,D[0])}function n(Z,x){g[0]=x,T(Z,D[0]),T(Z,D[1])}function V(Z,x){return b(Z,x?1:0)}function a(Z,x){x||(x="");var F=l(x),u=0;if(F<32)Z.push(160|F),u=1;else if(F<256)Z.push(217),b(Z,F),u=2;else if(F<65536)Z.push(218),w(Z,F),u=3;else{if(!(F<4294967296))throw new Error("String too long");Z.push(219),N(Z,F),u=5}return i(Z,Z.length,x),u+F}function I(Z,x){return isNaN(x)?I(Z,0):isFinite(x)?x!==(0|x)?(Z.push(203),n(Z,x),9):x>=0?x<128?(b(Z,x),1):x<256?(Z.push(204),b(Z,x),2):x<65536?(Z.push(205),w(Z,x),3):x<4294967296?(Z.push(206),N(Z,x),5):(Z.push(207),A(Z,x),9):x>=-32?(Z.push(224|x+32),1):x>=-128?(Z.push(208),e(Z,x),2):x>=-32768?(Z.push(209),E(Z,x),3):x>=-2147483648?(Z.push(210),T(Z,x),5):(Z.push(211),W(Z,x),9):I(Z,x>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var r=Object.freeze({__proto__:null,utf8Write:i,int8:e,uint8:b,int16:E,uint16:w,int32:T,uint32:N,int64:W,uint64:A,float32:h,float64:X,writeFloat32:O,writeFloat64:n,boolean:V,string:a,number:I});function z(Z,x,F){for(var u="",G=0,f=x,Y=x+F;f<Y;f++){var j=Z[f];0!==(128&j)?192!==(224&j)?224!==(240&j)?240!==(248&j)?console.error("Invalid byte "+j.toString(16)):(G=(7&j)<<18|(63&Z[++f])<<12|(63&Z[++f])<<6|63&Z[++f])>=65536?(G-=65536,u+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):u+=String.fromCharCode(G):u+=String.fromCharCode((15&j)<<12|(63&Z[++f])<<6|63&Z[++f]):u+=String.fromCharCode((31&j)<<6|63&Z[++f]):u+=String.fromCharCode(j)}return u}function P(Z,x){return ZZ(Z,x)<<24>>24}function ZZ(Z,x){return Z[x.offset++]}function xZ(Z,x){return FZ(Z,x)<<16>>16}function FZ(Z,x){return Z[x.offset++]|Z[x.offset++]<<8}function uZ(Z,x){return Z[x.offset++]|Z[x.offset++]<<8|Z[x.offset++]<<16|Z[x.offset++]<<24}function GZ(Z,x){return uZ(Z,x)>>>0}function fZ(Z,x){return sZ(Z,x)}function YZ(Z,x){return JZ(Z,x)}function jZ(Z,x){var F=GZ(Z,x);return uZ(Z,x)*Math.pow(2,32)+F}function dZ(Z,x){var F=GZ(Z,x);return GZ(Z,x)*Math.pow(2,32)+F}var tZ=new Int32Array(2),oZ=new Float32Array(tZ.buffer),cZ=new Float64Array(tZ.buffer);function sZ(Z,x){return tZ[0]=uZ(Z,x),oZ[0]}function JZ(Z,x){return tZ[0]=uZ(Z,x),tZ[1]=uZ(Z,x),cZ[0]}function pZ(Z,x){return ZZ(Z,x)>0}function UZ(Z,x){var F,u=Z[x.offset++];u<192?F=31&u:217===u?F=ZZ(Z,x):218===u?F=FZ(Z,x):219===u&&(F=GZ(Z,x));var G=z(Z,x.offset,F);return x.offset+=F,G}function kZ(Z,x){var F=Z[x.offset];return F<192&&F>160||217===F||218===F||219===F}function MZ(Z,x){var F=Z[x.offset++];return F<128?F:202===F?sZ(Z,x):203===F?JZ(Z,x):204===F?ZZ(Z,x):205===F?FZ(Z,x):206===F?GZ(Z,x):207===F?dZ(Z,x):208===F?P(Z,x):209===F?xZ(Z,x):210===F?uZ(Z,x):211===F?jZ(Z,x):F>223?-1*(255-F+1):void 0}function mZ(Z,x){var F=Z[x.offset];return F<128||F>=202&&F<=211}function CZ(Z,x){return Z[x.offset]<160}function LZ(Z,x){return Z[x.offset-1]===Y&&(Z[x.offset]<128||Z[x.offset]>=202&&Z[x.offset]<=211)}var HZ=Object.freeze({__proto__:null,int8:P,uint8:ZZ,int16:xZ,uint16:FZ,int32:uZ,uint32:GZ,float32:fZ,float64:YZ,int64:jZ,uint64:dZ,readFloat32:sZ,readFloat64:JZ,boolean:pZ,string:UZ,stringCheck:kZ,number:MZ,numberCheck:mZ,arrayCheck:CZ,switchStructureCheck:LZ}),SZ=function(){function x(Z){var x=this;this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return x.add(Z)}))}return x.prototype.Rj=function(x,F){return void 0===F&&(F=!0),t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,x,F?this.$items:void 0)},x.prototype.nx=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,x)},x.is=function(Z){return void 0!==Z.collection},x.prototype.add=function(Z){var x=this.$refId++;return void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,x),this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,Z),this.$changes.change(x),x},x.prototype.at=function(Z){var x=Array.from(this.$items.keys())[Z];return this.$items.get(x)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(Z){for(var x,F,u=this.$items.entries();(F=u.next())&&!F.done;)if(Z===F.value[1]){x=F.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&o.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(Z){return Array.from(this.$items.values()).some((function(x){return x===Z}))},x.prototype.forEach=function(Z){var x=this;this.$items.forEach((function(F,u,G){return Z(F,u,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(Z,x){this.$indexes.set(Z,x)},x.prototype.getIndex=function(Z){return this.$indexes.get(Z)},x.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},x.prototype.deleteByIndex=function(Z){var x=this.$indexes.get(Z);this.$items.delete(x),this.$indexes.delete(Z)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var Z=[];return this.forEach((function(x,F){Z.push("function"===typeof x.toJSON?x.toJSON():x)})),Z},x.prototype.clone=function(Z){var F;return Z?F=Object.assign(new x,this):(F=new x,this.forEach((function(Z){Z.$changes?F.add(Z.clone()):F.add(Z)}))),F},x}(),KZ=function(){function x(Z){var x=this;this.$changes=new d(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,Z&&Z.forEach((function(Z){return x.add(Z)}))}return x.prototype.Rj=function(x,F){return void 0===F&&(F=!0),t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.ADD,x,F?this.$items:void 0)},x.prototype.nx=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,x)},x.is=function(Z){return void 0!==Z.set},x.prototype.add=function(x){var F,u;if(this.has(x))return!1;var G=this.$refId++;void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,G);var f=null!==(u=null===(F=this.$changes.indexes[G])||void 0===F?void 0:F.op)&&void 0!==u?u:Z.OPERATION.ADD;return this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,x),this.$changes.change(G,f),G},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(Z){for(var x,F,u=this.$items.entries();(F=u.next())&&!F.done;)if(Z===F.value[1]){x=F.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&o.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:Z.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(Z){for(var x,F=this.$items.values(),u=!1;(x=F.next())&&!x.done;)if(Z===x.value){u=!0;break}return u},x.prototype.forEach=function(Z){var x=this;this.$items.forEach((function(F,u,G){return Z(F,u,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(Z,x){this.$indexes.set(Z,x)},x.prototype.getIndex=function(Z){return this.$indexes.get(Z)},x.prototype.getByIndex=function(Z){return this.$items.get(this.$indexes.get(Z))},x.prototype.deleteByIndex=function(Z){var x=this.$indexes.get(Z);this.$items.delete(x),this.$indexes.delete(Z)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var Z=[];return this.forEach((function(x,F){Z.push("function"===typeof x.toJSON?x.toJSON():x)})),Z},x.prototype.clone=function(Z){var F;return Z?F=Object.assign(new x,this):(F=new x,this.forEach((function(Z){Z.$changes?F.add(Z.clone()):F.add(Z)}))),F},x}(),yZ=function(){function Z(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return Z.prototype.addRefId=function(Z){this.refIds.has(Z)||(this.refIds.add(Z),this.containerIndexes.set(Z,new Set))},Z.get=function(x){return void 0===x.$filterState&&(x.$filterState=new Z),x.$filterState},Z}(),qZ=function(){function Z(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return Z.prototype.getNextUniqueId=function(){return this.nextUniqueId++},Z.prototype.addRef=function(Z,x,F){void 0===F&&(F=!0),this.refs.set(Z,x),F&&(this.refCounts[Z]=(this.refCounts[Z]||0)+1)},Z.prototype.removeRef=function(Z){this.refCounts[Z]=this.refCounts[Z]-1,this.deletedRefs.add(Z)},Z.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},Z.prototype.garbageCollectDeletedRefs=function(){var Z=this;this.deletedRefs.forEach((function(x){if(!(Z.refCounts[x]>0)){var F=Z.refs.get(x);if(F instanceof eZ)for(var u in F._definition.schema)"string"!==typeof F._definition.schema[u]&&F[u]&&F[u].$changes&&Z.removeRef(F[u].$changes.refId);else{var G=F.$changes.parent._definition,f=G.schema[G.fieldsByIndex[F.$changes.parentIndex]];"function"===typeof Object.values(f)[0]&&Array.from(F.values()).forEach((function(x){return Z.removeRef(x.$changes.refId)}))}Z.refs.delete(x),delete Z.refCounts[x]}})),this.deletedRefs.clear()},Z}(),RZ=function(Z){function x(){return null!==Z&&Z.apply(this,arguments)||this}return F(x,Z),x}(Error);function BZ(Z,x,F,u){var G,f=!1;switch(x){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":G="number",isNaN(Z)&&console.log('trying to encode "NaN" in '.concat(F.constructor.name,"#").concat(u));break;case"string":G="string",f=!0;break;case"boolean":return}if(typeof Z!==G&&(!f||f&&null!==Z)){var Y="'".concat(JSON.stringify(Z),"'").concat(Z&&Z.constructor&&" (".concat(Z.constructor.name,")")||"");throw new RZ("a '".concat(G,"' was expected, but ").concat(Y," was provided in ").concat(F.constructor.name,"#").concat(u))}}function vZ(Z,x,F,u){if(!(Z instanceof x))throw new RZ("a '".concat(x.name,"' was expected, but '").concat(Z.constructor.name,"' was provided in ").concat(F.constructor.name,"#").concat(u))}function lZ(Z,x,F,u,G){BZ(F,Z,u,G);var f=r[Z];if(!f)throw new RZ("a '".concat(Z,"' was expected, but ").concat(F," was provided in ").concat(u.constructor.name,"#").concat(G));f(x,F)}function iZ(Z,x,F){return HZ[Z](x,F)}var eZ=function(){function x(){for(var Z=[],x=0;x<arguments.length;x++)Z[x]=arguments[x];Object.defineProperties(this,{$changes:{value:new d(this,void 0,new qZ),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var F=this._definition.descriptors;F&&Object.defineProperties(this,F),Z[0]&&this.assign(Z[0])}return x.onError=function(Z){console.error(Z)},x.is=function(Z){return Z._definition&&void 0!==Z._definition.schema},x.prototype.onChange=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.REPLACE,x)},x.prototype.nx=function(x){return t(this.$callbacks||(this.$callbacks=[]),Z.OPERATION.DELETE,x)},x.prototype.assign=function(Z){return Object.assign(this,Z),this},Object.defineProperty(x.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),x.prototype.setDirty=function(Z,x){this.$changes.change(Z,x)},x.prototype.listen=function(Z,x,F){var u=this;return void 0===F&&(F=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[Z]||(this.$callbacks[Z]=[]),this.$callbacks[Z].push(x),F&&void 0!==this[Z]&&x(this[Z],void 0),function(){return c(u.$callbacks[Z],u.$callbacks[Z].indexOf(x))}},x.prototype.decode=function(F,u,G){var f;void 0===u&&(u={offset:0}),void 0===G&&(G=this);var j=[],d=this.$changes.root,t=F.length,o=0;for(d.refs.set(o,this);u.offset<t;){var c=F[u.offset++];if(c!=Y){var s=G.$changes,J=void 0!==G._definition,U=J?c>>6<<6:c;if(U!==Z.OPERATION.CLEAR){var M=J?c%(U||255):MZ(F,u),m=J?G._definition.fieldsByIndex[M]:"",L=s.getType(M),H=void 0,S=void 0,K=void 0;if(J?S=G["_".concat(m)]:(S=G.getByIndex(M),(U&Z.OPERATION.ADD)===Z.OPERATION.ADD?(K=G instanceof k?UZ(F,u):M,G.setIndex(M,K)):K=G.getIndex(M)),(U&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&(U!==Z.OPERATION.DELETE_AND_ADD&&G.deleteByIndex(M),S&&S.$changes&&d.removeRef(S.$changes.refId),H=null),void 0!==m){if(U===Z.OPERATION.DELETE);else if(x.is(L)){var y=MZ(F,u);if(H=d.refs.get(y),U!==Z.OPERATION.REPLACE){var q=this.getSchemaType(F,u,L);H||((H=this.createTypeInstance(q)).$changes.refId=y,S&&(H.$callbacks=S.$callbacks,S.$changes.refId&&y!==S.$changes.refId&&d.removeRef(S.$changes.refId))),d.addRef(y,H,H!==S)}}else if("string"===typeof L)H=iZ(L,F,u);else{var R=C(Object.keys(L)[0]),B=MZ(F,u),v=d.refs.has(B)?S||d.refs.get(B):new R.constructor;if((H=v.clone(!0)).$changes.refId=B,S&&(H.$callbacks=S.$callbacks,S.$changes.refId&&B!==S.$changes.refId)){d.removeRef(S.$changes.refId);for(var l=S.entries(),i=void 0;(i=l.next())&&!i.done;){var e=(f=i.value)[0],b=f[1];j.push({refId:B,op:Z.OPERATION.DELETE,field:e,value:void 0,previousValue:b})}}d.addRef(B,H,v!==S)}if(null!==H&&void 0!==H)if(H.$changes&&H.$changes.setParent(s.ref,s.root,M),G instanceof x)G[m]=H;else if(G instanceof k)e=K,G.$items.set(e,H),G.$changes.allChanges.add(M);else if(G instanceof p)G.setAt(M,H);else if(G instanceof SZ){var E=G.add(H);G.setIndex(M,E)}else G instanceof KZ&&!1!==(E=G.add(H))&&G.setIndex(M,E);S!==H&&j.push({refId:o,op:U,field:m,dynamicIndex:K,value:H,previousValue:S})}else{console.warn("@colyseus/schema: definition mismatch");for(var w={offset:u.offset};u.offset<t&&(!LZ(F,u)||(w.offset=u.offset+1,!d.refs.has(MZ(F,w))));)u.offset++}}else G.clear(j)}else{o=MZ(F,u);var T=d.refs.get(o);if(!T)throw new Error('"refId" not found: '.concat(o));G=T}}return this._triggerChanges(j),d.garbageCollectDeletedRefs(),j},x.prototype.encode=function(F,u,G){void 0===F&&(F=!1),void 0===u&&(u=[]),void 0===G&&(G=!1);for(var f=this.$changes,j=new WeakSet,d=[f],t=1,o=0;o<t;o++){var c=d[o],s=c.ref,J=s instanceof x;c.ensureRefId(),j.add(c),c!==f&&(c.changed||F)&&(b(u,Y),I(u,c.refId));for(var p=F?Array.from(c.allChanges):Array.from(c.changes.values()),U=0,M=p.length;U<M;U++){var m=F?{op:Z.OPERATION.ADD,index:p[U]}:p[U],L=m.index,H=J?s._definition.fieldsByIndex&&s._definition.fieldsByIndex[L]:L,S=u.length;if(m.op!==Z.OPERATION.TOUCH)if(J)b(u,L|m.op);else{if(b(u,m.op),m.op===Z.OPERATION.CLEAR)continue;I(u,L)}if(J||(m.op&Z.OPERATION.ADD)!=Z.OPERATION.ADD||s instanceof k&&a(u,c.ref.$indexes.get(L)),m.op!==Z.OPERATION.DELETE){var K=c.getType(L),y=c.getValue(L);if(y&&y.$changes&&!j.has(y.$changes)&&(d.push(y.$changes),y.$changes.ensureRefId(),t++),m.op!==Z.OPERATION.TOUCH){if(x.is(K))vZ(y,K,s,H),I(u,y.$changes.refId),(m.op&Z.OPERATION.ADD)===Z.OPERATION.ADD&&this.tryEncodeTypeId(u,K,y.constructor);else if("string"===typeof K)lZ(K,u,y,s,H);else{var q=C(Object.keys(K)[0]);vZ(s["_".concat(H)],q.constructor,s,H),I(u,y.$changes.refId)}G&&c.cache(L,u.slice(S))}}}F||G||c.discard()}return u},x.prototype.encodeAll=function(Z){return this.encode(!0,[],Z)},x.prototype.applyFilters=function(F,u){var G,f;void 0===u&&(u=!1);for(var j=this,d=new Set,t=yZ.get(F),o=[this.$changes],c=1,s=[],J=function(J){var p=o[J];if(d.has(p.refId))return"continue";var U=p.ref,M=U instanceof x;b(s,Y),I(s,p.refId);var m=t.refIds.has(p),C=u||!m;t.addRefId(p);var L=t.containerIndexes.get(p),H=C?Array.from(p.allChanges):Array.from(p.changes.values());!u&&M&&U._definition.indexesWithFilters&&U._definition.indexesWithFilters.forEach((function(x){!L.has(x)&&p.allChanges.has(x)&&(C?H.push(x):H.push({op:Z.OPERATION.ADD,index:x}))}));for(var S=0,K=H.length;S<K;S++){var y=C?{op:Z.OPERATION.ADD,index:H[S]}:H[S];if(y.op!==Z.OPERATION.CLEAR){var q=y.index;if(y.op!==Z.OPERATION.DELETE){var R=p.getValue(q),B=p.getType(q);if(M){if((v=U._definition.filters&&U._definition.filters[q])&&!v.call(U,F,R,j)){R&&R.$changes&&d.add(R.$changes.refId);continue}}else{var v,l=p.parent;if((v=p.getChildrenFilter())&&!v.call(l,F,U.$indexes.get(q),R,j)){R&&R.$changes&&d.add(R.$changes.refId);continue}}if(R.$changes&&(o.push(R.$changes),c++),y.op!==Z.OPERATION.TOUCH)if(y.op===Z.OPERATION.ADD||M)s.push.apply(s,null!==(G=p.caches[q])&&void 0!==G?G:[]),L.add(q);else if(L.has(q))s.push.apply(s,null!==(f=p.caches[q])&&void 0!==f?f:[]);else{if(L.add(q),b(s,Z.OPERATION.ADD),I(s,q),U instanceof k){var i=p.ref.$indexes.get(q);a(s,i)}R.$changes?I(s,R.$changes.refId):r[B](s,R)}else R.$changes&&!M&&(b(s,Z.OPERATION.ADD),I(s,q),U instanceof k&&(i=p.ref.$indexes.get(q),a(s,i)),I(s,R.$changes.refId))}else M?b(s,y.op|q):(b(s,y.op),I(s,q))}else b(s,y.op)}},p=0;p<c;p++)J(p);return s},x.prototype.clone=function(){var Z,x=new this.constructor,F=this._definition.schema;for(var u in F)"object"===typeof this[u]&&"function"===typeof(null===(Z=this[u])||void 0===Z?void 0:Z.clone)?x[u]=this[u].clone():x[u]=this[u];return x},x.prototype.toJSON=function(){var Z=this._definition.schema,x=this._definition.deprecated,F={};for(var u in Z)x[u]||null===this[u]||"undefined"===typeof this[u]||(F[u]="function"===typeof this[u].toJSON?this[u].toJSON():this["_".concat(u)]);return F},x.prototype.discardAllChanges=function(){this.$changes.discardAll()},x.prototype.getByIndex=function(Z){return this[this._definition.fieldsByIndex[Z]]},x.prototype.deleteByIndex=function(Z){this[this._definition.fieldsByIndex[Z]]=void 0},x.prototype.tryEncodeTypeId=function(Z,x,F){x._typeid!==F._typeid&&(b(Z,j),I(Z,F._typeid))},x.prototype.getSchemaType=function(Z,x,F){var u;return Z[x.offset]===j&&(x.offset++,u=this.constructor._context.get(MZ(Z,x))),u||F},x.prototype.createTypeInstance=function(Z){var x=new Z;return x.$changes.root=this.$changes.root,x},x.prototype._triggerChanges=function(F){for(var u,G,f,Y,j,d,t,o,c,s=new Set,J=this.$changes.root.refs,p=function(p){var U=F[p],k=U.refId,M=J.get(k),m=M.$callbacks;if((U.op&Z.OPERATION.DELETE)===Z.OPERATION.DELETE&&U.previousValue instanceof x&&(null===(G=null===(u=U.previousValue.$callbacks)||void 0===u?void 0:u[Z.OPERATION.DELETE])||void 0===G||G.forEach((function(Z){return Z()}))),!m)return"continue";if(M instanceof x){if(!s.has(k))try{null===(f=null===m||void 0===m?void 0:m[Z.OPERATION.REPLACE])||void 0===f||f.forEach((function(Z){return Z()}))}catch(C){x.onError(C)}try{m.hasOwnProperty(U.field)&&(null===(Y=m[U.field])||void 0===Y||Y.forEach((function(Z){return Z(U.value,U.previousValue)})))}catch(C){x.onError(C)}}else U.op===Z.OPERATION.ADD&&void 0===U.previousValue?null===(j=m[Z.OPERATION.ADD])||void 0===j||j.forEach((function(Z){var x;return Z(U.value,null!==(x=U.dynamicIndex)&&void 0!==x?x:U.field)})):U.op===Z.OPERATION.DELETE?void 0!==U.previousValue&&(null===(d=m[Z.OPERATION.DELETE])||void 0===d||d.forEach((function(Z){var x;return Z(U.previousValue,null!==(x=U.dynamicIndex)&&void 0!==x?x:U.field)}))):U.op===Z.OPERATION.DELETE_AND_ADD&&(void 0!==U.previousValue&&(null===(t=m[Z.OPERATION.DELETE])||void 0===t||t.forEach((function(Z){var x;return Z(U.previousValue,null!==(x=U.dynamicIndex)&&void 0!==x?x:U.field)}))),null===(o=m[Z.OPERATION.ADD])||void 0===o||o.forEach((function(Z){var x;return Z(U.value,null!==(x=U.dynamicIndex)&&void 0!==x?x:U.field)}))),U.value!==U.previousValue&&(null===(c=m[Z.OPERATION.REPLACE])||void 0===c||c.forEach((function(Z){var x;return Z(U.value,null!==(x=U.dynamicIndex)&&void 0!==x?x:U.field)})));s.add(k)},U=0;U<F.length;U++)p(U)},x._definition=L.create(),x}();function bZ(Z){for(var x=[Z.$changes],F=1,u={},G=u,f=function(Z){var F=x[Z];F.changes.forEach((function(Z){var x=F.ref,u=Z.index,f=x._definition?x._definition.fieldsByIndex[u]:x.$indexes.get(u);G[f]=F.getValue(u)}))},Y=0;Y<F;Y++)f(Y);return u}var EZ={context:new S},wZ=function(Z){function x(){return null!==Z&&Z.apply(this,arguments)||this}return F(x,Z),u([y("string",EZ)],x.prototype,"name",void 0),u([y("string",EZ)],x.prototype,"type",void 0),u([y("number",EZ)],x.prototype,"referencedType",void 0),x}(eZ),TZ=function(Z){function x(){var x=null!==Z&&Z.apply(this,arguments)||this;return x.fields=new p,x}return F(x,Z),u([y("number",EZ)],x.prototype,"id",void 0),u([y([wZ],EZ)],x.prototype,"fields",void 0),x}(eZ),NZ=function(Z){function x(){var x=null!==Z&&Z.apply(this,arguments)||this;return x.types=new p,x}return F(x,Z),x.encode=function(Z){var F=Z.constructor,u=new x;u.rootType=F._typeid;var G=function(Z,x){for(var F in x){var G=new wZ;G.name=F;var f=void 0;if("string"===typeof x[F])f=x[F];else{var Y=x[F],j=void 0;eZ.is(Y)?(f="ref",j=x[F]):"string"===typeof Y[f=Object.keys(Y)[0]]?f+=":"+Y[f]:j=Y[f],G.referencedType=j?j._typeid:-1}G.type=f,Z.fields.push(G)}u.types.push(Z)},f=F._context.types;for(var Y in f){var j=new TZ;j.id=Number(Y),G(j,f[Y]._definition.schema)}return u.encodeAll()},x.decode=function(Z,u){var G=new S,f=new x;f.decode(Z,u);var Y=f.types.reduce((function(Z,x){var u=function(Z){function x(){return null!==Z&&Z.apply(this,arguments)||this}return F(x,Z),x}(eZ),f=x.id;return Z[f]=u,G.add(u,f),Z}),{});f.types.forEach((function(Z){var x=Y[Z.id];Z.fields.forEach((function(Z){var F;if(void 0!==Z.referencedType){var u=Z.type,f=Y[Z.referencedType];if(!f){var j=Z.type.split(":");u=j[0],f=j[1]}"ref"===u?y(f,{context:G})(x.prototype,Z.name):y(((F={})[u]=f,F),{context:G})(x.prototype,Z.name)}else y(Z.type,{context:G})(x.prototype,Z.name)}))}));var j=Y[f.rootType],d=new j;for(var t in j._definition.schema){var o=j._definition.schema[t];"string"!==typeof o&&(d[t]="function"===typeof o?new o:new(C(Object.keys(o)[0]).constructor))}return d},u([y([TZ],EZ)],x.prototype,"types",void 0),u([y("number",EZ)],x.prototype,"rootType",void 0),x}(eZ);m("map",{constructor:k}),m("array",{constructor:p}),m("set",{constructor:KZ}),m("collection",{constructor:SZ}),Z.ArraySchema=p,Z.CollectionSchema=SZ,Z.Context=S,Z.MapSchema=k,Z.Reflection=NZ,Z.ReflectionField=wZ,Z.ReflectionType=TZ,Z.Schema=eZ,Z.SchemaDefinition=L,Z.SetSchema=KZ,Z.decode=HZ,Z.defineTypes=v,Z.deprecated=B,Z.dumpChanges=bZ,Z.encode=r,Z.filter=q,Z.filterChildren=R,Z.hasFilter=H,Z.registerType=m,Z.type=y,Object.defineProperty(Z,"__esModule",{value:!0})}(x)},13373:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13364:(Z,x,F)=>{var u=F(13373),G=F(13381),f=Object.hasOwnProperty,Y=Object.create(null);for(var j in u)f.call(u,j)&&(Y[u[j]]=j);var d=Z.exports={to:{},get:{}};function t(Z,x,F){return Math.min(Math.max(x,Z),F)}function o(Z){var x=Math.round(Z).toString(16).toUpperCase();return x.length<2?"0"+x:x}d.get=function(Z){var x,F;switch(Z.substring(0,3).toLowerCase()){case"hsl":x=d.get.hsl(Z),F="hsl";break;case"hwb":x=d.get.hwb(Z),F="hwb";break;default:x=d.get.rgb(Z),F="rgb"}return x?{model:F,value:x}:null},d.get.rgb=function(Z){if(!Z)return null;var x,F,G,Y=[0,0,0,1];if(x=Z.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(G=x[2],x=x[1],F=0;F<3;F++){var j=2*F;Y[F]=parseInt(x.slice(j,j+2),16)}G&&(Y[3]=parseInt(G,16)/255)}else if(x=Z.match(/^#([a-f0-9]{3,4})$/i)){for(G=(x=x[1])[3],F=0;F<3;F++)Y[F]=parseInt(x[F]+x[F],16);G&&(Y[3]=parseInt(G+G,16)/255)}else if(x=Z.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(F=0;F<3;F++)Y[F]=parseInt(x[F+1],0);x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}else{if(!(x=Z.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(x=Z.match(/^(\w+)$/))?"transparent"===x[1]?[0,0,0,0]:f.call(u,x[1])?((Y=u[x[1]])[3]=1,Y):null:null;for(F=0;F<3;F++)Y[F]=Math.round(2.55*parseFloat(x[F+1]));x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}for(F=0;F<3;F++)Y[F]=t(Y[F],0,255);return Y[3]=t(Y[3],0,1),Y},d.get.hsl=function(Z){if(!Z)return null;var x=Z.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var F=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,t(parseFloat(x[2]),0,100),t(parseFloat(x[3]),0,100),t(isNaN(F)?1:F,0,1)]}return null},d.get.hwb=function(Z){if(!Z)return null;var x=Z.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var F=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,t(parseFloat(x[2]),0,100),t(parseFloat(x[3]),0,100),t(isNaN(F)?1:F,0,1)]}return null},d.to.hex=function(){var Z=G(arguments);return"#"+o(Z[0])+o(Z[1])+o(Z[2])+(Z[3]<1?o(Math.round(255*Z[3])):"")},d.to.rgb=function(){var Z=G(arguments);return Z.length<4||1===Z[3]?"rgb("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+")":"rgba("+Math.round(Z[0])+", "+Math.round(Z[1])+", "+Math.round(Z[2])+", "+Z[3]+")"},d.to.rgb.percent=function(){var Z=G(arguments),x=Math.round(Z[0]/255*100),F=Math.round(Z[1]/255*100),u=Math.round(Z[2]/255*100);return Z.length<4||1===Z[3]?"rgb("+x+"%, "+F+"%, "+u+"%)":"rgba("+x+"%, "+F+"%, "+u+"%, "+Z[3]+")"},d.to.hsl=function(){var Z=G(arguments);return Z.length<4||1===Z[3]?"hsl("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%)":"hsla("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%, "+Z[3]+")"},d.to.hwb=function(){var Z=G(arguments),x="";return Z.length>=4&&1!==Z[3]&&(x=", "+Z[3]),"hwb("+Z[0]+", "+Z[1]+"%, "+Z[2]+"%"+x+")"},d.to.keyword=function(Z){return Y[Z.slice(0,3)]}},13358:(Z,x,F)=>{const u=F(13364),G=F(13394),f=["keyword","gray","hex"],Y={};for(const J of Object.keys(G))Y[[...G[J].labels].sort().join("")]=J;const j={};function d(Z,x){if(!(this instanceof d))return new d(Z,x);if(x&&x in f&&(x=null),x&&!(x in G))throw new Error("Unknown model: "+x);let F,t;if(null==Z)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(Z instanceof d)this.model=Z.model,this.color=[...Z.color],this.valpha=Z.valpha;else if("string"===typeof Z){const x=u.get(Z);if(null===x)throw new Error("Unable to parse color from string: "+Z);this.model=x.model,t=G[this.model].channels,this.color=x.value.slice(0,t),this.valpha="number"===typeof x.value[t]?x.value[t]:1}else if(Z.length>0){this.model=x||"rgb",t=G[this.model].channels;const F=Array.prototype.slice.call(Z,0,t);this.color=s(F,t),this.valpha="number"===typeof Z[t]?Z[t]:1}else if("number"===typeof Z)this.model="rgb",this.color=[Z>>16&255,Z>>8&255,255&Z],this.valpha=1;else{this.valpha=1;const x=Object.keys(Z);"alpha"in Z&&(x.splice(x.indexOf("alpha"),1),this.valpha="number"===typeof Z.alpha?Z.alpha:0);const u=x.sort().join("");if(!(u in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(Z));this.model=Y[u];const{labels:f}=G[this.model],j=[];for(F=0;F<f.length;F++)j.push(Z[f[F]]);this.color=s(j)}if(j[this.model])for(t=G[this.model].channels,F=0;F<t;F++){const Z=j[this.model][F];Z&&(this.color[F]=Z(this.color[F]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}d.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(Z){let x=this.model in u.to?this:this.rgb();x=x.round("number"===typeof Z?Z:1);const F=1===x.valpha?x.color:[...x.color,this.valpha];return u.to[x.model](F)},percentString(Z){const x=this.rgb().round("number"===typeof Z?Z:1),F=1===x.valpha?x.color:[...x.color,this.valpha];return u.to.rgb.percent(F)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const Z={},{channels:x}=G[this.model],{labels:F}=G[this.model];for(let u=0;u<x;u++)Z[F[u]]=this.color[u];return 1!==this.valpha&&(Z.alpha=this.valpha),Z},unitArray(){const Z=this.rgb().color;return Z[0]/=255,Z[1]/=255,Z[2]/=255,1!==this.valpha&&Z.push(this.valpha),Z},unitObject(){const Z=this.rgb().object();return Z.r/=255,Z.g/=255,Z.b/=255,1!==this.valpha&&(Z.alpha=this.valpha),Z},round(Z){return Z=Math.max(Z||0,0),new d([...this.color.map(t(Z)),this.valpha],this.model)},alpha(Z){return void 0!==Z?new d([...this.color,Math.max(0,Math.min(1,Z))],this.model):this.valpha},red:o("rgb",0,c(255)),green:o("rgb",1,c(255)),blue:o("rgb",2,c(255)),hue:o(["hsl","hsv","hsl","hwb","hcg"],0,(Z=>(Z%360+360)%360)),saturationl:o("hsl",1,c(100)),lightness:o("hsl",2,c(100)),saturationv:o("hsv",1,c(100)),value:o("hsv",2,c(100)),chroma:o("hcg",1,c(100)),gray:o("hcg",2,c(100)),white:o("hwb",1,c(100)),wblack:o("hwb",2,c(100)),cyan:o("cmyk",0,c(100)),magenta:o("cmyk",1,c(100)),yellow:o("cmyk",2,c(100)),black:o("cmyk",3,c(100)),x:o("xyz",0,c(95.047)),y:o("xyz",1,c(100)),z:o("xyz",2,c(108.833)),l:o("lab",0,c(100)),a:o("lab",1),b:o("lab",2),keyword(Z){return void 0!==Z?new d(Z):G[this.model].keyword(this.color)},hex(Z){return void 0!==Z?new d(Z):u.to.hex(this.rgb().round().color)},hexa(Z){if(void 0!==Z)return new d(Z);const x=this.rgb().round().color;let F=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===F.length&&(F="0"+F),u.to.hex(x)+F},rgbNumber(){const Z=this.rgb().color;return(255&Z[0])<<16|(255&Z[1])<<8|255&Z[2]},luminosity(){const Z=this.rgb().color,x=[];for(const[F,u]of Z.entries()){const Z=u/255;x[F]=Z<=.04045?Z/12.92:((Z+.055)/1.055)**2.4}return.2126*x[0]+.7152*x[1]+.0722*x[2]},contrast(Z){const x=this.luminosity(),F=Z.luminosity();return x>F?(x+.05)/(F+.05):(F+.05)/(x+.05)},level(Z){const x=this.contrast(Z);return x>=7?"AAA":x>=4.5?"AA":""},isDark(){const Z=this.rgb().color;return(2126*Z[0]+7152*Z[1]+722*Z[2])/1e4<128},isLight(){return!this.isDark()},negate(){const Z=this.rgb();for(let x=0;x<3;x++)Z.color[x]=255-Z.color[x];return Z},lighten(Z){const x=this.hsl();return x.color[2]+=x.color[2]*Z,x},darken(Z){const x=this.hsl();return x.color[2]-=x.color[2]*Z,x},saturate(Z){const x=this.hsl();return x.color[1]+=x.color[1]*Z,x},desaturate(Z){const x=this.hsl();return x.color[1]-=x.color[1]*Z,x},whiten(Z){const x=this.hwb();return x.color[1]+=x.color[1]*Z,x},blacken(Z){const x=this.hwb();return x.color[2]+=x.color[2]*Z,x},grayscale(){const Z=this.rgb().color,x=.3*Z[0]+.59*Z[1]+.11*Z[2];return d.rgb(x,x,x)},fade(Z){return this.alpha(this.valpha-this.valpha*Z)},opaquer(Z){return this.alpha(this.valpha+this.valpha*Z)},rotate(Z){const x=this.hsl();let F=x.color[0];return F=(F+Z)%360,F=F<0?360+F:F,x.color[0]=F,x},mix(Z,x){if(!Z||!Z.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof Z);const F=Z.rgb(),u=this.rgb(),G=void 0===x?.5:x,f=2*G-1,Y=F.alpha()-u.alpha(),j=((f*Y===-1?f:(f+Y)/(1+f*Y))+1)/2,t=1-j;return d.rgb(j*F.red()+t*u.red(),j*F.green()+t*u.green(),j*F.blue()+t*u.blue(),F.alpha()*G+u.alpha()*(1-G))}};for(const J of Object.keys(G)){if(f.includes(J))continue;const{channels:Z}=G[J];d.prototype[J]=function(){if(this.model===J)return new d(this);for(var Z=arguments.length,x=new Array(Z),F=0;F<Z;F++)x[F]=arguments[F];return x.length>0?new d(x,J):new d([...(u=G[this.model][J].raw(this.color),Array.isArray(u)?u:[u]),this.valpha],J);var u},d[J]=function(){for(var x=arguments.length,F=new Array(x),u=0;u<x;u++)F[u]=arguments[u];let G=F[0];return"number"===typeof G&&(G=s(F,Z)),new d(G,J)}}function t(Z){return function(x){return function(Z,x){return Number(Z.toFixed(x))}(x,Z)}}function o(Z,x,F){Z=Array.isArray(Z)?Z:[Z];for(const u of Z)(j[u]||(j[u]=[]))[x]=F;return Z=Z[0],function(u){let G;return void 0!==u?(F&&(u=F(u)),G=this[Z](),G.color[x]=u,G):(G=this[Z]().color[x],F&&(G=F(G)),G)}}function c(Z){return function(x){return Math.max(0,Math.min(Z,x))}}function s(Z,x){for(let F=0;F<x;F++)"number"!==typeof Z[F]&&(Z[F]=0);return Z}Z.exports=d},13399:(Z,x,F)=>{const u=F(13404),G={};for(const Y of Object.keys(u))G[u[Y]]=Y;const f={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Z.exports=f;for(const Y of Object.keys(f)){if(!("channels"in f[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in f[Y]))throw new Error("missing channel labels property: "+Y);if(f[Y].labels.length!==f[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:Z,labels:x}=f[Y];delete f[Y].channels,delete f[Y].labels,Object.defineProperty(f[Y],"channels",{value:Z}),Object.defineProperty(f[Y],"labels",{value:x})}f.rgb.hsl=function(Z){const x=Z[0]/255,F=Z[1]/255,u=Z[2]/255,G=Math.min(x,F,u),f=Math.max(x,F,u),Y=f-G;let j,d;f===G?j=0:x===f?j=(F-u)/Y:F===f?j=2+(u-x)/Y:u===f&&(j=4+(x-F)/Y),j=Math.min(60*j,360),j<0&&(j+=360);const t=(G+f)/2;return d=f===G?0:t<=.5?Y/(f+G):Y/(2-f-G),[j,100*d,100*t]},f.rgb.hsv=function(Z){let x,F,u,G,f;const Y=Z[0]/255,j=Z[1]/255,d=Z[2]/255,t=Math.max(Y,j,d),o=t-Math.min(Y,j,d),c=function(Z){return(t-Z)/6/o+.5};return 0===o?(G=0,f=0):(f=o/t,x=c(Y),F=c(j),u=c(d),Y===t?G=u-F:j===t?G=1/3+x-u:d===t&&(G=2/3+F-x),G<0?G+=1:G>1&&(G-=1)),[360*G,100*f,100*t]},f.rgb.hwb=function(Z){const x=Z[0],F=Z[1];let u=Z[2];const G=f.rgb.hsl(Z)[0],Y=1/255*Math.min(x,Math.min(F,u));return u=1-1/255*Math.max(x,Math.max(F,u)),[G,100*Y,100*u]},f.rgb.cmyk=function(Z){const x=Z[0]/255,F=Z[1]/255,u=Z[2]/255,G=Math.min(1-x,1-F,1-u);return[100*((1-x-G)/(1-G)||0),100*((1-F-G)/(1-G)||0),100*((1-u-G)/(1-G)||0),100*G]},f.rgb.keyword=function(Z){const x=G[Z];if(x)return x;let F,f=1/0;for(const G of Object.keys(u)){const x=u[G],d=(j=x,((Y=Z)[0]-j[0])**2+(Y[1]-j[1])**2+(Y[2]-j[2])**2);d<f&&(f=d,F=G)}var Y,j;return F},f.keyword.rgb=function(Z){return u[Z]},f.rgb.xyz=function(Z){let x=Z[0]/255,F=Z[1]/255,u=Z[2]/255;x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,F=F>.04045?((F+.055)/1.055)**2.4:F/12.92,u=u>.04045?((u+.055)/1.055)**2.4:u/12.92;return[100*(.4124*x+.3576*F+.1805*u),100*(.2126*x+.7152*F+.0722*u),100*(.0193*x+.1192*F+.9505*u)]},f.rgb.lab=function(Z){const x=f.rgb.xyz(Z);let F=x[0],u=x[1],G=x[2];F/=95.047,u/=100,G/=108.883,F=F>.008856?F**(1/3):7.787*F+16/116,u=u>.008856?u**(1/3):7.787*u+16/116,G=G>.008856?G**(1/3):7.787*G+16/116;return[116*u-16,500*(F-u),200*(u-G)]},f.hsl.rgb=function(Z){const x=Z[0]/360,F=Z[1]/100,u=Z[2]/100;let G,f,Y;if(0===F)return Y=255*u,[Y,Y,Y];G=u<.5?u*(1+F):u+F-u*F;const j=2*u-G,d=[0,0,0];for(let t=0;t<3;t++)f=x+1/3*-(t-1),f<0&&f++,f>1&&f--,Y=6*f<1?j+6*(G-j)*f:2*f<1?G:3*f<2?j+(G-j)*(2/3-f)*6:j,d[t]=255*Y;return d},f.hsl.hsv=function(Z){const x=Z[0];let F=Z[1]/100,u=Z[2]/100,G=F;const f=Math.max(u,.01);u*=2,F*=u<=1?u:2-u,G*=f<=1?f:2-f;return[x,100*(0===u?2*G/(f+G):2*F/(u+F)),100*((u+F)/2)]},f.hsv.rgb=function(Z){const x=Z[0]/60,F=Z[1]/100;let u=Z[2]/100;const G=Math.floor(x)%6,f=x-Math.floor(x),Y=255*u*(1-F),j=255*u*(1-F*f),d=255*u*(1-F*(1-f));switch(u*=255,G){case 0:return[u,d,Y];case 1:return[j,u,Y];case 2:return[Y,u,d];case 3:return[Y,j,u];case 4:return[d,Y,u];case 5:return[u,Y,j]}},f.hsv.hsl=function(Z){const x=Z[0],F=Z[1]/100,u=Z[2]/100,G=Math.max(u,.01);let f,Y;Y=(2-F)*u;const j=(2-F)*G;return f=F*G,f/=j<=1?j:2-j,f=f||0,Y/=2,[x,100*f,100*Y]},f.hwb.rgb=function(Z){const x=Z[0]/360;let F=Z[1]/100,u=Z[2]/100;const G=F+u;let f;G>1&&(F/=G,u/=G);const Y=Math.floor(6*x),j=1-u;f=6*x-Y,0!==(1&Y)&&(f=1-f);const d=F+f*(j-F);let t,o,c;switch(Y){default:case 6:case 0:t=j,o=d,c=F;break;case 1:t=d,o=j,c=F;break;case 2:t=F,o=j,c=d;break;case 3:t=F,o=d,c=j;break;case 4:t=d,o=F,c=j;break;case 5:t=j,o=F,c=d}return[255*t,255*o,255*c]},f.cmyk.rgb=function(Z){const x=Z[0]/100,F=Z[1]/100,u=Z[2]/100,G=Z[3]/100;return[255*(1-Math.min(1,x*(1-G)+G)),255*(1-Math.min(1,F*(1-G)+G)),255*(1-Math.min(1,u*(1-G)+G))]},f.xyz.rgb=function(Z){const x=Z[0]/100,F=Z[1]/100,u=Z[2]/100;let G,f,Y;return G=3.2406*x+-1.5372*F+-.4986*u,f=-.9689*x+1.8758*F+.0415*u,Y=.0557*x+-.204*F+1.057*u,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,G=Math.min(Math.max(0,G),1),f=Math.min(Math.max(0,f),1),Y=Math.min(Math.max(0,Y),1),[255*G,255*f,255*Y]},f.xyz.lab=function(Z){let x=Z[0],F=Z[1],u=Z[2];x/=95.047,F/=100,u/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,F=F>.008856?F**(1/3):7.787*F+16/116,u=u>.008856?u**(1/3):7.787*u+16/116;return[116*F-16,500*(x-F),200*(F-u)]},f.lab.xyz=function(Z){let x,F,u;F=(Z[0]+16)/116,x=Z[1]/500+F,u=F-Z[2]/200;const G=F**3,f=x**3,Y=u**3;return F=G>.008856?G:(F-16/116)/7.787,x=f>.008856?f:(x-16/116)/7.787,u=Y>.008856?Y:(u-16/116)/7.787,x*=95.047,F*=100,u*=108.883,[x,F,u]},f.lab.lch=function(Z){const x=Z[0],F=Z[1],u=Z[2];let G;G=360*Math.atan2(u,F)/2/Math.PI,G<0&&(G+=360);return[x,Math.sqrt(F*F+u*u),G]},f.lch.lab=function(Z){const x=Z[0],F=Z[1],u=Z[2]/360*2*Math.PI;return[x,F*Math.cos(u),F*Math.sin(u)]},f.rgb.ansi16=function(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[F,u,G]=Z;let Y=null===x?f.rgb.hsv(Z)[2]:x;if(Y=Math.round(Y/50),0===Y)return 30;let j=30+(Math.round(G/255)<<2|Math.round(u/255)<<1|Math.round(F/255));return 2===Y&&(j+=60),j},f.hsv.ansi16=function(Z){return f.rgb.ansi16(f.hsv.rgb(Z),Z[2])},f.rgb.ansi256=function(Z){const x=Z[0],F=Z[1],u=Z[2];if(x===F&&F===u)return x<8?16:x>248?231:Math.round((x-8)/247*24)+232;return 16+36*Math.round(x/255*5)+6*Math.round(F/255*5)+Math.round(u/255*5)},f.ansi16.rgb=function(Z){let x=Z%10;if(0===x||7===x)return Z>50&&(x+=3.5),x=x/10.5*255,[x,x,x];const F=.5*(1+~~(Z>50));return[(1&x)*F*255,(x>>1&1)*F*255,(x>>2&1)*F*255]},f.ansi256.rgb=function(Z){if(Z>=232){const x=10*(Z-232)+8;return[x,x,x]}let x;Z-=16;return[Math.floor(Z/36)/5*255,Math.floor((x=Z%36)/6)/5*255,x%6/5*255]},f.rgb.hex=function(Z){const x=(((255&Math.round(Z[0]))<<16)+((255&Math.round(Z[1]))<<8)+(255&Math.round(Z[2]))).toString(16).toUpperCase();return"000000".substring(x.length)+x},f.hex.rgb=function(Z){const x=Z.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!x)return[0,0,0];let F=x[0];3===x[0].length&&(F=F.split("").map((Z=>Z+Z)).join(""));const u=parseInt(F,16);return[u>>16&255,u>>8&255,255&u]},f.rgb.hcg=function(Z){const x=Z[0]/255,F=Z[1]/255,u=Z[2]/255,G=Math.max(Math.max(x,F),u),f=Math.min(Math.min(x,F),u),Y=G-f;let j,d;return j=Y<1?f/(1-Y):0,d=Y<=0?0:G===x?(F-u)/Y%6:G===F?2+(u-x)/Y:4+(x-F)/Y,d/=6,d%=1,[360*d,100*Y,100*j]},f.hsl.hcg=function(Z){const x=Z[1]/100,F=Z[2]/100,u=F<.5?2*x*F:2*x*(1-F);let G=0;return u<1&&(G=(F-.5*u)/(1-u)),[Z[0],100*u,100*G]},f.hsv.hcg=function(Z){const x=Z[1]/100,F=Z[2]/100,u=x*F;let G=0;return u<1&&(G=(F-u)/(1-u)),[Z[0],100*u,100*G]},f.hcg.rgb=function(Z){const x=Z[0]/360,F=Z[1]/100,u=Z[2]/100;if(0===F)return[255*u,255*u,255*u];const G=[0,0,0],f=x%1*6,Y=f%1,j=1-Y;let d=0;switch(Math.floor(f)){case 0:G[0]=1,G[1]=Y,G[2]=0;break;case 1:G[0]=j,G[1]=1,G[2]=0;break;case 2:G[0]=0,G[1]=1,G[2]=Y;break;case 3:G[0]=0,G[1]=j,G[2]=1;break;case 4:G[0]=Y,G[1]=0,G[2]=1;break;default:G[0]=1,G[1]=0,G[2]=j}return d=(1-F)*u,[255*(F*G[0]+d),255*(F*G[1]+d),255*(F*G[2]+d)]},f.hcg.hsv=function(Z){const x=Z[1]/100,F=x+Z[2]/100*(1-x);let u=0;return F>0&&(u=x/F),[Z[0],100*u,100*F]},f.hcg.hsl=function(Z){const x=Z[1]/100,F=Z[2]/100*(1-x)+.5*x;let u=0;return F>0&&F<.5?u=x/(2*F):F>=.5&&F<1&&(u=x/(2*(1-F))),[Z[0],100*u,100*F]},f.hcg.hwb=function(Z){const x=Z[1]/100,F=x+Z[2]/100*(1-x);return[Z[0],100*(F-x),100*(1-F)]},f.hwb.hcg=function(Z){const x=Z[1]/100,F=1-Z[2]/100,u=F-x;let G=0;return u<1&&(G=(F-u)/(1-u)),[Z[0],100*u,100*G]},f.apple.rgb=function(Z){return[Z[0]/65535*255,Z[1]/65535*255,Z[2]/65535*255]},f.rgb.apple=function(Z){return[Z[0]/255*65535,Z[1]/255*65535,Z[2]/255*65535]},f.gray.rgb=function(Z){return[Z[0]/100*255,Z[0]/100*255,Z[0]/100*255]},f.gray.hsl=function(Z){return[0,0,Z[0]]},f.gray.hsv=f.gray.hsl,f.gray.hwb=function(Z){return[0,100,Z[0]]},f.gray.cmyk=function(Z){return[0,0,0,Z[0]]},f.gray.lab=function(Z){return[Z[0],0,0]},f.gray.hex=function(Z){const x=255&Math.round(Z[0]/100*255),F=((x<<16)+(x<<8)+x).toString(16).toUpperCase();return"000000".substring(F.length)+F},f.rgb.gray=function(Z){return[(Z[0]+Z[1]+Z[2])/3/255*100]}},13394:(Z,x,F)=>{const u=F(13399),G=F(13410),f={};Object.keys(u).forEach((Z=>{f[Z]={},Object.defineProperty(f[Z],"channels",{value:u[Z].channels}),Object.defineProperty(f[Z],"labels",{value:u[Z].labels});const x=G(Z);Object.keys(x).forEach((F=>{const u=x[F];f[Z][F]=function(Z){const x=function(){for(var x=arguments.length,F=new Array(x),u=0;u<x;u++)F[u]=arguments[u];const G=F[0];if(void 0===G||null===G)return G;G.length>1&&(F=G);const f=Z(F);if("object"===typeof f)for(let Z=f.length,Y=0;Y<Z;Y++)f[Y]=Math.round(f[Y]);return f};return"conversion"in Z&&(x.conversion=Z.conversion),x}(u),f[Z][F].raw=function(Z){const x=function(){for(var x=arguments.length,F=new Array(x),u=0;u<x;u++)F[u]=arguments[u];const G=F[0];return void 0===G||null===G?G:(G.length>1&&(F=G),Z(F))};return"conversion"in Z&&(x.conversion=Z.conversion),x}(u)}))})),Z.exports=f},13410:(Z,x,F)=>{const u=F(13399);function G(Z){const x=function(){const Z={},x=Object.keys(u);for(let F=x.length,u=0;u<F;u++)Z[x[u]]={distance:-1,parent:null};return Z}(),F=[Z];for(x[Z].distance=0;F.length;){const Z=F.pop(),G=Object.keys(u[Z]);for(let u=G.length,f=0;f<u;f++){const u=G[f],Y=x[u];-1===Y.distance&&(Y.distance=x[Z].distance+1,Y.parent=Z,F.unshift(u))}}return x}function f(Z,x){return function(F){return x(Z(F))}}function Y(Z,x){const F=[x[Z].parent,Z];let G=u[x[Z].parent][Z],Y=x[Z].parent;for(;x[Y].parent;)F.unshift(x[Y].parent),G=f(u[x[Y].parent][Y],G),Y=x[Y].parent;return G.conversion=F,G}Z.exports=function(Z){const x=G(Z),F={},u=Object.keys(x);for(let G=u.length,f=0;f<G;f++){const Z=u[f];null!==x[Z].parent&&(F[Z]=Y(Z,x))}return F}},13404:Z=>{"use strict";Z.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11917:function(Z,x,F){"use strict";var u=this&&this.__createBinding||(Object.create?function(Z,x,F,u){void 0===u&&(u=F);var G=Object.getOwnPropertyDescriptor(x,F);G&&!("get"in G?!x.__esModule:G.writable||G.configurable)||(G={enumerable:!0,get:function(){return x[F]}}),Object.defineProperty(Z,u,G)}:function(Z,x,F,u){void 0===u&&(u=F),Z[u]=x[F]}),G=this&&this.__setModuleDefault||(Object.create?function(Z,x){Object.defineProperty(Z,"default",{enumerable:!0,value:x})}:function(Z,x){Z.default=x}),f=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var x={};if(null!=Z)for(var F in Z)"default"!==F&&Object.prototype.hasOwnProperty.call(Z,F)&&u(x,Z,F);return G(x,Z),x},Y=this&&this.__awaiter||function(Z,x,F,u){return new(F||(F=Promise))((function(G,f){function Y(Z){try{d(u.next(Z))}catch(x){f(x)}}function j(Z){try{d(u.throw(Z))}catch(x){f(x)}}function d(Z){var x;Z.done?G(Z.value):(x=Z.value,x instanceof F?x:new F((function(Z){Z(x)}))).then(Y,j)}d((u=u.apply(Z,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Auth=x.Platform=void 0;const j=f(F(11847)),d=F(11923),t="colyseus-auth-token";!function(Z){Z.ios="ios",Z.android="android"}(x.Platform||(x.Platform={}));x.Auth=class{constructor(Z){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=Z.replace("ws","http"),(0,d.getItem)(t,(Z=>this.token=Z))}get hasToken(){return!!this.token}login(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Y(this,void 0,void 0,(function*(){const x=Object.assign({},Z);this.hasToken&&(x.token=this.token);const F=yield this.request("post","/auth",x);this.token=F.token,(0,d.setItem)(t,this.token);for(let Z in F)this.hasOwnProperty(Z)&&(this[Z]=F[Z]);return this.registerPingService(),this}))}save(){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return Y(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(Z){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:Z})}))}acceptFriendRequest(Z){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:Z})}))}declineFriendRequest(Z){return Y(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:Z})}))}blockUser(Z){return Y(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:Z})}))}unblockUser(Z){return Y(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:Z})}))}request(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Y(this,void 0,void 0,(function*(){G.Accept="application/json",this.hasToken&&(G.Authorization="Bearer "+this.token);const f=[];for(const Z in F)f.push(`${Z}=${F[Z]}`);const Y=f.length>0?`?${f.join("&")}`:"",d={headers:G};return u&&(d.body=u),(yield j[Z](`${this.endpoint}${x}${Y}`,d)).data}))}logout(){this.token=void 0,(0,d.removeItem)(t),this.unregisterPingService()}registerPingService(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),Z)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11838:function(Z,x,F){"use strict";var u,G=this&&this.__awaiter||function(Z,x,F,u){return new(F||(F=Promise))((function(G,f){function Y(Z){try{d(u.next(Z))}catch(x){f(x)}}function j(Z){try{d(u.throw(Z))}catch(x){f(x)}}function d(Z){var x;Z.done?G(Z.value):(x=Z.value,x instanceof F?x:new F((function(Z){Z(x)}))).then(Y,j)}d((u=u.apply(Z,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Client=x.MatchMakeError=void 0;const f=F(11847),Y=F(11856),j=F(11864);class d extends Error{constructor(Z,x){super(Z),this.code=x,Object.setPrototypeOf(this,d.prototype)}}x.MatchMakeError=d;const t="undefined"!==typeof window&&"undefined"!==typeof(null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";x.Client=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;if("string"===typeof Z){const x=new URL(Z),F="https:"===x.protocol||"wss:"===x.protocol,u=Number(x.port||(F?443:80));this.settings={hostname:x.hostname,pathname:"/"!==x.pathname?x.pathname:"",port:u,secure:F}}else void 0===Z.port&&(Z.port=Z.secure?443:80),void 0===Z.pathname&&(Z.pathname=""),this.settings=Z}joinOrCreate(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",Z,x,F)}))}create(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",Z,x,F)}))}join(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",Z,x,F)}))}joinById(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",Z,x,F)}))}reconnect(Z,x){return G(this,void 0,void 0,(function*(){if("string"===typeof Z&&"string"===typeof x)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[F,u]=Z.split(":");return yield this.createMatchMakeRequest("reconnect",F,{reconnectionToken:u},x)}))}getAvailableRooms(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return G(this,void 0,void 0,(function*(){return(yield(0,f.get)(this.getHttpEndpoint(`${Z}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(Z,x,F){return G(this,void 0,void 0,(function*(){const u=this.createRoom(Z.room.name,x);u.roomId=Z.room.roomId,u.sessionId=Z.sessionId;const f={sessionId:u.sessionId};Z.reconnectionToken&&(f.reconnectionToken=Z.reconnectionToken);const j=F||u;return u.connect(this.buildEndpoint(Z.room,f),Z.devMode&&(()=>G(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${u.roomId}'...`);let F=0;const f=()=>G(this,void 0,void 0,(function*(){F++;try{yield this.consumeSeatReservation(Z,x,j),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${u.roomId}'`)}catch(G){F<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${F} out of 8)`),setTimeout(f,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(f,2e3)}))),j),new Promise(((Z,x)=>{const F=(Z,F)=>x(new Y.ServerError(Z,F));j.onError.once(F),j.onJoin.once((()=>{j.onError.remove(F),Z(j)}))}))}))}createMatchMakeRequest(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0,Y=arguments.length>4?arguments[4]:void 0;return G(this,void 0,void 0,(function*(){const G=(yield(0,f.post)(this.getHttpEndpoint(`${Z}/${x}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(F)})).data;if(G.error)throw new d(G.error,G.code);return"reconnect"===Z&&(G.reconnectionToken=F.reconnectionToken),yield this.consumeSeatReservation(G,u,Y)}))}createRoom(Z,x){return new j.Room(Z,x)}buildEndpoint(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=[];for(const G in x)x.hasOwnProperty(G)&&F.push(`${G}=${x[G]}`);let u=this.settings.secure?"wss://":"ws://";return Z.publicAddress?u+=`${Z.publicAddress}`:u+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${u}/${Z.processId}/${Z.roomId}?${F.join("&")}`}getHttpEndpoint(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${Z}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11874:(Z,x,F)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.Connection=void 0;const u=F(11881);x.Connection=class{constructor(){this.events={},this.transport=new u.WebSocketTransport(this.events)}send(Z){this.transport.send(Z)}connect(Z){this.transport.connect(Z)}close(Z,x){this.transport.close(Z,x)}get isOpen(){return this.transport.isOpen}}},11891:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.utf8Length=x.utf8Read=x.ErrorCode=x.Protocol=void 0,function(Z){Z[Z.HANDSHAKE=9]="HANDSHAKE",Z[Z.JOIN_ROOM=10]="JOIN_ROOM",Z[Z.ERROR=11]="ERROR",Z[Z.LEAVE_ROOM=12]="LEAVE_ROOM",Z[Z.ROOM_DATA=13]="ROOM_DATA",Z[Z.ROOM_STATE=14]="ROOM_STATE",Z[Z.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",Z[Z.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",Z[Z.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(x.Protocol||(x.Protocol={})),function(Z){Z[Z.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",Z[Z.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",Z[Z.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",Z[Z.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",Z[Z.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",Z[Z.AUTH_FAILED=4215]="AUTH_FAILED",Z[Z.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(x.ErrorCode||(x.ErrorCode={})),x.utf8Read=function(Z,x){const F=Z[x++];for(var u="",G=0,f=x,Y=x+F;f<Y;f++){var j=Z[f];if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(G=(7&j)<<18|(63&Z[++f])<<12|(63&Z[++f])<<6|63&Z[++f])>=65536?(G-=65536,u+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):u+=String.fromCharCode(G)}else u+=String.fromCharCode((15&j)<<12|(63&Z[++f])<<6|63&Z[++f]);else u+=String.fromCharCode((31&j)<<6|63&Z[++f]);else u+=String.fromCharCode(j)}return u},x.utf8Length=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",x=0,F=0;for(let u=0,G=Z.length;u<G;u++)x=Z.charCodeAt(u),x<128?F+=1:x<2048?F+=2:x<55296||x>=57344?F+=3:(u++,F+=4);return F+1}},11864:function(Z,x,F){"use strict";var u=this&&this.__createBinding||(Object.create?function(Z,x,F,u){void 0===u&&(u=F);var G=Object.getOwnPropertyDescriptor(x,F);G&&!("get"in G?!x.__esModule:G.writable||G.configurable)||(G={enumerable:!0,get:function(){return x[F]}}),Object.defineProperty(Z,u,G)}:function(Z,x,F,u){void 0===u&&(u=F),Z[u]=x[F]}),G=this&&this.__setModuleDefault||(Object.create?function(Z,x){Object.defineProperty(Z,"default",{enumerable:!0,value:x})}:function(Z,x){Z.default=x}),f=this&&this.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var x={};if(null!=Z)for(var F in Z)"default"!==F&&Object.prototype.hasOwnProperty.call(Z,F)&&u(x,Z,F);return G(x,Z),x};Object.defineProperty(x,"__esModule",{value:!0}),x.Room=void 0;const Y=f(F(11869)),j=F(11874),d=F(11891),t=F(11900),o=F(11904),c=F(11910),s=F(11913),J=F(11856);class p{constructor(Z,x){this.onStateChange=(0,c.createSignal)(),this.onError=(0,c.createSignal)(),this.onLeave=(0,c.createSignal)(),this.onJoin=(0,c.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,o.createNanoEvents)(),this.roomId=null,this.name=Z,x&&(this.serializer=new((0,t.getSerializer)("schema")),this.rootSchema=x,this.serializer.state=new x),this.onError(((Z,x)=>{var F;return null===(F=console.warn)||void 0===F?void 0:F.call(console,`colyseus.js - onError => (${Z}) ${x}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const u=new j.Connection;F.connection=u,u.events.onmessage=p.prototype.onMessageCallback.bind(F),u.events.onclose=function(Z){var u;if(!F.hasJoined)return null===(u=console.warn)||void 0===u||u.call(console,`Room connection was closed unexpectedly (${Z.code}): ${Z.reason}`),void F.onError.invoke(Z.code,Z.reason);Z.code===J.CloseCode.DEVMODE_RESTART&&x?x():(F.onLeave.invoke(Z.code),F.destroy())},u.events.onerror=function(Z){var x;null===(x=console.warn)||void 0===x||x.call(console,`Room, onError (${Z.code}): ${Z.reason}`),F.onError.invoke(Z.code,Z.reason)},u.connect(Z)}leave(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((x=>{this.onLeave((Z=>x(Z))),this.connection?Z?this.connection.send([d.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(J.CloseCode.CONSENTED)}))}onMessage(Z,x){return this.onMessageHandlers.on(this.getMessageHandlerKey(Z),x)}send(Z,x){const F=[d.Protocol.ROOM_DATA];let u;if("string"===typeof Z?s.encode.string(F,Z):s.encode.number(F,Z),void 0!==x){const Z=Y.encode(x);u=new Uint8Array(F.length+Z.byteLength),u.set(new Uint8Array(F),0),u.set(new Uint8Array(Z),F.length)}else u=new Uint8Array(F);this.connection.send(u.buffer)}sendBytes(Z,x){const F=[d.Protocol.ROOM_DATA_BYTES];let u;"string"===typeof Z?s.encode.string(F,Z):s.encode.number(F,Z),u=new Uint8Array(F.length+(x.byteLength||x.length)),u.set(new Uint8Array(F),0),u.set(new Uint8Array(x),F.length),this.connection.send(u.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(Z){const x=Array.from(new Uint8Array(Z.data)),F=x[0];if(F===d.Protocol.JOIN_ROOM){let Z=1;const F=(0,d.utf8Read)(x,Z);if(Z+=(0,d.utf8Length)(F),this.serializerId=(0,d.utf8Read)(x,Z),Z+=(0,d.utf8Length)(this.serializerId),!this.serializer){const Z=(0,t.getSerializer)(this.serializerId);this.serializer=new Z}x.length>Z&&this.serializer.handshake&&this.serializer.handshake(x,{offset:Z}),this.reconnectionToken=`${this.roomId}:${F}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([d.Protocol.JOIN_ROOM])}else if(F===d.Protocol.ERROR){const Z={offset:1},F=s.decode.number(x,Z),u=s.decode.string(x,Z);this.onError.invoke(F,u)}else if(F===d.Protocol.LEAVE_ROOM)this.leave();else if(F===d.Protocol.ROOM_DATA_SCHEMA){const Z={offset:1},F=this.serializer.getState().constructor._context.get(s.decode.number(x,Z)),u=new F;u.decode(x,Z),this.dispatchMessage(F,u)}else if(F===d.Protocol.ROOM_STATE)x.shift(),this.setState(x);else if(F===d.Protocol.ROOM_STATE_PATCH)x.shift(),this.patch(x);else if(F===d.Protocol.ROOM_DATA){const F={offset:1},u=s.decode.stringCheck(x,F)?s.decode.string(x,F):s.decode.number(x,F),G=x.length>F.offset?Y.decode(Z.data,F.offset):void 0;this.dispatchMessage(u,G)}else if(F===d.Protocol.ROOM_DATA_BYTES){const Z={offset:1},F=s.decode.stringCheck(x,Z)?s.decode.string(x,Z):s.decode.number(x,Z);this.dispatchMessage(F,new Uint8Array(x.slice(Z.offset)))}}setState(Z){this.serializer.setState(Z),this.onStateChange.invoke(this.serializer.getState())}patch(Z){this.serializer.patch(Z),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(Z,x){var F;const u=this.getMessageHandlerKey(Z);this.onMessageHandlers.events[u]?this.onMessageHandlers.emit(u,x):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",Z,x):null===(F=console.warn)||void 0===F||F.call(console,`colyseus.js: onMessage() not registered for type '${Z}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(Z){switch(typeof Z){case"function":return`$${Z._typeid}`;case"string":return Z;case"number":return`i${Z}`;default:throw new Error("invalid message type.")}}}x.Room=p},11923:(Z,x)=>{"use strict";let F;function u(){return F||(F="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(Z,x){this.cache[Z]=x},getItem:function(Z){this.cache[Z]},removeItem:function(Z){delete this.cache[Z]}}),F}Object.defineProperty(x,"__esModule",{value:!0}),x.getItem=x.removeItem=x.setItem=void 0,x.setItem=function(Z,x){u().setItem(Z,x)},x.removeItem=function(Z){u().removeItem(Z)},x.getItem=function(Z,x){const F=u().getItem(Z);"undefined"!==typeof Promise&&F instanceof Promise?F.then((Z=>x(Z))):x(F)}},11904:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createNanoEvents=void 0;x.createNanoEvents=()=>({emit(Z){let x=this.events[Z]||[];for(var F=arguments.length,u=new Array(F>1?F-1:0),G=1;G<F;G++)u[G-1]=arguments[G];for(let f=0,Y=x.length;f<Y;f++)x[f](...u)},events:{},on(Z,x){var F;return(null===(F=this.events[Z])||void 0===F?void 0:F.push(x))||(this.events[Z]=[x]),()=>{var F;this.events[Z]=null===(F=this.events[Z])||void 0===F?void 0:F.filter((Z=>x!==Z))}}})},11910:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createSignal=x.EventEmitter=void 0;class F{constructor(){this.handlers=[]}register(Z){return this.handlers.push(Z),this}invoke(){for(var Z=arguments.length,x=new Array(Z),F=0;F<Z;F++)x[F]=arguments[F];this.handlers.forEach((Z=>Z.apply(this,x)))}invokeAsync(){for(var Z=arguments.length,x=new Array(Z),F=0;F<Z;F++)x[F]=arguments[F];return Promise.all(this.handlers.map((Z=>Z.apply(this,x))))}remove(Z){const x=this.handlers.indexOf(Z);this.handlers[x]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}x.EventEmitter=F,x.createSignal=function(){const Z=new F;function x(x){return Z.register(x,null===this)}return x.once=x=>{const F=function(){for(var u=arguments.length,G=new Array(u),f=0;f<u;f++)G[f]=arguments[f];x.apply(this,G),Z.remove(F)};Z.register(F)},x.remove=x=>Z.remove(x),x.invoke=function(){return Z.invoke(...arguments)},x.invokeAsync=function(){return Z.invokeAsync(...arguments)},x.clear=()=>Z.clear(),x}},11856:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.ServerError=x.CloseCode=void 0,function(Z){Z[Z.CONSENTED=4e3]="CONSENTED",Z[Z.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(x.CloseCode||(x.CloseCode={}));class F extends Error{constructor(Z,x){super(x),this.name="ServerError",this.code=Z}}x.ServerError=F},11824:(Z,x,F)=>{"use strict";x.c=void 0,F(11829);var u=F(11838);Object.defineProperty(x,"c",{enumerable:!0,get:function(){return u.Client}});var G=F(11891);var f=F(11864);var Y=F(11917);const j=F(11932);const d=F(11940),t=F(11900);(0,t.registerSerializer)("schema",j.SchemaSerializer),(0,t.registerSerializer)("none",d.NoneSerializer)},11829:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=Z=>null!==Z&&"object"===typeof Z&&Z.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11869:(Z,x)=>{"use strict";function F(Z,x){if(this._offset=x,Z instanceof ArrayBuffer)this._buffer=Z,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(Z))throw new Error("Invalid argument");this._buffer=Z.buffer,this._view=new DataView(this._buffer,Z.byteOffset,Z.byteLength)}}Object.defineProperty(x,"__esModule",{value:!0}),x.decode=x.encode=void 0,F.prototype._array=function(Z){for(var x=new Array(Z),F=0;F<Z;F++)x[F]=this._parse();return x},F.prototype._map=function(Z){for(var x={},F=0;F<Z;F++)x[this._parse()]=this._parse();return x},F.prototype._str=function(Z){var x=function(Z,x,F){for(var u="",G=0,f=x,Y=x+F;f<Y;f++){var j=Z.getUint8(f);if(0!==(128&j))if(192!==(224&j))if(224!==(240&j)){if(240!==(248&j))throw new Error("Invalid byte "+j.toString(16));(G=(7&j)<<18|(63&Z.getUint8(++f))<<12|(63&Z.getUint8(++f))<<6|63&Z.getUint8(++f))>=65536?(G-=65536,u+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):u+=String.fromCharCode(G)}else u+=String.fromCharCode((15&j)<<12|(63&Z.getUint8(++f))<<6|63&Z.getUint8(++f));else u+=String.fromCharCode((31&j)<<6|63&Z.getUint8(++f));else u+=String.fromCharCode(j)}return u}(this._view,this._offset,Z);return this._offset+=Z,x},F.prototype._bin=function(Z){var x=this._buffer.slice(this._offset,this._offset+Z);return this._offset+=Z,x},F.prototype._parse=function(){var Z,x=this._view.getUint8(this._offset++),F=0,u=0,G=0,f=0;if(x<192)return x<128?x:x<144?this._map(15&x):x<160?this._array(15&x):this._str(31&x);if(x>223)return-1*(255-x+1);switch(x){case 192:return null;case 194:return!1;case 195:return!0;case 196:return F=this._view.getUint8(this._offset),this._offset+=1,this._bin(F);case 197:return F=this._view.getUint16(this._offset),this._offset+=2,this._bin(F);case 198:return F=this._view.getUint32(this._offset),this._offset+=4,this._bin(F);case 199:if(F=this._view.getUint8(this._offset),u=this._view.getInt8(this._offset+1),this._offset+=2,-1===u){var Y=this._view.getUint32(this._offset);return G=this._view.getInt32(this._offset+4),f=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*G+f)+Y/1e6)}return[u,this._bin(F)];case 200:return F=this._view.getUint16(this._offset),u=this._view.getInt8(this._offset+2),this._offset+=3,[u,this._bin(F)];case 201:return F=this._view.getUint32(this._offset),u=this._view.getInt8(this._offset+4),this._offset+=5,[u,this._bin(F)];case 202:return Z=this._view.getFloat32(this._offset),this._offset+=4,Z;case 203:return Z=this._view.getFloat64(this._offset),this._offset+=8,Z;case 204:return Z=this._view.getUint8(this._offset),this._offset+=1,Z;case 205:return Z=this._view.getUint16(this._offset),this._offset+=2,Z;case 206:return Z=this._view.getUint32(this._offset),this._offset+=4,Z;case 207:return G=this._view.getUint32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,G+f;case 208:return Z=this._view.getInt8(this._offset),this._offset+=1,Z;case 209:return Z=this._view.getInt16(this._offset),this._offset+=2,Z;case 210:return Z=this._view.getInt32(this._offset),this._offset+=4,Z;case 211:return G=this._view.getInt32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,G+f;case 212:return u=this._view.getInt8(this._offset),this._offset+=1,0===u?void(this._offset+=1):[u,this._bin(1)];case 213:return u=this._view.getInt8(this._offset),this._offset+=1,[u,this._bin(2)];case 214:return u=this._view.getInt8(this._offset),this._offset+=1,-1===u?(Z=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*Z)):[u,this._bin(4)];case 215:return u=this._view.getInt8(this._offset),this._offset+=1,0===u?(G=this._view.getInt32(this._offset)*Math.pow(2,32),f=this._view.getUint32(this._offset+4),this._offset+=8,new Date(G+f)):-1===u?(G=this._view.getUint32(this._offset),f=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&G)+f)+(G>>>2)/1e6)):[u,this._bin(8)];case 216:return u=this._view.getInt8(this._offset),this._offset+=1,[u,this._bin(16)];case 217:return F=this._view.getUint8(this._offset),this._offset+=1,this._str(F);case 218:return F=this._view.getUint16(this._offset),this._offset+=2,this._str(F);case 219:return F=this._view.getUint32(this._offset),this._offset+=4,this._str(F);case 220:return F=this._view.getUint16(this._offset),this._offset+=2,this._array(F);case 221:return F=this._view.getUint32(this._offset),this._offset+=4,this._array(F);case 222:return F=this._view.getUint16(this._offset),this._offset+=2,this._map(F);case 223:return F=this._view.getUint32(this._offset),this._offset+=4,this._map(F)}throw new Error("Could not parse")},x.decode=function(Z){var x=new F(Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),u=x._parse();if(x._offset!==Z.byteLength)throw new Error(Z.byteLength-x._offset+" trailing bytes");return u};function u(Z,x,F){for(var u=0,G=0,f=F.length;G<f;G++)(u=F.charCodeAt(G))<128?Z.setUint8(x++,u):u<2048?(Z.setUint8(x++,192|u>>6),Z.setUint8(x++,128|63&u)):u<55296||u>=57344?(Z.setUint8(x++,224|u>>12),Z.setUint8(x++,128|u>>6&63),Z.setUint8(x++,128|63&u)):(G++,u=65536+((1023&u)<<10|1023&F.charCodeAt(G)),Z.setUint8(x++,240|u>>18),Z.setUint8(x++,128|u>>12&63),Z.setUint8(x++,128|u>>6&63),Z.setUint8(x++,128|63&u))}function G(Z,x,F){var u=typeof F,f=0,Y=0,j=0,d=0,t=0,o=0;if("string"===u){if(t=function(Z){for(var x=0,F=0,u=0,G=Z.length;u<G;u++)(x=Z.charCodeAt(u))<128?F+=1:x<2048?F+=2:x<55296||x>=57344?F+=3:(u++,F+=4);return F}(F),t<32)Z.push(160|t),o=1;else if(t<256)Z.push(217,t),o=2;else if(t<65536)Z.push(218,t>>8,t),o=3;else{if(!(t<4294967296))throw new Error("String too long");Z.push(219,t>>24,t>>16,t>>8,t),o=5}return x.push({_str:F,_length:t,_offset:Z.length}),o+t}if("number"===u)return Math.floor(F)===F&&isFinite(F)?F>=0?F<128?(Z.push(F),1):F<256?(Z.push(204,F),2):F<65536?(Z.push(205,F>>8,F),3):F<4294967296?(Z.push(206,F>>24,F>>16,F>>8,F),5):(j=F/Math.pow(2,32)|0,d=F>>>0,Z.push(207,j>>24,j>>16,j>>8,j,d>>24,d>>16,d>>8,d),9):F>=-32?(Z.push(F),1):F>=-128?(Z.push(208,F),2):F>=-32768?(Z.push(209,F>>8,F),3):F>=-2147483648?(Z.push(210,F>>24,F>>16,F>>8,F),5):(j=Math.floor(F/Math.pow(2,32)),d=F>>>0,Z.push(211,j>>24,j>>16,j>>8,j,d>>24,d>>16,d>>8,d),9):(Z.push(203),x.push({_float:F,_length:8,_offset:Z.length}),9);if("object"===u){if(null===F)return Z.push(192),1;if(Array.isArray(F)){if((t=F.length)<16)Z.push(144|t),o=1;else if(t<65536)Z.push(220,t>>8,t),o=3;else{if(!(t<4294967296))throw new Error("Array too large");Z.push(221,t>>24,t>>16,t>>8,t),o=5}for(f=0;f<t;f++)o+=G(Z,x,F[f]);return o}if(F instanceof Date){var c=F.getTime(),s=Math.floor(c/1e3),J=1e6*(c-1e3*s);return s>=0&&J>=0&&s<=17179869183?0===J&&s<=4294967295?(Z.push(214,255,s>>24,s>>16,s>>8,s),6):(j=s/4294967296,d=4294967295&s,Z.push(215,255,J>>22,J>>14,J>>6,j,d>>24,d>>16,d>>8,d),10):(j=Math.floor(s/4294967296),d=s>>>0,Z.push(199,12,255,J>>24,J>>16,J>>8,J,j>>24,j>>16,j>>8,j,d>>24,d>>16,d>>8,d),15)}if(F instanceof ArrayBuffer){if((t=F.byteLength)<256)Z.push(196,t),o=2;else if(t<65536)Z.push(197,t>>8,t),o=3;else{if(!(t<4294967296))throw new Error("Buffer too large");Z.push(198,t>>24,t>>16,t>>8,t),o=5}return x.push({_bin:F,_length:t,_offset:Z.length}),o+t}if("function"===typeof F.toJSON)return G(Z,x,F.toJSON());var p=[],U="",k=Object.keys(F);for(f=0,Y=k.length;f<Y;f++)void 0!==F[U=k[f]]&&"function"!==typeof F[U]&&p.push(U);if((t=p.length)<16)Z.push(128|t),o=1;else if(t<65536)Z.push(222,t>>8,t),o=3;else{if(!(t<4294967296))throw new Error("Object too large");Z.push(223,t>>24,t>>16,t>>8,t),o=5}for(f=0;f<t;f++)o+=G(Z,x,U=p[f]),o+=G(Z,x,F[U]);return o}if("boolean"===u)return Z.push(F?195:194),1;if("undefined"===u)return Z.push(192),1;if("function"===typeof F.toJSON)return G(Z,x,F.toJSON());throw new Error("Could not encode")}x.encode=function(Z){var x=[],F=[],f=G(x,F,Z),Y=new ArrayBuffer(f),j=new DataView(Y),d=0,t=0,o=-1;F.length>0&&(o=F[0]._offset);for(var c,s=0,J=0,p=0,U=x.length;p<U;p++)if(j.setUint8(t+p,x[p]),p+1===o){if(s=(c=F[d])._length,J=t+o,c._bin)for(var k=new Uint8Array(c._bin),M=0;M<s;M++)j.setUint8(J+M,k[M]);else c._str?u(j,J,c._str):void 0!==c._float&&j.setFloat64(J,c._float);t+=s,F[++d]&&(o=F[d]._offset)}return Y}},11940:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.NoneSerializer=void 0;x.NoneSerializer=class{setState(Z){}getState(){return null}patch(Z){}teardown(){}handshake(Z){}}},11932:(Z,x,F)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.SchemaSerializer=void 0;const u=F(11913);x.SchemaSerializer=class{setState(Z){return this.state.decode(Z)}getState(){return this.state}patch(Z){return this.state.decode(Z)}teardown(){var Z,x;null===(x=null===(Z=this.state)||void 0===Z?void 0:Z.$changes)||void 0===x||x.root.clearRefs()}handshake(Z,x){if(this.state){(new u.Reflection).decode(Z,x)}else this.state=u.Reflection.decode(Z,x)}}},11900:(Z,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.getSerializer=x.registerSerializer=void 0;const F={};x.registerSerializer=function(Z,x){F[Z]=x},x.getSerializer=function(Z){const x=F[Z];if(!x)throw new Error("missing serializer: "+Z);return x}},11881:function(Z,x,F){"use strict";var u=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(x,"__esModule",{value:!0}),x.WebSocketTransport=void 0;const G=u(F(11885)),f=globalThis.WebSocket||G.default;x.WebSocketTransport=class{constructor(Z){this.events=Z}send(Z){Z instanceof ArrayBuffer?this.ws.send(Z):Array.isArray(Z)&&this.ws.send(new Uint8Array(Z).buffer)}connect(Z){this.ws=new f(Z,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(Z,x){this.ws.close(Z,x)}get isOpen(){return this.ws.readyState===f.OPEN}}},11885:Z=>{"use strict";Z.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12318:Z=>{"use strict";Z.exports=function(Z){for(var x=new Array(Z),F=0;F<Z;++F)x[F]=F;return x}},12320:Z=>{function x(Z){return!!Z.constructor&&"function"===typeof Z.constructor.isBuffer&&Z.constructor.isBuffer(Z)}Z.exports=function(Z){return null!=Z&&(x(Z)||function(Z){return"function"===typeof Z.readFloatLE&&"function"===typeof Z.slice&&x(Z.slice(0,0))}(Z)||!!Z._isBuffer)}},12313:(Z,x,F)=>{var u=F(12318),G=F(12320),f="undefined"!==typeof Float64Array;function Y(Z,x){return Z[0]-x[0]}function j(){var Z,x=this.stride,F=new Array(x.length);for(Z=0;Z<F.length;++Z)F[Z]=[Math.abs(x[Z]),Z];F.sort(Y);var u=new Array(F.length);for(Z=0;Z<u.length;++Z)u[Z]=F[Z][1];return u}function d(Z,x){var F=["View",x,"d",Z].join("");x<0&&(F="View_Nil"+Z);var G="generic"===Z;if(-1===x){var f="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+Z+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(f)()}if(0===x){f="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+Z+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(G?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(G?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",f)(t[Z][0])}f=["'use strict'"];var Y=u(x),d=Y.map((function(Z){return"i"+Z})),o="this.offset+"+Y.map((function(Z){return"this.stride["+Z+"]*i"+Z})).join("+"),c=Y.map((function(Z){return"b"+Z})).join(","),s=Y.map((function(Z){return"c"+Z})).join(",");f.push("function "+F+"(a,"+c+","+s+",d){this.data=a","this.shape=["+c+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+Z+"'","proto.dimension="+x),f.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+Y.map((function(Z){return"this.shape["+Z+"]"})).join("*"),"}})"),1===x?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),x<4?(f.push("function "+F+"_order(){"),2===x?f.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&f.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+F+"_set("+d.join(",")+",v){"),G?f.push("return this.data.set("+o+",v)}"):f.push("return this.data["+o+"]=v}"),f.push("proto.get=function "+F+"_get("+d.join(",")+"){"),G?f.push("return this.data.get("+o+")}"):f.push("return this.data["+o+"]}"),f.push("proto.index=function "+F+"_index(",d.join(),"){return "+o+"}"),f.push("proto.hi=function "+F+"_hi("+d.join(",")+"){return new "+F+"(this.data,"+Y.map((function(Z){return["(typeof i",Z,"!=='number'||i",Z,"<0)?this.shape[",Z,"]:i",Z,"|0"].join("")})).join(",")+","+Y.map((function(Z){return"this.stride["+Z+"]"})).join(",")+",this.offset)}");var J=Y.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})),p=Y.map((function(Z){return"c"+Z+"=this.stride["+Z+"]"}));f.push("proto.lo=function "+F+"_lo("+d.join(",")+"){var b=this.offset,d=0,"+J.join(",")+","+p.join(","));for(var U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'&&i"+U+">=0){d=i"+U+"|0;b+=c"+U+"*d;a"+U+"-=d}");f.push("return new "+F+"(this.data,"+Y.map((function(Z){return"a"+Z})).join(",")+","+Y.map((function(Z){return"c"+Z})).join(",")+",b)}"),f.push("proto.step=function "+F+"_step("+d.join(",")+"){var "+Y.map((function(Z){return"a"+Z+"=this.shape["+Z+"]"})).join(",")+","+Y.map((function(Z){return"b"+Z+"=this.stride["+Z+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'){d=i"+U+"|0;if(d<0){c+=b"+U+"*(a"+U+"-1);a"+U+"=ceil(-a"+U+"/d)}else{a"+U+"=ceil(a"+U+"/d)}b"+U+"*=d}");f.push("return new "+F+"(this.data,"+Y.map((function(Z){return"a"+Z})).join(",")+","+Y.map((function(Z){return"b"+Z})).join(",")+",c)}");var k=new Array(x),M=new Array(x);for(U=0;U<x;++U)k[U]="a[i"+U+"]",M[U]="b[i"+U+"]";f.push("proto.transpose=function "+F+"_transpose("+d+"){"+d.map((function(Z,x){return Z+"=("+Z+"===undefined?"+x+":"+Z+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+k.join(",")+","+M.join(",")+",this.offset)}"),f.push("proto.pick=function "+F+"_pick("+d+"){var a=[],b=[],c=this.offset");for(U=0;U<x;++U)f.push("if(typeof i"+U+"==='number'&&i"+U+">=0){c=(c+this.stride["+U+"]*i"+U+")|0}else{a.push(this.shape["+U+"]);b.push(this.stride["+U+"])}");return f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+Y.map((function(Z){return"shape["+Z+"]"})).join(",")+","+Y.map((function(Z){return"stride["+Z+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",f.join("\n"))(t[Z],j)}var t={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};Z.exports=function(Z,x,F,u){if(void 0===Z)return(0,t.array[0])([]);"number"===typeof Z&&(Z=[Z]),void 0===x&&(x=[Z.length]);var Y=x.length;if(void 0===F){F=new Array(Y);for(var j=Y-1,o=1;j>=0;--j)F[j]=o,o*=x[j]}if(void 0===u){u=0;for(j=0;j<Y;++j)F[j]<0&&(u-=(x[j]-1)*F[j])}for(var c=function(Z){if(G(Z))return"buffer";if(f)switch(Object.prototype.toString.call(Z)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Z)?"array":"generic"}(Z),s=t[c];s.length<=Y+1;)s.push(d(c,s.length-1));return(0,s[Y+1])(Z,x,F,u)}},13342:Z=>{var x;self,x=()=>(()=>{"use strict";var Z={d:(x,F)=>{for(var u in F)Z.o(F,u)&&!Z.o(x,u)&&Object.defineProperty(x,u,{enumerable:!0,get:F[u]})},o:(Z,x)=>Object.prototype.hasOwnProperty.call(Z,x)},x={};Z.d(x,{default:()=>b});var F,u=function(Z,x){var F=x.x-Z.x,u=x.y-Z.y;return Math.sqrt(F*F+u*u)},G=function(Z){return Z*(Math.PI/180)},f=new Map,Y=function(Z){f.has(Z)&&clearTimeout(f.get(Z)),f.set(Z,setTimeout(Z,100))},j=function(Z,x,F){for(var u,G=x.split(/[ ,]+/g),f=0;f<G.length;f+=1)u=G[f],Z.addEventListener?Z.addEventListener(u,F,!1):Z.attachEvent&&Z.attachEvent(u,F)},d=function(Z,x,F){for(var u,G=x.split(/[ ,]+/g),f=0;f<G.length;f+=1)u=G[f],Z.removeEventListener?Z.removeEventListener(u,F):Z.detachEvent&&Z.detachEvent(u,F)},t=function(Z){return Z.preventDefault(),Z.type.match(/^touch/)?Z.changedTouches:Z},o=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},c=function(Z,x){x.top||x.right||x.bottom||x.left?(Z.style.top=x.top,Z.style.right=x.right,Z.style.bottom=x.bottom,Z.style.left=x.left):(Z.style.left=x.x+"px",Z.style.top=x.y+"px")},s=function(Z,x,F){var u=J(Z);for(var G in u)if(u.hasOwnProperty(G))if("string"==typeof x)u[G]=x+" "+F;else{for(var f="",Y=0,j=x.length;Y<j;Y+=1)f+=x[Y]+" "+F+", ";u[G]=f.slice(0,-2)}return u},J=function(Z){var x={};return x[Z]="",["webkit","Moz","o"].forEach((function(F){x[F+Z.charAt(0).toUpperCase()+Z.slice(1)]=""})),x},p=function(Z,x){for(var F in x)x.hasOwnProperty(F)&&(Z[F]=x[F]);return Z},U=function(Z,x){if(Z.length)for(var F=0,u=Z.length;F<u;F+=1)x(Z[F]);else x(Z)},k="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,M=window.matchMedia("(any-hover: none)").matches,m=!!("ontouchstart"in window),C=!!window.PointerEvent,L=!!window.MSPointerEvent,H={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},S={start:"mousedown",move:"mousemove",end:"mouseup"},K={};function y(){}k&&!M?F=H:C?F={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:L?F={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:m?(F=H,K=S):F=S,y.prototype.on=function(Z,x){var F,u=this,G=Z.split(/[ ,]+/g);u._handlers_=u._handlers_||{};for(var f=0;f<G.length;f+=1)F=G[f],u._handlers_[F]=u._handlers_[F]||[],u._handlers_[F].push(x);return u},y.prototype.off=function(Z,x){var F=this;return F._handlers_=F._handlers_||{},void 0===Z?F._handlers_={}:void 0===x?F._handlers_[Z]=null:F._handlers_[Z]&&F._handlers_[Z].indexOf(x)>=0&&F._handlers_[Z].splice(F._handlers_[Z].indexOf(x),1),F},y.prototype.trigger=function(Z,x){var F,u=this,G=Z.split(/[ ,]+/g);u._handlers_=u._handlers_||{};for(var f=0;f<G.length;f+=1)F=G[f],u._handlers_[F]&&u._handlers_[F].length&&u._handlers_[F].forEach((function(Z){Z.call(u,{type:F,target:u},x)}))},y.prototype.config=function(Z){var x=this;x.options=x.defaults||{},Z&&(x.options=function(Z,x){var F={};for(var u in Z)Z.hasOwnProperty(u)&&x.hasOwnProperty(u)?F[u]=x[u]:Z.hasOwnProperty(u)&&(F[u]=Z[u]);return F}(x.options,Z))},y.prototype.bindEvt=function(Z,x){var u=this;return u._domHandlers_=u._domHandlers_||{},u._domHandlers_[x]=function(){"function"==typeof u["on"+x]?u["on"+x].apply(u,arguments):console.warn('[WARNING] : Missing "on'+x+'" handler.')},j(Z,F[x],u._domHandlers_[x]),K[x]&&j(Z,K[x],u._domHandlers_[x]),u},y.prototype.unbindEvt=function(Z,x){var u=this;return u._domHandlers_=u._domHandlers_||{},d(Z,F[x],u._domHandlers_[x]),K[x]&&d(Z,K[x],u._domHandlers_[x]),delete u._domHandlers_[x],this};const q=y;function R(Z,x){return this.identifier=x.identifier,this.position=x.position,this.frontPosition=x.frontPosition,this.collection=Z,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(x),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=R.id,R.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}R.prototype=new q,R.constructor=R,R.id=0,R.prototype.buildEl=function(Z){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},R.prototype.stylize=function(){if(this.options.dataOnly)return this;var Z=this.options.fadeTime+"ms",x=function(){var Z=J("borderRadius");for(var x in Z)Z.hasOwnProperty(x)&&(Z[x]="50%");return Z}(),F=s("transition","opacity",Z),u={};return u.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},u.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},u.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},p(u.el,F),"circle"===this.options.shape&&p(u.back,x),p(u.front,x),this.applyStyles(u),this},R.prototype.applyStyles=function(Z){for(var x in this.ui)if(this.ui.hasOwnProperty(x))for(var F in Z[x])this.ui[x].style[F]=Z[x][F];return this},R.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},R.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},R.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},R.prototype.show=function(Z){var x=this;return x.options.dataOnly||(clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.addToDom(),x.restCallback(),setTimeout((function(){x.ui.el.style.opacity=1}),0),x.showTimeout=setTimeout((function(){x.trigger("shown",x.instance),"function"==typeof Z&&Z.call(this)}),x.options.fadeTime)),x},R.prototype.hide=function(Z){var x=this;if(x.options.dataOnly)return x;if(x.ui.el.style.opacity=x.options.restOpacity,clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.removeTimeout=setTimeout((function(){var F="dynamic"===x.options.mode?"none":"block";x.ui.el.style.display=F,"function"==typeof Z&&Z.call(x),x.trigger("hidden",x.instance)}),x.options.fadeTime),x.options.restJoystick){var F=x.options.restJoystick,u={};u.x=!0===F||!1!==F.x?0:x.instance.frontPosition.x,u.y=!0===F||!1!==F.y?0:x.instance.frontPosition.y,x.setPosition(Z,u)}return x},R.prototype.setPosition=function(Z,x){var F=this;F.frontPosition={x:x.x,y:x.y};var u=F.options.fadeTime+"ms",G={};G.front=s("transition",["transform"],u);var f={front:{}};f.front={transform:"translate("+F.frontPosition.x+"px,"+F.frontPosition.y+"px)"},F.applyStyles(G),F.applyStyles(f),F.restTimeout=setTimeout((function(){"function"==typeof Z&&Z.call(F),F.restCallback()}),F.options.fadeTime)},R.prototype.restCallback=function(){var Z=this,x={};x.front=s("transition","none",""),Z.applyStyles(x),Z.trigger("rested",Z.instance)},R.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},R.prototype.computeDirection=function(Z){var x,F,u,G=Z.angle.radian,f=Math.PI/4,Y=Math.PI/2;if(G>f&&G<3*f&&!Z.lockX?x="up":G>-f&&G<=f&&!Z.lockY?x="left":G>3*-f&&G<=-f&&!Z.lockX?x="down":Z.lockY||(x="right"),Z.lockY||(F=G>-Y&&G<Y?"left":"right"),Z.lockX||(u=G>0?"up":"down"),Z.force>this.options.threshold){var j,d={};for(j in this.direction)this.direction.hasOwnProperty(j)&&(d[j]=this.direction[j]);var t={};for(j in this.direction={x:F,y:u,angle:x},Z.direction=this.direction,d)d[j]===this.direction[j]&&(t[j]=!0);if(t.x&&t.y&&t.angle)return Z;t.x&&t.y||this.trigger("plain",Z),t.x||this.trigger("plain:"+F,Z),t.y||this.trigger("plain:"+u,Z),t.angle||this.trigger("dir dir:"+x,Z)}else this.resetDirection();return Z};const B=R;function v(Z,x){var F=this;F.nipples=[],F.idles=[],F.actives=[],F.ids=[],F.pressureIntervals={},F.manager=Z,F.id=v.id,v.id+=1,F.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},F.config(x),"static"!==F.options.mode&&"semi"!==F.options.mode||(F.options.multitouch=!1),F.options.multitouch||(F.options.maxNumberOfNipples=1);var u=getComputedStyle(F.options.zone.parentElement);return u&&"flex"===u.display&&(F.parentIsFlex=!0),F.updateBox(),F.prepareNipples(),F.FJ(),F.begin(),F.nipples}v.prototype=new q,v.constructor=v,v.id=0,v.prototype.prepareNipples=function(){var Z=this,x=Z.nipples;x.on=Z.on.bind(Z),x.off=Z.off.bind(Z),x.options=Z.options,x.destroy=Z.destroy.bind(Z),x.ids=Z.ids,x.id=Z.id,x.processOnMove=Z.processOnMove.bind(Z),x.processOnEnd=Z.processOnEnd.bind(Z),x.get=function(Z){if(void 0===Z)return x[0];for(var F=0,u=x.length;F<u;F+=1)if(x[F].identifier===Z)return x[F];return!1}},v.prototype.FJ=function(){var Z=this;Z.bindEvt(Z.options.zone,"start"),Z.options.zone.style.touchAction="none",Z.options.zone.style.msTouchAction="none"},v.prototype.begin=function(){var Z=this,x=Z.options;if("static"===x.mode){var F=Z.createNipple(x.position,Z.manager.getIdentifier());F.add(),Z.idles.push(F)}},v.prototype.createNipple=function(Z,x){var F=this,u=F.manager.scroll,G={},f=F.options,Y=F.parentIsFlex?u.x:u.x+F.box.left,j=F.parentIsFlex?u.y:u.y+F.box.top;if(Z.x&&Z.y)G={x:Z.x-Y,y:Z.y-j};else if(Z.top||Z.right||Z.bottom||Z.left){var d=document.createElement("DIV");d.style.display="hidden",d.style.top=Z.top,d.style.right=Z.right,d.style.bottom=Z.bottom,d.style.left=Z.left,d.style.position="absolute",f.zone.appendChild(d);var t=d.getBoundingClientRect();f.zone.removeChild(d),G=Z,Z={x:t.left+u.x,y:t.top+u.y}}var o=new B(F,{color:f.color,size:f.size,threshold:f.threshold,fadeTime:f.fadeTime,dataOnly:f.dataOnly,restJoystick:f.restJoystick,restOpacity:f.restOpacity,mode:f.mode,identifier:x,position:Z,zone:f.zone,frontPosition:{x:0,y:0},shape:f.shape});return f.dataOnly||(c(o.ui.el,G),c(o.ui.front,o.frontPosition)),F.nipples.push(o),F.trigger("added "+o.identifier+":added",o),F.manager.trigger("added "+o.identifier+":added",o),F.bindNipple(o),o},v.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},v.prototype.bindNipple=function(Z){var x,F=this,u=function(Z,u){x=Z.type+" "+u.id+":"+Z.type,F.trigger(x,u)};Z.on("destroyed",F.onDestroyed.bind(F)),Z.on("shown hidden rested dir plain",u),Z.on("dir:up dir:right dir:down dir:left",u),Z.on("plain:up plain:right plain:down plain:left",u)},v.prototype.pressureFn=function(Z,x,F){var u=this,G=0;clearInterval(u.pressureIntervals[F]),u.pressureIntervals[F]=setInterval(function(){var F=Z.force||Z.pressure||Z.webkitForce||0;F!==G&&(x.trigger("pressure",F),u.trigger("pressure "+x.identifier+":pressure",F),G=F)}.bind(u),100)},v.prototype.onstart=function(Z){var x=this,F=x.options,u=Z;return Z=t(Z),x.updateBox(),U(Z,(function(G){x.actives.length<F.maxNumberOfNipples?x.processOnStart(G):u.type.match(/^touch/)&&(Object.keys(x.manager.ids).forEach((function(F){if(Object.values(u.touches).findIndex((function(Z){return Z.identifier===F}))<0){var G=[Z[0]];G.identifier=F,x.processOnEnd(G)}})),x.actives.length<F.maxNumberOfNipples&&x.processOnStart(G))})),x.manager.bindDocument(),!1},v.prototype.processOnStart=function(Z){var x,F=this,G=F.options,f=F.manager.getIdentifier(Z),Y=Z.force||Z.pressure||Z.webkitForce||0,j={x:Z.pageX,y:Z.pageY},d=F.getOrCreate(f,j);d.identifier!==f&&F.manager.removeIdentifier(d.identifier),d.identifier=f;var t=function(x){x.trigger("start",x),F.trigger("start "+x.id+":start",x),x.show(),Y>0&&F.pressureFn(Z,x,x.identifier),F.processOnMove(Z)};if((x=F.idles.indexOf(d))>=0&&F.idles.splice(x,1),F.actives.push(d),F.ids.push(d.identifier),"semi"!==G.mode)t(d);else{if(!(u(j,d.position)<=G.catchDistance))return d.destroy(),void F.processOnStart(Z);t(d)}return d},v.prototype.getOrCreate=function(Z,x){var F,u=this,G=u.options;return/(semi|static)/.test(G.mode)?(F=u.idles[0])?(u.idles.splice(0,1),F):"semi"===G.mode?u.createNipple(x,Z):(console.warn("Coudln't find the needed nipple."),!1):F=u.createNipple(x,Z)},v.prototype.processOnMove=function(Z){var x=this,F=x.options,f=x.manager.getIdentifier(Z),Y=x.nipples.get(f),j=x.manager.scroll;if(function(Z){return isNaN(Z.buttons)?0!==Z.pressure:0!==Z.buttons}(Z)){if(!Y)return console.error("Found zombie joystick with ID "+f),void x.manager.removeIdentifier(f);if(F.dynamicPage){var d=Y.el.getBoundingClientRect();Y.position={x:j.x+d.left,y:j.y+d.top}}Y.identifier=f;var t=Y.options.size/2,o={x:Z.pageX,y:Z.pageY};F.lockX&&(o.y=Y.position.y),F.lockY&&(o.x=Y.position.x);var c,s,J,p,U,k,M,m,C,L,H=u(o,Y.position),S=(c=o,J=(s=Y.position).x-c.x,p=s.y-c.y,function(Z){return Z*(180/Math.PI)}(Math.atan2(p,J))),K=G(S),y=H/t,q={distance:H,position:o};if("circle"===Y.options.shape?(U=Math.min(H,t),M=Y.position,m=U,L={x:0,y:0},C=G(C=S),L.x=M.x-m*Math.cos(C),L.y=M.y-m*Math.sin(C),k=L):(k=function(Z,x,F){return{x:Math.min(Math.max(Z.x,x.x-F),x.x+F),y:Math.min(Math.max(Z.y,x.y-F),x.y+F)}}(o,Y.position,t),U=u(k,Y.position)),F.follow){if(H>t){var R=o.x-k.x,B=o.y-k.y;Y.position.x+=R,Y.position.y+=B,Y.el.style.top=Y.position.y-(x.box.top+j.y)+"px",Y.el.style.left=Y.position.x-(x.box.left+j.x)+"px",H=u(o,Y.position)}}else o=k,H=U;var v=o.x-Y.position.x,l=o.y-Y.position.y;Y.frontPosition={x:v,y:l},F.dataOnly||(Y.ui.front.style.transform="translate("+v+"px,"+l+"px)");var i={identifier:Y.identifier,position:o,force:y,pressure:Z.force||Z.pressure||Z.webkitForce||0,distance:H,angle:{radian:K,degree:S},vector:{x:v/t,y:-l/t},raw:q,instance:Y,lockX:F.lockX,lockY:F.lockY};(i=Y.computeDirection(i)).angle={radian:G(180-S),degree:180-S},Y.trigger("move",i),x.trigger("move "+Y.id+":move",i)}else this.processOnEnd(Z)},v.prototype.processOnEnd=function(Z){var x=this,F=x.options,u=x.manager.getIdentifier(Z),G=x.nipples.get(u),f=x.manager.removeIdentifier(G.identifier);G&&(F.dataOnly||G.hide((function(){"dynamic"===F.mode&&(G.trigger("removed",G),x.trigger("removed "+G.id+":removed",G),x.manager.trigger("removed "+G.id+":removed",G),G.destroy())})),clearInterval(x.pressureIntervals[G.identifier]),G.resetDirection(),G.trigger("end",G),x.trigger("end "+G.id+":end",G),x.ids.indexOf(G.identifier)>=0&&x.ids.splice(x.ids.indexOf(G.identifier),1),x.actives.indexOf(G)>=0&&x.actives.splice(x.actives.indexOf(G),1),/(semi|static)/.test(F.mode)?x.idles.push(G):x.nipples.indexOf(G)>=0&&x.nipples.splice(x.nipples.indexOf(G),1),x.manager.unbindDocument(),/(semi|static)/.test(F.mode)&&(x.manager.ids[f.id]=f.identifier))},v.prototype.onDestroyed=function(Z,x){var F=this;F.nipples.indexOf(x)>=0&&F.nipples.splice(F.nipples.indexOf(x),1),F.actives.indexOf(x)>=0&&F.actives.splice(F.actives.indexOf(x),1),F.idles.indexOf(x)>=0&&F.idles.splice(F.idles.indexOf(x),1),F.ids.indexOf(x.identifier)>=0&&F.ids.splice(F.ids.indexOf(x.identifier),1),F.manager.removeIdentifier(x.identifier),F.manager.unbindDocument()},v.prototype.destroy=function(){var Z=this;for(var x in Z.unbindEvt(Z.options.zone,"start"),Z.nipples.forEach((function(Z){Z.destroy()})),Z.pressureIntervals)Z.pressureIntervals.hasOwnProperty(x)&&clearInterval(Z.pressureIntervals[x]);Z.trigger("destroyed",Z.nipples),Z.manager.unbindDocument(),Z.off()};const l=v;function i(Z){var x=this;x.ids={},x.index=0,x.collections=[],x.scroll=o(),x.config(Z),x.prepareCollections();var F=function(){var Z;x.collections.forEach((function(F){F.forEach((function(F){Z=F.el.getBoundingClientRect(),F.position={x:x.scroll.x+Z.left,y:x.scroll.y+Z.top}}))}))};j(window,"resize",(function(){Y(F)}));var u=function(){x.scroll=o()};return j(window,"scroll",(function(){Y(u)})),x.collections}i.prototype=new q,i.constructor=i,i.prototype.prepareCollections=function(){var Z=this;Z.collections.create=Z.create.bind(Z),Z.collections.on=Z.on.bind(Z),Z.collections.off=Z.off.bind(Z),Z.collections.destroy=Z.destroy.bind(Z),Z.collections.get=function(x){var F;return Z.collections.every((function(Z){return!(F=Z.get(x))})),F}},i.prototype.create=function(Z){return this.createCollection(Z)},i.prototype.createCollection=function(Z){var x=this,F=new l(x,Z);return x.bindCollection(F),x.collections.push(F),F},i.prototype.bindCollection=function(Z){var x,F=this,u=function(Z,u){x=Z.type+" "+u.id+":"+Z.type,F.trigger(x,u)};Z.on("destroyed",F.onDestroyed.bind(F)),Z.on("shown hidden rested dir plain",u),Z.on("dir:up dir:right dir:down dir:left",u),Z.on("plain:up plain:right plain:down plain:left",u)},i.prototype.bindDocument=function(){var Z=this;Z.binded||(Z.bindEvt(document,"move").bindEvt(document,"end"),Z.binded=!0)},i.prototype.unbindDocument=function(Z){var x=this;Object.keys(x.ids).length&&!0!==Z||(x.unbindEvt(document,"move").unbindEvt(document,"end"),x.binded=!1)},i.prototype.getIdentifier=function(Z){var x;return Z?void 0===(x=void 0===Z.identifier?Z.pointerId:Z.identifier)&&(x=this.latest||0):x=this.index,void 0===this.ids[x]&&(this.ids[x]=this.index,this.index+=1),this.latest=x,this.ids[x]},i.prototype.removeIdentifier=function(Z){var x={};for(var F in this.ids)if(this.ids[F]===Z){x.id=F,x.identifier=this.ids[F],delete this.ids[F];break}return x},i.prototype.onmove=function(Z){return this.onAny("move",Z),!1},i.prototype.onend=function(Z){return this.onAny("end",Z),!1},i.prototype.oncancel=function(Z){return this.onAny("end",Z),!1},i.prototype.onAny=function(Z,x){var F,u=this,G="processOn"+Z.charAt(0).toUpperCase()+Z.slice(1);x=t(x);var f=function(Z,x,F){F.ids.indexOf(x)>=0&&(F[G](Z),Z._found_=!0)};return U(x,(function(Z){F=u.getIdentifier(Z),U(u.collections,f.bind(null,Z,F)),Z._found_||u.removeIdentifier(F)})),!1},i.prototype.destroy=function(){var Z=this;Z.unbindDocument(!0),Z.ids={},Z.index=0,Z.collections.forEach((function(Z){Z.destroy()})),Z.off()},i.prototype.onDestroyed=function(Z,x){var F=this;if(F.collections.indexOf(x)<0)return!1;F.collections.splice(F.collections.indexOf(x),1)};var e=new i;const b={create:function(Z){return e.create(Z)},factory:e};return x.default})(),Z.exports=x()},12341:(Z,x,F)=>{"use strict";const{Deflate:u,deflate:G,deflateRaw:f,gzip:Y}=F(12350),{Inflate:j,inflate:d,inflateRaw:t,ungzip:o}=F(12404),c=F(12385);Z.exports.Deflate=u,Z.exports.deflate=G,Z.exports.deflateRaw=f,Z.exports.gzip=Y,Z.exports.Inflate=j,Z.exports.inflate=d,Z.exports.inflateRaw=t,Z.exports.ungzip=o,Z.exports.constants=c},12350:(Z,x,F)=>{"use strict";const u=F(12353),G=F(12390),f=F(12394),Y=F(12377),j=F(12396),d=Object.prototype.toString,{Z_NO_FLUSH:t,Z_SYNC_FLUSH:o,Z_FULL_FLUSH:c,Z_FINISH:s,Z_OK:J,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:U,Z_DEFAULT_STRATEGY:k,Z_DEFLATED:M}=F(12385);function m(Z){this.options=G.assign({level:U,method:M,WZ:16384,windowBits:15,memLevel:8,strategy:k},Z||{});let x=this.options;x.raw&&x.windowBits>0?x.windowBits=-x.windowBits:x.gzip&&x.windowBits>0&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.tx="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let F=u.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(F!==J)throw new Error(Y[F]);if(x.header&&u.deflateSetHeader(this.strm,x.header),x.dictionary){let Z;if(Z="string"===typeof x.dictionary?f.string2buf(x.dictionary):"[object ArrayBuffer]"===d.call(x.dictionary)?new Uint8Array(x.dictionary):x.dictionary,F=u.deflateSetDictionary(this.strm,Z),F!==J)throw new Error(Y[F]);this._dict_set=!0}}function C(Z,x){const F=new m(x);if(F.push(Z,!0),F.err)throw F.tx||Y[F.err];return F.result}m.prototype.push=function(Z,x){const F=this.strm,G=this.options.WZ;let Y,j;if(this.ended)return!1;for(j=x===~~x?x:!0===x?s:t,"string"===typeof Z?F.input=f.string2buf(Z):"[object ArrayBuffer]"===d.call(Z)?F.input=new Uint8Array(Z):F.input=Z,F.next_in=0,F.avail_in=F.input.length;;)if(0===F.avail_out&&(F.output=new Uint8Array(G),F.next_out=0,F.avail_out=G),(j===o||j===c)&&F.avail_out<=6)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else{if(Y=u.deflate(F,j),Y===p)return F.next_out>0&&this.onData(F.output.subarray(0,F.next_out)),Y=u.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===J;if(0!==F.avail_out){if(j>0&&F.next_out>0)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else if(0===F.avail_in)break}else this.onData(F.output)}return!0},m.prototype.onData=function(Z){this.chunks.push(Z)},m.prototype.onEnd=function(Z){Z===J&&(this.result=G.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.tx=this.strm.tx},Z.exports.Deflate=m,Z.exports.deflate=C,Z.exports.deflateRaw=function(Z,x){return(x=x||{}).raw=!0,C(Z,x)},Z.exports.gzip=function(Z,x){return(x=x||{}).gzip=!0,C(Z,x)},Z.exports.constants=F(12385)},12404:(Z,x,F)=>{"use strict";const u=F(12412),G=F(12390),f=F(12394),Y=F(12377),j=F(12396),d=F(12438),t=Object.prototype.toString,{Z_NO_FLUSH:o,Z_FINISH:c,Z_OK:s,Z_STREAM_END:J,Z_NEED_DICT:p,Z_STREAM_ERROR:U,Z_DATA_ERROR:k,Z_MEM_ERROR:M}=F(12385);function m(Z){this.options=G.assign({WZ:65536,windowBits:15,to:""},Z||{});const x=this.options;x.raw&&x.windowBits>=0&&x.windowBits<16&&(x.windowBits=-x.windowBits,0===x.windowBits&&(x.windowBits=-15)),!(x.windowBits>=0&&x.windowBits<16)||Z&&Z.windowBits||(x.windowBits+=32),x.windowBits>15&&x.windowBits<48&&0===(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.tx="",this.ended=!1,this.chunks=[],this.strm=new j,this.strm.avail_out=0;let F=u.inflateInit2(this.strm,x.windowBits);if(F!==s)throw new Error(Y[F]);if(this.header=new d,u.inflateGetHeader(this.strm,this.header),x.dictionary&&("string"===typeof x.dictionary?x.dictionary=f.string2buf(x.dictionary):"[object ArrayBuffer]"===t.call(x.dictionary)&&(x.dictionary=new Uint8Array(x.dictionary)),x.raw&&(F=u.inflateSetDictionary(this.strm,x.dictionary),F!==s)))throw new Error(Y[F])}function C(Z,x){const F=new m(x);if(F.push(Z),F.err)throw F.tx||Y[F.err];return F.result}m.prototype.push=function(Z,x){const F=this.strm,G=this.options.WZ,Y=this.options.dictionary;let j,d,m;if(this.ended)return!1;for(d=x===~~x?x:!0===x?c:o,"[object ArrayBuffer]"===t.call(Z)?F.input=new Uint8Array(Z):F.input=Z,F.next_in=0,F.avail_in=F.input.length;;){for(0===F.avail_out&&(F.output=new Uint8Array(G),F.next_out=0,F.avail_out=G),j=u.inflate(F,d),j===p&&Y&&(j=u.inflateSetDictionary(F,Y),j===s?j=u.inflate(F,d):j===k&&(j=p));F.avail_in>0&&j===J&&F.state.wrap>0&&0!==Z[F.next_in];)u.inflateReset(F),j=u.inflate(F,d);switch(j){case U:case k:case p:case M:return this.onEnd(j),this.ended=!0,!1}if(m=F.avail_out,F.next_out&&(0===F.avail_out||j===J))if("string"===this.options.to){let Z=f.utf8border(F.output,F.next_out),x=F.next_out-Z,u=f.buf2string(F.output,Z);F.next_out=x,F.avail_out=G-x,x&&F.output.set(F.output.subarray(Z,Z+x),0),this.onData(u)}else this.onData(F.output.length===F.next_out?F.output:F.output.subarray(0,F.next_out));if(j!==s||0!==m){if(j===J)return j=u.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,!0;if(0===F.avail_in)break}}return!0},m.prototype.onData=function(Z){this.chunks.push(Z)},m.prototype.onEnd=function(Z){Z===s&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=G.flattenChunks(this.chunks)),this.chunks=[],this.err=Z,this.tx=this.strm.tx},Z.exports.Inflate=m,Z.exports.inflate=C,Z.exports.inflateRaw=function(Z,x){return(x=x||{}).raw=!0,C(Z,x)},Z.exports.ungzip=C,Z.exports.constants=F(12385)},12390:Z=>{"use strict";const x=(Z,x)=>Object.prototype.hasOwnProperty.call(Z,x);Z.exports.assign=function(Z){const F=Array.prototype.slice.call(arguments,1);for(;F.length;){const u=F.shift();if(u){if("object"!==typeof u)throw new TypeError(u+"must be non-object");for(const F in u)x(u,F)&&(Z[F]=u[F])}}return Z},Z.exports.flattenChunks=Z=>{let x=0;for(let u=0,G=Z.length;u<G;u++)x+=Z[u].length;const F=new Uint8Array(x);for(let u=0,G=0,f=Z.length;u<f;u++){let x=Z[u];F.set(x,G),G+=x.length}return F}},12394:Z=>{"use strict";let x=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){x=!1}const F=new Uint8Array(256);for(let G=0;G<256;G++)F[G]=G>=252?6:G>=248?5:G>=240?4:G>=224?3:G>=192?2:1;F[254]=F[254]=1,Z.exports.string2buf=Z=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(Z);let x,F,u,G,f,Y=Z.length,j=0;for(G=0;G<Y;G++)F=Z.charCodeAt(G),55296===(64512&F)&&G+1<Y&&(u=Z.charCodeAt(G+1),56320===(64512&u)&&(F=65536+(F-55296<<10)+(u-56320),G++)),j+=F<128?1:F<2048?2:F<65536?3:4;for(x=new Uint8Array(j),f=0,G=0;f<j;G++)F=Z.charCodeAt(G),55296===(64512&F)&&G+1<Y&&(u=Z.charCodeAt(G+1),56320===(64512&u)&&(F=65536+(F-55296<<10)+(u-56320),G++)),F<128?x[f++]=F:F<2048?(x[f++]=192|F>>>6,x[f++]=128|63&F):F<65536?(x[f++]=224|F>>>12,x[f++]=128|F>>>6&63,x[f++]=128|63&F):(x[f++]=240|F>>>18,x[f++]=128|F>>>12&63,x[f++]=128|F>>>6&63,x[f++]=128|63&F);return x};Z.exports.buf2string=(Z,u)=>{const G=u||Z.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(Z.subarray(0,u));let f,Y;const j=new Array(2*G);for(Y=0,f=0;f<G;){let x=Z[f++];if(x<128){j[Y++]=x;continue}let u=F[x];if(u>4)j[Y++]=65533,f+=u-1;else{for(x&=2===u?31:3===u?15:7;u>1&&f<G;)x=x<<6|63&Z[f++],u--;u>1?j[Y++]=65533:x<65536?j[Y++]=x:(x-=65536,j[Y++]=55296|x>>10&1023,j[Y++]=56320|1023&x)}}return((Z,F)=>{if(F<65534&&Z.subarray&&x)return String.fromCharCode.apply(null,Z.length===F?Z:Z.subarray(0,F));let u="";for(let x=0;x<F;x++)u+=String.fromCharCode(Z[x]);return u})(j,Y)},Z.exports.utf8border=(Z,x)=>{(x=x||Z.length)>Z.length&&(x=Z.length);let u=x-1;for(;u>=0&&128===(192&Z[u]);)u--;return u<0||0===u?x:u+F[Z[u]]>x?u:x}},12367:Z=>{"use strict";Z.exports=(Z,x,F,u)=>{let G=65535&Z,f=Z>>>16&65535,Y=0;for(;0!==F;){Y=F>2e3?2e3:F,F-=Y;do{G=G+x[u++]|0,f=f+G|0}while(--Y);G%=65521,f%=65521}return G|f<<16}},12385:Z=>{"use strict";Z.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12373:Z=>{"use strict";const x=new Uint32Array((()=>{let Z,x=[];for(var F=0;F<256;F++){Z=F;for(var u=0;u<8;u++)Z=1&Z?3988292384^Z>>>1:Z>>>1;x[F]=Z}return x})());Z.exports=(Z,F,u,G)=>{const f=x,Y=G+u;Z^=-1;for(let x=G;x<Y;x++)Z=Z>>>8^f[255&(Z^F[x])];return~Z}},12353:(Z,x,F)=>{"use strict";const{_tr_init:u,_tr_stored_block:G,_tr_flush_block:f,_tr_tally:Y,_tr_align:j}=F(12359),d=F(12367),t=F(12373),o=F(12377),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:s,Z_FULL_FLUSH:J,Z_FINISH:p,Z_BLOCK:U,Z_OK:k,Z_STREAM_END:M,Z_STREAM_ERROR:m,Z_DATA_ERROR:C,Z_BUF_ERROR:L,Z_DEFAULT_COMPRESSION:H,Z_FILTERED:S,Z_HUFFMAN_ONLY:K,Z_RLE:y,Z_FIXED:q,Z_DEFAULT_STRATEGY:R,Z_UNKNOWN:B,Z_DEFLATED:v}=F(12385),l=258,i=262,e=103,b=113,E=666,w=(Z,x)=>(Z.tx=o[x],x),T=Z=>(Z<<1)-(Z>4?9:0),N=Z=>{let x=Z.length;for(;--x>=0;)Z[x]=0};let W=(Z,x,F)=>(x<<Z.hash_shift^F)&Z.hash_mask;const A=Z=>{const x=Z.state;let F=x.pending;F>Z.avail_out&&(F=Z.avail_out),0!==F&&(Z.output.set(x.pending_buf.subarray(x.pending_out,x.pending_out+F),Z.next_out),Z.next_out+=F,x.pending_out+=F,Z.total_out+=F,Z.avail_out-=F,x.pending-=F,0===x.pending&&(x.pending_out=0))},h=(Z,x)=>{f(Z,Z.block_start>=0?Z.block_start:-1,Z.strstart-Z.block_start,x),Z.block_start=Z.strstart,A(Z.strm)},X=(Z,x)=>{Z.pending_buf[Z.pending++]=x},D=(Z,x)=>{Z.pending_buf[Z.pending++]=x>>>8&255,Z.pending_buf[Z.pending++]=255&x},Q=(Z,x,F,u)=>{let G=Z.avail_in;return G>u&&(G=u),0===G?0:(Z.avail_in-=G,x.set(Z.input.subarray(Z.next_in,Z.next_in+G),F),1===Z.state.wrap?Z.adler=d(Z.adler,x,G,F):2===Z.state.wrap&&(Z.adler=t(Z.adler,x,G,F)),Z.next_in+=G,Z.total_in+=G,G)},g=(Z,x)=>{let F,u,G=Z.max_chain_length,f=Z.strstart,Y=Z.prev_length,j=Z.nice_match;const d=Z.strstart>Z.w_size-i?Z.strstart-(Z.w_size-i):0,t=Z.window,o=Z.w_mask,c=Z.prev,s=Z.strstart+l;let J=t[f+Y-1],p=t[f+Y];Z.prev_length>=Z.good_match&&(G>>=2),j>Z.lookahead&&(j=Z.lookahead);do{if(F=x,t[F+Y]===p&&t[F+Y-1]===J&&t[F]===t[f]&&t[++F]===t[f+1]){f+=2,F++;do{}while(t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&t[++f]===t[++F]&&f<s);if(u=l-(s-f),f=s-l,u>Y){if(Z.match_start=x,Y=u,u>=j)break;J=t[f+Y-1],p=t[f+Y]}}}while((x=c[x&o])>d&&0!==--G);return Y<=Z.lookahead?Y:Z.lookahead},O=Z=>{const x=Z.w_size;let F,u,G,f,Y;do{if(f=Z.window_size-Z.lookahead-Z.strstart,Z.strstart>=x+(x-i)){Z.window.set(Z.window.subarray(x,x+x),0),Z.match_start-=x,Z.strstart-=x,Z.block_start-=x,u=Z.hash_size,F=u;do{G=Z.head[--F],Z.head[F]=G>=x?G-x:0}while(--u);u=x,F=u;do{G=Z.prev[--F],Z.prev[F]=G>=x?G-x:0}while(--u);f+=x}if(0===Z.strm.avail_in)break;if(u=Q(Z.strm,Z.window,Z.strstart+Z.lookahead,f),Z.lookahead+=u,Z.lookahead+Z.insert>=3)for(Y=Z.strstart-Z.insert,Z.ins_h=Z.window[Y],Z.ins_h=W(Z,Z.ins_h,Z.window[Y+1]);Z.insert&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Y+3-1]),Z.prev[Y&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Y,Y++,Z.insert--,!(Z.lookahead+Z.insert<3)););}while(Z.lookahead<i&&0!==Z.strm.avail_in)},n=(Z,x)=>{let F,u;for(;;){if(Z.lookahead<i){if(O(Z),Z.lookahead<i&&x===c)return 1;if(0===Z.lookahead)break}if(F=0,Z.lookahead>=3&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),F=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),0!==F&&Z.strstart-F<=Z.w_size-i&&(Z.match_length=g(Z,F)),Z.match_length>=3)if(u=Y(Z,Z.strstart-Z.match_start,Z.match_length-3),Z.lookahead-=Z.match_length,Z.match_length<=Z.max_lazy_match&&Z.lookahead>=3){Z.match_length--;do{Z.strstart++,Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),F=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart}while(0!==--Z.match_length);Z.strstart++}else Z.strstart+=Z.match_length,Z.match_length=0,Z.ins_h=Z.window[Z.strstart],Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+1]);else u=Y(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++;if(u&&(h(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=Z.strstart<2?Z.strstart:2,x===p?(h(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(h(Z,!1),0===Z.strm.avail_out)?1:2},V=(Z,x)=>{let F,u,G;for(;;){if(Z.lookahead<i){if(O(Z),Z.lookahead<i&&x===c)return 1;if(0===Z.lookahead)break}if(F=0,Z.lookahead>=3&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),F=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart),Z.prev_length=Z.match_length,Z.prev_match=Z.match_start,Z.match_length=2,0!==F&&Z.prev_length<Z.max_lazy_match&&Z.strstart-F<=Z.w_size-i&&(Z.match_length=g(Z,F),Z.match_length<=5&&(Z.strategy===S||3===Z.match_length&&Z.strstart-Z.match_start>4096)&&(Z.match_length=2)),Z.prev_length>=3&&Z.match_length<=Z.prev_length){G=Z.strstart+Z.lookahead-3,u=Y(Z,Z.strstart-1-Z.prev_match,Z.prev_length-3),Z.lookahead-=Z.prev_length-1,Z.prev_length-=2;do{++Z.strstart<=G&&(Z.ins_h=W(Z,Z.ins_h,Z.window[Z.strstart+3-1]),F=Z.prev[Z.strstart&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=Z.strstart)}while(0!==--Z.prev_length);if(Z.match_available=0,Z.match_length=2,Z.strstart++,u&&(h(Z,!1),0===Z.strm.avail_out))return 1}else if(Z.match_available){if(u=Y(Z,0,Z.window[Z.strstart-1]),u&&h(Z,!1),Z.strstart++,Z.lookahead--,0===Z.strm.avail_out)return 1}else Z.match_available=1,Z.strstart++,Z.lookahead--}return Z.match_available&&(u=Y(Z,0,Z.window[Z.strstart-1]),Z.match_available=0),Z.insert=Z.strstart<2?Z.strstart:2,x===p?(h(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(h(Z,!1),0===Z.strm.avail_out)?1:2};function a(Z,x,F,u,G){this.good_length=Z,this.max_lazy=x,this.nice_length=F,this.max_chain=u,this.func=G}const I=[new a(0,0,0,0,((Z,x)=>{let F=65535;for(F>Z.pending_buf_size-5&&(F=Z.pending_buf_size-5);;){if(Z.lookahead<=1){if(O(Z),0===Z.lookahead&&x===c)return 1;if(0===Z.lookahead)break}Z.strstart+=Z.lookahead,Z.lookahead=0;const u=Z.block_start+F;if((0===Z.strstart||Z.strstart>=u)&&(Z.lookahead=Z.strstart-u,Z.strstart=u,h(Z,!1),0===Z.strm.avail_out))return 1;if(Z.strstart-Z.block_start>=Z.w_size-i&&(h(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,x===p?(h(Z,!0),0===Z.strm.avail_out?3:4):(Z.strstart>Z.block_start&&(h(Z,!1),Z.strm.avail_out),1)})),new a(4,4,8,4,n),new a(4,5,16,8,n),new a(4,6,32,32,n),new a(4,4,16,16,V),new a(8,16,32,32,V),new a(8,16,128,128,V),new a(8,32,128,256,V),new a(32,128,258,1024,V),new a(32,258,258,4096,V)];function r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const z=Z=>{if(!Z||!Z.state)return w(Z,m);Z.total_in=Z.total_out=0,Z.data_type=B;const x=Z.state;return x.pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap?42:b,Z.adler=2===x.wrap?0:1,x.last_flush=c,u(x),k},P=Z=>{const x=z(Z);var F;return x===k&&((F=Z.state).window_size=2*F.w_size,N(F.head),F.max_lazy_match=I[F.level].max_lazy,F.good_match=I[F.level].good_length,F.nice_match=I[F.level].nice_length,F.max_chain_length=I[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=2,F.match_available=0,F.ins_h=0),x},ZZ=(Z,x,F,u,G,f)=>{if(!Z)return m;let Y=1;if(x===H&&(x=6),u<0?(Y=0,u=-u):u>15&&(Y=2,u-=16),G<1||G>9||F!==v||u<8||u>15||x<0||x>9||f<0||f>q)return w(Z,m);8===u&&(u=9);const j=new r;return Z.state=j,j.strm=Z,j.wrap=Y,j.gzhead=null,j.w_bits=u,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=G+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+3-1)/3),j.window=new Uint8Array(2*j.w_size),j.head=new Uint16Array(j.hash_size),j.prev=new Uint16Array(j.w_size),j.lit_bufsize=1<<G+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new Uint8Array(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=x,j.strategy=f,j.method=F,P(Z)};Z.exports.deflateInit=(Z,x)=>ZZ(Z,x,v,15,8,R),Z.exports.deflateInit2=ZZ,Z.exports.deflateReset=P,Z.exports.deflateResetKeep=z,Z.exports.deflateSetHeader=(Z,x)=>Z&&Z.state?2!==Z.state.wrap?m:(Z.state.gzhead=x,k):m,Z.exports.deflate=(Z,x)=>{let F,u;if(!Z||!Z.state||x>U||x<0)return Z?w(Z,m):m;const f=Z.state;if(!Z.output||!Z.input&&0!==Z.avail_in||f.status===E&&x!==p)return w(Z,0===Z.avail_out?L:m);f.strm=Z;const d=f.last_flush;if(f.last_flush=x,42===f.status)if(2===f.wrap)Z.adler=0,X(f,31),X(f,139),X(f,8),f.gzhead?(X(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),X(f,255&f.gzhead.time),X(f,f.gzhead.time>>8&255),X(f,f.gzhead.time>>16&255),X(f,f.gzhead.time>>24&255),X(f,9===f.level?2:f.strategy>=K||f.level<2?4:0),X(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(X(f,255&f.gzhead.extra.length),X(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(Z.adler=t(Z.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(X(f,0),X(f,0),X(f,0),X(f,0),X(f,0),X(f,9===f.level?2:f.strategy>=K||f.level<2?4:0),X(f,3),f.status=b);else{let x=v+(f.w_bits-8<<4)<<8,F=-1;F=f.strategy>=K||f.level<2?0:f.level<6?1:6===f.level?2:3,x|=F<<6,0!==f.strstart&&(x|=32),x+=31-x%31,f.status=b,D(f,x),0!==f.strstart&&(D(f,Z.adler>>>16),D(f,65535&Z.adler)),Z.adler=1}if(69===f.status)if(f.gzhead.extra){for(F=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),A(Z),F=f.pending,f.pending!==f.pending_buf_size));)X(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(73===f.status)if(f.gzhead.name){F=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),A(Z),F=f.pending,f.pending===f.pending_buf_size)){u=1;break}u=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,X(f,u)}while(0!==u);f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),0===u&&(f.gzindex=0,f.status=91)}else f.status=91;if(91===f.status)if(f.gzhead.comment){F=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),A(Z),F=f.pending,f.pending===f.pending_buf_size)){u=1;break}u=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,X(f,u)}while(0!==u);f.gzhead.hcrc&&f.pending>F&&(Z.adler=t(Z.adler,f.pending_buf,f.pending-F,F)),0===u&&(f.status=e)}else f.status=e;if(f.status===e&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&A(Z),f.pending+2<=f.pending_buf_size&&(X(f,255&Z.adler),X(f,Z.adler>>8&255),Z.adler=0,f.status=b)):f.status=b),0!==f.pending){if(A(Z),0===Z.avail_out)return f.last_flush=-1,k}else if(0===Z.avail_in&&T(x)<=T(d)&&x!==p)return w(Z,L);if(f.status===E&&0!==Z.avail_in)return w(Z,L);if(0!==Z.avail_in||0!==f.lookahead||x!==c&&f.status!==E){let F=f.strategy===K?((Z,x)=>{let F;for(;;){if(0===Z.lookahead&&(O(Z),0===Z.lookahead)){if(x===c)return 1;break}if(Z.match_length=0,F=Y(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,F&&(h(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,x===p?(h(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(h(Z,!1),0===Z.strm.avail_out)?1:2})(f,x):f.strategy===y?((Z,x)=>{let F,u,G,f;const j=Z.window;for(;;){if(Z.lookahead<=l){if(O(Z),Z.lookahead<=l&&x===c)return 1;if(0===Z.lookahead)break}if(Z.match_length=0,Z.lookahead>=3&&Z.strstart>0&&(G=Z.strstart-1,u=j[G],u===j[++G]&&u===j[++G]&&u===j[++G])){f=Z.strstart+l;do{}while(u===j[++G]&&u===j[++G]&&u===j[++G]&&u===j[++G]&&u===j[++G]&&u===j[++G]&&u===j[++G]&&u===j[++G]&&G<f);Z.match_length=l-(f-G),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=3?(F=Y(Z,1,Z.match_length-3),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(F=Y(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),F&&(h(Z,!1),0===Z.strm.avail_out))return 1}return Z.insert=0,x===p?(h(Z,!0),0===Z.strm.avail_out?3:4):Z.last_lit&&(h(Z,!1),0===Z.strm.avail_out)?1:2})(f,x):I[f.level].func(f,x);if(3!==F&&4!==F||(f.status=E),1===F||3===F)return 0===Z.avail_out&&(f.last_flush=-1),k;if(2===F&&(x===s?j(f):x!==U&&(G(f,0,0,!1),x===J&&(N(f.head),0===f.lookahead&&(f.strstart=0,f.block_start=0,f.insert=0))),A(Z),0===Z.avail_out))return f.last_flush=-1,k}return x!==p?k:f.wrap<=0?M:(2===f.wrap?(X(f,255&Z.adler),X(f,Z.adler>>8&255),X(f,Z.adler>>16&255),X(f,Z.adler>>24&255),X(f,255&Z.total_in),X(f,Z.total_in>>8&255),X(f,Z.total_in>>16&255),X(f,Z.total_in>>24&255)):(D(f,Z.adler>>>16),D(f,65535&Z.adler)),A(Z),f.wrap>0&&(f.wrap=-f.wrap),0!==f.pending?k:M)},Z.exports.deflateEnd=Z=>{if(!Z||!Z.state)return m;const x=Z.state.status;return 42!==x&&69!==x&&73!==x&&91!==x&&x!==e&&x!==b&&x!==E?w(Z,m):(Z.state=null,x===b?w(Z,C):k)},Z.exports.deflateSetDictionary=(Z,x)=>{let F=x.length;if(!Z||!Z.state)return m;const u=Z.state,G=u.wrap;if(2===G||1===G&&42!==u.status||u.lookahead)return m;if(1===G&&(Z.adler=d(Z.adler,x,F,0)),u.wrap=0,F>=u.w_size){0===G&&(N(u.head),u.strstart=0,u.block_start=0,u.insert=0);let Z=new Uint8Array(u.w_size);Z.set(x.subarray(F-u.w_size,F),0),x=Z,F=u.w_size}const f=Z.avail_in,Y=Z.next_in,j=Z.input;for(Z.avail_in=F,Z.next_in=0,Z.input=x,O(u);u.lookahead>=3;){let Z=u.strstart,x=u.lookahead-2;do{u.ins_h=W(u,u.ins_h,u.window[Z+3-1]),u.prev[Z&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=Z,Z++}while(--x);u.strstart=Z,u.lookahead=2,O(u)}return u.strstart+=u.lookahead,u.block_start=u.strstart,u.insert=u.lookahead,u.lookahead=0,u.match_length=u.prev_length=2,u.match_available=0,Z.next_in=Y,Z.input=j,Z.avail_in=f,u.wrap=G,k},Z.exports.deflateInfo="pako deflate (from Nodeca project)"},12438:Z=>{"use strict";Z.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12421:Z=>{"use strict";Z.exports=function(Z,x){let F,u,G,f,Y,j,d,t,o,c,s,J,p,U,k,M,m,C,L,H,S,K,y,q;const R=Z.state;F=Z.next_in,y=Z.input,u=F+(Z.avail_in-5),G=Z.next_out,q=Z.output,f=G-(x-Z.avail_out),Y=G+(Z.avail_out-257),j=R.dmax,d=R.wsize,t=R.whave,o=R.wnext,c=R.window,s=R.hold,J=R.bits,p=R.lencode,U=R.distcode,k=(1<<R.lenbits)-1,M=(1<<R.distbits)-1;Z:do{J<15&&(s+=y[F++]<<J,J+=8,s+=y[F++]<<J,J+=8),m=p[s&k];x:for(;;){if(C=m>>>24,s>>>=C,J-=C,C=m>>>16&255,0===C)q[G++]=65535&m;else{if(!(16&C)){if(0===(64&C)){m=p[(65535&m)+(s&(1<<C)-1)];continue x}if(32&C){R.mode=12;break Z}Z.tx="invalid literal/length code",R.mode=30;break Z}L=65535&m,C&=15,C&&(J<C&&(s+=y[F++]<<J,J+=8),L+=s&(1<<C)-1,s>>>=C,J-=C),J<15&&(s+=y[F++]<<J,J+=8,s+=y[F++]<<J,J+=8),m=U[s&M];F:for(;;){if(C=m>>>24,s>>>=C,J-=C,C=m>>>16&255,!(16&C)){if(0===(64&C)){m=U[(65535&m)+(s&(1<<C)-1)];continue F}Z.tx="invalid distance code",R.mode=30;break Z}if(H=65535&m,C&=15,J<C&&(s+=y[F++]<<J,J+=8,J<C&&(s+=y[F++]<<J,J+=8)),H+=s&(1<<C)-1,H>j){Z.tx="invalid distance too far back",R.mode=30;break Z}if(s>>>=C,J-=C,C=G-f,H>C){if(C=H-C,C>t&&R.sane){Z.tx="invalid distance too far back",R.mode=30;break Z}if(S=0,K=c,0===o){if(S+=d-C,C<L){L-=C;do{q[G++]=c[S++]}while(--C);S=G-H,K=q}}else if(o<C){if(S+=d+o-C,C-=o,C<L){L-=C;do{q[G++]=c[S++]}while(--C);if(S=0,o<L){C=o,L-=C;do{q[G++]=c[S++]}while(--C);S=G-H,K=q}}}else if(S+=o-C,C<L){L-=C;do{q[G++]=c[S++]}while(--C);S=G-H,K=q}for(;L>2;)q[G++]=K[S++],q[G++]=K[S++],q[G++]=K[S++],L-=3;L&&(q[G++]=K[S++],L>1&&(q[G++]=K[S++]))}else{S=G-H;do{q[G++]=q[S++],q[G++]=q[S++],q[G++]=q[S++],L-=3}while(L>2);L&&(q[G++]=q[S++],L>1&&(q[G++]=q[S++]))}break}}break}}while(F<u&&G<Y);L=J>>3,F-=L,J-=L<<3,s&=(1<<J)-1,Z.next_in=F,Z.next_out=G,Z.avail_in=F<u?u-F+5:5-(F-u),Z.avail_out=G<Y?Y-G+257:257-(G-Y),R.hold=s,R.bits=J}},12412:(Z,x,F)=>{"use strict";const u=F(12367),G=F(12373),f=F(12421),Y=F(12429),{Z_FINISH:j,Z_BLOCK:d,Z_TREES:t,Z_OK:o,Z_STREAM_END:c,Z_NEED_DICT:s,Z_STREAM_ERROR:J,Z_DATA_ERROR:p,Z_MEM_ERROR:U,Z_BUF_ERROR:k,Z_DEFLATED:M}=F(12385),m=12,C=30,L=Z=>(Z>>>24&255)+(Z>>>8&65280)+((65280&Z)<<8)+((255&Z)<<24);function H(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const S=Z=>{if(!Z||!Z.state)return J;const x=Z.state;return Z.total_in=Z.total_out=x.total=0,Z.tx="",x.wrap&&(Z.adler=1&x.wrap),x.mode=1,x.last=0,x.havedict=0,x.dmax=32768,x.head=null,x.hold=0,x.bits=0,x.lencode=x.lendyn=new Int32Array(852),x.distcode=x.distdyn=new Int32Array(592),x.sane=1,x.back=-1,o},K=Z=>{if(!Z||!Z.state)return J;const x=Z.state;return x.wsize=0,x.whave=0,x.wnext=0,S(Z)},y=(Z,x)=>{let F;if(!Z||!Z.state)return J;const u=Z.state;return x<0?(F=0,x=-x):(F=1+(x>>4),x<48&&(x&=15)),x&&(x<8||x>15)?J:(null!==u.window&&u.wbits!==x&&(u.window=null),u.wrap=F,u.wbits=x,K(Z))},q=(Z,x)=>{if(!Z)return J;const F=new H;Z.state=F,F.window=null;const u=y(Z,x);return u!==o&&(Z.state=null),u};let R,B,v=!0;const l=Z=>{if(v){R=new Int32Array(512),B=new Int32Array(32);let x=0;for(;x<144;)Z.lens[x++]=8;for(;x<256;)Z.lens[x++]=9;for(;x<280;)Z.lens[x++]=7;for(;x<288;)Z.lens[x++]=8;for(Y(1,Z.lens,0,288,R,0,Z.work,{bits:9}),x=0;x<32;)Z.lens[x++]=5;Y(2,Z.lens,0,32,B,0,Z.work,{bits:5}),v=!1}Z.lencode=R,Z.lenbits=9,Z.distcode=B,Z.distbits=5},i=(Z,x,F,u)=>{let G;const f=Z.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new Uint8Array(f.wsize)),u>=f.wsize?(f.window.set(x.subarray(F-f.wsize,F),0),f.wnext=0,f.whave=f.wsize):(G=f.wsize-f.wnext,G>u&&(G=u),f.window.set(x.subarray(F-u,F-u+G),f.wnext),(u-=G)?(f.window.set(x.subarray(F-u,F),0),f.wnext=u,f.whave=f.wsize):(f.wnext+=G,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=G))),0};Z.exports.inflateReset=K,Z.exports.inflateReset2=y,Z.exports.inflateResetKeep=S,Z.exports.inflateInit=Z=>q(Z,15),Z.exports.inflateInit2=q,Z.exports.inflate=(Z,x)=>{let F,H,S,K,y,q,R,B,v,e,b,E,w,T,N,W,A,h,X,D,Q,g,O=0;const n=new Uint8Array(4);let V,a;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!Z||!Z.state||!Z.output||!Z.input&&0!==Z.avail_in)return J;F=Z.state,F.mode===m&&(F.mode=13),y=Z.next_out,S=Z.output,R=Z.avail_out,K=Z.next_in,H=Z.input,q=Z.avail_in,B=F.hold,v=F.bits,e=q,b=R,g=o;Z:for(;;)switch(F.mode){case 1:if(0===F.wrap){F.mode=13;break}for(;v<16;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(2&F.wrap&&35615===B){F.check=0,n[0]=255&B,n[1]=B>>>8&255,F.check=G(F.check,n,2,0),B=0,v=0,F.mode=2;break}if(F.flags=0,F.head&&(F.head.done=!1),!(1&F.wrap)||(((255&B)<<8)+(B>>8))%31){Z.tx="incorrect header check",F.mode=C;break}if((15&B)!==M){Z.tx="unknown compression method",F.mode=C;break}if(B>>>=4,v-=4,Q=8+(15&B),0===F.wbits)F.wbits=Q;else if(Q>F.wbits){Z.tx="invalid window size",F.mode=C;break}F.dmax=1<<F.wbits,Z.adler=F.check=1,F.mode=512&B?10:m,B=0,v=0;break;case 2:for(;v<16;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(F.flags=B,(255&F.flags)!==M){Z.tx="unknown compression method",F.mode=C;break}if(57344&F.flags){Z.tx="unknown header flags set",F.mode=C;break}F.head&&(F.head.text=B>>8&1),512&F.flags&&(n[0]=255&B,n[1]=B>>>8&255,F.check=G(F.check,n,2,0)),B=0,v=0,F.mode=3;case 3:for(;v<32;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.head&&(F.head.time=B),512&F.flags&&(n[0]=255&B,n[1]=B>>>8&255,n[2]=B>>>16&255,n[3]=B>>>24&255,F.check=G(F.check,n,4,0)),B=0,v=0,F.mode=4;case 4:for(;v<16;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.head&&(F.head.xflags=255&B,F.head.os=B>>8),512&F.flags&&(n[0]=255&B,n[1]=B>>>8&255,F.check=G(F.check,n,2,0)),B=0,v=0,F.mode=5;case 5:if(1024&F.flags){for(;v<16;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.length=B,F.head&&(F.head.extra_len=B),512&F.flags&&(n[0]=255&B,n[1]=B>>>8&255,F.check=G(F.check,n,2,0)),B=0,v=0}else F.head&&(F.head.extra=null);F.mode=6;case 6:if(1024&F.flags&&(E=F.length,E>q&&(E=q),E&&(F.head&&(Q=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Uint8Array(F.head.extra_len)),F.head.extra.set(H.subarray(K,K+E),Q)),512&F.flags&&(F.check=G(F.check,H,E,K)),q-=E,K+=E,F.length-=E),F.length))break Z;F.length=0,F.mode=7;case 7:if(2048&F.flags){if(0===q)break Z;E=0;do{Q=H[K+E++],F.head&&Q&&F.length<65536&&(F.head.name+=String.fromCharCode(Q))}while(Q&&E<q);if(512&F.flags&&(F.check=G(F.check,H,E,K)),q-=E,K+=E,Q)break Z}else F.head&&(F.head.name=null);F.length=0,F.mode=8;case 8:if(4096&F.flags){if(0===q)break Z;E=0;do{Q=H[K+E++],F.head&&Q&&F.length<65536&&(F.head.comment+=String.fromCharCode(Q))}while(Q&&E<q);if(512&F.flags&&(F.check=G(F.check,H,E,K)),q-=E,K+=E,Q)break Z}else F.head&&(F.head.comment=null);F.mode=9;case 9:if(512&F.flags){for(;v<16;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(B!==(65535&F.check)){Z.tx="header crc mismatch",F.mode=C;break}B=0,v=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),Z.adler=F.check=0,F.mode=m;break;case 10:for(;v<32;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}Z.adler=F.check=L(B),B=0,v=0,F.mode=11;case 11:if(0===F.havedict)return Z.next_out=y,Z.avail_out=R,Z.next_in=K,Z.avail_in=q,F.hold=B,F.bits=v,s;Z.adler=F.check=1,F.mode=m;case m:if(x===d||x===t)break Z;case 13:if(F.last){B>>>=7&v,v-=7&v,F.mode=27;break}for(;v<3;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}switch(F.last=1&B,B>>>=1,v-=1,3&B){case 0:F.mode=14;break;case 1:if(l(F),F.mode=20,x===t){B>>>=2,v-=2;break Z}break;case 2:F.mode=17;break;case 3:Z.tx="invalid block type",F.mode=C}B>>>=2,v-=2;break;case 14:for(B>>>=7&v,v-=7&v;v<32;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if((65535&B)!==(B>>>16^65535)){Z.tx="invalid stored block lengths",F.mode=C;break}if(F.length=65535&B,B=0,v=0,F.mode=15,x===t)break Z;case 15:F.mode=16;case 16:if(E=F.length,E){if(E>q&&(E=q),E>R&&(E=R),0===E)break Z;S.set(H.subarray(K,K+E),y),q-=E,K+=E,R-=E,y+=E,F.length-=E;break}F.mode=m;break;case 17:for(;v<14;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(F.nlen=257+(31&B),B>>>=5,v-=5,F.ndist=1+(31&B),B>>>=5,v-=5,F.ncode=4+(15&B),B>>>=4,v-=4,F.nlen>286||F.ndist>30){Z.tx="too many length or distance symbols",F.mode=C;break}F.have=0,F.mode=18;case 18:for(;F.have<F.ncode;){for(;v<3;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.lens[I[F.have++]]=7&B,B>>>=3,v-=3}for(;F.have<19;)F.lens[I[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,V={bits:F.lenbits},g=Y(0,F.lens,0,19,F.lencode,0,F.work,V),F.lenbits=V.bits,g){Z.tx="invalid code lengths set",F.mode=C;break}F.have=0,F.mode=19;case 19:for(;F.have<F.nlen+F.ndist;){for(;O=F.lencode[B&(1<<F.lenbits)-1],N=O>>>24,W=O>>>16&255,A=65535&O,!(N<=v);){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(A<16)B>>>=N,v-=N,F.lens[F.have++]=A;else{if(16===A){for(a=N+2;v<a;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(B>>>=N,v-=N,0===F.have){Z.tx="invalid bit length repeat",F.mode=C;break}Q=F.lens[F.have-1],E=3+(3&B),B>>>=2,v-=2}else if(17===A){for(a=N+3;v<a;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}B>>>=N,v-=N,Q=0,E=3+(7&B),B>>>=3,v-=3}else{for(a=N+7;v<a;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}B>>>=N,v-=N,Q=0,E=11+(127&B),B>>>=7,v-=7}if(F.have+E>F.nlen+F.ndist){Z.tx="invalid bit length repeat",F.mode=C;break}for(;E--;)F.lens[F.have++]=Q}}if(F.mode===C)break;if(0===F.lens[256]){Z.tx="invalid code -- missing end-of-block",F.mode=C;break}if(F.lenbits=9,V={bits:F.lenbits},g=Y(1,F.lens,0,F.nlen,F.lencode,0,F.work,V),F.lenbits=V.bits,g){Z.tx="invalid literal/lengths set",F.mode=C;break}if(F.distbits=6,F.distcode=F.distdyn,V={bits:F.distbits},g=Y(2,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,V),F.distbits=V.bits,g){Z.tx="invalid distances set",F.mode=C;break}if(F.mode=20,x===t)break Z;case 20:F.mode=21;case 21:if(q>=6&&R>=258){Z.next_out=y,Z.avail_out=R,Z.next_in=K,Z.avail_in=q,F.hold=B,F.bits=v,f(Z,b),y=Z.next_out,S=Z.output,R=Z.avail_out,K=Z.next_in,H=Z.input,q=Z.avail_in,B=F.hold,v=F.bits,F.mode===m&&(F.back=-1);break}for(F.back=0;O=F.lencode[B&(1<<F.lenbits)-1],N=O>>>24,W=O>>>16&255,A=65535&O,!(N<=v);){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(W&&0===(240&W)){for(h=N,X=W,D=A;O=F.lencode[D+((B&(1<<h+X)-1)>>h)],N=O>>>24,W=O>>>16&255,A=65535&O,!(h+N<=v);){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}B>>>=h,v-=h,F.back+=h}if(B>>>=N,v-=N,F.back+=N,F.length=A,0===W){F.mode=26;break}if(32&W){F.back=-1,F.mode=m;break}if(64&W){Z.tx="invalid literal/length code",F.mode=C;break}F.extra=15&W,F.mode=22;case 22:if(F.extra){for(a=F.extra;v<a;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.length+=B&(1<<F.extra)-1,B>>>=F.extra,v-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=23;case 23:for(;O=F.distcode[B&(1<<F.distbits)-1],N=O>>>24,W=O>>>16&255,A=65535&O,!(N<=v);){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(0===(240&W)){for(h=N,X=W,D=A;O=F.distcode[D+((B&(1<<h+X)-1)>>h)],N=O>>>24,W=O>>>16&255,A=65535&O,!(h+N<=v);){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}B>>>=h,v-=h,F.back+=h}if(B>>>=N,v-=N,F.back+=N,64&W){Z.tx="invalid distance code",F.mode=C;break}F.offset=A,F.extra=15&W,F.mode=24;case 24:if(F.extra){for(a=F.extra;v<a;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}F.offset+=B&(1<<F.extra)-1,B>>>=F.extra,v-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){Z.tx="invalid distance too far back",F.mode=C;break}F.mode=25;case 25:if(0===R)break Z;if(E=b-R,F.offset>E){if(E=F.offset-E,E>F.whave&&F.sane){Z.tx="invalid distance too far back",F.mode=C;break}E>F.wnext?(E-=F.wnext,w=F.wsize-E):w=F.wnext-E,E>F.length&&(E=F.length),T=F.window}else T=S,w=y-F.offset,E=F.length;E>R&&(E=R),R-=E,F.length-=E;do{S[y++]=T[w++]}while(--E);0===F.length&&(F.mode=21);break;case 26:if(0===R)break Z;S[y++]=F.length,R--,F.mode=21;break;case 27:if(F.wrap){for(;v<32;){if(0===q)break Z;q--,B|=H[K++]<<v,v+=8}if(b-=R,Z.total_out+=b,F.total+=b,b&&(Z.adler=F.check=F.flags?G(F.check,S,b,y-b):u(F.check,S,b,y-b)),b=R,(F.flags?B:L(B))!==F.check){Z.tx="incorrect data check",F.mode=C;break}B=0,v=0}F.mode=28;case 28:if(F.wrap&&F.flags){for(;v<32;){if(0===q)break Z;q--,B+=H[K++]<<v,v+=8}if(B!==(4294967295&F.total)){Z.tx="incorrect length check",F.mode=C;break}B=0,v=0}F.mode=29;case 29:g=c;break Z;case C:g=p;break Z;case 31:return U;default:return J}return Z.next_out=y,Z.avail_out=R,Z.next_in=K,Z.avail_in=q,F.hold=B,F.bits=v,(F.wsize||b!==Z.avail_out&&F.mode<C&&(F.mode<27||x!==j))&&i(Z,Z.output,Z.next_out,b-Z.avail_out)?(F.mode=31,U):(e-=Z.avail_in,b-=Z.avail_out,Z.total_in+=e,Z.total_out+=b,F.total+=b,F.wrap&&b&&(Z.adler=F.check=F.flags?G(F.check,S,b,Z.next_out-b):u(F.check,S,b,Z.next_out-b)),Z.data_type=F.bits+(F.last?64:0)+(F.mode===m?128:0)+(20===F.mode||15===F.mode?256:0),(0===e&&0===b||x===j)&&g===o&&(g=k),g)},Z.exports.inflateEnd=Z=>{if(!Z||!Z.state)return J;let x=Z.state;return x.window&&(x.window=null),Z.state=null,o},Z.exports.inflateGetHeader=(Z,x)=>{if(!Z||!Z.state)return J;const F=Z.state;return 0===(2&F.wrap)?J:(F.head=x,x.done=!1,o)},Z.exports.inflateSetDictionary=(Z,x)=>{const F=x.length;let G,f,Y;return Z&&Z.state?(G=Z.state,0!==G.wrap&&11!==G.mode?J:11===G.mode&&(f=1,f=u(f,x,F,0),f!==G.check)?p:(Y=i(Z,x,F,F),Y?(G.mode=31,U):(G.havedict=1,o))):J},Z.exports.inflateInfo="pako inflate (from Nodeca project)"},12429:Z=>{"use strict";const x=15,F=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),G=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);Z.exports=(Z,Y,j,d,t,o,c,s)=>{const J=s.bits;let p,U,k,M,m,C,L=0,H=0,S=0,K=0,y=0,q=0,R=0,B=0,v=0,l=0,i=null,e=0;const b=new Uint16Array(16),E=new Uint16Array(16);let w,T,N,W=null,A=0;for(L=0;L<=x;L++)b[L]=0;for(H=0;H<d;H++)b[Y[j+H]]++;for(y=J,K=x;K>=1&&0===b[K];K--);if(y>K&&(y=K),0===K)return t[o++]=20971520,t[o++]=20971520,s.bits=1,0;for(S=1;S<K&&0===b[S];S++);for(y<S&&(y=S),B=1,L=1;L<=x;L++)if(B<<=1,B-=b[L],B<0)return-1;if(B>0&&(0===Z||1!==K))return-1;for(E[1]=0,L=1;L<x;L++)E[L+1]=E[L]+b[L];for(H=0;H<d;H++)0!==Y[j+H]&&(c[E[Y[j+H]]++]=H);if(0===Z?(i=W=c,C=19):1===Z?(i=F,e-=257,W=u,A-=257,C=256):(i=G,W=f,C=-1),l=0,H=0,L=S,m=o,q=y,R=0,k=-1,v=1<<y,M=v-1,1===Z&&v>852||2===Z&&v>592)return 1;for(;;){w=L-R,c[H]<C?(T=0,N=c[H]):c[H]>C?(T=W[A+c[H]],N=i[e+c[H]]):(T=96,N=0),p=1<<L-R,U=1<<q,S=U;do{U-=p,t[m+(l>>R)+U]=w<<24|T<<16|N}while(0!==U);for(p=1<<L-1;l&p;)p>>=1;if(0!==p?(l&=p-1,l+=p):l=0,H++,0===--b[L]){if(L===K)break;L=Y[j+c[H]]}if(L>y&&(l&M)!==k){for(0===R&&(R=y),m+=S,q=L-R,B=1<<q;q+R<K&&(B-=b[q+R],!(B<=0));)q++,B<<=1;if(v+=1<<q,1===Z&&v>852||2===Z&&v>592)return 1;k=l&M,t[k]=y<<24|q<<16|m-o}}return 0!==l&&(t[m+l]=L-R<<24|64<<16),s.bits=y,0}},12377:Z=>{"use strict";Z.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12359:Z=>{"use strict";function x(Z){let x=Z.length;for(;--x>=0;)Z[x]=0}const F=256,u=286,G=30,f=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),j=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),d=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);x(o);const c=new Array(60);x(c);const s=new Array(512);x(s);const J=new Array(256);x(J);const p=new Array(29);x(p);const U=new Array(G);function k(Z,x,F,u,G){this.static_tree=Z,this.extra_bits=x,this.extra_base=F,this.elems=u,this.max_length=G,this.has_stree=Z&&Z.length}let M,m,C;function L(Z,x){this.dyn_tree=Z,this.max_code=0,this.stat_desc=x}x(U);const H=Z=>Z<256?s[Z]:s[256+(Z>>>7)],S=(Z,x)=>{Z.pending_buf[Z.pending++]=255&x,Z.pending_buf[Z.pending++]=x>>>8&255},K=(Z,x,F)=>{Z.bi_valid>16-F?(Z.bi_buf|=x<<Z.bi_valid&65535,S(Z,Z.bi_buf),Z.bi_buf=x>>16-Z.bi_valid,Z.bi_valid+=F-16):(Z.bi_buf|=x<<Z.bi_valid&65535,Z.bi_valid+=F)},y=(Z,x,F)=>{K(Z,F[2*x],F[2*x+1])},q=(Z,x)=>{let F=0;do{F|=1&Z,Z>>>=1,F<<=1}while(--x>0);return F>>>1},R=(Z,x,F)=>{const u=new Array(16);let G,Y,j=0;for(G=1;G<=f;G++)u[G]=j=j+F[G-1]<<1;for(Y=0;Y<=x;Y++){let x=Z[2*Y+1];0!==x&&(Z[2*Y]=q(u[x]++,x))}},B=Z=>{let x;for(x=0;x<u;x++)Z.dyn_ltree[2*x]=0;for(x=0;x<G;x++)Z.dyn_dtree[2*x]=0;for(x=0;x<19;x++)Z.bl_tree[2*x]=0;Z.dyn_ltree[512]=1,Z.opt_len=Z.static_len=0,Z.last_lit=Z.matches=0},v=Z=>{Z.bi_valid>8?S(Z,Z.bi_buf):Z.bi_valid>0&&(Z.pending_buf[Z.pending++]=Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0},l=(Z,x,F,u)=>{const G=2*x,f=2*F;return Z[G]<Z[f]||Z[G]===Z[f]&&u[x]<=u[F]},i=(Z,x,F)=>{const u=Z.heap[F];let G=F<<1;for(;G<=Z.heap_len&&(G<Z.heap_len&&l(x,Z.heap[G+1],Z.heap[G],Z.depth)&&G++,!l(x,u,Z.heap[G],Z.depth));)Z.heap[F]=Z.heap[G],F=G,G<<=1;Z.heap[F]=u},e=(Z,x,u)=>{let G,f,d,t,o=0;if(0!==Z.last_lit)do{G=Z.pending_buf[Z.d_buf+2*o]<<8|Z.pending_buf[Z.d_buf+2*o+1],f=Z.pending_buf[Z.l_buf+o],o++,0===G?y(Z,f,x):(d=J[f],y(Z,d+F+1,x),t=Y[d],0!==t&&(f-=p[d],K(Z,f,t)),G--,d=H(G),y(Z,d,u),t=j[d],0!==t&&(G-=U[d],K(Z,G,t)))}while(o<Z.last_lit);y(Z,256,x)},b=(Z,x)=>{const F=x.dyn_tree,u=x.stat_desc.static_tree,G=x.stat_desc.has_stree,Y=x.stat_desc.elems;let j,d,t,o=-1;for(Z.heap_len=0,Z.heap_max=573,j=0;j<Y;j++)0!==F[2*j]?(Z.heap[++Z.heap_len]=o=j,Z.depth[j]=0):F[2*j+1]=0;for(;Z.heap_len<2;)t=Z.heap[++Z.heap_len]=o<2?++o:0,F[2*t]=1,Z.depth[t]=0,Z.opt_len--,G&&(Z.static_len-=u[2*t+1]);for(x.max_code=o,j=Z.heap_len>>1;j>=1;j--)i(Z,F,j);t=Y;do{j=Z.heap[1],Z.heap[1]=Z.heap[Z.heap_len--],i(Z,F,1),d=Z.heap[1],Z.heap[--Z.heap_max]=j,Z.heap[--Z.heap_max]=d,F[2*t]=F[2*j]+F[2*d],Z.depth[t]=(Z.depth[j]>=Z.depth[d]?Z.depth[j]:Z.depth[d])+1,F[2*j+1]=F[2*d+1]=t,Z.heap[1]=t++,i(Z,F,1)}while(Z.heap_len>=2);Z.heap[--Z.heap_max]=Z.heap[1],((Z,x)=>{const F=x.dyn_tree,u=x.max_code,G=x.stat_desc.static_tree,Y=x.stat_desc.has_stree,j=x.stat_desc.extra_bits,d=x.stat_desc.extra_base,t=x.stat_desc.max_length;let o,c,s,J,p,U,k=0;for(J=0;J<=f;J++)Z.bl_count[J]=0;for(F[2*Z.heap[Z.heap_max]+1]=0,o=Z.heap_max+1;o<573;o++)c=Z.heap[o],J=F[2*F[2*c+1]+1]+1,J>t&&(J=t,k++),F[2*c+1]=J,c>u||(Z.bl_count[J]++,p=0,c>=d&&(p=j[c-d]),U=F[2*c],Z.opt_len+=U*(J+p),Y&&(Z.static_len+=U*(G[2*c+1]+p)));if(0!==k){do{for(J=t-1;0===Z.bl_count[J];)J--;Z.bl_count[J]--,Z.bl_count[J+1]+=2,Z.bl_count[t]--,k-=2}while(k>0);for(J=t;0!==J;J--)for(c=Z.bl_count[J];0!==c;)s=Z.heap[--o],s>u||(F[2*s+1]!==J&&(Z.opt_len+=(J-F[2*s+1])*F[2*s],F[2*s+1]=J),c--)}})(Z,x),R(F,o,Z.bl_count)},E=(Z,x,F)=>{let u,G,f=-1,Y=x[1],j=0,d=7,t=4;for(0===Y&&(d=138,t=3),x[2*(F+1)+1]=65535,u=0;u<=F;u++)G=Y,Y=x[2*(u+1)+1],++j<d&&G===Y||(j<t?Z.bl_tree[2*G]+=j:0!==G?(G!==f&&Z.bl_tree[2*G]++,Z.bl_tree[32]++):j<=10?Z.bl_tree[34]++:Z.bl_tree[36]++,j=0,f=G,0===Y?(d=138,t=3):G===Y?(d=6,t=3):(d=7,t=4))},w=(Z,x,F)=>{let u,G,f=-1,Y=x[1],j=0,d=7,t=4;for(0===Y&&(d=138,t=3),u=0;u<=F;u++)if(G=Y,Y=x[2*(u+1)+1],!(++j<d&&G===Y)){if(j<t)do{y(Z,G,Z.bl_tree)}while(0!==--j);else 0!==G?(G!==f&&(y(Z,G,Z.bl_tree),j--),y(Z,16,Z.bl_tree),K(Z,j-3,2)):j<=10?(y(Z,17,Z.bl_tree),K(Z,j-3,3)):(y(Z,18,Z.bl_tree),K(Z,j-11,7));j=0,f=G,0===Y?(d=138,t=3):G===Y?(d=6,t=3):(d=7,t=4)}};let T=!1;const N=(Z,x,F,u)=>{K(Z,0+(u?1:0),3),((Z,x,F,u)=>{v(Z),u&&(S(Z,F),S(Z,~F)),Z.pending_buf.set(Z.window.subarray(x,x+F),Z.pending),Z.pending+=F})(Z,x,F,!0)};Z.exports._tr_init=Z=>{T||((()=>{let Z,x,F,t,L;const H=new Array(16);for(F=0,t=0;t<28;t++)for(p[t]=F,Z=0;Z<1<<Y[t];Z++)J[F++]=t;for(J[F-1]=t,L=0,t=0;t<16;t++)for(U[t]=L,Z=0;Z<1<<j[t];Z++)s[L++]=t;for(L>>=7;t<G;t++)for(U[t]=L<<7,Z=0;Z<1<<j[t]-7;Z++)s[256+L++]=t;for(x=0;x<=f;x++)H[x]=0;for(Z=0;Z<=143;)o[2*Z+1]=8,Z++,H[8]++;for(;Z<=255;)o[2*Z+1]=9,Z++,H[9]++;for(;Z<=279;)o[2*Z+1]=7,Z++,H[7]++;for(;Z<=287;)o[2*Z+1]=8,Z++,H[8]++;for(R(o,287,H),Z=0;Z<G;Z++)c[2*Z+1]=5,c[2*Z]=q(Z,5);M=new k(o,Y,257,u,f),m=new k(c,j,0,G,f),C=new k(new Array(0),d,0,19,7)})(),T=!0),Z.l_desc=new L(Z.dyn_ltree,M),Z.d_desc=new L(Z.dyn_dtree,m),Z.bl_desc=new L(Z.bl_tree,C),Z.bi_buf=0,Z.bi_valid=0,B(Z)},Z.exports._tr_stored_block=N,Z.exports._tr_flush_block=(Z,x,u,G)=>{let f,Y,j=0;Z.level>0?(2===Z.strm.data_type&&(Z.strm.data_type=(Z=>{let x,u=4093624447;for(x=0;x<=31;x++,u>>>=1)if(1&u&&0!==Z.dyn_ltree[2*x])return 0;if(0!==Z.dyn_ltree[18]||0!==Z.dyn_ltree[20]||0!==Z.dyn_ltree[26])return 1;for(x=32;x<F;x++)if(0!==Z.dyn_ltree[2*x])return 1;return 0})(Z)),b(Z,Z.l_desc),b(Z,Z.d_desc),j=(Z=>{let x;for(E(Z,Z.dyn_ltree,Z.l_desc.max_code),E(Z,Z.dyn_dtree,Z.d_desc.max_code),b(Z,Z.bl_desc),x=18;x>=3&&0===Z.bl_tree[2*t[x]+1];x--);return Z.opt_len+=3*(x+1)+5+5+4,x})(Z),f=Z.opt_len+3+7>>>3,Y=Z.static_len+3+7>>>3,Y<=f&&(f=Y)):f=Y=u+5,u+4<=f&&-1!==x?N(Z,x,u,G):4===Z.strategy||Y===f?(K(Z,2+(G?1:0),3),e(Z,o,c)):(K(Z,4+(G?1:0),3),((Z,x,F,u)=>{let G;for(K(Z,x-257,5),K(Z,F-1,5),K(Z,u-4,4),G=0;G<u;G++)K(Z,Z.bl_tree[2*t[G]+1],3);w(Z,Z.dyn_ltree,x-1),w(Z,Z.dyn_dtree,F-1)})(Z,Z.l_desc.max_code+1,Z.d_desc.max_code+1,j+1),e(Z,Z.dyn_ltree,Z.dyn_dtree)),B(Z),G&&v(Z)},Z.exports._tr_tally=(Z,x,u)=>(Z.pending_buf[Z.d_buf+2*Z.last_lit]=x>>>8&255,Z.pending_buf[Z.d_buf+2*Z.last_lit+1]=255&x,Z.pending_buf[Z.l_buf+Z.last_lit]=255&u,Z.last_lit++,0===x?Z.dyn_ltree[2*u]++:(Z.matches++,x--,Z.dyn_ltree[2*(J[u]+F+1)]++,Z.dyn_dtree[2*H(x)]++),Z.last_lit===Z.lit_bufsize-1),Z.exports._tr_align=Z=>{K(Z,2,3),y(Z,256,o),(Z=>{16===Z.bi_valid?(S(Z,Z.bi_buf),Z.bi_buf=0,Z.bi_valid=0):Z.bi_valid>=8&&(Z.pending_buf[Z.pending++]=255&Z.bi_buf,Z.bi_buf>>=8,Z.bi_valid-=8)})(Z)}},12396:Z=>{"use strict";Z.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.tx="",this.state=null,this.data_type=2,this.adler=0}},12029:Z=>{function x(Z,x,F){for(var u=Z.length,G=-1/0,f=1/0,Y=0;Y<u;Y++){var j=(F[0][Y]-Z[Y])/x[Y],d=(F[1][Y]-Z[Y])/x[Y];if(j>d){var t=j;j=d,d=t}if(d<G||j>f)return 1/0;j>G&&(G=j),d<f&&(f=d)}return G>f?1/0:G}Z.exports=function(Z,F,u,G){var f=x(F,u,G);if(f===1/0)Z=null;else{Z=Z||[];for(var Y=0;Y<F.length;Y++)Z[Y]=F[Y]+u[Y]*f}return Z},Z.exports.distance=x},13420:(Z,x,F)=>{"use strict";F.d(x,{c:()=>Y});var u=F(29);const G=u.useLayoutEffect;const f=function(Z){var x=(0,u.useRef)(Z);return G((function(){x.current=Z})),x};var Y=function(Z){var x=f(Z);(0,u.Gx)((function(){var Z=function(Z){var F;if(null!=x.current&&(F=x.current(Z)),Z.defaultPrevented&&(Z.returnValue=""),"string"===typeof F)return Z.returnValue=F,F};return window.addEventListener("beforeunload",Z),function(){window.removeEventListener("beforeunload",Z)}}),[])}},13381:(Z,x,F)=>{"use strict";var u=F(13387),G=Array.prototype.concat,f=Array.prototype.slice,Y=Z.exports=function(Z){for(var x=[],F=0,Y=Z.length;F<Y;F++){var j=Z[F];u(j)?x=G.call(x,f.call(j)):x.push(j)}return x};Y.wrap=function(Z){return function(){return Z(Y(arguments))}}},13387:Z=>{Z.exports=function(Z){return!(!Z||"string"===typeof Z)&&(Z instanceof Array||Array.isArray(Z)||Z.length>=0&&(Z.splice instanceof Function||Object.getOwnPropertyDescriptor(Z,Z.length-1)&&"String"!==Z.constructor.name))}},12306:(Z,x,F)=>{var u=F(12308);function G(Z){for(var x,F,G=0,f=Z.length,Y=0;Y<Z.length;){for(x=Z[Y],F=0;Y<f&&Z[Y]===x;)++Y,++F;G+=u.log2(F)/7|0,G+=u.log2(x>>>0)/7|0,G+=2}return G}x.size=G,x.encode=function(Z,x){x||(x=new Uint8Array(G(Z)));for(var F,u,f=0,Y=x.length,j=0;j<Z.length;){for(F=Z[j],u=0;j<Z.length&&Z[j]===F;)++j,++u;for(;f<Y&&u>=128;)x[f++]=128+(127&u),u>>>=7;if(f>=Y)throw new Error("RLE buffer overflow");for(x[f++]=u,F>>>=0;f<Y&&F>=128;)x[f++]=128+(127&F),F>>>=7;if(f>=Y)throw new Error("RLE buffer overflow");x[f++]=F}return x},x.decode=function(Z,x){for(var F,u,G,f,Y=x.length,j=Z.length,d=0,t=0;t<j;){for(F=0,u=0;t<j&&Z[t]>=128;)F+=(127&Z[t++])<<u,u+=7;if(F+=Z[t++]<<u,t>=j)throw new Error("RLE buffer underrun");if(d+F>Y)throw new Error("Chunk buffer overflow");for(G=0,u=0;t<j&&Z[t]>=128;)G+=(127&Z[t++])<<u,u+=7;if(t>=j)throw new Error("RLE buffer underrun");for(G+=Z[t++]<<u,f=0;f<F;++f)x[d++]=G}return x}},12308:(Z,x)=>{"use strict";function F(Z){var x=32;return(Z&=-Z)&&x--,65535&Z&&(x-=16),16711935&Z&&(x-=8),252645135&Z&&(x-=4),858993459&Z&&(x-=2),1431655765&Z&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(Z){return(Z>0)-(Z<0)},x.abs=function(Z){var x=Z>>31;return(Z^x)-x},x.min=function(Z,x){return x^(Z^x)&-(Z<x)},x.max=function(Z,x){return Z^(Z^x)&-(Z<x)},x.isPow2=function(Z){return!(Z&Z-1)&&!!Z},x.log2=function(Z){var x,F;return x=(Z>65535)<<4,x|=F=((Z>>>=x)>255)<<3,x|=F=((Z>>>=F)>15)<<2,(x|=F=((Z>>>=F)>3)<<1)|(Z>>>=F)>>1},x.log10=function(Z){return Z>=1e9?9:Z>=1e8?8:Z>=1e7?7:Z>=1e6?6:Z>=1e5?5:Z>=1e4?4:Z>=1e3?3:Z>=100?2:Z>=10?1:0},x.popCount=function(Z){return 16843009*((Z=(858993459&(Z-=Z>>>1&1431655765))+(Z>>>2&858993459))+(Z>>>4)&252645135)>>>24},x.countTrailingZeros=F,x.nextPow2=function(Z){return Z+=0===Z,--Z,Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)+1},x.prevPow2=function(Z){return Z|=Z>>>1,Z|=Z>>>2,Z|=Z>>>4,Z|=Z>>>8,(Z|=Z>>>16)-(Z>>>1)},x.parity=function(Z){return Z^=Z>>>16,Z^=Z>>>8,Z^=Z>>>4,27030>>>(Z&=15)&1};var u=new Array(256);!function(Z){for(var x=0;x<256;++x){var F=x,u=x,G=7;for(F>>>=1;F;F>>>=1)u<<=1,u|=1&F,--G;Z[x]=u<<G&255}}(u),x.reverse=function(Z){return u[255&Z]<<24|u[Z>>>8&255]<<16|u[Z>>>16&255]<<8|u[Z>>>24&255]},x.interleave2=function(Z,x){return(Z=1431655765&((Z=858993459&((Z=252645135&((Z=16711935&((Z&=65535)|Z<<8))|Z<<4))|Z<<2))|Z<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(Z,x){return(Z=65535&((Z=16711935&((Z=252645135&((Z=858993459&((Z=Z>>>x&1431655765)|Z>>>1))|Z>>>2))|Z>>>4))|Z>>>16))<<16>>16},x.interleave3=function(Z,x,F){return Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2),(Z|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},x.deinterleave3=function(Z,x){return(Z=1023&((Z=4278190335&((Z=251719695&((Z=3272356035&((Z=Z>>>x&1227133513)|Z>>>2))|Z>>>4))|Z>>>8))|Z>>>16))<<22>>22},x.nextCombination=function(Z){var x=Z|Z-1;return x+1|(~x&-~x)-1>>>F(Z)+1}},12332:Z=>{"use strict";Z.exports=function(Z,x,F,u){var G=self||window;try{try{var f;try{f=new G.Blob([Z])}catch(t){(f=new(G.BlobBuilder||G.WebKitBlobBuilder||G.MozBlobBuilder||G.MSBlobBuilder)).append(Z),f=f.getBlob()}var Y=G.URL||G.webkitURL,j=Y.createObjectURL(f),d=new G[x](j,F);return Y.revokeObjectURL(j),d}catch(t){return new G[x]("data:application/javascript,".concat(encodeURIComponent(Z)),F)}}catch(t){if(!u)throw Error("Inline worker is not supported");return new G[x](u,F)}}},12015:(Z,x,F)=>{"use strict";function u(Z,x,F,u,G){var f={};return Object.keys(u).forEach((function(Z){f[Z]=u[Z]})),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=F.slice().reverse().reduce((function(F,u){return u(Z,x,F)||F}),f),G&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(G):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(Z,x,f),f=null),f}F.d(x,{e:()=>u})},12013:(Z,x,F)=>{"use strict";function u(Z,x,F,u){F&&Object.defineProperty(Z,x,{enumerable:F.enumerable,configurable:F.configurable,writable:F.writable,value:F.initializer?F.initializer.call(u):void 0})}F.d(x,{e:()=>u})},13414:(Z,x,F)=>{"use strict";F.d(x,{d:()=>Y,e:()=>c,f:()=>j,j:()=>f,n:()=>d,o:()=>G,p:()=>t,r:()=>o});var u=F(11424);class G{constructor(){this._easingMode=G.EASINGMODE_EASEIN}setEasingMode(Z){const x=Math.min(Math.max(Z,0),2);this._easingMode=x}getEasingMode(){return this._easingMode}easeInCore(Z){throw new Error("You must implement this method")}ease(Z){switch(this._easingMode){case G.EASINGMODE_EASEIN:return this.easeInCore(Z);case G.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-Z)}return Z>=.5?.5*(1-this.easeInCore(2*(1-Z)))+.5:.5*this.easeInCore(2*Z)}}G.EASINGMODE_EASEIN=0,G.EASINGMODE_EASEOUT=1,G.EASINGMODE_EASEINOUT=2;class f extends G{easeInCore(Z){return Z=Math.max(0,Math.min(1,Z)),1-Math.sqrt(1-Z*Z)}}class Y extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=Z}easeInCore(Z){const x=Math.max(0,this.amplitude);return Math.pow(Z,3)-Z*x*Math.sin(3.141592653589793*Z)}}class j extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=Z,this.bounciness=x}easeInCore(Z){const x=Math.max(0,this.bounces);let F=this.bounciness;F<=1&&(F=1.001);const u=Math.pow(F,x),G=1-F,f=(1-u)/G+.5*u,Y=Z*f,j=Math.log(-Y*(1-F)+1)/Math.log(F),d=Math.floor(j),t=d+1,o=(1-Math.pow(F,d))/(G*f),c=.5*(o+(1-Math.pow(F,t))/(G*f)),s=Z-c,J=c-o;return-Math.pow(1/F,x-d)/(J*J)*(s-J)*(s+J)}}class d extends G{easeInCore(Z){return Z*Z*Z}}class t extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=Z,this.springiness=x}easeInCore(Z){let x;const F=Math.max(0,this.oscillations),u=Math.max(0,this.springiness);return x=0==u?Z:(Math.exp(u*Z)-1)/(Math.exp(u)-1),x*Math.sin((6.283185307179586*F+1.5707963267948966)*Z)}}class o extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=Z}easeInCore(Z){return this.exponent<=0?Z:(Math.exp(this.exponent*Z)-1)/(Math.exp(this.exponent)-1)}}class c extends G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=Z,this.y1=x,this.x2=F,this.y2=u}easeInCore(Z){return u.b.Interpolate(Z,this.x1,this.y1,this.x2,this.y2)}}},12863:(Z,x,F)=>{"use strict";F.d(x,{b:()=>Y});var u=F(11179),G=F(11192),f=F(11634);class Y extends f.e{get _matrix(){return this._compose(),this.MJ}set _matrix(Z){(Z.updateFlag!==this.MJ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.MJ.G(Z),this._markAsDirtyAndDecompose())}constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(Z,x.KZ(),!1),this.name=Z,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=x,this.MJ=(null===G||void 0===G?void 0:G.clone())??u.Matrix.Identity(),this._restMatrix=f??this.MJ.clone(),this._bindMatrix=Y??this.MJ.clone(),this._index=j,this._absoluteMatrix=new u.Matrix,this._absoluteBindMatrix=new u.Matrix,this._absoluteInverseBindMatrix=new u.Matrix,this._finalMatrix=new u.Matrix,x.bones.push(this),this.setParent(F,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(Z){this.setParent(Z)}setParent(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==Z){if(this.parent){const Z=this.parent.children.indexOf(this);-1!==Z&&this.parent.children.splice(Z,1)}this._parentNode=Z,this.parent&&this.parent.children.push(this),x&&this._updateAbsoluteBindMatrices(),this.It()}}getLocalMatrix(){return this._compose(),this.MJ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(Z){this._restMatrix.G(Z)}setRestPose(Z){this.setRestMatrix(Z)}getBindPose(){return this.getBindMatrix()}setBindMatrix(Z){this.Xf(Z)}setBindPose(Z){this.setBindMatrix(Z)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const Z=u.TmpVectors.kx[0],x=u.TmpVectors.Quaternion[0],F=u.TmpVectors.kx[1];this.getRestMatrix().decompose(Z,x,F),this._linkedTransformNode.position.G(F),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??u.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.G(x),this._linkedTransformNode.pj.G(Z)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(Z){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=Z,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Aj}set position(Z){this._decompose(),this.Aj.G(Z),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(Z){this.setRotation(Z)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(Z){this.setRotationQuaternion(Z)}get pj(){return this.getScale()}set pj(Z){this.setScale(Z)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=u.kx.Zero(),this._localRotation=u.Quaternion.Zero(),this.Aj=u.kx.Zero()),this.MJ.decompose(this._localScaling,this._localRotation,this.Aj))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,u.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Aj,this.MJ)):this._needToCompose=!1)}Xf(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.G(Z),x&&this._updateAbsoluteBindMatrices(),F?this._matrix=Z:this.It()}_updateAbsoluteBindMatrices(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z||(Z=this._bindMatrix),this.parent?Z.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.G(Z),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),x)for(let F=0;F<this.children.length;F++)this.children[F]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}It(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.It(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.It(),this._needToDecompose=!0}_updatePosition(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const f=this.getLocalMatrix();if(0==x)G?(f.addAtIndex(12,Z.x),f.addAtIndex(13,Z.y),f.addAtIndex(14,Z.z)):f.setTranslationFromFloats(Z.x,Z.y,Z.z);else{let x=null;F&&(x=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=Y._TmpMats[0],d=Y._TmpVecs[0];this.parent?F&&x?(j.G(this.parent.getAbsoluteMatrix()),j.multiplyToRef(x,j)):j.G(this.parent.getAbsoluteMatrix()):u.Matrix.IdentityToRef(j),G&&j.setTranslationFromFloats(0,0,0),j.invert(),u.kx.TransformCoordinatesToRef(Z,j,d),G?(f.addAtIndex(12,d.x),f.addAtIndex(13,d.y),f.addAtIndex(14,d.z)):f.setTranslationFromFloats(d.x,d.y,d.z)}this._markAsDirtyAndDecompose()}translate(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,x,F,!0)}setPosition(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(Z,x,F,!1)}setAbsolutePosition(Z,x){this.setPosition(Z,1,x)}scale(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const f=this.getLocalMatrix(),j=Y._TmpMats[0];u.Matrix.ScalingToRef(Z,x,F,j),j.multiplyToRef(f,f),j.invert();for(const u of this.children){const G=u.getLocalMatrix();G.multiplyToRef(j,G),G.multiplyAtIndex(12,Z),G.multiplyAtIndex(13,x),G.multiplyAtIndex(14,F),u._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),G)for(const u of this.children)u.scale(Z,x,F,G)}setScale(Z){this._decompose(),this._localScaling.G(Z),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(Z){this._decompose(),Z.G(this._localScaling)}setYawPitchRoll(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4?arguments[4]:void 0;if(0===G){const j=Y._TmpQuat;return u.Quaternion.RotationYawPitchRollToRef(Z,x,F,j),void this.setRotationQuaternion(j,G,f)}const j=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,f))return;const d=Y._TmpMats[1];u.Matrix.RotationYawPitchRollToRef(Z,x,F,d),j.multiplyToRef(d,d),this._rotateWithMatrix(d,G,f)}rotate(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,G=arguments.length>3?arguments[3]:void 0;const f=Y._TmpMats[0];f.setTranslationFromFloats(0,0,0),u.Matrix.RotationAxisToRef(Z,x,f),this._rotateWithMatrix(f,F,G)}setAxisAngle(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,G=arguments.length>3?arguments[3]:void 0;if(0===F){const f=Y._TmpQuat;return u.Quaternion.RotationAxisToRef(Z,x,f),void this.setRotationQuaternion(f,F,G)}const f=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(f,G))return;const j=Y._TmpMats[1];u.Matrix.RotationAxisToRef(Z,x,j),f.multiplyToRef(j,j),this._rotateWithMatrix(j,F,G)}setRotation(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(Z.y,Z.x,Z.z,x,F)}setRotationQuaternion(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===x)return this._decompose(),this._localRotation.G(Z),void this._markAsDirtyAndCompose();const G=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,F))return;const f=Y._TmpMats[1];u.Matrix.FromQuaternionToRef(Z,f),G.multiplyToRef(f,f),this._rotateWithMatrix(f,x,F)}setRotationMatrix(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===x){const G=Y._TmpQuat;return u.Quaternion.FromRotationMatrixToRef(Z,G),void this.setRotationQuaternion(G,x,F)}const G=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,F))return;const f=Y._TmpMats[1];f.G(Z),G.multiplyToRef(Z,f),this._rotateWithMatrix(f,x,F)}_rotateWithMatrix(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const u=this.getLocalMatrix(),G=u.m[12],f=u.m[13],j=u.m[14],d=this.getParent(),t=Y._TmpMats[3],o=Y._TmpMats[4];d&&1==x?(F?(t.G(F.getWorldMatrix()),d.getAbsoluteMatrix().multiplyToRef(t,t)):t.G(d.getAbsoluteMatrix()),o.G(t),o.invert(),u.multiplyToRef(t,u),u.multiplyToRef(Z,u),u.multiplyToRef(o,u)):1==x&&F?(t.G(F.getWorldMatrix()),o.G(t),o.invert(),u.multiplyToRef(t,u),u.multiplyToRef(Z,u),u.multiplyToRef(o,u)):u.multiplyToRef(Z,u),u.setTranslationFromFloats(G,f,j),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(Z,x){const F=Y._TmpMats[2];return Z.G(this.getAbsoluteMatrix()),x?(Z.multiplyToRef(x.getWorldMatrix(),Z),u.Matrix.ScalingToRef(x.pj.x,x.pj.y,x.pj.z,F)):u.Matrix.IdentityToRef(F),Z.invert(),!isNaN(Z.m[0])&&(F.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyToRef(F,Z),!0)}Gf(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.kx.Zero();return this.getPositionToRef(Z,x,F),F}getPositionToRef(){let Z=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const Z=this.getLocalMatrix();x.x=Z.m[12],x.y=Z.m[13],x.z=Z.m[14]}else{let F=null;Z&&(F=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let u=Y._TmpMats[0];Z&&F?(u.G(this.getAbsoluteMatrix()),u.multiplyToRef(F,u)):u=this.getAbsoluteMatrix(),x.x=u.m[12],x.y=u.m[13],x.z=u.m[14]}}getAbsolutePosition(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=u.kx.Zero();return this.getPositionToRef(1,Z,x),x}getAbsolutePositionToRef(Z,x){this.getPositionToRef(1,Z,x)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.MJ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.G(this.MJ);const Z=this._skeleton.getPoseMatrix();Z&&this._absoluteMatrix.multiplyToRef(Z,this._absoluteMatrix)}const Z=this.children,x=Z.length;for(let F=0;F<x;F++)Z[F].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Bd(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.kx.Zero();return this.getDirectionToRef(Z,x,F),F}getDirectionToRef(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,G=null;x&&(G=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=Y._TmpMats[0];f.G(this.getAbsoluteMatrix()),x&&G&&f.multiplyToRef(G,f),u.kx.TransformNormalToRef(Z,f,F),F.normalize()}getRotation(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.kx.Zero();return this.getRotationToRef(Z,x,F),F}getRotationToRef(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;const u=Y._TmpQuat;this.getRotationQuaternionToRef(Z,x,u),u.toEulerAnglesToRef(F)}getRotationQuaternion(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.Quaternion.Identity();return this.getRotationQuaternionToRef(Z,x,F),F}getRotationQuaternionToRef(){let Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),x.G(this._localRotation);else{const F=Y._TmpMats[0],u=this.getAbsoluteMatrix();Z?u.multiplyToRef(Z.getWorldMatrix(),F):F.G(u),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.decompose(void 0,x,void 0)}}getRotationMatrix(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1?arguments[1]:void 0;const F=u.Matrix.Identity();return this.getRotationMatrixToRef(Z,x,F),F}getRotationMatrixToRef(){let Z=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(x);else{const F=Y._TmpMats[0],u=this.getAbsoluteMatrix();Z?u.multiplyToRef(Z.getWorldMatrix(),F):F.G(u),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.getRotationMatrixToRef(x)}}getAbsolutePositionFromLocal(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.kx.Zero();return this.getAbsolutePositionFromLocalToRef(Z,x,F),F}getAbsolutePositionFromLocalToRef(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,G=null;x&&(G=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=Y._TmpMats[0];f.G(this.getAbsoluteMatrix()),x&&G&&f.multiplyToRef(G,f),u.kx.TransformCoordinatesToRef(Z,f,F)}getLocalPositionFromAbsolute(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=u.kx.Zero();return this.getLocalPositionFromAbsoluteToRef(Z,x,F),F}getLocalPositionFromAbsoluteToRef(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,G=null;x&&(G=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const f=Y._TmpMats[0];f.G(this.getAbsoluteMatrix()),x&&G&&f.multiplyToRef(G,f),f.invert(),u.kx.TransformCoordinatesToRef(Z,f,F)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const Z=this._skeleton.bones.indexOf(this);if(-1!==Z&&this._skeleton.bones.splice(Z,1),this._parentNode&&this._parentNode.children){const Z=this._parentNode.children,x=Z.indexOf(this);-1!==x&&Z.splice(x,1)}super.dispose()}}Y._TmpVecs=(0,G.b)(2,u.kx.Zero),Y._TmpQuat=u.Quaternion.Identity(),Y._TmpMats=(0,G.b)(5,u.Matrix.Identity)},13412:(Z,x,F)=>{"use strict";F.d(x,{c:()=>b});var u=F(11159),G=F(11165),f=F(11e3),Y=F(11179),j=F(11194),d=F(11634),t=F(11671),o=F(11480),c=F(11022),s=F(11188);class J{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(Z){this._idleRotationSpeed=Z}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(Z){this._idleRotationWaitTime=Z}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(Z){this._idleRotationSpinupTime=Z}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(Z){this._attachedCamera=Z;const x=this._attachedCamera.KZ();this._onPrePointerObservableObserver=x.onPrePointerObservable.add((Z=>{Z.type!==o.b.POINTERDOWN?Z.type===o.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const Z=c.e.Now;let x=0;null!=this._lastFrameTime&&(x=Z-this._lastFrameTime),this._lastFrameTime=Z,this._applyUserInteraction();const F=Z-this._lastInteractionTime-this._idleRotationWaitTime,u=Math.max(Math.min(F/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*u,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(x/1e3))}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.KZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(Z){this._lastInteractionTime=Z??c.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<s.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let Z=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(Z=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?Z:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=c.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var p=F(13414),U=F(11745);class k{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(Z){if(this._autoTransitionRange===Z)return;this._autoTransitionRange=Z;const x=this._attachedCamera;x&&(Z?this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((Z=>{if(Z&&(Z.Qf(!0),Z.getBoundingInfo)){const x=Z.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*x,this.upperRadiusTransitionRange=.05*x}})):this._onMeshTargetChangedObserver&&x.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(Z){this._attachedCamera=Z,this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(Z){return!!this._attachedCamera&&(this._attachedCamera.radius===Z&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(Z){if(!this._attachedCamera)return;this._radiusBounceTransition||(k.EasingFunction.setEasingMode(k.EasingMode),this._radiusBounceTransition=U.d.CreateAnimation("radius",U.d.ANIMATIONTYPE_FLOAT,60,k.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const x=U.d.TransitionTo("radius",this._attachedCamera.radius+Z,this._attachedCamera,this._attachedCamera.KZ(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));x&&this._animatables.push(x)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}k.EasingFunction=new p.d(.3),k.EasingMode=p.o.EASINGMODE_EASEOUT;class M{constructor(){this.onTargetFramingAnimationEndObservable=new f.b,this._mode=M.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(Z){this._mode=Z}get mode(){return this._mode}set radiusScale(Z){this._radiusScale=Z}get radiusScale(){return this._radiusScale}set positionScale(Z){this._positionScale=Z}get positionScale(){return this._positionScale}set defaultElevation(Z){this._defaultElevation=Z}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(Z){this._elevationReturnTime=Z}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(Z){this._elevationReturnWaitTime=Z}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(Z){this._zoomStopsAnimation=Z}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(Z){this._framingTime=Z}get framingTime(){return this._framingTime}init(){}attach(Z){this._attachedCamera=Z;const x=this._attachedCamera.KZ();M.EasingFunction.setEasingMode(M.EasingMode),this._onPrePointerObservableObserver=x.onPrePointerObservable.add((Z=>{Z.type!==o.b.POINTERDOWN?Z.type===o.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=Z.onMeshTargetChangedObservable.add((Z=>{Z&&Z.getBoundingInfo&&this.zoomOnMesh(Z,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=Z.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const Z=this._attachedCamera.KZ();this._onPrePointerObservableObserver&&Z.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Qf(!0);const u=Z.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(u.minimumWorld,u.maximumWorld,x,F)}zoomOnMeshHierarchy(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z.Qf(!0);const u=Z.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(u.min,u.max,x,F)}zoomOnMeshesHierarchy(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new Y.kx(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new Y.kx(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let f=0;f<Z.length;f++){const x=Z[f].getHierarchyBoundingVectors(!0);Y.kx.CheckExtends(x.min,u,G),Y.kx.CheckExtends(x.max,u,G)}this.zoomOnBoundingInfo(u,G,x,F)}zoomOnBoundingInfo(Z,x){let F,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const f=Z.y,j=f+(x.y-f)*this._positionScale,d=x.Mx(Z).scale(.5);if(!isFinite(j))return!1;if(u)F=new Y.kx(0,j,0);else{const x=Z.add(d);F=new Y.kx(x.x,j,x.z)}this._vectorTransition||(this._vectorTransition=U.d.CreateAnimation("target",U.d.ANIMATIONTYPE_VECTOR3,60,M.EasingFunction)),this._betaIsAnimating=!0;let t=U.d.TransitionTo("target",F,this._attachedCamera,this._attachedCamera.KZ(),60,this._vectorTransition,this._framingTime);t&&this._animatables.push(t);let o=0;if(this._mode===M.FitFrustumSidesMode){const F=this._calculateLowerRadiusFromModelBoundingSphere(Z,x);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=d.length()+this._attachedCamera.hf),o=F}else this._mode===M.IgnoreBoundsSizeMode&&(o=this._calculateLowerRadiusFromModelBoundingSphere(Z,x),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.hf));if(this.autoCorrectCameraLimitsAndSensibility){const F=x.Mx(Z).length();this._attachedCamera.panningSensibility=5e3/F,this._attachedCamera.wheelPrecision=100/o}return this._radiusTransition||(this._radiusTransition=U.d.CreateAnimation("radius",U.d.ANIMATIONTYPE_FLOAT,60,M.EasingFunction)),t=U.d.TransitionTo("radius",o,this._attachedCamera,this._attachedCamera.KZ(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),G&&G(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),t&&this._animatables.push(t),!0}_calculateLowerRadiusFromModelBoundingSphere(Z,x){const F=this._attachedCamera;if(!F)return 0;let u=F._calculateLowerRadiusFromModelBoundingSphere(Z,x,this._radiusScale);return F.lowerRadiusLimit&&this._mode===M.IgnoreBoundsSizeMode&&(u=u<F.lowerRadiusLimit?F.lowerRadiusLimit:u),F.upperRadiusLimit&&(u=u>F.upperRadiusLimit?F.upperRadiusLimit:u),u}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const Z=c.e.Now-this._lastInteractionTime,x=.5*Math.PI-this._defaultElevation,F=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>F&&Z>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=U.d.CreateAnimation("beta",U.d.ANIMATIONTYPE_FLOAT,60,M.EasingFunction));const Z=U.d.TransitionTo("beta",x,this._attachedCamera,this._attachedCamera.KZ(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));Z&&this._animatables.push(Z)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}M.EasingFunction=new p.r,M.EasingMode=p.o.EASINGMODE_EASEINOUT,M.IgnoreBoundsSizeMode=0,M.FitFrustumSidesMode=1;var m=F(11673),C=F(11706),L=F(12860),H=F(10994);class S{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(Z){Z=H.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),F=x.getInputElement();let u=0,G=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=f=>{var Y,j;const d=f.event,t="touch"===d.pointerType;if(f.type!==o.b.POINTERMOVE&&-1===this.buttons.indexOf(d.button))return;const c=d.target;if(this._altKey=d.altKey,this._ctrlKey=d.ctrlKey,this._metaKey=d.metaKey,this._shiftKey=d.shiftKey,this._buttonsPressed=d.buttons,x.isPointerLock){const Z=d.movementX,x=d.movementY;this.onTouch(null,Z,x),this._pointA=null,this._pointB=null}else{if(f.type!==o.b.POINTERDOWN&&f.type!==o.b.POINTERDOUBLETAP&&t&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==d.pointerId&&(null===(j=this._pointB)||void 0===j?void 0:j.pointerId)!==d.pointerId)return;if(f.type!==o.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!t)if(f.type===o.b.POINTERDOUBLETAP)this.onDoubleTap(d.pointerType);else if(f.type!==o.b.POINTERUP||this._currentMousePointerIdDown!==d.pointerId&&!t){if(f.type===o.b.POINTERMOVE)if(Z||d.preventDefault(),this._pointA&&null===this._pointB){const Z=d.clientX-this._pointA.x,x=d.clientY-this._pointA.y;this._pointA.x=d.clientX,this._pointA.y=d.clientY,this.onTouch(this._pointA,Z,x)}else if(this._pointA&&this._pointB){const Z=this._pointA.pointerId===d.pointerId?this._pointA:this._pointB;Z.x=d.clientX,Z.y=d.clientY;const x=this._pointA.x-this._pointB.x,F=this._pointA.y-this._pointB.y,Y=x*x+F*F,j={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:d.pointerId,type:f.type};this.onMultiTouch(this._pointA,this._pointB,u,Y,G,j),G=j,u=Y}}else{try{null===c||void 0===c||c.releasePointerCapture(d.pointerId)}catch(s){}t||(this._pointB=null),x._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==d.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==d.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==u||G)&&(this.onMultiTouch(this._pointA,this._pointB,u,0,G,null),u=0,G=null),this._currentMousePointerIdDown=-1,this.onButtonUp(d),Z||d.preventDefault()}else{try{null===c||void 0===c||c.setPointerCapture(d.pointerId)}catch(s){}if(null===this._pointA)this._pointA={x:d.clientX,y:d.clientY,pointerId:d.pointerId,type:d.pointerType};else{if(null!==this._pointB)return;this._pointB={x:d.clientX,y:d.clientY,pointerId:d.pointerId,type:d.pointerType}}-1!==this._currentMousePointerIdDown||t||(this._currentMousePointerIdDown=d.pointerId),this.onButtonDown(d),Z||(d.preventDefault(),F&&F.focus())}}},this._observer=this.camera.KZ()._inputManager._addCameraPointerObserver(this._pointerInput,o.b.POINTERDOWN|o.b.POINTERUP|o.b.POINTERMOVE|o.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,u=0,G=null,this.onLostFocus()},this._contextMenuBind=Z=>this.onContextMenu(Z),F&&F.addEventListener("contextmenu",this._contextMenuBind,!1);const f=this.camera.KZ().getEngine().getHostWindow();f&&H.Tools.RegisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])}Rs(){if(this._onLostFocus){const Z=this.camera.KZ().getEngine().getHostWindow();Z&&H.Tools.UnregisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.KZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const Z=this.camera.KZ().getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(Z){}onTouch(Z,x,F){}onMultiTouch(Z,x,F,u,G,f){}onContextMenu(Z){Z.preventDefault()}onButtonDown(Z){}onButtonUp(Z){}onLostFocus(){}}(0,u.d)([(0,G.H)()],S.prototype,"buttons",void 0);class K extends S{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(Z,x){if(0!==this.panningSensibility&&Z&&x){const F=x.x-Z.x,u=x.y-Z.y;this.camera.inertialPanningX+=-F/this.panningSensibility,this.camera.inertialPanningY+=u/this.panningSensibility}}_computePinchZoom(Z,x){const F=this.camera.radius||K.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=F*Math.sqrt(Z)/Math.sqrt(x):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(x-Z)*F*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(x-Z)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(Z,x,F){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=F/this.panningSensibility):(this.camera.inertialAlphaOffset-=x/this.angularSensibilityX,this.camera.inertialBetaOffset-=F/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(Z,x,F,u,G,f){0===F&&null===G||0===u&&null===f||(this.multiTouchPanAndZoom?(this._computePinchZoom(F,u),this._computeMultiTouchPanning(G,f)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(u)-Math.sqrt(F))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(F,u),this._isPinching=!0):this._computeMultiTouchPanning(G,f)):this.multiTouchPanning?this._computeMultiTouchPanning(G,f):this.pinchZoom&&this._computePinchZoom(F,u))}onButtonDown(Z){this._isPanClick=Z.button===this.camera._panningMouseButton}onButtonUp(Z){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}K.MinimumRadiusForPinch=.001,(0,u.d)([(0,G.H)()],K.prototype,"buttons",void 0),(0,u.d)([(0,G.H)()],K.prototype,"angularSensibilityX",void 0),(0,u.d)([(0,G.H)()],K.prototype,"angularSensibilityY",void 0),(0,u.d)([(0,G.H)()],K.prototype,"pinchPrecision",void 0),(0,u.d)([(0,G.H)()],K.prototype,"pinchDeltaPercentage",void 0),(0,u.d)([(0,G.H)()],K.prototype,"useNaturalPinchZoom",void 0),(0,u.d)([(0,G.H)()],K.prototype,"pinchZoom",void 0),(0,u.d)([(0,G.H)()],K.prototype,"panningSensibility",void 0),(0,u.d)([(0,G.H)()],K.prototype,"multiTouchPanning",void 0),(0,u.d)([(0,G.H)()],K.prototype,"multiTouchPanAndZoom",void 0),L.c.ArcRotateCameraPointersInput=K;var y=F(11482);class q{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(Z){Z=H.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.KZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const F=x.event;if(!F.metaKey)if(x.type===y.d.KEYDOWN){if(this._ctrlPressed=F.ctrlKey,this._altPressed=F.altKey,-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),F.preventDefault&&(Z||F.preventDefault())}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){const x=this._keys.indexOf(F.keyCode);x>=0&&this._keys.splice(x,1),F.preventDefault&&(Z||F.preventDefault())}})))}Rs(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let x=0;x<this._keys.length;x++){const F=this._keys[x];-1!==this.keysLeft.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX-=1/this.panningSensibility:Z.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset+=1/this.zoomingSensibility:Z.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningX+=1/this.panningSensibility:Z.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?Z.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?Z.inertialRadiusOffset-=1/this.zoomingSensibility:Z.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(F)&&Z.useInputToRestoreState&&Z.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,u.d)([(0,G.H)()],q.prototype,"keysUp",void 0),(0,u.d)([(0,G.H)()],q.prototype,"keysDown",void 0),(0,u.d)([(0,G.H)()],q.prototype,"keysLeft",void 0),(0,u.d)([(0,G.H)()],q.prototype,"keysRight",void 0),(0,u.d)([(0,G.H)()],q.prototype,"keysReset",void 0),(0,u.d)([(0,G.H)()],q.prototype,"panningSensibility",void 0),(0,u.d)([(0,G.H)()],q.prototype,"zoomingSensibility",void 0),(0,u.d)([(0,G.H)()],q.prototype,"useAltToZoom",void 0),(0,u.d)([(0,G.H)()],q.prototype,"angularSpeed",void 0),L.c.ArcRotateCameraKeyboardMoveInput=q;var R=F(11238),B=F(11484);class v{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.kx(0,0,0),this._globalOffset=new Y.kx(0,0,0),this._inertialPanning=Y.kx.Zero()}_computeDeltaFromMouseWheelLegacyEvent(Z,x){let F=0;const u=.01*Z*this.wheelDeltaPercentage*x;return F=Z>0?u/(1+this.wheelDeltaPercentage):u*(1+this.wheelDeltaPercentage),F}attachControl(Z){Z=H.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==o.b.POINTERWHEEL)return;const F=x.event;let u=0;const G=F.deltaMode===B.d.DOM_DELTA_LINE?40:1,f=-F.deltaY*G;if(this.customComputeDeltaFromMouseWheel)u=this.customComputeDeltaFromMouseWheel(f,this,F);else if(this.wheelDeltaPercentage){if(u=this._computeDeltaFromMouseWheelLegacyEvent(f,this.camera.radius),u>0){let Z=this.camera.radius,x=this.camera.inertialRadiusOffset+u;for(let F=0;F<20&&!(Z<=x)&&!(Math.abs(x*this.camera.inertia)<.001);F++)Z-=x,x*=this.camera.inertia;Z=(0,j.Clamp)(Z,0,Number.MAX_VALUE),u=this._computeDeltaFromMouseWheelLegacyEvent(f,Z)}}else u=f/(40*this.wheelPrecision);u&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(u)):this.camera.inertialRadiusOffset+=u),F.preventDefault&&(Z||F.preventDefault())},this._observer=this.camera.KZ()._inputManager._addCameraPointerObserver(this._wheel,o.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Uj(0)}Rs(){this._observer&&(this.camera.KZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const Z=this.camera;0+Z.inertialAlphaOffset+Z.inertialBetaOffset+Z.inertialRadiusOffset&&(this._updateHitPlane(),Z.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(Z.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const Z=this.camera,x=Z.target.Mx(Z.position);this._hitPlane=R.d.FromPositionAndNormal(Z.target,x)}_getPosition(){const Z=this.camera,x=Z.KZ(),F=x.createPickingRay(x.pointerX,x.pointerY,Y.Matrix.Identity(),Z,!1);0===Z.targetScreenOffset.x&&0===Z.targetScreenOffset.y||(this._viewOffset.set(Z.targetScreenOffset.x,Z.targetScreenOffset.y,0),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),this._globalOffset=Y.kx.TransformNormal(this._viewOffset,Z._cameraTransformMatrix),F.origin.addInPlace(this._globalOffset));let u=0;return this._hitPlane&&(u=F.intersectsPlane(this._hitPlane)??0),F.origin.addInPlace(F.direction.scaleInPlace(u))}_zoomToMouse(Z){const x=this.camera,F=1-x.inertia;if(x.lowerRadiusLimit){const u=x.lowerRadiusLimit??0;x.radius-(x.inertialRadiusOffset+Z)/F<u&&(Z=(x.radius-u)*F-x.inertialRadiusOffset)}if(x.upperRadiusLimit){const u=x.upperRadiusLimit??0;x.radius-(x.inertialRadiusOffset+Z)/F>u&&(Z=(x.radius-u)*F-x.inertialRadiusOffset)}const u=Z/F/x.radius,G=this._getPosition(),f=Y.TmpVectors.kx[6];G.subtractToRef(x.target,f),f.scaleInPlace(u),f.scaleInPlace(F),this._inertialPanning.addInPlace(f),x.inertialRadiusOffset+=Z}_zeroIfClose(Z){Math.abs(Z.x)<s.e&&(Z.x=0),Math.abs(Z.y)<s.e&&(Z.y=0),Math.abs(Z.z)<s.e&&(Z.z=0)}}(0,u.d)([(0,G.H)()],v.prototype,"wheelPrecision",void 0),(0,u.d)([(0,G.H)()],v.prototype,"zoomToMouseLocation",void 0),(0,u.d)([(0,G.H)()],v.prototype,"wheelDeltaPercentage",void 0),L.c.ArcRotateCameraMouseWheelInput=v;class l extends L.g{constructor(Z){super(Z)}addMouseWheel(){return this.add(new v),this}addPointers(){return this.add(new K),this}addKeyboard(){return this.add(new q),this}}var i=F(11136);function e(Z,x){return isNaN(Z)?x:Z}d.e.AddNodeConstructor("ArcRotateCamera",((Z,x)=>()=>new b(Z,0,0,1,Y.kx.Zero(),x)));class b extends C.d{get target(){return this._target}set target(Z){this.setTarget(Z)}get targetHost(){return this._targetHost}set targetHost(Z){Z&&this.setTarget(Z)}getTarget(){return this.target}get position(){return this._position}set position(Z){this.setPosition(Z)}set upVector(Z){this._upToYMatrix||(this._yToUpMatrix=new Y.Matrix,this._upToYMatrix=new Y.Matrix,this._upVector=Y.kx.Zero()),Z.normalize(),this._upVector.G(Z),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.Matrix.RotationAlignToRef(Y.kx.UpReadOnly,this._upVector,this._yToUpMatrix),Y.Matrix.RotationAlignToRef(this._upVector,Y.kx.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityX:0}set angularSensibilityX(Z){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityX=Z)}get angularSensibilityY(){const Z=this.inputs.attached.pointers;return Z?Z.angularSensibilityY:0}set angularSensibilityY(Z){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityY=Z)}get pinchPrecision(){const Z=this.inputs.attached.pointers;return Z?Z.pinchPrecision:0}set pinchPrecision(Z){const x=this.inputs.attached.pointers;x&&(x.pinchPrecision=Z)}get pinchDeltaPercentage(){const Z=this.inputs.attached.pointers;return Z?Z.pinchDeltaPercentage:0}set pinchDeltaPercentage(Z){const x=this.inputs.attached.pointers;x&&(x.pinchDeltaPercentage=Z)}get useNaturalPinchZoom(){const Z=this.inputs.attached.pointers;return!!Z&&Z.useNaturalPinchZoom}set useNaturalPinchZoom(Z){const x=this.inputs.attached.pointers;x&&(x.useNaturalPinchZoom=Z)}get panningSensibility(){const Z=this.inputs.attached.pointers;return Z?Z.panningSensibility:0}set panningSensibility(Z){const x=this.inputs.attached.pointers;x&&(x.panningSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const x=this.inputs.attached.keyboard;x&&(x.keysUp=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const x=this.inputs.attached.keyboard;x&&(x.keysDown=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRight=Z)}get wheelPrecision(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelPrecision:0}set wheelPrecision(Z){const x=this.inputs.attached.mousewheel;x&&(x.wheelPrecision=Z)}get zoomToMouseLocation(){const Z=this.inputs.attached.mousewheel;return!!Z&&Z.zoomToMouseLocation}set zoomToMouseLocation(Z){const x=this.inputs.attached.mousewheel;x&&(x.zoomToMouseLocation=Z)}get wheelDeltaPercentage(){const Z=this.inputs.attached.mousewheel;return Z?Z.wheelDeltaPercentage:0}set wheelDeltaPercentage(Z){const x=this.inputs.attached.mousewheel;x&&(x.wheelDeltaPercentage=Z)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(Z){Z!==this.useBouncingBehavior&&(Z?(this._bouncingBehavior=new k,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(Z){Z!==this.useFramingBehavior&&(Z?(this._framingBehavior=new M,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(Z){Z!==this.useAutoRotationBehavior&&(Z?(this._autoRotationBehavior=new J,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(Z,x,F,u,G,j){var d;let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(Z,Y.kx.Zero(),j,t),d=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.kx.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.Matrix,this.panningAxis=new Y.kx(1,1,0),this._transformedDirection=new Y.kx,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new f.b,this.checkCollisions=!1,this.collisionRadius=new Y.kx(.5,.5,.5),this._previousPosition=Y.kx.Zero(),this._collisionVelocity=Y.kx.Zero(),this._newPosition=Y.kx.Zero(),this._computationVector=Y.kx.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.kx(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F?(d.setPosition(x),d.cp&&d.cp(F)):d._previousPosition.G(d._position);const u=Math.cos(d.alpha),G=Math.sin(d.alpha),f=Math.cos(d.beta);let Y=Math.sin(d.beta);0===Y&&(Y=1e-4);const j=d._getTargetPosition();d._computationVector.Jj(d.radius*u*Y,d.radius*f,d.radius*G*Y),j.addToRef(d._computationVector,d._newPosition),d._position.G(d._newPosition);let t=d.upVector;d.allowUpsideDown&&d.beta<0&&(t=t.clone(),t=t.negate()),d._computeViewMatrix(d._position,j,t),d._viewMatrix.addAtIndex(12,d.targetScreenOffset.x),d._viewMatrix.addAtIndex(13,d.targetScreenOffset.y),d._collisionTriggered=!1},this._target=Y.kx.Zero(),G&&this.setTarget(G),this.alpha=x,this.beta=F,this.radius=u,this.getViewMatrix(),this.inputs=new l(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.kx(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.Vector2.Zero()}_updateCache(Z){Z||super._updateCache(),this._cache._target.G(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.G(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const Z=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?Z.addToRef(this._targetBoundingCenter,this._target):this._target.G(Z)}const Z=this._getLockedTargetPosition();return Z||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>s.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,f=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=f?this._currentInterpolationFactor=f:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=e(Z,this._goalAlpha),this._goalBeta=e(x,this._goalBeta),this._goalRadius=e(F,this._goalRadius),this._goalTarget.set(e(u.x,this._goalTarget.x),e(u.y,this._goalTarget.y),e(u.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(e(G.x,this._goalTargetScreenOffset.x),e(G.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,j.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,j.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,j.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,j.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(Z,x){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const G=arguments;x=H.Tools.BackCompatCameraNoPreventDefault(G),this._useCtrlForPanning=F,this._panningMouseButton=u,"boolean"===typeof G[0]&&(G.length>1&&(this._useCtrlForPanning=G[1]),G.length>2&&(this._panningMouseButton=G[2])),this.inputs.attachElement(x),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Rs(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let Z=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){Z=!0;const x=this.invertRotation?-1:1,F=this._calculateHandednessMultiplier();let u=this.inertialAlphaOffset*F;this.beta<0&&(u*=-1),this.alpha+=u*x,this.beta+=this.inertialBetaOffset*x,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<s.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<s.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*s.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){Z=!0;const x=new Y.kx(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),x.multiplyInPlace(this.panningAxis),Y.kx.TransformNormalToRef(x,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const Z=this.upVector,x=Y.kx.CrossToRef(this._transformedDirection,Z,this._transformedDirection);Y.kx.CrossToRef(Z,x,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.kx.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.G(this._transformedDirection)}else{if(this.parent){const Z=Y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(Z),Z.transposeToRef(Z),Y.kx.TransformCoordinatesToRef(this._transformedDirection,Z,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*s.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*s.e&&(this.inertialPanningY=0)}if(Z)this.stopInterpolation();else if(this._isInterpolating){let Z=!1;const x=this._scene.getEngine().getDeltaTime()/1e3,F=1-Math.pow(2,-x/this._currentInterpolationFactor),u=e(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const x=Y.TmpVectors.kx[0].set(e(this._goalTarget.x,this._target.x),e(this._goalTarget.y,this._target.y),e(this._goalTarget.z,this._target.z));Y.kx.LerpToRef(this.target,x,F,this._target),10*Y.kx.Distance(this.target,x)/u<s.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.G(x),this.setTarget(this.target,!1,!0,!0)):Z=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const x=Y.Quaternion.RotationAlphaBetaGammaToRef(e(this._goalAlpha,this.alpha),e(this._goalBeta,this.beta),0,Y.TmpVectors.Quaternion[0]),u=Y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.TmpVectors.Quaternion[1]),G=Y.Quaternion.SlerpToRef(u,x,F,Y.TmpVectors.Quaternion[2]);G.normalize();const f=G.toAlphaBetaGammaToRef(Y.TmpVectors.kx[0]);if(this.alpha=f.x,this.beta=f.y,G.isApprox(x,s.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const Z=x.toAlphaBetaGammaToRef(Y.TmpVectors.kx[0]);this.alpha=Z.x,this.beta=Z.y}else Z=!0}if(isNaN(this._goalRadius)||(this.radius+=(u-this.radius)*F,Math.abs(u/this.radius-1)<s.e?(this._goalRadius=NaN,this.radius=u):Z=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const x=Y.TmpVectors.Vector2[0].set(e(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),e(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.Vector2.LerpToRef(this.targetScreenOffset,x,F,this.targetScreenOffset),Y.Vector2.Distance(this.targetScreenOffset,x)<s.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.G(x)):Z=!0}this._isInterpolating=Z}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.kx.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const Z=this.alpha;var x,F;this.alpha=function(Z){let x=Math.PI/2;return 0===Z.x&&0===Z.z||(x=Math.acos(Z.x/Math.sqrt(Math.pow(Z.x,2)+Math.pow(Z.z,2)))),Z.z<0&&(x=2*Math.PI-x),x}(this._computationVector),this.beta=(x=this._computationVector.y,F=this.radius,Math.acos(x/F));const u=Math.round((Z-this.alpha)/(2*Math.PI));this.alpha+=2*u*Math.PI,this._checkLimits()}setPosition(Z){this._position.equals(Z)||(this._position.G(Z),this.rebuildAnglesAndRadius())}setTarget(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(u=this.overrideCloneAlphaBetaRadius??u,Z.Qf)x&&Z.getBoundingInfo?this._targetBoundingCenter=Z.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,Z.Qf(),this._targetHost=Z,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const x=Z,u=this._getTargetPosition();if(u&&!F&&u.equals(x))return;this._targetHost=null,this._target=x,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}u||this.rebuildAnglesAndRadius()}_getViewMatrix(){const Z=Math.cos(this.alpha),x=Math.sin(this.alpha),F=Math.cos(this.beta);let u=Math.sin(this.beta);0===u&&(u=1e-4),0===this.radius&&(this.radius=1e-4);const G=this._getTargetPosition();if(this._computationVector.Jj(this.radius*Z*u,this.radius*F,this.radius*x*u),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.kx.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),G.addToRef(this._computationVector,this._newPosition),this.KZ().collisionsEnabled&&this.checkCollisions){const Z=this.KZ().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,Z.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.G(this._newPosition);let Z=this.upVector;this.allowUpsideDown&&u<0&&(Z=Z.negate()),this._computeViewMatrix(this._position,G,Z),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.G(G),this._viewMatrix}zoomOn(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z=Z||this.KZ().meshes;const F=t.d.MinMax(Z);let u=this._calculateLowerRadiusFromModelBoundingSphere(F.min,F.max);if(u=Math.max(Math.min(u,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=u*this.zoomOnFactor,this.mode===m.c.ORTHOGRAPHIC_CAMERA){const Z=this.KZ().getEngine().getAspectRatio(this),x=u*this.zoomOnFactor/2;this.orthoLeft=-x*Z,this.orthoRight=x*Z,this.orthoBottom=-x,this.orthoTop=x}this.focusOn({min:F.min,max:F.max,distance:u},x)}focusOn(Z){let x,F,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===Z.min){const u=Z||this.KZ().meshes;x=t.d.MinMax(u),F=Y.kx.Distance(x.min,x.max)}else{x=Z,F=Z.distance}this._target=t.d.Center(x),u||(this.maxZ=2*F)}createRigCamera(Z,x){let F=0;switch(this.cameraRigMode){case m.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case m.c.RIG_MODE_VR:F=this._cameraRigParams.stereoHalfAngle*(0===x?1:-1);break;case m.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:F=this._cameraRigParams.stereoHalfAngle*(0===x?-1:1)}const u=new b(Z,this.alpha+F,this.beta,this.radius,this._target,this.KZ());return u._cameraRigParams={},u.isRigCamera=!0,u.rigParent=this,u.upVector=this.upVector,u.mode=this.mode,u.orthoLeft=this.orthoLeft,u.orthoRight=this.orthoRight,u.orthoBottom=this.orthoBottom,u.orthoTop=this.orthoTop,u}_updateRigCameras(){const Z=this._rigCameras[0],x=this._rigCameras[1];switch(Z.beta=x.beta=this.beta,this.cameraRigMode){case m.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case m.c.RIG_MODE_VR:Z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case m.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const u=Y.kx.Distance(Z,x),G=this.KZ().getEngine().getAspectRatio(this),f=Math.tan(this.fov/2),j=f*G,d=.5*u*F,t=d*Math.sqrt(1+1/(j*j)),o=d*Math.sqrt(1+1/(f*f));return Math.max(t,o)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,u.d)([(0,G.H)()],b.prototype,"alpha",void 0),(0,u.d)([(0,G.H)()],b.prototype,"beta",void 0),(0,u.d)([(0,G.H)()],b.prototype,"radius",void 0),(0,u.d)([(0,G.H)()],b.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,u.d)([(0,G.D)("target")],b.prototype,"_target",void 0),(0,u.d)([(0,G.t)("targetHost")],b.prototype,"_targetHost",void 0),(0,u.d)([(0,G.H)()],b.prototype,"inertialAlphaOffset",void 0),(0,u.d)([(0,G.H)()],b.prototype,"inertialBetaOffset",void 0),(0,u.d)([(0,G.H)()],b.prototype,"inertialRadiusOffset",void 0),(0,u.d)([(0,G.H)()],b.prototype,"lowerAlphaLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"upperAlphaLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"lowerBetaLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"upperBetaLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"lowerRadiusLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"upperRadiusLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"lowerTargetYLimit",void 0),(0,u.d)([(0,G.H)()],b.prototype,"inertialPanningX",void 0),(0,u.d)([(0,G.H)()],b.prototype,"inertialPanningY",void 0),(0,u.d)([(0,G.H)()],b.prototype,"pinchToPanMaxDistance",void 0),(0,u.d)([(0,G.H)()],b.prototype,"panningDistanceLimit",void 0),(0,u.d)([(0,G.D)()],b.prototype,"panningOriginTarget",void 0),(0,u.d)([(0,G.H)()],b.prototype,"panningInertia",void 0),(0,u.d)([(0,G.H)()],b.prototype,"zoomToMouseLocation",null),(0,u.d)([(0,G.H)()],b.prototype,"zoomOnFactor",void 0),(0,u.d)([(0,G.C)()],b.prototype,"targetScreenOffset",void 0),(0,u.d)([(0,G.H)()],b.prototype,"allowUpsideDown",void 0),(0,u.d)([(0,G.H)()],b.prototype,"useInputToRestoreState",void 0),(0,u.d)([(0,G.H)()],b.prototype,"restoreStateInterpolationFactor",void 0),(0,i.g)("BABYLON.ArcRotateCamera",b)},12860:(Z,x,F)=>{"use strict";F.d(x,{c:()=>Y,g:()=>j});var u=F(11012),G=F(11213),f=F(11673),Y={};class j{constructor(Z){this.attachedToElement=!1,this.attached={},this.camera=Z,this.checkInputs=()=>{}}add(Z){const x=Z.getSimpleName();this.attached[x]?u.d.Warn("camera input of type "+x+" already exists on camera"):(this.attached[x]=Z,Z.camera=this.camera,Z.checkInputs&&(this.checkInputs=this._addCheckInputs(Z.checkInputs.bind(Z))),this.attachedToElement&&Z.attachControl(this.noPreventDefault))}remove(Z){for(const x in this.attached){const F=this.attached[x];if(F===Z)return F.Rs(),F.camera=null,delete this.attached[x],void this.rebuildInputCheck()}}removeByType(Z){for(const x in this.attached){const F=this.attached[x];F.getClassName()===Z&&(F.Rs(),F.camera=null,delete this.attached[x],this.rebuildInputCheck())}}_addCheckInputs(Z){const x=this.checkInputs;return()=>{x(),Z()}}attachInput(Z){this.attachedToElement&&Z.attachControl(this.noPreventDefault)}attachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){Z=!f.c.ForceAttachControlToAlwaysPreventDefault&&Z,this.attachedToElement=!0,this.noPreventDefault=Z;for(const x in this.attached)this.attached[x].attachControl(Z)}}detachElement(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const x in this.attached)this.attached[x].Rs(),Z&&(this.attached[x].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const Z in this.attached){const x=this.attached[Z];x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(Z){const x={};for(const F in this.attached){const Z=this.attached[F],u=G.c.Serialize(Z);x[Z.getClassName()]=u}Z.inputsmgr=x}parse(Z){const x=Z.inputsmgr;if(x){this.clear();for(const Z in x){const F=Y[Z];if(F){const u=x[Z],f=G.c.Parse((()=>new F),u,null);this.add(f)}}}else for(const F in this.attached){const x=Y[this.attached[F].getClassName()];if(x){const u=G.c.Parse((()=>new x),Z,null);this.remove(this.attached[F]),this.add(u)}}}}},12855:(Z,x,F)=>{"use strict";F.d(x,{b:()=>S});var u=F(11159),G=F(11165),f=F(11179),Y=F(11706),j=F(12860),d=F(11482),t=F(10994);class o{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(Z){Z=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.KZ(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const F=x.event;if(!F.metaKey)if(x.type===d.d.KEYDOWN){if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),Z||F.preventDefault()}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){const x=this._keys.indexOf(F.keyCode);x>=0&&this._keys.splice(x,1),Z||F.preventDefault()}})))}Rs(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const Z=this.camera;for(let x=0;x<this._keys.length;x++){const F=this._keys[x],u=Z._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(F)?Z._localDirection.Jj(-u,0,0):-1!==this.keysUp.indexOf(F)?Z._localDirection.Jj(0,0,u):-1!==this.keysRight.indexOf(F)?Z._localDirection.Jj(u,0,0):-1!==this.keysDown.indexOf(F)?Z._localDirection.Jj(0,0,-u):-1!==this.keysUpward.indexOf(F)?Z._localDirection.Jj(0,u,0):-1!==this.keysDownward.indexOf(F)?Z._localDirection.Jj(0,-u,0):-1!==this.keysRotateLeft.indexOf(F)?(Z._localDirection.Jj(0,0,0),Z.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(F)?(Z._localDirection.Jj(0,0,0),Z.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(F)?(Z._localDirection.Jj(0,0,0),Z.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(F)&&(Z._localDirection.Jj(0,0,0),Z.cameraRotation.x+=this._getLocalRotation()),Z.KZ().useRightHandedSystem&&(Z._localDirection.z*=-1),Z.getViewMatrix().invertToRef(Z._cameraTransformMatrix),f.kx.TransformNormalToRef(Z._localDirection,Z._cameraTransformMatrix,Z._transformedDirection),Z.cameraDirection.addInPlace(Z._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const Z=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*Z}}(0,u.d)([(0,G.H)()],o.prototype,"keysUp",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysUpward",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysDown",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysDownward",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysLeft",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysRight",void 0),(0,u.d)([(0,G.H)()],o.prototype,"rotationSpeed",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysRotateLeft",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysRotateRight",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysRotateUp",void 0),(0,u.d)([(0,G.H)()],o.prototype,"keysRotateDown",void 0),j.c.FreeCameraKeyboardMoveInput=o;var c=F(11e3),s=F(11480);class J{constructor(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=Z,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new c.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(Z){Z=t.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),F=x.getInputElement();this._pointerInput||(this._pointerInput=u=>{const G=u.event,f="touch"===G.pointerType;if(!this.touchEnabled&&f)return;if(u.type!==s.b.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const Y=G.target;if(u.type===s.b.POINTERDOWN){if(f&&-1!==this._activePointerId||!f&&-1!==this._currentActiveButton)return;this._activePointerId=G.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(G.pointerId)}catch(j){}-1===this._currentActiveButton&&(this._currentActiveButton=G.button),this._previousPosition={x:G.clientX,y:G.clientY},Z||(G.preventDefault(),F&&F.focus()),x.isPointerLock&&this._onMouseMove&&this._onMouseMove(u.event)}else if(u.type===s.b.POINTERUP){if(f&&this._activePointerId!==G.pointerId||!f&&this._currentActiveButton!==G.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(G.pointerId)}catch(j){}this._currentActiveButton=-1,this._previousPosition=null,Z||G.preventDefault(),this._activePointerId=-1}else if(u.type===s.b.POINTERMOVE&&(this._activePointerId===G.pointerId||!f))if(x.isPointerLock&&this._onMouseMove)this._onMouseMove(u.event);else if(this._previousPosition){const x=this.camera._calculateHandednessMultiplier(),F=(G.clientX-this._previousPosition.x)*x,u=G.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=F/this.angularSensibility,this.camera.cameraRotation.x+=u/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:F,offsetY:u}),this._previousPosition={x:G.clientX,y:G.clientY},Z||G.preventDefault()}}),this._onMouseMove=F=>{if(!x.isPointerLock)return;const u=this.camera._calculateHandednessMultiplier(),G=F.movementX*u;this.camera.cameraRotation.y+=G/this.angularSensibility;const f=F.movementY;this.camera.cameraRotation.x+=f/this.angularSensibility,this._previousPosition=null,Z||F.preventDefault()},this._observer=this.camera.KZ()._inputManager._addCameraPointerObserver(this._pointerInput,s.b.POINTERDOWN|s.b.POINTERUP|s.b.POINTERMOVE),F&&(this._contextMenuBind=Z=>this.onContextMenu(Z),F.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(Z){Z.preventDefault()}Rs(){if(this._observer){if(this.camera.KZ()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,u.d)([(0,G.H)()],J.prototype,"buttons",void 0),(0,u.d)([(0,G.H)()],J.prototype,"angularSensibility",void 0),j.c.FreeCameraMouseInput=J;var p,U=F(11484);class k{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new c.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(Z){Z=t.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==s.b.POINTERWHEEL)return;const F=x.event,u=F.deltaMode===U.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*u*F.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*u*F.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*u*F.deltaZ/this._normalize,F.preventDefault&&(Z||F.preventDefault())},this._observer=this.camera.KZ()._inputManager._addCameraPointerObserver(this._wheel,s.b.POINTERWHEEL)}Rs(){this._observer&&(this.camera.KZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,u.d)([(0,G.H)()],k.prototype,"wheelPrecisionX",void 0),(0,u.d)([(0,G.H)()],k.prototype,"wheelPrecisionY",void 0),(0,u.d)([(0,G.H)()],k.prototype,"wheelPrecisionZ",void 0),function(Z){Z[Z.MoveRelative=0]="MoveRelative",Z[Z.RotateRelative=1]="RotateRelative",Z[Z.MoveScene=2]="MoveScene"}(p||(p={}));class M extends k{constructor(){super(...arguments),this._moveRelative=f.kx.Zero(),this._rotateRelative=f.kx.Zero(),this._moveScene=f.kx.Zero(),this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(Z){null===Z&&this._wheelXAction!==p.MoveRelative||(this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=Z)}get wheelXMoveRelative(){return this._wheelXAction!==p.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(Z){null===Z&&this._wheelYAction!==p.MoveRelative||(this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=Z)}get wheelYMoveRelative(){return this._wheelYAction!==p.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(Z){null===Z&&this._wheelZAction!==p.MoveRelative||(this._wheelZAction=p.MoveRelative,this._wheelZActionCoordinate=Z)}get wheelZMoveRelative(){return this._wheelZAction!==p.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(Z){null===Z&&this._wheelXAction!==p.RotateRelative||(this._wheelXAction=p.RotateRelative,this._wheelXActionCoordinate=Z)}get wheelXRotateRelative(){return this._wheelXAction!==p.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(Z){null===Z&&this._wheelYAction!==p.RotateRelative||(this._wheelYAction=p.RotateRelative,this._wheelYActionCoordinate=Z)}get wheelYRotateRelative(){return this._wheelYAction!==p.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(Z){null===Z&&this._wheelZAction!==p.RotateRelative||(this._wheelZAction=p.RotateRelative,this._wheelZActionCoordinate=Z)}get wheelZRotateRelative(){return this._wheelZAction!==p.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(Z){null===Z&&this._wheelXAction!==p.MoveScene||(this._wheelXAction=p.MoveScene,this._wheelXActionCoordinate=Z)}get wheelXMoveScene(){return this._wheelXAction!==p.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(Z){null===Z&&this._wheelYAction!==p.MoveScene||(this._wheelYAction=p.MoveScene,this._wheelYActionCoordinate=Z)}get wheelYMoveScene(){return this._wheelYAction!==p.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(Z){null===Z&&this._wheelZAction!==p.MoveScene||(this._wheelZAction=p.MoveScene,this._wheelZActionCoordinate=Z)}get wheelZMoveScene(){return this._wheelZAction!==p.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Uj(0),this._rotateRelative.Uj(0),this._moveScene.Uj(0),this._updateCamera(),this.camera.KZ().useRightHandedSystem&&(this._moveRelative.z*=-1);const Z=f.Matrix.Zero();this.camera.getViewMatrix().invertToRef(Z);const x=f.kx.Zero();f.kx.TransformNormalToRef(this._moveRelative,Z,x),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(x),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(Z,x,F){if(0===Z)return;if(null===x||null===F)return;let u=null;switch(x){case p.MoveRelative:u=this._moveRelative;break;case p.RotateRelative:u=this._rotateRelative;break;case p.MoveScene:u=this._moveScene}switch(F){case 0:u.set(Z,0,0);break;case 1:u.set(0,Z,0);break;case 2:u.set(0,0,Z)}}}(0,u.d)([(0,G.H)()],M.prototype,"wheelXMoveRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelYMoveRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelZMoveRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelXRotateRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelYRotateRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelZRotateRelative",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelXMoveScene",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelYMoveScene",null),(0,u.d)([(0,G.H)()],M.prototype,"wheelZMoveScene",null),j.c.FreeCameraMouseWheelInput=M;class m{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=Z,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=t.Tools.IsSafari()}attachControl(Z){Z=t.Tools.BackCompatCameraNoPreventDefault(arguments);let x=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=F=>{const u=F.event,G="mouse"===u.pointerType||this._isSafari&&"undefined"===typeof u.pointerType;if(this.allowMouse||!G)if(F.type===s.b.POINTERDOWN){if(Z||u.preventDefault(),this._pointerPressed.push(u.pointerId),1!==this._pointerPressed.length)return;x={x:u.clientX,y:u.clientY}}else if(F.type===s.b.POINTERUP){Z||u.preventDefault();const F=this._pointerPressed.indexOf(u.pointerId);if(-1===F)return;if(this._pointerPressed.splice(F,1),0!=F)return;x=null,this._offsetX=null,this._offsetY=null}else if(F.type===s.b.POINTERMOVE){if(Z||u.preventDefault(),!x)return;if(0!=this._pointerPressed.indexOf(u.pointerId))return;this._offsetX=u.clientX-x.x,this._offsetY=-(u.clientY-x.y)}}),this._observer=this.camera.KZ()._inputManager._addCameraPointerObserver(this._pointerInput,s.b.POINTERDOWN|s.b.POINTERUP|s.b.POINTERMOVE),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.addEventListener("blur",this._onLostFocus)}}Rs(){if(this._pointerInput){if(this._observer&&(this.camera.KZ()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const Z=this.camera.getEngine().getInputElement();Z&&Z.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const Z=this.camera,x=Z._calculateHandednessMultiplier();Z.cameraRotation.y=x*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)Z.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const x=Z._computeLocalCameraSpeed(),F=new f.kx(0,0,0!==this.touchMoveSensibility?x*this._offsetY/this.touchMoveSensibility:0);f.Matrix.RotationYawPitchRollToRef(Z.rotation.y,Z.rotation.x,0,Z._cameraRotationMatrix),Z.cameraDirection.addInPlace(f.kx.TransformCoordinates(F,Z._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,u.d)([(0,G.H)()],m.prototype,"touchAngularSensibility",void 0),(0,u.d)([(0,G.H)()],m.prototype,"touchMoveSensibility",void 0),j.c.FreeCameraTouchInput=m;class C extends j.g{constructor(Z){super(Z),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new o),this}addMouse(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new J(Z),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new M,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new m),this}clear(){super.clear(),this._mouseInput=null}}var L=F(11136),H=F(11081);class S extends Y.d{get angularSensibility(){const Z=this.inputs.attached.mouse;return Z?Z.angularSensibility:0}set angularSensibility(Z){const x=this.inputs.attached.mouse;x&&(x.angularSensibility=Z)}get keysUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUp:[]}set keysUp(Z){const x=this.inputs.attached.keyboard;x&&(x.keysUp=Z)}get keysUpward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysUpward:[]}set keysUpward(Z){const x=this.inputs.attached.keyboard;x&&(x.keysUpward=Z)}get keysDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDown:[]}set keysDown(Z){const x=this.inputs.attached.keyboard;x&&(x.keysDown=Z)}get keysDownward(){const Z=this.inputs.attached.keyboard;return Z?Z.keysDownward:[]}set keysDownward(Z){const x=this.inputs.attached.keyboard;x&&(x.keysDownward=Z)}get keysLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysLeft:[]}set keysLeft(Z){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=Z)}get keysRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRight:[]}set keysRight(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRight=Z)}get keysRotateLeft(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateLeft:[]}set keysRotateLeft(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRotateLeft=Z)}get keysRotateRight(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateRight:[]}set keysRotateRight(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRotateRight=Z)}get keysRotateUp(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateUp:[]}set keysRotateUp(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRotateUp=Z)}get keysRotateDown(){const Z=this.inputs.attached.keyboard;return Z?Z.keysRotateDown:[]}set keysRotateDown(Z){const x=this.inputs.attached.keyboard;x&&(x.keysRotateDown=Z)}constructor(Z,x,F){var u;super(Z,x,F,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),u=this,this.ellipsoid=new f.kx(.5,1,.5),this.ellipsoidOffset=new f.kx(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=f.kx.Zero(),this._diffPosition=f.kx.Zero(),this._newPosition=f.kx.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;u._newPosition.G(x),u._newPosition.subtractToRef(u._oldPosition,u._diffPosition),u._diffPosition.length()>H.d.CollisionsEpsilon&&(u.position.addToRef(u._diffPosition,u._deferredPositionUpdate),u._deferOnly?u._deferredUpdated=!0:u.position.G(u._deferredPositionUpdate),u.cp&&F&&u.cp(F))},this.inputs=new C(this),this.inputs.addKeyboard().addMouse()}attachControl(Z,x){x=t.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(x)}Rs(){this.inputs.detachElement(),this.cameraDirection=new f.kx(0,0,0),this.cameraRotation=new f.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(Z){this._collisionMask=isNaN(Z)?-1:Z}_collideWithWorld(Z){let x;x=this.parent?f.kx.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,x.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const F=this.KZ().collisionCoordinator;this._collider||(this._collider=F.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let u=Z;this.applyGravity&&(u=Z.add(this.KZ().gravity)),F.getNewPosition(this._oldPosition,u,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=f.kx.Zero(),this._transformedDirection=f.kx.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(Z){this._needMoveForGravity=Z}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.KZ().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"dd"}}(0,u.d)([(0,G.D)()],S.prototype,"ellipsoid",void 0),(0,u.d)([(0,G.D)()],S.prototype,"ellipsoidOffset",void 0),(0,u.d)([(0,G.H)()],S.prototype,"checkCollisions",void 0),(0,u.d)([(0,G.H)()],S.prototype,"applyGravity",void 0),(0,L.g)("BABYLON.FreeCamera",S)},13463:(Z,x,F)=>{"use strict";F.d(x,{e:()=>f});var u=F(11285),G=F(13470);class f{constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=F,this.wc=[],this._maxBlockCapacity=x||64,this._selectionContent=new u.b(1024),this._creationFunc=Z}update(Z,x,F){G.c._CreateBlocks(Z,x,F,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}oo(Z){for(let x=0;x<this.So.length;x++){this.So[x].addEntry(Z)}}do(Z){for(let x=0;x<this.So.length;x++){this.So[x].removeEntry(Z)}}select(Z,x){this._selectionContent.reset();for(let F=0;F<this.So.length;F++){this.So[F].select(Z,this._selectionContent,x)}return x?this._selectionContent.concat(this.wc):this._selectionContent.concatWithNoDuplicate(this.wc),this._selectionContent}intersects(Z,x,F){this._selectionContent.reset();for(let u=0;u<this.So.length;u++){this.So[u].intersects(Z,x,this._selectionContent,F)}return F?this._selectionContent.concat(this.wc):this._selectionContent.concatWithNoDuplicate(this.wc),this._selectionContent}intersectsRay(Z){this._selectionContent.reset();for(let x=0;x<this.So.length;x++){this.So[x].intersectsRay(Z,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.wc),this._selectionContent}}f.CreationFuncForMeshes=(Z,x)=>{const F=Z.getBoundingInfo();!Z.isBlocked&&F.boundingBox.intersectsMinMax(x.gc,x.Ic)&&x.entries.push(Z)},f.CreationFuncForSubMeshes=(Z,x)=>{Z.getBoundingInfo().boundingBox.intersectsMinMax(x.gc,x.Ic)&&x.entries.push(Z)}},13470:(Z,x,F)=>{"use strict";F.d(x,{c:()=>f});var u=F(11179),G=F(11552);class f{constructor(Z,x,F,u,G,f){this.entries=[],this.zc=new Array,this._capacity=F,this._depth=u,this._maxDepth=G,this._creationFunc=f,this._minPoint=Z,this._maxPoint=x,this.zc.push(Z.clone()),this.zc.push(x.clone()),this.zc.push(Z.clone()),this.zc[2].x=x.x,this.zc.push(Z.clone()),this.zc[3].y=x.y,this.zc.push(Z.clone()),this.zc[4].z=x.z,this.zc.push(x.clone()),this.zc[5].z=Z.z,this.zc.push(x.clone()),this.zc[6].x=Z.x,this.zc.push(x.clone()),this.zc[7].y=Z.y}get Kx(){return this._capacity}get gc(){return this._minPoint}get Ic(){return this._maxPoint}addEntry(Z){if(this.So)for(let x=0;x<this.So.length;x++){this.So[x].addEntry(Z)}else this._creationFunc(Z,this),this.entries.length>this.Kx&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(Z){if(this.So){for(let x=0;x<this.So.length;x++){this.So[x].removeEntry(Z)}return}const x=this.entries.indexOf(Z);x>-1&&this.entries.splice(x,1)}addEntries(Z){for(let x=0;x<Z.length;x++){const F=Z[x];this.addEntry(F)}}select(Z,x,F){if(G.d.IsInFrustum(this.zc,Z)){if(this.So){for(let u=0;u<this.So.length;u++){this.So[u].select(Z,x,F)}return}F?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersects(Z,x,F,u){if(G.d.IntersectsSphere(this._minPoint,this._maxPoint,Z,x)){if(this.So){for(let G=0;G<this.So.length;G++){this.So[G].intersects(Z,x,F,u)}return}u?F.concat(this.entries):F.concatWithNoDuplicate(this.entries)}}intersectsRay(Z,x){if(Z.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.So){for(let F=0;F<this.So.length;F++){this.So[F].intersectsRay(Z,x)}return}x.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){f._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(Z,x,F,G,Y,j,d,t){d.So=new Array;const o=new u.kx((x.x-Z.x)/2,(x.y-Z.y)/2,(x.z-Z.z)/2);for(let u=0;u<2;u++)for(let x=0;x<2;x++)for(let c=0;c<2;c++){const s=Z.add(o.multiplyByFloats(u,x,c)),J=Z.add(o.multiplyByFloats(u+1,x+1,c+1)),p=new f(s,J,G,Y+1,j,t);p.addEntries(F),d.So.push(p)}}}},13475:(Z,x,F)=>{"use strict";F.d(x,{d:()=>o});var u=F(11447),G=F(11179),f=F(11642),Y=F(12634),j=F(11475),d=F(13463),t=F(11037);u.d.prototype.createOrUpdateSelectionOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,F=this._getComponent(j.c.NAME_OCTREE);F||(F=new o(this),this.tf(F)),this.Sc||(this.Sc=new d.e(d.e.CreationFuncForMeshes,Z,x));const u=this.getWorldExtends();return this.Sc.update(u.min,u.max,this.meshes),this.Sc},Object.defineProperty(u.d.prototype,"selectionOctree",{get:function(){return this.Sc},enumerable:!0,configurable:!0}),f.c.prototype.createOrUpdateSubmeshesOctree=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const F=this.KZ();let u=F._getComponent(j.c.NAME_OCTREE);u||(u=new o(F),F.tf(u)),this._submeshesOctree||(this._submeshesOctree=new d.e(d.e.CreationFuncForSubMeshes,Z,x)),this.Qf(!0);const G=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(G.minimumWorld,G.maximumWorld,this.bf),this._submeshesOctree};class o{constructor(Z){this.name=j.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.b(G.kx.Zero(),new G.kx(1,1,1)),(Z=Z||t.c.LastCreatedScene)&&(this.mx=Z,this.mx.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.mx.getActiveSubMeshCandidates=Z=>this.getActiveSubMeshCandidates(Z),this.mx.getCollidingSubMeshCandidates=(Z,x)=>this.getCollidingSubMeshCandidates(Z,x),this.mx.getIntersectingSubMeshCandidates=(Z,x)=>this.getIntersectingSubMeshCandidates(Z,x))}register(){this.mx.onMeshRemovedObservable.add((Z=>{const x=this.mx.selectionOctree;if(void 0!==x&&null!==x){const F=x.wc.indexOf(Z);-1!==F&&x.wc.splice(F,1)}})),this.mx.onMeshImportedObservable.add((Z=>{const x=this.mx.selectionOctree;void 0!==x&&null!==x&&x.oo(Z)}))}getActiveMeshCandidates(){var Z;return(null===(Z=this.mx.Sc)||void 0===Z?void 0:Z.select(this.mx.frustumPlanes))||this.mx._getDefaultMeshCandidates()}getActiveSubMeshCandidates(Z){if(Z._submeshesOctree&&Z.useOctreeForRenderingSelection){return Z._submeshesOctree.select(this.mx.frustumPlanes)}return this.mx._getDefaultSubMeshCandidates(Z)}getIntersectingSubMeshCandidates(Z,x){if(Z._submeshesOctree&&Z.useOctreeForPicking){Y.b.TransformToRef(x,Z.getWorldMatrix(),this._tempRay);return Z._submeshesOctree.intersectsRay(this._tempRay)}return this.mx._getDefaultSubMeshCandidates(Z)}getCollidingSubMeshCandidates(Z,x){if(Z._submeshesOctree&&Z.useOctreeForCollisions){const F=x._velocityWorldLength+Math.max(x._radius.x,x._radius.y,x._radius.z);return Z._submeshesOctree.intersects(x._basePointWorld,F)}return this.mx._getDefaultSubMeshCandidates(Z)}rebuild(){}dispose(){}}},12634:(Z,x,F)=>{"use strict";F.d(x,{b:()=>J});var u=F(11447),G=F(11673),f=F(11188),Y=F(11179),j=F(11192),d=F(11541),t=F(11471),o=F(11037),c=F(11493);const s={internalPickerForMesh:void 0};class J{constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.e;this.origin=Z,this.direction=x,this.length=F,this.epsilon=u}clone(){return new J(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const u=J._TmpVector3[0].Jj(Z.x-F,Z.y-F,Z.z-F),G=J._TmpVector3[1].Jj(x.x+F,x.y+F,x.z+F);let f,Y,j,d,t=0,o=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<u.x||this.origin.x>G.x)return!1}else if(f=1/this.direction.x,Y=(u.x-this.origin.x)*f,j=(G.x-this.origin.x)*f,j===-1/0&&(j=1/0),Y>j&&(d=Y,Y=j,j=d),t=Math.max(Y,t),o=Math.min(j,o),t>o)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<u.y||this.origin.y>G.y)return!1}else if(f=1/this.direction.y,Y=(u.y-this.origin.y)*f,j=(G.y-this.origin.y)*f,j===-1/0&&(j=1/0),Y>j&&(d=Y,Y=j,j=d),t=Math.max(Y,t),o=Math.min(j,o),t>o)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<u.z||this.origin.z>G.z)return!1}else if(f=1/this.direction.z,Y=(u.z-this.origin.z)*f,j=(G.z-this.origin.z)*f,j===-1/0&&(j=1/0),Y>j&&(d=Y,Y=j,j=d),t=Math.max(Y,t),o=Math.min(j,o),t>o)return!1;return!0}intersectsBox(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(Z.minimum,Z.maximum,x)}intersectsSphere(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=Z.center.x-this.origin.x,u=Z.center.y-this.origin.y,G=Z.center.z-this.origin.z,f=F*F+u*u+G*G,Y=Z.radius+x,j=Y*Y;if(f<=j)return!0;const d=F*this.direction.x+u*this.direction.y+G*this.direction.z;if(d<0)return!1;return f-d*d<=j}intersectsTriangle(Z,x,F){const u=J._TmpVector3[0],G=J._TmpVector3[1],f=J._TmpVector3[2],j=J._TmpVector3[3],t=J._TmpVector3[4];x.subtractToRef(Z,u),F.subtractToRef(Z,G),Y.kx.CrossToRef(this.direction,G,f);const o=Y.kx.Dot(u,f);if(0===o)return null;const c=1/o;this.origin.subtractToRef(Z,j);const s=Y.kx.Dot(j,f)*c;if(s<-this.epsilon||s>1+this.epsilon)return null;Y.kx.CrossToRef(j,u,t);const p=Y.kx.Dot(this.direction,t)*c;if(p<-this.epsilon||s+p>1+this.epsilon)return null;const U=Y.kx.Dot(G,t)*c;return U>this.length?null:new d.c(1-s-p,s,U)}intersectsPlane(Z){let x;const F=Y.kx.Dot(Z.normal,this.direction);if(Math.abs(F)<9.99999997475243e-7)return null;{const u=Y.kx.Dot(Z.normal,this.origin);return x=(-Z.d-u)/F,x<0?x<-9.99999997475243e-7?null:0:x}}intersectsAxis(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(Z){case"y":{const Z=(this.origin.y-x)/this.direction.y;return Z>0?null:new Y.kx(this.origin.x+this.direction.x*-Z,x,this.origin.z+this.direction.z*-Z)}case"x":{const Z=(this.origin.x-x)/this.direction.x;return Z>0?null:new Y.kx(x,this.origin.y+this.direction.y*-Z,this.origin.z+this.direction.z*-Z)}case"z":{const Z=(this.origin.z-x)/this.direction.z;return Z>0?null:new Y.kx(this.origin.x+this.direction.x*-Z,this.origin.y+this.direction.y*-Z,x)}default:return null}}intersectsMesh(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const j=Y.TmpVectors.Matrix[0];return Z.getWorldMatrix().invertToRef(j),this._tmpRay?J.TransformToRef(this,j,this._tmpRay):this._tmpRay=J.Transform(this,j),Z.intersects(this._tmpRay,x,F,u,G,f)}intersectsMeshes(Z,x,F){F?F.length=0:F=[];for(let u=0;u<Z.length;u++){const G=this.intersectsMesh(Z[u],x);G.hit&&F.push(G)}return F.sort(this._comparePickingInfo),F}_comparePickingInfo(Z,x){return Z.distance<x.distance?-1:Z.distance>x.distance?1:0}intersectionSegment(Z,x,F){const u=this.origin,G=Y.TmpVectors.kx[0],f=Y.TmpVectors.kx[1],j=Y.TmpVectors.kx[2],d=Y.TmpVectors.kx[3];x.subtractToRef(Z,G),this.direction.scaleToRef(J._Rayl,j),u.addToRef(j,f),Z.subtractToRef(u,d);const t=Y.kx.Dot(G,G),o=Y.kx.Dot(G,j),c=Y.kx.Dot(j,j),s=Y.kx.Dot(G,d),p=Y.kx.Dot(j,d),U=t*c-o*o;let k,M,m=U,C=U;U<J._Smallnum?(k=0,m=1,M=p,C=c):(k=o*p-c*s,M=t*p-o*s,k<0?(k=0,M=p,C=c):k>m&&(k=m,M=p+o,C=c)),M<0?(M=0,-s<0?k=0:-s>t?k=m:(k=-s,m=t)):M>C&&(M=C,-s+o<0?k=0:-s+o>t?k=m:(k=-s+o,m=t));const L=Math.abs(k)<J._Smallnum?0:k/m,H=Math.abs(M)<J._Smallnum?0:M/C,S=Y.TmpVectors.kx[4];j.scaleToRef(H,S);const K=Y.TmpVectors.kx[5];G.scaleToRef(L,K),K.addInPlace(d);const y=Y.TmpVectors.kx[6];K.subtractToRef(S,y);return H>0&&H<=this.length&&y.lengthSquared()<F*F?K.length():-1}update(Z,x,F,u,G,f,j){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){J._RayDistant||(J._RayDistant=J.Zero()),J._RayDistant.unprojectRayToRef(Z,x,F,u,Y.Matrix.IdentityReadOnly,f,j);const d=Y.TmpVectors.Matrix[0];G.invertToRef(d),J.TransformToRef(J._RayDistant,d,this)}else this.unprojectRayToRef(Z,x,F,u,G,f,j);return this}static Zero(){return new J(Y.kx.Zero(),Y.kx.Zero())}static CreateNew(Z,x,F,u,G,f,Y){return J.Zero().update(Z,x,F,u,G,f,Y)}static CreateNewFromTo(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Matrix.IdentityReadOnly;const u=new J(new Y.kx(0,0,0),new Y.kx(0,0,0));return J.CreateFromToToRef(Z,x,u,F)}static CreateFromToToRef(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.Matrix.IdentityReadOnly;F.origin.G(Z);const G=x.subtractToRef(Z,F.direction),f=Math.sqrt(G.x*G.x+G.y*G.y+G.z*G.z);return F.length=f,F.direction.normalize(),J.TransformToRef(F,u,F)}static Transform(Z,x){const F=new J(new Y.kx(0,0,0),new Y.kx(0,0,0));return J.TransformToRef(Z,x,F),F}static TransformToRef(Z,x,F){Y.kx.TransformCoordinatesToRef(Z.origin,x,F.origin),Y.kx.TransformNormalToRef(Z.direction,x,F.direction),F.length=Z.length,F.epsilon=Z.epsilon;const u=F.direction,G=u.length();if(0!==G&&1!==G){const Z=1/G;u.x*=Z,u.y*=Z,u.z*=Z,F.length*=G}return F}unprojectRayToRef(Z,x,F,u,G,f,j){const d=Y.TmpVectors.Matrix[0];G.multiplyToRef(f,d),d.multiplyToRef(j,d),d.invert();const t=o.c.LastCreatedEngine,c=Y.TmpVectors.kx[0];c.x=Z/F*2-1,c.y=-(x/u*2-1),c.z=null!==t&&void 0!==t&&t.useReverseDepthBuffer?1:null!==t&&void 0!==t&&t.isNDCHalfZRange?0:-1;const s=Y.TmpVectors.kx[1].Jj(c.x,c.y,1-1e-8),J=Y.TmpVectors.kx[2],p=Y.TmpVectors.kx[3];Y.kx._UnprojectFromInvertedMatrixToRef(c,d,J),Y.kx._UnprojectFromInvertedMatrixToRef(s,d,p),this.origin.G(J),p.subtractToRef(J,this.direction),this.direction.normalize()}}function p(Z,x,F,u,G){let f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=J.Zero();return U(Z,x,F,u,Y,G,f),Y}function U(Z,x,F,u,G,f){let j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const t=Z.getEngine();if(!f&&!(f=Z.activeCamera))return Z;const o=f.viewport,c=t.getRenderHeight(),{x:s,y:J,width:p,height:U}=o.toGlobal(t.getRenderWidth(),c),k=1/t.getHardwareScalingLevel();return x=x*k-s,F=F*k-(c-J-U),G.update(x,F,p,U,u||Y.Matrix.IdentityReadOnly,j?Y.Matrix.IdentityReadOnly:f.getViewMatrix(),f.getProjectionMatrix(),d),Z}function k(Z,x,F,u,G){if(!t.d)return Z;const f=Z.getEngine();if(!G&&!(G=Z.activeCamera))throw new Error("Active camera not set");const j=G.viewport,d=f.getRenderHeight(),{x:o,y:c,width:s,height:J}=j.toGlobal(f.getRenderWidth(),d),p=Y.Matrix.Identity(),U=1/f.getHardwareScalingLevel();return x=x*U-o,F=F*U-(d-c-J),u.update(x,F,s,J,p,p,G.getProjectionMatrix()),Z}function M(Z,x,F,u,G,f,Y,j){const d=x(u,F.enableDistantPicking),t=F.intersects(d,G,Y,f,u,j);return t&&t.hit?!G&&null!=Z&&t.distance>=Z.distance?null:t:null}function m(Z,x,F,u,G,f){let j=null;const d=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),o=Z.cameraToUseForPointers||Z.activeCamera,c=s.internalPickerForMesh||M;for(let t=0;t<Z.meshes.length;t++){const s=Z.meshes[t];if(F){if(!F(s,-1))continue}else if(!s.isEnabled()||!s.isVisible||!s.Xd)continue;const J=d&&s.isWorldMatrixCameraDependent(),p=s.Qf(J,o);if(s.hasThinInstances&&s.thinInstanceEnablePicking){const Z=c(j,x,s,p,!0,!0,f);if(Z){if(G)return Z;const d=Y.TmpVectors.Matrix[1],t=s.thinInstanceGetWorldMatrices();for(let Z=0;Z<t.length;Z++){if(F&&!F(s,Z))continue;t[Z].multiplyToRef(p,d);const Y=c(j,x,s,d,u,G,f,!0);if(Y&&(j=Y,j.thinInstanceIndex=Z,u))return j}}}else{const Z=c(j,x,s,p,u,G,f);if(Z&&(j=Z,u))return j}}return j||new t.d}function C(Z,x,F,u){if(!t.d)return null;const G=[],f=!!(Z.activeCameras&&Z.activeCameras.length>1&&Z.cameraToUseForPointers!==Z.activeCamera),j=Z.cameraToUseForPointers||Z.activeCamera,d=s.internalPickerForMesh||M;for(let t=0;t<Z.meshes.length;t++){const o=Z.meshes[t];if(F){if(!F(o,-1))continue}else if(!o.isEnabled()||!o.isVisible||!o.Xd)continue;const c=f&&o.isWorldMatrixCameraDependent(),s=o.Qf(c,j);if(o.hasThinInstances&&o.thinInstanceEnablePicking){if(d(null,x,o,s,!0,!0,u)){const Z=Y.TmpVectors.Matrix[1],f=o.thinInstanceGetWorldMatrices();for(let Y=0;Y<f.length;Y++){if(F&&!F(o,Y))continue;f[Y].multiplyToRef(s,Z);const j=d(null,x,o,Z,!1,!1,u,!0);j&&(j.thinInstanceIndex=Y,G.push(j))}}}else{const Z=d(null,x,o,s,!1,!1,u);Z&&G.push(Z)}}return G}function L(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,u=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;u||(u=Z.getWorldMatrix()),x.length=F,G?x.origin.G(G):x.origin.G(Z.position);const f=Y.TmpVectors.kx[2];f.set(0,0,Z._scene.useRightHandedSystem?-1:1);const j=Y.TmpVectors.kx[3];return Y.kx.TransformNormalToRef(f,u,j),Y.kx.NormalizeToRef(j,x.direction),x}var H,S;J._TmpVector3=(0,j.b)(6,Y.kx.Zero),J._RayDistant=J.Zero(),J._Smallnum=1e-8,J._Rayl=1e9,H=u.d,(S=G.c)&&(S.prototype.getForwardRay=function(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,x=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;return L(this,new J(Y.kx.Zero(),Y.kx.Zero(),Z),Z,x,F)},S.prototype.getForwardRayToRef=function(Z){return L(this,Z,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),H&&(c.e._IsPickingAvailable=!0,H.prototype.createPickingRay=function(Z,x,F,u){return p(this,Z,x,F,u,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),u.d.prototype.createPickingRayToRef=function(Z,x,F,u,G){return U(this,Z,x,F,u,G,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},u.d.prototype.createPickingRayInCameraSpace=function(Z,x,F){return function(Z,x,F,u){const G=J.Zero();return k(Z,x,F,G,u),G}(this,Z,x,F)},u.d.prototype.createPickingRayInCameraSpaceToRef=function(Z,x,F,u){return k(this,Z,x,F,u)},u.d.prototype.pickWithBoundingInfo=function(Z,x,F,u,G){return function(Z,x,F,u,G,f){if(!t.d)return null;const j=m(Z,(u=>(Z._tempPickingRay||(Z._tempPickingRay=J.Zero()),U(Z,x,F,u,Z._tempPickingRay,f||null),Z._tempPickingRay)),u,G,!0);return j&&(j.ray=p(Z,x,F,Y.Matrix.Identity(),f||null)),j}(this,Z,x,F,u,G)},u.d.prototype.MF=function(Z,x,F,u,G,f){return function(Z,x,F,u,G,f,j){const d=m(Z,((u,G)=>(Z._tempPickingRay||(Z._tempPickingRay=J.Zero()),U(Z,x,F,u,Z._tempPickingRay,f||null,!1,G),Z._tempPickingRay)),u,G,!1,j);return d&&(d.ray=p(Z,x,F,Y.Matrix.Identity(),f||null)),d}(this,Z,x,F,u,G,f)},u.d.prototype.pickWithRay=function(Z,x,F,u){return function(Z,x,F,u,G){const f=m(Z,(F=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=Y.Matrix.Identity()),F.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=J.Zero()),J.TransformToRef(x,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),F,u,!1,G);return f&&(f.ray=x),f}(this,Z,x,F,u)},u.d.prototype.multiPick=function(Z,x,F,u,G){return function(Z,x,F,u,G,f){return C(Z,(u=>p(Z,x,F,u,G||null)),u,f)}(this,Z,x,F,u,G)},u.d.prototype.multiPickWithRay=function(Z,x,F){return function(Z,x,F,u){return C(Z,(F=>(Z._pickWithRayInverseMatrix||(Z._pickWithRayInverseMatrix=Y.Matrix.Identity()),F.invertToRef(Z._pickWithRayInverseMatrix),Z._cachedRayForTransform||(Z._cachedRayForTransform=J.Zero()),J.TransformToRef(x,Z._pickWithRayInverseMatrix,Z._cachedRayForTransform),Z._cachedRayForTransform)),F,u)}(this,Z,x,F)}},12914:(Z,x,F)=>{"use strict";var u=F(11117),G=F(11012),f=F(11041),Y=F(11144),j=F(11081),d=F(11129);j.d.prototype._partialLoadFile=function(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(Z,(Z=>{F[x]=Z,F._internalCount++,6===F._internalCount&&u(F)}),void 0,void 0,!0,((Z,x)=>{G&&Z&&G(Z.status+" "+Z.statusText,x)}))},j.d.prototype._cascadeLoadFiles=function(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=[];G._internalCount=0;for(let f=0;f<6;f++)this._partialLoadFile(F[f],f,G,x,u)},j.d.prototype._cascadeLoadImgs=function(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let j=0;j<6;j++)this._partialLoadImg(u[j],j,Y,Z,x,F,G,f)},j.d.prototype._partialLoadImg=function(Z,x,F,u,G,j){let d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7?arguments[7]:void 0;const o=(0,Y.c)();(0,f.q)(Z,(Z=>{F[x]=Z,F._internalCount++,u&&u.removePendingData(o),6===F._internalCount&&j&&j(G,F)}),((Z,x)=>{u&&u.removePendingData(o),d&&d(Z,x)}),u?u.offlineProvider:null,t),u&&u.addPendingData(o)},j.d.prototype.createCubeTextureBase=function(Z,x,F,f){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,U=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,k=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,M=arguments.length>14&&void 0!==arguments[14]&&arguments[14],m=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const C=p||new u.e(this,7);C.isCube=!0,C.url=Z,C.generateMipMaps=!f,C._lodGenerationScale=s,C._lodGenerationOffset=J,C._useSRGBBuffer=!!M&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!f),C!==p&&(C.label=Z.substring(0,60)),this._doNotHandleContextLost||(C._extension=o,C._files=F,C._buffer=m);const L=Z;this._transformTextureUrl&&!p&&(Z=this._transformTextureUrl(Z));const H=o??function(Z){const x=Z.split("?")[0],F=x.lastIndexOf(".");return F>-1?x.substring(F).toLowerCase():""}(Z),S=(0,d.b)(H),K=(Z,x)=>{C.dispose(),j?j(Z,x):Z&&G.d.Warn(Z)},y=(u,j)=>{Z===L?u&&K(u.status+" "+u.statusText,j):(G.d.Warn(`Failed to load ${Z}, falling back to the ${L}`),this.createCubeTextureBase(L,x,F,!!f,Y,K,t,o,c,s,J,C,U,k,M,m))};if(S)S.then((u=>{const G=Z=>{U&&U(C,Z),u.loadCubeData(Z,C,c,Y,((Z,x)=>{K(Z,x)}))};m?G(m):F&&6===F.length?u.supportCascades?this._cascadeLoadFiles(x,(Z=>G(Z.map((Z=>new Uint8Array(Z))))),F,K):K("Textures type does not support cascades."):this._loadFile(Z,(Z=>G(new Uint8Array(Z))),void 0,void 0,!0,y)}));else{if(!F||0===F.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(x,C,((Z,x)=>{k&&k(Z,x)}),F,K)}return this._internalTexturesCache.push(C),C}},13479:(Z,x,F)=>{"use strict";F(11012);var u=F(11319);F(11117),F(11267),F(11110),F(11382),F(11334);u.b},12949:(Z,x,F)=>{"use strict";F.d(x,{d:()=>G});var u=F(11136);class G{constructor(Z){this.value=this._toInt(Z)}_toInt(Z){return 0|Z}add(Z){return new G(this.value+Z.value)}Mx(Z){return new G(this.value-Z.value)}multiply(Z){return new G(Math.imul(this.value,Z.value))}divide(Z){return new G(this.value/Z.value)}getClassName(){return G.ClassName}equals(Z){return this.value===Z.value}static FromValue(Z){return new G(Z)}toString(){return this.value.toString()}}G.ClassName="FlowGraphInteger",(0,u.g)("FlowGraphInteger",G)},12957:(Z,x,F)=>{"use strict";F.d(x,{c:()=>G,e:()=>f});var u=F(11179);class G{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Mf=Z}get m(){return this.Mf}transformVector(Z){return this.transformVectorToRef(Z,new u.Vector2)}transformVectorToRef(Z,x){return x.x=Z.x*this.Mf[0]+Z.y*this.Mf[1],x.y=Z.x*this.Mf[2]+Z.y*this.Mf[3],x}Wf(){return this.toArray()}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<4;x++)Z[x]=this.Mf[x];return Z}mF(Z){for(let x=0;x<4;x++)this.Mf[x]=Z[x];return this}multiplyToRef(Z,x){const F=Z.Mf,u=this.Mf,G=x.Mf;return G[0]=F[0]*u[0]+F[1]*u[2],G[1]=F[0]*u[1]+F[1]*u[3],G[2]=F[2]*u[0]+F[3]*u[2],G[3]=F[2]*u[1]+F[3]*u[3],x}multiply(Z){return this.multiplyToRef(Z,new G)}divideToRef(Z,x){const F=this.Mf,u=Z.Mf,G=x.Mf;return G[0]=F[0]/u[0],G[1]=F[1]/u[1],G[2]=F[2]/u[2],G[3]=F[3]/u[3],x}divide(Z){return this.divideToRef(Z,new G)}addToRef(Z,x){const F=this.Mf,u=Z.m,G=x.m;return G[0]=F[0]+u[0],G[1]=F[1]+u[1],G[2]=F[2]+u[2],G[3]=F[3]+u[3],x}add(Z){return this.addToRef(Z,new G)}subtractToRef(Z,x){const F=this.Mf,u=Z.m,G=x.m;return G[0]=F[0]-u[0],G[1]=F[1]-u[1],G[2]=F[2]-u[2],G[3]=F[3]-u[3],x}Mx(Z){return this.subtractToRef(Z,new G)}transpose(){const Z=this.Mf;return new G([Z[0],Z[2],Z[1],Z[3]])}determinant(){const Z=this.Mf;return Z[0]*Z[3]-Z[1]*Z[2]}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const x=this.Mf,F=1/Z;return new G([x[3]*F,-x[1]*F,-x[2]*F,x[0]*F])}equals(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.Mf,u=Z.m;return 0===x?F[0]===u[0]&&F[1]===u[1]&&F[2]===u[2]&&F[3]===u[3]:Math.abs(F[0]-u[0])<x&&Math.abs(F[1]-u[1])<x&&Math.abs(F[2]-u[2])<x&&Math.abs(F[3]-u[3])<x}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Mf.join(", ")})`}}class f{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Mf=Z}get m(){return this.Mf}transformVector(Z){return this.transformVectorToRef(Z,new u.kx)}transformVectorToRef(Z,x){const F=this.Mf;return x.x=Z.x*F[0]+Z.y*F[1]+Z.z*F[2],x.y=Z.x*F[3]+Z.y*F[4]+Z.z*F[5],x.z=Z.x*F[6]+Z.y*F[7]+Z.z*F[8],x}multiplyToRef(Z,x){const F=Z.Mf,u=this.Mf,G=x.m;return G[0]=F[0]*u[0]+F[1]*u[3]+F[2]*u[6],G[1]=F[0]*u[1]+F[1]*u[4]+F[2]*u[7],G[2]=F[0]*u[2]+F[1]*u[5]+F[2]*u[8],G[3]=F[3]*u[0]+F[4]*u[3]+F[5]*u[6],G[4]=F[3]*u[1]+F[4]*u[4]+F[5]*u[7],G[5]=F[3]*u[2]+F[4]*u[5]+F[5]*u[8],G[6]=F[6]*u[0]+F[7]*u[3]+F[8]*u[6],G[7]=F[6]*u[1]+F[7]*u[4]+F[8]*u[7],G[8]=F[6]*u[2]+F[7]*u[5]+F[8]*u[8],x}multiply(Z){return this.multiplyToRef(Z,new f)}divideToRef(Z,x){const F=this.Mf,u=Z.m,G=x.m;return G[0]=F[0]/u[0],G[1]=F[1]/u[1],G[2]=F[2]/u[2],G[3]=F[3]/u[3],G[4]=F[4]/u[4],G[5]=F[5]/u[5],G[6]=F[6]/u[6],G[7]=F[7]/u[7],G[8]=F[8]/u[8],x}divide(Z){return this.divideToRef(Z,new f)}addToRef(Z,x){const F=this.Mf,u=Z.m,G=x.m;return G[0]=F[0]+u[0],G[1]=F[1]+u[1],G[2]=F[2]+u[2],G[3]=F[3]+u[3],G[4]=F[4]+u[4],G[5]=F[5]+u[5],G[6]=F[6]+u[6],G[7]=F[7]+u[7],G[8]=F[8]+u[8],x}add(Z){return this.addToRef(Z,new f)}subtractToRef(Z,x){const F=this.Mf,u=Z.m,G=x.m;return G[0]=F[0]-u[0],G[1]=F[1]-u[1],G[2]=F[2]-u[2],G[3]=F[3]-u[3],G[4]=F[4]-u[4],G[5]=F[5]-u[5],G[6]=F[6]-u[6],G[7]=F[7]-u[7],G[8]=F[8]-u[8],x}Mx(Z){return this.subtractToRef(Z,new f)}toArray(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<9;x++)Z[x]=this.Mf[x];return Z}Wf(){return this.toArray()}mF(Z){for(let x=0;x<9;x++)this.Mf[x]=Z[x];return this}transpose(){const Z=this.Mf;return new f([Z[0],Z[3],Z[6],Z[1],Z[4],Z[7],Z[2],Z[5],Z[8]])}determinant(){const Z=this.Mf;return Z[0]*(Z[4]*Z[8]-Z[5]*Z[7])-Z[1]*(Z[3]*Z[8]-Z[5]*Z[6])+Z[2]*(Z[3]*Z[7]-Z[4]*Z[6])}inverse(){const Z=this.determinant();if(0===Z)throw new Error("Matrix is not invertible");const x=this.Mf,F=1/Z;return new f([(x[4]*x[8]-x[5]*x[7])*F,(x[2]*x[7]-x[1]*x[8])*F,(x[1]*x[5]-x[2]*x[4])*F,(x[5]*x[6]-x[3]*x[8])*F,(x[0]*x[8]-x[2]*x[6])*F,(x[2]*x[3]-x[0]*x[5])*F,(x[3]*x[7]-x[4]*x[6])*F,(x[1]*x[6]-x[0]*x[7])*F,(x[0]*x[4]-x[1]*x[3])*F])}equals(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.Mf,u=Z.m;return 0===x?F[0]===u[0]&&F[1]===u[1]&&F[2]===u[2]&&F[3]===u[3]&&F[4]===u[4]&&F[5]===u[5]&&F[6]===u[6]&&F[7]===u[7]&&F[8]===u[8]:Math.abs(F[0]-u[0])<x&&Math.abs(F[1]-u[1])<x&&Math.abs(F[2]-u[2])<x&&Math.abs(F[3]-u[3])<x&&Math.abs(F[4]-u[4])<x&&Math.abs(F[5]-u[5])<x&&Math.abs(F[6]-u[6])<x&&Math.abs(F[7]-u[7])<x&&Math.abs(F[8]-u[8])<x}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Mf.join(", ")})`}}},12963:(Z,x,F)=>{"use strict";var u;function G(Z,x,F,u){switch(x){case"Animation":return u?Z.animations.find((Z=>Z.uniqueId===F))??null:Z.animations[F]??null;case"AnimationGroup":return u?Z.animationGroups.find((Z=>Z.uniqueId===F))??null:Z.animationGroups[F]??null;case"Mesh":return u?Z.meshes.find((Z=>Z.uniqueId===F))??null:Z.meshes[F]??null;case"Material":return u?Z.materials.find((Z=>Z.uniqueId===F))??null:Z.materials[F]??null;case"mo":return u?Z.cameras.find((Z=>Z.uniqueId===F))??null:Z.cameras[F]??null;case"Light":return u?Z.lights.find((Z=>Z.uniqueId===F))??null:Z.lights[F]??null;default:return null}}F.d(x,{d:()=>G}),function(Z){Z.Animation="Animation",Z.AnimationGroup="AnimationGroup",Z.Mesh="Mesh",Z.Material="Material",Z.mo="mo",Z.Light="Light"}(u||(u={}))},13005:(Z,x,F)=>{"use strict";F.d(x,{b:()=>G});var u=F(13007);class G extends u.e{constructor(Z,x){if(super(Z),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),x)for(const F of x)this._eventsSignalOutputs[F]=this._registerSignalOutput(F+"Event")}_executeOnTick(Z){}_startPendingTasks(Z){Z._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(Z),this._resetAfterCanceled(Z)),this._preparePendingTasks(Z),Z._addPendingBlock(this),this.out._activateSignal(Z),Z._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(Z){Z._deleteExecutionVariable(this,"_initialized"),Z._removePendingBlock(this)}}},12977:(Z,x,F)=>{"use strict";F.d(x,{e:()=>t});var u=F(11144),G=F(11136),f=F(12982),Y=F(11e3),j=F(12941);class d extends f.b{constructor(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.defaultValue,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(Z,x,F),this.richType=u,this._defaultValue=G,this._optional=f,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(Z){this._isDisabled!==Z&&(this._isDisabled=Z,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(Z,x){x._getConnectionValue(this)!==Z&&(x._setConnectionValue(this,Z),this.onValueChangedObservable.notifyObservers(Z))}resetToDefaultValue(Z){Z._setConnectionValue(this,this._defaultValue)}connectTo(Z){this._isDisabled||super.connectTo(Z)}_getValueOrDefault(Z){const x=Z._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(x):x}getValue(Z){if(1===this.connectionType){Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(Z);const x=this._getValueOrDefault(Z);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}const x=this.isConnected()?this._connectedPoint[0].getValue(Z):this._getValueOrDefault(Z);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.richType={},this.richType.serialize(Z.richType),Z.optional=this._optional,(0,j.e)("defaultValue",this._defaultValue,Z)}}(0,G.g)("FlowGraphDataConnection",d);class t{constructor(Z){var x;this.config=Z,this.uniqueId=(0,u.c)(),this.name=(null===(x=this.config)||void 0===x?void 0:x.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(Z){}registerDataInput(Z,x,F){const u=new d(Z,0,this,x,F);return this.dataInputs.push(u),u}registerDataOutput(Z,x,F){const u=new d(Z,1,this,x,F);return this.dataOutputs.push(u),u}getDataInput(Z){return this.dataInputs.find((x=>x.name===Z))}getDataOutput(Z){return this.dataOutputs.find((x=>x.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.e;if(Z.uniqueId=this.uniqueId,Z.config={},this.config){const F=this.config,u=Object.keys(F);for(const G of u)x(G,F[G],Z.config)}Z.dataInputs=[],Z.dataOutputs=[],Z.className=this.getClassName();for(const F of this.dataInputs){const x={};F.serialize(x),Z.dataInputs.push(x)}for(const F of this.dataOutputs){const x={};F.serialize(x),Z.dataOutputs.push(x)}}deserialize(Z){}_log(Z,x,F){var u;null===(u=Z.logger)||void 0===u||u.addLogItem({action:x,payload:F,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12982:(Z,x,F)=>{"use strict";F.d(x,{b:()=>f});var u,G=F(11144);!function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(u||(u={}));class f{constructor(Z,x,F){this._ownerBlock=F,this._connectedPoint=[],this.uniqueId=(0,G.c)(),this.connectedPointIds=[],this.name=Z,this._connectionType=x}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(Z){if(this._connectionType===Z._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||Z._isSingularConnection()&&Z._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(Z),Z._connectedPoint.push(this)}disconnectFrom(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const F=this._connectedPoint.indexOf(Z),u=Z._connectedPoint.indexOf(this);-1!==F&&-1!==u&&(x&&this._connectedPoint.splice(F,1),Z._connectedPoint.splice(u,1))}disconnectFromAll(){for(const Z of this._connectedPoint)this.disconnectFrom(Z,!1);this._connectedPoint.length=0}dispose(){for(const Z of this._connectedPoint)this.disconnectFrom(Z)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Z.uniqueId=this.uniqueId,Z.name=this.name,Z._connectionType=this._connectionType,Z.connectedPointIds=[],Z.className=this.getClassName();for(const x of this._connectedPoint)Z.connectedPointIds.push(x.uniqueId)}getClassName(){return"FGConnection"}deserialize(Z){this.uniqueId=Z.uniqueId,this.name=Z.name,this._connectionType=Z._connectionType,this.connectedPointIds=Z.connectedPointIds}}},12936:(Z,x,F)=>{"use strict";F.d(x,{d:()=>C});var u,G=F(11e3),f=F(11159),Y=F(11165),j=F(11144),d=F(12941),t=F(12963),o=F(11012);!function(Z){Z.ExecuteBlock="ExecuteBlock",Z.ExecuteEvent="ExecuteEvent",Z.TriggerConnection="TriggerConnection",Z.ContextVariableSet="ContextVariableSet",Z.GlobalVariableSet="GlobalVariableSet",Z.GlobalVariableDelete="GlobalVariableDelete",Z.GlobalVariableGet="GlobalVariableGet",Z.AddConnection="AddConnection",Z.GetConnectionValue="GetConnectionValue",Z.SetConnectionValue="SetConnectionValue",Z.ActivateSignal="ActivateSignal",Z.ContextVariableGet="ContextVariableGet"}(u||(u={}));class c{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(Z){if(Z.time||(Z.time=Date.now()),this.log.push(Z),this.logToConsole){var x;const F=null===(x=Z.payload)||void 0===x?void 0:x.value;"object"===typeof F&&F.getClassName?o.d.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(F.getClassName())}: ${F.toString()}`):o.d.Log(`[FGLog] ${Z.className}:${Z.uniqueId.split("-")[0]} ${Z.action} - ${JSON.stringify(Z.payload)}`)}}getItemsOfType(Z){return this.log.filter((x=>x.action===Z))}}class s{get enableLogging(){return this._enableLogging}set enableLogging(Z){this._enableLogging!==Z&&(this._enableLogging=Z,this._enableLogging?(this.logger=new c,this.logger.logToConsole=!0):this.logger=null)}constructor(Z){this.uniqueId=(0,j.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new G.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=Z,this.assetsContext=Z.assetsContext??Z.mx}hasVariable(Z){return Z in this._userVariables}setVariable(Z,x){var F;this._userVariables[Z]=x,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:Z,value:x}})}getAsset(Z,x){return(0,t.d)(this.assetsContext,Z,x)}getVariable(Z){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:Z,value:this._userVariables[Z]}}),this._userVariables[Z]}get userVariables(){return this._userVariables}KZ(){return this._configuration.mx}_getUniqueIdPrefixedName(Z,x){return`${Z.uniqueId}_${x}`}_getGlobalContextVariable(Z,x){var F;return null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:Z,defaultValue:x,possibleValue:this._globalContextVariables[Z]}}),this._hasGlobalContextVariable(Z)?this._globalContextVariables[Z]:x}_setGlobalContextVariable(Z,x){var F;null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:Z,value:x}}),this._globalContextVariables[Z]=x}_deleteGlobalContextVariable(Z){var x;null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:Z}}),delete this._globalContextVariables[Z]}_hasGlobalContextVariable(Z){return Z in this._globalContextVariables}_setExecutionVariable(Z,x,F){this._executionVariables[this._getUniqueIdPrefixedName(Z,x)]=F}_getExecutionVariable(Z,x,F){return this._hasExecutionVariable(Z,x)?this._executionVariables[this._getUniqueIdPrefixedName(Z,x)]:F}_deleteExecutionVariable(Z,x){delete this._executionVariables[this._getUniqueIdPrefixedName(Z,x)]}_hasExecutionVariable(Z,x){return this._getUniqueIdPrefixedName(Z,x)in this._executionVariables}_hasConnectionValue(Z){return Z.uniqueId in this._connectionValues}_setConnectionValue(Z,x){var F;this._connectionValues[Z.uniqueId]=x,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:x}})}_setConnectionValueByKey(Z,x){this._connectionValues[Z]=x}_getConnectionValue(Z){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:Z.uniqueId,value:this._connectionValues[Z.uniqueId]}}),this._connectionValues[Z.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(Z){this._pendingBlocks.includes(Z)||(this._pendingBlocks.push(Z),this._pendingBlocks.sort(((Z,x)=>Z.priority-x.priority)))}_removePendingBlock(Z){const x=this._pendingBlocks.indexOf(Z);-1!==x&&this._pendingBlocks.splice(x,1)}_clearPendingBlocks(){for(const Z of this._pendingBlocks)Z._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(Z){var x;this.onNodeExecutedObservable.notifyObservers(Z),null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:Z.getClassName(),uniqueId:Z.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(Z){this._setGlobalContextVariable("timeSinceStart",Z.timeSinceStart),this._setGlobalContextVariable("deltaTime",Z.deltaTime);for(const F of this._pendingBlocks){var x;null===(x=F._executeOnTick)||void 0===x||x.call(F,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.e;Z.uniqueId=this.uniqueId,Z._userVariables={};for(const u in this._userVariables)x(u,this._userVariables[u],Z._userVariables);Z._connectionValues={};for(const u in this._connectionValues)x(u,this._connectionValues[u],Z._connectionValues);var F;this.assetsContext!==this.KZ()&&(Z._assetsContext={meshes:this.assetsContext.meshes.map((Z=>Z.id)),materials:this.assetsContext.materials.map((Z=>Z.id)),textures:this.assetsContext.textures.map((Z=>Z.name)),animations:this.assetsContext.animations.map((Z=>Z.name)),lights:this.assetsContext.lights.map((Z=>Z.id)),cameras:this.assetsContext.cameras.map((Z=>Z.id)),vJ:null===(F=this.assetsContext.vJ)||void 0===F?void 0:F.map((Z=>Z.name)),skeletons:this.assetsContext.skeletons.map((Z=>Z.id)),Vs:this.assetsContext.Vs.map((Z=>Z.name)),geometries:this.assetsContext.geometries.map((Z=>Z.id)),multiMaterials:this.assetsContext.multiMaterials.map((Z=>Z.id)),transformNodes:this.assetsContext.transformNodes.map((Z=>Z.id))})}getClassName(){return"FlowGraphContext"}}(0,f.d)([(0,Y.H)()],s.prototype,"uniqueId",void 0);var J=F(12968),p=F(11480);class U{constructor(Z){this.onEventTriggeredObservable=new G.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=Z,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Uf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const Z=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:Z}}),this._startingTime+=Z})),this._meshPickedObserver=this._scene.onPointerObservable.add((Z=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:Z})}),p.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((Z=>{const x=Z.pointerId,F=Z.mesh,u=this._pointerUnderMeshState[x];!u&&F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:x,mesh:F}}):u&&!F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:x,mesh:u}}):u&&F&&u!==F&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:x,mesh:u,over:F}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:x,mesh:F,out:u}})),this._pointerUnderMeshState[x]=F}),p.b.POINTERMOVE)}dispose(){var Z,x,F,u,G;null===(Z=this._sceneDisposeObserver)||void 0===Z||Z.remove(),null===(x=this._sceneReadyObserver)||void 0===x||x.remove(),null===(F=this._sceneOnBeforeRenderObserver)||void 0===F||F.remove(),null===(u=this._meshPickedObserver)||void 0===u||u.remove(),null===(G=this._meshUnderPointerObserver)||void 0===G||G.remove(),this.onEventTriggeredObservable.clear()}}var k,M=F(12990);!function(Z){Z[Z.Stopped=0]="Stopped",Z[Z.Started=1]="Started"}(k||(k={}));class m{get state(){return this._state}set state(Z){this._state=Z,this.onStateChangedObservable.notifyObservers(Z)}constructor(Z){this.onStateChangedObservable=new G.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=Z.mx,this._sceneEventCoordinator=new U(this._scene),this._coordinator=Z.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((Z=>{for(const x of this._executionContexts){const F=this._getContextualOrder(Z.type,x);for(const u of F)if(!u._executeEvent(x,Z.payload))break}switch(Z.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const x of this._executionContexts)x._notifyOnTick(Z.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const Z=new s({mx:this._scene,coordinator:this._coordinator});return this._executionContexts.push(Z),Z}getContext(Z){return this._executionContexts[Z]}addEventBlock(Z){if("PointerOver"!==Z.type&&"PointerOut"!==Z.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==Z.type&&this._eventBlocks[Z.type].push(Z),1===this.state)for(const x of this._executionContexts)Z._startPendingTasks(x);else this.onStateChangedObservable.addOnce((x=>{if(1===x)for(const F of this._executionContexts)Z._startPendingTasks(F)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((Z=>{1===Z&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const Z of this._executionContexts)for(const x in this._eventBlocks){const F=this._getContextualOrder(x,Z);for(const x of F)x._startPendingTasks(Z)}}_getContextualOrder(Z,x){const F=this._eventBlocks[Z].sort(((Z,x)=>x.initPriority-Z.initPriority));if("MeshPick"===Z){const Z=[];for(const u of F){const G=u.asset.getValue(x);let f=0;for(;f<F.length;f++){const Z=F[f].asset.getValue(x);if(G&&Z&&(0,M.q)(G,Z))break}Z.splice(f,0,u)}return Z}return F}dispose(){var Z;if(0!==this.state){this.state=0;for(const Z of this._executionContexts)Z._clearPendingBlocks();this._executionContexts.length=0;for(const Z in this._eventBlocks)this._eventBlocks[Z].length=0;null===(Z=this._eventObserver)||void 0===Z||Z.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(Z){const x=[],F=new Set;for(const u in this._eventBlocks)for(const Z of this._eventBlocks[u])x.push(Z),F.add(Z.uniqueId);for(;x.length>0;){const u=x.pop();Z(u);for(const Z of u.dataInputs)for(const u of Z._connectedPoint)F.has(u._ownerBlock.uniqueId)||(x.push(u._ownerBlock),F.add(u._ownerBlock.uniqueId));if(u instanceof J.e)for(const Z of u.signalOutputs)for(const u of Z._connectedPoint)F.has(u._ownerBlock.uniqueId)||(x.push(u._ownerBlock),F.add(u._ownerBlock.uniqueId))}}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1?arguments[1]:void 0;Z.allBlocks=[],this.visitAllBlocks((x=>{const F={};x.serialize(F),Z.allBlocks.push(F)})),Z.executionContexts=[];for(const F of this._executionContexts){const u={};F.serialize(u,x),Z.executionContexts.push(u)}}}class C{constructor(Z){this.config=Z,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.mx.Uf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.mx.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const Z=this._executeOnNextFrame.slice(0);if(Z.length)for(const x of Z){this.notifyCustomEvent(x.id,x.data,!1);const Z=this._executeOnNextFrame.findIndex((Z=>Z.uniqueId===x.uniqueId));-1!==Z&&this._executeOnNextFrame.splice(Z,1)}}));(C.SceneCoordinators.get(this.config.mx)??[]).push(this)}createGraph(){const Z=new m({mx:this.config.mx,coordinator:this});return this._flowGraphs.push(Z),Z}removeGraph(Z){const x=this._flowGraphs.indexOf(Z);-1!==x&&(Z.dispose(),this._flowGraphs.splice(x,1))}start(){for(const Z of this._flowGraphs)Z.start()}dispose(){var Z,x;for(const G of this._flowGraphs)G.dispose();this._flowGraphs.length=0,null===(Z=this._disposeObserver)||void 0===Z||Z.remove(),null===(x=this._onBeforeRenderObserver)||void 0===x||x.remove();const F=C.SceneCoordinators.get(this.config.mx)??[],u=F.indexOf(this);-1!==u&&F.splice(u,1)}serialize(Z,x){Z._flowGraphs=[];for(const F of this._flowGraphs){const u={};F.serialize(u,x),Z._flowGraphs.push(u)}Z.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(Z){let x=this._customEventsMap.get(Z);return x||(x=new G.b,this._customEventsMap.set(Z,x)),x}notifyCustomEvent(Z,x){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:Z,data:x,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(Z)){const x=this._eventExecutionCounter.get(Z);if(this._eventExecutionCounter.set(Z,x+1),x>=C.MaxEventTypeExecutionPerFrame)return void(x===C.MaxEventTypeExecutionPerFrame&&o.d.Warn(`FlowGraphCoordinator: Too many executions of event "${Z}".`))}else this._eventExecutionCounter.set(Z,1);const F=this._customEventsMap.get(Z);F&&F.notifyObservers(x)}}C.MaxEventsPerType=30,C.MaxEventTypeExecutionPerFrame=30,C.SceneCoordinators=new Map},12996:(Z,x,F)=>{"use strict";F.d(x,{e:()=>G});var u=F(13005);class G extends u.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(Z){Z._notifyExecuteNode(this),this.done._activateSignal(Z)}}},12968:(Z,x,F)=>{"use strict";F.d(x,{e:()=>j});var u=F(12977),G=F(12982),f=F(11136);class Y extends G.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(Z){super.connectTo(Z),this._connectedPoint.sort(((Z,x)=>x.priority-Z.priority))}_activateSignal(Z){var x;if(null===(x=Z.logger)||void 0===x||x.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)Z._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(Z,this),Z._increaseExecutionId();else for(const F of this._connectedPoint)F._activateSignal(Z)}}(0,f.g)("FlowGraphSignalConnection",Y);class j extends u.e{constructor(Z){super(Z),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(Z){const x=new Y(Z,0,this);return this.signalInputs.push(x),x}_registerSignalOutput(Z){const x=new Y(Z,1,this);return this.signalOutputs.push(x),x}_unregisterSignalInput(Z){const x=this.signalInputs.findIndex((x=>x.name===Z));-1!==x&&(this.signalInputs[x].dispose(),this.signalInputs.splice(x,1))}_unregisterSignalOutput(Z){const x=this.signalOutputs.findIndex((x=>x.name===Z));-1!==x&&(this.signalOutputs[x].dispose(),this.signalOutputs.splice(x,1))}_reportError(Z,x){this.error.payload="string"===typeof x?new Error(x):x,this.error._activateSignal(Z)}getSignalInput(Z){return this.signalInputs.find((x=>x.name===Z))}getSignalOutput(Z){return this.signalOutputs.find((x=>x.name===Z))}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(Z),Z.signalInputs=[],Z.signalOutputs=[];for(const x of this.signalInputs){const F={};x.serialize(F),Z.signalInputs.push(F)}for(const x of this.signalOutputs){const F={};x.serialize(F),Z.signalOutputs.push(F)}}deserialize(Z){for(let x=0;x<Z.signalInputs.length;x++){const F=this.getSignalInput(Z.signalInputs[x].name);if(!F)throw new Error("Could not find signal input with name "+Z.signalInputs[x].name+" in block "+Z.className);F.deserialize(Z.signalInputs[x])}for(let x=0;x<Z.signalOutputs.length;x++){const F=this.getSignalOutput(Z.signalOutputs[x].name);if(!F)throw new Error("Could not find signal output with name "+Z.signalOutputs[x].name+" in block "+Z.className);F.deserialize(Z.signalOutputs[x])}}getClassName(){return"FlowGraphExecutionBlock"}}},13007:(Z,x,F)=>{"use strict";F.d(x,{e:()=>G});var u=F(12968);class G extends u.e{constructor(Z){super(Z),this.out=this._registerSignalOutput("out")}}},12954:(Z,x,F)=>{"use strict";F.d(x,{C:()=>J,D:()=>p,H:()=>U,K:()=>q,N:()=>R,Q:()=>y,T:()=>K,d:()=>t,f:()=>s,g:()=>S,k:()=>k,o:()=>M,r:()=>m,u:()=>c,v:()=>H,y:()=>o});var u,G=F(11179),f=F(11230),Y=F(12949),j=F(12957);!function(Z){Z.Any="any",Z.String="string",Z.Number="number",Z.Boolean="boolean",Z.Object="object",Z.Integer="FlowGraphInteger",Z.Vector2="Vector2",Z.kx="kx",Z.Vector4="Vector4",Z.Quaternion="Quaternion",Z.Matrix="Matrix",Z.Matrix2D="Matrix2D",Z.Matrix3D="Matrix3D",Z.Lx="Lx",Z.kj="kj"}(u||(u={}));class d{constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=Z,this.defaultValue=x,this.animationType=F}serialize(Z){Z.typeName=this.typeName,Z.defaultValue=this.defaultValue}}const t=new d("any",void 0),o=new d("string",""),c=new d("number",0,0),s=new d("boolean",!1),J=new d("Vector2",G.Vector2.Zero(),5),p=new d("kx",G.kx.Zero(),1),U=new d("Vector4",G.Vector4.Zero()),k=new d("Matrix",G.Matrix.Identity(),3),M=new d("Matrix2D",new j.c),m=new d("Matrix3D",new j.e),C=new d("Lx",f.Lx.Black(),4),L=new d("kj",new f.kj(0,0,0,0),7),H=new d("Quaternion",G.Quaternion.Identity(),2);H.typeTransformer=Z=>{if(Z.getClassName){if("Vector4"===Z.getClassName())return G.Quaternion.Hx(Z.Wf());if("kx"===Z.getClassName())return G.Quaternion.FromEulerVector(Z);if("Matrix"===Z.getClassName())return G.Quaternion.FromRotationMatrix(Z)}return Z};const S=new d("FlowGraphInteger",new Y.d(0),0);function K(Z){const x=Z;switch(typeof Z){case"string":return o;case"number":return c;case"boolean":return s;case"object":if(x.getClassName)switch(x.getClassName()){case"Vector2":return J;case"kx":return p;case"Vector4":return U;case"Matrix":return k;case"Lx":return C;case"kj":return L;case"Quaternion":return H;case"FlowGraphInteger":return S;case"Matrix2D":return M;case"Matrix3D":return m}return t;default:return t}}function y(Z){switch(Z){case"string":return o;case"number":return c;case"boolean":return s;case"Vector2":return J;case"kx":return p;case"Vector4":return U;case"Matrix":return k;case"Lx":return C;case"kj":return L;case"Quaternion":return H;case"FlowGraphInteger":return S;case"Matrix2D":return M;case"Matrix3D":return m;default:return t}}function q(Z){switch(Z){case"number":default:return 0;case"Vector2":return 5;case"kx":return 1;case"Matrix":return 3;case"Lx":return 4;case"kj":return 7;case"Quaternion":return 2}}function R(Z){switch(Z){case 0:return c;case 5:return J;case 1:return p;case 3:return k;case 4:return C;case 7:return L;case 2:return H;default:return t}}},12941:(Z,x,F)=>{"use strict";F.d(x,{c:()=>o,e:()=>t,h:()=>c});var u=F(11230),G=F(11179),f=F(12949),Y=F(12954),j=F(12957);function d(Z){return"Vector2"===Z||"kx"===Z||"Vector4"===Z||"Quaternion"===Z||"Lx"===Z||"kj"===Z}function t(Z,x,F){var u;const G=(null===x||void 0===x||null===(u=x.getClassName)||void 0===u?void 0:u.call(x))??"";if(d(G)||function(Z){return"Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z}(G))F[Z]={value:x.Wf(),className:G};else if("FlowGraphInteger"===G)F[Z]={value:x.value,className:G};else if(G&&(x.id||x.name))F[Z]={id:x.id,name:x.name,className:G};else{if("object"===typeof x)throw new Error(`Could not serialize value ${x}`);F[Z]=x}}function o(Z,x,F,t){const c=x[Z];let s;const J=(null===c||void 0===c?void 0:c.type)??(null===c||void 0===c?void 0:c.className);if(function(Z){return"Mesh"===Z||"AbstractMesh"===Z||"GroundMesh"===Z||"InstanceMesh"===Z||"LinesMesh"===Z||"GoldbergMesh"===Z||"GreasedLineMesh"===Z||"TrailMesh"===Z}(J)){let Z=t.meshes.filter((Z=>c.id?Z.id===c.id:Z.name===c.name));0===Z.length&&(Z=t.transformNodes.filter((Z=>c.id?Z.id===c.id:Z.name===c.name))),s=c.uniqueId?Z.find((Z=>Z.uniqueId===c.uniqueId)):Z[0]}else if(d(J))s=function(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===Z)return G.Vector2.Hx(x);if("kx"===Z)return F&&(x[2]*=-1),G.kx.Hx(x);if("Vector4"===Z)return G.Vector4.Hx(x);if("Quaternion"===Z)return F&&(x[2]*=-1,x[3]*=-1),G.Quaternion.Hx(x);if("Lx"===Z)return new u.Lx(x[0],x[1],x[2]);if("kj"===Z)return new u.kj(x[0],x[1],x[2],x[3]);throw new Error(`Unknown vector class name ${Z}`)}(J,c.value);else if(function(Z){return"AnimationGroup"===Z}(J)){const Z=t.animationGroups.filter((Z=>Z.name===c.name));s=1===Z.length?Z[0]:Z.find((Z=>Z.uniqueId===c.uniqueId))}else s="Matrix"===J?G.Matrix.Hx(c.value):"Matrix2D"===J?new j.c(c.value):"Matrix3D"===J?new j.e(c.value):"FlowGraphInteger"===J?f.d.FromValue(c.value):"number"===J||"string"===J||"boolean"===J?c.value[0]:c&&void 0!==c.value?c.value:Array.isArray(c)?c.reduce(((Z,x)=>x.eventData?(Z[x.id]={type:(0,Y.Q)(x.type)},"undefined"!==typeof x.value&&(Z[x.id].value=o("value",x,F,t)),Z):Z),{}):c;return s}function c(Z){return"FlowGraphJsonPointerParserBlock"===Z}},12990:(Z,x,F)=>{"use strict";function u(Z,x){return!(!Z.parent||Z.parent!==x&&!u(Z.parent,x))}function G(Z){if(Z.getClassName)return Z.getClassName()}function f(Z,x){return Z===x&&("Vector2"===Z||"kx"===Z||"Vector4"===Z||"Quaternion"===Z)}function Y(Z,x){return Z===x&&("Matrix"===Z||"Matrix2D"===Z||"Matrix3D"===Z)}function j(Z,x){return"FlowGraphInteger"===Z&&"FlowGraphInteger"===x}function d(Z,x){const F="number"===typeof Z||"number"===typeof(null===Z||void 0===Z?void 0:Z.value);return F&&!x?!isNaN(t(Z)):F}function t(Z){return"number"===typeof Z?Z:Z.value}F.d(x,{e:()=>j,h:()=>Y,k:()=>f,o:()=>G,q:()=>u,u:()=>t,w:()=>d})},12325:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{SceneInstrumentation:()=>f});var u=F(10994),G=F(11427);class f{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(Z){Z!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=Z,Z?(this._onBeforeActiveMeshesEvaluationObserver=this.mx.onBeforeActiveMeshesEvaluationObservable.add((()=>{u.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.mx.onAfterActiveMeshesEvaluationObservable.add((()=>{u.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.mx.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mx.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(Z){Z!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=Z,Z?(this._onBeforeRenderTargetsRenderObserver=this.mx.onBeforeRenderTargetsRenderObservable.add((()=>{u.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.mx.onAfterRenderTargetsRenderObservable.add((()=>{u.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.mx.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mx.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(Z){Z!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=Z,Z?(this._onBeforeParticlesRenderingObserver=this.mx.onBeforeParticlesRenderingObservable.add((()=>{u.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.mx.onAfterParticlesRenderingObservable.add((()=>{u.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.mx.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mx.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(Z){Z!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=Z,this.mx.spriteManagers&&(Z?(this._onBeforeSpritesRenderingObserver=this.mx.onBeforeSpritesRenderingObservable.add((()=>{u.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.mx.onAfterSpritesRenderingObservable.add((()=>{u.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.mx.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.mx.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(Z){Z!==this._capturePhysicsTime&&this.mx.onBeforePhysicsObservable&&(this._capturePhysicsTime=Z,Z?(this._onBeforePhysicsObserver=this.mx.onBeforePhysicsObservable.add((()=>{u.Tools.StartPerformanceCounter("td"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.mx.onAfterPhysicsObservable.add((()=>{u.Tools.EndPerformanceCounter("td"),this._physicsTime.endMonitoring()}))):(this.mx.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.mx.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(Z){Z!==this._captureAnimationsTime&&(this._captureAnimationsTime=Z,Z?this._onAfterAnimationsObserver=this.mx.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.mx.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(Z){this._captureFrameTime=Z}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(Z){this._captureInterFrameTime=Z}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(Z){Z!==this._captureRenderTime&&(this._captureRenderTime=Z,Z?(this._onBeforeDrawPhaseObserver=this.mx.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),u.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.mx.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),u.Tools.EndPerformanceCounter("Main render")}))):(this.mx.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mx.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(Z){Z!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=Z,Z?(this._onBeforeCameraRenderObserver=this.mx.onBeforeCameraRenderObservable.add((Z=>{this._cameraRenderTime.beginMonitoring(),u.Tools.StartPerformanceCounter(`Rendering camera ${Z.name}`)})),this._onAfterCameraRenderObserver=this.mx.onAfterCameraRenderObservable.add((Z=>{this._cameraRenderTime.endMonitoring(!1),u.Tools.EndPerformanceCounter(`Rendering camera ${Z.name}`)}))):(this.mx.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mx.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.mx.getEngine()._drawCalls}constructor(Z){this.mx=Z,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new G.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new G.d,this._captureFrameTime=!1,this._frameTime=new G.d,this._captureRenderTime=!1,this._renderTime=new G.d,this._captureInterFrameTime=!1,this._interFrameTime=new G.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new G.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new G.d,this._capturePhysicsTime=!1,this._physicsTime=new G.d,this._captureAnimationsTime=!1,this._animationsTime=new G.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new G.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=Z.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(u.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.mx.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=Z.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(u.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.pf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.pf(),this._captureParticlesRenderTime&&this._particlesRenderTime.pf(),this._captureSpritesRenderTime&&this._spritesRenderTime.pf(),this._captureRenderTime&&this._renderTime.pf(),this._captureCameraRenderTime&&this._cameraRenderTime.pf()}))}dispose(){this._disposed||(this.mx.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.mx.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.mx.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.mx.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.mx.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.mx.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.mx.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.mx.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.mx.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.mx.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.mx.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.mx.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.mx.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.mx.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.mx.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.mx.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.mx.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.mx=null,this._disposed=!0)}}},12928:(Z,x,F)=>{"use strict";F.d(x,{e:()=>o});var u=F(11159),G=F(11165),f=F(11179),Y=F(11634),j=F(11764),d=F(11820),t=F(11136);Y.e.AddNodeConstructor("Light_Type_1",((Z,x)=>()=>new o(Z,f.kx.Zero(),x)));class o extends d.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(Z){this._shadowFrustumSize=Z,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(Z){this._shadowOrthoScale=Z,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(Z){this._orthoLeft=Z}get orthoRight(){return this._orthoRight}set orthoRight(Z){this._orthoRight=Z}get orthoTop(){return this._orthoTop}set orthoTop(Z){this._orthoTop=Z}get orthoBottom(){return this._orthoBottom}set orthoBottom(Z){this._orthoBottom=Z}constructor(Z,x,F){super(Z,F),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=x.scale(-1),this.direction=x}getClassName(){return"od"}getTypeID(){return j.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(Z,x,F){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(Z):this._setDefaultAutoExtendShadowProjectionMatrix(Z,x,F)}_setDefaultFixedFrustumShadowProjectionMatrix(Z){const x=this.KZ().activeCamera;x&&f.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:x.hf,void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,Z,this.KZ().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(Z,x,F){const u=this.KZ().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const Z=f.kx.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let u=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(let Y=0;Y<F.length;Y++){const j=F[Y];if(!j)continue;const d=j.getBoundingInfo().boundingBox;for(let F=0;F<d.vectorsWorld.length;F++)f.kx.TransformCoordinatesToRef(d.vectorsWorld[F],x,Z),Z.x<this._orthoLeft&&(this._orthoLeft=Z.x),Z.y<this._orthoBottom&&(this._orthoBottom=Z.y),Z.x>this._orthoRight&&(this._orthoRight=Z.x),Z.y>this._orthoTop&&(this._orthoTop=Z.y),this.autoCalcShadowZBounds&&(Z.z<u&&(u=Z.z),Z.z>G&&(G=Z.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=u,this._shadowMaxZ=G)}const G=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===u||void 0===u?void 0:u.hf)||0,d=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===u||void 0===u?void 0:u.maxZ)||1e4,t=this.KZ().getEngine().useReverseDepthBuffer;f.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-G*this.shadowOrthoScale,this._orthoRight+G*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,t?d:j,t?j:d,Z,this.KZ().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,x){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,x),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,x),this)}transferToNodeMaterialEffect(Z,x){return this.computeTransformedInformation()?(Z.setFloat3(x,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(Z.setFloat3(x,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(Z){const x=this._scene.getEngine();return!x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:1}getDepthMaxZ(Z){const x=this._scene.getEngine();return x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:1}prepareLightSpecificDefines(Z,x){Z["DIRLIGHT"+x]=!0}}(0,u.d)([(0,G.H)()],o.prototype,"shadowFrustumSize",null),(0,u.d)([(0,G.H)()],o.prototype,"shadowOrthoScale",null),(0,u.d)([(0,G.H)()],o.prototype,"autoUpdateExtends",void 0),(0,u.d)([(0,G.H)()],o.prototype,"autoCalcShadowZBounds",void 0),(0,u.d)([(0,G.H)("orthoLeft")],o.prototype,"_orthoLeft",void 0),(0,u.d)([(0,G.H)("orthoRight")],o.prototype,"_orthoRight",void 0),(0,u.d)([(0,G.H)("orthoTop")],o.prototype,"_orthoTop",void 0),(0,u.d)([(0,G.H)("orthoBottom")],o.prototype,"_orthoBottom",void 0),(0,t.g)("BABYLON.DirectionalLight",o)},13416:(Z,x,F)=>{"use strict";F.d(x,{c:()=>o});var u=F(11159),G=F(11165),f=F(11179),Y=F(11230),j=F(11634),d=F(11764),t=F(11136);j.e.AddNodeConstructor("Light_Type_3",((Z,x)=>()=>new o(Z,f.kx.Zero(),x)));class o extends d.e{constructor(Z,x,F){super(Z,F),this.groundColor=new Y.Lx(0,0,0),this.direction=x||f.kx.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"sd"}setDirectionToTarget(Z){return this.direction=f.kx.Normalize(Z.Mx(f.kx.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(Z,x){const F=f.kx.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",F.x,F.y,F.z,0,x),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Cj),x),this}transferToNodeMaterialEffect(Z,x){const F=f.kx.Normalize(this.direction);return Z.setFloat3(x,F.x,F.y,F.z),this}Qf(){return this._worldMatrix||(this._worldMatrix=f.Matrix.Identity()),this._worldMatrix}getTypeID(){return d.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(Z,x){Z["HEMILIGHT"+x]=!0}}(0,u.d)([(0,G.g)()],o.prototype,"groundColor",void 0),(0,u.d)([(0,G.D)()],o.prototype,"direction",void 0),(0,t.g)("BABYLON.HemisphericLight",o)},12895:(Z,x,F)=>{"use strict";F.d(x,{b:()=>c});var u=F(11159),G=F(11165),f=F(11179),Y=F(11634),j=F(11764),d=F(11820),t=F(11157),o=F(11136);Y.e.AddNodeConstructor("Light_Type_2",((Z,x)=>()=>new c(Z,f.kx.Zero(),f.kx.Zero(),0,0,x)));class c extends d.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(Z){this._iesProfileTexture!==Z&&(this._iesProfileTexture=Z,this._iesProfileTexture&&c._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(Z){this._angle=Z,this._cosHalfAngle=Math.cos(.5*Z),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(Z){this._innerAngle=Z,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(Z){this._shadowAngleScale=Z,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(Z){this._projectionTextureLightNear=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(Z){this._projectionTextureLightFar=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(Z){this._projectionTextureUpDirection=Z,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(Z){this._projectionTexture!==Z&&(this._projectionTexture=Z,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(c._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):c._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(Z){return void 0!==Z.onGeneratedObservable}static _IsTexture(Z){return void 0!==Z.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(Z){this._projectionTextureProjectionLightMatrix=Z,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(Z,x,F,u,G,Y){super(Z,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=f.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=f.kx.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=f.kx.Zero(),this._projectionTextureViewLightMatrix=f.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=f.Matrix.Zero(),this._projectionTextureScalingMatrix=f.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=x,this.direction=F,this.angle=u,this.exponent=G}getClassName(){return"SpotLight"}getTypeID(){return j.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(Z){super._setDirection(Z),this._projectionTextureViewLightDirty=!0}_setPosition(Z){super._setPosition(Z),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(Z,x,F){const u=this.KZ().activeCamera;if(!u)return;this._shadowAngleScale=this._shadowAngleScale||1;const G=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:u.hf,j=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,d=this.KZ().getEngine().useReverseDepthBuffer;f.Matrix.PerspectiveFovLHToRef(G,1,d?j:Y,d?Y:j,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,d)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),f.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const Z=this.projectionTextureLightFar,x=this.projectionTextureLightNear,F=Z/(Z-x),u=-F*x,G=1/Math.tan(this._angle/2);f.Matrix.FromValuesToRef(G/1,0,0,0,0,G,0,0,0,0,F,1,0,0,u,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof t.c){const Z=this._projectionTexture.uScale/2,x=this._projectionTexture.vScale/2;f.Matrix.FromValuesToRef(Z,0,0,0,0,x,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(Z,x){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),Z.setMatrix("textureProjectionMatrix"+x,this._projectionTextureMatrix),Z.setTexture("projectionLightTexture"+x,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&Z.setTexture("iesLightTexture"+x,this._iesProfileTexture),this}transferToEffect(Z,x){let F;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,x),F=f.kx.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,x),F=f.kx.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",F.x,F.y,F.z,this._cosHalfAngle,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,x),this}transferToNodeMaterialEffect(Z,x){let F;return F=this.computeTransformedInformation()?f.kx.Normalize(this.transformedDirection):f.kx.Normalize(this.direction),this.KZ().useRightHandedSystem?Z.setFloat3(x,-F.x,-F.y,-F.z):Z.setFloat3(x,F.x,F.y,F.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(Z){const x=this._scene.getEngine(),F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.hf)??0;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?F:this._scene.getEngine().isNDCHalfZRange?0:F}getDepthMaxZ(Z){const x=this._scene.getEngine(),F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)??1e4;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:F}prepareLightSpecificDefines(Z,x){Z["SPOTLIGHT"+x]=!0,Z["PROJECTEDLIGHTTEXTURE"+x]=!(!this.projectionTexture||!this.projectionTexture.isReady()),Z["IESLIGHTTEXTURE"+x]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,u.d)([(0,G.H)()],c.prototype,"angle",null),(0,u.d)([(0,G.H)()],c.prototype,"innerAngle",null),(0,u.d)([(0,G.H)()],c.prototype,"shadowAngleScale",null),(0,u.d)([(0,G.H)()],c.prototype,"exponent",void 0),(0,u.d)([(0,G.H)()],c.prototype,"projectionTextureLightNear",null),(0,u.d)([(0,G.H)()],c.prototype,"projectionTextureLightFar",null),(0,u.d)([(0,G.H)()],c.prototype,"projectionTextureUpDirection",null),(0,u.d)([(0,G.z)("projectedLightTexture")],c.prototype,"_projectionTexture",void 0),(0,o.g)("BABYLON.SpotLight",c)},12625:(Z,x,F)=>{"use strict";F.d(x,{b:()=>Y,e:()=>f,h:()=>j});const u={},G={};function f(Z,x){u[Z]=x}function Y(Z,x){G[Z]=x}function j(Z){return G[Z]?G[Z]:null}},12509:(Z,x,F)=>{"use strict";F.d(x,{d:()=>K,g:()=>w});var u,G=F(10994),f=F(11e3),Y=F(11447),j=F(11037),d=F(11012),t=F(11684),o=F(11041),c=F(11050),s=F(11144),J=F(11081),p=F(11031);!function(Z){Z[Z.Clean=0]="Clean",Z[Z.Stop=1]="Stop",Z[Z.Sync=2]="Sync",Z[Z.NoSync=3]="NoSync"}(u||(u={}));const U=new f.b,k={};let M=!1;function m(){return k[".babylon"]}function C(Z,x){const F=k[Z];return F||(d.d.Warn("Unable to find a plugin to load "+Z+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),x?m():void 0)}function L(Z,x,F){let u="Unable to load from "+(Z.rawData?"binary data":Z.url);return x?u+=`: ${x}`:F&&(u+=`: ${F}`),u}async function H(Z,x,F,u,G,f,Y,j,d){var t;const c="data:"===(s=Z.url).substring(0,5)?s.substring(5):null;var s;if(Z.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const M=c||Y?"":function(Z){const x=Z.indexOf("?");-1!==x&&(Z=Z.substring(0,x));const F=Z.lastIndexOf(".");return Z.substring(F,Z.length).toLowerCase()}(Z.url);let L=Y?C(Y,!0):c?function(Z){for(const x in k){const F=k[x].plugin;if(F.canDirectLoad&&F.canDirectLoad(Z))return k[x]}return m()}(Z.url):C(M,!1);if(!L&&M){if(Z.url&&!Z.url.startsWith("blob:")){const x=await async function(Z,x){const F=x.method||"GET";return await new Promise(((u,G)=>{const f=new p.b;f.addEventListener("readystatechange",(()=>{if(4==f.readyState)if(200==f.status){const Z={};if(x.responseHeaders)for(const F of x.responseHeaders)Z[F]=f.getResponseHeader(F)||"";u({response:f.response,headerValues:Z})}else G(`Unable to fetch data from ${Z}. Error code: ${f.status}`)})),f.open(F,Z),f.send()}))}(Z.url,{method:"HEAD",responseHeaders:["Content-Type"]}),F=x.headerValues?x.headerValues["Content-Type"]:"";F&&(L=function(Z){for(const x in k){const F=k[x];if(F.mimeType===Z)return F}}(F))}L||(L=m())}if(!L)throw new Error(`No plugin or fallback for ${Y??Z.url}`);if(!1===(null===d||void 0===d||null===(t=d[L.plugin.name])||void 0===t?void 0:t.enabled))throw new Error(`The '${L.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(Z.rawData&&!L.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(Z=>{if(L.plugin.createPlugin){const x=L.plugin.createPlugin(d??{});return x instanceof Promise?(x.then(Z).catch((Z=>{G("Error instantiating plugin.",Z)})),null):(Z(x),x)}return Z(L.plugin),L.plugin})((d=>{var t;if(!d)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(U.notifyObservers(d),c&&(d.canDirectLoad&&d.canDirectLoad(Z.url)||!(0,o.k)(Z.url))){if(d.directLoad){const Z=d.directLoad(x,c);Z instanceof Promise?Z.then((Z=>{F(d,Z)})).catch((Z=>{G("Error in directLoad of _loadData: "+Z,Z)})):F(d,Z)}else F(d,c);return}const s=L.isBinary,p=(Z,u)=>{x.J?G("Scene has been disposed"):F(d,Z,u)};let k=null,M=!1;null===(t=d.Uf)||void 0===t||t.add((()=>{M=!0,k&&(k.abort(),k=null),f()}));const m=()=>{if(M)return;const F=(Z,x)=>{G(null===Z||void 0===Z?void 0:Z.statusText,x)};if(!d.loadFile&&Z.rawData)throw"Plugin does not support loading ArrayBufferView.";k=d.loadFile?d.loadFile(x,Z.rawData||Z.file||Z.url,Z.rootUrl,p,u,s,F,j):x._loadFile(Z.file||Z.url,p,u,!0,s,F)},C=x.getEngine();let H=C.enableOfflineSupport;if(H){let F=!1;for(const u of x.disableOfflineSupportExceptionRules)if(u.test(Z.url)){F=!0;break}H=!F}H&&J.d.OfflineProviderFactory?x.offlineProvider=J.d.OfflineProviderFactory(Z.url,m,C.disableManifestCheck):m()}))}function S(Z,x){let F,u,f=null,Y=null;if(x)if(x.name)F=`file:${x.name}`,u=x.name,f=x;else if(ArrayBuffer.isView(x))F="",u=(0,s.c)(),Y=x;else if(x.startsWith("data:"))F=x,u="";else if(Z){const f=x;if("/"===f.substring(0,1))return G.Tools.Error("Wrong sceneFilename parameter"),null;F=Z+f,u=f}else F=x,u=G.Tools.GetFilename(x),Z=G.Tools.GetFolderPath(x);else F=Z,u=G.Tools.GetFilename(Z),Z=G.Tools.GetFolderPath(Z);return{url:F,rootUrl:Z,name:u,file:f,rawData:Y}}function K(Z){if("string"===typeof Z.extensions){const x=Z.extensions;k[x.toLowerCase()]={plugin:Z,isBinary:!1}}else{const x=Z.extensions,F=Object.keys(x);for(const u of F)k[u.toLowerCase()]={plugin:Z,isBinary:x[u].isBinary,mimeType:x[u].mimeType}}}async function y(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.c.LastCreatedScene,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!u)return d.d.Error("No scene available to import mesh to"),null;const J=S(x,F);if(!J)return null;const p={};u.addPendingData(p);const U=()=>{u.removePendingData(p)},k=(Z,x)=>{const F=L(J,Z,x);Y?Y(u,F,new c.i(F,c.g.SceneLoaderError,x)):d.d.Error(F),U()},M=f?Z=>{try{f(Z)}catch(x){k("Error in onProgress callback: "+x,x)}}:void 0,m=(Z,x,F,f,Y,j,d,t)=>{if(u.importedMeshesFiles.push(J.url),G)try{G(Z,x,F,f,Y,j,d,t)}catch(o){k("Error in onSuccess callback: "+o,o)}u.removePendingData(p)};return await H(J,u,((x,F,G)=>{if(x.rewriteRootURL&&(J.rootUrl=x.rewriteRootURL(J.rootUrl,G)),x.importMesh){const G=[],f=[],Y=[];if(!x.importMesh(Z,u,F,J.rootUrl,G,f,Y,k))return;u.loadingPluginName=x.name,m(G,f,Y,[],[],[],[],[])}else{x.importMeshAsync(Z,u,F,J.rootUrl,M,J.name).then((Z=>{u.loadingPluginName=x.name,m(Z.meshes,Z.Vs,Z.skeletons,Z.animationGroups,Z.transformNodes,Z.geometries,Z.lights,Z.spriteManagers)})).catch((Z=>{k(Z.message,Z)}))}}),M,k,U,t,o,s)}async function q(Z,x,F,u,G,f,Y,j){return await new Promise(((d,t)=>{try{y(Z,x,F,u,((Z,x,F,u,G,f,Y,j)=>{d({meshes:Z,Vs:x,skeletons:F,animationGroups:u,transformNodes:G,geometries:f,lights:Y,spriteManagers:j})}),G,((Z,x,F)=>{t(F||new Error(x))}),f,Y,j).catch(t)}catch(c){t(c)}}))}async function R(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.c.LastCreatedEngine,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};F?await v(Z,x,new Y.d(F),u,f,d,t,o,c):G.Tools.Error("No engine available")}async function B(Z,x,F,u,G,f,Y){return await new Promise(((j,d)=>{R(Z,x,F,(Z=>{j(Z)}),u,((Z,x,F)=>{d(F||new Error(x))}),G,f,Y)}))}async function v(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.c.LastCreatedScene,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return d.d.Error("No scene available to append to"),null;const J=S(Z,x);if(!J)return null;const p={};F.addPendingData(p);const U=()=>{F.removePendingData(p)};t.e.ShowLoadingScreen&&!M&&(M=!0,F.getEngine().displayLoadingUI(),F.executeWhenReady((()=>{F.getEngine().hideLoadingUI(),M=!1})));const k=(Z,x)=>{const u=L(J,Z,x);f?f(F,u,new c.i(u,c.g.SceneLoaderError,x)):d.d.Error(u),U()},m=G?Z=>{try{G(Z)}catch(x){k("Error in onProgress callback",x)}}:void 0,C=()=>{if(u)try{u(F)}catch(Z){k("Error in onSuccess callback",Z)}F.removePendingData(p)};return await H(J,F,((Z,x)=>{if(Z.load){if(!Z.load(F,x,J.rootUrl,k))return;F.loadingPluginName=Z.name,C()}else{Z.loadAsync(F,x,J.rootUrl,m,J.name).then((()=>{F.loadingPluginName=Z.name,C()})).catch((Z=>{k(Z.message,Z)}))}}),m,k,U,Y,o,s)}async function l(Z,x,F,u,G,f,Y){return await new Promise(((j,d)=>{try{v(Z,x,F,(Z=>{j(Z)}),u,((Z,x,F)=>{d(F||new Error(x))}),G,f,Y).catch(d)}catch(c){d(c)}}))}async function i(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.c.LastCreatedScene,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return d.d.Error("No scene available to load asset container to"),null;const s=S(Z,x);if(!s)return null;const J={};F.addPendingData(J);const p=()=>{F.removePendingData(J)},U=(Z,x)=>{const u=L(s,Z,x);f?f(F,u,new c.i(u,c.g.SceneLoaderError,x)):d.d.Error(u),p()},k=G?Z=>{try{G(Z)}catch(x){U("Error in onProgress callback",x)}}:void 0,M=Z=>{if(u)try{u(Z)}catch(x){U("Error in onSuccess callback",x)}F.removePendingData(J)};return await H(s,F,((Z,x)=>{if(Z.loadAssetContainer){const u=Z.loadAssetContainer(F,x,s.rootUrl,U);if(!u)return;u.populateRootNodes(),F.loadingPluginName=Z.name,M(u)}else if(Z.loadAssetContainerAsync){Z.loadAssetContainerAsync(F,x,s.rootUrl,k,s.name).then((x=>{x.populateRootNodes(),F.loadingPluginName=Z.name,M(x)})).catch((Z=>{U(Z.message,Z)}))}else U("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),k,U,p,Y,t,o)}async function e(Z,x,F,u,G,f,Y){return await new Promise(((j,d)=>{try{i(Z,x,F,(Z=>{j(Z)}),u,((Z,x,F)=>{d(F||new Error(x))}),G,f,Y).catch(d)}catch(c){d(c)}}))}async function b(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.c.LastCreatedScene,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!F)return void d.d.Error("No scene available to load animations to");if(u){for(const u of F.animatables)u.reset();F.stopAllAnimations();const Z=F.animationGroups.slice();for(const F of Z)F.dispose();const x=F.getNodes();for(const F of x)F.animations&&(F.animations=[])}else switch(G){case 0:const Z=F.animationGroups.slice();for(const x of Z)x.dispose();break;case 1:for(const x of F.animationGroups)x.stop();break;case 2:for(const x of F.animationGroups)x.reset(),x.restart();break;case 3:break;default:return void d.d.Error("Unknown animation group loading mode value '"+G+"'")}const p=F.animatables.length;await i(Z,x,F,(Z=>{Z.mergeAnimationsTo(F,F.animatables.slice(p),f),Z.dispose(),F.onAnimationFileImportedObservable.notifyObservers(F),Y&&Y(F)}),t,o,c,s,J)}async function E(Z,x,F,u,G,f,Y,j,d,t){return await new Promise(((o,s)=>{try{b(Z,x,F,u,G,f,(Z=>{o(Z)}),Y,((Z,x,F)=>{s(F||new Error(x))}),j,d,t).catch(s)}catch(c){s(c)}}))}class w{static get ForceFullSceneLoadingForIncremental(){return t.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(Z){t.e.ForceFullSceneLoadingForIncremental=Z}static get ShowLoadingScreen(){return t.e.ShowLoadingScreen}static set ShowLoadingScreen(Z){t.e.ShowLoadingScreen=Z}static get loggingLevel(){return t.e.loggingLevel}static set loggingLevel(Z){t.e.loggingLevel=Z}static get CleanBoneMatrixWeights(){return t.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(Z){t.e.CleanBoneMatrixWeights=Z}static GetDefaultPlugin(){return m()}static GetPluginForExtension(Z){var x;return null===(x=C(Z,!0))||void 0===x?void 0:x.plugin}static IsPluginForExtensionAvailable(Z){return function(Z){return!!k[Z]}(Z)}static RegisterPlugin(Z){K(Z)}static ImportMesh(Z,x,F,u,G,f,Y,d,t){y(Z,x,F,u,G,f,Y,d,t).catch((Z=>null===Y||void 0===Y?void 0:Y(j.c.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportMeshAsync(Z,x,F,u,G,f,Y){return await q(Z,x,F,u,G,f,Y)}static Load(Z,x,F,u,G,f,Y,d){R(Z,x,F,u,G,f,Y,d).catch((Z=>null===f||void 0===f?void 0:f(j.c.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAsync(Z,x,F,u,G,f){return await B(Z,x,F,u,G,f)}static Append(Z,x,F,u,G,f,Y,d){v(Z,x,F,u,G,f,Y,d).catch((Z=>null===f||void 0===f?void 0:f(F??j.c.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async AppendAsync(Z,x,F,u,G,f){return await l(Z,x,F,u,G,f)}static LoadAssetContainer(Z,x,F,u,G,f,Y,d){i(Z,x,F,u,G,f,Y,d).catch((Z=>null===f||void 0===f?void 0:f(F??j.c.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async LoadAssetContainerAsync(Z,x,F,u,G,f){return await e(Z,x,F,u,G,f)}static ImportAnimations(Z,x,F,u,G,f,Y,d,t,o,c){b(Z,x,F,u,G,f,Y,d,t,o,c).catch((Z=>null===t||void 0===t?void 0:t(F??j.c.LastCreatedScene,null===Z||void 0===Z?void 0:Z.message,Z)))}static async ImportAnimationsAsync(Z,x,F,u,G,f,Y,j,d,t,o){return await E(Z,x,F,u,G,f,j,t,o)}}w.NO_LOGGING=0,w.MINIMAL_LOGGING=1,w.SUMMARY_LOGGING=2,w.DETAILED_LOGGING=3,w.OnPluginActivatedObservable=U},12907:(Z,x,F)=>{"use strict";F.d(x,{c:()=>s});var u=F(11159),G=F(11165),f=F(10994),Y=F(11179),j=F(11201),d=F(11157),t=F(11136),o=F(11e3),c=F(11213);F(12914);class s extends j.e{set boundingBoxSize(Z){if(this._boundingBoxSize&&this._boundingBoxSize.equals(Z))return;this._boundingBoxSize=Z;const x=this.KZ();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(Z){this._rotationY=Z,this.setReflectionTextureMatrix(Y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(Z,x,F){let u="";for(const G of Z)u+=G;return new s(u,x,null,F,Z)}static CreateFromPrefilteredData(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=x.useDelayedTextureLoading;x.useDelayedTextureLoading=!1;const f=new s(Z,x,null,!1,null,null,null,void 0,!0,F,u);return x.useDelayedTextureLoading=G,f}constructor(Z,x){var F;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,M=arguments.length>13?arguments[13]:void 0,m=arguments.length>14?arguments[14]:void 0;super(x),this.onLoadObservable=new o.b,this.boundingBoxPosition=Y.kx.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.Matrix,this._buffer=null,this.name=Z,this.url=Z,this._noMipmap=G,this.Af=!1,this.isCube=!0,this._textureMatrix=Y.Matrix.Identity(),this.coordinatesMode=d.c.CUBIC_MODE;let C=null,L=null;null===u||Array.isArray(u)?(this._noMipmap=G,this._format=c,this._createPolynomials=p,C=u,this._loaderOptions=M,this._useSRGBBuffer=m,this._lodScale=U,this._lodOffset=k):(C=u.extensions??null,this._noMipmap=u.noMipmap??!1,f=u.files??null,L=u.buffer??null,this._format=u.format??5,s=u.prefiltered??!1,J=u.forcedExtension??null,this._createPolynomials=u.createPolynomials??!1,this._lodScale=u.lodScale??.8,this._lodOffset=u.lodOffset??0,this._loaderOptions=u.loaderOptions,this._useSRGBBuffer=u.useSRGBBuffer,j=u.V??null,t=u.onError??null),(Z||f)&&this.updateURL(Z,J,j,s,t,C,null===(F=this.KZ())||void 0===F?void 0:F.useDelayedTextureLoading,f,L)}getClassName(){return"CubeTexture"}updateURL(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=Z),this.url=Z,x&&(this._forcedExtension=x);const t=Z.lastIndexOf("."),o=x||(t>-1?Z.substring(t).toLowerCase():""),c=0===o.indexOf(".dds"),s=0===o.indexOf(".env"),J=0===o.indexOf(".basis");if(s?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=u,u&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),j)this._files=j;else if(J||s||c||f||(f=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,f){for(let x=0;x<f.length;x++)this._files.push(Z+f[x]);this._extensions=f}this._buffer=d,Y?(this.delayLoadState=4,this._delayedOnLoad=F,this._delayedOnError=G):this._loadTexture(F,G)}delayLoad(Z){4===this.delayLoadState&&(Z&&(this._forcedExtension=Z),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(Z){var x,F;if(Z.updateFlag===this._textureMatrix.updateFlag)return;Z.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(F=this.KZ())||void 0===F||F.markAllMaterialsAsDirty(1,(Z=>-1!==Z.getActiveTextures().indexOf(this))));if(this._textureMatrix=Z,null===(x=this.KZ())||void 0===x||!x.useRightHandedSystem)return;const u=Y.TmpVectors.kx[0],G=Y.TmpVectors.Quaternion[0],f=Y.TmpVectors.kx[1];this._textureMatrix.decompose(u,G,f),G.z*=-1,G.w*=-1,Y.Matrix.ComposeToRef(u,G,f,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var Z;return null!==(Z=this.KZ())&&void 0!==Z&&Z.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this.KZ(),u=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const G=()=>{var x;(this.onLoadObservable.notifyObservers(this),u)&&(u.dispose(),null===(x=this.KZ())||void 0===x||x.markAllMaterialsAsDirty(1));Z&&Z()},Y=(Z,F)=>{this._loadingError=!0,this._errorObject={message:Z,exception:F},x&&x(Z,F),d.c.OnTextureLoadErrorObservable.notifyObservers(this)};var j;this._texture?this._texture.isReady?f.Tools.SetImmediate((()=>G())):this._texture.onLoadedObservable.add((()=>G())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,F,this._lodScale,this._lodOffset,Z,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,F,this._files,this._noMipmap,Z,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(j=this._texture)||void 0===j||j.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(Z,x,F){const u=c.c.Parse((()=>{let u=!1;return Z.prefiltered&&(u=Z.prefiltered),new s(F+(Z.url??Z.name),x,Z.extensions,!1,Z.files||null,null,null,void 0,u,Z.forcedExtension)}),Z,x);if(Z.boundingBoxPosition&&(u.boundingBoxPosition=Y.kx.Hx(Z.boundingBoxPosition)),Z.boundingBoxSize&&(u.boundingBoxSize=Y.kx.Hx(Z.boundingBoxSize)),Z.animations)for(let G=0;G<Z.animations.length;G++){const x=Z.animations[G],F=(0,t.e)("BABYLON.Animation");F&&u.animations.push(F.Parse(x))}return u}clone(){let Z=0;const x=c.c.Clone((()=>{const x=new s(this.url,this.KZ()||this._getEngine(),this._extensions,this._noMipmap,this._files);return Z=x.uniqueId,x}),this);return x.uniqueId=Z,x}}(0,u.d)([(0,G.H)()],s.prototype,"url",void 0),(0,u.d)([(0,G.D)()],s.prototype,"boundingBoxPosition",void 0),(0,u.d)([(0,G.D)()],s.prototype,"boundingBoxSize",null),(0,u.d)([(0,G.H)("rotationY")],s.prototype,"rotationY",null),(0,u.d)([(0,G.H)("files")],s.prototype,"_files",void 0),(0,u.d)([(0,G.H)("forcedExtension")],s.prototype,"_forcedExtension",void 0),(0,u.d)([(0,G.H)("extensions")],s.prototype,"_extensions",void 0),(0,u.d)([(0,G.q)("textureMatrix")],s.prototype,"_textureMatrix",void 0),(0,u.d)([(0,G.q)("textureMatrixRefraction")],s.prototype,"_textureMatrixRefraction",void 0),d.c._CubeTextureParser=s.Parse,(0,t.g)("BABYLON.CubeTexture",s)},13426:(Z,x,F)=>{"use strict";F.d(x,{d:()=>d});var u=F(11012),G=F(11157),f=F(11147),Y=F(11325),j=F(11117);Y.ThinEngine.prototype.createDynamicTexture=function(Z,x,F,u){const G=new j.e(this,4);return G.baseWidth=Z,G.baseHeight=x,F&&(Z=this.needPOTTextures?(0,f.g)(Z,this._caps.maxTextureSize):Z,x=this.needPOTTextures?(0,f.g)(x,this._caps.maxTextureSize):x),G.width=Z,G.height=x,G.isReady=!1,G.generateMipMaps=F,G.samplingMode=u,this.updateTextureSamplingMode(u,G),this._internalTexturesCache.push(G),G},Y.ThinEngine.prototype.updateDynamicTexture=function(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!Z)return;const Y=this._gl,j=Y.TEXTURE_2D,d=this._bindTextureDirectly(j,Z,!0,f);this._unpackFlipY(void 0===F?Z.invertY:F),u&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const t=this._getWebGLTextureType(Z.type),o=this._getInternalFormat(G||Z.format),c=this._getRGBABufferInternalSizedFormat(Z.type,o);Y.texImage2D(j,0,c,o,t,x),Z.generateMipMaps&&Y.generateMipmap(j),d||this._bindTextureDirectly(j,null),u&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),G&&(Z.format=G),Z._dynamicTextureSource=x,Z._premulAlpha=u,Z.invertY=F||!1,Z.isReady=!0};class d extends G.c{constructor(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,j=arguments.length>6?arguments[6]:void 0;const d=!F||F._isScene;super(null,d?F:null===F||void 0===F?void 0:F.mx,d?!u:F,j,f,void 0,void 0,void 0,void 0,Y),this.name=Z,this.wrapU=G.c.CLAMP_ADDRESSMODE,this.wrapV=G.c.CLAMP_ADDRESSMODE,this._generateMipMaps=u;const t=this._getEngine();if(!t)return;if(x.getContext)this._canvas=x,this._ownCanvas=!1,this._texture=t.createDynamicTexture(this._canvas.width,this._canvas.height,u,f);else{this._canvas=t.createCanvas(1,1),this._ownCanvas=!0;const Z=x;Z.width||0===Z.width?this._texture=t.createDynamicTexture(Z.width,Z.height,u,f):this._texture=t.createDynamicTexture(x,x,u,f)}const o=this.getSize();this._canvas.width!==o.width&&(this._canvas.width=o.width),this._canvas.height!==o.height&&(this._canvas.height=o.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(Z){this._canvas.width=Z.width,this._canvas.height=Z.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(Z.width,Z.height,this._generateMipMaps,this.samplingMode)}scale(Z){const x=this.getSize();x.width*=Z,x.height*=Z,this._recreate(x)}scaleTo(Z,x){const F=this.getSize();F.width=Z,F.height=x,this._recreate(F)}getContext(){return this._context}clear(Z){const x=this.getSize();Z&&(this._context.fillStyle=Z),this._context.clearRect(0,0,x.width,x.height)}update(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===Z||Z,x,this._format||void 0,void 0,F)}drawText(Z,x,F,u,G,f,Y){let j=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const d=this.getSize();if(f&&(this._context.fillStyle=f,this._context.fillRect(0,0,d.width,d.height)),this._context.font=u,null===x||void 0===x){const F=this._context.measureText(Z);x=(d.width-F.width)/2}if(null===F||void 0===F){const Z=parseInt(u.replace(/\D/g,""));F=d.height/2+Z/3.65}this._context.fillStyle=G||"",this._context.fillText(Z,x,F),j&&this.update(Y)}dispose(){var Z,x;(super.dispose(),this._ownCanvas)&&(null===(Z=this._canvas)||void 0===Z||null===(x=Z.remove)||void 0===x||x.call(Z));this._canvas=null,this._context=null}clone(){const Z=this.KZ();if(!Z)return this;const x=this.getSize(),F=new d(this.name,x,Z,this._generateMipMaps);return F.Af=this.Af,F.level=this.level,F.wrapU=this.wrapU,F.wrapV=this.wrapV,F}serialize(){const Z=this.KZ();Z&&!Z.isReady()&&u.d.Warn("The scene must be ready before serializing the dynamic texture");const x=super.serialize();return d._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x}static _IsCanvasElement(Z){return void 0!==Z.toDataURL}_rebuild(){this.update()}}},12815:(Z,x,F)=>{"use strict";F.d(x,{c:()=>G});var u=F(11157);class G extends u.c{get depth(){return this._depth}constructor(Z,x,F,G,f,Y){let j=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:u.c.TRILINEAR_SAMPLINGMODE,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10?arguments[10]:void 0;super(null,Y,!j,d),this.format=f,this._texture=Y.getEngine().createRawTexture2DArray(Z,x,F,G,f,j,d,t,null,o,c),this._depth=G,this.is2DArray=!0}update(Z){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,Z,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(Z,x,F,u,f){return new G(Z,x,F,u,5,f,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12643:(Z,x,F)=>{"use strict";F.d(x,{c:()=>j,e:()=>d,g:()=>f,j:()=>Y});var u=F(11194),G=F(11179);function f(Z,x){return`{X: ${Z.x.toFixed(x)} Y: ${Z.y.toFixed(x)}}`}function Y(Z,x){return`{X: ${Z._x.toFixed(x)} Y: ${Z._y.toFixed(x)} Z: ${Z._z.toFixed(x)}}`}function j(Z,x){return 2*Math.acos((0,u.Clamp)(G.Quaternion.Dot(Z,x)))}function d(Z,x){const F=new G.Quaternion;return function(Z,x,F){const f=G.kx.Cross(Z,x),Y=Math.acos((0,u.Clamp)(G.kx.Dot(Z,x),-1,1));G.Quaternion.RotationAxisToRef(f,Y,F)}(Z,x,F),F}},12465:(Z,x,F)=>{"use strict";F.d(x,{e:()=>t});var u=F(11179),G=F(11230),f=F(11671),Y=F(11647),j=F(11242);F(12467);function d(Z){let x=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const F=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],f=[];let d=[];const t=Z.width||Z.size||1,o=Z.height||Z.size||1,c=Z.depth||Z.size||1,s=Z.wrap||!1;let J=void 0===Z.topBaseAt?1:Z.topBaseAt,p=void 0===Z.bottomBaseAt?0:Z.bottomBaseAt;J=(J+4)%4,p=(p+4)%4;let U=[2,0,3,1][J],k=[2,0,1,3][p],M=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(s){x=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],M=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let Z=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],F=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const u=[17,18,19,16],G=[22,23,20,21];for(;U>0;)Z.unshift(Z.pop()),u.unshift(u.pop()),U--;for(;k>0;)F.unshift(F.pop()),G.unshift(G.pop()),k--;Z=Z.flat(),F=F.flat(),M=M.concat(Z).concat(F),x.push(u[0],u[2],u[3],u[0],u[1],u[2]),x.push(G[0],G[2],G[3],G[0],G[1],G[2])}const m=[t/2,o/2,c/2];d=M.reduce(((Z,x,F)=>Z.concat(x*m[F%3])),[]);const C=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,L=Z.faceUV||new Array(6),H=Z.faceColors,S=[];for(let Y=0;Y<6;Y++)void 0===L[Y]&&(L[Y]=new u.Vector4(0,0,1,1)),H&&void 0===H[Y]&&(H[Y]=new G.kj(1,1,1,1));for(let u=0;u<6;u++)if(f.push(L[u].z,j.e?1-L[u].w:L[u].w),f.push(L[u].x,j.e?1-L[u].w:L[u].w),f.push(L[u].x,j.e?1-L[u].y:L[u].y),f.push(L[u].z,j.e?1-L[u].y:L[u].y),H)for(let Z=0;Z<4;Z++)S.push(H[u].r,H[u].g,H[u].b,H[u].a);Y.c._ComputeSides(C,d,x,F,f,Z.frontUVs,Z.backUVs);const K=new Y.c;if(K.indices=x,K.qZ=d,K.RZ=F,K.vZ=f,H){const Z=C===Y.c.DOUBLESIDE?S.concat(S):S;K.BZ=Z}return K}function t(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new f.d(Z,F);x.sideOrientation=f.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return d(x).iZ(u,x.updatable),u}Y.c.CreateBox=d,f.d.CreateBox=function(Z,x){return t(Z,{size:x,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12629:(Z,x,F)=>{"use strict";F.d(x,{d:()=>j});var u=F(11671),G=F(11647),f=F(11242);function Y(Z){const x=[],F=[],u=[],Y=[],j=Z.radius||.5,d=Z.tessellation||64,t=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,o=0===Z.sideOrientation?0:Z.sideOrientation||G.c.DEFAULTSIDE;x.push(0,0,0),Y.push(.5,.5);const c=2*Math.PI*t,s=1===t?c/d:c/(d-1);let J=0;for(let G=0;G<d;G++){const Z=Math.cos(J),F=Math.sin(J),u=(Z+1)/2,G=(1-F)/2;x.push(j*Z,j*F,0),Y.push(u,f.e?1-G:G),J+=s}1===t&&(x.push(x[3],x[4],x[5]),Y.push(Y[2],f.e?1-Y[3]:Y[3]));const p=x.length/3;for(let G=1;G<p-1;G++)F.push(G+1,0,G);G.c.ComputeNormals(x,F,u),G.c._ComputeSides(o,x,F,u,Y,Z.frontUVs,Z.backUVs);const U=new G.c;return U.indices=F,U.qZ=x,U.RZ=u,U.vZ=Y,U}function j(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new u.d(Z,F);x.sideOrientation=u.d._GetDefaultSideOrientation(x.sideOrientation),G._originalBuilderSideOrientation=x.sideOrientation;return Y(x).iZ(G,x.updatable),G}G.c.CreateDisc=Y,u.d.CreateDisc=function(Z,x,F){return j(Z,{radius:x,tessellation:F,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12467:(Z,x,F)=>{"use strict";F.d(x,{i:()=>k,e:()=>m,m:()=>M});var u=F(11179),G=F(11230),f=F(11671),Y=F(11647),j=F(11265);f.d._GroundMeshParser=(Z,x)=>d.Parse(Z,x);class d extends f.d{constructor(Z,x){super(Z,x),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=Z,this._subdivisionsY=Z,this.subdivide(Z);const F=this;F.createOrUpdateSubmeshesOctree&&F.createOrUpdateSubmeshesOctree(x)}getHeightAtCoordinates(Z,x){const F=this.getWorldMatrix(),G=u.TmpVectors.Matrix[5];F.invertToRef(G);const f=u.TmpVectors.kx[8];if(u.kx.TransformCoordinatesFromFloatsToRef(Z,0,x,G,f),Z=f.x,x=f.z,Z<this._minX||Z>=this._maxX||x<=this._minZ||x>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(Z,x),j=-(Y.x*Z+Y.z*x+Y.w)/Y.y;return u.kx.TransformCoordinatesFromFloatsToRef(0,j,0,F,f),f.y}getNormalAtCoordinates(Z,x){const F=new u.kx(0,1,0);return this.getNormalAtCoordinatesToRef(Z,x,F),F}getNormalAtCoordinatesToRef(Z,x,F){const G=this.getWorldMatrix(),f=u.TmpVectors.Matrix[5];G.invertToRef(f);const Y=u.TmpVectors.kx[8];if(u.kx.TransformCoordinatesFromFloatsToRef(Z,0,x,f,Y),Z=Y.x,x=Y.z,Z<this._minX||Z>this._maxX||x<this._minZ||x>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const j=this._getFacetAt(Z,x);return u.kx.TransformNormalFromFloatsToRef(j.x,j.y,j.z,G,F),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(Z,x){const F=Math.floor((Z+this._maxX)*this._subdivisionsX/this._width),u=Math.floor(-(x+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),G=this._heightQuads[u*this._subdivisionsX+F];let f;return f=x<G.slope.x*Z+G.slope.y?G.facet1:G.facet2,f}_initHeightQuads(){const Z=this._subdivisionsX,x=this._subdivisionsY;this._heightQuads=[];for(let F=0;F<x;F++)for(let x=0;x<Z;x++){const G={slope:u.Vector2.Zero(),facet1:new u.Vector4(0,0,0,0),facet2:new u.Vector4(0,0,0,0)};this._heightQuads[F*Z+x]=G}return this}_computeHeightQuads(){const Z=this.getVerticesData(j.f.PositionKind);if(!Z)return this;const x=u.TmpVectors.kx[3],F=u.TmpVectors.kx[2],G=u.TmpVectors.kx[1],f=u.TmpVectors.kx[0],Y=u.TmpVectors.kx[4],d=u.TmpVectors.kx[5],t=u.TmpVectors.kx[6],o=u.TmpVectors.kx[7],c=u.TmpVectors.kx[8];let s=0,J=0,p=0,U=0,k=0,M=0,m=0;const C=this._subdivisionsX,L=this._subdivisionsY;for(let j=0;j<L;j++)for(let L=0;L<C;L++){s=3*L,J=j*(C+1)*3,p=(j+1)*(C+1)*3,x.x=Z[J+s],x.y=Z[J+s+1],x.z=Z[J+s+2],F.x=Z[J+s+3],F.y=Z[J+s+4],F.z=Z[J+s+5],G.x=Z[p+s],G.y=Z[p+s+1],G.z=Z[p+s+2],f.x=Z[p+s+3],f.y=Z[p+s+4],f.z=Z[p+s+5],U=(f.z-x.z)/(f.x-x.x),k=x.z-U*x.x,F.subtractToRef(x,Y),G.subtractToRef(x,d),f.subtractToRef(x,t),u.kx.CrossToRef(t,d,o),u.kx.CrossToRef(Y,t,c),o.normalize(),c.normalize(),M=-(o.x*x.x+o.y*x.y+o.z*x.z),m=-(c.x*F.x+c.y*F.y+c.z*F.z);const H=this._heightQuads[j*C+L];H.slope.Jj(U,k),H.facet1.Jj(o.x,o.y,o.z,M),H.facet2.Jj(c.x,c.y,c.z,m)}return this}serialize(Z){super.serialize(Z),Z.subdivisionsX=this._subdivisionsX,Z.subdivisionsY=this._subdivisionsY,Z.minX=this._minX,Z.maxX=this._maxX,Z.hf=this._minZ,Z.maxZ=this._maxZ,Z.width=this._width,Z.height=this._height}static Parse(Z,x){const F=new d(Z.name,x);return F._subdivisionsX=Z.subdivisionsX||1,F._subdivisionsY=Z.subdivisionsY||1,F._minX=Z.minX,F._maxX=Z.maxX,F._minZ=Z.hf,F._maxZ=Z.maxZ,F._width=Z.width,F._height=Z.height,F}}var t=F(10994),o=F(11037),c=F(11188),s=F(11242);function J(Z){const x=[],F=[],G=[],f=[];let j,d;const t=Z.width||Z.size||1,o=Z.height||Z.size||1,c=0|(Z.subdivisionsX||Z.subdivisions||1),J=0|(Z.subdivisionsY||Z.subdivisions||1);for(j=0;j<=J;j++)for(d=0;d<=c;d++){const Z=new u.kx(d*t/c-t/2,0,(J-j)*o/J-o/2),x=new u.kx(0,1,0);F.push(Z.x,Z.y,Z.z),G.push(x.x,x.y,x.z),f.push(d/c,s.e?j/J:1-j/J)}for(j=0;j<J;j++)for(d=0;d<c;d++)x.push(d+1+(j+1)*(c+1)),x.push(d+1+j*(c+1)),x.push(d+j*(c+1)),x.push(d+(j+1)*(c+1)),x.push(d+1+(j+1)*(c+1)),x.push(d+j*(c+1));const p=new Y.c;return p.indices=x,p.qZ=F,p.RZ=G,p.vZ=f,p}function p(Z){const x=void 0!==Z.xmin&&null!==Z.xmin?Z.xmin:-1,F=void 0!==Z.zmin&&null!==Z.zmin?Z.zmin:-1,G=void 0!==Z.xmax&&null!==Z.xmax?Z.xmax:1,f=void 0!==Z.zmax&&null!==Z.zmax?Z.zmax:1,j=Z.subdivisions||{w:1,h:1},d=Z.precision||{w:1,h:1},t=[],o=[],c=[],s=[];let J,p,U,k;j.h=j.h<1?1:j.h,j.w=j.w<1?1:j.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;const M=(G-x)/j.w,m=(f-F)/j.h;function C(Z,x,F,G){const f=o.length/3,Y=d.w+1;for(J=0;J<d.h;J++)for(p=0;p<d.w;p++){const Z=[f+p+J*Y,f+(p+1)+J*Y,f+(p+1)+(J+1)*Y,f+p+(J+1)*Y];t.push(Z[1]),t.push(Z[2]),t.push(Z[3]),t.push(Z[0]),t.push(Z[1]),t.push(Z[3])}const j=u.kx.Zero(),U=new u.kx(0,1,0);for(J=0;J<=d.h;J++)for(j.z=J*(G-x)/d.h+x,p=0;p<=d.w;p++)j.x=p*(F-Z)/d.w+Z,j.y=0,o.push(j.x,j.y,j.z),c.push(U.x,U.y,U.z),s.push(p/d.w,J/d.h)}for(U=0;U<j.h;U++)for(k=0;k<j.w;k++)C(x+k*M,F+U*m,x+(k+1)*M,F+(U+1)*m);const L=new Y.c;return L.indices=t,L.qZ=o,L.RZ=c,L.vZ=s,L}function U(Z){const x=[],F=[],f=[],j=[];let d,t;const o=Z.colorFilter||new G.Lx(.3,.59,.11),s=Z.alphaFilter||0;let J=!1;if(Z.minHeight>Z.maxHeight){J=!0;const x=Z.maxHeight;Z.maxHeight=Z.minHeight,Z.minHeight=x}for(d=0;d<=Z.subdivisions;d++)for(t=0;t<=Z.subdivisions;t++){const x=new u.kx(t*Z.width/Z.subdivisions-Z.width/2,0,(Z.subdivisions-d)*Z.height/Z.subdivisions-Z.height/2),G=4*(((x.x+Z.width/2)/Z.width*(Z.bufferWidth-1)|0)+((1-(x.z+Z.height/2)/Z.height)*(Z.bufferHeight-1)|0)*Z.bufferWidth);let Y=Z.buffer[G]/255,p=Z.buffer[G+1]/255,U=Z.buffer[G+2]/255;const k=Z.buffer[G+3]/255;J&&(Y=1-Y,p=1-p,U=1-U);const M=Y*o.r+p*o.g+U*o.b;x.y=k>=s?Z.minHeight+(Z.maxHeight-Z.minHeight)*M:Z.minHeight-c.e,Z.heightBuffer&&(Z.heightBuffer[d*(Z.subdivisions+1)+t]=x.y),F.push(x.x,x.y,x.z),f.push(0,0,0),j.push(t/Z.subdivisions,1-d/Z.subdivisions)}for(d=0;d<Z.subdivisions;d++)for(t=0;t<Z.subdivisions;t++){const u=t+1+(d+1)*(Z.subdivisions+1),G=t+1+d*(Z.subdivisions+1),f=t+d*(Z.subdivisions+1),Y=t+(d+1)*(Z.subdivisions+1),j=F[3*u+1]>=Z.minHeight,o=F[3*G+1]>=Z.minHeight,c=F[3*f+1]>=Z.minHeight;j&&o&&c&&(x.push(u),x.push(G),x.push(f));F[3*Y+1]>=Z.minHeight&&j&&c&&(x.push(Y),x.push(u),x.push(f))}Y.c.ComputeNormals(F,x,f);const p=new Y.c;return p.indices=x,p.qZ=F,p.RZ=f,p.vZ=j,p}function k(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=new d(Z,arguments.length>2?arguments[2]:void 0);F._setReady(!1),F._subdivisionsX=x.subdivisionsX||x.subdivisions||1,F._subdivisionsY=x.subdivisionsY||x.subdivisions||1,F._width=x.width||1,F._height=x.height||1,F._maxX=F._width/2,F._maxZ=F._height/2,F._minX=-F._maxX,F._minZ=-F._maxZ;return J(x).iZ(F,x.updatable),F._setReady(!0),F}function M(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new f.d(Z,F);return p(x).iZ(u,x.updatable),u}function m(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const f=F.width||10,Y=F.height||10,j=F.subdivisions||1,c=F.minHeight||0,s=F.maxHeight||1,J=F.colorFilter||new G.Lx(.3,.59,.11),p=F.alphaFilter||0,k=F.updatable,M=F.onReady;u=u||o.c.LastCreatedScene;const m=new d(Z,u);let C;m._subdivisionsX=j,m._subdivisionsY=j,m._width=f,m._height=Y,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ,m._setReady(!1),F.passHeightBufferInCallback&&(C=new Float32Array((j+1)*(j+1)));const L=(Z,x,F)=>{U({width:f,height:Y,subdivisions:j,minHeight:c,maxHeight:s,colorFilter:J,buffer:Z,bufferWidth:x,bufferHeight:F,alphaFilter:p,heightBuffer:C}).iZ(m,k),M&&M(m,C),m._setReady(!0)};if("string"===typeof x){const Z=Z=>{var x;const F=Z.width,G=Z.height;if(u.J)return;const f=null===(x=u)||void 0===x?void 0:x.getEngine().resizeImageBitmap(Z,F,G);L(f,F,G)};t.Tools.LoadImage(x,Z,F.onError?F.onError:()=>{},u.offlineProvider)}else L(x.data,x.width,x.height);return m}Y.c.CreateGround=J,Y.c.CreateTiledGround=p,Y.c.CreateGroundFromHeightMap=U,f.d.CreateGround=(Z,x,F,u,G,f)=>k(Z,{width:x,height:F,subdivisions:u,updatable:f},G),f.d.CreateTiledGround=(Z,x,F,u,G,f,Y,j,d)=>M(Z,{xmin:x,zmin:F,xmax:u,zmax:G,subdivisions:f,precision:Y,updatable:d},j),f.d.CreateGroundFromHeightMap=(Z,x,F,u,G,f,Y,j,d,t,o)=>m(Z,x,{width:F,height:u,subdivisions:G,minHeight:f,maxHeight:Y,updatable:d,onReady:t,alphaFilter:o},j)},13146:(Z,x,F)=>{"use strict";F.d(x,{c:()=>J,f:()=>c,g:()=>s});var u=F(11179),G=F(11671),f=F(11647),Y=F(11767),j=F(11265),d=F(11012);function t(Z){const x=[],F=[],u=Z.lines,G=Z.BZ,Y=[];let j=0;for(let f=0;f<u.length;f++){const Z=u[f];for(let u=0;u<Z.length;u++){const{x:d,y:t,z:o}=Z[u];if(F.push(d,t,o),G){const Z=G[f],{r:x,g:F,b:j,a:d}=Z[u];Y.push(x,F,j,d)}u>0&&(x.push(j-1),x.push(j)),j++}}const d=new f.c;return d.indices=x,d.qZ=F,G&&(d.BZ=Y),d}function o(Z){const x=Z.dashSize||3,F=Z.gapSize||1,G=Z.dashNb||200,Y=Z.points,j=[],d=[],t=u.kx.Zero();let o=0,c=0,s=0,J=0,p=0,U=0,k=0;for(k=0;k<Y.length-1;k++)Y[k+1].subtractToRef(Y[k],t),o+=t.length();for(s=o/G,J=x*s/(x+F),k=0;k<Y.length-1;k++){Y[k+1].subtractToRef(Y[k],t),c=Math.floor(t.length()/s),t.normalize();for(let Z=0;Z<c;Z++)p=s*Z,j.push(Y[k].x+p*t.x,Y[k].y+p*t.y,Y[k].z+p*t.z),j.push(Y[k].x+(p+J)*t.x,Y[k].y+(p+J)*t.y,Y[k].z+(p+J)*t.z),d.push(U,U+1),U+=2}const M=new f.c;return M.qZ=j,M.indices=d,M}function c(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=x.instance,G=x.lines,f=x.BZ;if(u){const Z=u.getVerticesData(j.f.PositionKind);let x,F;f&&(x=u.getVerticesData(j.f.ColorKind));let Y=0,d=0;for(let u=0;u<G.length;u++){const j=G[u];for(let G=0;G<j.length;G++)Z[Y]=j[G].x,Z[Y+1]=j[G].y,Z[Y+2]=j[G].z,f&&x&&(F=f[u],x[d]=F[G].r,x[d+1]=F[G].g,x[d+2]=F[G].b,x[d+3]=F[G].a,d+=4),Y+=3}return u.updateVerticesData(j.f.PositionKind,Z,!1,!1),f&&x&&u.updateVerticesData(j.f.ColorKind,x,!1,!1),u.refreshBoundingInfo(),u}const d=!!f,o=new Y.e(Z,F,null,void 0,void 0,d,x.useVertexAlpha,x.material);return t(x).iZ(o,x.updatable),o}function s(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=x.BZ?[x.BZ]:null;return c(Z,{lines:[x.points],updatable:x.updatable,instance:x.instance,BZ:u,useVertexAlpha:x.useVertexAlpha,material:x.material},F)}function J(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=x.points,j=x.instance,t=x.gapSize||1,c=x.dashSize||3;if(j){const Z=Z=>{const x=u.kx.Zero(),F=Z.length/6;let G=0,Y=0,d=0,t=0,o=0,c=0,s=0,J=0;for(s=0;s<f.length-1;s++)f[s+1].subtractToRef(f[s],x),G+=x.length();d=G/F;const p=j._creationDataStorage.dashSize;for(t=p*d/(p+j._creationDataStorage.gapSize),s=0;s<f.length-1;s++)for(f[s+1].subtractToRef(f[s],x),Y=Math.floor(x.length()/d),x.normalize(),J=0;J<Y&&c<Z.length;)o=d*J,Z[c]=f[s].x+o*x.x,Z[c+1]=f[s].y+o*x.y,Z[c+2]=f[s].z+o*x.z,Z[c+3]=f[s].x+(o+t)*x.x,Z[c+4]=f[s].y+(o+t)*x.y,Z[c+5]=f[s].z+(o+t)*x.z,c+=6,J++;for(;c<Z.length;)Z[c]=f[s].x,Z[c+1]=f[s].y,Z[c+2]=f[s].z,c+=3};return(x.dashNb||x.dashSize||x.gapSize||x.useVertexAlpha||x.material)&&d.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),j.updateMeshPositions(Z,!1),j}const s=new Y.e(Z,F,null,void 0,void 0,void 0,x.useVertexAlpha,x.material);return o(x).iZ(s,x.updatable),s._creationDataStorage=new G.g,s._creationDataStorage.dashSize=c,s._creationDataStorage.gapSize=t,s}f.c.CreateLineSystem=t,f.c.CreateDashedLines=o,G.d.yt=function(Z,x){return s(Z,{points:x,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},G.d.CreateDashedLines=function(Z,x,F,u,G){return J(Z,{points:x,dashSize:F,gapSize:u,dashNb:G,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12511:(Z,x,F)=>{"use strict";F.d(x,{c:()=>j,e:()=>d});var u=F(11671),G=F(11647),f=F(11242);function Y(Z){const x=[],F=[],u=[],Y=[],j=void 0!==Z.width?Z.width:void 0!==Z.size?Z.size:1,d=void 0!==Z.height?Z.height:void 0!==Z.size?Z.size:1,t=0===Z.sideOrientation?0:Z.sideOrientation||G.c.DEFAULTSIDE,o=j/2,c=d/2;F.push(-o,-c,0),u.push(0,0,-1),Y.push(0,f.e?1:0),F.push(o,-c,0),u.push(0,0,-1),Y.push(1,f.e?1:0),F.push(o,c,0),u.push(0,0,-1),Y.push(1,f.e?0:1),F.push(-o,c,0),u.push(0,0,-1),Y.push(0,f.e?0:1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),G.c._ComputeSides(t,F,x,u,Y,Z.frontUVs,Z.backUVs);const s=new G.c;return s.indices=x,s.qZ=F,s.RZ=u,s.vZ=Y,s}function j(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new u.d(Z,F);x.sideOrientation=u.d._GetDefaultSideOrientation(x.sideOrientation),G._originalBuilderSideOrientation=x.sideOrientation;return Y(x).iZ(G,x.updatable),x.sourcePlane&&(G.translate(x.sourcePlane.normal,-x.sourcePlane.d),G.setDirection(x.sourcePlane.normal.scale(-1))),G}const d={Rt:j};G.c.Rt=Y,u.d.Rt=(Z,x,F,u,G)=>j(Z,{size:x,width:x,height:x,sideOrientation:G,updatable:u},F)},12616:(Z,x,F)=>{"use strict";F.d(x,{c:()=>d});var u=F(11179),G=F(11671),f=F(11647),Y=F(11242);function j(Z){const x=0|(Z.segments||32),F=Z.diameterX||Z.diameter||1,G=Z.diameterY||Z.diameter||1,j=Z.diameterZ||Z.diameter||1,d=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,t=Z.slice&&Z.slice<=0?1:Z.slice||1,o=0===Z.sideOrientation?0:Z.sideOrientation||f.c.DEFAULTSIDE,c=!!Z.dedupTopBottomIndices,s=new u.kx(F/2,G/2,j/2),J=2+x,p=2*J,U=[],k=[],M=[],m=[];for(let f=0;f<=J;f++){const Z=f/J,x=Z*Math.PI*t;for(let F=0;F<=p;F++){const G=F/p,f=G*Math.PI*2*d,j=u.Matrix.RotationZ(-x),t=u.Matrix.RotationY(f),o=u.kx.TransformCoordinates(u.kx.Up(),j),c=u.kx.TransformCoordinates(o,t),J=c.multiply(s),U=c.divide(s).normalize();k.push(J.x,J.y,J.z),M.push(U.x,U.y,U.z),m.push(G,Y.e?1-Z:Z)}if(f>0){const Z=k.length/3;for(let x=Z-2*(p+1);x+p+2<Z;x++)c?(f>1&&(U.push(x),U.push(x+1),U.push(x+p+1)),(f<J||t<1)&&(U.push(x+p+1),U.push(x+1),U.push(x+p+2))):(U.push(x),U.push(x+1),U.push(x+p+1),U.push(x+p+1),U.push(x+1),U.push(x+p+2))}}f.c._ComputeSides(o,k,U,M,m,Z.frontUVs,Z.backUVs);const C=new f.c;return C.indices=U,C.qZ=k,C.RZ=M,C.vZ=m,C}function d(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return j(x).iZ(u,x.updatable),u}f.c.CreateSphere=j,G.d.CreateSphere=(Z,x,F,u,G,f)=>d(Z,{segments:x,diameterX:F,diameterY:F,diameterZ:F,sideOrientation:f,updatable:G},u)},13437:(Z,x,F)=>{"use strict";F.d(x,{b:()=>j});var u=F(11787),G=F(12922),f=F(11808),Y=F(11647);class j{static get Configuration(){return{get decoder(){return G.b.DefaultConfiguration},set decoder(Z){G.b.DefaultConfiguration=Z}}}static set Configuration(Z){G.b.DefaultConfiguration=Z.decoder}static get DecoderAvailable(){return(0,u.i)(G.b.DefaultConfiguration)}static get Default(){return j._Default??(j._Default=new j),j._Default}static ResetDefault(Z){j._Default&&(Z||j._Default.dispose(),j._Default=null)}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultNumWorkers;const x="number"===typeof Z?{...G.b.DefaultConfiguration,numWorkers:Z}:{...G.b.DefaultConfiguration,...Z};this._decoder=new G.b(x)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(Z,x,F){return this._decoder.decodeMeshToMeshDataAsync(Z,x,F)}async decodeMeshToGeometryAsync(Z,x,F,u){return await this._decoder.decodeMeshToGeometryAsync(Z,x,F,u)}async _decodeMeshToGeometryForGltfAsync(Z,x,F,u,G,f){return await this._decoder._decodeMeshToGeometryForGltfAsync(Z,x,F,u,G,f)}async decodeMeshAsync(Z,x){const F=await this._decoder.decodeMeshToMeshDataAsync(Z,x),u=new Y.c;F.indices&&(u.indices=F.indices);for(const G of F.attributes){const Z=f.d.GetFloatData(G.data,G.size,f.d.GetDataType(G.data),G.byteOffset,G.byteStride,G.normalized,F.totalVertices);u.set(Z,G.kind)}return u}}j.DefaultNumWorkers=(0,u.h)(),j._Default=null},12922:(Z,x,F)=>{"use strict";F.d(x,{b:()=>t});var u=F(11787),G=F(10994),f=F(11680),Y=F(11808),j=F(11012),d=F(11799);class t extends u.d{static get DefaultAvailable(){return(0,u.i)(t.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(Z){t._Default&&(Z||t._Default.dispose(),t._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(Z,x){return{module:await(x||DracoDecoderModule)({wasmBinary:Z})}}_getWorkerContent(){return`${d.e}(${d.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultConfiguration)}decodeMeshToMeshDataAsync(Z,x,F){const u=Z instanceof ArrayBuffer?new Int8Array(Z):new Int8Array(Z.buffer,Z.byteOffset,Z.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async Z=>await new Promise(((G,f)=>{Z.push(((Z,Y)=>{let d=null;const t=[],o=x=>{Z.removeEventListener("error",o),Z.removeEventListener("message",c),f(x),Y()},c=x=>{const u=x.data;switch(u.id){case"indices":d=u.data;break;case"attribute":t.push({kind:u.kind,data:u.data,size:u.size,byteOffset:u.byteOffset,byteStride:u.byteStride,normalized:(f=u.kind,s=u.normalized,F&&void 0!==F[f]?(s!==F[f]&&j.d.Warn(`Normalized flag from Draco data (${s}) does not match normalized flag from glTF accessor (${F[f]}). Using flag from glTF accessor.`),F[f]):s)});break;case"decodeMeshDone":Z.removeEventListener("error",o),Z.removeEventListener("message",c),G({indices:d,attributes:t,totalVertices:u.totalVertices}),Y()}var f,s};Z.addEventListener("error",o),Z.addEventListener("message",c);const s=u.slice();Z.postMessage({id:"decodeMesh",dataView:s,attributes:x},[s.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((Z=>{let F=null;const G=[],f=(0,d.e)(Z.module,u,x,(Z=>{F=Z}),((Z,x,F,u,f,Y)=>{G.push({kind:Z,data:x,size:F,byteOffset:u,byteStride:f,normalized:Y})}));return{indices:F,attributes:G,totalVertices:f}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(Z,x,F,u){const G=await this.decodeMeshToMeshDataAsync(F,u),j=new f.c(Z,x);G.indices&&j.setIndices(G.indices);for(const f of G.attributes)j.setVerticesBuffer(new Y.d(x.getEngine(),f.data,f.kind,!1,void 0,f.byteStride,void 0,f.byteOffset,f.size,void 0,f.normalized,!0),G.totalVertices);return j}async _decodeMeshToGeometryForGltfAsync(Z,x,F,u,G,j){const d=await this.decodeMeshToMeshDataAsync(F,u,G),t=new f.c(Z,x);j&&(t._boundingInfo=j,t.useBoundingInfoFromGeometry=!0),d.indices&&t.setIndices(d.indices);for(const f of d.attributes)t.setVerticesBuffer(new Y.d(x.getEngine(),f.data,f.kind,!1,void 0,f.byteStride,void 0,f.byteOffset,f.size,void 0,f.normalized,!0),d.totalVertices);return t}}t.DefaultConfiguration={wasmUrl:`${G.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${G.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${G.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},t._Default=null},13140:(Z,x,F)=>{"use strict";F.d(x,{c:()=>jZ});var u=F(11179),G=F(11671),f=F(11265),Y=F(11647),j=F(11242);function d(Z){let x=Z.pathArray;const F=Z.closeArray||!1,u=Z.closePath||!1,G=Z.invertUV||!1,d=Math.floor(x[0].length/2);let t=Z.offset||d;t=t>d?d:Math.floor(t);const o=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,c=Z.vZ,s=Z.BZ,J=[],p=[],U=[],k=[],M=[],m=[],C=[],L=[];let H;const S=[],K=[];let y,q,R;if(x.length<2){const Z=[],F=[];for(q=0;q<x[0].length-t;q++)Z.push(x[0][q]),F.push(x[0][q+t]);x=[Z,F]}let B=0;const v=u?1:0,l=F?1:0;let i,e,b,E,w,T;for(H=x[0].length,y=0;y<x.length+l;y++){for(C[y]=0,M[y]=[0],i=y===x.length?x[0]:x[y],e=i.length,H=H<e?H:e,R=0;R<e;)J.push(i[R].x,i[R].y,i[R].z),R>0&&(b=i[R].Mx(i[R-1]).length(),E=b+C[y],M[y].push(E),C[y]=E),R++;u&&(R--,J.push(i[0].x,i[0].y,i[0].z),b=i[R].Mx(i[0]).length(),E=b+C[y],M[y].push(E),C[y]=E),S[y]=e+v,K[y]=B,B+=e+v}let N,W,A=null,h=null;for(q=0;q<H+v;q++)for(L[q]=0,m[q]=[0],y=0;y<x.length-1+l;y++)w=x[y],T=y===x.length-1?x[0]:x[y+1],q===H?(A=w[0],h=T[0]):(A=w[q],h=T[q]),b=h.Mx(A).length(),E=b+L[q],m[q].push(E),L[q]=E;if(c)for(y=0;y<c.length;y++)k.push(c[y].x,j.e?1-c[y].y:c[y].y);else for(y=0;y<x.length+l;y++)for(q=0;q<H+v;q++)N=0!=C[y]?M[y][q]/C[y]:0,W=0!=L[q]?m[q][y]/L[q]:0,G?k.push(W,N):k.push(N,j.e?1-W:W);y=0;let X=0,D=S[y]-1,Q=S[y+1]-1,g=D<Q?D:Q,O=K[1]-K[0];const n=S.length-1;for(;X<=g&&y<n;)p.push(X,X+O,X+1),p.push(X+O+1,X+1,X+O),X+=1,X===g&&(y++,O=K[y+1]-K[y],D=S[y]-1,Q=S[y+1]-1,X=K[y],g=D<Q?D+X:Q+X);if(Y.c.ComputeNormals(J,p,U),u){let Z=0,F=0;for(y=0;y<x.length;y++){Z=3*K[y],F=y+1<x.length?3*(K[y+1]-1):U.length-3,U[Z]=.5*(U[Z]+U[F]),U[Z+1]=.5*(U[Z+1]+U[F+1]),U[Z+2]=.5*(U[Z+2]+U[F+2]);const u=Math.sqrt(U[Z]*U[Z]+U[Z+1]*U[Z+1]+U[Z+2]*U[Z+2]);U[Z]/=u,U[Z+1]/=u,U[Z+2]/=u,U[F]=U[Z],U[F+1]=U[Z+1],U[F+2]=U[Z+2]}}if(F){let Z=3*K[0],F=3*K[x.length];for(q=0;q<H+v;q++){U[Z]=.5*(U[Z]+U[F]),U[Z+1]=.5*(U[Z+1]+U[F+1]),U[Z+2]=.5*(U[Z+2]+U[F+2]);const x=Math.sqrt(U[Z]*U[Z]+U[Z+1]*U[Z+1]+U[Z+2]*U[Z+2]);U[Z]/=x,U[Z+1]/=x,U[Z+2]/=x,U[F]=U[Z],U[F+1]=U[Z+1],U[F+2]=U[Z+2],Z+=3,F+=3}}Y.c._ComputeSides(o,J,p,U,k,Z.frontUVs,Z.backUVs);let V=null;if(s){V=new Float32Array(4*s.length);for(let Z=0;Z<s.length;Z++)V[4*Z]=s[Z].r,V[4*Z+1]=s[Z].g,V[4*Z+2]=s[Z].b,V[4*Z+3]=s[Z].a}const a=new Y.c,I=new Float32Array(J),r=new Float32Array(U),z=new Float32Array(k);return a.indices=p,a.qZ=I,a.RZ=r,a.vZ=z,V&&a.set(V,f.f.ColorKind),u&&(a._idx=K),a}function t(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=x.pathArray,o=x.closeArray,c=x.closePath,s=G.d._GetDefaultSideOrientation(x.sideOrientation),J=x.instance,p=x.updatable;if(J){const Z=u.TmpVectors.kx[0].Uj(Number.MAX_VALUE),F=u.TmpVectors.kx[1].Uj(-Number.MAX_VALUE),d=x=>{let u=t[0].length;const f=J;let Y=0;const j=f._originalBuilderSideOrientation===G.d.DOUBLESIDE?2:1;for(let G=1;G<=j;++G)for(let j=0;j<t.length;++j){const G=t[j],d=G.length;u=u<d?u:d;for(let f=0;f<u;++f){const u=G[f];x[Y]=u.x,x[Y+1]=u.y,x[Y+2]=u.z,Z.minimizeInPlaceFromFloats(u.x,u.y,u.z),F.maximizeInPlaceFromFloats(u.x,u.y,u.z),Y+=3}if(f._creationDataStorage&&f._creationDataStorage.closePath){const Z=G[0];x[Y]=Z.x,x[Y+1]=Z.y,x[Y+2]=Z.z,Y+=3}}},o=J.getVerticesData(f.f.PositionKind);if(d(o),J.hasBoundingInfo?J.getBoundingInfo().reConstruct(Z,F,J._worldMatrix):J.buildBoundingInfo(Z,F,J._worldMatrix),J.updateVerticesData(f.f.PositionKind,o,!1,!1),x.BZ){const Z=J.getVerticesData(f.f.ColorKind);for(let F=0,u=0;F<x.BZ.length;F++,u+=4){const G=x.BZ[F];Z[u]=G.r,Z[u+1]=G.g,Z[u+2]=G.b,Z[u+3]=G.a}J.updateVerticesData(f.f.ColorKind,Z,!1,!1)}if(x.vZ){const Z=J.getVerticesData(f.f.UVKind);for(let F=0;F<x.vZ.length;F++)Z[2*F]=x.vZ[F].x,Z[2*F+1]=j.e?1-x.vZ[F].y:x.vZ[F].y;J.updateVerticesData(f.f.UVKind,Z,!1,!1)}if(!J.areNormalsFrozen||J.isFacetDataEnabled){const Z=J.cj(),x=J.getVerticesData(f.f.NormalKind),F=J.isFacetDataEnabled?J.getFacetDataParameters():null;if(Y.c.ComputeNormals(o,Z,x,F),J._creationDataStorage&&J._creationDataStorage.closePath){let Z=0,F=0;for(let u=0;u<t.length;u++)Z=3*J._creationDataStorage.idx[u],F=u+1<t.length?3*(J._creationDataStorage.idx[u+1]-1):x.length-3,x[Z]=.5*(x[Z]+x[F]),x[Z+1]=.5*(x[Z+1]+x[F+1]),x[Z+2]=.5*(x[Z+2]+x[F+2]),x[F]=x[Z],x[F+1]=x[Z+1],x[F+2]=x[Z+2]}J.areNormalsFrozen||J.updateVerticesData(f.f.NormalKind,x,!1,!1)}return J}{const u=new G.d(Z,F);u._originalBuilderSideOrientation=s,u._creationDataStorage=new G.g;const f=d(x);return c&&(u._creationDataStorage.idx=f._idx),u._creationDataStorage.closePath=c,u._creationDataStorage.closeArray=o,f.iZ(u,p),u}}Y.c.CreateRibbon=d,G.d.CreateRibbon=function(Z,x){return t(Z,{pathArray:x,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var o=F(12629),c=F(12465),s=F(11230);function J(Z){const x=Z.pattern||G.d.NO_FLIP,F=Z.tileWidth||Z.tileSize||1,u=Z.tileHeight||Z.tileSize||1,f=Z.alignHorizontal||0,j=Z.alignVertical||0,d=Z.width||Z.size||1,t=Math.floor(d/F);let o=d-t*F;const c=Z.height||Z.size||1,s=Math.floor(c/u);let J=c-s*u;const p=F*t/2,U=u*s/2;let k=0,M=0,m=0,C=0,L=0,H=0;if(o>0||J>0){switch(m=-p,C=-U,L=p,H=U,f){case G.d.CENTER:o/=2,m-=o,L+=o;break;case G.d.LEFT:L+=o,k=-o/2;break;case G.d.RIGHT:m-=o,k=o/2}switch(j){case G.d.CENTER:J/=2,C-=J,H+=J;break;case G.d.BOTTOM:H+=J,M=-J/2;break;case G.d.TOP:C-=J,M=J/2}}const S=[],K=[],y=[];y[0]=[0,0,1,0,1,1,0,1],y[1]=[0,0,1,0,1,1,0,1],x!==G.d.ROTATE_TILE&&x!==G.d.ROTATE_ROW||(y[1]=[1,1,0,1,0,0,1,0]),x!==G.d.FLIP_TILE&&x!==G.d.FLIP_ROW||(y[1]=[1,0,0,0,0,1,1,1]),x!==G.d.FLIP_N_ROTATE_TILE&&x!==G.d.FLIP_N_ROTATE_ROW||(y[1]=[0,1,1,1,1,0,0,0]);let q=[];const R=[],B=[];let v=0;for(let Y=0;Y<s;Y++)for(let Z=0;Z<t;Z++)S.push(Z*F-p+k,Y*u-U+M,0),S.push((Z+1)*F-p+k,Y*u-U+M,0),S.push((Z+1)*F-p+k,(Y+1)*u-U+M,0),S.push(Z*F-p+k,(Y+1)*u-U+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),q=x===G.d.FLIP_TILE||x===G.d.ROTATE_TILE||x===G.d.FLIP_N_ROTATE_TILE?q.concat(y[(Z%2+Y%2)%2]):x===G.d.FLIP_ROW||x===G.d.ROTATE_ROW||x===G.d.FLIP_N_ROTATE_ROW?q.concat(y[Y%2]):q.concat(y[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),v+=4;if(o>0||J>0){const Z=J>0&&(j===G.d.CENTER||j===G.d.TOP),Y=J>0&&(j===G.d.CENTER||j===G.d.BOTTOM),d=o>0&&(f===G.d.CENTER||f===G.d.RIGHT),c=o>0&&(f===G.d.CENTER||f===G.d.LEFT);let y,l,i,e,b=[];if(Z&&d&&(S.push(m+k,C+M,0),S.push(-p+k,C+M,0),S.push(-p+k,C+J+M,0),S.push(m+k,C+J+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,y=1-o/F,l=1-J/u,i=1,e=1,b=[y,l,i,l,i,e,y,e],x===G.d.ROTATE_ROW&&(b=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),x===G.d.FLIP_ROW&&(b=[1-y,l,1-i,l,1-i,e,1-y,e]),x===G.d.FLIP_N_ROTATE_ROW&&(b=[y,1-l,i,1-l,i,1-e,y,1-e]),q=q.concat(b),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z&&c&&(S.push(p+k,C+M,0),S.push(L+k,C+M,0),S.push(L+k,C+J+M,0),S.push(p+k,C+J+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,y=0,l=1-J/u,i=o/F,e=1,b=[y,l,i,l,i,e,y,e],(x===G.d.ROTATE_ROW||x===G.d.ROTATE_TILE&&t%2===0)&&(b=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),(x===G.d.FLIP_ROW||x===G.d.FLIP_TILE&&t%2===0)&&(b=[1-y,l,1-i,l,1-i,e,1-y,e]),(x===G.d.FLIP_N_ROTATE_ROW||x===G.d.FLIP_N_ROTATE_TILE&&t%2===0)&&(b=[y,1-l,i,1-l,i,1-e,y,1-e]),q=q.concat(b),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&d&&(S.push(m+k,U+M,0),S.push(-p+k,U+M,0),S.push(-p+k,H+M,0),S.push(m+k,H+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,y=1-o/F,l=0,i=1,e=J/u,b=[y,l,i,l,i,e,y,e],(x===G.d.ROTATE_ROW&&s%2===1||x===G.d.ROTATE_TILE&&s%1===0)&&(b=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),(x===G.d.FLIP_ROW&&s%2===1||x===G.d.FLIP_TILE&&s%2===0)&&(b=[1-y,l,1-i,l,1-i,e,1-y,e]),(x===G.d.FLIP_N_ROTATE_ROW&&s%2===1||x===G.d.FLIP_N_ROTATE_TILE&&s%2===0)&&(b=[y,1-l,i,1-l,i,1-e,y,1-e]),q=q.concat(b),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&c&&(S.push(p+k,U+M,0),S.push(L+k,U+M,0),S.push(L+k,H+M,0),S.push(p+k,H+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,y=0,l=0,i=o/F,e=J/u,b=[y,l,i,l,i,e,y,e],(x===G.d.ROTATE_ROW&&s%2===1||x===G.d.ROTATE_TILE&&(s+t)%2===1)&&(b=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),(x===G.d.FLIP_ROW&&s%2===1||x===G.d.FLIP_TILE&&(s+t)%2===1)&&(b=[1-y,l,1-i,l,1-i,e,1-y,e]),(x===G.d.FLIP_N_ROTATE_ROW&&s%2===1||x===G.d.FLIP_N_ROTATE_TILE&&(s+t)%2===1)&&(b=[y,1-l,i,1-l,i,1-e,y,1-e]),q=q.concat(b),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Z){const Z=[];y=0,l=1-J/u,i=1,e=1,Z[0]=[y,l,i,l,i,e,y,e],Z[1]=[y,l,i,l,i,e,y,e],x!==G.d.ROTATE_TILE&&x!==G.d.ROTATE_ROW||(Z[1]=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),x!==G.d.FLIP_TILE&&x!==G.d.FLIP_ROW||(Z[1]=[1-y,l,1-i,l,1-i,e,1-y,e]),x!==G.d.FLIP_N_ROTATE_TILE&&x!==G.d.FLIP_N_ROTATE_ROW||(Z[1]=[y,1-l,i,1-l,i,1-e,y,1-e]);for(let u=0;u<t;u++)S.push(u*F-p+k,C+M,0),S.push((u+1)*F-p+k,C+M,0),S.push((u+1)*F-p+k,C+J+M,0),S.push(u*F-p+k,C+J+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,q=x===G.d.FLIP_TILE||x===G.d.ROTATE_TILE||x===G.d.FLIP_N_ROTATE_TILE?q.concat(Z[(u+1)%2]):x===G.d.FLIP_ROW||x===G.d.ROTATE_ROW||x===G.d.FLIP_N_ROTATE_ROW?q.concat(Z[1]):q.concat(Z[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const Z=[];y=0,l=0,i=1,e=J/u,Z[0]=[y,l,i,l,i,e,y,e],Z[1]=[y,l,i,l,i,e,y,e],x!==G.d.ROTATE_TILE&&x!==G.d.ROTATE_ROW||(Z[1]=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),x!==G.d.FLIP_TILE&&x!==G.d.FLIP_ROW||(Z[1]=[1-y,l,1-i,l,1-i,e,1-y,e]),x!==G.d.FLIP_N_ROTATE_TILE&&x!==G.d.FLIP_N_ROTATE_ROW||(Z[1]=[y,1-l,i,1-l,i,1-e,y,1-e]);for(let u=0;u<t;u++)S.push(u*F-p+k,H-J+M,0),S.push((u+1)*F-p+k,H-J+M,0),S.push((u+1)*F-p+k,H+M,0),S.push(u*F-p+k,H+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,q=x===G.d.FLIP_TILE||x===G.d.ROTATE_TILE||x===G.d.FLIP_N_ROTATE_TILE?q.concat(Z[(u+s)%2]):x===G.d.FLIP_ROW||x===G.d.ROTATE_ROW||x===G.d.FLIP_N_ROTATE_ROW?q.concat(Z[s%2]):q.concat(Z[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(d){const Z=[];y=1-o/F,l=0,i=1,e=1,Z[0]=[y,l,i,l,i,e,y,e],Z[1]=[y,l,i,l,i,e,y,e],x!==G.d.ROTATE_TILE&&x!==G.d.ROTATE_ROW||(Z[1]=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),x!==G.d.FLIP_TILE&&x!==G.d.FLIP_ROW||(Z[1]=[1-y,l,1-i,l,1-i,e,1-y,e]),x!==G.d.FLIP_N_ROTATE_TILE&&x!==G.d.FLIP_N_ROTATE_ROW||(Z[1]=[y,1-l,i,1-l,i,1-e,y,1-e]);for(let F=0;F<s;F++)S.push(m+k,F*u-U+M,0),S.push(m+o+k,F*u-U+M,0),S.push(m+o+k,(F+1)*u-U+M,0),S.push(m+k,(F+1)*u-U+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,q=x===G.d.FLIP_TILE||x===G.d.ROTATE_TILE||x===G.d.FLIP_N_ROTATE_TILE?q.concat(Z[(F+1)%2]):x===G.d.FLIP_ROW||x===G.d.ROTATE_ROW||x===G.d.FLIP_N_ROTATE_ROW?q.concat(Z[F%2]):q.concat(Z[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const Z=[];y=0,l=0,i=o/u,e=1,Z[0]=[y,l,i,l,i,e,y,e],Z[1]=[y,l,i,l,i,e,y,e],x!==G.d.ROTATE_TILE&&x!==G.d.ROTATE_ROW||(Z[1]=[1-y,1-l,1-i,1-l,1-i,1-e,1-y,1-e]),x!==G.d.FLIP_TILE&&x!==G.d.FLIP_ROW||(Z[1]=[1-y,l,1-i,l,1-i,e,1-y,e]),x!==G.d.FLIP_N_ROTATE_TILE&&x!==G.d.FLIP_N_ROTATE_ROW||(Z[1]=[y,1-l,i,1-l,i,1-e,y,1-e]);for(let F=0;F<s;F++)S.push(L-o+k,F*u-U+M,0),S.push(L+k,F*u-U+M,0),S.push(L+k,(F+1)*u-U+M,0),S.push(L-o+k,(F+1)*u-U+M,0),B.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,q=x===G.d.FLIP_TILE||x===G.d.ROTATE_TILE||x===G.d.FLIP_N_ROTATE_TILE?q.concat(Z[(F+t)%2]):x===G.d.FLIP_ROW||x===G.d.ROTATE_ROW||x===G.d.FLIP_N_ROTATE_ROW?q.concat(Z[F%2]):q.concat(Z[0]),R.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const l=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE;Y.c._ComputeSides(l,S,B,K,q,Z.frontUVs,Z.backUVs);const i=new Y.c;i.indices=B,i.qZ=S,i.RZ=K,i.vZ=q;const e=l===Y.c.DOUBLESIDE?R.concat(R):R;return i.BZ=e,i}function p(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return J(x).iZ(u,x.updatable),u}function U(Z){const x=Z.faceUV||new Array(6),F=Z.faceColors,f=Z.pattern||G.d.NO_FLIP,d=Z.width||Z.size||1,t=Z.height||Z.size||1,o=Z.depth||Z.size||1,c=Z.tileWidth||Z.tileSize||1,p=Z.tileHeight||Z.tileSize||1,U=Z.alignHorizontal||0,k=Z.alignVertical||0,M=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE;for(let G=0;G<6;G++)void 0===x[G]&&(x[G]=new u.Vector4(0,0,1,1)),F&&void 0===F[G]&&(F[G]=new s.kj(1,1,1,1));const m=d/2,C=t/2,L=o/2,H=[];for(let u=0;u<2;u++)H[u]=J({pattern:f,tileWidth:c,tileHeight:p,width:d,height:t,alignVertical:k,alignHorizontal:U,sideOrientation:M});for(let u=2;u<4;u++)H[u]=J({pattern:f,tileWidth:c,tileHeight:p,width:o,height:t,alignVertical:k,alignHorizontal:U,sideOrientation:M});let S=k;k===G.d.BOTTOM?S=G.d.TOP:k===G.d.TOP&&(S=G.d.BOTTOM);for(let u=4;u<6;u++)H[u]=J({pattern:f,tileWidth:c,tileHeight:p,width:d,height:o,alignVertical:S,alignHorizontal:U,sideOrientation:M});let K=[],y=[],q=[],R=[];const B=[],v=[],l=[],i=[];let e=0,b=0;for(let G=0;G<6;G++){const Z=H[G].qZ.length;v[G]=[],l[G]=[];for(let x=0;x<Z/3;x++)v[G].push(new u.kx(H[G].qZ[3*x],H[G].qZ[3*x+1],H[G].qZ[3*x+2])),l[G].push(new u.kx(H[G].RZ[3*x],H[G].RZ[3*x+1],H[G].RZ[3*x+2]));e=H[G].vZ.length,i[G]=[];for(let F=0;F<e;F+=2)i[G][F]=x[G].x+(x[G].z-x[G].x)*H[G].vZ[F],i[G][F+1]=x[G].y+(x[G].w-x[G].y)*H[G].vZ[F+1],j.e&&(i[G][F+1]=1-i[G][F+1]);if(q=q.concat(i[G]),R=R.concat(H[G].indices.map((Z=>Z+b))),b+=v[G].length,F)for(let x=0;x<4;x++)B.push(F[G].r,F[G].g,F[G].b,F[G].a)}const E=new u.kx(0,0,L),w=u.Matrix.RotationY(Math.PI);K=v[0].map((Z=>u.kx.TransformNormal(Z,w).add(E))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]),y=l[0].map((Z=>u.kx.TransformNormal(Z,w))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]),K=K.concat(v[1].map((Z=>Z.Mx(E))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),y=y.concat(l[1].map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]));const T=new u.kx(m,0,0),N=u.Matrix.RotationY(-Math.PI/2);K=K.concat(v[2].map((Z=>u.kx.TransformNormal(Z,N).add(T))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),y=y.concat(l[2].map((Z=>u.kx.TransformNormal(Z,N))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]));const W=u.Matrix.RotationY(Math.PI/2);K=K.concat(v[3].map((Z=>u.kx.TransformNormal(Z,W).Mx(T))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),y=y.concat(l[3].map((Z=>u.kx.TransformNormal(Z,W))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]));const A=new u.kx(0,C,0),h=u.Matrix.RotationX(Math.PI/2);K=K.concat(v[4].map((Z=>u.kx.TransformNormal(Z,h).add(A))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),y=y.concat(l[4].map((Z=>u.kx.TransformNormal(Z,h))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[]));const X=u.Matrix.RotationX(-Math.PI/2);K=K.concat(v[5].map((Z=>u.kx.TransformNormal(Z,X).Mx(A))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),y=y.concat(l[5].map((Z=>u.kx.TransformNormal(Z,X))).map((Z=>[Z.x,Z.y,Z.z])).reduce(((Z,x)=>Z.concat(x)),[])),Y.c._ComputeSides(M,K,R,y,q);const D=new Y.c;if(D.indices=R,D.qZ=K,D.RZ=y,D.vZ=q,F){const Z=M===Y.c.DOUBLESIDE?B.concat(B):B;D.BZ=Z}return D}function k(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return U(x).iZ(u,x.updatable),u}Y.c.CreateTiledPlane=J;Y.c.CreateTiledBox=U;var M=F(12616),m=F(11447),C=F(11410);function L(Z){const x=Z.height||2;let F=0===Z.diameterTop?0:Z.diameterTop||Z.diameter||1,f=0===Z.diameterBottom?0:Z.diameterBottom||Z.diameter||1;F=F||1e-5,f=f||1e-5;const d=0|(Z.tessellation||24),t=0|(Z.subdivisions||1),o=!!Z.hasRings,c=!!Z.enclose,J=0===Z.cap?0:Z.cap||G.d.CAP_ALL,p=Z.arc&&(Z.arc<=0||Z.arc>1)?1:Z.arc||1,U=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,k=Z.faceUV||new Array(3),M=Z.faceColors,m=2+(1+(1!==p&&c?2:0))*(o?t:1);let L;for(L=0;L<m;L++)M&&void 0===M[L]&&(M[L]=new s.kj(1,1,1,1));for(L=0;L<m;L++)k&&void 0===k[L]&&(k[L]=new u.Vector4(0,0,1,1));const H=[],S=[],K=[],y=[],q=[],R=2*Math.PI*p/d;let B,v,l;const i=(f-F)/2/x,e=u.kx.Zero(),b=u.kx.Zero(),E=u.kx.Zero(),w=u.kx.Zero(),T=u.kx.Zero(),N=C.c.Y;let W,A,h,X=1,D=1,Q=0,g=0;for(W=0;W<=t;W++)for(v=W/t,l=(v*(F-f)+f)/2,X=o&&0!==W&&W!==t?2:1,h=0;h<X;h++){for(o&&(D+=h),c&&(D+=2*h),A=0;A<=d;A++)B=A*R,e.x=Math.cos(-B)*l,e.y=-x/2+v*x,e.z=Math.sin(-B)*l,0===F&&W===t?(b.x=K[K.length-3*(d+1)],b.y=K[K.length-3*(d+1)+1],b.z=K[K.length-3*(d+1)+2]):(b.x=e.x,b.z=e.z,b.y=Math.sqrt(b.x*b.x+b.z*b.z)*i,b.normalize()),0===A&&(E.G(e),w.G(b)),S.push(e.x,e.y,e.z),K.push(b.x,b.y,b.z),g=o?Q!==D?k[D].y:k[D].w:k[D].y+(k[D].w-k[D].y)*v,y.push(k[D].x+(k[D].z-k[D].x)*A/d,j.e?1-g:g),M&&q.push(M[D].r,M[D].g,M[D].b,M[D].a);1!==p&&c&&(S.push(e.x,e.y,e.z),S.push(0,e.y,0),S.push(0,e.y,0),S.push(E.x,E.y,E.z),u.kx.CrossToRef(N,b,T),T.normalize(),K.push(T.x,T.y,T.z,T.x,T.y,T.z),u.kx.CrossToRef(w,N,T),T.normalize(),K.push(T.x,T.y,T.z,T.x,T.y,T.z),g=o?Q!==D?k[D+1].y:k[D+1].w:k[D+1].y+(k[D+1].w-k[D+1].y)*v,y.push(k[D+1].x,j.e?1-g:g),y.push(k[D+1].z,j.e?1-g:g),g=o?Q!==D?k[D+2].y:k[D+2].w:k[D+2].y+(k[D+2].w-k[D+2].y)*v,y.push(k[D+2].x,j.e?1-g:g),y.push(k[D+2].z,j.e?1-g:g),M&&(q.push(M[D+1].r,M[D+1].g,M[D+1].b,M[D+1].a),q.push(M[D+1].r,M[D+1].g,M[D+1].b,M[D+1].a),q.push(M[D+2].r,M[D+2].g,M[D+2].b,M[D+2].a),q.push(M[D+2].r,M[D+2].g,M[D+2].b,M[D+2].a))),Q!==D&&(Q=D)}const O=1!==p&&c?d+4:d;for(W=0,D=0;D<t;D++){let Z=0,x=0,F=0,u=0;for(A=0;A<d;A++)Z=W*(O+1)+A,x=(W+1)*(O+1)+A,F=W*(O+1)+(A+1),u=(W+1)*(O+1)+(A+1),H.push(Z,x,F),H.push(u,F,x);1!==p&&c&&(H.push(Z+2,x+2,F+2),H.push(u+2,F+2,x+2),H.push(Z+4,x+4,F+4),H.push(u+4,F+4,x+4)),W=o?W+2:W+1}const n=Z=>{const G=Z?F/2:f/2;if(0===G)return;let Y,t,o;const c=Z?k[m-1]:k[0];let s=null;M&&(s=Z?M[m-1]:M[0]);const J=S.length/3,U=Z?x/2:-x/2,C=new u.kx(0,U,0);S.push(C.x,C.y,C.z),K.push(0,Z?1:-1,0);const L=c.y+.5*(c.w-c.y);y.push(c.x+.5*(c.z-c.x),j.e?1-L:L),s&&q.push(s.r,s.g,s.b,s.a);const R=new u.Vector2(.5,.5);for(o=0;o<=d;o++){Y=2*Math.PI*o*p/d;const x=Math.cos(-Y),F=Math.sin(-Y);t=new u.kx(x*G,U,F*G);const f=new u.Vector2(x*R.x+.5,F*R.y+.5);S.push(t.x,t.y,t.z),K.push(0,Z?1:-1,0);const J=c.y+(c.w-c.y)*f.y;y.push(c.x+(c.z-c.x)*f.x,j.e?1-J:J),s&&q.push(s.r,s.g,s.b,s.a)}for(o=0;o<d;o++)Z?(H.push(J),H.push(J+(o+2)),H.push(J+(o+1))):(H.push(J),H.push(J+(o+1)),H.push(J+(o+2)))};J!==G.d.CAP_START&&J!==G.d.CAP_ALL||n(!1),J!==G.d.CAP_END&&J!==G.d.CAP_ALL||n(!0),Y.c._ComputeSides(U,S,H,K,y,Z.frontUVs,Z.backUVs);const V=new Y.c;return V.indices=H,V.qZ=S,V.RZ=K,V.vZ=y,M&&(V.BZ=q),V}function H(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return L(x).iZ(u,x.updatable),u}function S(Z){const x=[],F=[],G=[],f=[],d=Z.diameter||1,t=Z.thickness||.5,o=0|(Z.tessellation||16),c=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,s=o+1;for(let Y=0;Y<=o;Y++){const Z=Y/o,c=Y*Math.PI*2/o-Math.PI/2,J=u.Matrix.Translation(d/2,0,0).multiply(u.Matrix.RotationY(c));for(let d=0;d<=o;d++){const c=1-d/o,p=d*Math.PI*2/o+Math.PI,U=Math.cos(p),k=Math.sin(p);let M=new u.kx(U,k,0),m=M.scale(t/2);const C=new u.Vector2(Z,c);m=u.kx.TransformCoordinates(m,J),M=u.kx.TransformNormal(M,J),F.push(m.x,m.y,m.z),G.push(M.x,M.y,M.z),f.push(C.x,j.e?1-C.y:C.y);const L=(Y+1)%s,H=(d+1)%s;x.push(Y*s+d),x.push(Y*s+H),x.push(L*s+d),x.push(Y*s+H),x.push(L*s+H),x.push(L*s+d)}}Y.c._ComputeSides(c,F,x,G,f,Z.frontUVs,Z.backUVs);const J=new Y.c;return J.indices=x,J.qZ=F,J.RZ=G,J.vZ=f,J}function K(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return S(x).iZ(u,x.updatable),u}Y.c.CreateCylinder=L,G.d.CreateCylinder=(Z,x,F,u,f,Y,j,d,t)=>{void 0!==j&&j instanceof m.d||(void 0!==j&&(t=d||G.d.DEFAULTSIDE,d=j),j=Y,Y=1);return H(Z,{height:x,diameterTop:F,diameterBottom:u,tessellation:f,subdivisions:Y,sideOrientation:t,updatable:d},j)};function y(Z){const x=[],F=[],G=[],f=[],d=Z.radius||2,t=Z.tube||.5,o=Z.radialSegments||32,c=Z.tubularSegments||32,s=Z.p||2,J=Z.q||3,p=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,U=Z=>{const x=Math.cos(Z),F=Math.sin(Z),G=J/s*Z,f=Math.cos(G),Y=d*(2+f)*.5*x,j=d*(2+f)*F*.5,t=d*Math.sin(G)*.5;return new u.kx(Y,j,t)};let k,M;for(k=0;k<=o;k++){const Z=k%o/o*2*s*Math.PI,x=U(Z),G=U(Z+.01),Y=G.Mx(x);let d=G.add(x);const J=u.kx.Cross(Y,d);for(d=u.kx.Cross(J,Y),J.normalize(),d.normalize(),M=0;M<c;M++){const Z=M%c/c*2*Math.PI,u=-t*Math.cos(Z),G=t*Math.sin(Z);F.push(x.x+u*d.x+G*J.x),F.push(x.y+u*d.y+G*J.y),F.push(x.z+u*d.z+G*J.z),f.push(k/o),f.push(j.e?1-M/c:M/c)}}for(k=0;k<o;k++)for(M=0;M<c;M++){const Z=(M+1)%c,F=k*c+M,u=(k+1)*c+M,G=(k+1)*c+Z,f=k*c+Z;x.push(f),x.push(u),x.push(F),x.push(f),x.push(G),x.push(u)}Y.c.ComputeNormals(F,x,G),Y.c._ComputeSides(p,F,x,G,f,Z.frontUVs,Z.backUVs);const m=new Y.c;return m.indices=x,m.qZ=F,m.RZ=G,m.vZ=f,m}function q(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return y(x).iZ(u,x.updatable),u}Y.c.CreateTorus=S,G.d.CreateTorus=(Z,x,F,u,G,f,Y)=>K(Z,{diameter:x,thickness:F,tessellation:u,sideOrientation:Y,updatable:f},G);Y.c.CreateTorusKnot=y,G.d.CreateTorusKnot=(Z,x,F,u,G,f,Y,j,d,t)=>q(Z,{radius:x,tube:F,radialSegments:u,tubularSegments:G,p:f,q:Y,sideOrientation:t,updatable:d},j);var R=F(13146),B=F(11780),v=F(11424);function l(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=x.path,f=x.shape,Y=x.scale||1,j=x.rotation||0,d=0===x.cap?0:x.cap||G.d.NO_CAP,t=x.updatable,o=G.d._GetDefaultSideOrientation(x.sideOrientation),c=x.instance||null,s=x.invertUV||!1,J=x.closeShape||!1,p=x.closePath||!1,U=x.capFunction||null;return e(Z,f,u,Y,j,null,null,p,J,d,!1,F,!!t,o,c,s,x.frontUVs||null,x.backUVs||null,x.firstNormal||null,!!x.adjustFrame,U)}function i(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=x.path,f=x.shape,Y=x.scaleFunction||(()=>1),j=x.rotationFunction||(()=>0),d=x.closePath||x.ribbonCloseArray||!1,t=x.closeShape||x.ribbonClosePath||!1,o=0===x.cap?0:x.cap||G.d.NO_CAP,c=x.updatable,s=x.firstNormal||null,J=x.adjustFrame||!1,p=G.d._GetDefaultSideOrientation(x.sideOrientation),U=x.instance,k=x.invertUV||!1,M=x.capFunction||null;return e(Z,f,u,null,null,Y,j,d,t,o,!0,F,!!c,p,U||null,k,x.frontUVs||null,x.backUVs||null,s,J,M||null)}function e(Z,x,F,f,Y,j,d,o,c,s,J,p,U,k,M,m,C,L,H,S,K){const y=(Z,x,F,f,Y,j,d,t,o,c,s)=>{const J=F.getTangents(),p=F.getNormals(),U=F.getBinormals(),k=F.getDistances();if(s)for(let G=0;G<J.length;G++)if(0==J[G].x&&0==J[G].y&&0==J[G].z&&J[G].G(J[G-1]),0==p[G].x&&0==p[G].y&&0==p[G].z&&p[G].G(p[G-1]),0==U[G].x&&0==U[G].y&&0==U[G].z&&U[G].G(U[G-1]),G>0){let Z=J[G-1];u.kx.Dot(Z,J[G])<0&&J[G].scaleInPlace(-1),Z=p[G-1],u.kx.Dot(Z,p[G])<0&&p[G].scaleInPlace(-1),Z=U[G-1],u.kx.Dot(Z,U[G])<0&&U[G].scaleInPlace(-1)}let M=0;const m=c&&t?t:()=>null!==j?j:0,C=c&&d?d:()=>null!==Y?Y:1;let L=o===G.d.NO_CAP||o===G.d.CAP_END?0:2;const H=u.TmpVectors.Matrix[0];for(let G=0;G<x.length;G++){const F=[],Y=m(G,k[G]),j=C(G,k[G]);u.Matrix.RotationAxisToRef(J[G],M,H);for(let f=0;f<Z.length;f++){const Y=J[G].scale(Z[f].z).add(p[G].scale(Z[f].x)).add(U[G].scale(Z[f].y)),d=u.kx.Zero();u.kx.TransformCoordinatesToRef(Y,H,d),d.scaleInPlace(j).addInPlace(x[G]),F[f]=d}f[L]=F,M+=Y,L++}const S=K||(Z=>{const x=Array(),F=u.kx.Zero();let G;for(G=0;G<Z.length;G++)F.addInPlace(Z[G]);for(F.scaleInPlace(1/Z.length),G=0;G<Z.length;G++)x.push(F);return x});switch(o){case G.d.NO_CAP:break;case G.d.CAP_START:f[0]=S(f[2]),f[1]=f[2];break;case G.d.CAP_END:f[L]=f[L-1],f[L+1]=S(f[L-1]);break;case G.d.CAP_ALL:f[0]=S(f[2]),f[1]=f[2],f[L]=f[L-1],f[L+1]=S(f[L-1])}return f};let q,R;if(M){const Z=M._creationDataStorage;return q=H?Z.path3D.update(F,H):Z.path3D.update(F),R=y(x,F,Z.path3D,Z.pathArray,f,Y,j,d,Z.cap,J,S),M=t("",{pathArray:R,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:M},p||void 0)}q=H?new v.g(F,H):new v.g(F);R=y(x,F,q,new Array,f,Y,j,d,s=s<0||s>3?0:s,J,S);const B=t(Z,{pathArray:R,closeArray:o,closePath:c,updatable:U,sideOrientation:k,invertUV:m,frontUVs:C||void 0,backUVs:L||void 0},p);return B._creationDataStorage.pathArray=R,B._creationDataStorage.path3D=q,B._creationDataStorage.cap=s,B}function b(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=x.arc?x.arc<=0||x.arc>1?1:x.arc:1,Y=void 0===x.closed||x.closed,j=x.shape,d=x.radius||1,o=x.tessellation||64,c=x.clip||0,s=x.updatable,J=G.d._GetDefaultSideOrientation(x.sideOrientation),p=x.cap||G.d.NO_CAP,U=2*Math.PI,k=[],M=x.invertUV||!1;let m=0,C=0;const L=U/o*f;let H,S;for(m=0;m<=o-c;m++){for(S=[],p!=G.d.CAP_START&&p!=G.d.CAP_ALL||(S.push(new u.kx(0,j[0].y,0)),S.push(new u.kx(Math.cos(m*L)*j[0].x*d,j[0].y,Math.sin(m*L)*j[0].x*d))),C=0;C<j.length;C++)H=new u.kx(Math.cos(m*L)*j[C].x*d,j[C].y,Math.sin(m*L)*j[C].x*d),S.push(H);p!=G.d.CAP_END&&p!=G.d.CAP_ALL||(S.push(new u.kx(Math.cos(m*L)*j[j.length-1].x*d,j[j.length-1].y,Math.sin(m*L)*j[j.length-1].x*d)),S.push(new u.kx(0,j[j.length-1].y,0))),k.push(S)}return t(Z,{pathArray:k,closeArray:Y,sideOrientation:J,updatable:s,invertUV:M,frontUVs:x.frontUVs,backUVs:x.backUVs},F)}G.d.ExtrudeShape=function(Z,x,F,u,f,Y){let j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,o=arguments.length>9?arguments[9]:void 0;return l(Z,{shape:x,path:F,scale:u,rotation:f,cap:0===Y?0:Y||G.d.NO_CAP,sideOrientation:t,instance:o,updatable:d},j)},G.d.ExtrudeShapeCustom=(Z,x,F,u,f,Y,j,d,t,o,c,s)=>i(Z,{shape:x,path:F,scaleFunction:u,rotationFunction:f,ribbonCloseArray:Y,ribbonClosePath:j,cap:0===d?0:d||G.d.NO_CAP,sideOrientation:c,instance:s,updatable:o},t);G.d.CreateLathe=(Z,x,F,u,G,f,Y)=>b(Z,{shape:x,radius:F,tessellation:u,sideOrientation:Y,updatable:f},G);var E=F(12511),w=F(12467);function T(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=x.path;let Y=x.instance,j=1;void 0!==x.radius?j=x.radius:Y&&(j=Y._creationDataStorage.radius);const d=x.tessellation||64,o=x.radiusFunction||null;let c=x.cap||G.d.NO_CAP;const s=x.invertUV||!1,J=x.updatable,p=G.d._GetDefaultSideOrientation(x.sideOrientation);x.arc=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1;const U=(Z,x,F,f,Y,j,d,t)=>{const o=x.getTangents(),c=x.getNormals(),s=x.getDistances(),J=2*Math.PI/Y*t,p=j||(()=>f);let U,k,M,m;const C=u.TmpVectors.Matrix[0];let L=d===G.d.NO_CAP||d===G.d.CAP_END?0:2;for(let G=0;G<Z.length;G++){k=p(G,s[G]),U=Array(),M=c[G];for(let x=0;x<Y;x++)u.Matrix.RotationAxisToRef(o[G],J*x,C),m=U[x]?U[x]:u.kx.Zero(),u.kx.TransformCoordinatesToRef(M,C,m),m.scaleInPlace(k).addInPlace(Z[G]),U[x]=m;F[L]=U,L++}const H=(x,F)=>{const u=Array();for(let G=0;G<x;G++)u.push(Z[F]);return u};switch(d){case G.d.NO_CAP:break;case G.d.CAP_START:F[0]=H(Y,0),F[1]=F[2].slice(0);break;case G.d.CAP_END:F[L]=F[L-1].slice(0),F[L+1]=H(Y,Z.length-1);break;case G.d.CAP_ALL:F[0]=H(Y,0),F[1]=F[2].slice(0),F[L]=F[L-1].slice(0),F[L+1]=H(Y,Z.length-1)}return F};let k,M;if(Y){const Z=Y._creationDataStorage,F=x.arc||Z.arc;return k=Z.path3D.update(f),M=U(f,k,Z.pathArray,j,Z.tessellation,o,Z.cap,F),Y=t("",{pathArray:M,instance:Y}),Z.path3D=k,Z.pathArray=M,Z.arc=F,Z.radius=j,Y}k=new v.g(f);c=c<0||c>3?0:c,M=U(f,k,new Array,j,d,o,c,x.arc);const m=t(Z,{pathArray:M,closePath:!0,closeArray:!1,updatable:J,sideOrientation:p,invertUV:s,frontUVs:x.frontUVs,backUVs:x.backUVs},F);return m._creationDataStorage.pathArray=M,m._creationDataStorage.path3D=k,m._creationDataStorage.tessellation=d,m._creationDataStorage.cap=c,m._creationDataStorage.arc=x.arc,m._creationDataStorage.radius=j,m}function N(Z){const x=[];x[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},x[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},x[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},x[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},x[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},x[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},x[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},x[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},x[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},x[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},x[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},x[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},x[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},x[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},x[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const F=Z.type&&(Z.type<0||Z.type>=x.length)?0:Z.type||0,G=Z.size,f=Z.sizeX||G||1,d=Z.sizeY||G||1,t=Z.sizeZ||G||1,o=Z.custom||x[F],c=o.face.length,J=Z.faceUV||new Array(c),p=Z.faceColors,U=void 0===Z.flat||Z.flat,k=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,M=[],m=[],C=[],L=[],H=[];let S=0,K=0;const y=[];let q,R,B,v,l,i,e=0,b=0;if(U)for(b=0;b<c;b++)p&&void 0===p[b]&&(p[b]=new s.kj(1,1,1,1)),J&&void 0===J[b]&&(J[b]=new u.Vector4(0,0,1,1));if(U)for(b=0;b<c;b++){const Z=o.face[b].length;for(B=2*Math.PI/Z,v=.5*Math.tan(B/2),l=.5,e=0;e<Z;e++)M.push(o.vertex[o.face[b][e]][0]*f,o.vertex[o.face[b][e]][1]*d,o.vertex[o.face[b][e]][2]*t),y.push(S),S++,q=J[b].x+(J[b].z-J[b].x)*(.5+v),R=J[b].y+(J[b].w-J[b].y)*(l-.5),L.push(q,j.e?1-R:R),i=v*Math.cos(B)-l*Math.sin(B),l=v*Math.sin(B)+l*Math.cos(B),v=i,p&&H.push(p[b].r,p[b].g,p[b].b,p[b].a);for(e=0;e<Z-2;e++)m.push(y[0+K],y[e+2+K],y[e+1+K]);K+=Z}else{for(e=0;e<o.vertex.length;e++)M.push(o.vertex[e][0]*f,o.vertex[e][1]*d,o.vertex[e][2]*t),L.push(0,j.e?1:0);for(b=0;b<c;b++)for(e=0;e<o.face[b].length-2;e++)m.push(o.face[b][0],o.face[b][e+2],o.face[b][e+1])}Y.c.ComputeNormals(M,m,C),Y.c._ComputeSides(k,M,m,C,L,Z.frontUVs,Z.backUVs);const E=new Y.c;return E.qZ=M,E.indices=m,E.RZ=C,E.vZ=L,p&&U&&(E.BZ=H),E}function W(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return N(x).iZ(u,x.updatable),u}G.d.CreateTube=(Z,x,F,u,G,f,Y,j,d,t)=>T(Z,{path:x,radius:F,tessellation:u,radiusFunction:G,arc:1,cap:f,updatable:j,sideOrientation:d,instance:t},Y);function A(Z){const x=Z.sideOrientation||Y.c.DEFAULTSIDE,F=Z.radius||1,G=void 0===Z.flat||Z.flat,f=0|(Z.subdivisions||4),d=Z.radiusX||F,t=Z.radiusY||F,o=Z.radiusZ||F,c=(1+Math.sqrt(5))/2,s=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1],J=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],U=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],M=[],m=[],C=[],L=[];let H=0;const S=new Array(3),K=new Array(3);let y;for(y=0;y<3;y++)S[y]=u.kx.Zero(),K[y]=u.Vector2.Zero();for(let Y=0;Y<20;Y++){for(y=0;y<3;y++){const Z=J[3*Y+y];S[y].Jj(s[3*p[Z]],s[3*p[Z]+1],s[3*p[Z]+2]),S[y].normalize(),K[y].Jj(.134765625*U[2*Z]+.05859375+-.0390625*k[Y],.2333984375*U[2*Z+1]+.025390625+.01953125*k[Y])}const Z=(Z,x,F,Y)=>{const c=u.kx.Lerp(S[0],S[2],x/f),s=u.kx.Lerp(S[1],S[2],x/f),J=f===x?S[2]:u.kx.Lerp(c,s,Z/(f-x));let p;if(J.normalize(),G){const Z=u.kx.Lerp(S[0],S[2],Y/f),x=u.kx.Lerp(S[1],S[2],Y/f);p=u.kx.Lerp(Z,x,F/(f-Y))}else p=new u.kx(J.x,J.y,J.z);p.x/=d,p.y/=t,p.z/=o,p.normalize();const U=u.Vector2.Lerp(K[0],K[2],x/f),k=u.Vector2.Lerp(K[1],K[2],x/f),y=f===x?K[2]:u.Vector2.Lerp(U,k,Z/(f-x));m.push(J.x*d,J.y*t,J.z*o),C.push(p.x,p.y,p.z),L.push(y.x,j.e?1-y.y:y.y),M.push(H),H++};for(let x=0;x<f;x++)for(let F=0;F+x<f;F++)Z(F,x,F+1/3,x+1/3),Z(F+1,x,F+1/3,x+1/3),Z(F,x+1,F+1/3,x+1/3),F+x+1<f&&(Z(F+1,x,F+2/3,x+2/3),Z(F+1,x+1,F+2/3,x+2/3),Z(F,x+1,F+2/3,x+2/3))}Y.c._ComputeSides(x,m,M,C,L,Z.frontUVs,Z.backUVs);const q=new Y.c;return q.indices=M,q.qZ=m,q.RZ=C,q.vZ=L,q}function h(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new G.d(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),u._originalBuilderSideOrientation=x.sideOrientation;return A(x).iZ(u,x.updatable),u}Y.c.CreatePolyhedron=N,G.d.CreatePolyhedron=(Z,x,F)=>W(Z,x,F);Y.c.CreateIcoSphere=A,G.d.CreateIcoSphere=(Z,x,F)=>h(Z,x,F);var X=F(11194);const D=new u.kx(1,0,0),Q=new u.kx(-1,0,0),g=new u.kx(0,1,0),O=new u.kx(0,-1,0),n=new u.kx(0,0,1),V=new u.kx(0,0,-1);class a{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.kx.Zero(),x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.kx.Up(),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.Vector2.Zero(),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=Z,this.normal=x,this.uv=F,this.vertexIdx=G,this.vertexIdxForBones=f,this.localPositionOverride=Y,this.localNormalOverride=j,this.matrixIndicesOverride=d,this.matrixWeightsOverride=t}clone(){var Z,x,F,u;return new a(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(Z=this.localPositionOverride)||void 0===Z?void 0:Z.slice(),null===(x=this.localNormalOverride)||void 0===x?void 0:x.slice(),null===(F=this.matrixIndicesOverride)||void 0===F?void 0:F.slice(),null===(u=this.matrixWeightsOverride)||void 0===u?void 0:u.slice())}}function I(Z,x,F){var d,t,o,c,s;const J=!!x.skeleton,p=!(null===(d=x.morphTargetManager)||void 0===d||!d.numTargets),U=F.localMode||J,k=x.cj(),M=J||p?x.vj(!0,!0):x.getVerticesData(f.f.PositionKind),m=J||p?x.getNormalsData(!0,!0):x.getVerticesData(f.f.NormalKind),C=U?J?x.getVerticesData(f.f.PositionKind):M:null,L=U?J?x.getVerticesData(f.f.NormalKind):m:null,H=x.getVerticesData(f.f.UVKind),S=J?x.getVerticesData(f.f.MatricesIndicesKind):null,K=J?x.getVerticesData(f.f.MatricesWeightsKind):null,y=J?x.getVerticesData(f.f.MatricesIndicesExtraKind):null,q=J?x.getVerticesData(f.f.MatricesWeightsExtraKind):null,R=F.position||u.kx.Zero();let B=F.normal||u.kx.Up();const v=F.size||u.kx.One(),l=F.angle||0;if(!B){const Z=new u.kx(0,0,1),F=x.KZ().activeCamera,G=u.kx.TransformCoordinates(Z,F.getWorldMatrix());B=F.globalPosition.Mx(G)}const i=-Math.atan2(B.z,B.x)-Math.PI/2,e=Math.sqrt(B.x*B.x+B.z*B.z),b=Math.atan2(B.y,e),E=new Y.c;E.indices=[],E.qZ=[],E.RZ=[],E.vZ=[],E.matricesIndices=J?[]:null,E.matricesWeights=J?[]:null,E.matricesIndicesExtra=y?[]:null,E.matricesWeightsExtra=q?[]:null;let w=0;const T=(Z,x)=>{const G=new a;if(!k||!M||!m)return G;const f=k[Z];if(G.vertexIdx=3*f,G.vertexIdxForBones=4*f,G.position=new u.kx(M[3*f],M[3*f+1],M[3*f+2]),u.kx.TransformCoordinatesToRef(G.position,x,G.position),G.normal=new u.kx(m[3*f],m[3*f+1],m[3*f+2]),u.kx.TransformNormalToRef(G.normal,x,G.normal),F.captureUVS&&H){const Z=H[2*f+1];G.uv=new u.Vector2(H[2*f],j.e?1-Z:Z)}return G},N=[0,0,0,0],W=(Z,x)=>{if(0===Z.length)return Z;const F=.5*Math.abs(u.kx.Dot(v,x)),G=(Z,x,F,u)=>{for(let G=0;G<u;++G)if(Z[F+G]===x)return F+G;return-1},f=(Z,f)=>{const Y=u.kx.GetClipFactor(Z.position,f.position,x,F);let j=N,d=N;if(S&&K){const x=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,F=Z.matrixIndicesOverride??S,u=Z.matrixWeightsOverride??K,t=f.matrixIndicesOverride?0:f.vertexIdxForBones,o=f.matrixIndicesOverride??S,c=f.matrixWeightsOverride??K;j=[0,0,0,0],d=[0,0,0,0];let s=0;for(let Z=0;Z<4;++Z)if(u[x+Z]>0){const f=G(o,F[x+Z],t,4);j[s]=F[x+Z],d[s]=(0,X.Lerp)(u[x+Z],f>=0?c[f]:0,Y),s++}for(let Z=0;Z<4&&s<4;++Z){const u=o[t+Z];-1===G(F,u,x,4)&&(j[s]=u,d[s]=(0,X.Lerp)(0,c[t+Z],Y),s++)}const J=d[0]+d[1]+d[2]+d[3];d[0]/=J,d[1]/=J,d[2]/=J,d[3]/=J}const t=Z.localPositionOverride?Z.localPositionOverride[0]:(null===C||void 0===C?void 0:C[Z.vertexIdx])??0,o=Z.localPositionOverride?Z.localPositionOverride[1]:(null===C||void 0===C?void 0:C[Z.vertexIdx+1])??0,c=Z.localPositionOverride?Z.localPositionOverride[2]:(null===C||void 0===C?void 0:C[Z.vertexIdx+2])??0,s=f.localPositionOverride?f.localPositionOverride[0]:(null===C||void 0===C?void 0:C[f.vertexIdx])??0,J=f.localPositionOverride?f.localPositionOverride[1]:(null===C||void 0===C?void 0:C[f.vertexIdx+1])??0,p=f.localPositionOverride?f.localPositionOverride[2]:(null===C||void 0===C?void 0:C[f.vertexIdx+2])??0,U=Z.localNormalOverride?Z.localNormalOverride[0]:(null===L||void 0===L?void 0:L[Z.vertexIdx])??0,k=Z.localNormalOverride?Z.localNormalOverride[1]:(null===L||void 0===L?void 0:L[Z.vertexIdx+1])??0,M=Z.localNormalOverride?Z.localNormalOverride[2]:(null===L||void 0===L?void 0:L[Z.vertexIdx+2])??0,m=U+((f.localNormalOverride?f.localNormalOverride[0]:(null===L||void 0===L?void 0:L[f.vertexIdx])??0)-U)*Y,H=k+((f.localNormalOverride?f.localNormalOverride[1]:(null===L||void 0===L?void 0:L[f.vertexIdx+1])??0)-k)*Y,y=M+((f.localNormalOverride?f.localNormalOverride[2]:(null===L||void 0===L?void 0:L[f.vertexIdx+2])??0)-M)*Y,q=Math.sqrt(m*m+H*H+y*y);return new a(u.kx.Lerp(Z.position,f.position,Y),u.kx.Lerp(Z.normal,f.normal,Y).normalize(),u.Vector2.Lerp(Z.uv,f.uv,Y),-1,-1,C?[t+(s-t)*Y,o+(J-o)*Y,c+(p-c)*Y]:null,L?[m/q,H/q,y/q]:null,j,d)};let Y=null;Z.length>3&&(Y=[]);for(let j=0;j<Z.length;j+=3){let G=0,d=null,t=null,o=null,c=null;const s=u.kx.Dot(Z[j].position,x)-F>0,J=u.kx.Dot(Z[j+1].position,x)-F>0,p=u.kx.Dot(Z[j+2].position,x)-F>0;switch(G=(s?1:0)+(J?1:0)+(p?1:0),G){case 0:Z.length>3?(Y.push(Z[j]),Y.push(Z[j+1]),Y.push(Z[j+2])):Y=Z;break;case 1:if(Y=Y??new Array,s&&(d=Z[j+1],t=Z[j+2],o=f(Z[j],d),c=f(Z[j],t)),J){d=Z[j],t=Z[j+2],o=f(Z[j+1],d),c=f(Z[j+1],t),Y.push(o),Y.push(t.clone()),Y.push(d.clone()),Y.push(t.clone()),Y.push(o.clone()),Y.push(c);break}p&&(d=Z[j],t=Z[j+1],o=f(Z[j+2],d),c=f(Z[j+2],t)),d&&t&&o&&c&&(Y.push(d.clone()),Y.push(t.clone()),Y.push(o),Y.push(c),Y.push(o.clone()),Y.push(t.clone()));break;case 2:Y=Y??new Array,s||(d=Z[j].clone(),t=f(d,Z[j+1]),o=f(d,Z[j+2]),Y.push(d),Y.push(t),Y.push(o)),J||(d=Z[j+1].clone(),t=f(d,Z[j+2]),o=f(d,Z[j]),Y.push(d),Y.push(t),Y.push(o)),p||(d=Z[j+2].clone(),t=f(d,Z[j]),o=f(d,Z[j+1]),Y.push(d),Y.push(t),Y.push(o))}}return Y},A=x instanceof G.d?x:null,h=null===A||void 0===A?void 0:A._thinInstanceDataStorage.matrixData,I=(null===A||void 0===A?void 0:A.mj)||1,r=u.TmpVectors.Matrix[0];r.G(u.Matrix.IdentityReadOnly);for(let G=0;G<I;++G){if(null!==A&&void 0!==A&&A.hasThinInstances&&h){const Z=16*G;r.setRowFromFloats(0,h[Z+0],h[Z+1],h[Z+2],h[Z+3]),r.setRowFromFloats(1,h[Z+4],h[Z+5],h[Z+6],h[Z+7]),r.setRowFromFloats(2,h[Z+8],h[Z+9],h[Z+10],h[Z+11]),r.setRowFromFloats(3,h[Z+12],h[Z+13],h[Z+14],h[Z+15])}const Z=u.Matrix.RotationYawPitchRoll(i,b,l).multiply(u.Matrix.Translation(R.x,R.y,R.z)),f=u.Matrix.Invert(Z),Y=x.getWorldMatrix(),d=r.multiply(Y).multiply(f),t=new Array(3);for(let x=0;x<k.length;x+=3){let Z=t;if(Z[0]=T(x,d),Z[1]=T(x+1,d),Z[2]=T(x+2,d),!(F.cullBackFaces&&-Z[0].normal.z<=0&&-Z[1].normal.z<=0&&-Z[2].normal.z<=0)&&(Z=W(Z,D),Z&&(Z=W(Z,Q),Z&&(Z=W(Z,g),Z&&(Z=W(Z,O),Z&&(Z=W(Z,n),Z&&(Z=W(Z,V),Z)))))))for(let x=0;x<Z.length;x++){const u=Z[x];if(E.indices.push(w),U?(u.localPositionOverride?(E.qZ[3*w]=u.localPositionOverride[0],E.qZ[3*w+1]=u.localPositionOverride[1],E.qZ[3*w+2]=u.localPositionOverride[2]):C&&(E.qZ[3*w]=C[u.vertexIdx],E.qZ[3*w+1]=C[u.vertexIdx+1],E.qZ[3*w+2]=C[u.vertexIdx+2]),u.localNormalOverride?(E.RZ[3*w]=u.localNormalOverride[0],E.RZ[3*w+1]=u.localNormalOverride[1],E.RZ[3*w+2]=u.localNormalOverride[2]):L&&(E.RZ[3*w]=L[u.vertexIdx],E.RZ[3*w+1]=L[u.vertexIdx+1],E.RZ[3*w+2]=L[u.vertexIdx+2])):(u.position.toArray(E.qZ,3*w),u.normal.toArray(E.RZ,3*w)),E.matricesIndices&&E.matricesWeights&&(u.matrixIndicesOverride?(E.matricesIndices[4*w]=u.matrixIndicesOverride[0],E.matricesIndices[4*w+1]=u.matrixIndicesOverride[1],E.matricesIndices[4*w+2]=u.matrixIndicesOverride[2],E.matricesIndices[4*w+3]=u.matrixIndicesOverride[3]):(S&&(E.matricesIndices[4*w]=S[u.vertexIdxForBones],E.matricesIndices[4*w+1]=S[u.vertexIdxForBones+1],E.matricesIndices[4*w+2]=S[u.vertexIdxForBones+2],E.matricesIndices[4*w+3]=S[u.vertexIdxForBones+3]),y&&E.matricesIndicesExtra&&(E.matricesIndicesExtra[4*w]=y[u.vertexIdxForBones],E.matricesIndicesExtra[4*w+1]=y[u.vertexIdxForBones+1],E.matricesIndicesExtra[4*w+2]=y[u.vertexIdxForBones+2],E.matricesIndicesExtra[4*w+3]=y[u.vertexIdxForBones+3])),u.matrixWeightsOverride?(E.matricesWeights[4*w]=u.matrixWeightsOverride[0],E.matricesWeights[4*w+1]=u.matrixWeightsOverride[1],E.matricesWeights[4*w+2]=u.matrixWeightsOverride[2],E.matricesWeights[4*w+3]=u.matrixWeightsOverride[3]):(K&&(E.matricesWeights[4*w]=K[u.vertexIdxForBones],E.matricesWeights[4*w+1]=K[u.vertexIdxForBones+1],E.matricesWeights[4*w+2]=K[u.vertexIdxForBones+2],E.matricesWeights[4*w+3]=K[u.vertexIdxForBones+3]),q&&E.matricesWeightsExtra&&(E.matricesWeightsExtra[4*w]=q[u.vertexIdxForBones],E.matricesWeightsExtra[4*w+1]=q[u.vertexIdxForBones+1],E.matricesWeightsExtra[4*w+2]=q[u.vertexIdxForBones+2],E.matricesWeightsExtra[4*w+3]=q[u.vertexIdxForBones+3]))),F.captureUVS)u.uv.toArray(E.vZ,2*w);else{E.vZ.push(.5+u.position.x/v.x);const Z=.5+u.position.y/v.y;E.vZ.push(j.e?1-Z:Z)}w++}}}0===E.indices.length&&(E.indices=null),0===E.qZ.length&&(E.qZ=null),0===E.RZ.length&&(E.RZ=null),0===E.vZ.length&&(E.vZ=null),0===(null===(t=E.matricesIndices)||void 0===t?void 0:t.length)&&(E.matricesIndices=null),0===(null===(o=E.matricesWeights)||void 0===o?void 0:o.length)&&(E.matricesWeights=null),0===(null===(c=E.matricesIndicesExtra)||void 0===c?void 0:c.length)&&(E.matricesIndicesExtra=null),0===(null===(s=E.matricesWeightsExtra)||void 0===s?void 0:s.length)&&(E.matricesWeightsExtra=null);const z=new G.d(Z,x.KZ());return E.iZ(z),U?(z.skeleton=x.skeleton,z.parent=x):(z.position=R.clone(),z.rotation=new u.kx(b,i,l)),z.Qf(!0),z.refreshBoundingInfo(!0,!0),z}function r(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const x=0|Math.max(Z.subdivisions?Z.subdivisions:2,1),F=0|Math.max(Z.tessellation?Z.tessellation:16,3),G=Math.max(Z.height?Z.height:1,0),f=Math.max(Z.radius?Z.radius:.25,0),d=0|Math.max(Z.capSubdivisions?Z.capSubdivisions:6,1),t=F,o=x,c=Math.max(Z.radiusTop?Z.radiusTop:f,0),s=Math.max(Z.radiusBottom?Z.radiusBottom:f,0),J=G-(c+s),p=2*Math.PI,U=Math.max(Z.topCapSubdivisions?Z.topCapSubdivisions:d,1),k=Math.max(Z.bottomCapSubdivisions?Z.bottomCapSubdivisions:d,1),M=Math.acos((s-c)/G);let m=[];const C=[],L=[],H=[];let S=0;const K=[],y=.5*J,q=.5*Math.PI;let R,B;const v=u.kx.Zero(),l=u.kx.Zero(),i=Math.cos(M),e=Math.sin(M),b=new u.Vector2(c*e,y+c*i).Mx(new u.Vector2(s*e,s*i-y)).length(),E=c*M+b+s*(q-M);let w=0;for(B=0;B<=U;B++){const Z=[],x=q-M*(B/U);w+=c*M/U;const F=Math.cos(x),u=Math.sin(x),G=F*c;for(R=0;R<=t;R++){const x=R/t,f=x*p+0,Y=Math.sin(f),d=Math.cos(f);l.x=G*Y,l.y=y+u*c,l.z=G*d,C.push(l.x,l.y,l.z),v.set(F*Y,u,F*d),L.push(v.x,v.y,v.z),H.push(x,j.e?w/E:1-w/E),Z.push(S),S++}K.push(Z)}const T=G-c-s+i*c-i*s,N=e*(s-c)/T;for(B=1;B<=o;B++){const Z=[];w+=b/o;const x=e*(B*(s-c)/o+c);for(R=0;R<=t;R++){const F=R/t,u=F*p+0,G=Math.sin(u),f=Math.cos(u);l.x=x*G,l.y=y+i*c-B*T/o,l.z=x*f,C.push(l.x,l.y,l.z),v.set(G,N,f).normalize(),L.push(v.x,v.y,v.z),H.push(F,j.e?w/E:1-w/E),Z.push(S),S++}K.push(Z)}for(B=1;B<=k;B++){const Z=[],x=q-M-(Math.PI-M)*(B/k);w+=s*M/k;const F=Math.cos(x),u=Math.sin(x),G=F*s;for(R=0;R<=t;R++){const x=R/t,f=x*p+0,Y=Math.sin(f),d=Math.cos(f);l.x=G*Y,l.y=u*s-y,l.z=G*d,C.push(l.x,l.y,l.z),v.set(F*Y,u,F*d),L.push(v.x,v.y,v.z),H.push(x,j.e?w/E:1-w/E),Z.push(S),S++}K.push(Z)}for(R=0;R<t;R++)for(B=0;B<U+o+k;B++){const Z=K[B][R],x=K[B+1][R],F=K[B+1][R+1],u=K[B][R+1];m.push(Z),m.push(x),m.push(u),m.push(x),m.push(F),m.push(u)}if(m=m.reverse(),Z.orientation&&!Z.orientation.equals(u.kx.Up())){const x=new u.Matrix;Z.orientation.clone().scale(.5*Math.PI).cross(u.kx.Up()).toQuaternion().toRotationMatrix(x);const F=u.kx.Zero();for(let Z=0;Z<C.length;Z+=3)F.set(C[Z],C[Z+1],C[Z+2]),u.kx.TransformCoordinatesToRef(F.clone(),x,F),C[Z]=F.x,C[Z+1]=F.y,C[Z+2]=F.z}const W=new Y.c;return W.qZ=C,W.RZ=L,W.vZ=H,W.indices=m,W}function z(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:u.kx.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=new G.d(Z,F);return r(x).iZ(f,x.updatable),f}G.d.CreateDecal=(Z,x,F,u,G,f)=>I(Z,x,{position:F,normal:u,size:G,angle:f});G.d.CreateCapsule=(Z,x,F)=>z(Z,x,F),Y.c.CreateCapsule=r;var P=F(11012),ZZ=F(11188);class xZ{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=Z,this.y=x,Z!==Math.floor(Z)&&(Z=Math.floor(Z),P.d.Warn("x is not an integer, floor(x) used")),x!==Math.floor(x)&&(x=Math.floor(x),P.d.Warn("y is not an integer, floor(y) used"))}clone(){return new xZ(this.x,this.y)}rotate60About(Z){const x=this.x;return this.x=Z.x+Z.y-this.y,this.y=x+this.y-Z.x,this}rotateNeg60About(Z){const x=this.x;return this.x=x+this.y-Z.y,this.y=Z.x+Z.y-x,this}rotate120(Z,x){Z!==Math.floor(Z)&&(Z=Math.floor(Z),P.d.Warn("m not an integer only floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),P.d.Warn("n not an integer only floor(n) used"));const F=this.x;return this.x=Z-F-this.y,this.y=x+F,this}rotateNeg120(Z,x){Z!==Math.floor(Z)&&(Z=Math.floor(Z),P.d.Warn("m is not an integer, floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),P.d.Warn("n is not an integer,   floor(n) used"));const F=this.x;return this.x=this.y-x,this.y=Z+x-F-this.y,this}toCartesianOrigin(Z,x){const F=u.kx.Zero();return F.x=Z.x+2*this.x*x+this.y*x,F.y=Z.y+Math.sqrt(3)*this.y*x,F}static Zero(){return new xZ(0,0)}}class FZ{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new uZ("icosahedron","Regular",[[0,ZZ.h,-1],[-ZZ.h,1,0],[-1,0,-ZZ.h],[1,0,-ZZ.h],[ZZ.h,1,0],[0,ZZ.h,1],[-1,0,ZZ.h],[-ZZ.h,-1,0],[0,-ZZ.h,-1],[ZZ.h,-1,0],[1,0,ZZ.h],[0,-ZZ.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let Z=12;const x={},F=this.m,u=this.n;let G,f,Y,j,d,t=F,o=1,c=0;0!==u&&(t=(0,X.HighestCommonFactor)(F,u)),o=F/t,c=u/t;const s=xZ.Zero(),J=new xZ(F,u),p=new xZ(-u,F+u),U=xZ.Zero(),k=xZ.Zero(),M=xZ.Zero();let m,C,L,H,S=[];const K=[],y=this.vertByDist,q=(F,u,G,f)=>{m=F+"|"+G,C=u+"|"+f,m in x||C in x?m in x&&!(C in x)?x[C]=x[m]:C in x&&!(m in x)&&(x[m]=x[C]):(x[m]=Z,x[C]=Z,Z++),y[G][0]>2?K[x[m]]=[-y[G][0],y[G][1],x[m]]:K[x[m]]=[S[y[G][0]],y[G][1],x[m]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let R=0;R<20;R++){if(S=this.IDATA.face[R],Y=S[2],j=S[1],d=S[0],L=s.x+"|"+s.y,m=R+"|"+L,m in x||(x[m]=Y,K[Y]=[S[y[L][0]],y[L][1]]),L=J.x+"|"+J.y,m=R+"|"+L,m in x||(x[m]=j,K[j]=[S[y[L][0]],y[L][1]]),L=p.x+"|"+p.y,m=R+"|"+L,m in x||(x[m]=d,K[d]=[S[y[L][0]],y[L][1]]),G=this.IDATA.edgematch[R][0],f=this.IDATA.edgematch[R][1],"B"===f)for(let Z=1;Z<t;Z++)k.x=F-Z*(o+c),k.y=u+Z*o,M.x=-Z*c,M.y=Z*(o+c),L=k.x+"|"+k.y,H=M.x+"|"+M.y,q(R,G,L,H);if("O"===f)for(let Z=1;Z<t;Z++)M.x=-Z*c,M.y=Z*(o+c),U.x=Z*o,U.y=Z*c,L=M.x+"|"+M.y,H=U.x+"|"+U.y,q(R,G,L,H);if(G=this.IDATA.edgematch[R][2],f=this.IDATA.edgematch[R][3],f&&"A"===f)for(let Z=1;Z<t;Z++)U.x=Z*o,U.y=Z*c,k.x=F-(t-Z)*(o+c),k.y=u+(t-Z)*o,L=U.x+"|"+U.y,H=k.x+"|"+k.y,q(R,G,L,H);for(let F=0;F<this.vertices.length;F++)L=this.vertices[F].x+"|"+this.vertices[F].y,m=R+"|"+L,m in x||(x[m]=Z++,y[L][0]>2?K[x[m]]=[-y[L][0],y[L][1],x[m]]:K[x[m]]=[S[y[L][0]],y[L][1],x[m]])}this.closestTo=K,this.vecToidx=x}calcCoeffs(){const Z=this.m,x=this.n,F=Math.sqrt(3)/3,u=Z*Z+x*x+Z*x;this.coau=(Z+x)/u,this.cobu=-x/u,this.coav=-F*(Z-x)/u,this.cobv=F*(2*Z+x)/u}createInnerFacets(){const Z=this.m,x=this.n;for(let F=0;F<x+Z+1;F++)for(let Z=this.min[F];Z<this.max[F]+1;Z++)Z<this.max[F]&&Z<this.max[F+1]+1&&this.innerFacets.push(["|"+Z+"|"+F,"|"+Z+"|"+(F+1),"|"+(Z+1)+"|"+F]),F>0&&Z<this.max[F-1]&&Z+1<this.max[F]+1&&this.innerFacets.push(["|"+Z+"|"+F,"|"+(Z+1)+"|"+F,"|"+(Z+1)+"|"+(F-1)])}edgeVecsABOB(){const Z=this.m,x=this.n,F=new xZ(-x,Z+x);for(let u=1;u<Z+x;u++){const Z=new xZ(this.min[u],u),x=new xZ(this.min[u-1],u-1),G=new xZ(this.min[u+1],u+1),f=Z.clone(),Y=x.clone(),j=G.clone();f.rotate60About(F),Y.rotate60About(F),j.rotate60About(F);const d=new xZ(this.max[f.y],f.y),t=new xZ(this.max[f.y-1],f.y-1),o=new xZ(this.max[f.y-1]-1,f.y-1);f.x===d.x&&f.y===d.y||(f.x!==t.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,t,o]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,o,d])):f.y===j.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,x,t]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([Z,t,G])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([Z,x,t]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([Z,t,d])))}}mapABOBtoOBOA(){const Z=new xZ(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const F=[];for(let u=0;u<3;u++)Z.x=this.isoVecsABOB[x][u].x,Z.y=this.isoVecsABOB[x][u].y,0===this.vertexTypes[x][u]&&Z.rotateNeg120(this.m,this.n),F.push(Z.clone());this.isoVecsOBOA.push(F)}}mapABOBtoBAOA(){const Z=new xZ(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const F=[];for(let u=0;u<3;u++)Z.x=this.isoVecsABOB[x][u].x,Z.y=this.isoVecsABOB[x][u].y,1===this.vertexTypes[x][u]&&Z.rotate120(this.m,this.n),F.push(Z.clone());this.isoVecsBAOA.push(F)}}MapToFace(Z,x){const F=this.IDATA.face[Z],G=F[2],f=F[1],Y=F[0],j=u.kx.Hx(this.IDATA.vertex[G]),d=u.kx.Hx(this.IDATA.vertex[f]),t=u.kx.Hx(this.IDATA.vertex[Y]),o=d.Mx(j),c=t.Mx(j),s=o.scale(this.coau).add(c.scale(this.cobu)),J=o.scale(this.coav).add(c.scale(this.cobv)),p=[];let U,k=u.TmpVectors.kx[0];for(let u=0;u<this.cartesian.length;u++)k=s.scale(this.cartesian[u].x).add(J.scale(this.cartesian[u].y)).add(j),p[u]=[k.x,k.y,k.z],U=Z+"|"+this.vertices[u].x+"|"+this.vertices[u].y,x.vertex[this.vecToidx[U]]=[k.x,k.y,k.z]}build(Z,x){const F=[],u=xZ.Zero(),G=new xZ(Z,x),f=new xZ(-x,Z+x);F.push(u,G,f);for(let L=x;L<Z+1;L++)for(let x=0;x<Z+1-L;x++)F.push(new xZ(x,L));if(x>0){const u=(0,X.HighestCommonFactor)(Z,x),G=Z/u,f=x/u;for(let j=1;j<u;j++)F.push(new xZ(j*G,j*f)),F.push(new xZ(-j*f,j*(G+f))),F.push(new xZ(Z-j*(G+f),x+j*G));const Y=Z/x;for(let j=1;j<x;j++)for(let u=0;u<j*Y;u++)F.push(new xZ(u,j)),F.push(new xZ(u,j).rotate120(Z,x)),F.push(new xZ(u,j).rotateNeg120(Z,x))}F.sort(((Z,x)=>Z.x-x.x)),F.sort(((Z,x)=>Z.y-x.y));const Y=new Array(Z+x+1),j=new Array(Z+x+1);for(let L=0;L<Y.length;L++)Y[L]=1/0,j[L]=-1/0;let d=0,t=0;const o=F.length;for(let L=0;L<o;L++)t=F[L].x,d=F[L].y,Y[d]=Math.min(t,Y[d]),j[d]=Math.max(t,j[d]);const c=(F,u)=>{const G=F.clone();return"A"===u&&G.rotateNeg120(Z,x),"B"===u&&G.rotate120(Z,x),G.x<0?G.y:G.x+G.y},s=[],J=[],p=[],U=[],k={},M=[];let m=-1,C=-1;for(let L=0;L<o;L++)s[L]=F[L].toCartesianOrigin(new xZ(0,0),.5),J[L]=c(F[L],"O"),p[L]=c(F[L],"A"),U[L]=c(F[L],"B"),J[L]===p[L]&&p[L]===U[L]?(m=3,C=J[L]):J[L]===p[L]?(m=4,C=J[L]):p[L]===U[L]?(m=5,C=p[L]):U[L]===J[L]&&(m=6,C=J[L]),J[L]<p[L]&&J[L]<U[L]&&(m=2,C=J[L]),p[L]<J[L]&&p[L]<U[L]&&(m=1,C=p[L]),U[L]<p[L]&&U[L]<J[L]&&(m=0,C=U[L]),M.push([m,C,F[L].x,F[L].y]);M.sort(((Z,x)=>Z[2]-x[2])),M.sort(((Z,x)=>Z[3]-x[3])),M.sort(((Z,x)=>Z[1]-x[1])),M.sort(((Z,x)=>Z[0]-x[0]));for(let L=0;L<M.length;L++)k[M[L][2]+"|"+M[L][3]]=[M[L][0],M[L][1],L];return this.m=Z,this.n=x,this.vertices=F,this.vertByDist=k,this.cartesian=s,this.min=Y,this.max=j,this}}class uZ{constructor(Z,x,F,u){this.name=Z,this.category=x,this.vertex=F,this.face=u}}class GZ extends uZ{innerToData(Z,x){for(let F=0;F<x.innerFacets.length;F++)this.face.push(x.innerFacets[F].map((F=>x.vecToidx[Z+F])))}mapABOBtoDATA(Z,x){const F=x.IDATA.edgematch[Z][0];for(let u=0;u<x.isoVecsABOB.length;u++){const G=[];for(let f=0;f<3;f++)0===x.vertexTypes[u][f]?G.push(Z+"|"+x.isoVecsABOB[u][f].x+"|"+x.isoVecsABOB[u][f].y):G.push(F+"|"+x.isoVecsABOB[u][f].x+"|"+x.isoVecsABOB[u][f].y);this.face.push([x.vecToidx[G[0]],x.vecToidx[G[1]],x.vecToidx[G[2]]])}}mapOBOAtoDATA(Z,x){const F=x.IDATA.edgematch[Z][0];for(let u=0;u<x.isoVecsOBOA.length;u++){const G=[];for(let f=0;f<3;f++)1===x.vertexTypes[u][f]?G.push(Z+"|"+x.isoVecsOBOA[u][f].x+"|"+x.isoVecsOBOA[u][f].y):G.push(F+"|"+x.isoVecsOBOA[u][f].x+"|"+x.isoVecsOBOA[u][f].y);this.face.push([x.vecToidx[G[0]],x.vecToidx[G[1]],x.vecToidx[G[2]]])}}mapBAOAtoDATA(Z,x){const F=x.IDATA.edgematch[Z][2];for(let u=0;u<x.isoVecsBAOA.length;u++){const G=[];for(let f=0;f<3;f++)1===x.vertexTypes[u][f]?G.push(Z+"|"+x.isoVecsBAOA[u][f].x+"|"+x.isoVecsBAOA[u][f].y):G.push(F+"|"+x.isoVecsBAOA[u][f].x+"|"+x.isoVecsBAOA[u][f].y);this.face.push([x.vecToidx[G[0]],x.vecToidx[G[1]],x.vecToidx[G[2]]])}}orderData(Z){const x=[];for(let f=0;f<13;f++)x[f]=[];const F=Z.closestTo;for(let f=0;f<F.length;f++)F[f][0]>-1?F[f][1]>0&&x[F[f][0]].push([f,F[f][1]]):x[12].push([f,F[f][0]]);const u=[];for(let f=0;f<12;f++)u[f]=f;let G=12;for(let f=0;f<12;f++){x[f].sort(((Z,x)=>Z[1]-x[1]));for(let Z=0;Z<x[f].length;Z++)u[x[f][Z][0]]=G++}for(let f=0;f<x[12].length;f++)u[x[12][f][0]]=G++;for(let f=0;f<this.vertex.length;f++)this.vertex[f].push(u[f]);this.vertex.sort(((Z,x)=>Z[3]-x[3]));for(let f=0;f<this.vertex.length;f++)this.vertex[f].pop();for(let f=0;f<this.face.length;f++)for(let Z=0;Z<this.face[f].length;Z++)this.face[f][Z]=u[this.face[f][Z]];this.sharedNodes=x[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(Z,x){const F=[],u=[];let G=x.pop();u.push(G);let f=this.face[G].indexOf(Z);f=(f+2)%3;let Y=this.face[G][f];F.push(Y);let j=0;for(;x.length>0;)G=x[j],this.face[G].indexOf(Y)>-1?(f=(this.face[G].indexOf(Y)+1)%3,Y=this.face[G][f],F.push(Y),u.push(G),x.splice(j,1),j=0):j++;return this.adjacentFaces.push(F),u}toGoldbergPolyhedronData(){const Z=new uZ("GeoDual","Goldberg",[],[]);Z.name="GD dual";const x=this.vertex.length,F=new Array(x);for(let d=0;d<x;d++)F[d]=[];for(let d=0;d<this.face.length;d++)for(let Z=0;Z<3;Z++)F[this.face[d][Z]].push(d);let u=0,G=0,f=0,Y=[],j=[];this.adjacentFaces=[];for(let d=0;d<F.length;d++){Z.face[d]=this.setOrder(d,F[d].concat([]));for(const x of F[d]){u=0,G=0,f=0,Y=this.face[x];for(let Z=0;Z<3;Z++)j=this.vertex[Y[Z]],u+=j[0],G+=j[1],f+=j[2];Z.vertex[x]=[u/3,G/3,f/3]}}return Z}static BuildGeodesicData(Z){const x=new GZ("Geodesic-m-n","Geodesic",[[0,ZZ.h,-1],[-ZZ.h,1,0],[-1,0,-ZZ.h],[1,0,-ZZ.h],[ZZ.h,1,0],[0,ZZ.h,1],[-1,0,ZZ.h],[-ZZ.h,-1,0],[0,-ZZ.h,-1],[ZZ.h,-1,0],[1,0,ZZ.h],[0,-ZZ.h,1]],[]);Z.setIndices(),Z.calcCoeffs(),Z.createInnerFacets(),Z.edgeVecsABOB(),Z.mapABOBtoOBOA(),Z.mapABOBtoBAOA();for(let F=0;F<Z.IDATA.face.length;F++)Z.MapToFace(F,x),x.innerToData(F,Z),"B"===Z.IDATA.edgematch[F][1]&&x.mapABOBtoDATA(F,Z),"O"===Z.IDATA.edgematch[F][1]&&x.mapOBOAtoDATA(F,Z),"A"===Z.IDATA.edgematch[F][3]&&x.mapBAOAtoDATA(F,Z);x.orderData(Z);return x.vertex=x.vertex.map((function(Z){const x=Z[0],F=Z[1],u=Z[2],G=Math.sqrt(x*x+F*F+u*u);return Z[0]*=1/G,Z[1]*=1/G,Z[2]*=1/G,Z})),x}}G.d._GoldbergMeshParser=(Z,x)=>fZ.Parse(Z,x);class fZ extends G.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(Z,x){return void 0===x?(Z>this.goldbergData.nbUnsharedFaces-1&&(P.d.Warn("Maximum number of unshared faces used"),Z=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+Z):(Z>11&&(P.d.Warn("Last pole used"),Z=11),x>this.goldbergData.nbFacesAtPole-1&&(P.d.Warn("Maximum number of faces at a pole used"),x=this.goldbergData.nbFacesAtPole-1),12+Z*this.goldbergData.nbFacesAtPole+x)}_changeGoldbergFaceColors(Z){for(let F=0;F<Z.length;F++){const x=Z[F][0],u=Z[F][1],G=Z[F][2];for(let Z=x;Z<u+1;Z++)this.goldbergData.faceColors[Z]=G}const x=[];for(let F=0;F<12;F++)for(let Z=0;Z<5;Z++)x.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);for(let F=12;F<this.goldbergData.faceColors.length;F++)for(let Z=0;Z<6;Z++)x.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);return x}setGoldbergFaceColors(Z){const x=this._changeGoldbergFaceColors(Z);this.wZ(f.f.ColorKind,x)}updateGoldbergFaceColors(Z){const x=this._changeGoldbergFaceColors(Z);this.updateVerticesData(f.f.ColorKind,x)}_changeGoldbergFaceUVs(Z){const x=this.getVerticesData(f.f.UVKind);for(let F=0;F<Z.length;F++){const u=Z[F][0],G=Z[F][1],f=Z[F][2],Y=Z[F][3],j=Z[F][4],d=[],t=[];let o,c;for(let Z=0;Z<5;Z++)o=f.x+Y*Math.cos(j+Z*Math.PI/2.5),c=f.y+Y*Math.sin(j+Z*Math.PI/2.5),o<0&&(o=0),o>1&&(o=1),d.push(o,c);for(let Z=0;Z<6;Z++)o=f.x+Y*Math.cos(j+Z*Math.PI/3),c=f.y+Y*Math.sin(j+Z*Math.PI/3),o<0&&(o=0),o>1&&(o=1),t.push(o,c);for(let Z=u;Z<Math.min(12,G+1);Z++)for(let F=0;F<5;F++)x[10*Z+2*F]=d[2*F],x[10*Z+2*F+1]=d[2*F+1];for(let Z=Math.max(12,u);Z<G+1;Z++)for(let F=0;F<6;F++)x[12*Z-24+2*F]=t[2*F],x[12*Z-23+2*F]=t[2*F+1]}return x}setGoldbergFaceUVs(Z){const x=this._changeGoldbergFaceUVs(Z);this.wZ(f.f.UVKind,x)}updateGoldbergFaceUVs(Z){const x=this._changeGoldbergFaceUVs(Z);this.updateVerticesData(f.f.UVKind,x)}placeOnGoldbergFaceAt(Z,x,F){const G=u.kx.RotationFromAxis(this.goldbergData.faceXaxis[x],this.goldbergData.faceYaxis[x],this.goldbergData.faceZaxis[x]);Z.rotation=G,Z.position=this.goldbergData.faceCenters[x].add(this.goldbergData.faceXaxis[x].scale(F.x)).add(this.goldbergData.faceYaxis[x].scale(F.y)).add(this.goldbergData.faceZaxis[x].scale(F.z))}serialize(Z){super.serialize(Z),Z.type="GoldbergMesh";const x={};if(x.adjacentFaces=this.goldbergData.adjacentFaces,x.nbSharedFaces=this.goldbergData.nbSharedFaces,x.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,x.nbFaces=this.goldbergData.nbFaces,x.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){x.faceColors=[];for(const Z of this.goldbergData.faceColors)x.faceColors.push(Z.Wf())}if(this.goldbergData.faceCenters){x.faceCenters=[];for(const Z of this.goldbergData.faceCenters)x.faceCenters.push(Z.Wf())}if(this.goldbergData.faceZaxis){x.faceZaxis=[];for(const Z of this.goldbergData.faceZaxis)x.faceZaxis.push(Z.Wf())}if(this.goldbergData.faceYaxis){x.faceYaxis=[];for(const Z of this.goldbergData.faceYaxis)x.faceYaxis.push(Z.Wf())}if(this.goldbergData.faceXaxis){x.faceXaxis=[];for(const Z of this.goldbergData.faceXaxis)x.faceXaxis.push(Z.Wf())}Z.goldbergData=x}static Parse(Z,x){const F=Z.goldbergData;F.faceColors=F.faceColors.map((Z=>s.kj.Hx(Z))),F.faceCenters=F.faceCenters.map((Z=>u.kx.Hx(Z))),F.faceZaxis=F.faceZaxis.map((Z=>u.kx.Hx(Z))),F.faceXaxis=F.faceXaxis.map((Z=>u.kx.Hx(Z))),F.faceYaxis=F.faceYaxis.map((Z=>u.kx.Hx(Z)));const G=new fZ(Z.name,x);return G.goldbergData=F,G}}var YZ=F(11774);const jZ={CreateBox:c.e,CreateTiledBox:k,CreateSphere:M.c,CreateDisc:o.d,CreateIcoSphere:h,CreateRibbon:t,CreateCylinder:H,CreateTorus:K,CreateTorusKnot:q,CreateLineSystem:R.f,yt:R.g,CreateDashedLines:R.c,ExtrudeShape:l,ExtrudeShapeCustom:i,CreateLathe:b,CreateTiledPlane:p,Rt:E.c,CreateGround:w.i,CreateTiledGround:w.m,CreateGroundFromHeightMap:w.e,CreatePolygon:B.b,ExtrudePolygon:B.d,CreateTube:T,CreatePolyhedron:W,CreateGeodesic:function(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=x.m||1;u!==Math.floor(u)&&(u=Math.floor(u),P.d.Warn("m not an integer only floor(m) used"));let G=x.n||0;if(G!==Math.floor(G)&&(G=Math.floor(G),P.d.Warn("n not an integer only floor(n) used")),G>u){const Z=G;G=u,u=Z,P.d.Warn("n > m therefore m and n swapped")}const f=new FZ;return f.build(u,G),W(Z,{custom:GZ.BuildGeodesicData(f),size:x.size,sizeX:x.sizeX,sizeY:x.sizeY,sizeZ:x.sizeZ,faceUV:x.faceUV,faceColors:x.faceColors,flat:x.flat,updatable:x.updatable,sideOrientation:x.sideOrientation,frontUVs:x.frontUVs,backUVs:x.backUVs},F)},CreateGoldberg:function(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const f=x.size,d=x.sizeX||f||1,t=x.sizeY||f||1,o=x.sizeZ||f||1;let c=x.m||1;c!==Math.floor(c)&&(c=Math.floor(c),P.d.Warn("m not an integer only floor(m) used"));let J=x.n||0;if(J!==Math.floor(J)&&(J=Math.floor(J),P.d.Warn("n not an integer only floor(n) used")),J>c){const Z=J;J=c,c=Z,P.d.Warn("n > m therefore m and n swapped")}const p=new FZ;p.build(c,J);const U=GZ.BuildGeodesicData(p),k=U.toGoldbergPolyhedronData(),M=new fZ(Z,F);x.sideOrientation=G.d._GetDefaultSideOrientation(x.sideOrientation),M._originalBuilderSideOrientation=x.sideOrientation;(function(Z,x){const F=Z.size,G=Z.sizeX||F||1,f=Z.sizeY||F||1,d=Z.sizeZ||F||1,t=0===Z.sideOrientation?0:Z.sideOrientation||Y.c.DEFAULTSIDE,o=[],c=[],s=[],J=[];let p=1/0,U=-1/0,k=1/0,M=-1/0;for(let u=0;u<x.vertex.length;u++)p=Math.min(p,x.vertex[u][0]*G),U=Math.max(U,x.vertex[u][0]*G),k=Math.min(k,x.vertex[u][1]*f),M=Math.max(M,x.vertex[u][1]*f);let m=0;for(let Y=0;Y<x.face.length;Y++){const Z=x.face[Y],F=u.kx.Hx(x.vertex[Z[0]]),t=u.kx.Hx(x.vertex[Z[2]]),C=u.kx.Hx(x.vertex[Z[1]]),L=t.Mx(F),H=C.Mx(F),S=u.kx.Cross(H,L).normalize();for(let u=0;u<Z.length;u++){s.push(S.x,S.y,S.z);const F=x.vertex[Z[u]];o.push(F[0]*G,F[1]*f,F[2]*d);const Y=(F[1]*f-k)/(M-k);J.push((F[0]*G-p)/(U-p),j.e?1-Y:Y)}for(let x=0;x<Z.length-2;x++)c.push(m,m+x+2,m+x+1);m+=Z.length}Y.c._ComputeSides(t,o,c,s,J);const C=new Y.c;return C.qZ=o,C.indices=c,C.RZ=s,C.vZ=J,C})(x,k).iZ(M,x.updatable),M.goldbergData.nbSharedFaces=U.sharedNodes,M.goldbergData.nbUnsharedFaces=U.poleNodes,M.goldbergData.adjacentFaces=U.adjacentFaces,M.goldbergData.nbFaces=M.goldbergData.nbSharedFaces+M.goldbergData.nbUnsharedFaces,M.goldbergData.nbFacesAtPole=(M.goldbergData.nbUnsharedFaces-12)/12;for(let G=0;G<U.vertex.length;G++)M.goldbergData.faceCenters.push(u.kx.Hx(U.vertex[G])),M.goldbergData.faceCenters[G].x*=d,M.goldbergData.faceCenters[G].y*=t,M.goldbergData.faceCenters[G].z*=o,M.goldbergData.faceColors.push(new s.kj(1,1,1,1));for(let G=0;G<k.face.length;G++){const Z=k.face[G],x=u.kx.Hx(k.vertex[Z[0]]),F=u.kx.Hx(k.vertex[Z[2]]),f=u.kx.Hx(k.vertex[Z[1]]),Y=F.Mx(x),j=f.Mx(x),d=u.kx.Cross(j,Y).normalize(),t=u.kx.Cross(j,d).normalize();M.goldbergData.faceXaxis.push(j.normalize()),M.goldbergData.faceYaxis.push(d),M.goldbergData.faceZaxis.push(t)}return M},CreateDecal:I,CreateCapsule:z,CreateText:YZ.i}},12529:(Z,x,F)=>{"use strict";F.d(x,{c:()=>jx});var u=F(11179),G=F(11592);class f extends G.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=F(11230),j=(F(11369),F(11136));class d{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this._targetStopDuration!==Z&&(this._targetStopDuration=Z)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){this._noiseTexture!==Z&&(this._noiseTexture=Z,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(Z){this._isAnimationSheetEnabled!=Z&&(this._isAnimationSheetEnabled=Z,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(Z){this._useLogarithmicDepth=Z&&this.KZ().getEngine().getCaps().fragmentDepthSupported}KZ(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(Z){switch(Z){case d.BLENDMODE_MULTIPLYADD:return;case d.BLENDMODE_ADD:Z=1;break;case d.BLENDMODE_ONEONE:Z=6;break;case d.BLENDMODE_STANDARD:Z=2;break;case d.BLENDMODE_MULTIPLY:Z=4;break;case d.BLENDMODE_SUBTRACT:Z=3}this._engine.setAlphaMode(Z)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:u.kx.Zero()}set direction1(Z){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=Z)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:u.kx.Zero()}set direction2(Z){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=Z)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:u.kx.Zero()}set minEmitBox(Z){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=Z)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:u.kx.Zero()}set maxEmitBox(Z){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=Z)}get billboardMode(){return this._billboardMode}set billboardMode(Z){this._billboardMode!==Z&&(this._billboardMode=Z,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(Z){this._isBillboardBased!==Z&&(this._isBillboardBased=Z,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(Z){this._attachImageProcessingConfiguration(Z)}_attachImageProcessingConfiguration(Z){Z!==this._imageProcessingConfiguration&&(!Z&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=Z)}_reset(){}_removeGradientAndTexture(Z,x,F){if(!x)return this;let u=0;for(const G of x){if(G.gradient===Z){x.splice(u,1);break}u++}return F&&F.dispose(),this}constructor(Z){this.animations=[],this.renderingGroupId=0,this.i=u.kx.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new u.kx(10,10,10),this.onAnimationEnd=null,this.blendMode=d.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new u.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Ht=new u.kx(0,0,0),this._useLogarithmicDepth=!1,this.gravity=u.kx.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.kj(1,1,1,1),this.color2=new Y.kj(1,1,1,1),this.colorDead=new Y.kj(0,0,0,1),this.textureMask=new Y.kj(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new f,this.id=Z,this.name=Z}createPointEmitter(Z,x){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new u.kx(0,1,0),arguments.length>2&&void 0!==arguments[2]||new u.kx(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new u.kx(0,1,0),arguments.length>4&&void 0!==arguments[4]||new u.kx(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new u.kx(0,1,0),arguments.length>3&&void 0!==arguments[3]||new u.kx(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(Z,x,F,u){throw new Error("Method not implemented.")}}d.BLENDMODE_ONEONE=0,d.BLENDMODE_STANDARD=1,d.BLENDMODE_ADD=2,d.BLENDMODE_MULTIPLY=3,d.BLENDMODE_MULTIPLYADD=4,d.BLENDMODE_SUBTRACT=-1,(0,j.g)("BABYLON.BaseParticleSystem",d);var t=F(11194),o=F(11018);class c{constructor(){this.direction1=new u.kx(0,1,0),this.direction2=new u.kx(0,1,0),this.minEmitBox=new u.kx(-.5,-.5,-.5),this.maxEmitBox=new u.kx(.5,.5,.5)}startDirectionFunction(Z,x,F,G){const f=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),j=(0,t.RandomRange)(this.direction1.z,this.direction2.z);if(G)return x.x=f,x.y=Y,void(x.z=j);u.kx.TransformNormalFromFloatsToRef(f,Y,j,Z,x)}startPositionFunction(Z,x,F,G){const f=(0,t.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,t.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),j=(0,t.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(G)return x.x=f,x.y=Y,void(x.z=j);u.kx.TransformCoordinatesFromFloatsToRef(f,Y,j,Z,x)}clone(){const Z=new c;return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2),Z.setVector3("minEmitBox",this.minEmitBox),Z.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3),Z.addUniform("minEmitBox",3),Z.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Wf(),Z.direction2=this.direction2.Wf(),Z.minEmitBox=this.minEmitBox.Wf(),Z.maxEmitBox=this.maxEmitBox.Wf(),Z}parse(Z){u.kx.FromArrayToRef(Z.direction1,0,this.direction1),u.kx.FromArrayToRef(Z.direction2,0,this.direction2),u.kx.FromArrayToRef(Z.minEmitBox,0,this.minEmitBox),u.kx.FromArrayToRef(Z.maxEmitBox,0,this.maxEmitBox)}}class s{get radius(){return this._radius}set radius(Z){this._radius=Z,this._buildHeight()}get angle(){return this._angle}set angle(Z){this._angle=Z,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=F,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=x,this.radius=Z}startDirectionFunction(Z,x,F,G){G?u.TmpVectors.kx[0].G(F.Aj).normalize():F.position.subtractToRef(Z.getTranslation(),u.TmpVectors.kx[0]).normalize();const f=(0,t.RandomRange)(0,this.directionRandomizer),Y=(0,t.RandomRange)(0,this.directionRandomizer),j=(0,t.RandomRange)(0,this.directionRandomizer);x.x=u.TmpVectors.kx[0].x+f,x.y=u.TmpVectors.kx[0].y+Y,x.z=u.TmpVectors.kx[0].z+j,x.normalize()}startPositionFunction(Z,x,F,G){const f=(0,t.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,t.RandomRange)(0,this.heightRange),Y=1-Y*Y);let j=this._radius-(0,t.RandomRange)(0,this._radius*this.radiusRange);j*=Y;const d=j*Math.sin(f),o=j*Math.cos(f),c=Y*this._height;if(G)return x.x=d,x.y=c,void(x.z=o);u.kx.TransformCoordinatesFromFloatsToRef(d,c,o,Z,x)}clone(){const Z=new s(this._radius,this._angle,this.directionRandomizer);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat2("radius",this._radius,this.radiusRange),Z.setFloat("coneAngle",this._angle),Z.setFloat2("height",this._height,this.heightRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",2),Z.addUniform("coneAngle",1),Z.addUniform("height",2),Z.addUniform("directionRandomizer",1)}getEffectDefines(){let Z="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(Z+="\n#define CONEEMITTERSPAWNPOINT"),Z}getClassName(){return"ConeParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this._radius,Z.angle=this._angle,Z.directionRandomizer=this.directionRandomizer,Z.radiusRange=this.radiusRange,Z.heightRange=this.heightRange,Z.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,Z}parse(Z){this.radius=Z.radius,this.angle=Z.angle,this.directionRandomizer=Z.directionRandomizer,this.radiusRange=void 0!==Z.radiusRange?Z.radiusRange:1,this.heightRange=void 0!==Z.radiusRange?Z.heightRange:1,this.emitFromSpawnPointOnly=void 0!==Z.emitFromSpawnPointOnly&&Z.emitFromSpawnPointOnly}}class J extends s{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0);super(Z,x),this.direction1=F,this.direction2=G}startDirectionFunction(Z,x){const F=(0,t.RandomRange)(this.direction1.x,this.direction2.x),G=(0,t.RandomRange)(this.direction1.y,this.direction2.y),f=(0,t.RandomRange)(this.direction1.z,this.direction2.z);u.kx.TransformNormalFromFloatsToRef(F,G,f,Z,x)}clone(){const Z=new J(this.radius,this.angle,this.direction1,this.direction2);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Wf(),Z.direction2=this.direction2.Wf(),Z}parse(Z){super.parse(Z),this.direction1.G(Z.direction1),this.direction2.G(Z.direction2)}}class p{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=Z,this.height=x,this.radiusRange=F,this.directionRandomizer=G,this._tempVector=u.kx.Zero()}startDirectionFunction(Z,x,F,G,f){F.position.subtractToRef(Z.getTranslation(),this._tempVector),this._tempVector.normalize(),u.kx.TransformNormalToRef(this._tempVector,f,this._tempVector);const Y=(0,t.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let j=Math.atan2(this._tempVector.x,this._tempVector.z);j+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(j),this._tempVector.z=Math.cos(j),this._tempVector.normalize(),G?x.G(this._tempVector):u.kx.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z,x)}startPositionFunction(Z,x,F,G){const f=(0,t.RandomRange)(-this.height/2,this.height/2),Y=(0,t.RandomRange)(0,2*Math.PI),j=(0,t.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),d=Math.sqrt(j)*this.radius,o=d*Math.cos(Y),c=d*Math.sin(Y);G?x.Jj(o,f,c):u.kx.TransformCoordinatesFromFloatsToRef(o,f,c,Z,x)}clone(){const Z=new p(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.height=this.height,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.height=Z.height,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class U extends p{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0),f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.kx(0,1,0);super(Z,x,F),this.direction1=G,this.direction2=f}startDirectionFunction(Z,x,F,G){const f=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),j=(0,t.RandomRange)(this.direction1.z,this.direction2.z);G?x.Jj(f,Y,j):u.kx.TransformNormalFromFloatsToRef(f,Y,j,Z,x)}clone(){const Z=new U(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("height",this.height),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("height",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Wf(),Z.direction2=this.direction2.Wf(),Z}parse(Z){super.parse(Z),u.kx.FromArrayToRef(Z.direction1,0,this.direction1),u.kx.FromArrayToRef(Z.direction2,0,this.direction2)}}class k{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=x,this.directionRandomizer=F}startDirectionFunction(Z,x,F,G){const f=F.position.Mx(Z.getTranslation()).normalize(),Y=(0,t.RandomRange)(0,this.directionRandomizer),j=(0,t.RandomRange)(0,this.directionRandomizer),d=(0,t.RandomRange)(0,this.directionRandomizer);f.x+=Y,f.y+=j,f.z+=d,f.normalize(),G?x.G(f):u.kx.TransformNormalFromFloatsToRef(f.x,f.y,f.z,Z,x)}startPositionFunction(Z,x,F,G){const f=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),Y=(0,t.RandomRange)(0,1),j=(0,t.RandomRange)(0,2*Math.PI),d=Math.acos(2*Y-1),o=f*Math.cos(j)*Math.sin(d),c=f*Math.cos(d),s=f*Math.sin(j)*Math.sin(d);G?x.Jj(o,Math.abs(c),s):u.kx.TransformCoordinatesFromFloatsToRef(o,Math.abs(c),s,Z,x)}clone(){const Z=new k(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class M{constructor(){this.direction1=new u.kx(0,1,0),this.direction2=new u.kx(0,1,0)}startDirectionFunction(Z,x,F,G){const f=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),j=(0,t.RandomRange)(this.direction1.z,this.direction2.z);G?x.Jj(f,Y,j):u.kx.TransformNormalFromFloatsToRef(f,Y,j,Z,x)}startPositionFunction(Z,x,F,G){G?x.Jj(0,0,0):u.kx.TransformCoordinatesFromFloatsToRef(0,0,0,Z,x)}clone(){const Z=new M;return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.direction1=this.direction1.Wf(),Z.direction2=this.direction2.Wf(),Z}parse(Z){u.kx.FromArrayToRef(Z.direction1,0,this.direction1),u.kx.FromArrayToRef(Z.direction2,0,this.direction2)}}class m{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=Z,this.radiusRange=x,this.directionRandomizer=F}startDirectionFunction(Z,x,F,G){const f=F.position.Mx(Z.getTranslation()).normalize(),Y=(0,t.RandomRange)(0,this.directionRandomizer),j=(0,t.RandomRange)(0,this.directionRandomizer),d=(0,t.RandomRange)(0,this.directionRandomizer);f.x+=Y,f.y+=j,f.z+=d,f.normalize(),G?x.G(f):u.kx.TransformNormalFromFloatsToRef(f.x,f.y,f.z,Z,x)}startPositionFunction(Z,x,F,G){const f=this.radius-(0,t.RandomRange)(0,this.radius*this.radiusRange),Y=(0,t.RandomRange)(0,1),j=(0,t.RandomRange)(0,2*Math.PI),d=Math.acos(2*Y-1),o=f*Math.cos(j)*Math.sin(d),c=f*Math.cos(d),s=f*Math.sin(j)*Math.sin(d);G?x.Jj(o,c,s):u.kx.TransformCoordinatesFromFloatsToRef(o,c,s,Z,x)}clone(){const Z=new m(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.radius=this.radius,Z.radiusRange=this.radiusRange,Z.directionRandomizer=this.directionRandomizer,Z}parse(Z){this.radius=Z.radius,this.radiusRange=Z.radiusRange,this.directionRandomizer=Z.directionRandomizer}}class C extends m{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.kx(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0);super(Z),this.direction1=x,this.direction2=F}startDirectionFunction(Z,x){const F=(0,t.RandomRange)(this.direction1.x,this.direction2.x),G=(0,t.RandomRange)(this.direction1.y,this.direction2.y),f=(0,t.RandomRange)(this.direction1.z,this.direction2.z);u.kx.TransformNormalFromFloatsToRef(F,G,f,Z,x)}clone(){const Z=new C(this.radius,this.direction1,this.direction2);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setFloat("radius",this.radius),Z.setFloat("radiusRange",this.radiusRange),Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("radius",1),Z.addUniform("radiusRange",1),Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const Z=super.serialize();return Z.direction1=this.direction1.Wf(),Z.direction2=this.direction2.Wf(),Z}parse(Z){super.parse(Z),this.direction1.G(Z.direction1),this.direction2.G(Z.direction2)}}class L{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(Z,x,F,G){const f=u.TmpVectors.kx[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,F,f);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,F,f);const Z=u.TmpVectors.kx[1];f.subtractToRef(F.position,Z),Z.scaleToRef(1/F.lifeTime,f)}else f.set(0,0,0);G?x.G(f):u.kx.TransformNormalToRef(f,Z,x)}startPositionFunction(Z,x,F,G){const f=u.TmpVectors.kx[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,F,f):f.set(0,0,0),G?x.G(f):u.kx.TransformCoordinatesToRef(f,Z,x)}clone(){const Z=new L;return o.b.DeepCopy(this,Z),Z}applyToShader(Z){}buildUniformLayout(Z){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const Z={};return Z.type=this.getClassName(),Z.particlePositionGenerator=this.particlePositionGenerator,Z.particleDestinationGenerator=this.particleDestinationGenerator,Z}parse(Z){Z.particlePositionGenerator&&(this.particlePositionGenerator=Z.particlePositionGenerator),Z.particleDestinationGenerator&&(this.particleDestinationGenerator=Z.particleDestinationGenerator)}}var H=F(11265);class S{get mesh(){return this._mesh}set mesh(Z){this._mesh!==Z&&(this._mesh=Z,Z?(this._indices=Z.cj(),this._positions=Z.getVerticesData(H.f.PositionKind),this._normals=Z.getVerticesData(H.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=u.kx.Zero(),this._mesh=null,this.direction1=new u.kx(0,1,0),this.direction2=new u.kx(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=Z}startDirectionFunction(Z,x,F,G){if(this.useMeshNormalsForDirection&&this._normals)return void u.kx.TransformNormalToRef(this._storedNormal,Z,x);const f=(0,t.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,t.RandomRange)(this.direction1.y,this.direction2.y),j=(0,t.RandomRange)(this.direction1.z,this.direction2.z);G?x.Jj(f,Y,j):u.kx.TransformNormalFromFloatsToRef(f,Y,j,Z,x)}startPositionFunction(Z,x,F,G){if(!this._indices||!this._positions)return;const f=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),j=Math.random()*(1-Y),d=1-Y-j,t=this._indices[f],o=this._indices[f+1],c=this._indices[f+2],s=u.TmpVectors.kx[0],J=u.TmpVectors.kx[1],p=u.TmpVectors.kx[2],U=u.TmpVectors.kx[3];u.kx.FromArrayToRef(this._positions,3*t,s),u.kx.FromArrayToRef(this._positions,3*o,J),u.kx.FromArrayToRef(this._positions,3*c,p),U.x=Y*s.x+j*J.x+d*p.x,U.y=Y*s.y+j*J.y+d*p.y,U.z=Y*s.z+j*J.z+d*p.z,G?x.Jj(U.x,U.y,U.z):u.kx.TransformCoordinatesFromFloatsToRef(U.x,U.y,U.z,Z,x),this.useMeshNormalsForDirection&&this._normals&&(u.kx.FromArrayToRef(this._normals,3*t,s),u.kx.FromArrayToRef(this._normals,3*o,J),u.kx.FromArrayToRef(this._normals,3*c,p),this._storedNormal.x=Y*s.x+j*J.x+d*p.x,this._storedNormal.y=Y*s.y+j*J.y+d*p.y,this._storedNormal.z=Y*s.z+j*J.z+d*p.z)}clone(){const Z=new S(this.mesh);return o.b.DeepCopy(this,Z),Z}applyToShader(Z){Z.setVector3("direction1",this.direction1),Z.setVector3("direction2",this.direction2)}buildUniformLayout(Z){Z.addUniform("direction1",3),Z.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var Z;const x={};return x.type=this.getClassName(),x.direction1=this.direction1.Wf(),x.direction2=this.direction2.Wf(),x.meshId=null===(Z=this.mesh)||void 0===Z?void 0:Z.id,x.useMeshNormalsForDirection=this.useMeshNormalsForDirection,x}parse(Z,x){u.kx.FromArrayToRef(Z.direction1,0,this.direction1),u.kx.FromArrayToRef(Z.direction2,0,this.direction2),Z.meshId&&x&&(this.mesh=x.getLastMeshById(Z.meshId)),this.useMeshNormalsForDirection=Z.useMeshNormalsForDirection}}class K{_isUbo(Z){return void 0!==Z.addUniform}constructor(Z){this._isUbo(Z)?(this.setMatrix3x3=Z.updateMatrix3x3.bind(Z),this.setMatrix2x2=Z.updateMatrix2x2.bind(Z),this.setFloat=Z.updateFloat.bind(Z),this.setFloat2=Z.updateFloat2.bind(Z),this.setFloat3=Z.updateFloat3.bind(Z),this.setFloat4=Z.updateFloat4.bind(Z),this.setFloatArray=Z.updateFloatArray.bind(Z),this.setArray=Z.updateArray.bind(Z),this.setIntArray=Z.updateIntArray.bind(Z),this.setMatrix=Z.Xf.bind(Z),this.setMatrices=Z.updateMatrices.bind(Z),this.setVector3=Z.updateVector3.bind(Z),this.setVector4=Z.updateVector4.bind(Z),this.setColor3=Z.updateColor3.bind(Z),this.setColor4=Z.updateColor4.bind(Z),this.setDirectColor4=Z.updateDirectColor4.bind(Z),this.setInt=Z.updateInt.bind(Z),this.setInt2=Z.updateInt2.bind(Z),this.setInt3=Z.updateInt3.bind(Z),this.setInt4=Z.updateInt4.bind(Z)):(this.setMatrix3x3=Z.setMatrix3x3.bind(Z),this.setMatrix2x2=Z.setMatrix2x2.bind(Z),this.setFloat=Z.setFloat.bind(Z),this.setFloat2=Z.setFloat2.bind(Z),this.setFloat3=Z.setFloat3.bind(Z),this.setFloat4=Z.setFloat4.bind(Z),this.setFloatArray=Z.setFloatArray.bind(Z),this.setArray=Z.setArray.bind(Z),this.setIntArray=Z.setIntArray.bind(Z),this.setMatrix=Z.setMatrix.bind(Z),this.setMatrices=Z.setMatrices.bind(Z),this.setVector3=Z.setVector3.bind(Z),this.setVector4=Z.setVector4.bind(Z),this.setColor3=Z.setColor3.bind(Z),this.setColor4=Z.setColor4.bind(Z),this.setDirectColor4=Z.setDirectColor4.bind(Z),this.setInt=Z.setInt.bind(Z),this.setInt2=Z.setInt2.bind(Z),this.setInt3=Z.setInt3.bind(Z),this.setInt4=Z.setInt4.bind(Z))}}var y=F(11091);const q="gpuUpdateParticlesPixelShader",R="#version 300 es\nvoid main() {discard;}\n";y.d.ShadersStore[q]||(y.d.ShadersStore[q]=R);const B="gpuUpdateParticlesVertexShader",v="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";y.d.ShadersStore[B]||(y.d.ShadersStore[B]=v);(0,j.g)("BABYLON.WebGL2ParticleSystem",class{constructor(Z,x){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=Z,this._engine=x,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var Z;return(null===(Z=this._updateEffect)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof L&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=Z,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new K(this._updateEffect)}createVertexBuffers(Z,x){this._updateVAO.push(this._createUpdateVAO(Z)),this._renderVAO.push(this._engine.recordVertexArrayObject(x,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=x}createParticleBuffer(Z){return Z}bindDrawBuffers(Z,x,F){F?this._engine.bindBuffers(this._renderVertexBuffers,F,x):this._engine.bindVertexArrayObject(this._renderVAO[Z],null)}preUpdateParticleBuffer(){const Z=this._engine;if(this._engine.enableEffect(this._updateEffect),!Z.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(Z,x,F){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[Z],null);const u=this._engine;u.bindTransformFeedbackBuffer(x.getBuffer()),u.setRasterizerState(!1),u.beginTransformFeedback(!0),u.drawArraysType(3,0,F),u.endTransformFeedback(),u.setRasterizerState(!0),u.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let Z=0;Z<this._updateVAO.length;Z++)this._engine.releaseVertexArrayObject(this._updateVAO[Z]);this._updateVAO.length=0;for(let Z=0;Z<this._renderVAO.length;Z++)this._engine.releaseVertexArrayObject(this._renderVAO[Z]);this._renderVAO.length=0}_createUpdateVAO(Z){const x={};x.position=Z.createVertexBuffer("position",0,3);let F=3;x.age=Z.createVertexBuffer("age",F,1),F+=1,x.size=Z.createVertexBuffer("size",F,3),F+=3,x.life=Z.createVertexBuffer("life",F,1),F+=1,x.seed=Z.createVertexBuffer("seed",F,4),F+=4,x.direction=Z.createVertexBuffer("direction",F,3),F+=3,this._parent.particleEmitterType instanceof L&&(x.initialPosition=Z.createVertexBuffer("initialPosition",F,3),F+=3),this._parent._colorGradientsTexture||(x.color=Z.createVertexBuffer("color",F,4),F+=4),this._parent._isBillboardBased||(x.initialDirection=Z.createVertexBuffer("initialDirection",F,3),F+=3),this._parent.noiseTexture&&(x.noiseCoordinates1=Z.createVertexBuffer("noiseCoordinates1",F,3),F+=3,x.noiseCoordinates2=Z.createVertexBuffer("noiseCoordinates2",F,3),F+=3),this._parent._angularSpeedGradientsTexture?(x.angle=Z.createVertexBuffer("angle",F,1),F+=1):(x.angle=Z.createVertexBuffer("angle",F,2),F+=2),this._parent._isAnimationSheetEnabled&&(x.cellIndex=Z.createVertexBuffer("cellIndex",F,1),F+=1,this._parent.spriteRandomStartCell&&(x.cellStartOffset=Z.createVertexBuffer("cellStartOffset",F,1),F+=1));const u=this._engine.recordVertexArrayObject(x,null,this._updateEffect);return this._engine.bindArrayBuffer(null),u}});class l{constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,u=arguments.length>3?arguments[3]:void 0;this._engine=Z,this._label=u,this._engine._storageBuffers.push(this),this._create(x,F)}_create(Z,x){this._bufferSize=Z,this._creationFlags=x,this._buffer=this._engine.createStorageBuffer(Z,x,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(Z,x,F){this._buffer&&this._engine.updateStorageBuffer(this._buffer,Z,x,F)}async read(Z,x,F,u){return await this._engine.readFromStorageBuffer(this._buffer,Z,x,F,u)}dispose(){const Z=this._engine._storageBuffers,x=Z.indexOf(this);-1!==x&&(Z[x]=Z[Z.length-1],Z.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var i=F(11159),e=F(11165),b=F(11213),E=F(11157),w=F(11500),T=F(11012),N=F(11121),W=F(11427);class A{constructor(){this._gpuTimeInFrameId=-1,this.counter=new W.d}_addDuration(Z,x){Z<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==Z?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(x,!1),this._gpuTimeInFrameId=Z):this.counter.addCount(x,!1))}}var h=F(11072);class X{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=Z,this._engine=x,this.uniqueId=w.c.UniqueId,x.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new A),this._engine.getCaps().supportComputeShaders?u.bindingsMapping?(this._context=x.createComputeContext(),this._shaderPath=F,this._options={bindingsMapping:{},defines:[],...u}):T.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(Z,x){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const u=this._bindings[Z];this._bindings[Z]={type:F?0:4,object:x,indexInGroupEntries:null===u||void 0===u?void 0:u.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!u||u.object!==x||u.type!==this._bindings[Z].type)}setStorageTexture(Z,x){const F=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==x),this._bindings[Z]={type:1,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setExternalTexture(Z,x){const F=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==x),this._bindings[Z]={type:6,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setVideoTexture(Z,x){return!!x.externalTexture&&(this.setExternalTexture(Z,x.externalTexture),!0)}setUniformBuffer(Z,x){const F=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==x),this._bindings[Z]={type:X._BufferIsDataBuffer(x)?7:2,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setStorageBuffer(Z,x){const F=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==x),this._bindings[Z]={type:X._BufferIsDataBuffer(x)?7:3,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setTextureSampler(Z,x){const F=this._bindings[Z];this._contextIsDirty||(this._contextIsDirty=!F||!x.compareSampler(F.object)),this._bindings[Z]={type:5,object:x,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}isReady(){let Z=this._effect;for(const G in this._bindings){const Z=this._bindings[G],x=Z.type,F=Z.object;switch(x){case 0:case 4:case 1:if(!F.isReady())return!1;break;case 6:if(!F.isReady())return!1;break}}const x=[],F=this._shaderPath;if(this._options.defines)for(let G=0;G<this._options.defines.length;G++)x.push(this._options.defines[G]);const u=x.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,Z=this._engine.createComputeEffect(F,{defines:u,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=Z),!!Z.isReady()}dispatch(Z,x,F){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,Z,x,F,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const F=X._BufferIsDataBuffer(Z)?Z:Z.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,F,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const x in this._bindings){const F=this._bindings[x];if(!this._options.bindingsMapping[x])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+x+"'");switch(F.type){case 0:{const u=this._samplers[x],G=F.object;var Z;if(!u||!G._texture||!u.compareSampler(G._texture))this._samplers[x]=(new N.d).setParameters(G.wrapU,G.wrapV,G.wrapR,G.anisotropicFilteringLevel,G._texture.samplingMode,null===(Z=G._texture)||void 0===Z?void 0:Z._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const Z=F.object;Z.getBuffer()!==F.buffer&&(F.buffer=Z.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((G=>{(0,h.h)((()=>this.dispatch(Z,x,F)),G,void 0,u)}))}serialize(){const Z=b.c.Serialize(this);Z.options=this._options,Z.shaderPath=this._shaderPath,Z.FJ={},Z.textures={};for(const x in this._bindings){const F=this._bindings[x],u=F.object;switch(F.type){case 0:case 4:case 1:{const G=u.serialize();G&&(Z.textures[x]=G,Z.FJ[x]={type:F.type});break}}}return Z}static Parse(Z,x,F){const u=b.c.Parse((()=>new X(Z.name,x.getEngine(),Z.shaderPath,Z.options)),Z,x,F);for(const G in Z.textures){const f=Z.FJ[G],Y=E.c.Parse(Z.textures[G],x,F);0===f.type?u.setTexture(G,Y):4===f.type?u.setTexture(G,Y,!1):u.setStorageTexture(G,Y)}return u}static _BufferIsDataBuffer(Z){return void 0!==Z.underlyingResource}}(0,i.d)([(0,e.H)()],X.prototype,"name",void 0),(0,i.d)([(0,e.H)()],X.prototype,"fastMode",void 0),(0,j.g)("BABYLON.ComputeShader",X);var D=F(11468);const Q="gpuUpdateParticlesComputeShader",g="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";y.d.ShadersStoreWGSL[Q]||(y.d.ShadersStoreWGSL[Q]=g);(0,j.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(Z,x){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=Z,this._engine=x}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var Z;return(null===(Z=this._updateComputeShader)||void 0===Z?void 0:Z.isReady())??!1}createUpdateBuffer(Z){var x;const F={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(F.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(F.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(F.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(F.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(F.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(F.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(F.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new X("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:F,defines:Z.split("\n")}),null===(x=this._simParamsComputeShader)||void 0===x||x.dispose(),this._simParamsComputeShader=new D.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new K(this._simParamsComputeShader)}createVertexBuffers(Z,x){this._renderVertexBuffers.push(x)}createParticleBuffer(Z){const x=new l(this._engine,4*Z.length,11,"ComputeShaderParticleSystemBuffer");return x.update(Z),this._bufferComputeShader.push(x),x.getBuffer()}bindDrawBuffers(Z,x,F){this._engine.bindBuffers(this._renderVertexBuffers[Z],F,x)}preUpdateParticleBuffer(){}updateParticleBuffer(Z,x,F){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[Z]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^Z]),this._updateComputeShader.dispatch(Math.ceil(F/64))}releaseBuffers(){var Z;for(let x=0;x<this._bufferComputeShader.length;++x)this._bufferComputeShader[x].dispose();this._bufferComputeShader.length=0,null===(Z=this._simParamsComputeShader)||void 0===Z||Z.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class O{constructor(Z,x,F){this.gradient=Z,this.color1=x,this.color2=F}getColorToRef(Z){this.color2?Y.kj.LerpToRef(this.color1,this.color2,Math.random(),Z):Z.G(this.color1)}}class n{constructor(Z,x){this.gradient=Z,this.color=x}}class V{constructor(Z,x,F){this.gradient=Z,this.factor1=x,this.factor2=F}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class a{static GetCurrentGradient(Z,x,F){if(x[0].gradient>Z)return void F(x[0],x[0],1);for(let G=0;G<x.length-1;G++){const u=x[G],f=x[G+1];if(Z>=u.gradient&&Z<=f.gradient){return void F(u,f,(Z-u.gradient)/(f.gradient-u.gradient))}}const u=x.length-1;F(x[u],x[u],1)}}var I=F(11e3),r=F(11694),z=F(11037);class P{constructor(Z){this.particleSystem=Z,this.position=u.kx.Zero(),this.direction=u.kx.Zero(),this.color=new Y.kj(0,0,0,0),this.colorStep=new Y.kj(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new u.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.kj(0,0,0,0),this._currentColor2=new Y.kj(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=P._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let Z=this.age,x=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===x?(x=1,Z=this._randomCellOffset):Z+=this._randomCellOffset);const F=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let u;u=this._initialSpriteCellLoop?(0,t.Clamp)(Z*x%this.lifeTime/this.lifeTime):(0,t.Clamp)(Z*x/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+u*F|0}_inheritParticleInfoToSubEmitter(Z){if(Z.particleSystem.i.position){const x=Z.particleSystem.i;if(x.position.G(this.position),Z.inheritDirection){const Z=u.TmpVectors.kx[0];this.direction.normalizeToRef(Z),x.setDirection(Z,0,Math.PI/2)}}else{Z.particleSystem.i.G(this.position)}this.direction.scaleToRef(Z.inheritedVelocityAmount/2,u.TmpVectors.kx[0]),Z.particleSystem._inheritedVelocityOffset.G(u.TmpVectors.kx[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const Z of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(Z)}_reset(){this.age=0,this.id=P._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(Z){Z.position.G(this.position),this._initialDirection?Z._initialDirection?Z._initialDirection.G(this._initialDirection):Z._initialDirection=this._initialDirection.clone():Z._initialDirection=null,Z.direction.G(this.direction),this.Aj&&(Z.Aj?Z.Aj.G(this.Aj):Z.Aj=this.Aj.clone()),Z.color.G(this.color),Z.colorStep.G(this.colorStep),Z.lifeTime=this.lifeTime,Z.age=this.age,Z._randomCellOffset=this._randomCellOffset,Z.size=this.size,Z.scale.G(this.scale),Z.angle=this.angle,Z.angularSpeed=this.angularSpeed,Z.particleSystem=this.particleSystem,Z.cellIndex=this.cellIndex,Z.id=this.id,Z._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(Z._currentColorGradient=this._currentColorGradient,Z._currentColor1.G(this._currentColor1),Z._currentColor2.G(this._currentColor2)),this._currentSizeGradient&&(Z._currentSizeGradient=this._currentSizeGradient,Z._currentSize1=this._currentSize1,Z._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(Z._currentAngularSpeedGradient=this._currentAngularSpeedGradient,Z._currentAngularSpeed1=this._currentAngularSpeed1,Z._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(Z._currentVelocityGradient=this._currentVelocityGradient,Z._currentVelocity1=this._currentVelocity1,Z._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(Z._currentLimitVelocityGradient=this._currentLimitVelocityGradient,Z._currentLimitVelocity1=this._currentLimitVelocity1,Z._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(Z._currentDragGradient=this._currentDragGradient,Z._currentDrag1=this._currentDrag1,Z._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(Z._initialStartSpriteCellId=this._initialStartSpriteCellId,Z._initialEndSpriteCellId=this._initialEndSpriteCellId,Z._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(Z.remapData&&this.remapData?Z.remapData.G(this.remapData):Z.remapData=new u.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.G(this._randomNoiseCoordinates1),Z._randomNoiseCoordinates2.G(this._randomNoiseCoordinates2)):(Z._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),Z._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}P._Count=0;var ZZ=F(11306),xZ=(F(11365),F(11572)),FZ=F(11570),uZ=F(11459);function GZ(Z,x){const F=(0,t.RandomRange)(0,1);Y.kj.LerpToRef(x.color1,x.color2,F,Z.color),x.colorDead.subtractToRef(Z.color,x._colorDiff),x._colorDiff.scaleToRef(1/Z.lifeTime,Z.colorStep)}function fZ(Z,x){Z._currentColorGradient=x._colorGradients[0],Z._currentColorGradient.getColorToRef(Z.color),Z._currentColor1.G(Z.color),x._colorGradients.length>1?x._colorGradients[1].getColorToRef(Z._currentColor2):Z._currentColor2.G(Z.color)}function YZ(Z,x){const F=x._colorGradients;a.GetCurrentGradient(x._ratio,F,((x,F,u)=>{x!==Z._currentColorGradient&&(Z._currentColor1.G(Z._currentColor2),F.getColorToRef(Z._currentColor2),Z._currentColorGradient=x),Y.kj.LerpToRef(Z._currentColor1,Z._currentColor2,u,Z.color)}))}function jZ(Z,x){Z.colorStep.scaleToRef(x._scaledUpdateSpeed,x._scaledColorStep),Z.color.addInPlace(x._scaledColorStep),Z.color.a<0&&(Z.color.a=0)}function dZ(Z,x){a.GetCurrentGradient(x._ratio,x._angularSpeedGradients,((x,F,u)=>{x!==Z._currentAngularSpeedGradient&&(Z._currentAngularSpeed1=Z._currentAngularSpeed2,Z._currentAngularSpeed2=F.getFactor(),Z._currentAngularSpeedGradient=x),Z.angularSpeed=(0,t.Lerp)(Z._currentAngularSpeed1,Z._currentAngularSpeed2,u)}))}function tZ(Z,x){Z.angle+=Z.angularSpeed*x._scaledUpdateSpeed}function oZ(Z,x){x.particleEmitterType.startDirectionFunction(x._emitterWorldMatrix,Z.direction,Z,x.isLocal,x._emitterInverseWorldMatrix)}function cZ(Z,x){x.startDirectionFunction(x._emitterWorldMatrix,Z.direction,Z,x.isLocal)}function sZ(Z,x){Z._currentVelocityGradient=x._velocityGradients[0],Z._currentVelocity1=Z._currentVelocityGradient.getFactor(),x._velocityGradients.length>1?Z._currentVelocity2=x._velocityGradients[1].getFactor():Z._currentVelocity2=Z._currentVelocity1}function JZ(Z,x){Z._currentLimitVelocityGradient=x._limitVelocityGradients[0],Z._currentLimitVelocity1=Z._currentLimitVelocityGradient.getFactor(),x._limitVelocityGradients.length>1?Z._currentLimitVelocity2=x._limitVelocityGradients[1].getFactor():Z._currentLimitVelocity2=Z._currentLimitVelocity1}function pZ(Z,x){a.GetCurrentGradient(x._ratio,x._velocityGradients,((F,u,G)=>{F!==Z._currentVelocityGradient&&(Z._currentVelocity1=Z._currentVelocity2,Z._currentVelocity2=u.getFactor(),Z._currentVelocityGradient=F),x._directionScale*=(0,t.Lerp)(Z._currentVelocity1,Z._currentVelocity2,G)}))}function UZ(Z,x){a.GetCurrentGradient(x._ratio,x._limitVelocityGradients,((F,u,G)=>{F!==Z._currentLimitVelocityGradient&&(Z._currentLimitVelocity1=Z._currentLimitVelocity2,Z._currentLimitVelocity2=u.getFactor(),Z._currentLimitVelocityGradient=F);const f=(0,t.Lerp)(Z._currentLimitVelocity1,Z._currentLimitVelocity2,G);Z.direction.length()>f&&Z.direction.scaleInPlace(x.limitVelocityDamping)}))}function kZ(Z,x){Z.direction.scaleToRef(x._directionScale,x._scaledDirection)}function MZ(Z,x){x.particleEmitterType.startPositionFunction(x._emitterWorldMatrix,Z.position,Z,x.isLocal)}function mZ(Z,x){x.startPositionFunction(x._emitterWorldMatrix,Z.position,Z,x.isLocal)}function CZ(Z,x){Z.Aj?Z.Aj.G(Z.position):Z.Aj=Z.position.clone(),u.kx.TransformCoordinatesToRef(Z.Aj,x._emitterWorldMatrix,Z.position)}function LZ(Z,x){x.isLocal&&Z.Aj?(Z.Aj.addInPlace(x._scaledDirection),u.kx.TransformCoordinatesToRef(Z.Aj,x._emitterWorldMatrix,Z.position)):Z.position.addInPlace(x._scaledDirection)}function HZ(Z,x){Z._currentDragGradient=x._dragGradients[0],Z._currentDrag1=Z._currentDragGradient.getFactor(),x._dragGradients.length>1?Z._currentDrag2=x._dragGradients[1].getFactor():Z._currentDrag2=Z._currentDrag1}function SZ(Z,x){a.GetCurrentGradient(x._ratio,x._dragGradients,((F,u,G)=>{F!==Z._currentDragGradient&&(Z._currentDrag1=Z._currentDrag2,Z._currentDrag2=u.getFactor(),Z._currentDragGradient=F);const f=(0,t.Lerp)(Z._currentDrag1,Z._currentDrag2,G);x._scaledDirection.scaleInPlace(1-f)}))}function KZ(Z,x){Z._randomNoiseCoordinates1?(Z._randomNoiseCoordinates1.Jj(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2.Jj(Math.random(),Math.random(),Math.random())):(Z._randomNoiseCoordinates1=new u.kx(Math.random(),Math.random(),Math.random()),Z._randomNoiseCoordinates2=new u.kx(Math.random(),Math.random(),Math.random()))}function yZ(Z,x){const F=x._noiseTextureData,G=x._noiseTextureSize;if(F&&G&&Z._randomNoiseCoordinates1){const f=x._fetchR(Z._randomNoiseCoordinates1.x,Z._randomNoiseCoordinates1.y,G.width,G.height,F),Y=x._fetchR(Z._randomNoiseCoordinates1.z,Z._randomNoiseCoordinates2.x,G.width,G.height,F),j=x._fetchR(Z._randomNoiseCoordinates2.y,Z._randomNoiseCoordinates2.z,G.width,G.height,F),d=u.TmpVectors.kx[0],t=u.TmpVectors.kx[1];d.Jj((2*f-1)*x.noiseStrength.x,(2*Y-1)*x.noiseStrength.y,(2*j-1)*x.noiseStrength.z),d.scaleToRef(x._tempScaledUpdateSpeed,t),Z.direction.addInPlace(t)}}function qZ(Z,x){x.gravity.scaleToRef(x._tempScaledUpdateSpeed,x._scaledGravity),Z.direction.addInPlace(x._scaledGravity)}function RZ(Z,x){Z.size=(0,t.RandomRange)(x.minSize,x.maxSize),Z.scale.Jj((0,t.RandomRange)(x.minScaleX,x.maxScaleX),(0,t.RandomRange)(x.minScaleY,x.maxScaleY))}function BZ(Z,x){Z._currentSizeGradient=x._sizeGradients[0],Z._currentSize1=Z._currentSizeGradient.getFactor(),Z.size=Z._currentSize1,x._sizeGradients.length>1?Z._currentSize2=x._sizeGradients[1].getFactor():Z._currentSize2=Z._currentSize1,Z.scale.Jj((0,t.RandomRange)(x.minScaleX,x.maxScaleX),(0,t.RandomRange)(x.minScaleY,x.maxScaleY))}function vZ(Z,x){const F=x._actualFrame/x.targetStopDuration;a.GetCurrentGradient(F,x._startSizeGradients,((F,u,G)=>{F!==x._currentStartSizeGradient&&(x._currentStartSize1=x._currentStartSize2,x._currentStartSize2=u.getFactor(),x._currentStartSizeGradient=F);const f=(0,t.Lerp)(x._currentStartSize1,x._currentStartSize2,G);Z.scale.scaleInPlace(f)}))}function lZ(Z,x){a.GetCurrentGradient(x._ratio,x._sizeGradients,((x,F,u)=>{x!==Z._currentSizeGradient&&(Z._currentSize1=Z._currentSize2,Z._currentSize2=F.getFactor(),Z._currentSizeGradient=x),Z.size=(0,t.Lerp)(Z._currentSize1,Z._currentSize2,u)}))}function iZ(Z,x){Z.remapData=new u.Vector4(0,1,0,1)}function eZ(Z,x){x._colorRemapGradients&&x._colorRemapGradients.length>0&&a.GetCurrentGradient(x._ratio,x._colorRemapGradients,((x,F,u)=>{const G=(0,t.Lerp)(x.factor1,F.factor1,u),f=(0,t.Lerp)(x.factor2,F.factor2,u);Z.remapData.x=G,Z.remapData.y=f-G})),x._alphaRemapGradients&&x._alphaRemapGradients.length>0&&a.GetCurrentGradient(x._ratio,x._alphaRemapGradients,((x,F,u)=>{const G=(0,t.Lerp)(x.factor1,F.factor1,u),f=(0,t.Lerp)(x.factor2,F.factor2,u);Z.remapData.z=G,Z.remapData.w=f-G}))}function bZ(Z,x){const F=(0,t.Clamp)(x._actualFrame/x.targetStopDuration);a.GetCurrentGradient(F,x._lifeTimeGradients,((x,u)=>{const G=x,f=u,Y=G.getFactor(),j=f.getFactor(),d=(F-G.gradient)/(f.gradient-G.gradient);Z.lifeTime=(0,t.Lerp)(Y,j,d)})),x._emitPower=(0,t.RandomRange)(x.minEmitPower,x.maxEmitPower)}function EZ(Z,x){Z.lifeTime=(0,t.RandomRange)(x.minLifeTime,x.maxLifeTime),x._emitPower=(0,t.RandomRange)(x.minEmitPower,x.maxEmitPower)}function wZ(Z,x){0===x._emitPower?(Z._initialDirection?Z._initialDirection.G(Z.direction):Z._initialDirection=Z.direction.clone(),Z.direction.set(0,0,0)):(Z._initialDirection=null,Z.direction.scaleInPlace(x._emitPower)),Z.direction.addInPlace(x._inheritedVelocityOffset)}function TZ(Z,x){Z.angularSpeed=(0,t.RandomRange)(x.minAngularSpeed,x.maxAngularSpeed),Z.angle=(0,t.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function NZ(Z,x){Z._currentAngularSpeedGradient=x._angularSpeedGradients[0],Z.angularSpeed=Z._currentAngularSpeedGradient.getFactor(),Z._currentAngularSpeed1=Z.angularSpeed,x._angularSpeedGradients.length>1?Z._currentAngularSpeed2=x._angularSpeedGradients[1].getFactor():Z._currentAngularSpeed2=Z._currentAngularSpeed1,Z.angle=(0,t.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function WZ(Z,x){Z._initialStartSpriteCellId=x.startSpriteCellID,Z._initialEndSpriteCellId=x.endSpriteCellID,Z._initialSpriteCellLoop=x.spriteCellLoop}function AZ(Z,x){Z.previousItem=x.previousItem,Z.nextItem=x,x.previousItem&&(x.previousItem.nextItem=Z),x.previousItem=Z}function hZ(Z,x){Z.previousItem=x,Z.nextItem=x.nextItem,x.nextItem&&(x.nextItem.previousItem=Z),x.nextItem=Z}function XZ(Z,x){let F=x;for(;F.nextItem;)F=F.nextItem;Z.previousItem=F,Z.nextItem=F.nextItem,F.nextItem=Z}function DZ(Z){Z.previousItem&&(Z.previousItem.nextItem=Z.nextItem),Z.nextItem&&(Z.nextItem.previousItem=Z.previousItem)}class QZ extends d{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(Z){this._startDirectionFunction!==Z&&(this._startDirectionFunction=Z,this._directionProcessing.process=Z?cZ:oZ)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(Z){this._startPositionFunction!==Z&&(this._startPositionFunction=Z,this._positionCreation.process=Z?mZ:MZ)}set onDispose(Z){this._onDisposeObserver&&this.Uf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Uf.add(Z)}get J(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(Z){this._useRampGradients!==Z&&(this._useRampGradients=Z,this._resetEffect(),Z?(this._rampCreation={process:iZ,previousItem:null,nextItem:null},hZ(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:eZ,previousItem:null,nextItem:null},hZ(this._remapGradientProcessing,this._gravityProcessing)):(DZ(this._rampCreation),DZ(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(Z){this._isLocal!==Z&&(this._isLocal=Z,Z?(this._isLocalCreation={process:CZ,previousItem:null,nextItem:null},hZ(this._isLocalCreation,this._positionCreation)):DZ(this._isLocalCreation))}get particles(){return this.rs}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(Z){this._animationSheetEnabled!==Z&&(this._animationSheetEnabled=Z,Z?(this._sheetCreation={process:WZ,previousItem:null,nextItem:null},hZ(this._sheetCreation,this._colorCreation)):DZ(this._sheetCreation),this._reset())}getActiveCount(){return this.rs.length}getClassName(){return"Zd"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var Z;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[x])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new ZZ.b(this._engine),this._customWrappers[x].effect=Z,this._customWrappers[x].drawContext&&(this._customWrappers[x].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(Z){if(this.noiseTexture!==Z){if(this._noiseTexture=Z,!Z)return DZ(this._noiseCreation),void DZ(this._noiseProcessing);this._noiseCreation={process:KZ,previousItem:null,nextItem:null},hZ(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:yZ,previousItem:null,nextItem:null},hZ(this._noiseProcessing,this._positionProcessing)}}constructor(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,d=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(Z),this._emitterInverseWorldMatrix=u.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new u.kx,this.Uf=new I.b,this.onStoppedObservable=new I.b,this.onStartedObservable=new I.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.rs=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.kj(0,0,0,0),this._colorDiff=new Y.kj(0,0,0,0),this._scaledDirection=u.kx.Zero(),this._scaledGravity=u.kx.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=Z=>{},this.recycleParticle=Z=>{const x=this.rs.pop();x!==Z&&x.copyTo(Z),this._stockParticles.push(x)},this._createParticle=()=>{let Z;return 0!==this._stockParticles.length?(Z=this._stockParticles.pop(),Z._reset()):Z=new P(this),this._prepareParticle(Z),Z},this.paused=!1,this._shadersLoaded=!1,this._capacity=x,this._epsilon=j,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=u.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||z.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Vs.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:EZ,previousItem:null,nextItem:null},this._positionCreation={process:MZ,previousItem:null,nextItem:null},hZ(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:oZ,previousItem:null,nextItem:null},hZ(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:wZ,previousItem:null,nextItem:null},hZ(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:RZ,previousItem:null,nextItem:null},hZ(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:TZ,previousItem:null,nextItem:null},hZ(this._angleCreation,this._sizeCreation),this._colorCreation={process:GZ,previousItem:null,nextItem:null},hZ(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,d||(this._colorProcessing={process:jZ,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:tZ,previousItem:null,nextItem:null},hZ(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:kZ,previousItem:null,nextItem:null},hZ(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:LZ,previousItem:null,nextItem:null},hZ(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:qZ,previousItem:null,nextItem:null},hZ(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=f,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ZZ.b(this._engine)},this._customWrappers[0].effect=G,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new c,this.updateFunction=Z=>{var x;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(x=this.noiseTexture.getContent())||void 0===x||x.then((Z=>{this._noiseTextureData=Z})));const F=Z===this.rs;for(let u=0;u<Z.length;u++){const x=Z[u];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const G=x.age;if(x.age+=this._tempScaledUpdateSpeed,x.age>x.lifeTime){const Z=x.age-G,F=x.lifeTime-G;this._tempScaledUpdateSpeed=F*this._tempScaledUpdateSpeed/Z,x.age=x.lifeTime}this._ratio=x.age/x.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let f=this._updateQueueStart;for(;f;)f.process(x,this),f=f.nextItem;if(this._isAnimationSheetEnabled&&!d&&x.updateCellIndex(),x._inheritParticleInfoToSubEmitters(),x.age>=x.lifeTime){if(this._emitFromParticle(x),x._attachedSubEmitters){for(const Z of x._attachedSubEmitters)Z.particleSystem.disposeOnStop=!0,Z.particleSystem.stop();x._attachedSubEmitters=null}this.recycleParticle(x),F&&u--}else;}}}serialize(Z){throw new Error("Method not implemented.")}clone(Z,x){throw new Error("Method not implemented.")}_addFactorGradient(Z,x,F,u){const G=new V(x,F,u);Z.push(G),Z.sort(((Z,x)=>Z.gradient<x.gradient?-1:Z.gradient>x.gradient?1:0))}_removeFactorGradient(Z,x){if(!Z)return;let F=0;for(const u of Z){if(u.gradient===x){Z.splice(F,1);break}F++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=bZ:this._lifeTimeCreation.process=EZ}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:vZ,previousItem:null,nextItem:null},hZ(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(DZ(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(Z){this.targetStopDuration!==Z&&(this._targetStopDuration=Z,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(Z,x,F){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,Z,x,F),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(Z){return this._removeFactorGradient(this._lifeTimeGradients,Z),this._syncLifeTimeCreation(),this}addSizeGradient(Z,x,F){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=BZ,this._sizeGradientProcessing={process:lZ,previousItem:null,nextItem:null},AZ(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,Z,x,F),this}removeSizeGradient(Z){var x;return this._removeFactorGradient(this._sizeGradients,Z),0===(null===(x=this._sizeGradients)||void 0===x?void 0:x.length)&&(DZ(this._sizeGradientProcessing),this._sizeCreation.process=RZ),this}addColorRemapGradient(Z,x,F){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,Z,x,F),this}removeColorRemapGradient(Z){return this._removeFactorGradient(this._colorRemapGradients,Z),this}addAlphaRemapGradient(Z,x,F){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,Z,x,F),this}removeAlphaRemapGradient(Z){return this._removeFactorGradient(this._alphaRemapGradients,Z),this}addAngularSpeedGradient(Z,x,F){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=NZ,this._angularSpeedGradientProcessing={process:dZ,previousItem:null,nextItem:null},AZ(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,Z,x,F),this}removeAngularSpeedGradient(Z){var x;return this._removeFactorGradient(this._angularSpeedGradients,Z),0===(null===(x=this._angularSpeedGradients)||void 0===x?void 0:x.length)&&(this._angleCreation.process=TZ,DZ(this._angularSpeedGradientProcessing)),this}addVelocityGradient(Z,x,F){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:sZ,previousItem:null,nextItem:null},hZ(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:pZ,previousItem:null,nextItem:null},AZ(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,Z,x,F),this}removeVelocityGradient(Z){var x;return this._removeFactorGradient(this._velocityGradients,Z),0===(null===(x=this._velocityGradients)||void 0===x?void 0:x.length)&&(DZ(this._velocityCreation),DZ(this._velocityGradientProcessing)),this}addLimitVelocityGradient(Z,x,F){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:JZ,previousItem:null,nextItem:null},hZ(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:UZ,previousItem:null,nextItem:null},hZ(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,Z,x,F),this}removeLimitVelocityGradient(Z){var x;return this._removeFactorGradient(this._limitVelocityGradients,Z),0===(null===(x=this._limitVelocityGradients)||void 0===x?void 0:x.length)&&(DZ(this._limitVelocityCreation),DZ(this._limitVelocityGradientProcessing)),this}addDragGradient(Z,x,F){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:HZ,previousItem:null,nextItem:null},AZ(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:SZ,previousItem:null,nextItem:null},AZ(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,Z,x,F),this}removeDragGradient(Z){var x;return this._removeFactorGradient(this._dragGradients,Z),0===(null===(x=this._dragGradients)||void 0===x?void 0:x.length)&&(DZ(this._dragCreation),DZ(this._dragGradientProcessing)),this}addEmitRateGradient(Z,x,F){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,Z,x,F),this}removeEmitRateGradient(Z){return this._removeFactorGradient(this._emitRateGradients,Z),this}addStartSizeGradient(Z,x,F){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,Z,x,F),this._syncStartSizeCreation(),this}removeStartSizeGradient(Z){return this._removeFactorGradient(this._startSizeGradients,Z),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const Z=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.Lx[0];for(let F=0;F<this._rawTextureWidth;F++){const u=F/this._rawTextureWidth;a.GetCurrentGradient(u,this._rampGradients,((u,G,f)=>{Y.Lx.LerpToRef(u.color,G.color,f,x),Z[4*F]=255*x.r,Z[4*F+1]=255*x.g,Z[4*F+2]=255*x.b,Z[4*F+3]=255}))}this._rampGradientsTexture=r.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((Z,x)=>Z.gradient<x.gradient?-1:Z.gradient>x.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(Z,x){this._rampGradients||(this._rampGradients=[]);const F=new n(Z,x);return this._rampGradients.push(F),this._syncRampGradientTexture(),this}removeRampGradient(Z){return this._removeGradientAndTexture(Z,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(Z,x,F){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=fZ,this._colorProcessing.process=YZ);const u=new O(Z,x,F);return this._colorGradients.push(u),this._colorGradients.sort(((Z,x)=>Z.gradient<x.gradient?-1:Z.gradient>x.gradient?1:0)),this}removeColorGradient(Z){if(!this._colorGradients)return this;let x=0;for(const F of this._colorGradients){if(F.gradient===Z){this._colorGradients.splice(x,1);break}x++}return 0===this._colorGradients.length&&(this._colorCreation.process=GZ,this._colorProcessing.process=jZ),this}resetDrawCache(){if(this._drawWrappers){for(const Z of this._drawWrappers)if(Z)for(const x of Z)null===x||void 0===x||x.dispose();this._drawWrappers=[]}}_fetchR(Z,x,F,u,G){return G[4*(((Z=.5*Math.abs(Z)+.5)*F%F|0)+((x=.5*Math.abs(x)+.5)*u%u|0)*F)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const Z=this._engine,x=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*x),this._vertexBuffer=new H.e(Z,this._vertexData,!0,x);let F=0;const u=this._vertexBuffer.createVertexBuffer(H.f.PositionKind,F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.f.PositionKind]=u,F+=3;const G=this._vertexBuffer.createVertexBuffer(H.f.ColorKind,F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.f.ColorKind]=G,F+=4;const f=this._vertexBuffer.createVertexBuffer("angle",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=f,F+=1;const Y=this._vertexBuffer.createVertexBuffer("size",F,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,F+=2,this._isAnimationSheetEnabled){const Z=this._vertexBuffer.createVertexBuffer("cellIndex",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=Z,F+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const Z=this._vertexBuffer.createVertexBuffer("direction",F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=Z,F+=3}if(this._useRampGradients){const Z=this._vertexBuffer.createVertexBuffer("remapData",F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=Z,F+=4}let j;if(this._useInstancing){const x=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new H.e(Z,x,!1,2),j=this._spriteBuffer.createVertexBuffer("offset",0,2)}else j=this._vertexBuffer.createVertexBuffer("offset",F,2,this._vertexBufferSize,this._useInstancing),F+=2;this._vertexBuffers.offset=j,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const Z=[],x=[];let F=0;for(let u=0;u<this._capacity;u++)Z.push(F),Z.push(F+1),Z.push(F+2),Z.push(F),Z.push(F+2),Z.push(F+3),x.push(F,F+1,F+1,F+2,F+2,F+3,F+3,F,F,F+3),F+=4;this._indexBuffer=this._engine.createIndexBuffer(Z),this._linesIndexBuffer=this._engine.createIndexBuffer(x)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(Z)setTimeout((()=>{this.start(0)}),Z);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var x;-1!==(null===(x=this.i)||void 0===x?void 0:x.getClassName().indexOf("Mesh"))&&this.i.Qf(!0);const Z=this.noiseTexture;if(Z&&Z.onGeneratedObservable)Z.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let x=0;x<this.preWarmCycles;x++)this.animate(!0),Z.render()}))}));else for(let x=0;x<this.preWarmCycles;x++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(Z))}_postStop(Z){}reset(){this._stockParticles.length=0,this.rs.length=0}_appendParticleVertex(Z,x,F,G){let f=Z*this._vertexBufferSize;if(this._vertexData[f++]=x.position.x+this.Ht.x,this._vertexData[f++]=x.position.y+this.Ht.y,this._vertexData[f++]=x.position.z+this.Ht.z,this._vertexData[f++]=x.color.r,this._vertexData[f++]=x.color.g,this._vertexData[f++]=x.color.b,this._vertexData[f++]=x.color.a,this._vertexData[f++]=x.angle,this._vertexData[f++]=x.scale.x*x.size,this._vertexData[f++]=x.scale.y*x.size,this._isAnimationSheetEnabled&&(this._vertexData[f++]=x.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[f++]=x.direction.x,this._vertexData[f++]=x.direction.y,this._vertexData[f++]=x.direction.z);else if(x._initialDirection){let Z=x._initialDirection;this.isLocal&&(u.kx.TransformNormalToRef(Z,this._emitterWorldMatrix,u.TmpVectors.kx[0]),Z=u.TmpVectors.kx[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[f++]=Z.x,this._vertexData[f++]=Z.y,this._vertexData[f++]=Z.z}else{let Z=x.direction;this.isLocal&&(u.kx.TransformNormalToRef(Z,this._emitterWorldMatrix,u.TmpVectors.kx[0]),Z=u.TmpVectors.kx[0]),0===Z.x&&0===Z.z&&(Z.x=.001),this._vertexData[f++]=Z.x,this._vertexData[f++]=Z.y,this._vertexData[f++]=Z.z}this._useRampGradients&&x.remapData&&(this._vertexData[f++]=x.remapData.x,this._vertexData[f++]=x.remapData.y,this._vertexData[f++]=x.remapData.z,this._vertexData[f++]=x.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===F?F=this._epsilon:1===F&&(F=1-this._epsilon),0===G?G=this._epsilon:1===G&&(G=1-this._epsilon)),this._vertexData[f++]=F,this._vertexData[f++]=G)}_prepareParticle(Z){}_createNewOnes(Z){let x;for(let F=0;F<Z&&this.rs.length!==this._capacity;F++){x=this._createParticle(),this.rs.push(x);let Z=this._createQueueStart;for(;Z;)Z.process(x,this),Z=Z.nextItem;x._inheritParticleInfoToSubEmitters()}}_update(Z){if(this._alive=this.rs.length>0,this.i.position){const Z=this.i;this._emitterWorldMatrix=Z.getWorldMatrix()}else{const Z=this.i;this._emitterWorldMatrix=u.Matrix.Translation(Z.x,Z.y,Z.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.rs),this._createNewOnes(Z)}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=[H.f.PositionKind,H.f.ColorKind,"angle","offset","size"];return Z&&u.push("cellIndex"),x||u.push("direction"),F&&u.push("remapData"),u}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,xZ.b)(u),Z&&u.push("particlesInfos"),x&&u.push("logarithmicDepthConstant"),F&&(u.push("vFogInfos"),u.push("vFogColor")),u}fillDefines(Z,x){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xZ.i)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&Z.push("#define FOG")),this._isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),x===d.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&Z.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case 2:Z.push("#define BILLBOARDY");break;case 8:case 9:Z.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&Z.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:Z.push("#define BILLBOARDMODE_ALL")}F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,x,F){x.push(...QZ._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),Z.push(...QZ._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,uZ.f)(Z,this._imageProcessingConfigurationDefines),(0,uZ.b)(F,this._imageProcessingConfigurationDefines))}_getWrapper(Z){const x=this._getCustomDrawWrapper(Z);if(null!==x&&void 0!==x&&x.effect)return x;const F=[];this.fillDefines(F,Z);const u=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let G=this._drawWrappers[u];G||(G=this._drawWrappers[u]=[]);let f=G[Z];f||(f=new ZZ.b(this._engine),f.drawContext&&(f.drawContext.useInstancing=this._useInstancing),G[Z]=f);const Y=F.join("\n");if(f.defines!==Y){const Z=[],x=[],F=[];this.fillUniformsAttributesAndSamplerNames(x,Z,F),f.setEffect(this._engine.createEffect("particles",Z,x,F,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return f}animate(){var Z;let x,F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!F&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(F?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this.manualEmitCount>-1)x=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let Z=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const x=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(x,this._emitRateGradients,((x,F,u)=>{x!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=F.getFactor(),this._currentEmitRateGradient=x),Z=(0,t.Lerp)(this._currentEmitRate1,this._currentEmitRate2,u)}))}x=Z*this._scaledUpdateSpeed|0,this._newPartsExcess+=Z*this._scaledUpdateSpeed-x}if(this._newPartsExcess>1&&(x+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?x=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(x),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!F){let Z=0;for(let x=0;x<this.rs.length;x++){const F=this.rs[x];this._appendParticleVertices(Z,F),Z+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.rs.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(Z,x){this._appendParticleVertex(Z++,x,0,0),this._useInstancing||(this._appendParticleVertex(Z++,x,1,0),this._appendParticleVertex(Z++,x,1,1),this._appendParticleVertex(Z++,x,0,1))}rebuild(){var Z;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(Z=this._spriteBuffer)||void 0===Z||Z._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!QZ.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(F.bind(F,12736)),Promise.resolve().then(F.bind(F,12672))])):await Promise.all([Promise.resolve().then(F.bind(F,12659)),Promise.resolve().then(F.bind(F,12647))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==d.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(d.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(d.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(Z){const x=this._getWrapper(Z),F=x.effect,G=this._engine;G.enableEffect(x);const f=this.defaultViewMatrix??this._scene.getViewMatrix();if(F.setTexture("diffuseSampler",this.particleTexture),F.setMatrix("view",f),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();F.setFloat3("particlesInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,this.spriteCellWidth/Z.width)}if(F.setVector2("translationPivot",this.translationPivot),F.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;F.setVector3("eyePosition",Z.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),F.setTexture("rampSampler",this._rampGradientsTexture));const Y=F.defines;var j,d,t,o,c,s;(this._scene&&((0,xZ.f)(F,this,this._scene),this.applyFog&&(0,FZ.f)(this._scene,void 0,F)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(f.invertToRef(u.TmpVectors.Matrix[0]),F.setMatrix("invView",u.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?G.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,F):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,F)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?G.bindBuffers(this._vertexBuffers,null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._linesIndexBuffer:this._indexBuffer,F):G.bindBuffers(this._vertexBuffers,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null,F);(this.useLogarithmicDepth&&this._scene&&(0,FZ.l)(Y,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),this._useInstancing)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?G.drawElementsType(6,0,10,this.rs.length):G.drawArraysType(7,0,4,this.rs.length):null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?G.drawElementsType(1,0,10*this.rs.length):G.drawElementsType(0,0,6*this.rs.length);return this.rs.length}render(){if(!this.isReady()||!this.rs.length)return 0;const Z=this._engine;Z.setState&&(Z.setState(!1),this.forceDepthWrite&&Z.setDepthWrite(!0));let x=0;return x=this.blendMode===d.BLENDMODE_MULTIPLYADD?this._render(d.BLENDMODE_MULTIPLY)+this._render(d.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),x}_onDispose(){}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(x,F),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const Z=this._scene.Vs.indexOf(this);Z>-1&&this._scene.Vs.splice(Z,1),this._scene._activeParticleSystems.dispose()}this.Uf.notifyObservers(this),this.Uf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}QZ.ForceGLSL=!1;var gZ,OZ=F(11029);!function(Z){Z[Z.ATTACHED=0]="ATTACHED",Z[Z.END=1]="END"}(gZ||(gZ={}));class nZ{constructor(Z){if(this.particleSystem=Z,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!Z.i||!Z.i.dispose){const x=(0,j.e)("BABYLON.AbstractMesh");Z.i=new x("SubemitterSystemEmitter",Z.KZ()),Z._disposeEmitterOnDispose=!0}}clone(){let Z=this.particleSystem.i;if(Z){if(Z instanceof u.kx)Z=Z.clone();else if(-1!==Z.getClassName().indexOf("Mesh")){Z=new((0,j.e)("BABYLON.Mesh"))("",Z.KZ()),Z.isVisible=!1}}else Z=new u.kx;const x=new nZ(this.particleSystem.clone(this.particleSystem.name,Z));return x.particleSystem.name+="Clone",x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem._disposeEmitterOnDispose=!0,x.particleSystem.disposeOnStop=!0,x}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem=this.particleSystem.serialize(Z),x}static _ParseParticleSystem(Z,x,F){throw(0,OZ.e)("ParseParticle")}static Parse(Z,x,F){const u=Z.particleSystem,G=new nZ(nZ._ParseParticleSystem(u,x,F,!0));return G.type=Z.type,G.inheritDirection=Z.inheritDirection,G.inheritedVelocityAmount=Z.inheritedVelocityAmount,G.particleSystem._isSubEmitter=!0,G}dispose(){this.particleSystem.dispose()}}var VZ=F(11081);function aZ(Z,x){const F=new M;return F.direction1=Z,F.direction2=x,F}function IZ(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function rZ(){return new m(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function zZ(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.kx(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0);return new C(Z,x,F)}function PZ(){return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Zx(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0),f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.kx(0,1,0);return new U(Z,x,F,G,f)}function xx(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new s(Z,x)}function Fx(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0);return new J(Z,x,F,G)}const ux=u.kx.Zero(),Gx=u.kx.Zero(),fx=u.kx.Zero();class Yx{constructor(){this.strength=0,this.position=u.kx.Zero()}_processParticle(Z,x){this.position.subtractToRef(Z.position,ux);const F=ux.lengthSquared()+1;ux.normalize().scaleToRef(this.strength/F,Gx),Gx.scaleToRef(x._tempScaledUpdateSpeed,fx),Z.direction.addInPlace(fx)}serialize(){return{position:this.position.Wf(),strength:this.strength}}}class jx extends QZ{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=Z=>{if(!this._subEmitters||0===this._subEmitters.length)return;const x=Math.floor(Math.random()*this._subEmitters.length);for(const F of this._subEmitters[x])if(1===F.type){const x=F.clone();Z._inheritParticleInfoToSubEmitter(x),x.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(x.particleSystem),x.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(Z,x){const F=aZ(Z,x);return this.particleEmitterType=F,F}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z,this._flowMapUpdate&&(DZ(this._flowMapUpdate),this._flowMapUpdate=null),Z&&(this._flowMapUpdate={process:Z=>{var x;const F=null===(x=this.KZ())||void 0===x?void 0:x.getTransformMatrix();this._flowMap._processParticle(Z,this.flowMapStrength*this._tempScaledUpdateSpeed,F)},previousItem:null,nextItem:null},hZ(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(Z){this._attractors.push(Z),1===this._attractors.length&&(this._attractorUpdate={process:Z=>{for(const x of this._attractors)x._processParticle(Z,this)},previousItem:null,nextItem:null},hZ(this._attractorUpdate,this._directionProcessing))}removeAttractor(Z){const x=this._attractors.indexOf(Z);-1!==x&&this._attractors.splice(x,1),0===this._attractors.length&&DZ(this._attractorUpdate)}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(Z)}createHemisphericEmitter(){const Z=IZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=rZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=zZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.kx(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=PZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Fx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,x,F,u){const G=new c;return this.particleEmitterType=G,this.direction1=Z,this.direction2=x,this.minEmitBox=F,this.maxEmitBox=u,G}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const Z of this.subEmitters)Z instanceof jx?this._subEmitters.push([new nZ(Z)]):Z instanceof nZ?this._subEmitters.push([Z]):Z instanceof Array&&this._subEmitters.push(Z)}_stopSubEmitters(){if(this.activeSubSystems){for(const Z of this.activeSubSystems)Z.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const Z=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==Z&&this._rootParticleSystem.activeSubSystems.splice(Z,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(Z){Z&&this._stopSubEmitters()}_prepareParticle(Z){if(this._subEmitters&&this._subEmitters.length>0){const x=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];Z._attachedSubEmitters=[];for(const F of x)if(0===F.type){const x=F.clone();Z._attachedSubEmitters.push(x),x.particleSystem.start()}}}_onDispose(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),Z&&this.particles)for(const F of this.particles)if(F._attachedSubEmitters)for(let Z=F._attachedSubEmitters.length-1;Z>=0;Z-=1)F._attachedSubEmitters[Z].dispose();if(x&&this.activeSubSystems)for(let F=this.activeSubSystems.length-1;F>=0;F-=1)this.activeSubSystems[F].dispose();if(this._subEmitters&&this._subEmitters.length){for(let Z=0;Z<this._subEmitters.length;Z++)for(const x of this._subEmitters[Z])x.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.i&&this.i.dispose&&this.i.dispose(!0)}static _Parse(Z,x,F,G){let f;f=F instanceof VZ.d?null:F;const d=(0,j.e)("BABYLON.Texture");if(d&&f&&(Z.texture?x.particleTexture=d.Parse(Z.texture,f,G):Z.textureName&&(x.particleTexture=new d(G+Z.textureName,f,!1,void 0===Z.invertY||Z.invertY),x.particleTexture.name=Z.textureName)),Z.emitterId||0===Z.emitterId||void 0!==Z.i?Z.emitterId&&f?x.i=f.getLastMeshById(Z.emitterId):x.i=u.kx.Hx(Z.i):x.i=u.kx.Zero(),x.isLocal=!!Z.isLocal,void 0!==Z.renderingGroupId&&(x.renderingGroupId=Z.renderingGroupId),void 0!==Z.isBillboardBased&&(x.isBillboardBased=Z.isBillboardBased),void 0!==Z.billboardMode&&(x.billboardMode=Z.billboardMode),void 0!==Z.useLogarithmicDepth&&(x.useLogarithmicDepth=Z.useLogarithmicDepth),Z.animations){for(let F=0;F<Z.animations.length;F++){const u=Z.animations[F],G=(0,j.e)("BABYLON.Animation");G&&x.animations.push(G.Parse(u))}x.beginAnimationOnStart=Z.beginAnimationOnStart,x.beginAnimationFrom=Z.beginAnimationFrom,x.beginAnimationTo=Z.beginAnimationTo,x.beginAnimationLoop=Z.beginAnimationLoop}if(Z.autoAnimate&&f&&f.beginAnimation(x,Z.autoAnimateFrom,Z.autoAnimateTo,Z.autoAnimateLoop,Z.autoAnimateSpeed||1),x.startDelay=0|Z.startDelay,x.minAngularSpeed=Z.minAngularSpeed,x.maxAngularSpeed=Z.maxAngularSpeed,x.minSize=Z.minSize,x.maxSize=Z.maxSize,Z.minScaleX&&(x.minScaleX=Z.minScaleX,x.maxScaleX=Z.maxScaleX,x.minScaleY=Z.minScaleY,x.maxScaleY=Z.maxScaleY),void 0!==Z.preWarmCycles&&(x.preWarmCycles=Z.preWarmCycles,x.preWarmStepOffset=Z.preWarmStepOffset),void 0!==Z.minInitialRotation&&(x.minInitialRotation=Z.minInitialRotation,x.maxInitialRotation=Z.maxInitialRotation),x.minLifeTime=Z.minLifeTime,x.maxLifeTime=Z.maxLifeTime,x.minEmitPower=Z.minEmitPower,x.maxEmitPower=Z.maxEmitPower,x.emitRate=Z.emitRate,x.gravity=u.kx.Hx(Z.gravity),Z.noiseStrength&&(x.noiseStrength=u.kx.Hx(Z.noiseStrength)),x.color1=Y.kj.Hx(Z.color1),x.color2=Y.kj.Hx(Z.color2),x.colorDead=Y.kj.Hx(Z.colorDead),x.updateSpeed=Z.updateSpeed,x.targetStopDuration=Z.targetStopDuration,x.blendMode=Z.blendMode,Z.colorGradients)for(const u of Z.colorGradients)x.addColorGradient(u.gradient,Y.kj.Hx(u.color1),u.color2?Y.kj.Hx(u.color2):void 0);if(Z.rampGradients){for(const F of Z.rampGradients)x.addRampGradient(F.gradient,Y.Lx.Hx(F.color));x.useRampGradients=Z.useRampGradients}if(Z.colorRemapGradients)for(const u of Z.colorRemapGradients)x.addColorRemapGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.alphaRemapGradients)for(const u of Z.alphaRemapGradients)x.addAlphaRemapGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.sizeGradients)for(const u of Z.sizeGradients)x.addSizeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.angularSpeedGradients)for(const u of Z.angularSpeedGradients)x.addAngularSpeedGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.velocityGradients)for(const u of Z.velocityGradients)x.addVelocityGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.dragGradients)for(const u of Z.dragGradients)x.addDragGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.emitRateGradients)for(const u of Z.emitRateGradients)x.addEmitRateGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.startSizeGradients)for(const u of Z.startSizeGradients)x.addStartSizeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.lifeTimeGradients)for(const u of Z.lifeTimeGradients)x.addLifeTimeGradient(u.gradient,void 0!==u.factor1?u.factor1:u.factor,u.factor2);if(Z.limitVelocityGradients){for(const F of Z.limitVelocityGradients)x.addLimitVelocityGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);x.limitVelocityDamping=Z.limitVelocityDamping}if(Z.noiseTexture&&f){const F=(0,j.e)("BABYLON.ProceduralTexture");x.noiseTexture=F.Parse(Z.noiseTexture,f,G)}let t;if(Z.particleEmitterType){switch(Z.particleEmitterType.type){case"SphereParticleEmitter":t=new m;break;case"SphereDirectedParticleEmitter":t=new C;break;case"ConeEmitter":case"ConeParticleEmitter":t=new s;break;case"ConeDirectedParticleEmitter":t=new J;break;case"CylinderParticleEmitter":t=new p;break;case"CylinderDirectedParticleEmitter":t=new U;break;case"HemisphericParticleEmitter":t=new k;break;case"PointParticleEmitter":t=new M;break;case"MeshParticleEmitter":t=new S;break;case"CustomParticleEmitter":t=new L;break;default:t=new c}t.parse(Z.particleEmitterType,f)}else t=new c,t.parse(Z,f);x.particleEmitterType=t,x.startSpriteCellID=Z.startSpriteCellID,x.endSpriteCellID=Z.endSpriteCellID,x.spriteCellLoop=Z.spriteCellLoop??!0,x.spriteCellWidth=Z.spriteCellWidth,x.spriteCellHeight=Z.spriteCellHeight,x.spriteCellChangeSpeed=Z.spriteCellChangeSpeed,x.spriteRandomStartCell=Z.spriteRandomStartCell,x.disposeOnStop=Z.disposeOnStop??!1,x.manualEmitCount=Z.manualEmitCount??-1}static Parse(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],f=arguments.length>4?arguments[4]:void 0;const j=Z.name;let d,t,o=null,c=null;if(x instanceof VZ.d?d=x:(t=x,d=t.getEngine()),Z.customShader&&d.createEffectForParticles){c=Z.customShader;const x=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";o=d.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,x)}const s=new jx(j,f||Z.Kx,x,o,Z.isAnimationSheetEnabled);if(s.customShader=c,s._rootUrl=F,Z.id&&(s.id=Z.id),Z.subEmitters){s.subEmitters=[];for(const u of Z.subEmitters){const Z=[];for(const G of u)Z.push(nZ.Parse(G,x,F));s.subEmitters.push(Z)}}if(Z.attractors)for(const Y of Z.attractors){const Z=new Yx;Z.position=u.kx.Hx(Y.position),Z.strength=Y.strength,s.addAttractor(Z)}return jx._Parse(Z,s,x,F),Z.textureMask&&(s.textureMask=Y.kj.Hx(Z.textureMask)),Z.Ht&&(s.Ht=u.kx.Hx(Z.Ht)),Z.preventAutoStart&&(s.preventAutoStart=Z.preventAutoStart),G||s.preventAutoStart||s.start(),s}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};if(jx._Serialize(x,this,Z),x.textureMask=this.textureMask.Wf(),x.customShader=this.customShader,x.preventAutoStart=this.preventAutoStart,x.Ht=this.Ht.Wf(),this.subEmitters){x.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const F of this._subEmitters){const u=[];for(const x of F)u.push(x.serialize(Z));x.subEmitters.push(u)}}if(this._attractors&&this._attractors.length){x.attractors=[];for(const Z of this._attractors)x.attractors.push(Z.serialize())}return x}static _Serialize(Z,x,F){if(Z.name=x.name,Z.id=x.id,Z.Kx=x.getCapacity(),Z.disposeOnStop=x.disposeOnStop,Z.manualEmitCount=x.manualEmitCount,x.i.position){const F=x.i;Z.emitterId=F.id}else{const F=x.i;Z.i=F.Wf()}x.particleEmitterType&&(Z.particleEmitterType=x.particleEmitterType.serialize()),x.particleTexture&&(F?Z.texture=x.particleTexture.serialize():(Z.textureName=x.particleTexture.name,Z.invertY=!!x.particleTexture._invertY)),Z.isLocal=x.isLocal,b.c.AppendSerializedAnimations(x,Z),Z.beginAnimationOnStart=x.beginAnimationOnStart,Z.beginAnimationFrom=x.beginAnimationFrom,Z.beginAnimationTo=x.beginAnimationTo,Z.beginAnimationLoop=x.beginAnimationLoop,Z.startDelay=x.startDelay,Z.renderingGroupId=x.renderingGroupId,Z.isBillboardBased=x.isBillboardBased,Z.billboardMode=x.billboardMode,Z.minAngularSpeed=x.minAngularSpeed,Z.maxAngularSpeed=x.maxAngularSpeed,Z.minSize=x.minSize,Z.maxSize=x.maxSize,Z.minScaleX=x.minScaleX,Z.maxScaleX=x.maxScaleX,Z.minScaleY=x.minScaleY,Z.maxScaleY=x.maxScaleY,Z.minEmitPower=x.minEmitPower,Z.maxEmitPower=x.maxEmitPower,Z.minLifeTime=x.minLifeTime,Z.maxLifeTime=x.maxLifeTime,Z.emitRate=x.emitRate,Z.gravity=x.gravity.Wf(),Z.noiseStrength=x.noiseStrength.Wf(),Z.color1=x.color1.Wf(),Z.color2=x.color2.Wf(),Z.colorDead=x.colorDead.Wf(),Z.updateSpeed=x.updateSpeed,Z.targetStopDuration=x.targetStopDuration,Z.blendMode=x.blendMode,Z.preWarmCycles=x.preWarmCycles,Z.preWarmStepOffset=x.preWarmStepOffset,Z.minInitialRotation=x.minInitialRotation,Z.maxInitialRotation=x.maxInitialRotation,Z.startSpriteCellID=x.startSpriteCellID,Z.spriteCellLoop=x.spriteCellLoop,Z.endSpriteCellID=x.endSpriteCellID,Z.spriteCellChangeSpeed=x.spriteCellChangeSpeed,Z.spriteCellWidth=x.spriteCellWidth,Z.spriteCellHeight=x.spriteCellHeight,Z.spriteRandomStartCell=x.spriteRandomStartCell,Z.isAnimationSheetEnabled=x.isAnimationSheetEnabled,Z.useLogarithmicDepth=x.useLogarithmicDepth;const u=x.getColorGradients();if(u){Z.colorGradients=[];for(const x of u){const F={gradient:x.gradient,color1:x.color1.Wf()};x.color2?F.color2=x.color2.Wf():F.color2=x.color1.Wf(),Z.colorGradients.push(F)}}const G=x.getRampGradients();if(G){Z.rampGradients=[];for(const x of G){const F={gradient:x.gradient,color:x.color.Wf()};Z.rampGradients.push(F)}Z.useRampGradients=x.useRampGradients}const f=x.getColorRemapGradients();if(f){Z.colorRemapGradients=[];for(const x of f){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.colorRemapGradients.push(F)}}const Y=x.getAlphaRemapGradients();if(Y){Z.alphaRemapGradients=[];for(const x of Y){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.alphaRemapGradients.push(F)}}const j=x.getSizeGradients();if(j){Z.sizeGradients=[];for(const x of j){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.sizeGradients.push(F)}}const d=x.getAngularSpeedGradients();if(d){Z.angularSpeedGradients=[];for(const x of d){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.angularSpeedGradients.push(F)}}const t=x.getVelocityGradients();if(t){Z.velocityGradients=[];for(const x of t){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.velocityGradients.push(F)}}const o=x.getDragGradients();if(o){Z.dragGradients=[];for(const x of o){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.dragGradients.push(F)}}const c=x.getEmitRateGradients();if(c){Z.emitRateGradients=[];for(const x of c){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.emitRateGradients.push(F)}}const s=x.getStartSizeGradients();if(s){Z.startSizeGradients=[];for(const x of s){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.startSizeGradients.push(F)}}const J=x.getLifeTimeGradients();if(J){Z.lifeTimeGradients=[];for(const x of J){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.lifeTimeGradients.push(F)}}const p=x.getLimitVelocityGradients();if(p){Z.limitVelocityGradients=[];for(const x of p){const F={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?F.factor2=x.factor2:F.factor2=x.factor1,Z.limitVelocityGradients.push(F)}Z.limitVelocityDamping=x.limitVelocityDamping}x.noiseTexture&&(Z.noiseTexture=x.noiseTexture.serialize())}clone(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u={...this._customWrappers};let G=null;const f=this._engine;if(f.createEffectForParticles&&null!=this.customShader){G=this.customShader;const Z=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"",x=f.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,Z);u[0]?u[0].effect=x:this.setCustomEffect(x,0)}const Y=this.serialize(F),j=jx.Parse(Y,this._scene||this._engine,this._rootUrl);return j.name=Z,j.customShader=G,j._customWrappers=u,void 0===x&&(x=this.i),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.i=x,this.preventAutoStart||j.start(),j}}jx.BILLBOARDMODE_Y=2,jx.BILLBOARDMODE_ALL=7,jx.BILLBOARDMODE_STRETCHED=8,jx.BILLBOARDMODE_STRETCHED_LOCAL=9,nZ._ParseParticleSystem=jx.Parse;var dx=F(11450),tx=F(11447),ox=F(11319);ox.b.prototype.createTransformFeedback=function(){const Z=this._gl.createTransformFeedback();if(!Z)throw new Error("Unable to create Transform Feedback");return Z},ox.b.prototype.deleteTransformFeedback=function(Z){this._gl.deleteTransformFeedback(Z)},ox.b.prototype.bindTransformFeedback=function(Z){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,Z)},ox.b.prototype.beginTransformFeedback=function(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(Z?this._gl.POINTS:this._gl.TRIANGLES)},ox.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ox.b.prototype.setTranformFeedbackVaryings=function(Z,x){this._gl.transformFeedbackVaryings(Z,x,this._gl.INTERLEAVED_ATTRIBS)},ox.b.prototype.bindTransformFeedbackBuffer=function(Z){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z?Z.underlyingResource:null)},ox.b.prototype.readTransformFeedbackBuffer=function(Z){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,Z)};const cx="clipPlaneFragmentDeclaration2",sx="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";y.d.IncludesShadersStore[cx]||(y.d.IncludesShadersStore[cx]=sx);F(12537),F(12542),F(12550),F(12553),F(12558),F(12566),F(12574),F(12582);const Jx="gpuRenderParticlesPixelShader",px="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";y.d.ShadersStore[Jx]||(y.d.ShadersStore[Jx]=px);const Ux="clipPlaneVertexDeclaration2",kx="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";y.d.IncludesShadersStore[Ux]||(y.d.IncludesShadersStore[Ux]=kx);F(12589),F(12598),F(12607),F(12609);const Mx="gpuRenderParticlesVertexShader",mx="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";y.d.ShadersStore[Mx]||(y.d.ShadersStore[Mx]=mx);class Cx extends d{static get IsSupported(){if(!z.c.LastCreatedEngine)return!1;const Z=z.c.LastCreatedEngine.getCaps();return Z.supportTransformFeedbacks||Z.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(Z){this._maxActiveParticleCount=Math.min(Z,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(Z){this.maxActiveParticleCount=Z}createPointEmitter(Z,x){const F=aZ(Z,x);return this.particleEmitterType=F,F}createHemisphericEmitter(){const Z=IZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createSphereEmitter(){const Z=rZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=Z,Z}createDirectedSphereEmitter(){const Z=zZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new u.kx(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createCylinderEmitter(){const Z=PZ(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=Z,Z}createDirectedCylinderEmitter(){const Z=Zx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createConeEmitter(){const Z=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=Z,Z}createDirectedConeEmitter(){const Z=Fx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u.kx(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new u.kx(0,1,0));return this.particleEmitterType=Z,Z}createBoxEmitter(Z,x,F,u){const G=new c;return this.particleEmitterType=G,this.direction1=Z,this.direction2=x,this.minEmitBox=F,this.maxEmitBox=u,G}get flowMap(){return this._flowMap}set flowMap(Z){this._flowMap!==Z&&(this._flowMap=Z)}isReady(){if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==jx.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(jx.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(jx.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";Z?setTimeout((()=>{this.start(0)}),Z):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var Z;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Z=this._customWrappers[x])||void 0===Z?void 0:Z.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[Z]??this._customWrappers[0]}setCustomEffect(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new ZZ.b(this._engine),this._customWrappers[x].effect=Z}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new I.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(Z,x,F){return super._removeGradientAndTexture(Z,x,F),this._releaseBuffers(),this}addColorGradient(Z,x){this._colorGradients||(this._colorGradients=[]);const F=new O(Z,x);return this._colorGradients.push(F),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(Z&&this._colorGradients.sort(((Z,x)=>Z.gradient<x.gradient?-1:Z.gradient>x.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(Z){return this._removeGradientAndTexture(Z,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const x in this._drawWrappers){var Z;null===(Z=this._drawWrappers[x].drawContext)||void 0===Z||Z.reset()}}_addFactorGradient(Z,x,F){const u=new V(x,F);Z.push(u),this._releaseBuffers()}addSizeGradient(Z,x){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,Z,x),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(Z){return this._removeGradientAndTexture(Z,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(Z,x){if(!Z)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&Z.sort(((Z,x)=>Z.gradient<x.gradient?-1:Z.gradient>x.gradient?1:0));const F=this;F[x]&&(F[x].dispose(),F[x]=null)}addAngularSpeedGradient(Z,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,Z,x),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(Z){return this._removeGradientAndTexture(Z,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(Z,x){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,Z,x),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(Z,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,Z,x),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(Z){return this._removeGradientAndTexture(Z,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(Z,x){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,Z,x),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(Z){return this._removeGradientAndTexture(Z,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(Z){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(Z),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Uf=new I.b,this.onStoppedObservable=new I.b,this.onStartedObservable=new I.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=u.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||z.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Vs.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,j.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,j.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,j.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ZZ.b(this._engine)},this._customWrappers[0].effect=G,this._drawWrappers={0:new ZZ.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(x=x??{}).randomTextureSize||delete x.randomTextureSize;const Y={Kx:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...x},d=x;isFinite(d)&&(Y.Kx=d),this._capacity=Y.Kx,this._maxActiveParticleCount=Y.Kx,this._currentActiveCount=0,this._isAnimationSheetEnabled=f,this.particleEmitterType=new c;const t=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let o=[];for(let u=0;u<t;++u)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture=new r.d(new Float32Array(o),t,1,5,F,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,o=[];for(let u=0;u<t;++u)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture2=new r.d(new Float32Array(o),t,1,5,F,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=t}_reset(){this._releaseBuffers()}_createVertexBuffers(Z,x,F){const u={};u.position=x.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let G=3;u.age=x.createVertexBuffer("age",G,1,this._attributesStrideSize,!0),G+=1,u.size=x.createVertexBuffer("size",G,3,this._attributesStrideSize,!0),G+=3,u.life=x.createVertexBuffer("life",G,1,this._attributesStrideSize,!0),G+=1,G+=4,this.billboardMode===jx.BILLBOARDMODE_STRETCHED&&(u.direction=x.createVertexBuffer("direction",G,3,this._attributesStrideSize,!0)),G+=3,this._platform.alignDataInBuffer&&(G+=1),this.particleEmitterType instanceof L&&(G+=3,this._platform.alignDataInBuffer&&(G+=1)),this._colorGradientsTexture||(u.color=x.createVertexBuffer("color",G,4,this._attributesStrideSize,!0),G+=4),this._isBillboardBased||(u.initialDirection=x.createVertexBuffer("initialDirection",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1)),this.noiseTexture&&(u.noiseCoordinates1=x.createVertexBuffer("noiseCoordinates1",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1),u.noiseCoordinates2=x.createVertexBuffer("noiseCoordinates2",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1)),u.angle=x.createVertexBuffer("angle",G,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?G++:G+=2,this._isAnimationSheetEnabled&&(u.cellIndex=x.createVertexBuffer("cellIndex",G,1,this._attributesStrideSize,!0),G+=1,this.spriteRandomStartCell&&(u.cellStartOffset=x.createVertexBuffer("cellStartOffset",G,1,this._attributesStrideSize,!0),G+=1)),u.offset=F.createVertexBuffer("offset",0,2),u.uv=F.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(u),this._platform.createVertexBuffers(Z,u),this.resetDrawCache()}_initialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!Z)return;const x=this._engine,F=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof L&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const G=this.particleEmitterType instanceof L,f=u.TmpVectors.kx[0];let Y=0;for(let u=0;u<this._capacity;u++)if(F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),G?(this.particleEmitterType.particleDestinationGenerator(u,null,f),F.push(f.x),F.push(f.y),F.push(f.z)):(F.push(0),F.push(0),F.push(0)),this._platform.alignDataInBuffer&&F.push(0),Y+=16,G&&(this.particleEmitterType.particlePositionGenerator(u,null,f),F.push(f.x),F.push(f.y),F.push(f.z),this._platform.alignDataInBuffer&&F.push(0),Y+=4),this._colorGradientsTexture||(F.push(0),F.push(0),F.push(0),F.push(0),Y+=4),this.isBillboardBased||(F.push(0),F.push(0),F.push(0),this._platform.alignDataInBuffer&&F.push(0),Y+=4),this.noiseTexture&&(F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),Y+=8),F.push(0),Y+=1,this._angularSpeedGradientsTexture||(F.push(0),Y+=1),this._isAnimationSheetEnabled&&(F.push(0),Y+=1,this.spriteRandomStartCell&&(F.push(0),Y+=1)),this._platform.alignDataInBuffer){let Z=3-(Y+3&3);for(Y+=Z;Z-- >0;)F.push(0)}const j=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),d=this._platform.createParticleBuffer(F),t=this._platform.createParticleBuffer(F);this._buffer0=new H.e(x,d,!1,this._attributesStrideSize),this._buffer1=new H.e(x,t,!1,this._attributesStrideSize),this._spriteBuffer=new H.e(x,j,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let Z=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(Z+="\n#define BILLBOARD"),this._colorGradientsTexture&&(Z+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(Z+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(Z+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(Z+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(Z+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(Z+="\n#define DRAGGRADIENTS"),this._flowMap&&(Z+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(Z+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(Z+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(Z+="\n#define NOISE"),this.isLocal&&(Z+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===Z||(this._cachedUpdateDefines=Z,this._updateBuffer=this._platform.createUpdateBuffer(Z)),this._platform.isUpdateBufferReady()}_getWrapper(Z){const x=this._getCustomDrawWrapper(Z);if(null!==x&&void 0!==x&&x.effect)return x;const F=[];this.fillDefines(F,Z);let u=this._drawWrappers[Z];u||(u=new ZZ.b(this._engine),u.drawContext&&(u.drawContext.useInstancing=!0),this._drawWrappers[Z]=u);const G=F.join("\n");if(u.defines!==G){const Z=[],x=[],F=[];this.fillUniformsAttributesAndSamplerNames(x,Z,F),u.setEffect(this._engine.createEffect("gpuRenderParticles",Z,x,F,G),G)}return u}static _GetAttributeNamesOrOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=[H.f.PositionKind,"age","life","size","angle"];return Z||G.push(H.f.ColorKind),x&&G.push("cellIndex"),F||G.push("initialDirection"),u&&G.push("direction"),G.push("offset",H.f.UVKind),G}static _GetEffectCreationOptions(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u=["emitterWM","Ht","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,xZ.b)(u),Z&&u.push("sheetInfos"),x&&u.push("logarithmicDepthConstant"),F&&(u.push("vFogInfos"),u.push("vFogColor")),u}fillDefines(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xZ.i)(this,this._scene,Z),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==tx.d.FOGMODE_NONE&&Z.push("#define FOG")),x===jx.BLENDMODE_MULTIPLY&&Z.push("#define BLENDMULTIPLYMODE"),this.isLocal&&Z.push("#define LOCAL"),this.useLogarithmicDepth&&Z.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(Z.push("#define BILLBOARD"),this.billboardMode){case jx.BILLBOARDMODE_Y:Z.push("#define BILLBOARDY");break;case jx.BILLBOARDMODE_STRETCHED:Z.push("#define BILLBOARDSTRETCHED");break;case jx.BILLBOARDMODE_ALL:Z.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&Z.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&Z.push("#define ANIMATESHEET"),F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),Z.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(Z,x,F){x.push(...Cx._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===jx.BILLBOARDMODE_STRETCHED)),Z.push(...Cx._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(dx.d.PrepareUniforms(Z,this._imageProcessingConfigurationDefines),dx.d.PrepareSamplers(F,this._imageProcessingConfigurationDefines))}animate(){var Z;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(x?this.preWarmStepOffset:(null===(Z=this._scene)||void 0===Z?void 0:Z.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(Z,x){const F=this[x];if(!Z||!Z.length||F)return;const u=new Float32Array(this._rawTextureWidth);for(let G=0;G<this._rawTextureWidth;G++){const x=G/this._rawTextureWidth;a.GetCurrentGradient(x,Z,((Z,x,F)=>{u[G]=(0,t.Lerp)(Z.factor1,x.factor1,F)}))}this[x]=r.d.CreateRTexture(u,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[x].name=x.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const Z=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.kj[0];for(let F=0;F<this._rawTextureWidth;F++){const u=F/this._rawTextureWidth;a.GetCurrentGradient(u,this._colorGradients,((u,G,f)=>{Y.kj.LerpToRef(u.color1,G.color1,f,x),Z[4*F]=255*x.r,Z[4*F+1]=255*x.g,Z[4*F+2]=255*x.b,Z[4*F+3]=255*x.a}))}this._colorGradientsTexture=r.d.CreateRGBATexture(Z,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(Z,x){var F,G,f,Y;const j=this._getWrapper(Z),d=j.effect;this._engine.enableEffect(j);const t=(null===(F=this._scene)||void 0===F?void 0:F.getViewMatrix())||u.Matrix.IdentityReadOnly;if(d.setMatrix("view",t),d.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),d.setTexture("diffuseSampler",this.particleTexture),d.setVector2("translationPivot",this.translationPivot),d.setVector3("Ht",this.Ht),this.isLocal&&d.setMatrix("emitterWM",x),this._colorGradientsTexture?d.setTexture("colorGradientSampler",this._colorGradientsTexture):d.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const Z=this.particleTexture.getBaseSize();d.setFloat3("sheetInfos",this.spriteCellWidth/Z.width,this.spriteCellHeight/Z.height,Z.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const Z=this._scene.activeCamera;d.setVector3("eyePosition",Z.globalPosition)}const o=d.defines;if(this._scene&&((0,xZ.f)(d,this,this._scene),this.applyFog&&(0,FZ.f)(this._scene,void 0,d)),o.indexOf("#define BILLBOARDMODE_ALL")>=0){const Z=t.clone();Z.invert(),d.setMatrix("invView",Z)}return this.useLogarithmicDepth&&this._scene&&(0,FZ.l)(o,d,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(d),this._setEngineBasedOnBlendMode(Z),this._platform.bindDrawBuffers(this._targetIndex,d,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(d),null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(Z){if(!this.i||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!Z)if(this.i.position){Z=this.i.getWorldMatrix()}else{const x=this.i;Z=u.TmpVectors.Matrix[0],u.Matrix.TranslationToRef(x.x,x.y,x.z,Z)}const x=this._engine,F=x.getDepthWrite();if(x.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const Z=this.KZ();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",Z.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",Z),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const G=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=G,x.setDepthWrite(F)}render(){let Z,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!x&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let Z=0;Z<this.preWarmCycles;Z++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const Z=0|this._accumulatedCount;this._accumulatedCount-=Z,this._currentActiveCount+=Z}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.i.position){Z=this.i.getWorldMatrix()}else{const x=this.i;Z=u.TmpVectors.Matrix[0],u.Matrix.TranslationToRef(x.x,x.y,x.z,Z)}const G=this._engine;this.updateInAnimate||this._update(Z);let f=0;return x||F||(G.setState(!1),this.forceDepthWrite&&G.setDepthWrite(!0),f=this.blendMode===jx.BLENDMODE_MULTIPLYADD?this._render(jx.BLENDMODE_MULTIPLY,Z)+this._render(jx.BLENDMODE_ADD,Z):this._render(this.blendMode,Z),this._engine.setAlphaMode(0)),f}rebuild(){const Z=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(Z,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,Z()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const x in this._drawWrappers){this._drawWrappers[x].dispose()}if(this._drawWrappers={},this._scene){const Z=this._scene.Vs.indexOf(this);Z>-1&&this._scene.Vs.splice(Z,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let x=0;x<this._renderVertexBuffers.length;++x){const Z=this._renderVertexBuffers[x];for(const x in Z)Z[x].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),Z&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),Z&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Uf.notifyObservers(this),this.Uf.clear()}clone(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const u={...this._customWrappers};let G=null;const f=this._engine;if(f.createEffectForParticles&&null!=this.customShader){G=this.customShader;const Z=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"";u[0]=f.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,Z,void 0,void 0,void 0,this)}const Y=this.serialize(F),j=Cx.Parse(Y,this._scene||this._engine,this._rootUrl);return j.name=Z,j.customShader=G,j._customWrappers=u,void 0===x&&(x=this.i),this.noiseTexture&&(j.noiseTexture=this.noiseTexture.clone()),j.i=x,j}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return jx._Serialize(x,this,Z),x.activeParticleCount=this.activeParticleCount,x.randomTextureSize=this._randomTextureSize,x.customShader=this.customShader,x}static Parse(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const f=Z.name;let Y,j;x instanceof VZ.d?Y=x:(j=x,Y=j.getEngine());const d=new Cx(f,{Kx:G||Z.Kx,randomTextureSize:Z.randomTextureSize},x,null,Z.isAnimationSheetEnabled);if(d._rootUrl=F,Z.customShader&&Y.createEffectForParticles){const x=Z.customShader,F=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",u=Y.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,F,void 0,void 0,void 0,d);d.setCustomEffect(u,0),d.customShader=x}return Z.id&&(d.id=Z.id),Z.activeParticleCount&&(d.activeParticleCount=Z.activeParticleCount),jx._Parse(Z,d,x,F),Z.preventAutoStart&&(d.preventAutoStart=Z.preventAutoStart),u||d.preventAutoStart||d.start(),d}}var Lx=F(10994),Hx=F(12616),Sx=F(11580);class Kx{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(Z){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const x of this.systems)x.i=Z;this._emitterNode=Z}setEmitterAsSphere(Z,x,F){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:Z,renderingGroupId:x};const u=(0,Hx.c)("emitterSphere",{diameter:Z.diameter,segments:Z.segments},F);u.renderingGroupId=x;const G=new Sx.Cx("emitterSphereMaterial",F);G.emissiveColor=Z.color,u.material=G;for(const f of this.systems)f.i=u;this._emitterNode=u}start(Z){for(const x of this.systems)Z&&(x.i=Z),x.start()}dispose(){for(const Z of this.systems)Z.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={systems:[]};for(const F of this.systems)x.systems.push(F.serialize(Z));return this._emitterNode&&(x.i=this._emitterCreationOptions),x}static Parse(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0;const G=new Kx,f=this.BaseAssetsUrl+"/textures/";x=x||z.c.LastCreatedScene;for(const Y of Z.systems)G.systems.push(F?Cx.Parse(Y,x,f,!0,u):jx.Parse(Y,x,f,!0,u));if(Z.i){const F=Z.i.options;if("Sphere"===Z.i.kind)G.setEmitterAsSphere({diameter:F.diameter,segments:F.segments,color:Y.Lx.Hx(F.color)},Z.i.renderingGroupId,x)}return G}}Kx.BaseAssetsUrl="https://assets.babylonjs.com/particles";var yx=F(11031);class qx{static CreateDefault(Z){let x,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,u=arguments.length>2?arguments[2]:void 0;x=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Cx("default system",{Kx:F},u):new jx("default system",F,u),x.i=Z;const G=Lx.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return x.particleTexture=new E.c(G,x.KZ()),x.createConeEmitter(.1,Math.PI/4),x.color1=new Y.kj(1,1,1,1),x.color2=new Y.kj(1,1,1,1),x.colorDead=new Y.kj(1,1,1,0),x.minSize=.1,x.maxSize=.1,x.minEmitPower=2,x.maxEmitPower=2,x.updateSpeed=1/60,x.emitRate=30,x}static CreateAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0;x||(x=z.c.LastCreatedScene);const G={};return x.addPendingData(G),new Promise(((f,Y)=>{if(F&&!Cx.IsSupported)return x.removePendingData(G),Y("Particle system with GPU is not supported.");Lx.Tools.LoadFile(`${qx.BaseAssetsUrl}/systems/${Z}.json`,(Z=>{x.removePendingData(G);const Y=JSON.parse(Z.toString());return f(Kx.Parse(Y,x,F,u))}),void 0,void 0,void 0,(()=>(x.removePendingData(G),Y(`An error occurred with the creation of your particle system. Check if your type '${Z}' exists.`))))}))}static ExportSet(Z){const x=new Kx;for(const F of Z)x.systems.push(F);return x}static ParseFromFileAsync(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",f=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,j)=>{const d=new yx.b;d.addEventListener("readystatechange",(()=>{if(4==d.readyState)if(200==d.status){const x=JSON.parse(d.responseText);let j;j=u?Cx.Parse(x,F,G,!1,f):jx.Parse(x,F,G,!1,f),Z&&(j.name=Z),Y(j)}else j("Unable to load the particle system")})),d.open("GET",x),d.send()}))}static ParseFromSnippetAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0;if("_BLANK"===Z){const Z=this.CreateDefault(null);return Z.start(),Promise.resolve(Z)}return new Promise(((f,Y)=>{const j=new yx.b;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const Y=JSON.parse(JSON.parse(j.responseText).jsonPayload),d=JSON.parse(Y.particleSystem);let t;t=F?Cx.Parse(d,x,u,!1,G):jx.Parse(d,x,u,!1,G),t.snippetId=Z,f(t)}else Y("Unable to load the snippet "+Z)})),j.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),j.send()}))}}qx.BaseAssetsUrl=Kx.BaseAssetsUrl,qx.SnippetUrl="https://snippet.babylonjs.com",qx.CreateFromSnippetAsync=qx.ParseFromSnippetAsync;var Rx=F(11671),Bx=F(11475),vx=F(12625);(0,vx.e)(Bx.c.NAME_PARTICLESYSTEM,((Z,x,F,u)=>{const G=(0,vx.h)(Bx.c.NAME_PARTICLESYSTEM);if(G&&void 0!==Z.Vs&&null!==Z.Vs)for(let f=0,Y=Z.Vs.length;f<Y;f++){const Y=Z.Vs[f];F.Vs.push(G(Y,x,u))}})),(0,vx.b)(Bx.c.NAME_PARTICLESYSTEM,((Z,x,F)=>{if(Z.activeParticleCount){return Cx.Parse(Z,x,F)}return jx.Parse(Z,x,F)})),VZ.d.prototype.createEffectForParticles=function(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",f=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,o=arguments.length>9?arguments[9]:void 0,c=[],s=[];const J=[];return d?d.fillUniformsAttributesAndSamplerNames(s,c,J):(c=jx._GetAttributeNamesOrOptions(),s=jx._GetEffectCreationOptions()),-1===G.indexOf(" BILLBOARD")&&(G+="\n#define BILLBOARD\n"),null!==d&&void 0!==d&&d.isAnimationSheetEnabled&&-1===G.indexOf(" ANIMATESHEET")&&(G+="\n#define ANIMATESHEET\n"),-1===u.indexOf("diffuseSampler")&&u.push("diffuseSampler"),this.createEffect({vertex:o??(null===d||void 0===d?void 0:d.vertexShaderName)??"particles",fragmentElement:Z},c,s.concat(x),J.concat(u),G,f,Y,j,void 0,t,(async()=>{0===t?await Promise.resolve().then(F.bind(F,12659)):await Promise.resolve().then(F.bind(F,12736))}))},Rx.d.prototype.getEmittedParticleSystems=function(){const Z=[];for(let x=0;x<this.KZ().Vs.length;x++){const F=this.KZ().Vs[x];F.i===this&&Z.push(F)}return Z},Rx.d.prototype.getHierarchyEmittedParticleSystems=function(){const Z=[],x=this.getDescendants();x.push(this);for(let F=0;F<this.KZ().Vs.length;F++){const u=this.KZ().Vs[F],G=u.i;G.position&&-1!==x.indexOf(G)&&Z.push(u)}return Z};F(11546),F(11556),F(11642);F(11647),F(12629),F(11410),F(11532),F(11689);F(11401);var lx;F(12634),F(11201);!function(Z){Z[Z.Color=2]="Color",Z[Z.UV=1]="UV",Z[Z.Random=0]="Random",Z[Z.Stated=3]="Stated"}(lx||(lx={}));var ix=F(11442);const ex=new u.kx(0,0,0),bx=new u.kx(0,0,0),Ex=new u.kx(0,0,0);class wx{constructor(Z,x,F){this.width=Z,this.height=x,this.data=F}processFlowable(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;if(!F)return;F instanceof u.Matrix?u.kx.TransformCoordinatesToRef(Z.position,F,Ex):(Ex.x=F.x,Ex.y=F.y,Ex.z=F.z);const G=.5*Ex.x+.5,f=1-(.5*Ex.y+.5),Y=Math.floor(G*this.width),j=Math.floor(f*this.height);if(Y<0||Y>=this.width||j<0||j>=this.height)return;const d=4*(j*this.width+Y),t=this.data[d]/255*2-1,o=this.data[d+1]/255*2-1,c=this.data[d+2]/255*2-1,s=this.data[d+3]/255;ex.set(t,o,c),ex.scaleToRef(x*s,bx),Z.direction.addInPlace(bx)}_processParticle(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;this.processFlowable(Z,x,F)}static async FromUrlAsync(Z){return await new Promise(((x,F)=>{const u=document.createElement("canvas"),G=u.getContext("2d");let f=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=Z,Y.onerror=x=>{F(new Error(`Failed to load image: ${Z} : ${x}`))},Y.onload=()=>{u.width=Y.width,u.height=Y.height,G.drawImage(Y,0,0),f=G.getImageData(0,0,u.width,u.height),x(new wx(u.width,u.height,f.data))}}))}static async ExtractFromTextureAsync(Z){return await new Promise(((x,F)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{const F=await this.ExtractFromTextureAsync(Z);x(F)}catch(u){F(u)}}));const u=Z.getSize();ix.i.GetTextureDataAsync(Z,u.width,u.height).then((Z=>{x(new wx(u.width,u.height,new Uint8ClampedArray(Z)))})).catch(F)}))}}var Tx,Nx,Wx,Ax,hx,Xx,Dx,Qx,gx;!function(Z){Z[Z.Int=1]="Int",Z[Z.Float=2]="Float",Z[Z.Vector2=4]="Vector2",Z[Z.kx=8]="kx",Z[Z.Matrix=16]="Matrix",Z[Z.Particle=32]="Particle",Z[Z.Texture=64]="Texture",Z[Z.kj=128]="kj",Z[Z.FloatGradient=256]="FloatGradient",Z[Z.Vector2Gradient=512]="Vector2Gradient",Z[Z.Vector3Gradient=1024]="Vector3Gradient",Z[Z.Color4Gradient=2048]="Color4Gradient",Z[Z.System=4096]="System",Z[Z.AutoDetect=8192]="AutoDetect",Z[Z.BasedOnInput=16384]="BasedOnInput",Z[Z.Undefined=32768]="Undefined",Z[Z.All=65535]="All"}(Tx||(Tx={})),function(Z){Z[Z.Compatible=0]="Compatible",Z[Z.TypeIncompatible=1]="TypeIncompatible",Z[Z.HierarchyIssue=2]="HierarchyIssue"}(Nx||(Nx={})),function(Z){Z[Z.Input=0]="Input",Z[Z.Output=1]="Output"}(Wx||(Wx={}));class Ox{get direction(){return this._direction}get type(){if(this._type===Tx.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Tx.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(Z){this._type=Z}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((Z=>Z.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(Z,x,F){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Tx.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new I.b,this.onDisconnectionObservable=new I.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=x,this.name=Z,this._direction=F}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(Z){var x;return this.isConnected?null!==(x=this._connectedPoint)&&void 0!==x&&x._storedFunction?this._connectedPoint._storedFunction(Z):this._connectedPoint._storedValue:this.value}canConnectTo(Z){return 0===this.checkCompatibilityState(Z)}checkCompatibilityState(Z){const x=this._ownerBlock,F=Z.ownerBlock;if(this.type!==Z.type&&Z.innerType!==Tx.AutoDetect)return Z.acceptedConnectionPointTypes&&-1!==Z.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(Z.excludedConnectionPointTypes&&-1!==Z.excludedConnectionPointTypes.indexOf(this.type))return 1;let u=F,G=x;return 0===this.direction&&(u=x,G=F),u.isAnAncestorOf(G)?2:0}connectTo(Z){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(Z))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${Z.ownerBlock.name}".${Z.name}`;return this._endpoints.push(Z),Z._connectedPoint=this,this.onConnectionObservable.notifyObservers(Z),Z.onConnectionObservable.notifyObservers(this),this}disconnectFrom(Z){const x=this._endpoints.indexOf(Z);return-1===x||(this._endpoints.splice(x,1),Z._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(Z),Z.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(Z){let x=1;for(;x<Tx.All;)Z&x||this.excludedConnectionPointTypes.push(x),x<<=1}serialize(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const x={};return x.name=this.name,x.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Wf?(x.valueType="BABYLON."+this.value.getClassName(),x.value=this.value.Wf()):(x.valueType="number",x.value=this.value)),Z&&this.connectedPoint&&(x.inputName=this.name,x.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,x.targetConnectionName=this.connectedPoint.name,x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),x}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class nx{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(Z){this._name=Z}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(Z){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new I.b,this.Uf=new I.b,this.onInputChangedObservable=new I.b,this.visibleOnFrame=!1,this._name=Z,this.uniqueId=w.c.UniqueId}_inputRename(Z){return Z}_outputRename(Z){return Z}isAnAncestorOf(Z){for(const x of this._outputs)if(x.hasEndpoints)for(const F of x.endpoints){if(F.ownerBlock===Z)return!0;if(F.ownerBlock.isAnAncestorOf(Z))return!0}return!1}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const x of this._outputs)if(x.hasEndpoints)for(const F of x.endpoints)if(F.ownerBlock.isAnAncestorOfType(Z))return!0;return!1}getInputByName(Z){const x=this._inputs.filter((x=>x.name===Z));return x.length?x[0]:null}_linkConnectionTypes(Z,x){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[x]._acceptedConnectionPointType=this._inputs[Z]:(this._inputs[Z]._linkedConnectionSource=this._inputs[x],this._inputs[Z]._isMainLinkSource=!0),this._inputs[x]._linkedConnectionSource=this._inputs[Z]}registerInput(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const Y=new Ox(Z,this,0);return Y.type=x,Y.isOptional=F,Y.defaultValue=u,Y.value=u,Y.valueMin=G,Y.valueMax=f,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(Z,x,F){return(F=F??new Ox(Z,this,1)).type=x,this._outputs.push(F),this}_build(Z){}_customBuildStep(Z){}build(Z){if(this._buildId===Z.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((Z=>Z.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=Z.buildId;for(const x of this._inputs){if(!x.connectedPoint){x.isOptional||Z.notConnectedNonOptionalInputs.push(x);continue}const F=x.connectedPoint.ownerBlock;F&&F!==this&&!F.isSystem&&F.build(Z)}return this._customBuildStep(Z),Z.verbose&&T.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(Z),this.onBuildObservable.notifyObservers(this),!1}serialize(){const Z={};Z.customType="BABYLON."+this.getClassName(),Z.id=this.uniqueId,Z.name=this.name,Z.visibleOnFrame=this.visibleOnFrame,Z.inputs=[],Z.outputs=[];for(const x of this.inputs)Z.inputs.push(x.serialize());for(const x of this.outputs)Z.outputs.push(x.serialize(!1));return Z}_deserialize(Z){this._name=Z.name,this.comments=Z.comments,this.visibleOnFrame=!!Z.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(Z)}_deserializePortDisplayNamesAndExposedOnFrame(Z){const x=Z.inputs,F=Z.outputs;if(x)for(const u of x){const Z=this.inputs.find((Z=>Z.name===u.name));if(!Z)return;if(u.displayName&&(Z.displayName=u.displayName),u.isExposedOnFrame&&(Z.isExposedOnFrame=u.isExposedOnFrame,Z.exposedPortPosition=u.exposedPortPosition),void 0!==u.value&&null!==u.value)if("number"===u.valueType)Z.value=u.value;else{const x=(0,j.e)(u.valueType);x&&(Z.value=x.Hx(u.value))}}if(F)for(let u=0;u<F.length;u++){const Z=F[u];Z.displayName&&(this.outputs[u].displayName=Z.displayName),Z.isExposedOnFrame&&(this.outputs[u].isExposedOnFrame=Z.isExposedOnFrame,this.outputs[u].exposedPortPosition=Z.exposedPortPosition)}}clone(){const Z=this.serialize(),x=(0,j.e)(Z.customType);if(x){const F=new x;return F._deserialize(Z),F}return null}dispose(){this.Uf.notifyObservers(this),this.Uf.clear();for(const Z of this.inputs)Z.dispose();for(const Z of this.outputs)Z.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Vx(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",u=arguments.length>3?arguments[3]:void 0;return(G,f)=>{let Y=G._propStore;Y||(Y=[],G._propStore=Y),Y.push({propertyName:f,displayName:Z,type:x,groupName:F,options:u??{},className:G.getClassName()})}}(0,i.d)([(0,e.H)("comment")],nx.prototype,"comments",void 0),function(Z){Z[Z.Boolean=0]="Boolean",Z[Z.Float=1]="Float",Z[Z.Int=2]="Int",Z[Z.Vector2=3]="Vector2",Z[Z.List=4]="List",Z[Z.kj=5]="kj",Z[Z.SamplingMode=6]="SamplingMode",Z[Z.TextureFormat=7]="TextureFormat",Z[Z.TextureType=8]="TextureType"}(Ax||(Ax={})),function(Z){Z[Z.None=0]="None",Z[Z.Position=1]="Position",Z[Z.Direction=2]="Direction",Z[Z.Age=3]="Age",Z[Z.Lifetime=4]="Lifetime",Z[Z.Color=5]="Color",Z[Z.ScaledDirection=6]="ScaledDirection",Z[Z.Scale=7]="Scale",Z[Z.AgeGradient=8]="AgeGradient",Z[Z.Angle=9]="Angle",Z[Z.SpriteCellIndex=16]="SpriteCellIndex",Z[Z.SpriteCellStart=17]="SpriteCellStart",Z[Z.SpriteCellEnd=18]="SpriteCellEnd"}(hx||(hx={})),function(Z){Z[Z.None=0]="None",Z[Z.Time=1]="Time",Z[Z.Delta=2]="Delta",Z[Z.Emitter=3]="Emitter"}(Xx||(Xx={}));class ax{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let Z="";for(const x of this.notConnectedNonOptionalInputs)Z+=`input ${x.name} from block ${x.ownerBlock.name}[${x.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(Z)throw"Build of Node Particle System Set failed:\n"+Z}adapt(Z,x){const F=Z.getConnectedValue(this)||0;if(Z.type===x)return F;switch(x){case Tx.Vector2:return new u.Vector2(F,F);case Tx.kx:return new u.kx(F,F,F);case Tx.kj:return new Y.kj(F,F,F,F)}return null}getContextualValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case hx.Position:return this.particleContext.position;case hx.Direction:return this.particleContext.direction;case hx.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case hx.Color:return this.particleContext.color;case hx.Age:return this.particleContext.age;case hx.Lifetime:return this.particleContext.lifeTime;case hx.Angle:return this.particleContext.angle;case hx.Scale:return this.particleContext.scale;case hx.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case hx.SpriteCellEnd:return this.systemContext.endSpriteCellID;case hx.SpriteCellIndex:return this.particleContext.cellIndex;case hx.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.i.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.i.absolutePosition:this.systemContext.i:null}getSystemValue(Z){if(!this.particleContext||!this.systemContext)return null;switch(Z){case Xx.Time:return this.systemContext._actualFrame;case Xx.Delta:return this.systemContext._scaledUpdateSpeed;case Xx.Emitter:if(this.isEmitterTransformNode){return this.systemContext.i.absolutePosition}return this.systemContext.i}return null}}function Ix(Z,x,F){const u=new ax;u.mx=x;const G=Z.createSystem(u);return G.canStart=()=>!0,G.i=F.clone(),G.disposeOnStop=!0,G.start(),G}class rx extends nx{constructor(Z){super(Z),this.blendMode=d.BLENDMODE_ONEONE,this.Kx=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Tx.Particle),this.registerInput("texture",Tx.Texture),this.registerInput("onStart",Tx.System,!0),this.registerInput("onEnd",Tx.System,!0),this.registerOutput("system",Tx.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(Z){Z.Kx=this.Kx,Z.buildId=this._buildId++,this.build(Z);const x=this.particle.getConnectedValue(Z);return x.particleTexture=this.texture.getConnectedValue(Z),x.emitRate=this.emitRate,x.blendMode=this.blendMode,x.name=this.name,x._nodeGenerated=!0,x._targetStopDuration=this.targetStopDuration,x.startDelay=this.startDelay,this.system._storedValue=this,x.canStart=()=>!this.doNoStart,x.onStartedObservable.add((F=>{const u=this.onStart.getConnectedValue(Z);u&&F.onStartedObservable.addOnce((()=>{Z.systemContext=x;const F=Ix(u,Z.mx,Z.emitterPosition);this.Uf.addOnce((()=>{F.dispose()}))}));const G=this.onEnd.getConnectedValue(Z);G&&F.onStoppedObservable.addOnce((()=>{Z.systemContext=x;const F=Ix(G,Z.mx,Z.emitterPosition);this.Uf.addOnce((()=>{F.dispose()}))}))})),this.Uf.addOnce((()=>{x.dispose()})),x}serialize(){const Z=super.serialize();return Z.Kx=this.Kx,Z.emitRate=this.emitRate,Z.blendMode=this.blendMode,Z.doNoStart=this.doNoStart,Z.targetStopDuration=this.targetStopDuration,Z.startDelay=this.startDelay,Z}_deserialize(Z){super._deserialize(Z),this.Kx=Z.Kx,this.emitRate=Z.emitRate,this.doNoStart=!!Z.doNoStart,void 0!==Z.blendMode&&(this.blendMode=Z.blendMode),void 0!==Z.targetStopDuration&&(this.targetStopDuration=Z.targetStopDuration),void 0!==Z.startDelay&&(this.startDelay=Z.startDelay)}}(0,i.d)([Vx("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:d.BLENDMODE_ONEONE},{label:"Standard",value:d.BLENDMODE_STANDARD},{label:"Add",value:d.BLENDMODE_ADD},{label:"Multiply",value:d.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:d.BLENDMODE_MULTIPLYADD}]})],rx.prototype,"blendMode",void 0),(0,i.d)([Vx("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],rx.prototype,"Kx",void 0),(0,i.d)([Vx("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rx.prototype,"emitRate",void 0),(0,i.d)([Vx("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rx.prototype,"targetStopDuration",void 0),(0,i.d)([Vx("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rx.prototype,"startDelay",void 0),(0,i.d)([Vx("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rx.prototype,"doNoStart",void 0),(0,j.g)("BABYLON.SystemBlock",rx);class zx extends nx{get type(){if(this._type===Tx.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Tx.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Tx.Vector2,this._type;case"kx":return this._type=Tx.kx,this._type;case"kj":return this._type=Tx.kj,this._type;case"Matrix":return this._type=Tx.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===hx.None&&this._systemSource!==Xx.None}get systemSource(){return this._systemSource}set systemSource(Z){if(this._systemSource=Z,Z!==Xx.None){switch(this._contextualSource=hx.None,this._type=Tx.Float,Z){case Xx.Time:case Xx.Delta:this._type=Tx.Float;break;case Xx.Emitter:this._type=Tx.kx}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==hx.None}get contextualValue(){return this._contextualSource}set contextualValue(Z){if(this._contextualSource=Z,Z!==hx.None){switch(this._systemSource=Xx.None,Z){case hx.Scale:this._type=Tx.Vector2;break;case hx.Position:case hx.Direction:case hx.ScaledDirection:this._type=Tx.kx;break;case hx.Color:this._type=Tx.kj;break;case hx.Age:case hx.Lifetime:case hx.Angle:case hx.AgeGradient:this._type=Tx.Float;break;case hx.SpriteCellEnd:case hx.SpriteCellStart:case hx.SpriteCellIndex:this._type=Tx.Int}this.output&&(this.output.type=this._type)}}constructor(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tx.AutoDetect;super(Z),this._type=Tx.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new I.b,this._systemSource=Xx.None,this._contextualSource=hx.None,this._type=x,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",x)}get value(){return this._storedValue}set value(Z){this.type===Tx.Float&&this.min!==this.max&&(Z=Math.max(this.min,Z),Z=Math.min(this.max,Z)),this._storedValue=Z,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(Z){this._valueCallback=Z}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Tx.Int:case Tx.Float:this.value=0;break;case Tx.Vector2:this.value=u.Vector2.Zero();break;case Tx.kx:this.value=u.kx.Zero();break;case Tx.kj:this.value=new Y.kj(1,1,1,1);break;case Tx.Matrix:this.value=u.Matrix.Identity()}}_build(Z){super._build(Z),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=Z=>Z.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const Z=super.serialize();return Z.type=this.type,Z.contextualValue=this.contextualValue,Z.systemSource=this.systemSource,Z.min=this.min,Z.max=this.max,Z.groupInInspector=this.groupInInspector,Z.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Wf?(Z.valueType="BABYLON."+this._storedValue.getClassName(),Z.value=this._storedValue.Wf()):(Z.valueType="number",Z.value=this._storedValue)),Z}_deserialize(Z){if(super._deserialize(Z),this._type=Z.type,this.contextualValue=Z.contextualValue,this.systemSource=Z.systemSource||Xx.None,this.min=Z.min||0,this.max=Z.max||0,this.groupInInspector=Z.groupInInspector||"",void 0!==Z.displayInInspector&&(this.displayInInspector=Z.displayInInspector),Z.valueType)if("number"===Z.valueType)this._storedValue=Z.value;else{const x=(0,j.e)(Z.valueType);x&&(this._storedValue=x.Hx(Z.value))}}}(0,j.g)("BABYLON.ParticleInputBlock",zx);class Px extends nx{get url(){return this._url}set url(Z){this._url!==Z&&(this._cachedData=null,this._url=Z,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(Z){this._textureDataUrl!==Z&&(this._cachedData=null,this._textureDataUrl=Z,this._url="",this._sourceTexture=null)}set sourceTexture(Z){this._sourceTexture!==Z&&(this._cachedData=null,this._sourceTexture=Z,this._url="",this._textureDataUrl="")}constructor(Z){super(Z),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Tx.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const Z=this.texture._storedValue;return await new Promise(((x,F)=>{if(!Z.isReady())return void Z.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),x(this._cachedData)}catch(Z){F(Z)}}));const u=Z.getSize();ix.i.GetTextureDataAsync(Z,u.width,u.height).then((F=>{this._cachedData={width:u.width,height:u.height,data:new Uint8ClampedArray(F)},Z.dispose(),x(this._cachedData)})).catch(F)}))}_build(Z){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new E.c(this._textureDataUrl,Z.mx):this.texture._storedValue=new E.c(this._url,Z.mx):this.texture._storedValue=null}serialize(){const Z=super.serialize();return Z.url=this.url,Z.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(Z.textureDataUrl=this.textureDataUrl),Z}_deserialize(Z){super._deserialize(Z),this.url=Z.url,this.serializedCachedData=!!Z.serializedCachedData,Z.textureDataUrl&&(this.textureDataUrl=Z.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,j.g)("BABYLON.ParticleTextureSourceBlock",Px);class ZF extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("position",Tx.kx),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.position.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.position.G(this.position.getConnectedValue(Z))},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}}(0,j.g)("BABYLON.UpdatePositionBlock",ZF),function(Z){Z[Z.Add=0]="Add",Z[Z.Subtract=1]="Subtract",Z[Z.Multiply=2]="Multiply",Z[Z.Divide=3]="Divide",Z[Z.Max=4]="Max",Z[Z.Min=5]="Min"}(Dx||(Dx={}));class xF extends nx{constructor(Z){super(Z),this.operation=Dx.Add,this.registerInput("left",Tx.AutoDetect),this.registerInput("right",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this.output._typeConnectionSource=this.left;const x=[Tx.Matrix,Tx.Particle,Tx.Texture,Tx.System,Tx.FloatGradient,Tx.Color4Gradient,Tx.Vector2Gradient,Tx.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...x),this.right.excludedConnectionPointTypes.push(...x),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(Z){let x;const F=this.left,G=this.right;if(!F.isConnected||!G.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const f=F.type===Tx.Float||F.type===Tx.Int,j=G.type===Tx.Float||G.type===Tx.Int,d=f&&j;switch(this.operation){case Dx.Add:x=d?Z=>F.getConnectedValue(Z)+G.getConnectedValue(Z):f?Z=>Z.adapt(F,G.type).add(G.getConnectedValue(Z)):Z=>F.getConnectedValue(Z).add(Z.adapt(G,F.type));break;case Dx.Subtract:x=d?Z=>F.getConnectedValue(Z)-G.getConnectedValue(Z):f?Z=>Z.adapt(F,G.type).Mx(G.getConnectedValue(Z)):Z=>F.getConnectedValue(Z).Mx(Z.adapt(G,F.type));break;case Dx.Multiply:x=d?Z=>F.getConnectedValue(Z)*G.getConnectedValue(Z):f?Z=>Z.adapt(F,G.type).multiply(G.getConnectedValue(Z)):Z=>F.getConnectedValue(Z).multiply(Z.adapt(G,F.type));break;case Dx.Divide:x=d?Z=>F.getConnectedValue(Z)/G.getConnectedValue(Z):f?Z=>Z.adapt(F,G.type).divide(G.getConnectedValue(Z)):Z=>F.getConnectedValue(Z).divide(Z.adapt(G,F.type));break;case Dx.Min:if(d)x=Z=>Math.min(F.getConnectedValue(Z),G.getConnectedValue(Z));else{const[Z,j]=f?[G,F]:[F,G];switch(Z.type){case Tx.Vector2:x=x=>u.Vector2.Minimize(Z.getConnectedValue(x),x.adapt(j,Z.type));break;case Tx.kx:x=x=>u.kx.Minimize(Z.getConnectedValue(x),x.adapt(j,Z.type));break;case Tx.kj:x=x=>{const F=Z.getConnectedValue(x),{r:u,g:G,b:f,a:d}=x.adapt(j,Z.type);return new Y.kj(Math.min(F.r,u),Math.min(F.g,G),Math.min(F.b,f),Math.min(F.a,d))}}}break;case Dx.Max:if(!d){const[Z,j]=f?[G,F]:[F,G];switch(Z.type){case Tx.Vector2:x=x=>u.Vector2.Maximize(Z.getConnectedValue(x),x.adapt(j,Z.type));break;case Tx.kx:x=x=>u.kx.Maximize(Z.getConnectedValue(x),x.adapt(j,Z.type));break;case Tx.kj:x=x=>{const F=Z.getConnectedValue(x),{r:u,g:G,b:f,a:d}=x.adapt(j,Z.type);return new Y.kj(Math.max(F.r,u),Math.min(F.g,G),Math.min(F.b,f),Math.min(F.a,d))}}break}x=Z=>Math.max(F.getConnectedValue(Z),G.getConnectedValue(Z))}this.output._storedFunction=Z=>F.type===Tx.Int?0|x(Z):x(Z)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Tx.Int||this.left.type===Tx.Float&&this.right.type!==Tx.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[Z,x]of[[this.left,this.right],[this.right,this.left]])Z.acceptedConnectionPointTypes=[Tx.Int,Tx.Float],x.isConnected&&(Z.acceptedConnectionPointTypes.push(x.type),x.type!==Tx.Int&&x.type!==Tx.Float||Z.acceptedConnectionPointTypes.push(Tx.Vector2,Tx.kx,Tx.kj))}dispose(){super.dispose();for(const Z of this._connectionObservers)Z.remove();this._connectionObservers.length=0}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,i.d)([Vx("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Dx.Add},{label:"Subtract",value:Dx.Subtract},{label:"Multiply",value:Dx.Multiply},{label:"Divide",value:Dx.Divide},{label:"Max",value:Dx.Max},{label:"Min",value:Dx.Min}]})],xF.prototype,"operation",void 0),(0,j.g)("BABYLON.ParticleMathBlock",xF);class FF extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("direction1",Tx.kx,!0,new u.kx(0,1,0)),this.registerInput("direction2",Tx.kx,!0,new u.kx(0,1,0)),this.registerInput("minEmitBox",Tx.kx,!0,new u.kx(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Tx.kx,!0,new u.kx(.5,.5,.5)),this.registerOutput("output",Tx.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const x=this.particle.getConnectedValue(Z);x._directionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.direction1.getConnectedValue(Z),f=this.direction2.getConnectedValue(Z),Y=(0,t.RandomRange)(G.x,f.x),j=(0,t.RandomRange)(G.y,f.y),d=(0,t.RandomRange)(G.z,f.z);Z.isEmitterTransformNode?u.kx.TransformNormalFromFloatsToRef(Y,j,d,Z.emitterWorldMatrix,F.direction):F.direction.Jj(Y,j,d)},x._positionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.minEmitBox.getConnectedValue(Z),f=this.maxEmitBox.getConnectedValue(Z),Y=(0,t.RandomRange)(G.x,f.x),j=(0,t.RandomRange)(G.y,f.y),d=(0,t.RandomRange)(G.z,f.z);Z.isEmitterTransformNode?u.kx.TransformCoordinatesFromFloatsToRef(Y,j,d,Z.emitterWorldMatrix,F.position):(F.position.Jj(Y,j,d),F.position.addInPlace(Z.emitterPosition))},this.output._storedValue=x}}(0,j.g)("BABYLON.BoxShapeBlock",FF);class uF extends nx{constructor(Z){super(Z),this.registerInput("emitPower",Tx.Float,!0,1),this.registerInput("lifeTime",Tx.Float,!0,1),this.registerInput("color",Tx.kj,!0,new Y.kj(1,1,1,1)),this.registerInput("scale",Tx.Vector2,!0,new u.Vector2(1,1)),this.registerInput("angle",Tx.Float,!0,0),this.registerOutput("particle",Tx.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(Z){const x=new jx(this.name,Z.Kx,Z.mx,null,!1,void 0,!0);x.particleEmitterType=new M,x._lifeTimeCreation.process=(x,F)=>{Z.particleContext=x,x.lifeTime=this.lifeTime.getConnectedValue(Z),F._emitPower=this.emitPower.getConnectedValue(Z)},x._colorCreation.process=x=>{Z.particleContext=x,x.color.G(this.color.getConnectedValue(Z))},x._sizeCreation.process=x=>{Z.particleContext=x,x.size=1,x.scale.G(this.scale.getConnectedValue(Z))},x._angleCreation.process=x=>{Z.particleContext=x,x.angle=this.angle.getConnectedValue(Z)},this.particle._storedValue=x}}(0,j.g)("BABYLON.CreateParticleBlock",uF);class GF{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const Z=[];for(const x of this.attachedBlocks)x.isInput&&Z.push(x);return Z}constructor(Z){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new I.b,this.name=Z}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(Z)&&this.attachedBlocks.push(Z);for(const F of Z.inputs){const u=F.connectedPoint;if(u){const F=u.ownerBlock;F!==Z&&this._initializeBlock(F,x)}}}async buildAsync(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((F=>{const u=new Kx;for(const Z of this._systemBlocks)this._initializeBlock(Z);for(const G of this.systemBlocks){const F=new ax;F.buildId=this._buildId++,F.mx=Z,F.verbose=x;const f=G.createSystem(F);F.emitErrors(),u.systems.push(f)}this.onBuildObservable.notifyObservers(this),F(u)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const Z=new rx("Particle system"),x=new ZF("Update position");x.output.connectTo(Z.particle);const F=new zx("Position");F.contextualValue=hx.Position;const u=new zx("Scaled direction");u.contextualValue=hx.ScaledDirection;const G=new xF("Add");G.operation=Dx.Add,F.output.connectTo(G.left),u.output.connectTo(G.right),G.output.connectTo(x.position);const f=new uF("Create particle"),Y=new FF("Box shape");f.particle.connectTo(Y.particle),Y.output.connectTo(x.particle);const j=new Px("Texture");j.texture.connectTo(Z.texture),j.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(Z)}removeBlock(Z){const x=this.attachedBlocks.indexOf(Z);if(x>-1&&this.attachedBlocks.splice(x,1),Z.isSystem){const x=this._systemBlocks.indexOf(Z);x>-1&&this._systemBlocks.splice(x,1)}}parseSerializedObject(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x||this.clear();const F={};for(const u of Z.So){const Z=(0,j.e)(u.customType);if(Z){const x=new Z;x._deserialize(u),F[u.id]=x,this.attachedBlocks.push(x),x.isSystem&&this._systemBlocks.push(x)}}for(const u of this.attachedBlocks)if(u.isTeleportOut){const Z=u,x=Z._tempEntryPointUniqueId;if(x){const u=F[x];u&&u.attachToEndpoint(Z)}}for(let u=0;u<Z.So.length;u++){const G=Z.So[u],f=F[G.id];f&&(f.inputs.length&&G.inputs.some((Z=>Z.targetConnectionName))&&!x||this._restoreConnections(f,Z,F))}if(Z.locations||Z.editorData&&Z.editorData.locations){const u=Z.locations||Z.editorData.locations;for(const Z of u)F[Z.MG]&&(Z.MG=F[Z.MG].uniqueId);x&&this.editorData&&this.editorData.locations&&u.concat(this.editorData.locations),Z.locations?this.editorData={locations:u}:(this.editorData=Z.editorData,this.editorData.locations=u);const G=[];for(const Z in F)G[Z]=F[Z].uniqueId;this.editorData.map=G}this.comment=Z.comment}_restoreConnections(Z,x,F){for(const u of Z.outputs)for(const G of x.So){const f=F[G.id];if(f)for(const Y of G.inputs)if(F[Y.targetBlockId]!==Z||Y.targetConnectionName!==u.name);else{const Z=f.getInputByName(Y.inputName);if(!Z||Z.isConnected)continue;u.connectTo(Z,!0),this._restoreConnections(f,x,F)}}}serialize(Z){const x=Z?{}:b.c.Serialize(this);x.editorData=JSON.parse(JSON.stringify(this.editorData));let F=[];Z?F=Z:x.customType="BABYLON.NodeParticleSystemSet",x.So=[];for(const u of F)x.So.push(u.serialize());if(!Z)for(const u of this.attachedBlocks)-1===F.indexOf(u)&&x.So.push(u.serialize());return x}dispose(){for(const Z of this.attachedBlocks)Z.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(Z){const x=new GF(Z);return x.setToDefault(),x}static Parse(Z){const x=b.c.Parse((()=>new GF(Z.name)),Z,null);return x.parseSerializedObject(Z),x}static ParseFromSnippetAsync(Z,x){return"_BLANK"===Z?Promise.resolve(GF.CreateDefault("blank")):new Promise(((F,u)=>{const G=new yx.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const Y=JSON.parse(JSON.parse(G.responseText).jsonPayload),j=JSON.parse(Y.nodeParticle);x||(x=b.c.Parse((()=>new GF(Z)),j,null)),x.parseSerializedObject(j),x.snippetId=Z;try{F(x)}catch(f){u(f)}}else u("Unable to load the snippet "+Z)})),G.open("GET",this.SnippetUrl+"/"+Z.replace(/#/g,"/")),G.send()}))}}GF.EditorURL=`${Lx.Tools._DefaultCdnUrl}/v${VZ.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,GF.SnippetUrl="https://snippet.babylonjs.com",(0,i.d)([(0,e.H)()],GF.prototype,"name",void 0),(0,i.d)([(0,e.H)("comment")],GF.prototype,"comment",void 0),function(Z){Z[Z.None=0]="None",Z[Z.PerParticle=1]="PerParticle",Z[Z.PerSystem=2]="PerSystem"}(Qx||(Qx={}));class fF extends nx{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Qx.PerParticle,this.registerInput("min",Tx.AutoDetect,!0,0),this.registerInput("max",Tx.AutoDetect,!0,1),this.registerOutput("output",Tx.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tx.Float|Tx.Int|Tx.Vector2|Tx.kx|Tx.kj),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tx.Float|Tx.Int|Tx.Vector2|Tx.kx|Tx.kj),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Tx.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case Tx.AutoDetect:case Tx.Int:case Tx.Float:Z=Z=>{const x=this.min.getConnectedValue(Z)||0,F=this.max.getConnectedValue(Z)||1;return x+Math.random()*(F-x)};break;case Tx.Vector2:Z=Z=>{const x=this.min.getConnectedValue(Z)||u.Vector2.Zero(),F=this.max.getConnectedValue(Z)||u.Vector2.One();return new u.Vector2(x.x+Math.random()*(F.x-x.x),x.y+Math.random()*(F.y-x.y))};break;case Tx.kx:Z=Z=>{const x=this.min.getConnectedValue(Z)||u.kx.Zero(),F=this.max.getConnectedValue(Z)||u.kx.One();return new u.kx(x.x+Math.random()*(F.x-x.x),x.y+Math.random()*(F.y-x.y),x.z+Math.random()*(F.z-x.z))};break;case Tx.kj:Z=Z=>{const x=this.min.getConnectedValue(Z)||new Y.kj(0,0,0,0),F=this.max.getConnectedValue(Z)||new Y.kj(1,1,1,1);return new Y.kj(x.x+Math.random()*(F.x-x.x),x.y+Math.random()*(F.y-x.y),x.z+Math.random()*(F.z-x.z),x.w+Math.random()*(F.w-x.w))}}this.output._storedFunction=x=>{var F;let u=0;switch(this.lockMode){case Qx.PerParticle:u=(null===(F=x.particleContext)||void 0===F?void 0:F.id)||-1;break;case Qx.PerSystem:u=x.buildId||0}return this._currentLockId!==u&&(this.lockMode!==Qx.None&&(this._currentLockId=u),this.output._storedValue=Z(x)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),this.lockMode=Z.lockMode}}(0,i.d)([Vx("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Qx.None},{label:"Per particle",value:Qx.PerParticle},{label:"Per system",value:Qx.PerSystem}]})],fF.prototype,"lockMode",void 0),(0,j.g)("BABYLON.ParticleRandomBlock",fF);class YF extends nx{constructor(Z){super(Z),this._currentLockId=-2,this.lockMode=Qx.PerParticle,this.registerInput("min",Tx.AutoDetect),this.registerInput("max",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const x=[Tx.Matrix,Tx.Particle,Tx.Texture,Tx.System,Tx.FloatGradient,Tx.Color4Gradient,Tx.Vector2Gradient,Tx.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...x),this.max.excludedConnectionPointTypes.push(...x)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let Z=null;switch(this._currentLockId=-2,this.min.type){case Tx.Float:case Tx.Int:Z=Z=>{const x=this.min.getConnectedValue(Z),F=this.max.getConnectedValue(Z);return Math.random()*(F-x)+x};break;case Tx.Vector2:Z=Z=>{const x=this.min.getConnectedValue(Z),F=this.max.getConnectedValue(Z);return new u.Vector2(Math.random()*(F.x-x.x)+x.x,Math.random()*(F.y-x.y)+x.y)};break;case Tx.kx:Z=Z=>{const x=this.min.getConnectedValue(Z),F=this.max.getConnectedValue(Z);return new u.kx(Math.random()*(F.x-x.x)+x.x,Math.random()*(F.y-x.y)+x.y,Math.random()*(F.z-x.z)+x.z)};break;case Tx.kj:Z=Z=>{const x=this.min.getConnectedValue(Z),F=this.max.getConnectedValue(Z);return new Y.kj(Math.random()*(F.r-x.r)+x.r,Math.random()*(F.g-x.g)+x.g,Math.random()*(F.b-x.b)+x.b,Math.random()*(F.a-x.a)+x.a)}}this.output._storedFunction=x=>{var F;let u=0;switch(this.lockMode){case Qx.PerParticle:u=(null===(F=x.particleContext)||void 0===F?void 0:F.id)||-1;break;case Qx.PerSystem:u=x.buildId||0}return this._currentLockId!==u&&(this.lockMode!==Qx.None&&(this._currentLockId=u),this.output._storedValue=Z(x)),this.output._storedValue}}serialize(){const Z=super.serialize();return Z.lockMode=this.lockMode,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.lockMode&&(this.lockMode=Z.lockMode)}}(0,i.d)([Vx("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Qx.None},{label:"Per particle",value:Qx.PerParticle},{label:"Per system",value:Qx.PerSystem}]})],YF.prototype,"lockMode",void 0),(0,j.g)("BABYLON.RandomRangeBlock",YF);(0,j.g)("BABYLON.ParticleLerpBlock",class extends nx{constructor(Z){super(Z),this.registerInput("left",Tx.AutoDetect),this.registerInput("right",Tx.AutoDetect),this.registerInput("gradient",Tx.Float,!0,0,0,1),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tx.Float|Tx.Int|Tx.Vector2|Tx.kx|Tx.kj)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const Z=(Z,x,F)=>(1-Z)*x+Z*F;this.output._storedFunction=x=>{const F=this.left.getConnectedValue(x),G=this.right.getConnectedValue(x),f=this.gradient.getConnectedValue(x);switch(this.left.type){case Tx.Int:case Tx.Float:return Z(f,F,G);case Tx.Vector2:return new u.Vector2(Z(f,F.x,G.x),Z(f,F.y,G.y));case Tx.kx:return new u.kx(Z(f,F.x,G.x),Z(f,F.y,G.y),Z(f,F.z,G.z));case Tx.kj:return new Y.kj(Z(f,F.r,G.r),Z(f,F.g,G.g),Z(f,F.b,G.b),Z(f,F.a,G.a))}return 0}}});(0,j.g)("BABYLON.UpdateDirectionBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("direction",Tx.kx),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.direction.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.direction.G(this.direction.getConnectedValue(Z))},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}});(0,j.g)("BABYLON.UpdateColorBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("color",Tx.kj),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.color.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.color.G(this.color.getConnectedValue(Z))},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}});(0,j.g)("BABYLON.UpdateScaleBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("scale",Tx.Vector2),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.scale.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.scale.G(this.scale.getConnectedValue(Z))},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}});(0,j.g)("BABYLON.UpdateAngleBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("angle",Tx.Float),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.angle.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.angle=this.angle.getConnectedValue(Z)},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}});(0,j.g)("BABYLON.BasicPositionUpdateBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(Z){const x=this.particle.getConnectedValue(Z),F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.direction.scaleToRef(x._directionScale,x._scaledDirection),F.position.addInPlace(x._scaledDirection)},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F,this.output._storedValue=x}});(0,j.g)("BABYLON.BasicSpriteUpdateBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(Z){const x=this.particle.getConnectedValue(Z),F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.updateCellIndex()},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F,this.output._storedValue=x}});(0,j.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("cellIndex",Tx.Int),this.registerOutput("output",Tx.Particle),this.cellIndex.acceptedConnectionPointTypes=[Tx.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(Z){const x=this.particle.getConnectedValue(Z);if(this.output._storedValue=x,!this.cellIndex.isConnected)return;const F={process:F=>{Z.particleContext=F,Z.systemContext=x,F.cellIndex=Math.floor(this.cellIndex.getConnectedValue(Z))},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F}});class jF extends nx{constructor(Z){super(Z),this.strength=1,this.registerInput("particle",Tx.Particle),this.registerInput("flowMap",Tx.Texture),this.registerOutput("output",Tx.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(Z){var x;const F=this.particle.getConnectedValue(Z),u=Z.mx;let G;(null===(x=this.flowMap.connectedPoint)||void 0===x?void 0:x.ownerBlock).extractTextureContentAsync().then((Z=>{Z&&(G=new wx(Z.width,Z.height,Z.data))}));const f={process:Z=>{const x=u.getTransformMatrix();G&&G._processParticle(Z,this.strength*F._tempScaledUpdateSpeed,x)},previousItem:null,nextItem:null};F._updateQueueStart?XZ(f,F._updateQueueStart):F._updateQueueStart=f,this.output._storedValue=F}serialize(){const Z=super.serialize();return Z.strength=this.strength,Z}_deserialize(Z){super._deserialize(Z),this.strength=Z.strength}}(0,i.d)([Vx("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],jF.prototype,"strength",void 0),(0,j.g)("BABYLON.UpdateFlowMapBlock",jF);(0,j.g)("BABYLON.SphereShapeBlock",class extends nx{constructor(Z){super(Z),this.registerInput("input",Tx.Particle),this.registerInput("radius",Tx.Float,!0,1),this.registerInput("radiusRange",Tx.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tx.Float,!0,0,0,1),this.registerOutput("output",Tx.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(Z){const x=this.input.getConnectedValue(Z);x._directionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.directionRandomizer.getConnectedValue(Z),f=F.position.Mx(Z.emitterPosition).normalize(),Y=(0,t.RandomRange)(0,G),j=(0,t.RandomRange)(0,G),d=(0,t.RandomRange)(0,G);f.x+=Y,f.y+=j,f.z+=d,f.normalize(),Z.isEmitterTransformNode?u.kx.TransformNormalFromFloatsToRef(Y,j,d,Z.emitterWorldMatrix,F.direction):F.direction.Jj(Y,j,d)},x._positionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.radius.getConnectedValue(Z),f=this.radiusRange.getConnectedValue(Z),Y=G-(0,t.RandomRange)(0,G*f),j=(0,t.RandomRange)(0,1),d=(0,t.RandomRange)(0,2*Math.PI),o=Math.acos(2*j-1),c=Y*Math.cos(d)*Math.sin(o),s=Y*Math.cos(o),J=Y*Math.sin(d)*Math.sin(o);Z.isEmitterTransformNode?u.kx.TransformCoordinatesFromFloatsToRef(c,s,J,Z.emitterWorldMatrix,F.position):(F.position.Jj(c,s,J),F.position.addInPlace(Z.emitterPosition))},this.output._storedValue=x}});(0,j.g)("BABYLON.PointShapeBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("direction1",Tx.kx,!0,new u.kx(0,1,0)),this.registerInput("direction2",Tx.kx,!0,new u.kx(0,1,0)),this.registerOutput("output",Tx.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const x=this.particle.getConnectedValue(Z);x._directionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.direction1.getConnectedValue(Z),f=this.direction2.getConnectedValue(Z),Y=(0,t.RandomRange)(G.x,f.x),j=(0,t.RandomRange)(G.y,f.y),d=(0,t.RandomRange)(G.z,f.z);Z.isEmitterTransformNode?u.kx.TransformNormalFromFloatsToRef(Y,j,d,Z.emitterWorldMatrix,F.direction):F.direction.Jj(Y,j,d)},x._positionCreation.process=F=>{Z.systemContext=x,Z.isEmitterTransformNode?u.kx.TransformCoordinatesFromFloatsToRef(0,0,0,Z.emitterWorldMatrix,F.position):F.position.G(Z.emitterPosition)},this.output._storedValue=x}});(0,j.g)("BABYLON.CustomShapeBlock",class extends nx{constructor(Z){super(Z),this.registerInput("particle",Tx.Particle),this.registerInput("position",Tx.kx,!0,new u.kx(0,0,0)),this.registerInput("direction",Tx.kx,!0,new u.kx(0,1,0)),this.registerOutput("output",Tx.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){const x=this.particle.getConnectedValue(Z);x._directionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.direction.getConnectedValue(Z);Z.isEmitterTransformNode?u.kx.TransformNormalToRef(G,Z.emitterWorldMatrix,F.direction):F.direction.G(G)},x._positionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.position.getConnectedValue(Z);Z.isEmitterTransformNode?u.kx.TransformCoordinatesToRef(G,Z.emitterWorldMatrix,F.position):(F.position.G(G),F.position.addInPlace(Z.emitterPosition))},this.output._storedValue=x}});(0,j.g)("BABYLON.CylinderShapeBlock",class extends nx{constructor(Z){super(Z),this._tempVector=u.kx.Zero(),this.registerInput("particle",Tx.Particle),this.registerInput("radius",Tx.Float,!0,1),this.registerInput("height",Tx.Float,!0,1,0),this.registerInput("radiusRange",Tx.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tx.Float,!0,0,0,1),this.registerOutput("output",Tx.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(Z){const x=this.particle.getConnectedValue(Z);x._directionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.directionRandomizer.getConnectedValue(Z);F.position.subtractToRef(Z.emitterPosition,this._tempVector),this._tempVector.normalize(),Z.isEmitterTransformNode&&u.kx.TransformNormalToRef(this._tempVector,Z.emitterInverseWorldMatrix,this._tempVector);const f=(0,t.RandomRange)(-G/2,G/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,t.RandomRange)(-Math.PI/2,Math.PI/2)*G,this._tempVector.y=f,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),Z.isEmitterTransformNode?u.kx.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,Z.emitterWorldMatrix,F.direction):F.direction.G(this._tempVector)},x._positionCreation.process=F=>{Z.particleContext=F,Z.systemContext=x;const G=this.height.getConnectedValue(Z),f=this.radiusRange.getConnectedValue(Z),Y=this.radius.getConnectedValue(Z),j=(0,t.RandomRange)(-G/2,G/2),d=(0,t.RandomRange)(0,2*Math.PI),o=(0,t.RandomRange)((1-f)*(1-f),1),c=Math.sqrt(o)*Y,s=c*Math.cos(d),J=c*Math.sin(d);Z.isEmitterTransformNode?u.kx.TransformCoordinatesFromFloatsToRef(s,j,J,Z.emitterWorldMatrix,F.position):(F.position.Jj(s,j,J),F.position.addInPlace(Z.emitterPosition))},this.output._storedValue=x}});class dF extends nx{constructor(Z){super(Z),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Tx.Particle),this.registerOutput("output",Tx.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const x=this.particle.getConnectedValue(Z);x._isAnimationSheetEnabled=!0,x.spriteCellWidth=this.width,x.spriteCellHeight=this.height,x.startSpriteCellID=this.start,x.endSpriteCellID=this.end,x.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=x}serialize(){const Z=super.serialize();return Z.width=this.width,Z.height=this.height,Z.start=this.start,Z.end=this.end,Z.randomStartCell=this.randomStartCell,Z}_deserialize(Z){super._deserialize(Z),this.width=Z.width,this.height=Z.height,this.start=Z.start,this.end=Z.end,this.randomStartCell=Z.randomStartCell}}(0,i.d)([Vx("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dF.prototype,"start",void 0),(0,i.d)([Vx("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dF.prototype,"end",void 0),(0,i.d)([Vx("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dF.prototype,"width",void 0),(0,i.d)([Vx("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dF.prototype,"height",void 0),(0,i.d)([Vx("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dF.prototype,"loop",void 0),(0,i.d)([Vx("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dF.prototype,"randomStartCell",void 0),(0,j.g)("BABYLON.SetupSpriteSheetBlock",dF);class tF extends nx{constructor(Z){super(Z),this.reference=0,this.registerInput("value",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case Tx.Float:return Tx.FloatGradient;case Tx.Vector2:return Tx.Vector2Gradient;case Tx.kx:return Tx.Vector3Gradient;case Tx.kj:return Tx.Color4Gradient}return Z},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tx.Float|Tx.Vector2|Tx.kx|Tx.kj)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=Z=>null}serialize(){const Z=super.serialize();return Z.reference=this.reference,Z}_deserialize(Z){super._deserialize(Z),this.reference=Z.reference}}(0,i.d)([Vx("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],tF.prototype,"reference",void 0),(0,j.g)("BABYLON.ParticleGradientValueBlock",tF);(0,j.g)("BABYLON.ParticleGradientBlock",class extends nx{constructor(Z){super(Z),this._entryCount=1,this.registerInput("gradient",Tx.Float,!0,1,0,1),this.registerInput("value0",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=Z=>{switch(Z){case Tx.FloatGradient:return Tx.Float;case Tx.Vector2Gradient:return Tx.Vector2;case Tx.Vector3Gradient:return Tx.kx;case Tx.Color4Gradient:return Tx.kj}return Z},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tx.FloatGradient|Tx.Vector2Gradient|Tx.Vector3Gradient|Tx.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(Z){this._inputs[Z].onConnectionObservable.add((()=>{this._entryCount>Z||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Tx.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const Z=[];for(let F=1;F<this._inputs.length;F++){var x;if(this._inputs[F].isConnected)Z.push(null===(x=this._inputs[F].connectedPoint)||void 0===x?void 0:x.ownerBlock)}Z.sort(((Z,x)=>Z.reference-x.reference)),this.output._storedFunction=x=>{const F=this.gradient.getConnectedValue(x);if(1===Z.length)return Z[0].value.getConnectedValue(x);let G=null;for(let f=Z.length-1;f>=0;f--){const j=Z[f];if(j.reference<=F){const Z=j.value.getConnectedValue(x);if(G){const f=G.value.getConnectedValue(x),d=G.reference,o=j.reference,c=Math.max(0,Math.min(1,(F-o)/(d-o)));switch(this.output.type){case Tx.Float:return(0,t.Lerp)(Z,f,c);case Tx.Vector2:return u.Vector2.Lerp(Z,f,c);case Tx.kx:return u.kx.Lerp(Z,f,c);case Tx.kj:return Y.kj.Lerp(Z,f,c)}}return Z}G=j}return 0}}});(0,j.g)("BABYLON.ParticleConverterBlock",class extends nx{constructor(Z){super(Z),this.registerInput("color ",Tx.kj,!0),this.registerInput("xyz ",Tx.kx,!0),this.registerInput("xy ",Tx.Vector2,!0),this.registerInput("zw ",Tx.Vector2,!0),this.registerInput("x ",Tx.Float,!0),this.registerInput("y ",Tx.Float,!0),this.registerInput("z ",Tx.Float,!0),this.registerInput("w ",Tx.Float,!0),this.registerOutput("color",Tx.kj),this.registerOutput("xyz",Tx.kx),this.registerOutput("xy",Tx.Vector2),this.registerOutput("zw",Tx.Vector2),this.registerOutput("x",Tx.Float),this.registerOutput("y",Tx.Float),this.registerOutput("z",Tx.Float),this.registerOutput("w",Tx.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(Z){return"color "===Z?"colorIn":"xyz "===Z?"xyzIn":"xy "===Z?"xyIn":"zw "===Z?"zwIn":"x "===Z?"xIn":"y "===Z?"yIn":"z "===Z?"zIn":"w "===Z?"wIn":Z}_outputRename(Z){switch(Z){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return Z}}_build(Z){super._build(Z);const x=this.xIn,F=this.yIn,G=this.zIn,f=this.wIn,j=this.xyIn,d=this.zwIn,t=this.xyzIn,o=this.colorIn,c=this.colorOut,s=this.xyzOut,J=this.xyOut,p=this.zwOut,U=this.xOut,k=this.yOut,M=this.zOut,m=this.wOut,C=Z=>{if(o.isConnected)return o.getConnectedValue(Z);let u=0,c=0,s=0,J=0;if(x.isConnected&&(u=x.getConnectedValue(Z)),F.isConnected&&(c=F.getConnectedValue(Z)),G.isConnected&&(s=G.getConnectedValue(Z)),f.isConnected&&(J=f.getConnectedValue(Z)),j.isConnected){const x=j.getConnectedValue(Z);x&&(u=x.x,c=x.y)}if(d.isConnected){const x=d.getConnectedValue(Z);x&&(s=x.x,J=x.y)}if(t.isConnected){const x=t.getConnectedValue(Z);x&&(u=x.x,c=x.y,s=x.z)}return new Y.kj(u,c,s,J)};c._storedFunction=Z=>C(Z),s._storedFunction=Z=>{const x=C(Z);return new u.kx(x.r,x.g,x.b)},J._storedFunction=Z=>{const x=C(Z);return new u.Vector2(x.r,x.g)},p._storedFunction=Z=>{const x=C(Z);return new u.Vector2(x.b,x.a)},U._storedFunction=Z=>C(Z).r,k._storedFunction=Z=>C(Z).g,M._storedFunction=Z=>C(Z).b,m._storedFunction=Z=>C(Z).a}}),function(Z){Z[Z.Cos=0]="Cos",Z[Z.Sin=1]="Sin",Z[Z.Abs=2]="Abs",Z[Z.Exp=3]="Exp",Z[Z.Exp2=4]="Exp2",Z[Z.Round=5]="Round",Z[Z.Floor=6]="Floor",Z[Z.Ceiling=7]="Ceiling",Z[Z.Sqrt=8]="Sqrt",Z[Z.Log=9]="Log",Z[Z.Tan=10]="Tan",Z[Z.ArcTan=11]="ArcTan",Z[Z.ArcCos=12]="ArcCos",Z[Z.ArcSin=13]="ArcSin",Z[Z.Sign=14]="Sign",Z[Z.Negate=15]="Negate",Z[Z.OneMinus=16]="OneMinus",Z[Z.Reciprocal=17]="Reciprocal",Z[Z.ToDegrees=18]="ToDegrees",Z[Z.ToRadians=19]="ToRadians",Z[Z.Fract=20]="Fract"}(gx||(gx={}));class oF extends nx{constructor(Z){super(Z),this.operation=gx.Cos,this.registerInput("input",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tx.Float|Tx.Int|Tx.Vector2|Tx.kx|Tx.kj)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);let x=null;switch(this.operation){case gx.Cos:x=Z=>Math.cos(Z);break;case gx.Sin:x=Z=>Math.sin(Z);break;case gx.Abs:x=Z=>Math.abs(Z);break;case gx.Exp:x=Z=>Math.exp(Z);break;case gx.Exp2:x=Z=>Math.pow(2,Z);break;case gx.Round:x=Z=>Math.round(Z);break;case gx.Floor:x=Z=>Math.floor(Z);break;case gx.Ceiling:x=Z=>Math.ceil(Z);break;case gx.Sqrt:x=Z=>Math.sqrt(Z);break;case gx.Log:x=Z=>Math.log(Z);break;case gx.Tan:x=Z=>Math.tan(Z);break;case gx.ArcTan:x=Z=>Math.atan(Z);break;case gx.ArcCos:x=Z=>Math.acos(Z);break;case gx.ArcSin:x=Z=>Math.asin(Z);break;case gx.Sign:x=Z=>Math.sign(Z);break;case gx.Negate:x=Z=>-Z;break;case gx.OneMinus:x=Z=>1-Z;break;case gx.Reciprocal:x=Z=>1/Z;break;case gx.ToRadians:x=Z=>Z*Math.PI/180;break;case gx.ToDegrees:x=Z=>180*Z/Math.PI;break;case gx.Fract:x=Z=>Z>=0?Z-Math.floor(Z):Z-Math.ceil(Z)}if(!x)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Tx.Int:case Tx.Float:this.output._storedFunction=Z=>{const F=this.input.getConnectedValue(Z);return x(F)};break;case Tx.Vector2:this.output._storedFunction=Z=>{const F=this.input.getConnectedValue(Z);return new u.Vector2(x(F.x),x(F.y))};break;case Tx.kx:this.output._storedFunction=Z=>{const F=this.input.getConnectedValue(Z);return new u.kx(x(F.x),x(F.y),x(F.z))};break;case Tx.kj:this.output._storedFunction=Z=>{const F=this.input.getConnectedValue(Z);return new Y.kj(x(F.r),x(F.g),x(F.b),x(F.a))}}return this}serialize(){const Z=super.serialize();return Z.operation=this.operation,Z}_deserialize(Z){super._deserialize(Z),this.operation=Z.operation}}(0,i.d)([Vx("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:gx.Cos},{label:"Sin",value:gx.Sin},{label:"Abs",value:gx.Abs},{label:"Exp",value:gx.Exp},{label:"Exp2",value:gx.Exp2},{label:"Round",value:gx.Round},{label:"Floor",value:gx.Floor},{label:"Ceiling",value:gx.Ceiling},{label:"Sqrt",value:gx.Sqrt},{label:"Log",value:gx.Log},{label:"Tan",value:gx.Tan},{label:"ArcTan",value:gx.ArcTan},{label:"ArcCos",value:gx.ArcCos},{label:"ArcSin",value:gx.ArcSin},{label:"Sign",value:gx.Sign},{label:"Negate",value:gx.Negate},{label:"OneMinus",value:gx.OneMinus},{label:"Reciprocal",value:gx.Reciprocal},{label:"ToDegrees",value:gx.ToDegrees},{label:"ToRadians",value:gx.ToRadians},{label:"Fract",value:gx.Fract}]})],oF.prototype,"operation",void 0),(0,j.g)("BABYLON.ParticleTrigonometryBlock",oF);var cF,sF=F(12643);class JF extends nx{constructor(Z){super(Z),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Tx.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Tx.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tx.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tx.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tx.System),this._inputs[0].excludedConnectionPointTypes.push(Tx.Particle),this._inputs[0].excludedConnectionPointTypes.push(Tx.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const x=Z=>{const x=this.input.getConnectedValue(Z);if(this.log.length>=this.stackSize)return x;if(null===x||void 0===x)return this.log.push(["null",""]),x;switch(this.input.type){case Tx.Vector2:this.log.push([(0,sF.g)(x,4),x.toString()]);break;case Tx.kx:this.log.push([(0,sF.j)(x,4),x.toString()]);break;case Tx.kj:this.log.push([`{R: ${x.r.toFixed(4)} G: ${x.g.toFixed(4)} B: ${x.b.toFixed(4)} A: ${x.a.toFixed(4)}}`,x.toString()]);break;default:this.log.push([x.toString(),x.toString()])}return x};this.output.isConnected?this.output._storedFunction=x:this.output._storedValue=x(Z)}serialize(){const Z=super.serialize();return Z.stackSize=this.stackSize,Z}_deserialize(Z){super._deserialize(Z),this.stackSize=Z.stackSize}}(0,i.d)([Vx("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],JF.prototype,"stackSize",void 0),(0,j.g)("BABYLON.ParticleDebugBlock",JF);(0,j.g)("BABYLON.ParticleElbowBlock",class extends nx{constructor(Z){super(Z),this.registerInput("input",Tx.AutoDetect),this.registerOutput("output",Tx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(Z){super._build(Z);const x=this._outputs[0],F=this._inputs[0];x._storedFunction=Z=>F.getConnectedValue(Z)}});(0,j.g)("BABYLON.ParticleTeleportInBlock",class extends nx{get endpoints(){return this._endpoints}constructor(Z){super(Z),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Tx.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(Z){if(this.getClassName()===Z)return!0;for(const x of this.endpoints)if(x.isAnAncestorOfType(Z))return!0;return!1}isAnAncestorOf(Z){for(const x of this.endpoints){if(x===Z)return!0;if(x.isAnAncestorOf(Z))return!0}return!1}attachToEndpoint(Z){Z.detach(),this._endpoints.push(Z),Z._entryPoint=this,Z._outputs[0]._typeConnectionSource=this._inputs[0],Z._tempEntryPointUniqueId=null,Z.name="> "+this.name}detachFromEndpoint(Z){const x=this._endpoints.indexOf(Z);-1!==x&&(this._endpoints.splice(x,1),Z._outputs[0]._typeConnectionSource=null,Z._entryPoint=null)}_build(){for(const Z of this._endpoints)Z.output._storedFunction=Z=>this.input.getConnectedValue(Z)}});(0,j.g)("BABYLON.ParticleTeleportOutBlock",class extends nx{constructor(Z){super(Z),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Tx.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(Z){this.entryPoint&&this.entryPoint.build(Z)}clone(){const Z=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(Z),Z}serialize(){var Z;const x=super.serialize();return x.entryPoint=(null===(Z=this.entryPoint)||void 0===Z?void 0:Z.uniqueId)??"",x}_deserialize(Z){super._deserialize(Z),this._tempEntryPointUniqueId=Z.entryPoint}}),function(Z){Z[Z.Equal=0]="Equal",Z[Z.NotEqual=1]="NotEqual",Z[Z.LessThan=2]="LessThan",Z[Z.GreaterThan=3]="GreaterThan",Z[Z.LessOrEqual=4]="LessOrEqual",Z[Z.GreaterOrEqual=5]="GreaterOrEqual",Z[Z.Xor=6]="Xor",Z[Z.Or=7]="Or",Z[Z.And=8]="And"}(cF||(cF={}));class pF extends nx{constructor(Z){super(Z),this.test=cF.Equal,this.epsilon=0,this.registerInput("left",Tx.Float),this.registerInput("right",Tx.Float,!0,0),this.registerInput("ifTrue",Tx.AutoDetect,!0,1),this.registerInput("ifFalse",Tx.AutoDetect,!0,0),this.registerOutput("output",Tx.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Tx.Float,this._inputs[0].acceptedConnectionPointTypes.push(Tx.Int),this._inputs[1].acceptedConnectionPointTypes.push(Tx.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const Z=Z=>{const x=this.left.getConnectedValue(Z),F=this.right.getConnectedValue(Z);let u=!1;switch(this.test){case cF.Equal:u=(0,t.WithinEpsilon)(x,F,this.epsilon);break;case cF.NotEqual:u=!(0,t.WithinEpsilon)(x,F,this.epsilon);break;case cF.LessThan:u=x<F+this.epsilon;break;case cF.GreaterThan:u=x>F-this.epsilon;break;case cF.LessOrEqual:u=x<=F+this.epsilon;break;case cF.GreaterOrEqual:u=x>=F-this.epsilon;break;case cF.Xor:u=!!x&&!F||!x&&!!F;break;case cF.Or:u=!!x||!!F;break;case cF.And:u=!!x&&!!F}return u};this.output._storedFunction=x=>Z(x)?this.ifTrue.getConnectedValue(x):this.ifFalse.getConnectedValue(x)}serialize(){const Z=super.serialize();return Z.test=this.test,Z.epsilon=this.epsilon,Z}_deserialize(Z){super._deserialize(Z),this.test=Z.test,void 0!==Z.epsilon&&(this.epsilon=Z.epsilon)}}(0,i.d)([Vx("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:cF.Equal},{label:"NotEqual",value:cF.NotEqual},{label:"LessThan",value:cF.LessThan},{label:"GreaterThan",value:cF.GreaterThan},{label:"LessOrEqual",value:cF.LessOrEqual},{label:"GreaterOrEqual",value:cF.GreaterOrEqual},{label:"Xor",value:cF.Xor},{label:"Or",value:cF.Or},{label:"And",value:cF.And}]})],pF.prototype,"test",void 0),(0,i.d)([Vx("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pF.prototype,"epsilon",void 0),(0,j.g)("BABYLON.ParticleConditionBlock",pF);class UF extends nx{constructor(Z){super(Z),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Tx.Particle),this.registerInput("condition",Tx.Float,!0,0),this.registerInput("system",Tx.System),this.registerOutput("output",Tx.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(Z){this._triggerCount=0;const x=this.input.getConnectedValue(Z),F={process:F=>{if(Z.particleContext=F,Z.systemContext=x,0!==this.condition.getConnectedValue(Z)&&(0===this.limit||this._triggerCount<this.limit)){const u=(new Date).getTime();if(this._previousOne&&u-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=u;const G=this.system.getConnectedValue(Z);if(G){const u=Ix(G,Z.mx,F.position);u.Uf.addOnce((()=>{this._triggerCount--})),x.Uf.addOnce((()=>{u.dispose()}))}}},previousItem:null,nextItem:null};x._updateQueueStart?XZ(F,x._updateQueueStart):x._updateQueueStart=F,this.output._storedValue=x}serialize(){const Z=super.serialize();return Z.limit=this.limit,Z.delay=this.delay,Z}_deserialize(Z){super._deserialize(Z),void 0!==Z.limit&&(this.limit=Z.limit),void 0!==Z.delay&&(this.delay=Z.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,i.d)([Vx("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UF.prototype,"limit",void 0),(0,i.d)([Vx("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],UF.prototype,"delay",void 0),(0,j.g)("BABYLON.ParticleTriggerBlock",UF);F(12647),F(12659),F(12672),F(12736)},12713:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneFragment",f="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12680:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneFragmentDeclaration",f="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12745:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneVertex",f="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12738:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneVertexDeclaration",f="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12728:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogFragment",f="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12707:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogFragmentDeclaration",f="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12747:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogVertex",f="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12742:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogVertexDeclaration",f="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12695:(Z,x,F)=>{"use strict";var u=F(11091);const G="helperFunctions",f="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12683:(Z,x,F)=>{"use strict";var u=F(11091);const G="imageProcessingDeclaration",f="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12704:(Z,x,F)=>{"use strict";var u=F(11091);const G="imageProcessingFunctions",f="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12689:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthDeclaration",f="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12722:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthFragment",f="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12751:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthVertex",f="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";u.d.IncludesShadersStoreWGSL[G]||(u.d.IncludesShadersStoreWGSL[G]=f)},12672:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{particlesPixelShaderWGSL:()=>Y});var u=F(11091);F(12680),F(12683),F(12689),F(12695),F(12704),F(12707),F(12713),F(12722),F(12728);const G="particlesPixelShader",f="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";u.d.ShadersStoreWGSL[G]||(u.d.ShadersStoreWGSL[G]=f);const Y={name:G,shader:f}},12736:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{particlesVertexShaderWGSL:()=>Y});var u=F(11091);F(12738),F(12742),F(12689),F(12745),F(12747),F(12751);const G="particlesVertexShader",f="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";u.d.ShadersStoreWGSL[G]||(u.d.ShadersStoreWGSL[G]=f);const Y={name:G,shader:f}},12566:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneFragment",f="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12651:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneFragmentDeclaration",f="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12598:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneVertex",f="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12663:(Z,x,F)=>{"use strict";var u=F(11091);const G="clipPlaneVertexDeclaration",f="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12582:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogFragment",f="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12558:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogFragmentDeclaration",f="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12607:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogVertex",f="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12589:(Z,x,F)=>{"use strict";var u=F(11091);const G="fogVertexDeclaration",f="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12550:(Z,x,F)=>{"use strict";var u=F(11091);const G="helperFunctions",f="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12537:(Z,x,F)=>{"use strict";var u=F(11091);const G="imageProcessingDeclaration",f="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12553:(Z,x,F)=>{"use strict";var u=F(11091);const G="imageProcessingFunctions",f="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12542:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthDeclaration",f="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12574:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthFragment",f="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12609:(Z,x,F)=>{"use strict";var u=F(11091);const G="logDepthVertex",f="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";u.d.IncludesShadersStore[G]||(u.d.IncludesShadersStore[G]=f)},12647:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{particlesPixelShader:()=>Y});var u=F(11091);F(12651),F(12537),F(12542),F(12550),F(12553),F(12558),F(12566),F(12574),F(12582);const G="particlesPixelShader",f="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";u.d.ShadersStore[G]||(u.d.ShadersStore[G]=f);const Y={name:G,shader:f}},12659:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{particlesVertexShader:()=>Y});var u=F(11091);F(12663),F(12589),F(12542),F(12598),F(12607),F(12609);const G="particlesVertexShader",f="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";u.d.ShadersStore[G]||(u.d.ShadersStore[G]=f);const Y={name:G,shader:f}},13012:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{FlowGraphGLTFDataProvider:()=>f});var u=F(12977),G=F(12954);class f extends u.e{constructor(Z){var x,F;super();const u=Z.glTF,f=(null===(x=u.animations)||void 0===x?void 0:x.map((Z=>Z._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",G.d,f);const Y=(null===(F=u.nodes)||void 0===F?void 0:F.map((Z=>Z._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",G.d,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12889:(Z,x,F)=>{"use strict";F.d(x,{e:()=>k,f:()=>p,j:()=>J,k:()=>U});var u=F(11179),G=F(11697),f=F(11230),Y=F(12895);const j=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class d{constructor(Z,x){this._gltf=Z,this._infoTree=x}convert(Z){let x,F=this._gltf,u=this._infoTree;if(!Z.startsWith("/"))throw new Error("Path must start with a /");const G=Z.split("/");if(G.shift(),G[G.length-1].includes(".length")){const Z=G[G.length-1].split(".");G.pop(),G.push(...Z)}let f=!1;for(const d of G){const G="length"===d;if(G&&!u.__array__)throw new Error(`Path ${Z} is invalid`);if(u.__ignoreObjectTree__&&(f=!0),u.__array__&&!G)u=u.__array__;else if(u=u[d],!u)throw new Error(`Path ${Z} is invalid`);if(!f)if(void 0===F){if(!j.find((x=>x.regex.test(Z))))throw new Error(`Path ${Z} is invalid`)}else if(!G){var Y;F=null===(Y=F)||void 0===Y?void 0:Y[d]}(u.__target__||G)&&(x=F)}return{object:x,info:u}}}function t(Z,x,F,u){const G=o(Z,x);return u?G[F][u]:G[F]}function o(Z,x,F){var u,f;return null===(u=Z._data)||void 0===u||null===(f=u[(null===F||void 0===F?void 0:F.fillMode)??G.e.MATERIAL_TriangleFillMode])||void 0===f?void 0:f.babylonMaterial}function c(Z,x){return{offset:{componentsCount:2,type:"Vector2",get:(F,G,f)=>{const Y=t(F,f,Z,x);return new u.Vector2(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:o,set:(F,u,G,f)=>{const Y=t(u,f,Z,x);Y.uOffset=F.x,Y.vOffset=F.y},getPropertyName:[()=>`${Z}${x?"."+x:""}.uOffset`,()=>`${Z}${x?"."+x:""}.vOffset`]},rotation:{type:"number",get:(F,u,G)=>{var f;return null===(f=t(F,G,Z,x))||void 0===f?void 0:f.wAng},getTarget:o,set:(F,u,G,f)=>t(u,f,Z,x).wAng=F,getPropertyName:[()=>`${Z}${x?"."+x:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(F,G,f)=>{const Y=t(F,f,Z,x);return new u.Vector2(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:o,set:(F,u,G,f)=>{const Y=t(u,f,Z,x);Y.uScale=F.x,Y.vScale=F.y},getPropertyName:[()=>`${Z}${x?"."+x:""}.uScale`,()=>`${Z}${x?"."+x:""}.vScale`]}}}const s={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:Z=>{var x,F;return new u.Vector2((null===(x=Z._babylonCamera)||void 0===x?void 0:x.orthoLeft)??0,(null===(F=Z._babylonCamera)||void 0===F?void 0:F.orthoRight)??0)},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.orthoLeft=Z.x,x._babylonCamera.orthoRight=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:Z=>{var x,F;return new u.Vector2((null===(x=Z._babylonCamera)||void 0===x?void 0:x.orthoBottom)??0,(null===(F=Z._babylonCamera)||void 0===F?void 0:F.orthoTop)??0)},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.orthoBottom=Z.x,x._babylonCamera.orthoTop=Z.y)},getTarget:Z=>Z,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.maxZ},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.hf},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.hf=Z)},getTarget:Z=>Z,getPropertyName:[()=>"hf"]}},perspective:{aspectRatio:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.getEngine().getAspectRatio(Z._babylonCamera)},getTarget:Z=>Z,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.fov},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.fov=Z)},getTarget:Z=>Z,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.maxZ},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=Z)},getTarget:Z=>Z,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:Z=>{var x;return null===(x=Z._babylonCamera)||void 0===x?void 0:x.hf},set:(Z,x)=>{x._babylonCamera&&(x._babylonCamera.hf=Z)},getTarget:Z=>Z,getPropertyName:[()=>"hf"]}}}},nodes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"kx",get:Z=>{var x;return null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.position},set:(Z,x)=>{var F;return null===(F=x._babylonTransformNode)||void 0===F?void 0:F.position.G(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:Z=>{var x;return null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.rotationQuaternion},set:(Z,x)=>{var F,u;return null===(F=x._babylonTransformNode)||void 0===F||null===(u=F.rotationQuaternion)||void 0===u?void 0:u.G(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"kx",get:Z=>{var x;return null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.pj},set:(Z,x)=>{var F;return null===(F=x._babylonTransformNode)||void 0===F?void 0:F.pj.G(Z)},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pj"]},weights:{length:{type:"number",get:Z=>Z._numMorphTargets,getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(Z,x)=>{var F,u;return void 0!==x?null===(F=Z._primitiveBabylonMeshes)||void 0===F||null===(u=F[0].morphTargetManager)||void 0===u?void 0:u.getTarget(x).influence:void 0},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(Z,x)=>[0],getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:Z=>{var x,F,G;return u.Matrix.Compose(null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.pj,null===(F=Z._babylonTransformNode)||void 0===F?void 0:F.rotationQuaternion,null===(G=Z._babylonTransformNode)||void 0===G?void 0:G.position)},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:Z=>{var x,F,G,f;const Y=u.Matrix.Identity();let j=Z.parent;for(;j&&j.parent;)j=j.parent;const d=(null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.position._isDirty)||(null===(F=Z._babylonTransformNode)||void 0===F||null===(G=F.rotationQuaternion)||void 0===G?void 0:G._isDirty)||(null===(f=Z._babylonTransformNode)||void 0===f?void 0:f.pj._isDirty);if(j){var t;const x=null===(t=j._babylonTransformNode)||void 0===t?void 0:t.Qf(!0).invert();var o,c;if(x)null===(o=Z._babylonTransformNode)||void 0===o||null===(c=o.Qf(d))||void 0===c||c.multiplyToRef(x,Y)}else Z._babylonTransformNode&&Y.G(Z._babylonTransformNode.Qf(d));return Y},getTarget:Z=>Z._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:Z=>{var x,F;return null===(x=Z._babylonTransformNode)||void 0===x||null===(F=x.getChildren((Z=>Z instanceof Y.b),!0)[0])||void 0===F?void 0:F.Cj},getTarget:Z=>{var x;return null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.getChildren((Z=>Z instanceof Y.b),!0)[0]},set:(Z,x)=>{if(x._babylonTransformNode){const F=x._babylonTransformNode.getChildren((Z=>Z instanceof Y.b),!0)[0];F&&(F.Cj=Z)}}},color:{type:"Lx",get:Z=>{var x,F;return null===(x=Z._babylonTransformNode)||void 0===x||null===(F=x.getChildren((Z=>Z instanceof Y.b),!0)[0])||void 0===F?void 0:F.Lj},getTarget:Z=>{var x;return null===(x=Z._babylonTransformNode)||void 0===x?void 0:x.getChildren((Z=>Z instanceof Y.b),!0)[0]},set:(Z,x)=>{if(x._babylonTransformNode){const F=x._babylonTransformNode.getChildren((Z=>Z instanceof Y.b),!0)[0];F&&(F.Lj=Z)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Lx",get:(Z,x,F)=>o(Z,x,F).emissiveColor,set:(Z,x,F,u)=>o(x,F,u).emissiveColor.G(Z),getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:c("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(Z,x,F)=>{var u;return null===(u=t(Z,F,"bumpTexture"))||void 0===u?void 0:u.level},set:(Z,x,F,u)=>{const G=t(x,u,"bumpTexture");G&&(G.level=Z)},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:c("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(Z,x,F)=>o(Z,x,F).ambientTextureStrength,set:(Z,x,F,u)=>{const G=o(x,F,u);G&&(G.ambientTextureStrength=Z)},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:c("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"kj",get:(Z,x,F)=>{const u=o(Z,x,F);return f.kj.FromColor3(u.albedoColor,u.alpha)},set:(Z,x,F,u)=>{const G=o(x,F,u);G.albedoColor.set(Z.r,Z.g,Z.b),G.alpha=Z.a},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:c("albedoTexture")}},metallicFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).metallic,set:(Z,x,F,u)=>{const G=o(x,F,u);G&&(G.metallic=Z)},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).roughness,set:(Z,x,F,u)=>{const G=o(x,F,u);G&&(G.roughness=Z)},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:c("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(Z,x,F)=>o(Z,x,F).anisotropy.Cj,set:(Z,x,F,u)=>{o(x,F,u).anisotropy.Cj=Z},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(Z,x,F)=>o(Z,x,F).anisotropy.angle,set:(Z,x,F,u)=>{o(x,F,u).anisotropy.angle=Z},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:c("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).clearCoat.Cj,set:(Z,x,F,u)=>{o(x,F,u).clearCoat.Cj=Z},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).clearCoat.roughness,set:(Z,x,F,u)=>{o(x,F,u).clearCoat.roughness=Z},getTarget:(Z,x,F)=>o(Z,x,F),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:c("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(Z,x,F)=>{var u;return null===(u=o(Z,x,F).clearCoat.bumpTexture)||void 0===u?void 0:u.level},getTarget:o,set:(Z,x,F,u)=>o(x,F,u).clearCoat.bumpTexture.level=Z},extensions:{KHR_texture_transform:c("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:c("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(Z,x,F)=>o(Z,x,F).subSurface.dispersion,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.dispersion=Z}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(Z,x,F)=>o(Z,x,F).emissiveIntensity,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).emissiveIntensity=Z}},KHR_materials_ior:{ior:{type:"number",get:(Z,x,F)=>o(Z,x,F).indexOfRefraction,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).indexOfRefraction=Z}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).iridescence.Cj,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).iridescence.Cj=Z},iridescenceIor:{type:"number",get:(Z,x,F)=>o(Z,x,F).iridescence.indexOfRefraction,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).iridescence.indexOfRefraction=Z},iridescenceTexture:{extensions:{KHR_texture_transform:c("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(Z,x,F)=>o(Z,x,F).iridescence.maximumThickness,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).iridescence.maximumThickness=Z},iridescenceThicknessMinimum:{type:"number",get:(Z,x,F)=>o(Z,x,F).iridescence.minimumThickness,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).iridescence.minimumThickness=Z},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:c("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Lx",get:(Z,x,F)=>o(Z,x,F).sheen.color,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).sheen.color.G(Z)},sheenColorTexture:{extensions:{KHR_texture_transform:c("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).sheen.Cj,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).sheen.Cj=Z},sheenRoughnessTexture:{extensions:{KHR_texture_transform:c("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).metallicF0Factor,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).metallicF0Factor=Z,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Lx",get:(Z,x,F)=>o(Z,x,F).metallicReflectanceColor,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).metallicReflectanceColor.G(Z),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:c("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:c("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).subSurface.refractionIntensity,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.refractionIntensity=Z,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).subSurface.translucencyIntensity,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.translucencyIntensity=Z},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Lx",get:(Z,x,F)=>o(Z,x,F).subSurface.translucencyColor,getTarget:o,set:(Z,x,F,u)=>{var G;return Z&&(null===(G=o(x,F,u).subSurface.translucencyColor)||void 0===G?void 0:G.G(Z))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Lx",get:(Z,x,F)=>o(Z,x,F).subSurface.tintColor,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.tintColor.G(Z)},attenuationDistance:{type:"number",get:(Z,x,F)=>o(Z,x,F).subSurface.tintColorAtDistance,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.tintColorAtDistance=Z},thicknessFactor:{type:"number",get:(Z,x,F)=>o(Z,x,F).subSurface.maximumThickness,getTarget:o,set:(Z,x,F,u)=>o(x,F,u).subSurface.maximumThickness=Z},thicknessTexture:{extensions:{KHR_texture_transform:c("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,color:{type:"Lx",get:Z=>{var x;return null===(x=Z._babylonLight)||void 0===x?void 0:x.Lj},set:(Z,x)=>{var F;return null===(F=x._babylonLight)||void 0===F?void 0:F.Lj.G(Z)},getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"diffuse"]},Cj:{type:"number",get:Z=>{var x;return null===(x=Z._babylonLight)||void 0===x?void 0:x.Cj},set:(Z,x)=>x._babylonLight?x._babylonLight.Cj=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"intensity"]},range:{type:"number",get:Z=>{var x;return null===(x=Z._babylonLight)||void 0===x?void 0:x.range},set:(Z,x)=>x._babylonLight?x._babylonLight.range=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"range"]},spot:{innerConeAngle:{type:"number",get:Z=>{var x;return null===(x=Z._babylonLight)||void 0===x?void 0:x.innerAngle},set:(Z,x)=>x._babylonLight?x._babylonLight.innerAngle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"innerConeAngle"]},outerConeAngle:{type:"number",get:Z=>{var x;return null===(x=Z._babylonLight)||void 0===x?void 0:x.angle},set:(Z,x)=>x._babylonLight?x._babylonLight.angle=Z:void 0,getTarget:Z=>Z._babylonLight,getPropertyName:[Z=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonLight)),getPropertyName:[Z=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonTexture)),getPropertyName:[Z=>"length"]},__array__:{__target__:!0,Cj:{type:"number",get:Z=>{var x;return null===(x=Z._babylonTexture)||void 0===x?void 0:x.level},set:(Z,x)=>{x._babylonTexture&&(x._babylonTexture.level=Z)},getTarget:Z=>Z._babylonTexture},rotation:{type:"Quaternion",get:Z=>{var x;return Z._babylonTexture&&u.Quaternion.FromRotationMatrix(null===(x=Z._babylonTexture)||void 0===x?void 0:x.getReflectionTextureMatrix())},set:(Z,x)=>{var F;x._babylonTexture&&(null!==(F=x._babylonTexture.KZ())&&void 0!==F&&F.useRightHandedSystem||(Z=u.Quaternion.Inverse(Z)),u.Matrix.FromQuaternionToRef(Z,x._babylonTexture.getReflectionTextureMatrix()))},getTarget:Z=>Z._babylonTexture}}}}},animations:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>Z._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:Z=>Z.length,getTarget:Z=>Z.map((Z=>{var x;return null===(x=Z.primitives[0]._instanceData)||void 0===x?void 0:x.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function J(Z){return new d(Z,s)}function p(Z){const x=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let F=s;for(const u of x)u&&(F=F[u]);if(F&&F.type&&F.get)return F}function U(Z,x){const F=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let u=s;for(const G of F)G&&(u=u[G]);u&&u.type&&u.get&&(u.interpolation=x)}function k(Z,x){const F=Z.split("/").map((Z=>Z.replace(/{}/g,"__array__")));let u=s;for(const G of F)if(G){if(!u[G]){if("?"===G){u.__ignoreObjectTree__=!0;continue}u[G]={},"__array__"===G&&(u[G].__target__=!0)}u=u[G]}Object.assign(u,x)}},12897:(Z,x,F)=>{"use strict";F.r(x),F.d(x,{AnimationPropertyInfo:()=>t,TransformNodeAnimationPropertyInfo:()=>o,WeightAnimationPropertyInfo:()=>c,getQuaternion:()=>j,getVector3:()=>Y,getWeights:()=>d});var u=F(11745),G=F(11179),f=F(12889);function Y(Z,x,F,u){return G.kx.Hx(x,F).scaleInPlace(u)}function j(Z,x,F,u){return G.Quaternion.Hx(x,F).scaleInPlace(u)}function d(Z,x,F,u){const G=new Array(Z._numMorphTargets);for(let f=0;f<G.length;f++)G[f]=x[F++]*u;return G}class t{constructor(Z,x,F,u){this.type=Z,this.name=x,this.getValue=F,this.getStride=u}_buildAnimation(Z,x,F){const G=new u.d(Z,this.name,x,this.type);return G.setKeys(F),G}}class o extends t{buildAnimations(Z,x,F,u){const G=[];return G.push({babylonAnimatable:Z._babylonTransformNode,babylonAnimation:this._buildAnimation(x,F,u)}),G}}class c extends t{buildAnimations(Z,x,F,G){const f=[];if(Z._numMorphTargets)for(let Y=0;Y<Z._numMorphTargets;Y++){const j=new u.d(`${x}_${Y}`,this.name,F,this.type);if(j.setKeys(G.map((Z=>({frame:Z.frame,inTangent:Z.inTangent?Z.inTangent[Y]:void 0,value:Z.value[Y],outTangent:Z.outTangent?Z.outTangent[Y]:void 0,interpolation:Z.interpolation})))),Z._primitiveBabylonMeshes)for(const x of Z._primitiveBabylonMeshes)if(x.morphTargetManager){const Z=x.morphTargetManager.getTarget(Y),F=j.clone();Z.animations.push(F),f.push({babylonAnimatable:Z,babylonAnimation:F})}}return f}}(0,f.k)("/nodes/{}/translation",[new o(u.d.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,f.k)("/nodes/{}/rotation",[new o(u.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",j,(()=>4))]),(0,f.k)("/nodes/{}/scale",[new o(u.d.ANIMATIONTYPE_VECTOR3,"pj",Y,(()=>3))]),(0,f.k)("/nodes/{}/weights",[new c(u.d.ANIMATIONTYPE_FLOAT,"influence",d,(Z=>Z._numMorphTargets))])},12848:(Z,x,F)=>{"use strict";class u{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((Z,x)=>{this._resolve=Z,this._reject=x}))}}var G=F(11179),f=F(11230),Y=F(10994),j=F(11673),d=F(12855),t=F(12863),o=F(11e3),c=F(11694),s=F(11745),J=F(11748),p=F(11037),U=F(11012),k=F(11018);class M{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(Z){this._useTextureToStoreBoneMatrices=Z,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(Z){this._animationPropertiesOverride=Z}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(Z,x,F){this.name=Z,this.id=x,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=G.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new o.b,this.bones=[],this._scene=F||p.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const u=this._scene.getEngine().getCaps();this._canUseTextureForBones=u.textureFloat&&u.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((Z=>!Z.getParent()))}getTransformMatrices(Z){if(this.needInitialSkinMatrix){if(!Z)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return Z._bonesTransformMatrices||this.prepare(!0),Z._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(Z){return this.needInitialSkinMatrix&&Z._transformMatrixTexture?Z._transformMatrixTexture:this._transformMatrixTexture}KZ(){return this._scene}toString(Z){let x=`Name: ${this.name}, nBones: ${this.bones.length}`;if(x+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,Z){x+=", Ranges: {";let Z=!0;for(const F in this._ranges)Z&&(x+=", ",Z=!1),x+=F;x+="}"}return x}getBoneIndexByName(Z){for(let x=0,F=this.bones.length;x<F;x++)if(this.bones[x].name===Z)return x;return-1}createAnimationRange(Z,x,F){if(!this._ranges[Z]){this._ranges[Z]=new J.e(Z,x,F);for(let u=0,G=this.bones.length;u<G;u++)this.bones[u].animations[0]&&this.bones[u].animations[0].createRange(Z,x,F)}}deleteAnimationRange(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let F=0,u=this.bones.length;F<u;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].deleteRange(Z,x);this._ranges[Z]=null}getAnimationRange(Z){return this._ranges[Z]||null}getAnimationRanges(){const Z=[];let x;for(x in this._ranges)Z.push(this._ranges[x]);return Z}copyAnimationRange(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[x]||!Z.getAnimationRange(x))return!1;let u=!0;const G=this._getHighestAnimationFrame()+1,f={},Y=Z.bones;let j,d;for(d=0,j=Y.length;d<j;d++)f[Y[d].name]=Y[d];this.bones.length!==Y.length&&(U.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),u=!1);const t=F&&this.dimensionsAtRest&&Z.dimensionsAtRest?this.dimensionsAtRest.divide(Z.dimensionsAtRest):null;for(d=0,j=this.bones.length;d<j;d++){const Z=this.bones[d].name,Y=f[Z];Y?u=u&&this.bones[d].copyAnimationRange(Y,x,G,F,t):(U.d.Warn("copyAnimationRange: not same rig, missing source bone "+Z),u=!1)}const o=Z.getAnimationRange(x);return o&&(this._ranges[x]=new J.e(x,o.from+G,o.to+G)),u}returnToRest(){for(const Z of this.bones)-1!==Z._index&&Z.returnToRest()}_getHighestAnimationFrame(){let Z=0;for(let x=0,F=this.bones.length;x<F;x++)if(this.bones[x].animations[0]){const F=this.bones[x].animations[0].getHighestFrame();Z<F&&(Z=F)}return Z}beginAnimation(Z,x,F,u){const G=this.getAnimationRange(Z);return G?this._scene.beginAnimation(this,G.from,G.to,x,F,u):null}static MakeAnimationAdditive(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const u=Z.getAnimationRange(F);if(!u)return null;const G=Z._scene.getAllAnimatablesByTarget(Z);let f=null;for(let j=0;j<G.length;j++){const Z=G[j];if(Z.fromFrame===(null===u||void 0===u?void 0:u.from)&&Z.toFrame===(null===u||void 0===u?void 0:u.to)){f=Z;break}}const Y=Z.getAnimatables();for(let j=0;j<Y.length;j++){const Z=Y[j].animations;if(Z)for(let u=0;u<Z.length;u++)s.d.MakeAnimationAdditive(Z[u],x,F)}return f&&(f.isAdditive=!0),Z}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(Z){this._meshesWithPoseMatrix.push(Z)}_unregisterMeshWithPoseMatrix(Z){const x=this._meshesWithPoseMatrix.indexOf(Z);x>-1&&this._meshesWithPoseMatrix.splice(x,1)}_computeTransformMatrices(Z,x){this.onBeforeComputeObservable.notifyObservers(this);for(let F=0;F<this.bones.length;F++){const u=this.bones[F];u._childUpdateId++;const G=u.getParent();if(G?u.getLocalMatrix().multiplyToRef(G.getFinalMatrix(),u.getFinalMatrix()):x?u.getLocalMatrix().multiplyToRef(x,u.getFinalMatrix()):u.getFinalMatrix().G(u.getLocalMatrix()),-1!==u._index){const x=null===u._index?F:u._index;u.getAbsoluteInverseBindMatrix().multiplyToArray(u.getFinalMatrix(),Z,16*x)}}this._identity.copyToArray(Z,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const Z=this.KZ().getRenderId();if(this._currentRenderId===Z)return;this._currentRenderId=Z}if(this._numBonesWithLinkedTransformNode>0)for(const Z of this.bones)if(Z._linkedTransformNode){const x=Z._linkedTransformNode;Z.position=x.position,x.rotationQuaternion?Z.rotationQuaternion=x.rotationQuaternion:Z.rotation=x.rotation,Z.pj=x.pj}if(this.needInitialSkinMatrix)for(const Z of this._meshesWithPoseMatrix){const x=Z.getPoseMatrix();let F=this._isDirty;if(Z._bonesTransformMatrices&&Z._bonesTransformMatrices.length===16*(this.bones.length+1)||(Z._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),F=!0),F){if(this._synchronizedWithMesh!==Z){this._synchronizedWithMesh=Z;for(const Z of this.bones)if(!Z.getParent()){Z.getBindMatrix().multiplyToRef(x,G.TmpVectors.Matrix[1]),Z._updateAbsoluteBindMatrices(G.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const x=4*(this.bones.length+1);Z._transformMatrixTexture&&Z._transformMatrixTexture.getSize().width===x||(Z._transformMatrixTexture&&Z._transformMatrixTexture.dispose(),Z._transformMatrixTexture=c.d.CreateRGBATexture(Z._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(Z._bonesTransformMatrices,x),this.isUsingTextureForMatrices&&Z._transformMatrixTexture&&Z._transformMatrixTexture.update(Z._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=c.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let Z=0;Z<this.bones.length;Z++)this._animatables.push(this.bones[Z])}return this._animatables}clone(Z,x){const F=new M(Z,x||Z,this._scene);F.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let u=0;u<this.bones.length;u++){const Z=this.bones[u];let x=null;const G=Z.getParent();if(G){const Z=this.bones.indexOf(G);x=F.bones[Z]}const f=new t.b(Z.name,F,x,Z.getBindMatrix().clone(),Z.getRestMatrix().clone());f._index=Z._index,Z._linkedTransformNode&&f.linkTransformNode(Z._linkedTransformNode),k.b.DeepCopy(Z.animations,f.animations)}if(this._ranges){F._ranges={};for(const Z in this._ranges){const x=this._ranges[Z];x&&(F._ranges[Z]=x.clone())}}return this._isDirty=!0,F.prepare(!0),F}enableBlending(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const x of this.bones)for(const F of x.animations)F.enableBlending=!0,F.blendingSpeed=Z}dispose(){if(this._meshesWithPoseMatrix.length=0,this.KZ().stopAnimation(this),this.KZ().removeSkeleton(this),this._parentContainer){const Z=this._parentContainer.skeletons.indexOf(this);Z>-1&&this._parentContainer.skeletons.splice(Z,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const Z={};Z.name=this.name,Z.id=this.id,this.dimensionsAtRest&&(Z.dimensionsAtRest=this.dimensionsAtRest.Wf()),Z.bones=[],Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let F=0;F<this.bones.length;F++){var x;const u=this.bones[F],G=u.getParent(),f={parentBoneIndex:G?this.bones.indexOf(G):-1,index:u.getIndex(),name:u.name,id:u.id,matrix:u.getBindMatrix().Wf(),rest:u.getRestMatrix().Wf(),linkedTransformNodeId:null===(x=u.getTransformNode())||void 0===x?void 0:x.id};Z.bones.push(f),u.length&&(f.length=u.length),u.metadata&&(f.metadata=u.metadata),u.animations&&u.animations.length>0&&(f.animation=u.animations[0].serialize()),Z.ranges=[];for(const x in this._ranges){const F=this._ranges[x];if(!F)continue;const u={};u.name=x,u.from=F.from,u.to=F.to,Z.ranges.push(u)}}return Z}static Parse(Z,x){const F=new M(Z.name,Z.id,x);let u;for(Z.dimensionsAtRest&&(F.dimensionsAtRest=G.kx.Hx(Z.dimensionsAtRest)),F.needInitialSkinMatrix=Z.needInitialSkinMatrix,u=0;u<Z.bones.length;u++){const x=Z.bones[u],f=Z.bones[u].index;let Y=null;x.parentBoneIndex>-1&&(Y=F.bones[x.parentBoneIndex]);const j=x.rest?G.Matrix.Hx(x.rest):null,d=new t.b(x.name,F,Y,G.Matrix.Hx(x.matrix),j,null,f);void 0!==x.id&&null!==x.id&&(d.id=x.id),x.length&&(d.length=x.length),x.metadata&&(d.metadata=x.metadata),x.animation&&d.animations.push(s.d.Parse(x.animation)),void 0!==x.linkedTransformNodeId&&null!==x.linkedTransformNodeId&&(F._hasWaitingData=!0,d._waitingTransformNodeId=x.linkedTransformNodeId)}if(Z.ranges)for(u=0;u<Z.ranges.length;u++){const x=Z.ranges[u];F.createAnimationRange(x.name,x.from,x.to)}return F}computeAbsoluteMatrices(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||Z)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(Z)}getPoseMatrix(){let Z=null;return this._meshesWithPoseMatrix.length>0&&(Z=this._meshesWithPoseMatrix[0].getPoseMatrix()),Z}sortBones(){const Z=[],x=new Array(this.bones.length);for(let F=0;F<this.bones.length;F++)this._sortBones(F,Z,x);this.bones=Z}_sortBones(Z,x,F){if(F[Z])return;F[Z]=!0;const u=this.bones[Z];if(!u)return;void 0===u._index&&(u._index=Z);const G=u.getParent();G&&this._sortBones(this.bones.indexOf(G),x,F),x.push(u)}setCurrentPoseAsRest(){for(const Z of this.bones)Z.setCurrentPoseAsRest()}}var m=F(11523),C=F(11710),L=F(11157),H=F(11627),S=F(11265),K=F(11680),y=F(11642),q=F(11671),R=F(11755),B=F(11285),v=F(12815);class l{set areUpdatesFrozen(Z){Z?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new B.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,Z||(Z=p.c.LastCreatedScene),this._scene=Z,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const Z=this._scene.getEngine().getCaps();this._canUseTextureForTargets=Z.canUseGLVertexID&&Z.textureFloat&&Z.maxVertexTextureImageUnits>0&&Z.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return l.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?l.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(Z){this._numMaxInfluencers!==Z&&(this._numMaxInfluencers=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(Z){this._useTextureToStoreTargets!==Z&&(this._useTextureToStoreTargets=Z,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var Z;return l.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(Z=this._scene)&&void 0!==Z&&Z.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(Z){return this._activeTargets.data[Z]}getTarget(Z){return this._targets[Z]}getTargetByName(Z){for(const x of this._targets)if(x.name===Z)return x;return null}addTarget(Z){this._targets.push(Z),this._targetInfluenceChangedObservers.push(Z.onInfluenceChanged.add((Z=>{this.areUpdatesFrozen&&Z&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(Z)}))),this._targetDataLayoutChangedObservers.push(Z._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(Z){const x=this._targets.indexOf(Z);x>=0&&(this._targets.splice(x,1),Z.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(x,1)[0]),Z._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(x,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(Z)}_bind(Z){Z.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),Z.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),Z.setTexture("morphTargets",this._targetStoreTexture),Z.setInt("morphTargetCount",this.numInfluencers)}clone(){const Z=new l(this._scene);for(const x of this._targets)Z.addTarget(x.clone());return Z.enablePositionMorphing=this.enablePositionMorphing,Z.enableNormalMorphing=this.enableNormalMorphing,Z.enableTangentMorphing=this.enableTangentMorphing,Z.enableUVMorphing=this.enableUVMorphing,Z.enableUV2Morphing=this.enableUV2Morphing,Z.enableColorMorphing=this.enableColorMorphing,Z}serialize(){const Z={};Z.id=this.uniqueId,Z.targets=[];for(const x of this._targets)Z.targets.push(x.serialize());return Z}_syncActiveTargets(){let Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const x=!!this._targetStoreTexture,F=this.isUsingTextureForTargets;(this._mustSynchronize||x!==F)&&(this._mustSynchronize=!1,this.synchronize());let u=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let G=-1;for(const f of this._targets)if(G++,0!==f.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=l.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(f),this._morphTargetTextureIndices[u]=G,this._tempInfluences[u++]=f.influence}this._morphTargetTextureIndices.length!==u&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,u)),this._influences&&this._influences.length===u||(this._influences=new Float32Array(u));for(let f=0;f<u;f++)this._influences[f]=this._tempInfluences[f];if(Z&&this._scene)for(const f of this._scene.meshes)f.morphTargetManager===this&&(F?f._markSubMeshesAsAttributesDirty():f._syncGeometryWithMorphTargetManager())}synchronize(){var Z;if(!this._scene||this.areUpdatesFrozen)return;const x=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(Z=this._targetStoreTexture)||void 0===Z||Z.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>x.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const F of this._targets){this._supportsPositions=this._supportsPositions&&F.hasPositions,this._supportsNormals=this._supportsNormals&&F.hasNormals,this._supportsTangents=this._supportsTangents&&F.hasTangents,this._supportsUVs=this._supportsUVs&&F.hasUVs,this._supportsUV2s=this._supportsUV2s&&F.hasUV2s,this._supportsColors=this._supportsColors&&F.hasColors;const Z=F.vertexCount;if(0===this._vertexCount)this._vertexCount=Z;else if(this._vertexCount!==Z)return void U.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${F.name}": ${Z}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const Z=x.getCaps().maxTextureSize;this._textureWidth>Z&&(this._textureHeight=Math.ceil(this._textureWidth/Z),this._textureWidth=Z);const F=this._targets.length,u=new Float32Array(F*this._textureWidth*this._textureHeight*4);let G=0;for(let x=0;x<F;x++){const Z=this._targets[x],F=Z.getPositions(),f=Z.getNormals(),Y=Z.getUVs(),j=Z.getTangents(),d=Z.getUV2s(),t=Z.getColors();G=x*this._textureWidth*this._textureHeight*4;for(let x=0;x<this._vertexCount;x++)this._supportsPositions&&F&&(u[G]=F[3*x],u[G+1]=F[3*x+1],u[G+2]=F[3*x+2],G+=4),this._supportsNormals&&f&&(u[G]=f[3*x],u[G+1]=f[3*x+1],u[G+2]=f[3*x+2],G+=4),this._supportsUVs&&Y&&(u[G]=Y[2*x],u[G+1]=Y[2*x+1],G+=4),this._supportsTangents&&j&&(u[G]=j[3*x],u[G+1]=j[3*x+1],u[G+2]=j[3*x+2],G+=4),this._supportsUV2s&&d&&(u[G]=d[2*x],u[G+1]=d[2*x+1],G+=4),this._supportsColors&&t&&(u[G]=t[4*x],u[G+1]=t[4*x+1],u[G+2]=t[4*x+2],u[G+3]=t[4*x+3],G+=4)}this._targetStoreTexture=v.c.CreateRGBATexture(u,this._textureWidth,this._textureHeight,F,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const F of this._scene.meshes)F.morphTargetManager===this&&F._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const Z=this._parentContainer.morphTargetManagers.indexOf(this);Z>-1&&this._parentContainer.morphTargetManagers.splice(Z,1),this._parentContainer=null}for(const Z of this._targets)this._scene.stopAnimation(Z)}}static Parse(Z,x){const F=new l(x);for(const u of Z.targets)F.addTarget(R.c.Parse(u,x));return F}}l.EnableTextureStorage=!0,l.MaxActiveMorphTargetsInVertexAttributeMode=8,l.ConstantTargetCountForTextureMode=0;var i=F(12872),e=F(11041),b=F(11546);const E=new Map,w=E;function T(Z,x,F){N(Z)&&U.d.Warn(`Extension with the name '${Z}' already exists`),E.set(Z,{isGLTFExtension:x,factory:F})}function N(Z){return E.delete(Z)}var W=F(12889),A=F(11817),h=F(11271);class X{static Get(Z,x,F){if(!x||void 0==F||!x[F])throw new Error(`${Z}: Failed to find index (${F})`);return x[F]}static TryGet(Z,x){return Z&&void 0!=x&&Z[x]?Z[x]:null}static Assign(Z){if(Z)for(let x=0;x<Z.length;x++)Z[x].index=x}}function D(Z){if(Z.min&&Z.max){const x=Z.min,F=Z.max,u=G.TmpVectors.kx[0].Jj(x[0],x[1],x[2]),f=G.TmpVectors.kx[1].Jj(F[0],F[1],F[2]);if(Z.normalized&&5126!==Z.componentType){let x=1;switch(Z.componentType){case 5120:x=127;break;case 5121:x=255;break;case 5122:x=32767;break;case 5123:x=65535}const F=1/x;u.scaleInPlace(F),f.scaleInPlace(F)}return new b.b(u,f)}return null}class Q{static RegisterExtension(Z,x){T(Z,!1,x)}static UnregisterExtension(Z){return N(Z)}get Cf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(Z){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=Z}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((Z=>Z.dispose&&Z.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(Z,x,F,u,G,f){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=x,this._assetContainer=F,this._loadData(u);let f=null;if(Z){const x={};if(this._gltf.nodes)for(const Z of this._gltf.nodes)Z.name&&(x[Z.name]=Z.index);f=(Z instanceof Array?Z:[Z]).map((Z=>{const F=x[Z];if(void 0===F)throw new Error(`Failed to find node '${Z}'`);return F}))}return await this._loadAsync(G,Y,f,(()=>({meshes:this._getMeshes(),Vs:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=Z,this._loadData(x),await this._loadAsync(F,G,null,(()=>{}))}async _loadAsync(Z,x,F,u){return await Promise.resolve().then((async()=>{this._rootUrl=Z,this._uniqueRootUrl=!Z.startsWith("file:")&&x?Z:`${Z}${Date.now()}/`,this._fileName=x,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const G=`${i.m[i.m.LOADING]} => ${i.m[i.m.READY]}`,f=`${i.m[i.m.LOADING]} => ${i.m[i.m.COMPLETE]}`;this._parent._startPerformanceCounter(G),this._parent._startPerformanceCounter(f),this._parent._setState(i.m.LOADING),this._extensionsOnLoading();const j=new Array;if(!this.parent.loadOnlyMaterials)if(F)j.push(this.loadSceneAsync("/nodes",{nodes:F,index:-1}));else if(void 0!=this._gltf.mx||this._gltf.scenes&&this._gltf.scenes[0]){const Z=X.Get("/scene",this._gltf.scenes,this._gltf.mx||0);j.push(this.loadSceneAsync(`/scenes/${Z.index}`,Z))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let Z=0;Z<this._gltf.materials.length;++Z){const x=this._gltf.materials[Z],F="/materials/"+Z,u=m.e.TriangleFillMode;j.push(this._loadMaterialAsync(F,x,null,u,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&j.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&j.push(this._compileShadowGeneratorsAsync());const d=Promise.all(j).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Nj(!0);for(const Z of this._babylonScene.materials){const x=Z;void 0!==x.maxSimultaneousLights&&(x.maxSimultaneousLights=Math.max(x.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(i.m.READY),this._skipStartAnimationStep||this._startAnimations(),u()}));return await d.then((Z=>(this._parent._endPerformanceCounter(G),Y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(f),this._parent._setState(i.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(Z=>{this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()}))})),Z)))})).catch((Z=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(Z),this._parent.onErrorObservable.clear(),this.dispose()),Z}))}_loadData(Z){if(this._gltf=Z.json,this._setupData(),Z.bin){const x=this._gltf.buffers;if(x&&x[0]&&!x[0].uri){const F=x[0];(F.byteLength<Z.bin.byteLength-3||F.byteLength>Z.bin.byteLength)&&U.d.Warn(`Binary buffer length (${F.byteLength}) from JSON does not match chunk length (${Z.bin.byteLength})`),this._bin=Z.bin}else U.d.Warn("Unexpected BIN chunk")}}_setupData(){if(X.Assign(this._gltf.accessors),X.Assign(this._gltf.animations),X.Assign(this._gltf.buffers),X.Assign(this._gltf.bufferViews),X.Assign(this._gltf.cameras),X.Assign(this._gltf.images),X.Assign(this._gltf.materials),X.Assign(this._gltf.meshes),X.Assign(this._gltf.nodes),X.Assign(this._gltf.samplers),X.Assign(this._gltf.scenes),X.Assign(this._gltf.skins),X.Assign(this._gltf.textures),this._gltf.nodes){const Z={};for(const F of this._gltf.nodes)if(F.children)for(const x of F.children)Z[x]=F.index;const x=this._createRootNode();for(const F of this._gltf.nodes){const u=Z[F.index];F.parent=void 0===u?x:this._gltf.nodes[u]}}}async _loadExtensionsAsync(){const Z=[];if(w.forEach(((x,F)=>{var u;!1===(null===(u=this.parent.extensionOptions[F])||void 0===u?void 0:u.enabled)?x.isGLTFExtension&&this.isExtensionUsed(F)&&U.d.Warn(`Extension ${F} is used but has been explicitly disabled.`):x.isGLTFExtension&&!this.isExtensionUsed(F)||Z.push((async()=>{const Z=await x.factory(this);return Z.name!==F&&U.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${Z.name} !== ${F}`),this._parent.onExtensionLoadedObservable.notifyObservers(Z),Z})())})),this._extensions.push(...await Promise.all(Z)),this._extensions.sort(((Z,x)=>(Z.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const F of this._gltf.extensionsRequired){if(!this._extensions.some((Z=>Z.name===F&&Z.enabled))){var x;if(!1===(null===(x=this.parent.extensionOptions[F])||void 0===x?void 0:x.enabled))throw new Error(`Required extension ${F} is disabled`);throw new Error(`Required extension ${F} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new q.d("__root__",this._babylonScene);this._rootBabylonMesh=Z,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Nj(!1);const x={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case i.j.AUTO:this._babylonScene.useRightHandedSystem||(x.rotation=[0,1,0,0],x.scale=[1,1,-1],Q._LoadTransform(x,this._rootBabylonMesh));break;case i.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(Z),x}loadSceneAsync(Z,x){const F=this._extensionsLoadSceneAsync(Z,x);if(F)return F;const u=new Array;if(this.logOpen(`${Z} ${x.name||""}`),x.nodes)for(const G of x.nodes){const x=X.Get(`${Z}/nodes/${G}`,this._gltf.nodes,G);u.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(Z=>{Z.parent=this._rootBabylonMesh})))}for(const G of this._postSceneLoadActions)G();return u.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(u).then((()=>{}))}_forEachPrimitive(Z,x){if(Z._primitiveBabylonMeshes)for(const F of Z._primitiveBabylonMeshes)x(F)}_getGeometries(){const Z=[],x=this._gltf.nodes;if(x)for(const F of x)this._forEachPrimitive(F,(x=>{const F=x.af;F&&-1===Z.indexOf(F)&&Z.push(F)}));return Z}_getMeshes(){const Z=[];this._rootBabylonMesh instanceof y.c&&Z.push(this._rootBabylonMesh);const x=this._gltf.nodes;if(x)for(const F of x)this._forEachPrimitive(F,(x=>{Z.push(x)}));return Z}_getTransformNodes(){const Z=[],x=this._gltf.nodes;if(x)for(const F of x)F._babylonTransformNode&&"Yd"===F._babylonTransformNode.getClassName()&&Z.push(F._babylonTransformNode),F._babylonTransformNodeForSkin&&Z.push(F._babylonTransformNodeForSkin);return Z}_getSkeletons(){const Z=[],x=this._gltf.skins;if(x)for(const F of x)F._data&&Z.push(F._data.babylonSkeleton);return Z}_getAnimationGroups(){const Z=[],x=this._gltf.animations;if(x)for(const F of x)F._babylonAnimationGroup&&Z.push(F._babylonAnimationGroup);return Z}_startAnimations(){switch(this._parent.animationStartMode){case i.g.NONE:break;case i.g.FIRST:{const Z=this._getAnimationGroups();0!==Z.length&&Z[0].start(!0);break}case i.g.ALL:{const Z=this._getAnimationGroups();for(const x of Z)x.start(!0);break}default:return void U.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadNodeAsync(Z,x,F);if(u)return u;if(x._babylonTransformNode)throw new Error(`${Z}: Invalid recursive node hierarchy`);const G=new Array;this.logOpen(`${Z} ${x.name||""}`);const f=u=>{if(Q.AddPointerMetadata(u,Z),Q._LoadTransform(x,u),void 0!=x.camera){const F=X.Get(`${Z}/camera`,this._gltf.cameras,x.camera);G.push(this.loadCameraAsync(`/cameras/${F.index}`,F,(Z=>{Z.parent=u,this._babylonScene.useRightHandedSystem||(u.pj.x=-1)})))}if(x.children)for(const F of x.children){const x=X.Get(`${Z}/children/${F}`,this._gltf.nodes,F);G.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(Z=>{Z.parent=u})))}F(u)},Y=void 0!=x.mesh,j=this._parent.loadSkins&&void 0!=x.skin;if(!Y||j){const Z=x.name||`node${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new H.d(Z,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==x.mesh?x._babylonTransformNode=F:x._babylonTransformNodeForSkin=F,f(F)}if(Y)if(j){const F=X.Get(`${Z}/mesh`,this._gltf.meshes,x.mesh);G.push(this._loadMeshAsync(`/meshes/${F.index}`,x,F,(F=>{const u=x._babylonTransformNodeForSkin;F.metadata=(0,A.c)(u.metadata,F.metadata||{});const f=X.Get(`${Z}/skin`,this._gltf.skins,x.skin);G.push(this._loadSkinAsync(`/skins/${f.index}`,x,f,(Z=>{this._forEachPrimitive(x,(x=>{x.skeleton=Z})),this._postSceneLoadActions.push((()=>{if(void 0!=f.skeleton){const Z=X.Get(`/skins/${f.index}/skeleton`,this._gltf.nodes,f.skeleton).parent;x.index===Z.index?F.parent=u.parent:F.parent=Z._babylonTransformNode}else F.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:u,skinnedNode:F})}))})))})))}else{const F=X.Get(`${Z}/mesh`,this._gltf.meshes,x.mesh);G.push(this._loadMeshAsync(`/meshes/${F.index}`,x,F,f))}return this.logClose(),Promise.all(G).then((()=>(this._forEachPrimitive(x,(Z=>{const x=Z;!x.isAnInstance&&x.af&&x.af.useBoundingInfoFromGeometry?Z.bZ():Z.refreshBoundingInfo(!0,!0)})),x._babylonTransformNode)))}_loadMeshAsync(Z,x,F,u){const G=F.primitives;if(!G||!G.length)throw new Error(`${Z}: Primitives are missing`);void 0==G[0].index&&X.Assign(G);const f=new Array;this.logOpen(`${Z} ${F.name||""}`);const Y=x.name||`node${x.index}`;if(1===G.length){const u=F.primitives[0];f.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${u.index}`,Y,x,F,u,(Z=>{x._babylonTransformNode=Z,x._primitiveBabylonMeshes=[Z]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,x._babylonTransformNode=new H.d(Y,this._babylonScene),x._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._primitiveBabylonMeshes=[];for(const u of G)f.push(this._loadMeshPrimitiveAsync(`${Z}/primitives/${u.index}`,`${Y}_primitive${u.index}`,x,F,u,(Z=>{Z.parent=x._babylonTransformNode,x._primitiveBabylonMeshes.push(Z)})))}return u(x._babylonTransformNode),this.logClose(),Promise.all(f).then((()=>x._babylonTransformNode))}_loadMeshPrimitiveAsync(Z,x,F,u,G,f){const Y=this._extensionsLoadMeshPrimitiveAsync(Z,x,F,u,G,f);if(Y)return Y;this.logOpen(`${Z}`);const j=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==F.skin&&!u.primitives[0].targets;let d,t;if(j&&G._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,d=G._instanceData.babylonSourceMesh.createInstance(x),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t=G._instanceData.promise;else{const f=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new q.d(x,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?m.e.CounterClockWiseSideOrientation:m.e.ClockWiseSideOrientation,this._createMorphTargets(Z,F,u,G,Y),f.push(this._loadVertexDataAsync(Z,G,Y).then((async x=>await this._loadMorphTargetsAsync(Z,G,Y,x).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,x.iZ(Y),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const o=Q._GetDrawMode(Z,G.mode);if(void 0==G.material){let Z=this._defaultBabylonMaterialData[o];Z||(Z=this._createDefaultMaterial("__GLTFLoader._default",o),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this._defaultBabylonMaterialData[o]=Z),Y.material=Z}else if(!this.parent.skipMaterials){const x=X.Get(`${Z}/material`,this._gltf.materials,G.material);f.push(this._loadMaterialAsync(`/materials/${x.index}`,x,Y,o,(Z=>{Y.material=Z})))}t=Promise.all(f),j&&(G._instanceData={babylonSourceMesh:Y,promise:t}),d=Y}return Q.AddPointerMetadata(d,Z),this._parent.onMeshLoadedObservable.notifyObservers(d),f(d),this.logClose(),t.then((()=>d))}_loadVertexDataAsync(Z,x,F){const u=this._extensionsLoadVertexDataAsync(Z,x,F);if(u)return u;const G=x.attributes;if(!G)throw new Error(`${Z}: Attributes are missing`);const f=new Array,Y=new K.c(F.name,this._babylonScene);if(void 0==x.indices)F.isUnIndexed=!0;else{const F=X.Get(`${Z}/indices`,this._gltf.accessors,x.indices);f.push(this._loadIndicesAccessorAsync(`/accessors/${F.index}`,F).then((Z=>{Y.setIndices(Z)})))}const j=(x,u,j)=>{if(void 0==G[x])return;F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(u)&&F._delayInfo.push(u);const d=X.Get(`${Z}/attributes/${x}`,this._gltf.accessors,G[x]);f.push(this._loadVertexAccessorAsync(`/accessors/${d.index}`,d,u).then((Z=>{if(Z.getKind()===S.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!F.skeleton){const Z=D(d);Z&&(Y._boundingInfo=Z,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(Z,d.count)}))),u==S.f.MatricesIndicesExtraKind&&(F.numBoneInfluencers=8),j&&j(d)};return j("POSITION",S.f.PositionKind),j("NORMAL",S.f.NormalKind),j("TANGENT",S.f.TangentKind),j("TEXCOORD_0",S.f.UVKind),j("TEXCOORD_1",S.f.UV2Kind),j("TEXCOORD_2",S.f.UV3Kind),j("TEXCOORD_3",S.f.UV4Kind),j("TEXCOORD_4",S.f.UV5Kind),j("TEXCOORD_5",S.f.UV6Kind),j("JOINTS_0",S.f.MatricesIndicesKind),j("WEIGHTS_0",S.f.MatricesWeightsKind),j("JOINTS_1",S.f.MatricesIndicesExtraKind),j("WEIGHTS_1",S.f.MatricesWeightsExtraKind),j("COLOR_0",S.f.ColorKind,(Z=>{"VEC4"===Z.type&&(F.hasVertexAlpha=!0)})),Promise.all(f).then((()=>Y))}_createMorphTargets(Z,x,F,u,G){if(!u.targets||!this._parent.loadMorphTargets)return;if(void 0==x._numMorphTargets)x._numMorphTargets=u.targets.length;else if(u.targets.length!==x._numMorphTargets)throw new Error(`${Z}: Primitives do not have the same number of targets`);const f=F.extras?F.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,G.morphTargetManager=new l(this._babylonScene),G.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<u.targets.length;Y++){const Z=x.weights?x.weights[Y]:F.weights?F.weights[Y]:0,u=f?f[Y]:`morphTarget${Y}`;G.morphTargetManager.addTarget(new R.c(u,Z,G.KZ()))}}_loadMorphTargetsAsync(Z,x,F,u){if(!x.targets||!this._parent.loadMorphTargets)return Promise.resolve();const G=new Array,f=F.morphTargetManager;for(let Y=0;Y<f.numTargets;Y++){const F=f.getTarget(Y);G.push(this._loadMorphTargetVertexDataAsync(`${Z}/targets/${Y}`,u,x.targets[Y],F))}return Promise.all(G).then((()=>{f.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(Z,x,F,u){const G=new Array,f=(u,f,Y)=>{if(void 0==F[u])return;const j=x.getVertexBuffer(f);if(!j)return;const d=X.Get(`${Z}/${u}`,this._gltf.accessors,F[u]);G.push(this._loadFloatAccessorAsync(`/accessors/${d.index}`,d).then((Z=>{Y(j,Z)})))};return f("POSITION",S.f.PositionKind,((Z,x)=>{const F=new Float32Array(x.length);Z.forEach(x.length,((Z,u)=>{F[u]=x[u]+Z})),u.setPositions(F)})),f("NORMAL",S.f.NormalKind,((Z,x)=>{const F=new Float32Array(x.length);Z.forEach(F.length,((Z,u)=>{F[u]=x[u]+Z})),u.setNormals(F)})),f("TANGENT",S.f.TangentKind,((Z,x)=>{const F=new Float32Array(x.length/3*4);let G=0;Z.forEach(x.length/3*4,((Z,u)=>{(u+1)%4!==0&&(F[G]=x[G]+Z,G++)})),u.setTangents(F)})),f("TEXCOORD_0",S.f.UVKind,((Z,x)=>{const F=new Float32Array(x.length);Z.forEach(x.length,((Z,u)=>{F[u]=x[u]+Z})),u.setUVs(F)})),f("TEXCOORD_1",S.f.UV2Kind,((Z,x)=>{const F=new Float32Array(x.length);Z.forEach(x.length,((Z,u)=>{F[u]=x[u]+Z})),u.setUV2s(F)})),f("COLOR_0",S.f.ColorKind,((x,F)=>{let G=null;const f=x.getSize();if(3===f){G=new Float32Array(F.length/3*4),x.forEach(F.length,((Z,x)=>{const u=Math.floor(x/3),f=x%3;G[4*u+f]=F[3*u+f]+Z}));for(let Z=0;Z<F.length/3;++Z)G[4*Z+3]=1}else{if(4!==f)throw new Error(`${Z}: Invalid number of components (${f}) for COLOR_0 attribute`);G=new Float32Array(F.length),x.forEach(F.length,((Z,x)=>{G[x]=F[x]+Z}))}u.setColors(G)})),await Promise.all(G).then((()=>{}))}static _LoadTransform(Z,x){if(void 0!=Z.skin)return;let F=G.kx.Zero(),u=G.Quaternion.Identity(),f=G.kx.One();if(Z.matrix){G.Matrix.Hx(Z.matrix).decompose(f,u,F)}else Z.translation&&(F=G.kx.Hx(Z.translation)),Z.rotation&&(u=G.Quaternion.Hx(Z.rotation)),Z.scale&&(f=G.kx.Hx(Z.scale));x.position=F,x.rotationQuaternion=u,x.pj=f}_loadSkinAsync(Z,x,F,u){if(!this._parent.loadSkins)return Promise.resolve();const G=this._extensionsLoadSkinAsync(Z,x,F);if(G)return G;if(F._data)return u(F._data.babylonSkeleton),F._data.promise;const f=`skeleton${F.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new M(F.name||f,f,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(Z,F,Y);const j=this._loadSkinInverseBindMatricesDataAsync(Z,F).then((Z=>{this._updateBoneMatrices(Y,Z)}));return F._data={babylonSkeleton:Y,promise:j},u(Y),j}_loadBones(Z,x,F){if(void 0==x.skeleton||this._parent.alwaysComputeSkeletonRootNode){const F=this._findSkeletonRootNode(`${Z}/joints`,x.joints);if(F)if(void 0===x.skeleton)x.skeleton=F.index;else{const u=(Z,x)=>{for(;x.parent;x=x.parent)if(x.parent===Z)return!0;return!1},G=X.Get(`${Z}/skeleton`,this._gltf.nodes,x.skeleton);G===F||u(G,F)||(U.d.Warn(`${Z}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),x.skeleton=F.index)}else U.d.Warn(`${Z}: Failed to find common root`)}const u={};for(const G of x.joints){const f=X.Get(`${Z}/joints/${G}`,this._gltf.nodes,G);this._loadBone(f,x,F,u)}}_findSkeletonRootNode(Z,x){if(0===x.length)return null;const F={};for(const G of x){const x=[];let u=X.Get(`${Z}/${G}`,this._gltf.nodes,G);for(;-1!==u.index;)x.unshift(u),u=u.parent;F[G]=x}let u=null;for(let G=0;;++G){let Z=F[x[0]];if(G>=Z.length)return u;const f=Z[G];for(let Y=1;Y<x.length;++Y)if(Z=F[x[Y]],G>=Z.length||f!==Z[G])return u;u=f}}_loadBone(Z,x,F,u){Z._isJoint=!0;let G=u[Z.index];if(G)return G;let f=null;Z.index!==x.skeleton&&(Z.parent&&-1!==Z.parent.index?f=this._loadBone(Z.parent,x,F,u):void 0!==x.skeleton&&U.d.Warn(`/skins/${x.index}/skeleton: Skeleton node is not a common root`));const Y=x.joints.indexOf(Z.index);return G=new t.b(Z.name||`joint${Z.index}`,F,f,this._getNodeMatrix(Z),null,null,Y),u[Z.index]=G,this._postSceneLoadActions.push((()=>{G.linkTransformNode(Z._babylonTransformNode)})),G}_loadSkinInverseBindMatricesDataAsync(Z,x){if(void 0==x.inverseBindMatrices)return Promise.resolve(null);const F=X.Get(`${Z}/inverseBindMatrices`,this._gltf.accessors,x.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)}_updateBoneMatrices(Z,x){for(const F of Z.bones){const Z=G.Matrix.Identity(),u=F._index;x&&-1!==u&&(G.Matrix.FromArrayToRef(x,16*u,Z),Z.invertToRef(Z));const f=F.getParent();f&&Z.multiplyToRef(f.getAbsoluteInverseBindMatrix(),Z),F.Xf(Z,!1,!1),F._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(Z){return Z.matrix?G.Matrix.Hx(Z.matrix):G.Matrix.Compose(Z.scale?G.kx.Hx(Z.scale):G.kx.One(),Z.rotation?G.Quaternion.Hx(Z.rotation):G.Quaternion.Identity(),Z.translation?G.kx.Hx(Z.translation):G.kx.Zero())}loadCameraAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadCameraAsync(Z,x,F);if(u)return u;const f=new Array;this.logOpen(`${Z} ${x.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new d.b(x.name||`camera${x.index}`,G.kx.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonCamera=Y,Y.setTarget(new G.kx(0,0,-1)),x.type){case"perspective":{const F=x.perspective;if(!F)throw new Error(`${Z}: Camera perspective properties are missing`);Y.fov=F.yfov,Y.hf=F.znear,Y.maxZ=F.zfar||0;break}case"orthographic":if(!x.orthographic)throw new Error(`${Z}: Camera orthographic properties are missing`);Y.mode=j.c.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-x.orthographic.xmag,Y.orthoRight=x.orthographic.xmag,Y.orthoBottom=-x.orthographic.ymag,Y.orthoTop=x.orthographic.ymag,Y.hf=x.orthographic.znear,Y.maxZ=x.orthographic.zfar;break;default:throw new Error(`${Z}: Invalid camera type (${x.type})`)}return Q.AddPointerMetadata(Y,Z),this._parent.onCameraLoadedObservable.notifyObservers(Y),F(Y),this.logClose(),Promise.all(f).then((()=>Y))}_loadAnimationsAsync(){const Z=this._gltf.animations;if(!Z)return Promise.resolve();const x=new Array;for(let F=0;F<Z.length;F++){const u=Z[F];x.push(this.loadAnimationAsync(`/animations/${u.index}`,u).then((Z=>{0===Z.targetedAnimations.length&&Z.dispose()})))}return Promise.all(x).then((()=>{}))}loadAnimationAsync(Z,x){const u=this._extensionsLoadAnimationAsync(Z,x);return u||F.e(78).then(F.bind(F,14412)).then((F=>{let{AnimationGroup:u}=F;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new u(x.name||`animation${x.index}`,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonAnimationGroup=G;const f=new Array;X.Assign(x.channels),X.Assign(x.samplers);for(const Y of x.channels)f.push(this._loadAnimationChannelAsync(`${Z}/channels/${Y.index}`,Z,x,Y,((Z,x)=>{Z.animations=Z.animations||[],Z.animations.push(x),G.addTargetedAnimation(x,Z)})));return Promise.all(f).then((()=>(G.normalize(0),G)))}))}async _loadAnimationChannelAsync(Z,x,u,G,f){const Y=this._extensionsLoadAnimationChannelAsync(Z,x,u,G,f);if(Y)return await Y;if(void 0==G.target.node)return await Promise.resolve();const j=X.Get(`${Z}/target/node`,this._gltf.nodes,G.target.node),d=G.target.path,t="weights"===d;if(t&&!j._numMorphTargets||!t&&!j._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!t&&!j._isJoint)return await Promise.resolve();let o;switch(await Promise.resolve().then(F.bind(F,12897)),d){case"translation":var c;o=null===(c=(0,W.f)("/nodes/{}/translation"))||void 0===c?void 0:c.interpolation;break;case"rotation":var s;o=null===(s=(0,W.f)("/nodes/{}/rotation"))||void 0===s?void 0:s.interpolation;break;case"scale":var J;o=null===(J=(0,W.f)("/nodes/{}/scale"))||void 0===J?void 0:J.interpolation;break;case"weights":var p;o=null===(p=(0,W.f)("/nodes/{}/weights"))||void 0===p?void 0:p.interpolation;break;default:throw new Error(`${Z}/target/path: Invalid value (${G.target.path})`)}if(!o)throw new Error(`${Z}/target/path: Could not find interpolation properties for target path (${G.target.path})`);const U={object:j,info:o};return await this._loadAnimationChannelFromTargetInfoAsync(Z,x,u,G,U,f)}_loadAnimationChannelFromTargetInfoAsync(Z,x,F,u,G,f){const Y=this.parent.targetFps,j=1/Y,d=X.Get(`${Z}/sampler`,F.samplers,u.sampler);return this._loadAnimationSamplerAsync(`${x}/samplers/${u.sampler}`,d).then((Z=>{let x=0;const d=G.object,t=G.info;for(const G of t){const t=G.getStride(d),o=Z.input,c=Z.output,s=new Array(o.length);let J=0;switch(Z.interpolation){case"STEP":for(let Z=0;Z<o.length;Z++){const x=G.getValue(d,c,J,1);J+=t,s[Z]={frame:o[Z]*Y,value:x,interpolation:1}}break;case"CUBICSPLINE":for(let Z=0;Z<o.length;Z++){const x=G.getValue(d,c,J,j);J+=t;const F=G.getValue(d,c,J,1);J+=t;const u=G.getValue(d,c,J,j);J+=t,s[Z]={frame:o[Z]*Y,inTangent:x,value:F,outTangent:u}}break;case"LINEAR":for(let Z=0;Z<o.length;Z++){const x=G.getValue(d,c,J,1);J+=t,s[Z]={frame:o[Z]*Y,value:x}}}if(J>0){const Z=`${F.name||`animation${F.index}`}_channel${u.index}_${x}`,j=G.buildAnimations(d,Z,Y,s);for(const F of j)x++,f(F.babylonAnimatable,F.babylonAnimation)}}}))}_loadAnimationSamplerAsync(Z,x){if(x._data)return x._data;const F=x.interpolation||"LINEAR";switch(F){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${Z}/interpolation: Invalid value (${x.interpolation})`)}const u=X.Get(`${Z}/input`,this._gltf.accessors,x.input),G=X.Get(`${Z}/output`,this._gltf.accessors,x.output);return x._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${u.index}`,u),this._loadFloatAccessorAsync(`/accessors/${G.index}`,G)]).then((Z=>{let[x,u]=Z;return{input:x,interpolation:F,output:u}})),x._data}loadBufferAsync(Z,x,F,u){const G=this._extensionsLoadBufferAsync(Z,x,F,u);if(G)return G;if(!x._data)if(x.uri)x._data=this.loadUriAsync(`${Z}/uri`,x,x.uri);else{if(!this._bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);x._data=this._bin.readAsync(0,x.byteLength)}return x._data.then((x=>{try{return new Uint8Array(x.buffer,x.byteOffset+F,u)}catch(G){throw new Error(`${Z}: ${G.message}`)}}))}loadBufferViewAsync(Z,x){const F=this._extensionsLoadBufferViewAsync(Z,x);if(F)return F;if(x._data)return x._data;const u=X.Get(`${Z}/buffer`,this._gltf.buffers,x.buffer);return x._data=this.loadBufferAsync(`/buffers/${u.index}`,u,x.byteOffset||0,x.byteLength),x._data}_loadAccessorAsync(Z,x,F){if(x._data)return x._data;const u=Q._GetNumComponents(Z,x.type),G=u*S.f.GetTypeByteLength(x.componentType),f=u*x.count;if(void 0==x.bufferView)x._data=Promise.resolve(new F(f));else{const Y=X.Get(`${Z}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((j=>{if(5126!==x.componentType||x.normalized||Y.byteStride&&Y.byteStride!==G){const Z=new F(f);return S.f.ForEach(j,x.byteOffset||0,Y.byteStride||G,u,x.componentType,Z.length,x.normalized||!1,((x,F)=>{Z[F]=x})),Z}return Q._GetTypedArray(Z,x.componentType,j,x.byteOffset,f)}))}if(x.sparse){const f=x.sparse;x._data=x._data.then((Y=>{const j=Y,d=X.Get(`${Z}/sparse/indices/bufferView`,this._gltf.bufferViews,f.indices.bufferView),t=X.Get(`${Z}/sparse/values/bufferView`,this._gltf.bufferViews,f.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${d.index}`,d),this.loadBufferViewAsync(`/bufferViews/${t.index}`,t)]).then((Y=>{let[d,t]=Y;const o=Q._GetTypedArray(`${Z}/sparse/indices`,f.indices.componentType,d,f.indices.byteOffset,f.count),c=u*f.count;let s;if(5126!==x.componentType||x.normalized){const Y=Q._GetTypedArray(`${Z}/sparse/values`,x.componentType,t,f.values.byteOffset,c);s=new F(c),S.f.ForEach(Y,0,G,u,x.componentType,s.length,x.normalized||!1,((Z,x)=>{s[x]=Z}))}else s=Q._GetTypedArray(`${Z}/sparse/values`,x.componentType,t,f.values.byteOffset,c);let J=0;for(let Z=0;Z<o.length;Z++){let x=o[Z]*u;for(let Z=0;Z<u;Z++)j[x++]=s[J++]}return j}))}))}return x._data}_loadFloatAccessorAsync(Z,x){return this._loadAccessorAsync(Z,x,Float32Array)}_loadIndicesAccessorAsync(Z,x){if("SCALAR"!==x.type)throw new Error(`${Z}/type: Invalid value ${x.type}`);if(5121!==x.componentType&&5123!==x.componentType&&5125!==x.componentType)throw new Error(`${Z}/componentType: Invalid value ${x.componentType}`);if(x._data)return x._data;if(x.sparse){const F=Q._GetTypedArrayConstructor(`${Z}/componentType`,x.componentType);x._data=this._loadAccessorAsync(Z,x,F)}else{const F=X.Get(`${Z}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((F=>Q._GetTypedArray(Z,x.componentType,F,x.byteOffset,x.count)))}return x._data}_loadVertexBufferViewAsync(Z){if(Z._babylonBuffer)return Z._babylonBuffer;const x=this._babylonScene.getEngine();return Z._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>new S.e(x,Z,!1))),Z._babylonBuffer}_loadVertexAccessorAsync(Z,x,F){var u;if(null!==(u=x._babylonVertexBuffer)&&void 0!==u&&u[F])return x._babylonVertexBuffer[F];x._babylonVertexBuffer||(x._babylonVertexBuffer={});const G=this._babylonScene.getEngine();if(x.sparse||void 0==x.bufferView)x._babylonVertexBuffer[F]=this._loadFloatAccessorAsync(Z,x).then((Z=>new S.f(G,Z,F,!1)));else{const u=X.Get(`${Z}/bufferView`,this._gltf.bufferViews,x.bufferView);x._babylonVertexBuffer[F]=this._loadVertexBufferViewAsync(u).then((f=>{const Y=Q._GetNumComponents(Z,x.type);return new S.f(G,f,F,!1,void 0,u.byteStride,void 0,x.byteOffset,Y,x.componentType,x.normalized,!0,void 0,!0)}))}return x._babylonVertexBuffer[F]}_loadMaterialMetallicRoughnessPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return x&&(x.baseColorFactor?(F.albedoColor=f.Lx.Hx(x.baseColorFactor),F.alpha=x.baseColorFactor[3]):F.albedoColor=f.Lx.White(),F.metallic=void 0==x.metallicFactor?1:x.metallicFactor,F.roughness=void 0==x.roughnessFactor?1:x.roughnessFactor,x.baseColorTexture&&u.push(this.loadTextureInfoAsync(`${Z}/baseColorTexture`,x.baseColorTexture,(Z=>{Z.name=`${F.name} (Base Color)`,F.albedoTexture=Z}))),x.metallicRoughnessTexture&&(x.metallicRoughnessTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${Z}/metallicRoughnessTexture`,x.metallicRoughnessTexture,(Z=>{Z.name=`${F.name} (Metallic Roughness)`,F.metallicTexture=Z}))),F.useMetallnessFromMetallicTextureBlue=!0,F.useRoughnessFromMetallicTextureGreen=!0,F.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(u).then((()=>{}))}_loadMaterialAsync(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const f=this._extensionsLoadMaterialAsync(Z,x,F,u,G);if(f)return f;x._data=x._data||{};let Y=x._data[u];if(!Y){this.logOpen(`${Z} ${x.name||""}`);const F=this.createMaterial(Z,x,u);Y={babylonMaterial:F,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(Z,x,F)},x._data[u]=Y,Q.AddPointerMetadata(F,Z),this._parent.onMaterialLoadedObservable.notifyObservers(F),this.logClose()}return F&&(Y.babylonMeshes.push(F),F.Uf.addOnce((()=>{const Z=Y.babylonMeshes.indexOf(F);-1!==Z&&Y.babylonMeshes.splice(Z,1)}))),G(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(Z,x){this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new C.c(Z,this._babylonScene);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.fillMode=x,F.enableSpecularAntiAliasing=!0,F.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,F.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,F.transparencyMode=C.c.PBRMATERIAL_OPAQUE,F.metallic=1,F.roughness=1,F}createMaterial(Z,x,F){const u=this._extensionsCreateMaterial(Z,x,F);if(u)return u;const G=x.name||`material${x.index}`;return this._createDefaultMaterial(G,F)}loadMaterialPropertiesAsync(Z,x,F){const u=this._extensionsLoadMaterialPropertiesAsync(Z,x,F);if(u)return u;const G=new Array;return G.push(this.loadMaterialBasePropertiesAsync(Z,x,F)),x.pbrMetallicRoughness&&G.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${Z}/pbrMetallicRoughness`,x.pbrMetallicRoughness,F)),this.loadMaterialAlphaProperties(Z,x,F),Promise.all(G).then((()=>{}))}loadMaterialBasePropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.emissiveColor=x.emissiveFactor?f.Lx.Hx(x.emissiveFactor):new f.Lx(0,0,0),x.doubleSided&&(F.sj=!1,F.twoSidedLighting=!0),x.normalTexture&&(x.normalTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${Z}/normalTexture`,x.normalTexture,(Z=>{Z.name=`${F.name} (Normal)`,F.bumpTexture=Z}))),F.invertNormalMapX=!this._babylonScene.useRightHandedSystem,F.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=x.normalTexture.scale&&F.bumpTexture&&(F.bumpTexture.level=x.normalTexture.scale),F.forceIrradianceInFragment=!0),x.occlusionTexture&&(x.occlusionTexture.nonColorData=!0,u.push(this.loadTextureInfoAsync(`${Z}/occlusionTexture`,x.occlusionTexture,(Z=>{Z.name=`${F.name} (Occlusion)`,F.ambientTexture=Z}))),F.useAmbientInGrayScale=!0,void 0!=x.occlusionTexture.strength&&(F.ambientTextureStrength=x.occlusionTexture.strength)),x.emissiveTexture&&u.push(this.loadTextureInfoAsync(`${Z}/emissiveTexture`,x.emissiveTexture,(Z=>{Z.name=`${F.name} (Emissive)`,F.emissiveTexture=Z}))),Promise.all(u).then((()=>{}))}loadMaterialAlphaProperties(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);switch(x.alphaMode||"OPAQUE"){case"OPAQUE":F.transparencyMode=C.c.PBRMATERIAL_OPAQUE,F.alpha=1;break;case"MASK":F.transparencyMode=C.c.PBRMATERIAL_ALPHATEST,F.alphaCutOff=void 0==x.alphaCutoff?.5:x.alphaCutoff,F.albedoTexture&&(F.albedoTexture.Af=!0);break;case"BLEND":F.transparencyMode=C.c.PBRMATERIAL_ALPHABLEND,F.albedoTexture&&(F.albedoTexture.Af=!0,F.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${Z}/alphaMode: Invalid value (${x.alphaMode})`)}}loadTextureInfoAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadTextureInfoAsync(Z,x,F);if(u)return u;if(this.logOpen(`${Z}`),x.texCoord>=6)throw new Error(`${Z}/texCoord: Invalid value (${x.texCoord})`);const G=X.Get(`${Z}/index`,this._gltf.textures,x.index);G._textureInfo=x;const f=this._loadTextureAsync(`/textures/${x.index}`,G,(u=>{u.coordinatesIndex=x.texCoord||0,Q.AddPointerMetadata(u,Z),this._parent.onTextureLoadedObservable.notifyObservers(u),F(u)}));return this.logClose(),f}_loadTextureAsync(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const u=this._extensionsLoadTextureAsync(Z,x,F);if(u)return u;this.logOpen(`${Z} ${x.name||""}`);const G=void 0==x.sampler?Q.DefaultSampler:X.Get(`${Z}/sampler`,this._gltf.samplers,x.sampler),f=X.Get(`${Z}/source`,this._gltf.images,x.source),Y=this._createTextureAsync(Z,G,f,F,void 0,!x._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},f=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const j=this._loadSampler(`/samplers/${x.index}`,x),d=new Array,t=new u;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o={noMipmap:j.noMipMaps,invertY:!1,samplingMode:j.samplingMode,V:()=>{this._disposed||t.resolve()},onError:(x,F)=>{this._disposed||t.reject(new Error(`${Z}: ${F&&F.message?F.message:x||"Failed to load texture"}`))},mimeType:F.mimeType??(0,e.g)(F.uri??""),loaderOptions:f,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},c=new L.c(null,this._babylonScene,o);return c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d.push(t.promise),d.push(this.loadImageAsync(`/images/${F.index}`,F).then((Z=>{const x=F.uri||`${this._fileName}#image${F.index}`,u=`data:${this._uniqueRootUrl}${x}`;c.updateURL(u,Z);const G=c.getInternalTexture();G&&(G.label=F.name)}))),c.wrapU=j.wrapU,c.wrapV=j.wrapV,G(c),this._parent.useGltfTextureNames&&(c.name=F.name||F.uri||`image${F.index}`),Promise.all(d).then((()=>c))}_loadSampler(Z,x){return x._data||(x._data={noMipMaps:9728===x.minFilter||9729===x.minFilter,samplingMode:Q._GetTextureSamplingMode(Z,x),wrapU:Q._GetTextureWrapMode(`${Z}/wrapS`,x.wrapS),wrapV:Q._GetTextureWrapMode(`${Z}/wrapT`,x.wrapT)}),x._data}loadImageAsync(Z,x){if(!x._data){if(this.logOpen(`${Z} ${x.name||""}`),x.uri)x._data=this.loadUriAsync(`${Z}/uri`,x,x.uri);else{const F=X.Get(`${Z}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}this.logClose()}return x._data}loadUriAsync(Z,x,F){const u=this._extensionsLoadUriAsync(Z,x,F);if(u)return u;if(!Q._ValidateUri(F))throw new Error(`${Z}: '${F}' is invalid`);if((0,e.k)(F)){const x=new Uint8Array((0,e.c)(F));return this.log(`${Z}: Decoded ${F.substring(0,64)}... (${x.length} bytes)`),Promise.resolve(x)}return this.log(`${Z}: Loading ${F}`),this._parent.preprocessUrlAsync(this._rootUrl+F).then((x=>new Promise(((u,G)=>{this._parent._loadFile(this._babylonScene,x,(x=>{this._disposed||(this.log(`${Z}: Loaded ${F} (${x.byteLength} bytes)`),u(new Uint8Array(x)))}),!0,(x=>{G(new e.m(`${Z}: Failed to load '${F}'${x?": "+x.status+" "+x.statusText:""}`,x))}))}))))}static AddPointerMetadata(Z,x){Z.metadata=Z.metadata||{};const F=Z._internalMetadata=Z._internalMetadata||{},u=F.Cf=F.Cf||{};(u.pointers=u.pointers||[]).push(x)}static _GetTextureWrapMode(Z,x){switch(x=void 0==x?10497:x){case 33071:return L.c.CLAMP_ADDRESSMODE;case 33648:return L.c.MIRROR_ADDRESSMODE;case 10497:return L.c.WRAP_ADDRESSMODE;default:return U.d.Warn(`${Z}: Invalid value (${x})`),L.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(Z,x){const F=void 0==x.magFilter?9729:x.magFilter,u=void 0==x.minFilter?9987:x.minFilter;if(9729===F)switch(u){case 9728:return L.c.LINEAR_NEAREST;case 9729:return L.c.LINEAR_LINEAR;case 9984:return L.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return L.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return L.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return L.c.LINEAR_LINEAR_MIPLINEAR;default:return U.d.Warn(`${Z}/minFilter: Invalid value (${u})`),L.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==F&&U.d.Warn(`${Z}/magFilter: Invalid value (${F})`),u){case 9728:return L.c.NEAREST_NEAREST;case 9729:return L.c.NEAREST_LINEAR;case 9984:return L.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return L.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return L.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return L.c.NEAREST_LINEAR_MIPLINEAR;default:return U.d.Warn(`${Z}/minFilter: Invalid value (${u})`),L.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(Z,x){try{return(0,h.n)(x)}catch(F){throw new Error(`${Z}: ${F.message}`)}}static _GetTypedArray(Z,x,F,u,G){const f=F.buffer;u=F.byteOffset+(u||0);const Y=Q._GetTypedArrayConstructor(`${Z}/componentType`,x),j=S.f.GetTypeByteLength(x);return u%j!==0?(U.d.Warn(`${Z}: Copying buffer as byte offset (${u}) is not a multiple of component type byte length (${j})`),new Y(f.slice(u,u+G*j),0)):new Y(f,u,G)}static _GetNumComponents(Z,x){switch(x){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${Z}: Invalid type (${x})`)}static _ValidateUri(Z){return Y.Tools.IsBase64(Z)||-1===Z.indexOf("..")}static _GetDrawMode(Z,x){switch(void 0==x&&(x=4),x){case 0:return m.e.PointListDrawMode;case 1:return m.e.LineListDrawMode;case 2:return m.e.LineLoopDrawMode;case 3:return m.e.LineStripDrawMode;case 4:return m.e.TriangleFillMode;case 5:return m.e.TriangleStripDrawMode;case 6:return m.e.TriangleFanDrawMode}throw new Error(`${Z}: Invalid mesh primitive mode (${x})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const Z=new Array;if(this._gltf.materials)for(const x of this._gltf.materials)if(x._data)for(const F in x._data){const u=x._data[F];for(const x of u.babylonMeshes){x.Qf(!0);const F=u.babylonMaterial;Z.push(F.forceCompilationAsync(x)),Z.push(F.forceCompilationAsync(x,{useInstances:!0})),this._parent.useClipPlane&&(Z.push(F.forceCompilationAsync(x,{clipPlane:!0})),Z.push(F.forceCompilationAsync(x,{clipPlane:!0,useInstances:!0})))}}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const Z=new Array,x=this._babylonScene.lights;for(const F of x){const x=F.getShadowGenerator();x&&Z.push(x.forceCompilationAsync())}return Promise.all(Z).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(Z){for(const x of this._extensions)x.enabled&&Z(x)}_applyExtensions(Z,x,F){for(const u of this._extensions)if(u.enabled){const G=`${u.name}.${x}`,f=Z;f._activeLoaderExtensionFunctions=f._activeLoaderExtensionFunctions||{};const Y=f._activeLoaderExtensionFunctions;if(!Y[G]){Y[G]=!0;try{const Z=F(u);if(Z)return Z}finally{delete Y[G]}}}return null}_extensionsOnLoading(){this._forEachExtensions((Z=>Z.onLoading&&Z.onLoading()))}_extensionsOnReady(){this._forEachExtensions((Z=>Z.onReady&&Z.onReady()))}_extensionsLoadSceneAsync(Z,x){return this._applyExtensions(x,"loadScene",(F=>F.loadSceneAsync&&F.loadSceneAsync(Z,x)))}_extensionsLoadNodeAsync(Z,x,F){return this._applyExtensions(x,"loadNode",(u=>u.loadNodeAsync&&u.loadNodeAsync(Z,x,F)))}_extensionsLoadCameraAsync(Z,x,F){return this._applyExtensions(x,"loadCamera",(u=>u.loadCameraAsync&&u.loadCameraAsync(Z,x,F)))}_extensionsLoadVertexDataAsync(Z,x,F){return this._applyExtensions(x,"loadVertexData",(u=>u._loadVertexDataAsync&&u._loadVertexDataAsync(Z,x,F)))}_extensionsLoadMeshPrimitiveAsync(Z,x,F,u,G,f){return this._applyExtensions(G,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(Z,x,F,u,G,f)))}_extensionsLoadMaterialAsync(Z,x,F,u,G){return this._applyExtensions(x,"loadMaterial",(f=>f._loadMaterialAsync&&f._loadMaterialAsync(Z,x,F,u,G)))}_extensionsCreateMaterial(Z,x,F){return this._applyExtensions(x,"createMaterial",(u=>u.createMaterial&&u.createMaterial(Z,x,F)))}_extensionsLoadMaterialPropertiesAsync(Z,x,F){return this._applyExtensions(x,"loadMaterialProperties",(u=>u.loadMaterialPropertiesAsync&&u.loadMaterialPropertiesAsync(Z,x,F)))}_extensionsLoadTextureInfoAsync(Z,x,F){return this._applyExtensions(x,"loadTextureInfo",(u=>u.loadTextureInfoAsync&&u.loadTextureInfoAsync(Z,x,F)))}_extensionsLoadTextureAsync(Z,x,F){return this._applyExtensions(x,"loadTexture",(u=>u._loadTextureAsync&&u._loadTextureAsync(Z,x,F)))}_extensionsLoadAnimationAsync(Z,x){return this._applyExtensions(x,"loadAnimation",(F=>F.loadAnimationAsync&&F.loadAnimationAsync(Z,x)))}_extensionsLoadAnimationChannelAsync(Z,x,F,u,G){return this._applyExtensions(F,"loadAnimationChannel",(f=>f._loadAnimationChannelAsync&&f._loadAnimationChannelAsync(Z,x,F,u,G)))}_extensionsLoadSkinAsync(Z,x,F){return this._applyExtensions(F,"loadSkin",(u=>u._loadSkinAsync&&u._loadSkinAsync(Z,x,F)))}_extensionsLoadUriAsync(Z,x,F){return this._applyExtensions(x,"loadUri",(u=>u._loadUriAsync&&u._loadUriAsync(Z,x,F)))}_extensionsLoadBufferViewAsync(Z,x){return this._applyExtensions(x,"loadBufferView",(F=>F.loadBufferViewAsync&&F.loadBufferViewAsync(Z,x)))}_extensionsLoadBufferAsync(Z,x,F,u){return this._applyExtensions(x,"loadBuffer",(G=>G.loadBufferAsync&&G.loadBufferAsync(Z,x,F,u)))}static LoadExtensionAsync(Z,x,F,u){if(!x.extensions)return null;const G=x.extensions[F];return G?u(`${Z}/extensions/${F}`,G):null}static LoadExtraAsync(Z,x,F,u){if(!x.extras)return null;const G=x.extras[F];return G?u(`${Z}/extras/${F}`,G):null}isExtensionUsed(Z){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(Z)}logOpen(Z){this._parent._logOpen(Z)}logClose(){this._parent._logClose()}log(Z){this._parent._log(Z)}startPerformanceCounter(Z){this._parent._startPerformanceCounter(Z)}endPerformanceCounter(Z){this._parent._endPerformanceCounter(Z)}}Q.DefaultSampler={index:-1},i.e._CreateGLTF2Loader=Z=>new Q(Z);var g=F(12897),O=F(11399),n=F(11213),V=F(12901),a=F(12907);class I extends a.c{constructor(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",Z),this._texture=Z.getEngine().createRawCubeTexture(x,F,u,G,f,Y,j,d)}update(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,Z,x,F,u,G)}updateRGBDAsync(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,V.m)(this._texture,Z,x,F,u).then((()=>{}))}clone(){return n.c.Clone((()=>{const Z=this.KZ(),x=this._texture,F=new I(Z,x._bufferViewArray,x.width,x.format,x.type,x.generateMipMaps,x.invertY,x.samplingMode,x._compression);return 13===x.source&&F.updateRGBDAsync(x._bufferViewArrayArray,x._sphericalPolynomial,x._lodGenerationScale,x._lodGenerationOffset),F}),this)}}const r="EXT_lights_image_based";class z{constructor(Z){this.name=r,this._loader=Z,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Cf.extensions;if(Z&&Z[this.name]){const x=Z[this.name];this._lights=x.lights}}loadSceneAsync(Z,x){return Q.LoadExtensionAsync(Z,x,this.name,(async(F,u)=>{this._loader._allMaterialsDirtyRequired=!0;const G=new Array;G.push(this._loader.loadSceneAsync(Z,x)),this._loader.logOpen(`${F}`);const f=X.Get(`${F}/light`,this._lights,u.jf);return G.push(this._loadLightAsync(`/extensions/${this.name}/lights/${u.jf}`,f).then((Z=>{this._loader.babylonScene.environmentTexture=Z}))),this._loader.logClose(),await Promise.all(G).then((()=>{}))}))}_loadLightAsync(Z,x){if(!x._loaded){const F=new Array;this._loader.logOpen(`${Z}`);const u=new Array(x.specularImages.length);for(let G=0;G<x.specularImages.length;G++){const f=x.specularImages[G];u[G]=new Array(f.length);for(let x=0;x<f.length;x++){const Y=`${Z}/specularImages/${G}/${x}`;this._loader.logOpen(`${Y}`);const j=f[x],d=X.Get(Y,this._loader.Cf.images,j);F.push(this._loader.loadImageAsync(`/images/${j}`,d).then((Z=>{u[G][x]=Z}))),this._loader.logClose()}}this._loader.logClose(),x._loaded=Promise.all(F).then((async()=>{const F=new I(this._loader.babylonScene,null,x.specularImageSize);if(F.name=x.name||"environment",x._babylonTexture=F,void 0!=x.Cj&&(F.level=x.Cj),x.rotation){let Z=G.Quaternion.Hx(x.rotation);this._loader.babylonScene.useRightHandedSystem||(Z=G.Quaternion.Inverse(Z)),G.Matrix.FromQuaternionToRef(Z,F.getReflectionTextureMatrix())}if(!x.irradianceCoefficients)throw new Error(`${Z}: Irradiance coefficients are missing`);const f=O.e.Hx(x.irradianceCoefficients);f.scaleInPlace(x.Cj),f.convertIrradianceToLambertianRadiance();const Y=O.f.FromHarmonics(f),j=(u.length-1)/Math.log2(x.specularImageSize);return await F.updateRGBDAsync(u,Y,j)}))}return x._loaded.then((()=>x._babylonTexture))}}N(r),T(r,!0,(Z=>new z(Z)));F(11783);const P="EXT_mesh_gpu_instancing";class ZZ{constructor(Z){this.name=P,this._loader=Z,this.enabled=this._loader.isExtensionUsed(P)}dispose(){this._loader=null}loadNodeAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(Z,u)=>{this._loader._disableInstancedMesh++;const f=this._loader.loadNodeAsync(`/nodes/${x.index}`,x,F);if(this._loader._disableInstancedMesh--,!x._primitiveBabylonMeshes)return await f;const Y=new Array;let j=0;const d=x=>{if(void 0==u.attributes[x])return void Y.push(Promise.resolve(null));const F=X.Get(`${Z}/attributes/${x}`,this._loader.Cf.accessors,u.attributes[x]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${F.bufferView}`,F)),0===j)j=F.count;else if(j!==F.count)throw new Error(`${Z}/attributes: Instance buffer accessors do not have the same count.`)};return d("TRANSLATION"),d("ROTATION"),d("SCALE"),await f.then((async Z=>{const[F,u,f]=await Promise.all(Y),d=new Float32Array(16*j);G.TmpVectors.kx[0].Jj(0,0,0),G.TmpVectors.Quaternion[0].Jj(0,0,0,1),G.TmpVectors.kx[1].Jj(1,1,1);for(let x=0;x<j;++x)F&&G.kx.FromArrayToRef(F,3*x,G.TmpVectors.kx[0]),u&&G.Quaternion.FromArrayToRef(u,4*x,G.TmpVectors.Quaternion[0]),f&&G.kx.FromArrayToRef(f,3*x,G.TmpVectors.kx[1]),G.Matrix.ComposeToRef(G.TmpVectors.kx[1],G.TmpVectors.Quaternion[0],G.TmpVectors.kx[0],G.TmpVectors.Matrix[0]),G.TmpVectors.Matrix[0].copyToArray(d,16*x);for(const G of x._primitiveBabylonMeshes)G.ss("matrix",d,16,!0);return Z}))}))}}N(P),T(P,!0,(Z=>new ZZ(Z)));let xZ=0,FZ=null;class uZ{static get Default(){return uZ._Default||(uZ._Default=new uZ),uZ._Default}constructor(){const Z=uZ.Configuration.decoder;this._decoderModulePromise=Y.Tools.LoadBabylonScriptAsync(Z.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(Z,x,F,u,G){await this._decoderModulePromise,0===xZ&&(MeshoptDecoder.useWorkers(1),xZ=1);const f=await MeshoptDecoder.decodeGltfBufferAsync(x,F,Z,u,G);return null!==FZ&&clearTimeout(FZ),FZ=setTimeout((()=>{MeshoptDecoder.useWorkers(0),xZ=0,FZ=null}),1e3),f}}uZ.Configuration={decoder:{url:`${Y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},uZ._Default=null;const GZ="EXT_meshopt_compression";class fZ{constructor(Z){this.name=GZ,this.enabled=Z.isExtensionUsed(GZ),this._loader=Z}dispose(){this._loader=null}loadBufferViewAsync(Z,x){return Q.LoadExtensionAsync(Z,x,this.name,(async(F,u)=>{const G=x;if(G._meshOptData)return await G._meshOptData;const f=X.Get(`${Z}/buffer`,this._loader.Cf.buffers,u.buffer);return G._meshOptData=this._loader.loadBufferAsync(`/buffers/${f.index}`,f,u.byteOffset||0,u.byteLength).then((async Z=>await uZ.Default.decodeGltfBufferAsync(Z,u.count,u.byteStride,u.mode,u.filter))),await G._meshOptData}))}}N(GZ),T(GZ,!0,(Z=>new fZ(Z)));const YZ="EXT_texture_webp";class jZ{constructor(Z){this.name=YZ,this._loader=Z,this.enabled=Z.isExtensionUsed(YZ)}dispose(){this._loader=null}_loadTextureAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=void 0==x.sampler?Q.DefaultSampler:X.Get(`${Z}/sampler`,this._loader.Cf.samplers,x.sampler),Y=X.Get(`${u}/source`,this._loader.Cf.images,G.source);return await this._loader._createTextureAsync(Z,f,Y,(Z=>{F(Z)}),void 0,!x._textureInfo.nonColorData)}))}}N(YZ),T(YZ,!0,(Z=>new jZ(Z)));const dZ="EXT_texture_avif";class tZ{constructor(Z){this.name=dZ,this._loader=Z,this.enabled=Z.isExtensionUsed(dZ)}dispose(){this._loader=null}_loadTextureAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=void 0==x.sampler?Q.DefaultSampler:X.Get(`${Z}/sampler`,this._loader.Cf.samplers,x.sampler),Y=X.Get(`${u}/source`,this._loader.Cf.images,G.source);return await this._loader._createTextureAsync(Z,f,Y,(Z=>{F(Z)}),void 0,!x._textureInfo.nonColorData)}))}}N(dZ),T(dZ,!0,(Z=>new tZ(Z)));var oZ=F(12895),cZ=F(11764);const sZ="EXT_lights_ies";class JZ{constructor(Z){this.name=sZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(sZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Cf.extensions;if(Z&&Z[this.name]){const x=Z[this.name];this._lights=x.lights,X.Assign(this._lights)}}loadNodeAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,Y)=>{let j,d;this._loader._allMaterialsDirtyRequired=!0;const t=await this._loader.loadNodeAsync(Z,x,(Z=>{d=X.Get(u,this._lights,Y.jf);const x=d.name||Z.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,j=new oZ.b(x,G.kx.Zero(),G.kx.Backward(),0,1,this._loader.babylonScene),j.angle=Math.PI/2,j.innerAngle=0,j._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,d._babylonLight=j,j.falloffType=cZ.e.FALLOFF_GLTF,j.Lj=Y.color?f.Lx.Hx(Y.color):f.Lx.White(),j.Cj=Y.multiplier||1,j.range=Number.MAX_VALUE,j.parent=Z,this._loader._babylonLights.push(j),Q.AddPointerMetadata(j,u),F(Z)}));let o;if(d.uri)o=await this._loader.loadUriAsync(Z,d,d.uri);else{const x=X.Get(`${Z}/bufferView`,this._loader.Cf.bufferViews,d.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return j.iesProfileTexture=new L.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),t}))}}N(sZ),T(sZ,!0,(Z=>new JZ(Z)));var pZ=F(12922);const UZ="KHR_draco_mesh_compression";class kZ{constructor(Z){this.name=UZ,this.useNormalizedFlagFromAccessor=!0,this._loader=Z,this.enabled=pZ.b.DefaultAvailable&&this._loader.isExtensionUsed(UZ)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{if(void 0!=x.mode&&4!==x.mode&&5!==x.mode)throw new Error(`${Z}: Unsupported mode ${x.mode}`);const f={},Y={},j=(Z,u)=>{const j=G.attributes[Z];if(void 0!=j&&(F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(u)&&F._delayInfo.push(u),f[u]=j,this.useNormalizedFlagFromAccessor)){const F=X.TryGet(this._loader.Cf.accessors,x.attributes[Z]);F&&(Y[u]=F.normalized||!1)}};j("POSITION",S.f.PositionKind),j("NORMAL",S.f.NormalKind),j("TANGENT",S.f.TangentKind),j("TEXCOORD_0",S.f.UVKind),j("TEXCOORD_1",S.f.UV2Kind),j("TEXCOORD_2",S.f.UV3Kind),j("TEXCOORD_3",S.f.UV4Kind),j("TEXCOORD_4",S.f.UV5Kind),j("TEXCOORD_5",S.f.UV6Kind),j("JOINTS_0",S.f.MatricesIndicesKind),j("WEIGHTS_0",S.f.MatricesWeightsKind),j("COLOR_0",S.f.ColorKind);const d=X.Get(u,this._loader.Cf.bufferViews,G.bufferView);return d._dracoBabylonGeometry||(d._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((async u=>{const G=this.dracoDecoder||pZ.b.Default,j=X.TryGet(this._loader.Cf.accessors,x.attributes.POSITION),d=this._loader.parent.alwaysComputeBoundingBox||F.skeleton||!j?null:D(j);return await G._decodeMeshToGeometryForGltfAsync(F.name,this._loader.babylonScene,u,f,Y,d).catch((x=>{throw new Error(`${Z}: ${x.message}`)}))}))),await d._dracoBabylonGeometry}))}}N(UZ),T(UZ,!0,(Z=>new kZ(Z)));var MZ=F(12928),mZ=F(11159),CZ=F(11165),LZ=F(11634),HZ=F(11820),SZ=F(11136);LZ.e.AddNodeConstructor("Light_Type_0",((Z,x)=>()=>new KZ(Z,G.kx.Zero(),x)));class KZ extends HZ.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(Z){this._shadowAngle=Z,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(Z){const x=this.needCube();if(this._direction=Z,this.needCube()!==x&&this._shadowGenerators){const Z=this._shadowGenerators.values();for(let x=Z.next();!0!==x.done;x=Z.next()){x.value.recreateShadowMap()}}}constructor(Z,x,F){super(Z,F),this._shadowAngle=Math.PI/2,this.position=x}getClassName(){return"PointLight"}getTypeID(){return cZ.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(Z){if(this.direction)return super.getShadowDirection(Z);switch(Z){case 0:return new G.kx(1,0,0);case 1:return new G.kx(-1,0,0);case 2:return new G.kx(0,-1,0);case 3:return new G.kx(0,1,0);case 4:return new G.kx(0,0,1);case 5:return new G.kx(0,0,-1)}return G.kx.Zero()}_setDefaultShadowProjectionMatrix(Z,x,F){const u=this.KZ().activeCamera;if(!u)return;const f=void 0!==this.shadowMinZ?this.shadowMinZ:u.hf,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,j=this.KZ().getEngine().useReverseDepthBuffer;G.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,j?Y:f,j?f:Y,Z,!0,this._scene.getEngine().isNDCHalfZRange,void 0,j)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(Z,x){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,x):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,x),this}transferToNodeMaterialEffect(Z,x){return this.computeTransformedInformation()?Z.setFloat3(x,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):Z.setFloat3(x,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(Z,x){Z["POINTLIGHT"+x]=!0}}(0,mZ.d)([(0,CZ.H)()],KZ.prototype,"shadowAngle",null),(0,SZ.g)("BABYLON.PointLight",KZ);const yZ="KHR_lights_punctual";class qZ{constructor(Z){this.name=yZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(yZ)}dispose(){this._loader=null,delete this._lights}onLoading(){const Z=this._loader.Cf.extensions;if(Z&&Z[this.name]){const x=Z[this.name];this._lights=x.lights,X.Assign(this._lights)}}loadNodeAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(Z,x,(Z=>{let x;const j=X.Get(u,this._lights,Y.jf),d=j.name||Z.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,j.type){case"directional":{const Z=new MZ.e(d,G.kx.Backward(),this._loader.babylonScene);Z.position.Uj(0),x=Z;break}case"point":x=new KZ(d,G.kx.Zero(),this._loader.babylonScene);break;case"spot":{const Z=new oZ.b(d,G.kx.Zero(),G.kx.Backward(),0,1,this._loader.babylonScene);Z.angle=2*(j.spot&&j.spot.outerConeAngle||Math.PI/4),Z.innerAngle=2*(j.spot&&j.spot.innerConeAngle||0),x=Z;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${u}: Invalid light type (${j.type})`)}x._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,j._babylonLight=x,x.falloffType=cZ.e.FALLOFF_GLTF,x.Lj=j.color?f.Lx.Hx(j.color):f.Lx.White(),x.Cj=void 0==j.Cj?1:j.Cj,x.range=void 0==j.range?Number.MAX_VALUE:j.range,x.parent=Z,this._loader._babylonLights.push(x),Q.AddPointerMetadata(x,u),F(Z)})))))}}N(yZ),T(yZ,!0,(Z=>new qZ(Z)));const RZ="KHR_materials_pbrSpecularGlossiness";class BZ{constructor(Z){this.name=RZ,this.order=200,this._loader=Z,this.enabled=this._loader.isExtensionUsed(RZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialBasePropertiesAsync(Z,x,F)),f.push(this._loadSpecularGlossinessPropertiesAsync(u,G,F)),this._loader.loadMaterialAlphaProperties(Z,x,F),await Promise.all(f).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.metallic=null,F.roughness=null,x.diffuseFactor?(F.albedoColor=f.Lx.Hx(x.diffuseFactor),F.alpha=x.diffuseFactor[3]):F.albedoColor=f.Lx.White(),F.reflectivityColor=x.specularFactor?f.Lx.Hx(x.specularFactor):f.Lx.White(),F.microSurface=void 0==x.glossinessFactor?1:x.glossinessFactor,x.diffuseTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTexture`,x.diffuseTexture,(Z=>{Z.name=`${F.name} (Diffuse)`,F.albedoTexture=Z}))),x.specularGlossinessTexture&&(u.push(this._loader.loadTextureInfoAsync(`${Z}/specularGlossinessTexture`,x.specularGlossinessTexture,(Z=>{Z.name=`${F.name} (Specular Glossiness)`,F.reflectivityTexture=Z,F.reflectivityTexture.Af=!0}))),F.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(u).then((()=>{}))}}N(RZ),T(RZ,!0,(Z=>new BZ(Z)));const vZ="KHR_materials_unlit";class lZ{constructor(Z){this.name=vZ,this.order=210,this._loader=Z,this.enabled=this._loader.isExtensionUsed(vZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async()=>await this._loadUnlitPropertiesAsync(Z,x,F)))}_loadUnlitPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;F.unlit=!0;const G=x.pbrMetallicRoughness;return G&&(G.baseColorFactor?(F.albedoColor=f.Lx.Hx(G.baseColorFactor),F.alpha=G.baseColorFactor[3]):F.albedoColor=f.Lx.White(),G.baseColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/baseColorTexture`,G.baseColorTexture,(Z=>{Z.name=`${F.name} (Base Color)`,F.albedoTexture=Z})))),x.doubleSided&&(F.sj=!1,F.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(Z,x,F),Promise.all(u).then((()=>{}))}}N(vZ),T(vZ,!0,(Z=>new lZ(Z)));const iZ="KHR_materials_clearcoat";class eZ{constructor(Z){this.name=iZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(iZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadClearCoatPropertiesAsync(u,G,F)),await Promise.all(f)}))}_loadClearCoatPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.clearCoat.isEnabled=!0,F.clearCoat.useRoughnessFromMainTexture=!1,F.clearCoat.remapF0OnInterfaceChange=!1,void 0!=x.clearcoatFactor?F.clearCoat.Cj=x.clearcoatFactor:F.clearCoat.Cj=0,x.clearcoatTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatTexture`,x.clearcoatTexture,(Z=>{Z.name=`${F.name} (ClearCoat)`,F.clearCoat.texture=Z}))),void 0!=x.clearcoatRoughnessFactor?F.clearCoat.roughness=x.clearcoatRoughnessFactor:F.clearCoat.roughness=0,x.clearcoatRoughnessTexture&&(x.clearcoatRoughnessTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatRoughnessTexture`,x.clearcoatRoughnessTexture,(Z=>{Z.name=`${F.name} (ClearCoat Roughness)`,F.clearCoat.textureRoughness=Z})))),x.clearcoatNormalTexture&&(x.clearcoatNormalTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${Z}/clearcoatNormalTexture`,x.clearcoatNormalTexture,(Z=>{Z.name=`${F.name} (ClearCoat Normal)`,F.clearCoat.bumpTexture=Z}))),F.invertNormalMapX=!F.KZ().useRightHandedSystem,F.invertNormalMapY=F.KZ().useRightHandedSystem,void 0!=x.clearcoatNormalTexture.scale&&(F.clearCoat.bumpTexture.level=x.clearcoatNormalTexture.scale)),Promise.all(u).then((()=>{}))}}N(iZ),T(iZ,!0,(Z=>new eZ(Z)));const bZ="KHR_materials_iridescence";class EZ{constructor(Z){this.name=bZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(bZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadIridescencePropertiesAsync(u,G,F)),await Promise.all(f).then((()=>{}))}))}_loadIridescencePropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.iridescence.isEnabled=!0,F.iridescence.Cj=x.iridescenceFactor??0,F.iridescence.indexOfRefraction=x.iridescenceIor??x.iridescenceIOR??1.3,F.iridescence.minimumThickness=x.iridescenceThicknessMinimum??100,F.iridescence.maximumThickness=x.iridescenceThicknessMaximum??400,x.iridescenceTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceTexture`,x.iridescenceTexture,(Z=>{Z.name=`${F.name} (Iridescence)`,F.iridescence.texture=Z}))),x.iridescenceThicknessTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/iridescenceThicknessTexture`,x.iridescenceThicknessTexture,(Z=>{Z.name=`${F.name} (Iridescence Thickness)`,F.iridescence.thicknessTexture=Z}))),Promise.all(u).then((()=>{}))}}N(bZ),T(bZ,!0,(Z=>new EZ(Z)));const wZ="KHR_materials_anisotropy";class TZ{constructor(Z){this.name=wZ,this.order=195,this._loader=Z,this.enabled=this._loader.isExtensionUsed(wZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadIridescencePropertiesAsync(u,G,F)),await Promise.all(f)}))}async _loadIridescencePropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;F.anisotropy.isEnabled=!0,F.anisotropy.Cj=x.anisotropyStrength??0,F.anisotropy.angle=x.anisotropyRotation??0,x.anisotropyTexture&&(x.anisotropyTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${Z}/anisotropyTexture`,x.anisotropyTexture,(Z=>{Z.name=`${F.name} (Anisotropy Intensity)`,F.anisotropy.texture=Z})))),await Promise.all(u)}}N(wZ),T(wZ,!0,(Z=>new TZ(Z)));const NZ="KHR_materials_emissive_strength";class WZ{constructor(Z){this.name=NZ,this.order=170,this._loader=Z,this.enabled=this._loader.isExtensionUsed(NZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>await this._loader.loadMaterialPropertiesAsync(Z,x,F).then((()=>{this._loadEmissiveProperties(u,G,F)}))))}_loadEmissiveProperties(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);void 0!==x.emissiveStrength&&(F.emissiveIntensity=x.emissiveStrength)}}N(NZ),T(NZ,!0,(Z=>new WZ(Z)));const AZ="KHR_materials_sheen";class hZ{constructor(Z){this.name=AZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(AZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadSheenPropertiesAsync(u,G,F)),await Promise.all(f).then((()=>{}))}))}_loadSheenPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.sheen.isEnabled=!0,F.sheen.Cj=1,void 0!=x.sheenColorFactor?F.sheen.color=f.Lx.Hx(x.sheenColorFactor):F.sheen.color=f.Lx.Black(),x.sheenColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/sheenColorTexture`,x.sheenColorTexture,(Z=>{Z.name=`${F.name} (Sheen Color)`,F.sheen.texture=Z}))),void 0!==x.sheenRoughnessFactor?F.sheen.roughness=x.sheenRoughnessFactor:F.sheen.roughness=0,x.sheenRoughnessTexture&&(x.sheenRoughnessTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${Z}/sheenRoughnessTexture`,x.sheenRoughnessTexture,(Z=>{Z.name=`${F.name} (Sheen Roughness)`,F.sheen.textureRoughness=Z})))),F.sheen.albedoScaling=!0,F.sheen.useRoughnessFromMainTexture=!1,Promise.all(u).then((()=>{}))}}N(AZ),T(AZ,!0,(Z=>new hZ(Z)));var XZ=F(11697);const DZ="KHR_materials_specular";class QZ{constructor(Z){this.name=DZ,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(DZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;if(f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadSpecularPropertiesAsync(u,G,F)),G.extensions&&G.extensions.EXT_materials_specular_edge_color&&F instanceof C.c){G.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(F.brdf.dielectricSpecularModel=XZ.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,F.brdf.conductorSpecularModel=XZ.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(f).then((()=>{}))}))}_loadSpecularPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return void 0!==x.specularFactor&&(F.metallicF0Factor=x.specularFactor),void 0!==x.specularColorFactor&&(F.metallicReflectanceColor=f.Lx.Hx(x.specularColorFactor)),x.specularTexture&&(x.specularTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${Z}/specularTexture`,x.specularTexture,(Z=>{Z.name=`${F.name} (Specular)`,F.metallicReflectanceTexture=Z,F.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),x.specularColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/specularColorTexture`,x.specularColorTexture,(Z=>{Z.name=`${F.name} (Specular Color)`,F.reflectanceTexture=Z}))),Promise.all(u).then((()=>{}))}}N(DZ),T(DZ,!0,(Z=>new QZ(Z)));const gZ="KHR_materials_ior";class OZ{constructor(Z){this.name=gZ,this.order=180,this._loader=Z,this.enabled=this._loader.isExtensionUsed(gZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadIorPropertiesAsync(u,G,F)),await Promise.all(f).then((()=>{}))}))}_loadIorPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);return void 0!==x.ior?F.indexOfRefraction=x.ior:F.indexOfRefraction=OZ._DEFAULT_IOR,Promise.resolve()}}OZ._DEFAULT_IOR=1.5,N(gZ),T(gZ,!0,(Z=>new OZ(Z)));const nZ="KHR_materials_variants";class VZ{constructor(Z){this.name=nZ,this._loader=Z,this.enabled=this._loader.isExtensionUsed(nZ)}dispose(){this._loader=null}static GetAvailableVariants(Z){const x=this._GetExtensionMetadata(Z);return x?Object.keys(x.variants):[]}getAvailableVariants(Z){return VZ.GetAvailableVariants(Z)}static SelectVariant(Z,x){const F=this._GetExtensionMetadata(Z);if(!F)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${nZ} extension`);const u=Z=>{const x=F.variants[Z];if(x)for(const F of x)F.mesh.material=F.material};if(x instanceof Array)for(const G of x)u(G);else u(x);F.lastSelected=x}selectVariant(Z,x){VZ.SelectVariant(Z,x)}static Reset(Z){const x=this._GetExtensionMetadata(Z);if(!x)throw new Error(`Cannot reset on a glTF mesh that does not have the ${nZ} extension`);for(const F of x.original)F.mesh.material=F.material;x.lastSelected=null}reset(Z){VZ.Reset(Z)}static GetLastSelectedVariant(Z){const x=this._GetExtensionMetadata(Z);if(!x)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${nZ} extension`);return x.lastSelected}getLastSelectedVariant(Z){return VZ.GetLastSelectedVariant(Z)}static _GetExtensionMetadata(Z){var x,F;return(null===Z||void 0===Z||null===(x=Z._internalMetadata)||void 0===x||null===(F=x.Cf)||void 0===F?void 0:F[nZ])||null}onLoading(){const Z=this._loader.Cf.extensions;if(Z&&Z[this.name]){const x=Z[this.name];this._variants=x.variants}}onReady(){const Z=this._loader.rootBabylonMesh;if(Z){var x;const F=this._loader.parent.extensionOptions[nZ];null!==F&&void 0!==F&&F.defaultVariant&&VZ.SelectVariant(Z,F.defaultVariant),null===F||void 0===F||null===(x=F.onLoaded)||void 0===x||x.call(F,{get variants(){return VZ.GetAvailableVariants(Z)},get selectedVariant(){const x=VZ.GetLastSelectedVariant(Z);return x?Array.isArray(x)?x[0]:x:VZ.GetAvailableVariants(Z)[0]},set selectedVariant(x){VZ.SelectVariant(Z,x)}})}}_loadMeshPrimitiveAsync(Z,x,F,u,G,f){return Q.LoadExtensionAsync(Z,G,this.name,(async(Y,j)=>{const d=new Array;return d.push(this._loader._loadMeshPrimitiveAsync(Z,x,F,u,G,(x=>{if(f(x),x instanceof q.d){const F=Q._GetDrawMode(Z,G.mode),u=this._loader.rootBabylonMesh,f=u?u._internalMetadata=u._internalMetadata||{}:{},t=f.Cf=f.Cf||{},o=t[nZ]=t[nZ]||{lastSelected:null,original:[],variants:{}};o.original.push({mesh:x,material:x.material});for(let Z=0;Z<j.mappings.length;++Z){const G=j.mappings[Z],f=X.Get(`${Y}/mappings/${Z}/material`,this._loader.Cf.materials,G.material);d.push(this._loader._loadMaterialAsync(`#/materials/${G.material}`,f,x,F,(Z=>{for(let F=0;F<G.variants.length;++F){const f=G.variants[F],Y=X.Get(`/extensions/${nZ}/variants/${f}`,this._variants,f);o.variants[Y.name]=o.variants[Y.name]||[],o.variants[Y.name].push({mesh:x,material:Z}),x.onClonedObservable.add((Z=>{const F=Z;let G=null,f=F;do{if(f=f.parent,!f)return;G=VZ._GetExtensionMetadata(f)}while(null===G);if(u&&G===VZ._GetExtensionMetadata(u)){f._internalMetadata={};for(const Z in u._internalMetadata)f._internalMetadata[Z]=u._internalMetadata[Z];f._internalMetadata.Cf=[];for(const Z in u._internalMetadata.Cf)f._internalMetadata.Cf[Z]=u._internalMetadata.Cf[Z];f._internalMetadata.Cf[nZ]={lastSelected:null,original:[],variants:{}};for(const Z of G.original)f._internalMetadata.Cf[nZ].original.push({mesh:Z.mesh,material:Z.material});for(const Z in G.variants)if(Object.prototype.hasOwnProperty.call(G.variants,Z)){f._internalMetadata.Cf[nZ].variants[Z]=[];for(const x of G.variants[Z])f._internalMetadata.Cf[nZ].variants[Z].push({mesh:x.mesh,material:x.material})}G=f._internalMetadata.Cf[nZ]}for(const u of G.original)u.mesh===x&&(u.mesh=F);for(const u of G.variants[Y.name])u.mesh===x&&(u.mesh=F)}))}})))}}}))),await Promise.all(d).then((Z=>{let[x]=Z;return x}))}))}}N(nZ),T(nZ,!0,(Z=>new VZ(Z)));var aZ=F(11249);class IZ{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:XZ.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(Z,x){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...IZ._GetDefaultOptions(),...Z},this._scene=x,this._scene._transmissionHelper=this,this.onErrorObservable=new o.b,this._scene.Uf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(Z){if(!Object.keys(Z).filter((x=>this._options[x]!==Z[x])).length)return;const x={...this._options,...Z},F=this._options;this._options=x,x.renderSize===F.renderSize&&x.renderTargetTextureType===F.renderTargetTextureType&&x.generateMipmaps===F.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=x.samples,this._opaqueRenderTarget.lodGenerationScale=x.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=x.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(Z){return!!Z&&!!(Z instanceof C.c&&Z.subSurface.isRefractionEnabled)}_addMesh(Z){this._materialObservers[Z.uniqueId]=Z.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(Z.material)?(Z.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(Z)&&this._transparentMeshesCache.push(Z)):-1===this._opaqueMeshesCache.indexOf(Z)&&this._opaqueMeshesCache.push(Z)}))}_removeMesh(Z){Z.onMaterialChangedObservable.remove(this._materialObservers[Z.uniqueId]),delete this._materialObservers[Z.uniqueId];let x=this._transparentMeshesCache.indexOf(Z);-1!==x&&this._transparentMeshesCache.splice(x,1),x=this._opaqueMeshesCache.indexOf(Z),-1!==x&&this._opaqueMeshesCache.splice(x,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(Z){const x=this._transparentMeshesCache.indexOf(Z),F=this._opaqueMeshesCache.indexOf(Z);this._shouldRenderAsTransmission(Z.material)?(Z.material instanceof C.c&&(Z.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==F?(this._opaqueMeshesCache.splice(F,1),this._transparentMeshesCache.push(Z)):-1===x&&this._transparentMeshesCache.push(Z)):-1!==x?(this._transparentMeshesCache.splice(x,1),this._opaqueMeshesCache.push(Z)):-1===F&&this._opaqueMeshesCache.push(Z)}_isRenderTargetValid(){var Z;return null!==(null===(Z=this._opaqueRenderTarget)||void 0===Z?void 0:Z.getInternalTexture())}_setupRenderTargets(){var Z;let x;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new aZ.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(Z=this._options.clearColor)||void 0===Z?void 0:Z.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((Z=>{x=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?Z.clearColor.G(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(Z.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=x}));for(const F of this._transparentMeshesCache)this._shouldRenderAsTransmission(F.material)&&(F.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const rZ="KHR_materials_transmission";class zZ{constructor(Z){this.name=rZ,this.order=175,this._loader=Z,this.enabled=this._loader.isExtensionUsed(rZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadTransparentPropertiesAsync(u,x,F,G)),await Promise.all(f).then((()=>{}))}))}_loadTransparentPropertiesAsync(Z,x,F,u){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const G=F;if(G.subSurface.isRefractionEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.useAlbedoToTintRefraction=!0,void 0===u.transmissionFactor)return G.subSurface.refractionIntensity=0,G.subSurface.isRefractionEnabled=!1,Promise.resolve();{var f;G.subSurface.refractionIntensity=u.transmissionFactor;const Z=G.KZ();if(G.subSurface.refractionIntensity&&!Z._transmissionHelper)new IZ({},G.KZ());else if(G.subSurface.refractionIntensity&&(null===(f=Z._transmissionHelper)||void 0===f||!f._isRenderTargetValid())){var Y;null===(Y=Z._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,u.transmissionTexture?(u.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/transmissionTexture`,u.transmissionTexture,void 0).then((Z=>{Z.name=`${F.name} (Transmission)`,G.subSurface.refractionIntensityTexture=Z,G.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(rZ),T(rZ,!0,(Z=>new zZ(Z)));const PZ="KHR_materials_diffuse_transmission";class Zx{constructor(Z){this.name=PZ,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(PZ),this.enabled&&(Z.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadTranslucentPropertiesAsync(u,x,F,G)),await Promise.all(f).then((()=>{}))}))}_loadTranslucentPropertiesAsync(Z,x,F,u){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const G=F;if(G.subSurface.isTranslucencyEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,G.subSurface.useAlbedoToTintTranslucency=!1,void 0===u.diffuseTransmissionFactor)return G.subSurface.translucencyIntensity=0,G.subSurface.isTranslucencyEnabled=!1,Promise.resolve();G.subSurface.translucencyIntensity=u.diffuseTransmissionFactor;const Y=new Array;return G.subSurface.useGltfStyleTextures=!0,u.diffuseTransmissionTexture&&(u.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionTexture`,u.diffuseTransmissionTexture).then((Z=>{Z.name=`${F.name} (Diffuse Transmission)`,G.subSurface.translucencyIntensityTexture=Z})))),void 0!==u.diffuseTransmissionColorFactor?G.subSurface.translucencyColor=f.Lx.Hx(u.diffuseTransmissionColorFactor):G.subSurface.translucencyColor=f.Lx.White(),u.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseTransmissionColorTexture`,u.diffuseTransmissionColorTexture).then((Z=>{Z.name=`${F.name} (Diffuse Transmission Color)`,G.subSurface.translucencyColorTexture=Z}))),Promise.all(Y).then((()=>{}))}}N(PZ),T(PZ,!0,(Z=>new Zx(Z)));const xx="KHR_materials_volume";class Fx{constructor(Z){this.name=xx,this.order=173,this._loader=Z,this.enabled=this._loader.isExtensionUsed(xx),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadVolumePropertiesAsync(u,x,F,G)),await Promise.all(f).then((()=>{}))}))}_loadVolumePropertiesAsync(Z,x,F,u){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);if(!F.subSurface.isRefractionEnabled&&!F.subSurface.isTranslucencyEnabled||!u.thicknessFactor)return Promise.resolve();F.subSurface.volumeIndexOfRefraction=F.indexOfRefraction;const G=void 0!==u.attenuationDistance?u.attenuationDistance:Number.MAX_VALUE;return F.subSurface.tintColorAtDistance=G,void 0!==u.attenuationColor&&3==u.attenuationColor.length&&F.subSurface.tintColor.Jj(u.attenuationColor[0],u.attenuationColor[1],u.attenuationColor[2]),F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=u.thicknessFactor,F.subSurface.useThicknessAsDepth=!0,u.thicknessTexture?(u.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${Z}/thicknessTexture`,u.thicknessTexture).then((Z=>{Z.name=`${F.name} (Thickness)`,F.subSurface.thicknessTexture=Z,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(xx),T(xx,!0,(Z=>new Fx(Z)));const ux="KHR_materials_dispersion";class Gx{constructor(Z){this.name=ux,this.order=174,this._loader=Z,this.enabled=this._loader.isExtensionUsed(ux)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadDispersionPropertiesAsync(u,x,F,G)),await Promise.all(f).then((()=>{}))}))}_loadDispersionPropertiesAsync(Z,x,F,u){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);return F.subSurface.isRefractionEnabled&&u.dispersion?(F.subSurface.isDispersionEnabled=!0,F.subSurface.dispersion=u.dispersion,Promise.resolve()):Promise.resolve()}}N(ux),T(ux,!0,(Z=>new Gx(Z)));const fx="EXT_materials_diffuse_roughness";class Yx{constructor(Z){this.name=fx,this.order=190,this._loader=Z,this.enabled=this._loader.isExtensionUsed(fx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=new Array;return f.push(this._loader.loadMaterialPropertiesAsync(Z,x,F)),f.push(this._loadDiffuseRoughnessPropertiesAsync(u,G,F)),await Promise.all(f).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(Z,x,F){if(!(F instanceof C.c))throw new Error(`${Z}: Material type not supported`);const u=new Array;return F.brdf.baseDiffuseModel=XZ.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=x.diffuseRoughnessFactor?F.baseDiffuseRoughness=x.diffuseRoughnessFactor:F.baseDiffuseRoughness=0,x.diffuseRoughnessTexture&&u.push(this._loader.loadTextureInfoAsync(`${Z}/diffuseRoughnessTexture`,x.diffuseRoughnessTexture,(Z=>{Z.name=`${F.name} (Diffuse Roughness)`,F.baseDiffuseRoughnessTexture=Z}))),Promise.all(u).then((()=>{}))}}N(fx),T(fx,!0,(Z=>new Yx(Z)));const jx="KHR_mesh_quantization";class dx{constructor(Z){this.name=jx,this.enabled=Z.isExtensionUsed(jx)}dispose(){}}N(jx),T(jx,!0,(Z=>new dx(Z)));const tx="KHR_texture_basisu";class ox{constructor(Z){this.name=tx,this._loader=Z,this.enabled=Z.isExtensionUsed(tx)}dispose(){this._loader=null}_loadTextureAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>{const f=void 0==x.sampler?Q.DefaultSampler:X.Get(`${Z}/sampler`,this._loader.Cf.samplers,x.sampler),Y=X.Get(`${u}/source`,this._loader.Cf.images,G.source);return await this._loader._createTextureAsync(Z,f,Y,(Z=>{F(Z)}),x._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!x._textureInfo.nonColorData)}))}}N(tx),T(tx,!0,(Z=>new ox(Z)));const cx="KHR_texture_transform";class sx{constructor(Z){this.name=cx,this._loader=Z,this.enabled=this._loader.isExtensionUsed(cx)}dispose(){this._loader=null}loadTextureInfoAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(u,G)=>await this._loader.loadTextureInfoAsync(Z,x,(Z=>{if(!(Z instanceof L.c))throw new Error(`${u}: Texture type not supported`);G.offset&&(Z.uOffset=G.offset[0],Z.vOffset=G.offset[1]),Z.uRotationCenter=0,Z.vRotationCenter=0,G.rotation&&(Z.wAng=-G.rotation),G.scale&&(Z.uScale=G.scale[0],Z.vScale=G.scale[1]),void 0!=G.texCoord&&(Z.coordinatesIndex=G.texCoord),F(Z)}))))}}N(cx),T(cx,!0,(Z=>new sx(Z)));const Jx="KHR_xmp_json_ld";class px{constructor(Z){this.name=Jx,this.order=100,this._loader=Z,this.enabled=this._loader.isExtensionUsed(Jx)}dispose(){this._loader=null}onLoading(){var Z,x,F;if(null===this._loader.rootBabylonMesh)return;const u=null===(Z=this._loader.Cf.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld,G=null===(x=this._loader.Cf.asset)||void 0===x||null===(F=x.extensions)||void 0===F?void 0:F.KHR_xmp_json_ld;if(u&&G){const Z=+G.packet;u.packets&&Z<u.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=u.packets[Z])}}}function Ux(Z,x,F,u){return f.Lx.Hx(x,F).scale(u)}function kx(Z,x,F,u){return x[F]*u}function Mx(Z,x,F,u){return-x[F]*u}function mx(Z,x,F,u){return x[F+1]*u}function Cx(Z,x,F,u){return x[F]*u*2}function Lx(Z){return{scale:[new Sx(s.d.ANIMATIONTYPE_FLOAT,`${Z}.uScale`,kx,(()=>2)),new Sx(s.d.ANIMATIONTYPE_FLOAT,`${Z}.vScale`,mx,(()=>2))],offset:[new Sx(s.d.ANIMATIONTYPE_FLOAT,`${Z}.uOffset`,kx,(()=>2)),new Sx(s.d.ANIMATIONTYPE_FLOAT,`${Z}.vOffset`,mx,(()=>2))],rotation:[new Sx(s.d.ANIMATIONTYPE_FLOAT,`${Z}.wAng`,Mx,(()=>1))]}}N(Jx),T(Jx,!0,(Z=>new px(Z)));class Hx extends g.AnimationPropertyInfo{buildAnimations(Z,x,F,u){return[{babylonAnimatable:Z._babylonCamera,babylonAnimation:this._buildAnimation(x,F,u)}]}}class Sx extends g.AnimationPropertyInfo{buildAnimations(Z,x,F,u){const G=[];for(const f in Z._data)G.push({babylonAnimatable:Z._data[f].babylonMaterial,babylonAnimation:this._buildAnimation(x,F,u)});return G}}class Kx extends g.AnimationPropertyInfo{buildAnimations(Z,x,F,u){return[{babylonAnimatable:Z._babylonLight,babylonAnimation:this._buildAnimation(x,F,u)}]}}(0,W.k)("/cameras/{}/orthographic/xmag",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"orthoLeft",Mx,(()=>1)),new Hx(s.d.ANIMATIONTYPE_FLOAT,"orthoRight",mx,(()=>1))]),(0,W.k)("/cameras/{}/orthographic/ymag",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"orthoBottom",Mx,(()=>1)),new Hx(s.d.ANIMATIONTYPE_FLOAT,"orthoTop",mx,(()=>1))]),(0,W.k)("/cameras/{}/orthographic/zfar",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"maxZ",kx,(()=>1))]),(0,W.k)("/cameras/{}/orthographic/znear",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"hf",kx,(()=>1))]),(0,W.k)("/cameras/{}/perspective/yfov",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"fov",kx,(()=>1))]),(0,W.k)("/cameras/{}/perspective/zfar",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"maxZ",kx,(()=>1))]),(0,W.k)("/cameras/{}/perspective/znear",[new Hx(s.d.ANIMATIONTYPE_FLOAT,"hf",kx,(()=>1))]),(0,W.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"albedoColor",Ux,(()=>4)),new Sx(s.d.ANIMATIONTYPE_FLOAT,"alpha",(function(Z,x,F,u){return x[F+3]*u}),(()=>4))]),(0,W.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"metallic",kx,(()=>1))]),(0,W.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"roughness",kx,(()=>1))]);const yx=Lx("albedoTexture");(0,W.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",yx.scale),(0,W.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",yx.offset),(0,W.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",yx.rotation);const qx=Lx("metallicTexture");(0,W.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",qx.scale),(0,W.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",qx.offset),(0,W.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",qx.rotation),(0,W.k)("/materials/{}/emissiveFactor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"emissiveColor",Ux,(()=>3))]);const Rx=Lx("bumpTexture");(0,W.k)("/materials/{}/normalTexture/scale",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",kx,(()=>1))]),(0,W.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Rx.scale),(0,W.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Rx.offset),(0,W.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Rx.rotation),(0,W.k)("/materials/{}/occlusionTexture/strength",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",kx,(()=>1))]);const Bx=Lx("ambientTexture");(0,W.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Bx.scale),(0,W.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Bx.offset),(0,W.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Bx.rotation);const vx=Lx("emissiveTexture");(0,W.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",vx.scale),(0,W.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",vx.offset),(0,W.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",vx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",kx,(()=>1))]);const lx=Lx("anisotropy.texture");(0,W.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",lx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",lx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",lx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",kx,(()=>1))]);const ix=Lx("clearCoat.texture");(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",ix.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",ix.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",ix.rotation);const ex=Lx("clearCoat.bumpTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",ex.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",ex.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",ex.rotation);const bx=Lx("clearCoat.textureRoughness");(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",bx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",bx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",bx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",kx,(()=>1))]);const Ex=Lx("iridescence.texture");(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Ex.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Ex.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Ex.rotation);const wx=Lx("iridescence.thicknessTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",wx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",wx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",wx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"sheen.color",Ux,(()=>3))]),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",kx,(()=>1))]);const Tx=Lx("sheen.texture");(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Tx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Tx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Tx.rotation);const Nx=Lx("sheen.textureRoughness");(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Nx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Nx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Nx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Ux,(()=>3))]);const Wx=Lx("metallicReflectanceTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Wx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Wx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Wx.rotation);const Ax=Lx("reflectanceTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ax.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ax.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ax.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",kx,(()=>1))]);const hx=Lx("subSurface.refractionIntensityTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",hx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",hx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",hx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Ux,(()=>3))]),(0,W.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",kx,(()=>1))]),(0,W.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",kx,(()=>1))]);const Xx=Lx("subSurface.thicknessTexture");(0,W.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Xx.scale),(0,W.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Xx.offset),(0,W.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Xx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Sx(s.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",kx,(()=>1))]);const Dx=Lx("subSurface.translucencyIntensityTexture");(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Dx.scale),(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Dx.offset),(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Dx.rotation),(0,W.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Sx(s.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Ux,(()=>3))]);const Qx=Lx("subSurface.translucencyColorTexture");(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Qx.scale),(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Qx.offset),(0,W.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Qx.rotation),(0,W.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new Kx(s.d.ANIMATIONTYPE_COLOR3,"diffuse",Ux,(()=>3))]),(0,W.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Kx(s.d.ANIMATIONTYPE_FLOAT,"intensity",kx,(()=>1))]),(0,W.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new Kx(s.d.ANIMATIONTYPE_FLOAT,"range",kx,(()=>1))]),(0,W.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Kx(s.d.ANIMATIONTYPE_FLOAT,"innerAngle",Cx,(()=>1))]),(0,W.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Kx(s.d.ANIMATIONTYPE_FLOAT,"angle",Cx,(()=>1))]),(0,W.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new Kx(s.d.ANIMATIONTYPE_COLOR3,"diffuse",Ux,(()=>3))]),(0,W.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Kx(s.d.ANIMATIONTYPE_FLOAT,"intensity",kx,(()=>1))]);const gx="KHR_animation_pointer";class Ox{constructor(Z){this.name=gx,this._loader=Z,this._pathToObjectConverter=(0,W.j)(this._loader.Cf)}get enabled(){return this._loader.isExtensionUsed(gx)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(Z,x,F,u,G){var f;const Y=null===(f=u.target.extensions)||void 0===f?void 0:f.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==u.target.path&&U.d.Warn(`${Z}/target/path: Value (${u.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=u.target.node&&U.d.Warn(`${Z}/target/node: Value (${u.target.node}) must not be present when using the ${this.name} extension`);const j=`${Z}/extensions/${this.name}`,d=Y.pointer;if(!d)throw new Error(`${j}: Pointer is missing`);try{const f=this._pathToObjectConverter.convert(d);if(!f.info.interpolation)throw new Error(`${j}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(Z,x,F,u,{object:f.object,info:f.info.interpolation},G)}catch(t){return U.d.Warn(`${j}/pointer: Invalid pointer (${d}) skipped`),null}}}N(gx),T(gx,!0,(Z=>new Ox(Z)));class nx{constructor(Z,x,F){this.frame=Z,this.action=x,this.onlyOnce=F,this.isDone=!1}_clone(){return new nx(this.frame,this.action,this.onlyOnce)}}var Vx=F(11029),ax=F(11081),Ix=F(11072);class rx{get loop(){return this._loop}set loop(Z){Z!==this._loop&&(this._loop=Z,this.updateOptions({loop:Z}))}get currentTime(){var Z;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.audioContext&&(this.isPlaying||this.isPaused)){const Z=this.isPaused?0:ax.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+Z}return 0}get spatialSound(){return this._spatialSound}set spatialSound(Z){if(Z==this._spatialSound)return;const x=this.isPlaying;this.pause(),Z?(this._spatialSound=Z,this._updateSpatialParameters()):this._disableSpatialSound(),x&&this.play()}constructor(Z,x,F){var u;let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new o.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=G.kx.Zero(),this._localDirection=new G.kx(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=Z,F=F||p.c.LastCreatedScene)if(this._scene=F,rx._SceneComponentInitialization(F),this._readyToPlayCallback=f,this._customAttenuationFunction=(Z,x,F,u,G)=>x<F?Z*(1-x/F):0,j&&(this.autoplay=j.autoplay||!1,this._loop=j.loop||!1,void 0!==j.volume&&(this._volume=j.volume),this._spatialSound=j.spatialSound??!1,this.maxDistance=j.maxDistance??100,this.useCustomAttenuation=j.useCustomAttenuation??!1,this.rolloffFactor=j.rolloffFactor||1,this.refDistance=j.refDistance||1,this.distanceModel=j.distanceModel||"linear",this._playbackRate=j.playbackRate||1,this._streaming=j.streaming??!1,this._length=j.length,this._offset=j.offset),null!==(u=ax.d.audioEngine)&&void 0!==u&&u.canUseWebAudio&&ax.d.audioEngine.audioContext){this._soundGain=ax.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let Z=!0;if(x)try{"string"===typeof x?(this._urlType="String",this._url=x):x instanceof ArrayBuffer?this._urlType="ArrayBuffer":x instanceof HTMLMediaElement?this._urlType="MediaElement":x instanceof MediaStream?this._urlType="MediaStream":x instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(x)&&(this._urlType="Array");let F=[],u=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ax.d.audioEngine.audioContext.createMediaElementSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ax.d.audioEngine.audioContext.createMediaStreamSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":x.byteLength>0&&(u=!0,this._soundLoaded(x));break;case"AudioBuffer":this._audioBufferLoaded(x);break;case"String":F.push(x);case"Array":0===F.length&&(F=x);for(let Z=0;Z<F.length;Z++){const x=F[Z];if(u=j&&j.skipCodecCheck||-1!==x.indexOf(".mp3",x.length-4)&&ax.d.audioEngine.isMP3supported||-1!==x.indexOf(".ogg",x.length-4)&&ax.d.audioEngine.isOGGsupported||-1!==x.indexOf(".wav",x.length-4)||-1!==x.indexOf(".m4a",x.length-4)||-1!==x.indexOf(".mp4",x.length-4)||-1!==x.indexOf("blob:"),u){this._streaming?(this._htmlAudioElement=new Audio(x),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.Tools.SetCorsBehavior(x,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(x,(Z=>{this._soundLoaded(Z)}),void 0,!0,!0,(Z=>{Z&&U.d.Error("XHR "+Z.status+" error on: "+x+"."),U.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:Z=!1}Z?u||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):U.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(d){U.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),ax.d.audioEngine&&!ax.d.audioEngine.WarnedWebAudioUnsupported&&(U.d.Error("Web Audio is not supported by your browser."),ax.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var Z;null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(Z){var x;null!==(x=ax.d.audioEngine)&&void 0!==x&&x.audioContext&&(this._audioBuffer=Z,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(Z){var x;null!==(x=ax.d.audioEngine)&&void 0!==x&&x.audioContext&&ax.d.audioEngine.audioContext.decodeAudioData(Z,(Z=>{this._audioBufferLoaded(Z)}),(Z=>{U.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+Z)}))}setAudioBuffer(Z){var x;null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&(this._audioBuffer=Z,this._isReadyToPlay=!0)}updateOptions(Z){Z&&(this.loop=Z.loop??this.loop,this.maxDistance=Z.maxDistance??this.maxDistance,this.useCustomAttenuation=Z.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=Z.rolloffFactor??this.rolloffFactor,this.refDistance=Z.refDistance??this.refDistance,this.distanceModel=Z.distanceModel??this.distanceModel,this._playbackRate=Z.playbackRate??this._playbackRate,this._length=Z.length??void 0,this.spatialSound=Z.spatialSound??this._spatialSound,this._setOffset(Z.offset??void 0),this.setVolume(Z.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var Z;null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&ax.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??ax.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var Z;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(Z=this._soundPanner)||void 0===Z||Z.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var Z;null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(Z){var x;null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(Z),this._isOutputConnected=!0)}setDirectionalCone(Z,x,F){x<Z?U.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=Z,this._coneOuterAngle=x,this._coneOuterGain=F,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!=this._coneInnerAngle){var x;if(this._coneOuterAngle<Z)return void U.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z,null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!=this._coneOuterAngle){var x;if(Z<this._coneInnerAngle)return void U.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z,null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(Z){var x;Z.equals(this._position)||(this._position.G(Z),null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(Z){var x;this._localDirection=Z,null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const Z=this._connectedTransformNode.getWorldMatrix(),x=G.kx.TransformNormal(this._localDirection,Z);x.normalize(),this._soundPanner.orientationX.value=x.x,this._soundPanner.orientationY.value=x.y,this._soundPanner.orientationZ.value=x.z}updateDistanceFromListener(){var Z;if(null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const Z=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Mx(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,Z,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(Z){this._customAttenuationFunction=Z}play(Z,x,F){var u;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(u=ax.d.audioEngine)&&void 0!==u&&u.audioContext)try{var G,f;this._clearTimeoutsAndObservers();let u=Z?(null===(G=ax.d.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+Z:null===(f=ax.d.audioEngine)||void 0===f?void 0:f.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=ax.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const Z=()=>{var F;if(null!==(F=ax.d.audioEngine)&&void 0!==F&&F.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=x??0;const F=this._htmlAudioElement.play();void 0!==F&&F.catch((()=>{var x,F;(null===(x=ax.d.audioEngine)||void 0===x||x.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(F=ax.d.audioEngine)||void 0===F?void 0:F.onAudioUnlockedObservable.addOnce((()=>{Z()})))}))}else{var u;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(u=ax.d.audioEngine)||void 0===u?void 0:u.onAudioUnlockedObservable.addOnce((()=>{Z()}))}};Z()}}else{var Y;const G=()=>{var G;if(null!==(G=ax.d.audioEngine)&&void 0!==G&&G.audioContext){var f;if(F=F||this._length,void 0!==x&&this._setOffset(x),this._soundSource){const Z=this._soundSource;Z.onended=()=>{Z.disconnect()}}if(this._soundSource=null===(f=ax.d.audioEngine)||void 0===f?void 0:f.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==x&&(this._soundSource.loopStart=x),void 0!==F&&(this._soundSource.loopEnd=(0|x)+F),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},u=Z?(null===(Y=ax.d.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+Z:ax.d.audioEngine.audioContext.currentTime;const G=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(u,G,this.loop?void 0:F)}}};"suspended"===(null===(Y=ax.d.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var Z;"suspended"===(null===(Z=ax.d.audioEngine)||void 0===Z?void 0:Z.audioContext.state)?(ax.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=ax.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{G()})))):G()}),500):G()}this._startTime=u,this.isPlaying=!0,this.isPaused=!1}catch(j){U.d.Error("Error while trying to play audio: "+this.name+", "+j.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(Z){var x;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var F;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(F=this._streamingSource)||void 0===F||F.disconnect();this.isPlaying=!1}else if(null!==(x=ax.d.audioEngine)&&void 0!==x&&x.audioContext&&this._soundSource){const x=Z?ax.d.audioEngine.audioContext.currentTime+Z:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(x)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var Z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=ax.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(Z,x){var F;null!==(F=ax.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._soundGain&&(x&&ax.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ax.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ax.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(Z,ax.d.audioEngine.audioContext.currentTime+x)):this._soundGain.gain.value=Z),this._volume=Z}setPlaybackRate(Z){this._playbackRate=Z,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(Z){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=Z,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=Z=>this._onRegisterAfterWorldMatrixUpdate(Z),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(Z){var x;if(Z.getBoundingInfo){const x=Z.getBoundingInfo();this.setPosition(x.boundingSphere.centerWorld)}else this.setPosition(Z.absolutePosition);null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const Z=()=>{(0,Ix.h)((()=>this._isReadyToPlay),(()=>{F._audioBuffer=this.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,this._offset,this._length)}),void 0,300)},x={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},F=new rx(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,x);return this.useCustomAttenuation&&F.setAttenuationFunction(this._customAttenuationFunction),F.setPosition(this._position),F.setPlaybackRate(this._playbackRate),Z(),F}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const Z={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(Z.connectedMeshId=this._connectedTransformNode.id),Z.position=this._position.Wf(),Z.refDistance=this.refDistance,Z.distanceModel=this.distanceModel,Z.isDirectional=this._isDirectional,Z.localDirectionToMesh=this._localDirection.Wf(),Z.coneInnerAngle=this._coneInnerAngle,Z.coneOuterAngle=this._coneOuterAngle,Z.coneOuterGain=this._coneOuterGain),Z}static Parse(Z,x,F,u){const f=Z.name;let Y;Y=Z.url?F+Z.url:F+f;const j={autoplay:Z.autoplay,loop:Z.loop,volume:Z.volume,spatialSound:Z.spatialSound,maxDistance:Z.maxDistance,rolloffFactor:Z.rolloffFactor,refDistance:Z.refDistance,distanceModel:Z.distanceModel,playbackRate:Z.playbackRate};let d;if(u){const Z=()=>{(0,Ix.h)((()=>u._isReadyToPlay),(()=>{d._audioBuffer=u.getAudioBuffer(),d._isReadyToPlay=!0,d.autoplay&&d.play(0,d._offset,d._length)}),void 0,300)};d=new rx(f,new ArrayBuffer(0),x,null,j),Z()}else d=new rx(f,Y,x,(()=>{x.removePendingData(d)}),j),x.addPendingData(d);if(Z.position){const x=G.kx.Hx(Z.position);d.setPosition(x)}if(Z.isDirectional&&(d.setDirectionalCone(Z.coneInnerAngle||360,Z.coneOuterAngle||360,Z.coneOuterGain||0),Z.localDirectionToMesh)){const x=G.kx.Hx(Z.localDirectionToMesh);d.setLocalDirectionToMesh(x)}if(Z.connectedMeshId){const F=x.getMeshById(Z.connectedMeshId);F&&d.attachToMesh(F)}return Z.metadata&&(d.metadata=Z.metadata),d}_setOffset(Z){this._offset!==Z&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=Z)}_clearTimeoutsAndObservers(){var Z;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(Z=ax.d.audioEngine)||void 0===Z||Z.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}rx._SceneComponentInitialization=Z=>{throw(0,Vx.e)("AudioSceneComponent")},(0,SZ.g)("BABYLON.Sound",rx);class zx{constructor(Z,x,F){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],x.length!==F.length)throw new Error("Sounds length does not equal weights length");this.loop=Z,this._weights=F;let u=0;for(const f of F)u+=f;const G=u>0?1/u:0;for(let f=0;f<this._weights.length;f++)this._weights[f]*=G;this._sounds=x;for(const f of this._sounds)f.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(Z){if(Z!==this._coneInnerAngle){if(this._coneOuterAngle<Z)return void U.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=Z;for(const x of this._sounds)x.directionalConeInnerAngle=Z}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(Z){if(Z!==this._coneOuterAngle){if(Z<this._coneInnerAngle)return void U.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=Z;for(const x of this._sounds)x.directionalConeOuterAngle=Z}}get volume(){return this._volume}set volume(Z){if(Z!==this._volume)for(const x of this._sounds)x.setVolume(Z)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(Z){if(!this.isPaused){this.stop();const Z=Math.random();let x=0;for(let F=0;F<this._weights.length;F++)if(x+=this._weights[F],Z<=x){this._currentIndex=F;break}}const x=this._sounds[this._currentIndex??0];x.isReady()?x.play(0,this.isPaused?void 0:Z):x.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Px{constructor(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(Z=Z||p.c.LastCreatedScene)&&(this._scene=Z,this.soundCollection=[],this._options=x,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var Z;null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&ax.d.audioEngine.audioContext&&(this._outputAudioNode=ax.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ax.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(ax.d.audioEngine&&ax.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(Z){var x;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&Z.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==Z.soundTrackId&&(-1===Z.soundTrackId?this._scene.mainSoundTrack.removeSound(Z):this._scene.soundTracks&&this._scene.soundTracks[Z.soundTrackId].removeSound(Z)),this.soundCollection.push(Z),Z.soundTrackId=this.id}removeSound(Z){const x=this.soundCollection.indexOf(Z);-1!==x&&this.soundCollection.splice(x,1)}setVolume(Z){var x;null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=Z)}switchPanningModelToHRTF(){var Z;if(null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var Z;if(null!==(Z=ax.d.audioEngine)&&void 0!==Z&&Z.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToEqualPower()}connectToAnalyser(Z){var x;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=Z,null!==(x=ax.d.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ax.d.audioEngine.masterGain))}}var ZF=F(11475),xF=F(11447),FF=F(11004);ax.d.AudioEngineFactory=(Z,x,F)=>new uF(Z,x,F);class uF{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new o.b,this.onAudioLockedObservable=new o.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,FF.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const u=document.createElement("audio");this._hostElement=Z,this._audioContext=x,this._audioDestination=F;try{u&&u.canPlayType&&(u.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||u.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(G){}try{u&&u.canPlayType&&u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(G){}}lock(){this._triggerSuspendedState()}unlock(){var Z,x;if("running"===(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(x=this._audioContext)||void 0===x||x.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{U.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var Z;null===(Z=this._audioContext)||void 0===Z||Z.addEventListener("statechange",(()=>{var Z;this.unlocked&&"running"!==(null===(Z=this._audioContext)||void 0===Z?void 0:Z.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var Z;return null!==(Z=this._audioContext)&&void 0!==Z&&Z.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(Z){this.canUseWebAudio=!1,U.d.Error("Web Audio: "+Z.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(Z){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const Z=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",x=document.createElement("style");x.appendChild(document.createTextNode(Z)),document.getElementsByTagName("head")[0].appendChild(x),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var Z;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(Z=this._audioContext)||void 0===Z||Z.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(Z){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=Z)}connectToAnalyser(Z){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=Z,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var GF=F(11022);(0,F(12625).e)(ZF.c.NAME_AUDIO,((Z,x,F,u)=>{let G,f=[];if(F.vJ=F.vJ||[],void 0!==Z.vJ&&null!==Z.vJ)for(let j=0,d=Z.vJ.length;j<d;j++){var Y;const d=Z.vJ[j];null!==(Y=ax.d.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(d.url||(d.url=d.name),f[d.url]?F.vJ.push(rx.Parse(d,x,u,f[d.url])):(G=rx.Parse(d,x,u),f[d.url]=G,F.vJ.push(G))):F.vJ.push(new rx(d.name,null,x))}f=[]})),Object.defineProperty(xF.d.prototype,"mainSoundTrack",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),this._mainSoundTrack||(this._mainSoundTrack=new Px(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),xF.d.prototype.getSoundByName=function(Z){let x;for(x=0;x<this.mainSoundTrack.soundCollection.length;x++)if(this.mainSoundTrack.soundCollection[x].name===Z)return this.mainSoundTrack.soundCollection[x];if(this.soundTracks)for(let F=0;F<this.soundTracks.length;F++)for(x=0;x<this.soundTracks[F].soundCollection.length;x++)if(this.soundTracks[F].soundCollection[x].name===Z)return this.soundTracks[F].soundCollection[x];return null},Object.defineProperty(xF.d.prototype,"audioEnabled",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),Z.audioEnabled},set:function(Z){let x=this._getComponent(ZF.c.NAME_AUDIO);x||(x=new fF(this),this.tf(x)),Z?x.enableAudio():x.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(xF.d.prototype,"headphone",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),Z.headphone},set:function(Z){let x=this._getComponent(ZF.c.NAME_AUDIO);x||(x=new fF(this),this.tf(x)),Z?x.switchAudioModeForHeadphones():x.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(xF.d.prototype,"audioListenerPositionProvider",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),Z.audioListenerPositionProvider},set:function(Z){let x=this._getComponent(ZF.c.NAME_AUDIO);if(x||(x=new fF(this),this.tf(x)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");x.audioListenerPositionProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(xF.d.prototype,"audioListenerRotationProvider",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),Z.audioListenerRotationProvider},set:function(Z){let x=this._getComponent(ZF.c.NAME_AUDIO);if(x||(x=new fF(this),this.tf(x)),Z&&"function"!==typeof Z)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");x.audioListenerRotationProvider=Z},enumerable:!0,configurable:!0}),Object.defineProperty(xF.d.prototype,"audioPositioningRefreshRate",{get:function(){let Z=this._getComponent(ZF.c.NAME_AUDIO);return Z||(Z=new fF(this),this.tf(Z)),Z.audioPositioningRefreshRate},set:function(Z){let x=this._getComponent(ZF.c.NAME_AUDIO);x||(x=new fF(this),this.tf(x)),x.audioPositioningRefreshRate=Z},enumerable:!0,configurable:!0});class fF{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(Z){this.name=ZF.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new G.kx,this._cachedCameraPosition=new G.kx,this._lastCheck=0,this._invertMatrixTemp=new G.Matrix,this._cameraDirectionTemp=new G.kx,(Z=Z||p.c.LastCreatedScene)&&(this.mx=Z,Z.soundTracks=[],Z.vJ=[])}register(){this.mx._afterRenderStage.registerStep(ZF.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(Z){if(Z.vJ=[],this.mx.soundTracks)for(let x=0;x<this.mx.soundTracks.length;x++){const F=this.mx.soundTracks[x];for(let x=0;x<F.soundCollection.length;x++)Z.vJ.push(F.soundCollection[x].serialize())}}addFromContainer(Z){if(Z.vJ)for(const x of Z.vJ)x.play(),x.autoplay=!0,this.mx.mainSoundTrack.addSound(x)}removeFromContainer(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Z.vJ)for(const F of Z.vJ)F.stop(),F.autoplay=!1,this.mx.mainSoundTrack.removeSound(F),x&&F.dispose()}dispose(){const Z=this.mx;if(Z._mainSoundTrack&&Z.mainSoundTrack.dispose(),Z.soundTracks)for(let x=0;x<Z.soundTracks.length;x++)Z.soundTracks[x].dispose()}disableAudio(){const Z=this.mx;let x;for(this._audioEnabled=!1,ax.d.audioEngine&&ax.d.audioEngine.audioContext&&ax.d.audioEngine.audioContext.suspend(),x=0;x<Z.mainSoundTrack.soundCollection.length;x++)Z.mainSoundTrack.soundCollection[x].pause();if(Z.soundTracks)for(x=0;x<Z.soundTracks.length;x++)for(let F=0;F<Z.soundTracks[x].soundCollection.length;F++)Z.soundTracks[x].soundCollection[F].pause()}enableAudio(){const Z=this.mx;let x;for(this._audioEnabled=!0,ax.d.audioEngine&&ax.d.audioEngine.audioContext&&ax.d.audioEngine.audioContext.resume(),x=0;x<Z.mainSoundTrack.soundCollection.length;x++)Z.mainSoundTrack.soundCollection[x].isPaused&&Z.mainSoundTrack.soundCollection[x].play();if(Z.soundTracks)for(x=0;x<Z.soundTracks.length;x++)for(let F=0;F<Z.soundTracks[x].soundCollection.length;F++)Z.soundTracks[x].soundCollection[F].isPaused&&Z.soundTracks[x].soundCollection[F].play()}switchAudioModeForHeadphones(){const Z=this.mx;if(this._headphone=!0,Z.mainSoundTrack.switchPanningModelToHRTF(),Z.soundTracks)for(let x=0;x<Z.soundTracks.length;x++)Z.soundTracks[x].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const Z=this.mx;if(this._headphone=!1,Z.mainSoundTrack.switchPanningModelToEqualPower(),Z.soundTracks)for(let x=0;x<Z.soundTracks.length;x++)Z.soundTracks[x].switchPanningModelToEqualPower()}_afterRender(){const Z=GF.e.Now;if(this._lastCheck&&Z-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=Z;const x=this.mx;if(!this._audioEnabled||!x._mainSoundTrack||!x.soundTracks||0===x._mainSoundTrack.soundCollection.length&&1===x.soundTracks.length)return;const F=ax.d.audioEngine;if(F&&F.audioContext){let Z,u=x.activeCamera;if(x.activeCameras&&x.activeCameras.length>0&&(u=x.activeCameras[0]),this.audioListenerPositionProvider){const Z=this.audioListenerPositionProvider();F.audioContext.listener.setPosition(Z.x||0,Z.y||0,Z.z||0)}else u?this._cachedCameraPosition.equals(u.globalPosition)||(this._cachedCameraPosition.G(u.globalPosition),F.audioContext.listener.setPosition(u.globalPosition.x,u.globalPosition.y,u.globalPosition.z)):F.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const Z=this.audioListenerRotationProvider();F.audioContext.listener.setOrientation(Z.x||0,Z.y||0,Z.z||0,0,1,0)}else u?(u.rigCameras&&u.rigCameras.length>0&&(u=u.rigCameras[0]),u.getViewMatrix().invertToRef(this._invertMatrixTemp),G.kx.TransformNormalToRef(fF._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.G(this._cameraDirectionTemp),F.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):F.audioContext.listener.setOrientation(0,0,0,0,1,0);for(Z=0;Z<x.mainSoundTrack.soundCollection.length;Z++){const F=x.mainSoundTrack.soundCollection[Z];F.useCustomAttenuation&&F.updateDistanceFromListener()}if(x.soundTracks)for(Z=0;Z<x.soundTracks.length;Z++)for(let F=0;F<x.soundTracks[Z].soundCollection.length;F++){const u=x.soundTracks[Z].soundCollection[F];u.useCustomAttenuation&&u.updateDistanceFromListener()}}}}fF._CameraDirection=new G.kx(0,0,-1),rx._SceneComponentInitialization=Z=>{let x=Z._getComponent(ZF.c.NAME_AUDIO);x||(x=new fF(Z),Z.tf(x))};const YF="MSFT_audio_emitter";class jF{constructor(Z){this.name=YF,this._loader=Z,this.enabled=this._loader.isExtensionUsed(YF)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const Z=this._loader.Cf.extensions;if(Z&&Z[this.name]){const x=Z[this.name];this._clips=x.clips,this._emitters=x.emitters,X.Assign(this._clips),X.Assign(this._emitters)}}loadSceneAsync(Z,x){return Q.LoadExtensionAsync(Z,x,this.name,(async(F,u)=>{const G=new Array;G.push(this._loader.loadSceneAsync(Z,x));for(const Z of u.emitters){const x=X.Get(`${F}/emitters`,this._emitters,Z);if(void 0!=x.refDistance||void 0!=x.maxDistance||void 0!=x.rolloffFactor||void 0!=x.distanceModel||void 0!=x.innerAngle||void 0!=x.outerAngle)throw new Error(`${F}: Direction or Distance properties are not allowed on emitters attached to a scene`);G.push(this._loadEmitterAsync(`${F}/emitters/${x.index}`,x))}await Promise.all(G)}))}loadNodeAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(Z,u)=>{const f=new Array,j=await this._loader.loadNodeAsync(Z,x,(x=>{for(const F of u.emitters){const u=X.Get(`${Z}/emitters`,this._emitters,F);f.push(this._loadEmitterAsync(`${Z}/emitters/${u.index}`,u).then((()=>{for(const Z of u._babylonSounds)Z.attachToMesh(x),void 0==u.innerAngle&&void 0==u.outerAngle||(Z.setLocalDirectionToMesh(G.kx.Forward()),Z.setDirectionalCone(2*Y.Tools.ToDegrees(void 0==u.innerAngle?Math.PI:u.innerAngle),2*Y.Tools.ToDegrees(void 0==u.outerAngle?Math.PI:u.outerAngle),0))})))}F(x)}));return await Promise.all(f),j}))}loadAnimationAsync(Z,x){return Q.LoadExtensionAsync(Z,x,this.name,(async(F,u)=>{const G=await this._loader.loadAnimationAsync(Z,x),f=new Array;X.Assign(u.events);for(const Y of u.events)f.push(this._loadAnimationEventAsync(`${F}/events/${Y.index}`,Z,x,Y,G));return await Promise.all(f),G}))}_loadClipAsync(Z,x){if(x._objectURL)return x._objectURL;let F;if(x.uri)F=this._loader.loadUriAsync(Z,x,x.uri);else{const u=X.Get(`${Z}/bufferView`,this._loader.Cf.bufferViews,x.bufferView);F=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return x._objectURL=F.then((Z=>URL.createObjectURL(new Blob([Z],{type:x.mimeType})))),x._objectURL}_loadEmitterAsync(Z,x){if(x._babylonSounds=x._babylonSounds||[],!x._babylonData){const Z=new Array,F=x.name||`emitter${x.index}`,u={loop:!1,autoplay:!1,volume:void 0==x.volume?1:x.volume};for(let f=0;f<x.clips.length;f++){const G=`/extensions/${this.name}/clips`,Y=X.Get(G,this._clips,x.clips[f].clip);Z.push(this._loadClipAsync(`${G}/${x.clips[f].clip}`,Y).then((Z=>{const G=x._babylonSounds[f]=new rx(F,Z,this._loader.babylonScene,null,u);G.refDistance=x.refDistance||1,G.maxDistance=x.maxDistance||256,G.rolloffFactor=x.rolloffFactor||1,G.distanceModel=x.distanceModel||"exponential"})))}const G=Promise.all(Z).then((()=>{const Z=x.clips.map((Z=>Z.weight||1)),F=new zx(x.loop||!1,x._babylonSounds,Z);x.innerAngle&&(F.directionalConeInnerAngle=2*Y.Tools.ToDegrees(x.innerAngle)),x.outerAngle&&(F.directionalConeOuterAngle=2*Y.Tools.ToDegrees(x.outerAngle)),x.volume&&(F.volume=x.volume),x._babylonData.sound=F}));x._babylonData={loaded:G}}return x._babylonData.loaded}_getEventAction(Z,x,F,u,G){switch(F){case"play":return Z=>{const F=(G||0)+(Z-u);x.play(F)};case"stop":return()=>{x.stop()};case"pause":return()=>{x.pause()};default:throw new Error(`${Z}: Unsupported action ${F}`)}}_loadAnimationEventAsync(Z,x,F,u,G){if(0==G.targetedAnimations.length)return Promise.resolve();const f=G.targetedAnimations[0],Y=u.i,j=X.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(Z,j).then((()=>{const x=j._babylonData.sound;if(x){const F=new nx(u.time,this._getEventAction(Z,x,u.action,u.time,u.startOffset));f.animation.addEvent(F),G.onAnimationGroupEndObservable.add((()=>{x.stop()})),G.onAnimationGroupPauseObservable.add((()=>{x.pause()}))}}))}}N(YF),T(YF,!0,(Z=>new jF(Z)));const dF="MSFT_lod";class tF{constructor(Z){var x;this.name=dF,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new o.b,this.onMaterialLODsLoadedObservable=new o.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=Z,this.maxLODsToLoad=(null===(x=this._loader.parent.extensionOptions[dF])||void 0===x?void 0:x.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(dF)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let Z=0;Z<this._nodePromiseLODs.length;Z++){const x=Promise.all(this._nodePromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Node LOD ${Z}`),this._loader.log(`Loaded node LOD ${Z}`)),this.onNodeLODsLoadedObservable.notifyObservers(Z),Z!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${Z+1}`),this._loadBufferLOD(this._nodeBufferLODs,Z+1),this._nodeSignalLODs[Z]&&this._nodeSignalLODs[Z].resolve())}));this._loader._completePromises.push(x)}for(let Z=0;Z<this._materialPromiseLODs.length;Z++){const x=Promise.all(this._materialPromiseLODs[Z]).then((()=>{0!==Z&&(this._loader.endPerformanceCounter(`Material LOD ${Z}`),this._loader.log(`Loaded material LOD ${Z}`)),this.onMaterialLODsLoadedObservable.notifyObservers(Z),Z!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${Z+1}`),this._loadBufferLOD(this._materialBufferLODs,Z+1),this._materialSignalLODs[Z]&&this._materialSignalLODs[Z].resolve())}));this._loader._completePromises.push(x)}}loadSceneAsync(Z,x){const F=this._loader.loadSceneAsync(Z,x);return this._loadBufferLOD(this._bufferLODs,0),F}loadNodeAsync(Z,x,F){return Q.LoadExtensionAsync(Z,x,this.name,(async(Z,G)=>{let f;const Y=this._getLODs(Z,x,this._loader.Cf.nodes,G.ids);this._loader.logOpen(`${Z}`);for(let x=0;x<Y.length;x++){const Z=Y[x];0!==x&&(this._nodeIndexLOD=x,this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new u);const G=Z=>{F(Z),Z.Nj(!1)},j=this._loader.loadNodeAsync(`/nodes/${Z.index}`,Z,G).then((Z=>{if(0!==x){const Z=Y[x-1];Z._babylonTransformNode&&(this._disposeTransformNode(Z._babylonTransformNode),delete Z._babylonTransformNode)}return Z.Nj(!0),Z}));this._nodePromiseLODs[x]=this._nodePromiseLODs[x]||[],0===x?f=j:(this._nodeIndexLOD=null,this._nodePromiseLODs[x].push(j))}return this._loader.logClose(),await f}))}_loadMaterialAsync(Z,x,F,u,G){return this._nodeIndexLOD?null:Q.LoadExtensionAsync(Z,x,this.name,(async(Z,f)=>{let Y;const j=this._getLODs(Z,x,this._loader.Cf.materials,f.ids);this._loader.logOpen(`${Z}`);for(let x=0;x<j.length;x++){const Z=j[x];0!==x&&(this._materialIndexLOD=x);const f=this._loader._loadMaterialAsync(`/materials/${Z.index}`,Z,F,u,(Z=>{0===x&&G(Z)})).then((Z=>{if(0!==x){G(Z);const F=j[x-1]._data;F[u]&&(this._disposeMaterials([F[u].babylonMaterial]),delete F[u])}return Z}));this._materialPromiseLODs[x]=this._materialPromiseLODs[x]||[],0===x?Y=f:(this._materialIndexLOD=null,this._materialPromiseLODs[x].push(f))}return this._loader.logClose(),await Y}))}_loadUriAsync(Z,x,F){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const G=this._nodeIndexLOD-1;return this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new u,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(Z,x,F)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const G=this._materialIndexLOD-1;return this._materialSignalLODs[G]=this._materialSignalLODs[G]||new u,this._materialSignalLODs[G].promise.then((async()=>await this._loader.loadUriAsync(Z,x,F)))}return null}loadBufferAsync(Z,x,F,G){if(this._loader.parent.useRangeRequests&&!x.uri){if(!this._loader.bin)throw new Error(`${Z}: Uri is missing or the binary glTF is missing its binary chunk`);const x=async(Z,x)=>{const f=F,Y=f+G-1;let j=Z[x];return j?(j.start=Math.min(j.start,f),j.end=Math.max(j.end,Y)):(j={start:f,end:Y,loaded:new u},Z[x]=j),await j.loaded.promise.then((Z=>new Uint8Array(Z.buffer,Z.byteOffset+F-j.start,G)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?x(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?x(this._materialBufferLODs,this._materialIndexLOD):x(this._bufferLODs,0)}return null}_loadBufferLOD(Z,x){const F=Z[x];F&&(this._loader.log(`Loading buffer range [${F.start}-${F.end}]`),this._loader.bin.readAsync(F.start,F.end-F.start+1).then((Z=>{F.loaded.resolve(Z)}),(Z=>{F.loaded.reject(Z)})))}_getLODs(Z,x,F,u){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const G=[];for(let f=u.length-1;f>=0;f--)if(G.push(X.Get(`${Z}/ids/${u[f]}`,F,u[f])),G.length===this.maxLODsToLoad)return G;return G.push(x),G}_disposeTransformNode(Z){const x=[],F=Z.material;F&&x.push(F);for(const G of Z.getChildMeshes())G.material&&x.push(G.material);Z.dispose();const u=x.filter((Z=>this._loader.babylonScene.meshes.every((x=>x.material!=Z))));this._disposeMaterials(u)}_disposeMaterials(Z){const x={};for(const F of Z){for(const Z of F.getActiveTextures())x[Z.uniqueId]=Z;F.dispose()}for(const F in x)for(const Z of this._loader.babylonScene.materials)Z.hasTexture(x[F])&&delete x[F];for(const F in x)x[F].dispose()}}N(dF),T(dF,!0,(Z=>new tF(Z)));const oF="MSFT_minecraftMesh";class cF{constructor(Z){this.name=oF,this._loader=Z,this.enabled=this._loader.isExtensionUsed(oF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtraAsync(Z,x,this.name,(async(u,G)=>{if(G){if(!(F instanceof C.c))throw new Error(`${u}: Material type not supported`);const G=this._loader.loadMaterialPropertiesAsync(Z,x,F);return F.needAlphaBlending()&&(F.forceDepthWrite=!0,F.separateCullingPass=!0),F.sj=F.forceDepthWrite,F.twoSidedLighting=!0,await G}}))}}N(oF),T(oF,!0,(Z=>new cF(Z)));const sF="MSFT_sRGBFactors";class JF{constructor(Z){this.name=sF,this._loader=Z,this.enabled=this._loader.isExtensionUsed(sF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(Z,x,F){return Q.LoadExtraAsync(Z,x,this.name,(async(u,G)=>{if(G){if(!(F instanceof C.c))throw new Error(`${u}: Material type not supported`);const G=this._loader.loadMaterialPropertiesAsync(Z,x,F),f=F.KZ().getEngine().useExactSrgbConversions;return F.albedoTexture||F.albedoColor.toLinearSpaceToRef(F.albedoColor,f),F.reflectivityTexture||F.reflectivityColor.toLinearSpaceToRef(F.reflectivityColor,f),await G}}))}}N(sF),T(sF,!0,(Z=>new JF(Z)));var pF=F(12936);const UF={};var kF=F(12996),MF=F(12968),mF=F(12941),CF=F(12954);function LF(Z,x){for(const F of Z)for(const Z of F.dataOutputs)if(Z.uniqueId===x)return Z;throw new Error("Could not find data out connection with unique id "+x)}function HF(Z,x){for(const F of Z)if(F instanceof MF.e)for(const Z of F.signalInputs)if(Z.uniqueId===x)return Z;throw new Error("Could not find signal in connection with unique id "+x)}async function SF(Z,x){const u=await Promise.all(Z.allBlocks.map((async Z=>{const x=function(Z){switch(Z){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([F.e(78),F.e(79)]).then(F.bind(F,14419))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await F.e(80).then(F.bind(F,14425))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await F.e(81).then(F.bind(F,14430))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await F.e(82).then(F.bind(F,14432))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await F.e(83).then(F.bind(F,14434))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await F.e(84).then(F.bind(F,14439))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await F.e(85).then(F.bind(F,14447))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await F.e(86).then(F.bind(F,14454))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await F.e(87).then(F.bind(F,14457))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await F.e(95).then(F.bind(F,14494))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await F.e(96).then(F.bind(F,14502))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await F.e(97).then(F.bind(F,14511))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await F.e(98).then(F.bind(F,14517))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await F.e(99).then(F.bind(F,14525))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await F.e(100).then(F.bind(F,14534))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await F.e(101).then(F.bind(F,14537))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await F.e(102).then(F.bind(F,14542))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await F.e(103).then(F.bind(F,14551))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await F.e(104).then(F.bind(F,14553))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await F.e(105).then(F.bind(F,14557))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await F.e(106).then(F.bind(F,14564))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await F.e(107).then(F.bind(F,14567))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await F.e(108).then(F.bind(F,14576))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await F.e(109).then(F.bind(F,14583))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await F.e(110).then(F.bind(F,14587))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await F.e(111).then(F.bind(F,14592))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await F.e(112).then(F.bind(F,14595))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await F.e(113).then(F.bind(F,14597))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await F.e(92).then(F.bind(F,14599))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await F.e(114).then(F.bind(F,14608))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await F.e(115).then(F.bind(F,14612))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await F.e(116).then(F.bind(F,14615))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await F.e(93).then(F.bind(F,14618))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await F.e(88).then(F.bind(F,14464))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,14624))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await F.e(89).then(F.bind(F,14483))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await F.e(90).then(F.bind(F,14491))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await F.e(91).then(F.bind(F,14628))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await F.e(117).then(F.bind(F,14632))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await F.e(118).then(F.bind(F,14635))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await F.e(119).then(F.bind(F,14638))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await F.e(120).then(F.bind(F,14644))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await F.e(121).then(F.bind(F,14653))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await F.e(122).then(F.bind(F,14658))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await F.e(123).then(F.bind(F,14660))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await F.e(124).then(F.bind(F,14665))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await F.e(125).then(F.bind(F,14668))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await F.e(126).then(F.bind(F,14673))).FlowGraphDataSwitchBlock;default:if(UF[Z])return UF[Z];throw new Error(`Unknown block name ${Z}`)}}(Z.className);return await x()})));return function(Z,x,F){const u=x.coordinator.createGraph(),G=[],f=x.valueParseFunction??mF.c;for(let Y=0;Y<Z.allBlocks.length;Y++){const j=yF(Z.allBlocks[Y],{mx:x.coordinator.config.mx,pathConverter:x.pathConverter,assetsContainer:x.coordinator.config.mx,valueParseFunction:f},F[Y]);G.push(j),j instanceof kF.e&&u.addEventBlock(j)}for(const Y of G){for(const Z of Y.dataInputs)for(const x of Z.connectedPointIds){const F=LF(G,x);Z.connectTo(F)}if(Y instanceof MF.e)for(const Z of Y.signalOutputs)for(const x of Z.connectedPointIds){const F=HF(G,x);Z.connectTo(F)}}for(const Y of Z.executionContexts)KF(Y,{graph:u,valueParseFunction:f},Z.rightHanded);return u}(Z,x,u)}function KF(Z,x,F){const u=x.graph.createContext();Z.enableLogging&&(u.enableLogging=!0),u.treatDataAsRightHanded=F||!1;const G=x.valueParseFunction??mF.c;u.uniqueId=Z.uniqueId;const f=u.KZ();if(Z._assetsContext){var Y,j,d,t,o,c,s,J,p,U;const x=Z._assetsContext,F={meshes:null===(Y=x.meshes)||void 0===Y?void 0:Y.map((Z=>f.getMeshById(Z))),lights:null===(j=x.lights)||void 0===j?void 0:j.map((Z=>f.getLightByName(Z))),cameras:null===(d=x.cameras)||void 0===d?void 0:d.map((Z=>f.getCameraByName(Z))),materials:null===(t=x.materials)||void 0===t?void 0:t.map((Z=>f.getMaterialById(Z))),textures:null===(o=x.textures)||void 0===o?void 0:o.map((Z=>f.getTextureByName(Z))),animations:null===(c=x.animations)||void 0===c?void 0:c.map((Z=>f.animations.find((x=>x.name===Z)))),skeletons:null===(s=x.skeletons)||void 0===s?void 0:s.map((Z=>f.getSkeletonByName(Z))),Vs:null===(J=x.Vs)||void 0===J?void 0:J.map((Z=>f.getParticleSystemById(Z))),animationGroups:null===(p=x.animationGroups)||void 0===p?void 0:p.map((Z=>f.getAnimationGroupByName(Z))),transformNodes:null===(U=x.transformNodes)||void 0===U?void 0:U.map((Z=>f.getTransformNodeById(Z))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vJ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};u.assetsContext=F}for(const k in Z._userVariables){const x=G(k,Z._userVariables,u.assetsContext,f);u.userVariables[k]=x}for(const k in Z._connectionValues){const x=G(k,Z._connectionValues,u.assetsContext,f);u._setConnectionValueByKey(k,x)}return u}function yF(Z,x,F){const u={},G=x.valueParseFunction??mF.c;if(Z.config)for(const Y in Z.config)u[Y]=G(Y,Z.config,x.assetsContainer||x.mx,x.mx);if((0,mF.h)(Z.className)){if(!x.pathConverter)throw new Error("Path converter is required for this block");u.pathConverter=x.pathConverter}const f=new F(u);f.uniqueId=Z.uniqueId;for(let Y=0;Y<Z.dataInputs.length;Y++){const x=f.getDataInput(Z.dataInputs[Y].name);if(!x)throw new Error("Could not find data input with name "+Z.dataInputs[Y].name+" in block "+Z.className);x.deserialize(Z.dataInputs[Y])}for(let Y=0;Y<Z.dataOutputs.length;Y++){const x=f.getDataOutput(Z.dataOutputs[Y].name);if(!x)throw new Error("Could not find data output with name "+Z.dataOutputs[Y].name+" in block "+Z.className);x.deserialize(Z.dataOutputs[Y])}return f.metadata=Z.metadata,f.deserialize&&f.deserialize(Z),f}function qF(Z){const[x,F]=Z.split(":");return RF({op:x,extension:F})}function RF(Z){var x;let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const u=Z.extension?null===(x=vF[Z.extension])||void 0===x?void 0:x[Z.op]:lF[Z.op];if(!u&&(U.d.Warn(`No mapping found for operation ${Z.op} and extension ${Z.extension||"KHR_interactivity"}`),F)){const x={},F={flows:{}};if(Z.inputValueSockets){x.values={};for(const F in Z.inputValueSockets)x.values[F]={name:F}}return Z.outputValueSockets&&(F.values={},Object.keys(Z.outputValueSockets).forEach((Z=>{F.values[Z]={name:Z}}))),{So:[],inputs:x,outputs:F}}return u}function BF(Z,x,F){vF[x]||(vF[x]={}),vF[x][Z]=F}const vF={BABYLON:{"flow/log":{So:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},lF={"event/onStart":{So:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{So:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{So:["FlowGraphSendCustomEventBlock"],extraProcessor(Z,x,F,u,G){if("event/send"!==x.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const f=Z.configuration.event.value[0];if("number"!==typeof f)throw new Error("Event id should be a number");const Y=u.arrays.events[f],j=G[0];return j.config||(j.config={}),j.config.eventId=Y.eventId,j.config.eventData=Y.eventData,G}},"event/receive":{So:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(Z,x){var F;if(!Z.configuration)return U.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const u=Z.configuration.event;if(!u)return U.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const G=u.value[0];if("number"!==typeof G)return U.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(F=x.events)||void 0===F?void 0:F[G])?{valid:!0}:(U.d.Error(`Event with id ${G} not found`),{valid:!1,error:`Event with id ${G} not found`})},extraProcessor(Z,x,F,u,G){if("event/receive"!==x.op||!Z.configuration||1!==Object.keys(Z.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const f=Z.configuration.event.value[0];if("number"!==typeof f)throw new Error("Event id should be a number");const Y=u.arrays.events[f],j=G[0];return j.config||(j.config={}),j.config.eventId=Y.eventId,j.config.eventData=Y.eventData,G}},"math/e":iF("FlowGraphEBlock"),"math/pi":iF("FlowGraphPIBlock"),"math/inf":iF("FlowGraphInfBlock"),"math/nan":iF("FlowGraphNaNBlock"),"math/abs":iF("FlowGraphAbsBlock"),"math/sign":iF("FlowGraphSignBlock"),"math/trunc":iF("FlowGraphTruncBlock"),"math/floor":iF("FlowGraphFloorBlock"),"math/ceil":iF("FlowGraphCeilBlock"),"math/round":{So:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G){var f;return(f=G[0]).config||(f.config={}),G[0].config.roundHalfAwayFromZero=!0,G}},"math/fract":iF("FlowGraphFractBlock"),"math/neg":iF("FlowGraphNegationBlock"),"math/add":iF("FlowGraphAddBlock",["a","b"],!0),"math/sub":iF("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{So:["FlowGraphMultiplyBlock"],extraProcessor(Z,x,F,u,G){var f;(f=G[0]).config||(f.config={}),G[0].config.useMatrixPerComponent=!0,G[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(Z.values||{}).find((x=>{var F;return void 0!==(null===(F=Z.values)||void 0===F?void 0:F[x].type)&&(Y=Z.values[x].type,!0)})),-1!==Y&&(G[0].config.type=u.arrays.types[Y].flowGraphType),G},validation:Z=>Z.values?eF(Z):{valid:!0}},"math/div":iF("FlowGraphDivideBlock",["a","b"],!0),"math/rem":iF("FlowGraphModuloBlock",["a","b"]),"math/min":iF("FlowGraphMinBlock",["a","b"]),"math/max":iF("FlowGraphMaxBlock",["a","b"]),"math/clamp":iF("FlowGraphClampBlock",["a","b","c"]),"math/saturate":iF("FlowGraphSaturateBlock"),"math/mix":iF("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":iF("FlowGraphEqualityBlock",["a","b"]),"math/lt":iF("FlowGraphLessThanBlock",["a","b"]),"math/le":iF("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":iF("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":iF("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":iF("FlowGraphIsNaNBlock"),"math/isinf":iF("FlowGraphIsInfBlock"),"math/select":{So:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{So:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":iF("FlowGraphSinBlock"),"math/cos":iF("FlowGraphCosBlock"),"math/tan":iF("FlowGraphTanBlock"),"math/asin":iF("FlowGraphASinBlock"),"math/acos":iF("FlowGraphACosBlock"),"math/atan":iF("FlowGraphATanBlock"),"math/atan2":iF("FlowGraphATan2Block",["a","b"]),"math/sinh":iF("FlowGraphSinhBlock"),"math/cosh":iF("FlowGraphCoshBlock"),"math/tanh":iF("FlowGraphTanhBlock"),"math/asinh":iF("FlowGraphASinhBlock"),"math/acosh":iF("FlowGraphACoshBlock"),"math/atanh":iF("FlowGraphATanhBlock"),"math/exp":iF("FlowGraphExponentialBlock"),"math/log":iF("FlowGraphLogBlock"),"math/log2":iF("FlowGraphLog2Block"),"math/log10":iF("FlowGraphLog10Block"),"math/sqrt":iF("FlowGraphSquareRootBlock"),"math/cbrt":iF("FlowGraphCubeRootBlock"),"math/pow":iF("FlowGraphPowerBlock",["a","b"]),"math/length":iF("FlowGraphLengthBlock"),"math/normalize":iF("FlowGraphNormalizeBlock"),"math/dot":iF("FlowGraphDotBlock",["a","b"]),"math/cross":iF("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":iF("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":iF("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{So:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{So:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{So:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{So:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{So:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{So:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{So:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":iF("FlowGraphTransposeBlock"),"math/determinant":iF("FlowGraphDeterminantBlock"),"math/inverse":iF("FlowGraphInvertMatrixBlock"),"math/matmul":iF("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{So:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"pj",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G,f){const Y=G[0].dataInputs.find((Z=>"rotationQuaternion"===Z.name));if(!Y)throw new Error("Rotation quaternion input not found");return f._connectionValues[Y.uniqueId]&&(f._connectionValues[Y.uniqueId].type="Quaternion"),G}},"math/matDecompose":{So:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"pj"}}}},"math/quatConjugate":iF("FlowGraphConjugateBlock",["a"]),"math/quatMul":{So:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G){var f;return(f=G[0]).config||(f.config={}),G[0].config.type="Quaternion",G}},"math/quatAngleBetween":iF("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{So:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":iF("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":iF("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{So:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G){var f;return(f=G[0]).config||(f.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract2x2":{So:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{So:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G){var f;return(f=G[0]).config||(f.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract3x3":{So:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{So:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G){var f;return(f=G[0]).config||(f.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract4x4":{So:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{So:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G,f){var Y,j;(j=G[0]).config||(j.config={});const d=G[0].dataInputs[0];return G[0].config.valueType=(null===(Y=f._connectionValues[d.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",G}},"math/and":{So:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G,f){var Y,j,d;(d=G[0]).config||(d.config={});const t=G[0].dataInputs[0],o=G[0].dataInputs[1];return G[0].config.valueType=(null===(Y=f._connectionValues[t.uniqueId])||void 0===Y?void 0:Y.type)??(null===(j=f._connectionValues[o.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",G}},"math/or":{So:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G,f){var Y,j,d;(d=G[0]).config||(d.config={});const t=G[0].dataInputs[0],o=G[0].dataInputs[1];return G[0].config.valueType=(null===(Y=f._connectionValues[t.uniqueId])||void 0===Y?void 0:Y.type)??(null===(j=f._connectionValues[o.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",G}},"math/xor":{So:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,x,F,u,G,f){var Y,j,d;(d=G[0]).config||(d.config={});const t=G[0].dataInputs[0],o=G[0].dataInputs[1];return G[0].config.valueType=(null===(Y=f._connectionValues[t.uniqueId])||void 0===Y?void 0:Y.type)??(null===(j=f._connectionValues[o.uniqueId])||void 0===j?void 0:j.type)??"FlowGraphInteger",G}},"math/asr":iF("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":iF("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":iF("FlowGraphLeadingZerosBlock"),"math/ctz":iF("FlowGraphTrailingZerosBlock"),"math/popcnt":iF("FlowGraphOneBitsCounterBlock"),"math/rad":iF("FlowGraphDegToRadBlock"),"math/deg":iF("FlowGraphRadToDegBlock"),"type/boolToInt":iF("FlowGraphBooleanToInt"),"type/boolToFloat":iF("FlowGraphBooleanToFloat"),"type/intToBool":iF("FlowGraphIntToBoolean"),"type/intToFloat":iF("FlowGraphIntToFloat"),"type/floatToInt":iF("FlowGraphFloatToInt"),"type/floatToBool":iF("FlowGraphFloatToBoolean"),"flow/sequence":{So:["FlowGraphSequenceBlock"],extraProcessor(Z,x,F,u,G){const f=G[0];return f.config||(f.config={}),f.config.outputSignalCount=Object.keys(Z.flows||[]).length,f.signalOutputs.forEach(((Z,x)=>{Z.name="out_"+x})),G}},"flow/branch":{So:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{So:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const x=Z.configuration.cases.value;if(!x.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return U.d.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const F=new Set(x);Z.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(Z,x,F,u,G){if("flow/switch"!==x.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return G[0].signalOutputs.forEach((Z=>{"default"!==Z.name&&(Z.name="out_"+Z.name)})),G}},"flow/while":{So:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{So:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(Z,x,F,u,G){const f=G[0];return f.config||(f.config={}),f.config.incrementIndexWhenLoopDone=!0,G}},"flow/doN":{So:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{So:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(Z,x,F,u,G){if("flow/multiGate"!==x.op||!Z.flows||0===Object.keys(Z.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const f=G[0];return f.config||(f.config={}),f.config.outputSignalCount=Object.keys(Z.flows).length,f.signalOutputs.forEach(((Z,x)=>{Z.name="out_"+x})),G}},"flow/waitAll":{So:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(Z){var x,F;return"number"!==typeof(null===(x=Z.configuration)||void 0===x||null===(F=x.inputFlows)||void 0===F?void 0:F.value[0])&&(Z.configuration=Z.configuration||{inputFlows:{value:[0]}},Z.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{So:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{So:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{So:["FlowGraphCancelDelayBlock"]},"variable/get":{So:["FlowGraphGetVariableBlock"],validation(Z){var x,F;return null!==(x=Z.configuration)&&void 0!==x&&null!==(F=x.variable)&&void 0!==F&&F.value?{valid:!0}:(U.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,x)=>[x.getVariableName(Z[0])]}}},"variable/set":{So:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(Z,x)=>[x.getVariableName(Z[0])]}}},"variable/setMultiple":{So:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(Z,x)=>[Z[0].map((Z=>x.getVariableName(Z)))]}},extraProcessor:(Z,x,F,u,G)=>(G[0].dataInputs.forEach((Z=>{Z.name=u.getVariableName(+Z.name)})),G)},"variable/interpolate":{So:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(Z,x)=>[x.getVariableName(Z[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:Z=>!0===Z[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qF:"FlowGraphPlayAnimationBlock"},out:{name:"out",qF:"FlowGraphPlayAnimationBlock"},done:{name:"done",qF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(Z,x,F,u,G){var f,Y,j;const d=G[0],t=null===(f=Z.configuration)||void 0===f?void 0:f.variable.value[0];if("number"!==typeof t)throw U.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const o=u.arrays.staticVariables[t];"undefined"===typeof d.config.animationType.value&&(u.arrays.staticVariables,d.config.animationType.value=(0,CF.K)(o.type));const c=G[4];return c.config||(c.config={}),(Y=c.config).variable||(Y.variable={}),c.config.variable.value=u.getVariableName(t),(j=G[3]).config||(j.config={}),G}},"pointer/get":{So:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",qF:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,x,F,u,G)=>(G.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),G)},"pointer/set":{So:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",qF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",qF:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,x,F,u,G)=>(G.forEach((Z=>{"FlowGraphJsonPointerParserBlock"===Z.className&&(Z.config||(Z.config={}),Z.config.outputValue=!0)})),G)},"pointer/interpolate":{So:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",qF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",qF:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",qF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",qF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",qF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",qF:"FlowGraphPlayAnimationBlock"},out:{name:"out",qF:"FlowGraphPlayAnimationBlock"},done:{name:"done",qF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(Z,x,F,u,G)=>(G.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className?(x.config||(x.config={}),x.config.outputValue=!0):"FlowGraphInterpolationBlock"===x.className&&(x.config||(x.config={}),Object.keys(Z.values||[]).forEach((F=>{var G;const f=null===(G=Z.values)||void 0===G?void 0:G[F];if("value"===F&&f){const Z=f.type;void 0!==Z&&(x.config.animationType=u.arrays.types[Z].flowGraphType)}})))})),G)},"animation/start":{So:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qF:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(Z,x)=>[Z[0]*x._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(Z,x)=>[Z[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){const j=G[G.length-1];return j.config||(j.config={}),j.config.glTF=Y,G}},"animation/stop":{So:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",qF:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){const j=G[G.length-1];return j.config||(j.config={}),j.config.glTF=Y,G}},"animation/stopAt":{So:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",qF:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(Z,x)=>[Z[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){const j=G[G.length-1];return j.config||(j.config={}),j.config.glTF=Y,G}},"math/switch":{So:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(Z){if(Z.configuration&&Z.configuration.cases){const x=Z.configuration.cases.value;if(!x.every((Z=>"number"===typeof Z&&/^-?\d+$/.test(Z.toString()))))return U.d.Warn("Switch cases should be integers. Using empty array instead."),Z.configuration.cases.value=[],{valid:!0};const F=new Set(x);Z.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(Z,x,F,u,G){const f=G[0];return f.dataInputs.forEach((Z=>{"default"!==Z.name&&"case"!==Z.name&&(Z.name="in_"+Z.name)})),f.config||(f.config={}),f.config.treatCasesAsIntegers=!0,G}},"debug/log":{So:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function iF(Z){let x=arguments.length>2?arguments[2]:void 0;return{So:[Z],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((Z,x)=>(Z[x]={name:x},Z)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(Z,F,u,G,f){var Y;if(x){(Y=f[0]).config||(Y.config={}),f[0].config.preventIntegerFloatArithmetic=!0;let x=-1;Object.keys(Z.values||{}).find((F=>{var u;return void 0!==(null===(u=Z.values)||void 0===u?void 0:u[F].type)&&(x=Z.values[F].type,!0)})),-1!==x&&(f[0].config.type=G.arrays.types[x].flowGraphType)}return f},validation:Z=>x?eF(Z):{valid:!0}}}function eF(Z){if(Z.values){const x=Object.keys(Z.values).map((x=>Z.values[x].type)).filter((Z=>void 0!==Z));if(!x.every((Z=>Z===x[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}lF["math/compose"]=lF["math/matCompose"],lF["math/decompose"]=lF["math/matDecompose"];var bF=F(11144);const EF={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"kx",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class wF{constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=Z,this._gltf=x,this._animationTargetFps=F,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const Z of this._interactivityGraph.types)this._types.push(EF[Z.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const Z of this._interactivityGraph.declarations){const x=RF(Z);if(!x)throw U.d.Error(["No mapping found for declaration",Z]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:x,fullOperationName:Z.extension?Z.op+":"+Z.extension:Z.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const Z of this._interactivityGraph.variables){const x=this._parseVariable(Z);this._staticVariables.push(x)}}_parseVariable(Z,x){const F=this._types[Z.type];if(!F)throw U.d.Error(["No type found for variable",Z]),new Error("Error parsing variables");if(Z.value&&Z.value.length!==F.length)throw U.d.Error(["Invalid value length for variable",Z,F]),new Error("Error parsing variables");const u=Z.value||[];if(!u.length)switch(F.flowGraphType){case"boolean":u.push(!1);break;case"FlowGraphInteger":u.push(0);break;case"number":u.push(NaN);break;case"Vector2":u.push(NaN,NaN);break;case"kx":u.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":u.fill(NaN,0,4);break;case"Matrix":u.fill(NaN,0,16);break;case"Matrix3D":u.fill(NaN,0,9)}return"number"===F.elementType&&"string"===typeof u[0]&&(u[0]=parseFloat(u[0])),{type:F.flowGraphType,value:x?x(u,this):u}}_parseEvents(){if(this._interactivityGraph.events)for(const Z of this._interactivityGraph.events){const x={eventId:Z.id||"internalEvent_"+this._internalEventsCounter++};Z.values&&(x.eventData=Object.keys(Z.values).map((x=>{var F;const u=null===(F=Z.values)||void 0===F?void 0:F[x];if(!u)throw U.d.Error(["No value found for event key",x]),new Error("Error parsing events");const G=this._types[u.type];if(!G)throw U.d.Error(["No type found for event value",u]),new Error("Error parsing events");const f="undefined"!==typeof u.value?this._parseVariable(u):void 0;return{id:x,type:G.flowGraphType,eventData:!0,value:f}}))),this._events.push(x)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const x of this._interactivityGraph.nodes){if("number"!==typeof x.declaration)throw U.d.Error(["No declaration found for node",x]),new Error("Error parsing nodes");const F=this._mappings[x.declaration];if(!F)throw U.d.Error(["No mapping found for node",x]),new Error("Error parsing nodes");if(F.flowGraphMapping.validation){const u=F.flowGraphMapping.validation(x,this._interactivityGraph,this._gltf);var Z;if(!u.valid)throw new Error(`Error validating interactivity node ${null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[x.declaration].op} - ${u.error}`)}const u=[];for(const Z of F.flowGraphMapping.So){const G=this._getEmptyBlock(Z,F.fullOperationName);this._parseNodeConfiguration(x,G,F.flowGraphMapping,Z),u.push(G)}this._nodes.push({So:u,fullOperationName:F.fullOperationName})}}_getEmptyBlock(Z,x){return{uniqueId:(0,bF.c)(),className:Z,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:x,metadata:{}}}_parseNodeConfiguration(Z,x,F,u){const G=x.config;if(Z.configuration){const x=Object.keys(Z.configuration);for(const j of x){var f,Y;const x=null===(f=Z.configuration)||void 0===f?void 0:f[j];if(!x)throw U.d.Error(["No value found for node configuration",j]),new Error("Error parsing node configuration");const d=null===(Y=F.configuration)||void 0===Y?void 0:Y[j];if(d&&d.qF?d.qF===u:0===F.So.indexOf(u)){const Z=(null===d||void 0===d?void 0:d.name)||j;x&&"undefined"!==typeof x.value||"undefined"===typeof(null===d||void 0===d?void 0:d.defaultValue)?x.value.length>=0?G[Z]={value:1===x.value.length?x.value[0]:x.value}:U.d.Warn(["Invalid value for node configuration",x]):G[Z]={value:d.defaultValue},d&&d.dataTransformer&&(G[Z].value=d.dataTransformer([G[Z].value],this)[0])}}}}_parseNodeConnections(Z){for(let S=0;S<this._nodes.length;S++){var x;const K=null===(x=this._interactivityGraph.nodes)||void 0===x?void 0:x[S];if(!K)throw U.d.Error(["No node found for interactivity node",this._nodes[S]]),new Error("Error parsing node connections");const y=this._nodes[S],q=this._mappings[K.declaration];if(!q)throw U.d.Error(["No mapping found for node",K]),new Error("Error parsing node connections");const R=K.flows||{},B=Object.keys(R).sort();for(const Z of B){var F,u,G,f;const x=R[Z],t=null===(F=q.flowGraphMapping.outputs)||void 0===F||null===(u=F.flows)||void 0===u?void 0:u[Z],o=(null===t||void 0===t?void 0:t.name)||Z,c=this._createNewSocketConnection(o,!0);(t&&t.qF&&y.So.find((Z=>Z.className===t.qF))||y.So[0]).signalOutputs.push(c);const s=x.node,J=this._nodes[s];if(!J)throw U.d.Error(["No node found for input node id",s]),new Error("Error parsing node connections");const p=qF(J.fullOperationName);if(!p)throw U.d.Error(["No mapping found for input node",J]),new Error("Error parsing node connections");let k=null===(G=p.inputs)||void 0===G||null===(f=G.flows)||void 0===f?void 0:f[x.socket||"in"],M=!1;if(!k)for(const Z in null===(Y=p.inputs)||void 0===Y?void 0:Y.flows){var Y,j,d;if(Z.startsWith("[")&&Z.endsWith("]"))M=!0,k=null===(j=p.inputs)||void 0===j||null===(d=j.flows)||void 0===d?void 0:d[Z]}const m=k?M?k.name.replace("$1",x.socket||""):k.name:x.socket||"in",C=k&&k.qF&&J.So.find((Z=>Z.className===k.qF))||J.So[0];let L=C.signalInputs.find((Z=>Z.name===m));L||(L=this._createNewSocketConnection(m),C.signalInputs.push(L)),L.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(L.uniqueId)}const v=K.values||{},l=Object.keys(v);for(const x of l){var t,o;const F=v[x];let u=null===(t=q.flowGraphMapping.inputs)||void 0===t||null===(o=t.values)||void 0===o?void 0:o[x],G=!1;if(!u)for(const Z in null===(c=q.flowGraphMapping.inputs)||void 0===c?void 0:c.values){var c,s,J;if(Z.startsWith("[")&&Z.endsWith("]"))G=!0,u=null===(s=q.flowGraphMapping.inputs)||void 0===s||null===(J=s.values)||void 0===J?void 0:J[Z]}const f=u?G?u.name.replace("$1",x):u.name:x,Y=this._createNewSocketConnection(f);if((u&&u.qF&&y.So.find((Z=>Z.className===u.qF))||y.So[0]).dataInputs.push(Y),void 0!==F.value){const x=this._parseVariable(F,u&&u.dataTransformer);Z._connectionValues[Y.uniqueId]=x}else{if("undefined"===typeof F.node)throw U.d.Error(["Invalid value for value connection",F]),new Error("Error parsing node connections");{var p,k,M;const Z=F.node,x=F.socket||"value",u=this._nodes[Z];if(!u)throw U.d.Error(["No node found for output socket reference",F]),new Error("Error parsing node connections");const G=qF(u.fullOperationName);if(!G)throw U.d.Error(["No mapping found for output socket reference",F]),new Error("Error parsing node connections");let f=null===(p=G.outputs)||void 0===p||null===(k=p.values)||void 0===k?void 0:k[x],j=!1;if(!f)for(const F in null===(m=G.outputs)||void 0===m?void 0:m.values){var m,C,L;if(F.startsWith("[")&&F.endsWith("]"))j=!0,f=null===(C=G.outputs)||void 0===C||null===(L=C.values)||void 0===L?void 0:L[F]}const d=f?j?f.name.replace("$1",x):null===(M=f)||void 0===M?void 0:M.name:x,t=f&&f.qF&&u.So.find((Z=>Z.className===f.qF))||u.So[0];let o=t.dataOutputs.find((Z=>Z.name===d));o||(o=this._createNewSocketConnection(d,!0),t.dataOutputs.push(o)),Y.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(Y.uniqueId)}}}if(q.flowGraphMapping.interBlockConnectors)for(const Z of q.flowGraphMapping.interBlockConnectors){const x=Z.input,F=Z.output,u=Z.isVariable;this._connectFlowGraphNodes(x,F,y.So[Z.inputBlockIndex],y.So[Z.outputBlockIndex],u)}if(q.flowGraphMapping.extraProcessor){var H;const x=null===(H=this._interactivityGraph.declarations)||void 0===H?void 0:H[K.declaration];if(!x)throw U.d.Error(["No declaration found for extra processor",K]),new Error("Error parsing node connections");y.So=q.flowGraphMapping.extraProcessor(K,x,q.flowGraphMapping,this,y.So,Z,this._gltf)}}}_createNewSocketConnection(Z,x){return{uniqueId:(0,bF.c)(),name:Z,_connectionType:x?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(Z,x,F,u,G){const f=G?F.dataInputs:F.signalInputs,Y=G?u.dataOutputs:u.signalOutputs,j=f.find((x=>x.name===Z))||this._createNewSocketConnection(Z),d=Y.find((Z=>Z.name===x))||this._createNewSocketConnection(x,!0);f.find((x=>x.name===Z))||f.push(j),Y.find((Z=>Z.name===x))||Y.push(d),j.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(j.uniqueId)}getVariableName(Z){return"staticVariable_"+Z}serializeToFlowGraph(){const Z={uniqueId:(0,bF.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(Z);for(let x=0;x<this._staticVariables.length;x++){const F=this._staticVariables[x];Z._userVariables[this.getVariableName(x)]=F}return{rightHanded:!0,allBlocks:this._nodes.reduce(((Z,x)=>Z.concat(x.So)),[]),executionContexts:[Z]}}}const TF="KHR_interactivity";class NF{constructor(Z){this._loader=Z,this.name=TF,this.enabled=this._loader.isExtensionUsed(TF),this._pathConverter=(0,W.j)(this._loader.Cf),Z._skipStartAnimationStep=!0;const x=Z.babylonScene;x&&function(Z){(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!Z.activeCamera)return new G.Quaternion(NaN,NaN,NaN,NaN);const x=G.Quaternion.FromRotationMatrix(Z.activeCamera.getWorldMatrix()).normalize();return Z.useRightHandedSystem||(x.w*=-1,x.x*=-1),x},type:"Quaternion",getTarget:()=>Z.activeCamera}),(0,W.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!Z.activeCamera)return new G.kx(NaN,NaN,NaN);const x=Z.activeCamera.getWorldMatrix().getTranslation();return Z.useRightHandedSystem||(x.x*=-1),x},type:"kx",getTarget:()=>Z.activeCamera}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:Z=>{var x;return(null===(x=Z._babylonAnimationGroup)||void 0===x?void 0:x.isPlaying)??!1},type:"boolean",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:Z=>{var x;return((null===(x=Z._babylonAnimationGroup)||void 0===x?void 0:x.from)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:Z=>{var x;return((null===(x=Z._babylonAnimationGroup)||void 0===x?void 0:x.to)??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:Z=>{var x;return((null===(x=Z._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup}),(0,W.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:Z=>{var x;return((null===(x=Z._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:Z=>Z._babylonAnimationGroup})}(x)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var Z;if(!this._loader.babylonScene||!this._pathConverter)return;const x=this._loader.babylonScene,F=null===(Z=this._loader.Cf.extensions)||void 0===Z?void 0:Z.KHR_interactivity;if(!F)return;const u=new pF.d({mx:x});u.dispatchEventsSynchronously=!1;const G=F.graphs.map((Z=>new wF(Z,this._loader.Cf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(G.map((async Z=>await SF(Z,{coordinator:u,pathConverter:this._pathConverter})))),u.start()}}var WF;WF=async()=>(await Promise.resolve().then(F.bind(F,13012))).FlowGraphGLTFDataProvider,UF[`${TF}/${"FlowGraphGLTFDataProvider"}`]=WF,N(TF),T(TF,!0,(Z=>new NF(Z)));const AF="KHR_node_visibility";(0,W.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:Z=>{const x=Z._babylonTransformNode;return!x||void 0===x.isVisible||x.isVisible},set:(Z,x)=>{var F,u;null===(F=x._primitiveBabylonMeshes)||void 0===F||F.forEach((Z=>{Z.inheritVisibility=!0})),x._babylonTransformNode&&(x._babylonTransformNode.isVisible=Z),null===(u=x._primitiveBabylonMeshes)||void 0===u||u.forEach((x=>{x.isVisible=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class hF{constructor(Z){this.name=AF,this._loader=Z,this.enabled=Z.isExtensionUsed(AF)}async onReady(){var Z;null===(Z=this._loader.Cf.nodes)||void 0===Z||Z.forEach((Z=>{var x,F,u,G;(null===(x=Z._primitiveBabylonMeshes)||void 0===x||x.forEach((Z=>{Z.inheritVisibility=!0})),null!==(F=Z.extensions)&&void 0!==F&&F.KHR_node_visibility)&&(!1===(null===(u=Z.extensions)||void 0===u?void 0:u.KHR_node_visibility.visible)&&(Z._babylonTransformNode&&(Z._babylonTransformNode.isVisible=!1),null===(G=Z._primitiveBabylonMeshes)||void 0===G||G.forEach((Z=>{Z.isVisible=!1}))))}))}dispose(){this._loader=null}}N(AF),T(AF,!0,(Z=>new hF(Z)));const XF="KHR_node_selectability";BF("event/onSelect",XF,{So:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qF:"FlowGraphGetVariableBlock",dataTransformer:Z=>["pickedMesh_"+Z[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",qF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){var j,d,t,o,c,s;const J=G[G.length-1];J.config=J.config||{},J.config.glTF=Y;const p=null===(j=Z.configuration)||void 0===j||null===(d=j.nodeIndex)||void 0===d?void 0:d.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const U="pickedMesh_"+p;return G[1].config.variable=U,f._userVariables[U]={className:"Mesh",id:null===Y||void 0===Y||null===(t=Y.nodes)||void 0===t||null===(o=t[p]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===Y||void 0===Y||null===(c=Y.nodes)||void 0===c||null===(s=c[p]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},G}}),(0,W.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:Z=>{const x=Z._babylonTransformNode;return!x||void 0===x.Xd||x.Xd},set:(Z,x)=>{var F;null===(F=x._primitiveBabylonMeshes)||void 0===F||F.forEach((x=>{x.Xd=Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"Xd"],type:"boolean"});class DF{constructor(Z){this.name=XF,this._loader=Z,this.enabled=Z.isExtensionUsed(XF)}async onReady(){var Z;null===(Z=this._loader.Cf.nodes)||void 0===Z||Z.forEach((Z=>{var x,F,u;null!==(x=Z.extensions)&&void 0!==x&&x.KHR_node_selectability&&!1===(null===(F=Z.extensions)||void 0===F?void 0:F.KHR_node_selectability.selectable)&&(null===(u=Z._babylonTransformNode)||void 0===u||u.getChildMeshes().forEach((Z=>{Z.Xd=!1})))}))}dispose(){this._loader=null}}N(XF),T(XF,!0,(Z=>new DF(Z)));const QF="KHR_node_hoverability",gF="targetMeshPointerOver_";BF("event/onHoverIn",QF,{So:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qF:"FlowGraphGetVariableBlock",dataTransformer:Z=>[gF+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){var j,d,t,o,c,s;const J=G[G.length-1];J.config=J.config||{},J.config.glTF=Y;const p=null===(j=Z.configuration)||void 0===j||null===(d=j.nodeIndex)||void 0===d?void 0:d.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const U=gF+p;return G[1].config.variable=U,f._userVariables[U]={className:"Mesh",id:null===Y||void 0===Y||null===(t=Y.nodes)||void 0===t||null===(o=t[p]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===Y||void 0===Y||null===(c=Y.nodes)||void 0===c||null===(s=c[p]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},G}});const OF="targetMeshPointerOut_";BF("event/onHoverOut",QF,{So:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",qF:"FlowGraphGetVariableBlock",dataTransformer:Z=>[OF+Z[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",qF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(Z,x,F,u,G,f,Y){var j,d,t,o,c,s;const J=G[G.length-1];J.config=J.config||{},J.config.glTF=Y;const p=null===(j=Z.configuration)||void 0===j||null===(d=j.nodeIndex)||void 0===d?void 0:d.value[0];if(void 0===p||"number"!==typeof p)throw new Error("nodeIndex not found in configuration");const U=OF+p;return G[1].config.variable=U,f._userVariables[U]={className:"Mesh",id:null===Y||void 0===Y||null===(t=Y.nodes)||void 0===t||null===(o=t[p]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===Y||void 0===Y||null===(c=Y.nodes)||void 0===c||null===(s=c[p]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},G}}),(0,W.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:Z=>{const x=Z._babylonTransformNode;return!x||void 0===x.pointerOverDisableMeshTesting||x.pointerOverDisableMeshTesting},set:(Z,x)=>{var F;null===(F=x._primitiveBabylonMeshes)||void 0===F||F.forEach((x=>{x.pointerOverDisableMeshTesting=!Z}))},getTarget:Z=>Z._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class nF{constructor(Z){this.name=QF,this._loader=Z,this.enabled=Z.isExtensionUsed(QF)}async onReady(){var Z;null===(Z=this._loader.Cf.nodes)||void 0===Z||Z.forEach((Z=>{var x,F,u;null!==(x=Z.extensions)&&void 0!==x&&x.KHR_node_hoverability&&!1===(null===(F=Z.extensions)||void 0===F?void 0:F.KHR_node_hoverability.hoverable)&&(null===(u=Z._babylonTransformNode)||void 0===u||u.getChildMeshes().forEach((Z=>{Z.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}N(QF),T(QF,!0,(Z=>new nF(Z)));const VF="ExtrasAsMetadata";class aF{_assignExtras(Z,x){if(x.extras&&Object.keys(x.extras).length>0){const F=Z.metadata=Z.metadata||{};(F.Cf=F.Cf||{}).extras=x.extras}}constructor(Z){this.name=VF,this.enabled=!0,this._loader=Z}dispose(){this._loader=null}loadNodeAsync(Z,x,F){return this._loader.loadNodeAsync(Z,x,(Z=>{this._assignExtras(Z,x),F(Z)}))}loadCameraAsync(Z,x,F){return this._loader.loadCameraAsync(Z,x,(Z=>{this._assignExtras(Z,x),F(Z)}))}createMaterial(Z,x,F){const u=this._loader.createMaterial(Z,x,F);return this._assignExtras(u,x),u}}N(VF),T(VF,!1,(Z=>new aF(Z)));F(13012)},12872:(Z,x,F)=>{"use strict";F.d(x,{e:()=>e,g:()=>q,j:()=>y,m:()=>R});var u=F(11e3),G=F(10994),f=F(12509),Y=F(11671),j=F(11627),d=F(11642),t=F(11012),o=F(11037),c=F(11664),s=F(11764),J=F(11673),p=F(11221);class U{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Vs=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vJ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(Z){this._environmentTexture=Z}getNodes(){let Z=[];Z=Z.concat(this.meshes),Z=Z.concat(this.lights),Z=Z.concat(this.cameras),Z=Z.concat(this.transformNodes);for(const x of this.skeletons)Z=Z.concat(x.bones);return Z}}class k extends U{}class M{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const Z=this.rootNodes;for(const u of Z)u.dispose();Z.length=0;const x=this.skeletons;for(const u of x)u.dispose();x.length=0;const F=this.animationGroups;for(const u of F)u.dispose();F.length=0}}class m extends U{constructor(Z){super(),this._wasAddedToScene=!1,(Z=Z||o.c.LastCreatedScene)&&(this.mx=Z,this.proceduralTextures=[],Z.Uf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=Z.getEngine().onContextRestoredObservable.add((()=>{for(const Z of this.geometries)Z._rebuild();for(const Z of this.meshes)Z._rebuild();for(const Z of this.Vs)Z.rebuild();for(const Z of this.textures)Z._rebuild()})))}_topologicalSort(Z){const x=new Map;for(const Y of Z)x.set(Y.uniqueId,Y);const F={dependsOn:new Map,dependedBy:new Map};for(const Y of Z){const Z=Y.uniqueId;F.dependsOn.set(Z,new Set),F.dependedBy.set(Z,new Set)}for(const Y of Z){const Z=Y.uniqueId,u=F.dependsOn.get(Z);if(Y instanceof c.d){const G=Y.sourceMesh;x.has(G.uniqueId)&&(u.add(G.uniqueId),F.dependedBy.get(G.uniqueId).add(Z))}const G=F.dependedBy.get(Z);for(const f of Y.getDescendants()){const u=f.uniqueId;if(x.has(u)){G.add(u);F.dependsOn.get(u).add(Z)}}}const u=[],G=[];for(const Y of Z){const Z=Y.uniqueId;0===F.dependsOn.get(Z).size&&(G.push(Y),x.delete(Z))}const f=G;for(;f.length>0;){const Z=f.shift();u.push(Z);const G=F.dependedBy.get(Z.uniqueId);for(const u of Array.from(G.values())){const G=F.dependsOn.get(u);G.delete(Z.uniqueId),0===G.size&&x.get(u)&&(f.push(x.get(u)),x.delete(u))}}return x.size>0&&(t.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),x.forEach((Z=>{t.d.Error(Z.name)}))),u}_addNodeAndDescendantsToList(Z,x,F,u){if(F&&(!u||u(F))&&!x.has(F.uniqueId)){Z.push(F),x.add(F.uniqueId);for(const G of F.getDescendants(!0))this._addNodeAndDescendantsToList(Z,x,G,u)}}_isNodeInContainer(Z){return Z instanceof d.c&&-1!==this.meshes.indexOf(Z)||(Z instanceof j.d&&-1!==this.transformNodes.indexOf(Z)||(Z instanceof s.e&&-1!==this.lights.indexOf(Z)||Z instanceof J.c&&-1!==this.cameras.indexOf(Z)))}_isValidHierarchy(){for(const Z of this.meshes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return t.d.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.transformNodes)if(Z.parent&&!this._isNodeInContainer(Z.parent))return t.d.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.lights)if(Z.parent&&!this._isNodeInContainer(Z.parent))return t.d.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;for(const Z of this.cameras)if(Z.parent&&!this._isNodeInContainer(Z.parent))return t.d.Warn(`Node ${Z.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(Z){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const u={},f={},j=new M,d=[],t=[],o={doNotInstantiate:!0,...F},c=[],s=new Set;for(const G of this.transformNodes)null===G.parent&&this._addNodeAndDescendantsToList(c,s,G,o.predicate);for(const G of this.meshes)null===G.parent&&this._addNodeAndDescendantsToList(c,s,G,o.predicate);const J=this._topologicalSort(c),p=(F,G)=>{if(((x,F)=>{if(u[x.uniqueId]=F.uniqueId,f[F.uniqueId]=F,Z&&(F.name=Z(x.name)),F instanceof Y.d){const Z=F;if(Z.morphTargetManager){const F=x.morphTargetManager;Z.morphTargetManager=F.clone();for(let x=0;x<F.numTargets;x++){const G=F.getTarget(x),Y=Z.morphTargetManager.getTarget(x);u[G.uniqueId]=Y.uniqueId,f[Y.uniqueId]=Y}}}})(F,G),F.parent){const Z=u[F.parent.uniqueId],x=f[Z];G.parent=x||F.parent}if(G.position&&F.position&&G.position.G(F.position),G.rotationQuaternion&&F.rotationQuaternion&&G.rotationQuaternion.G(F.rotationQuaternion),G.rotation&&F.rotation&&G.rotation.G(F.rotation),G.pj&&F.pj&&G.pj.G(F.pj),G.material){const Y=G;if(Y.material)if(x){const x=F.material;if(-1===t.indexOf(x)){let F=x.clone(Z?Z(x.name):"Clone of "+x.name);if(t.push(x),u[x.uniqueId]=F.uniqueId,f[F.uniqueId]=F,"MultiMaterial"===x.getClassName()){const G=x;for(const x of G.Mj)x&&(F=x.clone(Z?Z(x.name):"Clone of "+x.name),t.push(x),u[x.uniqueId]=F.uniqueId,f[F.uniqueId]=F);G.Mj=G.Mj.map((Z=>Z&&f[u[Z.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=f[u[x.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.mx.multiMaterials.indexOf(Y.material)&&this.mx.addMultiMaterial(Y.material):-1===this.mx.materials.indexOf(Y.material)&&this.mx.addMaterial(Y.material)}null===G.parent&&j.rootNodes.push(G)};for(const G of J)if("InstancedMesh"===G.getClassName()){const Z=G,x=Z.sourceMesh,F=u[x.uniqueId];p(Z,("number"===typeof F?f[F]:x).createInstance(Z.name))}else{let Z=!0;"Yd"===G.getClassName()||"Node"===G.getClassName()||G.skeleton||!G.getTotalVertices||0===G.getTotalVertices()?Z=!1:o.doNotInstantiate&&(Z="function"===typeof o.doNotInstantiate?!o.doNotInstantiate(G):!o.doNotInstantiate);const x=Z?G.createInstance(`instance of ${G.name}`):G.clone(`Clone of ${G.name}`,null,!0);if(!x)throw new Error(`Could not clone or instantiate node on Asset Container ${G.name}`);p(G,x)}for(const G of this.skeletons){if(o.predicate&&!o.predicate(G))continue;const x=G.clone(Z?Z(G.name):"Clone of "+G.name);for(const Z of this.meshes)if(Z.skeleton===G&&!Z.isAnInstance){const F=f[u[Z.uniqueId]];if(!F||F.isAnInstance)continue;if(F.skeleton=x,-1!==d.indexOf(x))continue;d.push(x);for(const Z of x.bones)Z._linkedTransformNode&&(Z._linkedTransformNode=f[u[Z._linkedTransformNode.uniqueId]])}j.skeletons.push(x)}for(const G of this.animationGroups){if(o.predicate&&!o.predicate(G))continue;const x=G.clone(Z?Z(G.name):"Clone of "+G.name,(Z=>f[u[Z.uniqueId]]||Z));j.animationGroups.push(x)}return j}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.mx.environmentTexture=this.environmentTexture);for(const Z of this.mx._serializableComponents)Z.addFromContainer(this);this.mx.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=[];for(const F of this.cameras)Z&&!Z(F)||(this.mx.addCamera(F),x.push(F));for(const F of this.lights)Z&&!Z(F)||(this.mx.addLight(F),x.push(F));for(const F of this.meshes)Z&&!Z(F)||(this.mx.oo(F),x.push(F));for(const F of this.skeletons)Z&&!Z(F)||this.mx.addSkeleton(F);for(const F of this.animations)Z&&!Z(F)||this.mx.addAnimation(F);for(const F of this.animationGroups)Z&&!Z(F)||this.mx.addAnimationGroup(F);for(const F of this.multiMaterials)Z&&!Z(F)||this.mx.addMultiMaterial(F);for(const F of this.materials)Z&&!Z(F)||this.mx.addMaterial(F);for(const F of this.morphTargetManagers)Z&&!Z(F)||this.mx.addMorphTargetManager(F);for(const F of this.geometries)Z&&!Z(F)||this.mx.addGeometry(F);for(const F of this.transformNodes)Z&&!Z(F)||(this.mx.addTransformNode(F),x.push(F));for(const F of this.actionManagers)Z&&!Z(F)||this.mx.addActionManager(F);for(const F of this.textures)Z&&!Z(F)||this.mx.addTexture(F);for(const F of this.reflectionProbes)Z&&!Z(F)||this.mx.addReflectionProbe(F);for(const F of x)F.parent&&-1===this.mx.getNodes().indexOf(F.parent)&&(F.setParent?F.setParent(null):F.parent=null)}removeAllFromScene(){this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.mx.environmentTexture&&(this.mx.environmentTexture=null);for(const Z of this.mx._serializableComponents)Z.removeFromContainer(this)}removeFromScene(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const x of this.cameras)Z&&!Z(x)||this.mx.removeCamera(x);for(const x of this.lights)Z&&!Z(x)||this.mx.removeLight(x);for(const x of this.meshes)Z&&!Z(x)||this.mx.do(x,!0);for(const x of this.skeletons)Z&&!Z(x)||this.mx.removeSkeleton(x);for(const x of this.animations)Z&&!Z(x)||this.mx.removeAnimation(x);for(const x of this.animationGroups)Z&&!Z(x)||this.mx.removeAnimationGroup(x);for(const x of this.multiMaterials)Z&&!Z(x)||this.mx.removeMultiMaterial(x);for(const x of this.materials)Z&&!Z(x)||this.mx.removeMaterial(x);for(const x of this.morphTargetManagers)Z&&!Z(x)||this.mx.removeMorphTargetManager(x);for(const x of this.geometries)Z&&!Z(x)||this.mx.removeGeometry(x);for(const x of this.transformNodes)Z&&!Z(x)||this.mx.removeTransformNode(x);for(const x of this.actionManagers)Z&&!Z(x)||this.mx.removeActionManager(x);for(const x of this.textures)Z&&!Z(x)||this.mx.removeTexture(x);for(const x of this.reflectionProbes)Z&&!Z(x)||this.mx.removeReflectionProbe(x)}dispose(){const Z=this.cameras.slice(0);for(const J of Z)J.dispose();this.cameras.length=0;const x=this.lights.slice(0);for(const J of x)J.dispose();this.lights.length=0;const F=this.meshes.slice(0);for(const J of F)J.dispose();this.meshes.length=0;const u=this.skeletons.slice(0);for(const J of u)J.dispose();this.skeletons.length=0;const G=this.animationGroups.slice(0);for(const J of G)J.dispose();this.animationGroups.length=0;const f=this.multiMaterials.slice(0);for(const J of f)J.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const J of Y)J.dispose();this.materials.length=0;const j=this.geometries.slice(0);for(const J of j)J.dispose();this.geometries.length=0;const d=this.transformNodes.slice(0);for(const J of d)J.dispose();this.transformNodes.length=0;const t=this.actionManagers.slice(0);for(const J of t)J.dispose();this.actionManagers.length=0;const o=this.textures.slice(0);for(const J of o)J.dispose();this.textures.length=0;const c=this.reflectionProbes.slice(0);for(const J of c)J.dispose();this.reflectionProbes.length=0;const s=this.morphTargetManagers.slice(0);for(const J of s)J.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const J of this.mx._serializableComponents)J.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.mx.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(Z,x,F){if(Z&&x)for(const u of Z){let Z=!0;if(F)for(const x of F)if(u===x){Z=!1;break}Z&&(x.push(u),u._parentContainer=this)}}moveAllFromScene(Z){this._wasAddedToScene=!1,void 0===Z&&(Z=new k);for(const x in this)Object.prototype.hasOwnProperty.call(this,x)&&(this[x]=this[x]||("_environmentTexture"===x?null:[]),this._moveAssets(this.mx[x],this[x],Z[x]));this.environmentTexture=this.mx.environmentTexture,this.removeAllFromScene()}createRootMesh(){const Z=new Y.d("assetContainerRootMesh",this.mx);for(const x of this.meshes)x.parent||Z.addChild(x);return this.meshes.unshift(Z),Z}mergeAnimationsTo(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.c.LastCreatedScene,x=arguments.length>1?arguments[1]:void 0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Z)return t.d.Error("No scene available to merge animations to"),[];const u=F||(x=>{let F=null;const u=x.animations.length?x.animations[0].targetProperty:"",G=x.name.split(".").join("").split("_primitive")[0];switch(u){case"position":case"rotationQuaternion":F=Z.getTransformNodeByName(x.name)||Z.getTransformNodeByName(G);break;case"influence":F=Z.getMorphTargetByName(x.name)||Z.getMorphTargetByName(G);break;default:F=Z.getNodeByName(x.name)||Z.getNodeByName(G)}return F}),G=this.getNodes();for(const j of G){const Z=u(j);if(null!==Z){for(const x of j.animations){const F=Z.animations.filter((Z=>Z.targetProperty===x.targetProperty));for(const x of F){const F=Z.animations.indexOf(x,0);F>-1&&Z.animations.splice(F,1)}}Z.animations=Z.animations.concat(j.animations)}}const f=[],Y=this.animationGroups.slice();for(const j of Y){f.push(j.clone(j.name,u));for(const Z of j.animatables)Z.stop()}for(const j of x){const x=u(j.target);x&&(Z.beginAnimation(x,j.fromFrame,j.toFrame,j.loopAnimation,j.speedRatio,j.onAnimationEnd?j.onAnimationEnd:void 0,void 0,!0,void 0,j.onAnimationLoop?j.onAnimationLoop:void 0),Z.stopAnimation(j.target))}return f}populateRootNodes(){this.rootNodes.length=0;for(const Z of this.meshes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.transformNodes)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.lights)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z);for(const Z of this.cameras)Z.parent||-1!==this.rootNodes.indexOf(Z)||this.rootNodes.push(Z)}addAllAssetsToContainer(Z){if(!Z)return;const x=[],F=new Set;for(x.push(Z);x.length>0;){const Z=x.pop();if(Z instanceof Y.d?(Z.af&&-1===this.geometries.indexOf(Z.af)&&this.geometries.push(Z.af),this.meshes.push(Z)):Z instanceof c.d?this.meshes.push(Z):Z instanceof j.d?this.transformNodes.push(Z):Z instanceof s.e?this.lights.push(Z):Z instanceof J.c&&this.cameras.push(Z),Z instanceof d.c){if(Z.material&&-1===this.materials.indexOf(Z.material)){this.materials.push(Z.material);for(const x of Z.material.getActiveTextures())-1===this.textures.indexOf(x)&&this.textures.push(x)}Z.skeleton&&-1===this.skeletons.indexOf(Z.skeleton)&&this.skeletons.push(Z.skeleton),Z.morphTargetManager&&-1===this.morphTargetManagers.indexOf(Z.morphTargetManager)&&this.morphTargetManagers.push(Z.morphTargetManager)}for(const u of Z.getChildren())F.has(u)||x.push(u);F.add(Z)}this.populateRootNodes()}_getByTags(Z,x,F){if(void 0===x)return Z;const u=[];for(const G in Z){const f=Z[G];p.e&&p.e.MatchesQuery(f,x)&&(!F||F(f))&&u.push(f)}return u}getMeshesByTags(Z,x){return this._getByTags(this.meshes,Z,x)}getCamerasByTags(Z,x){return this._getByTags(this.cameras,Z,x)}getLightsByTags(Z,x){return this._getByTags(this.lights,Z,x)}getMaterialsByTags(Z,x){return this._getByTags(this.materials,Z,x).concat(this._getByTags(this.multiMaterials,Z,x))}getTransformNodesByTags(Z,x){return this._getByTags(this.transformNodes,Z,x)}}var C=F(11056);class L{constructor(Z){this.byteOffset=0,this.buffer=Z}async loadAsync(Z){const x=await this.buffer.readAsync(this.byteOffset,Z);this._dataView=new DataView(x.buffer,x.byteOffset,x.byteLength),this._dataByteOffset=0}readUint32(){const Z=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,Z}readUint8Array(Z){const x=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,Z);return this._dataByteOffset+=Z,this.byteOffset+=Z,x}readString(Z){return(0,C.i)(this.readUint8Array(Z))}skipBytes(Z){this._dataByteOffset+=Z,this.byteOffset+=Z}}var H=F(12881);const S="Z2xURg",K={name:"Cf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:Z=>-1!==Z.indexOf("asset")&&-1!==Z.indexOf("version")||Z.startsWith("data:base64,"+S)||Z.startsWith("data:;base64,"+S)||Z.startsWith("data:application/octet-stream;base64,"+S)||Z.startsWith("data:model/gltf-binary;base64,"+S)};var y,q,R,B=F(11041),v=F(11050);function l(Z,x,F){try{return Promise.resolve(new Uint8Array(Z,x,F))}catch(u){return Promise.reject(u)}}!function(Z){Z[Z.AUTO=0]="AUTO",Z[Z.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(y||(y={})),function(Z){Z[Z.NONE=0]="NONE",Z[Z.FIRST=1]="FIRST",Z[Z.ALL=2]="ALL"}(q||(q={})),function(Z){Z[Z.LOADING=0]="LOADING",Z[Z.READY=1]="READY",Z[Z.COMPLETE=2]="COMPLETE"}(R||(R={}));class i{constructor(){this.coordinateSystemMode=y.AUTO,this.animationStartMode=q.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.extensionOptions={}}G(Z){Z&&(this.onParsed=Z.onParsed,this.coordinateSystemMode=Z.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=Z.animationStartMode??this.animationStartMode,this.loadNodeAnimations=Z.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=Z.loadSkins??this.loadSkins,this.loadMorphTargets=Z.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=Z.compileMaterials??this.compileMaterials,this.useClipPlane=Z.useClipPlane??this.useClipPlane,this.compileShadowGenerators=Z.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=Z.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=Z.useRangeRequests??this.useRangeRequests,this.createInstances=Z.createInstances??this.createInstances,this.alwaysComputeBoundingBox=Z.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=Z.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=Z.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=Z.skipMaterials??this.skipMaterials,this.useSRGBBuffers=Z.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=Z.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=Z.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=Z.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=Z.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=Z.customRootNode,this.onMeshLoaded=Z.onMeshLoaded,this.onSkinLoaded=Z.onSkinLoaded,this.onTextureLoaded=Z.onTextureLoaded,this.onMaterialLoaded=Z.onMaterialLoaded,this.onCameraLoaded=Z.onCameraLoaded,this.extensionOptions=Z.extensionOptions??this.extensionOptions)}}class e extends i{constructor(Z){super(),this.onParsedObservable=new u.b,this.onMeshLoadedObservable=new u.b,this.onSkinLoadedObservable=new u.b,this.onTextureLoadedObservable=new u.b,this.onMaterialLoadedObservable=new u.b,this.onCameraLoadedObservable=new u.b,this.onCompleteObservable=new u.b,this.onErrorObservable=new u.b,this.Uf=new u.b,this.onExtensionLoadedObservable=new u.b,this.validate=!1,this.onValidatedObservable=new u.b,this._loader=null,this._state=null,this._requests=new Array,this.name=K.name,this.extensions=K.extensions,this.onLoaderStateChangedObservable=new u.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.G(Z)}set onParsed(Z){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),Z&&(this._onParsedObserver=this.onParsedObservable.add(Z))}set onMeshLoaded(Z){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),Z&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(Z))}set onSkinLoaded(Z){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),Z&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((x=>Z(x.node,x.skinnedNode))))}set onTextureLoaded(Z){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),Z&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(Z))}set onMaterialLoaded(Z){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),Z&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(Z))}set onCameraLoaded(Z){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),Z&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(Z))}set onComplete(Z){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(Z)}set onError(Z){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(Z)}set onDispose(Z){this._onDisposeObserver&&this.Uf.remove(this._onDisposeObserver),this._onDisposeObserver=this.Uf.add(Z)}set onExtensionLoaded(Z){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(Z)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(Z){this._loggingEnabled!==Z&&(this._loggingEnabled=Z,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(Z){this._capturePerformanceCounters!==Z&&(this._capturePerformanceCounters=Z,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(Z){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(Z)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const Z of this._requests)Z.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=Z=>Promise.resolve(Z),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Uf.notifyObservers(void 0),this.Uf.clear()}loadFile(Z,x,F,f,Y,j,d,o){if(ArrayBuffer.isView(x))return this._loadBinary(Z,x,F,f,d,o),null;this._progressCallback=Y;const c=x.name||G.Tools.GetFilename(x);if(j){if(this.useRangeRequests){this.validate&&t.d.Warn("glTF validation is not supported when range requests are enabled");const F={abort:()=>{},onCompleteObservable:new u.b},G={readAsync:(F,u)=>new Promise(((G,f)=>{this._loadFile(Z,x,(Z=>{G(new Uint8Array(Z))}),!0,(Z=>{f(Z)}),(Z=>{Z.setRequestHeader("Range",`bytes=${F}-${F+u-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new L(G)).then((Z=>{F.onCompleteObservable.notifyObservers(F),f(Z)}),d?Z=>d(void 0,Z):void 0),F}return this._loadFile(Z,x,(x=>{this._validate(Z,new Uint8Array(x,0,x.byteLength),F,c),this._unpackBinaryAsync(new L({readAsync:(Z,F)=>l(x,Z,F),byteLength:x.byteLength})).then((Z=>{f(Z)}),d?Z=>d(void 0,Z):void 0)}),!0,d)}return this._loadFile(Z,x,(x=>{try{this._validate(Z,x,F,c),f({json:this._parseJson(x)})}catch{d&&d()}}),!1,d)}_loadBinary(Z,x,F,u,G,f){this._validate(Z,new Uint8Array(x.buffer,x.byteOffset,x.byteLength),F,f),this._unpackBinaryAsync(new L({readAsync:(Z,F)=>function(Z,x,F){try{if(x<0||x>=Z.byteLength)throw new RangeError("Offset is out of range.");if(x+F>Z.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(Z.buffer,Z.byteOffset+x,F))}catch(u){return Promise.reject(u)}}(x,Z,F),byteLength:x.byteLength})).then((Z=>{u(Z)}),G?Z=>G(void 0,Z):void 0)}importMeshAsync(Z,x,F,u,G,f){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(F),this.onParsedObservable.clear(),this._log(`Loading ${f||""}`),this._loader=this._getLoader(F),this._loader.importMeshAsync(Z,x,null,F,u,G,f))))}loadAsync(Z,x,F,u,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(x),this._loader.loadAsync(Z,x,F,u,G))))}loadAssetContainerAsync(Z,x,F,u,G){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(x);const f=new m(Z),Y=[];this.onMaterialLoadedObservable.add((Z=>{Y.push(Z)}));const j=[];this.onTextureLoadedObservable.add((Z=>{j.push(Z)}));const d=[];this.onCameraLoadedObservable.add((Z=>{d.push(Z)}));const t=[];return this.onMeshLoadedObservable.add((Z=>{Z.morphTargetManager&&t.push(Z.morphTargetManager)})),this._loader.importMeshAsync(null,Z,f,x,F,u,G).then((Z=>(Array.prototype.push.apply(f.geometries,Z.geometries),Array.prototype.push.apply(f.meshes,Z.meshes),Array.prototype.push.apply(f.Vs,Z.Vs),Array.prototype.push.apply(f.skeletons,Z.skeletons),Array.prototype.push.apply(f.animationGroups,Z.animationGroups),Array.prototype.push.apply(f.materials,Y),Array.prototype.push.apply(f.textures,j),Array.prototype.push.apply(f.lights,Z.lights),Array.prototype.push.apply(f.transformNodes,Z.transformNodes),Array.prototype.push.apply(f.cameras,d),Array.prototype.push.apply(f.morphTargetManagers,t),f)))}))}canDirectLoad(Z){return K.canDirectLoad(Z)}directLoad(Z,x){if(x.startsWith("base64,"+S)||x.startsWith(";base64,"+S)||x.startsWith("application/octet-stream;base64,"+S)||x.startsWith("model/gltf-binary;base64,"+S)){const F=(0,B.c)(x);return this._validate(Z,new Uint8Array(F,0,F.byteLength)),this._unpackBinaryAsync(new L({readAsync:(Z,x)=>l(F,Z,x),byteLength:F.byteLength}))}return this._validate(Z,x),Promise.resolve({json:this._parseJson(x)})}createPlugin(Z){return new e(Z[K.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((Z,x)=>{this.onCompleteObservable.addOnce((()=>{Z()})),this.onErrorObservable.addOnce((Z=>{x(Z)}))}))}_setState(Z){this._state!==Z&&(this._state=Z,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(R[this._state]))}_loadFile(Z,x,F,u,G,f){const Y=Z._loadFile(x,F,(Z=>{this._onProgress(Z,Y)}),!0,u,G,f);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(Z,x){if(!this._progressCallback)return;x._lengthComputable=Z.lengthComputable,x._loaded=Z.loaded,x._total=Z.total;let F=!0,u=0,G=0;for(const f of this._requests){if(void 0===f._lengthComputable||void 0===f._loaded||void 0===f._total)return;F=F&&f._lengthComputable,u+=f._loaded,G+=f._total}this._progressCallback({lengthComputable:F,loaded:u,total:F?G:0})}_validate(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),H.d.ValidateAsync(x,F,u,(x=>this.preprocessUrlAsync(F+x).then((x=>Z._loadFileAsync(x,void 0,!0,!0).then((Z=>new Uint8Array(Z,0,Z.byteLength))))))).then((Z=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(Z),this.onValidatedObservable.clear()}),(Z=>{this._endPerformanceCounter("Validate JSON"),G.Tools.Warn(`Failed to validate: ${Z.message}`),this.onValidatedObservable.clear()})))}_getLoader(Z){const x=Z.json.asset||{};this._log(`Asset version: ${x.version}`),x.minVersion&&this._log(`Asset minimum version: ${x.minVersion}`),x.generator&&this._log(`Asset generator: ${x.generator}`);const F=e._parseVersion(x.version);if(!F)throw new Error("Invalid version: "+x.version);if(void 0!==x.minVersion){const Z=e._parseVersion(x.minVersion);if(!Z)throw new Error("Invalid minimum version: "+x.minVersion);if(e._compareVersion(Z,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}const u={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[F.major];if(!u)throw new Error("Unsupported version: "+x.version);return u(this)}_parseJson(Z){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${Z.length}`);const x=JSON.parse(Z);return this._endPerformanceCounter("Parse JSON"),x}_unpackBinaryAsync(Z){return this._startPerformanceCounter("Unpack Binary"),Z.loadAsync(20).then((()=>{const x=Z.readUint32();if(1179937895!==x)throw new v.i("Unexpected magic: "+x,v.g.GLTFLoaderUnexpectedMagicError);const F=Z.readUint32();this.loggingEnabled&&this._log(`Binary version: ${F}`);const u=Z.readUint32();let G;switch(this.useRangeRequests||u===Z.buffer.byteLength||t.d.Warn(`Length in header does not match actual data length: ${u} != ${Z.buffer.byteLength}`),F){case 1:G=this._unpackBinaryV1Async(Z,u);break;case 2:G=this._unpackBinaryV2Async(Z,u);break;default:throw new Error("Unsupported version: "+F)}return this._endPerformanceCounter("Unpack Binary"),G}))}_unpackBinaryV1Async(Z,x){const F=Z.readUint32(),u=Z.readUint32();if(0!==u)throw new Error(`Unexpected content format: ${u}`);const G=x-Z.byteOffset,f={json:this._parseJson(Z.readString(F)),bin:null};if(0!==G){const x=Z.byteOffset;f.bin={readAsync:(F,u)=>Z.buffer.readAsync(x+F,u),byteLength:G}}return Promise.resolve(f)}_unpackBinaryV2Async(Z,x){const F=1313821514,u=5130562,G=Z.readUint32();if(Z.readUint32()!==F)throw new Error("First chunk format is not JSON");return Z.byteOffset+G===x?Z.loadAsync(G).then((()=>({json:this._parseJson(Z.readString(G)),bin:null}))):Z.loadAsync(G+8).then((()=>{const f={json:this._parseJson(Z.readString(G)),bin:null},Y=()=>{const G=Z.readUint32();switch(Z.readUint32()){case F:throw new Error("Unexpected JSON chunk");case u:{const x=Z.byteOffset;f.bin={readAsync:(F,u)=>Z.buffer.readAsync(x+F,u),byteLength:G},Z.skipBytes(G);break}default:Z.skipBytes(G)}return Z.byteOffset!==x?Z.loadAsync(8).then(Y):Promise.resolve(f)};return Y()}))}static _parseVersion(Z){if("1.0"===Z||"1.0.1"===Z)return{major:1,minor:0};const x=(Z+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null}static _compareVersion(Z,x){return Z.major>x.major?1:Z.major<x.major?-1:Z.minor>x.minor?1:Z.minor<x.minor?-1:0}_logOpen(Z){this._log(Z),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(Z){const x=e._logSpaces.substring(0,2*this._logIndentLevel);t.d.Log(`${x}${Z}`)}_logDisabled(Z){}_startPerformanceCounterEnabled(Z){G.Tools.StartPerformanceCounter(Z)}_startPerformanceCounterDisabled(Z){}_endPerformanceCounterEnabled(Z){G.Tools.EndPerformanceCounter(Z)}_endPerformanceCounterDisabled(Z){}}e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",(0,f.d)(new e)},12881:(Z,x,F)=>{"use strict";F.d(x,{d:()=>Y});var u=F(10994);function G(Z,x,F,u){const G={externalResourceFunction:u};return F&&(G.uri="file:"===x?F:x+F),ArrayBuffer.isView(Z)?GLTFValidator.validateBytes(Z,G):GLTFValidator.validateString(Z,G)}function f(){const Z=[];onmessage=x=>{const F=x.data;switch(F.id){case"init":importScripts(F.url);break;case"validate":G(F.data,F.rootUrl,F.fileName,(x=>new Promise(((F,u)=>{const G=Z.length;Z.push({resolve:F,reject:u}),postMessage({id:"getExternalResource",index:G,uri:x})})))).then((Z=>{postMessage({id:"validate.resolve",value:Z})}),(Z=>{postMessage({id:"validate.reject",reason:Z})}));break;case"getExternalResource.resolve":Z[F.index].resolve(F.value);break;case"getExternalResource.reject":Z[F.index].reject(F.reason)}}}class Y{static ValidateAsync(Z,x,F,Y){return"function"===typeof Worker?new Promise(((j,d)=>{const t=`${G}(${f})()`,o=URL.createObjectURL(new Blob([t],{type:"application/javascript"})),c=new Worker(o),s=Z=>{c.removeEventListener("error",s),c.removeEventListener("message",J),d(Z)},J=Z=>{const x=Z.data;switch(x.id){case"getExternalResource":Y(x.uri).then((Z=>{c.postMessage({id:"getExternalResource.resolve",index:x.index,value:Z},[Z.buffer])}),(Z=>{c.postMessage({id:"getExternalResource.reject",index:x.index,reason:Z})}));break;case"validate.resolve":c.removeEventListener("error",s),c.removeEventListener("message",J),j(x.value),c.terminate();break;case"validate.reject":c.removeEventListener("error",s),c.removeEventListener("message",J),d(x.reason),c.terminate()}};if(c.addEventListener("error",s),c.addEventListener("message",J),c.postMessage({id:"init",url:u.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(Z)){const u=Z.slice();c.postMessage({id:"validate",data:u,rootUrl:x,fileName:F},[u.buffer])}else c.postMessage({id:"validate",data:Z,rootUrl:x,fileName:F})})):(this._LoadScriptPromise||(this._LoadScriptPromise=u.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>G(Z,x,F,Y))))}}Y.Configuration={url:`${u.Tools._DefaultCdnUrl}/gltf_validator.js`}},13433:(Z,x,F)=>{"use strict";F.d(x,{e:()=>K});var u=F(11159),G=F(11165),f=F(11213),Y=F(11179),j=F(11592),d=F(11520),t=F(11265),o=F(11447),c=F(11136),s=F(11091);F(12651),F(12542),F(12558),F(12550),F(12566),F(12574),F(12582);const J="imageProcessingCompatibility",p="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";s.d.IncludesShadersStore[J]||(s.d.IncludesShadersStore[J]=p);const U="skyPixelShader",k="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";s.d.ShadersStore[U]||(s.d.ShadersStore[U]=k);F(12663),F(12589),F(12598),F(12609),F(12607);const M="skyVertexShader",m="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";s.d.ShadersStore[M]||(s.d.ShadersStore[M]=m);var C=F(11512),L=F(11572),H=F(11570);class S extends j.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class K extends d.b{constructor(Z,x){super(Z,x),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.kx(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.kx.Zero(),this.up=Y.kx.Up(),this.dithering=!1,this._cameraPosition=Y.kx.Zero(),this._skyOrientation=new Y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(Z,x){const F=x._drawWrapper;if(this.isFrozen&&F.effect&&F._wasPreviouslyReady)return!0;x.materialDefines||(x.materialDefines=new S);const u=x.materialDefines,G=this.KZ();if(this._isReadyForSubMesh(x))return!0;if((0,H.Y)(Z,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,u),(0,H.K)(Z,u,!0,!1),u.IMAGEPROCESSINGPOSTPROCESS!==G.imageProcessingConfiguration.applyByPostProcess&&u.markAsMiscDirty(),u.DITHER!==this.dithering&&u.markAsMiscDirty(),u.isDirty){u.markAsProcessed(),G.resetCachedMaterial();const Z=new C.d;u.FOG&&Z.addFallback(1,"FOG"),u.IMAGEPROCESSINGPOSTPROCESS=G.imageProcessingConfiguration.applyByPostProcess,u.DITHER=this.dithering;const F=[t.f.PositionKind];u.VERTEXCOLOR&&F.push(t.f.ColorKind);const f="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,L.b)(Y);const j=u.toString();x.setEffect(G.getEngine().createEffect(f,F,Y,[],j,Z,this.onCompiled,this.onError),u,this._materialContext)}return!(!x.effect||!x.effect.isReady())&&(u._renderId=G.getRenderId(),F._wasPreviouslyReady=!0,!0)}bindForSubMesh(Z,x,F){const u=this.KZ(),G=F.materialDefines;if(!G)return;const f=F.effect;if(!f)return;this._activeEffect=f,this.bindOnlyWorldMatrix(Z),this._activeEffect.setMatrix("viewProjection",u.getTransformMatrix()),this._mustRebind(u,f,F)&&((0,L.f)(f,this,u),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,H.l)(G,f,u)),u.fogEnabled&&x.applyFog&&u.fogMode!==o.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",u.getViewMatrix()),(0,H.f)(u,x,this._activeEffect);const j=u.activeCamera;if(j){const Z=j.getWorldMatrix();this._cameraPosition.x=Z.m[12],this._cameraPosition.y=Z.m[13],this._cameraPosition.z=Z.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const Z=Math.PI*(this.inclination-.5),x=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(x)*Math.cos(Z),this.sunPosition.y=this.distance*Math.sin(-Z),this.sunPosition.z=this.distance*Math.sin(x)*Math.cos(Z),Y.Quaternion.FromUnitVectorsToRef(Y.kx.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(x,this._activeEffect,F)}getAnimatables(){return[]}dispose(Z){super.dispose(Z)}clone(Z){return f.c.Clone((()=>new K(Z,this.KZ())),this)}serialize(){const Z=super.serialize();return Z.customType="BABYLON.SkyMaterial",Z}getClassName(){return"SkyMaterial"}static Parse(Z,x,F){return f.c.Parse((()=>new K(Z.name,x)),Z,x,F)}}(0,u.d)([(0,G.H)()],K.prototype,"luminance",void 0),(0,u.d)([(0,G.H)()],K.prototype,"turbidity",void 0),(0,u.d)([(0,G.H)()],K.prototype,"rayleigh",void 0),(0,u.d)([(0,G.H)()],K.prototype,"mieCoefficient",void 0),(0,u.d)([(0,G.H)()],K.prototype,"mieDirectionalG",void 0),(0,u.d)([(0,G.H)()],K.prototype,"distance",void 0),(0,u.d)([(0,G.H)()],K.prototype,"inclination",void 0),(0,u.d)([(0,G.H)()],K.prototype,"azimuth",void 0),(0,u.d)([(0,G.D)()],K.prototype,"sunPosition",void 0),(0,u.d)([(0,G.H)()],K.prototype,"useSunPosition",void 0),(0,u.d)([(0,G.D)()],K.prototype,"cameraOffset",void 0),(0,u.d)([(0,G.D)()],K.prototype,"up",void 0),(0,u.d)([(0,G.H)()],K.prototype,"dithering",void 0),(0,c.g)("BABYLON.SkyMaterial",K)},11847:(Z,x,F)=>{"use strict";function u(Z,x){x.headers=Z.headers||{},x.statusMessage=Z.statusText,x.statusCode=Z.status,x.data=Z.response}function G(Z,x,F){return new Promise((function(G,f){F=F||{};var Y,j,d,t=new XMLHttpRequest,o=F.body,c=F.headers||{};for(Y in F.timeout&&(t.timeout=F.timeout),t.ontimeout=t.onerror=function(Z){Z.timeout="timeout"==Z.type,f(Z)},t.open(Z,x.href||x),t.onload=function(){for(d=t.getAllResponseHeaders().trim().split(/[\r\n]+/),u(t,t);j=d.shift();)j=j.split(": "),t.headers[j.shift().toLowerCase()]=j.join(": ");if((j=t.headers["content-type"])&&~j.indexOf("application/json"))try{t.data=JSON.parse(t.data,F.reviver)}catch(Z){return u(t,Z),f(Z)}(t.status>=400?f:G)(t)},typeof FormData<"u"&&o instanceof FormData||o&&"object"==typeof o&&(c["content-type"]="application/json",o=JSON.stringify(o)),t.withCredentials=!!F.withCredentials,c)t.setRequestHeader(Y,c[Y]);t.send(o)}))}F.r(x),F.d(x,{del:()=>d,get:()=>f,patch:()=>j,post:()=>Y,put:()=>t,send:()=>G});var f=G.bind(G,"GET"),Y=G.bind(G,"POST"),j=G.bind(G,"PATCH"),d=G.bind(G,"DELETE"),t=G.bind(G,"PUT")},13533:(Z,x,F)=>{"use strict";F.d(x,{c:()=>c});const u=.5*(Math.sqrt(3)-1),G=(3-Math.sqrt(3))/6,f=1/3,Y=1/6,j=(Math.sqrt(5)-1)/4,d=(5-Math.sqrt(5))/20,t=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),o=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const c=class{constructor(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const x="function"==typeof Z?Z:function(Z){let x=0,F=0,u=0,G=1;const f=function(){let Z=4022871197;return function(x){x=x.toString();for(let F=0;F<x.length;F++){Z+=x.charCodeAt(F);let u=.02519603282416938*Z;Z=u>>>0,u-=Z,u*=Z,Z=u>>>0,u-=Z,Z+=4294967296*u}return 2.3283064365386963e-10*(Z>>>0)}}();x=f(" "),F=f(" "),u=f(" "),x-=f(Z),x<0&&(x+=1);F-=f(Z),F<0&&(F+=1);u-=f(Z),u<0&&(u+=1);return function(){const Z=2091639*x+2.3283064365386963e-10*G;return x=F,F=u,u=Z-(G=0|Z)}}(Z);this.p=function(Z){const x=new Uint8Array(256);for(let F=0;F<256;F++)x[F]=F;for(let F=0;F<255;F++){const u=F+~~(Z()*(256-F)),G=x[F];x[F]=x[u],x[u]=G}return x}(x),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let F=0;F<512;F++)this.perm[F]=this.p[255&F],this.permMod12[F]=this.perm[F]%12}noise2D(Z,x){const F=this.permMod12,f=this.perm;let Y=0,j=0,d=0;const o=(Z+x)*u,c=Math.floor(Z+o),s=Math.floor(x+o),J=(c+s)*G,p=Z-(c-J),U=x-(s-J);let k,M;p>U?(k=1,M=0):(k=0,M=1);const m=p-k+G,C=U-M+G,L=p-1+2*G,H=U-1+2*G,S=255&c,K=255&s;let y=.5-p*p-U*U;if(y>=0){const Z=3*F[S+f[K]];y*=y,Y=y*y*(t[Z]*p+t[Z+1]*U)}let q=.5-m*m-C*C;if(q>=0){const Z=3*F[S+k+f[K+M]];q*=q,j=q*q*(t[Z]*m+t[Z+1]*C)}let R=.5-L*L-H*H;if(R>=0){const Z=3*F[S+1+f[K+1]];R*=R,d=R*R*(t[Z]*L+t[Z+1]*H)}return 70*(Y+j+d)}noise3D(Z,x,F){const u=this.permMod12,G=this.perm;let j,d,o,c;const s=(Z+x+F)*f,J=Math.floor(Z+s),p=Math.floor(x+s),U=Math.floor(F+s),k=(J+p+U)*Y,M=Z-(J-k),m=x-(p-k),C=F-(U-k);let L,H,S,K,y,q;M>=m?m>=C?(L=1,H=0,S=0,K=1,y=1,q=0):M>=C?(L=1,H=0,S=0,K=1,y=0,q=1):(L=0,H=0,S=1,K=1,y=0,q=1):m<C?(L=0,H=0,S=1,K=0,y=1,q=1):M<C?(L=0,H=1,S=0,K=0,y=1,q=1):(L=0,H=1,S=0,K=1,y=1,q=0);const R=M-L+Y,B=m-H+Y,v=C-S+Y,l=M-K+2*Y,i=m-y+2*Y,e=C-q+2*Y,b=M-1+.5,E=m-1+.5,w=C-1+.5,T=255&J,N=255&p,W=255&U;let A=.6-M*M-m*m-C*C;if(A<0)j=0;else{const Z=3*u[T+G[N+G[W]]];A*=A,j=A*A*(t[Z]*M+t[Z+1]*m+t[Z+2]*C)}let h=.6-R*R-B*B-v*v;if(h<0)d=0;else{const Z=3*u[T+L+G[N+H+G[W+S]]];h*=h,d=h*h*(t[Z]*R+t[Z+1]*B+t[Z+2]*v)}let X=.6-l*l-i*i-e*e;if(X<0)o=0;else{const Z=3*u[T+K+G[N+y+G[W+q]]];X*=X,o=X*X*(t[Z]*l+t[Z+1]*i+t[Z+2]*e)}let D=.6-b*b-E*E-w*w;if(D<0)c=0;else{const Z=3*u[T+1+G[N+1+G[W+1]]];D*=D,c=D*D*(t[Z]*b+t[Z+1]*E+t[Z+2]*w)}return 32*(j+d+o+c)}noise4D(Z,x,F,u){const G=this.perm;let f,Y,t,c,s;const J=(Z+x+F+u)*j,p=Math.floor(Z+J),U=Math.floor(x+J),k=Math.floor(F+J),M=Math.floor(u+J),m=(p+U+k+M)*d,C=Z-(p-m),L=x-(U-m),H=F-(k-m),S=u-(M-m);let K=0,y=0,q=0,R=0;C>L?K++:y++,C>H?K++:q++,C>S?K++:R++,L>H?y++:q++,L>S?y++:R++,H>S?q++:R++;const B=K>=3?1:0,v=y>=3?1:0,l=q>=3?1:0,i=R>=3?1:0,e=K>=2?1:0,b=y>=2?1:0,E=q>=2?1:0,w=R>=2?1:0,T=K>=1?1:0,N=y>=1?1:0,W=q>=1?1:0,A=R>=1?1:0,h=C-B+d,X=L-v+d,D=H-l+d,Q=S-i+d,g=C-e+2*d,O=L-b+2*d,n=H-E+2*d,V=S-w+2*d,a=C-T+3*d,I=L-N+3*d,r=H-W+3*d,z=S-A+3*d,P=C-1+4*d,ZZ=L-1+4*d,xZ=H-1+4*d,FZ=S-1+4*d,uZ=255&p,GZ=255&U,fZ=255&k,YZ=255&M;let jZ=.6-C*C-L*L-H*H-S*S;if(jZ<0)f=0;else{const Z=G[uZ+G[GZ+G[fZ+G[YZ]]]]%32*4;jZ*=jZ,f=jZ*jZ*(o[Z]*C+o[Z+1]*L+o[Z+2]*H+o[Z+3]*S)}let dZ=.6-h*h-X*X-D*D-Q*Q;if(dZ<0)Y=0;else{const Z=G[uZ+B+G[GZ+v+G[fZ+l+G[YZ+i]]]]%32*4;dZ*=dZ,Y=dZ*dZ*(o[Z]*h+o[Z+1]*X+o[Z+2]*D+o[Z+3]*Q)}let tZ=.6-g*g-O*O-n*n-V*V;if(tZ<0)t=0;else{const Z=G[uZ+e+G[GZ+b+G[fZ+E+G[YZ+w]]]]%32*4;tZ*=tZ,t=tZ*tZ*(o[Z]*g+o[Z+1]*O+o[Z+2]*n+o[Z+3]*V)}let oZ=.6-a*a-I*I-r*r-z*z;if(oZ<0)c=0;else{const Z=G[uZ+T+G[GZ+N+G[fZ+W+G[YZ+A]]]]%32*4;oZ*=oZ,c=oZ*oZ*(o[Z]*a+o[Z+1]*I+o[Z+2]*r+o[Z+3]*z)}let cZ=.6-P*P-ZZ*ZZ-xZ*xZ-FZ*FZ;if(cZ<0)s=0;else{const Z=G[uZ+1+G[GZ+1+G[fZ+1+G[YZ+1]]]]%32*4;cZ*=cZ,s=cZ*cZ*(o[Z]*P+o[Z+1]*ZZ+o[Z+2]*xZ+o[Z+3]*FZ)}return 27*(f+Y+t+c+s)}}}}]);