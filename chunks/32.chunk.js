/*! For license information please see ljhqg.32.d85cc628.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13101:(q,S,b)=>{"use strict";var z=b(13105),C=b(13107),v=b(13114);b.g.__TYPEDARRAY_POOL||(b.g.__TYPEDARRAY_POOL={UINT8:C([32,0]),UINT16:C([32,0]),UINT32:C([32,0]),INT8:C([32,0]),INT16:C([32,0]),INT32:C([32,0]),FLOAT:C([32,0]),DOUBLE:C([32,0]),DATA:C([32,0]),UINT8C:C([32,0]),BUFFER:C([32,0])});var U="undefined"!==typeof Uint8ClampedArray,g=b.g.__TYPEDARRAY_POOL;g.UINT8C||(g.UINT8C=C([32,0])),g.BUFFER||(g.BUFFER=C([32,0]));var r=g.DATA,I=g.BUFFER;function V(q){if(q){var S=q.length||q.byteLength,b=z.log2(S);r[b].push(q)}}function l(q){q=z.nextPow2(q);var S=z.log2(q),b=r[S];return b.length>0?b.pop():new ArrayBuffer(q)}function y(q){return new Uint8Array(l(q),0,q)}function R(q){return new Uint16Array(l(2*q),0,q)}function G(q){return new Uint32Array(l(4*q),0,q)}function Z(q){return new Int8Array(l(q),0,q)}function H(q){return new Int16Array(l(2*q),0,q)}function Q(q){return new Int32Array(l(4*q),0,q)}function k(q){return new Float32Array(l(4*q),0,q)}function W(q){return new Float64Array(l(8*q),0,q)}function N(q){return U?new Uint8ClampedArray(l(q),0,q):y(q)}function u(q){return new DataView(l(q),0,q)}S.free=function(q){if(v(q))I[z.log2(q.length)].push(q);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(q)&&(q=q.buffer),!q)return;var S=q.length||q.byteLength,b=0|z.log2(S);r[b].push(q)}},S.freeUint8=S.freeUint16=S.freeUint32=S.freeInt8=S.freeInt16=S.freeInt32=S.freeFloat32=S.freeFloat=S.freeFloat64=S.freeDouble=S.freeUint8Clamped=S.freeDataView=function(q){V(q.buffer)},S.freeArrayBuffer=V,S.freeBuffer=function(q){I[z.log2(q.length)].push(q)},S.malloc=function(q,S){if(void 0===S||"arraybuffer"===S)return l(q);switch(S){case"uint8":return y(q);case"uint16":return R(q);case"uint32":return G(q);case"int8":return Z(q);case"int16":return H(q);case"int32":return Q(q);case"float":case"float32":return k(q);case"double":case"float64":return W(q);case"uint8_clamped":return N(q);case"buffer":throw"Buffer not supported";case"data":case"dataview":return u(q);default:return null}return null},S.mallocArrayBuffer=l,S.mallocUint8=y,S.mallocUint16=R,S.mallocUint32=G,S.mallocInt8=Z,S.mallocInt16=H,S.mallocInt32=Q,S.mallocFloat32=S.mallocFloat=k,S.mallocFloat64=S.mallocDouble=W,S.mallocUint8Clamped=N,S.mallocDataView=u,S.clearCache=function(){for(var q=0;q<32;++q)g.UINT8[q].length=0,g.UINT16[q].length=0,g.UINT32[q].length=0,g.INT8[q].length=0,g.INT16[q].length=0,g.INT32[q].length=0,g.FLOAT[q].length=0,g.DOUBLE[q].length=0,g.UINT8C[q].length=0,r[q].length=0,I[q].length=0}},13173:(q,S,b)=>{q.exports=C;var z=b(11915);function C(q,S){if(!(this instanceof C))return new C(q,S);var b=z.create();z.add(b,q,S),this.base=z.min(z.create(),q,b),this.ZV=z.clone(S),this.max=z.max(z.create(),q,b),this.mag=z.length(this.ZV)}var v=C.prototype;v.width=function(){return this.ZV[0]},v.height=function(){return this.ZV[1]},v.depth=function(){return this.ZV[2]},v.x0=function(){return this.base[0]},v.y0=function(){return this.base[1]},v.z0=function(){return this.base[2]},v.x1=function(){return this.max[0]},v.y1=function(){return this.max[1]},v.z1=function(){return this.max[2]},v.translate=function(q){return z.add(this.max,this.max,q),z.add(this.base,this.base,q),this},v.setPosition=function(q){return z.add(this.max,q,this.ZV),z.i(this.base,q),this},v.expand=function(q){var S=z.create(),b=z.create();return z.max(S,q.max,this.max),z.min(b,q.base,this.base),z.RS(S,S,b),new C(b,S)},v.intersects=function(q){return!(q.base[0]>this.max[0])&&(!(q.base[1]>this.max[1])&&(!(q.base[2]>this.max[2])&&(!(q.max[0]<this.base[0])&&(!(q.max[1]<this.base[1])&&!(q.max[2]<this.base[2])))))},v.touches=function(q){var S=this.union(q);return null!==S&&(0==S.width()||0==S.height()||0==S.depth())},v.union=function(q){if(!this.intersects(q))return null;var S=Math.max(q.base[0],this.base[0]),b=Math.max(q.base[1],this.base[1]),z=Math.max(q.base[2],this.base[2]);return new C([S,b,z],[Math.min(q.max[0],this.max[0])-S,Math.min(q.max[1],this.max[1])-b,Math.min(q.max[2],this.max[2])-z])}},13105:(q,S)=>{"use strict";function b(q){var S=32;return(q&=-q)&&S--,65535&q&&(S-=16),16711935&q&&(S-=8),252645135&q&&(S-=4),858993459&q&&(S-=2),1431655765&q&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(q){return(q>0)-(q<0)},S.abs=function(q){var S=q>>31;return(q^S)-S},S.min=function(q,S){return S^(q^S)&-(q<S)},S.max=function(q,S){return q^(q^S)&-(q<S)},S.isPow2=function(q){return!(q&q-1)&&!!q},S.log2=function(q){var S,b;return S=(q>65535)<<4,S|=b=((q>>>=S)>255)<<3,S|=b=((q>>>=b)>15)<<2,(S|=b=((q>>>=b)>3)<<1)|(q>>>=b)>>1},S.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},S.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},S.countTrailingZeros=b,S.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},S.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},S.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var z=new Array(256);!function(q){for(var S=0;S<256;++S){var b=S,z=S,C=7;for(b>>>=1;b;b>>>=1)z<<=1,z|=1&b,--C;q[S]=z<<C&255}}(z),S.reverse=function(q){return z[255&q]<<24|z[q>>>8&255]<<16|z[q>>>16&255]<<8|z[q>>>24&255]},S.interleave2=function(q,S){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(q,S){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>S&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},S.interleave3=function(q,S,b){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},S.deinterleave3=function(q,S){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>S&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},S.nextCombination=function(q){var S=q|q-1;return S+1|(~S&-~S)-1>>>b(q)+1}},13094:(q,S,b)=>{"use strict";q.exports=function(q,S,b){switch(arguments.length){case 1:return z=[],I(C=q,C,V,!0),z;case 2:return"function"===typeof S?I(q,q,S,!0):function(q,S){return z=[],I(q,S,V,!1),z}(q,S);case 3:return I(q,S,b,!1);default:throw new Error("box-intersect: Invalid arguments")}var C};var z,C=b(13101),v=b(13121),U=b(13126);function g(q,S){for(var b=0;b<q;++b)if(!(S[b]<=S[b+q]))return!0;return!1}function r(q,S,b,z){for(var C=0,v=0,U=0,r=q.length;U<r;++U){var I=q[U];if(!g(S,I)){for(var V=0;V<2*S;++V)b[C++]=I[V];z[v++]=U}}return v}function I(q,S,b,z){var g=q.length,I=S.length;if(!(g<=0||I<=0)){var V=q[0].length>>>1;if(!(V<=0)){var l,y=C.mallocDouble(2*V*g),R=C.mallocInt32(g);if((g=r(q,V,y,R))>0){if(1===V&&z)v.init(g),l=v.sweepComplete(V,b,0,g,y,R,0,g,y,R);else{var G=C.mallocDouble(2*V*I),Z=C.mallocInt32(I);(I=r(S,V,G,Z))>0&&(v.init(g+I),l=1===V?v.sweepBipartite(V,b,0,g,y,R,0,I,G,Z):U(V,b,z,g,y,R,I,G,Z),C.free(G),C.free(Z))}C.free(y),C.free(R)}return l}}}function V(q,S){z.push([q,S])}},13128:(q,S)=>{"use strict";var b="d",z="ax",C="fp",v="es",U="rs",g="re",r="rb",I="bs",V="be",l="bb",y=[b,z,"vv",U,g,r,"ri",I,V,l,"bi"];function R(q){var S="bruteForce"+(q?"Full":"Partial"),z=[],U=y.slice();q||U.splice(3,0,C);var g=["function "+S+"("+U.join()+"){"];function r(S,C){var U=function(q,S,z){var C="bruteForce"+(q?"Red":"Blue")+(S?"Flip":"")+(z?"Full":""),U=["function ",C,"(",y.join(),"){","var ",v,"=2*",b,";"],g="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",r="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return q?U.push(g,"Q",":",r):U.push(r,"Q",":",g),z?U.push("if(y1<x0||x1<y0)continue;"):S?U.push("if(y0<=x0||x1<y0)continue;"):U.push("if(y0<x0||x1<y0)continue;"),U.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),S?U.push("yi,xi"):U.push("xi,yi"),U.push(");if(rv!==void 0)return rv;}}}"),{name:C,code:U.join("")}}(S,C,q);z.push(U.code),g.push("return "+U.name+"("+y.join()+");")}g.push("if(re-rs>be-bs){"),q?(r(!0,!1),g.push("}else{"),r(!1,!1)):(g.push("if(fp){"),r(!0,!0),g.push("}else{"),r(!0,!1),g.push("}}else{if(fp){"),r(!1,!0),g.push("}else{"),r(!1,!1),g.push("}")),g.push("}}return "+S);var I=z.join("")+g.join("");return new Function(I)()}S.partial=R(!1),S.full=R(!0)},13126:(q,S,b)=>{"use strict";q.exports=function(q,S,b,v,V,m,E,e,i){!function(q,S){var b=8*C.log2(S+1)*(q+1)|0,v=C.nextPow2(N*b);X.length<v&&(z.free(X),X=z.mallocInt32(v));var U=C.nextPow2(u*b);T.length<U&&(z.free(T),T=z.mallocDouble(U))}(q,v+E);var J,L=0,d=2*q;B(L++,0,0,v,0,E,b?16:0,-1/0,1/0),b||B(L++,0,0,E,0,v,1,-1/0,1/0);for(;L>0;){var K=(L-=1)*N,D=X[K],x=X[K+1],F=X[K+2],a=X[K+3],n=X[K+4],o=X[K+5],s=L*u,A=T[s],w=T[s+1],P=1&o,h=!!(16&o),O=V,j=m,M=e,p=i;if(P&&(O=e,j=i,M=V,p=m),!(2&o&&x>=(F=H(q,D,x,F,O,j,w)))&&!(4&o&&(x=Q(q,D,x,F,O,j,A))>=F)){var Y=F-x,c=n-a;if(h){if(q*Y*(Y+c)<R){if(void 0!==(J=r.scanComplete(q,D,S,x,F,O,j,a,n,M,p)))return J;continue}}else{if(q*Math.min(Y,c)<l){if(void 0!==(J=U(q,D,S,P,x,F,O,j,a,n,M,p)))return J;continue}if(q*Y*c<y){if(void 0!==(J=r.scanBipartite(q,D,S,P,x,F,O,j,a,n,M,p)))return J;continue}}var qq=G(q,D,x,F,O,j,A,w);if(x<qq)if(q*(qq-x)<l){if(void 0!==(J=g(q,D+1,S,x,qq,O,j,a,n,M,p)))return J}else if(D===q-2){if(void 0!==(J=P?r.sweepBipartite(q,S,a,n,M,p,x,qq,O,j):r.sweepBipartite(q,S,x,qq,O,j,a,n,M,p)))return J}else B(L++,D+1,x,qq,a,n,P,-1/0,1/0),B(L++,D+1,a,n,x,qq,1^P,-1/0,1/0);if(qq<F){var Sq=I(q,D,a,n,M,p),bq=M[d*Sq+D],zq=Z(q,D,Sq,n,M,p,bq);if(zq<n&&B(L++,D,qq,F,zq,n,(4|P)+(h?16:0),bq,w),a<Sq&&B(L++,D,qq,F,a,Sq,(2|P)+(h?16:0),A,bq),Sq+1===zq){if(void 0!==(J=h?f(q,D,S,qq,F,O,j,Sq,M,p[Sq]):t(q,D,S,P,qq,F,O,j,Sq,M,p[Sq])))return J}else if(Sq<zq){var Cq;if(h){if(qq<(Cq=k(q,D,qq,F,O,j,bq))){var vq=Z(q,D,qq,Cq,O,j,bq);if(D===q-2){if(qq<vq&&void 0!==(J=r.sweepComplete(q,S,qq,vq,O,j,Sq,zq,M,p)))return J;if(vq<Cq&&void 0!==(J=r.sweepBipartite(q,S,vq,Cq,O,j,Sq,zq,M,p)))return J}else qq<vq&&B(L++,D+1,qq,vq,Sq,zq,16,-1/0,1/0),vq<Cq&&(B(L++,D+1,vq,Cq,Sq,zq,0,-1/0,1/0),B(L++,D+1,Sq,zq,vq,Cq,1,-1/0,1/0))}}else qq<(Cq=P?W(q,D,qq,F,O,j,bq):k(q,D,qq,F,O,j,bq))&&(D===q-2?J=P?r.sweepBipartite(q,S,Sq,zq,M,p,qq,Cq,O,j):r.sweepBipartite(q,S,qq,Cq,O,j,Sq,zq,M,p):(B(L++,D+1,qq,Cq,Sq,zq,P,-1/0,1/0),B(L++,D+1,Sq,zq,qq,Cq,1^P,-1/0,1/0)))}}}}};var z=b(13101),C=b(13105),v=b(13128),U=v.partial,g=v.full,r=b(13121),I=b(13132),V=b(13141),l=128,y=1<<22,R=1<<22,G=V("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Z=V("lo===p0",["p0"]),H=V("lo<p0",["p0"]),Q=V("hi<=p0",["p0"]),k=V("lo<=p0&&p0<=hi",["p0"]),W=V("lo<p0&&p0<=hi",["p0"]),N=6,u=2,X=z.mallocInt32(1024),T=z.mallocDouble(1024);function B(q,S,b,z,C,v,U,g,r){var I=N*q;X[I]=S,X[I+1]=b,X[I+2]=z,X[I+3]=C,X[I+4]=v,X[I+5]=U;var V=u*q;T[V]=g,T[V+1]=r}function t(q,S,b,z,C,v,U,g,r,I,V){var l=2*q,y=r*l,R=I[y+S];q:for(var G=C,Z=C*l;G<v;++G,Z+=l){var H=U[Z+S],Q=U[Z+S+q];if(!(R<H||Q<R)&&(!z||R!==H)){for(var k,W=g[G],N=S+1;N<q;++N){H=U[Z+N],Q=U[Z+N+q];var u=I[y+N],X=I[y+N+q];if(Q<u||X<H)continue q}if(void 0!==(k=z?b(V,W):b(W,V)))return k}}}function f(q,S,b,z,C,v,U,g,r,I){var V=2*q,l=g*V,y=r[l+S];q:for(var R=z,G=z*V;R<C;++R,G+=V){var Z=U[R];if(Z!==I){var H=v[G+S],Q=v[G+S+q];if(!(y<H||Q<y)){for(var k=S+1;k<q;++k){H=v[G+k],Q=v[G+k+q];var W=r[l+k],N=r[l+k+q];if(Q<W||N<H)continue q}var u=b(Z,I);if(void 0!==u)return u}}}}},13132:(q,S,b)=>{"use strict";q.exports=function(q,S,b,U,g,r){if(U<=b+1)return b;var I=b,V=U,l=U+b>>>1,y=2*q,R=l,G=g[y*l+S];for(;I<V;){if(V-I<C){v(q,S,I,V,g,r),G=g[y*l+S];break}var Z=V-I,H=Math.random()*Z+I|0,Q=g[y*H+S],k=Math.random()*Z+I|0,W=g[y*k+S],N=Math.random()*Z+I|0,u=g[y*N+S];Q<=W?u>=W?(R=k,G=W):Q>=u?(R=H,G=Q):(R=N,G=u):W>=u?(R=k,G=W):u>=Q?(R=H,G=Q):(R=N,G=u);for(var X=y*(V-1),T=y*R,B=0;B<y;++B,++X,++T){var t=g[X];g[X]=g[T],g[T]=t}var f=r[V-1];r[V-1]=r[R],r[R]=f;for(X=y*(V-1),T=y*(R=z(q,S,I,V-1,g,r,G)),B=0;B<y;++B,++X,++T){t=g[X];g[X]=g[T],g[T]=t}f=r[V-1];if(r[V-1]=r[R],r[R]=f,l<R){for(V=R-1;I<V&&g[y*(V-1)+S]===G;)V-=1;V+=1}else{if(!(R<l))break;for(I=R+1;I<V&&g[y*I+S]===G;)I+=1}}return z(q,S,b,l,g,r,g[y*l+S])};var z=b(13141)("lo<p0",["p0"]),C=8;function v(q,S,b,z,C,v){for(var U=2*q,g=U*(b+1)+S,r=b+1;r<z;++r,g+=U)for(var I=C[g],V=r,l=U*(r-1);V>b&&C[l+S]>I;--V,l-=U){for(var y=l,R=l+U,G=0;G<U;++G,++y,++R){var Z=C[y];C[y]=C[R],C[R]=Z}var H=v[V];v[V]=v[V-1],v[V-1]=H}}},13141:q=>{"use strict";q.exports=function(q,b){var z="abcdef".split("").concat(b),C=[];q.indexOf("lo")>=0&&C.push("lo=e[k+n]");q.indexOf("hi")>=0&&C.push("hi=e[k+o]");return z.push(S.replace("_",C.join()).replace("$",q)),Function.apply(void 0,z)};var S="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13124:q=>{"use strict";q.exports=function(q,z){z<=4*S?b(0,z-1,q):I(0,z-1,q)};var S=32;function b(q,S,b){for(var z=2*(q+1),C=q+1;C<=S;++C){for(var v=b[z++],U=b[z++],g=C,r=z-2;g-- >q;){var I=b[r-2],V=b[r-1];if(I<v)break;if(I===v&&V<U)break;b[r]=I,b[r+1]=V,r-=2}b[r]=v,b[r+1]=U}}function z(q,S,b){S*=2;var z=b[q*=2],C=b[q+1];b[q]=b[S],b[q+1]=b[S+1],b[S]=z,b[S+1]=C}function C(q,S,b){S*=2,b[q*=2]=b[S],b[q+1]=b[S+1]}function v(q,S,b,z){S*=2,b*=2;var C=z[q*=2],v=z[q+1];z[q]=z[S],z[q+1]=z[S+1],z[S]=z[b],z[S+1]=z[b+1],z[b]=C,z[b+1]=v}function U(q,S,b,z,C){S*=2,C[q*=2]=C[S],C[S]=b,C[q+1]=C[S+1],C[S+1]=z}function g(q,S,b){S*=2;var z=b[q*=2],C=b[S];return!(z<C)&&(z!==C||b[q+1]>b[S+1])}function r(q,S,b,z){var C=z[q*=2];return C<S||C===S&&z[q+1]<b}function I(q,V,l){var y=(V-q+1)/6|0,R=q+y,G=V-y,Z=q+V>>1,H=Z-y,Q=Z+y,k=R,W=H,N=Z,u=Q,X=G,T=q+1,B=V-1,t=0;g(k,W,l)&&(t=k,k=W,W=t),g(u,X,l)&&(t=u,u=X,X=t),g(k,N,l)&&(t=k,k=N,N=t),g(W,N,l)&&(t=W,W=N,N=t),g(k,u,l)&&(t=k,k=u,u=t),g(N,u,l)&&(t=N,N=u,u=t),g(W,X,l)&&(t=W,W=X,X=t),g(W,N,l)&&(t=W,W=N,N=t),g(u,X,l)&&(t=u,u=X,X=t);for(var f=l[2*W],m=l[2*W+1],E=l[2*u],e=l[2*u+1],i=2*k,J=2*N,L=2*X,d=2*R,K=2*Z,D=2*G,x=0;x<2;++x){var F=l[i+x],a=l[J+x],n=l[L+x];l[d+x]=F,l[K+x]=a,l[D+x]=n}C(H,q,l),C(Q,V,l);for(var o=T;o<=B;++o)if(r(o,f,m,l))o!==T&&z(o,T,l),++T;else if(!r(o,E,e,l))for(;;){if(r(B,E,e,l)){r(B,f,m,l)?(v(o,T,B,l),++T,--B):(z(o,B,l),--B);break}if(--B<o)break}U(q,T-1,f,m,l),U(V,B+1,E,e,l),T-2-q<=S?b(q,T-2,l):I(q,T-2,l),V-(B+2)<=S?b(B+2,V,l):I(B+2,V,l),B-T<=S?b(T,B,l):I(T,B,l)}},13121:(q,S,b)=>{"use strict";q.exports={init:function(q){var S=C.nextPow2(q);r.length<S&&(z.free(r),r=z.mallocInt32(S));I.length<S&&(z.free(I),I=z.mallocInt32(S));V.length<S&&(z.free(V),V=z.mallocInt32(S));l.length<S&&(z.free(l),l=z.mallocInt32(S));y.length<S&&(z.free(y),y=z.mallocInt32(S));R.length<S&&(z.free(R),R=z.mallocInt32(S));var b=8*S;G.length<b&&(z.free(G),G=z.mallocDouble(b))},sweepBipartite:function(q,S,b,z,C,g,y,R,Q,k){for(var W=0,N=2*q,u=q-1,X=N-1,T=b;T<z;++T){var B=g[T],t=N*T;G[W++]=C[t+u],G[W++]=-(B+1),G[W++]=C[t+X],G[W++]=B}for(T=y;T<R;++T){B=k[T]+U;var f=N*T;G[W++]=Q[f+u],G[W++]=-B,G[W++]=Q[f+X],G[W++]=B}var m=W>>>1;v(G,m);var E=0,e=0;for(T=0;T<m;++T){var i=0|G[2*T+1];if(i>=U)Z(V,l,e--,i=i-U|0);else if(i>=0)Z(r,I,E--,i);else if(i<=-U){i=-i-U|0;for(var J=0;J<E;++J){if(void 0!==(L=S(r[J],i)))return L}H(V,l,e++,i)}else{i=-i-1|0;for(J=0;J<e;++J){var L;if(void 0!==(L=S(i,V[J])))return L}H(r,I,E++,i)}}},sweepComplete:function(q,S,b,z,C,U,g,Q,k,W){for(var N=0,u=2*q,X=q-1,T=u-1,B=b;B<z;++B){var t=U[B]+1<<1,f=u*B;G[N++]=C[f+X],G[N++]=-t,G[N++]=C[f+T],G[N++]=t}for(B=g;B<Q;++B){t=W[B]+1<<1;var m=u*B;G[N++]=k[m+X],G[N++]=1|-t,G[N++]=k[m+T],G[N++]=1|t}var E=N>>>1;v(G,E);var e=0,i=0,J=0;for(B=0;B<E;++B){var L=0|G[2*B+1],d=1&L;if(B<E-1&&L>>1===G[2*B+3]>>1&&(d=2,B+=1),L<0){for(var K=-(L>>1)-1,D=0;D<J;++D){if(void 0!==(x=S(y[D],K)))return x}if(0!==d)for(D=0;D<e;++D){if(void 0!==(x=S(r[D],K)))return x}if(1!==d)for(D=0;D<i;++D){var x;if(void 0!==(x=S(V[D],K)))return x}0===d?H(r,I,e++,K):1===d?H(V,l,i++,K):2===d&&H(y,R,J++,K)}else{K=(L>>1)-1;0===d?Z(r,I,e--,K):1===d?Z(V,l,i--,K):2===d&&Z(y,R,J--,K)}}},scanBipartite:function(q,S,b,z,C,g,V,l,y,R,Q,k){var W=0,N=2*q,u=S,X=S+q,T=1,B=1;z?B=U:T=U;for(var t=C;t<g;++t){var f=t+T,m=N*t;G[W++]=V[m+u],G[W++]=-f,G[W++]=V[m+X],G[W++]=f}for(t=y;t<R;++t){f=t+B;var E=N*t;G[W++]=Q[E+u],G[W++]=-f}var e=W>>>1;v(G,e);var i=0;for(t=0;t<e;++t){var J=0|G[2*t+1];if(J<0){var L=!1;if((f=-J)>=U?(L=!z,f-=U):(L=!!z,f-=1),L)H(r,I,i++,f);else{var d=k[f],K=N*f,D=Q[K+S+1],x=Q[K+S+1+q];q:for(var F=0;F<i;++F){var a=r[F],n=N*a;if(!(x<V[n+S+1]||V[n+S+1+q]<D)){for(var o=S+2;o<q;++o)if(Q[K+o+q]<V[n+o]||V[n+o+q]<Q[K+o])continue q;var s,A=l[a];if(void 0!==(s=z?b(d,A):b(A,d)))return s}}}}else Z(r,I,i--,J-T)}},scanComplete:function(q,S,b,z,C,g,I,V,l,y,R){for(var Z=0,H=2*q,Q=S,k=S+q,W=z;W<C;++W){var N=W+U,u=H*W;G[Z++]=g[u+Q],G[Z++]=-N,G[Z++]=g[u+k],G[Z++]=N}for(W=V;W<l;++W){N=W+1;var X=H*W;G[Z++]=y[X+Q],G[Z++]=-N}var T=Z>>>1;v(G,T);var B=0;for(W=0;W<T;++W){var t=0|G[2*W+1];if(t<0){if((N=-t)>=U)r[B++]=N-U;else{var f=R[N-=1],m=H*N,E=y[m+S+1],e=y[m+S+1+q];q:for(var i=0;i<B;++i){var J=r[i],L=I[J];if(L===f)break;var d=H*J;if(!(e<g[d+S+1]||g[d+S+1+q]<E)){for(var K=S+2;K<q;++K)if(y[m+K+q]<g[d+K]||g[d+K+q]<y[m+K])continue q;var D=b(L,f);if(void 0!==D)return D}}}}else{for(N=t-U,i=B-1;i>=0;--i)if(r[i]===N){for(K=i+1;K<B;++K)r[K-1]=r[K];break}--B}}}};var z=b(13101),C=b(13105),v=b(13124),U=1<<28,g=1024,r=z.mallocInt32(g),I=z.mallocInt32(g),V=z.mallocInt32(g),l=z.mallocInt32(g),y=z.mallocInt32(g),R=z.mallocInt32(g),G=z.mallocDouble(8192);function Z(q,S,b,z){var C=S[z],v=q[b-1];q[C]=v,S[v]=C}function H(q,S,b,z){q[b]=z,S[z]=b}},13107:q=>{"use strict";function S(q,b,z){var C=0|q[z];if(C<=0)return[];var v,U=new Array(C);if(z===q.length-1)for(v=0;v<C;++v)U[v]=b;else for(v=0;v<C;++v)U[v]=S(q,b,z+1);return U}q.exports=function(q,b){switch("undefined"===typeof b&&(b=0),typeof q){case"number":if(q>0)return function(q,S){var b,z;for(b=new Array(q),z=0;z<q;++z)b[z]=S;return b}(0|q,b);break;case"object":if("number"===typeof q.length)return S(q,b,0)}return[]}},13056:(q,S,b)=>{q.exports=function(){var q=this;this.components={},this.comps=this.components;var S=this.components,b=1,C={},v=[],U=[],g={timeout:!1,removals:[],multiComps:[]};function r(q,b){var z=S[b],v=C[b],U=v.hash[q];U&&(v.remove(q),z.qb&&(z.multi?(U.forEach((S=>{S&&z.qb(q,S)})),U.length=0):z.qb(q,U)),g.removals.push(v),I())}function I(){g.timeout||(g.timeout=!0,setTimeout(V,1))}function V(){g.timeout=!1,l()}function l(){g.multiComps.length&&function(q){for(var S=0;S<q.length;S++){var{entID:b,data:z}=q[S],C=z.hash[b];if(C){for(var v=0;v<C.length;v++)C[v]||(C.splice(v,1),v--);0===C.length&&(z.remove(b),g.removals.push(z))}}q.length=0}(g.multiComps),g.removals.length&&function(q){for(var S=0;S<q.length;S++){q[S].flush()}q.length=0}(g.removals)}this.el=C,this._systems=v,this._renderSystems=U,this.kV=function(S){var z=b++;return Array.isArray(S)&&S.forEach((S=>q.vI(z,S))),z},this.deleteEntity=function(S){return Object.keys(C).forEach((q=>{C[q].hash[S]&&r(S,q)})),q},this.dV=function(q){if(!q)throw new Error("Missing component definition");var b=q.name;if(!b)throw new Error("Component definition must have a name property.");if("string"!==typeof b)throw new Error("Component name must be a string.");if(""===b)throw new Error("Component name must be a non-empty string.");if(C[b])throw new Error(`Component ${b} already exists.`);var g={};return g.name=b,g.multi=!!q.multi,g.order=isNaN(q.order)?99:q.order,g.stateConstructor=q.stateConstructor||null,g.state=q.state||{},g.mg=q.mg||null,g.qb=q.qb||null,g.system=q.system||null,g.Gr=q.Gr||null,S[b]=g,C[b]=new z,C[b]._pendingMultiCleanup=!1,C[b]._multiCleanupIDs=g.multi?[]:null,g.system&&(v.push(b),v.sort(((q,b)=>S[q].order-S[b].order))),g.Gr&&(U.push(b),U.sort(((q,b)=>S[q].order-S[b].order))),b},this.overwriteComponent=function(q,b){var z=S[q];if(!z)throw new Error(`Unknown component: ${q}`);if(!b)throw new Error("Missing component definition");if(z.name!==b.name)throw new Error("Overwriting component must use the same name property.");var g={};g.name=q,g.multi=!!b.multi,g.order=isNaN(b.order)?99:b.order,g.state=b.state||{},g.mg=b.mg||null,g.qb=b.qb||null,g.system=b.system||null,g.Gr=b.Gr||null,S[q]=g,C[q]._pendingMultiCleanup=!1,C[q]._multiCleanupIDs=g.multi?[]:null;var r=v.indexOf(q);g.system&&r<0&&v.push(q),!g.system&&r>=0&&v.splice(r,1),v.sort(((q,b)=>S[q].order-S[b].order));var I=U.indexOf(q);g.Gr&&I<0&&U.push(q),!g.Gr&&I>=0&&U.splice(I,1),U.sort(((q,b)=>S[q].order-S[b].order));var V=g.state;return this.bV(q).forEach((q=>{for(var S in V)S in q||(q[S]=V[S]);g.mg&&g.mg(q.yr,q)})),q},this.deleteComponent=function(b){var z=C[b];if(!z)throw new Error(`Unknown component: ${b}`);z.flush(),z.list.forEach((q=>{q&&r(q.yr||q[0].yr,b)}));var g=v.indexOf(b),I=U.indexOf(b);return g>-1&&v.splice(g,1),I>-1&&U.splice(I,1),C[b].dispose(),delete C[b],delete S[b],q},this.vI=function(q,b,z){var v,U=S[b],g=C[b];if(!g)throw new Error(`Unknown component: ${b}.`);if(g.hash[q]&&!U.multi)throw new Error(`Entity ${q} already has component: ${b}.`);if(U.stateConstructor){if(!(v=new U.stateConstructor).hasOwnProperty("yr"))throw new Error(`Component ${U.name} stateConstructor type does not have property __id`)}else v=Object.assign({},{yr:q},U.state,z);if(v.yr=q,U.multi){var r=g.hash[q];r||(r=[],g.add(q,r)),r.push(v)}else g.add(q,v);return U.mg&&U.mg(q,v),this},this.ZI=function(q,S){var b=C[S];if(!b)throw new Error(`Unknown component: ${S}.`);return!!b.hash[q]},this.II=function(S,b){if(!C[b])throw new Error(`Unknown component: ${b}.`);return r(S,b),q},this.getState=function(q,S){var b=C[S];if(!b)throw new Error(`Unknown component: ${S}.`);return b.hash[q]},this.bV=function(q){var S=C[q];if(!S)throw new Error(`Unknown component: ${q}.`);return l(),S.list},this.BR=function(q){if(!C[q])throw new Error(`Unknown component: ${q}.`);var S=C[q].hash;return q=>S[q]},this.mR=function(q){if(!C[q])throw new Error(`Unknown component: ${q}.`);var S=C[q].hash;return q=>!!S[q]},this.rr=function(b){l();for(var z=0;z<v.length;z++){var U=v[z],g=S[U],r=C[U];g.system(b,r.list),l()}return q},this.render=function(b){l();for(var z=0;z<U.length;z++){var v=U[z],g=S[v],r=C[v];g.Gr(b,r.list),l()}return q},this.removeMultiComponent=function(b,z,v){var U=S[z],r=C[z];if(!r)throw new Error(`Unknown component: ${z}.`);if(!U.multi)throw new Error("removeMultiComponent called on non-multi component");return function(q,S,b,z){var C=b.hash[q];if(C){var v=C[z];v&&(C[z]=null,S.qb&&S.qb(q,v),g.multiComps.push({entID:q,data:b}),I())}}(b,U,r,v),q}};var z=b(13065)},13065:q=>{function S(q,S){var b=q._map[S];if(delete q.hash[S],delete q._map[S],b===q.list.length-1)q.list.pop();else{var z=q.list.pop();if(q.list[b]=z,null===z||null===z[0]){var C=q.list.length;for(var v in q._map)if(q._map[v]===C)return void(q._map[v]=b)}else{var U=z.yr||z[0].yr;q._map[U]=b}}}q.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(q,S){if("number"===typeof this._map[q]){var b=this._map[q];this.hash[q]=S,this.list[b]=S}else this._map[q]=this.list.length,this.hash[q]=S,this.list.push(S)}remove(q){var S=this._map[q];this.hash[q]=null,this.list[S]=null,this._pendingRemovals.push(q)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var q=0;q<this._pendingRemovals.length;q++){var b=this._pendingRemovals[q];null===this.hash[b]&&S(this,b)}this._pendingRemovals.length=0}}},13027:q=>{"use strict";var S,b="object"===typeof Reflect?Reflect:null,z=function(q,S,b){return Function.prototype.apply.call(q,S,b)};S=b&&"function"===typeof b.ownKeys?b.ownKeys:Object.getOwnPropertySymbols?function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:function(q){return Object.getOwnPropertyNames(q)};var C=Number.isNaN||function(q){return q!==q};function v(){v.init.call(this)}q.exports=v,q.exports.once=function(q,S){return new Promise((function(b,z){function C(b){q.removeListener(S,v),z(b)}function v(){"function"===typeof q.removeListener&&q.removeListener("error",C),b([].slice.call(arguments))}Z(q,S,v,{once:!0}),"error"!==S&&function(q,S,b){"function"===typeof q.on&&Z(q,"error",S,b)}(q,C,{once:!0})}))},v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var U=10;function g(q){if("function"!==typeof q)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof q)}function r(q){return void 0===q._maxListeners?v.defaultMaxListeners:q._maxListeners}function I(q,S,b,z){var C,v,U,I;if(g(b),void 0===(v=q._events)?(v=q._events=Object.create(null),q._eventsCount=0):(void 0!==v.newListener&&(q.emit("newListener",S,b.listener?b.listener:b),v=q._events),U=v[S]),void 0===U)U=v[S]=b,++q._eventsCount;else if("function"===typeof U?U=v[S]=z?[b,U]:[U,b]:z?U.unshift(b):U.push(b),(C=r(q))>0&&U.length>C&&!U.warned){U.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.j=q,V.type=S,V.count=U.length,I=V,console&&console.warn&&console.warn(I)}return q}function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(q,S,b){var z={fired:!1,wrapFn:void 0,target:q,type:S,listener:b},C=V.bind(z);return C.listener=b,z.wrapFn=C,C}function y(q,S,b){var z=q._events;if(void 0===z)return[];var C=z[S];return void 0===C?[]:"function"===typeof C?b?[C.listener||C]:[C]:b?function(q){for(var S=new Array(q.length),b=0;b<S.length;++b)S[b]=q[b].listener||q[b];return S}(C):G(C,C.length)}function R(q){var S=this._events;if(void 0!==S){var b=S[q];if("function"===typeof b)return 1;if(void 0!==b)return b.length}return 0}function G(q,S){for(var b=new Array(S),z=0;z<S;++z)b[z]=q[z];return b}function Z(q,S,b,z){if("function"===typeof q.on)z.once?q.once(S,b):q.on(S,b);else{if("function"!==typeof q.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof q);q.addEventListener(S,(function C(v){z.once&&q.removeEventListener(S,C),b(v)}))}}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(q){if("number"!==typeof q||q<0||C(q))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+q+".");U=q}}),v.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(q){if("number"!==typeof q||q<0||C(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this},v.prototype.getMaxListeners=function(){return r(this)},v.prototype.emit=function(q){for(var S=[],b=1;b<arguments.length;b++)S.push(arguments[b]);var C="error"===q,v=this._events;if(void 0!==v)C=C&&void 0===v.error;else if(!C)return!1;if(C){var U;if(S.length>0&&(U=S[0]),U instanceof Error)throw U;var g=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw g.context=U,g}var r=v[q];if(void 0===r)return!1;if("function"===typeof r)z(r,this,S);else{var I=r.length,V=G(r,I);for(b=0;b<I;++b)z(V[b],this,S)}return!0},v.prototype.addListener=function(q,S){return I(this,q,S,!1)},v.prototype.on=v.prototype.addListener,v.prototype.prependListener=function(q,S){return I(this,q,S,!0)},v.prototype.once=function(q,S){return g(S),this.on(q,l(this,q,S)),this},v.prototype.prependOnceListener=function(q,S){return g(S),this.prependListener(q,l(this,q,S)),this},v.prototype.removeListener=function(q,S){var b,z,C,v,U;if(g(S),void 0===(z=this._events))return this;if(void 0===(b=z[q]))return this;if(b===S||b.listener===S)0===--this._eventsCount?this._events=Object.create(null):(delete z[q],z.removeListener&&this.emit("removeListener",q,b.listener||S));else if("function"!==typeof b){for(C=-1,v=b.length-1;v>=0;v--)if(b[v]===S||b[v].listener===S){U=b[v].listener,C=v;break}if(C<0)return this;0===C?b.shift():function(q,S){for(;S+1<q.length;S++)q[S]=q[S+1];q.pop()}(b,C),1===b.length&&(z[q]=b[0]),void 0!==z.removeListener&&this.emit("removeListener",q,U||S)}return this},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(q){var S,b,z;if(void 0===(b=this._events))return this;if(void 0===b.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==b[q]&&(0===--this._eventsCount?this._events=Object.create(null):delete b[q]),this;if(0===arguments.length){var C,v=Object.keys(b);for(z=0;z<v.length;++z)"removeListener"!==(C=v[z])&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(S=b[q]))this.removeListener(q,S);else if(void 0!==S)for(z=S.length-1;z>=0;z--)this.removeListener(q,S[z]);return this},v.prototype.listeners=function(q){return y(this,q,!0)},v.prototype.rawListeners=function(q){return y(this,q,!1)},v.listenerCount=function(q,S){return"function"===typeof q.listenerCount?q.listenerCount(S):R.call(q,S)},v.prototype.listenerCount=R,v.prototype.eventNames=function(){return this._eventsCount>0?S(this._events):[]}},13315:q=>{"use strict";q.exports=function(q,S,b,z,C,v){var U=+S[0],g=+S[1],r=+S[2],I=+b[0],V=+b[1],l=+b[2],y=Math.sqrt(I*I+V*V+l*l);if(0===y)throw new Error("Can't raycast along a zero vector");return function(q,S,b,z,C,v,U,g,r,I){for(var V=0,l=Math.floor,y=0|l(S),R=0|l(b),G=0|l(z),Z=C>0?1:-1,H=v>0?1:-1,Q=U>0?1:-1,k=Math.abs(1/C),W=Math.abs(1/v),N=Math.abs(1/U),u=k<1/0?k*(Z>0?y+1-S:S-y):1/0,X=W<1/0?W*(H>0?R+1-b:b-R):1/0,T=N<1/0?N*(Q>0?G+1-z:z-G):1/0,B=-1;V<=g;){var t=q(y,R,G);if(t)return r&&(r[0]=S+V*C,r[1]=b+V*v,r[2]=z+V*U),I&&(I[0]=I[1]=I[2]=0,0===B&&(I[0]=-Z),1===B&&(I[1]=-H),2===B&&(I[2]=-Q)),t;u<X?u<T?(y+=Z,V=u,u+=k,B=0):(G+=Q,V=T,T+=N,B=2):X<T?(R+=H,V=X,X+=W,B=1):(G+=Q,V=T,T+=N,B=2)}return r&&(r[0]=S+V*C,r[1]=b+V*v,r[2]=z+V*U),I&&(I[0]=I[1]=I[2]=0),0}(q,U,g,r,I/=y,V/=y,l/=y,z="undefined"===typeof z?64:+z,C,v)}},13348:(q,S,b)=>{"use strict";b.d(S,{e:()=>v});var z=b(13027);function C(){this.Wy=!1,this.stopPropagation=!1,this.Ny=!1,this.disabled=!1}class v{constructor(q,S){this.version="0.7.0";var b=Object.assign({},new C,S||{});this.element=q||document,this.Wy=!!b.Wy,this.stopPropagation=!!b.stopPropagation,this.Ny=!!b.Ny,this.disabled=!!b.disabled,this.filterEvents=(q,S)=>!0,this.down=new z.EventEmitter,this.up=new z.EventEmitter,this.state={},this.MI={dx:0,dy:0,ZR:0,jI:0,HR:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?g(this):document.addEventListener("DOMContentLoaded",(q=>{g(this)}),{once:!0})}bind(q){for(var S=arguments.length,b=new Array(S>1?S-1:0),z=1;z<S;z++)b[z-1]=arguments[z];b.forEach((S=>{var b=this._keyBindmap[S]||[];b.includes(q)||(b.push(q),this._keyBindmap[S]=b)})),this.state[q]=!!this.state[q],this.pressCount[q]=this.pressCount[q]||0,this.releaseCount[q]=this.releaseCount[q]||0}unbind(q){for(var S in this._keyBindmap){var b=this._keyBindmap[S],z=b.indexOf(q);z>-1&&b.splice(z,1)}}getBindings(){var q={};for(var S in this._keyBindmap){this._keyBindmap[S].forEach((b=>{q[b]=q[b]||[],q[b].push(S)}))}return q}rr(){U(this.MI),U(this.pressCount),U(this.releaseCount)}}function U(q){for(var S in q)q[S]=0}function g(q){window.addEventListener("keydown",G.bind(null,q,!0),!1),window.addEventListener("keyup",G.bind(null,q,!1),!1);var S={passive:!0};q.element.addEventListener("touchstart",l.bind(void 0,q),{passive:!1}),q.element.addEventListener("touchend",R.bind(void 0,q),S),q.element.addEventListener("mousedown",Z.bind(null,q,!0),S),window.document.addEventListener("mouseup",Z.bind(null,q,!1),S),q.element.addEventListener("touchmove",H.bind(null,q),S),q.element.addEventListener("mousemove",H.bind(null,q),S),window.PointerEvent,q.element.addEventListener("wheel",Q.bind(null,q),S),q.element.addEventListener("contextmenu",k.bind(null,q),!1),window.addEventListener("blur",W.bind(null,q),!1)}var r=0,I=0,V=null;function l(q,S){S.preventDefault(),y(S)}function y(q){let S=!1;for(let b=0;b<q.touches.length;++b)if(q.touches[b].identifier===V){S=!0;break}if(!S){const S=q.changedTouches[0];r=S.clientX,I=S.clientY,V=S.identifier}}function R(q,S){for(var b=S.changedTouches,z=0;z<b.length;++z)b[z].identifier===V&&(V=null)}function G(q,S,b){N(b.code,S,q,b)}function Z(q,S,b){if("pointerId"in b)if(S){if(null!==q._touches.currID)return;q._touches.currID=b.pointerId}else{if(q._touches.currID!==b.pointerId)return;q._touches.currID=null}return N("Mouse"+("button"in b?b.button+1:1),S,q,b),!1}function H(q,S){var b=S.movementX||S.mozMovementX||0,z=S.movementY||S.mozMovementY||0;if(S.touches&&0===(b|z)){var C=function(q){y(q);for(let S=0;S<q.changedTouches.length;++S)if(q.changedTouches[S].identifier==V){const b=q.changedTouches[S],z=[b.clientX-r,b.clientY-I];return r=b.clientX,I=b.clientY,z}return console.error(`Did not find touch id ${V}`),[0,0]}(S);b=C[0],z=C[1]}q.MI.dx+=b,q.MI.dy+=z}function Q(q,S){var b=1;switch(S.deltaMode){case 0:b=1;break;case 1:b=12;break;case 2:b=q.element.clientHeight||window.innerHeight}q.MI.ZR+=(S.deltaX||0)*b,q.MI.jI+=(S.deltaY||0)*b,q.MI.HR+=(S.deltaZ||0)*b}function k(q,S){if(!q.Ny)return S.preventDefault(),!1}function W(q){for(var S in q._keyStates)q._keyStates[S]&&(/^Mouse\d/.test(S)||N(S,!1,q,{code:S,note:"i0wf9iblkp",preventDefault:()=>{},stopPropagation:()=>{}}))}function N(q,S,b,z){var C=b._keyBindmap[q];C&&(u(b._keyStates[q],S)&&(b._keyStates[q]=S,C.forEach((q=>{(!b.filterEvents||b.filterEvents(z,q))&&function(q,S,b,z){var C=S?b.pressCount:b.releaseCount;C[q]=(C[q]||0)+1;var v=b._bindPressCount[q]||0;(v+=S?1:-1)<0&&(v=0);b._bindPressCount[q]=v;var U=b.state[q];if(u(U,v)){b.state[q]=v>0;var g=S?b.down:b.up;b.disabled||g.emit(q,z)}}(q,S,b,z)}))),"button"in z||(b.Wy&&!z.defaultPrevented&&z.preventDefault(),b.stopPropagation&&z.stopPropagation()))}function u(q,S){return q?!S:S}},11977:q=>{q.exports=function(q,S,b){return q[0]=S[0]+b[0],q[1]=S[1]+b[1],q[2]=S[2]+b[2],q}},11939:(q,S,b)=>{q.exports=function(q,S){var b=z(q[0],q[1],q[2]),U=z(S[0],S[1],S[2]);C(b,b),C(U,U);var g=v(b,U);return g>1?0:Math.acos(g)};var z=b(11945),C=b(11952),v=b(11958)},12021:q=>{q.exports=function(q,S){return q[0]=Math.ceil(S[0]),q[1]=Math.ceil(S[1]),q[2]=Math.ceil(S[2]),q}},11933:q=>{q.exports=function(q){var S=new Float32Array(3);return S[0]=q[0],S[1]=q[1],S[2]=q[2],S}},11961:q=>{q.exports=function(q,S){return q[0]=S[0],q[1]=S[1],q[2]=S[2],q}},11927:q=>{q.exports=function(){var q=new Float32Array(3);return q[0]=0,q[1]=0,q[2]=0,q}},12096:q=>{q.exports=function(q,S,b){var z=S[0],C=S[1],v=S[2],U=b[0],g=b[1],r=b[2];return q[0]=C*r-v*g,q[1]=v*U-z*r,q[2]=z*g-C*U,q}},12055:(q,S,b)=>{q.exports=b(12052)},12052:q=>{q.exports=function(q,S){var b=S[0]-q[0],z=S[1]-q[1],C=S[2]-q[2];return Math.sqrt(b*b+z*z+C*C)}},12007:(q,S,b)=>{q.exports=b(12004)},12004:q=>{q.exports=function(q,S,b){return q[0]=S[0]/b[0],q[1]=S[1]/b[1],q[2]=S[2]/b[2],q}},11958:q=>{q.exports=function(q,S){return q[0]*S[0]+q[1]*S[1]+q[2]*S[2]}},11922:q=>{q.exports=1e-6},11971:(q,S,b)=>{q.exports=function(q,S){var b=q[0],C=q[1],v=q[2],U=S[0],g=S[1],r=S[2];return Math.abs(b-U)<=z*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(C-g)<=z*Math.max(1,Math.abs(C),Math.abs(g))&&Math.abs(v-r)<=z*Math.max(1,Math.abs(v),Math.abs(r))};var z=b(11922)},11973:q=>{q.exports=function(q,S){return q[0]===S[0]&&q[1]===S[1]&&q[2]===S[2]}},12017:q=>{q.exports=function(q,S){return q[0]=Math.floor(S[0]),q[1]=Math.floor(S[1]),q[2]=Math.floor(S[2]),q}},12156:(q,S,b)=>{q.exports=function(q,S,b,C,v,U){var g,r;S||(S=3);b||(b=0);r=C?Math.min(C*S+b,q.length):q.length;for(g=b;g<r;g+=S)z[0]=q[g],z[1]=q[g+1],z[2]=q[g+2],v(z,z,U),q[g]=z[0],q[g+1]=z[1],q[g+2]=z[2];return q};var z=b(11927)()},11945:q=>{q.exports=function(q,S,b){var z=new Float32Array(3);return z[0]=q,z[1]=S,z[2]=b,z}},11915:(q,S,b)=>{q.exports={EPSILON:b(11922),create:b(11927),clone:b(11933),angle:b(11939),cg:b(11945),i:b(11961),set:b(11963),equals:b(11971),exactEquals:b(11973),add:b(11977),RS:b(11982),sub:b(11990),multiply:b(11999),mul:b(12002),divide:b(12004),div:b(12007),min:b(12009),max:b(12011),floor:b(12017),ceil:b(12021),round:b(12030),scale:b(12038),qr:b(12046),distance:b(12052),k:b(12055),squaredDistance:b(12060),sqrDist:b(12063),length:b(12067),len:b(12070),squaredLength:b(12072),Sr:b(12076),negate:b(12081),inverse:b(12089),normalize:b(11952),dot:b(11958),cross:b(12096),Mg:b(12101),random:b(12110),transformMat4:b(12119),transformMat3:b(12126),transformQuat:b(12135),zr:b(12141),Cr:b(12147),vr:b(12150),forEach:b(12156)}},12089:q=>{q.exports=function(q,S){return q[0]=1/S[0],q[1]=1/S[1],q[2]=1/S[2],q}},12070:(q,S,b)=>{q.exports=b(12067)},12067:q=>{q.exports=function(q){var S=q[0],b=q[1],z=q[2];return Math.sqrt(S*S+b*b+z*z)}},12101:q=>{q.exports=function(q,S,b,z){var C=S[0],v=S[1],U=S[2];return q[0]=C+z*(b[0]-C),q[1]=v+z*(b[1]-v),q[2]=U+z*(b[2]-U),q}},12011:q=>{q.exports=function(q,S,b){return q[0]=Math.max(S[0],b[0]),q[1]=Math.max(S[1],b[1]),q[2]=Math.max(S[2],b[2]),q}},12009:q=>{q.exports=function(q,S,b){return q[0]=Math.min(S[0],b[0]),q[1]=Math.min(S[1],b[1]),q[2]=Math.min(S[2],b[2]),q}},12002:(q,S,b)=>{q.exports=b(11999)},11999:q=>{q.exports=function(q,S,b){return q[0]=S[0]*b[0],q[1]=S[1]*b[1],q[2]=S[2]*b[2],q}},12081:q=>{q.exports=function(q,S){return q[0]=-S[0],q[1]=-S[1],q[2]=-S[2],q}},11952:q=>{q.exports=function(q,S){var b=S[0],z=S[1],C=S[2],v=b*b+z*z+C*C;v>0&&(v=1/Math.sqrt(v),q[0]=S[0]*v,q[1]=S[1]*v,q[2]=S[2]*v);return q}},12110:q=>{q.exports=function(q,S){S=S||1;var b=2*Math.random()*Math.PI,z=2*Math.random()-1,C=Math.sqrt(1-z*z)*S;return q[0]=Math.cos(b)*C,q[1]=Math.sin(b)*C,q[2]=z*S,q}},12141:q=>{q.exports=function(q,S,b,z){var C=b[1],v=b[2],U=S[1]-C,g=S[2]-v,r=Math.sin(z),I=Math.cos(z);return q[0]=S[0],q[1]=C+U*I-g*r,q[2]=v+U*r+g*I,q}},12147:q=>{q.exports=function(q,S,b,z){var C=b[0],v=b[2],U=S[0]-C,g=S[2]-v,r=Math.sin(z),I=Math.cos(z);return q[0]=C+g*r+U*I,q[1]=S[1],q[2]=v+g*I-U*r,q}},12150:q=>{q.exports=function(q,S,b,z){var C=b[0],v=b[1],U=S[0]-C,g=S[1]-v,r=Math.sin(z),I=Math.cos(z);return q[0]=C+U*I-g*r,q[1]=v+U*r+g*I,q[2]=S[2],q}},12030:q=>{q.exports=function(q,S){return q[0]=Math.round(S[0]),q[1]=Math.round(S[1]),q[2]=Math.round(S[2]),q}},12038:q=>{q.exports=function(q,S,b){return q[0]=S[0]*b,q[1]=S[1]*b,q[2]=S[2]*b,q}},12046:q=>{q.exports=function(q,S,b,z){return q[0]=S[0]+b[0]*z,q[1]=S[1]+b[1]*z,q[2]=S[2]+b[2]*z,q}},11963:q=>{q.exports=function(q,S,b,z){return q[0]=S,q[1]=b,q[2]=z,q}},12063:(q,S,b)=>{q.exports=b(12060)},12076:(q,S,b)=>{q.exports=b(12072)},12060:q=>{q.exports=function(q,S){var b=S[0]-q[0],z=S[1]-q[1],C=S[2]-q[2];return b*b+z*z+C*C}},12072:q=>{q.exports=function(q){var S=q[0],b=q[1],z=q[2];return S*S+b*b+z*z}},11990:(q,S,b)=>{q.exports=b(11982)},11982:q=>{q.exports=function(q,S,b){return q[0]=S[0]-b[0],q[1]=S[1]-b[1],q[2]=S[2]-b[2],q}},12126:q=>{q.exports=function(q,S,b){var z=S[0],C=S[1],v=S[2];return q[0]=z*b[0]+C*b[3]+v*b[6],q[1]=z*b[1]+C*b[4]+v*b[7],q[2]=z*b[2]+C*b[5]+v*b[8],q}},12119:q=>{q.exports=function(q,S,b){var z=S[0],C=S[1],v=S[2],U=b[3]*z+b[7]*C+b[11]*v+b[15];return U=U||1,q[0]=(b[0]*z+b[4]*C+b[8]*v+b[12])/U,q[1]=(b[1]*z+b[5]*C+b[9]*v+b[13])/U,q[2]=(b[2]*z+b[6]*C+b[10]*v+b[14])/U,q}},12135:q=>{q.exports=function(q,S,b){var z=S[0],C=S[1],v=S[2],U=b[0],g=b[1],r=b[2],I=b[3],V=I*z+g*v-r*C,l=I*C+r*z-U*v,y=I*v+U*C-g*z,R=-U*z-g*C-r*v;return q[0]=V*I+R*-U+l*-r-y*-g,q[1]=l*I+R*-g+y*-U-V*-r,q[2]=y*I+R*-r+V*-g-l*-U,q}},13045:q=>{"use strict";q.exports=function(q){for(var S=new Array(q),b=0;b<q;++b)S[b]=b;return S}},13114:q=>{q.exports=function(q){return null!=q&&null!=q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}},13321:(q,S,b)=>{"use strict";b.d(S,{e:()=>z});class z{constructor(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Sl=!1,this.bl=!1,this.cV=30,this.ql=0,this.ll=!1,this.fullscreen=!1,this.Cl=function(q){},this.vl=function(){},this.Il=function(){},this.Sb=function(){},this.Ul=function(q){},this.onFullscreenChanged=function(q){},I((()=>{!function(q,S){q._nowObject=performance||Date,q._lastTick=0,q._renderAccum=0,q._rt=0,q._frameCB=g.bind(null,q),requestAnimationFrame(q._frameCB),S>0&&(q._intervalCB=U.bind(null,q),q._interval=setInterval(q._intervalCB,Math.max(S,1e3/q.cV/2)))}(this,S),function(q,S){if(!S)return;var b=!1,z=!1;document.addEventListener("pointerlockchange",(z=>{b=document.pointerLockElement===S,q.Ul(b)})),document.addEventListener("fullscreenchange",(b=>{z=document.fullscreenElement===S,q.onFullscreenChanged(z)})),Object.defineProperty(q,"ll",{get:()=>b,set:q=>{q&&!b?r(S):b&&!q&&function(q){q.exitPointerLock&&q.exitPointerLock()}(document)}}),Object.defineProperty(q,"fullscreen",{get:()=>z,set:q=>{q&&!z?S.requestFullscreen():z&&!q&&document.exitFullscreen()}}),S.addEventListener("click",(C=>{q.Sl&&!b&&r(S),q.bl&&!z&&S.requestFullscreen()}));var C=()=>q.Sb();if(window.ResizeObserver){new ResizeObserver(C).observe(S)}else window.addEventListener("resize",C)}(this,q),this.Il()}))}}var C=3,v=20;function U(q){for(var S=1e3/q.cV,b=q._nowObject.now()+v,z=0;q._nowObject.now()>=q._lastTick+S&&q._nowObject.now()<b&&++z<=C;)q.Cl(S),q._lastTick+=S;var U=5*(S+5),g=q._nowObject.now();if(g-q._lastTick>U)for(;g>=q._lastTick+S;)q._lastTick+=S}function g(q){requestAnimationFrame(q._frameCB),U(q);var S=q._nowObject.now(),b=S-q._rt;if(q._rt=S,q.ql>0){q._renderAccum+=b;var z=1e3/q.ql;if(q._renderAccum<z)return;q._renderAccum=Math.min(q._renderAccum-z,z)}var C=1e3/q.cV,v=(S-q._lastTick)/C;q.vl(b,v,C)}function r(q){q.requestPointerLock&&q.requestPointerLock()}var I=q=>{if("loading"===document.readyState){var S=()=>{document.removeEventListener("readystatechange",S),q()};document.addEventListener("readystatechange",S)}else setTimeout(q,1)}},13043:(q,S,b)=>{var z=b(13045),C=b(13047),v="undefined"!==typeof Float64Array;function U(q,S){return q[0]-S[0]}function g(){var q,S=this.stride,b=new Array(S.length);for(q=0;q<b.length;++q)b[q]=[Math.abs(S[q]),q];b.sort(U);var z=new Array(b.length);for(q=0;q<z.length;++q)z[q]=b[q][1];return z}function r(q,S){var b=["View",S,"d",q].join("");S<0&&(b="View_Nil"+q);var C="generic"===q;if(-1===S){var v="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(v)()}if(0===S){v="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(C?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(C?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",v)(I[q][0])}v=["'use strict'"];var U=z(S),r=U.map((function(q){return"i"+q})),V="this.offset+"+U.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),l=U.map((function(q){return"b"+q})).join(","),y=U.map((function(q){return"c"+q})).join(",");v.push("function "+b+"(a,"+l+","+y+",d){this.data=a","this.shape=["+l+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+q+"'","proto.dimension="+S),v.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+U.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===S?v.push("proto.order=[0]"):(v.push("Object.defineProperty(proto,'order',{get:"),S<4?(v.push("function "+b+"_order(){"),2===S?v.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&v.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):v.push("ORDER})")),v.push("proto.set=function "+b+"_set("+r.join(",")+",v){"),C?v.push("return this.data.set("+V+",v)}"):v.push("return this.data["+V+"]=v}"),v.push("proto.get=function "+b+"_get("+r.join(",")+"){"),C?v.push("return this.data.get("+V+")}"):v.push("return this.data["+V+"]}"),v.push("proto.index=function "+b+"_index(",r.join(),"){return "+V+"}"),v.push("proto.hi=function "+b+"_hi("+r.join(",")+"){return new "+b+"(this.data,"+U.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+U.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var R=U.map((function(q){return"a"+q+"=this.shape["+q+"]"})),G=U.map((function(q){return"c"+q+"=this.stride["+q+"]"}));v.push("proto.lo=function "+b+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+R.join(",")+","+G.join(","));for(var Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){d=i"+Z+"|0;b+=c"+Z+"*d;a"+Z+"-=d}");v.push("return new "+b+"(this.data,"+U.map((function(q){return"a"+q})).join(",")+","+U.map((function(q){return"c"+q})).join(",")+",b)}"),v.push("proto.step=function "+b+"_step("+r.join(",")+"){var "+U.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+U.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'){d=i"+Z+"|0;if(d<0){c+=b"+Z+"*(a"+Z+"-1);a"+Z+"=ceil(-a"+Z+"/d)}else{a"+Z+"=ceil(a"+Z+"/d)}b"+Z+"*=d}");v.push("return new "+b+"(this.data,"+U.map((function(q){return"a"+q})).join(",")+","+U.map((function(q){return"b"+q})).join(",")+",c)}");var H=new Array(S),Q=new Array(S);for(Z=0;Z<S;++Z)H[Z]="a[i"+Z+"]",Q[Z]="b[i"+Z+"]";v.push("proto.transpose=function "+b+"_transpose("+r+"){"+r.map((function(q,S){return q+"=("+q+"===undefined?"+S+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+H.join(",")+","+Q.join(",")+",this.offset)}"),v.push("proto.pick=function "+b+"_pick("+r+"){var a=[],b=[],c=this.offset");for(Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){c=(c+this.stride["+Z+"]*i"+Z+")|0}else{a.push(this.shape["+Z+"]);b.push(this.stride["+Z+"])}");return v.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),v.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+U.map((function(q){return"shape["+q+"]"})).join(",")+","+U.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",v.join("\n"))(I[q],g)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,S,b,z){if(void 0===q)return(0,I.array[0])([]);"number"===typeof q&&(q=[q]),void 0===S&&(S=[q.length]);var U=S.length;if(void 0===b){b=new Array(U);for(var g=U-1,V=1;g>=0;--g)b[g]=V,V*=S[g]}if(void 0===z){z=0;for(g=0;g<U;++g)b[g]<0&&(z-=(S[g]-1)*b[g])}for(var l=function(q){if(C(q))return"buffer";if(v)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),y=I[l];y.length<=U+1;)y.push(r(l,y.length-1));return(0,y[U+1])(q,S,b,z)}},13047:q=>{function S(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(S(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&S(q.slice(0,0))}(q)||!!q._isBuffer)}},13178:q=>{"use strict";var S=[],b=[],z=[],C=[],v=[],U=[],g=[],r=[],I=[],V=[],l=[],y=[];q.exports=function(q,R,G,Z,H,Q){for(var k=g,W=I,N=V,u=y,X=0;X<3;X++)k[X]=+G[X],N[X]=+R.max[X],W[X]=+R.base[X];Q||(Q=1e-10);var T=function(q,g,I,V,y,R){var G=S,Z=b,H=z,Q=C,k=v,W=U,N=r,u=Math.floor,X=0,T=0,B=0,t=0,f=0;if(m(),0===B)return 0;for(t=i();T<=B;){if(E(t)&&e())return X;t=i()}for(X+=B,f=0;f<3;f++)V[f]+=I[f],y[f]+=I[f];return X;function m(){if(T=0,0!==(B=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])))for(var q=0;q<3;q++){var S=I[q]>=0;Q[q]=S?1:-1;var b=S?y[q]:V[q];G[q]=S?V[q]:y[q],Z[q]=J(b,Q[q]),H[q]=L(G[q],Q[q]),N[q]=I[q]/B,k[q]=Math.abs(1/N[q]);var z=S?Z[q]+1-b:b-Z[q];W[q]=k[q]<1/0?k[q]*z:1/0}}function E(S){for(var b=Q[0],z=0===S?Z[0]:H[0],C=Z[0]+b,v=Q[1],U=1===S?Z[1]:H[1],g=Z[1]+v,r=Q[2],I=2===S?Z[2]:H[2],V=Z[2]+r,l=z;l!=C;l+=b)for(var y=U;y!=g;y+=v)for(var R=I;R!=V;R+=r)if(q(l,y,R))return!0;return!1}function e(){X+=T;var q=Q[t],S=T/B,b=l;for(f=0;f<3;f++){var z=I[f]*S;V[f]+=z,y[f]+=z,b[f]=I[f]-z}if(q>0?y[t]=Math.round(y[t]):V[t]=Math.round(V[t]),g(X,t,q,b))return!0;for(f=0;f<3;f++)I[f]=b[f];return m(),0===B}function i(){var q=W[0]<W[1]?W[0]<W[2]?0:2:W[1]<W[2]?1:2,S=W[q]-T;for(T=W[q],Z[q]+=Q[q],W[q]+=k[q],f=0;f<3;f++)G[f]+=S*N[f],H[f]=L(G[f],Q[f]);return q}function J(q,S){return u(q-S*R)}function L(q,S){return u(q+S*R)}}(q,Z,k,W,N,Q);if(!H){for(X=0;X<3;X++)u[X]=G[X]>0?N[X]-R.max[X]:W[X]-R.base[X];R.translate(u)}return T}},13356:(q,S,b)=>{"use strict";b.d(S,{c:()=>l});var z=b(13173),C=b(11915);class v{constructor(q,S,b,v,U,g,r){this.SV=new z(q.base,q.ZV),this.qv=S,this.friction=b,this.restitution=v,this.Lg=U,this.DR=g,this.Dg=!!r,this.GV=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.TG=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.iI=C.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=C.create(),this._impulses=C.create(),this._sleepFrameCount=10}loadFromCopy(q){C.i(this.SV.base,q.SV.base),C.i(this.SV.ZV,q.SV.ZV),C.i(this.SV.max,q.SV.max),this.SV.mag=q.SV.mag,this.qv=q.qv,this.friction=q.friction,this.restitution=q.restitution,this.Lg=q.Lg,this.DR=q.DR,this.Dg=q.Dg,this.GV=q.GV,this.fluidDrag=q.fluidDrag,this.TG=q.TG,this.preventFallOffEdge=q.preventFallOffEdge,this.rolledBackLastTick=q.rolledBackLastTick,C.i(this.iI,q.iI),C.i(this.resting,q.resting),this.inFluid=q.inFluid,this._ratioInFluid=q._ratioInFluid,C.i(this._forces,q._forces),C.i(this._impulses,q._impulses),this._sleepFrameCount=q._sleepFrameCount}setPosition(q){U(q),C.RS(q,q,this.SV.base),this.SV.translate(q),this.dI()}bb(){return C.clone(this.SV.base)}applyForce(q){U(q),C.add(this._forces,this._forces,q),this.dI()}applyImpulse(q){U(q),C.add(this._impulses,this._impulses,q),this.dI()}dI(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var U=q=>{};var g=b(13173),r=b(11915),I=b(13178);function V(){this.GV=.1,this.fluidDrag=.4,this.jg=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function l(q,S,b){q=Object.assign(new V,q),this.gravity=q.gravity||[0,-10,0],this.GV=q.GV||.1,this.jg=q.jg||2,this.fluidDrag=q.fluidDrag||.4,this.minBounceImpulse=q.minBounceImpulse,this.bodies=[],this.vR=q.vR,this.testSolid=S,this.testFluid=b}l.prototype.AR=function(q,S,b,z,C,U){q=q||new g([0,0,0],[1,1,1]),"undefined"==typeof S&&(S=1),"undefined"==typeof b&&(b=1),"undefined"==typeof z&&(z=0),"undefined"==typeof C&&(C=1);var r=new v(q,S,b,z,C,U);return this.bodies.push(r),r},l.prototype.wR=function(q){var S=this.bodies.indexOf(q);S<0||(this.bodies.splice(S,1),q.SV=q.DR=null)};var y=r.create(),R=r.create(),G=r.create(),Z=r.create(),H=r.create(),Q=r.create(),k=r.create(),W=new g([0,0,0],[1,1,1]),N=new v(W,1,1,0,1,(()=>{}),!1);function u(q,S,b){return S=b,S*=1-(1-q.ratioInFluid)**2}l.prototype.rr=function(q){q/=1e3;var S=F(0,r.squaredLength(this.gravity));this.bodies.forEach((b=>function(q,S,b,z){r.i(H,S.resting),q.vR&&N.loadFromCopy(S);if(S.qv<=0)return r.set(S.iI,0,0,0),r.set(S._forces,0,0,0),void r.set(S._impulses,0,0,0);var C=z||0===S.Lg;if(function(q,S,b,z){if(S._sleepFrameCount>0)return!1;if(z)return!0;var C=!1,v=.5*b*b*S.Lg;return r.scale(x,q.gravity,v),I(q.testSolid,S.SV,x,(function(){return C=!0,!0}),!0),C}(q,S,b,C))return;S._sleepFrameCount--,function(q,S){var b=S.SV,z=Math.floor(b.base[0]),C=Math.floor(b.base[2]),v=Math.floor(b.base[1]),U=Math.floor(b.max[1]);if(!q.testFluid(z,v,C))return S.inFluid=!1,void(S.ratioInFluid=0);var g=1,I=v+1;for(;I<=U&&q.testFluid(z,I,C);)g++,I++;var V=(v+g-b.base[1])/b.ZV[1];V>1&&(V=1);var l=b.ZV[0]*b.ZV[1]*b.ZV[2]*V,y=T;r.scale(y,q.gravity,-q.jg*l*S.Lg),S.applyForce(y),S.inFluid=!0,S.ratioInFluid=V}(q,S),n(S._forces),n(S._impulses),n(S.iI),n(S.resting),r.scale(y,S._forces,1/S.qv),r.qr(y,y,q.gravity,S.Lg),r.scale(R,S._impulses,1/S.qv),r.qr(R,R,y,b),r.add(S.iI,S.iI,R),S.friction&&(B(q,0,S,R,b),B(q,1,S,R,b),B(q,2,S,R,b));var v=S.fluidDrag>=0?S.fluidDrag:q.fluidDrag,U=S.GV>=0?S.GV:q.GV,g=U,V=U;S.inFluid&&(g=u(S,g,S.fluidDragHoriz>=0?S.fluidDragHoriz:v),V=u(S,V,S.fluidDragVert>=0?S.fluidDragVert:v));g=Math.max(1-g*b/S.qv,0),V=Math.max(1-V*b/S.qv,0),r.set(X,g,V,g),r.multiply(S.iI,S.iI,X),r.scale(G,S.iI,b),r.set(S._forces,0,0,0),r.set(S._impulses,0,0,0),S.Dg&&a(m,S.SV);r.i(Q,G),r.set(k,0,0,0),S.preventFallOffEdge&&function(q,S,b,z){if(!S.resting[1]||b[1]>0)return;var C=d;a(C,S.SV);for(var v=0;v<3;v+=2){r.set(L,0,0,0),L[v]=b[v];var U=!0;(U=(U=(U=(U=U&&!D(q,C.base[0]+L[0]+1e-5,C.base[1],C.base[2]+L[2]+1e-5))&&!D(q,C.max[0]+L[0]-1e-5,C.base[1],C.base[2]+L[2]+1e-5))&&!D(q,C.base[0]+L[0]+1e-5,C.base[1],C.max[2]+L[2]-1e-5))&&!D(q,C.max[0]+L[0]-1e-5,C.base[1],C.max[2]+L[2]-1e-5))?(z[v]=b[v]>0?1:-1,b[v]=0):0===v&&(r.set(K,b[0],0,0),f(q,C,K,z,S.slideOnCollision))}}(q,S,G,k);f(q,S.SV,G,S.resting,S.slideOnCollision),S.Dg&&function(q,S,b,z){if(S.resting[1]>=0&&!S.inFluid)return;var C=0!==S.resting[0],v=0!==S.resting[2];if(!C&&!v)return;var U=Math.abs(z[0]/z[2]),g=4;if(!C&&U>g)return;if(!v&&U<1/g)return;r.add(e,b.base,z);var V=q.testSolid;I(V,b,z,(function(q,S,b,z){if(1!==S)return!0;z[S]=0}));var l=b.base[1],y=S.inFluid?1.951:1.001,R=Math.floor(l+y)-l;r.set(i,0,R,0);var G=!1;if(I(V,b,i,(function(q,S,b,z){return G=!0,!0})),G)return;r.RS(J,e,b.base),J[1]=0,f(q,b,J,E,!0);var Z=F(b.base[0],e[0]),H=F(b.base[2],e[2]);if(C&&!Z&&(!H||!v))return;if(v&&(!Z||!C)&&!H)return;var Q=!0;if(Q=Q&&!D(q,b.base[0]+1e-5,b.base[1],b.base[2]+1e-5),Q=Q&&!D(q,b.max[0]-1e-5,b.base[1],b.base[2]+1e-5),Q=Q&&!D(q,b.base[0]+1e-5,b.base[1],b.max[2]-1e-5),Q=Q&&!D(q,b.max[0]-1e-5,b.base[1],b.max[2]-1e-5),Q)return;a(S.SV,b),S.resting[0]=E[0],S.resting[2]=E[2],S.TG&&S.TG()}(q,S,m,Q);for(var l=0;l<3;++l)S.resting[l]=S.resting[l]||k[l],Z[l]=0,S.resting[l]&&(H[l]||(Z[l]=-S.iI[l]),S.iI[l]=0);var W=r.length(Z);W>.001&&(r.scale(Z,Z,S.qv),S.DR&&S.DR(Z),S.restitution>0&&W>q.minBounceImpulse&&(r.scale(Z,Z,S.restitution),S.applyImpulse(Z)));var t=r.squaredLength(S.iI);t>1e-5&&S.dI();q.vR&&q.vR(S)?(S.loadFromCopy(N),S.rolledBackLastTick=!0):S.rolledBackLastTick=!1}(this,b,q,S)))};var X=r.create([0,0,0]);var T=r.create();function B(q,S,b,z,C){var v=b.resting[S],U=z[S];if(!b.alwaysApplyHorizFriction||1!==S){if(0===v)return;if(v*U<=0)return}r.i(t,b.iI),t[S]=0;var g=r.length(t);if(!F(g,0)){var I=Math.abs(b.friction*q.gravity[S]*C),V=g>I?(g-I)/g:0;b.iI[(S+1)%3]*=V,b.iI[(S+2)%3]*=V}}var t=r.create();function f(q,S,b,z,C){return r.set(z,0,0,0),I(q.testSolid,S,b,(function(q,S,b,v){z[S]=b,v[S]=0,C||(v[0]=0,v[1]=0,v[2]=0)}))}var m=new g([],[]),E=r.create(),e=r.create(),i=r.create(),J=r.create();var L=r.create(),d=new g([],[]),K=r.create();function D(q,S,b,z){return q.testSolid(Math.floor(S),Math.floor(b-1),Math.floor(z))}var x=r.create();function F(q,S){return Math.abs(q-S)<1e-5}function a(q,S){for(var b=0;b<3;b++)q.base[b]=S.base[b],q.max[b]=S.max[b],q.ZV[b]=S.ZV[b]}var n=function(q){}},11809:function(q,S){!function(q){"use strict";var S=function(q,b){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(q,S){q.__proto__=S}||function(q,S){for(var b in S)Object.prototype.hasOwnProperty.call(S,b)&&(q[b]=S[b])},S(q,b)};function b(q,b){if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function z(){this.constructor=q}S(q,b),q.prototype=null===b?Object.create(b):(z.prototype=b.prototype,new z)}function z(q,S,b,z){var C,v=arguments.length,U=v<3?S:null===z?z=Object.getOwnPropertyDescriptor(S,b):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)U=Reflect.decorate(q,S,b,z);else for(var g=q.length-1;g>=0;g--)(C=q[g])&&(U=(v<3?C(U):v>3?C(S,b,U):C(S,b))||U);return v>3&&U&&Object.defineProperty(S,b,U),U}function C(q,S,b){if(b||2===arguments.length)for(var z,C=0,v=S.length;C<v;C++)!z&&C in S||(z||(z=Array.prototype.slice.call(S,0,C)),z[C]=S[C]);return q.concat(z||Array.prototype.slice.call(S))}var v,U=255,g=213;q.OPERATION=void 0,(v=q.OPERATION||(q.OPERATION={}))[v.ADD=128]="ADD",v[v.REPLACE=0]="REPLACE",v[v.DELETE=64]="DELETE",v[v.DELETE_AND_ADD=192]="DELETE_AND_ADD",v[v.TOUCH=1]="TOUCH",v[v.CLEAR=10]="CLEAR";var r=function(){function S(q,S,b){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=q,this.setParent(S,b)}return S.prototype.setParent=function(q,S,b){var z=this;if(this.indexes||(this.indexes=this.ref instanceof Jq?this.ref._definition.indexes:{}),this.parent=q,this.parentIndex=b,S)if(this.root=S,this.ref instanceof Jq){var C=this.ref._definition;for(var v in C.schema){var U=this.ref[v];if(U&&U.$changes){var g=C.indexes[v];U.$changes.setParent(this.ref,S,g)}}}else"object"===typeof this.ref&&this.ref.forEach((function(q,S){if(q instanceof Jq){var b=q.$changes,C=z.ref.$changes.indexes[S];b.setParent(z.ref,z.root,C)}}))},S.prototype.operation=function(q){this.changes.set(--this.currentCustomOperation,q)},S.prototype.change=function(S,b){void 0===b&&(b=q.OPERATION.ADD);var z="number"===typeof S?S:this.indexes[S];this.assertValidIndex(z,S);var C=this.changes.get(z);C&&C.op!==q.OPERATION.DELETE&&C.op!==q.OPERATION.TOUCH||this.changes.set(z,{op:C&&C.op===q.OPERATION.DELETE?q.OPERATION.DELETE_AND_ADD:b,index:z}),this.allChanges.add(z),this.changed=!0,this.touchParents()},S.prototype.touch=function(S){var b="number"===typeof S?S:this.indexes[S];this.assertValidIndex(b,S),this.changes.has(b)||this.changes.set(b,{op:q.OPERATION.TOUCH,index:b}),this.allChanges.add(b),this.touchParents()},S.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},S.prototype.getType=function(q){if(this.ref._definition)return(S=this.ref._definition).schema[S.fieldsByIndex[q]];var S,b=(S=this.parent._definition).schema[S.fieldsByIndex[this.parentIndex]];return Object.values(b)[0]},S.prototype.getChildrenFilter=function(){var q=this.parent._definition.childFilters;return q&&q[this.parentIndex]},S.prototype.getValue=function(q){return this.ref.getByIndex(q)},S.prototype.delete=function(S){var b="number"===typeof S?S:this.indexes[S];if(void 0!==b){var z=this.getValue(b);this.changes.set(b,{op:q.OPERATION.DELETE,index:b}),this.allChanges.delete(b),delete this.caches[b],z&&z.$changes&&(z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(S," (").concat(b,")"))},S.prototype.discard=function(S,b){var z=this;void 0===S&&(S=!1),void 0===b&&(b=!1),this.ref instanceof Jq||this.changes.forEach((function(S){if(S.op===q.OPERATION.DELETE){var b=z.ref.getIndex(S.index);delete z.indexes[b]}})),this.changes.clear(),this.changed=S,b&&this.allChanges.clear(),this.currentCustomOperation=0},S.prototype.discardAll=function(){var q=this;this.changes.forEach((function(S){var b=q.getValue(S.index);b&&b.$changes&&b.$changes.discardAll()})),this.discard()},S.prototype.cache=function(q,S){this.caches[q]=S},S.prototype.clone=function(){return new S(this.ref,this.parent,this.root)},S.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},S.prototype.assertValidIndex=function(q,S){if(void 0===q)throw new Error('ChangeTree: missing index for field "'.concat(S,'"'))},S}();function I(q,S,b,z){return q[S]||(q[S]=[]),q[S].push(b),null===z||void 0===z||z.forEach((function(q,S){return b(q,S)})),function(){return l(q[S],q[S].indexOf(b))}}function V(S){var b=this,z="string"!==typeof this.$changes.getType();this.$items.forEach((function(C,v){S.push({refId:b.$changes.refId,op:q.OPERATION.DELETE,field:v,value:void 0,previousValue:C}),z&&b.$changes.root.removeRef(C.$changes.refId)}))}function l(q,S){if(-1===S||S>=q.length)return!1;for(var b=q.length-1,z=S;z<b;z++)q[z]=q[z+1];return q.length=b,!0}var y=function(q,S){var b=q.toString(),z=S.toString();return b<z?-1:b>z?1:0};function R(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,S){return"symbol"===typeof S||isNaN(S)?q[S]:q.at(S)},set:function(q,S,b){if("symbol"===typeof S||isNaN(S))q[S]=b;else{var z=Array.from(q.$items.keys()),C=parseInt(z[S]||S);void 0===b||null===b?q.deleteAt(C):q.setAt(C,b)}return!0},deleteProperty:function(q,S){return"number"===typeof S?q.deleteAt(S):delete q[S],!0}})}var G=function(){function S(){for(var q=[],S=0;S<arguments.length;S++)q[S]=arguments[S];this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,q)}return S.prototype.mg=function(S,b){return void 0===b&&(b=!0),I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,S,b?this.$items:void 0)},S.prototype.qb=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,S)},S.is=function(q){return Array.isArray(q)||void 0!==q.array},Object.defineProperty(S.prototype,"length",{get:function(){return this.$items.size},set:function(q){0===q?this.clear():this.splice(q,this.length-q)},enumerable:!1,configurable:!0}),S.prototype.push=function(){for(var q,S=this,b=[],z=0;z<arguments.length;z++)b[z]=arguments[z];return b.forEach((function(b){q=S.$refId++,S.setAt(q,b)})),q},S.prototype.pop=function(){var q=Array.from(this.$indexes.values()).pop();if(void 0!==q){this.$changes.delete(q),this.$indexes.delete(q);var S=this.$items.get(q);return this.$items.delete(q),S}},S.prototype.at=function(q){var S=Array.from(this.$items.keys())[q];return this.$items.get(S)},S.prototype.setAt=function(S,b){var z,C;if(void 0!==b&&null!==b){if(this.$items.get(S)!==b){void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,S);var v=null!==(C=null===(z=this.$changes.indexes[S])||void 0===z?void 0:z.op)&&void 0!==C?C:q.OPERATION.ADD;this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,b),this.$changes.change(S,v)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},S.prototype.deleteAt=function(q){var S=Array.from(this.$items.keys())[q];return void 0!==S&&this.$deleteAt(S)},S.prototype.$deleteAt=function(q){return this.$changes.delete(q),this.$indexes.delete(q),this.$items.delete(q)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.concat=function(){for(var q,b=[],z=0;z<arguments.length;z++)b[z]=arguments[z];return new(S.bind.apply(S,C([void 0],(q=Array.from(this.$items.values())).concat.apply(q,b),!1)))},S.prototype.join=function(q){return Array.from(this.$items.values()).join(q)},S.prototype.reverse=function(){var q=this,S=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(b,z){q.setAt(S[z],b)})),this},S.prototype.shift=function(){var q=Array.from(this.$items.keys()).shift();if(void 0!==q){var S=this.$items.get(q);return this.$deleteAt(q),S}},S.prototype.slice=function(q,b){var z=new S;return z.push.apply(z,Array.from(this.$items.values()).slice(q,b)),z},S.prototype.sort=function(q){var S=this;void 0===q&&(q=y);var b=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(q).forEach((function(q,z){S.setAt(b[z],q)})),this},S.prototype.splice=function(q,S){void 0===S&&(S=this.length-q);for(var b=Array.from(this.$items.keys()),z=[],C=q;C<q+S;C++)z.push(this.$items.get(b[C])),this.$deleteAt(b[C]);return z},S.prototype.unshift=function(){for(var q=this,S=[],b=0;b<arguments.length;b++)S[b]=arguments[b];var z=this.length,C=S.length,v=Array.from(this.$items.values());return S.forEach((function(S,b){q.setAt(b,S)})),v.forEach((function(S,b){q.setAt(C+b,S)})),z+C},S.prototype.indexOf=function(q,S){return Array.from(this.$items.values()).indexOf(q,S)},S.prototype.lastIndexOf=function(q,S){return void 0===S&&(S=this.length-1),Array.from(this.$items.values()).lastIndexOf(q,S)},S.prototype.every=function(q,S){return Array.from(this.$items.values()).every(q,S)},S.prototype.some=function(q,S){return Array.from(this.$items.values()).some(q,S)},S.prototype.forEach=function(q,S){Array.from(this.$items.values()).forEach(q,S)},S.prototype.map=function(q,S){return Array.from(this.$items.values()).map(q,S)},S.prototype.filter=function(q,S){return Array.from(this.$items.values()).filter(q,S)},S.prototype.reduce=function(q,S){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},S.prototype.reduceRight=function(q,S){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},S.prototype.find=function(q,S){return Array.from(this.$items.values()).find(q,S)},S.prototype.findIndex=function(q,S){return Array.from(this.$items.values()).findIndex(q,S)},S.prototype.fill=function(q,S,b){throw new Error("ArraySchema#fill() not implemented")},S.prototype.copyWithin=function(q,S,b){throw new Error("ArraySchema#copyWithin() not implemented")},S.prototype.toString=function(){return this.$items.toString()},S.prototype.toLocaleString=function(){return this.$items.toLocaleString()},S.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},S.prototype.includes=function(q,S){return Array.from(this.$items.values()).includes(q,S)},S.prototype.flatMap=function(q,S){throw new Error("ArraySchema#flatMap() is not supported.")},S.prototype.flat=function(q){throw new Error("ArraySchema#flat() is not supported.")},S.prototype.findLast=function(){var q=Array.from(this.$items.values());return q.findLast.apply(q,arguments)},S.prototype.findLastIndex=function(){var q=Array.from(this.$items.values());return q.findLastIndex.apply(q,arguments)},S.prototype.setIndex=function(q,S){this.$indexes.set(q,S)},S.prototype.getIndex=function(q){return this.$indexes.get(q)},S.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},S.prototype.deleteByIndex=function(q){var S=this.$indexes.get(q);this.$items.delete(S),this.$indexes.delete(q)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){return this.toArray().map((function(q){return"function"===typeof q.toJSON?q.toJSON():q}))},S.prototype.clone=function(q){return q?new(S.bind.apply(S,C([void 0],Array.from(this.$items.values()),!1))):new(S.bind.apply(S,C([void 0],this.map((function(q){return q.$changes?q.clone():q})),!1)))},S}();function Z(q){return q.$proxy=!0,q=new Proxy(q,{get:function(q,S){return"symbol"!==typeof S&&"undefined"===typeof q[S]?q.get(S):q[S]},set:function(q,S,b){return"symbol"!==typeof S&&-1===S.indexOf("$")&&"mg"!==S&&"qb"!==S&&"onChange"!==S?q.set(S,b):q[S]=b,!0},deleteProperty:function(q,S){return q.delete(S),!0}})}var H=function(){function S(q){var b=this;if(this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q)if(q instanceof Map||q instanceof S)q.forEach((function(q,S){return b.set(S,q)}));else for(var z in q)this.set(z,q[z])}return S.prototype.mg=function(S,b){return void 0===b&&(b=!0),I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,S,b?this.$items:void 0)},S.prototype.qb=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,S)},S.is=function(q){return void 0!==q.map},S.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(S.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(S,Symbol.species,{get:function(){return S},enumerable:!1,configurable:!0}),S.prototype.set=function(S,b){if(void 0===b||null===b)throw new Error("MapSchema#set('".concat(S,"', ").concat(b,"): trying to set ").concat(b," value on '").concat(S,"'."));S=S.toString();var z="undefined"!==typeof this.$changes.indexes[S],C=z?this.$changes.indexes[S]:this.$refId++,v=z?q.OPERATION.REPLACE:q.OPERATION.ADD,U=void 0!==b.$changes;if(U&&b.$changes.setParent(this,this.$changes.root,C),z){if(!U&&this.$items.get(S)===b)return;U&&this.$items.get(S)!==b&&(v=q.OPERATION.ADD)}else this.$changes.indexes[S]=C,this.$indexes.set(C,S);return this.$items.set(S,b),this.$changes.change(S,v),this},S.prototype.get=function(q){return this.$items.get(q)},S.prototype.delete=function(q){return this.$changes.delete(q),this.$items.delete(q)},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(q){return this.$items.has(q)},S.prototype.forEach=function(q){this.$items.forEach(q)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.keys=function(){return this.$items.keys()},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(q,S){this.$indexes.set(q,S)},S.prototype.getIndex=function(q){return this.$indexes.get(q)},S.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},S.prototype.deleteByIndex=function(q){var S=this.$indexes.get(q);this.$items.delete(S),this.$indexes.delete(q)},S.prototype.toJSON=function(){var q={};return this.forEach((function(S,b){q[b]="function"===typeof S.toJSON?S.toJSON():S})),q},S.prototype.clone=function(q){var b;return q?b=Object.assign(new S,this):(b=new S,this.forEach((function(q,S){q.$changes?b.set(S,q.clone()):b.set(S,q)}))),b},S}(),Q={};function k(q,S){Q[q]=S}function W(q){return Q[q]}var N=function(){function q(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return q.create=function(S){var b=new q;return b.schema=Object.assign({},S&&S.schema||{}),b.indexes=Object.assign({},S&&S.indexes||{}),b.fieldsByIndex=Object.assign({},S&&S.fieldsByIndex||{}),b.descriptors=Object.assign({},S&&S.descriptors||{}),b.deprecated=Object.assign({},S&&S.deprecated||{}),b},q.prototype.addField=function(q,S){var b=this.getNextFieldIndex();this.fieldsByIndex[b]=q,this.indexes[q]=b,this.schema[q]=Array.isArray(S)?{array:S[0]}:S},q.prototype.hasField=function(q){return void 0!==this.indexes[q]},q.prototype.addFilter=function(q,S){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[q]]=S,this.indexesWithFilters.push(this.indexes[q]),!0},q.prototype.addChildrenFilter=function(q,S){var b=this.indexes[q],z=this.schema[q];if(W(Object.keys(z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[b]=S,!0;console.warn("@filterChildren: field '".concat(q,"' can't have children. Ignoring filter."))},q.prototype.getChildrenFilter=function(q){return this.childFilters&&this.childFilters[this.indexes[q]]},q.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},q}();function u(q){return q._context&&q._context.useFilters}var X=function(){function q(){this.types={},this.schemas=new Map,this.useFilters=!1}return q.prototype.has=function(q){return this.schemas.has(q)},q.prototype.get=function(q){return this.types[q]},q.prototype.add=function(q,S){void 0===S&&(S=this.schemas.size),q._definition=N.create(q._definition),q._typeid=S,this.types[S]=q,this.schemas.set(q,S)},q.create=function(S){return void 0===S&&(S={}),function(b){return S.context||(S.context=new q),B(b,S)}},q}(),T=new X;function B(q,S){return void 0===S&&(S={}),function(b,z){var v=S.context||T,U=b.constructor;if(U._context=v,!q)throw new Error("".concat(U.name,': @type() reference provided for "').concat(z,"\" is undefined. Make sure you don't have any circular dependencies."));v.has(U)||v.add(U);var g=U._definition;if(g.addField(z,q),g.descriptors[z]){if(g.deprecated[z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(z,"' definition on '").concat(U.name,"'.\nCheck @type() annotation"))}catch(Q){var r=Q.stack.split("\n")[4].trim();throw new Error("".concat(Q.message," ").concat(r))}}var I=G.is(q),V=!I&&H.is(q);if("string"!==typeof q&&!Jq.is(q)){var l=Object.values(q)[0];"string"===typeof l||v.has(l)||v.add(l)}if(S.manual)g.descriptors[z]={enumerable:!0,configurable:!0,writable:!0};else{var y="_".concat(z);g.descriptors[y]={enumerable:!1,configurable:!1,writable:!0},g.descriptors[z]={get:function(){return this[y]},set:function(q){q!==this[y]&&(void 0!==q&&null!==q?(!I||q instanceof G||(q=new(G.bind.apply(G,C([void 0],q,!1)))),!V||q instanceof H||(q=new H(q)),void 0===q.$proxy&&(V?q=Z(q):I&&(q=R(q))),this.$changes.change(z),q.$changes&&q.$changes.setParent(this,this.$changes.root,this._definition.indexes[z])):this[y]&&this.$changes.delete(z),this[y]=q)},enumerable:!0,configurable:!0}}}}function t(q){return function(S,b){var z=S.constructor;z._definition.addFilter(b,q)&&(z._context.useFilters=!0)}}function f(q){return function(S,b){var z=S.constructor;z._definition.addChildrenFilter(b,q)&&(z._context.useFilters=!0)}}function m(q){return void 0===q&&(q=!0),function(S,b){var z=S.constructor._definition;z.deprecated[b]=!0,q&&(z.descriptors[b]={get:function(){throw new Error("".concat(b," is deprecated."))},set:function(q){},enumerable:!1,configurable:!0})}}function E(q,S,b){for(var z in void 0===b&&(b={}),b.context||(b.context=q._context||b.context||T),S)B(S[z],b)(q.prototype,z);return q}function e(q){for(var S=0,b=0,z=0,C=q.length;z<C;z++)(S=q.charCodeAt(z))<128?b+=1:S<2048?b+=2:S<55296||S>=57344?b+=3:(z++,b+=4);return b}function i(q,S,b){for(var z=0,C=0,v=b.length;C<v;C++)(z=b.charCodeAt(C))<128?q[S++]=z:z<2048?(q[S++]=192|z>>6,q[S++]=128|63&z):z<55296||z>=57344?(q[S++]=224|z>>12,q[S++]=128|z>>6&63,q[S++]=128|63&z):(C++,z=65536+((1023&z)<<10|1023&b.charCodeAt(C)),q[S++]=240|z>>18,q[S++]=128|z>>12&63,q[S++]=128|z>>6&63,q[S++]=128|63&z)}function J(q,S){q.push(255&S)}function L(q,S){q.push(255&S)}function d(q,S){q.push(255&S),q.push(S>>8&255)}function K(q,S){q.push(255&S),q.push(S>>8&255)}function D(q,S){q.push(255&S),q.push(S>>8&255),q.push(S>>16&255),q.push(S>>24&255)}function x(q,S){var b=S>>24,z=S>>16,C=S>>8,v=S;q.push(255&v),q.push(255&C),q.push(255&z),q.push(255&b)}function F(q,S){var b=Math.floor(S/Math.pow(2,32));x(q,S>>>0),x(q,b)}function a(q,S){var b=S/Math.pow(2,32)|0;x(q,S>>>0),x(q,b)}function n(q,S){P(q,S)}function o(q,S){h(q,S)}var s=new Int32Array(2),A=new Float32Array(s.buffer),w=new Float64Array(s.buffer);function P(q,S){A[0]=S,D(q,s[0])}function h(q,S){w[0]=S,D(q,s[0]),D(q,s[1])}function O(q,S){return L(q,S?1:0)}function j(q,S){S||(S="");var b=e(S),z=0;if(b<32)q.push(160|b),z=1;else if(b<256)q.push(217),L(q,b),z=2;else if(b<65536)q.push(218),K(q,b),z=3;else{if(!(b<4294967296))throw new Error("String too long");q.push(219),x(q,b),z=5}return i(q,q.length,S),z+b}function M(q,S){return isNaN(S)?M(q,0):isFinite(S)?S!==(0|S)?(q.push(203),h(q,S),9):S>=0?S<128?(L(q,S),1):S<256?(q.push(204),L(q,S),2):S<65536?(q.push(205),K(q,S),3):S<4294967296?(q.push(206),x(q,S),5):(q.push(207),a(q,S),9):S>=-32?(q.push(224|S+32),1):S>=-128?(q.push(208),J(q,S),2):S>=-32768?(q.push(209),d(q,S),3):S>=-2147483648?(q.push(210),D(q,S),5):(q.push(211),F(q,S),9):M(q,S>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:i,int8:J,uint8:L,int16:d,uint16:K,int32:D,uint32:x,int64:F,uint64:a,float32:n,float64:o,writeFloat32:P,writeFloat64:h,boolean:O,string:j,number:M});function Y(q,S,b){for(var z="",C=0,v=S,U=S+b;v<U;v++){var g=q[v];0!==(128&g)?192!==(224&g)?224!==(240&g)?240!==(248&g)?console.error("Invalid byte "+g.toString(16)):(C=(7&g)<<18|(63&q[++v])<<12|(63&q[++v])<<6|63&q[++v])>=65536?(C-=65536,z+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):z+=String.fromCharCode(C):z+=String.fromCharCode((15&g)<<12|(63&q[++v])<<6|63&q[++v]):z+=String.fromCharCode((31&g)<<6|63&q[++v]):z+=String.fromCharCode(g)}return z}function c(q,S){return qq(q,S)<<24>>24}function qq(q,S){return q[S.offset++]}function Sq(q,S){return bq(q,S)<<16>>16}function bq(q,S){return q[S.offset++]|q[S.offset++]<<8}function zq(q,S){return q[S.offset++]|q[S.offset++]<<8|q[S.offset++]<<16|q[S.offset++]<<24}function Cq(q,S){return zq(q,S)>>>0}function vq(q,S){return yq(q,S)}function Uq(q,S){return Rq(q,S)}function gq(q,S){var b=Cq(q,S);return zq(q,S)*Math.pow(2,32)+b}function rq(q,S){var b=Cq(q,S);return Cq(q,S)*Math.pow(2,32)+b}var Iq=new Int32Array(2),Vq=new Float32Array(Iq.buffer),lq=new Float64Array(Iq.buffer);function yq(q,S){return Iq[0]=zq(q,S),Vq[0]}function Rq(q,S){return Iq[0]=zq(q,S),Iq[1]=zq(q,S),lq[0]}function Gq(q,S){return qq(q,S)>0}function Zq(q,S){var b,z=q[S.offset++];z<192?b=31&z:217===z?b=qq(q,S):218===z?b=bq(q,S):219===z&&(b=Cq(q,S));var C=Y(q,S.offset,b);return S.offset+=b,C}function Hq(q,S){var b=q[S.offset];return b<192&&b>160||217===b||218===b||219===b}function Qq(q,S){var b=q[S.offset++];return b<128?b:202===b?yq(q,S):203===b?Rq(q,S):204===b?qq(q,S):205===b?bq(q,S):206===b?Cq(q,S):207===b?rq(q,S):208===b?c(q,S):209===b?Sq(q,S):210===b?zq(q,S):211===b?gq(q,S):b>223?-1*(255-b+1):void 0}function kq(q,S){var b=q[S.offset];return b<128||b>=202&&b<=211}function Wq(q,S){return q[S.offset]<160}function Nq(q,S){return q[S.offset-1]===U&&(q[S.offset]<128||q[S.offset]>=202&&q[S.offset]<=211)}var uq=Object.freeze({__proto__:null,int8:c,uint8:qq,int16:Sq,uint16:bq,int32:zq,uint32:Cq,float32:vq,float64:Uq,int64:gq,uint64:rq,readFloat32:yq,readFloat64:Rq,boolean:Gq,string:Zq,stringCheck:Hq,number:Qq,numberCheck:kq,arrayCheck:Wq,switchStructureCheck:Nq}),Xq=function(){function S(q){var S=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return S.add(q)}))}return S.prototype.mg=function(S,b){return void 0===b&&(b=!0),I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,S,b?this.$items:void 0)},S.prototype.qb=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,S)},S.is=function(q){return void 0!==q.collection},S.prototype.add=function(q){var S=this.$refId++;return void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,S),this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,q),this.$changes.change(S),S},S.prototype.at=function(q){var S=Array.from(this.$items.keys())[q];return this.$items.get(S)},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(q){for(var S,b,z=this.$items.entries();(b=z.next())&&!b.done;)if(q===b.value[1]){S=b.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(q){return Array.from(this.$items.values()).some((function(S){return S===q}))},S.prototype.forEach=function(q){var S=this;this.$items.forEach((function(b,z,C){return q(b,z,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(q,S){this.$indexes.set(q,S)},S.prototype.getIndex=function(q){return this.$indexes.get(q)},S.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},S.prototype.deleteByIndex=function(q){var S=this.$indexes.get(q);this.$items.delete(S),this.$indexes.delete(q)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var q=[];return this.forEach((function(S,b){q.push("function"===typeof S.toJSON?S.toJSON():S)})),q},S.prototype.clone=function(q){var b;return q?b=Object.assign(new S,this):(b=new S,this.forEach((function(q){q.$changes?b.add(q.clone()):b.add(q)}))),b},S}(),Tq=function(){function S(q){var S=this;this.$changes=new r(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,q&&q.forEach((function(q){return S.add(q)}))}return S.prototype.mg=function(S,b){return void 0===b&&(b=!0),I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.ADD,S,b?this.$items:void 0)},S.prototype.qb=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,S)},S.prototype.onChange=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,S)},S.is=function(q){return void 0!==q.set},S.prototype.add=function(S){var b,z;if(this.has(S))return!1;var C=this.$refId++;void 0!==S.$changes&&S.$changes.setParent(this,this.$changes.root,C);var v=null!==(z=null===(b=this.$changes.indexes[C])||void 0===b?void 0:b.op)&&void 0!==z?z:q.OPERATION.ADD;return this.$changes.indexes[C]=C,this.$indexes.set(C,C),this.$items.set(C,S),this.$changes.change(C,v),C},S.prototype.entries=function(){return this.$items.entries()},S.prototype.delete=function(q){for(var S,b,z=this.$items.entries();(b=z.next())&&!b.done;)if(q===b.value[1]){S=b.value[0];break}return void 0!==S&&(this.$changes.delete(S),this.$indexes.delete(S),this.$items.delete(S))},S.prototype.clear=function(S){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),S&&V.call(this,S),this.$items.clear(),this.$changes.operation({index:0,op:q.OPERATION.CLEAR}),this.$changes.touchParents()},S.prototype.has=function(q){for(var S,b=this.$items.values(),z=!1;(S=b.next())&&!S.done;)if(q===S.value){z=!0;break}return z},S.prototype.forEach=function(q){var S=this;this.$items.forEach((function(b,z,C){return q(b,z,S)}))},S.prototype.values=function(){return this.$items.values()},Object.defineProperty(S.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),S.prototype.setIndex=function(q,S){this.$indexes.set(q,S)},S.prototype.getIndex=function(q){return this.$indexes.get(q)},S.prototype.getByIndex=function(q){return this.$items.get(this.$indexes.get(q))},S.prototype.deleteByIndex=function(q){var S=this.$indexes.get(q);this.$items.delete(S),this.$indexes.delete(q)},S.prototype.toArray=function(){return Array.from(this.$items.values())},S.prototype.toJSON=function(){var q=[];return this.forEach((function(S,b){q.push("function"===typeof S.toJSON?S.toJSON():S)})),q},S.prototype.clone=function(q){var b;return q?b=Object.assign(new S,this):(b=new S,this.forEach((function(q){q.$changes?b.add(q.clone()):b.add(q)}))),b},S}(),Bq=function(){function q(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return q.prototype.addRefId=function(q){this.refIds.has(q)||(this.refIds.add(q),this.containerIndexes.set(q,new Set))},q.get=function(S){return void 0===S.$filterState&&(S.$filterState=new q),S.$filterState},q}(),tq=function(){function q(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return q.prototype.getNextUniqueId=function(){return this.nextUniqueId++},q.prototype.addRef=function(q,S,b){void 0===b&&(b=!0),this.refs.set(q,S),b&&(this.refCounts[q]=(this.refCounts[q]||0)+1)},q.prototype.removeRef=function(q){this.refCounts[q]=this.refCounts[q]-1,this.deletedRefs.add(q)},q.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},q.prototype.garbageCollectDeletedRefs=function(){var q=this;this.deletedRefs.forEach((function(S){if(!(q.refCounts[S]>0)){var b=q.refs.get(S);if(b instanceof Jq)for(var z in b._definition.schema)"string"!==typeof b._definition.schema[z]&&b[z]&&b[z].$changes&&q.removeRef(b[z].$changes.refId);else{var C=b.$changes.parent._definition,v=C.schema[C.fieldsByIndex[b.$changes.parentIndex]];"function"===typeof Object.values(v)[0]&&Array.from(b.values()).forEach((function(S){return q.removeRef(S.$changes.refId)}))}q.refs.delete(S),delete q.refCounts[S]}})),this.deletedRefs.clear()},q}(),fq=function(q){function S(){return null!==q&&q.apply(this,arguments)||this}return b(S,q),S}(Error);function mq(q,S,b,z){var C,v=!1;switch(S){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":C="number",isNaN(q)&&console.log('trying to encode "NaN" in '.concat(b.constructor.name,"#").concat(z));break;case"string":C="string",v=!0;break;case"boolean":return}if(typeof q!==C&&(!v||v&&null!==q)){var U="'".concat(JSON.stringify(q),"'").concat(q&&q.constructor&&" (".concat(q.constructor.name,")")||"");throw new fq("a '".concat(C,"' was expected, but ").concat(U," was provided in ").concat(b.constructor.name,"#").concat(z))}}function Eq(q,S,b,z){if(!(q instanceof S))throw new fq("a '".concat(S.name,"' was expected, but '").concat(q.constructor.name,"' was provided in ").concat(b.constructor.name,"#").concat(z))}function eq(q,S,b,z,C){mq(b,q,z,C);var v=p[q];if(!v)throw new fq("a '".concat(q,"' was expected, but ").concat(b," was provided in ").concat(z.constructor.name,"#").concat(C));v(S,b)}function iq(q,S,b){return uq[q](S,b)}var Jq=function(){function S(){for(var q=[],S=0;S<arguments.length;S++)q[S]=arguments[S];Object.defineProperties(this,{$changes:{value:new r(this,void 0,new tq),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var b=this._definition.descriptors;b&&Object.defineProperties(this,b),q[0]&&this.assign(q[0])}return S.onError=function(q){console.error(q)},S.is=function(q){return q._definition&&void 0!==q._definition.schema},S.prototype.onChange=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.REPLACE,S)},S.prototype.qb=function(S){return I(this.$callbacks||(this.$callbacks=[]),q.OPERATION.DELETE,S)},S.prototype.assign=function(q){return Object.assign(this,q),this},Object.defineProperty(S.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),S.prototype.setDirty=function(q,S){this.$changes.change(q,S)},S.prototype.listen=function(q,S,b){var z=this;return void 0===b&&(b=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[q]||(this.$callbacks[q]=[]),this.$callbacks[q].push(S),b&&void 0!==this[q]&&S(this[q],void 0),function(){return l(z.$callbacks[q],z.$callbacks[q].indexOf(S))}},S.prototype.decode=function(b,z,C){var v;void 0===z&&(z={offset:0}),void 0===C&&(C=this);var g=[],r=this.$changes.root,I=b.length,V=0;for(r.refs.set(V,this);z.offset<I;){var l=b[z.offset++];if(l!=U){var y=C.$changes,R=void 0!==C._definition,Z=R?l>>6<<6:l;if(Z!==q.OPERATION.CLEAR){var Q=R?l%(Z||255):Qq(b,z),k=R?C._definition.fieldsByIndex[Q]:"",N=y.getType(Q),u=void 0,X=void 0,T=void 0;if(R?X=C["_".concat(k)]:(X=C.getByIndex(Q),(Z&q.OPERATION.ADD)===q.OPERATION.ADD?(T=C instanceof H?Zq(b,z):Q,C.setIndex(Q,T)):T=C.getIndex(Q)),(Z&q.OPERATION.DELETE)===q.OPERATION.DELETE&&(Z!==q.OPERATION.DELETE_AND_ADD&&C.deleteByIndex(Q),X&&X.$changes&&r.removeRef(X.$changes.refId),u=null),void 0!==k){if(Z===q.OPERATION.DELETE);else if(S.is(N)){var B=Qq(b,z);if(u=r.refs.get(B),Z!==q.OPERATION.REPLACE){var t=this.getSchemaType(b,z,N);u||((u=this.createTypeInstance(t)).$changes.refId=B,X&&(u.$callbacks=X.$callbacks,X.$changes.refId&&B!==X.$changes.refId&&r.removeRef(X.$changes.refId))),r.addRef(B,u,u!==X)}}else if("string"===typeof N)u=iq(N,b,z);else{var f=W(Object.keys(N)[0]),m=Qq(b,z),E=r.refs.has(m)?X||r.refs.get(m):new f.constructor;if((u=E.clone(!0)).$changes.refId=m,X&&(u.$callbacks=X.$callbacks,X.$changes.refId&&m!==X.$changes.refId)){r.removeRef(X.$changes.refId);for(var e=X.entries(),i=void 0;(i=e.next())&&!i.done;){var J=(v=i.value)[0],L=v[1];g.push({refId:m,op:q.OPERATION.DELETE,field:J,value:void 0,previousValue:L})}}r.addRef(m,u,E!==X)}if(null!==u&&void 0!==u)if(u.$changes&&u.$changes.setParent(y.ref,y.root,Q),C instanceof S)C[k]=u;else if(C instanceof H)J=T,C.$items.set(J,u),C.$changes.allChanges.add(Q);else if(C instanceof G)C.setAt(Q,u);else if(C instanceof Xq){var d=C.add(u);C.setIndex(Q,d)}else C instanceof Tq&&!1!==(d=C.add(u))&&C.setIndex(Q,d);X!==u&&g.push({refId:V,op:Z,field:k,dynamicIndex:T,value:u,previousValue:X})}else{console.warn("@colyseus/schema: definition mismatch");for(var K={offset:z.offset};z.offset<I&&(!Nq(b,z)||(K.offset=z.offset+1,!r.refs.has(Qq(b,K))));)z.offset++}}else C.clear(g)}else{V=Qq(b,z);var D=r.refs.get(V);if(!D)throw new Error('"refId" not found: '.concat(V));C=D}}return this._triggerChanges(g),r.garbageCollectDeletedRefs(),g},S.prototype.encode=function(b,z,C){void 0===b&&(b=!1),void 0===z&&(z=[]),void 0===C&&(C=!1);for(var v=this.$changes,g=new WeakSet,r=[v],I=1,V=0;V<I;V++){var l=r[V],y=l.ref,R=y instanceof S;l.ensureRefId(),g.add(l),l!==v&&(l.changed||b)&&(L(z,U),M(z,l.refId));for(var G=b?Array.from(l.allChanges):Array.from(l.changes.values()),Z=0,Q=G.length;Z<Q;Z++){var k=b?{op:q.OPERATION.ADD,index:G[Z]}:G[Z],N=k.index,u=R?y._definition.fieldsByIndex&&y._definition.fieldsByIndex[N]:N,X=z.length;if(k.op!==q.OPERATION.TOUCH)if(R)L(z,N|k.op);else{if(L(z,k.op),k.op===q.OPERATION.CLEAR)continue;M(z,N)}if(R||(k.op&q.OPERATION.ADD)!=q.OPERATION.ADD||y instanceof H&&j(z,l.ref.$indexes.get(N)),k.op!==q.OPERATION.DELETE){var T=l.getType(N),B=l.getValue(N);if(B&&B.$changes&&!g.has(B.$changes)&&(r.push(B.$changes),B.$changes.ensureRefId(),I++),k.op!==q.OPERATION.TOUCH){if(S.is(T))Eq(B,T,y,u),M(z,B.$changes.refId),(k.op&q.OPERATION.ADD)===q.OPERATION.ADD&&this.tryEncodeTypeId(z,T,B.constructor);else if("string"===typeof T)eq(T,z,B,y,u);else{var t=W(Object.keys(T)[0]);Eq(y["_".concat(u)],t.constructor,y,u),M(z,B.$changes.refId)}C&&l.cache(N,z.slice(X))}}}b||C||l.discard()}return z},S.prototype.encodeAll=function(q){return this.encode(!0,[],q)},S.prototype.applyFilters=function(b,z){var C,v;void 0===z&&(z=!1);for(var g=this,r=new Set,I=Bq.get(b),V=[this.$changes],l=1,y=[],R=function(R){var G=V[R];if(r.has(G.refId))return"continue";var Z=G.ref,Q=Z instanceof S;L(y,U),M(y,G.refId);var k=I.refIds.has(G),W=z||!k;I.addRefId(G);var N=I.containerIndexes.get(G),u=W?Array.from(G.allChanges):Array.from(G.changes.values());!z&&Q&&Z._definition.indexesWithFilters&&Z._definition.indexesWithFilters.forEach((function(S){!N.has(S)&&G.allChanges.has(S)&&(W?u.push(S):u.push({op:q.OPERATION.ADD,index:S}))}));for(var X=0,T=u.length;X<T;X++){var B=W?{op:q.OPERATION.ADD,index:u[X]}:u[X];if(B.op!==q.OPERATION.CLEAR){var t=B.index;if(B.op!==q.OPERATION.DELETE){var f=G.getValue(t),m=G.getType(t);if(Q){if((E=Z._definition.filters&&Z._definition.filters[t])&&!E.call(Z,b,f,g)){f&&f.$changes&&r.add(f.$changes.refId);continue}}else{var E,e=G.parent;if((E=G.getChildrenFilter())&&!E.call(e,b,Z.$indexes.get(t),f,g)){f&&f.$changes&&r.add(f.$changes.refId);continue}}if(f.$changes&&(V.push(f.$changes),l++),B.op!==q.OPERATION.TOUCH)if(B.op===q.OPERATION.ADD||Q)y.push.apply(y,null!==(C=G.caches[t])&&void 0!==C?C:[]),N.add(t);else if(N.has(t))y.push.apply(y,null!==(v=G.caches[t])&&void 0!==v?v:[]);else{if(N.add(t),L(y,q.OPERATION.ADD),M(y,t),Z instanceof H){var i=G.ref.$indexes.get(t);j(y,i)}f.$changes?M(y,f.$changes.refId):p[m](y,f)}else f.$changes&&!Q&&(L(y,q.OPERATION.ADD),M(y,t),Z instanceof H&&(i=G.ref.$indexes.get(t),j(y,i)),M(y,f.$changes.refId))}else Q?L(y,B.op|t):(L(y,B.op),M(y,t))}else L(y,B.op)}},G=0;G<l;G++)R(G);return y},S.prototype.clone=function(){var q,S=new this.constructor,b=this._definition.schema;for(var z in b)"object"===typeof this[z]&&"function"===typeof(null===(q=this[z])||void 0===q?void 0:q.clone)?S[z]=this[z].clone():S[z]=this[z];return S},S.prototype.toJSON=function(){var q=this._definition.schema,S=this._definition.deprecated,b={};for(var z in q)S[z]||null===this[z]||"undefined"===typeof this[z]||(b[z]="function"===typeof this[z].toJSON?this[z].toJSON():this["_".concat(z)]);return b},S.prototype.discardAllChanges=function(){this.$changes.discardAll()},S.prototype.getByIndex=function(q){return this[this._definition.fieldsByIndex[q]]},S.prototype.deleteByIndex=function(q){this[this._definition.fieldsByIndex[q]]=void 0},S.prototype.tryEncodeTypeId=function(q,S,b){S._typeid!==b._typeid&&(L(q,g),M(q,b._typeid))},S.prototype.getSchemaType=function(q,S,b){var z;return q[S.offset]===g&&(S.offset++,z=this.constructor._context.get(Qq(q,S))),z||b},S.prototype.createTypeInstance=function(q){var S=new q;return S.$changes.root=this.$changes.root,S},S.prototype._triggerChanges=function(b){for(var z,C,v,U,g,r,I,V,l,y=new Set,R=this.$changes.root.refs,G=function(G){var Z=b[G],H=Z.refId,Q=R.get(H),k=Q.$callbacks;if((Z.op&q.OPERATION.DELETE)===q.OPERATION.DELETE&&Z.previousValue instanceof S&&(null===(C=null===(z=Z.previousValue.$callbacks)||void 0===z?void 0:z[q.OPERATION.DELETE])||void 0===C||C.forEach((function(q){return q()}))),!k)return"continue";if(Q instanceof S){if(!y.has(H))try{null===(v=null===k||void 0===k?void 0:k[q.OPERATION.REPLACE])||void 0===v||v.forEach((function(q){return q()}))}catch(W){S.onError(W)}try{k.hasOwnProperty(Z.field)&&(null===(U=k[Z.field])||void 0===U||U.forEach((function(q){return q(Z.value,Z.previousValue)})))}catch(W){S.onError(W)}}else Z.op===q.OPERATION.ADD&&void 0===Z.previousValue?null===(g=k[q.OPERATION.ADD])||void 0===g||g.forEach((function(q){var S;return q(Z.value,null!==(S=Z.dynamicIndex)&&void 0!==S?S:Z.field)})):Z.op===q.OPERATION.DELETE?void 0!==Z.previousValue&&(null===(r=k[q.OPERATION.DELETE])||void 0===r||r.forEach((function(q){var S;return q(Z.previousValue,null!==(S=Z.dynamicIndex)&&void 0!==S?S:Z.field)}))):Z.op===q.OPERATION.DELETE_AND_ADD&&(void 0!==Z.previousValue&&(null===(I=k[q.OPERATION.DELETE])||void 0===I||I.forEach((function(q){var S;return q(Z.previousValue,null!==(S=Z.dynamicIndex)&&void 0!==S?S:Z.field)}))),null===(V=k[q.OPERATION.ADD])||void 0===V||V.forEach((function(q){var S;return q(Z.value,null!==(S=Z.dynamicIndex)&&void 0!==S?S:Z.field)}))),Z.value!==Z.previousValue&&(null===(l=k[q.OPERATION.REPLACE])||void 0===l||l.forEach((function(q){var S;return q(Z.value,null!==(S=Z.dynamicIndex)&&void 0!==S?S:Z.field)})));y.add(H)},Z=0;Z<b.length;Z++)G(Z)},S._definition=N.create(),S}();function Lq(q){for(var S=[q.$changes],b=1,z={},C=z,v=function(q){var b=S[q];b.changes.forEach((function(q){var S=b.ref,z=q.index,v=S._definition?S._definition.fieldsByIndex[z]:S.$indexes.get(z);C[v]=b.getValue(z)}))},U=0;U<b;U++)v(U);return z}var dq={context:new X},Kq=function(q){function S(){return null!==q&&q.apply(this,arguments)||this}return b(S,q),z([B("string",dq)],S.prototype,"name",void 0),z([B("string",dq)],S.prototype,"type",void 0),z([B("number",dq)],S.prototype,"referencedType",void 0),S}(Jq),Dq=function(q){function S(){var S=null!==q&&q.apply(this,arguments)||this;return S.fields=new G,S}return b(S,q),z([B("number",dq)],S.prototype,"id",void 0),z([B([Kq],dq)],S.prototype,"fields",void 0),S}(Jq),xq=function(q){function S(){var S=null!==q&&q.apply(this,arguments)||this;return S.types=new G,S}return b(S,q),S.encode=function(q){var b=q.constructor,z=new S;z.rootType=b._typeid;var C=function(q,S){for(var b in S){var C=new Kq;C.name=b;var v=void 0;if("string"===typeof S[b])v=S[b];else{var U=S[b],g=void 0;Jq.is(U)?(v="ref",g=S[b]):"string"===typeof U[v=Object.keys(U)[0]]?v+=":"+U[v]:g=U[v],C.referencedType=g?g._typeid:-1}C.type=v,q.fields.push(C)}z.types.push(q)},v=b._context.types;for(var U in v){var g=new Dq;g.id=Number(U),C(g,v[U]._definition.schema)}return z.encodeAll()},S.decode=function(q,z){var C=new X,v=new S;v.decode(q,z);var U=v.types.reduce((function(q,S){var z=function(q){function S(){return null!==q&&q.apply(this,arguments)||this}return b(S,q),S}(Jq),v=S.id;return q[v]=z,C.add(z,v),q}),{});v.types.forEach((function(q){var S=U[q.id];q.fields.forEach((function(q){var b;if(void 0!==q.referencedType){var z=q.type,v=U[q.referencedType];if(!v){var g=q.type.split(":");z=g[0],v=g[1]}"ref"===z?B(v,{context:C})(S.prototype,q.name):B(((b={})[z]=v,b),{context:C})(S.prototype,q.name)}else B(q.type,{context:C})(S.prototype,q.name)}))}));var g=U[v.rootType],r=new g;for(var I in g._definition.schema){var V=g._definition.schema[I];"string"!==typeof V&&(r[I]="function"===typeof V?new V:new(W(Object.keys(V)[0]).constructor))}return r},z([B([Dq],dq)],S.prototype,"types",void 0),z([B("number",dq)],S.prototype,"rootType",void 0),S}(Jq);k("map",{constructor:H}),k("array",{constructor:G}),k("set",{constructor:Tq}),k("collection",{constructor:Xq}),q.ArraySchema=G,q.CollectionSchema=Xq,q.Context=X,q.MapSchema=H,q.Reflection=xq,q.ReflectionField=Kq,q.ReflectionType=Dq,q.Schema=Jq,q.SchemaDefinition=N,q.SetSchema=Tq,q.decode=uq,q.defineTypes=E,q.deprecated=m,q.dumpChanges=Lq,q.encode=p,q.filter=t,q.filterChildren=f,q.hasFilter=u,q.registerType=k,q.type=B,Object.defineProperty(q,"__esModule",{value:!0})}(S)},13230:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13221:(q,S,b)=>{var z=b(13230),C=b(13235),v=Object.hasOwnProperty,U=Object.create(null);for(var g in z)v.call(z,g)&&(U[z[g]]=g);var r=q.exports={to:{},get:{}};function I(q,S,b){return Math.min(Math.max(S,q),b)}function V(q){var S=Math.round(q).toString(16).toUpperCase();return S.length<2?"0"+S:S}r.get=function(q){var S,b;switch(q.substring(0,3).toLowerCase()){case"hsl":S=r.get.hsl(q),b="hsl";break;case"hwb":S=r.get.hwb(q),b="hwb";break;default:S=r.get.rgb(q),b="rgb"}return S?{model:b,value:S}:null},r.get.rgb=function(q){if(!q)return null;var S,b,C,U=[0,0,0,1];if(S=q.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(C=S[2],S=S[1],b=0;b<3;b++){var g=2*b;U[b]=parseInt(S.slice(g,g+2),16)}C&&(U[3]=parseInt(C,16)/255)}else if(S=q.match(/^#([a-f0-9]{3,4})$/i)){for(C=(S=S[1])[3],b=0;b<3;b++)U[b]=parseInt(S[b]+S[b],16);C&&(U[3]=parseInt(C+C,16)/255)}else if(S=q.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(b=0;b<3;b++)U[b]=parseInt(S[b+1],0);S[4]&&(S[5]?U[3]=.01*parseFloat(S[4]):U[3]=parseFloat(S[4]))}else{if(!(S=q.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(S=q.match(/^(\w+)$/))?"transparent"===S[1]?[0,0,0,0]:v.call(z,S[1])?((U=z[S[1]])[3]=1,U):null:null;for(b=0;b<3;b++)U[b]=Math.round(2.55*parseFloat(S[b+1]));S[4]&&(S[5]?U[3]=.01*parseFloat(S[4]):U[3]=parseFloat(S[4]))}for(b=0;b<3;b++)U[b]=I(U[b],0,255);return U[3]=I(U[3],0,1),U},r.get.hsl=function(q){if(!q)return null;var S=q.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var b=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,I(parseFloat(S[2]),0,100),I(parseFloat(S[3]),0,100),I(isNaN(b)?1:b,0,1)]}return null},r.get.hwb=function(q){if(!q)return null;var S=q.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(S){var b=parseFloat(S[4]);return[(parseFloat(S[1])%360+360)%360,I(parseFloat(S[2]),0,100),I(parseFloat(S[3]),0,100),I(isNaN(b)?1:b,0,1)]}return null},r.to.hex=function(){var q=C(arguments);return"#"+V(q[0])+V(q[1])+V(q[2])+(q[3]<1?V(Math.round(255*q[3])):"")},r.to.rgb=function(){var q=C(arguments);return q.length<4||1===q[3]?"rgb("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+")":"rgba("+Math.round(q[0])+", "+Math.round(q[1])+", "+Math.round(q[2])+", "+q[3]+")"},r.to.rgb.percent=function(){var q=C(arguments),S=Math.round(q[0]/255*100),b=Math.round(q[1]/255*100),z=Math.round(q[2]/255*100);return q.length<4||1===q[3]?"rgb("+S+"%, "+b+"%, "+z+"%)":"rgba("+S+"%, "+b+"%, "+z+"%, "+q[3]+")"},r.to.hsl=function(){var q=C(arguments);return q.length<4||1===q[3]?"hsl("+q[0]+", "+q[1]+"%, "+q[2]+"%)":"hsla("+q[0]+", "+q[1]+"%, "+q[2]+"%, "+q[3]+")"},r.to.hwb=function(){var q=C(arguments),S="";return q.length>=4&&1!==q[3]&&(S=", "+q[3]),"hwb("+q[0]+", "+q[1]+"%, "+q[2]+"%"+S+")"},r.to.keyword=function(q){return U[q.slice(0,3)]}},13214:(q,S,b)=>{const z=b(13221),C=b(13248),v=["keyword","gray","hex"],U={};for(const R of Object.keys(C))U[[...C[R].labels].sort().join("")]=R;const g={};function r(q,S){if(!(this instanceof r))return new r(q,S);if(S&&S in v&&(S=null),S&&!(S in C))throw new Error("Unknown model: "+S);let b,I;if(null==q)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(q instanceof r)this.model=q.model,this.color=[...q.color],this.valpha=q.valpha;else if("string"===typeof q){const S=z.get(q);if(null===S)throw new Error("Unable to parse color from string: "+q);this.model=S.model,I=C[this.model].channels,this.color=S.value.slice(0,I),this.valpha="number"===typeof S.value[I]?S.value[I]:1}else if(q.length>0){this.model=S||"rgb",I=C[this.model].channels;const b=Array.prototype.slice.call(q,0,I);this.color=y(b,I),this.valpha="number"===typeof q[I]?q[I]:1}else if("number"===typeof q)this.model="rgb",this.color=[q>>16&255,q>>8&255,255&q],this.valpha=1;else{this.valpha=1;const S=Object.keys(q);"alpha"in q&&(S.splice(S.indexOf("alpha"),1),this.valpha="number"===typeof q.alpha?q.alpha:0);const z=S.sort().join("");if(!(z in U))throw new Error("Unable to parse color from object: "+JSON.stringify(q));this.model=U[z];const{labels:v}=C[this.model],g=[];for(b=0;b<v.length;b++)g.push(q[v[b]]);this.color=y(g)}if(g[this.model])for(I=C[this.model].channels,b=0;b<I;b++){const q=g[this.model][b];q&&(this.color[b]=q(this.color[b]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}r.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(q){let S=this.model in z.to?this:this.rgb();S=S.round("number"===typeof q?q:1);const b=1===S.valpha?S.color:[...S.color,this.valpha];return z.to[S.model](b)},percentString(q){const S=this.rgb().round("number"===typeof q?q:1),b=1===S.valpha?S.color:[...S.color,this.valpha];return z.to.rgb.percent(b)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const q={},{channels:S}=C[this.model],{labels:b}=C[this.model];for(let z=0;z<S;z++)q[b[z]]=this.color[z];return 1!==this.valpha&&(q.alpha=this.valpha),q},unitArray(){const q=this.rgb().color;return q[0]/=255,q[1]/=255,q[2]/=255,1!==this.valpha&&q.push(this.valpha),q},unitObject(){const q=this.rgb().object();return q.r/=255,q.g/=255,q.b/=255,1!==this.valpha&&(q.alpha=this.valpha),q},round(q){return q=Math.max(q||0,0),new r([...this.color.map(I(q)),this.valpha],this.model)},alpha(q){return void 0!==q?new r([...this.color,Math.max(0,Math.min(1,q))],this.model):this.valpha},red:V("rgb",0,l(255)),green:V("rgb",1,l(255)),blue:V("rgb",2,l(255)),hue:V(["hsl","hsv","hsl","hwb","hcg"],0,(q=>(q%360+360)%360)),saturationl:V("hsl",1,l(100)),lightness:V("hsl",2,l(100)),saturationv:V("hsv",1,l(100)),value:V("hsv",2,l(100)),chroma:V("hcg",1,l(100)),gray:V("hcg",2,l(100)),white:V("hwb",1,l(100)),wblack:V("hwb",2,l(100)),cyan:V("cmyk",0,l(100)),magenta:V("cmyk",1,l(100)),yellow:V("cmyk",2,l(100)),black:V("cmyk",3,l(100)),x:V("xyz",0,l(95.047)),y:V("xyz",1,l(100)),z:V("xyz",2,l(108.833)),l:V("lab",0,l(100)),a:V("lab",1),b:V("lab",2),keyword(q){return void 0!==q?new r(q):C[this.model].keyword(this.color)},hex(q){return void 0!==q?new r(q):z.to.hex(this.rgb().round().color)},hexa(q){if(void 0!==q)return new r(q);const S=this.rgb().round().color;let b=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===b.length&&(b="0"+b),z.to.hex(S)+b},rgbNumber(){const q=this.rgb().color;return(255&q[0])<<16|(255&q[1])<<8|255&q[2]},luminosity(){const q=this.rgb().color,S=[];for(const[b,z]of q.entries()){const q=z/255;S[b]=q<=.04045?q/12.92:((q+.055)/1.055)**2.4}return.2126*S[0]+.7152*S[1]+.0722*S[2]},contrast(q){const S=this.luminosity(),b=q.luminosity();return S>b?(S+.05)/(b+.05):(b+.05)/(S+.05)},level(q){const S=this.contrast(q);return S>=7?"AAA":S>=4.5?"AA":""},isDark(){const q=this.rgb().color;return(2126*q[0]+7152*q[1]+722*q[2])/1e4<128},isLight(){return!this.isDark()},negate(){const q=this.rgb();for(let S=0;S<3;S++)q.color[S]=255-q.color[S];return q},lighten(q){const S=this.hsl();return S.color[2]+=S.color[2]*q,S},darken(q){const S=this.hsl();return S.color[2]-=S.color[2]*q,S},saturate(q){const S=this.hsl();return S.color[1]+=S.color[1]*q,S},desaturate(q){const S=this.hsl();return S.color[1]-=S.color[1]*q,S},whiten(q){const S=this.hwb();return S.color[1]+=S.color[1]*q,S},blacken(q){const S=this.hwb();return S.color[2]+=S.color[2]*q,S},grayscale(){const q=this.rgb().color,S=.3*q[0]+.59*q[1]+.11*q[2];return r.rgb(S,S,S)},fade(q){return this.alpha(this.valpha-this.valpha*q)},opaquer(q){return this.alpha(this.valpha+this.valpha*q)},rotate(q){const S=this.hsl();let b=S.color[0];return b=(b+q)%360,b=b<0?360+b:b,S.color[0]=b,S},mix(q,S){if(!q||!q.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof q);const b=q.rgb(),z=this.rgb(),C=void 0===S?.5:S,v=2*C-1,U=b.alpha()-z.alpha(),g=((v*U===-1?v:(v+U)/(1+v*U))+1)/2,I=1-g;return r.rgb(g*b.red()+I*z.red(),g*b.green()+I*z.green(),g*b.blue()+I*z.blue(),b.alpha()*C+z.alpha()*(1-C))}};for(const R of Object.keys(C)){if(v.includes(R))continue;const{channels:q}=C[R];r.prototype[R]=function(){if(this.model===R)return new r(this);for(var q=arguments.length,S=new Array(q),b=0;b<q;b++)S[b]=arguments[b];return S.length>0?new r(S,R):new r([...(z=C[this.model][R].raw(this.color),Array.isArray(z)?z:[z]),this.valpha],R);var z},r[R]=function(){for(var S=arguments.length,b=new Array(S),z=0;z<S;z++)b[z]=arguments[z];let C=b[0];return"number"===typeof C&&(C=y(b,q)),new r(C,R)}}function I(q){return function(S){return function(q,S){return Number(q.toFixed(S))}(S,q)}}function V(q,S,b){q=Array.isArray(q)?q:[q];for(const z of q)(g[z]||(g[z]=[]))[S]=b;return q=q[0],function(z){let C;return void 0!==z?(b&&(z=b(z)),C=this[q](),C.color[S]=z,C):(C=this[q]().color[S],b&&(C=b(C)),C)}}function l(q){return function(S){return Math.max(0,Math.min(q,S))}}function y(q,S){for(let b=0;b<S;b++)"number"!==typeof q[b]&&(q[b]=0);return q}q.exports=r},13253:(q,S,b)=>{const z=b(13259),C={};for(const U of Object.keys(z))C[z[U]]=U;const v={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};q.exports=v;for(const U of Object.keys(v)){if(!("channels"in v[U]))throw new Error("missing channels property: "+U);if(!("labels"in v[U]))throw new Error("missing channel labels property: "+U);if(v[U].labels.length!==v[U].channels)throw new Error("channel and label counts mismatch: "+U);const{channels:q,labels:S}=v[U];delete v[U].channels,delete v[U].labels,Object.defineProperty(v[U],"channels",{value:q}),Object.defineProperty(v[U],"labels",{value:S})}v.rgb.hsl=function(q){const S=q[0]/255,b=q[1]/255,z=q[2]/255,C=Math.min(S,b,z),v=Math.max(S,b,z),U=v-C;let g,r;v===C?g=0:S===v?g=(b-z)/U:b===v?g=2+(z-S)/U:z===v&&(g=4+(S-b)/U),g=Math.min(60*g,360),g<0&&(g+=360);const I=(C+v)/2;return r=v===C?0:I<=.5?U/(v+C):U/(2-v-C),[g,100*r,100*I]},v.rgb.hsv=function(q){let S,b,z,C,v;const U=q[0]/255,g=q[1]/255,r=q[2]/255,I=Math.max(U,g,r),V=I-Math.min(U,g,r),l=function(q){return(I-q)/6/V+.5};return 0===V?(C=0,v=0):(v=V/I,S=l(U),b=l(g),z=l(r),U===I?C=z-b:g===I?C=1/3+S-z:r===I&&(C=2/3+b-S),C<0?C+=1:C>1&&(C-=1)),[360*C,100*v,100*I]},v.rgb.hwb=function(q){const S=q[0],b=q[1];let z=q[2];const C=v.rgb.hsl(q)[0],U=1/255*Math.min(S,Math.min(b,z));return z=1-1/255*Math.max(S,Math.max(b,z)),[C,100*U,100*z]},v.rgb.cmyk=function(q){const S=q[0]/255,b=q[1]/255,z=q[2]/255,C=Math.min(1-S,1-b,1-z);return[100*((1-S-C)/(1-C)||0),100*((1-b-C)/(1-C)||0),100*((1-z-C)/(1-C)||0),100*C]},v.rgb.keyword=function(q){const S=C[q];if(S)return S;let b,v=1/0;for(const C of Object.keys(z)){const S=z[C],r=(g=S,((U=q)[0]-g[0])**2+(U[1]-g[1])**2+(U[2]-g[2])**2);r<v&&(v=r,b=C)}var U,g;return b},v.keyword.rgb=function(q){return z[q]},v.rgb.xyz=function(q){let S=q[0]/255,b=q[1]/255,z=q[2]/255;S=S>.04045?((S+.055)/1.055)**2.4:S/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92;return[100*(.4124*S+.3576*b+.1805*z),100*(.2126*S+.7152*b+.0722*z),100*(.0193*S+.1192*b+.9505*z)]},v.rgb.lab=function(q){const S=v.rgb.xyz(q);let b=S[0],z=S[1],C=S[2];b/=95.047,z/=100,C/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*z-16,500*(b-z),200*(z-C)]},v.hsl.rgb=function(q){const S=q[0]/360,b=q[1]/100,z=q[2]/100;let C,v,U;if(0===b)return U=255*z,[U,U,U];C=z<.5?z*(1+b):z+b-z*b;const g=2*z-C,r=[0,0,0];for(let I=0;I<3;I++)v=S+1/3*-(I-1),v<0&&v++,v>1&&v--,U=6*v<1?g+6*(C-g)*v:2*v<1?C:3*v<2?g+(C-g)*(2/3-v)*6:g,r[I]=255*U;return r},v.hsl.hsv=function(q){const S=q[0];let b=q[1]/100,z=q[2]/100,C=b;const v=Math.max(z,.01);z*=2,b*=z<=1?z:2-z,C*=v<=1?v:2-v;return[S,100*(0===z?2*C/(v+C):2*b/(z+b)),100*((z+b)/2)]},v.hsv.rgb=function(q){const S=q[0]/60,b=q[1]/100;let z=q[2]/100;const C=Math.floor(S)%6,v=S-Math.floor(S),U=255*z*(1-b),g=255*z*(1-b*v),r=255*z*(1-b*(1-v));switch(z*=255,C){case 0:return[z,r,U];case 1:return[g,z,U];case 2:return[U,z,r];case 3:return[U,g,z];case 4:return[r,U,z];case 5:return[z,U,g]}},v.hsv.hsl=function(q){const S=q[0],b=q[1]/100,z=q[2]/100,C=Math.max(z,.01);let v,U;U=(2-b)*z;const g=(2-b)*C;return v=b*C,v/=g<=1?g:2-g,v=v||0,U/=2,[S,100*v,100*U]},v.hwb.rgb=function(q){const S=q[0]/360;let b=q[1]/100,z=q[2]/100;const C=b+z;let v;C>1&&(b/=C,z/=C);const U=Math.floor(6*S),g=1-z;v=6*S-U,0!==(1&U)&&(v=1-v);const r=b+v*(g-b);let I,V,l;switch(U){default:case 6:case 0:I=g,V=r,l=b;break;case 1:I=r,V=g,l=b;break;case 2:I=b,V=g,l=r;break;case 3:I=b,V=r,l=g;break;case 4:I=r,V=b,l=g;break;case 5:I=g,V=b,l=r}return[255*I,255*V,255*l]},v.cmyk.rgb=function(q){const S=q[0]/100,b=q[1]/100,z=q[2]/100,C=q[3]/100;return[255*(1-Math.min(1,S*(1-C)+C)),255*(1-Math.min(1,b*(1-C)+C)),255*(1-Math.min(1,z*(1-C)+C))]},v.xyz.rgb=function(q){const S=q[0]/100,b=q[1]/100,z=q[2]/100;let C,v,U;return C=3.2406*S+-1.5372*b+-.4986*z,v=-.9689*S+1.8758*b+.0415*z,U=.0557*S+-.204*b+1.057*z,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,C=Math.min(Math.max(0,C),1),v=Math.min(Math.max(0,v),1),U=Math.min(Math.max(0,U),1),[255*C,255*v,255*U]},v.xyz.lab=function(q){let S=q[0],b=q[1],z=q[2];S/=95.047,b/=100,z/=108.883,S=S>.008856?S**(1/3):7.787*S+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*b-16,500*(S-b),200*(b-z)]},v.lab.xyz=function(q){let S,b,z;b=(q[0]+16)/116,S=q[1]/500+b,z=b-q[2]/200;const C=b**3,v=S**3,U=z**3;return b=C>.008856?C:(b-16/116)/7.787,S=v>.008856?v:(S-16/116)/7.787,z=U>.008856?U:(z-16/116)/7.787,S*=95.047,b*=100,z*=108.883,[S,b,z]},v.lab.lch=function(q){const S=q[0],b=q[1],z=q[2];let C;C=360*Math.atan2(z,b)/2/Math.PI,C<0&&(C+=360);return[S,Math.sqrt(b*b+z*z),C]},v.lch.lab=function(q){const S=q[0],b=q[1],z=q[2]/360*2*Math.PI;return[S,b*Math.cos(z),b*Math.sin(z)]},v.rgb.ansi16=function(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[b,z,C]=q;let U=null===S?v.rgb.hsv(q)[2]:S;if(U=Math.round(U/50),0===U)return 30;let g=30+(Math.round(C/255)<<2|Math.round(z/255)<<1|Math.round(b/255));return 2===U&&(g+=60),g},v.hsv.ansi16=function(q){return v.rgb.ansi16(v.hsv.rgb(q),q[2])},v.rgb.ansi256=function(q){const S=q[0],b=q[1],z=q[2];if(S===b&&b===z)return S<8?16:S>248?231:Math.round((S-8)/247*24)+232;return 16+36*Math.round(S/255*5)+6*Math.round(b/255*5)+Math.round(z/255*5)},v.ansi16.rgb=function(q){let S=q%10;if(0===S||7===S)return q>50&&(S+=3.5),S=S/10.5*255,[S,S,S];const b=.5*(1+~~(q>50));return[(1&S)*b*255,(S>>1&1)*b*255,(S>>2&1)*b*255]},v.ansi256.rgb=function(q){if(q>=232){const S=10*(q-232)+8;return[S,S,S]}let S;q-=16;return[Math.floor(q/36)/5*255,Math.floor((S=q%36)/6)/5*255,S%6/5*255]},v.rgb.hex=function(q){const S=(((255&Math.round(q[0]))<<16)+((255&Math.round(q[1]))<<8)+(255&Math.round(q[2]))).toString(16).toUpperCase();return"000000".substring(S.length)+S},v.hex.rgb=function(q){const S=q.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!S)return[0,0,0];let b=S[0];3===S[0].length&&(b=b.split("").map((q=>q+q)).join(""));const z=parseInt(b,16);return[z>>16&255,z>>8&255,255&z]},v.rgb.hcg=function(q){const S=q[0]/255,b=q[1]/255,z=q[2]/255,C=Math.max(Math.max(S,b),z),v=Math.min(Math.min(S,b),z),U=C-v;let g,r;return g=U<1?v/(1-U):0,r=U<=0?0:C===S?(b-z)/U%6:C===b?2+(z-S)/U:4+(S-b)/U,r/=6,r%=1,[360*r,100*U,100*g]},v.hsl.hcg=function(q){const S=q[1]/100,b=q[2]/100,z=b<.5?2*S*b:2*S*(1-b);let C=0;return z<1&&(C=(b-.5*z)/(1-z)),[q[0],100*z,100*C]},v.hsv.hcg=function(q){const S=q[1]/100,b=q[2]/100,z=S*b;let C=0;return z<1&&(C=(b-z)/(1-z)),[q[0],100*z,100*C]},v.hcg.rgb=function(q){const S=q[0]/360,b=q[1]/100,z=q[2]/100;if(0===b)return[255*z,255*z,255*z];const C=[0,0,0],v=S%1*6,U=v%1,g=1-U;let r=0;switch(Math.floor(v)){case 0:C[0]=1,C[1]=U,C[2]=0;break;case 1:C[0]=g,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=U;break;case 3:C[0]=0,C[1]=g,C[2]=1;break;case 4:C[0]=U,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=g}return r=(1-b)*z,[255*(b*C[0]+r),255*(b*C[1]+r),255*(b*C[2]+r)]},v.hcg.hsv=function(q){const S=q[1]/100,b=S+q[2]/100*(1-S);let z=0;return b>0&&(z=S/b),[q[0],100*z,100*b]},v.hcg.hsl=function(q){const S=q[1]/100,b=q[2]/100*(1-S)+.5*S;let z=0;return b>0&&b<.5?z=S/(2*b):b>=.5&&b<1&&(z=S/(2*(1-b))),[q[0],100*z,100*b]},v.hcg.hwb=function(q){const S=q[1]/100,b=S+q[2]/100*(1-S);return[q[0],100*(b-S),100*(1-b)]},v.hwb.hcg=function(q){const S=q[1]/100,b=1-q[2]/100,z=b-S;let C=0;return z<1&&(C=(b-z)/(1-z)),[q[0],100*z,100*C]},v.apple.rgb=function(q){return[q[0]/65535*255,q[1]/65535*255,q[2]/65535*255]},v.rgb.apple=function(q){return[q[0]/255*65535,q[1]/255*65535,q[2]/255*65535]},v.gray.rgb=function(q){return[q[0]/100*255,q[0]/100*255,q[0]/100*255]},v.gray.hsl=function(q){return[0,0,q[0]]},v.gray.hsv=v.gray.hsl,v.gray.hwb=function(q){return[0,100,q[0]]},v.gray.cmyk=function(q){return[0,0,0,q[0]]},v.gray.lab=function(q){return[q[0],0,0]},v.gray.hex=function(q){const S=255&Math.round(q[0]/100*255),b=((S<<16)+(S<<8)+S).toString(16).toUpperCase();return"000000".substring(b.length)+b},v.rgb.gray=function(q){return[(q[0]+q[1]+q[2])/3/255*100]}},13248:(q,S,b)=>{const z=b(13253),C=b(13268),v={};Object.keys(z).forEach((q=>{v[q]={},Object.defineProperty(v[q],"channels",{value:z[q].channels}),Object.defineProperty(v[q],"labels",{value:z[q].labels});const S=C(q);Object.keys(S).forEach((b=>{const z=S[b];v[q][b]=function(q){const S=function(){for(var S=arguments.length,b=new Array(S),z=0;z<S;z++)b[z]=arguments[z];const C=b[0];if(void 0===C||null===C)return C;C.length>1&&(b=C);const v=q(b);if("object"===typeof v)for(let q=v.length,U=0;U<q;U++)v[U]=Math.round(v[U]);return v};return"conversion"in q&&(S.conversion=q.conversion),S}(z),v[q][b].raw=function(q){const S=function(){for(var S=arguments.length,b=new Array(S),z=0;z<S;z++)b[z]=arguments[z];const C=b[0];return void 0===C||null===C?C:(C.length>1&&(b=C),q(b))};return"conversion"in q&&(S.conversion=q.conversion),S}(z)}))})),q.exports=v},13268:(q,S,b)=>{const z=b(13253);function C(q){const S=function(){const q={},S=Object.keys(z);for(let b=S.length,z=0;z<b;z++)q[S[z]]={distance:-1,parent:null};return q}(),b=[q];for(S[q].distance=0;b.length;){const q=b.pop(),C=Object.keys(z[q]);for(let z=C.length,v=0;v<z;v++){const z=C[v],U=S[z];-1===U.distance&&(U.distance=S[q].distance+1,U.parent=q,b.unshift(z))}}return S}function v(q,S){return function(b){return S(q(b))}}function U(q,S){const b=[S[q].parent,q];let C=z[S[q].parent][q],U=S[q].parent;for(;S[U].parent;)b.unshift(S[U].parent),C=v(z[S[U].parent][U],C),U=S[U].parent;return C.conversion=b,C}q.exports=function(q){const S=C(q),b={},z=Object.keys(S);for(let C=z.length,v=0;v<C;v++){const q=z[v];null!==S[q].parent&&(b[q]=U(q,S))}return b}},13259:q=>{"use strict";q.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11816:function(q,S,b){"use strict";var z=this&&this.__createBinding||(Object.create?function(q,S,b,z){void 0===z&&(z=b);var C=Object.getOwnPropertyDescriptor(S,b);C&&!("get"in C?!S.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return S[b]}}),Object.defineProperty(q,z,C)}:function(q,S,b,z){void 0===z&&(z=b),q[z]=S[b]}),C=this&&this.__setModuleDefault||(Object.create?function(q,S){Object.defineProperty(q,"default",{enumerable:!0,value:S})}:function(q,S){q.default=S}),v=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var S={};if(null!=q)for(var b in q)"default"!==b&&Object.prototype.hasOwnProperty.call(q,b)&&z(S,q,b);return C(S,q),S},U=this&&this.__awaiter||function(q,S,b,z){return new(b||(b=Promise))((function(C,v){function U(q){try{r(z.next(q))}catch(S){v(S)}}function g(q){try{r(z.throw(q))}catch(S){v(S)}}function r(q){var S;q.done?C(q.value):(S=q.value,S instanceof b?S:new b((function(q){q(S)}))).then(U,g)}r((z=z.apply(q,S||[])).next())}))};Object.defineProperty(S,"__esModule",{value:!0}),S.Auth=S.Platform=void 0;const g=v(b(11739)),r=b(11820),I="colyseus-auth-token";!function(q){q.ios="ios",q.android="android"}(S.Platform||(S.Platform={}));S.Auth=class{constructor(q){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=q.replace("ws","http"),(0,r.getItem)(I,(q=>this.token=q))}get hasToken(){return!!this.token}login(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U(this,void 0,void 0,(function*(){const S=Object.assign({},q);this.hasToken&&(S.token=this.token);const b=yield this.request("post","/auth",S);this.token=b.token,(0,r.setItem)(I,this.token);for(let q in b)this.hasOwnProperty(q)&&(this[q]=b[q]);return this.registerPingService(),this}))}save(){return U(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return U(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return U(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return U(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(q){return U(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:q})}))}acceptFriendRequest(q){return U(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:q})}))}declineFriendRequest(q){return U(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:q})}))}blockUser(q){return U(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:q})}))}unblockUser(q){return U(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:q})}))}request(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return U(this,void 0,void 0,(function*(){C.Accept="application/json",this.hasToken&&(C.Authorization="Bearer "+this.token);const v=[];for(const q in b)v.push(`${q}=${b[q]}`);const U=v.length>0?`?${v.join("&")}`:"",r={headers:C};return z&&(r.body=z),(yield g[q](`${this.endpoint}${S}${U}`,r)).data}))}logout(){this.token=void 0,(0,r.removeItem)(I),this.unregisterPingService()}registerPingService(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),q)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11734:function(q,S,b){"use strict";var z,C=this&&this.__awaiter||function(q,S,b,z){return new(b||(b=Promise))((function(C,v){function U(q){try{r(z.next(q))}catch(S){v(S)}}function g(q){try{r(z.throw(q))}catch(S){v(S)}}function r(q){var S;q.done?C(q.value):(S=q.value,S instanceof b?S:new b((function(q){q(S)}))).then(U,g)}r((z=z.apply(q,S||[])).next())}))};Object.defineProperty(S,"__esModule",{value:!0}),S.Client=S.MatchMakeError=void 0;const v=b(11739),U=b(11746),g=b(11753);class r extends Error{constructor(q,S){super(q),this.code=S,Object.setPrototypeOf(this,r.prototype)}}S.MatchMakeError=r;const I="undefined"!==typeof window&&"undefined"!==typeof(null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";S.Client=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;if("string"===typeof q){const S=new URL(q),b="https:"===S.protocol||"wss:"===S.protocol,z=Number(S.port||(b?443:80));this.settings={hostname:S.hostname,pathname:"/"!==S.pathname?S.pathname:"",port:z,secure:b}}else void 0===q.port&&(q.port=q.secure?443:80),void 0===q.pathname&&(q.pathname=""),this.settings=q}joinOrCreate(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",q,S,b)}))}create(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",q,S,b)}))}join(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",q,S,b)}))}joinById(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;return C(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",q,S,b)}))}reconnect(q,S){return C(this,void 0,void 0,(function*(){if("string"===typeof q&&"string"===typeof S)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[b,z]=q.split(":");return yield this.createMatchMakeRequest("reconnect",b,{reconnectionToken:z},S)}))}getAvailableRooms(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return C(this,void 0,void 0,(function*(){return(yield(0,v.get)(this.getHttpEndpoint(`${q}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(q,S,b){return C(this,void 0,void 0,(function*(){const z=this.createRoom(q.room.name,S);z.roomId=q.room.roomId,z.sessionId=q.sessionId;const v={sessionId:z.sessionId};q.reconnectionToken&&(v.reconnectionToken=q.reconnectionToken);const g=b||z;return z.connect(this.buildEndpoint(q.room,v),q.devMode&&(()=>C(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${z.roomId}'...`);let b=0;const v=()=>C(this,void 0,void 0,(function*(){b++;try{yield this.consumeSeatReservation(q,S,g),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${z.roomId}'`)}catch(C){b<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${b} out of 8)`),setTimeout(v,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(v,2e3)}))),g),new Promise(((q,S)=>{const b=(q,b)=>S(new U.ServerError(q,b));g.onError.once(b),g.onJoin.once((()=>{g.onError.remove(b),q(g)}))}))}))}createMatchMakeRequest(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0;return C(this,void 0,void 0,(function*(){const C=(yield(0,v.post)(this.getHttpEndpoint(`${q}/${S}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(b)})).data;if(C.error)throw new r(C.error,C.code);return"reconnect"===q&&(C.reconnectionToken=b.reconnectionToken),yield this.consumeSeatReservation(C,z,U)}))}createRoom(q,S){return new g.Room(q,S)}buildEndpoint(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=[];for(const C in S)S.hasOwnProperty(C)&&b.push(`${C}=${S[C]}`);let z=this.settings.secure?"wss://":"ws://";return q.publicAddress?z+=`${q.publicAddress}`:z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${z}/${q.processId}/${q.roomId}?${b.join("&")}`}getHttpEndpoint(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${q}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11765:(q,S,b)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.Connection=void 0;const z=b(11771);S.Connection=class{constructor(){this.events={},this.transport=new z.WebSocketTransport(this.events)}send(q){this.transport.send(q)}connect(q){this.transport.connect(q)}close(q,S){this.transport.close(q,S)}get isOpen(){return this.transport.isOpen}}},11778:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.utf8Length=S.utf8Read=S.ErrorCode=S.Protocol=void 0,function(q){q[q.HANDSHAKE=9]="HANDSHAKE",q[q.JOIN_ROOM=10]="JOIN_ROOM",q[q.ERROR=11]="ERROR",q[q.LEAVE_ROOM=12]="LEAVE_ROOM",q[q.ROOM_DATA=13]="ROOM_DATA",q[q.ROOM_STATE=14]="ROOM_STATE",q[q.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",q[q.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",q[q.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(S.Protocol||(S.Protocol={})),function(q){q[q.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",q[q.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",q[q.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",q[q.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",q[q.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",q[q.AUTH_FAILED=4215]="AUTH_FAILED",q[q.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(S.ErrorCode||(S.ErrorCode={})),S.utf8Read=function(q,S){const b=q[S++];for(var z="",C=0,v=S,U=S+b;v<U;v++){var g=q[v];if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));(C=(7&g)<<18|(63&q[++v])<<12|(63&q[++v])<<6|63&q[++v])>=65536?(C-=65536,z+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):z+=String.fromCharCode(C)}else z+=String.fromCharCode((15&g)<<12|(63&q[++v])<<6|63&q[++v]);else z+=String.fromCharCode((31&g)<<6|63&q[++v]);else z+=String.fromCharCode(g)}return z},S.utf8Length=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",S=0,b=0;for(let z=0,C=q.length;z<C;z++)S=q.charCodeAt(z),S<128?b+=1:S<2048?b+=2:S<55296||S>=57344?b+=3:(z++,b+=4);return b+1}},11753:function(q,S,b){"use strict";var z=this&&this.__createBinding||(Object.create?function(q,S,b,z){void 0===z&&(z=b);var C=Object.getOwnPropertyDescriptor(S,b);C&&!("get"in C?!S.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return S[b]}}),Object.defineProperty(q,z,C)}:function(q,S,b,z){void 0===z&&(z=b),q[z]=S[b]}),C=this&&this.__setModuleDefault||(Object.create?function(q,S){Object.defineProperty(q,"default",{enumerable:!0,value:S})}:function(q,S){q.default=S}),v=this&&this.__importStar||function(q){if(q&&q.__esModule)return q;var S={};if(null!=q)for(var b in q)"default"!==b&&Object.prototype.hasOwnProperty.call(q,b)&&z(S,q,b);return C(S,q),S};Object.defineProperty(S,"__esModule",{value:!0}),S.Room=void 0;const U=v(b(11762)),g=b(11765),r=b(11778),I=b(11785),V=b(11793),l=b(11802),y=b(11809),R=b(11746);class G{constructor(q,S){this.onStateChange=(0,l.createSignal)(),this.onError=(0,l.createSignal)(),this.onLeave=(0,l.createSignal)(),this.onJoin=(0,l.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,V.createNanoEvents)(),this.roomId=null,this.name=q,S&&(this.serializer=new((0,I.getSerializer)("schema")),this.rootSchema=S,this.serializer.state=new S),this.onError(((q,S)=>{var b;return null===(b=console.warn)||void 0===b?void 0:b.call(console,`colyseus.js - onError => (${q}) ${S}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const z=new g.Connection;b.connection=z,z.events.onmessage=G.prototype.onMessageCallback.bind(b),z.events.onclose=function(q){var z;if(!b.hasJoined)return null===(z=console.warn)||void 0===z||z.call(console,`Room connection was closed unexpectedly (${q.code}): ${q.reason}`),void b.onError.invoke(q.code,q.reason);q.code===R.CloseCode.DEVMODE_RESTART&&S?S():(b.onLeave.invoke(q.code),b.destroy())},z.events.onerror=function(q){var S;null===(S=console.warn)||void 0===S||S.call(console,`Room, onError (${q.code}): ${q.reason}`),b.onError.invoke(q.code,q.reason)},z.connect(q)}leave(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((S=>{this.onLeave((q=>S(q))),this.connection?q?this.connection.send([r.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(R.CloseCode.CONSENTED)}))}onMessage(q,S){return this.onMessageHandlers.on(this.getMessageHandlerKey(q),S)}send(q,S){const b=[r.Protocol.ROOM_DATA];let z;if("string"===typeof q?y.encode.string(b,q):y.encode.number(b,q),void 0!==S){const q=U.encode(S);z=new Uint8Array(b.length+q.byteLength),z.set(new Uint8Array(b),0),z.set(new Uint8Array(q),b.length)}else z=new Uint8Array(b);this.connection.send(z.buffer)}sendBytes(q,S){const b=[r.Protocol.ROOM_DATA_BYTES];let z;"string"===typeof q?y.encode.string(b,q):y.encode.number(b,q),z=new Uint8Array(b.length+(S.byteLength||S.length)),z.set(new Uint8Array(b),0),z.set(new Uint8Array(S),b.length),this.connection.send(z.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(q){const S=Array.from(new Uint8Array(q.data)),b=S[0];if(b===r.Protocol.JOIN_ROOM){let q=1;const b=(0,r.utf8Read)(S,q);if(q+=(0,r.utf8Length)(b),this.serializerId=(0,r.utf8Read)(S,q),q+=(0,r.utf8Length)(this.serializerId),!this.serializer){const q=(0,I.getSerializer)(this.serializerId);this.serializer=new q}S.length>q&&this.serializer.handshake&&this.serializer.handshake(S,{offset:q}),this.reconnectionToken=`${this.roomId}:${b}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([r.Protocol.JOIN_ROOM])}else if(b===r.Protocol.ERROR){const q={offset:1},b=y.decode.number(S,q),z=y.decode.string(S,q);this.onError.invoke(b,z)}else if(b===r.Protocol.LEAVE_ROOM)this.leave();else if(b===r.Protocol.ROOM_DATA_SCHEMA){const q={offset:1},b=this.serializer.getState().constructor._context.get(y.decode.number(S,q)),z=new b;z.decode(S,q),this.dispatchMessage(b,z)}else if(b===r.Protocol.ROOM_STATE)S.shift(),this.setState(S);else if(b===r.Protocol.ROOM_STATE_PATCH)S.shift(),this.patch(S);else if(b===r.Protocol.ROOM_DATA){const b={offset:1},z=y.decode.stringCheck(S,b)?y.decode.string(S,b):y.decode.number(S,b),C=S.length>b.offset?U.decode(q.data,b.offset):void 0;this.dispatchMessage(z,C)}else if(b===r.Protocol.ROOM_DATA_BYTES){const q={offset:1},b=y.decode.stringCheck(S,q)?y.decode.string(S,q):y.decode.number(S,q);this.dispatchMessage(b,new Uint8Array(S.slice(q.offset)))}}setState(q){this.serializer.setState(q),this.onStateChange.invoke(this.serializer.getState())}patch(q){this.serializer.patch(q),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(q,S){var b;const z=this.getMessageHandlerKey(q);this.onMessageHandlers.events[z]?this.onMessageHandlers.emit(z,S):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",q,S):null===(b=console.warn)||void 0===b||b.call(console,`colyseus.js: onMessage() not registered for type '${q}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(q){switch(typeof q){case"function":return`$${q._typeid}`;case"string":return q;case"number":return`i${q}`;default:throw new Error("invalid message type.")}}}S.Room=G},11820:(q,S)=>{"use strict";let b;function z(){return b||(b="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(q,S){this.cache[q]=S},getItem:function(q){this.cache[q]},removeItem:function(q){delete this.cache[q]}}),b}Object.defineProperty(S,"__esModule",{value:!0}),S.getItem=S.removeItem=S.setItem=void 0,S.setItem=function(q,S){z().setItem(q,S)},S.removeItem=function(q){z().removeItem(q)},S.getItem=function(q,S){const b=z().getItem(q);"undefined"!==typeof Promise&&b instanceof Promise?b.then((q=>S(q))):S(b)}},11793:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createNanoEvents=void 0;S.createNanoEvents=()=>({emit(q){let S=this.events[q]||[];for(var b=arguments.length,z=new Array(b>1?b-1:0),C=1;C<b;C++)z[C-1]=arguments[C];for(let v=0,U=S.length;v<U;v++)S[v](...z)},events:{},on(q,S){var b;return(null===(b=this.events[q])||void 0===b?void 0:b.push(S))||(this.events[q]=[S]),()=>{var b;this.events[q]=null===(b=this.events[q])||void 0===b?void 0:b.filter((q=>S!==q))}}})},11802:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.createSignal=S.EventEmitter=void 0;class b{constructor(){this.handlers=[]}register(q){return this.handlers.push(q),this}invoke(){for(var q=arguments.length,S=new Array(q),b=0;b<q;b++)S[b]=arguments[b];this.handlers.forEach((q=>q.apply(this,S)))}invokeAsync(){for(var q=arguments.length,S=new Array(q),b=0;b<q;b++)S[b]=arguments[b];return Promise.all(this.handlers.map((q=>q.apply(this,S))))}remove(q){const S=this.handlers.indexOf(q);this.handlers[S]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}S.EventEmitter=b,S.createSignal=function(){const q=new b;function S(S){return q.register(S,null===this)}return S.once=S=>{const b=function(){for(var z=arguments.length,C=new Array(z),v=0;v<z;v++)C[v]=arguments[v];S.apply(this,C),q.remove(b)};q.register(b)},S.remove=S=>q.remove(S),S.invoke=function(){return q.invoke(...arguments)},S.invokeAsync=function(){return q.invokeAsync(...arguments)},S.clear=()=>q.clear(),S}},11746:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.ServerError=S.CloseCode=void 0,function(q){q[q.CONSENTED=4e3]="CONSENTED",q[q.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(S.CloseCode||(S.CloseCode={}));class b extends Error{constructor(q,S){super(S),this.name="ServerError",this.code=q}}S.ServerError=b},11720:(q,S,b)=>{"use strict";S.c=void 0,b(11726);var z=b(11734);Object.defineProperty(S,"c",{enumerable:!0,get:function(){return z.Client}});var C=b(11778);var v=b(11753);var U=b(11816);const g=b(11824);const r=b(11828),I=b(11785);(0,I.registerSerializer)("schema",g.SchemaSerializer),(0,I.registerSerializer)("none",r.NoneSerializer)},11726:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=q=>null!==q&&"object"===typeof q&&q.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11762:(q,S)=>{"use strict";function b(q,S){if(this._offset=S,q instanceof ArrayBuffer)this._buffer=q,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(q))throw new Error("Invalid argument");this._buffer=q.buffer,this._view=new DataView(this._buffer,q.byteOffset,q.byteLength)}}Object.defineProperty(S,"__esModule",{value:!0}),S.decode=S.encode=void 0,b.prototype._array=function(q){for(var S=new Array(q),b=0;b<q;b++)S[b]=this._parse();return S},b.prototype._map=function(q){for(var S={},b=0;b<q;b++)S[this._parse()]=this._parse();return S},b.prototype._str=function(q){var S=function(q,S,b){for(var z="",C=0,v=S,U=S+b;v<U;v++){var g=q.getUint8(v);if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));(C=(7&g)<<18|(63&q.getUint8(++v))<<12|(63&q.getUint8(++v))<<6|63&q.getUint8(++v))>=65536?(C-=65536,z+=String.fromCharCode(55296+(C>>>10),56320+(1023&C))):z+=String.fromCharCode(C)}else z+=String.fromCharCode((15&g)<<12|(63&q.getUint8(++v))<<6|63&q.getUint8(++v));else z+=String.fromCharCode((31&g)<<6|63&q.getUint8(++v));else z+=String.fromCharCode(g)}return z}(this._view,this._offset,q);return this._offset+=q,S},b.prototype._bin=function(q){var S=this._buffer.slice(this._offset,this._offset+q);return this._offset+=q,S},b.prototype._parse=function(){var q,S=this._view.getUint8(this._offset++),b=0,z=0,C=0,v=0;if(S<192)return S<128?S:S<144?this._map(15&S):S<160?this._array(15&S):this._str(31&S);if(S>223)return-1*(255-S+1);switch(S){case 192:return null;case 194:return!1;case 195:return!0;case 196:return b=this._view.getUint8(this._offset),this._offset+=1,this._bin(b);case 197:return b=this._view.getUint16(this._offset),this._offset+=2,this._bin(b);case 198:return b=this._view.getUint32(this._offset),this._offset+=4,this._bin(b);case 199:if(b=this._view.getUint8(this._offset),z=this._view.getInt8(this._offset+1),this._offset+=2,-1===z){var U=this._view.getUint32(this._offset);return C=this._view.getInt32(this._offset+4),v=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*C+v)+U/1e6)}return[z,this._bin(b)];case 200:return b=this._view.getUint16(this._offset),z=this._view.getInt8(this._offset+2),this._offset+=3,[z,this._bin(b)];case 201:return b=this._view.getUint32(this._offset),z=this._view.getInt8(this._offset+4),this._offset+=5,[z,this._bin(b)];case 202:return q=this._view.getFloat32(this._offset),this._offset+=4,q;case 203:return q=this._view.getFloat64(this._offset),this._offset+=8,q;case 204:return q=this._view.getUint8(this._offset),this._offset+=1,q;case 205:return q=this._view.getUint16(this._offset),this._offset+=2,q;case 206:return q=this._view.getUint32(this._offset),this._offset+=4,q;case 207:return C=this._view.getUint32(this._offset)*Math.pow(2,32),v=this._view.getUint32(this._offset+4),this._offset+=8,C+v;case 208:return q=this._view.getInt8(this._offset),this._offset+=1,q;case 209:return q=this._view.getInt16(this._offset),this._offset+=2,q;case 210:return q=this._view.getInt32(this._offset),this._offset+=4,q;case 211:return C=this._view.getInt32(this._offset)*Math.pow(2,32),v=this._view.getUint32(this._offset+4),this._offset+=8,C+v;case 212:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?void(this._offset+=1):[z,this._bin(1)];case 213:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(2)];case 214:return z=this._view.getInt8(this._offset),this._offset+=1,-1===z?(q=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*q)):[z,this._bin(4)];case 215:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?(C=this._view.getInt32(this._offset)*Math.pow(2,32),v=this._view.getUint32(this._offset+4),this._offset+=8,new Date(C+v)):-1===z?(C=this._view.getUint32(this._offset),v=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&C)+v)+(C>>>2)/1e6)):[z,this._bin(8)];case 216:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(16)];case 217:return b=this._view.getUint8(this._offset),this._offset+=1,this._str(b);case 218:return b=this._view.getUint16(this._offset),this._offset+=2,this._str(b);case 219:return b=this._view.getUint32(this._offset),this._offset+=4,this._str(b);case 220:return b=this._view.getUint16(this._offset),this._offset+=2,this._array(b);case 221:return b=this._view.getUint32(this._offset),this._offset+=4,this._array(b);case 222:return b=this._view.getUint16(this._offset),this._offset+=2,this._map(b);case 223:return b=this._view.getUint32(this._offset),this._offset+=4,this._map(b)}throw new Error("Could not parse")},S.decode=function(q){var S=new b(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),z=S._parse();if(S._offset!==q.byteLength)throw new Error(q.byteLength-S._offset+" trailing bytes");return z};function z(q,S,b){for(var z=0,C=0,v=b.length;C<v;C++)(z=b.charCodeAt(C))<128?q.setUint8(S++,z):z<2048?(q.setUint8(S++,192|z>>6),q.setUint8(S++,128|63&z)):z<55296||z>=57344?(q.setUint8(S++,224|z>>12),q.setUint8(S++,128|z>>6&63),q.setUint8(S++,128|63&z)):(C++,z=65536+((1023&z)<<10|1023&b.charCodeAt(C)),q.setUint8(S++,240|z>>18),q.setUint8(S++,128|z>>12&63),q.setUint8(S++,128|z>>6&63),q.setUint8(S++,128|63&z))}function C(q,S,b){var z=typeof b,v=0,U=0,g=0,r=0,I=0,V=0;if("string"===z){if(I=function(q){for(var S=0,b=0,z=0,C=q.length;z<C;z++)(S=q.charCodeAt(z))<128?b+=1:S<2048?b+=2:S<55296||S>=57344?b+=3:(z++,b+=4);return b}(b),I<32)q.push(160|I),V=1;else if(I<256)q.push(217,I),V=2;else if(I<65536)q.push(218,I>>8,I),V=3;else{if(!(I<4294967296))throw new Error("String too long");q.push(219,I>>24,I>>16,I>>8,I),V=5}return S.push({_str:b,_length:I,_offset:q.length}),V+I}if("number"===z)return Math.floor(b)===b&&isFinite(b)?b>=0?b<128?(q.push(b),1):b<256?(q.push(204,b),2):b<65536?(q.push(205,b>>8,b),3):b<4294967296?(q.push(206,b>>24,b>>16,b>>8,b),5):(g=b/Math.pow(2,32)|0,r=b>>>0,q.push(207,g>>24,g>>16,g>>8,g,r>>24,r>>16,r>>8,r),9):b>=-32?(q.push(b),1):b>=-128?(q.push(208,b),2):b>=-32768?(q.push(209,b>>8,b),3):b>=-2147483648?(q.push(210,b>>24,b>>16,b>>8,b),5):(g=Math.floor(b/Math.pow(2,32)),r=b>>>0,q.push(211,g>>24,g>>16,g>>8,g,r>>24,r>>16,r>>8,r),9):(q.push(203),S.push({_float:b,_length:8,_offset:q.length}),9);if("object"===z){if(null===b)return q.push(192),1;if(Array.isArray(b)){if((I=b.length)<16)q.push(144|I),V=1;else if(I<65536)q.push(220,I>>8,I),V=3;else{if(!(I<4294967296))throw new Error("Array too large");q.push(221,I>>24,I>>16,I>>8,I),V=5}for(v=0;v<I;v++)V+=C(q,S,b[v]);return V}if(b instanceof Date){var l=b.getTime(),y=Math.floor(l/1e3),R=1e6*(l-1e3*y);return y>=0&&R>=0&&y<=17179869183?0===R&&y<=4294967295?(q.push(214,255,y>>24,y>>16,y>>8,y),6):(g=y/4294967296,r=4294967295&y,q.push(215,255,R>>22,R>>14,R>>6,g,r>>24,r>>16,r>>8,r),10):(g=Math.floor(y/4294967296),r=y>>>0,q.push(199,12,255,R>>24,R>>16,R>>8,R,g>>24,g>>16,g>>8,g,r>>24,r>>16,r>>8,r),15)}if(b instanceof ArrayBuffer){if((I=b.byteLength)<256)q.push(196,I),V=2;else if(I<65536)q.push(197,I>>8,I),V=3;else{if(!(I<4294967296))throw new Error("Buffer too large");q.push(198,I>>24,I>>16,I>>8,I),V=5}return S.push({_bin:b,_length:I,_offset:q.length}),V+I}if("function"===typeof b.toJSON)return C(q,S,b.toJSON());var G=[],Z="",H=Object.keys(b);for(v=0,U=H.length;v<U;v++)void 0!==b[Z=H[v]]&&"function"!==typeof b[Z]&&G.push(Z);if((I=G.length)<16)q.push(128|I),V=1;else if(I<65536)q.push(222,I>>8,I),V=3;else{if(!(I<4294967296))throw new Error("Object too large");q.push(223,I>>24,I>>16,I>>8,I),V=5}for(v=0;v<I;v++)V+=C(q,S,Z=G[v]),V+=C(q,S,b[Z]);return V}if("boolean"===z)return q.push(b?195:194),1;if("undefined"===z)return q.push(192),1;if("function"===typeof b.toJSON)return C(q,S,b.toJSON());throw new Error("Could not encode")}S.encode=function(q){var S=[],b=[],v=C(S,b,q),U=new ArrayBuffer(v),g=new DataView(U),r=0,I=0,V=-1;b.length>0&&(V=b[0]._offset);for(var l,y=0,R=0,G=0,Z=S.length;G<Z;G++)if(g.setUint8(I+G,S[G]),G+1===V){if(y=(l=b[r])._length,R=I+V,l._bin)for(var H=new Uint8Array(l._bin),Q=0;Q<y;Q++)g.setUint8(R+Q,H[Q]);else l._str?z(g,R,l._str):void 0!==l._float&&g.setFloat64(R,l._float);I+=y,b[++r]&&(V=b[r]._offset)}return U}},11828:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.NoneSerializer=void 0;S.NoneSerializer=class{setState(q){}getState(){return null}patch(q){}teardown(){}handshake(q){}}},11824:(q,S,b)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.SchemaSerializer=void 0;const z=b(11809);S.SchemaSerializer=class{setState(q){return this.state.decode(q)}getState(){return this.state}patch(q){return this.state.decode(q)}teardown(){var q,S;null===(S=null===(q=this.state)||void 0===q?void 0:q.$changes)||void 0===S||S.root.clearRefs()}handshake(q,S){if(this.state){(new z.Reflection).decode(q,S)}else this.state=z.Reflection.decode(q,S)}}},11785:(q,S)=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.getSerializer=S.registerSerializer=void 0;const b={};S.registerSerializer=function(q,S){b[q]=S},S.getSerializer=function(q){const S=b[q];if(!S)throw new Error("missing serializer: "+q);return S}},11771:function(q,S,b){"use strict";var z=this&&this.__importDefault||function(q){return q&&q.__esModule?q:{default:q}};Object.defineProperty(S,"__esModule",{value:!0}),S.WebSocketTransport=void 0;const C=z(b(11775)),v=globalThis.WebSocket||C.default;S.WebSocketTransport=class{constructor(q){this.events=q}send(q){q instanceof ArrayBuffer?this.ws.send(q):Array.isArray(q)&&this.ws.send(new Uint8Array(q).buffer)}connect(q){this.ws=new v(q,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(q,S){this.ws.close(q,S)}get isOpen(){return this.ws.readyState===v.OPEN}}},11775:q=>{"use strict";q.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12192:q=>{"use strict";q.exports=function(q){for(var S=new Array(q),b=0;b<q;++b)S[b]=b;return S}},12195:q=>{function S(q){return!!q.constructor&&"function"===typeof q.constructor.isBuffer&&q.constructor.isBuffer(q)}q.exports=function(q){return null!=q&&(S(q)||function(q){return"function"===typeof q.readFloatLE&&"function"===typeof q.slice&&S(q.slice(0,0))}(q)||!!q._isBuffer)}},12190:(q,S,b)=>{var z=b(12192),C=b(12195),v="undefined"!==typeof Float64Array;function U(q,S){return q[0]-S[0]}function g(){var q,S=this.stride,b=new Array(S.length);for(q=0;q<b.length;++q)b[q]=[Math.abs(S[q]),q];b.sort(U);var z=new Array(b.length);for(q=0;q<z.length;++q)z[q]=b[q][1];return z}function r(q,S){var b=["View",S,"d",q].join("");S<0&&(b="View_Nil"+q);var C="generic"===q;if(-1===S){var v="function "+b+"(a){this.data=a;};var proto="+b+".prototype;proto.dtype='"+q+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+b+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+b+"(a){return new "+b+"(a);}";return new Function(v)()}if(0===S){v="function "+b+"(a,d) {this.data = a;this.offset = d};var proto="+b+".prototype;proto.dtype='"+q+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+b+"_copy() {return new "+b+"(this.data,this.offset)};proto.pick=function "+b+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+b+"_get(){return "+(C?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+b+"_set(v){return "+(C?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+b+"(a,b,c,d){return new "+b+"(a,d)}";return new Function("TrivialArray",v)(I[q][0])}v=["'use strict'"];var U=z(S),r=U.map((function(q){return"i"+q})),V="this.offset+"+U.map((function(q){return"this.stride["+q+"]*i"+q})).join("+"),l=U.map((function(q){return"b"+q})).join(","),y=U.map((function(q){return"c"+q})).join(",");v.push("function "+b+"(a,"+l+","+y+",d){this.data=a","this.shape=["+l+"]","this.stride=["+y+"]","this.offset=d|0}","var proto="+b+".prototype","proto.dtype='"+q+"'","proto.dimension="+S),v.push("Object.defineProperty(proto,'size',{get:function "+b+"_size(){return "+U.map((function(q){return"this.shape["+q+"]"})).join("*"),"}})"),1===S?v.push("proto.order=[0]"):(v.push("Object.defineProperty(proto,'order',{get:"),S<4?(v.push("function "+b+"_order(){"),2===S?v.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===S&&v.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):v.push("ORDER})")),v.push("proto.set=function "+b+"_set("+r.join(",")+",v){"),C?v.push("return this.data.set("+V+",v)}"):v.push("return this.data["+V+"]=v}"),v.push("proto.get=function "+b+"_get("+r.join(",")+"){"),C?v.push("return this.data.get("+V+")}"):v.push("return this.data["+V+"]}"),v.push("proto.index=function "+b+"_index(",r.join(),"){return "+V+"}"),v.push("proto.hi=function "+b+"_hi("+r.join(",")+"){return new "+b+"(this.data,"+U.map((function(q){return["(typeof i",q,"!=='number'||i",q,"<0)?this.shape[",q,"]:i",q,"|0"].join("")})).join(",")+","+U.map((function(q){return"this.stride["+q+"]"})).join(",")+",this.offset)}");var R=U.map((function(q){return"a"+q+"=this.shape["+q+"]"})),G=U.map((function(q){return"c"+q+"=this.stride["+q+"]"}));v.push("proto.lo=function "+b+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+R.join(",")+","+G.join(","));for(var Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){d=i"+Z+"|0;b+=c"+Z+"*d;a"+Z+"-=d}");v.push("return new "+b+"(this.data,"+U.map((function(q){return"a"+q})).join(",")+","+U.map((function(q){return"c"+q})).join(",")+",b)}"),v.push("proto.step=function "+b+"_step("+r.join(",")+"){var "+U.map((function(q){return"a"+q+"=this.shape["+q+"]"})).join(",")+","+U.map((function(q){return"b"+q+"=this.stride["+q+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'){d=i"+Z+"|0;if(d<0){c+=b"+Z+"*(a"+Z+"-1);a"+Z+"=ceil(-a"+Z+"/d)}else{a"+Z+"=ceil(a"+Z+"/d)}b"+Z+"*=d}");v.push("return new "+b+"(this.data,"+U.map((function(q){return"a"+q})).join(",")+","+U.map((function(q){return"b"+q})).join(",")+",c)}");var H=new Array(S),Q=new Array(S);for(Z=0;Z<S;++Z)H[Z]="a[i"+Z+"]",Q[Z]="b[i"+Z+"]";v.push("proto.transpose=function "+b+"_transpose("+r+"){"+r.map((function(q,S){return q+"=("+q+"===undefined?"+S+":"+q+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+b+"(this.data,"+H.join(",")+","+Q.join(",")+",this.offset)}"),v.push("proto.pick=function "+b+"_pick("+r+"){var a=[],b=[],c=this.offset");for(Z=0;Z<S;++Z)v.push("if(typeof i"+Z+"==='number'&&i"+Z+">=0){c=(c+this.stride["+Z+"]*i"+Z+")|0}else{a.push(this.shape["+Z+"]);b.push(this.stride["+Z+"])}");return v.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),v.push("return function construct_"+b+"(data,shape,stride,offset){return new "+b+"(data,"+U.map((function(q){return"shape["+q+"]"})).join(",")+","+U.map((function(q){return"stride["+q+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",v.join("\n"))(I[q],g)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};q.exports=function(q,S,b,z){if(void 0===q)return(0,I.array[0])([]);"number"===typeof q&&(q=[q]),void 0===S&&(S=[q.length]);var U=S.length;if(void 0===b){b=new Array(U);for(var g=U-1,V=1;g>=0;--g)b[g]=V,V*=S[g]}if(void 0===z){z=0;for(g=0;g<U;++g)b[g]<0&&(z-=(S[g]-1)*b[g])}for(var l=function(q){if(C(q))return"buffer";if(v)switch(Object.prototype.toString.call(q)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(q)?"array":"generic"}(q),y=I[l];y.length<=U+1;)y.push(r(l,y.length-1));return(0,y[U+1])(q,S,b,z)}},13196:q=>{var S;self,S=()=>(()=>{"use strict";var q={d:(S,b)=>{for(var z in b)q.o(b,z)&&!q.o(S,z)&&Object.defineProperty(S,z,{enumerable:!0,get:b[z]})},o:(q,S)=>Object.prototype.hasOwnProperty.call(q,S)},S={};q.d(S,{default:()=>L});var b,z=function(q,S){var b=S.x-q.x,z=S.y-q.y;return Math.sqrt(b*b+z*z)},C=function(q){return q*(Math.PI/180)},v=new Map,U=function(q){v.has(q)&&clearTimeout(v.get(q)),v.set(q,setTimeout(q,100))},g=function(q,S,b){for(var z,C=S.split(/[ ,]+/g),v=0;v<C.length;v+=1)z=C[v],q.addEventListener?q.addEventListener(z,b,!1):q.attachEvent&&q.attachEvent(z,b)},r=function(q,S,b){for(var z,C=S.split(/[ ,]+/g),v=0;v<C.length;v+=1)z=C[v],q.removeEventListener?q.removeEventListener(z,b):q.detachEvent&&q.detachEvent(z,b)},I=function(q){return q.preventDefault(),q.type.match(/^touch/)?q.changedTouches:q},V=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},l=function(q,S){S.top||S.right||S.bottom||S.left?(q.style.top=S.top,q.style.right=S.right,q.style.bottom=S.bottom,q.style.left=S.left):(q.style.left=S.x+"px",q.style.top=S.y+"px")},y=function(q,S,b){var z=R(q);for(var C in z)if(z.hasOwnProperty(C))if("string"==typeof S)z[C]=S+" "+b;else{for(var v="",U=0,g=S.length;U<g;U+=1)v+=S[U]+" "+b+", ";z[C]=v.slice(0,-2)}return z},R=function(q){var S={};return S[q]="",["webkit","Moz","o"].forEach((function(b){S[b+q.charAt(0).toUpperCase()+q.slice(1)]=""})),S},G=function(q,S){for(var b in S)S.hasOwnProperty(b)&&(q[b]=S[b]);return q},Z=function(q,S){if(q.length)for(var b=0,z=q.length;b<z;b+=1)S(q[b]);else S(q)},H="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Q=window.matchMedia("(any-hover: none)").matches,k=!!("ontouchstart"in window),W=!!window.PointerEvent,N=!!window.MSPointerEvent,u={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},X={start:"mousedown",move:"mousemove",end:"mouseup"},T={};function B(){}H&&!Q?b=u:W?b={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:N?b={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:k?(b=u,T=X):b=X,B.prototype.on=function(q,S){var b,z=this,C=q.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var v=0;v<C.length;v+=1)b=C[v],z._handlers_[b]=z._handlers_[b]||[],z._handlers_[b].push(S);return z},B.prototype.off=function(q,S){var b=this;return b._handlers_=b._handlers_||{},void 0===q?b._handlers_={}:void 0===S?b._handlers_[q]=null:b._handlers_[q]&&b._handlers_[q].indexOf(S)>=0&&b._handlers_[q].splice(b._handlers_[q].indexOf(S),1),b},B.prototype.trigger=function(q,S){var b,z=this,C=q.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var v=0;v<C.length;v+=1)b=C[v],z._handlers_[b]&&z._handlers_[b].length&&z._handlers_[b].forEach((function(q){q.call(z,{type:b,target:z},S)}))},B.prototype.config=function(q){var S=this;S.options=S.defaults||{},q&&(S.options=function(q,S){var b={};for(var z in q)q.hasOwnProperty(z)&&S.hasOwnProperty(z)?b[z]=S[z]:q.hasOwnProperty(z)&&(b[z]=q[z]);return b}(S.options,q))},B.prototype.bindEvt=function(q,S){var z=this;return z._domHandlers_=z._domHandlers_||{},z._domHandlers_[S]=function(){"function"==typeof z["on"+S]?z["on"+S].apply(z,arguments):console.warn('[WARNING] : Missing "on'+S+'" handler.')},g(q,b[S],z._domHandlers_[S]),T[S]&&g(q,T[S],z._domHandlers_[S]),z},B.prototype.unbindEvt=function(q,S){var z=this;return z._domHandlers_=z._domHandlers_||{},r(q,b[S],z._domHandlers_[S]),T[S]&&r(q,T[S],z._domHandlers_[S]),delete z._domHandlers_[S],this};const t=B;function f(q,S){return this.identifier=S.identifier,this.position=S.position,this.frontPosition=S.frontPosition,this.collection=q,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(S),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=f.id,f.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}f.prototype=new t,f.constructor=f,f.id=0,f.prototype.buildEl=function(q){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},f.prototype.stylize=function(){if(this.options.dataOnly)return this;var q=this.options.fadeTime+"ms",S=function(){var q=R("borderRadius");for(var S in q)q.hasOwnProperty(S)&&(q[S]="50%");return q}(),b=y("transition","opacity",q),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},G(z.el,b),"circle"===this.options.shape&&G(z.back,S),G(z.front,S),this.applyStyles(z),this},f.prototype.applyStyles=function(q){for(var S in this.ui)if(this.ui.hasOwnProperty(S))for(var b in q[S])this.ui[S].style[b]=q[S][b];return this},f.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},f.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},f.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},f.prototype.show=function(q){var S=this;return S.options.dataOnly||(clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.addToDom(),S.restCallback(),setTimeout((function(){S.ui.el.style.opacity=1}),0),S.showTimeout=setTimeout((function(){S.trigger("shown",S.instance),"function"==typeof q&&q.call(this)}),S.options.fadeTime)),S},f.prototype.hide=function(q){var S=this;if(S.options.dataOnly)return S;if(S.ui.el.style.opacity=S.options.restOpacity,clearTimeout(S.removeTimeout),clearTimeout(S.showTimeout),clearTimeout(S.restTimeout),S.removeTimeout=setTimeout((function(){var b="dynamic"===S.options.mode?"none":"block";S.ui.el.style.display=b,"function"==typeof q&&q.call(S),S.trigger("hidden",S.instance)}),S.options.fadeTime),S.options.restJoystick){var b=S.options.restJoystick,z={};z.x=!0===b||!1!==b.x?0:S.instance.frontPosition.x,z.y=!0===b||!1!==b.y?0:S.instance.frontPosition.y,S.setPosition(q,z)}return S},f.prototype.setPosition=function(q,S){var b=this;b.frontPosition={x:S.x,y:S.y};var z=b.options.fadeTime+"ms",C={};C.front=y("transition",["transform"],z);var v={front:{}};v.front={transform:"translate("+b.frontPosition.x+"px,"+b.frontPosition.y+"px)"},b.applyStyles(C),b.applyStyles(v),b.restTimeout=setTimeout((function(){"function"==typeof q&&q.call(b),b.restCallback()}),b.options.fadeTime)},f.prototype.restCallback=function(){var q=this,S={};S.front=y("transition","none",""),q.applyStyles(S),q.trigger("rested",q.instance)},f.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},f.prototype.computeDirection=function(q){var S,b,z,C=q.angle.radian,v=Math.PI/4,U=Math.PI/2;if(C>v&&C<3*v&&!q.lockX?S="up":C>-v&&C<=v&&!q.lockY?S="left":C>3*-v&&C<=-v&&!q.lockX?S="down":q.lockY||(S="right"),q.lockY||(b=C>-U&&C<U?"left":"right"),q.lockX||(z=C>0?"up":"down"),q.force>this.options.threshold){var g,r={};for(g in this.direction)this.direction.hasOwnProperty(g)&&(r[g]=this.direction[g]);var I={};for(g in this.direction={x:b,y:z,angle:S},q.direction=this.direction,r)r[g]===this.direction[g]&&(I[g]=!0);if(I.x&&I.y&&I.angle)return q;I.x&&I.y||this.trigger("plain",q),I.x||this.trigger("plain:"+b,q),I.y||this.trigger("plain:"+z,q),I.angle||this.trigger("dir dir:"+S,q)}else this.resetDirection();return q};const m=f;function E(q,S){var b=this;b.nipples=[],b.idles=[],b.actives=[],b.ids=[],b.pressureIntervals={},b.manager=q,b.id=E.id,E.id+=1,b.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},b.config(S),"static"!==b.options.mode&&"semi"!==b.options.mode||(b.options.multitouch=!1),b.options.multitouch||(b.options.maxNumberOfNipples=1);var z=getComputedStyle(b.options.zone.parentElement);return z&&"flex"===z.display&&(b.parentIsFlex=!0),b.updateBox(),b.prepareNipples(),b.uy(),b.begin(),b.nipples}E.prototype=new t,E.constructor=E,E.id=0,E.prototype.prepareNipples=function(){var q=this,S=q.nipples;S.on=q.on.bind(q),S.off=q.off.bind(q),S.options=q.options,S.destroy=q.destroy.bind(q),S.ids=q.ids,S.id=q.id,S.processOnMove=q.processOnMove.bind(q),S.processOnEnd=q.processOnEnd.bind(q),S.get=function(q){if(void 0===q)return S[0];for(var b=0,z=S.length;b<z;b+=1)if(S[b].identifier===q)return S[b];return!1}},E.prototype.uy=function(){var q=this;q.bindEvt(q.options.zone,"start"),q.options.zone.style.touchAction="none",q.options.zone.style.msTouchAction="none"},E.prototype.begin=function(){var q=this,S=q.options;if("static"===S.mode){var b=q.createNipple(S.position,q.manager.getIdentifier());b.add(),q.idles.push(b)}},E.prototype.createNipple=function(q,S){var b=this,z=b.manager.scroll,C={},v=b.options,U=b.parentIsFlex?z.x:z.x+b.box.left,g=b.parentIsFlex?z.y:z.y+b.box.top;if(q.x&&q.y)C={x:q.x-U,y:q.y-g};else if(q.top||q.right||q.bottom||q.left){var r=document.createElement("DIV");r.style.display="hidden",r.style.top=q.top,r.style.right=q.right,r.style.bottom=q.bottom,r.style.left=q.left,r.style.position="absolute",v.zone.appendChild(r);var I=r.getBoundingClientRect();v.zone.removeChild(r),C=q,q={x:I.left+z.x,y:I.top+z.y}}var V=new m(b,{color:v.color,size:v.size,threshold:v.threshold,fadeTime:v.fadeTime,dataOnly:v.dataOnly,restJoystick:v.restJoystick,restOpacity:v.restOpacity,mode:v.mode,identifier:S,position:q,zone:v.zone,frontPosition:{x:0,y:0},shape:v.shape});return v.dataOnly||(l(V.ui.el,C),l(V.ui.front,V.frontPosition)),b.nipples.push(V),b.trigger("added "+V.identifier+":added",V),b.manager.trigger("added "+V.identifier+":added",V),b.bindNipple(V),V},E.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},E.prototype.bindNipple=function(q){var S,b=this,z=function(q,z){S=q.type+" "+z.id+":"+q.type,b.trigger(S,z)};q.on("destroyed",b.onDestroyed.bind(b)),q.on("shown hidden rested dir plain",z),q.on("dir:up dir:right dir:down dir:left",z),q.on("plain:up plain:right plain:down plain:left",z)},E.prototype.pressureFn=function(q,S,b){var z=this,C=0;clearInterval(z.pressureIntervals[b]),z.pressureIntervals[b]=setInterval(function(){var b=q.force||q.pressure||q.webkitForce||0;b!==C&&(S.trigger("pressure",b),z.trigger("pressure "+S.identifier+":pressure",b),C=b)}.bind(z),100)},E.prototype.onstart=function(q){var S=this,b=S.options,z=q;return q=I(q),S.updateBox(),Z(q,(function(C){S.actives.length<b.maxNumberOfNipples?S.processOnStart(C):z.type.match(/^touch/)&&(Object.keys(S.manager.ids).forEach((function(b){if(Object.values(z.touches).findIndex((function(q){return q.identifier===b}))<0){var C=[q[0]];C.identifier=b,S.processOnEnd(C)}})),S.actives.length<b.maxNumberOfNipples&&S.processOnStart(C))})),S.manager.bindDocument(),!1},E.prototype.processOnStart=function(q){var S,b=this,C=b.options,v=b.manager.getIdentifier(q),U=q.force||q.pressure||q.webkitForce||0,g={x:q.pageX,y:q.pageY},r=b.getOrCreate(v,g);r.identifier!==v&&b.manager.removeIdentifier(r.identifier),r.identifier=v;var I=function(S){S.trigger("start",S),b.trigger("start "+S.id+":start",S),S.show(),U>0&&b.pressureFn(q,S,S.identifier),b.processOnMove(q)};if((S=b.idles.indexOf(r))>=0&&b.idles.splice(S,1),b.actives.push(r),b.ids.push(r.identifier),"semi"!==C.mode)I(r);else{if(!(z(g,r.position)<=C.catchDistance))return r.destroy(),void b.processOnStart(q);I(r)}return r},E.prototype.getOrCreate=function(q,S){var b,z=this,C=z.options;return/(semi|static)/.test(C.mode)?(b=z.idles[0])?(z.idles.splice(0,1),b):"semi"===C.mode?z.createNipple(S,q):(console.warn("Coudln't find the needed nipple."),!1):b=z.createNipple(S,q)},E.prototype.processOnMove=function(q){var S=this,b=S.options,v=S.manager.getIdentifier(q),U=S.nipples.get(v),g=S.manager.scroll;if(function(q){return isNaN(q.buttons)?0!==q.pressure:0!==q.buttons}(q)){if(!U)return console.error("Found zombie joystick with ID "+v),void S.manager.removeIdentifier(v);if(b.dynamicPage){var r=U.el.getBoundingClientRect();U.position={x:g.x+r.left,y:g.y+r.top}}U.identifier=v;var I=U.options.size/2,V={x:q.pageX,y:q.pageY};b.lockX&&(V.y=U.position.y),b.lockY&&(V.x=U.position.x);var l,y,R,G,Z,H,Q,k,W,N,u=z(V,U.position),X=(l=V,R=(y=U.position).x-l.x,G=y.y-l.y,function(q){return q*(180/Math.PI)}(Math.atan2(G,R))),T=C(X),B=u/I,t={distance:u,position:V};if("circle"===U.options.shape?(Z=Math.min(u,I),Q=U.position,k=Z,N={x:0,y:0},W=C(W=X),N.x=Q.x-k*Math.cos(W),N.y=Q.y-k*Math.sin(W),H=N):(H=function(q,S,b){return{x:Math.min(Math.max(q.x,S.x-b),S.x+b),y:Math.min(Math.max(q.y,S.y-b),S.y+b)}}(V,U.position,I),Z=z(H,U.position)),b.follow){if(u>I){var f=V.x-H.x,m=V.y-H.y;U.position.x+=f,U.position.y+=m,U.el.style.top=U.position.y-(S.box.top+g.y)+"px",U.el.style.left=U.position.x-(S.box.left+g.x)+"px",u=z(V,U.position)}}else V=H,u=Z;var E=V.x-U.position.x,e=V.y-U.position.y;U.frontPosition={x:E,y:e},b.dataOnly||(U.ui.front.style.transform="translate("+E+"px,"+e+"px)");var i={identifier:U.identifier,position:V,force:B,pressure:q.force||q.pressure||q.webkitForce||0,distance:u,angle:{radian:T,degree:X},vector:{x:E/I,y:-e/I},raw:t,instance:U,lockX:b.lockX,lockY:b.lockY};(i=U.computeDirection(i)).angle={radian:C(180-X),degree:180-X},U.trigger("move",i),S.trigger("move "+U.id+":move",i)}else this.processOnEnd(q)},E.prototype.processOnEnd=function(q){var S=this,b=S.options,z=S.manager.getIdentifier(q),C=S.nipples.get(z),v=S.manager.removeIdentifier(C.identifier);C&&(b.dataOnly||C.hide((function(){"dynamic"===b.mode&&(C.trigger("removed",C),S.trigger("removed "+C.id+":removed",C),S.manager.trigger("removed "+C.id+":removed",C),C.destroy())})),clearInterval(S.pressureIntervals[C.identifier]),C.resetDirection(),C.trigger("end",C),S.trigger("end "+C.id+":end",C),S.ids.indexOf(C.identifier)>=0&&S.ids.splice(S.ids.indexOf(C.identifier),1),S.actives.indexOf(C)>=0&&S.actives.splice(S.actives.indexOf(C),1),/(semi|static)/.test(b.mode)?S.idles.push(C):S.nipples.indexOf(C)>=0&&S.nipples.splice(S.nipples.indexOf(C),1),S.manager.unbindDocument(),/(semi|static)/.test(b.mode)&&(S.manager.ids[v.id]=v.identifier))},E.prototype.onDestroyed=function(q,S){var b=this;b.nipples.indexOf(S)>=0&&b.nipples.splice(b.nipples.indexOf(S),1),b.actives.indexOf(S)>=0&&b.actives.splice(b.actives.indexOf(S),1),b.idles.indexOf(S)>=0&&b.idles.splice(b.idles.indexOf(S),1),b.ids.indexOf(S.identifier)>=0&&b.ids.splice(b.ids.indexOf(S.identifier),1),b.manager.removeIdentifier(S.identifier),b.manager.unbindDocument()},E.prototype.destroy=function(){var q=this;for(var S in q.unbindEvt(q.options.zone,"start"),q.nipples.forEach((function(q){q.destroy()})),q.pressureIntervals)q.pressureIntervals.hasOwnProperty(S)&&clearInterval(q.pressureIntervals[S]);q.trigger("destroyed",q.nipples),q.manager.unbindDocument(),q.off()};const e=E;function i(q){var S=this;S.ids={},S.index=0,S.collections=[],S.scroll=V(),S.config(q),S.prepareCollections();var b=function(){var q;S.collections.forEach((function(b){b.forEach((function(b){q=b.el.getBoundingClientRect(),b.position={x:S.scroll.x+q.left,y:S.scroll.y+q.top}}))}))};g(window,"resize",(function(){U(b)}));var z=function(){S.scroll=V()};return g(window,"scroll",(function(){U(z)})),S.collections}i.prototype=new t,i.constructor=i,i.prototype.prepareCollections=function(){var q=this;q.collections.create=q.create.bind(q),q.collections.on=q.on.bind(q),q.collections.off=q.off.bind(q),q.collections.destroy=q.destroy.bind(q),q.collections.get=function(S){var b;return q.collections.every((function(q){return!(b=q.get(S))})),b}},i.prototype.create=function(q){return this.createCollection(q)},i.prototype.createCollection=function(q){var S=this,b=new e(S,q);return S.bindCollection(b),S.collections.push(b),b},i.prototype.bindCollection=function(q){var S,b=this,z=function(q,z){S=q.type+" "+z.id+":"+q.type,b.trigger(S,z)};q.on("destroyed",b.onDestroyed.bind(b)),q.on("shown hidden rested dir plain",z),q.on("dir:up dir:right dir:down dir:left",z),q.on("plain:up plain:right plain:down plain:left",z)},i.prototype.bindDocument=function(){var q=this;q.binded||(q.bindEvt(document,"move").bindEvt(document,"end"),q.binded=!0)},i.prototype.unbindDocument=function(q){var S=this;Object.keys(S.ids).length&&!0!==q||(S.unbindEvt(document,"move").unbindEvt(document,"end"),S.binded=!1)},i.prototype.getIdentifier=function(q){var S;return q?void 0===(S=void 0===q.identifier?q.pointerId:q.identifier)&&(S=this.latest||0):S=this.index,void 0===this.ids[S]&&(this.ids[S]=this.index,this.index+=1),this.latest=S,this.ids[S]},i.prototype.removeIdentifier=function(q){var S={};for(var b in this.ids)if(this.ids[b]===q){S.id=b,S.identifier=this.ids[b],delete this.ids[b];break}return S},i.prototype.onmove=function(q){return this.onAny("move",q),!1},i.prototype.onend=function(q){return this.onAny("end",q),!1},i.prototype.oncancel=function(q){return this.onAny("end",q),!1},i.prototype.onAny=function(q,S){var b,z=this,C="processOn"+q.charAt(0).toUpperCase()+q.slice(1);S=I(S);var v=function(q,S,b){b.ids.indexOf(S)>=0&&(b[C](q),q._found_=!0)};return Z(S,(function(q){b=z.getIdentifier(q),Z(z.collections,v.bind(null,q,b)),q._found_||z.removeIdentifier(b)})),!1},i.prototype.destroy=function(){var q=this;q.unbindDocument(!0),q.ids={},q.index=0,q.collections.forEach((function(q){q.destroy()})),q.off()},i.prototype.onDestroyed=function(q,S){var b=this;if(b.collections.indexOf(S)<0)return!1;b.collections.splice(b.collections.indexOf(S),1)};var J=new i;const L={create:function(q){return J.create(q)},factory:J};return S.default})(),q.exports=S()},12210:(q,S,b)=>{"use strict";const{Deflate:z,deflate:C,deflateRaw:v,gzip:U}=b(12218),{Inflate:g,inflate:r,inflateRaw:I,ungzip:V}=b(12277),l=b(12256);q.exports.Deflate=z,q.exports.deflate=C,q.exports.deflateRaw=v,q.exports.gzip=U,q.exports.Inflate=g,q.exports.inflate=r,q.exports.inflateRaw=I,q.exports.ungzip=V,q.exports.constants=l},12218:(q,S,b)=>{"use strict";const z=b(12221),C=b(12258),v=b(12267),U=b(12250),g=b(12273),r=Object.prototype.toString,{Z_NO_FLUSH:I,Z_SYNC_FLUSH:V,Z_FULL_FLUSH:l,Z_FINISH:y,Z_OK:R,Z_STREAM_END:G,Z_DEFAULT_COMPRESSION:Z,Z_DEFAULT_STRATEGY:H,Z_DEFLATED:Q}=b(12256);function k(q){this.options=C.assign({level:Z,method:Q,Fq:16384,windowBits:15,memLevel:8,strategy:H},q||{});let S=this.options;S.raw&&S.windowBits>0?S.windowBits=-S.windowBits:S.gzip&&S.windowBits>0&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.gS="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;let b=z.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(b!==R)throw new Error(U[b]);if(S.header&&z.deflateSetHeader(this.strm,S.header),S.dictionary){let q;if(q="string"===typeof S.dictionary?v.string2buf(S.dictionary):"[object ArrayBuffer]"===r.call(S.dictionary)?new Uint8Array(S.dictionary):S.dictionary,b=z.deflateSetDictionary(this.strm,q),b!==R)throw new Error(U[b]);this._dict_set=!0}}function W(q,S){const b=new k(S);if(b.push(q,!0),b.err)throw b.gS||U[b.err];return b.result}k.prototype.push=function(q,S){const b=this.strm,C=this.options.Fq;let U,g;if(this.ended)return!1;for(g=S===~~S?S:!0===S?y:I,"string"===typeof q?b.input=v.string2buf(q):"[object ArrayBuffer]"===r.call(q)?b.input=new Uint8Array(q):b.input=q,b.next_in=0,b.avail_in=b.input.length;;)if(0===b.avail_out&&(b.output=new Uint8Array(C),b.next_out=0,b.avail_out=C),(g===V||g===l)&&b.avail_out<=6)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else{if(U=z.deflate(b,g),U===G)return b.next_out>0&&this.onData(b.output.subarray(0,b.next_out)),U=z.deflateEnd(this.strm),this.onEnd(U),this.ended=!0,U===R;if(0!==b.avail_out){if(g>0&&b.next_out>0)this.onData(b.output.subarray(0,b.next_out)),b.avail_out=0;else if(0===b.avail_in)break}else this.onData(b.output)}return!0},k.prototype.onData=function(q){this.chunks.push(q)},k.prototype.onEnd=function(q){q===R&&(this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.gS=this.strm.gS},q.exports.Deflate=k,q.exports.deflate=W,q.exports.deflateRaw=function(q,S){return(S=S||{}).raw=!0,W(q,S)},q.exports.gzip=function(q,S){return(S=S||{}).gzip=!0,W(q,S)},q.exports.constants=b(12256)},12277:(q,S,b)=>{"use strict";const z=b(12279),C=b(12258),v=b(12267),U=b(12250),g=b(12273),r=b(12299),I=Object.prototype.toString,{Z_NO_FLUSH:V,Z_FINISH:l,Z_OK:y,Z_STREAM_END:R,Z_NEED_DICT:G,Z_STREAM_ERROR:Z,Z_DATA_ERROR:H,Z_MEM_ERROR:Q}=b(12256);function k(q){this.options=C.assign({Fq:65536,windowBits:15,to:""},q||{});const S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,0===S.windowBits&&(S.windowBits=-15)),!(S.windowBits>=0&&S.windowBits<16)||q&&q.windowBits||(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&0===(15&S.windowBits)&&(S.windowBits|=15),this.err=0,this.gS="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;let b=z.inflateInit2(this.strm,S.windowBits);if(b!==y)throw new Error(U[b]);if(this.header=new r,z.inflateGetHeader(this.strm,this.header),S.dictionary&&("string"===typeof S.dictionary?S.dictionary=v.string2buf(S.dictionary):"[object ArrayBuffer]"===I.call(S.dictionary)&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(b=z.inflateSetDictionary(this.strm,S.dictionary),b!==y)))throw new Error(U[b])}function W(q,S){const b=new k(S);if(b.push(q),b.err)throw b.gS||U[b.err];return b.result}k.prototype.push=function(q,S){const b=this.strm,C=this.options.Fq,U=this.options.dictionary;let g,r,k;if(this.ended)return!1;for(r=S===~~S?S:!0===S?l:V,"[object ArrayBuffer]"===I.call(q)?b.input=new Uint8Array(q):b.input=q,b.next_in=0,b.avail_in=b.input.length;;){for(0===b.avail_out&&(b.output=new Uint8Array(C),b.next_out=0,b.avail_out=C),g=z.inflate(b,r),g===G&&U&&(g=z.inflateSetDictionary(b,U),g===y?g=z.inflate(b,r):g===H&&(g=G));b.avail_in>0&&g===R&&b.state.wrap>0&&0!==q[b.next_in];)z.inflateReset(b),g=z.inflate(b,r);switch(g){case Z:case H:case G:case Q:return this.onEnd(g),this.ended=!0,!1}if(k=b.avail_out,b.next_out&&(0===b.avail_out||g===R))if("string"===this.options.to){let q=v.utf8border(b.output,b.next_out),S=b.next_out-q,z=v.buf2string(b.output,q);b.next_out=S,b.avail_out=C-S,S&&b.output.set(b.output.subarray(q,q+S),0),this.onData(z)}else this.onData(b.output.length===b.next_out?b.output:b.output.subarray(0,b.next_out));if(g!==y||0!==k){if(g===R)return g=z.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,!0;if(0===b.avail_in)break}}return!0},k.prototype.onData=function(q){this.chunks.push(q)},k.prototype.onEnd=function(q){q===y&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=C.flattenChunks(this.chunks)),this.chunks=[],this.err=q,this.gS=this.strm.gS},q.exports.Inflate=k,q.exports.inflate=W,q.exports.inflateRaw=function(q,S){return(S=S||{}).raw=!0,W(q,S)},q.exports.ungzip=W,q.exports.constants=b(12256)},12258:q=>{"use strict";const S=(q,S)=>Object.prototype.hasOwnProperty.call(q,S);q.exports.assign=function(q){const b=Array.prototype.slice.call(arguments,1);for(;b.length;){const z=b.shift();if(z){if("object"!==typeof z)throw new TypeError(z+"must be non-object");for(const b in z)S(z,b)&&(q[b]=z[b])}}return q},q.exports.flattenChunks=q=>{let S=0;for(let z=0,C=q.length;z<C;z++)S+=q[z].length;const b=new Uint8Array(S);for(let z=0,C=0,v=q.length;z<v;z++){let S=q[z];b.set(S,C),C+=S.length}return b}},12267:q=>{"use strict";let S=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){S=!1}const b=new Uint8Array(256);for(let C=0;C<256;C++)b[C]=C>=252?6:C>=248?5:C>=240?4:C>=224?3:C>=192?2:1;b[254]=b[254]=1,q.exports.string2buf=q=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(q);let S,b,z,C,v,U=q.length,g=0;for(C=0;C<U;C++)b=q.charCodeAt(C),55296===(64512&b)&&C+1<U&&(z=q.charCodeAt(C+1),56320===(64512&z)&&(b=65536+(b-55296<<10)+(z-56320),C++)),g+=b<128?1:b<2048?2:b<65536?3:4;for(S=new Uint8Array(g),v=0,C=0;v<g;C++)b=q.charCodeAt(C),55296===(64512&b)&&C+1<U&&(z=q.charCodeAt(C+1),56320===(64512&z)&&(b=65536+(b-55296<<10)+(z-56320),C++)),b<128?S[v++]=b:b<2048?(S[v++]=192|b>>>6,S[v++]=128|63&b):b<65536?(S[v++]=224|b>>>12,S[v++]=128|b>>>6&63,S[v++]=128|63&b):(S[v++]=240|b>>>18,S[v++]=128|b>>>12&63,S[v++]=128|b>>>6&63,S[v++]=128|63&b);return S};q.exports.buf2string=(q,z)=>{const C=z||q.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(q.subarray(0,z));let v,U;const g=new Array(2*C);for(U=0,v=0;v<C;){let S=q[v++];if(S<128){g[U++]=S;continue}let z=b[S];if(z>4)g[U++]=65533,v+=z-1;else{for(S&=2===z?31:3===z?15:7;z>1&&v<C;)S=S<<6|63&q[v++],z--;z>1?g[U++]=65533:S<65536?g[U++]=S:(S-=65536,g[U++]=55296|S>>10&1023,g[U++]=56320|1023&S)}}return((q,b)=>{if(b<65534&&q.subarray&&S)return String.fromCharCode.apply(null,q.length===b?q:q.subarray(0,b));let z="";for(let S=0;S<b;S++)z+=String.fromCharCode(q[S]);return z})(g,U)},q.exports.utf8border=(q,S)=>{(S=S||q.length)>q.length&&(S=q.length);let z=S-1;for(;z>=0&&128===(192&q[z]);)z--;return z<0||0===z?S:z+b[q[z]]>S?z:S}},12239:q=>{"use strict";q.exports=(q,S,b,z)=>{let C=65535&q,v=q>>>16&65535,U=0;for(;0!==b;){U=b>2e3?2e3:b,b-=U;do{C=C+S[z++]|0,v=v+C|0}while(--U);C%=65521,v%=65521}return C|v<<16}},12256:q=>{"use strict";q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12241:q=>{"use strict";const S=new Uint32Array((()=>{let q,S=[];for(var b=0;b<256;b++){q=b;for(var z=0;z<8;z++)q=1&q?3988292384^q>>>1:q>>>1;S[b]=q}return S})());q.exports=(q,b,z,C)=>{const v=S,U=C+z;q^=-1;for(let S=C;S<U;S++)q=q>>>8^v[255&(q^b[S])];return~q}},12221:(q,S,b)=>{"use strict";const{_tr_init:z,_tr_stored_block:C,_tr_flush_block:v,_tr_tally:U,_tr_align:g}=b(12230),r=b(12239),I=b(12241),V=b(12250),{Z_NO_FLUSH:l,Z_PARTIAL_FLUSH:y,Z_FULL_FLUSH:R,Z_FINISH:G,Z_BLOCK:Z,Z_OK:H,Z_STREAM_END:Q,Z_STREAM_ERROR:k,Z_DATA_ERROR:W,Z_BUF_ERROR:N,Z_DEFAULT_COMPRESSION:u,Z_FILTERED:X,Z_HUFFMAN_ONLY:T,Z_RLE:B,Z_FIXED:t,Z_DEFAULT_STRATEGY:f,Z_UNKNOWN:m,Z_DEFLATED:E}=b(12256),e=258,i=262,J=103,L=113,d=666,K=(q,S)=>(q.gS=V[S],S),D=q=>(q<<1)-(q>4?9:0),x=q=>{let S=q.length;for(;--S>=0;)q[S]=0};let F=(q,S,b)=>(S<<q.hash_shift^b)&q.hash_mask;const a=q=>{const S=q.state;let b=S.pending;b>q.avail_out&&(b=q.avail_out),0!==b&&(q.output.set(S.pending_buf.subarray(S.pending_out,S.pending_out+b),q.next_out),q.next_out+=b,S.pending_out+=b,q.total_out+=b,q.avail_out-=b,S.pending-=b,0===S.pending&&(S.pending_out=0))},n=(q,S)=>{v(q,q.block_start>=0?q.block_start:-1,q.strstart-q.block_start,S),q.block_start=q.strstart,a(q.strm)},o=(q,S)=>{q.pending_buf[q.pending++]=S},s=(q,S)=>{q.pending_buf[q.pending++]=S>>>8&255,q.pending_buf[q.pending++]=255&S},A=(q,S,b,z)=>{let C=q.avail_in;return C>z&&(C=z),0===C?0:(q.avail_in-=C,S.set(q.input.subarray(q.next_in,q.next_in+C),b),1===q.state.wrap?q.adler=r(q.adler,S,C,b):2===q.state.wrap&&(q.adler=I(q.adler,S,C,b)),q.next_in+=C,q.total_in+=C,C)},w=(q,S)=>{let b,z,C=q.max_chain_length,v=q.strstart,U=q.prev_length,g=q.nice_match;const r=q.strstart>q.w_size-i?q.strstart-(q.w_size-i):0,I=q.window,V=q.w_mask,l=q.prev,y=q.strstart+e;let R=I[v+U-1],G=I[v+U];q.prev_length>=q.good_match&&(C>>=2),g>q.lookahead&&(g=q.lookahead);do{if(b=S,I[b+U]===G&&I[b+U-1]===R&&I[b]===I[v]&&I[++b]===I[v+1]){v+=2,b++;do{}while(I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&I[++v]===I[++b]&&v<y);if(z=e-(y-v),v=y-e,z>U){if(q.match_start=S,U=z,z>=g)break;R=I[v+U-1],G=I[v+U]}}}while((S=l[S&V])>r&&0!==--C);return U<=q.lookahead?U:q.lookahead},P=q=>{const S=q.w_size;let b,z,C,v,U;do{if(v=q.window_size-q.lookahead-q.strstart,q.strstart>=S+(S-i)){q.window.set(q.window.subarray(S,S+S),0),q.match_start-=S,q.strstart-=S,q.block_start-=S,z=q.hash_size,b=z;do{C=q.head[--b],q.head[b]=C>=S?C-S:0}while(--z);z=S,b=z;do{C=q.prev[--b],q.prev[b]=C>=S?C-S:0}while(--z);v+=S}if(0===q.strm.avail_in)break;if(z=A(q.strm,q.window,q.strstart+q.lookahead,v),q.lookahead+=z,q.lookahead+q.insert>=3)for(U=q.strstart-q.insert,q.ins_h=q.window[U],q.ins_h=F(q,q.ins_h,q.window[U+1]);q.insert&&(q.ins_h=F(q,q.ins_h,q.window[U+3-1]),q.prev[U&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=U,U++,q.insert--,!(q.lookahead+q.insert<3)););}while(q.lookahead<i&&0!==q.strm.avail_in)},h=(q,S)=>{let b,z;for(;;){if(q.lookahead<i){if(P(q),q.lookahead<i&&S===l)return 1;if(0===q.lookahead)break}if(b=0,q.lookahead>=3&&(q.ins_h=F(q,q.ins_h,q.window[q.strstart+3-1]),b=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),0!==b&&q.strstart-b<=q.w_size-i&&(q.match_length=w(q,b)),q.match_length>=3)if(z=U(q,q.strstart-q.match_start,q.match_length-3),q.lookahead-=q.match_length,q.match_length<=q.max_lazy_match&&q.lookahead>=3){q.match_length--;do{q.strstart++,q.ins_h=F(q,q.ins_h,q.window[q.strstart+3-1]),b=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart}while(0!==--q.match_length);q.strstart++}else q.strstart+=q.match_length,q.match_length=0,q.ins_h=q.window[q.strstart],q.ins_h=F(q,q.ins_h,q.window[q.strstart+1]);else z=U(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++;if(z&&(n(q,!1),0===q.strm.avail_out))return 1}return q.insert=q.strstart<2?q.strstart:2,S===G?(n(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(n(q,!1),0===q.strm.avail_out)?1:2},O=(q,S)=>{let b,z,C;for(;;){if(q.lookahead<i){if(P(q),q.lookahead<i&&S===l)return 1;if(0===q.lookahead)break}if(b=0,q.lookahead>=3&&(q.ins_h=F(q,q.ins_h,q.window[q.strstart+3-1]),b=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart),q.prev_length=q.match_length,q.prev_match=q.match_start,q.match_length=2,0!==b&&q.prev_length<q.max_lazy_match&&q.strstart-b<=q.w_size-i&&(q.match_length=w(q,b),q.match_length<=5&&(q.strategy===X||3===q.match_length&&q.strstart-q.match_start>4096)&&(q.match_length=2)),q.prev_length>=3&&q.match_length<=q.prev_length){C=q.strstart+q.lookahead-3,z=U(q,q.strstart-1-q.prev_match,q.prev_length-3),q.lookahead-=q.prev_length-1,q.prev_length-=2;do{++q.strstart<=C&&(q.ins_h=F(q,q.ins_h,q.window[q.strstart+3-1]),b=q.prev[q.strstart&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=q.strstart)}while(0!==--q.prev_length);if(q.match_available=0,q.match_length=2,q.strstart++,z&&(n(q,!1),0===q.strm.avail_out))return 1}else if(q.match_available){if(z=U(q,0,q.window[q.strstart-1]),z&&n(q,!1),q.strstart++,q.lookahead--,0===q.strm.avail_out)return 1}else q.match_available=1,q.strstart++,q.lookahead--}return q.match_available&&(z=U(q,0,q.window[q.strstart-1]),q.match_available=0),q.insert=q.strstart<2?q.strstart:2,S===G?(n(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(n(q,!1),0===q.strm.avail_out)?1:2};function j(q,S,b,z,C){this.good_length=q,this.max_lazy=S,this.nice_length=b,this.max_chain=z,this.func=C}const M=[new j(0,0,0,0,((q,S)=>{let b=65535;for(b>q.pending_buf_size-5&&(b=q.pending_buf_size-5);;){if(q.lookahead<=1){if(P(q),0===q.lookahead&&S===l)return 1;if(0===q.lookahead)break}q.strstart+=q.lookahead,q.lookahead=0;const z=q.block_start+b;if((0===q.strstart||q.strstart>=z)&&(q.lookahead=q.strstart-z,q.strstart=z,n(q,!1),0===q.strm.avail_out))return 1;if(q.strstart-q.block_start>=q.w_size-i&&(n(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,S===G?(n(q,!0),0===q.strm.avail_out?3:4):(q.strstart>q.block_start&&(n(q,!1),q.strm.avail_out),1)})),new j(4,4,8,4,h),new j(4,5,16,8,h),new j(4,6,32,32,h),new j(4,4,16,16,O),new j(8,16,32,32,O),new j(8,16,128,128,O),new j(8,32,128,256,O),new j(32,128,258,1024,O),new j(32,258,258,4096,O)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Y=q=>{if(!q||!q.state)return K(q,k);q.total_in=q.total_out=0,q.data_type=m;const S=q.state;return S.pending=0,S.pending_out=0,S.wrap<0&&(S.wrap=-S.wrap),S.status=S.wrap?42:L,q.adler=2===S.wrap?0:1,S.last_flush=l,z(S),H},c=q=>{const S=Y(q);var b;return S===H&&((b=q.state).window_size=2*b.w_size,x(b.head),b.max_lazy_match=M[b.level].max_lazy,b.good_match=M[b.level].good_length,b.nice_match=M[b.level].nice_length,b.max_chain_length=M[b.level].max_chain,b.strstart=0,b.block_start=0,b.lookahead=0,b.insert=0,b.match_length=b.prev_length=2,b.match_available=0,b.ins_h=0),S},qq=(q,S,b,z,C,v)=>{if(!q)return k;let U=1;if(S===u&&(S=6),z<0?(U=0,z=-z):z>15&&(U=2,z-=16),C<1||C>9||b!==E||z<8||z>15||S<0||S>9||v<0||v>t)return K(q,k);8===z&&(z=9);const g=new p;return q.state=g,g.strm=q,g.wrap=U,g.gzhead=null,g.w_bits=z,g.w_size=1<<g.w_bits,g.w_mask=g.w_size-1,g.hash_bits=C+7,g.hash_size=1<<g.hash_bits,g.hash_mask=g.hash_size-1,g.hash_shift=~~((g.hash_bits+3-1)/3),g.window=new Uint8Array(2*g.w_size),g.head=new Uint16Array(g.hash_size),g.prev=new Uint16Array(g.w_size),g.lit_bufsize=1<<C+6,g.pending_buf_size=4*g.lit_bufsize,g.pending_buf=new Uint8Array(g.pending_buf_size),g.d_buf=1*g.lit_bufsize,g.l_buf=3*g.lit_bufsize,g.level=S,g.strategy=v,g.method=b,c(q)};q.exports.deflateInit=(q,S)=>qq(q,S,E,15,8,f),q.exports.deflateInit2=qq,q.exports.deflateReset=c,q.exports.deflateResetKeep=Y,q.exports.deflateSetHeader=(q,S)=>q&&q.state?2!==q.state.wrap?k:(q.state.gzhead=S,H):k,q.exports.deflate=(q,S)=>{let b,z;if(!q||!q.state||S>Z||S<0)return q?K(q,k):k;const v=q.state;if(!q.output||!q.input&&0!==q.avail_in||v.status===d&&S!==G)return K(q,0===q.avail_out?N:k);v.strm=q;const r=v.last_flush;if(v.last_flush=S,42===v.status)if(2===v.wrap)q.adler=0,o(v,31),o(v,139),o(v,8),v.gzhead?(o(v,(v.gzhead.text?1:0)+(v.gzhead.hcrc?2:0)+(v.gzhead.extra?4:0)+(v.gzhead.name?8:0)+(v.gzhead.comment?16:0)),o(v,255&v.gzhead.time),o(v,v.gzhead.time>>8&255),o(v,v.gzhead.time>>16&255),o(v,v.gzhead.time>>24&255),o(v,9===v.level?2:v.strategy>=T||v.level<2?4:0),o(v,255&v.gzhead.os),v.gzhead.extra&&v.gzhead.extra.length&&(o(v,255&v.gzhead.extra.length),o(v,v.gzhead.extra.length>>8&255)),v.gzhead.hcrc&&(q.adler=I(q.adler,v.pending_buf,v.pending,0)),v.gzindex=0,v.status=69):(o(v,0),o(v,0),o(v,0),o(v,0),o(v,0),o(v,9===v.level?2:v.strategy>=T||v.level<2?4:0),o(v,3),v.status=L);else{let S=E+(v.w_bits-8<<4)<<8,b=-1;b=v.strategy>=T||v.level<2?0:v.level<6?1:6===v.level?2:3,S|=b<<6,0!==v.strstart&&(S|=32),S+=31-S%31,v.status=L,s(v,S),0!==v.strstart&&(s(v,q.adler>>>16),s(v,65535&q.adler)),q.adler=1}if(69===v.status)if(v.gzhead.extra){for(b=v.pending;v.gzindex<(65535&v.gzhead.extra.length)&&(v.pending!==v.pending_buf_size||(v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),a(q),b=v.pending,v.pending!==v.pending_buf_size));)o(v,255&v.gzhead.extra[v.gzindex]),v.gzindex++;v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),v.gzindex===v.gzhead.extra.length&&(v.gzindex=0,v.status=73)}else v.status=73;if(73===v.status)if(v.gzhead.name){b=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),a(q),b=v.pending,v.pending===v.pending_buf_size)){z=1;break}z=v.gzindex<v.gzhead.name.length?255&v.gzhead.name.charCodeAt(v.gzindex++):0,o(v,z)}while(0!==z);v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),0===z&&(v.gzindex=0,v.status=91)}else v.status=91;if(91===v.status)if(v.gzhead.comment){b=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),a(q),b=v.pending,v.pending===v.pending_buf_size)){z=1;break}z=v.gzindex<v.gzhead.comment.length?255&v.gzhead.comment.charCodeAt(v.gzindex++):0,o(v,z)}while(0!==z);v.gzhead.hcrc&&v.pending>b&&(q.adler=I(q.adler,v.pending_buf,v.pending-b,b)),0===z&&(v.status=J)}else v.status=J;if(v.status===J&&(v.gzhead.hcrc?(v.pending+2>v.pending_buf_size&&a(q),v.pending+2<=v.pending_buf_size&&(o(v,255&q.adler),o(v,q.adler>>8&255),q.adler=0,v.status=L)):v.status=L),0!==v.pending){if(a(q),0===q.avail_out)return v.last_flush=-1,H}else if(0===q.avail_in&&D(S)<=D(r)&&S!==G)return K(q,N);if(v.status===d&&0!==q.avail_in)return K(q,N);if(0!==q.avail_in||0!==v.lookahead||S!==l&&v.status!==d){let b=v.strategy===T?((q,S)=>{let b;for(;;){if(0===q.lookahead&&(P(q),0===q.lookahead)){if(S===l)return 1;break}if(q.match_length=0,b=U(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,b&&(n(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,S===G?(n(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(n(q,!1),0===q.strm.avail_out)?1:2})(v,S):v.strategy===B?((q,S)=>{let b,z,C,v;const g=q.window;for(;;){if(q.lookahead<=e){if(P(q),q.lookahead<=e&&S===l)return 1;if(0===q.lookahead)break}if(q.match_length=0,q.lookahead>=3&&q.strstart>0&&(C=q.strstart-1,z=g[C],z===g[++C]&&z===g[++C]&&z===g[++C])){v=q.strstart+e;do{}while(z===g[++C]&&z===g[++C]&&z===g[++C]&&z===g[++C]&&z===g[++C]&&z===g[++C]&&z===g[++C]&&z===g[++C]&&C<v);q.match_length=e-(v-C),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=3?(b=U(q,1,q.match_length-3),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(b=U(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),b&&(n(q,!1),0===q.strm.avail_out))return 1}return q.insert=0,S===G?(n(q,!0),0===q.strm.avail_out?3:4):q.last_lit&&(n(q,!1),0===q.strm.avail_out)?1:2})(v,S):M[v.level].func(v,S);if(3!==b&&4!==b||(v.status=d),1===b||3===b)return 0===q.avail_out&&(v.last_flush=-1),H;if(2===b&&(S===y?g(v):S!==Z&&(C(v,0,0,!1),S===R&&(x(v.head),0===v.lookahead&&(v.strstart=0,v.block_start=0,v.insert=0))),a(q),0===q.avail_out))return v.last_flush=-1,H}return S!==G?H:v.wrap<=0?Q:(2===v.wrap?(o(v,255&q.adler),o(v,q.adler>>8&255),o(v,q.adler>>16&255),o(v,q.adler>>24&255),o(v,255&q.total_in),o(v,q.total_in>>8&255),o(v,q.total_in>>16&255),o(v,q.total_in>>24&255)):(s(v,q.adler>>>16),s(v,65535&q.adler)),a(q),v.wrap>0&&(v.wrap=-v.wrap),0!==v.pending?H:Q)},q.exports.deflateEnd=q=>{if(!q||!q.state)return k;const S=q.state.status;return 42!==S&&69!==S&&73!==S&&91!==S&&S!==J&&S!==L&&S!==d?K(q,k):(q.state=null,S===L?K(q,W):H)},q.exports.deflateSetDictionary=(q,S)=>{let b=S.length;if(!q||!q.state)return k;const z=q.state,C=z.wrap;if(2===C||1===C&&42!==z.status||z.lookahead)return k;if(1===C&&(q.adler=r(q.adler,S,b,0)),z.wrap=0,b>=z.w_size){0===C&&(x(z.head),z.strstart=0,z.block_start=0,z.insert=0);let q=new Uint8Array(z.w_size);q.set(S.subarray(b-z.w_size,b),0),S=q,b=z.w_size}const v=q.avail_in,U=q.next_in,g=q.input;for(q.avail_in=b,q.next_in=0,q.input=S,P(z);z.lookahead>=3;){let q=z.strstart,S=z.lookahead-2;do{z.ins_h=F(z,z.ins_h,z.window[q+3-1]),z.prev[q&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=q,q++}while(--S);z.strstart=q,z.lookahead=2,P(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=2,z.match_available=0,q.next_in=U,q.input=g,q.avail_in=v,z.wrap=C,H},q.exports.deflateInfo="pako deflate (from Nodeca project)"},12299:q=>{"use strict";q.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12284:q=>{"use strict";q.exports=function(q,S){let b,z,C,v,U,g,r,I,V,l,y,R,G,Z,H,Q,k,W,N,u,X,T,B,t;const f=q.state;b=q.next_in,B=q.input,z=b+(q.avail_in-5),C=q.next_out,t=q.output,v=C-(S-q.avail_out),U=C+(q.avail_out-257),g=f.dmax,r=f.wsize,I=f.whave,V=f.wnext,l=f.window,y=f.hold,R=f.bits,G=f.lencode,Z=f.distcode,H=(1<<f.lenbits)-1,Q=(1<<f.distbits)-1;q:do{R<15&&(y+=B[b++]<<R,R+=8,y+=B[b++]<<R,R+=8),k=G[y&H];S:for(;;){if(W=k>>>24,y>>>=W,R-=W,W=k>>>16&255,0===W)t[C++]=65535&k;else{if(!(16&W)){if(0===(64&W)){k=G[(65535&k)+(y&(1<<W)-1)];continue S}if(32&W){f.mode=12;break q}q.gS="invalid literal/length code",f.mode=30;break q}N=65535&k,W&=15,W&&(R<W&&(y+=B[b++]<<R,R+=8),N+=y&(1<<W)-1,y>>>=W,R-=W),R<15&&(y+=B[b++]<<R,R+=8,y+=B[b++]<<R,R+=8),k=Z[y&Q];b:for(;;){if(W=k>>>24,y>>>=W,R-=W,W=k>>>16&255,!(16&W)){if(0===(64&W)){k=Z[(65535&k)+(y&(1<<W)-1)];continue b}q.gS="invalid distance code",f.mode=30;break q}if(u=65535&k,W&=15,R<W&&(y+=B[b++]<<R,R+=8,R<W&&(y+=B[b++]<<R,R+=8)),u+=y&(1<<W)-1,u>g){q.gS="invalid distance too far back",f.mode=30;break q}if(y>>>=W,R-=W,W=C-v,u>W){if(W=u-W,W>I&&f.sane){q.gS="invalid distance too far back",f.mode=30;break q}if(X=0,T=l,0===V){if(X+=r-W,W<N){N-=W;do{t[C++]=l[X++]}while(--W);X=C-u,T=t}}else if(V<W){if(X+=r+V-W,W-=V,W<N){N-=W;do{t[C++]=l[X++]}while(--W);if(X=0,V<N){W=V,N-=W;do{t[C++]=l[X++]}while(--W);X=C-u,T=t}}}else if(X+=V-W,W<N){N-=W;do{t[C++]=l[X++]}while(--W);X=C-u,T=t}for(;N>2;)t[C++]=T[X++],t[C++]=T[X++],t[C++]=T[X++],N-=3;N&&(t[C++]=T[X++],N>1&&(t[C++]=T[X++]))}else{X=C-u;do{t[C++]=t[X++],t[C++]=t[X++],t[C++]=t[X++],N-=3}while(N>2);N&&(t[C++]=t[X++],N>1&&(t[C++]=t[X++]))}break}}break}}while(b<z&&C<U);N=R>>3,b-=N,R-=N<<3,y&=(1<<R)-1,q.next_in=b,q.next_out=C,q.avail_in=b<z?z-b+5:5-(b-z),q.avail_out=C<U?U-C+257:257-(C-U),f.hold=y,f.bits=R}},12279:(q,S,b)=>{"use strict";const z=b(12239),C=b(12241),v=b(12284),U=b(12290),{Z_FINISH:g,Z_BLOCK:r,Z_TREES:I,Z_OK:V,Z_STREAM_END:l,Z_NEED_DICT:y,Z_STREAM_ERROR:R,Z_DATA_ERROR:G,Z_MEM_ERROR:Z,Z_BUF_ERROR:H,Z_DEFLATED:Q}=b(12256),k=12,W=30,N=q=>(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24);function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const X=q=>{if(!q||!q.state)return R;const S=q.state;return q.total_in=q.total_out=S.total=0,q.gS="",S.wrap&&(q.adler=1&S.wrap),S.mode=1,S.last=0,S.havedict=0,S.dmax=32768,S.head=null,S.hold=0,S.bits=0,S.lencode=S.lendyn=new Int32Array(852),S.distcode=S.distdyn=new Int32Array(592),S.sane=1,S.back=-1,V},T=q=>{if(!q||!q.state)return R;const S=q.state;return S.wsize=0,S.whave=0,S.wnext=0,X(q)},B=(q,S)=>{let b;if(!q||!q.state)return R;const z=q.state;return S<0?(b=0,S=-S):(b=1+(S>>4),S<48&&(S&=15)),S&&(S<8||S>15)?R:(null!==z.window&&z.wbits!==S&&(z.window=null),z.wrap=b,z.wbits=S,T(q))},t=(q,S)=>{if(!q)return R;const b=new u;q.state=b,b.window=null;const z=B(q,S);return z!==V&&(q.state=null),z};let f,m,E=!0;const e=q=>{if(E){f=new Int32Array(512),m=new Int32Array(32);let S=0;for(;S<144;)q.lens[S++]=8;for(;S<256;)q.lens[S++]=9;for(;S<280;)q.lens[S++]=7;for(;S<288;)q.lens[S++]=8;for(U(1,q.lens,0,288,f,0,q.work,{bits:9}),S=0;S<32;)q.lens[S++]=5;U(2,q.lens,0,32,m,0,q.work,{bits:5}),E=!1}q.lencode=f,q.lenbits=9,q.distcode=m,q.distbits=5},i=(q,S,b,z)=>{let C;const v=q.state;return null===v.window&&(v.wsize=1<<v.wbits,v.wnext=0,v.whave=0,v.window=new Uint8Array(v.wsize)),z>=v.wsize?(v.window.set(S.subarray(b-v.wsize,b),0),v.wnext=0,v.whave=v.wsize):(C=v.wsize-v.wnext,C>z&&(C=z),v.window.set(S.subarray(b-z,b-z+C),v.wnext),(z-=C)?(v.window.set(S.subarray(b-z,b),0),v.wnext=z,v.whave=v.wsize):(v.wnext+=C,v.wnext===v.wsize&&(v.wnext=0),v.whave<v.wsize&&(v.whave+=C))),0};q.exports.inflateReset=T,q.exports.inflateReset2=B,q.exports.inflateResetKeep=X,q.exports.inflateInit=q=>t(q,15),q.exports.inflateInit2=t,q.exports.inflate=(q,S)=>{let b,u,X,T,B,t,f,m,E,J,L,d,K,D,x,F,a,n,o,s,A,w,P=0;const h=new Uint8Array(4);let O,j;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!q||!q.state||!q.output||!q.input&&0!==q.avail_in)return R;b=q.state,b.mode===k&&(b.mode=13),B=q.next_out,X=q.output,f=q.avail_out,T=q.next_in,u=q.input,t=q.avail_in,m=b.hold,E=b.bits,J=t,L=f,w=V;q:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;E<16;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(2&b.wrap&&35615===m){b.check=0,h[0]=255&m,h[1]=m>>>8&255,b.check=C(b.check,h,2,0),m=0,E=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&m)<<8)+(m>>8))%31){q.gS="incorrect header check",b.mode=W;break}if((15&m)!==Q){q.gS="unknown compression method",b.mode=W;break}if(m>>>=4,E-=4,A=8+(15&m),0===b.wbits)b.wbits=A;else if(A>b.wbits){q.gS="invalid window size",b.mode=W;break}b.dmax=1<<b.wbits,q.adler=b.check=1,b.mode=512&m?10:k,m=0,E=0;break;case 2:for(;E<16;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(b.flags=m,(255&b.flags)!==Q){q.gS="unknown compression method",b.mode=W;break}if(57344&b.flags){q.gS="unknown header flags set",b.mode=W;break}b.head&&(b.head.text=m>>8&1),512&b.flags&&(h[0]=255&m,h[1]=m>>>8&255,b.check=C(b.check,h,2,0)),m=0,E=0,b.mode=3;case 3:for(;E<32;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.head&&(b.head.time=m),512&b.flags&&(h[0]=255&m,h[1]=m>>>8&255,h[2]=m>>>16&255,h[3]=m>>>24&255,b.check=C(b.check,h,4,0)),m=0,E=0,b.mode=4;case 4:for(;E<16;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.head&&(b.head.xflags=255&m,b.head.os=m>>8),512&b.flags&&(h[0]=255&m,h[1]=m>>>8&255,b.check=C(b.check,h,2,0)),m=0,E=0,b.mode=5;case 5:if(1024&b.flags){for(;E<16;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.length=m,b.head&&(b.head.extra_len=m),512&b.flags&&(h[0]=255&m,h[1]=m>>>8&255,b.check=C(b.check,h,2,0)),m=0,E=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(d=b.length,d>t&&(d=t),d&&(b.head&&(A=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Uint8Array(b.head.extra_len)),b.head.extra.set(u.subarray(T,T+d),A)),512&b.flags&&(b.check=C(b.check,u,d,T)),t-=d,T+=d,b.length-=d),b.length))break q;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(0===t)break q;d=0;do{A=u[T+d++],b.head&&A&&b.length<65536&&(b.head.name+=String.fromCharCode(A))}while(A&&d<t);if(512&b.flags&&(b.check=C(b.check,u,d,T)),t-=d,T+=d,A)break q}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(0===t)break q;d=0;do{A=u[T+d++],b.head&&A&&b.length<65536&&(b.head.comment+=String.fromCharCode(A))}while(A&&d<t);if(512&b.flags&&(b.check=C(b.check,u,d,T)),t-=d,T+=d,A)break q}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;E<16;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(m!==(65535&b.check)){q.gS="header crc mismatch",b.mode=W;break}m=0,E=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),q.adler=b.check=0,b.mode=k;break;case 10:for(;E<32;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}q.adler=b.check=N(m),m=0,E=0,b.mode=11;case 11:if(0===b.havedict)return q.next_out=B,q.avail_out=f,q.next_in=T,q.avail_in=t,b.hold=m,b.bits=E,y;q.adler=b.check=1,b.mode=k;case k:if(S===r||S===I)break q;case 13:if(b.last){m>>>=7&E,E-=7&E,b.mode=27;break}for(;E<3;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}switch(b.last=1&m,m>>>=1,E-=1,3&m){case 0:b.mode=14;break;case 1:if(e(b),b.mode=20,S===I){m>>>=2,E-=2;break q}break;case 2:b.mode=17;break;case 3:q.gS="invalid block type",b.mode=W}m>>>=2,E-=2;break;case 14:for(m>>>=7&E,E-=7&E;E<32;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if((65535&m)!==(m>>>16^65535)){q.gS="invalid stored block lengths",b.mode=W;break}if(b.length=65535&m,m=0,E=0,b.mode=15,S===I)break q;case 15:b.mode=16;case 16:if(d=b.length,d){if(d>t&&(d=t),d>f&&(d=f),0===d)break q;X.set(u.subarray(T,T+d),B),t-=d,T+=d,f-=d,B+=d,b.length-=d;break}b.mode=k;break;case 17:for(;E<14;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(b.nlen=257+(31&m),m>>>=5,E-=5,b.ndist=1+(31&m),m>>>=5,E-=5,b.ncode=4+(15&m),m>>>=4,E-=4,b.nlen>286||b.ndist>30){q.gS="too many length or distance symbols",b.mode=W;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;E<3;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.lens[M[b.have++]]=7&m,m>>>=3,E-=3}for(;b.have<19;)b.lens[M[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,O={bits:b.lenbits},w=U(0,b.lens,0,19,b.lencode,0,b.work,O),b.lenbits=O.bits,w){q.gS="invalid code lengths set",b.mode=W;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;P=b.lencode[m&(1<<b.lenbits)-1],x=P>>>24,F=P>>>16&255,a=65535&P,!(x<=E);){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(a<16)m>>>=x,E-=x,b.lens[b.have++]=a;else{if(16===a){for(j=x+2;E<j;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(m>>>=x,E-=x,0===b.have){q.gS="invalid bit length repeat",b.mode=W;break}A=b.lens[b.have-1],d=3+(3&m),m>>>=2,E-=2}else if(17===a){for(j=x+3;E<j;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}m>>>=x,E-=x,A=0,d=3+(7&m),m>>>=3,E-=3}else{for(j=x+7;E<j;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}m>>>=x,E-=x,A=0,d=11+(127&m),m>>>=7,E-=7}if(b.have+d>b.nlen+b.ndist){q.gS="invalid bit length repeat",b.mode=W;break}for(;d--;)b.lens[b.have++]=A}}if(b.mode===W)break;if(0===b.lens[256]){q.gS="invalid code -- missing end-of-block",b.mode=W;break}if(b.lenbits=9,O={bits:b.lenbits},w=U(1,b.lens,0,b.nlen,b.lencode,0,b.work,O),b.lenbits=O.bits,w){q.gS="invalid literal/lengths set",b.mode=W;break}if(b.distbits=6,b.distcode=b.distdyn,O={bits:b.distbits},w=U(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,O),b.distbits=O.bits,w){q.gS="invalid distances set",b.mode=W;break}if(b.mode=20,S===I)break q;case 20:b.mode=21;case 21:if(t>=6&&f>=258){q.next_out=B,q.avail_out=f,q.next_in=T,q.avail_in=t,b.hold=m,b.bits=E,v(q,L),B=q.next_out,X=q.output,f=q.avail_out,T=q.next_in,u=q.input,t=q.avail_in,m=b.hold,E=b.bits,b.mode===k&&(b.back=-1);break}for(b.back=0;P=b.lencode[m&(1<<b.lenbits)-1],x=P>>>24,F=P>>>16&255,a=65535&P,!(x<=E);){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(F&&0===(240&F)){for(n=x,o=F,s=a;P=b.lencode[s+((m&(1<<n+o)-1)>>n)],x=P>>>24,F=P>>>16&255,a=65535&P,!(n+x<=E);){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}m>>>=n,E-=n,b.back+=n}if(m>>>=x,E-=x,b.back+=x,b.length=a,0===F){b.mode=26;break}if(32&F){b.back=-1,b.mode=k;break}if(64&F){q.gS="invalid literal/length code",b.mode=W;break}b.extra=15&F,b.mode=22;case 22:if(b.extra){for(j=b.extra;E<j;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.length+=m&(1<<b.extra)-1,m>>>=b.extra,E-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;P=b.distcode[m&(1<<b.distbits)-1],x=P>>>24,F=P>>>16&255,a=65535&P,!(x<=E);){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(0===(240&F)){for(n=x,o=F,s=a;P=b.distcode[s+((m&(1<<n+o)-1)>>n)],x=P>>>24,F=P>>>16&255,a=65535&P,!(n+x<=E);){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}m>>>=n,E-=n,b.back+=n}if(m>>>=x,E-=x,b.back+=x,64&F){q.gS="invalid distance code",b.mode=W;break}b.offset=a,b.extra=15&F,b.mode=24;case 24:if(b.extra){for(j=b.extra;E<j;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}b.offset+=m&(1<<b.extra)-1,m>>>=b.extra,E-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){q.gS="invalid distance too far back",b.mode=W;break}b.mode=25;case 25:if(0===f)break q;if(d=L-f,b.offset>d){if(d=b.offset-d,d>b.whave&&b.sane){q.gS="invalid distance too far back",b.mode=W;break}d>b.wnext?(d-=b.wnext,K=b.wsize-d):K=b.wnext-d,d>b.length&&(d=b.length),D=b.window}else D=X,K=B-b.offset,d=b.length;d>f&&(d=f),f-=d,b.length-=d;do{X[B++]=D[K++]}while(--d);0===b.length&&(b.mode=21);break;case 26:if(0===f)break q;X[B++]=b.length,f--,b.mode=21;break;case 27:if(b.wrap){for(;E<32;){if(0===t)break q;t--,m|=u[T++]<<E,E+=8}if(L-=f,q.total_out+=L,b.total+=L,L&&(q.adler=b.check=b.flags?C(b.check,X,L,B-L):z(b.check,X,L,B-L)),L=f,(b.flags?m:N(m))!==b.check){q.gS="incorrect data check",b.mode=W;break}m=0,E=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;E<32;){if(0===t)break q;t--,m+=u[T++]<<E,E+=8}if(m!==(4294967295&b.total)){q.gS="incorrect length check",b.mode=W;break}m=0,E=0}b.mode=29;case 29:w=l;break q;case W:w=G;break q;case 31:return Z;default:return R}return q.next_out=B,q.avail_out=f,q.next_in=T,q.avail_in=t,b.hold=m,b.bits=E,(b.wsize||L!==q.avail_out&&b.mode<W&&(b.mode<27||S!==g))&&i(q,q.output,q.next_out,L-q.avail_out)?(b.mode=31,Z):(J-=q.avail_in,L-=q.avail_out,q.total_in+=J,q.total_out+=L,b.total+=L,b.wrap&&L&&(q.adler=b.check=b.flags?C(b.check,X,L,q.next_out-L):z(b.check,X,L,q.next_out-L)),q.data_type=b.bits+(b.last?64:0)+(b.mode===k?128:0)+(20===b.mode||15===b.mode?256:0),(0===J&&0===L||S===g)&&w===V&&(w=H),w)},q.exports.inflateEnd=q=>{if(!q||!q.state)return R;let S=q.state;return S.window&&(S.window=null),q.state=null,V},q.exports.inflateGetHeader=(q,S)=>{if(!q||!q.state)return R;const b=q.state;return 0===(2&b.wrap)?R:(b.head=S,S.done=!1,V)},q.exports.inflateSetDictionary=(q,S)=>{const b=S.length;let C,v,U;return q&&q.state?(C=q.state,0!==C.wrap&&11!==C.mode?R:11===C.mode&&(v=1,v=z(v,S,b,0),v!==C.check)?G:(U=i(q,S,b,b),U?(C.mode=31,Z):(C.havedict=1,V))):R},q.exports.inflateInfo="pako inflate (from Nodeca project)"},12290:q=>{"use strict";const S=15,b=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),C=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),v=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);q.exports=(q,U,g,r,I,V,l,y)=>{const R=y.bits;let G,Z,H,Q,k,W,N=0,u=0,X=0,T=0,B=0,t=0,f=0,m=0,E=0,e=0,i=null,J=0;const L=new Uint16Array(16),d=new Uint16Array(16);let K,D,x,F=null,a=0;for(N=0;N<=S;N++)L[N]=0;for(u=0;u<r;u++)L[U[g+u]]++;for(B=R,T=S;T>=1&&0===L[T];T--);if(B>T&&(B=T),0===T)return I[V++]=20971520,I[V++]=20971520,y.bits=1,0;for(X=1;X<T&&0===L[X];X++);for(B<X&&(B=X),m=1,N=1;N<=S;N++)if(m<<=1,m-=L[N],m<0)return-1;if(m>0&&(0===q||1!==T))return-1;for(d[1]=0,N=1;N<S;N++)d[N+1]=d[N]+L[N];for(u=0;u<r;u++)0!==U[g+u]&&(l[d[U[g+u]]++]=u);if(0===q?(i=F=l,W=19):1===q?(i=b,J-=257,F=z,a-=257,W=256):(i=C,F=v,W=-1),e=0,u=0,N=X,k=V,t=B,f=0,H=-1,E=1<<B,Q=E-1,1===q&&E>852||2===q&&E>592)return 1;for(;;){K=N-f,l[u]<W?(D=0,x=l[u]):l[u]>W?(D=F[a+l[u]],x=i[J+l[u]]):(D=96,x=0),G=1<<N-f,Z=1<<t,X=Z;do{Z-=G,I[k+(e>>f)+Z]=K<<24|D<<16|x}while(0!==Z);for(G=1<<N-1;e&G;)G>>=1;if(0!==G?(e&=G-1,e+=G):e=0,u++,0===--L[N]){if(N===T)break;N=U[g+l[u]]}if(N>B&&(e&Q)!==H){for(0===f&&(f=B),k+=X,t=N-f,m=1<<t;t+f<T&&(m-=L[t+f],!(m<=0));)t++,m<<=1;if(E+=1<<t,1===q&&E>852||2===q&&E>592)return 1;H=e&Q,I[H]=B<<24|t<<16|k-V}}return 0!==e&&(I[k+e]=N-f<<24|64<<16),y.bits=B,0}},12250:q=>{"use strict";q.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12230:q=>{"use strict";function S(q){let S=q.length;for(;--S>=0;)q[S]=0}const b=256,z=286,C=30,v=15,U=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),g=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V=new Array(576);S(V);const l=new Array(60);S(l);const y=new Array(512);S(y);const R=new Array(256);S(R);const G=new Array(29);S(G);const Z=new Array(C);function H(q,S,b,z,C){this.static_tree=q,this.extra_bits=S,this.extra_base=b,this.elems=z,this.max_length=C,this.has_stree=q&&q.length}let Q,k,W;function N(q,S){this.dyn_tree=q,this.max_code=0,this.stat_desc=S}S(Z);const u=q=>q<256?y[q]:y[256+(q>>>7)],X=(q,S)=>{q.pending_buf[q.pending++]=255&S,q.pending_buf[q.pending++]=S>>>8&255},T=(q,S,b)=>{q.bi_valid>16-b?(q.bi_buf|=S<<q.bi_valid&65535,X(q,q.bi_buf),q.bi_buf=S>>16-q.bi_valid,q.bi_valid+=b-16):(q.bi_buf|=S<<q.bi_valid&65535,q.bi_valid+=b)},B=(q,S,b)=>{T(q,b[2*S],b[2*S+1])},t=(q,S)=>{let b=0;do{b|=1&q,q>>>=1,b<<=1}while(--S>0);return b>>>1},f=(q,S,b)=>{const z=new Array(16);let C,U,g=0;for(C=1;C<=v;C++)z[C]=g=g+b[C-1]<<1;for(U=0;U<=S;U++){let S=q[2*U+1];0!==S&&(q[2*U]=t(z[S]++,S))}},m=q=>{let S;for(S=0;S<z;S++)q.dyn_ltree[2*S]=0;for(S=0;S<C;S++)q.dyn_dtree[2*S]=0;for(S=0;S<19;S++)q.bl_tree[2*S]=0;q.dyn_ltree[512]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0},E=q=>{q.bi_valid>8?X(q,q.bi_buf):q.bi_valid>0&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0},e=(q,S,b,z)=>{const C=2*S,v=2*b;return q[C]<q[v]||q[C]===q[v]&&z[S]<=z[b]},i=(q,S,b)=>{const z=q.heap[b];let C=b<<1;for(;C<=q.heap_len&&(C<q.heap_len&&e(S,q.heap[C+1],q.heap[C],q.depth)&&C++,!e(S,z,q.heap[C],q.depth));)q.heap[b]=q.heap[C],b=C,C<<=1;q.heap[b]=z},J=(q,S,z)=>{let C,v,r,I,V=0;if(0!==q.last_lit)do{C=q.pending_buf[q.d_buf+2*V]<<8|q.pending_buf[q.d_buf+2*V+1],v=q.pending_buf[q.l_buf+V],V++,0===C?B(q,v,S):(r=R[v],B(q,r+b+1,S),I=U[r],0!==I&&(v-=G[r],T(q,v,I)),C--,r=u(C),B(q,r,z),I=g[r],0!==I&&(C-=Z[r],T(q,C,I)))}while(V<q.last_lit);B(q,256,S)},L=(q,S)=>{const b=S.dyn_tree,z=S.stat_desc.static_tree,C=S.stat_desc.has_stree,U=S.stat_desc.elems;let g,r,I,V=-1;for(q.heap_len=0,q.heap_max=573,g=0;g<U;g++)0!==b[2*g]?(q.heap[++q.heap_len]=V=g,q.depth[g]=0):b[2*g+1]=0;for(;q.heap_len<2;)I=q.heap[++q.heap_len]=V<2?++V:0,b[2*I]=1,q.depth[I]=0,q.opt_len--,C&&(q.static_len-=z[2*I+1]);for(S.max_code=V,g=q.heap_len>>1;g>=1;g--)i(q,b,g);I=U;do{g=q.heap[1],q.heap[1]=q.heap[q.heap_len--],i(q,b,1),r=q.heap[1],q.heap[--q.heap_max]=g,q.heap[--q.heap_max]=r,b[2*I]=b[2*g]+b[2*r],q.depth[I]=(q.depth[g]>=q.depth[r]?q.depth[g]:q.depth[r])+1,b[2*g+1]=b[2*r+1]=I,q.heap[1]=I++,i(q,b,1)}while(q.heap_len>=2);q.heap[--q.heap_max]=q.heap[1],((q,S)=>{const b=S.dyn_tree,z=S.max_code,C=S.stat_desc.static_tree,U=S.stat_desc.has_stree,g=S.stat_desc.extra_bits,r=S.stat_desc.extra_base,I=S.stat_desc.max_length;let V,l,y,R,G,Z,H=0;for(R=0;R<=v;R++)q.bl_count[R]=0;for(b[2*q.heap[q.heap_max]+1]=0,V=q.heap_max+1;V<573;V++)l=q.heap[V],R=b[2*b[2*l+1]+1]+1,R>I&&(R=I,H++),b[2*l+1]=R,l>z||(q.bl_count[R]++,G=0,l>=r&&(G=g[l-r]),Z=b[2*l],q.opt_len+=Z*(R+G),U&&(q.static_len+=Z*(C[2*l+1]+G)));if(0!==H){do{for(R=I-1;0===q.bl_count[R];)R--;q.bl_count[R]--,q.bl_count[R+1]+=2,q.bl_count[I]--,H-=2}while(H>0);for(R=I;0!==R;R--)for(l=q.bl_count[R];0!==l;)y=q.heap[--V],y>z||(b[2*y+1]!==R&&(q.opt_len+=(R-b[2*y+1])*b[2*y],b[2*y+1]=R),l--)}})(q,S),f(b,V,q.bl_count)},d=(q,S,b)=>{let z,C,v=-1,U=S[1],g=0,r=7,I=4;for(0===U&&(r=138,I=3),S[2*(b+1)+1]=65535,z=0;z<=b;z++)C=U,U=S[2*(z+1)+1],++g<r&&C===U||(g<I?q.bl_tree[2*C]+=g:0!==C?(C!==v&&q.bl_tree[2*C]++,q.bl_tree[32]++):g<=10?q.bl_tree[34]++:q.bl_tree[36]++,g=0,v=C,0===U?(r=138,I=3):C===U?(r=6,I=3):(r=7,I=4))},K=(q,S,b)=>{let z,C,v=-1,U=S[1],g=0,r=7,I=4;for(0===U&&(r=138,I=3),z=0;z<=b;z++)if(C=U,U=S[2*(z+1)+1],!(++g<r&&C===U)){if(g<I)do{B(q,C,q.bl_tree)}while(0!==--g);else 0!==C?(C!==v&&(B(q,C,q.bl_tree),g--),B(q,16,q.bl_tree),T(q,g-3,2)):g<=10?(B(q,17,q.bl_tree),T(q,g-3,3)):(B(q,18,q.bl_tree),T(q,g-11,7));g=0,v=C,0===U?(r=138,I=3):C===U?(r=6,I=3):(r=7,I=4)}};let D=!1;const x=(q,S,b,z)=>{T(q,0+(z?1:0),3),((q,S,b,z)=>{E(q),z&&(X(q,b),X(q,~b)),q.pending_buf.set(q.window.subarray(S,S+b),q.pending),q.pending+=b})(q,S,b,!0)};q.exports._tr_init=q=>{D||((()=>{let q,S,b,I,N;const u=new Array(16);for(b=0,I=0;I<28;I++)for(G[I]=b,q=0;q<1<<U[I];q++)R[b++]=I;for(R[b-1]=I,N=0,I=0;I<16;I++)for(Z[I]=N,q=0;q<1<<g[I];q++)y[N++]=I;for(N>>=7;I<C;I++)for(Z[I]=N<<7,q=0;q<1<<g[I]-7;q++)y[256+N++]=I;for(S=0;S<=v;S++)u[S]=0;for(q=0;q<=143;)V[2*q+1]=8,q++,u[8]++;for(;q<=255;)V[2*q+1]=9,q++,u[9]++;for(;q<=279;)V[2*q+1]=7,q++,u[7]++;for(;q<=287;)V[2*q+1]=8,q++,u[8]++;for(f(V,287,u),q=0;q<C;q++)l[2*q+1]=5,l[2*q]=t(q,5);Q=new H(V,U,257,z,v),k=new H(l,g,0,C,v),W=new H(new Array(0),r,0,19,7)})(),D=!0),q.l_desc=new N(q.dyn_ltree,Q),q.d_desc=new N(q.dyn_dtree,k),q.bl_desc=new N(q.bl_tree,W),q.bi_buf=0,q.bi_valid=0,m(q)},q.exports._tr_stored_block=x,q.exports._tr_flush_block=(q,S,z,C)=>{let v,U,g=0;q.level>0?(2===q.strm.data_type&&(q.strm.data_type=(q=>{let S,z=4093624447;for(S=0;S<=31;S++,z>>>=1)if(1&z&&0!==q.dyn_ltree[2*S])return 0;if(0!==q.dyn_ltree[18]||0!==q.dyn_ltree[20]||0!==q.dyn_ltree[26])return 1;for(S=32;S<b;S++)if(0!==q.dyn_ltree[2*S])return 1;return 0})(q)),L(q,q.l_desc),L(q,q.d_desc),g=(q=>{let S;for(d(q,q.dyn_ltree,q.l_desc.max_code),d(q,q.dyn_dtree,q.d_desc.max_code),L(q,q.bl_desc),S=18;S>=3&&0===q.bl_tree[2*I[S]+1];S--);return q.opt_len+=3*(S+1)+5+5+4,S})(q),v=q.opt_len+3+7>>>3,U=q.static_len+3+7>>>3,U<=v&&(v=U)):v=U=z+5,z+4<=v&&-1!==S?x(q,S,z,C):4===q.strategy||U===v?(T(q,2+(C?1:0),3),J(q,V,l)):(T(q,4+(C?1:0),3),((q,S,b,z)=>{let C;for(T(q,S-257,5),T(q,b-1,5),T(q,z-4,4),C=0;C<z;C++)T(q,q.bl_tree[2*I[C]+1],3);K(q,q.dyn_ltree,S-1),K(q,q.dyn_dtree,b-1)})(q,q.l_desc.max_code+1,q.d_desc.max_code+1,g+1),J(q,q.dyn_ltree,q.dyn_dtree)),m(q),C&&E(q)},q.exports._tr_tally=(q,S,z)=>(q.pending_buf[q.d_buf+2*q.last_lit]=S>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&S,q.pending_buf[q.l_buf+q.last_lit]=255&z,q.last_lit++,0===S?q.dyn_ltree[2*z]++:(q.matches++,S--,q.dyn_ltree[2*(R[z]+b+1)]++,q.dyn_dtree[2*u(S)]++),q.last_lit===q.lit_bufsize-1),q.exports._tr_align=q=>{T(q,2,3),B(q,256,V),(q=>{16===q.bi_valid?(X(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):q.bi_valid>=8&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(q)}},12273:q=>{"use strict";q.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.gS="",this.state=null,this.data_type=2,this.adler=0}},11900:q=>{function S(q,S,b){for(var z=q.length,C=-1/0,v=1/0,U=0;U<z;U++){var g=(b[0][U]-q[U])/S[U],r=(b[1][U]-q[U])/S[U];if(g>r){var I=g;g=r,r=I}if(r<C||g>v)return 1/0;g>C&&(C=g),r<v&&(v=r)}return C>v?1/0:C}q.exports=function(q,b,z,C){var v=S(b,z,C);if(v===1/0)q=null;else{q=q||[];for(var U=0;U<b.length;U++)q[U]=b[U]+z[U]*v}return q},q.exports.distance=S},13288:(q,S,b)=>{"use strict";b.d(S,{c:()=>U});var z=b(34);const C=z.useLayoutEffect;const v=function(q){var S=(0,z.useRef)(q);return C((function(){S.current=q})),S};var U=function(q){var S=v(q);(0,z.CS)((function(){var q=function(q){var b;if(null!=S.current&&(b=S.current(q)),q.defaultPrevented&&(q.returnValue=""),"string"===typeof b)return q.returnValue=b,b};return window.addEventListener("beforeunload",q),function(){window.removeEventListener("beforeunload",q)}}),[])}},13235:(q,S,b)=>{"use strict";var z=b(13243),C=Array.prototype.concat,v=Array.prototype.slice,U=q.exports=function(q){for(var S=[],b=0,U=q.length;b<U;b++){var g=q[b];z(g)?S=C.call(S,v.call(g)):S.push(g)}return S};U.wrap=function(q){return function(){return q(U(arguments))}}},13243:q=>{q.exports=function(q){return!(!q||"string"===typeof q)&&(q instanceof Array||Array.isArray(q)||q.length>=0&&(q.splice instanceof Function||Object.getOwnPropertyDescriptor(q,q.length-1)&&"String"!==q.constructor.name))}},12180:(q,S,b)=>{var z=b(12186);function C(q){for(var S,b,C=0,v=q.length,U=0;U<q.length;){for(S=q[U],b=0;U<v&&q[U]===S;)++U,++b;C+=z.log2(b)/7|0,C+=z.log2(S>>>0)/7|0,C+=2}return C}S.size=C,S.encode=function(q,S){S||(S=new Uint8Array(C(q)));for(var b,z,v=0,U=S.length,g=0;g<q.length;){for(b=q[g],z=0;g<q.length&&q[g]===b;)++g,++z;for(;v<U&&z>=128;)S[v++]=128+(127&z),z>>>=7;if(v>=U)throw new Error("RLE buffer overflow");for(S[v++]=z,b>>>=0;v<U&&b>=128;)S[v++]=128+(127&b),b>>>=7;if(v>=U)throw new Error("RLE buffer overflow");S[v++]=b}return S},S.decode=function(q,S){for(var b,z,C,v,U=S.length,g=q.length,r=0,I=0;I<g;){for(b=0,z=0;I<g&&q[I]>=128;)b+=(127&q[I++])<<z,z+=7;if(b+=q[I++]<<z,I>=g)throw new Error("RLE buffer underrun");if(r+b>U)throw new Error("Chunk buffer overflow");for(C=0,z=0;I<g&&q[I]>=128;)C+=(127&q[I++])<<z,z+=7;if(I>=g)throw new Error("RLE buffer underrun");for(C+=q[I++]<<z,v=0;v<b;++v)S[r++]=C}return S}},12186:(q,S)=>{"use strict";function b(q){var S=32;return(q&=-q)&&S--,65535&q&&(S-=16),16711935&q&&(S-=8),252645135&q&&(S-=4),858993459&q&&(S-=2),1431655765&q&&(S-=1),S}S.INT_BITS=32,S.INT_MAX=2147483647,S.INT_MIN=-1<<31,S.sign=function(q){return(q>0)-(q<0)},S.abs=function(q){var S=q>>31;return(q^S)-S},S.min=function(q,S){return S^(q^S)&-(q<S)},S.max=function(q,S){return q^(q^S)&-(q<S)},S.isPow2=function(q){return!(q&q-1)&&!!q},S.log2=function(q){var S,b;return S=(q>65535)<<4,S|=b=((q>>>=S)>255)<<3,S|=b=((q>>>=b)>15)<<2,(S|=b=((q>>>=b)>3)<<1)|(q>>>=b)>>1},S.log10=function(q){return q>=1e9?9:q>=1e8?8:q>=1e7?7:q>=1e6?6:q>=1e5?5:q>=1e4?4:q>=1e3?3:q>=100?2:q>=10?1:0},S.popCount=function(q){return 16843009*((q=(858993459&(q-=q>>>1&1431655765))+(q>>>2&858993459))+(q>>>4)&252645135)>>>24},S.countTrailingZeros=b,S.nextPow2=function(q){return q+=0===q,--q,q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)+1},S.prevPow2=function(q){return q|=q>>>1,q|=q>>>2,q|=q>>>4,q|=q>>>8,(q|=q>>>16)-(q>>>1)},S.parity=function(q){return q^=q>>>16,q^=q>>>8,q^=q>>>4,27030>>>(q&=15)&1};var z=new Array(256);!function(q){for(var S=0;S<256;++S){var b=S,z=S,C=7;for(b>>>=1;b;b>>>=1)z<<=1,z|=1&b,--C;q[S]=z<<C&255}}(z),S.reverse=function(q){return z[255&q]<<24|z[q>>>8&255]<<16|z[q>>>16&255]<<8|z[q>>>24&255]},S.interleave2=function(q,S){return(q=1431655765&((q=858993459&((q=252645135&((q=16711935&((q&=65535)|q<<8))|q<<4))|q<<2))|q<<1))|(S=1431655765&((S=858993459&((S=252645135&((S=16711935&((S&=65535)|S<<8))|S<<4))|S<<2))|S<<1))<<1},S.deinterleave2=function(q,S){return(q=65535&((q=16711935&((q=252645135&((q=858993459&((q=q>>>S&1431655765)|q>>>1))|q>>>2))|q>>>4))|q>>>16))<<16>>16},S.interleave3=function(q,S,b){return q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2),(q|=(S=1227133513&((S=3272356035&((S=251719695&((S=4278190335&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<1)|(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<2},S.deinterleave3=function(q,S){return(q=1023&((q=4278190335&((q=251719695&((q=3272356035&((q=q>>>S&1227133513)|q>>>2))|q>>>4))|q>>>8))|q>>>16))<<22>>22},S.nextCombination=function(q){var S=q|q-1;return S+1|(~S&-~S)-1>>>b(q)+1}},12208:q=>{"use strict";q.exports=function(q,S,b,z){var C=self||window;try{try{var v;try{v=new C.Blob([q])}catch(I){(v=new(C.BlobBuilder||C.WebKitBlobBuilder||C.MozBlobBuilder||C.MSBlobBuilder)).append(q),v=v.getBlob()}var U=C.URL||C.webkitURL,g=U.createObjectURL(v),r=new C[S](g,b);return U.revokeObjectURL(g),r}catch(I){return new C[S]("data:application/javascript,".concat(encodeURIComponent(q)),b)}}catch(I){if(!z)throw Error("Inline worker is not supported");return new C[S](z,b)}}},11893:(q,S,b)=>{"use strict";function z(q,S,b,z,C){var v={};return Object.keys(z).forEach((function(q){v[q]=z[q]})),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=b.slice().reverse().reduce((function(b,z){return z(q,S,b)||b}),v),C&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(C):void 0,v.initializer=void 0),void 0===v.initializer&&(Object.defineProperty(q,S,v),v=null),v}b.d(S,{e:()=>z})},11886:(q,S,b)=>{"use strict";function z(q,S,b,z){b&&Object.defineProperty(q,S,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(z):void 0})}b.d(S,{d:()=>z})},13281:(q,S,b)=>{"use strict";b.d(S,{e:()=>U,f:()=>l,i:()=>g,l:()=>v,o:()=>r,q:()=>C,r:()=>I,v:()=>V});var z=b(11314);class C{constructor(){this._easingMode=C.EASINGMODE_EASEIN}setEasingMode(q){const S=Math.min(Math.max(q,0),2);this._easingMode=S}getEasingMode(){return this._easingMode}easeInCore(q){throw new Error("You must implement this method")}ease(q){switch(this._easingMode){case C.EASINGMODE_EASEIN:return this.easeInCore(q);case C.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-q)}return q>=.5?.5*(1-this.easeInCore(2*(1-q)))+.5:.5*this.easeInCore(2*q)}}C.EASINGMODE_EASEIN=0,C.EASINGMODE_EASEOUT=1,C.EASINGMODE_EASEINOUT=2;class v extends C{easeInCore(q){return q=Math.max(0,Math.min(1,q)),1-Math.sqrt(1-q*q)}}class U extends C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=q}easeInCore(q){const S=Math.max(0,this.amplitude);return Math.pow(q,3)-q*S*Math.sin(3.141592653589793*q)}}class g extends C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=q,this.bounciness=S}easeInCore(q){const S=Math.max(0,this.bounces);let b=this.bounciness;b<=1&&(b=1.001);const z=Math.pow(b,S),C=1-b,v=(1-z)/C+.5*z,U=q*v,g=Math.log(-U*(1-b)+1)/Math.log(b),r=Math.floor(g),I=r+1,V=(1-Math.pow(b,r))/(C*v),l=.5*(V+(1-Math.pow(b,I))/(C*v)),y=q-l,R=l-V;return-Math.pow(1/b,S-r)/(R*R)*(y-R)*(y+R)}}class r extends C{easeInCore(q){return q*q*q}}class I extends C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=q,this.springiness=S}easeInCore(q){let S;const b=Math.max(0,this.oscillations),z=Math.max(0,this.springiness);return S=0==z?q:(Math.exp(z*q)-1)/(Math.exp(z)-1),S*Math.sin((6.283185307179586*b+1.5707963267948966)*q)}}class V extends C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=q}easeInCore(q){return this.exponent<=0?q:(Math.exp(this.exponent*q)-1)/(Math.exp(this.exponent)-1)}}class l extends C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=q,this.y1=S,this.x2=b,this.y2=z}easeInCore(q){return z.c.Interpolate(q,this.x1,this.y1,this.x2,this.y2)}}},12757:(q,S,b)=>{"use strict";b.d(S,{b:()=>U});var z=b(11103),C=b(11118),v=b(11523);class U extends v.e{get _matrix(){return this._compose(),this.oy}set _matrix(q){(q.updateFlag!==this.oy.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.oy.v(q),this._markAsDirtyAndDecompose())}constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(q,S.Tq(),!1),this.name=q,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=S,this.oy=(null===C||void 0===C?void 0:C.clone())??z.Matrix.Identity(),this._restMatrix=v??this.oy.clone(),this._bindMatrix=U??this.oy.clone(),this._index=g,this._absoluteMatrix=new z.Matrix,this._absoluteBindMatrix=new z.Matrix,this._absoluteInverseBindMatrix=new z.Matrix,this._finalMatrix=new z.Matrix,S.bones.push(this),this.setParent(b,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(q){this.setParent(q)}setParent(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==q){if(this.parent){const q=this.parent.children.indexOf(this);-1!==q&&this.parent.children.splice(q,1)}this._parentNode=q,this.parent&&this.parent.children.push(this),S&&this._updateAbsoluteBindMatrices(),this.gV()}}getLocalMatrix(){return this._compose(),this.oy}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(q){this._restMatrix.v(q)}setRestPose(q){this.setRestMatrix(q)}getBindPose(){return this.getBindMatrix()}setBindMatrix(q){this.Wb(q)}setBindPose(q){this.setBindMatrix(q)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const q=z.TmpVectors.yS[0],S=z.TmpVectors.Quaternion[0],b=z.TmpVectors.yS[1];this.getRestMatrix().decompose(q,S,b),this._linkedTransformNode.position.v(b),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??z.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.v(S),this._linkedTransformNode.tb.v(q)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(q){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=q,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Nr}set position(q){this._decompose(),this.Nr.v(q),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(q){this.setRotation(q)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(q){this.setRotationQuaternion(q)}get tb(){return this.getScale()}set tb(q){this.setScale(q)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.yS.Zero(),this._localRotation=z.Quaternion.Zero(),this.Nr=z.yS.Zero()),this.oy.decompose(this._localScaling,this._localRotation,this.Nr))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Nr,this.oy)):this._needToCompose=!1)}Wb(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.v(q),S&&this._updateAbsoluteBindMatrices(),b?this._matrix=q:this.gV()}_updateAbsoluteBindMatrices(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q||(q=this._bindMatrix),this.parent?q.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.v(q),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),S)for(let b=0;b<this.children.length;b++)this.children[b]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}gV(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.gV(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.gV(),this._needToDecompose=!0}_updatePosition(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const v=this.getLocalMatrix();if(0==S)C?(v.addAtIndex(12,q.x),v.addAtIndex(13,q.y),v.addAtIndex(14,q.z)):v.setTranslationFromFloats(q.x,q.y,q.z);else{let S=null;b&&(S=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const g=U._TmpMats[0],r=U._TmpVecs[0];this.parent?b&&S?(g.v(this.parent.getAbsoluteMatrix()),g.multiplyToRef(S,g)):g.v(this.parent.getAbsoluteMatrix()):z.Matrix.IdentityToRef(g),C&&g.setTranslationFromFloats(0,0,0),g.invert(),z.yS.TransformCoordinatesToRef(q,g,r),C?(v.addAtIndex(12,r.x),v.addAtIndex(13,r.y),v.addAtIndex(14,r.z)):v.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()}translate(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,S,b,!0)}setPosition(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this._updatePosition(q,S,b,!1)}setAbsolutePosition(q,S){this.setPosition(q,1,S)}scale(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const v=this.getLocalMatrix(),g=U._TmpMats[0];z.Matrix.ScalingToRef(q,S,b,g),g.multiplyToRef(v,v),g.invert();for(const z of this.children){const C=z.getLocalMatrix();C.multiplyToRef(g,C),C.multiplyAtIndex(12,q),C.multiplyAtIndex(13,S),C.multiplyAtIndex(14,b),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),C)for(const z of this.children)z.scale(q,S,b,C)}setScale(q){this._decompose(),this._localScaling.v(q),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(q){this._decompose(),q.v(this._localScaling)}setYawPitchRoll(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4?arguments[4]:void 0;if(0===C){const g=U._TmpQuat;return z.Quaternion.RotationYawPitchRollToRef(q,S,b,g),void this.setRotationQuaternion(g,C,v)}const g=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,v))return;const r=U._TmpMats[1];z.Matrix.RotationYawPitchRollToRef(q,S,b,r),g.multiplyToRef(r,r),this._rotateWithMatrix(r,C,v)}rotate(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;const v=U._TmpMats[0];v.setTranslationFromFloats(0,0,0),z.Matrix.RotationAxisToRef(q,S,v),this._rotateWithMatrix(v,b,C)}setAxisAngle(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3?arguments[3]:void 0;if(0===b){const v=U._TmpQuat;return z.Quaternion.RotationAxisToRef(q,S,v),void this.setRotationQuaternion(v,b,C)}const v=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(v,C))return;const g=U._TmpMats[1];z.Matrix.RotationAxisToRef(q,S,g),v.multiplyToRef(g,g),this._rotateWithMatrix(g,b,C)}setRotation(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(q.y,q.x,q.z,S,b)}setRotationQuaternion(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===S)return this._decompose(),this._localRotation.v(q),void this._markAsDirtyAndCompose();const C=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,b))return;const v=U._TmpMats[1];z.Matrix.FromQuaternionToRef(q,v),C.multiplyToRef(v,v),this._rotateWithMatrix(v,S,b)}setRotationMatrix(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;if(0===S){const C=U._TmpQuat;return z.Quaternion.FromRotationMatrixToRef(q,C),void this.setRotationQuaternion(C,S,b)}const C=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,b))return;const v=U._TmpMats[1];v.v(q),C.multiplyToRef(q,v),this._rotateWithMatrix(v,S,b)}_rotateWithMatrix(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const z=this.getLocalMatrix(),C=z.m[12],v=z.m[13],g=z.m[14],r=this.getParent(),I=U._TmpMats[3],V=U._TmpMats[4];r&&1==S?(b?(I.v(b.getWorldMatrix()),r.getAbsoluteMatrix().multiplyToRef(I,I)):I.v(r.getAbsoluteMatrix()),V.v(I),V.invert(),z.multiplyToRef(I,z),z.multiplyToRef(q,z),z.multiplyToRef(V,z)):1==S&&b?(I.v(b.getWorldMatrix()),V.v(I),V.invert(),z.multiplyToRef(I,z),z.multiplyToRef(q,z),z.multiplyToRef(V,z)):z.multiplyToRef(q,z),z.setTranslationFromFloats(C,v,g),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(q,S){const b=U._TmpMats[2];return q.v(this.getAbsoluteMatrix()),S?(q.multiplyToRef(S.getWorldMatrix(),q),z.Matrix.ScalingToRef(S.tb.x,S.tb.y,S.tb.z,b)):z.Matrix.IdentityToRef(b),q.invert(),!isNaN(q.m[0])&&(b.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyToRef(b,q),!0)}bb(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.yS.Zero();return this.getPositionToRef(q,S,b),b}getPositionToRef(){let q=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const q=this.getLocalMatrix();S.x=q.m[12],S.y=q.m[13],S.z=q.m[14]}else{let b=null;q&&(b=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let z=U._TmpMats[0];q&&b?(z.v(this.getAbsoluteMatrix()),z.multiplyToRef(b,z)):z=this.getAbsoluteMatrix(),S.x=z.m[12],S.y=z.m[13],S.z=z.m[14]}}getAbsolutePosition(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=z.yS.Zero();return this.getPositionToRef(1,q,S),S}getAbsolutePositionToRef(q,S){this.getPositionToRef(1,q,S)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.oy.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.v(this.oy);const q=this._skeleton.getPoseMatrix();q&&this._absoluteMatrix.multiplyToRef(q,this._absoluteMatrix)}const q=this.children,S=q.length;for(let b=0;b<S;b++)q[b].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Yr(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.yS.Zero();return this.getDirectionToRef(q,S,b),b}getDirectionToRef(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,C=null;S&&(C=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const v=U._TmpMats[0];v.v(this.getAbsoluteMatrix()),S&&C&&v.multiplyToRef(C,v),z.yS.TransformNormalToRef(q,v,b),b.normalize()}getRotation(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.yS.Zero();return this.getRotationToRef(q,S,b),b}getRotationToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;const z=U._TmpQuat;this.getRotationQuaternionToRef(q,S,z),z.toEulerAnglesToRef(b)}getRotationQuaternion(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.Quaternion.Identity();return this.getRotationQuaternionToRef(q,S,b),b}getRotationQuaternionToRef(){let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),S.v(this._localRotation);else{const b=U._TmpMats[0],z=this.getAbsoluteMatrix();q?z.multiplyToRef(q.getWorldMatrix(),b):b.v(z),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.decompose(void 0,S,void 0)}}getRotationMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1?arguments[1]:void 0;const b=z.Matrix.Identity();return this.getRotationMatrixToRef(q,S,b),b}getRotationMatrixToRef(){let q=arguments.length>1?arguments[1]:void 0,S=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(S);else{const b=U._TmpMats[0],z=this.getAbsoluteMatrix();q?z.multiplyToRef(q.getWorldMatrix(),b):b.v(z),b.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyAtIndex(1,this._scalingDeterminant),b.multiplyAtIndex(2,this._scalingDeterminant),b.getRotationMatrixToRef(S)}}getAbsolutePositionFromLocal(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.yS.Zero();return this.getAbsolutePositionFromLocalToRef(q,S,b),b}getAbsolutePositionFromLocalToRef(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,C=null;S&&(C=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const v=U._TmpMats[0];v.v(this.getAbsoluteMatrix()),S&&C&&v.multiplyToRef(C,v),z.yS.TransformCoordinatesToRef(q,v,b)}getLocalPositionFromAbsolute(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=z.yS.Zero();return this.getLocalPositionFromAbsoluteToRef(q,S,b),b}getLocalPositionFromAbsoluteToRef(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,C=null;S&&(C=S.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const v=U._TmpMats[0];v.v(this.getAbsoluteMatrix()),S&&C&&v.multiplyToRef(C,v),v.invert(),z.yS.TransformCoordinatesToRef(q,v,b)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const q=this._skeleton.bones.indexOf(this);if(-1!==q&&this._skeleton.bones.splice(q,1),this._parentNode&&this._parentNode.children){const q=this._parentNode.children,S=q.indexOf(this);-1!==S&&q.splice(S,1)}super.dispose()}}U._TmpVecs=(0,C.e)(2,z.yS.Zero),U._TmpQuat=z.Quaternion.Identity(),U._TmpMats=(0,C.e)(5,z.Matrix.Identity)},13275:(q,S,b)=>{"use strict";b.d(S,{c:()=>L});var z=b(11081),C=b(11090),v=b(10929),U=b(11103),g=b(11121),r=b(11523),I=b(11555),V=b(11381),l=b(10957),y=b(11109);class R{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(q){this._idleRotationSpeed=q}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(q){this._idleRotationWaitTime=q}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(q){this._idleRotationSpinupTime=q}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(q){this._attachedCamera=q;const S=this._attachedCamera.Tq();this._onPrePointerObservableObserver=S.onPrePointerObservable.add((q=>{q.type!==V.e.POINTERDOWN?q.type===V.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const q=l.e.Now;let S=0;null!=this._lastFrameTime&&(S=q-this._lastFrameTime),this._lastFrameTime=q,this._applyUserInteraction();const b=q-this._lastInteractionTime-this._idleRotationWaitTime,z=Math.max(Math.min(b/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(S/1e3))}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Tq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(q){this._lastInteractionTime=q??l.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<y.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let q=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(q=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?q:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=l.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var G=b(13281),Z=b(11634);class H{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(q){if(this._autoTransitionRange===q)return;this._autoTransitionRange=q;const S=this._attachedCamera;S&&(q?this._onMeshTargetChangedObserver=S.onMeshTargetChangedObservable.add((q=>{if(q&&(q.Nb(!0),q.getBoundingInfo)){const S=q.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*S,this.upperRadiusTransitionRange=.05*S}})):this._onMeshTargetChangedObserver&&S.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(q){this._attachedCamera=q,this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(q){return!!this._attachedCamera&&(this._attachedCamera.radius===q&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(q){if(!this._attachedCamera)return;this._radiusBounceTransition||(H.EasingFunction.setEasingMode(H.EasingMode),this._radiusBounceTransition=Z.d.CreateAnimation("radius",Z.d.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const S=Z.d.TransitionTo("radius",this._attachedCamera.radius+q,this._attachedCamera,this._attachedCamera.Tq(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));S&&this._animatables.push(S)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}H.EasingFunction=new G.e(.3),H.EasingMode=G.q.EASINGMODE_EASEOUT;class Q{constructor(){this.onTargetFramingAnimationEndObservable=new v.d,this._mode=Q.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(q){this._mode=q}get mode(){return this._mode}set radiusScale(q){this._radiusScale=q}get radiusScale(){return this._radiusScale}set positionScale(q){this._positionScale=q}get positionScale(){return this._positionScale}set defaultElevation(q){this._defaultElevation=q}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(q){this._elevationReturnTime=q}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(q){this._elevationReturnWaitTime=q}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(q){this._zoomStopsAnimation=q}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(q){this._framingTime=q}get framingTime(){return this._framingTime}init(){}attach(q){this._attachedCamera=q;const S=this._attachedCamera.Tq();Q.EasingFunction.setEasingMode(Q.EasingMode),this._onPrePointerObservableObserver=S.onPrePointerObservable.add((q=>{q.type!==V.e.POINTERDOWN?q.type===V.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=q.onMeshTargetChangedObservable.add((q=>{q&&q.getBoundingInfo&&this.zoomOnMesh(q,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=q.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const q=this._attachedCamera.Tq();this._onPrePointerObservableObserver&&q.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Nb(!0);const z=q.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(z.minimumWorld,z.maximumWorld,S,b)}zoomOnMeshHierarchy(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.Nb(!0);const z=q.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(z.min,z.max,S,b)}zoomOnMeshesHierarchy(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new U.yS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new U.yS(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let v=0;v<q.length;v++){const S=q[v].getHierarchyBoundingVectors(!0);U.yS.CheckExtends(S.min,z,C),U.yS.CheckExtends(S.max,z,C)}this.zoomOnBoundingInfo(z,C,S,b)}zoomOnBoundingInfo(q,S){let b,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const v=q.y,g=v+(S.y-v)*this._positionScale,r=S.RS(q).scale(.5);if(!isFinite(g))return!1;if(z)b=new U.yS(0,g,0);else{const S=q.add(r);b=new U.yS(S.x,g,S.z)}this._vectorTransition||(this._vectorTransition=Z.d.CreateAnimation("target",Z.d.ANIMATIONTYPE_VECTOR3,60,Q.EasingFunction)),this._betaIsAnimating=!0;let I=Z.d.TransitionTo("target",b,this._attachedCamera,this._attachedCamera.Tq(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);let V=0;if(this._mode===Q.FitFrustumSidesMode){const b=this._calculateLowerRadiusFromModelBoundingSphere(q,S);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=r.length()+this._attachedCamera.kb),V=b}else this._mode===Q.IgnoreBoundsSizeMode&&(V=this._calculateLowerRadiusFromModelBoundingSphere(q,S),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.kb));if(this.autoCorrectCameraLimitsAndSensibility){const b=S.RS(q).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/V}return this._radiusTransition||(this._radiusTransition=Z.d.CreateAnimation("radius",Z.d.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction)),I=Z.d.TransitionTo("radius",V,this._attachedCamera,this._attachedCamera.Tq(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),C&&C(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),I&&this._animatables.push(I),!0}_calculateLowerRadiusFromModelBoundingSphere(q,S){const b=this._attachedCamera;if(!b)return 0;let z=b._calculateLowerRadiusFromModelBoundingSphere(q,S,this._radiusScale);return b.lowerRadiusLimit&&this._mode===Q.IgnoreBoundsSizeMode&&(z=z<b.lowerRadiusLimit?b.lowerRadiusLimit:z),b.upperRadiusLimit&&(z=z>b.upperRadiusLimit?b.upperRadiusLimit:z),z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const q=l.e.Now-this._lastInteractionTime,S=.5*Math.PI-this._defaultElevation,b=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>b&&q>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Z.d.CreateAnimation("beta",Z.d.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction));const q=Z.d.TransitionTo("beta",S,this._attachedCamera,this._attachedCamera.Tq(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));q&&this._animatables.push(q)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=l.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Q.EasingFunction=new G.v,Q.EasingMode=G.q.EASINGMODE_EASEINOUT,Q.IgnoreBoundsSizeMode=0,Q.FitFrustumSidesMode=1;var k=b(11557),W=b(11583),N=b(12750),u=b(10921);class X{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(q){q=u.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),b=S.getInputElement();let z=0,C=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=v=>{var U,g;const r=v.event,I="touch"===r.pointerType;if(v.type!==V.e.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const l=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,S.isPointerLock){const q=r.movementX,S=r.movementY;this.onTouch(null,q,S),this._pointA=null,this._pointB=null}else{if(v.type!==V.e.POINTERDOWN&&v.type!==V.e.POINTERDOUBLETAP&&I&&(null===(U=this._pointA)||void 0===U?void 0:U.pointerId)!==r.pointerId&&(null===(g=this._pointB)||void 0===g?void 0:g.pointerId)!==r.pointerId)return;if(v.type!==V.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!I)if(v.type===V.e.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(v.type!==V.e.POINTERUP||this._currentMousePointerIdDown!==r.pointerId&&!I){if(v.type===V.e.POINTERMOVE)if(q||r.preventDefault(),this._pointA&&null===this._pointB){const q=r.clientX-this._pointA.x,S=r.clientY-this._pointA.y;this._pointA.x=r.clientX,this._pointA.y=r.clientY,this.onTouch(this._pointA,q,S)}else if(this._pointA&&this._pointB){const q=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;q.x=r.clientX,q.y=r.clientY;const S=this._pointA.x-this._pointB.x,b=this._pointA.y-this._pointB.y,U=S*S+b*b,g={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:v.type};this.onMultiTouch(this._pointA,this._pointB,z,U,C,g),C=g,z=U}}else{try{null===l||void 0===l||l.releasePointerCapture(r.pointerId)}catch(y){}I||(this._pointB=null),S._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==z||C)&&(this.onMultiTouch(this._pointA,this._pointB,z,0,C,null),z=0,C=null),this._currentMousePointerIdDown=-1,this.onButtonUp(r),q||r.preventDefault()}else{try{null===l||void 0===l||l.setPointerCapture(r.pointerId)}catch(y){}if(null===this._pointA)this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType};else{if(null!==this._pointB)return;this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}}-1!==this._currentMousePointerIdDown||I||(this._currentMousePointerIdDown=r.pointerId),this.onButtonDown(r),q||(r.preventDefault(),b&&b.focus())}}},this._observer=this.camera.Tq()._inputManager._addCameraPointerObserver(this._pointerInput,V.e.POINTERDOWN|V.e.POINTERUP|V.e.POINTERMOVE|V.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,z=0,C=null,this.onLostFocus()},this._contextMenuBind=q=>this.onContextMenu(q),b&&b.addEventListener("contextmenu",this._contextMenuBind,!1);const v=this.camera.Tq().getEngine().getHostWindow();v&&u.Tools.RegisterTopRootEvents(v,[{name:"blur",handler:this._onLostFocus}])}Ol(){if(this._onLostFocus){const q=this.camera.Tq().getEngine().getHostWindow();q&&u.Tools.UnregisterTopRootEvents(q,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Tq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const q=this.camera.Tq().getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(q){}onTouch(q,S,b){}onMultiTouch(q,S,b,z,C,v){}onContextMenu(q){q.preventDefault()}onButtonDown(q){}onButtonUp(q){}onLostFocus(){}}(0,z.e)([(0,C.J)()],X.prototype,"buttons",void 0);class T extends X{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(q,S){if(0!==this.panningSensibility&&q&&S){const b=S.x-q.x,z=S.y-q.y;this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility}}_computePinchZoom(q,S){const b=this.camera.radius||T.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=b*Math.sqrt(q)/Math.sqrt(S):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(S-q)*b*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(S-q)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(q,S,b){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-S/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility):(this.camera.inertialAlphaOffset-=S/this.angularSensibilityX,this.camera.inertialBetaOffset-=b/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(q,S,b,z,C,v){0===b&&null===C||0===z&&null===v||(this.multiTouchPanAndZoom?(this._computePinchZoom(b,z),this._computeMultiTouchPanning(C,v)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(z)-Math.sqrt(b))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(b,z),this._isPinching=!0):this._computeMultiTouchPanning(C,v)):this.multiTouchPanning?this._computeMultiTouchPanning(C,v):this.pinchZoom&&this._computePinchZoom(b,z))}onButtonDown(q){this._isPanClick=q.button===this.camera._panningMouseButton}onButtonUp(q){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}T.MinimumRadiusForPinch=.001,(0,z.e)([(0,C.J)()],T.prototype,"buttons",void 0),(0,z.e)([(0,C.J)()],T.prototype,"angularSensibilityX",void 0),(0,z.e)([(0,C.J)()],T.prototype,"angularSensibilityY",void 0),(0,z.e)([(0,C.J)()],T.prototype,"pinchPrecision",void 0),(0,z.e)([(0,C.J)()],T.prototype,"pinchDeltaPercentage",void 0),(0,z.e)([(0,C.J)()],T.prototype,"useNaturalPinchZoom",void 0),(0,z.e)([(0,C.J)()],T.prototype,"pinchZoom",void 0),(0,z.e)([(0,C.J)()],T.prototype,"panningSensibility",void 0),(0,z.e)([(0,C.J)()],T.prototype,"multiTouchPanning",void 0),(0,z.e)([(0,C.J)()],T.prototype,"multiTouchPanAndZoom",void 0),N.e.ArcRotateCameraPointersInput=T;var B=b(11385);class t{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(q){q=u.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Tq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const b=S.event;if(!b.metaKey)if(S.type===B.d.KEYDOWN){if(this._ctrlPressed=b.ctrlKey,this._altPressed=b.altKey,-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),b.preventDefault&&(q||b.preventDefault())}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysReset.indexOf(b.keyCode)){const S=this._keys.indexOf(b.keyCode);S>=0&&this._keys.splice(S,1),b.preventDefault&&(q||b.preventDefault())}})))}Ol(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let S=0;S<this._keys.length;S++){const b=this._keys[S];-1!==this.keysLeft.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX-=1/this.panningSensibility:q.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset+=1/this.zoomingSensibility:q.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningX+=1/this.panningSensibility:q.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(b)?this._ctrlPressed&&this.camera._useCtrlForPanning?q.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?q.inertialRadiusOffset-=1/this.zoomingSensibility:q.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(b)&&q.useInputToRestoreState&&q.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,z.e)([(0,C.J)()],t.prototype,"keysUp",void 0),(0,z.e)([(0,C.J)()],t.prototype,"keysDown",void 0),(0,z.e)([(0,C.J)()],t.prototype,"keysLeft",void 0),(0,z.e)([(0,C.J)()],t.prototype,"keysRight",void 0),(0,z.e)([(0,C.J)()],t.prototype,"keysReset",void 0),(0,z.e)([(0,C.J)()],t.prototype,"panningSensibility",void 0),(0,z.e)([(0,C.J)()],t.prototype,"zoomingSensibility",void 0),(0,z.e)([(0,C.J)()],t.prototype,"useAltToZoom",void 0),(0,z.e)([(0,C.J)()],t.prototype,"angularSpeed",void 0),N.e.ArcRotateCameraKeyboardMoveInput=t;var f=b(11153),m=b(11392);class E{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new U.yS(0,0,0),this._globalOffset=new U.yS(0,0,0),this._inertialPanning=U.yS.Zero()}_computeDeltaFromMouseWheelLegacyEvent(q,S){let b=0;const z=.01*q*this.wheelDeltaPercentage*S;return b=q>0?z/(1+this.wheelDeltaPercentage):z*(1+this.wheelDeltaPercentage),b}attachControl(q){q=u.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==V.e.POINTERWHEEL)return;const b=S.event;let z=0;const C=b.deltaMode===m.c.DOM_DELTA_LINE?40:1,v=-b.deltaY*C;if(this.customComputeDeltaFromMouseWheel)z=this.customComputeDeltaFromMouseWheel(v,this,b);else if(this.wheelDeltaPercentage){if(z=this._computeDeltaFromMouseWheelLegacyEvent(v,this.camera.radius),z>0){let q=this.camera.radius,S=this.camera.inertialRadiusOffset+z;for(let b=0;b<20&&!(q<=S)&&!(Math.abs(S*this.camera.inertia)<.001);b++)q-=S,S*=this.camera.inertia;q=(0,g.Clamp)(q,0,Number.MAX_VALUE),z=this._computeDeltaFromMouseWheelLegacyEvent(v,q)}}else z=v/(40*this.wheelPrecision);z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(z)):this.camera.inertialRadiusOffset+=z),b.preventDefault&&(q||b.preventDefault())},this._observer=this.camera.Tq()._inputManager._addCameraPointerObserver(this._wheel,V.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.fb(0)}Ol(){this._observer&&(this.camera.Tq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const q=this.camera;0+q.inertialAlphaOffset+q.inertialBetaOffset+q.inertialRadiusOffset&&(this._updateHitPlane(),q.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(q.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const q=this.camera,S=q.target.RS(q.position);this._hitPlane=f.e.FromPositionAndNormal(q.target,S)}_getPosition(){const q=this.camera,S=q.Tq(),b=S.createPickingRay(S.pointerX,S.pointerY,U.Matrix.Identity(),q,!1);0===q.targetScreenOffset.x&&0===q.targetScreenOffset.y||(this._viewOffset.set(q.targetScreenOffset.x,q.targetScreenOffset.y,0),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),this._globalOffset=U.yS.TransformNormal(this._viewOffset,q._cameraTransformMatrix),b.origin.addInPlace(this._globalOffset));let z=0;return this._hitPlane&&(z=b.intersectsPlane(this._hitPlane)??0),b.origin.addInPlace(b.direction.scaleInPlace(z))}_zoomToMouse(q){const S=this.camera,b=1-S.inertia;if(S.lowerRadiusLimit){const z=S.lowerRadiusLimit??0;S.radius-(S.inertialRadiusOffset+q)/b<z&&(q=(S.radius-z)*b-S.inertialRadiusOffset)}if(S.upperRadiusLimit){const z=S.upperRadiusLimit??0;S.radius-(S.inertialRadiusOffset+q)/b>z&&(q=(S.radius-z)*b-S.inertialRadiusOffset)}const z=q/b/S.radius,C=this._getPosition(),v=U.TmpVectors.yS[6];C.subtractToRef(S.target,v),v.scaleInPlace(z),v.scaleInPlace(b),this._inertialPanning.addInPlace(v),S.inertialRadiusOffset+=q}_zeroIfClose(q){Math.abs(q.x)<y.d&&(q.x=0),Math.abs(q.y)<y.d&&(q.y=0),Math.abs(q.z)<y.d&&(q.z=0)}}(0,z.e)([(0,C.J)()],E.prototype,"wheelPrecision",void 0),(0,z.e)([(0,C.J)()],E.prototype,"zoomToMouseLocation",void 0),(0,z.e)([(0,C.J)()],E.prototype,"wheelDeltaPercentage",void 0),N.e.ArcRotateCameraMouseWheelInput=E;class e extends N.f{constructor(q){super(q)}addMouseWheel(){return this.add(new E),this}addPointers(){return this.add(new T),this}addKeyboard(){return this.add(new t),this}}var i=b(11058);function J(q,S){return isNaN(q)?S:q}r.e.AddNodeConstructor("ArcRotateCamera",((q,S)=>()=>new L(q,0,0,1,U.yS.Zero(),S)));class L extends W.d{get target(){return this._target}set target(q){this.setTarget(q)}get targetHost(){return this._targetHost}set targetHost(q){q&&this.setTarget(q)}getTarget(){return this.target}get position(){return this._position}set position(q){this.setPosition(q)}set upVector(q){this._upToYMatrix||(this._yToUpMatrix=new U.Matrix,this._upToYMatrix=new U.Matrix,this._upVector=U.yS.Zero()),q.normalize(),this._upVector.v(q),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){U.Matrix.RotationAlignToRef(U.yS.UpReadOnly,this._upVector,this._yToUpMatrix),U.Matrix.RotationAlignToRef(this._upVector,U.yS.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityX:0}set angularSensibilityX(q){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityX=q)}get angularSensibilityY(){const q=this.inputs.attached.pointers;return q?q.angularSensibilityY:0}set angularSensibilityY(q){const S=this.inputs.attached.pointers;S&&(S.angularSensibilityY=q)}get pinchPrecision(){const q=this.inputs.attached.pointers;return q?q.pinchPrecision:0}set pinchPrecision(q){const S=this.inputs.attached.pointers;S&&(S.pinchPrecision=q)}get pinchDeltaPercentage(){const q=this.inputs.attached.pointers;return q?q.pinchDeltaPercentage:0}set pinchDeltaPercentage(q){const S=this.inputs.attached.pointers;S&&(S.pinchDeltaPercentage=q)}get useNaturalPinchZoom(){const q=this.inputs.attached.pointers;return!!q&&q.useNaturalPinchZoom}set useNaturalPinchZoom(q){const S=this.inputs.attached.pointers;S&&(S.useNaturalPinchZoom=q)}get panningSensibility(){const q=this.inputs.attached.pointers;return q?q.panningSensibility:0}set panningSensibility(q){const S=this.inputs.attached.pointers;S&&(S.panningSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const S=this.inputs.attached.keyboard;S&&(S.keysUp=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const S=this.inputs.attached.keyboard;S&&(S.keysDown=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const S=this.inputs.attached.keyboard;S&&(S.keysRight=q)}get wheelPrecision(){const q=this.inputs.attached.mousewheel;return q?q.wheelPrecision:0}set wheelPrecision(q){const S=this.inputs.attached.mousewheel;S&&(S.wheelPrecision=q)}get zoomToMouseLocation(){const q=this.inputs.attached.mousewheel;return!!q&&q.zoomToMouseLocation}set zoomToMouseLocation(q){const S=this.inputs.attached.mousewheel;S&&(S.zoomToMouseLocation=q)}get wheelDeltaPercentage(){const q=this.inputs.attached.mousewheel;return q?q.wheelDeltaPercentage:0}set wheelDeltaPercentage(q){const S=this.inputs.attached.mousewheel;S&&(S.wheelDeltaPercentage=q)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(q){q!==this.useBouncingBehavior&&(q?(this._bouncingBehavior=new H,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(q){q!==this.useFramingBehavior&&(q?(this._framingBehavior=new Q,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(q){q!==this.useAutoRotationBehavior&&(q?(this._autoRotationBehavior=new R,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(q,S,b,z,C,g){var r;let I=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(q,U.yS.Zero(),g,I),r=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=U.yS.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=U.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new U.Matrix,this.panningAxis=new U.yS(1,1,0),this._transformedDirection=new U.yS,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new v.d,this.checkCollisions=!1,this.collisionRadius=new U.yS(.5,.5,.5),this._previousPosition=U.yS.Zero(),this._collisionVelocity=U.yS.Zero(),this._newPosition=U.yS.Zero(),this._computationVector=U.yS.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new U.yS(NaN,NaN,NaN),this._goalTargetScreenOffset=new U.Vector2(NaN,NaN),this._onCollisionPositionChange=function(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b?(r.setPosition(S),r.DR&&r.DR(b)):r._previousPosition.v(r._position);const z=Math.cos(r.alpha),C=Math.sin(r.alpha),v=Math.cos(r.beta);let U=Math.sin(r.beta);0===U&&(U=1e-4);const g=r._getTargetPosition();r._computationVector.Bb(r.radius*z*U,r.radius*v,r.radius*C*U),g.addToRef(r._computationVector,r._newPosition),r._position.v(r._newPosition);let I=r.upVector;r.allowUpsideDown&&r.beta<0&&(I=I.clone(),I=I.negate()),r._computeViewMatrix(r._position,g,I),r._viewMatrix.addAtIndex(12,r.targetScreenOffset.x),r._viewMatrix.addAtIndex(13,r.targetScreenOffset.y),r._collisionTriggered=!1},this._target=U.yS.Zero(),C&&this.setTarget(C),this.alpha=S,this.beta=b,this.radius=z,this.getViewMatrix(),this.inputs=new e(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new U.yS(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=U.Vector2.Zero()}_updateCache(q){q||super._updateCache(),this._cache._target.v(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.v(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const q=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?q.addToRef(this._targetBoundingCenter,this._target):this._target.v(q)}const q=this._getLockedTargetPosition();return q||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>y.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,v=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=v?this._currentInterpolationFactor=v:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=J(q,this._goalAlpha),this._goalBeta=J(S,this._goalBeta),this._goalRadius=J(b,this._goalRadius),this._goalTarget.set(J(z.x,this._goalTarget.x),J(z.y,this._goalTarget.y),J(z.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(J(C.x,this._goalTargetScreenOffset.x),J(C.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,g.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,g.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,g.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,g.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(q,S){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const C=arguments;S=u.Tools.BackCompatCameraNoPreventDefault(C),this._useCtrlForPanning=b,this._panningMouseButton=z,"boolean"===typeof C[0]&&(C.length>1&&(this._useCtrlForPanning=C[1]),C.length>2&&(this._panningMouseButton=C[2])),this.inputs.attachElement(S),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ol(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let q=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){q=!0;const S=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let z=this.inertialAlphaOffset*b;this.beta<0&&(z*=-1),this.alpha+=z*S,this.beta+=this.inertialBetaOffset*S,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<y.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<y.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*y.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){q=!0;const S=new U.yS(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),S.multiplyInPlace(this.panningAxis),U.yS.TransformNormalToRef(S,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const q=this.upVector,S=U.yS.CrossToRef(this._transformedDirection,q,this._transformedDirection);U.yS.CrossToRef(q,S,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);U.yS.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.v(this._transformedDirection)}else{if(this.parent){const q=U.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.transposeToRef(q),U.yS.TransformCoordinatesToRef(this._transformedDirection,q,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*y.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*y.d&&(this.inertialPanningY=0)}if(q)this.stopInterpolation();else if(this._isInterpolating){let q=!1;const S=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-S/this._currentInterpolationFactor),z=J(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const S=U.TmpVectors.yS[0].set(J(this._goalTarget.x,this._target.x),J(this._goalTarget.y,this._target.y),J(this._goalTarget.z,this._target.z));U.yS.LerpToRef(this.target,S,b,this._target),10*U.yS.Distance(this.target,S)/z<y.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.v(S),this.setTarget(this.target,!1,!0,!0)):q=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const S=U.Quaternion.RotationAlphaBetaGammaToRef(J(this._goalAlpha,this.alpha),J(this._goalBeta,this.beta),0,U.TmpVectors.Quaternion[0]),z=U.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,U.TmpVectors.Quaternion[1]),C=U.Quaternion.SlerpToRef(z,S,b,U.TmpVectors.Quaternion[2]);C.normalize();const v=C.toAlphaBetaGammaToRef(U.TmpVectors.yS[0]);if(this.alpha=v.x,this.beta=v.y,C.isApprox(S,y.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const q=S.toAlphaBetaGammaToRef(U.TmpVectors.yS[0]);this.alpha=q.x,this.beta=q.y}else q=!0}if(isNaN(this._goalRadius)||(this.radius+=(z-this.radius)*b,Math.abs(z/this.radius-1)<y.d?(this._goalRadius=NaN,this.radius=z):q=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const S=U.TmpVectors.Vector2[0].set(J(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),J(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));U.Vector2.LerpToRef(this.targetScreenOffset,S,b,this.targetScreenOffset),U.Vector2.Distance(this.targetScreenOffset,S)<y.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.v(S)):q=!0}this._isInterpolating=q}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.yS.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const q=this.alpha;var S,b;this.alpha=function(q){let S=Math.PI/2;return 0===q.x&&0===q.z||(S=Math.acos(q.x/Math.sqrt(Math.pow(q.x,2)+Math.pow(q.z,2)))),q.z<0&&(S=2*Math.PI-S),S}(this._computationVector),this.beta=(S=this._computationVector.y,b=this.radius,Math.acos(S/b));const z=Math.round((q-this.alpha)/(2*Math.PI));this.alpha+=2*z*Math.PI,this._checkLimits()}setPosition(q){this._position.equals(q)||(this._position.v(q),this.rebuildAnglesAndRadius())}setTarget(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=this.overrideCloneAlphaBetaRadius??z,q.Nb)S&&q.getBoundingInfo?this._targetBoundingCenter=q.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,q.Nb(),this._targetHost=q,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const S=q,z=this._getTargetPosition();if(z&&!b&&z.equals(S))return;this._targetHost=null,this._target=S,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const q=Math.cos(this.alpha),S=Math.sin(this.alpha),b=Math.cos(this.beta);let z=Math.sin(this.beta);0===z&&(z=1e-4),0===this.radius&&(this.radius=1e-4);const C=this._getTargetPosition();if(this._computationVector.Bb(this.radius*q*z,this.radius*b,this.radius*S*z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.yS.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),C.addToRef(this._computationVector,this._newPosition),this.Tq().collisionsEnabled&&this.checkCollisions){const q=this.Tq().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,q.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.v(this._newPosition);let q=this.upVector;this.allowUpsideDown&&z<0&&(q=q.negate()),this._computeViewMatrix(this._position,C,q),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.v(C),this._viewMatrix}zoomOn(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q||this.Tq().meshes;const b=I.d.MinMax(q);let z=this._calculateLowerRadiusFromModelBoundingSphere(b.min,b.max);if(z=Math.max(Math.min(z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=z*this.zoomOnFactor,this.mode===k.c.ORTHOGRAPHIC_CAMERA){const q=this.Tq().getEngine().getAspectRatio(this),S=z*this.zoomOnFactor/2;this.orthoLeft=-S*q,this.orthoRight=S*q,this.orthoBottom=-S,this.orthoTop=S}this.focusOn({min:b.min,max:b.max,distance:z},S)}focusOn(q){let S,b,z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===q.min){const z=q||this.Tq().meshes;S=I.d.MinMax(z),b=U.yS.Distance(S.min,S.max)}else{S=q,b=q.distance}this._target=I.d.Center(S),z||(this.maxZ=2*b)}createRigCamera(q,S){let b=0;switch(this.cameraRigMode){case k.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.c.RIG_MODE_VR:b=this._cameraRigParams.stereoHalfAngle*(0===S?1:-1);break;case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b=this._cameraRigParams.stereoHalfAngle*(0===S?-1:1)}const z=new L(q,this.alpha+b,this.beta,this.radius,this._target,this.Tq());return z._cameraRigParams={},z.isRigCamera=!0,z.rigParent=this,z.upVector=this.upVector,z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoBottom=this.orthoBottom,z.orthoTop=this.orthoTop,z}_updateRigCameras(){const q=this._rigCameras[0],S=this._rigCameras[1];switch(q.beta=S.beta=this.beta,this.cameraRigMode){case k.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case k.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case k.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case k.c.RIG_MODE_VR:q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case k.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,S.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const z=U.yS.Distance(q,S),C=this.Tq().getEngine().getAspectRatio(this),v=Math.tan(this.fov/2),g=v*C,r=.5*z*b,I=r*Math.sqrt(1+1/(g*g)),V=r*Math.sqrt(1+1/(v*v));return Math.max(I,V)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,z.e)([(0,C.J)()],L.prototype,"alpha",void 0),(0,z.e)([(0,C.J)()],L.prototype,"beta",void 0),(0,z.e)([(0,C.J)()],L.prototype,"radius",void 0),(0,z.e)([(0,C.J)()],L.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,z.e)([(0,C.F)("target")],L.prototype,"_target",void 0),(0,z.e)([(0,C.u)("targetHost")],L.prototype,"_targetHost",void 0),(0,z.e)([(0,C.J)()],L.prototype,"inertialAlphaOffset",void 0),(0,z.e)([(0,C.J)()],L.prototype,"inertialBetaOffset",void 0),(0,z.e)([(0,C.J)()],L.prototype,"inertialRadiusOffset",void 0),(0,z.e)([(0,C.J)()],L.prototype,"lowerAlphaLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"upperAlphaLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"lowerBetaLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"upperBetaLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"lowerRadiusLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"upperRadiusLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"lowerTargetYLimit",void 0),(0,z.e)([(0,C.J)()],L.prototype,"inertialPanningX",void 0),(0,z.e)([(0,C.J)()],L.prototype,"inertialPanningY",void 0),(0,z.e)([(0,C.J)()],L.prototype,"pinchToPanMaxDistance",void 0),(0,z.e)([(0,C.J)()],L.prototype,"panningDistanceLimit",void 0),(0,z.e)([(0,C.F)()],L.prototype,"panningOriginTarget",void 0),(0,z.e)([(0,C.J)()],L.prototype,"panningInertia",void 0),(0,z.e)([(0,C.J)()],L.prototype,"zoomToMouseLocation",null),(0,z.e)([(0,C.J)()],L.prototype,"zoomOnFactor",void 0),(0,z.e)([(0,C.B)()],L.prototype,"targetScreenOffset",void 0),(0,z.e)([(0,C.J)()],L.prototype,"allowUpsideDown",void 0),(0,z.e)([(0,C.J)()],L.prototype,"useInputToRestoreState",void 0),(0,z.e)([(0,C.J)()],L.prototype,"restoreStateInterpolationFactor",void 0),(0,i.f)("BABYLON.ArcRotateCamera",L)},12750:(q,S,b)=>{"use strict";b.d(S,{e:()=>U,f:()=>g});var z=b(10943),C=b(11137),v=b(11557),U={};class g{constructor(q){this.attachedToElement=!1,this.attached={},this.camera=q,this.checkInputs=()=>{}}add(q){const S=q.getSimpleName();this.attached[S]?z.b.Warn("camera input of type "+S+" already exists on camera"):(this.attached[S]=q,q.camera=this.camera,q.checkInputs&&(this.checkInputs=this._addCheckInputs(q.checkInputs.bind(q))),this.attachedToElement&&q.attachControl(this.noPreventDefault))}remove(q){for(const S in this.attached){const b=this.attached[S];if(b===q)return b.Ol(),b.camera=null,delete this.attached[S],void this.rebuildInputCheck()}}removeByType(q){for(const S in this.attached){const b=this.attached[S];b.getClassName()===q&&(b.Ol(),b.camera=null,delete this.attached[S],this.rebuildInputCheck())}}_addCheckInputs(q){const S=this.checkInputs;return()=>{S(),q()}}attachInput(q){this.attachedToElement&&q.attachControl(this.noPreventDefault)}attachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){q=!v.c.ForceAttachControlToAlwaysPreventDefault&&q,this.attachedToElement=!0,this.noPreventDefault=q;for(const S in this.attached)this.attached[S].attachControl(q)}}detachElement(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const S in this.attached)this.attached[S].Ol(),q&&(this.attached[S].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const q in this.attached){const S=this.attached[q];S.checkInputs&&(this.checkInputs=this._addCheckInputs(S.checkInputs.bind(S)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(q){const S={};for(const b in this.attached){const q=this.attached[b],z=C.b.Serialize(q);S[q.getClassName()]=z}q.inputsmgr=S}parse(q){const S=q.inputsmgr;if(S){this.clear();for(const q in S){const b=U[q];if(b){const z=S[q],v=C.b.Parse((()=>new b),z,null);this.add(v)}}}else for(const b in this.attached){const S=U[this.attached[b].getClassName()];if(S){const z=C.b.Parse((()=>new S),q,null);this.remove(this.attached[b]),this.add(z)}}}}},12741:(q,S,b)=>{"use strict";b.d(S,{c:()=>X});var z=b(11081),C=b(11090),v=b(11103),U=b(11583),g=b(12750),r=b(11385),I=b(10921);class V{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(q){q=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Tq(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((S=>{const b=S.event;if(!b.metaKey)if(S.type===r.d.KEYDOWN){if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){-1===this._keys.indexOf(b.keyCode)&&this._keys.push(b.keyCode),q||b.preventDefault()}}else if(-1!==this.keysUp.indexOf(b.keyCode)||-1!==this.keysDown.indexOf(b.keyCode)||-1!==this.keysLeft.indexOf(b.keyCode)||-1!==this.keysRight.indexOf(b.keyCode)||-1!==this.keysUpward.indexOf(b.keyCode)||-1!==this.keysDownward.indexOf(b.keyCode)||-1!==this.keysRotateLeft.indexOf(b.keyCode)||-1!==this.keysRotateRight.indexOf(b.keyCode)||-1!==this.keysRotateUp.indexOf(b.keyCode)||-1!==this.keysRotateDown.indexOf(b.keyCode)){const S=this._keys.indexOf(b.keyCode);S>=0&&this._keys.splice(S,1),q||b.preventDefault()}})))}Ol(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const q=this.camera;for(let S=0;S<this._keys.length;S++){const b=this._keys[S],z=q._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(b)?q._localDirection.Bb(-z,0,0):-1!==this.keysUp.indexOf(b)?q._localDirection.Bb(0,0,z):-1!==this.keysRight.indexOf(b)?q._localDirection.Bb(z,0,0):-1!==this.keysDown.indexOf(b)?q._localDirection.Bb(0,0,-z):-1!==this.keysUpward.indexOf(b)?q._localDirection.Bb(0,z,0):-1!==this.keysDownward.indexOf(b)?q._localDirection.Bb(0,-z,0):-1!==this.keysRotateLeft.indexOf(b)?(q._localDirection.Bb(0,0,0),q.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(b)?(q._localDirection.Bb(0,0,0),q.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(b)?(q._localDirection.Bb(0,0,0),q.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(b)&&(q._localDirection.Bb(0,0,0),q.cameraRotation.x+=this._getLocalRotation()),q.Tq().useRightHandedSystem&&(q._localDirection.z*=-1),q.getViewMatrix().invertToRef(q._cameraTransformMatrix),v.yS.TransformNormalToRef(q._localDirection,q._cameraTransformMatrix,q._transformedDirection),q.cameraDirection.addInPlace(q._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const q=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*q}}(0,z.e)([(0,C.J)()],V.prototype,"keysUp",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysUpward",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysDown",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysDownward",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysLeft",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysRight",void 0),(0,z.e)([(0,C.J)()],V.prototype,"rotationSpeed",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysRotateLeft",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysRotateRight",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysRotateUp",void 0),(0,z.e)([(0,C.J)()],V.prototype,"keysRotateDown",void 0),g.e.FreeCameraKeyboardMoveInput=V;var l=b(10929),y=b(11381);class R{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=q,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new l.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(q){q=I.Tools.BackCompatCameraNoPreventDefault(arguments);const S=this.camera.getEngine(),b=S.getInputElement();this._pointerInput||(this._pointerInput=z=>{const C=z.event,v="touch"===C.pointerType;if(!this.touchEnabled&&v)return;if(z.type!==y.e.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const U=C.target;if(z.type===y.e.POINTERDOWN){if(v&&-1!==this._activePointerId||!v&&-1!==this._currentActiveButton)return;this._activePointerId=C.pointerId;try{null===U||void 0===U||U.setPointerCapture(C.pointerId)}catch(g){}-1===this._currentActiveButton&&(this._currentActiveButton=C.button),this._previousPosition={x:C.clientX,y:C.clientY},q||(C.preventDefault(),b&&b.focus()),S.isPointerLock&&this._onMouseMove&&this._onMouseMove(z.event)}else if(z.type===y.e.POINTERUP){if(v&&this._activePointerId!==C.pointerId||!v&&this._currentActiveButton!==C.button)return;try{null===U||void 0===U||U.releasePointerCapture(C.pointerId)}catch(g){}this._currentActiveButton=-1,this._previousPosition=null,q||C.preventDefault(),this._activePointerId=-1}else if(z.type===y.e.POINTERMOVE&&(this._activePointerId===C.pointerId||!v))if(S.isPointerLock&&this._onMouseMove)this._onMouseMove(z.event);else if(this._previousPosition){const S=this.camera._calculateHandednessMultiplier(),b=(C.clientX-this._previousPosition.x)*S,z=C.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=b/this.angularSensibility,this.camera.cameraRotation.x+=z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:b,offsetY:z}),this._previousPosition={x:C.clientX,y:C.clientY},q||C.preventDefault()}}),this._onMouseMove=b=>{if(!S.isPointerLock)return;const z=this.camera._calculateHandednessMultiplier(),C=b.movementX*z;this.camera.cameraRotation.y+=C/this.angularSensibility;const v=b.movementY;this.camera.cameraRotation.x+=v/this.angularSensibility,this._previousPosition=null,q||b.preventDefault()},this._observer=this.camera.Tq()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),b&&(this._contextMenuBind=q=>this.onContextMenu(q),b.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(q){q.preventDefault()}Ol(){if(this._observer){if(this.camera.Tq()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,z.e)([(0,C.J)()],R.prototype,"buttons",void 0),(0,z.e)([(0,C.J)()],R.prototype,"angularSensibility",void 0),g.e.FreeCameraMouseInput=R;var G,Z=b(11392);class H{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new l.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(q){q=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=S=>{if(S.type!==y.e.POINTERWHEEL)return;const b=S.event,z=b.deltaMode===Z.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*z*b.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*z*b.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*z*b.deltaZ/this._normalize,b.preventDefault&&(q||b.preventDefault())},this._observer=this.camera.Tq()._inputManager._addCameraPointerObserver(this._wheel,y.e.POINTERWHEEL)}Ol(){this._observer&&(this.camera.Tq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,z.e)([(0,C.J)()],H.prototype,"wheelPrecisionX",void 0),(0,z.e)([(0,C.J)()],H.prototype,"wheelPrecisionY",void 0),(0,z.e)([(0,C.J)()],H.prototype,"wheelPrecisionZ",void 0),function(q){q[q.MoveRelative=0]="MoveRelative",q[q.RotateRelative=1]="RotateRelative",q[q.MoveScene=2]="MoveScene"}(G||(G={}));class Q extends H{constructor(){super(...arguments),this._moveRelative=v.yS.Zero(),this._rotateRelative=v.yS.Zero(),this._moveScene=v.yS.Zero(),this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(q){null===q&&this._wheelXAction!==G.MoveRelative||(this._wheelXAction=G.MoveRelative,this._wheelXActionCoordinate=q)}get wheelXMoveRelative(){return this._wheelXAction!==G.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(q){null===q&&this._wheelYAction!==G.MoveRelative||(this._wheelYAction=G.MoveRelative,this._wheelYActionCoordinate=q)}get wheelYMoveRelative(){return this._wheelYAction!==G.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(q){null===q&&this._wheelZAction!==G.MoveRelative||(this._wheelZAction=G.MoveRelative,this._wheelZActionCoordinate=q)}get wheelZMoveRelative(){return this._wheelZAction!==G.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(q){null===q&&this._wheelXAction!==G.RotateRelative||(this._wheelXAction=G.RotateRelative,this._wheelXActionCoordinate=q)}get wheelXRotateRelative(){return this._wheelXAction!==G.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(q){null===q&&this._wheelYAction!==G.RotateRelative||(this._wheelYAction=G.RotateRelative,this._wheelYActionCoordinate=q)}get wheelYRotateRelative(){return this._wheelYAction!==G.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(q){null===q&&this._wheelZAction!==G.RotateRelative||(this._wheelZAction=G.RotateRelative,this._wheelZActionCoordinate=q)}get wheelZRotateRelative(){return this._wheelZAction!==G.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(q){null===q&&this._wheelXAction!==G.MoveScene||(this._wheelXAction=G.MoveScene,this._wheelXActionCoordinate=q)}get wheelXMoveScene(){return this._wheelXAction!==G.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(q){null===q&&this._wheelYAction!==G.MoveScene||(this._wheelYAction=G.MoveScene,this._wheelYActionCoordinate=q)}get wheelYMoveScene(){return this._wheelYAction!==G.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(q){null===q&&this._wheelZAction!==G.MoveScene||(this._wheelZAction=G.MoveScene,this._wheelZActionCoordinate=q)}get wheelZMoveScene(){return this._wheelZAction!==G.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.fb(0),this._rotateRelative.fb(0),this._moveScene.fb(0),this._updateCamera(),this.camera.Tq().useRightHandedSystem&&(this._moveRelative.z*=-1);const q=v.Matrix.Zero();this.camera.getViewMatrix().invertToRef(q);const S=v.yS.Zero();v.yS.TransformNormalToRef(this._moveRelative,q,S),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(S),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(q,S,b){if(0===q)return;if(null===S||null===b)return;let z=null;switch(S){case G.MoveRelative:z=this._moveRelative;break;case G.RotateRelative:z=this._rotateRelative;break;case G.MoveScene:z=this._moveScene}switch(b){case 0:z.set(q,0,0);break;case 1:z.set(0,q,0);break;case 2:z.set(0,0,q)}}}(0,z.e)([(0,C.J)()],Q.prototype,"wheelXMoveRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelYMoveRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelZMoveRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelXRotateRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelYRotateRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelZRotateRelative",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelXMoveScene",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelYMoveScene",null),(0,z.e)([(0,C.J)()],Q.prototype,"wheelZMoveScene",null),g.e.FreeCameraMouseWheelInput=Q;class k{constructor(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=q,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=I.Tools.IsSafari()}attachControl(q){q=I.Tools.BackCompatCameraNoPreventDefault(arguments);let S=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=b=>{const z=b.event,C="mouse"===z.pointerType||this._isSafari&&"undefined"===typeof z.pointerType;if(this.allowMouse||!C)if(b.type===y.e.POINTERDOWN){if(q||z.preventDefault(),this._pointerPressed.push(z.pointerId),1!==this._pointerPressed.length)return;S={x:z.clientX,y:z.clientY}}else if(b.type===y.e.POINTERUP){q||z.preventDefault();const b=this._pointerPressed.indexOf(z.pointerId);if(-1===b)return;if(this._pointerPressed.splice(b,1),0!=b)return;S=null,this._offsetX=null,this._offsetY=null}else if(b.type===y.e.POINTERMOVE){if(q||z.preventDefault(),!S)return;if(0!=this._pointerPressed.indexOf(z.pointerId))return;this._offsetX=z.clientX-S.x,this._offsetY=-(z.clientY-S.y)}}),this._observer=this.camera.Tq()._inputManager._addCameraPointerObserver(this._pointerInput,y.e.POINTERDOWN|y.e.POINTERUP|y.e.POINTERMOVE),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.addEventListener("blur",this._onLostFocus)}}Ol(){if(this._pointerInput){if(this._observer&&(this.camera.Tq()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const q=this.camera.getEngine().getInputElement();q&&q.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const q=this.camera,S=q._calculateHandednessMultiplier();q.cameraRotation.y=S*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)q.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const S=q._computeLocalCameraSpeed(),b=new v.yS(0,0,0!==this.touchMoveSensibility?S*this._offsetY/this.touchMoveSensibility:0);v.Matrix.RotationYawPitchRollToRef(q.rotation.y,q.rotation.x,0,q._cameraRotationMatrix),q.cameraDirection.addInPlace(v.yS.TransformCoordinates(b,q._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,z.e)([(0,C.J)()],k.prototype,"touchAngularSensibility",void 0),(0,z.e)([(0,C.J)()],k.prototype,"touchMoveSensibility",void 0),g.e.FreeCameraTouchInput=k;class W extends g.f{constructor(q){super(q),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new V),this}addMouse(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new R(q),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Q,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new k),this}clear(){super.clear(),this._mouseInput=null}}var N=b(11058),u=b(11006);class X extends U.d{get angularSensibility(){const q=this.inputs.attached.mouse;return q?q.angularSensibility:0}set angularSensibility(q){const S=this.inputs.attached.mouse;S&&(S.angularSensibility=q)}get keysUp(){const q=this.inputs.attached.keyboard;return q?q.keysUp:[]}set keysUp(q){const S=this.inputs.attached.keyboard;S&&(S.keysUp=q)}get keysUpward(){const q=this.inputs.attached.keyboard;return q?q.keysUpward:[]}set keysUpward(q){const S=this.inputs.attached.keyboard;S&&(S.keysUpward=q)}get keysDown(){const q=this.inputs.attached.keyboard;return q?q.keysDown:[]}set keysDown(q){const S=this.inputs.attached.keyboard;S&&(S.keysDown=q)}get keysDownward(){const q=this.inputs.attached.keyboard;return q?q.keysDownward:[]}set keysDownward(q){const S=this.inputs.attached.keyboard;S&&(S.keysDownward=q)}get keysLeft(){const q=this.inputs.attached.keyboard;return q?q.keysLeft:[]}set keysLeft(q){const S=this.inputs.attached.keyboard;S&&(S.keysLeft=q)}get keysRight(){const q=this.inputs.attached.keyboard;return q?q.keysRight:[]}set keysRight(q){const S=this.inputs.attached.keyboard;S&&(S.keysRight=q)}get keysRotateLeft(){const q=this.inputs.attached.keyboard;return q?q.keysRotateLeft:[]}set keysRotateLeft(q){const S=this.inputs.attached.keyboard;S&&(S.keysRotateLeft=q)}get keysRotateRight(){const q=this.inputs.attached.keyboard;return q?q.keysRotateRight:[]}set keysRotateRight(q){const S=this.inputs.attached.keyboard;S&&(S.keysRotateRight=q)}get keysRotateUp(){const q=this.inputs.attached.keyboard;return q?q.keysRotateUp:[]}set keysRotateUp(q){const S=this.inputs.attached.keyboard;S&&(S.keysRotateUp=q)}get keysRotateDown(){const q=this.inputs.attached.keyboard;return q?q.keysRotateDown:[]}set keysRotateDown(q){const S=this.inputs.attached.keyboard;S&&(S.keysRotateDown=q)}constructor(q,S,b){var z;super(q,S,b,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),z=this,this.ellipsoid=new v.yS(.5,1,.5),this.ellipsoidOffset=new v.yS(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=v.yS.Zero(),this._diffPosition=v.yS.Zero(),this._newPosition=v.yS.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z._newPosition.v(S),z._newPosition.subtractToRef(z._oldPosition,z._diffPosition),z._diffPosition.length()>u.c.CollisionsEpsilon&&(z.position.addToRef(z._diffPosition,z._deferredPositionUpdate),z._deferOnly?z._deferredUpdated=!0:z.position.v(z._deferredPositionUpdate),z.DR&&b&&z.DR(b))},this.inputs=new W(this),this.inputs.addKeyboard().addMouse()}attachControl(q,S){S=I.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(S)}Ol(){this.inputs.detachElement(),this.cameraDirection=new v.yS(0,0,0),this.cameraRotation=new v.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(q){this._collisionMask=isNaN(q)?-1:q}_collideWithWorld(q){let S;S=this.parent?v.yS.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,S.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const b=this.Tq().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let z=q;this.applyGravity&&(z=q.add(this.Tq().gravity)),b.getNewPosition(this._oldPosition,z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=v.yS.Zero(),this._transformedDirection=v.yS.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(q){this._needMoveForGravity=q}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Tq().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Fb"}}(0,z.e)([(0,C.F)()],X.prototype,"ellipsoid",void 0),(0,z.e)([(0,C.F)()],X.prototype,"ellipsoidOffset",void 0),(0,z.e)([(0,C.J)()],X.prototype,"checkCollisions",void 0),(0,z.e)([(0,C.J)()],X.prototype,"applyGravity",void 0),(0,N.f)("BABYLON.FreeCamera",X)},13323:(q,S,b)=>{"use strict";b.d(S,{c:()=>v});var z=b(11200),C=b(13329);class v{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=b,this.Gl=[],this._maxBlockCapacity=S||64,this._selectionContent=new z.c(1024),this._creationFunc=q}update(q,S,b){C.e._CreateBlocks(q,S,b,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}NV(q){for(let S=0;S<this.LV.length;S++){this.LV[S].addEntry(q)}}WV(q){for(let S=0;S<this.LV.length;S++){this.LV[S].removeEntry(q)}}select(q,S){this._selectionContent.reset();for(let b=0;b<this.LV.length;b++){this.LV[b].select(q,this._selectionContent,S)}return S?this._selectionContent.concat(this.Gl):this._selectionContent.concatWithNoDuplicate(this.Gl),this._selectionContent}intersects(q,S,b){this._selectionContent.reset();for(let z=0;z<this.LV.length;z++){this.LV[z].intersects(q,S,this._selectionContent,b)}return b?this._selectionContent.concat(this.Gl):this._selectionContent.concatWithNoDuplicate(this.Gl),this._selectionContent}intersectsRay(q){this._selectionContent.reset();for(let S=0;S<this.LV.length;S++){this.LV[S].intersectsRay(q,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Gl),this._selectionContent}}v.CreationFuncForMeshes=(q,S)=>{const b=q.getBoundingInfo();!q.isBlocked&&b.boundingBox.intersectsMinMax(S.kl,S.Wl)&&S.entries.push(q)},v.CreationFuncForSubMeshes=(q,S)=>{q.getBoundingInfo().boundingBox.intersectsMinMax(S.kl,S.Wl)&&S.entries.push(q)}},13329:(q,S,b)=>{"use strict";b.d(S,{e:()=>v});var z=b(11103),C=b(11448);class v{constructor(q,S,b,z,C,v){this.entries=[],this.Nl=new Array,this._capacity=b,this._depth=z,this._maxDepth=C,this._creationFunc=v,this._minPoint=q,this._maxPoint=S,this.Nl.push(q.clone()),this.Nl.push(S.clone()),this.Nl.push(q.clone()),this.Nl[2].x=S.x,this.Nl.push(q.clone()),this.Nl[3].y=S.y,this.Nl.push(q.clone()),this.Nl[4].z=S.z,this.Nl.push(S.clone()),this.Nl[5].z=q.z,this.Nl.push(S.clone()),this.Nl[6].x=q.x,this.Nl.push(S.clone()),this.Nl[7].y=q.y}get WS(){return this._capacity}get kl(){return this._minPoint}get Wl(){return this._maxPoint}addEntry(q){if(this.LV)for(let S=0;S<this.LV.length;S++){this.LV[S].addEntry(q)}else this._creationFunc(q,this),this.entries.length>this.WS&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(q){if(this.LV){for(let S=0;S<this.LV.length;S++){this.LV[S].removeEntry(q)}return}const S=this.entries.indexOf(q);S>-1&&this.entries.splice(S,1)}addEntries(q){for(let S=0;S<q.length;S++){const b=q[S];this.addEntry(b)}}select(q,S,b){if(C.c.IsInFrustum(this.Nl,q)){if(this.LV){for(let z=0;z<this.LV.length;z++){this.LV[z].select(q,S,b)}return}b?S.concat(this.entries):S.concatWithNoDuplicate(this.entries)}}intersects(q,S,b,z){if(C.c.IntersectsSphere(this._minPoint,this._maxPoint,q,S)){if(this.LV){for(let C=0;C<this.LV.length;C++){this.LV[C].intersects(q,S,b,z)}return}z?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersectsRay(q,S){if(q.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.LV){for(let b=0;b<this.LV.length;b++){this.LV[b].intersectsRay(q,S)}return}S.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){v._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(q,S,b,C,U,g,r,I){r.LV=new Array;const V=new z.yS((S.x-q.x)/2,(S.y-q.y)/2,(S.z-q.z)/2);for(let z=0;z<2;z++)for(let S=0;S<2;S++)for(let l=0;l<2;l++){const y=q.add(V.multiplyByFloats(z,S,l)),R=q.add(V.multiplyByFloats(z+1,S+1,l+1)),G=new v(y,R,C,U+1,g,I);G.addEntries(b),r.LV.push(G)}}}},13336:(q,S,b)=>{"use strict";b.d(S,{c:()=>V});var z=b(11339),C=b(11103),v=b(11532),U=b(12496),g=b(11379),r=b(13323),I=b(10975);z.c.prototype.createOrUpdateSelectionOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,b=this._getComponent(g.c.NAME_OCTREE);b||(b=new V(this),this.o(b)),this.yl||(this.yl=new r.c(r.c.CreationFuncForMeshes,q,S));const z=this.getWorldExtends();return this.yl.update(z.min,z.max,this.meshes),this.yl},Object.defineProperty(z.c.prototype,"selectionOctree",{get:function(){return this.yl},enumerable:!0,configurable:!0}),v.c.prototype.createOrUpdateSubmeshesOctree=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const b=this.Tq();let z=b._getComponent(g.c.NAME_OCTREE);z||(z=new V(b),b.o(z)),this._submeshesOctree||(this._submeshesOctree=new r.c(r.c.CreationFuncForSubMeshes,q,S)),this.Nb(!0);const C=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(C.minimumWorld,C.maximumWorld,this.Gb),this._submeshesOctree};class V{constructor(q){this.name=g.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new U.e(C.yS.Zero(),new C.yS(1,1,1)),(q=q||I.b.LastCreatedScene)&&(this.GS=q,this.GS.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.GS.getActiveSubMeshCandidates=q=>this.getActiveSubMeshCandidates(q),this.GS.getCollidingSubMeshCandidates=(q,S)=>this.getCollidingSubMeshCandidates(q,S),this.GS.getIntersectingSubMeshCandidates=(q,S)=>this.getIntersectingSubMeshCandidates(q,S))}register(){this.GS.onMeshRemovedObservable.add((q=>{const S=this.GS.selectionOctree;if(void 0!==S&&null!==S){const b=S.Gl.indexOf(q);-1!==b&&S.Gl.splice(b,1)}})),this.GS.onMeshImportedObservable.add((q=>{const S=this.GS.selectionOctree;void 0!==S&&null!==S&&S.NV(q)}))}getActiveMeshCandidates(){var q;return(null===(q=this.GS.yl)||void 0===q?void 0:q.select(this.GS.frustumPlanes))||this.GS._getDefaultMeshCandidates()}getActiveSubMeshCandidates(q){if(q._submeshesOctree&&q.useOctreeForRenderingSelection){return q._submeshesOctree.select(this.GS.frustumPlanes)}return this.GS._getDefaultSubMeshCandidates(q)}getIntersectingSubMeshCandidates(q,S){if(q._submeshesOctree&&q.useOctreeForPicking){U.e.TransformToRef(S,q.getWorldMatrix(),this._tempRay);return q._submeshesOctree.intersectsRay(this._tempRay)}return this.GS._getDefaultSubMeshCandidates(q)}getCollidingSubMeshCandidates(q,S){if(q._submeshesOctree&&q.useOctreeForCollisions){const b=S._velocityWorldLength+Math.max(S._radius.x,S._radius.y,S._radius.z);return q._submeshesOctree.intersects(S._basePointWorld,b)}return this.GS._getDefaultSubMeshCandidates(q)}rebuild(){}dispose(){}}},12496:(q,S,b)=>{"use strict";b.d(S,{e:()=>R});var z=b(11339),C=b(11557),v=b(11109),U=b(11103),g=b(11118),r=b(11439),I=b(11372),V=b(10975),l=b(11395);const y={internalPickerForMesh:void 0};class R{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.d;this.origin=q,this.direction=S,this.length=b,this.epsilon=z}clone(){return new R(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=R._TmpVector3[0].Bb(q.x-b,q.y-b,q.z-b),C=R._TmpVector3[1].Bb(S.x+b,S.y+b,S.z+b);let v,U,g,r,I=0,V=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<z.x||this.origin.x>C.x)return!1}else if(v=1/this.direction.x,U=(z.x-this.origin.x)*v,g=(C.x-this.origin.x)*v,g===-1/0&&(g=1/0),U>g&&(r=U,U=g,g=r),I=Math.max(U,I),V=Math.min(g,V),I>V)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<z.y||this.origin.y>C.y)return!1}else if(v=1/this.direction.y,U=(z.y-this.origin.y)*v,g=(C.y-this.origin.y)*v,g===-1/0&&(g=1/0),U>g&&(r=U,U=g,g=r),I=Math.max(U,I),V=Math.min(g,V),I>V)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<z.z||this.origin.z>C.z)return!1}else if(v=1/this.direction.z,U=(z.z-this.origin.z)*v,g=(C.z-this.origin.z)*v,g===-1/0&&(g=1/0),U>g&&(r=U,U=g,g=r),I=Math.max(U,I),V=Math.min(g,V),I>V)return!1;return!0}intersectsBox(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(q.minimum,q.maximum,S)}intersectsSphere(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=q.center.x-this.origin.x,z=q.center.y-this.origin.y,C=q.center.z-this.origin.z,v=b*b+z*z+C*C,U=q.radius+S,g=U*U;if(v<=g)return!0;const r=b*this.direction.x+z*this.direction.y+C*this.direction.z;if(r<0)return!1;return v-r*r<=g}intersectsTriangle(q,S,b){const z=R._TmpVector3[0],C=R._TmpVector3[1],v=R._TmpVector3[2],g=R._TmpVector3[3],I=R._TmpVector3[4];S.subtractToRef(q,z),b.subtractToRef(q,C),U.yS.CrossToRef(this.direction,C,v);const V=U.yS.Dot(z,v);if(0===V)return null;const l=1/V;this.origin.subtractToRef(q,g);const y=U.yS.Dot(g,v)*l;if(y<-this.epsilon||y>1+this.epsilon)return null;U.yS.CrossToRef(g,z,I);const G=U.yS.Dot(this.direction,I)*l;if(G<-this.epsilon||y+G>1+this.epsilon)return null;const Z=U.yS.Dot(C,I)*l;return Z>this.length?null:new r.b(1-y-G,y,Z)}intersectsPlane(q){let S;const b=U.yS.Dot(q.normal,this.direction);if(Math.abs(b)<9.99999997475243e-7)return null;{const z=U.yS.Dot(q.normal,this.origin);return S=(-q.d-z)/b,S<0?S<-9.99999997475243e-7?null:0:S}}intersectsAxis(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(q){case"y":{const q=(this.origin.y-S)/this.direction.y;return q>0?null:new U.yS(this.origin.x+this.direction.x*-q,S,this.origin.z+this.direction.z*-q)}case"x":{const q=(this.origin.x-S)/this.direction.x;return q>0?null:new U.yS(S,this.origin.y+this.direction.y*-q,this.origin.z+this.direction.z*-q)}case"z":{const q=(this.origin.z-S)/this.direction.z;return q>0?null:new U.yS(this.origin.x+this.direction.x*-q,this.origin.y+this.direction.y*-q,S)}default:return null}}intersectsMesh(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=U.TmpVectors.Matrix[0];return q.getWorldMatrix().invertToRef(g),this._tmpRay?R.TransformToRef(this,g,this._tmpRay):this._tmpRay=R.Transform(this,g),q.intersects(this._tmpRay,S,b,z,C,v)}intersectsMeshes(q,S,b){b?b.length=0:b=[];for(let z=0;z<q.length;z++){const C=this.intersectsMesh(q[z],S);C.hit&&b.push(C)}return b.sort(this._comparePickingInfo),b}_comparePickingInfo(q,S){return q.distance<S.distance?-1:q.distance>S.distance?1:0}intersectionSegment(q,S,b){const z=this.origin,C=U.TmpVectors.yS[0],v=U.TmpVectors.yS[1],g=U.TmpVectors.yS[2],r=U.TmpVectors.yS[3];S.subtractToRef(q,C),this.direction.scaleToRef(R._Rayl,g),z.addToRef(g,v),q.subtractToRef(z,r);const I=U.yS.Dot(C,C),V=U.yS.Dot(C,g),l=U.yS.Dot(g,g),y=U.yS.Dot(C,r),G=U.yS.Dot(g,r),Z=I*l-V*V;let H,Q,k=Z,W=Z;Z<R._Smallnum?(H=0,k=1,Q=G,W=l):(H=V*G-l*y,Q=I*G-V*y,H<0?(H=0,Q=G,W=l):H>k&&(H=k,Q=G+V,W=l)),Q<0?(Q=0,-y<0?H=0:-y>I?H=k:(H=-y,k=I)):Q>W&&(Q=W,-y+V<0?H=0:-y+V>I?H=k:(H=-y+V,k=I));const N=Math.abs(H)<R._Smallnum?0:H/k,u=Math.abs(Q)<R._Smallnum?0:Q/W,X=U.TmpVectors.yS[4];g.scaleToRef(u,X);const T=U.TmpVectors.yS[5];C.scaleToRef(N,T),T.addInPlace(r);const B=U.TmpVectors.yS[6];T.subtractToRef(X,B);return u>0&&u<=this.length&&B.lengthSquared()<b*b?T.length():-1}update(q,S,b,z,C,v,g){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){R._RayDistant||(R._RayDistant=R.Zero()),R._RayDistant.unprojectRayToRef(q,S,b,z,U.Matrix.IdentityReadOnly,v,g);const r=U.TmpVectors.Matrix[0];C.invertToRef(r),R.TransformToRef(R._RayDistant,r,this)}else this.unprojectRayToRef(q,S,b,z,C,v,g);return this}static Zero(){return new R(U.yS.Zero(),U.yS.Zero())}static CreateNew(q,S,b,z,C,v,U){return R.Zero().update(q,S,b,z,C,v,U)}static CreateNewFromTo(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.Matrix.IdentityReadOnly;const z=new R(new U.yS(0,0,0),new U.yS(0,0,0));return R.CreateFromToToRef(q,S,z,b)}static CreateFromToToRef(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.Matrix.IdentityReadOnly;b.origin.v(q);const C=S.subtractToRef(q,b.direction),v=Math.sqrt(C.x*C.x+C.y*C.y+C.z*C.z);return b.length=v,b.direction.normalize(),R.TransformToRef(b,z,b)}static Transform(q,S){const b=new R(new U.yS(0,0,0),new U.yS(0,0,0));return R.TransformToRef(q,S,b),b}static TransformToRef(q,S,b){U.yS.TransformCoordinatesToRef(q.origin,S,b.origin),U.yS.TransformNormalToRef(q.direction,S,b.direction),b.length=q.length,b.epsilon=q.epsilon;const z=b.direction,C=z.length();if(0!==C&&1!==C){const q=1/C;z.x*=q,z.y*=q,z.z*=q,b.length*=C}return b}unprojectRayToRef(q,S,b,z,C,v,g){const r=U.TmpVectors.Matrix[0];C.multiplyToRef(v,r),r.multiplyToRef(g,r),r.invert();const I=V.b.LastCreatedEngine,l=U.TmpVectors.yS[0];l.x=q/b*2-1,l.y=-(S/z*2-1),l.z=null!==I&&void 0!==I&&I.useReverseDepthBuffer?1:null!==I&&void 0!==I&&I.isNDCHalfZRange?0:-1;const y=U.TmpVectors.yS[1].Bb(l.x,l.y,1-1e-8),R=U.TmpVectors.yS[2],G=U.TmpVectors.yS[3];U.yS._UnprojectFromInvertedMatrixToRef(l,r,R),U.yS._UnprojectFromInvertedMatrixToRef(y,r,G),this.origin.v(R),G.subtractToRef(R,this.direction),this.direction.normalize()}}function G(q,S,b,z,C){let v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=R.Zero();return Z(q,S,b,z,U,C,v),U}function Z(q,S,b,z,C,v){let g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const I=q.getEngine();if(!v&&!(v=q.activeCamera))return q;const V=v.viewport,l=I.getRenderHeight(),{x:y,y:R,width:G,height:Z}=V.toGlobal(I.getRenderWidth(),l),H=1/I.getHardwareScalingLevel();return S=S*H-y,b=b*H-(l-R-Z),C.update(S,b,G,Z,z||U.Matrix.IdentityReadOnly,g?U.Matrix.IdentityReadOnly:v.getViewMatrix(),v.getProjectionMatrix(),r),q}function H(q,S,b,z,C){if(!I.e)return q;const v=q.getEngine();if(!C&&!(C=q.activeCamera))throw new Error("Active camera not set");const g=C.viewport,r=v.getRenderHeight(),{x:V,y:l,width:y,height:R}=g.toGlobal(v.getRenderWidth(),r),G=U.Matrix.Identity(),Z=1/v.getHardwareScalingLevel();return S=S*Z-V,b=b*Z-(r-l-R),z.update(S,b,y,R,G,G,C.getProjectionMatrix()),q}function Q(q,S,b,z,C,v,U,g){const r=S(z,b.enableDistantPicking),I=b.intersects(r,C,U,v,z,g);return I&&I.hit?!C&&null!=q&&I.distance>=q.distance?null:I:null}function k(q,S,b,z,C,v){let g=null;const r=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),V=q.cameraToUseForPointers||q.activeCamera,l=y.internalPickerForMesh||Q;for(let I=0;I<q.meshes.length;I++){const y=q.meshes[I];if(b){if(!b(y,-1))continue}else if(!y.isEnabled()||!y.isVisible||!y.gI)continue;const R=r&&y.isWorldMatrixCameraDependent(),G=y.Nb(R,V);if(y.hasThinInstances&&y.thinInstanceEnablePicking){const q=l(g,S,y,G,!0,!0,v);if(q){if(C)return q;const r=U.TmpVectors.Matrix[1],I=y.thinInstanceGetWorldMatrices();for(let q=0;q<I.length;q++){if(b&&!b(y,q))continue;I[q].multiplyToRef(G,r);const U=l(g,S,y,r,z,C,v,!0);if(U&&(g=U,g.thinInstanceIndex=q,z))return g}}}else{const q=l(g,S,y,G,z,C,v);if(q&&(g=q,z))return g}}return g||new I.e}function W(q,S,b,z){if(!I.e)return null;const C=[],v=!!(q.activeCameras&&q.activeCameras.length>1&&q.cameraToUseForPointers!==q.activeCamera),g=q.cameraToUseForPointers||q.activeCamera,r=y.internalPickerForMesh||Q;for(let I=0;I<q.meshes.length;I++){const V=q.meshes[I];if(b){if(!b(V,-1))continue}else if(!V.isEnabled()||!V.isVisible||!V.gI)continue;const l=v&&V.isWorldMatrixCameraDependent(),y=V.Nb(l,g);if(V.hasThinInstances&&V.thinInstanceEnablePicking){if(r(null,S,V,y,!0,!0,z)){const q=U.TmpVectors.Matrix[1],v=V.thinInstanceGetWorldMatrices();for(let U=0;U<v.length;U++){if(b&&!b(V,U))continue;v[U].multiplyToRef(y,q);const g=r(null,S,V,q,!1,!1,z,!0);g&&(g.thinInstanceIndex=U,C.push(g))}}}else{const q=r(null,S,V,y,!1,!1,z);q&&C.push(q)}}return C}function N(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,z=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;z||(z=q.getWorldMatrix()),S.length=b,C?S.origin.v(C):S.origin.v(q.position);const v=U.TmpVectors.yS[2];v.set(0,0,q._scene.useRightHandedSystem?-1:1);const g=U.TmpVectors.yS[3];return U.yS.TransformNormalToRef(v,z,g),U.yS.NormalizeToRef(g,S.direction),S}var u,X;R._TmpVector3=(0,g.e)(6,U.yS.Zero),R._RayDistant=R.Zero(),R._Smallnum=1e-8,R._Rayl=1e9,u=z.c,(X=C.c)&&(X.prototype.getForwardRay=function(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,S=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;return N(this,new R(U.yS.Zero(),U.yS.Zero(),q),q,S,b)},X.prototype.getForwardRayToRef=function(q){return N(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),u&&(l.c._IsPickingAvailable=!0,u.prototype.createPickingRay=function(q,S,b,z){return G(this,q,S,b,z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),z.c.prototype.createPickingRayToRef=function(q,S,b,z,C){return Z(this,q,S,b,z,C,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},z.c.prototype.createPickingRayInCameraSpace=function(q,S,b){return function(q,S,b,z){const C=R.Zero();return H(q,S,b,C,z),C}(this,q,S,b)},z.c.prototype.createPickingRayInCameraSpaceToRef=function(q,S,b,z){return H(this,q,S,b,z)},z.c.prototype.pickWithBoundingInfo=function(q,S,b,z,C){return function(q,S,b,z,C,v){if(!I.e)return null;const g=k(q,(z=>(q._tempPickingRay||(q._tempPickingRay=R.Zero()),Z(q,S,b,z,q._tempPickingRay,v||null),q._tempPickingRay)),z,C,!0);return g&&(g.ray=G(q,S,b,U.Matrix.Identity(),v||null)),g}(this,q,S,b,z,C)},z.c.prototype.vz=function(q,S,b,z,C,v){return function(q,S,b,z,C,v,g){const r=k(q,((z,C)=>(q._tempPickingRay||(q._tempPickingRay=R.Zero()),Z(q,S,b,z,q._tempPickingRay,v||null,!1,C),q._tempPickingRay)),z,C,!1,g);return r&&(r.ray=G(q,S,b,U.Matrix.Identity(),v||null)),r}(this,q,S,b,z,C,v)},z.c.prototype.pickWithRay=function(q,S,b,z){return function(q,S,b,z,C){const v=k(q,(b=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=U.Matrix.Identity()),b.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=R.Zero()),R.TransformToRef(S,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),b,z,!1,C);return v&&(v.ray=S),v}(this,q,S,b,z)},z.c.prototype.multiPick=function(q,S,b,z,C){return function(q,S,b,z,C,v){return W(q,(z=>G(q,S,b,z,C||null)),z,v)}(this,q,S,b,z,C)},z.c.prototype.multiPickWithRay=function(q,S,b){return function(q,S,b,z){return W(q,(b=>(q._pickWithRayInverseMatrix||(q._pickWithRayInverseMatrix=U.Matrix.Identity()),b.invertToRef(q._pickWithRayInverseMatrix),q._cachedRayForTransform||(q._cachedRayForTransform=R.Zero()),R.TransformToRef(S,q._pickWithRayInverseMatrix,q._cachedRayForTransform),q._cachedRayForTransform)),b,z)}(this,q,S,b)}},12801:(q,S,b)=>{"use strict";var z=b(11033),C=b(10943),v=b(10977),U=b(11060),g=b(11006),r=b(11045);g.c.prototype._partialLoadFile=function(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(q,(q=>{b[S]=q,b._internalCount++,6===b._internalCount&&z(b)}),void 0,void 0,!0,((q,S)=>{C&&q&&C(q.status+" "+q.statusText,S)}))},g.c.prototype._cascadeLoadFiles=function(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=[];C._internalCount=0;for(let v=0;v<6;v++)this._partialLoadFile(b[v],v,C,S,z)},g.c.prototype._cascadeLoadImgs=function(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5?arguments[5]:void 0;const U=[];U._internalCount=0;for(let g=0;g<6;g++)this._partialLoadImg(z[g],g,U,q,S,b,C,v)},g.c.prototype._partialLoadImg=function(q,S,b,z,C,g){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7?arguments[7]:void 0;const V=(0,U.d)();(0,v.t)(q,(q=>{b[S]=q,b._internalCount++,z&&z.removePendingData(V),6===b._internalCount&&g&&g(C,b)}),((q,S)=>{z&&z.removePendingData(V),r&&r(q,S)}),z?z.offlineProvider:null,I),z&&z.addPendingData(V)},g.c.prototype.createCubeTextureBase=function(q,S,b,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6?arguments[6]:void 0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,R=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,G=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,H=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Q=arguments.length>14&&void 0!==arguments[14]&&arguments[14],k=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const W=G||new z.d(this,7);W.isCube=!0,W.url=q,W.generateMipMaps=!v,W._lodGenerationScale=y,W._lodGenerationOffset=R,W._useSRGBBuffer=!!Q&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!v),W!==G&&(W.label=q.substring(0,60)),this._doNotHandleContextLost||(W._extension=V,W._files=b,W._buffer=k);const N=q;this._transformTextureUrl&&!G&&(q=this._transformTextureUrl(q));const u=V??function(q){const S=q.split("?")[0],b=S.lastIndexOf(".");return b>-1?S.substring(b).toLowerCase():""}(q),X=(0,r.d)(u),T=(q,S)=>{W.dispose(),g?g(q,S):q&&C.b.Warn(q)},B=(z,g)=>{q===N?z&&T(z.status+" "+z.statusText,g):(C.b.Warn(`Failed to load ${q}, falling back to the ${N}`),this.createCubeTextureBase(N,S,b,!!v,U,T,I,V,l,y,R,W,Z,H,Q,k))};if(X)X.then((z=>{const C=q=>{Z&&Z(W,q),z.loadCubeData(q,W,l,U,((q,S)=>{T(q,S)}))};k?C(k):b&&6===b.length?z.supportCascades?this._cascadeLoadFiles(S,(q=>C(q.map((q=>new Uint8Array(q))))),b,T):T("Textures type does not support cascades."):this._loadFile(q,(q=>C(new Uint8Array(q))),void 0,void 0,!0,B)}));else{if(!b||0===b.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(S,W,((q,S)=>{H&&H(q,S)}),b,T)}return this._internalTexturesCache.push(W),W}},13344:(q,S,b)=>{"use strict";b(10943);var z=b(11231);b(11033),b(11181),b(11029),b(11281),b(11246);z.e},12836:(q,S,b)=>{"use strict";b.d(S,{d:()=>C});var z=b(11058);class C{constructor(q){this.value=this._toInt(q)}_toInt(q){return 0|q}add(q){return new C(this.value+q.value)}RS(q){return new C(this.value-q.value)}multiply(q){return new C(Math.imul(this.value,q.value))}divide(q){return new C(this.value/q.value)}getClassName(){return C.ClassName}equals(q){return this.value===q.value}static FromValue(q){return new C(q)}toString(){return this.value.toString()}}C.ClassName="FlowGraphInteger",(0,z.f)("FlowGraphInteger",C)},12841:(q,S,b)=>{"use strict";b.d(S,{e:()=>C,f:()=>v});var z=b(11103);class C{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.rb=q}get m(){return this.rb}transformVector(q){return this.transformVectorToRef(q,new z.Vector2)}transformVectorToRef(q,S){return S.x=q.x*this.rb[0]+q.y*this.rb[1],S.y=q.x*this.rb[2]+q.y*this.rb[3],S}Zb(){return this.toArray()}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<4;S++)q[S]=this.rb[S];return q}Uz(q){for(let S=0;S<4;S++)this.rb[S]=q[S];return this}multiplyToRef(q,S){const b=q.rb,z=this.rb,C=S.rb;return C[0]=b[0]*z[0]+b[1]*z[2],C[1]=b[0]*z[1]+b[1]*z[3],C[2]=b[2]*z[0]+b[3]*z[2],C[3]=b[2]*z[1]+b[3]*z[3],S}multiply(q){return this.multiplyToRef(q,new C)}divideToRef(q,S){const b=this.rb,z=q.rb,C=S.rb;return C[0]=b[0]/z[0],C[1]=b[1]/z[1],C[2]=b[2]/z[2],C[3]=b[3]/z[3],S}divide(q){return this.divideToRef(q,new C)}addToRef(q,S){const b=this.rb,z=q.m,C=S.m;return C[0]=b[0]+z[0],C[1]=b[1]+z[1],C[2]=b[2]+z[2],C[3]=b[3]+z[3],S}add(q){return this.addToRef(q,new C)}subtractToRef(q,S){const b=this.rb,z=q.m,C=S.m;return C[0]=b[0]-z[0],C[1]=b[1]-z[1],C[2]=b[2]-z[2],C[3]=b[3]-z[3],S}RS(q){return this.subtractToRef(q,new C)}transpose(){const q=this.rb;return new C([q[0],q[2],q[1],q[3]])}determinant(){const q=this.rb;return q[0]*q[3]-q[1]*q[2]}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const S=this.rb,b=1/q;return new C([S[3]*b,-S[1]*b,-S[2]*b,S[0]*b])}equals(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.rb,z=q.m;return 0===S?b[0]===z[0]&&b[1]===z[1]&&b[2]===z[2]&&b[3]===z[3]:Math.abs(b[0]-z[0])<S&&Math.abs(b[1]-z[1])<S&&Math.abs(b[2]-z[2])<S&&Math.abs(b[3]-z[3])<S}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.rb.join(", ")})`}}class v{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.rb=q}get m(){return this.rb}transformVector(q){return this.transformVectorToRef(q,new z.yS)}transformVectorToRef(q,S){const b=this.rb;return S.x=q.x*b[0]+q.y*b[1]+q.z*b[2],S.y=q.x*b[3]+q.y*b[4]+q.z*b[5],S.z=q.x*b[6]+q.y*b[7]+q.z*b[8],S}multiplyToRef(q,S){const b=q.rb,z=this.rb,C=S.m;return C[0]=b[0]*z[0]+b[1]*z[3]+b[2]*z[6],C[1]=b[0]*z[1]+b[1]*z[4]+b[2]*z[7],C[2]=b[0]*z[2]+b[1]*z[5]+b[2]*z[8],C[3]=b[3]*z[0]+b[4]*z[3]+b[5]*z[6],C[4]=b[3]*z[1]+b[4]*z[4]+b[5]*z[7],C[5]=b[3]*z[2]+b[4]*z[5]+b[5]*z[8],C[6]=b[6]*z[0]+b[7]*z[3]+b[8]*z[6],C[7]=b[6]*z[1]+b[7]*z[4]+b[8]*z[7],C[8]=b[6]*z[2]+b[7]*z[5]+b[8]*z[8],S}multiply(q){return this.multiplyToRef(q,new v)}divideToRef(q,S){const b=this.rb,z=q.m,C=S.m;return C[0]=b[0]/z[0],C[1]=b[1]/z[1],C[2]=b[2]/z[2],C[3]=b[3]/z[3],C[4]=b[4]/z[4],C[5]=b[5]/z[5],C[6]=b[6]/z[6],C[7]=b[7]/z[7],C[8]=b[8]/z[8],S}divide(q){return this.divideToRef(q,new v)}addToRef(q,S){const b=this.rb,z=q.m,C=S.m;return C[0]=b[0]+z[0],C[1]=b[1]+z[1],C[2]=b[2]+z[2],C[3]=b[3]+z[3],C[4]=b[4]+z[4],C[5]=b[5]+z[5],C[6]=b[6]+z[6],C[7]=b[7]+z[7],C[8]=b[8]+z[8],S}add(q){return this.addToRef(q,new v)}subtractToRef(q,S){const b=this.rb,z=q.m,C=S.m;return C[0]=b[0]-z[0],C[1]=b[1]-z[1],C[2]=b[2]-z[2],C[3]=b[3]-z[3],C[4]=b[4]-z[4],C[5]=b[5]-z[5],C[6]=b[6]-z[6],C[7]=b[7]-z[7],C[8]=b[8]-z[8],S}RS(q){return this.subtractToRef(q,new v)}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let S=0;S<9;S++)q[S]=this.rb[S];return q}Zb(){return this.toArray()}Uz(q){for(let S=0;S<9;S++)this.rb[S]=q[S];return this}transpose(){const q=this.rb;return new v([q[0],q[3],q[6],q[1],q[4],q[7],q[2],q[5],q[8]])}determinant(){const q=this.rb;return q[0]*(q[4]*q[8]-q[5]*q[7])-q[1]*(q[3]*q[8]-q[5]*q[6])+q[2]*(q[3]*q[7]-q[4]*q[6])}inverse(){const q=this.determinant();if(0===q)throw new Error("Matrix is not invertible");const S=this.rb,b=1/q;return new v([(S[4]*S[8]-S[5]*S[7])*b,(S[2]*S[7]-S[1]*S[8])*b,(S[1]*S[5]-S[2]*S[4])*b,(S[5]*S[6]-S[3]*S[8])*b,(S[0]*S[8]-S[2]*S[6])*b,(S[2]*S[3]-S[0]*S[5])*b,(S[3]*S[7]-S[4]*S[6])*b,(S[1]*S[6]-S[0]*S[7])*b,(S[0]*S[4]-S[1]*S[3])*b])}equals(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const b=this.rb,z=q.m;return 0===S?b[0]===z[0]&&b[1]===z[1]&&b[2]===z[2]&&b[3]===z[3]&&b[4]===z[4]&&b[5]===z[5]&&b[6]===z[6]&&b[7]===z[7]&&b[8]===z[8]:Math.abs(b[0]-z[0])<S&&Math.abs(b[1]-z[1])<S&&Math.abs(b[2]-z[2])<S&&Math.abs(b[3]-z[3])<S&&Math.abs(b[4]-z[4])<S&&Math.abs(b[5]-z[5])<S&&Math.abs(b[6]-z[6])<S&&Math.abs(b[7]-z[7])<S&&Math.abs(b[8]-z[8])<S}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.rb.join(", ")})`}}},12845:(q,S,b)=>{"use strict";var z;function C(q,S,b,z){switch(S){case"Animation":return z?q.animations.find((q=>q.uniqueId===b))??null:q.animations[b]??null;case"AnimationGroup":return z?q.animationGroups.find((q=>q.uniqueId===b))??null:q.animationGroups[b]??null;case"Mesh":return z?q.meshes.find((q=>q.uniqueId===b))??null:q.meshes[b]??null;case"Material":return z?q.materials.find((q=>q.uniqueId===b))??null:q.materials[b]??null;case"EV":return z?q.cameras.find((q=>q.uniqueId===b))??null:q.cameras[b]??null;case"Light":return z?q.lights.find((q=>q.uniqueId===b))??null:q.lights[b]??null;default:return null}}b.d(S,{b:()=>C}),function(q){q.Animation="Animation",q.AnimationGroup="AnimationGroup",q.Mesh="Mesh",q.Material="Material",q.EV="EV",q.Light="Light"}(z||(z={}))},12864:(q,S,b)=>{"use strict";b.d(S,{c:()=>C});var z=b(12866);class C extends z.e{constructor(q,S){if(super(q),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),S)for(const b of S)this._eventsSignalOutputs[b]=this._registerSignalOutput(b+"Event")}_executeOnTick(q){}_startPendingTasks(q){q._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(q),this._resetAfterCanceled(q)),this._preparePendingTasks(q),q._addPendingBlock(this),this.out._activateSignal(q),q._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(q){q._deleteExecutionVariable(this,"_initialized"),q._removePendingBlock(this)}}},12852:(q,S,b)=>{"use strict";b.d(S,{c:()=>I});var z=b(11060),C=b(11058),v=b(12854),U=b(10929),g=b(12830);class r extends v.d{constructor(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:z.defaultValue,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(q,S,b),this.richType=z,this._defaultValue=C,this._optional=v,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new U.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(q){this._isDisabled!==q&&(this._isDisabled=q,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(q,S){S._getConnectionValue(this)!==q&&(S._setConnectionValue(this,q),this.onValueChangedObservable.notifyObservers(q))}resetToDefaultValue(q){q._setConnectionValue(this,this._defaultValue)}connectTo(q){this._isDisabled||super.connectTo(q)}_getValueOrDefault(q){const S=q._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(S):S}getValue(q){if(1===this.connectionType){q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(q);const S=this._getValueOrDefault(q);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}const S=this.isConnected()?this._connectedPoint[0].getValue(q):this._getValueOrDefault(q);return this._lastValue=S,this.richType.typeTransformer?this.richType.typeTransformer(S):S}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.richType={},this.richType.serialize(q.richType),q.optional=this._optional,(0,g.g)("defaultValue",this._defaultValue,q)}}(0,C.f)("FlowGraphDataConnection",r);class I{constructor(q){var S;this.config=q,this.uniqueId=(0,z.d)(),this.name=(null===(S=this.config)||void 0===S?void 0:S.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(q){}registerDataInput(q,S,b){const z=new r(q,0,this,S,b);return this.dataInputs.push(z),z}registerDataOutput(q,S,b){const z=new r(q,1,this,S,b);return this.dataOutputs.push(z),z}getDataInput(q){return this.dataInputs.find((S=>S.name===q))}getDataOutput(q){return this.dataOutputs.find((S=>S.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.g;if(q.uniqueId=this.uniqueId,q.config={},this.config){const b=this.config,z=Object.keys(b);for(const C of z)S(C,b[C],q.config)}q.dataInputs=[],q.dataOutputs=[],q.className=this.getClassName();for(const b of this.dataInputs){const S={};b.serialize(S),q.dataInputs.push(S)}for(const b of this.dataOutputs){const S={};b.serialize(S),q.dataOutputs.push(S)}}deserialize(q){}_log(q,S,b){var z;null===(z=q.logger)||void 0===z||z.addLogItem({action:S,payload:b,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12854:(q,S,b)=>{"use strict";b.d(S,{d:()=>v});var z,C=b(11060);!function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(z||(z={}));class v{constructor(q,S,b){this._ownerBlock=b,this._connectedPoint=[],this.uniqueId=(0,C.d)(),this.connectedPointIds=[],this.name=q,this._connectionType=S}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(q){if(this._connectionType===q._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||q._isSingularConnection()&&q._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(q),q._connectedPoint.push(this)}disconnectFrom(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const b=this._connectedPoint.indexOf(q),z=q._connectedPoint.indexOf(this);-1!==b&&-1!==z&&(S&&this._connectedPoint.splice(b,1),q._connectedPoint.splice(z,1))}disconnectFromAll(){for(const q of this._connectedPoint)this.disconnectFrom(q,!1);this._connectedPoint.length=0}dispose(){for(const q of this._connectedPoint)this.disconnectFrom(q)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.uniqueId=this.uniqueId,q.name=this.name,q._connectionType=this._connectionType,q.connectedPointIds=[],q.className=this.getClassName();for(const S of this._connectedPoint)q.connectedPointIds.push(S.uniqueId)}getClassName(){return"FGConnection"}deserialize(q){this.uniqueId=q.uniqueId,this.name=q.name,this._connectionType=q._connectionType,this.connectedPointIds=q.connectedPointIds}}},12821:(q,S,b)=>{"use strict";b.d(S,{d:()=>W});var z,C=b(10929),v=b(11081),U=b(11090),g=b(11060),r=b(12830),I=b(12845),V=b(10943);!function(q){q.ExecuteBlock="ExecuteBlock",q.ExecuteEvent="ExecuteEvent",q.TriggerConnection="TriggerConnection",q.ContextVariableSet="ContextVariableSet",q.GlobalVariableSet="GlobalVariableSet",q.GlobalVariableDelete="GlobalVariableDelete",q.GlobalVariableGet="GlobalVariableGet",q.AddConnection="AddConnection",q.GetConnectionValue="GetConnectionValue",q.SetConnectionValue="SetConnectionValue",q.ActivateSignal="ActivateSignal",q.ContextVariableGet="ContextVariableGet"}(z||(z={}));class l{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(q){if(q.time||(q.time=Date.now()),this.log.push(q),this.logToConsole){var S;const b=null===(S=q.payload)||void 0===S?void 0:S.value;"object"===typeof b&&b.getClassName?V.b.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(b.getClassName())}: ${b.toString()}`):V.b.Log(`[FGLog] ${q.className}:${q.uniqueId.split("-")[0]} ${q.action} - ${JSON.stringify(q.payload)}`)}}getItemsOfType(q){return this.log.filter((S=>S.action===q))}}class y{get enableLogging(){return this._enableLogging}set enableLogging(q){this._enableLogging!==q&&(this._enableLogging=q,this._enableLogging?(this.logger=new l,this.logger.logToConsole=!0):this.logger=null)}constructor(q){this.uniqueId=(0,g.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new C.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=q,this.assetsContext=q.assetsContext??q.GS}hasVariable(q){return q in this._userVariables}setVariable(q,S){var b;this._userVariables[q]=S,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:q,value:S}})}getAsset(q,S){return(0,I.b)(this.assetsContext,q,S)}getVariable(q){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:q,value:this._userVariables[q]}}),this._userVariables[q]}get userVariables(){return this._userVariables}Tq(){return this._configuration.GS}_getUniqueIdPrefixedName(q,S){return`${q.uniqueId}_${S}`}_getGlobalContextVariable(q,S){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:q,defaultValue:S,possibleValue:this._globalContextVariables[q]}}),this._hasGlobalContextVariable(q)?this._globalContextVariables[q]:S}_setGlobalContextVariable(q,S){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:q,value:S}}),this._globalContextVariables[q]=S}_deleteGlobalContextVariable(q){var S;null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:q}}),delete this._globalContextVariables[q]}_hasGlobalContextVariable(q){return q in this._globalContextVariables}_setExecutionVariable(q,S,b){this._executionVariables[this._getUniqueIdPrefixedName(q,S)]=b}_getExecutionVariable(q,S,b){return this._hasExecutionVariable(q,S)?this._executionVariables[this._getUniqueIdPrefixedName(q,S)]:b}_deleteExecutionVariable(q,S){delete this._executionVariables[this._getUniqueIdPrefixedName(q,S)]}_hasExecutionVariable(q,S){return this._getUniqueIdPrefixedName(q,S)in this._executionVariables}_hasConnectionValue(q){return q.uniqueId in this._connectionValues}_setConnectionValue(q,S){var b;this._connectionValues[q.uniqueId]=S,null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:q.uniqueId,value:S}})}_setConnectionValueByKey(q,S){this._connectionValues[q]=S}_getConnectionValue(q){var S;return null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:q.uniqueId,value:this._connectionValues[q.uniqueId]}}),this._connectionValues[q.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(q){this._pendingBlocks.includes(q)||(this._pendingBlocks.push(q),this._pendingBlocks.sort(((q,S)=>q.priority-S.priority)))}_removePendingBlock(q){const S=this._pendingBlocks.indexOf(q);-1!==S&&this._pendingBlocks.splice(S,1)}_clearPendingBlocks(){for(const q of this._pendingBlocks)q._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(q){var S;this.onNodeExecutedObservable.notifyObservers(q),null===(S=this.logger)||void 0===S||S.addLogItem({time:Date.now(),className:q.getClassName(),uniqueId:q.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(q){this._setGlobalContextVariable("timeSinceStart",q.timeSinceStart),this._setGlobalContextVariable("deltaTime",q.deltaTime);for(const b of this._pendingBlocks){var S;null===(S=b._executeOnTick)||void 0===S||S.call(b,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.g;q.uniqueId=this.uniqueId,q._userVariables={};for(const z in this._userVariables)S(z,this._userVariables[z],q._userVariables);q._connectionValues={};for(const z in this._connectionValues)S(z,this._connectionValues[z],q._connectionValues);var b;this.assetsContext!==this.Tq()&&(q._assetsContext={meshes:this.assetsContext.meshes.map((q=>q.id)),materials:this.assetsContext.materials.map((q=>q.id)),textures:this.assetsContext.textures.map((q=>q.name)),animations:this.assetsContext.animations.map((q=>q.name)),lights:this.assetsContext.lights.map((q=>q.id)),cameras:this.assetsContext.cameras.map((q=>q.id)),SR:null===(b=this.assetsContext.SR)||void 0===b?void 0:b.map((q=>q.name)),skeletons:this.assetsContext.skeletons.map((q=>q.id)),Gy:this.assetsContext.Gy.map((q=>q.name)),geometries:this.assetsContext.geometries.map((q=>q.id)),multiMaterials:this.assetsContext.multiMaterials.map((q=>q.id)),transformNodes:this.assetsContext.transformNodes.map((q=>q.id))})}getClassName(){return"FlowGraphContext"}}(0,v.e)([(0,U.J)()],y.prototype,"uniqueId",void 0);var R=b(12850),G=b(11381);class Z{constructor(q){this.onEventTriggeredObservable=new C.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=q,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.gb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const q=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:q}}),this._startingTime+=q})),this._meshPickedObserver=this._scene.onPointerObservable.add((q=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:q})}),G.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((q=>{const S=q.pointerId,b=q.mesh,z=this._pointerUnderMeshState[S];!z&&b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:S,mesh:b}}):z&&!b?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:S,mesh:z}}):z&&b&&z!==b&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:S,mesh:z,over:b}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:S,mesh:b,out:z}})),this._pointerUnderMeshState[S]=b}),G.e.POINTERMOVE)}dispose(){var q,S,b,z,C;null===(q=this._sceneDisposeObserver)||void 0===q||q.remove(),null===(S=this._sceneReadyObserver)||void 0===S||S.remove(),null===(b=this._sceneOnBeforeRenderObserver)||void 0===b||b.remove(),null===(z=this._meshPickedObserver)||void 0===z||z.remove(),null===(C=this._meshUnderPointerObserver)||void 0===C||C.remove(),this.onEventTriggeredObservable.clear()}}var H,Q=b(12856);!function(q){q[q.Stopped=0]="Stopped",q[q.Started=1]="Started"}(H||(H={}));class k{get state(){return this._state}set state(q){this._state=q,this.onStateChangedObservable.notifyObservers(q)}constructor(q){this.onStateChangedObservable=new C.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=q.GS,this._sceneEventCoordinator=new Z(this._scene),this._coordinator=q.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((q=>{for(const S of this._executionContexts){const b=this._getContextualOrder(q.type,S);for(const z of b)if(!z._executeEvent(S,q.payload))break}switch(q.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const S of this._executionContexts)S._notifyOnTick(q.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const q=new y({GS:this._scene,coordinator:this._coordinator});return this._executionContexts.push(q),q}getContext(q){return this._executionContexts[q]}addEventBlock(q){if("PointerOver"!==q.type&&"PointerOut"!==q.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==q.type&&this._eventBlocks[q.type].push(q),1===this.state)for(const S of this._executionContexts)q._startPendingTasks(S);else this.onStateChangedObservable.addOnce((S=>{if(1===S)for(const b of this._executionContexts)q._startPendingTasks(b)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((q=>{1===q&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const q of this._executionContexts)for(const S in this._eventBlocks){const b=this._getContextualOrder(S,q);for(const S of b)S._startPendingTasks(q)}}_getContextualOrder(q,S){const b=this._eventBlocks[q].sort(((q,S)=>S.initPriority-q.initPriority));if("MeshPick"===q){const q=[];for(const z of b){const C=z.asset.getValue(S);let v=0;for(;v<b.length;v++){const q=b[v].asset.getValue(S);if(C&&q&&(0,Q.k)(C,q))break}q.splice(v,0,z)}return q}return b}dispose(){var q;if(0!==this.state){this.state=0;for(const q of this._executionContexts)q._clearPendingBlocks();this._executionContexts.length=0;for(const q in this._eventBlocks)this._eventBlocks[q].length=0;null===(q=this._eventObserver)||void 0===q||q.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(q){const S=[],b=new Set;for(const z in this._eventBlocks)for(const q of this._eventBlocks[z])S.push(q),b.add(q.uniqueId);for(;S.length>0;){const z=S.pop();q(z);for(const q of z.dataInputs)for(const z of q._connectedPoint)b.has(z._ownerBlock.uniqueId)||(S.push(z._ownerBlock),b.add(z._ownerBlock.uniqueId));if(z instanceof R.e)for(const q of z.signalOutputs)for(const z of q._connectedPoint)b.has(z._ownerBlock.uniqueId)||(S.push(z._ownerBlock),b.add(z._ownerBlock.uniqueId))}}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},S=arguments.length>1?arguments[1]:void 0;q.allBlocks=[],this.visitAllBlocks((S=>{const b={};S.serialize(b),q.allBlocks.push(b)})),q.executionContexts=[];for(const b of this._executionContexts){const z={};b.serialize(z,S),q.executionContexts.push(z)}}}class W{constructor(q){this.config=q,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.GS.gb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.GS.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const q=this._executeOnNextFrame.slice(0);if(q.length)for(const S of q){this.notifyCustomEvent(S.id,S.data,!1);const q=this._executeOnNextFrame.findIndex((q=>q.uniqueId===S.uniqueId));-1!==q&&this._executeOnNextFrame.splice(q,1)}}));(W.SceneCoordinators.get(this.config.GS)??[]).push(this)}createGraph(){const q=new k({GS:this.config.GS,coordinator:this});return this._flowGraphs.push(q),q}removeGraph(q){const S=this._flowGraphs.indexOf(q);-1!==S&&(q.dispose(),this._flowGraphs.splice(S,1))}start(){for(const q of this._flowGraphs)q.start()}dispose(){var q,S;for(const C of this._flowGraphs)C.dispose();this._flowGraphs.length=0,null===(q=this._disposeObserver)||void 0===q||q.remove(),null===(S=this._onBeforeRenderObserver)||void 0===S||S.remove();const b=W.SceneCoordinators.get(this.config.GS)??[],z=b.indexOf(this);-1!==z&&b.splice(z,1)}serialize(q,S){q._flowGraphs=[];for(const b of this._flowGraphs){const z={};b.serialize(z,S),q._flowGraphs.push(z)}q.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(q){let S=this._customEventsMap.get(q);return S||(S=new C.d,this._customEventsMap.set(q,S)),S}notifyCustomEvent(q,S){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:q,data:S,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(q)){const S=this._eventExecutionCounter.get(q);if(this._eventExecutionCounter.set(q,S+1),S>=W.MaxEventTypeExecutionPerFrame)return void(S===W.MaxEventTypeExecutionPerFrame&&V.b.Warn(`FlowGraphCoordinator: Too many executions of event "${q}".`))}else this._eventExecutionCounter.set(q,1);const b=this._customEventsMap.get(q);b&&b.notifyObservers(S)}}W.MaxEventsPerType=30,W.MaxEventTypeExecutionPerFrame=30,W.SceneCoordinators=new Map},12860:(q,S,b)=>{"use strict";b.d(S,{e:()=>C});var z=b(12864);class C extends z.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(q){q._notifyExecuteNode(this),this.done._activateSignal(q)}}},12850:(q,S,b)=>{"use strict";b.d(S,{e:()=>g});var z=b(12852),C=b(12854),v=b(11058);class U extends C.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(q){super.connectTo(q),this._connectedPoint.sort(((q,S)=>S.priority-q.priority))}_activateSignal(q){var S;if(null===(S=q.logger)||void 0===S||S.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)q._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(q,this),q._increaseExecutionId();else for(const b of this._connectedPoint)b._activateSignal(q)}}(0,v.f)("FlowGraphSignalConnection",U);class g extends z.c{constructor(q){super(q),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(q){const S=new U(q,0,this);return this.signalInputs.push(S),S}_registerSignalOutput(q){const S=new U(q,1,this);return this.signalOutputs.push(S),S}_unregisterSignalInput(q){const S=this.signalInputs.findIndex((S=>S.name===q));-1!==S&&(this.signalInputs[S].dispose(),this.signalInputs.splice(S,1))}_unregisterSignalOutput(q){const S=this.signalOutputs.findIndex((S=>S.name===q));-1!==S&&(this.signalOutputs[S].dispose(),this.signalOutputs.splice(S,1))}_reportError(q,S){this.error.payload="string"===typeof S?new Error(S):S,this.error._activateSignal(q)}getSignalInput(q){return this.signalInputs.find((S=>S.name===q))}getSignalOutput(q){return this.signalOutputs.find((S=>S.name===q))}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(q),q.signalInputs=[],q.signalOutputs=[];for(const S of this.signalInputs){const b={};S.serialize(b),q.signalInputs.push(b)}for(const S of this.signalOutputs){const b={};S.serialize(b),q.signalOutputs.push(b)}}deserialize(q){for(let S=0;S<q.signalInputs.length;S++){const b=this.getSignalInput(q.signalInputs[S].name);if(!b)throw new Error("Could not find signal input with name "+q.signalInputs[S].name+" in block "+q.className);b.deserialize(q.signalInputs[S])}for(let S=0;S<q.signalOutputs.length;S++){const b=this.getSignalOutput(q.signalOutputs[S].name);if(!b)throw new Error("Could not find signal output with name "+q.signalOutputs[S].name+" in block "+q.className);b.deserialize(q.signalOutputs[S])}}getClassName(){return"FlowGraphExecutionBlock"}}},12866:(q,S,b)=>{"use strict";b.d(S,{e:()=>C});var z=b(12850);class C extends z.e{constructor(q){super(q),this.out=this._registerSignalOutput("out")}}},12839:(q,S,b)=>{"use strict";b.d(S,{A:()=>G,C:()=>Z,F:()=>t,I:()=>f,J:()=>B,K:()=>T,d:()=>I,f:()=>y,h:()=>X,i:()=>H,j:()=>Q,l:()=>k,o:()=>l,r:()=>u,u:()=>V,y:()=>R});var z,C=b(11103),v=b(11150),U=b(12836),g=b(12841);!function(q){q.Any="any",q.String="string",q.Number="number",q.Boolean="boolean",q.Object="object",q.Integer="FlowGraphInteger",q.Vector2="Vector2",q.yS="yS",q.Vector4="Vector4",q.Quaternion="Quaternion",q.Matrix="Matrix",q.Matrix2D="Matrix2D",q.Matrix3D="Matrix3D",q.HS="HS",q.Jb="Jb"}(z||(z={}));class r{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=q,this.defaultValue=S,this.animationType=b}serialize(q){q.typeName=this.typeName,q.defaultValue=this.defaultValue}}const I=new r("any",void 0),V=new r("string",""),l=new r("number",0,0),y=new r("boolean",!1),R=new r("Vector2",C.Vector2.Zero(),5),G=new r("yS",C.yS.Zero(),1),Z=new r("Vector4",C.Vector4.Zero()),H=new r("Matrix",C.Matrix.Identity(),3),Q=new r("Matrix2D",new g.e),k=new r("Matrix3D",new g.f),W=new r("HS",v.HS.Black(),4),N=new r("Jb",new v.b(0,0,0,0),7),u=new r("Quaternion",C.Quaternion.Identity(),2);u.typeTransformer=q=>{if(q.getClassName){if("Vector4"===q.getClassName())return C.Quaternion.Hb(q.Zb());if("yS"===q.getClassName())return C.Quaternion.FromEulerVector(q);if("Matrix"===q.getClassName())return C.Quaternion.FromRotationMatrix(q)}return q};const X=new r("FlowGraphInteger",new U.d(0),0);function T(q){const S=q;switch(typeof q){case"string":return V;case"number":return l;case"boolean":return y;case"object":if(S.getClassName)switch(S.getClassName()){case"Vector2":return R;case"yS":return G;case"Vector4":return Z;case"Matrix":return H;case"HS":return W;case"Jb":return N;case"Quaternion":return u;case"FlowGraphInteger":return X;case"Matrix2D":return Q;case"Matrix3D":return k}return I;default:return I}}function B(q){switch(q){case"string":return V;case"number":return l;case"boolean":return y;case"Vector2":return R;case"yS":return G;case"Vector4":return Z;case"Matrix":return H;case"HS":return W;case"Jb":return N;case"Quaternion":return u;case"FlowGraphInteger":return X;case"Matrix2D":return Q;case"Matrix3D":return k;default:return I}}function t(q){switch(q){case"number":default:return 0;case"Vector2":return 5;case"yS":return 1;case"Matrix":return 3;case"HS":return 4;case"Jb":return 7;case"Quaternion":return 2}}function f(q){switch(q){case 0:return l;case 5:return R;case 1:return G;case 3:return H;case 4:return W;case 7:return N;case 2:return u;default:return I}}},12830:(q,S,b)=>{"use strict";b.d(S,{e:()=>V,g:()=>I,j:()=>l});var z=b(11150),C=b(11103),v=b(12836),U=b(12839),g=b(12841);function r(q){return"Vector2"===q||"yS"===q||"Vector4"===q||"Quaternion"===q||"HS"===q||"Jb"===q}function I(q,S,b){var z;const C=(null===S||void 0===S||null===(z=S.getClassName)||void 0===z?void 0:z.call(S))??"";if(r(C)||function(q){return"Matrix"===q||"Matrix2D"===q||"Matrix3D"===q}(C))b[q]={value:S.Zb(),className:C};else if("FlowGraphInteger"===C)b[q]={value:S.value,className:C};else if(C&&(S.id||S.name))b[q]={id:S.id,name:S.name,className:C};else{if("object"===typeof S)throw new Error(`Could not serialize value ${S}`);b[q]=S}}function V(q,S,b,I){const l=S[q];let y;const R=(null===l||void 0===l?void 0:l.type)??(null===l||void 0===l?void 0:l.className);if(function(q){return"Mesh"===q||"AbstractMesh"===q||"GroundMesh"===q||"InstanceMesh"===q||"LinesMesh"===q||"GoldbergMesh"===q||"GreasedLineMesh"===q||"TrailMesh"===q}(R)){let q=I.meshes.filter((q=>l.id?q.id===l.id:q.name===l.name));0===q.length&&(q=I.transformNodes.filter((q=>l.id?q.id===l.id:q.name===l.name))),y=l.uniqueId?q.find((q=>q.uniqueId===l.uniqueId)):q[0]}else if(r(R))y=function(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===q)return C.Vector2.Hb(S);if("yS"===q)return b&&(S[2]*=-1),C.yS.Hb(S);if("Vector4"===q)return C.Vector4.Hb(S);if("Quaternion"===q)return b&&(S[2]*=-1,S[3]*=-1),C.Quaternion.Hb(S);if("HS"===q)return new z.HS(S[0],S[1],S[2]);if("Jb"===q)return new z.b(S[0],S[1],S[2],S[3]);throw new Error(`Unknown vector class name ${q}`)}(R,l.value);else if(function(q){return"AnimationGroup"===q}(R)){const q=I.animationGroups.filter((q=>q.name===l.name));y=1===q.length?q[0]:q.find((q=>q.uniqueId===l.uniqueId))}else y="Matrix"===R?C.Matrix.Hb(l.value):"Matrix2D"===R?new g.e(l.value):"Matrix3D"===R?new g.f(l.value):"FlowGraphInteger"===R?v.d.FromValue(l.value):"number"===R||"string"===R||"boolean"===R?l.value[0]:l&&void 0!==l.value?l.value:Array.isArray(l)?l.reduce(((q,S)=>S.eventData?(q[S.id]={type:(0,U.J)(S.type)},"undefined"!==typeof S.value&&(q[S.id].value=V("value",S,b,I)),q):q),{}):l;return y}function l(q){return"FlowGraphJsonPointerParserBlock"===q}},12856:(q,S,b)=>{"use strict";function z(q,S){return!(!q.parent||q.parent!==S&&!z(q.parent,S))}function C(q){if(q.getClassName)return q.getClassName()}function v(q,S){return q===S&&("Vector2"===q||"yS"===q||"Vector4"===q||"Quaternion"===q)}function U(q,S){return q===S&&("Matrix"===q||"Matrix2D"===q||"Matrix3D"===q)}function g(q,S){return"FlowGraphInteger"===q&&"FlowGraphInteger"===S}function r(q,S){const b="number"===typeof q||"number"===typeof(null===q||void 0===q?void 0:q.value);return b&&!S?!isNaN(I(q)):b}function I(q){return"number"===typeof q?q:q.value}b.d(S,{b:()=>g,c:()=>U,g:()=>v,i:()=>C,k:()=>z,o:()=>I,s:()=>r})},12202:(q,S,b)=>{"use strict";b.r(S),b.d(S,{SceneInstrumentation:()=>v});var z=b(10921),C=b(11321);class v{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(q){q!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=q,q?(this._onBeforeActiveMeshesEvaluationObserver=this.GS.onBeforeActiveMeshesEvaluationObservable.add((()=>{z.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.GS.onAfterActiveMeshesEvaluationObservable.add((()=>{z.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.GS.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.GS.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(q){q!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=q,q?(this._onBeforeRenderTargetsRenderObserver=this.GS.onBeforeRenderTargetsRenderObservable.add((()=>{z.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.GS.onAfterRenderTargetsRenderObservable.add((()=>{z.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.GS.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.GS.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(q){q!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=q,q?(this._onBeforeParticlesRenderingObserver=this.GS.onBeforeParticlesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.GS.onAfterParticlesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.GS.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.GS.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(q){q!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=q,this.GS.spriteManagers&&(q?(this._onBeforeSpritesRenderingObserver=this.GS.onBeforeSpritesRenderingObservable.add((()=>{z.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.GS.onAfterSpritesRenderingObservable.add((()=>{z.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.GS.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.GS.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(q){q!==this._capturePhysicsTime&&this.GS.onBeforePhysicsObservable&&(this._capturePhysicsTime=q,q?(this._onBeforePhysicsObserver=this.GS.onBeforePhysicsObservable.add((()=>{z.Tools.StartPerformanceCounter("nb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.GS.onAfterPhysicsObservable.add((()=>{z.Tools.EndPerformanceCounter("nb"),this._physicsTime.endMonitoring()}))):(this.GS.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.GS.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(q){q!==this._captureAnimationsTime&&(this._captureAnimationsTime=q,q?this._onAfterAnimationsObserver=this.GS.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.GS.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(q){this._captureFrameTime=q}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(q){this._captureInterFrameTime=q}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(q){q!==this._captureRenderTime&&(this._captureRenderTime=q,q?(this._onBeforeDrawPhaseObserver=this.GS.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),z.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.GS.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter("Main render")}))):(this.GS.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.GS.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(q){q!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=q,q?(this._onBeforeCameraRenderObserver=this.GS.onBeforeCameraRenderObservable.add((q=>{this._cameraRenderTime.beginMonitoring(),z.Tools.StartPerformanceCounter(`Rendering camera ${q.name}`)})),this._onAfterCameraRenderObserver=this.GS.onAfterCameraRenderObservable.add((q=>{this._cameraRenderTime.endMonitoring(!1),z.Tools.EndPerformanceCounter(`Rendering camera ${q.name}`)}))):(this.GS.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.GS.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.GS.getEngine()._drawCalls}constructor(q){this.GS=q,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new C.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new C.b,this._captureFrameTime=!1,this._frameTime=new C.b,this._captureRenderTime=!1,this._renderTime=new C.b,this._captureInterFrameTime=!1,this._interFrameTime=new C.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new C.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new C.b,this._capturePhysicsTime=!1,this._physicsTime=new C.b,this._captureAnimationsTime=!1,this._animationsTime=new C.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new C.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=q.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(z.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.GS.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=q.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(z.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ub(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ub(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ub(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ub(),this._captureRenderTime&&this._renderTime.Ub(),this._captureCameraRenderTime&&this._cameraRenderTime.Ub()}))}dispose(){this._disposed||(this.GS.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.GS.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.GS.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.GS.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.GS.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.GS.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.GS.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.GS.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.GS.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.GS.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.GS.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.GS.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.GS.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.GS.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.GS.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.GS.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.GS.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.GS=null,this._disposed=!0)}}},12815:(q,S,b)=>{"use strict";b.d(S,{b:()=>V});var z=b(11081),C=b(11090),v=b(11103),U=b(11523),g=b(11659),r=b(11711),I=b(11058);U.e.AddNodeConstructor("Light_Type_1",((q,S)=>()=>new V(q,v.yS.Zero(),S)));class V extends r.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(q){this._shadowFrustumSize=q,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(q){this._shadowOrthoScale=q,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(q){this._orthoLeft=q}get orthoRight(){return this._orthoRight}set orthoRight(q){this._orthoRight=q}get orthoTop(){return this._orthoTop}set orthoTop(q){this._orthoTop=q}get orthoBottom(){return this._orthoBottom}set orthoBottom(q){this._orthoBottom=q}constructor(q,S,b){super(q,b),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=S.scale(-1),this.direction=S}getClassName(){return"ob"}getTypeID(){return g.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(q,S,b){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(q):this._setDefaultAutoExtendShadowProjectionMatrix(q,S,b)}_setDefaultFixedFrustumShadowProjectionMatrix(q){const S=this.Tq().activeCamera;S&&v.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:S.kb,void 0!==this.shadowMaxZ?this.shadowMaxZ:S.maxZ,q,this.Tq().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(q,S,b){const z=this.Tq().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const q=v.yS.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let z=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let U=0;U<b.length;U++){const g=b[U];if(!g)continue;const r=g.getBoundingInfo().boundingBox;for(let b=0;b<r.vectorsWorld.length;b++)v.yS.TransformCoordinatesToRef(r.vectorsWorld[b],S,q),q.x<this._orthoLeft&&(this._orthoLeft=q.x),q.y<this._orthoBottom&&(this._orthoBottom=q.y),q.x>this._orthoRight&&(this._orthoRight=q.x),q.y>this._orthoTop&&(this._orthoTop=q.y),this.autoCalcShadowZBounds&&(q.z<z&&(z=q.z),q.z>C&&(C=q.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=z,this._shadowMaxZ=C)}const C=this._orthoRight-this._orthoLeft,U=this._orthoTop-this._orthoBottom,g=void 0!==this.shadowMinZ?this.shadowMinZ:(null===z||void 0===z?void 0:z.kb)||0,r=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===z||void 0===z?void 0:z.maxZ)||1e4,I=this.Tq().getEngine().useReverseDepthBuffer;v.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-C*this.shadowOrthoScale,this._orthoRight+C*this.shadowOrthoScale,this._orthoBottom-U*this.shadowOrthoScale,this._orthoTop+U*this.shadowOrthoScale,I?r:g,I?g:r,q,this.Tq().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,S){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,S),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,S),this)}transferToNodeMaterialEffect(q,S){return this.computeTransformedInformation()?(q.setFloat3(S,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(q.setFloat3(S,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(q){const S=this._scene.getEngine();return!S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:1}getDepthMaxZ(q){const S=this._scene.getEngine();return S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:1}prepareLightSpecificDefines(q,S){q["DIRLIGHT"+S]=!0}}(0,z.e)([(0,C.J)()],V.prototype,"shadowFrustumSize",null),(0,z.e)([(0,C.J)()],V.prototype,"shadowOrthoScale",null),(0,z.e)([(0,C.J)()],V.prototype,"autoUpdateExtends",void 0),(0,z.e)([(0,C.J)()],V.prototype,"autoCalcShadowZBounds",void 0),(0,z.e)([(0,C.J)("orthoLeft")],V.prototype,"_orthoLeft",void 0),(0,z.e)([(0,C.J)("orthoRight")],V.prototype,"_orthoRight",void 0),(0,z.e)([(0,C.J)("orthoTop")],V.prototype,"_orthoTop",void 0),(0,z.e)([(0,C.J)("orthoBottom")],V.prototype,"_orthoBottom",void 0),(0,I.f)("BABYLON.DirectionalLight",V)},13285:(q,S,b)=>{"use strict";b.d(S,{c:()=>V});var z=b(11081),C=b(11090),v=b(11103),U=b(11150),g=b(11523),r=b(11659),I=b(11058);g.e.AddNodeConstructor("Light_Type_3",((q,S)=>()=>new V(q,v.yS.Zero(),S)));class V extends r.b{constructor(q,S,b){super(q,b),this.groundColor=new U.HS(0,0,0),this.direction=S||v.yS.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"sb"}setDirectionToTarget(q){return this.direction=v.yS.Normalize(q.RS(v.yS.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(q,S){const b=v.yS.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",b.x,b.y,b.z,0,S),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.eb),S),this}transferToNodeMaterialEffect(q,S){const b=v.yS.Normalize(this.direction);return q.setFloat3(S,b.x,b.y,b.z),this}Nb(){return this._worldMatrix||(this._worldMatrix=v.Matrix.Identity()),this._worldMatrix}getTypeID(){return r.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(q,S){q["HEMILIGHT"+S]=!0}}(0,z.e)([(0,C.m)()],V.prototype,"groundColor",void 0),(0,z.e)([(0,C.F)()],V.prototype,"direction",void 0),(0,I.f)("BABYLON.HemisphericLight",V)},12784:(q,S,b)=>{"use strict";b.d(S,{b:()=>l});var z=b(11081),C=b(11090),v=b(11103),U=b(11523),g=b(11659),r=b(11711),I=b(11075),V=b(11058);U.e.AddNodeConstructor("Light_Type_2",((q,S)=>()=>new l(q,v.yS.Zero(),v.yS.Zero(),0,0,S)));class l extends r.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(q){this._iesProfileTexture!==q&&(this._iesProfileTexture=q,this._iesProfileTexture&&l._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(q){this._angle=q,this._cosHalfAngle=Math.cos(.5*q),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(q){this._innerAngle=q,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(q){this._shadowAngleScale=q,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(q){this._projectionTextureLightNear=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(q){this._projectionTextureLightFar=q,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(q){this._projectionTextureUpDirection=q,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(q){this._projectionTexture!==q&&(this._projectionTexture=q,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(l._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):l._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(q){return void 0!==q.onGeneratedObservable}static _IsTexture(q){return void 0!==q.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(q){this._projectionTextureProjectionLightMatrix=q,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(q,S,b,z,C,U){super(q,U),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=v.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=v.yS.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=v.yS.Zero(),this._projectionTextureViewLightMatrix=v.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=v.Matrix.Zero(),this._projectionTextureScalingMatrix=v.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=S,this.direction=b,this.angle=z,this.exponent=C}getClassName(){return"SpotLight"}getTypeID(){return g.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(q){super._setDirection(q),this._projectionTextureViewLightDirty=!0}_setPosition(q){super._setPosition(q),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(q,S,b){const z=this.Tq().activeCamera;if(!z)return;this._shadowAngleScale=this._shadowAngleScale||1;const C=this._shadowAngleScale*this._angle,U=void 0!==this.shadowMinZ?this.shadowMinZ:z.kb,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,r=this.Tq().getEngine().useReverseDepthBuffer;v.Matrix.PerspectiveFovLHToRef(C,1,r?g:U,r?U:g,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,r)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),v.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const q=this.projectionTextureLightFar,S=this.projectionTextureLightNear,b=q/(q-S),z=-b*S,C=1/Math.tan(this._angle/2);v.Matrix.FromValuesToRef(C/1,0,0,0,0,C,0,0,0,0,b,1,0,0,z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof I.e){const q=this._projectionTexture.uScale/2,S=this._projectionTexture.vScale/2;v.Matrix.FromValuesToRef(q,0,0,0,0,S,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(q,S){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),q.setMatrix("textureProjectionMatrix"+S,this._projectionTextureMatrix),q.setTexture("projectionLightTexture"+S,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&q.setTexture("iesLightTexture"+S,this._iesProfileTexture),this}transferToEffect(q,S){let b;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,S),b=v.yS.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,S),b=v.yS.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",b.x,b.y,b.z,this._cosHalfAngle,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,S),this}transferToNodeMaterialEffect(q,S){let b;return b=this.computeTransformedInformation()?v.yS.Normalize(this.transformedDirection):v.yS.Normalize(this.direction),this.Tq().useRightHandedSystem?q.setFloat3(S,-b.x,-b.y,-b.z):q.setFloat3(S,b.x,b.y,b.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(q){const S=this._scene.getEngine(),b=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.kb)??0;return S.useReverseDepthBuffer&&S.isNDCHalfZRange?b:this._scene.getEngine().isNDCHalfZRange?0:b}getDepthMaxZ(q){const S=this._scene.getEngine(),b=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)??1e4;return S.useReverseDepthBuffer&&S.isNDCHalfZRange?0:b}prepareLightSpecificDefines(q,S){q["SPOTLIGHT"+S]=!0,q["PROJECTEDLIGHTTEXTURE"+S]=!(!this.projectionTexture||!this.projectionTexture.isReady()),q["IESLIGHTTEXTURE"+S]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,z.e)([(0,C.J)()],l.prototype,"angle",null),(0,z.e)([(0,C.J)()],l.prototype,"innerAngle",null),(0,z.e)([(0,C.J)()],l.prototype,"shadowAngleScale",null),(0,z.e)([(0,C.J)()],l.prototype,"exponent",void 0),(0,z.e)([(0,C.J)()],l.prototype,"projectionTextureLightNear",null),(0,z.e)([(0,C.J)()],l.prototype,"projectionTextureLightFar",null),(0,z.e)([(0,C.J)()],l.prototype,"projectionTextureUpDirection",null),(0,z.e)([(0,C.x)("projectedLightTexture")],l.prototype,"_projectionTexture",void 0),(0,V.f)("BABYLON.SpotLight",l)},12489:(q,S,b)=>{"use strict";b.d(S,{b:()=>U,d:()=>v,g:()=>g});const z={},C={};function v(q,S){z[q]=S}function U(q,S){C[q]=S}function g(q){return C[q]?C[q]:null}},12372:(q,S,b)=>{"use strict";b.d(S,{d:()=>T,e:()=>K});var z,C=b(10921),v=b(10929),U=b(11339),g=b(10975),r=b(10943),I=b(11563),V=b(10977),l=b(10982),y=b(11060),R=b(11006),G=b(10966);!function(q){q[q.Clean=0]="Clean",q[q.Stop=1]="Stop",q[q.Sync=2]="Sync",q[q.NoSync=3]="NoSync"}(z||(z={}));const Z=new v.d,H={};let Q=!1;function k(){return H[".babylon"]}function W(q,S){const b=H[q];return b||(r.b.Warn("Unable to find a plugin to load "+q+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),S?k():void 0)}function N(q,S,b){let z="Unable to load from "+(q.rawData?"binary data":q.url);return S?z+=`: ${S}`:b&&(z+=`: ${b}`),z}async function u(q,S,b,z,C,v,U,g,r){var I;const l="data:"===(y=q.url).substring(0,5)?y.substring(5):null;var y;if(q.rawData&&!U)throw"When using ArrayBufferView to load data the file extension must be provided.";const Q=l||U?"":function(q){const S=q.indexOf("?");-1!==S&&(q=q.substring(0,S));const b=q.lastIndexOf(".");return q.substring(b,q.length).toLowerCase()}(q.url);let N=U?W(U,!0):l?function(q){for(const S in H){const b=H[S].plugin;if(b.canDirectLoad&&b.canDirectLoad(q))return H[S]}return k()}(q.url):W(Q,!1);if(!N&&Q){if(q.url&&!q.url.startsWith("blob:")){const S=await async function(q,S){const b=S.method||"GET";return await new Promise(((z,C)=>{const v=new G.c;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const q={};if(S.responseHeaders)for(const b of S.responseHeaders)q[b]=v.getResponseHeader(b)||"";z({response:v.response,headerValues:q})}else C(`Unable to fetch data from ${q}. Error code: ${v.status}`)})),v.open(b,q),v.send()}))}(q.url,{method:"HEAD",responseHeaders:["Content-Type"]}),b=S.headerValues?S.headerValues["Content-Type"]:"";b&&(N=function(q){for(const S in H){const b=H[S];if(b.mimeType===q)return b}}(b))}N||(N=k())}if(!N)throw new Error(`No plugin or fallback for ${U??q.url}`);if(!1===(null===r||void 0===r||null===(I=r[N.plugin.name])||void 0===I?void 0:I.enabled))throw new Error(`The '${N.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(q.rawData&&!N.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(q=>{if(N.plugin.createPlugin){const S=N.plugin.createPlugin(r??{});return S instanceof Promise?(S.then(q).catch((q=>{C("Error instantiating plugin.",q)})),null):(q(S),S)}return q(N.plugin),N.plugin})((r=>{var I;if(!r)throw`The loader plugin corresponding to the '${U}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Z.notifyObservers(r),l&&(r.canDirectLoad&&r.canDirectLoad(q.url)||!(0,V.j)(q.url))){if(r.directLoad){const q=r.directLoad(S,l);q instanceof Promise?q.then((q=>{b(r,q)})).catch((q=>{C("Error in directLoad of _loadData: "+q,q)})):b(r,q)}else b(r,l);return}const y=N.isBinary,G=(q,z)=>{S.V?C("Scene has been disposed"):b(r,q,z)};let H=null,Q=!1;null===(I=r.gb)||void 0===I||I.add((()=>{Q=!0,H&&(H.abort(),H=null),v()}));const k=()=>{if(Q)return;const b=(q,S)=>{C(null===q||void 0===q?void 0:q.statusText,S)};if(!r.loadFile&&q.rawData)throw"Plugin does not support loading ArrayBufferView.";H=r.loadFile?r.loadFile(S,q.rawData||q.file||q.url,q.rootUrl,G,z,y,b,g):S._loadFile(q.file||q.url,G,z,!0,y,b)},W=S.getEngine();let u=W.enableOfflineSupport;if(u){let b=!1;for(const z of S.disableOfflineSupportExceptionRules)if(z.test(q.url)){b=!0;break}u=!b}u&&R.c.OfflineProviderFactory?S.offlineProvider=R.c.OfflineProviderFactory(q.url,k,W.disableManifestCheck):k()}))}function X(q,S){let b,z,v=null,U=null;if(S)if(S.name)b=`file:${S.name}`,z=S.name,v=S;else if(ArrayBuffer.isView(S))b="",z=(0,y.d)(),U=S;else if(S.startsWith("data:"))b=S,z="";else if(q){const v=S;if("/"===v.substring(0,1))return C.Tools.Error("Wrong sceneFilename parameter"),null;b=q+v,z=v}else b=S,z=C.Tools.GetFilename(S),q=C.Tools.GetFolderPath(S);else b=q,z=C.Tools.GetFilename(q),q=C.Tools.GetFolderPath(q);return{url:b,rootUrl:q,name:z,file:v,rawData:U}}function T(q){if("string"===typeof q.extensions){const S=q.extensions;H[S.toLowerCase()]={plugin:q,isBinary:!1}}else{const S=q.extensions,b=Object.keys(S);for(const z of b)H[z.toLowerCase()]={plugin:q,isBinary:S[z].isBinary,mimeType:S[z].mimeType}}}async function B(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.b.LastCreatedScene,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!z)return r.b.Error("No scene available to import mesh to"),null;const R=X(S,b);if(!R)return null;const G={};z.addPendingData(G);const Z=()=>{z.removePendingData(G)},H=(q,S)=>{const b=N(R,q,S);U?U(z,b,new l.j(b,l.f.SceneLoaderError,S)):r.b.Error(b),Z()},Q=v?q=>{try{v(q)}catch(S){H("Error in onProgress callback: "+S,S)}}:void 0,k=(q,S,b,v,U,g,r,I)=>{if(z.importedMeshesFiles.push(R.url),C)try{C(q,S,b,v,U,g,r,I)}catch(V){H("Error in onSuccess callback: "+V,V)}z.removePendingData(G)};return await u(R,z,((S,b,C)=>{if(S.rewriteRootURL&&(R.rootUrl=S.rewriteRootURL(R.rootUrl,C)),S.importMesh){const C=[],v=[],U=[];if(!S.importMesh(q,z,b,R.rootUrl,C,v,U,H))return;z.loadingPluginName=S.name,k(C,v,U,[],[],[],[],[])}else{S.importMeshAsync(q,z,b,R.rootUrl,Q,R.name).then((q=>{z.loadingPluginName=S.name,k(q.meshes,q.Gy,q.skeletons,q.animationGroups,q.transformNodes,q.geometries,q.lights,q.spriteManagers)})).catch((q=>{H(q.message,q)}))}}),Q,H,Z,I,V,y)}async function t(q,S,b,z,C,v,U,g){return await new Promise(((r,I)=>{try{B(q,S,b,z,((q,S,b,z,C,v,U,g)=>{r({meshes:q,Gy:S,skeletons:b,animationGroups:z,transformNodes:C,geometries:v,lights:U,spriteManagers:g})}),C,((q,S,b)=>{I(b||new Error(S))}),v,U,g).catch(I)}catch(l){I(l)}}))}async function f(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.b.LastCreatedEngine,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};b?await E(q,S,new U.c(b),z,v,r,I,V,l):C.Tools.Error("No engine available")}async function m(q,S,b,z,C,v,U){return await new Promise(((g,r)=>{f(q,S,b,(q=>{g(q)}),z,((q,S,b)=>{r(b||new Error(S))}),C,v,U)}))}async function E(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return r.b.Error("No scene available to append to"),null;const R=X(q,S);if(!R)return null;const G={};b.addPendingData(G);const Z=()=>{b.removePendingData(G)};I.c.ShowLoadingScreen&&!Q&&(Q=!0,b.getEngine().displayLoadingUI(),b.executeWhenReady((()=>{b.getEngine().hideLoadingUI(),Q=!1})));const H=(q,S)=>{const z=N(R,q,S);v?v(b,z,new l.j(z,l.f.SceneLoaderError,S)):r.b.Error(z),Z()},k=C?q=>{try{C(q)}catch(S){H("Error in onProgress callback",S)}}:void 0,W=()=>{if(z)try{z(b)}catch(q){H("Error in onSuccess callback",q)}b.removePendingData(G)};return await u(R,b,((q,S)=>{if(q.load){if(!q.load(b,S,R.rootUrl,H))return;b.loadingPluginName=q.name,W()}else{q.loadAsync(b,S,R.rootUrl,k,R.name).then((()=>{b.loadingPluginName=q.name,W()})).catch((q=>{H(q.message,q)}))}}),k,H,Z,U,V,y)}async function e(q,S,b,z,C,v,U){return await new Promise(((g,r)=>{try{E(q,S,b,(q=>{g(q)}),z,((q,S,b)=>{r(b||new Error(S))}),C,v,U).catch(r)}catch(l){r(l)}}))}async function i(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!b)return r.b.Error("No scene available to load asset container to"),null;const y=X(q,S);if(!y)return null;const R={};b.addPendingData(R);const G=()=>{b.removePendingData(R)},Z=(q,S)=>{const z=N(y,q,S);v?v(b,z,new l.j(z,l.f.SceneLoaderError,S)):r.b.Error(z),G()},H=C?q=>{try{C(q)}catch(S){Z("Error in onProgress callback",S)}}:void 0,Q=q=>{if(z)try{z(q)}catch(S){Z("Error in onSuccess callback",S)}b.removePendingData(R)};return await u(y,b,((q,S)=>{if(q.loadAssetContainer){const z=q.loadAssetContainer(b,S,y.rootUrl,Z);if(!z)return;z.populateRootNodes(),b.loadingPluginName=q.name,Q(z)}else if(q.loadAssetContainerAsync){q.loadAssetContainerAsync(b,S,y.rootUrl,H,y.name).then((S=>{S.populateRootNodes(),b.loadingPluginName=q.name,Q(S)})).catch((q=>{Z(q.message,q)}))}else Z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),H,Z,G,U,I,V)}async function J(q,S,b,z,C,v,U){return await new Promise(((g,r)=>{try{i(q,S,b,(q=>{g(q)}),z,((q,S,b)=>{r(b||new Error(S))}),C,v,U).catch(r)}catch(l){r(l)}}))}async function L(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.b.LastCreatedScene,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!b)return void r.b.Error("No scene available to load animations to");if(z){for(const z of b.animatables)z.reset();b.stopAllAnimations();const q=b.animationGroups.slice();for(const b of q)b.dispose();const S=b.getNodes();for(const b of S)b.animations&&(b.animations=[])}else switch(C){case 0:const q=b.animationGroups.slice();for(const S of q)S.dispose();break;case 1:for(const S of b.animationGroups)S.stop();break;case 2:for(const S of b.animationGroups)S.reset(),S.restart();break;case 3:break;default:return void r.b.Error("Unknown animation group loading mode value '"+C+"'")}const G=b.animatables.length;await i(q,S,b,(q=>{q.mergeAnimationsTo(b,b.animatables.slice(G),v),q.dispose(),b.onAnimationFileImportedObservable.notifyObservers(b),U&&U(b)}),I,V,l,y,R)}async function d(q,S,b,z,C,v,U,g,r,I){return await new Promise(((V,y)=>{try{L(q,S,b,z,C,v,(q=>{V(q)}),U,((q,S,b)=>{y(b||new Error(S))}),g,r,I).catch(y)}catch(l){y(l)}}))}class K{static get ForceFullSceneLoadingForIncremental(){return I.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){I.c.ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return I.c.ShowLoadingScreen}static set ShowLoadingScreen(q){I.c.ShowLoadingScreen=q}static get loggingLevel(){return I.c.loggingLevel}static set loggingLevel(q){I.c.loggingLevel=q}static get CleanBoneMatrixWeights(){return I.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){I.c.CleanBoneMatrixWeights=q}static GetDefaultPlugin(){return k()}static GetPluginForExtension(q){var S;return null===(S=W(q,!0))||void 0===S?void 0:S.plugin}static IsPluginForExtensionAvailable(q){return function(q){return!!H[q]}(q)}static RegisterPlugin(q){T(q)}static ImportMesh(q,S,b,z,C,v,U,r,I){B(q,S,b,z,C,v,U,r,I).catch((q=>null===U||void 0===U?void 0:U(g.b.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportMeshAsync(q,S,b,z,C,v,U){return await t(q,S,b,z,C,v,U)}static Load(q,S,b,z,C,v,U,r){f(q,S,b,z,C,v,U,r).catch((q=>null===v||void 0===v?void 0:v(g.b.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAsync(q,S,b,z,C,v){return await m(q,S,b,z,C,v)}static Append(q,S,b,z,C,v,U,r){E(q,S,b,z,C,v,U,r).catch((q=>null===v||void 0===v?void 0:v(b??g.b.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async AppendAsync(q,S,b,z,C,v){return await e(q,S,b,z,C,v)}static LoadAssetContainer(q,S,b,z,C,v,U,r){i(q,S,b,z,C,v,U,r).catch((q=>null===v||void 0===v?void 0:v(b??g.b.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async LoadAssetContainerAsync(q,S,b,z,C,v){return await J(q,S,b,z,C,v)}static ImportAnimations(q,S,b,z,C,v,U,r,I,V,l){L(q,S,b,z,C,v,U,r,I,V,l).catch((q=>null===I||void 0===I?void 0:I(b??g.b.LastCreatedScene,null===q||void 0===q?void 0:q.message,q)))}static async ImportAnimationsAsync(q,S,b,z,C,v,U,g,r,I,V){return await d(q,S,b,z,C,v,g,I,V)}}K.NO_LOGGING=0,K.MINIMAL_LOGGING=1,K.SUMMARY_LOGGING=2,K.DETAILED_LOGGING=3,K.OnPluginActivatedObservable=Z},12799:(q,S,b)=>{"use strict";b.d(S,{e:()=>y});var z=b(11081),C=b(11090),v=b(10921),U=b(11103),g=b(11128),r=b(11075),I=b(11058),V=b(10929),l=b(11137);b(12801);class y extends g.d{set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const S=this.Tq();S&&S.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(q){this._rotationY=q,this.setReflectionTextureMatrix(U.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(q,S,b){let z="";for(const C of q)z+=C;return new y(z,S,null,b,q)}static CreateFromPrefilteredData(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=S.useDelayedTextureLoading;S.useDelayedTextureLoading=!1;const v=new y(q,S,null,!1,null,null,null,void 0,!0,b,z);return S.useDelayedTextureLoading=C,v}constructor(q,S){var b;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,H=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Q=arguments.length>13?arguments[13]:void 0,k=arguments.length>14?arguments[14]:void 0;super(S),this.onLoadObservable=new V.d,this.boundingBoxPosition=U.yS.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new U.Matrix,this._buffer=null,this.name=q,this.url=q,this._noMipmap=C,this.Qb=!1,this.isCube=!0,this._textureMatrix=U.Matrix.Identity(),this.coordinatesMode=r.e.CUBIC_MODE;let W=null,N=null;null===z||Array.isArray(z)?(this._noMipmap=C,this._format=l,this._createPolynomials=G,W=z,this._loaderOptions=Q,this._useSRGBBuffer=k,this._lodScale=Z,this._lodOffset=H):(W=z.extensions??null,this._noMipmap=z.noMipmap??!1,v=z.files??null,N=z.buffer??null,this._format=z.format??5,y=z.prefiltered??!1,R=z.forcedExtension??null,this._createPolynomials=z.createPolynomials??!1,this._lodScale=z.lodScale??.8,this._lodOffset=z.lodOffset??0,this._loaderOptions=z.loaderOptions,this._useSRGBBuffer=z.useSRGBBuffer,g=z.M??null,I=z.onError??null),(q||v)&&this.updateURL(q,R,g,y,I,W,null===(b=this.Tq())||void 0===b?void 0:b.useDelayedTextureLoading,v,N)}getClassName(){return"CubeTexture"}updateURL(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,S&&(this._forcedExtension=S);const I=q.lastIndexOf("."),V=S||(I>-1?q.substring(I).toLowerCase():""),l=0===V.indexOf(".dds"),y=0===V.indexOf(".env"),R=0===V.indexOf(".basis");if(y?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=z,z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),g)this._files=g;else if(R||y||l||v||(v=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,v){for(let S=0;S<v.length;S++)this._files.push(q+v[S]);this._extensions=v}this._buffer=r,U?(this.delayLoadState=4,this._delayedOnLoad=b,this._delayedOnError=C):this._loadTexture(b,C)}delayLoad(q){4===this.delayLoadState&&(q&&(this._forcedExtension=q),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(q){var S,b;if(q.updateFlag===this._textureMatrix.updateFlag)return;q.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(b=this.Tq())||void 0===b||b.markAllMaterialsAsDirty(1,(q=>-1!==q.getActiveTextures().indexOf(this))));if(this._textureMatrix=q,null===(S=this.Tq())||void 0===S||!S.useRightHandedSystem)return;const z=U.TmpVectors.yS[0],C=U.TmpVectors.Quaternion[0],v=U.TmpVectors.yS[1];this._textureMatrix.decompose(z,C,v),C.z*=-1,C.w*=-1,U.Matrix.ComposeToRef(z,C,v,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var q;return null!==(q=this.Tq())&&void 0!==q&&q.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this.Tq(),z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const C=()=>{var S;(this.onLoadObservable.notifyObservers(this),z)&&(z.dispose(),null===(S=this.Tq())||void 0===S||S.markAllMaterialsAsDirty(1));q&&q()},U=(q,b)=>{this._loadingError=!0,this._errorObject={message:q,exception:b},S&&S(q,b),r.e.OnTextureLoadErrorObservable.notifyObservers(this)};var g;this._texture?this._texture.isReady?v.Tools.SetImmediate((()=>C())):this._texture.onLoadedObservable.add((()=>C())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,b,this._lodScale,this._lodOffset,q,U,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,b,this._files,this._noMipmap,q,U,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(g=this._texture)||void 0===g||g.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(q,S,b){const z=l.b.Parse((()=>{let z=!1;return q.prefiltered&&(z=q.prefiltered),new y(b+(q.url??q.name),S,q.extensions,!1,q.files||null,null,null,void 0,z,q.forcedExtension)}),q,S);if(q.boundingBoxPosition&&(z.boundingBoxPosition=U.yS.Hb(q.boundingBoxPosition)),q.boundingBoxSize&&(z.boundingBoxSize=U.yS.Hb(q.boundingBoxSize)),q.animations)for(let C=0;C<q.animations.length;C++){const S=q.animations[C],b=(0,I.c)("BABYLON.Animation");b&&z.animations.push(b.Parse(S))}return z}clone(){let q=0;const S=l.b.Clone((()=>{const S=new y(this.url,this.Tq()||this._getEngine(),this._extensions,this._noMipmap,this._files);return q=S.uniqueId,S}),this);return S.uniqueId=q,S}}(0,z.e)([(0,C.J)()],y.prototype,"url",void 0),(0,z.e)([(0,C.F)()],y.prototype,"boundingBoxPosition",void 0),(0,z.e)([(0,C.F)()],y.prototype,"boundingBoxSize",null),(0,z.e)([(0,C.J)("rotationY")],y.prototype,"rotationY",null),(0,z.e)([(0,C.J)("files")],y.prototype,"_files",void 0),(0,z.e)([(0,C.J)("forcedExtension")],y.prototype,"_forcedExtension",void 0),(0,z.e)([(0,C.J)("extensions")],y.prototype,"_extensions",void 0),(0,z.e)([(0,C.t)("textureMatrix")],y.prototype,"_textureMatrix",void 0),(0,z.e)([(0,C.t)("textureMatrixRefraction")],y.prototype,"_textureMatrixRefraction",void 0),r.e._CubeTextureParser=y.Parse,(0,I.f)("BABYLON.CubeTexture",y)},13294:(q,S,b)=>{"use strict";b.d(S,{b:()=>r});var z=b(10943),C=b(11075),v=b(11064),U=b(11239),g=b(11033);U.ThinEngine.prototype.createDynamicTexture=function(q,S,b,z){const C=new g.d(this,4);return C.baseWidth=q,C.baseHeight=S,b&&(q=this.needPOTTextures?(0,v.g)(q,this._caps.maxTextureSize):q,S=this.needPOTTextures?(0,v.g)(S,this._caps.maxTextureSize):S),C.width=q,C.height=S,C.isReady=!1,C.generateMipMaps=b,C.samplingMode=z,this.updateTextureSamplingMode(z,C),this._internalTexturesCache.push(C),C},U.ThinEngine.prototype.updateDynamicTexture=function(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!q)return;const U=this._gl,g=U.TEXTURE_2D,r=this._bindTextureDirectly(g,q,!0,v);this._unpackFlipY(void 0===b?q.invertY:b),z&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const I=this._getWebGLTextureType(q.type),V=this._getInternalFormat(C||q.format),l=this._getRGBABufferInternalSizedFormat(q.type,V);U.texImage2D(g,0,l,V,I,S),q.generateMipMaps&&U.generateMipmap(g),r||this._bindTextureDirectly(g,null),z&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),C&&(q.format=C),q._dynamicTextureSource=S,q._premulAlpha=z,q.invertY=b||!1,q.isReady=!0};class r extends C.e{constructor(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,g=arguments.length>6?arguments[6]:void 0;const r=!b||b._isScene;super(null,r?b:null===b||void 0===b?void 0:b.GS,r?!z:b,g,v,void 0,void 0,void 0,void 0,U),this.name=q,this.wrapU=C.e.CLAMP_ADDRESSMODE,this.wrapV=C.e.CLAMP_ADDRESSMODE,this._generateMipMaps=z;const I=this._getEngine();if(!I)return;if(S.getContext)this._canvas=S,this._ownCanvas=!1,this._texture=I.createDynamicTexture(this._canvas.width,this._canvas.height,z,v);else{this._canvas=I.createCanvas(1,1),this._ownCanvas=!0;const q=S;q.width||0===q.width?this._texture=I.createDynamicTexture(q.width,q.height,z,v):this._texture=I.createDynamicTexture(S,S,z,v)}const V=this.getSize();this._canvas.width!==V.width&&(this._canvas.width=V.width),this._canvas.height!==V.height&&(this._canvas.height=V.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(q){this._canvas.width=q.width,this._canvas.height=q.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(q.width,q.height,this._generateMipMaps,this.samplingMode)}scale(q){const S=this.getSize();S.width*=q,S.height*=q,this._recreate(S)}scaleTo(q,S){const b=this.getSize();b.width=q,b.height=S,this._recreate(b)}getContext(){return this._context}clear(q){const S=this.getSize();q&&(this._context.fillStyle=q),this._context.clearRect(0,0,S.width,S.height)}update(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===q||q,S,this._format||void 0,void 0,b)}drawText(q,S,b,z,C,v,U){let g=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const r=this.getSize();if(v&&(this._context.fillStyle=v,this._context.fillRect(0,0,r.width,r.height)),this._context.font=z,null===S||void 0===S){const b=this._context.measureText(q);S=(r.width-b.width)/2}if(null===b||void 0===b){const q=parseInt(z.replace(/\D/g,""));b=r.height/2+q/3.65}this._context.fillStyle=C||"",this._context.fillText(q,S,b),g&&this.update(U)}dispose(){var q,S;(super.dispose(),this._ownCanvas)&&(null===(q=this._canvas)||void 0===q||null===(S=q.remove)||void 0===S||S.call(q));this._canvas=null,this._context=null}clone(){const q=this.Tq();if(!q)return this;const S=this.getSize(),b=new r(this.name,S,q,this._generateMipMaps);return b.Qb=this.Qb,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b}serialize(){const q=this.Tq();q&&!q.isReady()&&z.b.Warn("The scene must be ready before serializing the dynamic texture");const S=super.serialize();return r._IsCanvasElement(this._canvas)&&(S.base64String=this._canvas.toDataURL()),S.invertY=this._invertY,S.samplingMode=this.samplingMode,S}static _IsCanvasElement(q){return void 0!==q.toDataURL}_rebuild(){this.update()}}},12701:(q,S,b)=>{"use strict";b.d(S,{b:()=>C});var z=b(11075);class C extends z.e{get depth(){return this._depth}constructor(q,S,b,C,v,U){let g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:z.e.TRILINEAR_SAMPLINGMODE,V=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10?arguments[10]:void 0;super(null,U,!g,r),this.format=v,this._texture=U.getEngine().createRawTexture2DArray(q,S,b,C,v,g,r,I,null,V,l),this._depth=C,this.is2DArray=!0}update(q){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(q,S,b,z,v){return new C(q,S,b,z,5,v,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12504:(q,S,b)=>{"use strict";b.d(S,{e:()=>g,g:()=>r,h:()=>v,i:()=>U});var z=b(11121),C=b(11103);function v(q,S){return`{X: ${q.x.toFixed(S)} Y: ${q.y.toFixed(S)}}`}function U(q,S){return`{X: ${q._x.toFixed(S)} Y: ${q._y.toFixed(S)} Z: ${q._z.toFixed(S)}}`}function g(q,S){return 2*Math.acos((0,z.Clamp)(C.Quaternion.Dot(q,S)))}function r(q,S){const b=new C.Quaternion;return function(q,S,b){const v=C.yS.Cross(q,S),U=Math.acos((0,z.Clamp)(C.yS.Dot(q,S),-1,1));C.Quaternion.RotationAxisToRef(v,U,b)}(q,S,b),b}},12327:(q,S,b)=>{"use strict";b.d(S,{e:()=>I});var z=b(11103),C=b(11150),v=b(11555),U=b(11535),g=b(11160);b(12330);function r(q){let S=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],v=[];let r=[];const I=q.width||q.size||1,V=q.height||q.size||1,l=q.depth||q.size||1,y=q.wrap||!1;let R=void 0===q.topBaseAt?1:q.topBaseAt,G=void 0===q.bottomBaseAt?0:q.bottomBaseAt;R=(R+4)%4,G=(G+4)%4;let Z=[2,0,3,1][R],H=[2,0,1,3][G],Q=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(y){S=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Q=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let q=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],b=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const z=[17,18,19,16],C=[22,23,20,21];for(;Z>0;)q.unshift(q.pop()),z.unshift(z.pop()),Z--;for(;H>0;)b.unshift(b.pop()),C.unshift(C.pop()),H--;q=q.flat(),b=b.flat(),Q=Q.concat(q).concat(b),S.push(z[0],z[2],z[3],z[0],z[1],z[2]),S.push(C[0],C[2],C[3],C[0],C[1],C[2])}const k=[I/2,V/2,l/2];r=Q.reduce(((q,S,b)=>q.concat(S*k[b%3])),[]);const W=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,N=q.faceUV||new Array(6),u=q.faceColors,X=[];for(let U=0;U<6;U++)void 0===N[U]&&(N[U]=new z.Vector4(0,0,1,1)),u&&void 0===u[U]&&(u[U]=new C.b(1,1,1,1));for(let z=0;z<6;z++)if(v.push(N[z].z,g.e?1-N[z].w:N[z].w),v.push(N[z].x,g.e?1-N[z].w:N[z].w),v.push(N[z].x,g.e?1-N[z].y:N[z].y),v.push(N[z].z,g.e?1-N[z].y:N[z].y),u)for(let q=0;q<4;q++)X.push(u[z].r,u[z].g,u[z].b,u[z].a);U.c._ComputeSides(W,r,S,b,v,q.frontUVs,q.backUVs);const T=new U.c;if(T.indices=S,T.tq=r,T.fq=b,T.Eq=v,u){const q=W===U.c.DOUBLESIDE?X.concat(X):X;T.mq=q}return T}function I(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.d(q,b);S.sideOrientation=v.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return r(S).iq(z,S.updatable),z}U.c.CreateBox=r,v.d.CreateBox=function(q,S){return I(q,{size:S,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12492:(q,S,b)=>{"use strict";b.d(S,{c:()=>g});var z=b(11555),C=b(11535),v=b(11160);function U(q){const S=[],b=[],z=[],U=[],g=q.radius||.5,r=q.tessellation||64,I=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,V=0===q.sideOrientation?0:q.sideOrientation||C.c.DEFAULTSIDE;S.push(0,0,0),U.push(.5,.5);const l=2*Math.PI*I,y=1===I?l/r:l/(r-1);let R=0;for(let C=0;C<r;C++){const q=Math.cos(R),b=Math.sin(R),z=(q+1)/2,C=(1-b)/2;S.push(g*q,g*b,0),U.push(z,v.e?1-C:C),R+=y}1===I&&(S.push(S[3],S[4],S[5]),U.push(U[2],v.e?1-U[3]:U[3]));const G=S.length/3;for(let C=1;C<G-1;C++)b.push(C+1,0,C);C.c.ComputeNormals(S,b,z),C.c._ComputeSides(V,S,b,z,U,q.frontUVs,q.backUVs);const Z=new C.c;return Z.indices=b,Z.tq=S,Z.fq=z,Z.Eq=U,Z}function g(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.d(q,b);S.sideOrientation=z.d._GetDefaultSideOrientation(S.sideOrientation),C._originalBuilderSideOrientation=S.sideOrientation;return U(S).iq(C,S.updatable),C}C.c.CreateDisc=U,z.d.CreateDisc=function(q,S,b){return g(q,{radius:S,tessellation:b,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12330:(q,S,b)=>{"use strict";b.d(S,{c:()=>H,b:()=>k,d:()=>Q});var z=b(11103),C=b(11150),v=b(11555),U=b(11535),g=b(11172);v.d._GroundMeshParser=(q,S)=>r.Parse(q,S);class r extends v.d{constructor(q,S){super(q,S),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=q,this._subdivisionsY=q,this.subdivide(q);const b=this;b.createOrUpdateSubmeshesOctree&&b.createOrUpdateSubmeshesOctree(S)}getHeightAtCoordinates(q,S){const b=this.getWorldMatrix(),C=z.TmpVectors.Matrix[5];b.invertToRef(C);const v=z.TmpVectors.yS[8];if(z.yS.TransformCoordinatesFromFloatsToRef(q,0,S,C,v),q=v.x,S=v.z,q<this._minX||q>=this._maxX||S<=this._minZ||S>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(q,S),g=-(U.x*q+U.z*S+U.w)/U.y;return z.yS.TransformCoordinatesFromFloatsToRef(0,g,0,b,v),v.y}getNormalAtCoordinates(q,S){const b=new z.yS(0,1,0);return this.getNormalAtCoordinatesToRef(q,S,b),b}getNormalAtCoordinatesToRef(q,S,b){const C=this.getWorldMatrix(),v=z.TmpVectors.Matrix[5];C.invertToRef(v);const U=z.TmpVectors.yS[8];if(z.yS.TransformCoordinatesFromFloatsToRef(q,0,S,v,U),q=U.x,S=U.z,q<this._minX||q>this._maxX||S<this._minZ||S>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(q,S);return z.yS.TransformNormalFromFloatsToRef(g.x,g.y,g.z,C,b),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(q,S){const b=Math.floor((q+this._maxX)*this._subdivisionsX/this._width),z=Math.floor(-(S+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),C=this._heightQuads[z*this._subdivisionsX+b];let v;return v=S<C.slope.x*q+C.slope.y?C.facet1:C.facet2,v}_initHeightQuads(){const q=this._subdivisionsX,S=this._subdivisionsY;this._heightQuads=[];for(let b=0;b<S;b++)for(let S=0;S<q;S++){const C={slope:z.Vector2.Zero(),facet1:new z.Vector4(0,0,0,0),facet2:new z.Vector4(0,0,0,0)};this._heightQuads[b*q+S]=C}return this}_computeHeightQuads(){const q=this.getVerticesData(g.f.PositionKind);if(!q)return this;const S=z.TmpVectors.yS[3],b=z.TmpVectors.yS[2],C=z.TmpVectors.yS[1],v=z.TmpVectors.yS[0],U=z.TmpVectors.yS[4],r=z.TmpVectors.yS[5],I=z.TmpVectors.yS[6],V=z.TmpVectors.yS[7],l=z.TmpVectors.yS[8];let y=0,R=0,G=0,Z=0,H=0,Q=0,k=0;const W=this._subdivisionsX,N=this._subdivisionsY;for(let g=0;g<N;g++)for(let N=0;N<W;N++){y=3*N,R=g*(W+1)*3,G=(g+1)*(W+1)*3,S.x=q[R+y],S.y=q[R+y+1],S.z=q[R+y+2],b.x=q[R+y+3],b.y=q[R+y+4],b.z=q[R+y+5],C.x=q[G+y],C.y=q[G+y+1],C.z=q[G+y+2],v.x=q[G+y+3],v.y=q[G+y+4],v.z=q[G+y+5],Z=(v.z-S.z)/(v.x-S.x),H=S.z-Z*S.x,b.subtractToRef(S,U),C.subtractToRef(S,r),v.subtractToRef(S,I),z.yS.CrossToRef(I,r,V),z.yS.CrossToRef(U,I,l),V.normalize(),l.normalize(),Q=-(V.x*S.x+V.y*S.y+V.z*S.z),k=-(l.x*b.x+l.y*b.y+l.z*b.z);const u=this._heightQuads[g*W+N];u.slope.Bb(Z,H),u.facet1.Bb(V.x,V.y,V.z,Q),u.facet2.Bb(l.x,l.y,l.z,k)}return this}serialize(q){super.serialize(q),q.subdivisionsX=this._subdivisionsX,q.subdivisionsY=this._subdivisionsY,q.minX=this._minX,q.maxX=this._maxX,q.kb=this._minZ,q.maxZ=this._maxZ,q.width=this._width,q.height=this._height}static Parse(q,S){const b=new r(q.name,S);return b._subdivisionsX=q.subdivisionsX||1,b._subdivisionsY=q.subdivisionsY||1,b._minX=q.minX,b._maxX=q.maxX,b._minZ=q.kb,b._maxZ=q.maxZ,b._width=q.width,b._height=q.height,b}}var I=b(10921),V=b(10975),l=b(11109),y=b(11160);function R(q){const S=[],b=[],C=[],v=[];let g,r;const I=q.width||q.size||1,V=q.height||q.size||1,l=0|(q.subdivisionsX||q.subdivisions||1),R=0|(q.subdivisionsY||q.subdivisions||1);for(g=0;g<=R;g++)for(r=0;r<=l;r++){const q=new z.yS(r*I/l-I/2,0,(R-g)*V/R-V/2),S=new z.yS(0,1,0);b.push(q.x,q.y,q.z),C.push(S.x,S.y,S.z),v.push(r/l,y.e?g/R:1-g/R)}for(g=0;g<R;g++)for(r=0;r<l;r++)S.push(r+1+(g+1)*(l+1)),S.push(r+1+g*(l+1)),S.push(r+g*(l+1)),S.push(r+(g+1)*(l+1)),S.push(r+1+(g+1)*(l+1)),S.push(r+g*(l+1));const G=new U.c;return G.indices=S,G.tq=b,G.fq=C,G.Eq=v,G}function G(q){const S=void 0!==q.xmin&&null!==q.xmin?q.xmin:-1,b=void 0!==q.zmin&&null!==q.zmin?q.zmin:-1,C=void 0!==q.xmax&&null!==q.xmax?q.xmax:1,v=void 0!==q.zmax&&null!==q.zmax?q.zmax:1,g=q.subdivisions||{w:1,h:1},r=q.precision||{w:1,h:1},I=[],V=[],l=[],y=[];let R,G,Z,H;g.h=g.h<1?1:g.h,g.w=g.w<1?1:g.w,r.w=r.w<1?1:r.w,r.h=r.h<1?1:r.h;const Q=(C-S)/g.w,k=(v-b)/g.h;function W(q,S,b,C){const v=V.length/3,U=r.w+1;for(R=0;R<r.h;R++)for(G=0;G<r.w;G++){const q=[v+G+R*U,v+(G+1)+R*U,v+(G+1)+(R+1)*U,v+G+(R+1)*U];I.push(q[1]),I.push(q[2]),I.push(q[3]),I.push(q[0]),I.push(q[1]),I.push(q[3])}const g=z.yS.Zero(),Z=new z.yS(0,1,0);for(R=0;R<=r.h;R++)for(g.z=R*(C-S)/r.h+S,G=0;G<=r.w;G++)g.x=G*(b-q)/r.w+q,g.y=0,V.push(g.x,g.y,g.z),l.push(Z.x,Z.y,Z.z),y.push(G/r.w,R/r.h)}for(Z=0;Z<g.h;Z++)for(H=0;H<g.w;H++)W(S+H*Q,b+Z*k,S+(H+1)*Q,b+(Z+1)*k);const N=new U.c;return N.indices=I,N.tq=V,N.fq=l,N.Eq=y,N}function Z(q){const S=[],b=[],v=[],g=[];let r,I;const V=q.colorFilter||new C.HS(.3,.59,.11),y=q.alphaFilter||0;let R=!1;if(q.minHeight>q.maxHeight){R=!0;const S=q.maxHeight;q.maxHeight=q.minHeight,q.minHeight=S}for(r=0;r<=q.subdivisions;r++)for(I=0;I<=q.subdivisions;I++){const S=new z.yS(I*q.width/q.subdivisions-q.width/2,0,(q.subdivisions-r)*q.height/q.subdivisions-q.height/2),C=4*(((S.x+q.width/2)/q.width*(q.bufferWidth-1)|0)+((1-(S.z+q.height/2)/q.height)*(q.bufferHeight-1)|0)*q.bufferWidth);let U=q.buffer[C]/255,G=q.buffer[C+1]/255,Z=q.buffer[C+2]/255;const H=q.buffer[C+3]/255;R&&(U=1-U,G=1-G,Z=1-Z);const Q=U*V.r+G*V.g+Z*V.b;S.y=H>=y?q.minHeight+(q.maxHeight-q.minHeight)*Q:q.minHeight-l.d,q.heightBuffer&&(q.heightBuffer[r*(q.subdivisions+1)+I]=S.y),b.push(S.x,S.y,S.z),v.push(0,0,0),g.push(I/q.subdivisions,1-r/q.subdivisions)}for(r=0;r<q.subdivisions;r++)for(I=0;I<q.subdivisions;I++){const z=I+1+(r+1)*(q.subdivisions+1),C=I+1+r*(q.subdivisions+1),v=I+r*(q.subdivisions+1),U=I+(r+1)*(q.subdivisions+1),g=b[3*z+1]>=q.minHeight,V=b[3*C+1]>=q.minHeight,l=b[3*v+1]>=q.minHeight;g&&V&&l&&(S.push(z),S.push(C),S.push(v));b[3*U+1]>=q.minHeight&&g&&l&&(S.push(U),S.push(z),S.push(v))}U.c.ComputeNormals(b,S,v);const G=new U.c;return G.indices=S,G.tq=b,G.fq=v,G.Eq=g,G}function H(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const b=new r(q,arguments.length>2?arguments[2]:void 0);b._setReady(!1),b._subdivisionsX=S.subdivisionsX||S.subdivisions||1,b._subdivisionsY=S.subdivisionsY||S.subdivisions||1,b._width=S.width||1,b._height=S.height||1,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ;return R(S).iq(b,S.updatable),b._setReady(!0),b}function Q(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new v.d(q,b);return G(S).iq(z,S.updatable),z}function k(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const v=b.width||10,U=b.height||10,g=b.subdivisions||1,l=b.minHeight||0,y=b.maxHeight||1,R=b.colorFilter||new C.HS(.3,.59,.11),G=b.alphaFilter||0,H=b.updatable,Q=b.onReady;z=z||V.b.LastCreatedScene;const k=new r(q,z);let W;k._subdivisionsX=g,k._subdivisionsY=g,k._width=v,k._height=U,k._maxX=k._width/2,k._maxZ=k._height/2,k._minX=-k._maxX,k._minZ=-k._maxZ,k._setReady(!1),b.passHeightBufferInCallback&&(W=new Float32Array((g+1)*(g+1)));const N=(q,S,b)=>{Z({width:v,height:U,subdivisions:g,minHeight:l,maxHeight:y,colorFilter:R,buffer:q,bufferWidth:S,bufferHeight:b,alphaFilter:G,heightBuffer:W}).iq(k,H),Q&&Q(k,W),k._setReady(!0)};if("string"===typeof S){const q=q=>{var S;const b=q.width,C=q.height;if(z.V)return;const v=null===(S=z)||void 0===S?void 0:S.getEngine().resizeImageBitmap(q,b,C);N(v,b,C)};I.Tools.LoadImage(S,q,b.onError?b.onError:()=>{},z.offlineProvider)}else N(S.data,S.width,S.height);return k}U.c.CreateGround=R,U.c.CreateTiledGround=G,U.c.CreateGroundFromHeightMap=Z,v.d.CreateGround=(q,S,b,z,C,v)=>H(q,{width:S,height:b,subdivisions:z,updatable:v},C),v.d.CreateTiledGround=(q,S,b,z,C,v,U,g,r)=>Q(q,{xmin:S,zmin:b,xmax:z,zmax:C,subdivisions:v,precision:U,updatable:r},g),v.d.CreateGroundFromHeightMap=(q,S,b,z,C,v,U,g,r,I,V)=>k(q,S,{width:b,height:z,subdivisions:C,minHeight:v,maxHeight:U,updatable:r,onReady:I,alphaFilter:V},g)},12997:(q,S,b)=>{"use strict";b.d(S,{d:()=>R,h:()=>l,l:()=>y});var z=b(11103),C=b(11555),v=b(11535),U=b(11665),g=b(11172),r=b(10943);function I(q){const S=[],b=[],z=q.lines,C=q.mq,U=[];let g=0;for(let v=0;v<z.length;v++){const q=z[v];for(let z=0;z<q.length;z++){const{x:r,y:I,z:V}=q[z];if(b.push(r,I,V),C){const q=C[v],{r:S,g:b,b:g,a:r}=q[z];U.push(S,b,g,r)}z>0&&(S.push(g-1),S.push(g)),g++}}const r=new v.c;return r.indices=S,r.tq=b,C&&(r.mq=U),r}function V(q){const S=q.dashSize||3,b=q.gapSize||1,C=q.dashNb||200,U=q.points,g=[],r=[],I=z.yS.Zero();let V=0,l=0,y=0,R=0,G=0,Z=0,H=0;for(H=0;H<U.length-1;H++)U[H+1].subtractToRef(U[H],I),V+=I.length();for(y=V/C,R=S*y/(S+b),H=0;H<U.length-1;H++){U[H+1].subtractToRef(U[H],I),l=Math.floor(I.length()/y),I.normalize();for(let q=0;q<l;q++)G=y*q,g.push(U[H].x+G*I.x,U[H].y+G*I.y,U[H].z+G*I.z),g.push(U[H].x+(G+R)*I.x,U[H].y+(G+R)*I.y,U[H].z+(G+R)*I.z),r.push(Z,Z+1),Z+=2}const Q=new v.c;return Q.tq=g,Q.indices=r,Q}function l(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=S.instance,C=S.lines,v=S.mq;if(z){const q=z.getVerticesData(g.f.PositionKind);let S,b;v&&(S=z.getVerticesData(g.f.ColorKind));let U=0,r=0;for(let z=0;z<C.length;z++){const g=C[z];for(let C=0;C<g.length;C++)q[U]=g[C].x,q[U+1]=g[C].y,q[U+2]=g[C].z,v&&S&&(b=v[z],S[r]=b[C].r,S[r+1]=b[C].g,S[r+2]=b[C].b,S[r+3]=b[C].a,r+=4),U+=3}return z.updateVerticesData(g.f.PositionKind,q,!1,!1),v&&S&&z.updateVerticesData(g.f.ColorKind,S,!1,!1),z.refreshBoundingInfo(),z}const r=!!v,V=new U.d(q,b,null,void 0,void 0,r,S.useVertexAlpha,S.material);return I(S).iq(V,S.updatable),V}function y(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=S.mq?[S.mq]:null;return l(q,{lines:[S.points],updatable:S.updatable,instance:S.instance,mq:z,useVertexAlpha:S.useVertexAlpha,material:S.material},b)}function R(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=S.points,g=S.instance,I=S.gapSize||1,l=S.dashSize||3;if(g){const q=q=>{const S=z.yS.Zero(),b=q.length/6;let C=0,U=0,r=0,I=0,V=0,l=0,y=0,R=0;for(y=0;y<v.length-1;y++)v[y+1].subtractToRef(v[y],S),C+=S.length();r=C/b;const G=g._creationDataStorage.dashSize;for(I=G*r/(G+g._creationDataStorage.gapSize),y=0;y<v.length-1;y++)for(v[y+1].subtractToRef(v[y],S),U=Math.floor(S.length()/r),S.normalize(),R=0;R<U&&l<q.length;)V=r*R,q[l]=v[y].x+V*S.x,q[l+1]=v[y].y+V*S.y,q[l+2]=v[y].z+V*S.z,q[l+3]=v[y].x+(V+I)*S.x,q[l+4]=v[y].y+(V+I)*S.y,q[l+5]=v[y].z+(V+I)*S.z,l+=6,R++;for(;l<q.length;)q[l]=v[y].x,q[l+1]=v[y].y,q[l+2]=v[y].z,l+=3};return(S.dashNb||S.dashSize||S.gapSize||S.useVertexAlpha||S.material)&&r.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),g.updateMeshPositions(q,!1),g}const y=new U.d(q,b,null,void 0,void 0,void 0,S.useVertexAlpha,S.material);return V(S).iq(y,S.updatable),y._creationDataStorage=new C.h,y._creationDataStorage.dashSize=l,y._creationDataStorage.gapSize=I,y}v.c.CreateLineSystem=I,v.c.CreateDashedLines=V,C.d.FI=function(q,S){return y(q,{points:S,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},C.d.CreateDashedLines=function(q,S,b,z,C){return R(q,{points:S,dashSize:b,gapSize:z,dashNb:C,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12379:(q,S,b)=>{"use strict";b.d(S,{d:()=>g,e:()=>r});var z=b(11555),C=b(11535),v=b(11160);function U(q){const S=[],b=[],z=[],U=[],g=void 0!==q.width?q.width:void 0!==q.size?q.size:1,r=void 0!==q.height?q.height:void 0!==q.size?q.size:1,I=0===q.sideOrientation?0:q.sideOrientation||C.c.DEFAULTSIDE,V=g/2,l=r/2;b.push(-V,-l,0),z.push(0,0,-1),U.push(0,v.e?1:0),b.push(V,-l,0),z.push(0,0,-1),U.push(1,v.e?1:0),b.push(V,l,0),z.push(0,0,-1),U.push(1,v.e?0:1),b.push(-V,l,0),z.push(0,0,-1),U.push(0,v.e?0:1),S.push(0),S.push(1),S.push(2),S.push(0),S.push(2),S.push(3),C.c._ComputeSides(I,b,S,z,U,q.frontUVs,q.backUVs);const y=new C.c;return y.indices=S,y.tq=b,y.fq=z,y.Eq=U,y}function g(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.d(q,b);S.sideOrientation=z.d._GetDefaultSideOrientation(S.sideOrientation),C._originalBuilderSideOrientation=S.sideOrientation;return U(S).iq(C,S.updatable),S.sourcePlane&&(C.translate(S.sourcePlane.normal,-S.sourcePlane.d),C.setDirection(S.sourcePlane.normal.scale(-1))),C}const r={nI:g};C.c.nI=U,z.d.nI=(q,S,b,z,C)=>g(q,{size:S,width:S,height:S,sideOrientation:C,updatable:z},b)},12483:(q,S,b)=>{"use strict";b.d(S,{c:()=>r});var z=b(11103),C=b(11555),v=b(11535),U=b(11160);function g(q){const S=0|(q.segments||32),b=q.diameterX||q.diameter||1,C=q.diameterY||q.diameter||1,g=q.diameterZ||q.diameter||1,r=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,I=q.slice&&q.slice<=0?1:q.slice||1,V=0===q.sideOrientation?0:q.sideOrientation||v.c.DEFAULTSIDE,l=!!q.dedupTopBottomIndices,y=new z.yS(b/2,C/2,g/2),R=2+S,G=2*R,Z=[],H=[],Q=[],k=[];for(let v=0;v<=R;v++){const q=v/R,S=q*Math.PI*I;for(let b=0;b<=G;b++){const C=b/G,v=C*Math.PI*2*r,g=z.Matrix.RotationZ(-S),I=z.Matrix.RotationY(v),V=z.yS.TransformCoordinates(z.yS.Up(),g),l=z.yS.TransformCoordinates(V,I),R=l.multiply(y),Z=l.divide(y).normalize();H.push(R.x,R.y,R.z),Q.push(Z.x,Z.y,Z.z),k.push(C,U.e?1-q:q)}if(v>0){const q=H.length/3;for(let S=q-2*(G+1);S+G+2<q;S++)l?(v>1&&(Z.push(S),Z.push(S+1),Z.push(S+G+1)),(v<R||I<1)&&(Z.push(S+G+1),Z.push(S+1),Z.push(S+G+2))):(Z.push(S),Z.push(S+1),Z.push(S+G+1),Z.push(S+G+1),Z.push(S+1),Z.push(S+G+2))}}v.c._ComputeSides(V,H,Z,Q,k,q.frontUVs,q.backUVs);const W=new v.c;return W.indices=Z,W.tq=H,W.fq=Q,W.Eq=k,W}function r(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return g(S).iq(z,S.updatable),z}v.c.CreateSphere=g,C.d.CreateSphere=(q,S,b,z,C,v)=>r(q,{segments:S,diameterX:b,diameterY:b,diameterZ:b,sideOrientation:v,updatable:C},z)},13309:(q,S,b)=>{"use strict";b.d(S,{c:()=>g});var z=b(11684),C=b(12807),v=b(11702),U=b(11535);class g{static get Configuration(){return{get decoder(){return C.b.DefaultConfiguration},set decoder(q){C.b.DefaultConfiguration=q}}}static set Configuration(q){C.b.DefaultConfiguration=q.decoder}static get DecoderAvailable(){return(0,z.h)(C.b.DefaultConfiguration)}static get Default(){return g._Default??(g._Default=new g),g._Default}static ResetDefault(q){g._Default&&(q||g._Default.dispose(),g._Default=null)}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.DefaultNumWorkers;const S="number"===typeof q?{...C.b.DefaultConfiguration,numWorkers:q}:{...C.b.DefaultConfiguration,...q};this._decoder=new C.b(S)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(q,S,b){return this._decoder.decodeMeshToMeshDataAsync(q,S,b)}async decodeMeshToGeometryAsync(q,S,b,z){return await this._decoder.decodeMeshToGeometryAsync(q,S,b,z)}async _decodeMeshToGeometryForGltfAsync(q,S,b,z,C,v){return await this._decoder._decodeMeshToGeometryForGltfAsync(q,S,b,z,C,v)}async decodeMeshAsync(q,S){const b=await this._decoder.decodeMeshToMeshDataAsync(q,S),z=new U.c;b.indices&&(z.indices=b.indices);for(const C of b.attributes){const q=v.b.GetFloatData(C.data,C.size,v.b.GetDataType(C.data),C.byteOffset,C.byteStride,C.normalized,b.totalVertices);z.set(q,C.kind)}return z}}g.DefaultNumWorkers=(0,z.d)(),g._Default=null},12807:(q,S,b)=>{"use strict";b.d(S,{b:()=>I});var z=b(11684),C=b(10921),v=b(11560),U=b(11702),g=b(10943),r=b(11694);class I extends z.c{static get DefaultAvailable(){return(0,z.h)(I.DefaultConfiguration)}static get Default(){return I._Default??(I._Default=new I),I._Default}static ResetDefault(q){I._Default&&(q||I._Default.dispose(),I._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(q,S){return{module:await(S||DracoDecoderModule)({wasmBinary:q})}}_getWorkerContent(){return`${r.c}(${r.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DefaultConfiguration)}decodeMeshToMeshDataAsync(q,S,b){const z=q instanceof ArrayBuffer?new Int8Array(q):new Int8Array(q.buffer,q.byteOffset,q.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async q=>await new Promise(((C,v)=>{q.push(((q,U)=>{let r=null;const I=[],V=S=>{q.removeEventListener("error",V),q.removeEventListener("message",l),v(S),U()},l=S=>{const z=S.data;switch(z.id){case"indices":r=z.data;break;case"attribute":I.push({kind:z.kind,data:z.data,size:z.size,byteOffset:z.byteOffset,byteStride:z.byteStride,normalized:(v=z.kind,y=z.normalized,b&&void 0!==b[v]?(y!==b[v]&&g.b.Warn(`Normalized flag from Draco data (${y}) does not match normalized flag from glTF accessor (${b[v]}). Using flag from glTF accessor.`),b[v]):y)});break;case"decodeMeshDone":q.removeEventListener("error",V),q.removeEventListener("message",l),C({indices:r,attributes:I,totalVertices:z.totalVertices}),U()}var v,y};q.addEventListener("error",V),q.addEventListener("message",l);const y=z.slice();q.postMessage({id:"decodeMesh",dataView:y,attributes:S},[y.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((q=>{let b=null;const C=[],v=(0,r.c)(q.module,z,S,(q=>{b=q}),((q,S,b,z,v,U)=>{C.push({kind:q,data:S,size:b,byteOffset:z,byteStride:v,normalized:U})}));return{indices:b,attributes:C,totalVertices:v}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(q,S,b,z){const C=await this.decodeMeshToMeshDataAsync(b,z),g=new v.c(q,S);C.indices&&g.setIndices(C.indices);for(const v of C.attributes)g.setVerticesBuffer(new U.b(S.getEngine(),v.data,v.kind,!1,void 0,v.byteStride,void 0,v.byteOffset,v.size,void 0,v.normalized,!0),C.totalVertices);return g}async _decodeMeshToGeometryForGltfAsync(q,S,b,z,C,g){const r=await this.decodeMeshToMeshDataAsync(b,z,C),I=new v.c(q,S);g&&(I._boundingInfo=g,I.useBoundingInfoFromGeometry=!0),r.indices&&I.setIndices(r.indices);for(const v of r.attributes)I.setVerticesBuffer(new U.b(S.getEngine(),v.data,v.kind,!1,void 0,v.byteStride,void 0,v.byteOffset,v.size,void 0,v.normalized,!0),r.totalVertices);return I}}I.DefaultConfiguration={wasmUrl:`${C.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${C.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${C.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},I._Default=null},12988:(q,S,b)=>{"use strict";b.d(S,{e:()=>gq});var z=b(11103),C=b(11555),v=b(11172),U=b(11535),g=b(11160);function r(q){let S=q.pathArray;const b=q.closeArray||!1,z=q.closePath||!1,C=q.invertUV||!1,r=Math.floor(S[0].length/2);let I=q.offset||r;I=I>r?r:Math.floor(I);const V=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,l=q.Eq,y=q.mq,R=[],G=[],Z=[],H=[],Q=[],k=[],W=[],N=[];let u;const X=[],T=[];let B,t,f;if(S.length<2){const q=[],b=[];for(t=0;t<S[0].length-I;t++)q.push(S[0][t]),b.push(S[0][t+I]);S=[q,b]}let m=0;const E=z?1:0,e=b?1:0;let i,J,L,d,K,D;for(u=S[0].length,B=0;B<S.length+e;B++){for(W[B]=0,Q[B]=[0],i=B===S.length?S[0]:S[B],J=i.length,u=u<J?u:J,f=0;f<J;)R.push(i[f].x,i[f].y,i[f].z),f>0&&(L=i[f].RS(i[f-1]).length(),d=L+W[B],Q[B].push(d),W[B]=d),f++;z&&(f--,R.push(i[0].x,i[0].y,i[0].z),L=i[f].RS(i[0]).length(),d=L+W[B],Q[B].push(d),W[B]=d),X[B]=J+E,T[B]=m,m+=J+E}let x,F,a=null,n=null;for(t=0;t<u+E;t++)for(N[t]=0,k[t]=[0],B=0;B<S.length-1+e;B++)K=S[B],D=B===S.length-1?S[0]:S[B+1],t===u?(a=K[0],n=D[0]):(a=K[t],n=D[t]),L=n.RS(a).length(),d=L+N[t],k[t].push(d),N[t]=d;if(l)for(B=0;B<l.length;B++)H.push(l[B].x,g.e?1-l[B].y:l[B].y);else for(B=0;B<S.length+e;B++)for(t=0;t<u+E;t++)x=0!=W[B]?Q[B][t]/W[B]:0,F=0!=N[t]?k[t][B]/N[t]:0,C?H.push(F,x):H.push(x,g.e?1-F:F);B=0;let o=0,s=X[B]-1,A=X[B+1]-1,w=s<A?s:A,P=T[1]-T[0];const h=X.length-1;for(;o<=w&&B<h;)G.push(o,o+P,o+1),G.push(o+P+1,o+1,o+P),o+=1,o===w&&(B++,P=T[B+1]-T[B],s=X[B]-1,A=X[B+1]-1,o=T[B],w=s<A?s+o:A+o);if(U.c.ComputeNormals(R,G,Z),z){let q=0,b=0;for(B=0;B<S.length;B++){q=3*T[B],b=B+1<S.length?3*(T[B+1]-1):Z.length-3,Z[q]=.5*(Z[q]+Z[b]),Z[q+1]=.5*(Z[q+1]+Z[b+1]),Z[q+2]=.5*(Z[q+2]+Z[b+2]);const z=Math.sqrt(Z[q]*Z[q]+Z[q+1]*Z[q+1]+Z[q+2]*Z[q+2]);Z[q]/=z,Z[q+1]/=z,Z[q+2]/=z,Z[b]=Z[q],Z[b+1]=Z[q+1],Z[b+2]=Z[q+2]}}if(b){let q=3*T[0],b=3*T[S.length];for(t=0;t<u+E;t++){Z[q]=.5*(Z[q]+Z[b]),Z[q+1]=.5*(Z[q+1]+Z[b+1]),Z[q+2]=.5*(Z[q+2]+Z[b+2]);const S=Math.sqrt(Z[q]*Z[q]+Z[q+1]*Z[q+1]+Z[q+2]*Z[q+2]);Z[q]/=S,Z[q+1]/=S,Z[q+2]/=S,Z[b]=Z[q],Z[b+1]=Z[q+1],Z[b+2]=Z[q+2],q+=3,b+=3}}U.c._ComputeSides(V,R,G,Z,H,q.frontUVs,q.backUVs);let O=null;if(y){O=new Float32Array(4*y.length);for(let q=0;q<y.length;q++)O[4*q]=y[q].r,O[4*q+1]=y[q].g,O[4*q+2]=y[q].b,O[4*q+3]=y[q].a}const j=new U.c,M=new Float32Array(R),p=new Float32Array(Z),Y=new Float32Array(H);return j.indices=G,j.tq=M,j.fq=p,j.Eq=Y,O&&j.set(O,v.f.ColorKind),z&&(j._idx=T),j}function I(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=S.pathArray,V=S.closeArray,l=S.closePath,y=C.d._GetDefaultSideOrientation(S.sideOrientation),R=S.instance,G=S.updatable;if(R){const q=z.TmpVectors.yS[0].fb(Number.MAX_VALUE),b=z.TmpVectors.yS[1].fb(-Number.MAX_VALUE),r=S=>{let z=I[0].length;const v=R;let U=0;const g=v._originalBuilderSideOrientation===C.d.DOUBLESIDE?2:1;for(let C=1;C<=g;++C)for(let g=0;g<I.length;++g){const C=I[g],r=C.length;z=z<r?z:r;for(let v=0;v<z;++v){const z=C[v];S[U]=z.x,S[U+1]=z.y,S[U+2]=z.z,q.minimizeInPlaceFromFloats(z.x,z.y,z.z),b.maximizeInPlaceFromFloats(z.x,z.y,z.z),U+=3}if(v._creationDataStorage&&v._creationDataStorage.closePath){const q=C[0];S[U]=q.x,S[U+1]=q.y,S[U+2]=q.z,U+=3}}},V=R.getVerticesData(v.f.PositionKind);if(r(V),R.hasBoundingInfo?R.getBoundingInfo().reConstruct(q,b,R._worldMatrix):R.buildBoundingInfo(q,b,R._worldMatrix),R.updateVerticesData(v.f.PositionKind,V,!1,!1),S.mq){const q=R.getVerticesData(v.f.ColorKind);for(let b=0,z=0;b<S.mq.length;b++,z+=4){const C=S.mq[b];q[z]=C.r,q[z+1]=C.g,q[z+2]=C.b,q[z+3]=C.a}R.updateVerticesData(v.f.ColorKind,q,!1,!1)}if(S.Eq){const q=R.getVerticesData(v.f.UVKind);for(let b=0;b<S.Eq.length;b++)q[2*b]=S.Eq[b].x,q[2*b+1]=g.e?1-S.Eq[b].y:S.Eq[b].y;R.updateVerticesData(v.f.UVKind,q,!1,!1)}if(!R.areNormalsFrozen||R.isFacetDataEnabled){const q=R.Xb(),S=R.getVerticesData(v.f.NormalKind),b=R.isFacetDataEnabled?R.getFacetDataParameters():null;if(U.c.ComputeNormals(V,q,S,b),R._creationDataStorage&&R._creationDataStorage.closePath){let q=0,b=0;for(let z=0;z<I.length;z++)q=3*R._creationDataStorage.idx[z],b=z+1<I.length?3*(R._creationDataStorage.idx[z+1]-1):S.length-3,S[q]=.5*(S[q]+S[b]),S[q+1]=.5*(S[q+1]+S[b+1]),S[q+2]=.5*(S[q+2]+S[b+2]),S[b]=S[q],S[b+1]=S[q+1],S[b+2]=S[q+2]}R.areNormalsFrozen||R.updateVerticesData(v.f.NormalKind,S,!1,!1)}return R}{const z=new C.d(q,b);z._originalBuilderSideOrientation=y,z._creationDataStorage=new C.h;const v=r(S);return l&&(z._creationDataStorage.idx=v._idx),z._creationDataStorage.closePath=l,z._creationDataStorage.closeArray=V,v.iq(z,G),z}}U.c.CreateRibbon=r,C.d.CreateRibbon=function(q,S){return I(q,{pathArray:S,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var V=b(12492),l=b(12327),y=b(11150);function R(q){const S=q.pattern||C.d.NO_FLIP,b=q.tileWidth||q.tileSize||1,z=q.tileHeight||q.tileSize||1,v=q.alignHorizontal||0,g=q.alignVertical||0,r=q.width||q.size||1,I=Math.floor(r/b);let V=r-I*b;const l=q.height||q.size||1,y=Math.floor(l/z);let R=l-y*z;const G=b*I/2,Z=z*y/2;let H=0,Q=0,k=0,W=0,N=0,u=0;if(V>0||R>0){switch(k=-G,W=-Z,N=G,u=Z,v){case C.d.CENTER:V/=2,k-=V,N+=V;break;case C.d.LEFT:N+=V,H=-V/2;break;case C.d.RIGHT:k-=V,H=V/2}switch(g){case C.d.CENTER:R/=2,W-=R,u+=R;break;case C.d.BOTTOM:u+=R,Q=-R/2;break;case C.d.TOP:W-=R,Q=R/2}}const X=[],T=[],B=[];B[0]=[0,0,1,0,1,1,0,1],B[1]=[0,0,1,0,1,1,0,1],S!==C.d.ROTATE_TILE&&S!==C.d.ROTATE_ROW||(B[1]=[1,1,0,1,0,0,1,0]),S!==C.d.FLIP_TILE&&S!==C.d.FLIP_ROW||(B[1]=[1,0,0,0,0,1,1,1]),S!==C.d.FLIP_N_ROTATE_TILE&&S!==C.d.FLIP_N_ROTATE_ROW||(B[1]=[0,1,1,1,1,0,0,0]);let t=[];const f=[],m=[];let E=0;for(let U=0;U<y;U++)for(let q=0;q<I;q++)X.push(q*b-G+H,U*z-Z+Q,0),X.push((q+1)*b-G+H,U*z-Z+Q,0),X.push((q+1)*b-G+H,(U+1)*z-Z+Q,0),X.push(q*b-G+H,(U+1)*z-Z+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),t=S===C.d.FLIP_TILE||S===C.d.ROTATE_TILE||S===C.d.FLIP_N_ROTATE_TILE?t.concat(B[(q%2+U%2)%2]):S===C.d.FLIP_ROW||S===C.d.ROTATE_ROW||S===C.d.FLIP_N_ROTATE_ROW?t.concat(B[U%2]):t.concat(B[0]),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),E+=4;if(V>0||R>0){const q=R>0&&(g===C.d.CENTER||g===C.d.TOP),U=R>0&&(g===C.d.CENTER||g===C.d.BOTTOM),r=V>0&&(v===C.d.CENTER||v===C.d.RIGHT),l=V>0&&(v===C.d.CENTER||v===C.d.LEFT);let B,e,i,J,L=[];if(q&&r&&(X.push(k+H,W+Q,0),X.push(-G+H,W+Q,0),X.push(-G+H,W+R+Q,0),X.push(k+H,W+R+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,B=1-V/b,e=1-R/z,i=1,J=1,L=[B,e,i,e,i,J,B,J],S===C.d.ROTATE_ROW&&(L=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),S===C.d.FLIP_ROW&&(L=[1-B,e,1-i,e,1-i,J,1-B,J]),S===C.d.FLIP_N_ROTATE_ROW&&(L=[B,1-e,i,1-e,i,1-J,B,1-J]),t=t.concat(L),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&l&&(X.push(G+H,W+Q,0),X.push(N+H,W+Q,0),X.push(N+H,W+R+Q,0),X.push(G+H,W+R+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,B=0,e=1-R/z,i=V/b,J=1,L=[B,e,i,e,i,J,B,J],(S===C.d.ROTATE_ROW||S===C.d.ROTATE_TILE&&I%2===0)&&(L=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),(S===C.d.FLIP_ROW||S===C.d.FLIP_TILE&&I%2===0)&&(L=[1-B,e,1-i,e,1-i,J,1-B,J]),(S===C.d.FLIP_N_ROTATE_ROW||S===C.d.FLIP_N_ROTATE_TILE&&I%2===0)&&(L=[B,1-e,i,1-e,i,1-J,B,1-J]),t=t.concat(L),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&r&&(X.push(k+H,Z+Q,0),X.push(-G+H,Z+Q,0),X.push(-G+H,u+Q,0),X.push(k+H,u+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,B=1-V/b,e=0,i=1,J=R/z,L=[B,e,i,e,i,J,B,J],(S===C.d.ROTATE_ROW&&y%2===1||S===C.d.ROTATE_TILE&&y%1===0)&&(L=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),(S===C.d.FLIP_ROW&&y%2===1||S===C.d.FLIP_TILE&&y%2===0)&&(L=[1-B,e,1-i,e,1-i,J,1-B,J]),(S===C.d.FLIP_N_ROTATE_ROW&&y%2===1||S===C.d.FLIP_N_ROTATE_TILE&&y%2===0)&&(L=[B,1-e,i,1-e,i,1-J,B,1-J]),t=t.concat(L),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&l&&(X.push(G+H,Z+Q,0),X.push(N+H,Z+Q,0),X.push(N+H,u+Q,0),X.push(G+H,u+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,B=0,e=0,i=V/b,J=R/z,L=[B,e,i,e,i,J,B,J],(S===C.d.ROTATE_ROW&&y%2===1||S===C.d.ROTATE_TILE&&(y+I)%2===1)&&(L=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),(S===C.d.FLIP_ROW&&y%2===1||S===C.d.FLIP_TILE&&(y+I)%2===1)&&(L=[1-B,e,1-i,e,1-i,J,1-B,J]),(S===C.d.FLIP_N_ROTATE_ROW&&y%2===1||S===C.d.FLIP_N_ROTATE_TILE&&(y+I)%2===1)&&(L=[B,1-e,i,1-e,i,1-J,B,1-J]),t=t.concat(L),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q){const q=[];B=0,e=1-R/z,i=1,J=1,q[0]=[B,e,i,e,i,J,B,J],q[1]=[B,e,i,e,i,J,B,J],S!==C.d.ROTATE_TILE&&S!==C.d.ROTATE_ROW||(q[1]=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),S!==C.d.FLIP_TILE&&S!==C.d.FLIP_ROW||(q[1]=[1-B,e,1-i,e,1-i,J,1-B,J]),S!==C.d.FLIP_N_ROTATE_TILE&&S!==C.d.FLIP_N_ROTATE_ROW||(q[1]=[B,1-e,i,1-e,i,1-J,B,1-J]);for(let z=0;z<I;z++)X.push(z*b-G+H,W+Q,0),X.push((z+1)*b-G+H,W+Q,0),X.push((z+1)*b-G+H,W+R+Q,0),X.push(z*b-G+H,W+R+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,t=S===C.d.FLIP_TILE||S===C.d.ROTATE_TILE||S===C.d.FLIP_N_ROTATE_TILE?t.concat(q[(z+1)%2]):S===C.d.FLIP_ROW||S===C.d.ROTATE_ROW||S===C.d.FLIP_N_ROTATE_ROW?t.concat(q[1]):t.concat(q[0]),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const q=[];B=0,e=0,i=1,J=R/z,q[0]=[B,e,i,e,i,J,B,J],q[1]=[B,e,i,e,i,J,B,J],S!==C.d.ROTATE_TILE&&S!==C.d.ROTATE_ROW||(q[1]=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),S!==C.d.FLIP_TILE&&S!==C.d.FLIP_ROW||(q[1]=[1-B,e,1-i,e,1-i,J,1-B,J]),S!==C.d.FLIP_N_ROTATE_TILE&&S!==C.d.FLIP_N_ROTATE_ROW||(q[1]=[B,1-e,i,1-e,i,1-J,B,1-J]);for(let z=0;z<I;z++)X.push(z*b-G+H,u-R+Q,0),X.push((z+1)*b-G+H,u-R+Q,0),X.push((z+1)*b-G+H,u+Q,0),X.push(z*b-G+H,u+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,t=S===C.d.FLIP_TILE||S===C.d.ROTATE_TILE||S===C.d.FLIP_N_ROTATE_TILE?t.concat(q[(z+y)%2]):S===C.d.FLIP_ROW||S===C.d.ROTATE_ROW||S===C.d.FLIP_N_ROTATE_ROW?t.concat(q[y%2]):t.concat(q[0]),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(r){const q=[];B=1-V/b,e=0,i=1,J=1,q[0]=[B,e,i,e,i,J,B,J],q[1]=[B,e,i,e,i,J,B,J],S!==C.d.ROTATE_TILE&&S!==C.d.ROTATE_ROW||(q[1]=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),S!==C.d.FLIP_TILE&&S!==C.d.FLIP_ROW||(q[1]=[1-B,e,1-i,e,1-i,J,1-B,J]),S!==C.d.FLIP_N_ROTATE_TILE&&S!==C.d.FLIP_N_ROTATE_ROW||(q[1]=[B,1-e,i,1-e,i,1-J,B,1-J]);for(let b=0;b<y;b++)X.push(k+H,b*z-Z+Q,0),X.push(k+V+H,b*z-Z+Q,0),X.push(k+V+H,(b+1)*z-Z+Q,0),X.push(k+H,(b+1)*z-Z+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,t=S===C.d.FLIP_TILE||S===C.d.ROTATE_TILE||S===C.d.FLIP_N_ROTATE_TILE?t.concat(q[(b+1)%2]):S===C.d.FLIP_ROW||S===C.d.ROTATE_ROW||S===C.d.FLIP_N_ROTATE_ROW?t.concat(q[b%2]):t.concat(q[0]),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const q=[];B=0,e=0,i=V/z,J=1,q[0]=[B,e,i,e,i,J,B,J],q[1]=[B,e,i,e,i,J,B,J],S!==C.d.ROTATE_TILE&&S!==C.d.ROTATE_ROW||(q[1]=[1-B,1-e,1-i,1-e,1-i,1-J,1-B,1-J]),S!==C.d.FLIP_TILE&&S!==C.d.FLIP_ROW||(q[1]=[1-B,e,1-i,e,1-i,J,1-B,J]),S!==C.d.FLIP_N_ROTATE_TILE&&S!==C.d.FLIP_N_ROTATE_ROW||(q[1]=[B,1-e,i,1-e,i,1-J,B,1-J]);for(let b=0;b<y;b++)X.push(N-V+H,b*z-Z+Q,0),X.push(N+H,b*z-Z+Q,0),X.push(N+H,(b+1)*z-Z+Q,0),X.push(N-V+H,(b+1)*z-Z+Q,0),m.push(E,E+1,E+3,E+1,E+2,E+3),E+=4,t=S===C.d.FLIP_TILE||S===C.d.ROTATE_TILE||S===C.d.FLIP_N_ROTATE_TILE?t.concat(q[(b+I)%2]):S===C.d.FLIP_ROW||S===C.d.ROTATE_ROW||S===C.d.FLIP_N_ROTATE_ROW?t.concat(q[b%2]):t.concat(q[0]),f.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const e=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE;U.c._ComputeSides(e,X,m,T,t,q.frontUVs,q.backUVs);const i=new U.c;i.indices=m,i.tq=X,i.fq=T,i.Eq=t;const J=e===U.c.DOUBLESIDE?f.concat(f):f;return i.mq=J,i}function G(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return R(S).iq(z,S.updatable),z}function Z(q){const S=q.faceUV||new Array(6),b=q.faceColors,v=q.pattern||C.d.NO_FLIP,r=q.width||q.size||1,I=q.height||q.size||1,V=q.depth||q.size||1,l=q.tileWidth||q.tileSize||1,G=q.tileHeight||q.tileSize||1,Z=q.alignHorizontal||0,H=q.alignVertical||0,Q=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE;for(let C=0;C<6;C++)void 0===S[C]&&(S[C]=new z.Vector4(0,0,1,1)),b&&void 0===b[C]&&(b[C]=new y.b(1,1,1,1));const k=r/2,W=I/2,N=V/2,u=[];for(let z=0;z<2;z++)u[z]=R({pattern:v,tileWidth:l,tileHeight:G,width:r,height:I,alignVertical:H,alignHorizontal:Z,sideOrientation:Q});for(let z=2;z<4;z++)u[z]=R({pattern:v,tileWidth:l,tileHeight:G,width:V,height:I,alignVertical:H,alignHorizontal:Z,sideOrientation:Q});let X=H;H===C.d.BOTTOM?X=C.d.TOP:H===C.d.TOP&&(X=C.d.BOTTOM);for(let z=4;z<6;z++)u[z]=R({pattern:v,tileWidth:l,tileHeight:G,width:r,height:V,alignVertical:X,alignHorizontal:Z,sideOrientation:Q});let T=[],B=[],t=[],f=[];const m=[],E=[],e=[],i=[];let J=0,L=0;for(let C=0;C<6;C++){const q=u[C].tq.length;E[C]=[],e[C]=[];for(let S=0;S<q/3;S++)E[C].push(new z.yS(u[C].tq[3*S],u[C].tq[3*S+1],u[C].tq[3*S+2])),e[C].push(new z.yS(u[C].fq[3*S],u[C].fq[3*S+1],u[C].fq[3*S+2]));J=u[C].Eq.length,i[C]=[];for(let b=0;b<J;b+=2)i[C][b]=S[C].x+(S[C].z-S[C].x)*u[C].Eq[b],i[C][b+1]=S[C].y+(S[C].w-S[C].y)*u[C].Eq[b+1],g.e&&(i[C][b+1]=1-i[C][b+1]);if(t=t.concat(i[C]),f=f.concat(u[C].indices.map((q=>q+L))),L+=E[C].length,b)for(let S=0;S<4;S++)m.push(b[C].r,b[C].g,b[C].b,b[C].a)}const d=new z.yS(0,0,N),K=z.Matrix.RotationY(Math.PI);T=E[0].map((q=>z.yS.TransformNormal(q,K).add(d))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]),B=e[0].map((q=>z.yS.TransformNormal(q,K))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]),T=T.concat(E[1].map((q=>q.RS(d))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),B=B.concat(e[1].map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]));const D=new z.yS(k,0,0),x=z.Matrix.RotationY(-Math.PI/2);T=T.concat(E[2].map((q=>z.yS.TransformNormal(q,x).add(D))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),B=B.concat(e[2].map((q=>z.yS.TransformNormal(q,x))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]));const F=z.Matrix.RotationY(Math.PI/2);T=T.concat(E[3].map((q=>z.yS.TransformNormal(q,F).RS(D))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),B=B.concat(e[3].map((q=>z.yS.TransformNormal(q,F))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]));const a=new z.yS(0,W,0),n=z.Matrix.RotationX(Math.PI/2);T=T.concat(E[4].map((q=>z.yS.TransformNormal(q,n).add(a))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),B=B.concat(e[4].map((q=>z.yS.TransformNormal(q,n))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[]));const o=z.Matrix.RotationX(-Math.PI/2);T=T.concat(E[5].map((q=>z.yS.TransformNormal(q,o).RS(a))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),B=B.concat(e[5].map((q=>z.yS.TransformNormal(q,o))).map((q=>[q.x,q.y,q.z])).reduce(((q,S)=>q.concat(S)),[])),U.c._ComputeSides(Q,T,f,B,t);const s=new U.c;if(s.indices=f,s.tq=T,s.fq=B,s.Eq=t,b){const q=Q===U.c.DOUBLESIDE?m.concat(m):m;s.mq=q}return s}function H(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return Z(S).iq(z,S.updatable),z}U.c.CreateTiledPlane=R;U.c.CreateTiledBox=Z;var Q=b(12483),k=b(11339),W=b(11307);function N(q){const S=q.height||2;let b=0===q.diameterTop?0:q.diameterTop||q.diameter||1,v=0===q.diameterBottom?0:q.diameterBottom||q.diameter||1;b=b||1e-5,v=v||1e-5;const r=0|(q.tessellation||24),I=0|(q.subdivisions||1),V=!!q.hasRings,l=!!q.enclose,R=0===q.cap?0:q.cap||C.d.CAP_ALL,G=q.arc&&(q.arc<=0||q.arc>1)?1:q.arc||1,Z=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,H=q.faceUV||new Array(3),Q=q.faceColors,k=2+(1+(1!==G&&l?2:0))*(V?I:1);let N;for(N=0;N<k;N++)Q&&void 0===Q[N]&&(Q[N]=new y.b(1,1,1,1));for(N=0;N<k;N++)H&&void 0===H[N]&&(H[N]=new z.Vector4(0,0,1,1));const u=[],X=[],T=[],B=[],t=[],f=2*Math.PI*G/r;let m,E,e;const i=(v-b)/2/S,J=z.yS.Zero(),L=z.yS.Zero(),d=z.yS.Zero(),K=z.yS.Zero(),D=z.yS.Zero(),x=W.c.Y;let F,a,n,o=1,s=1,A=0,w=0;for(F=0;F<=I;F++)for(E=F/I,e=(E*(b-v)+v)/2,o=V&&0!==F&&F!==I?2:1,n=0;n<o;n++){for(V&&(s+=n),l&&(s+=2*n),a=0;a<=r;a++)m=a*f,J.x=Math.cos(-m)*e,J.y=-S/2+E*S,J.z=Math.sin(-m)*e,0===b&&F===I?(L.x=T[T.length-3*(r+1)],L.y=T[T.length-3*(r+1)+1],L.z=T[T.length-3*(r+1)+2]):(L.x=J.x,L.z=J.z,L.y=Math.sqrt(L.x*L.x+L.z*L.z)*i,L.normalize()),0===a&&(d.v(J),K.v(L)),X.push(J.x,J.y,J.z),T.push(L.x,L.y,L.z),w=V?A!==s?H[s].y:H[s].w:H[s].y+(H[s].w-H[s].y)*E,B.push(H[s].x+(H[s].z-H[s].x)*a/r,g.e?1-w:w),Q&&t.push(Q[s].r,Q[s].g,Q[s].b,Q[s].a);1!==G&&l&&(X.push(J.x,J.y,J.z),X.push(0,J.y,0),X.push(0,J.y,0),X.push(d.x,d.y,d.z),z.yS.CrossToRef(x,L,D),D.normalize(),T.push(D.x,D.y,D.z,D.x,D.y,D.z),z.yS.CrossToRef(K,x,D),D.normalize(),T.push(D.x,D.y,D.z,D.x,D.y,D.z),w=V?A!==s?H[s+1].y:H[s+1].w:H[s+1].y+(H[s+1].w-H[s+1].y)*E,B.push(H[s+1].x,g.e?1-w:w),B.push(H[s+1].z,g.e?1-w:w),w=V?A!==s?H[s+2].y:H[s+2].w:H[s+2].y+(H[s+2].w-H[s+2].y)*E,B.push(H[s+2].x,g.e?1-w:w),B.push(H[s+2].z,g.e?1-w:w),Q&&(t.push(Q[s+1].r,Q[s+1].g,Q[s+1].b,Q[s+1].a),t.push(Q[s+1].r,Q[s+1].g,Q[s+1].b,Q[s+1].a),t.push(Q[s+2].r,Q[s+2].g,Q[s+2].b,Q[s+2].a),t.push(Q[s+2].r,Q[s+2].g,Q[s+2].b,Q[s+2].a))),A!==s&&(A=s)}const P=1!==G&&l?r+4:r;for(F=0,s=0;s<I;s++){let q=0,S=0,b=0,z=0;for(a=0;a<r;a++)q=F*(P+1)+a,S=(F+1)*(P+1)+a,b=F*(P+1)+(a+1),z=(F+1)*(P+1)+(a+1),u.push(q,S,b),u.push(z,b,S);1!==G&&l&&(u.push(q+2,S+2,b+2),u.push(z+2,b+2,S+2),u.push(q+4,S+4,b+4),u.push(z+4,b+4,S+4)),F=V?F+2:F+1}const h=q=>{const C=q?b/2:v/2;if(0===C)return;let U,I,V;const l=q?H[k-1]:H[0];let y=null;Q&&(y=q?Q[k-1]:Q[0]);const R=X.length/3,Z=q?S/2:-S/2,W=new z.yS(0,Z,0);X.push(W.x,W.y,W.z),T.push(0,q?1:-1,0);const N=l.y+.5*(l.w-l.y);B.push(l.x+.5*(l.z-l.x),g.e?1-N:N),y&&t.push(y.r,y.g,y.b,y.a);const f=new z.Vector2(.5,.5);for(V=0;V<=r;V++){U=2*Math.PI*V*G/r;const S=Math.cos(-U),b=Math.sin(-U);I=new z.yS(S*C,Z,b*C);const v=new z.Vector2(S*f.x+.5,b*f.y+.5);X.push(I.x,I.y,I.z),T.push(0,q?1:-1,0);const R=l.y+(l.w-l.y)*v.y;B.push(l.x+(l.z-l.x)*v.x,g.e?1-R:R),y&&t.push(y.r,y.g,y.b,y.a)}for(V=0;V<r;V++)q?(u.push(R),u.push(R+(V+2)),u.push(R+(V+1))):(u.push(R),u.push(R+(V+1)),u.push(R+(V+2)))};R!==C.d.CAP_START&&R!==C.d.CAP_ALL||h(!1),R!==C.d.CAP_END&&R!==C.d.CAP_ALL||h(!0),U.c._ComputeSides(Z,X,u,T,B,q.frontUVs,q.backUVs);const O=new U.c;return O.indices=u,O.tq=X,O.fq=T,O.Eq=B,Q&&(O.mq=t),O}function u(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return N(S).iq(z,S.updatable),z}function X(q){const S=[],b=[],C=[],v=[],r=q.diameter||1,I=q.thickness||.5,V=0|(q.tessellation||16),l=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,y=V+1;for(let U=0;U<=V;U++){const q=U/V,l=U*Math.PI*2/V-Math.PI/2,R=z.Matrix.Translation(r/2,0,0).multiply(z.Matrix.RotationY(l));for(let r=0;r<=V;r++){const l=1-r/V,G=r*Math.PI*2/V+Math.PI,Z=Math.cos(G),H=Math.sin(G);let Q=new z.yS(Z,H,0),k=Q.scale(I/2);const W=new z.Vector2(q,l);k=z.yS.TransformCoordinates(k,R),Q=z.yS.TransformNormal(Q,R),b.push(k.x,k.y,k.z),C.push(Q.x,Q.y,Q.z),v.push(W.x,g.e?1-W.y:W.y);const N=(U+1)%y,u=(r+1)%y;S.push(U*y+r),S.push(U*y+u),S.push(N*y+r),S.push(U*y+u),S.push(N*y+u),S.push(N*y+r)}}U.c._ComputeSides(l,b,S,C,v,q.frontUVs,q.backUVs);const R=new U.c;return R.indices=S,R.tq=b,R.fq=C,R.Eq=v,R}function T(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return X(S).iq(z,S.updatable),z}U.c.CreateCylinder=N,C.d.CreateCylinder=(q,S,b,z,v,U,g,r,I)=>{void 0!==g&&g instanceof k.c||(void 0!==g&&(I=r||C.d.DEFAULTSIDE,r=g),g=U,U=1);return u(q,{height:S,diameterTop:b,diameterBottom:z,tessellation:v,subdivisions:U,sideOrientation:I,updatable:r},g)};function B(q){const S=[],b=[],C=[],v=[],r=q.radius||2,I=q.tube||.5,V=q.radialSegments||32,l=q.tubularSegments||32,y=q.p||2,R=q.q||3,G=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,Z=q=>{const S=Math.cos(q),b=Math.sin(q),C=R/y*q,v=Math.cos(C),U=r*(2+v)*.5*S,g=r*(2+v)*b*.5,I=r*Math.sin(C)*.5;return new z.yS(U,g,I)};let H,Q;for(H=0;H<=V;H++){const q=H%V/V*2*y*Math.PI,S=Z(q),C=Z(q+.01),U=C.RS(S);let r=C.add(S);const R=z.yS.Cross(U,r);for(r=z.yS.Cross(R,U),R.normalize(),r.normalize(),Q=0;Q<l;Q++){const q=Q%l/l*2*Math.PI,z=-I*Math.cos(q),C=I*Math.sin(q);b.push(S.x+z*r.x+C*R.x),b.push(S.y+z*r.y+C*R.y),b.push(S.z+z*r.z+C*R.z),v.push(H/V),v.push(g.e?1-Q/l:Q/l)}}for(H=0;H<V;H++)for(Q=0;Q<l;Q++){const q=(Q+1)%l,b=H*l+Q,z=(H+1)*l+Q,C=(H+1)*l+q,v=H*l+q;S.push(v),S.push(z),S.push(b),S.push(v),S.push(C),S.push(z)}U.c.ComputeNormals(b,S,C),U.c._ComputeSides(G,b,S,C,v,q.frontUVs,q.backUVs);const k=new U.c;return k.indices=S,k.tq=b,k.fq=C,k.Eq=v,k}function t(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2?arguments[2]:void 0;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return B(S).iq(z,S.updatable),z}U.c.CreateTorus=X,C.d.CreateTorus=(q,S,b,z,C,v,U)=>T(q,{diameter:S,thickness:b,tessellation:z,sideOrientation:U,updatable:v},C);U.c.CreateTorusKnot=B,C.d.CreateTorusKnot=(q,S,b,z,C,v,U,g,r,I)=>t(q,{radius:S,tube:b,radialSegments:z,tubularSegments:C,p:v,q:U,sideOrientation:I,updatable:r},g);var f=b(12997),m=b(11674),E=b(11314);function e(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=S.path,v=S.shape,U=S.scale||1,g=S.rotation||0,r=0===S.cap?0:S.cap||C.d.NO_CAP,I=S.updatable,V=C.d._GetDefaultSideOrientation(S.sideOrientation),l=S.instance||null,y=S.invertUV||!1,R=S.closeShape||!1,G=S.closePath||!1,Z=S.capFunction||null;return J(q,v,z,U,g,null,null,G,R,r,!1,b,!!I,V,l,y,S.frontUVs||null,S.backUVs||null,S.firstNormal||null,!!S.adjustFrame,Z)}function i(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=S.path,v=S.shape,U=S.scaleFunction||(()=>1),g=S.rotationFunction||(()=>0),r=S.closePath||S.ribbonCloseArray||!1,I=S.closeShape||S.ribbonClosePath||!1,V=0===S.cap?0:S.cap||C.d.NO_CAP,l=S.updatable,y=S.firstNormal||null,R=S.adjustFrame||!1,G=C.d._GetDefaultSideOrientation(S.sideOrientation),Z=S.instance,H=S.invertUV||!1,Q=S.capFunction||null;return J(q,v,z,null,null,U,g,r,I,V,!0,b,!!l,G,Z||null,H,S.frontUVs||null,S.backUVs||null,y,R,Q||null)}function J(q,S,b,v,U,g,r,V,l,y,R,G,Z,H,Q,k,W,N,u,X,T){const B=(q,S,b,v,U,g,r,I,V,l,y)=>{const R=b.getTangents(),G=b.getNormals(),Z=b.getBinormals(),H=b.getDistances();if(y)for(let C=0;C<R.length;C++)if(0==R[C].x&&0==R[C].y&&0==R[C].z&&R[C].v(R[C-1]),0==G[C].x&&0==G[C].y&&0==G[C].z&&G[C].v(G[C-1]),0==Z[C].x&&0==Z[C].y&&0==Z[C].z&&Z[C].v(Z[C-1]),C>0){let q=R[C-1];z.yS.Dot(q,R[C])<0&&R[C].scaleInPlace(-1),q=G[C-1],z.yS.Dot(q,G[C])<0&&G[C].scaleInPlace(-1),q=Z[C-1],z.yS.Dot(q,Z[C])<0&&Z[C].scaleInPlace(-1)}let Q=0;const k=l&&I?I:()=>null!==g?g:0,W=l&&r?r:()=>null!==U?U:1;let N=V===C.d.NO_CAP||V===C.d.CAP_END?0:2;const u=z.TmpVectors.Matrix[0];for(let C=0;C<S.length;C++){const b=[],U=k(C,H[C]),g=W(C,H[C]);z.Matrix.RotationAxisToRef(R[C],Q,u);for(let v=0;v<q.length;v++){const U=R[C].scale(q[v].z).add(G[C].scale(q[v].x)).add(Z[C].scale(q[v].y)),r=z.yS.Zero();z.yS.TransformCoordinatesToRef(U,u,r),r.scaleInPlace(g).addInPlace(S[C]),b[v]=r}v[N]=b,Q+=U,N++}const X=T||(q=>{const S=Array(),b=z.yS.Zero();let C;for(C=0;C<q.length;C++)b.addInPlace(q[C]);for(b.scaleInPlace(1/q.length),C=0;C<q.length;C++)S.push(b);return S});switch(V){case C.d.NO_CAP:break;case C.d.CAP_START:v[0]=X(v[2]),v[1]=v[2];break;case C.d.CAP_END:v[N]=v[N-1],v[N+1]=X(v[N-1]);break;case C.d.CAP_ALL:v[0]=X(v[2]),v[1]=v[2],v[N]=v[N-1],v[N+1]=X(v[N-1])}return v};let t,f;if(Q){const q=Q._creationDataStorage;return t=u?q.path3D.update(b,u):q.path3D.update(b),f=B(S,b,q.path3D,q.pathArray,v,U,g,r,q.cap,R,X),Q=I("",{pathArray:f,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Q},G||void 0)}t=u?new E.m(b,u):new E.m(b);f=B(S,b,t,new Array,v,U,g,r,y=y<0||y>3?0:y,R,X);const m=I(q,{pathArray:f,closeArray:V,closePath:l,updatable:Z,sideOrientation:H,invertUV:k,frontUVs:W||void 0,backUVs:N||void 0},G);return m._creationDataStorage.pathArray=f,m._creationDataStorage.path3D=t,m._creationDataStorage.cap=y,m}function L(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=S.arc?S.arc<=0||S.arc>1?1:S.arc:1,U=void 0===S.closed||S.closed,g=S.shape,r=S.radius||1,V=S.tessellation||64,l=S.clip||0,y=S.updatable,R=C.d._GetDefaultSideOrientation(S.sideOrientation),G=S.cap||C.d.NO_CAP,Z=2*Math.PI,H=[],Q=S.invertUV||!1;let k=0,W=0;const N=Z/V*v;let u,X;for(k=0;k<=V-l;k++){for(X=[],G!=C.d.CAP_START&&G!=C.d.CAP_ALL||(X.push(new z.yS(0,g[0].y,0)),X.push(new z.yS(Math.cos(k*N)*g[0].x*r,g[0].y,Math.sin(k*N)*g[0].x*r))),W=0;W<g.length;W++)u=new z.yS(Math.cos(k*N)*g[W].x*r,g[W].y,Math.sin(k*N)*g[W].x*r),X.push(u);G!=C.d.CAP_END&&G!=C.d.CAP_ALL||(X.push(new z.yS(Math.cos(k*N)*g[g.length-1].x*r,g[g.length-1].y,Math.sin(k*N)*g[g.length-1].x*r)),X.push(new z.yS(0,g[g.length-1].y,0))),H.push(X)}return I(q,{pathArray:H,closeArray:U,sideOrientation:R,updatable:y,invertUV:Q,frontUVs:S.frontUVs,backUVs:S.backUVs},b)}C.d.ExtrudeShape=function(q,S,b,z,v,U){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0,V=arguments.length>9?arguments[9]:void 0;return e(q,{shape:S,path:b,scale:z,rotation:v,cap:0===U?0:U||C.d.NO_CAP,sideOrientation:I,instance:V,updatable:r},g)},C.d.ExtrudeShapeCustom=(q,S,b,z,v,U,g,r,I,V,l,y)=>i(q,{shape:S,path:b,scaleFunction:z,rotationFunction:v,ribbonCloseArray:U,ribbonClosePath:g,cap:0===r?0:r||C.d.NO_CAP,sideOrientation:l,instance:y,updatable:V},I);C.d.CreateLathe=(q,S,b,z,C,v,U)=>L(q,{shape:S,radius:b,tessellation:z,sideOrientation:U,updatable:v},C);var d=b(12379),K=b(12330);function D(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=S.path;let U=S.instance,g=1;void 0!==S.radius?g=S.radius:U&&(g=U._creationDataStorage.radius);const r=S.tessellation||64,V=S.radiusFunction||null;let l=S.cap||C.d.NO_CAP;const y=S.invertUV||!1,R=S.updatable,G=C.d._GetDefaultSideOrientation(S.sideOrientation);S.arc=S.arc&&(S.arc<=0||S.arc>1)?1:S.arc||1;const Z=(q,S,b,v,U,g,r,I)=>{const V=S.getTangents(),l=S.getNormals(),y=S.getDistances(),R=2*Math.PI/U*I,G=g||(()=>v);let Z,H,Q,k;const W=z.TmpVectors.Matrix[0];let N=r===C.d.NO_CAP||r===C.d.CAP_END?0:2;for(let C=0;C<q.length;C++){H=G(C,y[C]),Z=Array(),Q=l[C];for(let S=0;S<U;S++)z.Matrix.RotationAxisToRef(V[C],R*S,W),k=Z[S]?Z[S]:z.yS.Zero(),z.yS.TransformCoordinatesToRef(Q,W,k),k.scaleInPlace(H).addInPlace(q[C]),Z[S]=k;b[N]=Z,N++}const u=(S,b)=>{const z=Array();for(let C=0;C<S;C++)z.push(q[b]);return z};switch(r){case C.d.NO_CAP:break;case C.d.CAP_START:b[0]=u(U,0),b[1]=b[2].slice(0);break;case C.d.CAP_END:b[N]=b[N-1].slice(0),b[N+1]=u(U,q.length-1);break;case C.d.CAP_ALL:b[0]=u(U,0),b[1]=b[2].slice(0),b[N]=b[N-1].slice(0),b[N+1]=u(U,q.length-1)}return b};let H,Q;if(U){const q=U._creationDataStorage,b=S.arc||q.arc;return H=q.path3D.update(v),Q=Z(v,H,q.pathArray,g,q.tessellation,V,q.cap,b),U=I("",{pathArray:Q,instance:U}),q.path3D=H,q.pathArray=Q,q.arc=b,q.radius=g,U}H=new E.m(v);l=l<0||l>3?0:l,Q=Z(v,H,new Array,g,r,V,l,S.arc);const k=I(q,{pathArray:Q,closePath:!0,closeArray:!1,updatable:R,sideOrientation:G,invertUV:y,frontUVs:S.frontUVs,backUVs:S.backUVs},b);return k._creationDataStorage.pathArray=Q,k._creationDataStorage.path3D=H,k._creationDataStorage.tessellation=r,k._creationDataStorage.cap=l,k._creationDataStorage.arc=S.arc,k._creationDataStorage.radius=g,k}function x(q){const S=[];S[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},S[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},S[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},S[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},S[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},S[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},S[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},S[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},S[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},S[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},S[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},S[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},S[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},S[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},S[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const b=q.type&&(q.type<0||q.type>=S.length)?0:q.type||0,C=q.size,v=q.sizeX||C||1,r=q.sizeY||C||1,I=q.sizeZ||C||1,V=q.custom||S[b],l=V.face.length,R=q.faceUV||new Array(l),G=q.faceColors,Z=void 0===q.flat||q.flat,H=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,Q=[],k=[],W=[],N=[],u=[];let X=0,T=0;const B=[];let t,f,m,E,e,i,J=0,L=0;if(Z)for(L=0;L<l;L++)G&&void 0===G[L]&&(G[L]=new y.b(1,1,1,1)),R&&void 0===R[L]&&(R[L]=new z.Vector4(0,0,1,1));if(Z)for(L=0;L<l;L++){const q=V.face[L].length;for(m=2*Math.PI/q,E=.5*Math.tan(m/2),e=.5,J=0;J<q;J++)Q.push(V.vertex[V.face[L][J]][0]*v,V.vertex[V.face[L][J]][1]*r,V.vertex[V.face[L][J]][2]*I),B.push(X),X++,t=R[L].x+(R[L].z-R[L].x)*(.5+E),f=R[L].y+(R[L].w-R[L].y)*(e-.5),N.push(t,g.e?1-f:f),i=E*Math.cos(m)-e*Math.sin(m),e=E*Math.sin(m)+e*Math.cos(m),E=i,G&&u.push(G[L].r,G[L].g,G[L].b,G[L].a);for(J=0;J<q-2;J++)k.push(B[0+T],B[J+2+T],B[J+1+T]);T+=q}else{for(J=0;J<V.vertex.length;J++)Q.push(V.vertex[J][0]*v,V.vertex[J][1]*r,V.vertex[J][2]*I),N.push(0,g.e?1:0);for(L=0;L<l;L++)for(J=0;J<V.face[L].length-2;J++)k.push(V.face[L][0],V.face[L][J+2],V.face[L][J+1])}U.c.ComputeNormals(Q,k,W),U.c._ComputeSides(H,Q,k,W,N,q.frontUVs,q.backUVs);const d=new U.c;return d.tq=Q,d.indices=k,d.fq=W,d.Eq=N,G&&Z&&(d.mq=u),d}function F(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return x(S).iq(z,S.updatable),z}C.d.CreateTube=(q,S,b,z,C,v,U,g,r,I)=>D(q,{path:S,radius:b,tessellation:z,radiusFunction:C,arc:1,cap:v,updatable:g,sideOrientation:r,instance:I},U);function a(q){const S=q.sideOrientation||U.c.DEFAULTSIDE,b=q.radius||1,C=void 0===q.flat||q.flat,v=0|(q.subdivisions||4),r=q.radiusX||b,I=q.radiusY||b,V=q.radiusZ||b,l=(1+Math.sqrt(5))/2,y=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],R=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],G=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],H=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Q=[],k=[],W=[],N=[];let u=0;const X=new Array(3),T=new Array(3);let B;for(B=0;B<3;B++)X[B]=z.yS.Zero(),T[B]=z.Vector2.Zero();for(let U=0;U<20;U++){for(B=0;B<3;B++){const q=R[3*U+B];X[B].Bb(y[3*G[q]],y[3*G[q]+1],y[3*G[q]+2]),X[B].normalize(),T[B].Bb(.134765625*Z[2*q]+.05859375+-.0390625*H[U],.2333984375*Z[2*q+1]+.025390625+.01953125*H[U])}const q=(q,S,b,U)=>{const l=z.yS.Lerp(X[0],X[2],S/v),y=z.yS.Lerp(X[1],X[2],S/v),R=v===S?X[2]:z.yS.Lerp(l,y,q/(v-S));let G;if(R.normalize(),C){const q=z.yS.Lerp(X[0],X[2],U/v),S=z.yS.Lerp(X[1],X[2],U/v);G=z.yS.Lerp(q,S,b/(v-U))}else G=new z.yS(R.x,R.y,R.z);G.x/=r,G.y/=I,G.z/=V,G.normalize();const Z=z.Vector2.Lerp(T[0],T[2],S/v),H=z.Vector2.Lerp(T[1],T[2],S/v),B=v===S?T[2]:z.Vector2.Lerp(Z,H,q/(v-S));k.push(R.x*r,R.y*I,R.z*V),W.push(G.x,G.y,G.z),N.push(B.x,g.e?1-B.y:B.y),Q.push(u),u++};for(let S=0;S<v;S++)for(let b=0;b+S<v;b++)q(b,S,b+1/3,S+1/3),q(b+1,S,b+1/3,S+1/3),q(b,S+1,b+1/3,S+1/3),b+S+1<v&&(q(b+1,S,b+2/3,S+2/3),q(b+1,S+1,b+2/3,S+2/3),q(b,S+1,b+2/3,S+2/3))}U.c._ComputeSides(S,k,Q,W,N,q.frontUVs,q.backUVs);const t=new U.c;return t.indices=Q,t.tq=k,t.fq=W,t.Eq=N,t}function n(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.d(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),z._originalBuilderSideOrientation=S.sideOrientation;return a(S).iq(z,S.updatable),z}U.c.CreatePolyhedron=x,C.d.CreatePolyhedron=(q,S,b)=>F(q,S,b);U.c.CreateIcoSphere=a,C.d.CreateIcoSphere=(q,S,b)=>n(q,S,b);var o=b(11121);const s=new z.yS(1,0,0),A=new z.yS(-1,0,0),w=new z.yS(0,1,0),P=new z.yS(0,-1,0),h=new z.yS(0,0,1),O=new z.yS(0,0,-1);class j{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.yS.Zero(),S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.yS.Up(),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.Vector2.Zero(),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=q,this.normal=S,this.uv=b,this.vertexIdx=C,this.vertexIdxForBones=v,this.localPositionOverride=U,this.localNormalOverride=g,this.matrixIndicesOverride=r,this.matrixWeightsOverride=I}clone(){var q,S,b,z;return new j(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(q=this.localPositionOverride)||void 0===q?void 0:q.slice(),null===(S=this.localNormalOverride)||void 0===S?void 0:S.slice(),null===(b=this.matrixIndicesOverride)||void 0===b?void 0:b.slice(),null===(z=this.matrixWeightsOverride)||void 0===z?void 0:z.slice())}}function M(q,S,b){var r,I,V,l,y;const R=!!S.skeleton,G=!(null===(r=S.morphTargetManager)||void 0===r||!r.numTargets),Z=b.localMode||R,H=S.Xb(),Q=R||G?S.Vr(!0,!0):S.getVerticesData(v.f.PositionKind),k=R||G?S.getNormalsData(!0,!0):S.getVerticesData(v.f.NormalKind),W=Z?R?S.getVerticesData(v.f.PositionKind):Q:null,N=Z?R?S.getVerticesData(v.f.NormalKind):k:null,u=S.getVerticesData(v.f.UVKind),X=R?S.getVerticesData(v.f.MatricesIndicesKind):null,T=R?S.getVerticesData(v.f.MatricesWeightsKind):null,B=R?S.getVerticesData(v.f.MatricesIndicesExtraKind):null,t=R?S.getVerticesData(v.f.MatricesWeightsExtraKind):null,f=b.position||z.yS.Zero();let m=b.normal||z.yS.Up();const E=b.size||z.yS.One(),e=b.angle||0;if(!m){const q=new z.yS(0,0,1),b=S.Tq().activeCamera,C=z.yS.TransformCoordinates(q,b.getWorldMatrix());m=b.globalPosition.RS(C)}const i=-Math.atan2(m.z,m.x)-Math.PI/2,J=Math.sqrt(m.x*m.x+m.z*m.z),L=Math.atan2(m.y,J),d=new U.c;d.indices=[],d.tq=[],d.fq=[],d.Eq=[],d.matricesIndices=R?[]:null,d.matricesWeights=R?[]:null,d.matricesIndicesExtra=B?[]:null,d.matricesWeightsExtra=t?[]:null;let K=0;const D=(q,S)=>{const C=new j;if(!H||!Q||!k)return C;const v=H[q];if(C.vertexIdx=3*v,C.vertexIdxForBones=4*v,C.position=new z.yS(Q[3*v],Q[3*v+1],Q[3*v+2]),z.yS.TransformCoordinatesToRef(C.position,S,C.position),C.normal=new z.yS(k[3*v],k[3*v+1],k[3*v+2]),z.yS.TransformNormalToRef(C.normal,S,C.normal),b.captureUVS&&u){const q=u[2*v+1];C.uv=new z.Vector2(u[2*v],g.e?1-q:q)}return C},x=[0,0,0,0],F=(q,S)=>{if(0===q.length)return q;const b=.5*Math.abs(z.yS.Dot(E,S)),C=(q,S,b,z)=>{for(let C=0;C<z;++C)if(q[b+C]===S)return b+C;return-1},v=(q,v)=>{const U=z.yS.GetClipFactor(q.position,v.position,S,b);let g=x,r=x;if(X&&T){const S=q.matrixIndicesOverride?0:q.vertexIdxForBones,b=q.matrixIndicesOverride??X,z=q.matrixWeightsOverride??T,I=v.matrixIndicesOverride?0:v.vertexIdxForBones,V=v.matrixIndicesOverride??X,l=v.matrixWeightsOverride??T;g=[0,0,0,0],r=[0,0,0,0];let y=0;for(let q=0;q<4;++q)if(z[S+q]>0){const v=C(V,b[S+q],I,4);g[y]=b[S+q],r[y]=(0,o.Lerp)(z[S+q],v>=0?l[v]:0,U),y++}for(let q=0;q<4&&y<4;++q){const z=V[I+q];-1===C(b,z,S,4)&&(g[y]=z,r[y]=(0,o.Lerp)(0,l[I+q],U),y++)}const R=r[0]+r[1]+r[2]+r[3];r[0]/=R,r[1]/=R,r[2]/=R,r[3]/=R}const I=q.localPositionOverride?q.localPositionOverride[0]:(null===W||void 0===W?void 0:W[q.vertexIdx])??0,V=q.localPositionOverride?q.localPositionOverride[1]:(null===W||void 0===W?void 0:W[q.vertexIdx+1])??0,l=q.localPositionOverride?q.localPositionOverride[2]:(null===W||void 0===W?void 0:W[q.vertexIdx+2])??0,y=v.localPositionOverride?v.localPositionOverride[0]:(null===W||void 0===W?void 0:W[v.vertexIdx])??0,R=v.localPositionOverride?v.localPositionOverride[1]:(null===W||void 0===W?void 0:W[v.vertexIdx+1])??0,G=v.localPositionOverride?v.localPositionOverride[2]:(null===W||void 0===W?void 0:W[v.vertexIdx+2])??0,Z=q.localNormalOverride?q.localNormalOverride[0]:(null===N||void 0===N?void 0:N[q.vertexIdx])??0,H=q.localNormalOverride?q.localNormalOverride[1]:(null===N||void 0===N?void 0:N[q.vertexIdx+1])??0,Q=q.localNormalOverride?q.localNormalOverride[2]:(null===N||void 0===N?void 0:N[q.vertexIdx+2])??0,k=Z+((v.localNormalOverride?v.localNormalOverride[0]:(null===N||void 0===N?void 0:N[v.vertexIdx])??0)-Z)*U,u=H+((v.localNormalOverride?v.localNormalOverride[1]:(null===N||void 0===N?void 0:N[v.vertexIdx+1])??0)-H)*U,B=Q+((v.localNormalOverride?v.localNormalOverride[2]:(null===N||void 0===N?void 0:N[v.vertexIdx+2])??0)-Q)*U,t=Math.sqrt(k*k+u*u+B*B);return new j(z.yS.Lerp(q.position,v.position,U),z.yS.Lerp(q.normal,v.normal,U).normalize(),z.Vector2.Lerp(q.uv,v.uv,U),-1,-1,W?[I+(y-I)*U,V+(R-V)*U,l+(G-l)*U]:null,N?[k/t,u/t,B/t]:null,g,r)};let U=null;q.length>3&&(U=[]);for(let g=0;g<q.length;g+=3){let C=0,r=null,I=null,V=null,l=null;const y=z.yS.Dot(q[g].position,S)-b>0,R=z.yS.Dot(q[g+1].position,S)-b>0,G=z.yS.Dot(q[g+2].position,S)-b>0;switch(C=(y?1:0)+(R?1:0)+(G?1:0),C){case 0:q.length>3?(U.push(q[g]),U.push(q[g+1]),U.push(q[g+2])):U=q;break;case 1:if(U=U??new Array,y&&(r=q[g+1],I=q[g+2],V=v(q[g],r),l=v(q[g],I)),R){r=q[g],I=q[g+2],V=v(q[g+1],r),l=v(q[g+1],I),U.push(V),U.push(I.clone()),U.push(r.clone()),U.push(I.clone()),U.push(V.clone()),U.push(l);break}G&&(r=q[g],I=q[g+1],V=v(q[g+2],r),l=v(q[g+2],I)),r&&I&&V&&l&&(U.push(r.clone()),U.push(I.clone()),U.push(V),U.push(l),U.push(V.clone()),U.push(I.clone()));break;case 2:U=U??new Array,y||(r=q[g].clone(),I=v(r,q[g+1]),V=v(r,q[g+2]),U.push(r),U.push(I),U.push(V)),R||(r=q[g+1].clone(),I=v(r,q[g+2]),V=v(r,q[g]),U.push(r),U.push(I),U.push(V)),G||(r=q[g+2].clone(),I=v(r,q[g]),V=v(r,q[g+1]),U.push(r),U.push(I),U.push(V))}}return U},a=S instanceof C.d?S:null,n=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,M=(null===a||void 0===a?void 0:a.Eb)||1,p=z.TmpVectors.Matrix[0];p.v(z.Matrix.IdentityReadOnly);for(let C=0;C<M;++C){if(null!==a&&void 0!==a&&a.hasThinInstances&&n){const q=16*C;p.setRowFromFloats(0,n[q+0],n[q+1],n[q+2],n[q+3]),p.setRowFromFloats(1,n[q+4],n[q+5],n[q+6],n[q+7]),p.setRowFromFloats(2,n[q+8],n[q+9],n[q+10],n[q+11]),p.setRowFromFloats(3,n[q+12],n[q+13],n[q+14],n[q+15])}const q=z.Matrix.RotationYawPitchRoll(i,L,e).multiply(z.Matrix.Translation(f.x,f.y,f.z)),v=z.Matrix.Invert(q),U=S.getWorldMatrix(),r=p.multiply(U).multiply(v),I=new Array(3);for(let S=0;S<H.length;S+=3){let q=I;if(q[0]=D(S,r),q[1]=D(S+1,r),q[2]=D(S+2,r),!(b.cullBackFaces&&-q[0].normal.z<=0&&-q[1].normal.z<=0&&-q[2].normal.z<=0)&&(q=F(q,s),q&&(q=F(q,A),q&&(q=F(q,w),q&&(q=F(q,P),q&&(q=F(q,h),q&&(q=F(q,O),q)))))))for(let S=0;S<q.length;S++){const z=q[S];if(d.indices.push(K),Z?(z.localPositionOverride?(d.tq[3*K]=z.localPositionOverride[0],d.tq[3*K+1]=z.localPositionOverride[1],d.tq[3*K+2]=z.localPositionOverride[2]):W&&(d.tq[3*K]=W[z.vertexIdx],d.tq[3*K+1]=W[z.vertexIdx+1],d.tq[3*K+2]=W[z.vertexIdx+2]),z.localNormalOverride?(d.fq[3*K]=z.localNormalOverride[0],d.fq[3*K+1]=z.localNormalOverride[1],d.fq[3*K+2]=z.localNormalOverride[2]):N&&(d.fq[3*K]=N[z.vertexIdx],d.fq[3*K+1]=N[z.vertexIdx+1],d.fq[3*K+2]=N[z.vertexIdx+2])):(z.position.toArray(d.tq,3*K),z.normal.toArray(d.fq,3*K)),d.matricesIndices&&d.matricesWeights&&(z.matrixIndicesOverride?(d.matricesIndices[4*K]=z.matrixIndicesOverride[0],d.matricesIndices[4*K+1]=z.matrixIndicesOverride[1],d.matricesIndices[4*K+2]=z.matrixIndicesOverride[2],d.matricesIndices[4*K+3]=z.matrixIndicesOverride[3]):(X&&(d.matricesIndices[4*K]=X[z.vertexIdxForBones],d.matricesIndices[4*K+1]=X[z.vertexIdxForBones+1],d.matricesIndices[4*K+2]=X[z.vertexIdxForBones+2],d.matricesIndices[4*K+3]=X[z.vertexIdxForBones+3]),B&&d.matricesIndicesExtra&&(d.matricesIndicesExtra[4*K]=B[z.vertexIdxForBones],d.matricesIndicesExtra[4*K+1]=B[z.vertexIdxForBones+1],d.matricesIndicesExtra[4*K+2]=B[z.vertexIdxForBones+2],d.matricesIndicesExtra[4*K+3]=B[z.vertexIdxForBones+3])),z.matrixWeightsOverride?(d.matricesWeights[4*K]=z.matrixWeightsOverride[0],d.matricesWeights[4*K+1]=z.matrixWeightsOverride[1],d.matricesWeights[4*K+2]=z.matrixWeightsOverride[2],d.matricesWeights[4*K+3]=z.matrixWeightsOverride[3]):(T&&(d.matricesWeights[4*K]=T[z.vertexIdxForBones],d.matricesWeights[4*K+1]=T[z.vertexIdxForBones+1],d.matricesWeights[4*K+2]=T[z.vertexIdxForBones+2],d.matricesWeights[4*K+3]=T[z.vertexIdxForBones+3]),t&&d.matricesWeightsExtra&&(d.matricesWeightsExtra[4*K]=t[z.vertexIdxForBones],d.matricesWeightsExtra[4*K+1]=t[z.vertexIdxForBones+1],d.matricesWeightsExtra[4*K+2]=t[z.vertexIdxForBones+2],d.matricesWeightsExtra[4*K+3]=t[z.vertexIdxForBones+3]))),b.captureUVS)z.uv.toArray(d.Eq,2*K);else{d.Eq.push(.5+z.position.x/E.x);const q=.5+z.position.y/E.y;d.Eq.push(g.e?1-q:q)}K++}}}0===d.indices.length&&(d.indices=null),0===d.tq.length&&(d.tq=null),0===d.fq.length&&(d.fq=null),0===d.Eq.length&&(d.Eq=null),0===(null===(I=d.matricesIndices)||void 0===I?void 0:I.length)&&(d.matricesIndices=null),0===(null===(V=d.matricesWeights)||void 0===V?void 0:V.length)&&(d.matricesWeights=null),0===(null===(l=d.matricesIndicesExtra)||void 0===l?void 0:l.length)&&(d.matricesIndicesExtra=null),0===(null===(y=d.matricesWeightsExtra)||void 0===y?void 0:y.length)&&(d.matricesWeightsExtra=null);const Y=new C.d(q,S.Tq());return d.iq(Y),Z?(Y.skeleton=S.skeleton,Y.parent=S):(Y.position=f.clone(),Y.rotation=new z.yS(L,i,e)),Y.Nb(!0),Y.refreshBoundingInfo(!0,!0),Y}function p(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const S=0|Math.max(q.subdivisions?q.subdivisions:2,1),b=0|Math.max(q.tessellation?q.tessellation:16,3),C=Math.max(q.height?q.height:1,0),v=Math.max(q.radius?q.radius:.25,0),r=0|Math.max(q.capSubdivisions?q.capSubdivisions:6,1),I=b,V=S,l=Math.max(q.radiusTop?q.radiusTop:v,0),y=Math.max(q.radiusBottom?q.radiusBottom:v,0),R=C-(l+y),G=2*Math.PI,Z=Math.max(q.topCapSubdivisions?q.topCapSubdivisions:r,1),H=Math.max(q.bottomCapSubdivisions?q.bottomCapSubdivisions:r,1),Q=Math.acos((y-l)/C);let k=[];const W=[],N=[],u=[];let X=0;const T=[],B=.5*R,t=.5*Math.PI;let f,m;const E=z.yS.Zero(),e=z.yS.Zero(),i=Math.cos(Q),J=Math.sin(Q),L=new z.Vector2(l*J,B+l*i).RS(new z.Vector2(y*J,y*i-B)).length(),d=l*Q+L+y*(t-Q);let K=0;for(m=0;m<=Z;m++){const q=[],S=t-Q*(m/Z);K+=l*Q/Z;const b=Math.cos(S),z=Math.sin(S),C=b*l;for(f=0;f<=I;f++){const S=f/I,v=S*G+0,U=Math.sin(v),r=Math.cos(v);e.x=C*U,e.y=B+z*l,e.z=C*r,W.push(e.x,e.y,e.z),E.set(b*U,z,b*r),N.push(E.x,E.y,E.z),u.push(S,g.e?K/d:1-K/d),q.push(X),X++}T.push(q)}const D=C-l-y+i*l-i*y,x=J*(y-l)/D;for(m=1;m<=V;m++){const q=[];K+=L/V;const S=J*(m*(y-l)/V+l);for(f=0;f<=I;f++){const b=f/I,z=b*G+0,C=Math.sin(z),v=Math.cos(z);e.x=S*C,e.y=B+i*l-m*D/V,e.z=S*v,W.push(e.x,e.y,e.z),E.set(C,x,v).normalize(),N.push(E.x,E.y,E.z),u.push(b,g.e?K/d:1-K/d),q.push(X),X++}T.push(q)}for(m=1;m<=H;m++){const q=[],S=t-Q-(Math.PI-Q)*(m/H);K+=y*Q/H;const b=Math.cos(S),z=Math.sin(S),C=b*y;for(f=0;f<=I;f++){const S=f/I,v=S*G+0,U=Math.sin(v),r=Math.cos(v);e.x=C*U,e.y=z*y-B,e.z=C*r,W.push(e.x,e.y,e.z),E.set(b*U,z,b*r),N.push(E.x,E.y,E.z),u.push(S,g.e?K/d:1-K/d),q.push(X),X++}T.push(q)}for(f=0;f<I;f++)for(m=0;m<Z+V+H;m++){const q=T[m][f],S=T[m+1][f],b=T[m+1][f+1],z=T[m][f+1];k.push(q),k.push(S),k.push(z),k.push(S),k.push(b),k.push(z)}if(k=k.reverse(),q.orientation&&!q.orientation.equals(z.yS.Up())){const S=new z.Matrix;q.orientation.clone().scale(.5*Math.PI).cross(z.yS.Up()).toQuaternion().toRotationMatrix(S);const b=z.yS.Zero();for(let q=0;q<W.length;q+=3)b.set(W[q],W[q+1],W[q+2]),z.yS.TransformCoordinatesToRef(b.clone(),S,b),W[q]=b.x,W[q+1]=b.y,W[q+2]=b.z}const F=new U.c;return F.tq=W,F.fq=N,F.Eq=u,F.indices=k,F}function Y(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:z.yS.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=new C.d(q,b);return p(S).iq(v,S.updatable),v}C.d.CreateDecal=(q,S,b,z,C,v)=>M(q,S,{position:b,normal:z,size:C,angle:v});C.d.CreateCapsule=(q,S,b)=>Y(q,S,b),U.c.CreateCapsule=p;var c=b(10943),qq=b(11109);class Sq{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=S,q!==Math.floor(q)&&(q=Math.floor(q),c.b.Warn("x is not an integer, floor(x) used")),S!==Math.floor(S)&&(S=Math.floor(S),c.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Sq(this.x,this.y)}rotate60About(q){const S=this.x;return this.x=q.x+q.y-this.y,this.y=S+this.y-q.x,this}rotateNeg60About(q){const S=this.x;return this.x=S+this.y-q.y,this.y=q.x+q.y-S,this}rotate120(q,S){q!==Math.floor(q)&&(q=Math.floor(q),c.b.Warn("m not an integer only floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),c.b.Warn("n not an integer only floor(n) used"));const b=this.x;return this.x=q-b-this.y,this.y=S+b,this}rotateNeg120(q,S){q!==Math.floor(q)&&(q=Math.floor(q),c.b.Warn("m is not an integer, floor(m) used")),S!==Math.floor(S)&&(S=Math.floor(S),c.b.Warn("n is not an integer,   floor(n) used"));const b=this.x;return this.x=this.y-S,this.y=q+S-b-this.y,this}toCartesianOrigin(q,S){const b=z.yS.Zero();return b.x=q.x+2*this.x*S+this.y*S,b.y=q.y+Math.sqrt(3)*this.y*S,b}static Zero(){return new Sq(0,0)}}class bq{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new zq("icosahedron","Regular",[[0,qq.g,-1],[-qq.g,1,0],[-1,0,-qq.g],[1,0,-qq.g],[qq.g,1,0],[0,qq.g,1],[-1,0,qq.g],[-qq.g,-1,0],[0,-qq.g,-1],[qq.g,-1,0],[1,0,qq.g],[0,-qq.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let q=12;const S={},b=this.m,z=this.n;let C,v,U,g,r,I=b,V=1,l=0;0!==z&&(I=(0,o.HighestCommonFactor)(b,z)),V=b/I,l=z/I;const y=Sq.Zero(),R=new Sq(b,z),G=new Sq(-z,b+z),Z=Sq.Zero(),H=Sq.Zero(),Q=Sq.Zero();let k,W,N,u,X=[];const T=[],B=this.vertByDist,t=(b,z,C,v)=>{k=b+"|"+C,W=z+"|"+v,k in S||W in S?k in S&&!(W in S)?S[W]=S[k]:W in S&&!(k in S)&&(S[k]=S[W]):(S[k]=q,S[W]=q,q++),B[C][0]>2?T[S[k]]=[-B[C][0],B[C][1],S[k]]:T[S[k]]=[X[B[C][0]],B[C][1],S[k]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let f=0;f<20;f++){if(X=this.IDATA.face[f],U=X[2],g=X[1],r=X[0],N=y.x+"|"+y.y,k=f+"|"+N,k in S||(S[k]=U,T[U]=[X[B[N][0]],B[N][1]]),N=R.x+"|"+R.y,k=f+"|"+N,k in S||(S[k]=g,T[g]=[X[B[N][0]],B[N][1]]),N=G.x+"|"+G.y,k=f+"|"+N,k in S||(S[k]=r,T[r]=[X[B[N][0]],B[N][1]]),C=this.IDATA.edgematch[f][0],v=this.IDATA.edgematch[f][1],"B"===v)for(let q=1;q<I;q++)H.x=b-q*(V+l),H.y=z+q*V,Q.x=-q*l,Q.y=q*(V+l),N=H.x+"|"+H.y,u=Q.x+"|"+Q.y,t(f,C,N,u);if("O"===v)for(let q=1;q<I;q++)Q.x=-q*l,Q.y=q*(V+l),Z.x=q*V,Z.y=q*l,N=Q.x+"|"+Q.y,u=Z.x+"|"+Z.y,t(f,C,N,u);if(C=this.IDATA.edgematch[f][2],v=this.IDATA.edgematch[f][3],v&&"A"===v)for(let q=1;q<I;q++)Z.x=q*V,Z.y=q*l,H.x=b-(I-q)*(V+l),H.y=z+(I-q)*V,N=Z.x+"|"+Z.y,u=H.x+"|"+H.y,t(f,C,N,u);for(let b=0;b<this.vertices.length;b++)N=this.vertices[b].x+"|"+this.vertices[b].y,k=f+"|"+N,k in S||(S[k]=q++,B[N][0]>2?T[S[k]]=[-B[N][0],B[N][1],S[k]]:T[S[k]]=[X[B[N][0]],B[N][1],S[k]])}this.closestTo=T,this.vecToidx=S}calcCoeffs(){const q=this.m,S=this.n,b=Math.sqrt(3)/3,z=q*q+S*S+q*S;this.coau=(q+S)/z,this.cobu=-S/z,this.coav=-b*(q-S)/z,this.cobv=b*(2*q+S)/z}createInnerFacets(){const q=this.m,S=this.n;for(let b=0;b<S+q+1;b++)for(let q=this.min[b];q<this.max[b]+1;q++)q<this.max[b]&&q<this.max[b+1]+1&&this.innerFacets.push(["|"+q+"|"+b,"|"+q+"|"+(b+1),"|"+(q+1)+"|"+b]),b>0&&q<this.max[b-1]&&q+1<this.max[b]+1&&this.innerFacets.push(["|"+q+"|"+b,"|"+(q+1)+"|"+b,"|"+(q+1)+"|"+(b-1)])}edgeVecsABOB(){const q=this.m,S=this.n,b=new Sq(-S,q+S);for(let z=1;z<q+S;z++){const q=new Sq(this.min[z],z),S=new Sq(this.min[z-1],z-1),C=new Sq(this.min[z+1],z+1),v=q.clone(),U=S.clone(),g=C.clone();v.rotate60About(b),U.rotate60About(b),g.rotate60About(b);const r=new Sq(this.max[v.y],v.y),I=new Sq(this.max[v.y-1],v.y-1),V=new Sq(this.max[v.y-1]-1,v.y-1);v.x===r.x&&v.y===r.y||(v.x!==I.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,I,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,V,r])):v.y===g.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,S,I]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([q,I,C])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([q,S,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([q,I,r])))}}mapABOBtoOBOA(){const q=new Sq(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const b=[];for(let z=0;z<3;z++)q.x=this.isoVecsABOB[S][z].x,q.y=this.isoVecsABOB[S][z].y,0===this.vertexTypes[S][z]&&q.rotateNeg120(this.m,this.n),b.push(q.clone());this.isoVecsOBOA.push(b)}}mapABOBtoBAOA(){const q=new Sq(0,0);for(let S=0;S<this.isoVecsABOB.length;S++){const b=[];for(let z=0;z<3;z++)q.x=this.isoVecsABOB[S][z].x,q.y=this.isoVecsABOB[S][z].y,1===this.vertexTypes[S][z]&&q.rotate120(this.m,this.n),b.push(q.clone());this.isoVecsBAOA.push(b)}}MapToFace(q,S){const b=this.IDATA.face[q],C=b[2],v=b[1],U=b[0],g=z.yS.Hb(this.IDATA.vertex[C]),r=z.yS.Hb(this.IDATA.vertex[v]),I=z.yS.Hb(this.IDATA.vertex[U]),V=r.RS(g),l=I.RS(g),y=V.scale(this.coau).add(l.scale(this.cobu)),R=V.scale(this.coav).add(l.scale(this.cobv)),G=[];let Z,H=z.TmpVectors.yS[0];for(let z=0;z<this.cartesian.length;z++)H=y.scale(this.cartesian[z].x).add(R.scale(this.cartesian[z].y)).add(g),G[z]=[H.x,H.y,H.z],Z=q+"|"+this.vertices[z].x+"|"+this.vertices[z].y,S.vertex[this.vecToidx[Z]]=[H.x,H.y,H.z]}build(q,S){const b=[],z=Sq.Zero(),C=new Sq(q,S),v=new Sq(-S,q+S);b.push(z,C,v);for(let N=S;N<q+1;N++)for(let S=0;S<q+1-N;S++)b.push(new Sq(S,N));if(S>0){const z=(0,o.HighestCommonFactor)(q,S),C=q/z,v=S/z;for(let g=1;g<z;g++)b.push(new Sq(g*C,g*v)),b.push(new Sq(-g*v,g*(C+v))),b.push(new Sq(q-g*(C+v),S+g*C));const U=q/S;for(let g=1;g<S;g++)for(let z=0;z<g*U;z++)b.push(new Sq(z,g)),b.push(new Sq(z,g).rotate120(q,S)),b.push(new Sq(z,g).rotateNeg120(q,S))}b.sort(((q,S)=>q.x-S.x)),b.sort(((q,S)=>q.y-S.y));const U=new Array(q+S+1),g=new Array(q+S+1);for(let N=0;N<U.length;N++)U[N]=1/0,g[N]=-1/0;let r=0,I=0;const V=b.length;for(let N=0;N<V;N++)I=b[N].x,r=b[N].y,U[r]=Math.min(I,U[r]),g[r]=Math.max(I,g[r]);const l=(b,z)=>{const C=b.clone();return"A"===z&&C.rotateNeg120(q,S),"B"===z&&C.rotate120(q,S),C.x<0?C.y:C.x+C.y},y=[],R=[],G=[],Z=[],H={},Q=[];let k=-1,W=-1;for(let N=0;N<V;N++)y[N]=b[N].toCartesianOrigin(new Sq(0,0),.5),R[N]=l(b[N],"O"),G[N]=l(b[N],"A"),Z[N]=l(b[N],"B"),R[N]===G[N]&&G[N]===Z[N]?(k=3,W=R[N]):R[N]===G[N]?(k=4,W=R[N]):G[N]===Z[N]?(k=5,W=G[N]):Z[N]===R[N]&&(k=6,W=R[N]),R[N]<G[N]&&R[N]<Z[N]&&(k=2,W=R[N]),G[N]<R[N]&&G[N]<Z[N]&&(k=1,W=G[N]),Z[N]<G[N]&&Z[N]<R[N]&&(k=0,W=Z[N]),Q.push([k,W,b[N].x,b[N].y]);Q.sort(((q,S)=>q[2]-S[2])),Q.sort(((q,S)=>q[3]-S[3])),Q.sort(((q,S)=>q[1]-S[1])),Q.sort(((q,S)=>q[0]-S[0]));for(let N=0;N<Q.length;N++)H[Q[N][2]+"|"+Q[N][3]]=[Q[N][0],Q[N][1],N];return this.m=q,this.n=S,this.vertices=b,this.vertByDist=H,this.cartesian=y,this.min=U,this.max=g,this}}class zq{constructor(q,S,b,z){this.name=q,this.category=S,this.vertex=b,this.face=z}}class Cq extends zq{innerToData(q,S){for(let b=0;b<S.innerFacets.length;b++)this.face.push(S.innerFacets[b].map((b=>S.vecToidx[q+b])))}mapABOBtoDATA(q,S){const b=S.IDATA.edgematch[q][0];for(let z=0;z<S.isoVecsABOB.length;z++){const C=[];for(let v=0;v<3;v++)0===S.vertexTypes[z][v]?C.push(q+"|"+S.isoVecsABOB[z][v].x+"|"+S.isoVecsABOB[z][v].y):C.push(b+"|"+S.isoVecsABOB[z][v].x+"|"+S.isoVecsABOB[z][v].y);this.face.push([S.vecToidx[C[0]],S.vecToidx[C[1]],S.vecToidx[C[2]]])}}mapOBOAtoDATA(q,S){const b=S.IDATA.edgematch[q][0];for(let z=0;z<S.isoVecsOBOA.length;z++){const C=[];for(let v=0;v<3;v++)1===S.vertexTypes[z][v]?C.push(q+"|"+S.isoVecsOBOA[z][v].x+"|"+S.isoVecsOBOA[z][v].y):C.push(b+"|"+S.isoVecsOBOA[z][v].x+"|"+S.isoVecsOBOA[z][v].y);this.face.push([S.vecToidx[C[0]],S.vecToidx[C[1]],S.vecToidx[C[2]]])}}mapBAOAtoDATA(q,S){const b=S.IDATA.edgematch[q][2];for(let z=0;z<S.isoVecsBAOA.length;z++){const C=[];for(let v=0;v<3;v++)1===S.vertexTypes[z][v]?C.push(q+"|"+S.isoVecsBAOA[z][v].x+"|"+S.isoVecsBAOA[z][v].y):C.push(b+"|"+S.isoVecsBAOA[z][v].x+"|"+S.isoVecsBAOA[z][v].y);this.face.push([S.vecToidx[C[0]],S.vecToidx[C[1]],S.vecToidx[C[2]]])}}orderData(q){const S=[];for(let v=0;v<13;v++)S[v]=[];const b=q.closestTo;for(let v=0;v<b.length;v++)b[v][0]>-1?b[v][1]>0&&S[b[v][0]].push([v,b[v][1]]):S[12].push([v,b[v][0]]);const z=[];for(let v=0;v<12;v++)z[v]=v;let C=12;for(let v=0;v<12;v++){S[v].sort(((q,S)=>q[1]-S[1]));for(let q=0;q<S[v].length;q++)z[S[v][q][0]]=C++}for(let v=0;v<S[12].length;v++)z[S[12][v][0]]=C++;for(let v=0;v<this.vertex.length;v++)this.vertex[v].push(z[v]);this.vertex.sort(((q,S)=>q[3]-S[3]));for(let v=0;v<this.vertex.length;v++)this.vertex[v].pop();for(let v=0;v<this.face.length;v++)for(let q=0;q<this.face[v].length;q++)this.face[v][q]=z[this.face[v][q]];this.sharedNodes=S[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(q,S){const b=[],z=[];let C=S.pop();z.push(C);let v=this.face[C].indexOf(q);v=(v+2)%3;let U=this.face[C][v];b.push(U);let g=0;for(;S.length>0;)C=S[g],this.face[C].indexOf(U)>-1?(v=(this.face[C].indexOf(U)+1)%3,U=this.face[C][v],b.push(U),z.push(C),S.splice(g,1),g=0):g++;return this.adjacentFaces.push(b),z}toGoldbergPolyhedronData(){const q=new zq("GeoDual","Goldberg",[],[]);q.name="GD dual";const S=this.vertex.length,b=new Array(S);for(let r=0;r<S;r++)b[r]=[];for(let r=0;r<this.face.length;r++)for(let q=0;q<3;q++)b[this.face[r][q]].push(r);let z=0,C=0,v=0,U=[],g=[];this.adjacentFaces=[];for(let r=0;r<b.length;r++){q.face[r]=this.setOrder(r,b[r].concat([]));for(const S of b[r]){z=0,C=0,v=0,U=this.face[S];for(let q=0;q<3;q++)g=this.vertex[U[q]],z+=g[0],C+=g[1],v+=g[2];q.vertex[S]=[z/3,C/3,v/3]}}return q}static BuildGeodesicData(q){const S=new Cq("Geodesic-m-n","Geodesic",[[0,qq.g,-1],[-qq.g,1,0],[-1,0,-qq.g],[1,0,-qq.g],[qq.g,1,0],[0,qq.g,1],[-1,0,qq.g],[-qq.g,-1,0],[0,-qq.g,-1],[qq.g,-1,0],[1,0,qq.g],[0,-qq.g,1]],[]);q.setIndices(),q.calcCoeffs(),q.createInnerFacets(),q.edgeVecsABOB(),q.mapABOBtoOBOA(),q.mapABOBtoBAOA();for(let b=0;b<q.IDATA.face.length;b++)q.MapToFace(b,S),S.innerToData(b,q),"B"===q.IDATA.edgematch[b][1]&&S.mapABOBtoDATA(b,q),"O"===q.IDATA.edgematch[b][1]&&S.mapOBOAtoDATA(b,q),"A"===q.IDATA.edgematch[b][3]&&S.mapBAOAtoDATA(b,q);S.orderData(q);return S.vertex=S.vertex.map((function(q){const S=q[0],b=q[1],z=q[2],C=Math.sqrt(S*S+b*b+z*z);return q[0]*=1/C,q[1]*=1/C,q[2]*=1/C,q})),S}}C.d._GoldbergMeshParser=(q,S)=>vq.Parse(q,S);class vq extends C.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(q,S){return void 0===S?(q>this.goldbergData.nbUnsharedFaces-1&&(c.b.Warn("Maximum number of unshared faces used"),q=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+q):(q>11&&(c.b.Warn("Last pole used"),q=11),S>this.goldbergData.nbFacesAtPole-1&&(c.b.Warn("Maximum number of faces at a pole used"),S=this.goldbergData.nbFacesAtPole-1),12+q*this.goldbergData.nbFacesAtPole+S)}_changeGoldbergFaceColors(q){for(let b=0;b<q.length;b++){const S=q[b][0],z=q[b][1],C=q[b][2];for(let q=S;q<z+1;q++)this.goldbergData.faceColors[q]=C}const S=[];for(let b=0;b<12;b++)for(let q=0;q<5;q++)S.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);for(let b=12;b<this.goldbergData.faceColors.length;b++)for(let q=0;q<6;q++)S.push(this.goldbergData.faceColors[b].r,this.goldbergData.faceColors[b].g,this.goldbergData.faceColors[b].b,this.goldbergData.faceColors[b].a);return S}setGoldbergFaceColors(q){const S=this._changeGoldbergFaceColors(q);this.Kq(v.f.ColorKind,S)}updateGoldbergFaceColors(q){const S=this._changeGoldbergFaceColors(q);this.updateVerticesData(v.f.ColorKind,S)}_changeGoldbergFaceUVs(q){const S=this.getVerticesData(v.f.UVKind);for(let b=0;b<q.length;b++){const z=q[b][0],C=q[b][1],v=q[b][2],U=q[b][3],g=q[b][4],r=[],I=[];let V,l;for(let q=0;q<5;q++)V=v.x+U*Math.cos(g+q*Math.PI/2.5),l=v.y+U*Math.sin(g+q*Math.PI/2.5),V<0&&(V=0),V>1&&(V=1),r.push(V,l);for(let q=0;q<6;q++)V=v.x+U*Math.cos(g+q*Math.PI/3),l=v.y+U*Math.sin(g+q*Math.PI/3),V<0&&(V=0),V>1&&(V=1),I.push(V,l);for(let q=z;q<Math.min(12,C+1);q++)for(let b=0;b<5;b++)S[10*q+2*b]=r[2*b],S[10*q+2*b+1]=r[2*b+1];for(let q=Math.max(12,z);q<C+1;q++)for(let b=0;b<6;b++)S[12*q-24+2*b]=I[2*b],S[12*q-23+2*b]=I[2*b+1]}return S}setGoldbergFaceUVs(q){const S=this._changeGoldbergFaceUVs(q);this.Kq(v.f.UVKind,S)}updateGoldbergFaceUVs(q){const S=this._changeGoldbergFaceUVs(q);this.updateVerticesData(v.f.UVKind,S)}placeOnGoldbergFaceAt(q,S,b){const C=z.yS.RotationFromAxis(this.goldbergData.faceXaxis[S],this.goldbergData.faceYaxis[S],this.goldbergData.faceZaxis[S]);q.rotation=C,q.position=this.goldbergData.faceCenters[S].add(this.goldbergData.faceXaxis[S].scale(b.x)).add(this.goldbergData.faceYaxis[S].scale(b.y)).add(this.goldbergData.faceZaxis[S].scale(b.z))}serialize(q){super.serialize(q),q.type="GoldbergMesh";const S={};if(S.adjacentFaces=this.goldbergData.adjacentFaces,S.nbSharedFaces=this.goldbergData.nbSharedFaces,S.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,S.nbFaces=this.goldbergData.nbFaces,S.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){S.faceColors=[];for(const q of this.goldbergData.faceColors)S.faceColors.push(q.Zb())}if(this.goldbergData.faceCenters){S.faceCenters=[];for(const q of this.goldbergData.faceCenters)S.faceCenters.push(q.Zb())}if(this.goldbergData.faceZaxis){S.faceZaxis=[];for(const q of this.goldbergData.faceZaxis)S.faceZaxis.push(q.Zb())}if(this.goldbergData.faceYaxis){S.faceYaxis=[];for(const q of this.goldbergData.faceYaxis)S.faceYaxis.push(q.Zb())}if(this.goldbergData.faceXaxis){S.faceXaxis=[];for(const q of this.goldbergData.faceXaxis)S.faceXaxis.push(q.Zb())}q.goldbergData=S}static Parse(q,S){const b=q.goldbergData;b.faceColors=b.faceColors.map((q=>y.b.Hb(q))),b.faceCenters=b.faceCenters.map((q=>z.yS.Hb(q))),b.faceZaxis=b.faceZaxis.map((q=>z.yS.Hb(q))),b.faceXaxis=b.faceXaxis.map((q=>z.yS.Hb(q))),b.faceYaxis=b.faceYaxis.map((q=>z.yS.Hb(q)));const C=new vq(q.name,S);return C.goldbergData=b,C}}var Uq=b(11667);const gq={CreateBox:l.e,CreateTiledBox:H,CreateSphere:Q.c,CreateDisc:V.c,CreateIcoSphere:n,CreateRibbon:I,CreateCylinder:u,CreateTorus:T,CreateTorusKnot:t,CreateLineSystem:f.h,FI:f.l,CreateDashedLines:f.d,ExtrudeShape:e,ExtrudeShapeCustom:i,CreateLathe:L,CreateTiledPlane:G,nI:d.d,CreateGround:K.c,CreateTiledGround:K.d,CreateGroundFromHeightMap:K.b,CreatePolygon:m.d,ExtrudePolygon:m.g,CreateTube:D,CreatePolyhedron:F,CreateGeodesic:function(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=S.m||1;z!==Math.floor(z)&&(z=Math.floor(z),c.b.Warn("m not an integer only floor(m) used"));let C=S.n||0;if(C!==Math.floor(C)&&(C=Math.floor(C),c.b.Warn("n not an integer only floor(n) used")),C>z){const q=C;C=z,z=q,c.b.Warn("n > m therefore m and n swapped")}const v=new bq;return v.build(z,C),F(q,{custom:Cq.BuildGeodesicData(v),size:S.size,sizeX:S.sizeX,sizeY:S.sizeY,sizeZ:S.sizeZ,faceUV:S.faceUV,faceColors:S.faceColors,flat:S.flat,updatable:S.updatable,sideOrientation:S.sideOrientation,frontUVs:S.frontUVs,backUVs:S.backUVs},b)},CreateGoldberg:function(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=S.size,r=S.sizeX||v||1,I=S.sizeY||v||1,V=S.sizeZ||v||1;let l=S.m||1;l!==Math.floor(l)&&(l=Math.floor(l),c.b.Warn("m not an integer only floor(m) used"));let R=S.n||0;if(R!==Math.floor(R)&&(R=Math.floor(R),c.b.Warn("n not an integer only floor(n) used")),R>l){const q=R;R=l,l=q,c.b.Warn("n > m therefore m and n swapped")}const G=new bq;G.build(l,R);const Z=Cq.BuildGeodesicData(G),H=Z.toGoldbergPolyhedronData(),Q=new vq(q,b);S.sideOrientation=C.d._GetDefaultSideOrientation(S.sideOrientation),Q._originalBuilderSideOrientation=S.sideOrientation;(function(q,S){const b=q.size,C=q.sizeX||b||1,v=q.sizeY||b||1,r=q.sizeZ||b||1,I=0===q.sideOrientation?0:q.sideOrientation||U.c.DEFAULTSIDE,V=[],l=[],y=[],R=[];let G=1/0,Z=-1/0,H=1/0,Q=-1/0;for(let z=0;z<S.vertex.length;z++)G=Math.min(G,S.vertex[z][0]*C),Z=Math.max(Z,S.vertex[z][0]*C),H=Math.min(H,S.vertex[z][1]*v),Q=Math.max(Q,S.vertex[z][1]*v);let k=0;for(let U=0;U<S.face.length;U++){const q=S.face[U],b=z.yS.Hb(S.vertex[q[0]]),I=z.yS.Hb(S.vertex[q[2]]),W=z.yS.Hb(S.vertex[q[1]]),N=I.RS(b),u=W.RS(b),X=z.yS.Cross(u,N).normalize();for(let z=0;z<q.length;z++){y.push(X.x,X.y,X.z);const b=S.vertex[q[z]];V.push(b[0]*C,b[1]*v,b[2]*r);const U=(b[1]*v-H)/(Q-H);R.push((b[0]*C-G)/(Z-G),g.e?1-U:U)}for(let S=0;S<q.length-2;S++)l.push(k,k+S+2,k+S+1);k+=q.length}U.c._ComputeSides(I,V,l,y,R);const W=new U.c;return W.tq=V,W.indices=l,W.fq=y,W.Eq=R,W})(S,H).iq(Q,S.updatable),Q.goldbergData.nbSharedFaces=Z.sharedNodes,Q.goldbergData.nbUnsharedFaces=Z.poleNodes,Q.goldbergData.adjacentFaces=Z.adjacentFaces,Q.goldbergData.nbFaces=Q.goldbergData.nbSharedFaces+Q.goldbergData.nbUnsharedFaces,Q.goldbergData.nbFacesAtPole=(Q.goldbergData.nbUnsharedFaces-12)/12;for(let C=0;C<Z.vertex.length;C++)Q.goldbergData.faceCenters.push(z.yS.Hb(Z.vertex[C])),Q.goldbergData.faceCenters[C].x*=r,Q.goldbergData.faceCenters[C].y*=I,Q.goldbergData.faceCenters[C].z*=V,Q.goldbergData.faceColors.push(new y.b(1,1,1,1));for(let C=0;C<H.face.length;C++){const q=H.face[C],S=z.yS.Hb(H.vertex[q[0]]),b=z.yS.Hb(H.vertex[q[2]]),v=z.yS.Hb(H.vertex[q[1]]),U=b.RS(S),g=v.RS(S),r=z.yS.Cross(g,U).normalize(),I=z.yS.Cross(g,r).normalize();Q.goldbergData.faceXaxis.push(g.normalize()),Q.goldbergData.faceYaxis.push(r),Q.goldbergData.faceZaxis.push(I)}return Q},CreateDecal:M,CreateCapsule:Y,CreateText:Uq.g}},12404:(q,S,b)=>{"use strict";b.d(S,{b:()=>gS});var z=b(11103),C=b(11496);class v extends C.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var U=b(11150),g=(b(11275),b(11058));class r{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this._targetStopDuration!==q&&(this._targetStopDuration=q)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){this._noiseTexture!==q&&(this._noiseTexture=q,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(q){this._isAnimationSheetEnabled!=q&&(this._isAnimationSheetEnabled=q,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){this._useLogarithmicDepth=q&&this.Tq().getEngine().getCaps().fragmentDepthSupported}Tq(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(q){switch(q){case r.BLENDMODE_MULTIPLYADD:return;case r.BLENDMODE_ADD:q=1;break;case r.BLENDMODE_ONEONE:q=6;break;case r.BLENDMODE_STANDARD:q=2;break;case r.BLENDMODE_MULTIPLY:q=4;break;case r.BLENDMODE_SUBTRACT:q=3}this._engine.setAlphaMode(q)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.yS.Zero()}set direction1(q){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=q)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.yS.Zero()}set direction2(q){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=q)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.yS.Zero()}set minEmitBox(q){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=q)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.yS.Zero()}set maxEmitBox(q){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=q)}get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(q){this._isBillboardBased!==q&&(this._isBillboardBased=q,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q)}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(!q&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=q)}_reset(){}_removeGradientAndTexture(q,S,b){if(!S)return this;let z=0;for(const C of S){if(C.gradient===q){S.splice(z,1);break}z++}return b&&b.dispose(),this}constructor(q){this.animations=[],this.renderingGroupId=0,this.j=z.yS.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new z.yS(10,10,10),this.onAnimationEnd=null,this.blendMode=r.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new z.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.KI=new z.yS(0,0,0),this._useLogarithmicDepth=!1,this.gravity=z.yS.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new U.b(1,1,1,1),this.color2=new U.b(1,1,1,1),this.colorDead=new U.b(0,0,0,1),this.textureMask=new U.b(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new v,this.id=q,this.name=q}createPointEmitter(q,S){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new z.yS(0,1,0),arguments.length>2&&void 0!==arguments[2]||new z.yS(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new z.yS(0,1,0),arguments.length>4&&void 0!==arguments[4]||new z.yS(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new z.yS(0,1,0),arguments.length>3&&void 0!==arguments[3]||new z.yS(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(q,S,b,z){throw new Error("Method not implemented.")}}r.BLENDMODE_ONEONE=0,r.BLENDMODE_STANDARD=1,r.BLENDMODE_ADD=2,r.BLENDMODE_MULTIPLY=3,r.BLENDMODE_MULTIPLYADD=4,r.BLENDMODE_SUBTRACT=-1,(0,g.f)("BABYLON.BaseParticleSystem",r);var I=b(11121),V=b(10948);class l{constructor(){this.direction1=new z.yS(0,1,0),this.direction2=new z.yS(0,1,0),this.minEmitBox=new z.yS(-.5,-.5,-.5),this.maxEmitBox=new z.yS(.5,.5,.5)}startDirectionFunction(q,S,b,C){const v=(0,I.RandomRange)(this.direction1.x,this.direction2.x),U=(0,I.RandomRange)(this.direction1.y,this.direction2.y),g=(0,I.RandomRange)(this.direction1.z,this.direction2.z);if(C)return S.x=v,S.y=U,void(S.z=g);z.yS.TransformNormalFromFloatsToRef(v,U,g,q,S)}startPositionFunction(q,S,b,C){const v=(0,I.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),U=(0,I.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),g=(0,I.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(C)return S.x=v,S.y=U,void(S.z=g);z.yS.TransformCoordinatesFromFloatsToRef(v,U,g,q,S)}clone(){const q=new l;return V.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2),q.setVector3("minEmitBox",this.minEmitBox),q.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3),q.addUniform("minEmitBox",3),q.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Zb(),q.direction2=this.direction2.Zb(),q.minEmitBox=this.minEmitBox.Zb(),q.maxEmitBox=this.maxEmitBox.Zb(),q}parse(q){z.yS.FromArrayToRef(q.direction1,0,this.direction1),z.yS.FromArrayToRef(q.direction2,0,this.direction2),z.yS.FromArrayToRef(q.minEmitBox,0,this.minEmitBox),z.yS.FromArrayToRef(q.maxEmitBox,0,this.maxEmitBox)}}class y{get radius(){return this._radius}set radius(q){this._radius=q,this._buildHeight()}get angle(){return this._angle}set angle(q){this._angle=q,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=b,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=S,this.radius=q}startDirectionFunction(q,S,b,C){C?z.TmpVectors.yS[0].v(b.Nr).normalize():b.position.subtractToRef(q.getTranslation(),z.TmpVectors.yS[0]).normalize();const v=(0,I.RandomRange)(0,this.directionRandomizer),U=(0,I.RandomRange)(0,this.directionRandomizer),g=(0,I.RandomRange)(0,this.directionRandomizer);S.x=z.TmpVectors.yS[0].x+v,S.y=z.TmpVectors.yS[0].y+U,S.z=z.TmpVectors.yS[0].z+g,S.normalize()}startPositionFunction(q,S,b,C){const v=(0,I.RandomRange)(0,2*Math.PI);let U;this.emitFromSpawnPointOnly?U=1e-4:(U=(0,I.RandomRange)(0,this.heightRange),U=1-U*U);let g=this._radius-(0,I.RandomRange)(0,this._radius*this.radiusRange);g*=U;const r=g*Math.sin(v),V=g*Math.cos(v),l=U*this._height;if(C)return S.x=r,S.y=l,void(S.z=V);z.yS.TransformCoordinatesFromFloatsToRef(r,l,V,q,S)}clone(){const q=new y(this._radius,this._angle,this.directionRandomizer);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat2("radius",this._radius,this.radiusRange),q.setFloat("coneAngle",this._angle),q.setFloat2("height",this._height,this.heightRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",2),q.addUniform("coneAngle",1),q.addUniform("height",2),q.addUniform("directionRandomizer",1)}getEffectDefines(){let q="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(q+="\n#define CONEEMITTERSPAWNPOINT"),q}getClassName(){return"ConeParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this._radius,q.angle=this._angle,q.directionRandomizer=this.directionRandomizer,q.radiusRange=this.radiusRange,q.heightRange=this.heightRange,q.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,q}parse(q){this.radius=q.radius,this.angle=q.angle,this.directionRandomizer=q.directionRandomizer,this.radiusRange=void 0!==q.radiusRange?q.radiusRange:1,this.heightRange=void 0!==q.radiusRange?q.heightRange:1,this.emitFromSpawnPointOnly=void 0!==q.emitFromSpawnPointOnly&&q.emitFromSpawnPointOnly}}class R extends y{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0);super(q,S),this.direction1=b,this.direction2=C}startDirectionFunction(q,S){const b=(0,I.RandomRange)(this.direction1.x,this.direction2.x),C=(0,I.RandomRange)(this.direction1.y,this.direction2.y),v=(0,I.RandomRange)(this.direction1.z,this.direction2.z);z.yS.TransformNormalFromFloatsToRef(b,C,v,q,S)}clone(){const q=new R(this.radius,this.angle,this.direction1,this.direction2);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Zb(),q.direction2=this.direction2.Zb(),q}parse(q){super.parse(q),this.direction1.v(q.direction1),this.direction2.v(q.direction2)}}class G{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=q,this.height=S,this.radiusRange=b,this.directionRandomizer=C,this._tempVector=z.yS.Zero()}startDirectionFunction(q,S,b,C,v){b.position.subtractToRef(q.getTranslation(),this._tempVector),this._tempVector.normalize(),z.yS.TransformNormalToRef(this._tempVector,v,this._tempVector);const U=(0,I.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=U,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),C?S.v(this._tempVector):z.yS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q,S)}startPositionFunction(q,S,b,C){const v=(0,I.RandomRange)(-this.height/2,this.height/2),U=(0,I.RandomRange)(0,2*Math.PI),g=(0,I.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),r=Math.sqrt(g)*this.radius,V=r*Math.cos(U),l=r*Math.sin(U);C?S.Bb(V,v,l):z.yS.TransformCoordinatesFromFloatsToRef(V,v,l,q,S)}clone(){const q=new G(this.radius,this.directionRandomizer);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.height=this.height,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.height=q.height,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class Z extends G{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0),v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.yS(0,1,0);super(q,S,b),this.direction1=C,this.direction2=v}startDirectionFunction(q,S,b,C){const v=(0,I.RandomRange)(this.direction1.x,this.direction2.x),U=(0,I.RandomRange)(this.direction1.y,this.direction2.y),g=(0,I.RandomRange)(this.direction1.z,this.direction2.z);C?S.Bb(v,U,g):z.yS.TransformNormalFromFloatsToRef(v,U,g,q,S)}clone(){const q=new Z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("height",this.height),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("height",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Zb(),q.direction2=this.direction2.Zb(),q}parse(q){super.parse(q),z.yS.FromArrayToRef(q.direction1,0,this.direction1),z.yS.FromArrayToRef(q.direction2,0,this.direction2)}}class H{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=S,this.directionRandomizer=b}startDirectionFunction(q,S,b,C){const v=b.position.RS(q.getTranslation()).normalize(),U=(0,I.RandomRange)(0,this.directionRandomizer),g=(0,I.RandomRange)(0,this.directionRandomizer),r=(0,I.RandomRange)(0,this.directionRandomizer);v.x+=U,v.y+=g,v.z+=r,v.normalize(),C?S.v(v):z.yS.TransformNormalFromFloatsToRef(v.x,v.y,v.z,q,S)}startPositionFunction(q,S,b,C){const v=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),U=(0,I.RandomRange)(0,1),g=(0,I.RandomRange)(0,2*Math.PI),r=Math.acos(2*U-1),V=v*Math.cos(g)*Math.sin(r),l=v*Math.cos(r),y=v*Math.sin(g)*Math.sin(r);C?S.Bb(V,Math.abs(l),y):z.yS.TransformCoordinatesFromFloatsToRef(V,Math.abs(l),y,q,S)}clone(){const q=new H(this.radius,this.directionRandomizer);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class Q{constructor(){this.direction1=new z.yS(0,1,0),this.direction2=new z.yS(0,1,0)}startDirectionFunction(q,S,b,C){const v=(0,I.RandomRange)(this.direction1.x,this.direction2.x),U=(0,I.RandomRange)(this.direction1.y,this.direction2.y),g=(0,I.RandomRange)(this.direction1.z,this.direction2.z);C?S.Bb(v,U,g):z.yS.TransformNormalFromFloatsToRef(v,U,g,q,S)}startPositionFunction(q,S,b,C){C?S.Bb(0,0,0):z.yS.TransformCoordinatesFromFloatsToRef(0,0,0,q,S)}clone(){const q=new Q;return V.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.direction1=this.direction1.Zb(),q.direction2=this.direction2.Zb(),q}parse(q){z.yS.FromArrayToRef(q.direction1,0,this.direction1),z.yS.FromArrayToRef(q.direction2,0,this.direction2)}}class k{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=q,this.radiusRange=S,this.directionRandomizer=b}startDirectionFunction(q,S,b,C){const v=b.position.RS(q.getTranslation()).normalize(),U=(0,I.RandomRange)(0,this.directionRandomizer),g=(0,I.RandomRange)(0,this.directionRandomizer),r=(0,I.RandomRange)(0,this.directionRandomizer);v.x+=U,v.y+=g,v.z+=r,v.normalize(),C?S.v(v):z.yS.TransformNormalFromFloatsToRef(v.x,v.y,v.z,q,S)}startPositionFunction(q,S,b,C){const v=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),U=(0,I.RandomRange)(0,1),g=(0,I.RandomRange)(0,2*Math.PI),r=Math.acos(2*U-1),V=v*Math.cos(g)*Math.sin(r),l=v*Math.cos(r),y=v*Math.sin(g)*Math.sin(r);C?S.Bb(V,l,y):z.yS.TransformCoordinatesFromFloatsToRef(V,l,y,q,S)}clone(){const q=new k(this.radius,this.directionRandomizer);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.radius=this.radius,q.radiusRange=this.radiusRange,q.directionRandomizer=this.directionRandomizer,q}parse(q){this.radius=q.radius,this.radiusRange=q.radiusRange,this.directionRandomizer=q.directionRandomizer}}class W extends k{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.yS(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0);super(q),this.direction1=S,this.direction2=b}startDirectionFunction(q,S){const b=(0,I.RandomRange)(this.direction1.x,this.direction2.x),C=(0,I.RandomRange)(this.direction1.y,this.direction2.y),v=(0,I.RandomRange)(this.direction1.z,this.direction2.z);z.yS.TransformNormalFromFloatsToRef(b,C,v,q,S)}clone(){const q=new W(this.radius,this.direction1,this.direction2);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setFloat("radius",this.radius),q.setFloat("radiusRange",this.radiusRange),q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("radius",1),q.addUniform("radiusRange",1),q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const q=super.serialize();return q.direction1=this.direction1.Zb(),q.direction2=this.direction2.Zb(),q}parse(q){super.parse(q),this.direction1.v(q.direction1),this.direction2.v(q.direction2)}}class N{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(q,S,b,C){const v=z.TmpVectors.yS[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,b,v);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,b,v);const q=z.TmpVectors.yS[1];v.subtractToRef(b.position,q),q.scaleToRef(1/b.lifeTime,v)}else v.set(0,0,0);C?S.v(v):z.yS.TransformNormalToRef(v,q,S)}startPositionFunction(q,S,b,C){const v=z.TmpVectors.yS[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,b,v):v.set(0,0,0),C?S.v(v):z.yS.TransformCoordinatesToRef(v,q,S)}clone(){const q=new N;return V.d.DeepCopy(this,q),q}applyToShader(q){}buildUniformLayout(q){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const q={};return q.type=this.getClassName(),q.particlePositionGenerator=this.particlePositionGenerator,q.particleDestinationGenerator=this.particleDestinationGenerator,q}parse(q){q.particlePositionGenerator&&(this.particlePositionGenerator=q.particlePositionGenerator),q.particleDestinationGenerator&&(this.particleDestinationGenerator=q.particleDestinationGenerator)}}var u=b(11172);class X{get mesh(){return this._mesh}set mesh(q){this._mesh!==q&&(this._mesh=q,q?(this._indices=q.Xb(),this._positions=q.getVerticesData(u.f.PositionKind),this._normals=q.getVerticesData(u.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.yS.Zero(),this._mesh=null,this.direction1=new z.yS(0,1,0),this.direction2=new z.yS(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=q}startDirectionFunction(q,S,b,C){if(this.useMeshNormalsForDirection&&this._normals)return void z.yS.TransformNormalToRef(this._storedNormal,q,S);const v=(0,I.RandomRange)(this.direction1.x,this.direction2.x),U=(0,I.RandomRange)(this.direction1.y,this.direction2.y),g=(0,I.RandomRange)(this.direction1.z,this.direction2.z);C?S.Bb(v,U,g):z.yS.TransformNormalFromFloatsToRef(v,U,g,q,S)}startPositionFunction(q,S,b,C){if(!this._indices||!this._positions)return;const v=3*(Math.random()*(this._indices.length/3)|0),U=Math.random(),g=Math.random()*(1-U),r=1-U-g,I=this._indices[v],V=this._indices[v+1],l=this._indices[v+2],y=z.TmpVectors.yS[0],R=z.TmpVectors.yS[1],G=z.TmpVectors.yS[2],Z=z.TmpVectors.yS[3];z.yS.FromArrayToRef(this._positions,3*I,y),z.yS.FromArrayToRef(this._positions,3*V,R),z.yS.FromArrayToRef(this._positions,3*l,G),Z.x=U*y.x+g*R.x+r*G.x,Z.y=U*y.y+g*R.y+r*G.y,Z.z=U*y.z+g*R.z+r*G.z,C?S.Bb(Z.x,Z.y,Z.z):z.yS.TransformCoordinatesFromFloatsToRef(Z.x,Z.y,Z.z,q,S),this.useMeshNormalsForDirection&&this._normals&&(z.yS.FromArrayToRef(this._normals,3*I,y),z.yS.FromArrayToRef(this._normals,3*V,R),z.yS.FromArrayToRef(this._normals,3*l,G),this._storedNormal.x=U*y.x+g*R.x+r*G.x,this._storedNormal.y=U*y.y+g*R.y+r*G.y,this._storedNormal.z=U*y.z+g*R.z+r*G.z)}clone(){const q=new X(this.mesh);return V.d.DeepCopy(this,q),q}applyToShader(q){q.setVector3("direction1",this.direction1),q.setVector3("direction2",this.direction2)}buildUniformLayout(q){q.addUniform("direction1",3),q.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var q;const S={};return S.type=this.getClassName(),S.direction1=this.direction1.Zb(),S.direction2=this.direction2.Zb(),S.meshId=null===(q=this.mesh)||void 0===q?void 0:q.id,S.useMeshNormalsForDirection=this.useMeshNormalsForDirection,S}parse(q,S){z.yS.FromArrayToRef(q.direction1,0,this.direction1),z.yS.FromArrayToRef(q.direction2,0,this.direction2),q.meshId&&S&&(this.mesh=S.getLastMeshById(q.meshId)),this.useMeshNormalsForDirection=q.useMeshNormalsForDirection}}class T{_isUbo(q){return void 0!==q.addUniform}constructor(q){this._isUbo(q)?(this.setMatrix3x3=q.updateMatrix3x3.bind(q),this.setMatrix2x2=q.updateMatrix2x2.bind(q),this.setFloat=q.updateFloat.bind(q),this.setFloat2=q.updateFloat2.bind(q),this.setFloat3=q.updateFloat3.bind(q),this.setFloat4=q.updateFloat4.bind(q),this.setFloatArray=q.updateFloatArray.bind(q),this.setArray=q.updateArray.bind(q),this.setIntArray=q.updateIntArray.bind(q),this.setMatrix=q.Wb.bind(q),this.setMatrices=q.updateMatrices.bind(q),this.setVector3=q.updateVector3.bind(q),this.setVector4=q.updateVector4.bind(q),this.setColor3=q.updateColor3.bind(q),this.setColor4=q.updateColor4.bind(q),this.setDirectColor4=q.updateDirectColor4.bind(q),this.setInt=q.updateInt.bind(q),this.setInt2=q.updateInt2.bind(q),this.setInt3=q.updateInt3.bind(q),this.setInt4=q.updateInt4.bind(q)):(this.setMatrix3x3=q.setMatrix3x3.bind(q),this.setMatrix2x2=q.setMatrix2x2.bind(q),this.setFloat=q.setFloat.bind(q),this.setFloat2=q.setFloat2.bind(q),this.setFloat3=q.setFloat3.bind(q),this.setFloat4=q.setFloat4.bind(q),this.setFloatArray=q.setFloatArray.bind(q),this.setArray=q.setArray.bind(q),this.setIntArray=q.setIntArray.bind(q),this.setMatrix=q.setMatrix.bind(q),this.setMatrices=q.setMatrices.bind(q),this.setVector3=q.setVector3.bind(q),this.setVector4=q.setVector4.bind(q),this.setColor3=q.setColor3.bind(q),this.setColor4=q.setColor4.bind(q),this.setDirectColor4=q.setDirectColor4.bind(q),this.setInt=q.setInt.bind(q),this.setInt2=q.setInt2.bind(q),this.setInt3=q.setInt3.bind(q),this.setInt4=q.setInt4.bind(q))}}var B=b(11017);const t="gpuUpdateParticlesPixelShader",f="#version 300 es\nvoid main() {discard;}\n";B.d.ShadersStore[t]||(B.d.ShadersStore[t]=f);const m="gpuUpdateParticlesVertexShader",E="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";B.d.ShadersStore[m]||(B.d.ShadersStore[m]=E);(0,g.f)("BABYLON.WebGL2ParticleSystem",class{constructor(q,S){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=q,this._engine=S,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var q;return(null===(q=this._updateEffect)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof N&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=q,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new T(this._updateEffect)}createVertexBuffers(q,S){this._updateVAO.push(this._createUpdateVAO(q)),this._renderVAO.push(this._engine.recordVertexArrayObject(S,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=S}createParticleBuffer(q){return q}bindDrawBuffers(q,S,b){b?this._engine.bindBuffers(this._renderVertexBuffers,b,S):this._engine.bindVertexArrayObject(this._renderVAO[q],null)}preUpdateParticleBuffer(){const q=this._engine;if(this._engine.enableEffect(this._updateEffect),!q.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(q,S,b){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[q],null);const z=this._engine;z.bindTransformFeedbackBuffer(S.getBuffer()),z.setRasterizerState(!1),z.beginTransformFeedback(!0),z.drawArraysType(3,0,b),z.endTransformFeedback(),z.setRasterizerState(!0),z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let q=0;q<this._updateVAO.length;q++)this._engine.releaseVertexArrayObject(this._updateVAO[q]);this._updateVAO.length=0;for(let q=0;q<this._renderVAO.length;q++)this._engine.releaseVertexArrayObject(this._renderVAO[q]);this._renderVAO.length=0}_createUpdateVAO(q){const S={};S.position=q.createVertexBuffer("position",0,3);let b=3;S.age=q.createVertexBuffer("age",b,1),b+=1,S.size=q.createVertexBuffer("size",b,3),b+=3,S.life=q.createVertexBuffer("life",b,1),b+=1,S.seed=q.createVertexBuffer("seed",b,4),b+=4,S.direction=q.createVertexBuffer("direction",b,3),b+=3,this._parent.particleEmitterType instanceof N&&(S.initialPosition=q.createVertexBuffer("initialPosition",b,3),b+=3),this._parent._colorGradientsTexture||(S.color=q.createVertexBuffer("color",b,4),b+=4),this._parent._isBillboardBased||(S.initialDirection=q.createVertexBuffer("initialDirection",b,3),b+=3),this._parent.noiseTexture&&(S.noiseCoordinates1=q.createVertexBuffer("noiseCoordinates1",b,3),b+=3,S.noiseCoordinates2=q.createVertexBuffer("noiseCoordinates2",b,3),b+=3),this._parent._angularSpeedGradientsTexture?(S.angle=q.createVertexBuffer("angle",b,1),b+=1):(S.angle=q.createVertexBuffer("angle",b,2),b+=2),this._parent._isAnimationSheetEnabled&&(S.cellIndex=q.createVertexBuffer("cellIndex",b,1),b+=1,this._parent.spriteRandomStartCell&&(S.cellStartOffset=q.createVertexBuffer("cellStartOffset",b,1),b+=1));const z=this._engine.recordVertexArrayObject(S,null,this._updateEffect);return this._engine.bindArrayBuffer(null),z}});class e{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3?arguments[3]:void 0;this._engine=q,this._label=z,this._engine._storageBuffers.push(this),this._create(S,b)}_create(q,S){this._bufferSize=q,this._creationFlags=S,this._buffer=this._engine.createStorageBuffer(q,S,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(q,S,b){this._buffer&&this._engine.updateStorageBuffer(this._buffer,q,S,b)}async read(q,S,b,z){return await this._engine.readFromStorageBuffer(this._buffer,q,S,b,z)}dispose(){const q=this._engine._storageBuffers,S=q.indexOf(this);-1!==S&&(q[S]=q[q.length-1],q.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var i=b(11081),J=b(11090),L=b(11137),d=b(11075),K=b(11401),D=b(10943),x=b(11039),F=b(11321);class a{constructor(){this._gpuTimeInFrameId=-1,this.counter=new F.b}_addDuration(q,S){q<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==q?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(S,!1),this._gpuTimeInFrameId=q):this.counter.addCount(S,!1))}}var n=b(11e3);class o{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=q,this._engine=S,this.uniqueId=K.c.UniqueId,S.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new a),this._engine.getCaps().supportComputeShaders?z.bindingsMapping?(this._context=S.createComputeContext(),this._shaderPath=b,this._options={bindingsMapping:{},defines:[],...z}):D.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):D.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(q,S){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this._bindings[q];this._bindings[q]={type:b?0:4,object:S,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!z||z.object!==S||z.type!==this._bindings[q].type)}setStorageTexture(q,S){const b=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==S),this._bindings[q]={type:1,object:S,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setExternalTexture(q,S){const b=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==S),this._bindings[q]={type:6,object:S,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setVideoTexture(q,S){return!!S.externalTexture&&(this.setExternalTexture(q,S.externalTexture),!0)}setUniformBuffer(q,S){const b=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==S),this._bindings[q]={type:o._BufferIsDataBuffer(S)?7:2,object:S,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setStorageBuffer(q,S){const b=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==S),this._bindings[q]={type:o._BufferIsDataBuffer(S)?7:3,object:S,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}setTextureSampler(q,S){const b=this._bindings[q];this._contextIsDirty||(this._contextIsDirty=!b||!S.compareSampler(b.object)),this._bindings[q]={type:5,object:S,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries}}isReady(){let q=this._effect;for(const C in this._bindings){const q=this._bindings[C],S=q.type,b=q.object;switch(S){case 0:case 4:case 1:if(!b.isReady())return!1;break;case 6:if(!b.isReady())return!1;break}}const S=[],b=this._shaderPath;if(this._options.defines)for(let C=0;C<this._options.defines.length;C++)S.push(this._options.defines[C]);const z=S.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,q=this._engine.createComputeEffect(b,{defines:z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=q),!!q.isReady()}dispatch(q,S,b){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,q,S,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const b=o._BufferIsDataBuffer(q)?q:q.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,S,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const S in this._bindings){const b=this._bindings[S];if(!this._options.bindingsMapping[S])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+S+"'");switch(b.type){case 0:{const z=this._samplers[S],C=b.object;var q;if(!z||!C._texture||!z.compareSampler(C._texture))this._samplers[S]=(new x.b).setParameters(C.wrapU,C.wrapV,C.wrapR,C.anisotropicFilteringLevel,C._texture.samplingMode,null===(q=C._texture)||void 0===q?void 0:q._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const q=b.object;q.getBuffer()!==b.buffer&&(b.buffer=q.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((C=>{(0,n.f)((()=>this.dispatch(q,S,b)),C,void 0,z)}))}serialize(){const q=L.b.Serialize(this);q.options=this._options,q.shaderPath=this._shaderPath,q.uy={},q.textures={};for(const S in this._bindings){const b=this._bindings[S],z=b.object;switch(b.type){case 0:case 4:case 1:{const C=z.serialize();C&&(q.textures[S]=C,q.uy[S]={type:b.type});break}}}return q}static Parse(q,S,b){const z=L.b.Parse((()=>new o(q.name,S.getEngine(),q.shaderPath,q.options)),q,S,b);for(const C in q.textures){const v=q.uy[C],U=d.e.Parse(q.textures[C],S,b);0===v.type?z.setTexture(C,U):4===v.type?z.setTexture(C,U,!1):z.setStorageTexture(C,U)}return z}static _BufferIsDataBuffer(q){return void 0!==q.underlyingResource}}(0,i.e)([(0,J.J)()],o.prototype,"name",void 0),(0,i.e)([(0,J.J)()],o.prototype,"fastMode",void 0),(0,g.f)("BABYLON.ComputeShader",o);var s=b(11366);const A="gpuUpdateParticlesComputeShader",w="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";B.d.ShadersStoreWGSL[A]||(B.d.ShadersStoreWGSL[A]=w);(0,g.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(q,S){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=q,this._engine=S}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var q;return(null===(q=this._updateComputeShader)||void 0===q?void 0:q.isReady())??!1}createUpdateBuffer(q){var S;const b={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(b.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(b.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(b.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(b.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(b.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(b.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(b.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new o("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:b,defines:q.split("\n")}),null===(S=this._simParamsComputeShader)||void 0===S||S.dispose(),this._simParamsComputeShader=new s.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new T(this._simParamsComputeShader)}createVertexBuffers(q,S){this._renderVertexBuffers.push(S)}createParticleBuffer(q){const S=new e(this._engine,4*q.length,11,"ComputeShaderParticleSystemBuffer");return S.update(q),this._bufferComputeShader.push(S),S.getBuffer()}bindDrawBuffers(q,S,b){this._engine.bindBuffers(this._renderVertexBuffers[q],b,S)}preUpdateParticleBuffer(){}updateParticleBuffer(q,S,b){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[q]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^q]),this._updateComputeShader.dispatch(Math.ceil(b/64))}releaseBuffers(){var q;for(let S=0;S<this._bufferComputeShader.length;++S)this._bufferComputeShader[S].dispose();this._bufferComputeShader.length=0,null===(q=this._simParamsComputeShader)||void 0===q||q.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class P{constructor(q,S,b){this.gradient=q,this.color1=S,this.color2=b}getColorToRef(q){this.color2?U.b.LerpToRef(this.color1,this.color2,Math.random(),q):q.v(this.color1)}}class h{constructor(q,S){this.gradient=q,this.color=S}}class O{constructor(q,S,b){this.gradient=q,this.factor1=S,this.factor2=b}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class j{static GetCurrentGradient(q,S,b){if(S[0].gradient>q)return void b(S[0],S[0],1);for(let C=0;C<S.length-1;C++){const z=S[C],v=S[C+1];if(q>=z.gradient&&q<=v.gradient){return void b(z,v,(q-z.gradient)/(v.gradient-z.gradient))}}const z=S.length-1;b(S[z],S[z],1)}}var M=b(10929),p=b(11573),Y=b(10975);class c{constructor(q){this.particleSystem=q,this.position=z.yS.Zero(),this.direction=z.yS.Zero(),this.color=new U.b(0,0,0,0),this.colorStep=new U.b(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new U.b(0,0,0,0),this._currentColor2=new U.b(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=c._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let q=this.age,S=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===S?(S=1,q=this._randomCellOffset):q+=this._randomCellOffset);const b=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let z;z=this._initialSpriteCellLoop?(0,I.Clamp)(q*S%this.lifeTime/this.lifeTime):(0,I.Clamp)(q*S/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+z*b|0}_inheritParticleInfoToSubEmitter(q){if(q.particleSystem.j.position){const S=q.particleSystem.j;if(S.position.v(this.position),q.inheritDirection){const q=z.TmpVectors.yS[0];this.direction.normalizeToRef(q),S.setDirection(q,0,Math.PI/2)}}else{q.particleSystem.j.v(this.position)}this.direction.scaleToRef(q.inheritedVelocityAmount/2,z.TmpVectors.yS[0]),q.particleSystem._inheritedVelocityOffset.v(z.TmpVectors.yS[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const q of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(q)}_reset(){this.age=0,this.id=c._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(q){q.position.v(this.position),this._initialDirection?q._initialDirection?q._initialDirection.v(this._initialDirection):q._initialDirection=this._initialDirection.clone():q._initialDirection=null,q.direction.v(this.direction),this.Nr&&(q.Nr?q.Nr.v(this.Nr):q.Nr=this.Nr.clone()),q.color.v(this.color),q.colorStep.v(this.colorStep),q.lifeTime=this.lifeTime,q.age=this.age,q._randomCellOffset=this._randomCellOffset,q.size=this.size,q.scale.v(this.scale),q.angle=this.angle,q.angularSpeed=this.angularSpeed,q.particleSystem=this.particleSystem,q.cellIndex=this.cellIndex,q.id=this.id,q._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(q._currentColorGradient=this._currentColorGradient,q._currentColor1.v(this._currentColor1),q._currentColor2.v(this._currentColor2)),this._currentSizeGradient&&(q._currentSizeGradient=this._currentSizeGradient,q._currentSize1=this._currentSize1,q._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(q._currentAngularSpeedGradient=this._currentAngularSpeedGradient,q._currentAngularSpeed1=this._currentAngularSpeed1,q._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(q._currentVelocityGradient=this._currentVelocityGradient,q._currentVelocity1=this._currentVelocity1,q._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(q._currentLimitVelocityGradient=this._currentLimitVelocityGradient,q._currentLimitVelocity1=this._currentLimitVelocity1,q._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(q._currentDragGradient=this._currentDragGradient,q._currentDrag1=this._currentDrag1,q._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(q._initialStartSpriteCellId=this._initialStartSpriteCellId,q._initialEndSpriteCellId=this._initialEndSpriteCellId,q._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(q.remapData&&this.remapData?q.remapData.v(this.remapData):q.remapData=new z.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.v(this._randomNoiseCoordinates1),q._randomNoiseCoordinates2.v(this._randomNoiseCoordinates2)):(q._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),q._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}c._Count=0;var qq=b(11220),Sq=(b(11269),b(11476)),bq=b(11468),zq=b(11362);function Cq(q,S){const b=(0,I.RandomRange)(0,1);U.b.LerpToRef(S.color1,S.color2,b,q.color),S.colorDead.subtractToRef(q.color,S._colorDiff),S._colorDiff.scaleToRef(1/q.lifeTime,q.colorStep)}function vq(q,S){q._currentColorGradient=S._colorGradients[0],q._currentColorGradient.getColorToRef(q.color),q._currentColor1.v(q.color),S._colorGradients.length>1?S._colorGradients[1].getColorToRef(q._currentColor2):q._currentColor2.v(q.color)}function Uq(q,S){const b=S._colorGradients;j.GetCurrentGradient(S._ratio,b,((S,b,z)=>{S!==q._currentColorGradient&&(q._currentColor1.v(q._currentColor2),b.getColorToRef(q._currentColor2),q._currentColorGradient=S),U.b.LerpToRef(q._currentColor1,q._currentColor2,z,q.color)}))}function gq(q,S){q.colorStep.scaleToRef(S._scaledUpdateSpeed,S._scaledColorStep),q.color.addInPlace(S._scaledColorStep),q.color.a<0&&(q.color.a=0)}function rq(q,S){j.GetCurrentGradient(S._ratio,S._angularSpeedGradients,((S,b,z)=>{S!==q._currentAngularSpeedGradient&&(q._currentAngularSpeed1=q._currentAngularSpeed2,q._currentAngularSpeed2=b.getFactor(),q._currentAngularSpeedGradient=S),q.angularSpeed=(0,I.Lerp)(q._currentAngularSpeed1,q._currentAngularSpeed2,z)}))}function Iq(q,S){q.angle+=q.angularSpeed*S._scaledUpdateSpeed}function Vq(q,S){S.particleEmitterType.startDirectionFunction(S._emitterWorldMatrix,q.direction,q,S.isLocal,S._emitterInverseWorldMatrix)}function lq(q,S){S.startDirectionFunction(S._emitterWorldMatrix,q.direction,q,S.isLocal)}function yq(q,S){q._currentVelocityGradient=S._velocityGradients[0],q._currentVelocity1=q._currentVelocityGradient.getFactor(),S._velocityGradients.length>1?q._currentVelocity2=S._velocityGradients[1].getFactor():q._currentVelocity2=q._currentVelocity1}function Rq(q,S){q._currentLimitVelocityGradient=S._limitVelocityGradients[0],q._currentLimitVelocity1=q._currentLimitVelocityGradient.getFactor(),S._limitVelocityGradients.length>1?q._currentLimitVelocity2=S._limitVelocityGradients[1].getFactor():q._currentLimitVelocity2=q._currentLimitVelocity1}function Gq(q,S){j.GetCurrentGradient(S._ratio,S._velocityGradients,((b,z,C)=>{b!==q._currentVelocityGradient&&(q._currentVelocity1=q._currentVelocity2,q._currentVelocity2=z.getFactor(),q._currentVelocityGradient=b),S._directionScale*=(0,I.Lerp)(q._currentVelocity1,q._currentVelocity2,C)}))}function Zq(q,S){j.GetCurrentGradient(S._ratio,S._limitVelocityGradients,((b,z,C)=>{b!==q._currentLimitVelocityGradient&&(q._currentLimitVelocity1=q._currentLimitVelocity2,q._currentLimitVelocity2=z.getFactor(),q._currentLimitVelocityGradient=b);const v=(0,I.Lerp)(q._currentLimitVelocity1,q._currentLimitVelocity2,C);q.direction.length()>v&&q.direction.scaleInPlace(S.limitVelocityDamping)}))}function Hq(q,S){q.direction.scaleToRef(S._directionScale,S._scaledDirection)}function Qq(q,S){S.particleEmitterType.startPositionFunction(S._emitterWorldMatrix,q.position,q,S.isLocal)}function kq(q,S){S.startPositionFunction(S._emitterWorldMatrix,q.position,q,S.isLocal)}function Wq(q,S){q.Nr?q.Nr.v(q.position):q.Nr=q.position.clone(),z.yS.TransformCoordinatesToRef(q.Nr,S._emitterWorldMatrix,q.position)}function Nq(q,S){S.isLocal&&q.Nr?(q.Nr.addInPlace(S._scaledDirection),z.yS.TransformCoordinatesToRef(q.Nr,S._emitterWorldMatrix,q.position)):q.position.addInPlace(S._scaledDirection)}function uq(q,S){q._currentDragGradient=S._dragGradients[0],q._currentDrag1=q._currentDragGradient.getFactor(),S._dragGradients.length>1?q._currentDrag2=S._dragGradients[1].getFactor():q._currentDrag2=q._currentDrag1}function Xq(q,S){j.GetCurrentGradient(S._ratio,S._dragGradients,((b,z,C)=>{b!==q._currentDragGradient&&(q._currentDrag1=q._currentDrag2,q._currentDrag2=z.getFactor(),q._currentDragGradient=b);const v=(0,I.Lerp)(q._currentDrag1,q._currentDrag2,C);S._scaledDirection.scaleInPlace(1-v)}))}function Tq(q,S){q._randomNoiseCoordinates1?(q._randomNoiseCoordinates1.Bb(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2.Bb(Math.random(),Math.random(),Math.random())):(q._randomNoiseCoordinates1=new z.yS(Math.random(),Math.random(),Math.random()),q._randomNoiseCoordinates2=new z.yS(Math.random(),Math.random(),Math.random()))}function Bq(q,S){const b=S._noiseTextureData,C=S._noiseTextureSize;if(b&&C&&q._randomNoiseCoordinates1){const v=S._fetchR(q._randomNoiseCoordinates1.x,q._randomNoiseCoordinates1.y,C.width,C.height,b),U=S._fetchR(q._randomNoiseCoordinates1.z,q._randomNoiseCoordinates2.x,C.width,C.height,b),g=S._fetchR(q._randomNoiseCoordinates2.y,q._randomNoiseCoordinates2.z,C.width,C.height,b),r=z.TmpVectors.yS[0],I=z.TmpVectors.yS[1];r.Bb((2*v-1)*S.noiseStrength.x,(2*U-1)*S.noiseStrength.y,(2*g-1)*S.noiseStrength.z),r.scaleToRef(S._tempScaledUpdateSpeed,I),q.direction.addInPlace(I)}}function tq(q,S){S.gravity.scaleToRef(S._tempScaledUpdateSpeed,S._scaledGravity),q.direction.addInPlace(S._scaledGravity)}function fq(q,S){q.size=(0,I.RandomRange)(S.minSize,S.maxSize),q.scale.Bb((0,I.RandomRange)(S.minScaleX,S.maxScaleX),(0,I.RandomRange)(S.minScaleY,S.maxScaleY))}function mq(q,S){q._currentSizeGradient=S._sizeGradients[0],q._currentSize1=q._currentSizeGradient.getFactor(),q.size=q._currentSize1,S._sizeGradients.length>1?q._currentSize2=S._sizeGradients[1].getFactor():q._currentSize2=q._currentSize1,q.scale.Bb((0,I.RandomRange)(S.minScaleX,S.maxScaleX),(0,I.RandomRange)(S.minScaleY,S.maxScaleY))}function Eq(q,S){const b=S._actualFrame/S.targetStopDuration;j.GetCurrentGradient(b,S._startSizeGradients,((b,z,C)=>{b!==S._currentStartSizeGradient&&(S._currentStartSize1=S._currentStartSize2,S._currentStartSize2=z.getFactor(),S._currentStartSizeGradient=b);const v=(0,I.Lerp)(S._currentStartSize1,S._currentStartSize2,C);q.scale.scaleInPlace(v)}))}function eq(q,S){j.GetCurrentGradient(S._ratio,S._sizeGradients,((S,b,z)=>{S!==q._currentSizeGradient&&(q._currentSize1=q._currentSize2,q._currentSize2=b.getFactor(),q._currentSizeGradient=S),q.size=(0,I.Lerp)(q._currentSize1,q._currentSize2,z)}))}function iq(q,S){q.remapData=new z.Vector4(0,1,0,1)}function Jq(q,S){S._colorRemapGradients&&S._colorRemapGradients.length>0&&j.GetCurrentGradient(S._ratio,S._colorRemapGradients,((S,b,z)=>{const C=(0,I.Lerp)(S.factor1,b.factor1,z),v=(0,I.Lerp)(S.factor2,b.factor2,z);q.remapData.x=C,q.remapData.y=v-C})),S._alphaRemapGradients&&S._alphaRemapGradients.length>0&&j.GetCurrentGradient(S._ratio,S._alphaRemapGradients,((S,b,z)=>{const C=(0,I.Lerp)(S.factor1,b.factor1,z),v=(0,I.Lerp)(S.factor2,b.factor2,z);q.remapData.z=C,q.remapData.w=v-C}))}function Lq(q,S){const b=(0,I.Clamp)(S._actualFrame/S.targetStopDuration);j.GetCurrentGradient(b,S._lifeTimeGradients,((S,z)=>{const C=S,v=z,U=C.getFactor(),g=v.getFactor(),r=(b-C.gradient)/(v.gradient-C.gradient);q.lifeTime=(0,I.Lerp)(U,g,r)})),S._emitPower=(0,I.RandomRange)(S.minEmitPower,S.maxEmitPower)}function dq(q,S){q.lifeTime=(0,I.RandomRange)(S.minLifeTime,S.maxLifeTime),S._emitPower=(0,I.RandomRange)(S.minEmitPower,S.maxEmitPower)}function Kq(q,S){0===S._emitPower?(q._initialDirection?q._initialDirection.v(q.direction):q._initialDirection=q.direction.clone(),q.direction.set(0,0,0)):(q._initialDirection=null,q.direction.scaleInPlace(S._emitPower)),q.direction.addInPlace(S._inheritedVelocityOffset)}function Dq(q,S){q.angularSpeed=(0,I.RandomRange)(S.minAngularSpeed,S.maxAngularSpeed),q.angle=(0,I.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function xq(q,S){q._currentAngularSpeedGradient=S._angularSpeedGradients[0],q.angularSpeed=q._currentAngularSpeedGradient.getFactor(),q._currentAngularSpeed1=q.angularSpeed,S._angularSpeedGradients.length>1?q._currentAngularSpeed2=S._angularSpeedGradients[1].getFactor():q._currentAngularSpeed2=q._currentAngularSpeed1,q.angle=(0,I.RandomRange)(S.minInitialRotation,S.maxInitialRotation)}function Fq(q,S){q._initialStartSpriteCellId=S.startSpriteCellID,q._initialEndSpriteCellId=S.endSpriteCellID,q._initialSpriteCellLoop=S.spriteCellLoop}function aq(q,S){q.previousItem=S.previousItem,q.nextItem=S,S.previousItem&&(S.previousItem.nextItem=q),S.previousItem=q}function nq(q,S){q.previousItem=S,q.nextItem=S.nextItem,S.nextItem&&(S.nextItem.previousItem=q),S.nextItem=q}function oq(q,S){let b=S;for(;b.nextItem;)b=b.nextItem;q.previousItem=b,q.nextItem=b.nextItem,b.nextItem=q}function sq(q){q.previousItem&&(q.previousItem.nextItem=q.nextItem),q.nextItem&&(q.nextItem.previousItem=q.previousItem)}class Aq extends r{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(q){this._startDirectionFunction!==q&&(this._startDirectionFunction=q,this._directionProcessing.process=q?lq:Vq)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(q){this._startPositionFunction!==q&&(this._startPositionFunction=q,this._positionCreation.process=q?kq:Qq)}set onDispose(q){this._onDisposeObserver&&this.gb.remove(this._onDisposeObserver),this._onDisposeObserver=this.gb.add(q)}get V(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(q){this._useRampGradients!==q&&(this._useRampGradients=q,this._resetEffect(),q?(this._rampCreation={process:iq,previousItem:null,nextItem:null},nq(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Jq,previousItem:null,nextItem:null},nq(this._remapGradientProcessing,this._gravityProcessing)):(sq(this._rampCreation),sq(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(q){this._isLocal!==q&&(this._isLocal=q,q?(this._isLocalCreation={process:Wq,previousItem:null,nextItem:null},nq(this._isLocalCreation,this._positionCreation)):sq(this._isLocalCreation))}get particles(){return this.Hy}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(q){this._animationSheetEnabled!==q&&(this._animationSheetEnabled=q,q?(this._sheetCreation={process:Fq,previousItem:null,nextItem:null},nq(this._sheetCreation,this._colorCreation)):sq(this._sheetCreation),this._reset())}getActiveCount(){return this.Hy.length}getClassName(){return"Kb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var q;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[S])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new qq.e(this._engine),this._customWrappers[S].effect=q,this._customWrappers[S].drawContext&&(this._customWrappers[S].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(q){if(this.noiseTexture!==q){if(this._noiseTexture=q,!q)return sq(this._noiseCreation),void sq(this._noiseProcessing);this._noiseCreation={process:Tq,previousItem:null,nextItem:null},nq(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Bq,previousItem:null,nextItem:null},nq(this._noiseProcessing,this._positionProcessing)}}constructor(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(q),this._emitterInverseWorldMatrix=z.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new z.yS,this.gb=new M.d,this.onStoppedObservable=new M.d,this.onStartedObservable=new M.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Hy=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new U.b(0,0,0,0),this._colorDiff=new U.b(0,0,0,0),this._scaledDirection=z.yS.Zero(),this._scaledGravity=z.yS.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=q=>{},this.recycleParticle=q=>{const S=this.Hy.pop();S!==q&&S.copyTo(q),this._stockParticles.push(S)},this._createParticle=()=>{let q;return 0!==this._stockParticles.length?(q=this._stockParticles.pop(),q._reset()):q=new c(this),this._prepareParticle(q),q},this.paused=!1,this._shadersLoaded=!1,this._capacity=S,this._epsilon=g,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||Y.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Gy.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:dq,previousItem:null,nextItem:null},this._positionCreation={process:Qq,previousItem:null,nextItem:null},nq(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Vq,previousItem:null,nextItem:null},nq(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Kq,previousItem:null,nextItem:null},nq(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:fq,previousItem:null,nextItem:null},nq(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Dq,previousItem:null,nextItem:null},nq(this._angleCreation,this._sizeCreation),this._colorCreation={process:Cq,previousItem:null,nextItem:null},nq(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,r||(this._colorProcessing={process:gq,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Iq,previousItem:null,nextItem:null},nq(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Hq,previousItem:null,nextItem:null},nq(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Nq,previousItem:null,nextItem:null},nq(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:tq,previousItem:null,nextItem:null},nq(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=v,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new l,this.updateFunction=q=>{var S;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(S=this.noiseTexture.getContent())||void 0===S||S.then((q=>{this._noiseTextureData=q})));const b=q===this.Hy;for(let z=0;z<q.length;z++){const S=q[z];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const C=S.age;if(S.age+=this._tempScaledUpdateSpeed,S.age>S.lifeTime){const q=S.age-C,b=S.lifeTime-C;this._tempScaledUpdateSpeed=b*this._tempScaledUpdateSpeed/q,S.age=S.lifeTime}this._ratio=S.age/S.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let v=this._updateQueueStart;for(;v;)v.process(S,this),v=v.nextItem;if(this._isAnimationSheetEnabled&&!r&&S.updateCellIndex(),S._inheritParticleInfoToSubEmitters(),S.age>=S.lifeTime){if(this._emitFromParticle(S),S._attachedSubEmitters){for(const q of S._attachedSubEmitters)q.particleSystem.disposeOnStop=!0,q.particleSystem.stop();S._attachedSubEmitters=null}this.recycleParticle(S),b&&z--}else;}}}serialize(q){throw new Error("Method not implemented.")}clone(q,S){throw new Error("Method not implemented.")}_addFactorGradient(q,S,b,z){const C=new O(S,b,z);q.push(C),q.sort(((q,S)=>q.gradient<S.gradient?-1:q.gradient>S.gradient?1:0))}_removeFactorGradient(q,S){if(!q)return;let b=0;for(const z of q){if(z.gradient===S){q.splice(b,1);break}b++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Lq:this._lifeTimeCreation.process=dq}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Eq,previousItem:null,nextItem:null},nq(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(sq(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(q){this.targetStopDuration!==q&&(this._targetStopDuration=q,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(q,S,b){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,q,S,b),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(q){return this._removeFactorGradient(this._lifeTimeGradients,q),this._syncLifeTimeCreation(),this}addSizeGradient(q,S,b){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=mq,this._sizeGradientProcessing={process:eq,previousItem:null,nextItem:null},aq(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,q,S,b),this}removeSizeGradient(q){var S;return this._removeFactorGradient(this._sizeGradients,q),0===(null===(S=this._sizeGradients)||void 0===S?void 0:S.length)&&(sq(this._sizeGradientProcessing),this._sizeCreation.process=fq),this}addColorRemapGradient(q,S,b){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,q,S,b),this}removeColorRemapGradient(q){return this._removeFactorGradient(this._colorRemapGradients,q),this}addAlphaRemapGradient(q,S,b){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,q,S,b),this}removeAlphaRemapGradient(q){return this._removeFactorGradient(this._alphaRemapGradients,q),this}addAngularSpeedGradient(q,S,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=xq,this._angularSpeedGradientProcessing={process:rq,previousItem:null,nextItem:null},aq(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,q,S,b),this}removeAngularSpeedGradient(q){var S;return this._removeFactorGradient(this._angularSpeedGradients,q),0===(null===(S=this._angularSpeedGradients)||void 0===S?void 0:S.length)&&(this._angleCreation.process=Dq,sq(this._angularSpeedGradientProcessing)),this}addVelocityGradient(q,S,b){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:yq,previousItem:null,nextItem:null},nq(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Gq,previousItem:null,nextItem:null},aq(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,q,S,b),this}removeVelocityGradient(q){var S;return this._removeFactorGradient(this._velocityGradients,q),0===(null===(S=this._velocityGradients)||void 0===S?void 0:S.length)&&(sq(this._velocityCreation),sq(this._velocityGradientProcessing)),this}addLimitVelocityGradient(q,S,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Rq,previousItem:null,nextItem:null},nq(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Zq,previousItem:null,nextItem:null},nq(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,q,S,b),this}removeLimitVelocityGradient(q){var S;return this._removeFactorGradient(this._limitVelocityGradients,q),0===(null===(S=this._limitVelocityGradients)||void 0===S?void 0:S.length)&&(sq(this._limitVelocityCreation),sq(this._limitVelocityGradientProcessing)),this}addDragGradient(q,S,b){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:uq,previousItem:null,nextItem:null},aq(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Xq,previousItem:null,nextItem:null},aq(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,q,S,b),this}removeDragGradient(q){var S;return this._removeFactorGradient(this._dragGradients,q),0===(null===(S=this._dragGradients)||void 0===S?void 0:S.length)&&(sq(this._dragCreation),sq(this._dragGradientProcessing)),this}addEmitRateGradient(q,S,b){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,q,S,b),this}removeEmitRateGradient(q){return this._removeFactorGradient(this._emitRateGradients,q),this}addStartSizeGradient(q,S,b){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,q,S,b),this._syncStartSizeCreation(),this}removeStartSizeGradient(q){return this._removeFactorGradient(this._startSizeGradients,q),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const q=new Uint8Array(4*this._rawTextureWidth),S=U.e.HS[0];for(let b=0;b<this._rawTextureWidth;b++){const z=b/this._rawTextureWidth;j.GetCurrentGradient(z,this._rampGradients,((z,C,v)=>{U.HS.LerpToRef(z.color,C.color,v,S),q[4*b]=255*S.r,q[4*b+1]=255*S.g,q[4*b+2]=255*S.b,q[4*b+3]=255}))}this._rampGradientsTexture=p.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((q,S)=>q.gradient<S.gradient?-1:q.gradient>S.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(q,S){this._rampGradients||(this._rampGradients=[]);const b=new h(q,S);return this._rampGradients.push(b),this._syncRampGradientTexture(),this}removeRampGradient(q){return this._removeGradientAndTexture(q,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(q,S,b){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=vq,this._colorProcessing.process=Uq);const z=new P(q,S,b);return this._colorGradients.push(z),this._colorGradients.sort(((q,S)=>q.gradient<S.gradient?-1:q.gradient>S.gradient?1:0)),this}removeColorGradient(q){if(!this._colorGradients)return this;let S=0;for(const b of this._colorGradients){if(b.gradient===q){this._colorGradients.splice(S,1);break}S++}return 0===this._colorGradients.length&&(this._colorCreation.process=Cq,this._colorProcessing.process=gq),this}resetDrawCache(){if(this._drawWrappers){for(const q of this._drawWrappers)if(q)for(const S of q)null===S||void 0===S||S.dispose();this._drawWrappers=[]}}_fetchR(q,S,b,z,C){return C[4*(((q=.5*Math.abs(q)+.5)*b%b|0)+((S=.5*Math.abs(S)+.5)*z%z|0)*b)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const q=this._engine,S=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*S),this._vertexBuffer=new u.b(q,this._vertexData,!0,S);let b=0;const z=this._vertexBuffer.createVertexBuffer(u.f.PositionKind,b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.f.PositionKind]=z,b+=3;const C=this._vertexBuffer.createVertexBuffer(u.f.ColorKind,b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.f.ColorKind]=C,b+=4;const v=this._vertexBuffer.createVertexBuffer("angle",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=v,b+=1;const U=this._vertexBuffer.createVertexBuffer("size",b,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=U,b+=2,this._isAnimationSheetEnabled){const q=this._vertexBuffer.createVertexBuffer("cellIndex",b,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=q,b+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const q=this._vertexBuffer.createVertexBuffer("direction",b,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=q,b+=3}if(this._useRampGradients){const q=this._vertexBuffer.createVertexBuffer("remapData",b,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=q,b+=4}let g;if(this._useInstancing){const S=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new u.b(q,S,!1,2),g=this._spriteBuffer.createVertexBuffer("offset",0,2)}else g=this._vertexBuffer.createVertexBuffer("offset",b,2,this._vertexBufferSize,this._useInstancing),b+=2;this._vertexBuffers.offset=g,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const q=[],S=[];let b=0;for(let z=0;z<this._capacity;z++)q.push(b),q.push(b+1),q.push(b+2),q.push(b),q.push(b+2),q.push(b+3),S.push(b,b+1,b+1,b+2,b+2,b+3,b+3,b,b,b+3),b+=4;this._indexBuffer=this._engine.createIndexBuffer(q),this._linesIndexBuffer=this._engine.createIndexBuffer(S)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(q)setTimeout((()=>{this.start(0)}),q);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var S;-1!==(null===(S=this.j)||void 0===S?void 0:S.getClassName().indexOf("Mesh"))&&this.j.Nb(!0);const q=this.noiseTexture;if(q&&q.onGeneratedObservable)q.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let S=0;S<this.preWarmCycles;S++)this.animate(!0),q.render()}))}));else for(let S=0;S<this.preWarmCycles;S++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(q))}_postStop(q){}reset(){this._stockParticles.length=0,this.Hy.length=0}_appendParticleVertex(q,S,b,C){let v=q*this._vertexBufferSize;if(this._vertexData[v++]=S.position.x+this.KI.x,this._vertexData[v++]=S.position.y+this.KI.y,this._vertexData[v++]=S.position.z+this.KI.z,this._vertexData[v++]=S.color.r,this._vertexData[v++]=S.color.g,this._vertexData[v++]=S.color.b,this._vertexData[v++]=S.color.a,this._vertexData[v++]=S.angle,this._vertexData[v++]=S.scale.x*S.size,this._vertexData[v++]=S.scale.y*S.size,this._isAnimationSheetEnabled&&(this._vertexData[v++]=S.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[v++]=S.direction.x,this._vertexData[v++]=S.direction.y,this._vertexData[v++]=S.direction.z);else if(S._initialDirection){let q=S._initialDirection;this.isLocal&&(z.yS.TransformNormalToRef(q,this._emitterWorldMatrix,z.TmpVectors.yS[0]),q=z.TmpVectors.yS[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[v++]=q.x,this._vertexData[v++]=q.y,this._vertexData[v++]=q.z}else{let q=S.direction;this.isLocal&&(z.yS.TransformNormalToRef(q,this._emitterWorldMatrix,z.TmpVectors.yS[0]),q=z.TmpVectors.yS[0]),0===q.x&&0===q.z&&(q.x=.001),this._vertexData[v++]=q.x,this._vertexData[v++]=q.y,this._vertexData[v++]=q.z}this._useRampGradients&&S.remapData&&(this._vertexData[v++]=S.remapData.x,this._vertexData[v++]=S.remapData.y,this._vertexData[v++]=S.remapData.z,this._vertexData[v++]=S.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===b?b=this._epsilon:1===b&&(b=1-this._epsilon),0===C?C=this._epsilon:1===C&&(C=1-this._epsilon)),this._vertexData[v++]=b,this._vertexData[v++]=C)}_prepareParticle(q){}_createNewOnes(q){let S;for(let b=0;b<q&&this.Hy.length!==this._capacity;b++){S=this._createParticle(),this.Hy.push(S);let q=this._createQueueStart;for(;q;)q.process(S,this),q=q.nextItem;S._inheritParticleInfoToSubEmitters()}}_update(q){if(this._alive=this.Hy.length>0,this.j.position){const q=this.j;this._emitterWorldMatrix=q.getWorldMatrix()}else{const q=this.j;this._emitterWorldMatrix=z.Matrix.Translation(q.x,q.y,q.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Hy),this._createNewOnes(q)}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=[u.f.PositionKind,u.f.ColorKind,"angle","offset","size"];return q&&z.push("cellIndex"),S||z.push("direction"),b&&z.push("remapData"),z}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Sq.d)(z),q&&z.push("particlesInfos"),S&&z.push("logarithmicDepthConstant"),b&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(q,S){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&q.push("#define FOG")),this._isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),S===r.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&q.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case 2:q.push("#define BILLBOARDY");break;case 8:case 9:q.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&q.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:q.push("#define BILLBOARDMODE_ALL")}b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,S,b){S.push(...Aq._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),q.push(...Aq._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zq.e)(q,this._imageProcessingConfigurationDefines),(0,zq.c)(b,this._imageProcessingConfigurationDefines))}_getWrapper(q){const S=this._getCustomDrawWrapper(q);if(null!==S&&void 0!==S&&S.effect)return S;const b=[];this.fillDefines(b,q);const z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let C=this._drawWrappers[z];C||(C=this._drawWrappers[z]=[]);let v=C[q];v||(v=new qq.e(this._engine),v.drawContext&&(v.drawContext.useInstancing=this._useInstancing),C[q]=v);const U=b.join("\n");if(v.defines!==U){const q=[],S=[],b=[];this.fillUniformsAttributesAndSamplerNames(S,q,b),v.setEffect(this._engine.createEffect("particles",q,S,b,U,void 0,void 0,void 0,void 0,this._shaderLanguage),U)}return v}animate(){var q;let S,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!b&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(b?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this.manualEmitCount>-1)S=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let q=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const S=this._actualFrame/this.targetStopDuration;j.GetCurrentGradient(S,this._emitRateGradients,((S,b,z)=>{S!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=b.getFactor(),this._currentEmitRateGradient=S),q=(0,I.Lerp)(this._currentEmitRate1,this._currentEmitRate2,z)}))}S=q*this._scaledUpdateSpeed|0,this._newPartsExcess+=q*this._scaledUpdateSpeed-S}if(this._newPartsExcess>1&&(S+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?S=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(S),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!b){let q=0;for(let S=0;S<this.Hy.length;S++){const b=this.Hy[S];this._appendParticleVertices(q,b),q+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Hy.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(q,S){this._appendParticleVertex(q++,S,0,0),this._useInstancing||(this._appendParticleVertex(q++,S,1,0),this._appendParticleVertex(q++,S,1,1),this._appendParticleVertex(q++,S,0,1))}rebuild(){var q;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(q=this._spriteBuffer)||void 0===q||q._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Aq.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(b.bind(b,12584)),Promise.resolve().then(b.bind(b,12529))])):await Promise.all([Promise.resolve().then(b.bind(b,12518)),Promise.resolve().then(b.bind(b,12509))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==r.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(r.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(r.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(q){const S=this._getWrapper(q),b=S.effect,C=this._engine;C.enableEffect(S);const v=this.defaultViewMatrix??this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",v),b.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();b.setFloat3("particlesInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,this.spriteCellWidth/q.width)}if(b.setVector2("translationPivot",this.translationPivot),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;b.setVector3("eyePosition",q.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),b.setTexture("rampSampler",this._rampGradientsTexture));const U=b.defines;var g,r,I,V,l,y;(this._scene&&((0,Sq.f)(b,this,this._scene),this.applyFog&&(0,bq.g)(this._scene,void 0,b)),U.indexOf("#define BILLBOARDMODE_ALL")>=0&&(v.invertToRef(z.TmpVectors.Matrix[0]),b.setMatrix("invView",z.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?C.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,b):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,b)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?C.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBuffer:this._indexBuffer,b):C.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null,b);(this.useLogarithmicDepth&&this._scene&&(0,bq.l)(U,b,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(b),this._setEngineBasedOnBlendMode(q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(b),this._useInstancing)?null!==(l=this._scene)&&void 0!==l&&l.forceWireframe?C.drawElementsType(6,0,10,this.Hy.length):C.drawArraysType(7,0,4,this.Hy.length):null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?C.drawElementsType(1,0,10*this.Hy.length):C.drawElementsType(0,0,6*this.Hy.length);return this.Hy.length}render(){if(!this.isReady()||!this.Hy.length)return 0;const q=this._engine;q.setState&&(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0));let S=0;return S=this.blendMode===r.BLENDMODE_MULTIPLYADD?this._render(r.BLENDMODE_MULTIPLY)+this._render(r.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),S}_onDispose(){}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(S,b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const q=this._scene.Gy.indexOf(this);q>-1&&this._scene.Gy.splice(q,1),this._scene._activeParticleSystems.dispose()}this.gb.notifyObservers(this),this.gb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Aq.ForceGLSL=!1;var wq,Pq=b(10964);!function(q){q[q.ATTACHED=0]="ATTACHED",q[q.END=1]="END"}(wq||(wq={}));class hq{constructor(q){if(this.particleSystem=q,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!q.j||!q.j.dispose){const S=(0,g.c)("BABYLON.AbstractMesh");q.j=new S("SubemitterSystemEmitter",q.Tq()),q._disposeEmitterOnDispose=!0}}clone(){let q=this.particleSystem.j;if(q){if(q instanceof z.yS)q=q.clone();else if(-1!==q.getClassName().indexOf("Mesh")){q=new((0,g.c)("BABYLON.Mesh"))("",q.Tq()),q.isVisible=!1}}else q=new z.yS;const S=new hq(this.particleSystem.clone(this.particleSystem.name,q));return S.particleSystem.name+="Clone",S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem._disposeEmitterOnDispose=!0,S.particleSystem.disposeOnStop=!0,S}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return S.type=this.type,S.inheritDirection=this.inheritDirection,S.inheritedVelocityAmount=this.inheritedVelocityAmount,S.particleSystem=this.particleSystem.serialize(q),S}static _ParseParticleSystem(q,S,b){throw(0,Pq.c)("ParseParticle")}static Parse(q,S,b){const z=q.particleSystem,C=new hq(hq._ParseParticleSystem(z,S,b,!0));return C.type=q.type,C.inheritDirection=q.inheritDirection,C.inheritedVelocityAmount=q.inheritedVelocityAmount,C.particleSystem._isSubEmitter=!0,C}dispose(){this.particleSystem.dispose()}}var Oq=b(11006);function jq(q,S){const b=new Q;return b.direction1=q,b.direction2=S,b}function Mq(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pq(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Yq(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.yS(0,1,0),b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0);return new W(q,S,b)}function cq(){return new G(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function qS(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0),v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.yS(0,1,0);return new Z(q,S,b,C,v)}function SS(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new y(q,S)}function bS(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0),C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0);return new R(q,S,b,C)}const zS=z.yS.Zero(),CS=z.yS.Zero(),vS=z.yS.Zero();class US{constructor(){this.strength=0,this.position=z.yS.Zero()}_processParticle(q,S){this.position.subtractToRef(q.position,zS);const b=zS.lengthSquared()+1;zS.normalize().scaleToRef(this.strength/b,CS),CS.scaleToRef(S._tempScaledUpdateSpeed,vS),q.direction.addInPlace(vS)}serialize(){return{position:this.position.Zb(),strength:this.strength}}}class gS extends Aq{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=q=>{if(!this._subEmitters||0===this._subEmitters.length)return;const S=Math.floor(Math.random()*this._subEmitters.length);for(const b of this._subEmitters[S])if(1===b.type){const S=b.clone();q._inheritParticleInfoToSubEmitter(S),S.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(S.particleSystem),S.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(q,S){const b=jq(q,S);return this.particleEmitterType=b,b}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q,this._flowMapUpdate&&(sq(this._flowMapUpdate),this._flowMapUpdate=null),q&&(this._flowMapUpdate={process:q=>{var S;const b=null===(S=this.Tq())||void 0===S?void 0:S.getTransformMatrix();this._flowMap._processParticle(q,this.flowMapStrength*this._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null},nq(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(q){this._attractors.push(q),1===this._attractors.length&&(this._attractorUpdate={process:q=>{for(const S of this._attractors)S._processParticle(q,this)},previousItem:null,nextItem:null},nq(this._attractorUpdate,this._directionProcessing))}removeAttractor(q){const S=this._attractors.indexOf(q);-1!==S&&this._attractors.splice(S,1),0===this._attractors.length&&sq(this._attractorUpdate)}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(q)}createHemisphericEmitter(){const q=Mq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=pq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Yq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.yS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=cq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=bS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,S,b,z){const C=new l;return this.particleEmitterType=C,this.direction1=q,this.direction2=S,this.minEmitBox=b,this.maxEmitBox=z,C}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const q of this.subEmitters)q instanceof gS?this._subEmitters.push([new hq(q)]):q instanceof hq?this._subEmitters.push([q]):q instanceof Array&&this._subEmitters.push(q)}_stopSubEmitters(){if(this.activeSubSystems){for(const q of this.activeSubSystems)q.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const q=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==q&&this._rootParticleSystem.activeSubSystems.splice(q,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(q){q&&this._stopSubEmitters()}_prepareParticle(q){if(this._subEmitters&&this._subEmitters.length>0){const S=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];q._attachedSubEmitters=[];for(const b of S)if(0===b.type){const S=b.clone();q._attachedSubEmitters.push(S),S.particleSystem.start()}}}_onDispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),q&&this.particles)for(const b of this.particles)if(b._attachedSubEmitters)for(let q=b._attachedSubEmitters.length-1;q>=0;q-=1)b._attachedSubEmitters[q].dispose();if(S&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let q=0;q<this._subEmitters.length;q++)for(const S of this._subEmitters[q])S.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(q,S,b,C){let v;v=b instanceof Oq.c?null:b;const r=(0,g.c)("BABYLON.Texture");if(r&&v&&(q.texture?S.particleTexture=r.Parse(q.texture,v,C):q.textureName&&(S.particleTexture=new r(C+q.textureName,v,!1,void 0===q.invertY||q.invertY),S.particleTexture.name=q.textureName)),q.emitterId||0===q.emitterId||void 0!==q.j?q.emitterId&&v?S.j=v.getLastMeshById(q.emitterId):S.j=z.yS.Hb(q.j):S.j=z.yS.Zero(),S.isLocal=!!q.isLocal,void 0!==q.renderingGroupId&&(S.renderingGroupId=q.renderingGroupId),void 0!==q.isBillboardBased&&(S.isBillboardBased=q.isBillboardBased),void 0!==q.billboardMode&&(S.billboardMode=q.billboardMode),void 0!==q.useLogarithmicDepth&&(S.useLogarithmicDepth=q.useLogarithmicDepth),q.animations){for(let b=0;b<q.animations.length;b++){const z=q.animations[b],C=(0,g.c)("BABYLON.Animation");C&&S.animations.push(C.Parse(z))}S.beginAnimationOnStart=q.beginAnimationOnStart,S.beginAnimationFrom=q.beginAnimationFrom,S.beginAnimationTo=q.beginAnimationTo,S.beginAnimationLoop=q.beginAnimationLoop}if(q.autoAnimate&&v&&v.beginAnimation(S,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),S.startDelay=0|q.startDelay,S.minAngularSpeed=q.minAngularSpeed,S.maxAngularSpeed=q.maxAngularSpeed,S.minSize=q.minSize,S.maxSize=q.maxSize,q.minScaleX&&(S.minScaleX=q.minScaleX,S.maxScaleX=q.maxScaleX,S.minScaleY=q.minScaleY,S.maxScaleY=q.maxScaleY),void 0!==q.preWarmCycles&&(S.preWarmCycles=q.preWarmCycles,S.preWarmStepOffset=q.preWarmStepOffset),void 0!==q.minInitialRotation&&(S.minInitialRotation=q.minInitialRotation,S.maxInitialRotation=q.maxInitialRotation),S.minLifeTime=q.minLifeTime,S.maxLifeTime=q.maxLifeTime,S.minEmitPower=q.minEmitPower,S.maxEmitPower=q.maxEmitPower,S.emitRate=q.emitRate,S.gravity=z.yS.Hb(q.gravity),q.noiseStrength&&(S.noiseStrength=z.yS.Hb(q.noiseStrength)),S.color1=U.b.Hb(q.color1),S.color2=U.b.Hb(q.color2),S.colorDead=U.b.Hb(q.colorDead),S.updateSpeed=q.updateSpeed,S.targetStopDuration=q.targetStopDuration,S.blendMode=q.blendMode,q.colorGradients)for(const z of q.colorGradients)S.addColorGradient(z.gradient,U.b.Hb(z.color1),z.color2?U.b.Hb(z.color2):void 0);if(q.rampGradients){for(const b of q.rampGradients)S.addRampGradient(b.gradient,U.HS.Hb(b.color));S.useRampGradients=q.useRampGradients}if(q.colorRemapGradients)for(const z of q.colorRemapGradients)S.addColorRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.alphaRemapGradients)for(const z of q.alphaRemapGradients)S.addAlphaRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.sizeGradients)for(const z of q.sizeGradients)S.addSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.angularSpeedGradients)for(const z of q.angularSpeedGradients)S.addAngularSpeedGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.velocityGradients)for(const z of q.velocityGradients)S.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.dragGradients)for(const z of q.dragGradients)S.addDragGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.emitRateGradients)for(const z of q.emitRateGradients)S.addEmitRateGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.startSizeGradients)for(const z of q.startSizeGradients)S.addStartSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.lifeTimeGradients)for(const z of q.lifeTimeGradients)S.addLifeTimeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(q.limitVelocityGradients){for(const b of q.limitVelocityGradients)S.addLimitVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);S.limitVelocityDamping=q.limitVelocityDamping}if(q.noiseTexture&&v){const b=(0,g.c)("BABYLON.ProceduralTexture");S.noiseTexture=b.Parse(q.noiseTexture,v,C)}let I;if(q.particleEmitterType){switch(q.particleEmitterType.type){case"SphereParticleEmitter":I=new k;break;case"SphereDirectedParticleEmitter":I=new W;break;case"ConeEmitter":case"ConeParticleEmitter":I=new y;break;case"ConeDirectedParticleEmitter":I=new R;break;case"CylinderParticleEmitter":I=new G;break;case"CylinderDirectedParticleEmitter":I=new Z;break;case"HemisphericParticleEmitter":I=new H;break;case"PointParticleEmitter":I=new Q;break;case"MeshParticleEmitter":I=new X;break;case"CustomParticleEmitter":I=new N;break;default:I=new l}I.parse(q.particleEmitterType,v)}else I=new l,I.parse(q,v);S.particleEmitterType=I,S.startSpriteCellID=q.startSpriteCellID,S.endSpriteCellID=q.endSpriteCellID,S.spriteCellLoop=q.spriteCellLoop??!0,S.spriteCellWidth=q.spriteCellWidth,S.spriteCellHeight=q.spriteCellHeight,S.spriteCellChangeSpeed=q.spriteCellChangeSpeed,S.spriteRandomStartCell=q.spriteRandomStartCell,S.disposeOnStop=q.disposeOnStop??!1,S.manualEmitCount=q.manualEmitCount??-1}static Parse(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],v=arguments.length>4?arguments[4]:void 0;const g=q.name;let r,I,V=null,l=null;if(S instanceof Oq.c?r=S:(I=S,r=I.getEngine()),q.customShader&&r.createEffectForParticles){l=q.customShader;const S=l.shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";V=r.createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,S)}const y=new gS(g,v||q.WS,S,V,q.isAnimationSheetEnabled);if(y.customShader=l,y._rootUrl=b,q.id&&(y.id=q.id),q.subEmitters){y.subEmitters=[];for(const z of q.subEmitters){const q=[];for(const C of z)q.push(hq.Parse(C,S,b));y.subEmitters.push(q)}}if(q.attractors)for(const U of q.attractors){const q=new US;q.position=z.yS.Hb(U.position),q.strength=U.strength,y.addAttractor(q)}return gS._Parse(q,y,S,b),q.textureMask&&(y.textureMask=U.b.Hb(q.textureMask)),q.KI&&(y.KI=z.yS.Hb(q.KI)),q.preventAutoStart&&(y.preventAutoStart=q.preventAutoStart),C||y.preventAutoStart||y.start(),y}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};if(gS._Serialize(S,this,q),S.textureMask=this.textureMask.Zb(),S.customShader=this.customShader,S.preventAutoStart=this.preventAutoStart,S.KI=this.KI.Zb(),this.subEmitters){S.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const b of this._subEmitters){const z=[];for(const S of b)z.push(S.serialize(q));S.subEmitters.push(z)}}if(this._attractors&&this._attractors.length){S.attractors=[];for(const q of this._attractors)S.attractors.push(q.serialize())}return S}static _Serialize(q,S,b){if(q.name=S.name,q.id=S.id,q.WS=S.getCapacity(),q.disposeOnStop=S.disposeOnStop,q.manualEmitCount=S.manualEmitCount,S.j.position){const b=S.j;q.emitterId=b.id}else{const b=S.j;q.j=b.Zb()}S.particleEmitterType&&(q.particleEmitterType=S.particleEmitterType.serialize()),S.particleTexture&&(b?q.texture=S.particleTexture.serialize():(q.textureName=S.particleTexture.name,q.invertY=!!S.particleTexture._invertY)),q.isLocal=S.isLocal,L.b.AppendSerializedAnimations(S,q),q.beginAnimationOnStart=S.beginAnimationOnStart,q.beginAnimationFrom=S.beginAnimationFrom,q.beginAnimationTo=S.beginAnimationTo,q.beginAnimationLoop=S.beginAnimationLoop,q.startDelay=S.startDelay,q.renderingGroupId=S.renderingGroupId,q.isBillboardBased=S.isBillboardBased,q.billboardMode=S.billboardMode,q.minAngularSpeed=S.minAngularSpeed,q.maxAngularSpeed=S.maxAngularSpeed,q.minSize=S.minSize,q.maxSize=S.maxSize,q.minScaleX=S.minScaleX,q.maxScaleX=S.maxScaleX,q.minScaleY=S.minScaleY,q.maxScaleY=S.maxScaleY,q.minEmitPower=S.minEmitPower,q.maxEmitPower=S.maxEmitPower,q.minLifeTime=S.minLifeTime,q.maxLifeTime=S.maxLifeTime,q.emitRate=S.emitRate,q.gravity=S.gravity.Zb(),q.noiseStrength=S.noiseStrength.Zb(),q.color1=S.color1.Zb(),q.color2=S.color2.Zb(),q.colorDead=S.colorDead.Zb(),q.updateSpeed=S.updateSpeed,q.targetStopDuration=S.targetStopDuration,q.blendMode=S.blendMode,q.preWarmCycles=S.preWarmCycles,q.preWarmStepOffset=S.preWarmStepOffset,q.minInitialRotation=S.minInitialRotation,q.maxInitialRotation=S.maxInitialRotation,q.startSpriteCellID=S.startSpriteCellID,q.spriteCellLoop=S.spriteCellLoop,q.endSpriteCellID=S.endSpriteCellID,q.spriteCellChangeSpeed=S.spriteCellChangeSpeed,q.spriteCellWidth=S.spriteCellWidth,q.spriteCellHeight=S.spriteCellHeight,q.spriteRandomStartCell=S.spriteRandomStartCell,q.isAnimationSheetEnabled=S.isAnimationSheetEnabled,q.useLogarithmicDepth=S.useLogarithmicDepth;const z=S.getColorGradients();if(z){q.colorGradients=[];for(const S of z){const b={gradient:S.gradient,color1:S.color1.Zb()};S.color2?b.color2=S.color2.Zb():b.color2=S.color1.Zb(),q.colorGradients.push(b)}}const C=S.getRampGradients();if(C){q.rampGradients=[];for(const S of C){const b={gradient:S.gradient,color:S.color.Zb()};q.rampGradients.push(b)}q.useRampGradients=S.useRampGradients}const v=S.getColorRemapGradients();if(v){q.colorRemapGradients=[];for(const S of v){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.colorRemapGradients.push(b)}}const U=S.getAlphaRemapGradients();if(U){q.alphaRemapGradients=[];for(const S of U){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.alphaRemapGradients.push(b)}}const g=S.getSizeGradients();if(g){q.sizeGradients=[];for(const S of g){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.sizeGradients.push(b)}}const r=S.getAngularSpeedGradients();if(r){q.angularSpeedGradients=[];for(const S of r){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.angularSpeedGradients.push(b)}}const I=S.getVelocityGradients();if(I){q.velocityGradients=[];for(const S of I){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.velocityGradients.push(b)}}const V=S.getDragGradients();if(V){q.dragGradients=[];for(const S of V){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.dragGradients.push(b)}}const l=S.getEmitRateGradients();if(l){q.emitRateGradients=[];for(const S of l){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.emitRateGradients.push(b)}}const y=S.getStartSizeGradients();if(y){q.startSizeGradients=[];for(const S of y){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.startSizeGradients.push(b)}}const R=S.getLifeTimeGradients();if(R){q.lifeTimeGradients=[];for(const S of R){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.lifeTimeGradients.push(b)}}const G=S.getLimitVelocityGradients();if(G){q.limitVelocityGradients=[];for(const S of G){const b={gradient:S.gradient,factor1:S.factor1};void 0!==S.factor2?b.factor2=S.factor2:b.factor2=S.factor1,q.limitVelocityGradients.push(b)}q.limitVelocityDamping=S.limitVelocityDamping}S.noiseTexture&&(q.noiseTexture=S.noiseTexture.serialize())}clone(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let C=null;const v=this._engine;if(v.createEffectForParticles&&null!=this.customShader){C=this.customShader;const q=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"",S=v.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,q);z[0]?z[0].effect=S:this.setCustomEffect(S,0)}const U=this.serialize(b),g=gS.Parse(U,this._scene||this._engine,this._rootUrl);return g.name=q,g.customShader=C,g._customWrappers=z,void 0===S&&(S=this.j),this.noiseTexture&&(g.noiseTexture=this.noiseTexture.clone()),g.j=S,this.preventAutoStart||g.start(),g}}gS.BILLBOARDMODE_Y=2,gS.BILLBOARDMODE_ALL=7,gS.BILLBOARDMODE_STRETCHED=8,gS.BILLBOARDMODE_STRETCHED_LOCAL=9,hq._ParseParticleSystem=gS.Parse;var rS=b(11345),IS=b(11339),VS=b(11231);VS.e.prototype.createTransformFeedback=function(){const q=this._gl.createTransformFeedback();if(!q)throw new Error("Unable to create Transform Feedback");return q},VS.e.prototype.deleteTransformFeedback=function(q){this._gl.deleteTransformFeedback(q)},VS.e.prototype.bindTransformFeedback=function(q){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,q)},VS.e.prototype.beginTransformFeedback=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(q?this._gl.POINTS:this._gl.TRIANGLES)},VS.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},VS.e.prototype.setTranformFeedbackVaryings=function(q,S){this._gl.transformFeedbackVaryings(q,S,this._gl.INTERLEAVED_ATTRIBS)},VS.e.prototype.bindTransformFeedbackBuffer=function(q){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q?q.underlyingResource:null)},VS.e.prototype.readTransformFeedbackBuffer=function(q){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,q)};const lS="clipPlaneFragmentDeclaration2",yS="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";B.d.IncludesShadersStore[lS]||(B.d.IncludesShadersStore[lS]=yS);b(12406),b(12410),b(12417),b(12420),b(12428),b(12435),b(12444),b(12452);const RS="gpuRenderParticlesPixelShader",GS="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";B.d.ShadersStore[RS]||(B.d.ShadersStore[RS]=GS);const ZS="clipPlaneVertexDeclaration2",HS="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";B.d.IncludesShadersStore[ZS]||(B.d.IncludesShadersStore[ZS]=HS);b(12460),b(12468),b(12474),b(12477);const QS="gpuRenderParticlesVertexShader",kS="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";B.d.ShadersStore[QS]||(B.d.ShadersStore[QS]=kS);class WS extends r{static get IsSupported(){if(!Y.b.LastCreatedEngine)return!1;const q=Y.b.LastCreatedEngine.getCaps();return q.supportTransformFeedbacks||q.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(q){this._maxActiveParticleCount=Math.min(q,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(q){this.maxActiveParticleCount=q}createPointEmitter(q,S){const b=jq(q,S);return this.particleEmitterType=b,b}createHemisphericEmitter(){const q=Mq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createSphereEmitter(){const q=pq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=q,q}createDirectedSphereEmitter(){const q=Yq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.yS(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createCylinderEmitter(){const q=cq(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=q,q}createDirectedCylinderEmitter(){const q=qS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createConeEmitter(){const q=SS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=q,q}createDirectedConeEmitter(){const q=bS(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.yS(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.yS(0,1,0));return this.particleEmitterType=q,q}createBoxEmitter(q,S,b,z){const C=new l;return this.particleEmitterType=C,this.direction1=q,this.direction2=S,this.minEmitBox=b,this.maxEmitBox=z,C}get flowMap(){return this._flowMap}set flowMap(q){this._flowMap!==q&&(this._flowMap=q)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==gS.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(gS.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(gS.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";q?setTimeout((()=>{this.start(0)}),q):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var q;let S=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._customWrappers[S])||void 0===q?void 0:q.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[q]??this._customWrappers[0]}setCustomEffect(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[S]=new qq.e(this._engine),this._customWrappers[S].effect=q}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new M.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(q,S,b){return super._removeGradientAndTexture(q,S,b),this._releaseBuffers(),this}addColorGradient(q,S){this._colorGradients||(this._colorGradients=[]);const b=new P(q,S);return this._colorGradients.push(b),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(q&&this._colorGradients.sort(((q,S)=>q.gradient<S.gradient?-1:q.gradient>S.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(q){return this._removeGradientAndTexture(q,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const S in this._drawWrappers){var q;null===(q=this._drawWrappers[S].drawContext)||void 0===q||q.reset()}}_addFactorGradient(q,S,b){const z=new O(S,b);q.push(z),this._releaseBuffers()}addSizeGradient(q,S){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,q,S),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(q){return this._removeGradientAndTexture(q,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(q,S){if(!q)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&q.sort(((q,S)=>q.gradient<S.gradient?-1:q.gradient>S.gradient?1:0));const b=this;b[S]&&(b[S].dispose(),b[S]=null)}addAngularSpeedGradient(q,S){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,q,S),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(q){return this._removeGradientAndTexture(q,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(q,S){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,q,S),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(q){return this._removeGradientAndTexture(q,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(q,S){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,q,S),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(q){return this._removeGradientAndTexture(q,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(q,S){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,q,S),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(q){return this._removeGradientAndTexture(q,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(q){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(q),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.gb=new M.d,this.onStoppedObservable=new M.d,this.onStartedObservable=new M.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,b&&"Scene"!==b.getClassName()?(this._engine=b,this.defaultProjectionMatrix=z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=b||Y.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Gy.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,g.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,g.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,g.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,g.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new qq.e(this._engine)},this._customWrappers[0].effect=C,this._drawWrappers={0:new qq.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(S=S??{}).randomTextureSize||delete S.randomTextureSize;const U={WS:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...S},r=S;isFinite(r)&&(U.WS=r),this._capacity=U.WS,this._maxActiveParticleCount=U.WS,this._currentActiveCount=0,this._isAnimationSheetEnabled=v,this.particleEmitterType=new l;const I=Math.min(this._engine.getCaps().maxTextureSize,U.randomTextureSize);let V=[];for(let z=0;z<I;++z)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture=new p.c(new Float32Array(V),I,1,5,b,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,V=[];for(let z=0;z<I;++z)V.push(Math.random()),V.push(Math.random()),V.push(Math.random()),V.push(Math.random());this._randomTexture2=new p.c(new Float32Array(V),I,1,5,b,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=I}_reset(){this._releaseBuffers()}_createVertexBuffers(q,S,b){const z={};z.position=S.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let C=3;z.age=S.createVertexBuffer("age",C,1,this._attributesStrideSize,!0),C+=1,z.size=S.createVertexBuffer("size",C,3,this._attributesStrideSize,!0),C+=3,z.life=S.createVertexBuffer("life",C,1,this._attributesStrideSize,!0),C+=1,C+=4,this.billboardMode===gS.BILLBOARDMODE_STRETCHED&&(z.direction=S.createVertexBuffer("direction",C,3,this._attributesStrideSize,!0)),C+=3,this._platform.alignDataInBuffer&&(C+=1),this.particleEmitterType instanceof N&&(C+=3,this._platform.alignDataInBuffer&&(C+=1)),this._colorGradientsTexture||(z.color=S.createVertexBuffer("color",C,4,this._attributesStrideSize,!0),C+=4),this._isBillboardBased||(z.initialDirection=S.createVertexBuffer("initialDirection",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),this.noiseTexture&&(z.noiseCoordinates1=S.createVertexBuffer("noiseCoordinates1",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1),z.noiseCoordinates2=S.createVertexBuffer("noiseCoordinates2",C,3,this._attributesStrideSize,!0),C+=3,this._platform.alignDataInBuffer&&(C+=1)),z.angle=S.createVertexBuffer("angle",C,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?C++:C+=2,this._isAnimationSheetEnabled&&(z.cellIndex=S.createVertexBuffer("cellIndex",C,1,this._attributesStrideSize,!0),C+=1,this.spriteRandomStartCell&&(z.cellStartOffset=S.createVertexBuffer("cellStartOffset",C,1,this._attributesStrideSize,!0),C+=1)),z.offset=b.createVertexBuffer("offset",0,2),z.uv=b.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(z),this._platform.createVertexBuffers(q,z),this.resetDrawCache()}_initialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!q)return;const S=this._engine,b=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof N&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const C=this.particleEmitterType instanceof N,v=z.TmpVectors.yS[0];let U=0;for(let z=0;z<this._capacity;z++)if(b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),C?(this.particleEmitterType.particleDestinationGenerator(z,null,v),b.push(v.x),b.push(v.y),b.push(v.z)):(b.push(0),b.push(0),b.push(0)),this._platform.alignDataInBuffer&&b.push(0),U+=16,C&&(this.particleEmitterType.particlePositionGenerator(z,null,v),b.push(v.x),b.push(v.y),b.push(v.z),this._platform.alignDataInBuffer&&b.push(0),U+=4),this._colorGradientsTexture||(b.push(0),b.push(0),b.push(0),b.push(0),U+=4),this.isBillboardBased||(b.push(0),b.push(0),b.push(0),this._platform.alignDataInBuffer&&b.push(0),U+=4),this.noiseTexture&&(b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),b.push(Math.random()),b.push(Math.random()),b.push(Math.random()),this._platform.alignDataInBuffer&&b.push(0),U+=8),b.push(0),U+=1,this._angularSpeedGradientsTexture||(b.push(0),U+=1),this._isAnimationSheetEnabled&&(b.push(0),U+=1,this.spriteRandomStartCell&&(b.push(0),U+=1)),this._platform.alignDataInBuffer){let q=3-(U+3&3);for(U+=q;q-- >0;)b.push(0)}const g=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),r=this._platform.createParticleBuffer(b),I=this._platform.createParticleBuffer(b);this._buffer0=new u.b(S,r,!1,this._attributesStrideSize),this._buffer1=new u.b(S,I,!1,this._attributesStrideSize),this._spriteBuffer=new u.b(S,g,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let q=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(q+="\n#define BILLBOARD"),this._colorGradientsTexture&&(q+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(q+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(q+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(q+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(q+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(q+="\n#define DRAGGRADIENTS"),this._flowMap&&(q+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(q+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(q+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(q+="\n#define NOISE"),this.isLocal&&(q+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===q||(this._cachedUpdateDefines=q,this._updateBuffer=this._platform.createUpdateBuffer(q)),this._platform.isUpdateBufferReady()}_getWrapper(q){const S=this._getCustomDrawWrapper(q);if(null!==S&&void 0!==S&&S.effect)return S;const b=[];this.fillDefines(b,q);let z=this._drawWrappers[q];z||(z=new qq.e(this._engine),z.drawContext&&(z.drawContext.useInstancing=!0),this._drawWrappers[q]=z);const C=b.join("\n");if(z.defines!==C){const q=[],S=[],b=[];this.fillUniformsAttributesAndSamplerNames(S,q,b),z.setEffect(this._engine.createEffect("gpuRenderParticles",q,S,b,C),C)}return z}static _GetAttributeNamesOrOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=[u.f.PositionKind,"age","life","size","angle"];return q||C.push(u.f.ColorKind),S&&C.push("cellIndex"),b||C.push("initialDirection"),z&&C.push("direction"),C.push("offset",u.f.UVKind),C}static _GetEffectCreationOptions(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["emitterWM","KI","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Sq.d)(z),q&&z.push("sheetInfos"),S&&z.push("logarithmicDepthConstant"),b&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Sq.k)(this,this._scene,q),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==IS.c.FOGMODE_NONE&&q.push("#define FOG")),S===gS.BLENDMODE_MULTIPLY&&q.push("#define BLENDMULTIPLYMODE"),this.isLocal&&q.push("#define LOCAL"),this.useLogarithmicDepth&&q.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(q.push("#define BILLBOARD"),this.billboardMode){case gS.BILLBOARDMODE_Y:q.push("#define BILLBOARDY");break;case gS.BILLBOARDMODE_STRETCHED:q.push("#define BILLBOARDSTRETCHED");break;case gS.BILLBOARDMODE_ALL:q.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&q.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&q.push("#define ANIMATESHEET"),b&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),q.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(q,S,b){S.push(...WS._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===gS.BILLBOARDMODE_STRETCHED)),q.push(...WS._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),b.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(rS.b.PrepareUniforms(q,this._imageProcessingConfigurationDefines),rS.b.PrepareSamplers(b,this._imageProcessingConfigurationDefines))}animate(){var q;let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(S?this.preWarmStepOffset:(null===(q=this._scene)||void 0===q?void 0:q.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(q,S){const b=this[S];if(!q||!q.length||b)return;const z=new Float32Array(this._rawTextureWidth);for(let C=0;C<this._rawTextureWidth;C++){const S=C/this._rawTextureWidth;j.GetCurrentGradient(S,q,((q,S,b)=>{z[C]=(0,I.Lerp)(q.factor1,S.factor1,b)}))}this[S]=p.c.CreateRTexture(z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[S].name=S.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const q=new Uint8Array(4*this._rawTextureWidth),S=U.e.Jb[0];for(let b=0;b<this._rawTextureWidth;b++){const z=b/this._rawTextureWidth;j.GetCurrentGradient(z,this._colorGradients,((z,C,v)=>{U.b.LerpToRef(z.color1,C.color1,v,S),q[4*b]=255*S.r,q[4*b+1]=255*S.g,q[4*b+2]=255*S.b,q[4*b+3]=255*S.a}))}this._colorGradientsTexture=p.c.CreateRGBATexture(q,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(q,S){var b,C,v,U;const g=this._getWrapper(q),r=g.effect;this._engine.enableEffect(g);const I=(null===(b=this._scene)||void 0===b?void 0:b.getViewMatrix())||z.Matrix.IdentityReadOnly;if(r.setMatrix("view",I),r.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),r.setTexture("diffuseSampler",this.particleTexture),r.setVector2("translationPivot",this.translationPivot),r.setVector3("KI",this.KI),this.isLocal&&r.setMatrix("emitterWM",S),this._colorGradientsTexture?r.setTexture("colorGradientSampler",this._colorGradientsTexture):r.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const q=this.particleTexture.getBaseSize();r.setFloat3("sheetInfos",this.spriteCellWidth/q.width,this.spriteCellHeight/q.height,q.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const q=this._scene.activeCamera;r.setVector3("eyePosition",q.globalPosition)}const V=r.defines;if(this._scene&&((0,Sq.f)(r,this,this._scene),this.applyFog&&(0,bq.g)(this._scene,void 0,r)),V.indexOf("#define BILLBOARDMODE_ALL")>=0){const q=I.clone();q.invert(),r.setMatrix("invView",q)}return this.useLogarithmicDepth&&this._scene&&(0,bq.l)(V,r,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(r),this._setEngineBasedOnBlendMode(q),this._platform.bindDrawBuffers(this._targetIndex,r,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(r),null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(U=this._scene)&&void 0!==U&&U.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(q){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!q)if(this.j.position){q=this.j.getWorldMatrix()}else{const S=this.j;q=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(S.x,S.y,S.z,q)}const S=this._engine,b=S.getDepthWrite();if(S.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const q=this.Tq();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",q.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",q),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const C=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=C,S.setDepthWrite(b)}render(){let q,S=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!S&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let q=0;q<this.preWarmCycles;q++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const q=0|this._accumulatedCount;this._accumulatedCount-=q,this._currentActiveCount+=q}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){q=this.j.getWorldMatrix()}else{const S=this.j;q=z.TmpVectors.Matrix[0],z.Matrix.TranslationToRef(S.x,S.y,S.z,q)}const C=this._engine;this.updateInAnimate||this._update(q);let v=0;return S||b||(C.setState(!1),this.forceDepthWrite&&C.setDepthWrite(!0),v=this.blendMode===gS.BLENDMODE_MULTIPLYADD?this._render(gS.BLENDMODE_MULTIPLY,q)+this._render(gS.BLENDMODE_ADD,q):this._render(this.blendMode,q),this._engine.setAlphaMode(0)),v}rebuild(){const q=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(q,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,q()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const S in this._drawWrappers){this._drawWrappers[S].dispose()}if(this._drawWrappers={},this._scene){const q=this._scene.Gy.indexOf(this);q>-1&&this._scene.Gy.splice(q,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let S=0;S<this._renderVertexBuffers.length;++S){const q=this._renderVertexBuffers[S];for(const S in q)q[S].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),q&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),q&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.gb.notifyObservers(this),this.gb.clear()}clone(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let C=null;const v=this._engine;if(v.createEffectForParticles&&null!=this.customShader){C=this.customShader;const q=C.shaderOptions.defines.length>0?C.shaderOptions.defines.join("\n"):"";z[0]=v.createEffectForParticles(C.shaderPath.fragmentElement,C.shaderOptions.uniforms,C.shaderOptions.samplers,q,void 0,void 0,void 0,this)}const U=this.serialize(b),g=WS.Parse(U,this._scene||this._engine,this._rootUrl);return g.name=q,g.customShader=C,g._customWrappers=z,void 0===S&&(S=this.j),this.noiseTexture&&(g.noiseTexture=this.noiseTexture.clone()),g.j=S,g}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={};return gS._Serialize(S,this,q),S.activeParticleCount=this.activeParticleCount,S.randomTextureSize=this._randomTextureSize,S.customShader=this.customShader,S}static Parse(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const v=q.name;let U,g;S instanceof Oq.c?U=S:(g=S,U=g.getEngine());const r=new WS(v,{WS:C||q.WS,randomTextureSize:q.randomTextureSize},S,null,q.isAnimationSheetEnabled);if(r._rootUrl=b,q.customShader&&U.createEffectForParticles){const S=q.customShader,b=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",z=U.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,b,void 0,void 0,void 0,r);r.setCustomEffect(z,0),r.customShader=S}return q.id&&(r.id=q.id),q.activeParticleCount&&(r.activeParticleCount=q.activeParticleCount),gS._Parse(q,r,S,b),q.preventAutoStart&&(r.preventAutoStart=q.preventAutoStart),z||r.preventAutoStart||r.start(),r}}var NS=b(10921),uS=b(12483),XS=b(11485);class TS{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(q){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const S of this.systems)S.j=q;this._emitterNode=q}setEmitterAsSphere(q,S,b){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:q,renderingGroupId:S};const z=(0,uS.c)("emitterSphere",{diameter:q.diameter,segments:q.segments},b);z.renderingGroupId=S;const C=new XS.ZS("emitterSphereMaterial",b);C.emissiveColor=q.color,z.material=C;for(const v of this.systems)v.j=z;this._emitterNode=z}start(q){for(const S of this.systems)q&&(S.j=q),S.start()}dispose(){for(const q of this.systems)q.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const S={systems:[]};for(const b of this.systems)S.systems.push(b.serialize(q));return this._emitterNode&&(S.j=this._emitterCreationOptions),S}static Parse(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;const C=new TS,v=this.BaseAssetsUrl+"/textures/";S=S||Y.b.LastCreatedScene;for(const U of q.systems)C.systems.push(b?WS.Parse(U,S,v,!0,z):gS.Parse(U,S,v,!0,z));if(q.j){const b=q.j.options;if("Sphere"===q.j.kind)C.setEmitterAsSphere({diameter:b.diameter,segments:b.segments,color:U.HS.Hb(b.color)},q.j.renderingGroupId,S)}return C}}TS.BaseAssetsUrl="https://assets.babylonjs.com/particles";var BS=b(10966);class tS{static CreateDefault(q){let S,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,z=arguments.length>2?arguments[2]:void 0;S=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new WS("default system",{WS:b},z):new gS("default system",b,z),S.j=q;const C=NS.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return S.particleTexture=new d.e(C,S.Tq()),S.createConeEmitter(.1,Math.PI/4),S.color1=new U.b(1,1,1,1),S.color2=new U.b(1,1,1,1),S.colorDead=new U.b(1,1,1,0),S.minSize=.1,S.maxSize=.1,S.minEmitPower=2,S.maxEmitPower=2,S.updateSpeed=1/60,S.emitRate=30,S}static CreateAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;S||(S=Y.b.LastCreatedScene);const C={};return S.addPendingData(C),new Promise(((v,U)=>{if(b&&!WS.IsSupported)return S.removePendingData(C),U("Particle system with GPU is not supported.");NS.Tools.LoadFile(`${tS.BaseAssetsUrl}/systems/${q}.json`,(q=>{S.removePendingData(C);const U=JSON.parse(q.toString());return v(TS.Parse(U,S,b,z))}),void 0,void 0,void 0,(()=>(S.removePendingData(C),U(`An error occurred with the creation of your particle system. Check if your type '${q}' exists.`))))}))}static ExportSet(q){const S=new TS;for(const b of q)S.systems.push(b);return S}static ParseFromFileAsync(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",v=arguments.length>5?arguments[5]:void 0;return new Promise(((U,g)=>{const r=new BS.c;r.addEventListener("readystatechange",(()=>{if(4==r.readyState)if(200==r.status){const S=JSON.parse(r.responseText);let g;g=z?WS.Parse(S,b,C,!1,v):gS.Parse(S,b,C,!1,v),q&&(g.name=q),U(g)}else g("Unable to load the particle system")})),r.open("GET",S),r.send()}))}static ParseFromSnippetAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0;if("_BLANK"===q){const q=this.CreateDefault(null);return q.start(),Promise.resolve(q)}return new Promise(((v,U)=>{const g=new BS.c;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const U=JSON.parse(JSON.parse(g.responseText).jsonPayload),r=JSON.parse(U.particleSystem);let I;I=b?WS.Parse(r,S,z,!1,C):gS.Parse(r,S,z,!1,C),I.snippetId=q,v(I)}else U("Unable to load the snippet "+q)})),g.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),g.send()}))}}tS.BaseAssetsUrl=TS.BaseAssetsUrl,tS.SnippetUrl="https://snippet.babylonjs.com",tS.CreateFromSnippetAsync=tS.ParseFromSnippetAsync;var fS=b(11555),mS=b(11379),ES=b(12489);(0,ES.d)(mS.c.NAME_PARTICLESYSTEM,((q,S,b,z)=>{const C=(0,ES.g)(mS.c.NAME_PARTICLESYSTEM);if(C&&void 0!==q.Gy&&null!==q.Gy)for(let v=0,U=q.Gy.length;v<U;v++){const U=q.Gy[v];b.Gy.push(C(U,S,z))}})),(0,ES.b)(mS.c.NAME_PARTICLESYSTEM,((q,S,b)=>{if(q.activeParticleCount){return WS.Parse(q,S,b)}return gS.Parse(q,S,b)})),Oq.c.prototype.createEffectForParticles=function(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",v=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0,r=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,V=arguments.length>9?arguments[9]:void 0,l=[],y=[];const R=[];return r?r.fillUniformsAttributesAndSamplerNames(y,l,R):(l=gS._GetAttributeNamesOrOptions(),y=gS._GetEffectCreationOptions()),-1===C.indexOf(" BILLBOARD")&&(C+="\n#define BILLBOARD\n"),null!==r&&void 0!==r&&r.isAnimationSheetEnabled&&-1===C.indexOf(" ANIMATESHEET")&&(C+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:V??(null===r||void 0===r?void 0:r.vertexShaderName)??"particles",fragmentElement:q},l,y.concat(S),R.concat(z),C,v,U,g,void 0,I,(async()=>{0===I?await Promise.resolve().then(b.bind(b,12518)):await Promise.resolve().then(b.bind(b,12584))}))},fS.d.prototype.getEmittedParticleSystems=function(){const q=[];for(let S=0;S<this.Tq().Gy.length;S++){const b=this.Tq().Gy[S];b.j===this&&q.push(b)}return q},fS.d.prototype.getHierarchyEmittedParticleSystems=function(){const q=[],S=this.getDescendants();S.push(this);for(let b=0;b<this.Tq().Gy.length;b++){const z=this.Tq().Gy[b],C=z.j;C.position&&-1!==S.indexOf(C)&&q.push(z)}return q};b(11446),b(11457),b(11532);b(11535),b(12492),b(11307),b(11432),b(11568);b(11300);var eS;b(12496),b(11128);!function(q){q[q.Color=2]="Color",q[q.UV=1]="UV",q[q.Random=0]="Random",q[q.Stated=3]="Stated"}(eS||(eS={}));var iS=b(11329);const JS=new z.yS(0,0,0),LS=new z.yS(0,0,0),dS=new z.yS(0,0,0);class KS{constructor(q,S,b){this.width=q,this.height=S,this.data=b}processFlowable(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;if(!b)return;b instanceof z.Matrix?z.yS.TransformCoordinatesToRef(q.position,b,dS):(dS.x=b.x,dS.y=b.y,dS.z=b.z);const C=.5*dS.x+.5,v=1-(.5*dS.y+.5),U=Math.floor(C*this.width),g=Math.floor(v*this.height);if(U<0||U>=this.width||g<0||g>=this.height)return;const r=4*(g*this.width+U),I=this.data[r]/255*2-1,V=this.data[r+1]/255*2-1,l=this.data[r+2]/255*2-1,y=this.data[r+3]/255;JS.set(I,V,l),JS.scaleToRef(S*y,LS),q.direction.addInPlace(LS)}_processParticle(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,b=arguments.length>2?arguments[2]:void 0;this.processFlowable(q,S,b)}static async FromUrlAsync(q){return await new Promise(((S,b)=>{const z=document.createElement("canvas"),C=z.getContext("2d");let v=null;const U=new Image;U.crossOrigin="anonymous",U.src=q,U.onerror=S=>{b(new Error(`Failed to load image: ${q} : ${S}`))},U.onload=()=>{z.width=U.width,z.height=U.height,C.drawImage(U,0,0),v=C.getImageData(0,0,z.width,z.height),S(new KS(z.width,z.height,v.data))}}))}static async ExtractFromTextureAsync(q){return await new Promise(((S,b)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{const b=await this.ExtractFromTextureAsync(q);S(b)}catch(z){b(z)}}));const z=q.getSize();iS.j.GetTextureDataAsync(q,z.width,z.height).then((q=>{S(new KS(z.width,z.height,new Uint8ClampedArray(q)))})).catch(b)}))}}var DS,xS,FS,aS,nS,oS,sS,AS,wS;!function(q){q[q.Int=1]="Int",q[q.Float=2]="Float",q[q.Vector2=4]="Vector2",q[q.yS=8]="yS",q[q.Matrix=16]="Matrix",q[q.Particle=32]="Particle",q[q.Texture=64]="Texture",q[q.Jb=128]="Jb",q[q.FloatGradient=256]="FloatGradient",q[q.Vector2Gradient=512]="Vector2Gradient",q[q.Vector3Gradient=1024]="Vector3Gradient",q[q.Color4Gradient=2048]="Color4Gradient",q[q.System=4096]="System",q[q.AutoDetect=8192]="AutoDetect",q[q.BasedOnInput=16384]="BasedOnInput",q[q.Undefined=32768]="Undefined",q[q.All=65535]="All"}(DS||(DS={})),function(q){q[q.Compatible=0]="Compatible",q[q.TypeIncompatible=1]="TypeIncompatible",q[q.HierarchyIssue=2]="HierarchyIssue"}(xS||(xS={})),function(q){q[q.Input=0]="Input",q[q.Output=1]="Output"}(FS||(FS={}));class PS{get direction(){return this._direction}get type(){if(this._type===DS.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===DS.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(q){this._type=q}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((q=>q.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(q,S,b){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=DS.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new M.d,this.onDisconnectionObservable=new M.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=S,this.name=q,this._direction=b}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(q){var S;return this.isConnected?null!==(S=this._connectedPoint)&&void 0!==S&&S._storedFunction?this._connectedPoint._storedFunction(q):this._connectedPoint._storedValue:this.value}canConnectTo(q){return 0===this.checkCompatibilityState(q)}checkCompatibilityState(q){const S=this._ownerBlock,b=q.ownerBlock;if(this.type!==q.type&&q.innerType!==DS.AutoDetect)return q.acceptedConnectionPointTypes&&-1!==q.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(q.excludedConnectionPointTypes&&-1!==q.excludedConnectionPointTypes.indexOf(this.type))return 1;let z=b,C=S;return 0===this.direction&&(z=S,C=b),z.isAnAncestorOf(C)?2:0}connectTo(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(q))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${q.ownerBlock.name}".${q.name}`;return this._endpoints.push(q),q._connectedPoint=this,this.onConnectionObservable.notifyObservers(q),q.onConnectionObservable.notifyObservers(this),this}disconnectFrom(q){const S=this._endpoints.indexOf(q);return-1===S||(this._endpoints.splice(S,1),q._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(q),q.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(q){let S=1;for(;S<DS.All;)q&S||this.excludedConnectionPointTypes.push(S),S<<=1}serialize(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const S={};return S.name=this.name,S.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Zb?(S.valueType="BABYLON."+this.value.getClassName(),S.value=this.value.Zb()):(S.valueType="number",S.value=this.value)),q&&this.connectedPoint&&(S.inputName=this.name,S.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,S.targetConnectionName=this.connectedPoint.name,S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(S.isExposedOnFrame=!0,S.exposedPortPosition=this.exposedPortPosition),S}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class hS{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(q){this._name=q}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(q){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new M.d,this.gb=new M.d,this.onInputChangedObservable=new M.d,this.visibleOnFrame=!1,this._name=q,this.uniqueId=K.c.UniqueId}_inputRename(q){return q}_outputRename(q){return q}isAnAncestorOf(q){for(const S of this._outputs)if(S.hasEndpoints)for(const b of S.endpoints){if(b.ownerBlock===q)return!0;if(b.ownerBlock.isAnAncestorOf(q))return!0}return!1}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const S of this._outputs)if(S.hasEndpoints)for(const b of S.endpoints)if(b.ownerBlock.isAnAncestorOfType(q))return!0;return!1}getInputByName(q){const S=this._inputs.filter((S=>S.name===q));return S.length?S[0]:null}_linkConnectionTypes(q,S){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[S]._acceptedConnectionPointType=this._inputs[q]:(this._inputs[q]._linkedConnectionSource=this._inputs[S],this._inputs[q]._isMainLinkSource=!0),this._inputs[S]._linkedConnectionSource=this._inputs[q]}registerInput(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0;const U=new PS(q,this,0);return U.type=S,U.isOptional=b,U.defaultValue=z,U.value=z,U.valueMin=C,U.valueMax=v,this._inputs.push(U),this.onInputChangedObservable.notifyObservers(U),this}registerOutput(q,S,b){return(b=b??new PS(q,this,1)).type=S,this._outputs.push(b),this}_build(q){}_customBuildStep(q){}build(q){if(this._buildId===q.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((q=>q.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=q.buildId;for(const S of this._inputs){if(!S.connectedPoint){S.isOptional||q.notConnectedNonOptionalInputs.push(S);continue}const b=S.connectedPoint.ownerBlock;b&&b!==this&&!b.isSystem&&b.build(q)}return this._customBuildStep(q),q.verbose&&D.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(q),this.onBuildObservable.notifyObservers(this),!1}serialize(){const q={};q.customType="BABYLON."+this.getClassName(),q.id=this.uniqueId,q.name=this.name,q.visibleOnFrame=this.visibleOnFrame,q.inputs=[],q.outputs=[];for(const S of this.inputs)q.inputs.push(S.serialize());for(const S of this.outputs)q.outputs.push(S.serialize(!1));return q}_deserialize(q){this._name=q.name,this.comments=q.comments,this.visibleOnFrame=!!q.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(q)}_deserializePortDisplayNamesAndExposedOnFrame(q){const S=q.inputs,b=q.outputs;if(S)for(const z of S){const q=this.inputs.find((q=>q.name===z.name));if(!q)return;if(z.displayName&&(q.displayName=z.displayName),z.isExposedOnFrame&&(q.isExposedOnFrame=z.isExposedOnFrame,q.exposedPortPosition=z.exposedPortPosition),void 0!==z.value&&null!==z.value)if("number"===z.valueType)q.value=z.value;else{const S=(0,g.c)(z.valueType);S&&(q.value=S.Hb(z.value))}}if(b)for(let z=0;z<b.length;z++){const q=b[z];q.displayName&&(this.outputs[z].displayName=q.displayName),q.isExposedOnFrame&&(this.outputs[z].isExposedOnFrame=q.isExposedOnFrame,this.outputs[z].exposedPortPosition=q.exposedPortPosition)}}clone(){const q=this.serialize(),S=(0,g.c)(q.customType);if(S){const b=new S;return b._deserialize(q),b}return null}dispose(){this.gb.notifyObservers(this),this.gb.clear();for(const q of this.inputs)q.dispose();for(const q of this.outputs)q.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function OS(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",z=arguments.length>3?arguments[3]:void 0;return(C,v)=>{let U=C._propStore;U||(U=[],C._propStore=U),U.push({propertyName:v,displayName:q,type:S,groupName:b,options:z??{},className:C.getClassName()})}}(0,i.e)([(0,J.J)("comment")],hS.prototype,"comments",void 0),function(q){q[q.Boolean=0]="Boolean",q[q.Float=1]="Float",q[q.Int=2]="Int",q[q.Vector2=3]="Vector2",q[q.List=4]="List",q[q.Jb=5]="Jb",q[q.SamplingMode=6]="SamplingMode",q[q.TextureFormat=7]="TextureFormat",q[q.TextureType=8]="TextureType"}(aS||(aS={})),function(q){q[q.None=0]="None",q[q.Position=1]="Position",q[q.Direction=2]="Direction",q[q.Age=3]="Age",q[q.Lifetime=4]="Lifetime",q[q.Color=5]="Color",q[q.ScaledDirection=6]="ScaledDirection",q[q.Scale=7]="Scale",q[q.AgeGradient=8]="AgeGradient",q[q.Angle=9]="Angle",q[q.SpriteCellIndex=16]="SpriteCellIndex",q[q.SpriteCellStart=17]="SpriteCellStart",q[q.SpriteCellEnd=18]="SpriteCellEnd"}(nS||(nS={})),function(q){q[q.None=0]="None",q[q.Time=1]="Time",q[q.Delta=2]="Delta",q[q.Emitter=3]="Emitter"}(oS||(oS={}));class jS{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let q="";for(const S of this.notConnectedNonOptionalInputs)q+=`input ${S.name} from block ${S.ownerBlock.name}[${S.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(q)throw"Build of Node Particle System Set failed:\n"+q}adapt(q,S){const b=q.getConnectedValue(this)||0;if(q.type===S)return b;switch(S){case DS.Vector2:return new z.Vector2(b,b);case DS.yS:return new z.yS(b,b,b);case DS.Jb:return new U.b(b,b,b,b)}return null}getContextualValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case nS.Position:return this.particleContext.position;case nS.Direction:return this.particleContext.direction;case nS.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case nS.Color:return this.particleContext.color;case nS.Age:return this.particleContext.age;case nS.Lifetime:return this.particleContext.lifeTime;case nS.Angle:return this.particleContext.angle;case nS.Scale:return this.particleContext.scale;case nS.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case nS.SpriteCellEnd:return this.systemContext.endSpriteCellID;case nS.SpriteCellIndex:return this.particleContext.cellIndex;case nS.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(q){if(!this.particleContext||!this.systemContext)return null;switch(q){case oS.Time:return this.systemContext._actualFrame;case oS.Delta:return this.systemContext._scaledUpdateSpeed;case oS.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function MS(q,S,b){const z=new jS;z.GS=S;const C=q.createSystem(z);return C.canStart=()=>!0,C.j=b.clone(),C.disposeOnStop=!0,C.start(),C}class pS extends hS{constructor(q){super(q),this.blendMode=r.BLENDMODE_ONEONE,this.WS=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",DS.Particle),this.registerInput("texture",DS.Texture),this.registerInput("onStart",DS.System,!0),this.registerInput("onEnd",DS.System,!0),this.registerOutput("system",DS.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(q){q.WS=this.WS,q.buildId=this._buildId++,this.build(q);const S=this.particle.getConnectedValue(q);return S.particleTexture=this.texture.getConnectedValue(q),S.emitRate=this.emitRate,S.blendMode=this.blendMode,S.name=this.name,S._nodeGenerated=!0,S._targetStopDuration=this.targetStopDuration,S.startDelay=this.startDelay,this.system._storedValue=this,S.canStart=()=>!this.doNoStart,S.onStartedObservable.add((b=>{const z=this.onStart.getConnectedValue(q);z&&b.onStartedObservable.addOnce((()=>{q.systemContext=S;const b=MS(z,q.GS,q.emitterPosition);this.gb.addOnce((()=>{b.dispose()}))}));const C=this.onEnd.getConnectedValue(q);C&&b.onStoppedObservable.addOnce((()=>{q.systemContext=S;const b=MS(C,q.GS,q.emitterPosition);this.gb.addOnce((()=>{b.dispose()}))}))})),this.gb.addOnce((()=>{S.dispose()})),S}serialize(){const q=super.serialize();return q.WS=this.WS,q.emitRate=this.emitRate,q.blendMode=this.blendMode,q.doNoStart=this.doNoStart,q.targetStopDuration=this.targetStopDuration,q.startDelay=this.startDelay,q}_deserialize(q){super._deserialize(q),this.WS=q.WS,this.emitRate=q.emitRate,this.doNoStart=!!q.doNoStart,void 0!==q.blendMode&&(this.blendMode=q.blendMode),void 0!==q.targetStopDuration&&(this.targetStopDuration=q.targetStopDuration),void 0!==q.startDelay&&(this.startDelay=q.startDelay)}}(0,i.e)([OS("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:r.BLENDMODE_ONEONE},{label:"Standard",value:r.BLENDMODE_STANDARD},{label:"Add",value:r.BLENDMODE_ADD},{label:"Multiply",value:r.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:r.BLENDMODE_MULTIPLYADD}]})],pS.prototype,"blendMode",void 0),(0,i.e)([OS("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],pS.prototype,"WS",void 0),(0,i.e)([OS("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pS.prototype,"emitRate",void 0),(0,i.e)([OS("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pS.prototype,"targetStopDuration",void 0),(0,i.e)([OS("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],pS.prototype,"startDelay",void 0),(0,i.e)([OS("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],pS.prototype,"doNoStart",void 0),(0,g.f)("BABYLON.SystemBlock",pS);class YS extends hS{get type(){if(this._type===DS.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=DS.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=DS.Vector2,this._type;case"yS":return this._type=DS.yS,this._type;case"Jb":return this._type=DS.Jb,this._type;case"Matrix":return this._type=DS.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===nS.None&&this._systemSource!==oS.None}get systemSource(){return this._systemSource}set systemSource(q){if(this._systemSource=q,q!==oS.None){switch(this._contextualSource=nS.None,this._type=DS.Float,q){case oS.Time:case oS.Delta:this._type=DS.Float;break;case oS.Emitter:this._type=DS.yS}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==nS.None}get contextualValue(){return this._contextualSource}set contextualValue(q){if(this._contextualSource=q,q!==nS.None){switch(this._systemSource=oS.None,q){case nS.Scale:this._type=DS.Vector2;break;case nS.Position:case nS.Direction:case nS.ScaledDirection:this._type=DS.yS;break;case nS.Color:this._type=DS.Jb;break;case nS.Age:case nS.Lifetime:case nS.Angle:case nS.AgeGradient:this._type=DS.Float;break;case nS.SpriteCellEnd:case nS.SpriteCellStart:case nS.SpriteCellIndex:this._type=DS.Int}this.output&&(this.output.type=this._type)}}constructor(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DS.AutoDetect;super(q),this._type=DS.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new M.d,this._systemSource=oS.None,this._contextualSource=nS.None,this._type=S,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",S)}get value(){return this._storedValue}set value(q){this.type===DS.Float&&this.min!==this.max&&(q=Math.max(this.min,q),q=Math.min(this.max,q)),this._storedValue=q,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(q){this._valueCallback=q}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case DS.Int:case DS.Float:this.value=0;break;case DS.Vector2:this.value=z.Vector2.Zero();break;case DS.yS:this.value=z.yS.Zero();break;case DS.Jb:this.value=new U.b(1,1,1,1);break;case DS.Matrix:this.value=z.Matrix.Identity()}}_build(q){super._build(q),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=q=>q.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=q=>q.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const q=super.serialize();return q.type=this.type,q.contextualValue=this.contextualValue,q.systemSource=this.systemSource,q.min=this.min,q.max=this.max,q.groupInInspector=this.groupInInspector,q.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Zb?(q.valueType="BABYLON."+this._storedValue.getClassName(),q.value=this._storedValue.Zb()):(q.valueType="number",q.value=this._storedValue)),q}_deserialize(q){if(super._deserialize(q),this._type=q.type,this.contextualValue=q.contextualValue,this.systemSource=q.systemSource||oS.None,this.min=q.min||0,this.max=q.max||0,this.groupInInspector=q.groupInInspector||"",void 0!==q.displayInInspector&&(this.displayInInspector=q.displayInInspector),q.valueType)if("number"===q.valueType)this._storedValue=q.value;else{const S=(0,g.c)(q.valueType);S&&(this._storedValue=S.Hb(q.value))}}}(0,g.f)("BABYLON.ParticleInputBlock",YS);class cS extends hS{get url(){return this._url}set url(q){this._url!==q&&(this._cachedData=null,this._url=q,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(q){this._textureDataUrl!==q&&(this._cachedData=null,this._textureDataUrl=q,this._url="",this._sourceTexture=null)}set sourceTexture(q){this._sourceTexture!==q&&(this._cachedData=null,this._sourceTexture=q,this._url="",this._textureDataUrl="")}constructor(q){super(q),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",DS.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const q=this.texture._storedValue;return await new Promise(((S,b)=>{if(!q.isReady())return void q.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),S(this._cachedData)}catch(q){b(q)}}));const z=q.getSize();iS.j.GetTextureDataAsync(q,z.width,z.height).then((b=>{this._cachedData={width:z.width,height:z.height,data:new Uint8ClampedArray(b)},q.dispose(),S(this._cachedData)})).catch(b)}))}_build(q){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new d.e(this._textureDataUrl,q.GS):this.texture._storedValue=new d.e(this._url,q.GS):this.texture._storedValue=null}serialize(){const q=super.serialize();return q.url=this.url,q.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(q.textureDataUrl=this.textureDataUrl),q}_deserialize(q){super._deserialize(q),this.url=q.url,this.serializedCachedData=!!q.serializedCachedData,q.textureDataUrl&&(this.textureDataUrl=q.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,g.f)("BABYLON.ParticleTextureSourceBlock",cS);class qb extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("position",DS.yS),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.position.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.position.v(this.position.getConnectedValue(q))},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}}(0,g.f)("BABYLON.UpdatePositionBlock",qb),function(q){q[q.Add=0]="Add",q[q.Subtract=1]="Subtract",q[q.Multiply=2]="Multiply",q[q.Divide=3]="Divide",q[q.Max=4]="Max",q[q.Min=5]="Min"}(sS||(sS={}));class Sb extends hS{constructor(q){super(q),this.operation=sS.Add,this.registerInput("left",DS.AutoDetect),this.registerInput("right",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this.output._typeConnectionSource=this.left;const S=[DS.Matrix,DS.Particle,DS.Texture,DS.System,DS.FloatGradient,DS.Color4Gradient,DS.Vector2Gradient,DS.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...S),this.right.excludedConnectionPointTypes.push(...S),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(q){let S;const b=this.left,C=this.right;if(!b.isConnected||!C.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const v=b.type===DS.Float||b.type===DS.Int,g=C.type===DS.Float||C.type===DS.Int,r=v&&g;switch(this.operation){case sS.Add:S=r?q=>b.getConnectedValue(q)+C.getConnectedValue(q):v?q=>q.adapt(b,C.type).add(C.getConnectedValue(q)):q=>b.getConnectedValue(q).add(q.adapt(C,b.type));break;case sS.Subtract:S=r?q=>b.getConnectedValue(q)-C.getConnectedValue(q):v?q=>q.adapt(b,C.type).RS(C.getConnectedValue(q)):q=>b.getConnectedValue(q).RS(q.adapt(C,b.type));break;case sS.Multiply:S=r?q=>b.getConnectedValue(q)*C.getConnectedValue(q):v?q=>q.adapt(b,C.type).multiply(C.getConnectedValue(q)):q=>b.getConnectedValue(q).multiply(q.adapt(C,b.type));break;case sS.Divide:S=r?q=>b.getConnectedValue(q)/C.getConnectedValue(q):v?q=>q.adapt(b,C.type).divide(C.getConnectedValue(q)):q=>b.getConnectedValue(q).divide(q.adapt(C,b.type));break;case sS.Min:if(r)S=q=>Math.min(b.getConnectedValue(q),C.getConnectedValue(q));else{const[q,g]=v?[C,b]:[b,C];switch(q.type){case DS.Vector2:S=S=>z.Vector2.Minimize(q.getConnectedValue(S),S.adapt(g,q.type));break;case DS.yS:S=S=>z.yS.Minimize(q.getConnectedValue(S),S.adapt(g,q.type));break;case DS.Jb:S=S=>{const b=q.getConnectedValue(S),{r:z,g:C,b:v,a:r}=S.adapt(g,q.type);return new U.b(Math.min(b.r,z),Math.min(b.g,C),Math.min(b.b,v),Math.min(b.a,r))}}}break;case sS.Max:if(!r){const[q,g]=v?[C,b]:[b,C];switch(q.type){case DS.Vector2:S=S=>z.Vector2.Maximize(q.getConnectedValue(S),S.adapt(g,q.type));break;case DS.yS:S=S=>z.yS.Maximize(q.getConnectedValue(S),S.adapt(g,q.type));break;case DS.Jb:S=S=>{const b=q.getConnectedValue(S),{r:z,g:C,b:v,a:r}=S.adapt(g,q.type);return new U.b(Math.max(b.r,z),Math.min(b.g,C),Math.min(b.b,v),Math.min(b.a,r))}}break}S=q=>Math.max(b.getConnectedValue(q),C.getConnectedValue(q))}this.output._storedFunction=q=>b.type===DS.Int?0|S(q):S(q)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===DS.Int||this.left.type===DS.Float&&this.right.type!==DS.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[q,S]of[[this.left,this.right],[this.right,this.left]])q.acceptedConnectionPointTypes=[DS.Int,DS.Float],S.isConnected&&(q.acceptedConnectionPointTypes.push(S.type),S.type!==DS.Int&&S.type!==DS.Float||q.acceptedConnectionPointTypes.push(DS.Vector2,DS.yS,DS.Jb))}dispose(){super.dispose();for(const q of this._connectionObservers)q.remove();this._connectionObservers.length=0}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,i.e)([OS("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:sS.Add},{label:"Subtract",value:sS.Subtract},{label:"Multiply",value:sS.Multiply},{label:"Divide",value:sS.Divide},{label:"Max",value:sS.Max},{label:"Min",value:sS.Min}]})],Sb.prototype,"operation",void 0),(0,g.f)("BABYLON.ParticleMathBlock",Sb);class bb extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("direction1",DS.yS,!0,new z.yS(0,1,0)),this.registerInput("direction2",DS.yS,!0,new z.yS(0,1,0)),this.registerInput("minEmitBox",DS.yS,!0,new z.yS(-.5,-.5,-.5)),this.registerInput("maxEmitBox",DS.yS,!0,new z.yS(.5,.5,.5)),this.registerOutput("output",DS.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const S=this.particle.getConnectedValue(q);S._directionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.direction1.getConnectedValue(q),v=this.direction2.getConnectedValue(q),U=(0,I.RandomRange)(C.x,v.x),g=(0,I.RandomRange)(C.y,v.y),r=(0,I.RandomRange)(C.z,v.z);q.isEmitterTransformNode?z.yS.TransformNormalFromFloatsToRef(U,g,r,q.emitterWorldMatrix,b.direction):b.direction.Bb(U,g,r)},S._positionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.minEmitBox.getConnectedValue(q),v=this.maxEmitBox.getConnectedValue(q),U=(0,I.RandomRange)(C.x,v.x),g=(0,I.RandomRange)(C.y,v.y),r=(0,I.RandomRange)(C.z,v.z);q.isEmitterTransformNode?z.yS.TransformCoordinatesFromFloatsToRef(U,g,r,q.emitterWorldMatrix,b.position):(b.position.Bb(U,g,r),b.position.addInPlace(q.emitterPosition))},this.output._storedValue=S}}(0,g.f)("BABYLON.BoxShapeBlock",bb);class zb extends hS{constructor(q){super(q),this.registerInput("emitPower",DS.Float,!0,1),this.registerInput("lifeTime",DS.Float,!0,1),this.registerInput("color",DS.Jb,!0,new U.b(1,1,1,1)),this.registerInput("scale",DS.Vector2,!0,new z.Vector2(1,1)),this.registerInput("angle",DS.Float,!0,0),this.registerOutput("particle",DS.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(q){const S=new gS(this.name,q.WS,q.GS,null,!1,void 0,!0);S.particleEmitterType=new Q,S._lifeTimeCreation.process=(S,b)=>{q.particleContext=S,S.lifeTime=this.lifeTime.getConnectedValue(q),b._emitPower=this.emitPower.getConnectedValue(q)},S._colorCreation.process=S=>{q.particleContext=S,S.color.v(this.color.getConnectedValue(q))},S._sizeCreation.process=S=>{q.particleContext=S,S.size=1,S.scale.v(this.scale.getConnectedValue(q))},S._angleCreation.process=S=>{q.particleContext=S,S.angle=this.angle.getConnectedValue(q)},this.particle._storedValue=S}}(0,g.f)("BABYLON.CreateParticleBlock",zb);class Cb{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const q=[];for(const S of this.attachedBlocks)S.isInput&&q.push(S);return q}constructor(q){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new M.d,this.name=q}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(q)&&this.attachedBlocks.push(q);for(const b of q.inputs){const z=b.connectedPoint;if(z){const b=z.ownerBlock;b!==q&&this._initializeBlock(b,S)}}}async buildAsync(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((b=>{const z=new TS;for(const q of this._systemBlocks)this._initializeBlock(q);for(const C of this.systemBlocks){const b=new jS;b.buildId=this._buildId++,b.GS=q,b.verbose=S;const v=C.createSystem(b);b.emitErrors(),z.systems.push(v)}this.onBuildObservable.notifyObservers(this),b(z)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const q=new pS("Particle system"),S=new qb("Update position");S.output.connectTo(q.particle);const b=new YS("Position");b.contextualValue=nS.Position;const z=new YS("Scaled direction");z.contextualValue=nS.ScaledDirection;const C=new Sb("Add");C.operation=sS.Add,b.output.connectTo(C.left),z.output.connectTo(C.right),C.output.connectTo(S.position);const v=new zb("Create particle"),U=new bb("Box shape");v.particle.connectTo(U.particle),U.output.connectTo(S.particle);const g=new cS("Texture");g.texture.connectTo(q.texture),g.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(q)}removeBlock(q){const S=this.attachedBlocks.indexOf(q);if(S>-1&&this.attachedBlocks.splice(S,1),q.isSystem){const S=this._systemBlocks.indexOf(q);S>-1&&this._systemBlocks.splice(S,1)}}parseSerializedObject(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];S||this.clear();const b={};for(const z of q.LV){const q=(0,g.c)(z.customType);if(q){const S=new q;S._deserialize(z),b[z.id]=S,this.attachedBlocks.push(S),S.isSystem&&this._systemBlocks.push(S)}}for(const z of this.attachedBlocks)if(z.isTeleportOut){const q=z,S=q._tempEntryPointUniqueId;if(S){const z=b[S];z&&z.attachToEndpoint(q)}}for(let z=0;z<q.LV.length;z++){const C=q.LV[z],v=b[C.id];v&&(v.inputs.length&&C.inputs.some((q=>q.targetConnectionName))&&!S||this._restoreConnections(v,q,b))}if(q.locations||q.editorData&&q.editorData.locations){const z=q.locations||q.editorData.locations;for(const q of z)b[q.Az]&&(q.Az=b[q.Az].uniqueId);S&&this.editorData&&this.editorData.locations&&z.concat(this.editorData.locations),q.locations?this.editorData={locations:z}:(this.editorData=q.editorData,this.editorData.locations=z);const C=[];for(const q in b)C[q]=b[q].uniqueId;this.editorData.map=C}this.comment=q.comment}_restoreConnections(q,S,b){for(const z of q.outputs)for(const C of S.LV){const v=b[C.id];if(v)for(const U of C.inputs)if(b[U.targetBlockId]!==q||U.targetConnectionName!==z.name);else{const q=v.getInputByName(U.inputName);if(!q||q.isConnected)continue;z.connectTo(q,!0),this._restoreConnections(v,S,b)}}}serialize(q){const S=q?{}:L.b.Serialize(this);S.editorData=JSON.parse(JSON.stringify(this.editorData));let b=[];q?b=q:S.customType="BABYLON.NodeParticleSystemSet",S.LV=[];for(const z of b)S.LV.push(z.serialize());if(!q)for(const z of this.attachedBlocks)-1===b.indexOf(z)&&S.LV.push(z.serialize());return S}dispose(){for(const q of this.attachedBlocks)q.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(q){const S=new Cb(q);return S.setToDefault(),S}static Parse(q){const S=L.b.Parse((()=>new Cb(q.name)),q,null);return S.parseSerializedObject(q),S}static ParseFromSnippetAsync(q,S){return"_BLANK"===q?Promise.resolve(Cb.CreateDefault("blank")):new Promise(((b,z)=>{const C=new BS.c;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const U=JSON.parse(JSON.parse(C.responseText).jsonPayload),g=JSON.parse(U.nodeParticle);S||(S=L.b.Parse((()=>new Cb(q)),g,null)),S.parseSerializedObject(g),S.snippetId=q;try{b(S)}catch(v){z(v)}}else z("Unable to load the snippet "+q)})),C.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),C.send()}))}}Cb.EditorURL=`${NS.Tools._DefaultCdnUrl}/v${Oq.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Cb.SnippetUrl="https://snippet.babylonjs.com",(0,i.e)([(0,J.J)()],Cb.prototype,"name",void 0),(0,i.e)([(0,J.J)("comment")],Cb.prototype,"comment",void 0),function(q){q[q.None=0]="None",q[q.PerParticle=1]="PerParticle",q[q.PerSystem=2]="PerSystem"}(AS||(AS={}));class vb extends hS{constructor(q){super(q),this._currentLockId=-2,this.lockMode=AS.PerParticle,this.registerInput("min",DS.AutoDetect,!0,0),this.registerInput("max",DS.AutoDetect,!0,1),this.registerOutput("output",DS.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DS.Float|DS.Int|DS.Vector2|DS.yS|DS.Jb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(DS.Float|DS.Int|DS.Vector2|DS.yS|DS.Jb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=DS.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case DS.AutoDetect:case DS.Int:case DS.Float:q=q=>{const S=this.min.getConnectedValue(q)||0,b=this.max.getConnectedValue(q)||1;return S+Math.random()*(b-S)};break;case DS.Vector2:q=q=>{const S=this.min.getConnectedValue(q)||z.Vector2.Zero(),b=this.max.getConnectedValue(q)||z.Vector2.One();return new z.Vector2(S.x+Math.random()*(b.x-S.x),S.y+Math.random()*(b.y-S.y))};break;case DS.yS:q=q=>{const S=this.min.getConnectedValue(q)||z.yS.Zero(),b=this.max.getConnectedValue(q)||z.yS.One();return new z.yS(S.x+Math.random()*(b.x-S.x),S.y+Math.random()*(b.y-S.y),S.z+Math.random()*(b.z-S.z))};break;case DS.Jb:q=q=>{const S=this.min.getConnectedValue(q)||new U.b(0,0,0,0),b=this.max.getConnectedValue(q)||new U.b(1,1,1,1);return new U.b(S.x+Math.random()*(b.x-S.x),S.y+Math.random()*(b.y-S.y),S.z+Math.random()*(b.z-S.z),S.w+Math.random()*(b.w-S.w))}}this.output._storedFunction=S=>{var b;let z=0;switch(this.lockMode){case AS.PerParticle:z=(null===(b=S.particleContext)||void 0===b?void 0:b.id)||-1;break;case AS.PerSystem:z=S.buildId||0}return this._currentLockId!==z&&(this.lockMode!==AS.None&&(this._currentLockId=z),this.output._storedValue=q(S)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),this.lockMode=q.lockMode}}(0,i.e)([OS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:AS.None},{label:"Per particle",value:AS.PerParticle},{label:"Per system",value:AS.PerSystem}]})],vb.prototype,"lockMode",void 0),(0,g.f)("BABYLON.ParticleRandomBlock",vb);class Ub extends hS{constructor(q){super(q),this._currentLockId=-2,this.lockMode=AS.PerParticle,this.registerInput("min",DS.AutoDetect),this.registerInput("max",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const S=[DS.Matrix,DS.Particle,DS.Texture,DS.System,DS.FloatGradient,DS.Color4Gradient,DS.Vector2Gradient,DS.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...S),this.max.excludedConnectionPointTypes.push(...S)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let q=null;switch(this._currentLockId=-2,this.min.type){case DS.Float:case DS.Int:q=q=>{const S=this.min.getConnectedValue(q),b=this.max.getConnectedValue(q);return Math.random()*(b-S)+S};break;case DS.Vector2:q=q=>{const S=this.min.getConnectedValue(q),b=this.max.getConnectedValue(q);return new z.Vector2(Math.random()*(b.x-S.x)+S.x,Math.random()*(b.y-S.y)+S.y)};break;case DS.yS:q=q=>{const S=this.min.getConnectedValue(q),b=this.max.getConnectedValue(q);return new z.yS(Math.random()*(b.x-S.x)+S.x,Math.random()*(b.y-S.y)+S.y,Math.random()*(b.z-S.z)+S.z)};break;case DS.Jb:q=q=>{const S=this.min.getConnectedValue(q),b=this.max.getConnectedValue(q);return new U.b(Math.random()*(b.r-S.r)+S.r,Math.random()*(b.g-S.g)+S.g,Math.random()*(b.b-S.b)+S.b,Math.random()*(b.a-S.a)+S.a)}}this.output._storedFunction=S=>{var b;let z=0;switch(this.lockMode){case AS.PerParticle:z=(null===(b=S.particleContext)||void 0===b?void 0:b.id)||-1;break;case AS.PerSystem:z=S.buildId||0}return this._currentLockId!==z&&(this.lockMode!==AS.None&&(this._currentLockId=z),this.output._storedValue=q(S)),this.output._storedValue}}serialize(){const q=super.serialize();return q.lockMode=this.lockMode,q}_deserialize(q){super._deserialize(q),void 0!==q.lockMode&&(this.lockMode=q.lockMode)}}(0,i.e)([OS("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:AS.None},{label:"Per particle",value:AS.PerParticle},{label:"Per system",value:AS.PerSystem}]})],Ub.prototype,"lockMode",void 0),(0,g.f)("BABYLON.RandomRangeBlock",Ub);(0,g.f)("BABYLON.ParticleLerpBlock",class extends hS{constructor(q){super(q),this.registerInput("left",DS.AutoDetect),this.registerInput("right",DS.AutoDetect),this.registerInput("gradient",DS.Float,!0,0,0,1),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DS.Float|DS.Int|DS.Vector2|DS.yS|DS.Jb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const q=(q,S,b)=>(1-q)*S+q*b;this.output._storedFunction=S=>{const b=this.left.getConnectedValue(S),C=this.right.getConnectedValue(S),v=this.gradient.getConnectedValue(S);switch(this.left.type){case DS.Int:case DS.Float:return q(v,b,C);case DS.Vector2:return new z.Vector2(q(v,b.x,C.x),q(v,b.y,C.y));case DS.yS:return new z.yS(q(v,b.x,C.x),q(v,b.y,C.y),q(v,b.z,C.z));case DS.Jb:return new U.b(q(v,b.r,C.r),q(v,b.g,C.g),q(v,b.b,C.b),q(v,b.a,C.a))}return 0}}});(0,g.f)("BABYLON.UpdateDirectionBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("direction",DS.yS),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.direction.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.direction.v(this.direction.getConnectedValue(q))},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}});(0,g.f)("BABYLON.UpdateColorBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("color",DS.Jb),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.color.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.color.v(this.color.getConnectedValue(q))},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}});(0,g.f)("BABYLON.UpdateScaleBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("scale",DS.Vector2),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.scale.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.scale.v(this.scale.getConnectedValue(q))},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}});(0,g.f)("BABYLON.UpdateAngleBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("angle",DS.Float),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.angle.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.angle=this.angle.getConnectedValue(q)},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}});(0,g.f)("BABYLON.BasicPositionUpdateBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(q){const S=this.particle.getConnectedValue(q),b={process:b=>{q.particleContext=b,q.systemContext=S,b.direction.scaleToRef(S._directionScale,S._scaledDirection),b.position.addInPlace(S._scaledDirection)},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b,this.output._storedValue=S}});(0,g.f)("BABYLON.BasicSpriteUpdateBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(q){const S=this.particle.getConnectedValue(q),b={process:b=>{q.particleContext=b,q.systemContext=S,b.updateCellIndex()},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b,this.output._storedValue=S}});(0,g.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("cellIndex",DS.Int),this.registerOutput("output",DS.Particle),this.cellIndex.acceptedConnectionPointTypes=[DS.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(q){const S=this.particle.getConnectedValue(q);if(this.output._storedValue=S,!this.cellIndex.isConnected)return;const b={process:b=>{q.particleContext=b,q.systemContext=S,b.cellIndex=Math.floor(this.cellIndex.getConnectedValue(q))},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b}});class gb extends hS{constructor(q){super(q),this.strength=1,this.registerInput("particle",DS.Particle),this.registerInput("flowMap",DS.Texture),this.registerOutput("output",DS.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(q){var S;const b=this.particle.getConnectedValue(q),z=q.GS;let C;(null===(S=this.flowMap.connectedPoint)||void 0===S?void 0:S.ownerBlock).extractTextureContentAsync().then((q=>{q&&(C=new KS(q.width,q.height,q.data))}));const v={process:q=>{const S=z.getTransformMatrix();C&&C._processParticle(q,this.strength*b._tempScaledUpdateSpeed,S)},previousItem:null,nextItem:null};b._updateQueueStart?oq(v,b._updateQueueStart):b._updateQueueStart=v,this.output._storedValue=b}serialize(){const q=super.serialize();return q.strength=this.strength,q}_deserialize(q){super._deserialize(q),this.strength=q.strength}}(0,i.e)([OS("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gb.prototype,"strength",void 0),(0,g.f)("BABYLON.UpdateFlowMapBlock",gb);(0,g.f)("BABYLON.SphereShapeBlock",class extends hS{constructor(q){super(q),this.registerInput("input",DS.Particle),this.registerInput("radius",DS.Float,!0,1),this.registerInput("radiusRange",DS.Float,!0,1,0,1),this.registerInput("directionRandomizer",DS.Float,!0,0,0,1),this.registerOutput("output",DS.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(q){const S=this.input.getConnectedValue(q);S._directionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.directionRandomizer.getConnectedValue(q),v=b.position.RS(q.emitterPosition).normalize(),U=(0,I.RandomRange)(0,C),g=(0,I.RandomRange)(0,C),r=(0,I.RandomRange)(0,C);v.x+=U,v.y+=g,v.z+=r,v.normalize(),q.isEmitterTransformNode?z.yS.TransformNormalFromFloatsToRef(U,g,r,q.emitterWorldMatrix,b.direction):b.direction.Bb(U,g,r)},S._positionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.radius.getConnectedValue(q),v=this.radiusRange.getConnectedValue(q),U=C-(0,I.RandomRange)(0,C*v),g=(0,I.RandomRange)(0,1),r=(0,I.RandomRange)(0,2*Math.PI),V=Math.acos(2*g-1),l=U*Math.cos(r)*Math.sin(V),y=U*Math.cos(V),R=U*Math.sin(r)*Math.sin(V);q.isEmitterTransformNode?z.yS.TransformCoordinatesFromFloatsToRef(l,y,R,q.emitterWorldMatrix,b.position):(b.position.Bb(l,y,R),b.position.addInPlace(q.emitterPosition))},this.output._storedValue=S}});(0,g.f)("BABYLON.PointShapeBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("direction1",DS.yS,!0,new z.yS(0,1,0)),this.registerInput("direction2",DS.yS,!0,new z.yS(0,1,0)),this.registerOutput("output",DS.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const S=this.particle.getConnectedValue(q);S._directionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.direction1.getConnectedValue(q),v=this.direction2.getConnectedValue(q),U=(0,I.RandomRange)(C.x,v.x),g=(0,I.RandomRange)(C.y,v.y),r=(0,I.RandomRange)(C.z,v.z);q.isEmitterTransformNode?z.yS.TransformNormalFromFloatsToRef(U,g,r,q.emitterWorldMatrix,b.direction):b.direction.Bb(U,g,r)},S._positionCreation.process=b=>{q.systemContext=S,q.isEmitterTransformNode?z.yS.TransformCoordinatesFromFloatsToRef(0,0,0,q.emitterWorldMatrix,b.position):b.position.v(q.emitterPosition)},this.output._storedValue=S}});(0,g.f)("BABYLON.CustomShapeBlock",class extends hS{constructor(q){super(q),this.registerInput("particle",DS.Particle),this.registerInput("position",DS.yS,!0,new z.yS(0,0,0)),this.registerInput("direction",DS.yS,!0,new z.yS(0,1,0)),this.registerOutput("output",DS.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){const S=this.particle.getConnectedValue(q);S._directionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.direction.getConnectedValue(q);q.isEmitterTransformNode?z.yS.TransformNormalToRef(C,q.emitterWorldMatrix,b.direction):b.direction.v(C)},S._positionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.position.getConnectedValue(q);q.isEmitterTransformNode?z.yS.TransformCoordinatesToRef(C,q.emitterWorldMatrix,b.position):(b.position.v(C),b.position.addInPlace(q.emitterPosition))},this.output._storedValue=S}});(0,g.f)("BABYLON.CylinderShapeBlock",class extends hS{constructor(q){super(q),this._tempVector=z.yS.Zero(),this.registerInput("particle",DS.Particle),this.registerInput("radius",DS.Float,!0,1),this.registerInput("height",DS.Float,!0,1,0),this.registerInput("radiusRange",DS.Float,!0,1,0,1),this.registerInput("directionRandomizer",DS.Float,!0,0,0,1),this.registerOutput("output",DS.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(q){const S=this.particle.getConnectedValue(q);S._directionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.directionRandomizer.getConnectedValue(q);b.position.subtractToRef(q.emitterPosition,this._tempVector),this._tempVector.normalize(),q.isEmitterTransformNode&&z.yS.TransformNormalToRef(this._tempVector,q.emitterInverseWorldMatrix,this._tempVector);const v=(0,I.RandomRange)(-C/2,C/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*C,this._tempVector.y=v,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),q.isEmitterTransformNode?z.yS.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,q.emitterWorldMatrix,b.direction):b.direction.v(this._tempVector)},S._positionCreation.process=b=>{q.particleContext=b,q.systemContext=S;const C=this.height.getConnectedValue(q),v=this.radiusRange.getConnectedValue(q),U=this.radius.getConnectedValue(q),g=(0,I.RandomRange)(-C/2,C/2),r=(0,I.RandomRange)(0,2*Math.PI),V=(0,I.RandomRange)((1-v)*(1-v),1),l=Math.sqrt(V)*U,y=l*Math.cos(r),R=l*Math.sin(r);q.isEmitterTransformNode?z.yS.TransformCoordinatesFromFloatsToRef(y,g,R,q.emitterWorldMatrix,b.position):(b.position.Bb(y,g,R),b.position.addInPlace(q.emitterPosition))},this.output._storedValue=S}});class rb extends hS{constructor(q){super(q),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",DS.Particle),this.registerOutput("output",DS.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const S=this.particle.getConnectedValue(q);S._isAnimationSheetEnabled=!0,S.spriteCellWidth=this.width,S.spriteCellHeight=this.height,S.startSpriteCellID=this.start,S.endSpriteCellID=this.end,S.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=S}serialize(){const q=super.serialize();return q.width=this.width,q.height=this.height,q.start=this.start,q.end=this.end,q.randomStartCell=this.randomStartCell,q}_deserialize(q){super._deserialize(q),this.width=q.width,this.height=q.height,this.start=q.start,this.end=q.end,this.randomStartCell=q.randomStartCell}}(0,i.e)([OS("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rb.prototype,"start",void 0),(0,i.e)([OS("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rb.prototype,"end",void 0),(0,i.e)([OS("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rb.prototype,"width",void 0),(0,i.e)([OS("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],rb.prototype,"height",void 0),(0,i.e)([OS("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rb.prototype,"loop",void 0),(0,i.e)([OS("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],rb.prototype,"randomStartCell",void 0),(0,g.f)("BABYLON.SetupSpriteSheetBlock",rb);class Ib extends hS{constructor(q){super(q),this.reference=0,this.registerInput("value",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case DS.Float:return DS.FloatGradient;case DS.Vector2:return DS.Vector2Gradient;case DS.yS:return DS.Vector3Gradient;case DS.Jb:return DS.Color4Gradient}return q},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DS.Float|DS.Vector2|DS.yS|DS.Jb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=q=>null}serialize(){const q=super.serialize();return q.reference=this.reference,q}_deserialize(q){super._deserialize(q),this.reference=q.reference}}(0,i.e)([OS("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Ib.prototype,"reference",void 0),(0,g.f)("BABYLON.ParticleGradientValueBlock",Ib);(0,g.f)("BABYLON.ParticleGradientBlock",class extends hS{constructor(q){super(q),this._entryCount=1,this.registerInput("gradient",DS.Float,!0,1,0,1),this.registerInput("value0",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=q=>{switch(q){case DS.FloatGradient:return DS.Float;case DS.Vector2Gradient:return DS.Vector2;case DS.Vector3Gradient:return DS.yS;case DS.Color4Gradient:return DS.Jb}return q},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(DS.FloatGradient|DS.Vector2Gradient|DS.Vector3Gradient|DS.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(q){this._inputs[q].onConnectionObservable.add((()=>{this._entryCount>q||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),DS.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const q=[];for(let b=1;b<this._inputs.length;b++){var S;if(this._inputs[b].isConnected)q.push(null===(S=this._inputs[b].connectedPoint)||void 0===S?void 0:S.ownerBlock)}q.sort(((q,S)=>q.reference-S.reference)),this.output._storedFunction=S=>{const b=this.gradient.getConnectedValue(S);if(1===q.length)return q[0].value.getConnectedValue(S);let C=null;for(let v=q.length-1;v>=0;v--){const g=q[v];if(g.reference<=b){const q=g.value.getConnectedValue(S);if(C){const v=C.value.getConnectedValue(S),r=C.reference,V=g.reference,l=Math.max(0,Math.min(1,(b-V)/(r-V)));switch(this.output.type){case DS.Float:return(0,I.Lerp)(q,v,l);case DS.Vector2:return z.Vector2.Lerp(q,v,l);case DS.yS:return z.yS.Lerp(q,v,l);case DS.Jb:return U.b.Lerp(q,v,l)}}return q}C=g}return 0}}});(0,g.f)("BABYLON.ParticleConverterBlock",class extends hS{constructor(q){super(q),this.registerInput("color ",DS.Jb,!0),this.registerInput("xyz ",DS.yS,!0),this.registerInput("xy ",DS.Vector2,!0),this.registerInput("zw ",DS.Vector2,!0),this.registerInput("x ",DS.Float,!0),this.registerInput("y ",DS.Float,!0),this.registerInput("z ",DS.Float,!0),this.registerInput("w ",DS.Float,!0),this.registerOutput("color",DS.Jb),this.registerOutput("xyz",DS.yS),this.registerOutput("xy",DS.Vector2),this.registerOutput("zw",DS.Vector2),this.registerOutput("x",DS.Float),this.registerOutput("y",DS.Float),this.registerOutput("z",DS.Float),this.registerOutput("w",DS.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(q){return"color "===q?"colorIn":"xyz "===q?"xyzIn":"xy "===q?"xyIn":"zw "===q?"zwIn":"x "===q?"xIn":"y "===q?"yIn":"z "===q?"zIn":"w "===q?"wIn":q}_outputRename(q){switch(q){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return q}}_build(q){super._build(q);const S=this.xIn,b=this.yIn,C=this.zIn,v=this.wIn,g=this.xyIn,r=this.zwIn,I=this.xyzIn,V=this.colorIn,l=this.colorOut,y=this.xyzOut,R=this.xyOut,G=this.zwOut,Z=this.xOut,H=this.yOut,Q=this.zOut,k=this.wOut,W=q=>{if(V.isConnected)return V.getConnectedValue(q);let z=0,l=0,y=0,R=0;if(S.isConnected&&(z=S.getConnectedValue(q)),b.isConnected&&(l=b.getConnectedValue(q)),C.isConnected&&(y=C.getConnectedValue(q)),v.isConnected&&(R=v.getConnectedValue(q)),g.isConnected){const S=g.getConnectedValue(q);S&&(z=S.x,l=S.y)}if(r.isConnected){const S=r.getConnectedValue(q);S&&(y=S.x,R=S.y)}if(I.isConnected){const S=I.getConnectedValue(q);S&&(z=S.x,l=S.y,y=S.z)}return new U.b(z,l,y,R)};l._storedFunction=q=>W(q),y._storedFunction=q=>{const S=W(q);return new z.yS(S.r,S.g,S.b)},R._storedFunction=q=>{const S=W(q);return new z.Vector2(S.r,S.g)},G._storedFunction=q=>{const S=W(q);return new z.Vector2(S.b,S.a)},Z._storedFunction=q=>W(q).r,H._storedFunction=q=>W(q).g,Q._storedFunction=q=>W(q).b,k._storedFunction=q=>W(q).a}}),function(q){q[q.Cos=0]="Cos",q[q.Sin=1]="Sin",q[q.Abs=2]="Abs",q[q.Exp=3]="Exp",q[q.Exp2=4]="Exp2",q[q.Round=5]="Round",q[q.Floor=6]="Floor",q[q.Ceiling=7]="Ceiling",q[q.Sqrt=8]="Sqrt",q[q.Log=9]="Log",q[q.Tan=10]="Tan",q[q.ArcTan=11]="ArcTan",q[q.ArcCos=12]="ArcCos",q[q.ArcSin=13]="ArcSin",q[q.Sign=14]="Sign",q[q.Negate=15]="Negate",q[q.OneMinus=16]="OneMinus",q[q.Reciprocal=17]="Reciprocal",q[q.ToDegrees=18]="ToDegrees",q[q.ToRadians=19]="ToRadians",q[q.Fract=20]="Fract"}(wS||(wS={}));class Vb extends hS{constructor(q){super(q),this.operation=wS.Cos,this.registerInput("input",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(DS.Float|DS.Int|DS.Vector2|DS.yS|DS.Jb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);let S=null;switch(this.operation){case wS.Cos:S=q=>Math.cos(q);break;case wS.Sin:S=q=>Math.sin(q);break;case wS.Abs:S=q=>Math.abs(q);break;case wS.Exp:S=q=>Math.exp(q);break;case wS.Exp2:S=q=>Math.pow(2,q);break;case wS.Round:S=q=>Math.round(q);break;case wS.Floor:S=q=>Math.floor(q);break;case wS.Ceiling:S=q=>Math.ceil(q);break;case wS.Sqrt:S=q=>Math.sqrt(q);break;case wS.Log:S=q=>Math.log(q);break;case wS.Tan:S=q=>Math.tan(q);break;case wS.ArcTan:S=q=>Math.atan(q);break;case wS.ArcCos:S=q=>Math.acos(q);break;case wS.ArcSin:S=q=>Math.asin(q);break;case wS.Sign:S=q=>Math.sign(q);break;case wS.Negate:S=q=>-q;break;case wS.OneMinus:S=q=>1-q;break;case wS.Reciprocal:S=q=>1/q;break;case wS.ToRadians:S=q=>q*Math.PI/180;break;case wS.ToDegrees:S=q=>180*q/Math.PI;break;case wS.Fract:S=q=>q>=0?q-Math.floor(q):q-Math.ceil(q)}if(!S)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case DS.Int:case DS.Float:this.output._storedFunction=q=>{const b=this.input.getConnectedValue(q);return S(b)};break;case DS.Vector2:this.output._storedFunction=q=>{const b=this.input.getConnectedValue(q);return new z.Vector2(S(b.x),S(b.y))};break;case DS.yS:this.output._storedFunction=q=>{const b=this.input.getConnectedValue(q);return new z.yS(S(b.x),S(b.y),S(b.z))};break;case DS.Jb:this.output._storedFunction=q=>{const b=this.input.getConnectedValue(q);return new U.b(S(b.r),S(b.g),S(b.b),S(b.a))}}return this}serialize(){const q=super.serialize();return q.operation=this.operation,q}_deserialize(q){super._deserialize(q),this.operation=q.operation}}(0,i.e)([OS("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:wS.Cos},{label:"Sin",value:wS.Sin},{label:"Abs",value:wS.Abs},{label:"Exp",value:wS.Exp},{label:"Exp2",value:wS.Exp2},{label:"Round",value:wS.Round},{label:"Floor",value:wS.Floor},{label:"Ceiling",value:wS.Ceiling},{label:"Sqrt",value:wS.Sqrt},{label:"Log",value:wS.Log},{label:"Tan",value:wS.Tan},{label:"ArcTan",value:wS.ArcTan},{label:"ArcCos",value:wS.ArcCos},{label:"ArcSin",value:wS.ArcSin},{label:"Sign",value:wS.Sign},{label:"Negate",value:wS.Negate},{label:"OneMinus",value:wS.OneMinus},{label:"Reciprocal",value:wS.Reciprocal},{label:"ToDegrees",value:wS.ToDegrees},{label:"ToRadians",value:wS.ToRadians},{label:"Fract",value:wS.Fract}]})],Vb.prototype,"operation",void 0),(0,g.f)("BABYLON.ParticleTrigonometryBlock",Vb);var lb,yb=b(12504);class Rb extends hS{constructor(q){super(q),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(DS.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(DS.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(DS.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(DS.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(DS.System),this._inputs[0].excludedConnectionPointTypes.push(DS.Particle),this._inputs[0].excludedConnectionPointTypes.push(DS.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const S=q=>{const S=this.input.getConnectedValue(q);if(this.log.length>=this.stackSize)return S;if(null===S||void 0===S)return this.log.push(["null",""]),S;switch(this.input.type){case DS.Vector2:this.log.push([(0,yb.h)(S,4),S.toString()]);break;case DS.yS:this.log.push([(0,yb.i)(S,4),S.toString()]);break;case DS.Jb:this.log.push([`{R: ${S.r.toFixed(4)} G: ${S.g.toFixed(4)} B: ${S.b.toFixed(4)} A: ${S.a.toFixed(4)}}`,S.toString()]);break;default:this.log.push([S.toString(),S.toString()])}return S};this.output.isConnected?this.output._storedFunction=S:this.output._storedValue=S(q)}serialize(){const q=super.serialize();return q.stackSize=this.stackSize,q}_deserialize(q){super._deserialize(q),this.stackSize=q.stackSize}}(0,i.e)([OS("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Rb.prototype,"stackSize",void 0),(0,g.f)("BABYLON.ParticleDebugBlock",Rb);(0,g.f)("BABYLON.ParticleElbowBlock",class extends hS{constructor(q){super(q),this.registerInput("input",DS.AutoDetect),this.registerOutput("output",DS.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(q){super._build(q);const S=this._outputs[0],b=this._inputs[0];S._storedFunction=q=>b.getConnectedValue(q)}});(0,g.f)("BABYLON.ParticleTeleportInBlock",class extends hS{get endpoints(){return this._endpoints}constructor(q){super(q),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",DS.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(q){if(this.getClassName()===q)return!0;for(const S of this.endpoints)if(S.isAnAncestorOfType(q))return!0;return!1}isAnAncestorOf(q){for(const S of this.endpoints){if(S===q)return!0;if(S.isAnAncestorOf(q))return!0}return!1}attachToEndpoint(q){q.detach(),this._endpoints.push(q),q._entryPoint=this,q._outputs[0]._typeConnectionSource=this._inputs[0],q._tempEntryPointUniqueId=null,q.name="> "+this.name}detachFromEndpoint(q){const S=this._endpoints.indexOf(q);-1!==S&&(this._endpoints.splice(S,1),q._outputs[0]._typeConnectionSource=null,q._entryPoint=null)}_build(){for(const q of this._endpoints)q.output._storedFunction=q=>this.input.getConnectedValue(q)}});(0,g.f)("BABYLON.ParticleTeleportOutBlock",class extends hS{constructor(q){super(q),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",DS.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(q){this.entryPoint&&this.entryPoint.build(q)}clone(){const q=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(q),q}serialize(){var q;const S=super.serialize();return S.entryPoint=(null===(q=this.entryPoint)||void 0===q?void 0:q.uniqueId)??"",S}_deserialize(q){super._deserialize(q),this._tempEntryPointUniqueId=q.entryPoint}}),function(q){q[q.Equal=0]="Equal",q[q.NotEqual=1]="NotEqual",q[q.LessThan=2]="LessThan",q[q.GreaterThan=3]="GreaterThan",q[q.LessOrEqual=4]="LessOrEqual",q[q.GreaterOrEqual=5]="GreaterOrEqual",q[q.Xor=6]="Xor",q[q.Or=7]="Or",q[q.And=8]="And"}(lb||(lb={}));class Gb extends hS{constructor(q){super(q),this.test=lb.Equal,this.epsilon=0,this.registerInput("left",DS.Float),this.registerInput("right",DS.Float,!0,0),this.registerInput("ifTrue",DS.AutoDetect,!0,1),this.registerInput("ifFalse",DS.AutoDetect,!0,0),this.registerOutput("output",DS.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=DS.Float,this._inputs[0].acceptedConnectionPointTypes.push(DS.Int),this._inputs[1].acceptedConnectionPointTypes.push(DS.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const q=q=>{const S=this.left.getConnectedValue(q),b=this.right.getConnectedValue(q);let z=!1;switch(this.test){case lb.Equal:z=(0,I.WithinEpsilon)(S,b,this.epsilon);break;case lb.NotEqual:z=!(0,I.WithinEpsilon)(S,b,this.epsilon);break;case lb.LessThan:z=S<b+this.epsilon;break;case lb.GreaterThan:z=S>b-this.epsilon;break;case lb.LessOrEqual:z=S<=b+this.epsilon;break;case lb.GreaterOrEqual:z=S>=b-this.epsilon;break;case lb.Xor:z=!!S&&!b||!S&&!!b;break;case lb.Or:z=!!S||!!b;break;case lb.And:z=!!S&&!!b}return z};this.output._storedFunction=S=>q(S)?this.ifTrue.getConnectedValue(S):this.ifFalse.getConnectedValue(S)}serialize(){const q=super.serialize();return q.test=this.test,q.epsilon=this.epsilon,q}_deserialize(q){super._deserialize(q),this.test=q.test,void 0!==q.epsilon&&(this.epsilon=q.epsilon)}}(0,i.e)([OS("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:lb.Equal},{label:"NotEqual",value:lb.NotEqual},{label:"LessThan",value:lb.LessThan},{label:"GreaterThan",value:lb.GreaterThan},{label:"LessOrEqual",value:lb.LessOrEqual},{label:"GreaterOrEqual",value:lb.GreaterOrEqual},{label:"Xor",value:lb.Xor},{label:"Or",value:lb.Or},{label:"And",value:lb.And}]})],Gb.prototype,"test",void 0),(0,i.e)([OS("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gb.prototype,"epsilon",void 0),(0,g.f)("BABYLON.ParticleConditionBlock",Gb);class Zb extends hS{constructor(q){super(q),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",DS.Particle),this.registerInput("condition",DS.Float,!0,0),this.registerInput("system",DS.System),this.registerOutput("output",DS.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(q){this._triggerCount=0;const S=this.input.getConnectedValue(q),b={process:b=>{if(q.particleContext=b,q.systemContext=S,0!==this.condition.getConnectedValue(q)&&(0===this.limit||this._triggerCount<this.limit)){const z=(new Date).getTime();if(this._previousOne&&z-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=z;const C=this.system.getConnectedValue(q);if(C){const z=MS(C,q.GS,b.position);z.gb.addOnce((()=>{this._triggerCount--})),S.gb.addOnce((()=>{z.dispose()}))}}},previousItem:null,nextItem:null};S._updateQueueStart?oq(b,S._updateQueueStart):S._updateQueueStart=b,this.output._storedValue=S}serialize(){const q=super.serialize();return q.limit=this.limit,q.delay=this.delay,q}_deserialize(q){super._deserialize(q),void 0!==q.limit&&(this.limit=q.limit),void 0!==q.delay&&(this.delay=q.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,i.e)([OS("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zb.prototype,"limit",void 0),(0,i.e)([OS("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Zb.prototype,"delay",void 0),(0,g.f)("BABYLON.ParticleTriggerBlock",Zb);b(12509),b(12518),b(12529),b(12584)},12562:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneFragment",v="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12534:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneFragmentDeclaration",v="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12601:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneVertex",v="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12591:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneVertexDeclaration",v="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12576:(q,S,b)=>{"use strict";var z=b(11017);const C="fogFragment",v="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12560:(q,S,b)=>{"use strict";var z=b(11017);const C="fogFragmentDeclaration",v="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12607:(q,S,b)=>{"use strict";var z=b(11017);const C="fogVertex",v="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12598:(q,S,b)=>{"use strict";var z=b(11017);const C="fogVertexDeclaration",v="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12548:(q,S,b)=>{"use strict";var z=b(11017);const C="helperFunctions",v="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12537:(q,S,b)=>{"use strict";var z=b(11017);const C="imageProcessingDeclaration",v="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12554:(q,S,b)=>{"use strict";var z=b(11017);const C="imageProcessingFunctions",v="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12540:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthDeclaration",v="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12571:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthFragment",v="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12610:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthVertex",v="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";z.d.IncludesShadersStoreWGSL[C]||(z.d.IncludesShadersStoreWGSL[C]=v)},12529:(q,S,b)=>{"use strict";b.r(S),b.d(S,{particlesPixelShaderWGSL:()=>U});var z=b(11017);b(12534),b(12537),b(12540),b(12548),b(12554),b(12560),b(12562),b(12571),b(12576);const C="particlesPixelShader",v="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.d.ShadersStoreWGSL[C]||(z.d.ShadersStoreWGSL[C]=v);const U={name:C,shader:v}},12584:(q,S,b)=>{"use strict";b.r(S),b.d(S,{particlesVertexShaderWGSL:()=>U});var z=b(11017);b(12591),b(12598),b(12540),b(12601),b(12607),b(12610);const C="particlesVertexShader",v="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.d.ShadersStoreWGSL[C]||(z.d.ShadersStoreWGSL[C]=v);const U={name:C,shader:v}},12435:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneFragment",v="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12515:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneFragmentDeclaration",v="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12468:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneVertex",v="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12520:(q,S,b)=>{"use strict";var z=b(11017);const C="clipPlaneVertexDeclaration",v="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12452:(q,S,b)=>{"use strict";var z=b(11017);const C="fogFragment",v="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12428:(q,S,b)=>{"use strict";var z=b(11017);const C="fogFragmentDeclaration",v="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12474:(q,S,b)=>{"use strict";var z=b(11017);const C="fogVertex",v="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12460:(q,S,b)=>{"use strict";var z=b(11017);const C="fogVertexDeclaration",v="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12417:(q,S,b)=>{"use strict";var z=b(11017);const C="helperFunctions",v="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12406:(q,S,b)=>{"use strict";var z=b(11017);const C="imageProcessingDeclaration",v="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12420:(q,S,b)=>{"use strict";var z=b(11017);const C="imageProcessingFunctions",v="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12410:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthDeclaration",v="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12444:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthFragment",v="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12477:(q,S,b)=>{"use strict";var z=b(11017);const C="logDepthVertex",v="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";z.d.IncludesShadersStore[C]||(z.d.IncludesShadersStore[C]=v)},12509:(q,S,b)=>{"use strict";b.r(S),b.d(S,{particlesPixelShader:()=>U});var z=b(11017);b(12515),b(12406),b(12410),b(12417),b(12420),b(12428),b(12435),b(12444),b(12452);const C="particlesPixelShader",v="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.d.ShadersStore[C]||(z.d.ShadersStore[C]=v);const U={name:C,shader:v}},12518:(q,S,b)=>{"use strict";b.r(S),b.d(S,{particlesVertexShader:()=>U});var z=b(11017);b(12520),b(12460),b(12410),b(12468),b(12474),b(12477);const C="particlesVertexShader",v="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.d.ShadersStore[C]||(z.d.ShadersStore[C]=v);const U={name:C,shader:v}},12875:(q,S,b)=>{"use strict";b.r(S),b.d(S,{FlowGraphGLTFDataProvider:()=>v});var z=b(12852),C=b(12839);class v extends z.c{constructor(q){var S,b;super();const z=q.glTF,v=(null===(S=z.animations)||void 0===S?void 0:S.map((q=>q._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",C.d,v);const U=(null===(b=z.nodes)||void 0===b?void 0:b.map((q=>q._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",C.d,U)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12779:(q,S,b)=>{"use strict";b.d(S,{b:()=>H,d:()=>G,g:()=>R,i:()=>Z});var z=b(11103),C=b(11575),v=b(11150),U=b(12784);const g=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class r{constructor(q,S){this._gltf=q,this._infoTree=S}convert(q){let S,b=this._gltf,z=this._infoTree;if(!q.startsWith("/"))throw new Error("Path must start with a /");const C=q.split("/");if(C.shift(),C[C.length-1].includes(".length")){const q=C[C.length-1].split(".");C.pop(),C.push(...q)}let v=!1;for(const r of C){const C="length"===r;if(C&&!z.__array__)throw new Error(`Path ${q} is invalid`);if(z.__ignoreObjectTree__&&(v=!0),z.__array__&&!C)z=z.__array__;else if(z=z[r],!z)throw new Error(`Path ${q} is invalid`);if(!v)if(void 0===b){if(!g.find((S=>S.regex.test(q))))throw new Error(`Path ${q} is invalid`)}else if(!C){var U;b=null===(U=b)||void 0===U?void 0:U[r]}(z.__target__||C)&&(S=b)}return{object:S,info:z}}}function I(q,S,b,z){const C=V(q,S);return z?C[b][z]:C[b]}function V(q,S,b){var z,v;return null===(z=q._data)||void 0===z||null===(v=z[(null===b||void 0===b?void 0:b.fillMode)??C.b.MATERIAL_TriangleFillMode])||void 0===v?void 0:v.babylonMaterial}function l(q,S){return{offset:{componentsCount:2,type:"Vector2",get:(b,C,v)=>{const U=I(b,v,q,S);return new z.Vector2(null===U||void 0===U?void 0:U.uOffset,null===U||void 0===U?void 0:U.vOffset)},getTarget:V,set:(b,z,C,v)=>{const U=I(z,v,q,S);U.uOffset=b.x,U.vOffset=b.y},getPropertyName:[()=>`${q}${S?"."+S:""}.uOffset`,()=>`${q}${S?"."+S:""}.vOffset`]},rotation:{type:"number",get:(b,z,C)=>{var v;return null===(v=I(b,C,q,S))||void 0===v?void 0:v.wAng},getTarget:V,set:(b,z,C,v)=>I(z,v,q,S).wAng=b,getPropertyName:[()=>`${q}${S?"."+S:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(b,C,v)=>{const U=I(b,v,q,S);return new z.Vector2(null===U||void 0===U?void 0:U.uScale,null===U||void 0===U?void 0:U.vScale)},getTarget:V,set:(b,z,C,v)=>{const U=I(z,v,q,S);U.uScale=b.x,U.vScale=b.y},getPropertyName:[()=>`${q}${S?"."+S:""}.uScale`,()=>`${q}${S?"."+S:""}.vScale`]}}}const y={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:q=>{var S,b;return new z.Vector2((null===(S=q._babylonCamera)||void 0===S?void 0:S.orthoLeft)??0,(null===(b=q._babylonCamera)||void 0===b?void 0:b.orthoRight)??0)},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.orthoLeft=q.x,S._babylonCamera.orthoRight=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:q=>{var S,b;return new z.Vector2((null===(S=q._babylonCamera)||void 0===S?void 0:S.orthoBottom)??0,(null===(b=q._babylonCamera)||void 0===b?void 0:b.orthoTop)??0)},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.orthoBottom=q.x,S._babylonCamera.orthoTop=q.y)},getTarget:q=>q,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.maxZ},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.kb},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.kb=q)},getTarget:q=>q,getPropertyName:[()=>"kb"]}},perspective:{aspectRatio:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.getEngine().getAspectRatio(q._babylonCamera)},getTarget:q=>q,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.fov},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.fov=q)},getTarget:q=>q,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.maxZ},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.maxZ=q)},getTarget:q=>q,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:q=>{var S;return null===(S=q._babylonCamera)||void 0===S?void 0:S.kb},set:(q,S)=>{S._babylonCamera&&(S._babylonCamera.kb=q)},getTarget:q=>q,getPropertyName:[()=>"kb"]}}}},nodes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"yS",get:q=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.position},set:(q,S)=>{var b;return null===(b=S._babylonTransformNode)||void 0===b?void 0:b.position.v(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:q=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.rotationQuaternion},set:(q,S)=>{var b,z;return null===(b=S._babylonTransformNode)||void 0===b||null===(z=b.rotationQuaternion)||void 0===z?void 0:z.v(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"yS",get:q=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.tb},set:(q,S)=>{var b;return null===(b=S._babylonTransformNode)||void 0===b?void 0:b.tb.v(q)},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"tb"]},weights:{length:{type:"number",get:q=>q._numMorphTargets,getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(q,S)=>{var b,z;return void 0!==S?null===(b=q._primitiveBabylonMeshes)||void 0===b||null===(z=b[0].morphTargetManager)||void 0===z?void 0:z.getTarget(S).influence:void 0},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(q,S)=>[0],getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:q=>{var S,b,C;return z.Matrix.Compose(null===(S=q._babylonTransformNode)||void 0===S?void 0:S.tb,null===(b=q._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion,null===(C=q._babylonTransformNode)||void 0===C?void 0:C.position)},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:q=>{var S,b,C,v;const U=z.Matrix.Identity();let g=q.parent;for(;g&&g.parent;)g=g.parent;const r=(null===(S=q._babylonTransformNode)||void 0===S?void 0:S.position._isDirty)||(null===(b=q._babylonTransformNode)||void 0===b||null===(C=b.rotationQuaternion)||void 0===C?void 0:C._isDirty)||(null===(v=q._babylonTransformNode)||void 0===v?void 0:v.tb._isDirty);if(g){var I;const S=null===(I=g._babylonTransformNode)||void 0===I?void 0:I.Nb(!0).invert();var V,l;if(S)null===(V=q._babylonTransformNode)||void 0===V||null===(l=V.Nb(r))||void 0===l||l.multiplyToRef(S,U)}else q._babylonTransformNode&&U.v(q._babylonTransformNode.Nb(r));return U},getTarget:q=>q._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:q=>{var S,b;return null===(S=q._babylonTransformNode)||void 0===S||null===(b=S.getChildren((q=>q instanceof U.b),!0)[0])||void 0===b?void 0:b.eb},getTarget:q=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.getChildren((q=>q instanceof U.b),!0)[0]},set:(q,S)=>{if(S._babylonTransformNode){const b=S._babylonTransformNode.getChildren((q=>q instanceof U.b),!0)[0];b&&(b.eb=q)}}},color:{type:"HS",get:q=>{var S,b;return null===(S=q._babylonTransformNode)||void 0===S||null===(b=S.getChildren((q=>q instanceof U.b),!0)[0])||void 0===b?void 0:b.ib},getTarget:q=>{var S;return null===(S=q._babylonTransformNode)||void 0===S?void 0:S.getChildren((q=>q instanceof U.b),!0)[0]},set:(q,S)=>{if(S._babylonTransformNode){const b=S._babylonTransformNode.getChildren((q=>q instanceof U.b),!0)[0];b&&(b.ib=q)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"HS",get:(q,S,b)=>V(q,S,b).emissiveColor,set:(q,S,b,z)=>V(S,b,z).emissiveColor.v(q),getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:l("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(q,S,b)=>{var z;return null===(z=I(q,b,"bumpTexture"))||void 0===z?void 0:z.level},set:(q,S,b,z)=>{const C=I(S,z,"bumpTexture");C&&(C.level=q)},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:l("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(q,S,b)=>V(q,S,b).ambientTextureStrength,set:(q,S,b,z)=>{const C=V(S,b,z);C&&(C.ambientTextureStrength=q)},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:l("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Jb",get:(q,S,b)=>{const z=V(q,S,b);return v.b.FromColor3(z.albedoColor,z.alpha)},set:(q,S,b,z)=>{const C=V(S,b,z);C.albedoColor.set(q.r,q.g,q.b),C.alpha=q.a},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:l("albedoTexture")}},metallicFactor:{type:"number",get:(q,S,b)=>V(q,S,b).metallic,set:(q,S,b,z)=>{const C=V(S,b,z);C&&(C.metallic=q)},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(q,S,b)=>V(q,S,b).roughness,set:(q,S,b,z)=>{const C=V(S,b,z);C&&(C.roughness=q)},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:l("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(q,S,b)=>V(q,S,b).anisotropy.eb,set:(q,S,b,z)=>{V(S,b,z).anisotropy.eb=q},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(q,S,b)=>V(q,S,b).anisotropy.angle,set:(q,S,b,z)=>{V(S,b,z).anisotropy.angle=q},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:l("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(q,S,b)=>V(q,S,b).clearCoat.eb,set:(q,S,b,z)=>{V(S,b,z).clearCoat.eb=q},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(q,S,b)=>V(q,S,b).clearCoat.roughness,set:(q,S,b,z)=>{V(S,b,z).clearCoat.roughness=q},getTarget:(q,S,b)=>V(q,S,b),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:l("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(q,S,b)=>{var z;return null===(z=V(q,S,b).clearCoat.bumpTexture)||void 0===z?void 0:z.level},getTarget:V,set:(q,S,b,z)=>V(S,b,z).clearCoat.bumpTexture.level=q},extensions:{KHR_texture_transform:l("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:l("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(q,S,b)=>V(q,S,b).subSurface.dispersion,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.dispersion=q}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(q,S,b)=>V(q,S,b).emissiveIntensity,getTarget:V,set:(q,S,b,z)=>V(S,b,z).emissiveIntensity=q}},KHR_materials_ior:{ior:{type:"number",get:(q,S,b)=>V(q,S,b).indexOfRefraction,getTarget:V,set:(q,S,b,z)=>V(S,b,z).indexOfRefraction=q}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(q,S,b)=>V(q,S,b).iridescence.eb,getTarget:V,set:(q,S,b,z)=>V(S,b,z).iridescence.eb=q},iridescenceIor:{type:"number",get:(q,S,b)=>V(q,S,b).iridescence.indexOfRefraction,getTarget:V,set:(q,S,b,z)=>V(S,b,z).iridescence.indexOfRefraction=q},iridescenceTexture:{extensions:{KHR_texture_transform:l("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(q,S,b)=>V(q,S,b).iridescence.maximumThickness,getTarget:V,set:(q,S,b,z)=>V(S,b,z).iridescence.maximumThickness=q},iridescenceThicknessMinimum:{type:"number",get:(q,S,b)=>V(q,S,b).iridescence.minimumThickness,getTarget:V,set:(q,S,b,z)=>V(S,b,z).iridescence.minimumThickness=q},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:l("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"HS",get:(q,S,b)=>V(q,S,b).sheen.color,getTarget:V,set:(q,S,b,z)=>V(S,b,z).sheen.color.v(q)},sheenColorTexture:{extensions:{KHR_texture_transform:l("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(q,S,b)=>V(q,S,b).sheen.eb,getTarget:V,set:(q,S,b,z)=>V(S,b,z).sheen.eb=q},sheenRoughnessTexture:{extensions:{KHR_texture_transform:l("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(q,S,b)=>V(q,S,b).metallicF0Factor,getTarget:V,set:(q,S,b,z)=>V(S,b,z).metallicF0Factor=q,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"HS",get:(q,S,b)=>V(q,S,b).metallicReflectanceColor,getTarget:V,set:(q,S,b,z)=>V(S,b,z).metallicReflectanceColor.v(q),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:l("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:l("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(q,S,b)=>V(q,S,b).subSurface.refractionIntensity,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.refractionIntensity=q,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(q,S,b)=>V(q,S,b).subSurface.translucencyIntensity,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.translucencyIntensity=q},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"HS",get:(q,S,b)=>V(q,S,b).subSurface.translucencyColor,getTarget:V,set:(q,S,b,z)=>{var C;return q&&(null===(C=V(S,b,z).subSurface.translucencyColor)||void 0===C?void 0:C.v(q))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:l("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"HS",get:(q,S,b)=>V(q,S,b).subSurface.tintColor,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.tintColor.v(q)},attenuationDistance:{type:"number",get:(q,S,b)=>V(q,S,b).subSurface.tintColorAtDistance,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.tintColorAtDistance=q},thicknessFactor:{type:"number",get:(q,S,b)=>V(q,S,b).subSurface.maximumThickness,getTarget:V,set:(q,S,b,z)=>V(S,b,z).subSurface.maximumThickness=q},thicknessTexture:{extensions:{KHR_texture_transform:l("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,color:{type:"HS",get:q=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.ib},set:(q,S)=>{var b;return null===(b=S._babylonLight)||void 0===b?void 0:b.ib.v(q)},getTarget:q=>q._babylonLight,getPropertyName:[q=>"diffuse"]},eb:{type:"number",get:q=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.eb},set:(q,S)=>S._babylonLight?S._babylonLight.eb=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"intensity"]},range:{type:"number",get:q=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.range},set:(q,S)=>S._babylonLight?S._babylonLight.range=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"range"]},spot:{innerConeAngle:{type:"number",get:q=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.innerAngle},set:(q,S)=>S._babylonLight?S._babylonLight.innerAngle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"innerConeAngle"]},outerConeAngle:{type:"number",get:q=>{var S;return null===(S=q._babylonLight)||void 0===S?void 0:S.angle},set:(q,S)=>S._babylonLight?S._babylonLight.angle=q:void 0,getTarget:q=>q._babylonLight,getPropertyName:[q=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonLight)),getPropertyName:[q=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonTexture)),getPropertyName:[q=>"length"]},__array__:{__target__:!0,eb:{type:"number",get:q=>{var S;return null===(S=q._babylonTexture)||void 0===S?void 0:S.level},set:(q,S)=>{S._babylonTexture&&(S._babylonTexture.level=q)},getTarget:q=>q._babylonTexture},rotation:{type:"Quaternion",get:q=>{var S;return q._babylonTexture&&z.Quaternion.FromRotationMatrix(null===(S=q._babylonTexture)||void 0===S?void 0:S.getReflectionTextureMatrix())},set:(q,S)=>{var b;S._babylonTexture&&(null!==(b=S._babylonTexture.Tq())&&void 0!==b&&b.useRightHandedSystem||(q=z.Quaternion.Inverse(q)),z.Matrix.FromQuaternionToRef(q,S._babylonTexture.getReflectionTextureMatrix()))},getTarget:q=>q._babylonTexture}}}}},animations:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>q._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:q=>q.length,getTarget:q=>q.map((q=>{var S;return null===(S=q.primitives[0]._instanceData)||void 0===S?void 0:S.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function R(q){return new r(q,y)}function G(q){const S=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let b=y;for(const z of S)z&&(b=b[z]);if(b&&b.type&&b.get)return b}function Z(q,S){const b=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let z=y;for(const C of b)C&&(z=z[C]);z&&z.type&&z.get&&(z.interpolation=S)}function H(q,S){const b=q.split("/").map((q=>q.replace(/{}/g,"__array__")));let z=y;for(const C of b)if(C){if(!z[C]){if("?"===C){z.__ignoreObjectTree__=!0;continue}z[C]={},"__array__"===C&&(z[C].__target__=!0)}z=z[C]}Object.assign(z,S)}},12787:(q,S,b)=>{"use strict";b.r(S),b.d(S,{AnimationPropertyInfo:()=>I,TransformNodeAnimationPropertyInfo:()=>V,WeightAnimationPropertyInfo:()=>l,getQuaternion:()=>g,getVector3:()=>U,getWeights:()=>r});var z=b(11634),C=b(11103),v=b(12779);function U(q,S,b,z){return C.yS.Hb(S,b).scaleInPlace(z)}function g(q,S,b,z){return C.Quaternion.Hb(S,b).scaleInPlace(z)}function r(q,S,b,z){const C=new Array(q._numMorphTargets);for(let v=0;v<C.length;v++)C[v]=S[b++]*z;return C}class I{constructor(q,S,b,z){this.type=q,this.name=S,this.getValue=b,this.getStride=z}_buildAnimation(q,S,b){const C=new z.d(q,this.name,S,this.type);return C.setKeys(b),C}}class V extends I{buildAnimations(q,S,b,z){const C=[];return C.push({babylonAnimatable:q._babylonTransformNode,babylonAnimation:this._buildAnimation(S,b,z)}),C}}class l extends I{buildAnimations(q,S,b,C){const v=[];if(q._numMorphTargets)for(let U=0;U<q._numMorphTargets;U++){const g=new z.d(`${S}_${U}`,this.name,b,this.type);if(g.setKeys(C.map((q=>({frame:q.frame,inTangent:q.inTangent?q.inTangent[U]:void 0,value:q.value[U],outTangent:q.outTangent?q.outTangent[U]:void 0,interpolation:q.interpolation})))),q._primitiveBabylonMeshes)for(const S of q._primitiveBabylonMeshes)if(S.morphTargetManager){const q=S.morphTargetManager.getTarget(U),b=g.clone();q.animations.push(b),v.push({babylonAnimatable:q,babylonAnimation:b})}}return v}}(0,v.i)("/nodes/{}/translation",[new V(z.d.ANIMATIONTYPE_VECTOR3,"position",U,(()=>3))]),(0,v.i)("/nodes/{}/rotation",[new V(z.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",g,(()=>4))]),(0,v.i)("/nodes/{}/scale",[new V(z.d.ANIMATIONTYPE_VECTOR3,"tb",U,(()=>3))]),(0,v.i)("/nodes/{}/weights",[new l(z.d.ANIMATIONTYPE_FLOAT,"influence",r,(q=>q._numMorphTargets))])},12732:(q,S,b)=>{"use strict";class z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((q,S)=>{this._resolve=q,this._reject=S}))}}var C=b(11103),v=b(11150),U=b(10921),g=b(11557),r=b(12741),I=b(12757),V=b(10929),l=b(11573),y=b(11634),R=b(11642),G=b(10975),Z=b(10943),H=b(10948);class Q{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(q){this._useTextureToStoreBoneMatrices=q,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(q,S,b){this.name=q,this.id=S,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=C.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new V.d,this.bones=[],this._scene=b||G.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const z=this._scene.getEngine().getCaps();this._canUseTextureForBones=z.textureFloat&&z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((q=>!q.getParent()))}getTransformMatrices(q){if(this.needInitialSkinMatrix){if(!q)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return q._bonesTransformMatrices||this.prepare(!0),q._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(q){return this.needInitialSkinMatrix&&q._transformMatrixTexture?q._transformMatrixTexture:this._transformMatrixTexture}Tq(){return this._scene}toString(q){let S=`Name: ${this.name}, nBones: ${this.bones.length}`;if(S+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,q){S+=", Ranges: {";let q=!0;for(const b in this._ranges)q&&(S+=", ",q=!1),S+=b;S+="}"}return S}getBoneIndexByName(q){for(let S=0,b=this.bones.length;S<b;S++)if(this.bones[S].name===q)return S;return-1}createAnimationRange(q,S,b){if(!this._ranges[q]){this._ranges[q]=new R.d(q,S,b);for(let z=0,C=this.bones.length;z<C;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].createRange(q,S,b)}}deleteAnimationRange(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let b=0,z=this.bones.length;b<z;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].deleteRange(q,S);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}getAnimationRanges(){const q=[];let S;for(S in this._ranges)q.push(this._ranges[S]);return q}copyAnimationRange(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[S]||!q.getAnimationRange(S))return!1;let z=!0;const C=this._getHighestAnimationFrame()+1,v={},U=q.bones;let g,r;for(r=0,g=U.length;r<g;r++)v[U[r].name]=U[r];this.bones.length!==U.length&&(Z.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${U.length}`),z=!1);const I=b&&this.dimensionsAtRest&&q.dimensionsAtRest?this.dimensionsAtRest.divide(q.dimensionsAtRest):null;for(r=0,g=this.bones.length;r<g;r++){const q=this.bones[r].name,U=v[q];U?z=z&&this.bones[r].copyAnimationRange(U,S,C,b,I):(Z.b.Warn("copyAnimationRange: not same rig, missing source bone "+q),z=!1)}const V=q.getAnimationRange(S);return V&&(this._ranges[S]=new R.d(S,V.from+C,V.to+C)),z}returnToRest(){for(const q of this.bones)-1!==q._index&&q.returnToRest()}_getHighestAnimationFrame(){let q=0;for(let S=0,b=this.bones.length;S<b;S++)if(this.bones[S].animations[0]){const b=this.bones[S].animations[0].getHighestFrame();q<b&&(q=b)}return q}beginAnimation(q,S,b,z){const C=this.getAnimationRange(q);return C?this._scene.beginAnimation(this,C.from,C.to,S,b,z):null}static MakeAnimationAdditive(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0;const z=q.getAnimationRange(b);if(!z)return null;const C=q._scene.getAllAnimatablesByTarget(q);let v=null;for(let g=0;g<C.length;g++){const q=C[g];if(q.fromFrame===(null===z||void 0===z?void 0:z.from)&&q.toFrame===(null===z||void 0===z?void 0:z.to)){v=q;break}}const U=q.getAnimatables();for(let g=0;g<U.length;g++){const q=U[g].animations;if(q)for(let z=0;z<q.length;z++)y.d.MakeAnimationAdditive(q[z],S,b)}return v&&(v.isAdditive=!0),q}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(q){this._meshesWithPoseMatrix.push(q)}_unregisterMeshWithPoseMatrix(q){const S=this._meshesWithPoseMatrix.indexOf(q);S>-1&&this._meshesWithPoseMatrix.splice(S,1)}_computeTransformMatrices(q,S){this.onBeforeComputeObservable.notifyObservers(this);for(let b=0;b<this.bones.length;b++){const z=this.bones[b];z._childUpdateId++;const C=z.getParent();if(C?z.getLocalMatrix().multiplyToRef(C.getFinalMatrix(),z.getFinalMatrix()):S?z.getLocalMatrix().multiplyToRef(S,z.getFinalMatrix()):z.getFinalMatrix().v(z.getLocalMatrix()),-1!==z._index){const S=null===z._index?b:z._index;z.getAbsoluteInverseBindMatrix().multiplyToArray(z.getFinalMatrix(),q,16*S)}}this._identity.copyToArray(q,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const q=this.Tq().getRenderId();if(this._currentRenderId===q)return;this._currentRenderId=q}if(this._numBonesWithLinkedTransformNode>0)for(const q of this.bones)if(q._linkedTransformNode){const S=q._linkedTransformNode;q.position=S.position,S.rotationQuaternion?q.rotationQuaternion=S.rotationQuaternion:q.rotation=S.rotation,q.tb=S.tb}if(this.needInitialSkinMatrix)for(const q of this._meshesWithPoseMatrix){const S=q.getPoseMatrix();let b=this._isDirty;if(q._bonesTransformMatrices&&q._bonesTransformMatrices.length===16*(this.bones.length+1)||(q._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),b=!0),b){if(this._synchronizedWithMesh!==q){this._synchronizedWithMesh=q;for(const q of this.bones)if(!q.getParent()){q.getBindMatrix().multiplyToRef(S,C.TmpVectors.Matrix[1]),q._updateAbsoluteBindMatrices(C.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const S=4*(this.bones.length+1);q._transformMatrixTexture&&q._transformMatrixTexture.getSize().width===S||(q._transformMatrixTexture&&q._transformMatrixTexture.dispose(),q._transformMatrixTexture=l.c.CreateRGBATexture(q._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(q._bonesTransformMatrices,S),this.isUsingTextureForMatrices&&q._transformMatrixTexture&&q._transformMatrixTexture.update(q._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=l.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let q=0;q<this.bones.length;q++)this._animatables.push(this.bones[q])}return this._animatables}clone(q,S){const b=new Q(q,S||q,this._scene);b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){const q=this.bones[z];let S=null;const C=q.getParent();if(C){const q=this.bones.indexOf(C);S=b.bones[q]}const v=new I.b(q.name,b,S,q.getBindMatrix().clone(),q.getRestMatrix().clone());v._index=q._index,q._linkedTransformNode&&v.linkTransformNode(q._linkedTransformNode),H.d.DeepCopy(q.animations,v.animations)}if(this._ranges){b._ranges={};for(const q in this._ranges){const S=this._ranges[q];S&&(b._ranges[q]=S.clone())}}return this._isDirty=!0,b.prepare(!0),b}enableBlending(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const S of this.bones)for(const b of S.animations)b.enableBlending=!0,b.blendingSpeed=q}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Tq().stopAnimation(this),this.Tq().removeSkeleton(this),this._parentContainer){const q=this._parentContainer.skeletons.indexOf(this);q>-1&&this._parentContainer.skeletons.splice(q,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const q={};q.name=this.name,q.id=this.id,this.dimensionsAtRest&&(q.dimensionsAtRest=this.dimensionsAtRest.Zb()),q.bones=[],q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){var S;const z=this.bones[b],C=z.getParent(),v={parentBoneIndex:C?this.bones.indexOf(C):-1,index:z.getIndex(),name:z.name,id:z.id,matrix:z.getBindMatrix().Zb(),rest:z.getRestMatrix().Zb(),linkedTransformNodeId:null===(S=z.getTransformNode())||void 0===S?void 0:S.id};q.bones.push(v),z.length&&(v.length=z.length),z.metadata&&(v.metadata=z.metadata),z.animations&&z.animations.length>0&&(v.animation=z.animations[0].serialize()),q.ranges=[];for(const S in this._ranges){const b=this._ranges[S];if(!b)continue;const z={};z.name=S,z.from=b.from,z.to=b.to,q.ranges.push(z)}}return q}static Parse(q,S){const b=new Q(q.name,q.id,S);let z;for(q.dimensionsAtRest&&(b.dimensionsAtRest=C.yS.Hb(q.dimensionsAtRest)),b.needInitialSkinMatrix=q.needInitialSkinMatrix,z=0;z<q.bones.length;z++){const S=q.bones[z],v=q.bones[z].index;let U=null;S.parentBoneIndex>-1&&(U=b.bones[S.parentBoneIndex]);const g=S.rest?C.Matrix.Hb(S.rest):null,r=new I.b(S.name,b,U,C.Matrix.Hb(S.matrix),g,null,v);void 0!==S.id&&null!==S.id&&(r.id=S.id),S.length&&(r.length=S.length),S.metadata&&(r.metadata=S.metadata),S.animation&&r.animations.push(y.d.Parse(S.animation)),void 0!==S.linkedTransformNodeId&&null!==S.linkedTransformNodeId&&(b._hasWaitingData=!0,r._waitingTransformNodeId=S.linkedTransformNodeId)}if(q.ranges)for(z=0;z<q.ranges.length;z++){const S=q.ranges[z];b.createAnimationRange(S.name,S.from,S.to)}return b}computeAbsoluteMatrices(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||q)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(q)}getPoseMatrix(){let q=null;return this._meshesWithPoseMatrix.length>0&&(q=this._meshesWithPoseMatrix[0].getPoseMatrix()),q}sortBones(){const q=[],S=new Array(this.bones.length);for(let b=0;b<this.bones.length;b++)this._sortBones(b,q,S);this.bones=q}_sortBones(q,S,b){if(b[q])return;b[q]=!0;const z=this.bones[q];if(!z)return;void 0===z._index&&(z._index=q);const C=z.getParent();C&&this._sortBones(this.bones.indexOf(C),S,b),S.push(z)}setCurrentPoseAsRest(){for(const q of this.bones)q.setCurrentPoseAsRest()}}var k=b(11423),W=b(11591),N=b(11075),u=b(11520),X=b(11172),T=b(11560),B=b(11532),t=b(11555),f=b(11650),m=b(11200),E=b(12701);class e{set areUpdatesFrozen(q){q?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new m.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,q||(q=G.b.LastCreatedScene),this._scene=q,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const q=this._scene.getEngine().getCaps();this._canUseTextureForTargets=q.canUseGLVertexID&&q.textureFloat&&q.maxVertexTextureImageUnits>0&&q.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return e.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?e.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(q){this._numMaxInfluencers!==q&&(this._numMaxInfluencers=q,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(q){this._useTextureToStoreTargets!==q&&(this._useTextureToStoreTargets=q,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var q;return e.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(q=this._scene)&&void 0!==q&&q.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(q){return this._activeTargets.data[q]}getTarget(q){return this._targets[q]}getTargetByName(q){for(const S of this._targets)if(S.name===q)return S;return null}addTarget(q){this._targets.push(q),this._targetInfluenceChangedObservers.push(q.onInfluenceChanged.add((q=>{this.areUpdatesFrozen&&q&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(q)}))),this._targetDataLayoutChangedObservers.push(q._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(q){const S=this._targets.indexOf(q);S>=0&&(this._targets.splice(S,1),q.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(S,1)[0]),q._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(S,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(q)}_bind(q){q.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),q.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),q.setTexture("morphTargets",this._targetStoreTexture),q.setInt("morphTargetCount",this.numInfluencers)}clone(){const q=new e(this._scene);for(const S of this._targets)q.addTarget(S.clone());return q.enablePositionMorphing=this.enablePositionMorphing,q.enableNormalMorphing=this.enableNormalMorphing,q.enableTangentMorphing=this.enableTangentMorphing,q.enableUVMorphing=this.enableUVMorphing,q.enableUV2Morphing=this.enableUV2Morphing,q.enableColorMorphing=this.enableColorMorphing,q}serialize(){const q={};q.id=this.uniqueId,q.targets=[];for(const S of this._targets)q.targets.push(S.serialize());return q}_syncActiveTargets(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const S=!!this._targetStoreTexture,b=this.isUsingTextureForTargets;(this._mustSynchronize||S!==b)&&(this._mustSynchronize=!1,this.synchronize());let z=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let C=-1;for(const v of this._targets)if(C++,0!==v.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=e.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(v),this._morphTargetTextureIndices[z]=C,this._tempInfluences[z++]=v.influence}this._morphTargetTextureIndices.length!==z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,z)),this._influences&&this._influences.length===z||(this._influences=new Float32Array(z));for(let v=0;v<z;v++)this._influences[v]=this._tempInfluences[v];if(q&&this._scene)for(const v of this._scene.meshes)v.morphTargetManager===this&&(b?v._markSubMeshesAsAttributesDirty():v._syncGeometryWithMorphTargetManager())}synchronize(){var q;if(!this._scene||this.areUpdatesFrozen)return;const S=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(q=this._targetStoreTexture)||void 0===q||q.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>S.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const b of this._targets){this._supportsPositions=this._supportsPositions&&b.hasPositions,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs,this._supportsUV2s=this._supportsUV2s&&b.hasUV2s,this._supportsColors=this._supportsColors&&b.hasColors;const q=b.vertexCount;if(0===this._vertexCount)this._vertexCount=q;else if(this._vertexCount!==q)return void Z.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${b.name}": ${q}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const q=S.getCaps().maxTextureSize;this._textureWidth>q&&(this._textureHeight=Math.ceil(this._textureWidth/q),this._textureWidth=q);const b=this._targets.length,z=new Float32Array(b*this._textureWidth*this._textureHeight*4);let C=0;for(let S=0;S<b;S++){const q=this._targets[S],b=q.getPositions(),v=q.getNormals(),U=q.getUVs(),g=q.getTangents(),r=q.getUV2s(),I=q.getColors();C=S*this._textureWidth*this._textureHeight*4;for(let S=0;S<this._vertexCount;S++)this._supportsPositions&&b&&(z[C]=b[3*S],z[C+1]=b[3*S+1],z[C+2]=b[3*S+2],C+=4),this._supportsNormals&&v&&(z[C]=v[3*S],z[C+1]=v[3*S+1],z[C+2]=v[3*S+2],C+=4),this._supportsUVs&&U&&(z[C]=U[2*S],z[C+1]=U[2*S+1],C+=4),this._supportsTangents&&g&&(z[C]=g[3*S],z[C+1]=g[3*S+1],z[C+2]=g[3*S+2],C+=4),this._supportsUV2s&&r&&(z[C]=r[2*S],z[C+1]=r[2*S+1],C+=4),this._supportsColors&&I&&(z[C]=I[4*S],z[C+1]=I[4*S+1],z[C+2]=I[4*S+2],z[C+3]=I[4*S+3],C+=4)}this._targetStoreTexture=E.b.CreateRGBATexture(z,this._textureWidth,this._textureHeight,b,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const b of this._scene.meshes)b.morphTargetManager===this&&b._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const q=this._parentContainer.morphTargetManagers.indexOf(this);q>-1&&this._parentContainer.morphTargetManagers.splice(q,1),this._parentContainer=null}for(const q of this._targets)this._scene.stopAnimation(q)}}static Parse(q,S){const b=new e(S);for(const z of q.targets)b.addTarget(f.c.Parse(z,S));return b}}e.EnableTextureStorage=!0,e.MaxActiveMorphTargetsInVertexAttributeMode=8,e.ConstantTargetCountForTextureMode=0;var i=b(12763),J=b(10977),L=b(11446);const d=new Map,K=d;function D(q,S,b){x(q)&&Z.b.Warn(`Extension with the name '${q}' already exists`),d.set(q,{isGLTFExtension:S,factory:b})}function x(q){return d.delete(q)}var F=b(12779),a=b(11705),n=b(11187);class o{static Get(q,S,b){if(!S||void 0==b||!S[b])throw new Error(`${q}: Failed to find index (${b})`);return S[b]}static TryGet(q,S){return q&&void 0!=S&&q[S]?q[S]:null}static Assign(q){if(q)for(let S=0;S<q.length;S++)q[S].index=S}}function s(q){if(q.min&&q.max){const S=q.min,b=q.max,z=C.TmpVectors.yS[0].Bb(S[0],S[1],S[2]),v=C.TmpVectors.yS[1].Bb(b[0],b[1],b[2]);if(q.normalized&&5126!==q.componentType){let S=1;switch(q.componentType){case 5120:S=127;break;case 5121:S=255;break;case 5122:S=32767;break;case 5123:S=65535}const b=1/S;z.scaleInPlace(b),v.scaleInPlace(b)}return new L.c(z,v)}return null}class A{static RegisterExtension(q,S){D(q,!1,S)}static UnregisterExtension(q){return x(q)}get lb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(q){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=q}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((q=>q.dispose&&q.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(q,S,b,z,C,v){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=S,this._assetContainer=b,this._loadData(z);let v=null;if(q){const S={};if(this._gltf.nodes)for(const q of this._gltf.nodes)q.name&&(S[q.name]=q.index);v=(q instanceof Array?q:[q]).map((q=>{const b=S[q];if(void 0===b)throw new Error(`Failed to find node '${q}'`);return b}))}return await this._loadAsync(C,U,v,(()=>({meshes:this._getMeshes(),Gy:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=q,this._loadData(S),await this._loadAsync(b,C,null,(()=>{}))}async _loadAsync(q,S,b,z){return await Promise.resolve().then((async()=>{this._rootUrl=q,this._uniqueRootUrl=!q.startsWith("file:")&&S?q:`${q}${Date.now()}/`,this._fileName=S,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const C=`${i.g[i.g.LOADING]} => ${i.g[i.g.READY]}`,v=`${i.g[i.g.LOADING]} => ${i.g[i.g.COMPLETE]}`;this._parent._startPerformanceCounter(C),this._parent._startPerformanceCounter(v),this._parent._setState(i.g.LOADING),this._extensionsOnLoading();const g=new Array;if(!this.parent.loadOnlyMaterials)if(b)g.push(this.loadSceneAsync("/nodes",{nodes:b,index:-1}));else if(void 0!=this._gltf.GS||this._gltf.scenes&&this._gltf.scenes[0]){const q=o.Get("/scene",this._gltf.scenes,this._gltf.GS||0);g.push(this.loadSceneAsync(`/scenes/${q.index}`,q))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let q=0;q<this._gltf.materials.length;++q){const S=this._gltf.materials[q],b="/materials/"+q,z=k.c.TriangleFillMode;g.push(this._loadMaterialAsync(b,S,null,z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&g.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&g.push(this._compileShadowGeneratorsAsync());const r=Promise.all(g).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.br(!0);for(const q of this._babylonScene.materials){const S=q;void 0!==S.maxSimultaneousLights&&(S.maxSimultaneousLights=Math.max(S.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(i.g.READY),this._skipStartAnimationStep||this._startAnimations(),z()}));return await r.then((q=>(this._parent._endPerformanceCounter(C),U.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(v),this._parent._setState(i.g.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(q=>{this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()}))})),q)))})).catch((q=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(q),this._parent.onErrorObservable.clear(),this.dispose()),q}))}_loadData(q){if(this._gltf=q.json,this._setupData(),q.bin){const S=this._gltf.buffers;if(S&&S[0]&&!S[0].uri){const b=S[0];(b.byteLength<q.bin.byteLength-3||b.byteLength>q.bin.byteLength)&&Z.b.Warn(`Binary buffer length (${b.byteLength}) from JSON does not match chunk length (${q.bin.byteLength})`),this._bin=q.bin}else Z.b.Warn("Unexpected BIN chunk")}}_setupData(){if(o.Assign(this._gltf.accessors),o.Assign(this._gltf.animations),o.Assign(this._gltf.buffers),o.Assign(this._gltf.bufferViews),o.Assign(this._gltf.cameras),o.Assign(this._gltf.images),o.Assign(this._gltf.materials),o.Assign(this._gltf.meshes),o.Assign(this._gltf.nodes),o.Assign(this._gltf.samplers),o.Assign(this._gltf.scenes),o.Assign(this._gltf.skins),o.Assign(this._gltf.textures),this._gltf.nodes){const q={};for(const b of this._gltf.nodes)if(b.children)for(const S of b.children)q[S]=b.index;const S=this._createRootNode();for(const b of this._gltf.nodes){const z=q[b.index];b.parent=void 0===z?S:this._gltf.nodes[z]}}}async _loadExtensionsAsync(){const q=[];if(K.forEach(((S,b)=>{var z;!1===(null===(z=this.parent.extensionOptions[b])||void 0===z?void 0:z.enabled)?S.isGLTFExtension&&this.isExtensionUsed(b)&&Z.b.Warn(`Extension ${b} is used but has been explicitly disabled.`):S.isGLTFExtension&&!this.isExtensionUsed(b)||q.push((async()=>{const q=await S.factory(this);return q.name!==b&&Z.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${q.name} !== ${b}`),this._parent.onExtensionLoadedObservable.notifyObservers(q),q})())})),this._extensions.push(...await Promise.all(q)),this._extensions.sort(((q,S)=>(q.order||Number.MAX_VALUE)-(S.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const b of this._gltf.extensionsRequired){if(!this._extensions.some((q=>q.name===b&&q.enabled))){var S;if(!1===(null===(S=this.parent.extensionOptions[b])||void 0===S?void 0:S.enabled))throw new Error(`Required extension ${b} is disabled`);throw new Error(`Required extension ${b} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new t.d("__root__",this._babylonScene);this._rootBabylonMesh=q,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.br(!1);const S={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case i.d.AUTO:this._babylonScene.useRightHandedSystem||(S.rotation=[0,1,0,0],S.scale=[1,1,-1],A._LoadTransform(S,this._rootBabylonMesh));break;case i.d.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(q),S}loadSceneAsync(q,S){const b=this._extensionsLoadSceneAsync(q,S);if(b)return b;const z=new Array;if(this.logOpen(`${q} ${S.name||""}`),S.nodes)for(const C of S.nodes){const S=o.Get(`${q}/nodes/${C}`,this._gltf.nodes,C);z.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(q=>{q.parent=this._rootBabylonMesh})))}for(const C of this._postSceneLoadActions)C();return z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(z).then((()=>{}))}_forEachPrimitive(q,S){if(q._primitiveBabylonMeshes)for(const b of q._primitiveBabylonMeshes)S(b)}_getGeometries(){const q=[],S=this._gltf.nodes;if(S)for(const b of S)this._forEachPrimitive(b,(S=>{const b=S.ub;b&&-1===q.indexOf(b)&&q.push(b)}));return q}_getMeshes(){const q=[];this._rootBabylonMesh instanceof B.c&&q.push(this._rootBabylonMesh);const S=this._gltf.nodes;if(S)for(const b of S)this._forEachPrimitive(b,(S=>{q.push(S)}));return q}_getTransformNodes(){const q=[],S=this._gltf.nodes;if(S)for(const b of S)b._babylonTransformNode&&"xb"===b._babylonTransformNode.getClassName()&&q.push(b._babylonTransformNode),b._babylonTransformNodeForSkin&&q.push(b._babylonTransformNodeForSkin);return q}_getSkeletons(){const q=[],S=this._gltf.skins;if(S)for(const b of S)b._data&&q.push(b._data.babylonSkeleton);return q}_getAnimationGroups(){const q=[],S=this._gltf.animations;if(S)for(const b of S)b._babylonAnimationGroup&&q.push(b._babylonAnimationGroup);return q}_startAnimations(){switch(this._parent.animationStartMode){case i.c.NONE:break;case i.c.FIRST:{const q=this._getAnimationGroups();0!==q.length&&q[0].start(!0);break}case i.c.ALL:{const q=this._getAnimationGroups();for(const S of q)S.start(!0);break}default:return void Z.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadNodeAsync(q,S,b);if(z)return z;if(S._babylonTransformNode)throw new Error(`${q}: Invalid recursive node hierarchy`);const C=new Array;this.logOpen(`${q} ${S.name||""}`);const v=z=>{if(A.AddPointerMetadata(z,q),A._LoadTransform(S,z),void 0!=S.camera){const b=o.Get(`${q}/camera`,this._gltf.cameras,S.camera);C.push(this.loadCameraAsync(`/cameras/${b.index}`,b,(q=>{q.parent=z,this._babylonScene.useRightHandedSystem||(z.tb.x=-1)})))}if(S.children)for(const b of S.children){const S=o.Get(`${q}/children/${b}`,this._gltf.nodes,b);C.push(this.loadNodeAsync(`/nodes/${S.index}`,S,(q=>{q.parent=z})))}b(z)},U=void 0!=S.mesh,g=this._parent.loadSkins&&void 0!=S.skin;if(!U||g){const q=S.name||`node${S.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new u.e(q,this._babylonScene);b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==S.mesh?S._babylonTransformNode=b:S._babylonTransformNodeForSkin=b,v(b)}if(U)if(g){const b=o.Get(`${q}/mesh`,this._gltf.meshes,S.mesh);C.push(this._loadMeshAsync(`/meshes/${b.index}`,S,b,(b=>{const z=S._babylonTransformNodeForSkin;b.metadata=(0,a.d)(z.metadata,b.metadata||{});const v=o.Get(`${q}/skin`,this._gltf.skins,S.skin);C.push(this._loadSkinAsync(`/skins/${v.index}`,S,v,(q=>{this._forEachPrimitive(S,(S=>{S.skeleton=q})),this._postSceneLoadActions.push((()=>{if(void 0!=v.skeleton){const q=o.Get(`/skins/${v.index}/skeleton`,this._gltf.nodes,v.skeleton).parent;S.index===q.index?b.parent=z.parent:b.parent=q._babylonTransformNode}else b.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:z,skinnedNode:b})}))})))})))}else{const b=o.Get(`${q}/mesh`,this._gltf.meshes,S.mesh);C.push(this._loadMeshAsync(`/meshes/${b.index}`,S,b,v))}return this.logClose(),Promise.all(C).then((()=>(this._forEachPrimitive(S,(q=>{const S=q;!S.isAnInstance&&S.ub&&S.ub.useBoundingInfoFromGeometry?q.Lq():q.refreshBoundingInfo(!0,!0)})),S._babylonTransformNode)))}_loadMeshAsync(q,S,b,z){const C=b.primitives;if(!C||!C.length)throw new Error(`${q}: Primitives are missing`);void 0==C[0].index&&o.Assign(C);const v=new Array;this.logOpen(`${q} ${b.name||""}`);const U=S.name||`node${S.index}`;if(1===C.length){const z=b.primitives[0];v.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${z.index}`,U,S,b,z,(q=>{S._babylonTransformNode=q,S._primitiveBabylonMeshes=[q]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,S._babylonTransformNode=new u.e(U,this._babylonScene),S._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._primitiveBabylonMeshes=[];for(const z of C)v.push(this._loadMeshPrimitiveAsync(`${q}/primitives/${z.index}`,`${U}_primitive${z.index}`,S,b,z,(q=>{q.parent=S._babylonTransformNode,S._primitiveBabylonMeshes.push(q)})))}return z(S._babylonTransformNode),this.logClose(),Promise.all(v).then((()=>S._babylonTransformNode))}_loadMeshPrimitiveAsync(q,S,b,z,C,v){const U=this._extensionsLoadMeshPrimitiveAsync(q,S,b,z,C,v);if(U)return U;this.logOpen(`${q}`);const g=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==b.skin&&!z.primitives[0].targets;let r,I;if(g&&C._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,r=C._instanceData.babylonSourceMesh.createInstance(S),r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I=C._instanceData.promise;else{const v=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new t.d(S,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.sideOrientation=this._babylonScene.useRightHandedSystem?k.c.CounterClockWiseSideOrientation:k.c.ClockWiseSideOrientation,this._createMorphTargets(q,b,z,C,U),v.push(this._loadVertexDataAsync(q,C,U).then((async S=>await this._loadMorphTargetsAsync(q,C,U,S).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,S.iq(U),S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const V=A._GetDrawMode(q,C.mode);if(void 0==C.material){let q=this._defaultBabylonMaterialData[V];q||(q=this._createDefaultMaterial("__GLTFLoader._default",V),this._parent.onMaterialLoadedObservable.notifyObservers(q),this._defaultBabylonMaterialData[V]=q),U.material=q}else if(!this.parent.skipMaterials){const S=o.Get(`${q}/material`,this._gltf.materials,C.material);v.push(this._loadMaterialAsync(`/materials/${S.index}`,S,U,V,(q=>{U.material=q})))}I=Promise.all(v),g&&(C._instanceData={babylonSourceMesh:U,promise:I}),r=U}return A.AddPointerMetadata(r,q),this._parent.onMeshLoadedObservable.notifyObservers(r),v(r),this.logClose(),I.then((()=>r))}_loadVertexDataAsync(q,S,b){const z=this._extensionsLoadVertexDataAsync(q,S,b);if(z)return z;const C=S.attributes;if(!C)throw new Error(`${q}: Attributes are missing`);const v=new Array,U=new T.c(b.name,this._babylonScene);if(void 0==S.indices)b.isUnIndexed=!0;else{const b=o.Get(`${q}/indices`,this._gltf.accessors,S.indices);v.push(this._loadIndicesAccessorAsync(`/accessors/${b.index}`,b).then((q=>{U.setIndices(q)})))}const g=(S,z,g)=>{if(void 0==C[S])return;b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(z)&&b._delayInfo.push(z);const r=o.Get(`${q}/attributes/${S}`,this._gltf.accessors,C[S]);v.push(this._loadVertexAccessorAsync(`/accessors/${r.index}`,r,z).then((q=>{if(q.getKind()===X.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!b.skeleton){const q=s(r);q&&(U._boundingInfo=q,U.useBoundingInfoFromGeometry=!0)}U.setVerticesBuffer(q,r.count)}))),z==X.f.MatricesIndicesExtraKind&&(b.numBoneInfluencers=8),g&&g(r)};return g("POSITION",X.f.PositionKind),g("NORMAL",X.f.NormalKind),g("TANGENT",X.f.TangentKind),g("TEXCOORD_0",X.f.UVKind),g("TEXCOORD_1",X.f.UV2Kind),g("TEXCOORD_2",X.f.UV3Kind),g("TEXCOORD_3",X.f.UV4Kind),g("TEXCOORD_4",X.f.UV5Kind),g("TEXCOORD_5",X.f.UV6Kind),g("JOINTS_0",X.f.MatricesIndicesKind),g("WEIGHTS_0",X.f.MatricesWeightsKind),g("JOINTS_1",X.f.MatricesIndicesExtraKind),g("WEIGHTS_1",X.f.MatricesWeightsExtraKind),g("COLOR_0",X.f.ColorKind,(q=>{"VEC4"===q.type&&(b.hasVertexAlpha=!0)})),Promise.all(v).then((()=>U))}_createMorphTargets(q,S,b,z,C){if(!z.targets||!this._parent.loadMorphTargets)return;if(void 0==S._numMorphTargets)S._numMorphTargets=z.targets.length;else if(z.targets.length!==S._numMorphTargets)throw new Error(`${q}: Primitives do not have the same number of targets`);const v=b.extras?b.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,C.morphTargetManager=new e(this._babylonScene),C.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.morphTargetManager.areUpdatesFrozen=!0;for(let U=0;U<z.targets.length;U++){const q=S.weights?S.weights[U]:b.weights?b.weights[U]:0,z=v?v[U]:`morphTarget${U}`;C.morphTargetManager.addTarget(new f.c(z,q,C.Tq()))}}_loadMorphTargetsAsync(q,S,b,z){if(!S.targets||!this._parent.loadMorphTargets)return Promise.resolve();const C=new Array,v=b.morphTargetManager;for(let U=0;U<v.numTargets;U++){const b=v.getTarget(U);C.push(this._loadMorphTargetVertexDataAsync(`${q}/targets/${U}`,z,S.targets[U],b))}return Promise.all(C).then((()=>{v.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(q,S,b,z){const C=new Array,v=(z,v,U)=>{if(void 0==b[z])return;const g=S.getVertexBuffer(v);if(!g)return;const r=o.Get(`${q}/${z}`,this._gltf.accessors,b[z]);C.push(this._loadFloatAccessorAsync(`/accessors/${r.index}`,r).then((q=>{U(g,q)})))};return v("POSITION",X.f.PositionKind,((q,S)=>{const b=new Float32Array(S.length);q.forEach(S.length,((q,z)=>{b[z]=S[z]+q})),z.setPositions(b)})),v("NORMAL",X.f.NormalKind,((q,S)=>{const b=new Float32Array(S.length);q.forEach(b.length,((q,z)=>{b[z]=S[z]+q})),z.setNormals(b)})),v("TANGENT",X.f.TangentKind,((q,S)=>{const b=new Float32Array(S.length/3*4);let C=0;q.forEach(S.length/3*4,((q,z)=>{(z+1)%4!==0&&(b[C]=S[C]+q,C++)})),z.setTangents(b)})),v("TEXCOORD_0",X.f.UVKind,((q,S)=>{const b=new Float32Array(S.length);q.forEach(S.length,((q,z)=>{b[z]=S[z]+q})),z.setUVs(b)})),v("TEXCOORD_1",X.f.UV2Kind,((q,S)=>{const b=new Float32Array(S.length);q.forEach(S.length,((q,z)=>{b[z]=S[z]+q})),z.setUV2s(b)})),v("COLOR_0",X.f.ColorKind,((S,b)=>{let C=null;const v=S.getSize();if(3===v){C=new Float32Array(b.length/3*4),S.forEach(b.length,((q,S)=>{const z=Math.floor(S/3),v=S%3;C[4*z+v]=b[3*z+v]+q}));for(let q=0;q<b.length/3;++q)C[4*q+3]=1}else{if(4!==v)throw new Error(`${q}: Invalid number of components (${v}) for COLOR_0 attribute`);C=new Float32Array(b.length),S.forEach(b.length,((q,S)=>{C[S]=b[S]+q}))}z.setColors(C)})),await Promise.all(C).then((()=>{}))}static _LoadTransform(q,S){if(void 0!=q.skin)return;let b=C.yS.Zero(),z=C.Quaternion.Identity(),v=C.yS.One();if(q.matrix){C.Matrix.Hb(q.matrix).decompose(v,z,b)}else q.translation&&(b=C.yS.Hb(q.translation)),q.rotation&&(z=C.Quaternion.Hb(q.rotation)),q.scale&&(v=C.yS.Hb(q.scale));S.position=b,S.rotationQuaternion=z,S.tb=v}_loadSkinAsync(q,S,b,z){if(!this._parent.loadSkins)return Promise.resolve();const C=this._extensionsLoadSkinAsync(q,S,b);if(C)return C;if(b._data)return z(b._data.babylonSkeleton),b._data.promise;const v=`skeleton${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new Q(b.name||v,v,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(q,b,U);const g=this._loadSkinInverseBindMatricesDataAsync(q,b).then((q=>{this._updateBoneMatrices(U,q)}));return b._data={babylonSkeleton:U,promise:g},z(U),g}_loadBones(q,S,b){if(void 0==S.skeleton||this._parent.alwaysComputeSkeletonRootNode){const b=this._findSkeletonRootNode(`${q}/joints`,S.joints);if(b)if(void 0===S.skeleton)S.skeleton=b.index;else{const z=(q,S)=>{for(;S.parent;S=S.parent)if(S.parent===q)return!0;return!1},C=o.Get(`${q}/skeleton`,this._gltf.nodes,S.skeleton);C===b||z(C,b)||(Z.b.Warn(`${q}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),S.skeleton=b.index)}else Z.b.Warn(`${q}: Failed to find common root`)}const z={};for(const C of S.joints){const v=o.Get(`${q}/joints/${C}`,this._gltf.nodes,C);this._loadBone(v,S,b,z)}}_findSkeletonRootNode(q,S){if(0===S.length)return null;const b={};for(const C of S){const S=[];let z=o.Get(`${q}/${C}`,this._gltf.nodes,C);for(;-1!==z.index;)S.unshift(z),z=z.parent;b[C]=S}let z=null;for(let C=0;;++C){let q=b[S[0]];if(C>=q.length)return z;const v=q[C];for(let U=1;U<S.length;++U)if(q=b[S[U]],C>=q.length||v!==q[C])return z;z=v}}_loadBone(q,S,b,z){q._isJoint=!0;let C=z[q.index];if(C)return C;let v=null;q.index!==S.skeleton&&(q.parent&&-1!==q.parent.index?v=this._loadBone(q.parent,S,b,z):void 0!==S.skeleton&&Z.b.Warn(`/skins/${S.index}/skeleton: Skeleton node is not a common root`));const U=S.joints.indexOf(q.index);return C=new I.b(q.name||`joint${q.index}`,b,v,this._getNodeMatrix(q),null,null,U),z[q.index]=C,this._postSceneLoadActions.push((()=>{C.linkTransformNode(q._babylonTransformNode)})),C}_loadSkinInverseBindMatricesDataAsync(q,S){if(void 0==S.inverseBindMatrices)return Promise.resolve(null);const b=o.Get(`${q}/inverseBindMatrices`,this._gltf.accessors,S.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${b.index}`,b)}_updateBoneMatrices(q,S){for(const b of q.bones){const q=C.Matrix.Identity(),z=b._index;S&&-1!==z&&(C.Matrix.FromArrayToRef(S,16*z,q),q.invertToRef(q));const v=b.getParent();v&&q.multiplyToRef(v.getAbsoluteInverseBindMatrix(),q),b.Wb(q,!1,!1),b._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(q){return q.matrix?C.Matrix.Hb(q.matrix):C.Matrix.Compose(q.scale?C.yS.Hb(q.scale):C.yS.One(),q.rotation?C.Quaternion.Hb(q.rotation):C.Quaternion.Identity(),q.translation?C.yS.Hb(q.translation):C.yS.Zero())}loadCameraAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadCameraAsync(q,S,b);if(z)return z;const v=new Array;this.logOpen(`${q} ${S.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new r.c(S.name||`camera${S.index}`,C.yS.Zero(),this._babylonScene,!1);switch(U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonCamera=U,U.setTarget(new C.yS(0,0,-1)),S.type){case"perspective":{const b=S.perspective;if(!b)throw new Error(`${q}: Camera perspective properties are missing`);U.fov=b.yfov,U.kb=b.znear,U.maxZ=b.zfar||0;break}case"orthographic":if(!S.orthographic)throw new Error(`${q}: Camera orthographic properties are missing`);U.mode=g.c.ORTHOGRAPHIC_CAMERA,U.orthoLeft=-S.orthographic.xmag,U.orthoRight=S.orthographic.xmag,U.orthoBottom=-S.orthographic.ymag,U.orthoTop=S.orthographic.ymag,U.kb=S.orthographic.znear,U.maxZ=S.orthographic.zfar;break;default:throw new Error(`${q}: Invalid camera type (${S.type})`)}return A.AddPointerMetadata(U,q),this._parent.onCameraLoadedObservable.notifyObservers(U),b(U),this.logClose(),Promise.all(v).then((()=>U))}_loadAnimationsAsync(){const q=this._gltf.animations;if(!q)return Promise.resolve();const S=new Array;for(let b=0;b<q.length;b++){const z=q[b];S.push(this.loadAnimationAsync(`/animations/${z.index}`,z).then((q=>{0===q.targetedAnimations.length&&q.dispose()})))}return Promise.all(S).then((()=>{}))}loadAnimationAsync(q,S){const z=this._extensionsLoadAnimationAsync(q,S);return z||b.e(78).then(b.bind(b,14278)).then((b=>{let{AnimationGroup:z}=b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new z(S.name||`animation${S.index}`,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S._babylonAnimationGroup=C;const v=new Array;o.Assign(S.channels),o.Assign(S.samplers);for(const U of S.channels)v.push(this._loadAnimationChannelAsync(`${q}/channels/${U.index}`,q,S,U,((q,S)=>{q.animations=q.animations||[],q.animations.push(S),C.addTargetedAnimation(S,q)})));return Promise.all(v).then((()=>(C.normalize(0),C)))}))}async _loadAnimationChannelAsync(q,S,z,C,v){const U=this._extensionsLoadAnimationChannelAsync(q,S,z,C,v);if(U)return await U;if(void 0==C.target.node)return await Promise.resolve();const g=o.Get(`${q}/target/node`,this._gltf.nodes,C.target.node),r=C.target.path,I="weights"===r;if(I&&!g._numMorphTargets||!I&&!g._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!I&&!g._isJoint)return await Promise.resolve();let V;switch(await Promise.resolve().then(b.bind(b,12787)),r){case"translation":var l;V=null===(l=(0,F.d)("/nodes/{}/translation"))||void 0===l?void 0:l.interpolation;break;case"rotation":var y;V=null===(y=(0,F.d)("/nodes/{}/rotation"))||void 0===y?void 0:y.interpolation;break;case"scale":var R;V=null===(R=(0,F.d)("/nodes/{}/scale"))||void 0===R?void 0:R.interpolation;break;case"weights":var G;V=null===(G=(0,F.d)("/nodes/{}/weights"))||void 0===G?void 0:G.interpolation;break;default:throw new Error(`${q}/target/path: Invalid value (${C.target.path})`)}if(!V)throw new Error(`${q}/target/path: Could not find interpolation properties for target path (${C.target.path})`);const Z={object:g,info:V};return await this._loadAnimationChannelFromTargetInfoAsync(q,S,z,C,Z,v)}_loadAnimationChannelFromTargetInfoAsync(q,S,b,z,C,v){const U=this.parent.targetFps,g=1/U,r=o.Get(`${q}/sampler`,b.samplers,z.sampler);return this._loadAnimationSamplerAsync(`${S}/samplers/${z.sampler}`,r).then((q=>{let S=0;const r=C.object,I=C.info;for(const C of I){const I=C.getStride(r),V=q.input,l=q.output,y=new Array(V.length);let R=0;switch(q.interpolation){case"STEP":for(let q=0;q<V.length;q++){const S=C.getValue(r,l,R,1);R+=I,y[q]={frame:V[q]*U,value:S,interpolation:1}}break;case"CUBICSPLINE":for(let q=0;q<V.length;q++){const S=C.getValue(r,l,R,g);R+=I;const b=C.getValue(r,l,R,1);R+=I;const z=C.getValue(r,l,R,g);R+=I,y[q]={frame:V[q]*U,inTangent:S,value:b,outTangent:z}}break;case"LINEAR":for(let q=0;q<V.length;q++){const S=C.getValue(r,l,R,1);R+=I,y[q]={frame:V[q]*U,value:S}}}if(R>0){const q=`${b.name||`animation${b.index}`}_channel${z.index}_${S}`,g=C.buildAnimations(r,q,U,y);for(const b of g)S++,v(b.babylonAnimatable,b.babylonAnimation)}}}))}_loadAnimationSamplerAsync(q,S){if(S._data)return S._data;const b=S.interpolation||"LINEAR";switch(b){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${q}/interpolation: Invalid value (${S.interpolation})`)}const z=o.Get(`${q}/input`,this._gltf.accessors,S.input),C=o.Get(`${q}/output`,this._gltf.accessors,S.output);return S._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${z.index}`,z),this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)]).then((q=>{let[S,z]=q;return{input:S,interpolation:b,output:z}})),S._data}loadBufferAsync(q,S,b,z){const C=this._extensionsLoadBufferAsync(q,S,b,z);if(C)return C;if(!S._data)if(S.uri)S._data=this.loadUriAsync(`${q}/uri`,S,S.uri);else{if(!this._bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);S._data=this._bin.readAsync(0,S.byteLength)}return S._data.then((S=>{try{return new Uint8Array(S.buffer,S.byteOffset+b,z)}catch(C){throw new Error(`${q}: ${C.message}`)}}))}loadBufferViewAsync(q,S){const b=this._extensionsLoadBufferViewAsync(q,S);if(b)return b;if(S._data)return S._data;const z=o.Get(`${q}/buffer`,this._gltf.buffers,S.buffer);return S._data=this.loadBufferAsync(`/buffers/${z.index}`,z,S.byteOffset||0,S.byteLength),S._data}_loadAccessorAsync(q,S,b){if(S._data)return S._data;const z=A._GetNumComponents(q,S.type),C=z*X.f.GetTypeByteLength(S.componentType),v=z*S.count;if(void 0==S.bufferView)S._data=Promise.resolve(new b(v));else{const U=o.Get(`${q}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((g=>{if(5126!==S.componentType||S.normalized||U.byteStride&&U.byteStride!==C){const q=new b(v);return X.f.ForEach(g,S.byteOffset||0,U.byteStride||C,z,S.componentType,q.length,S.normalized||!1,((S,b)=>{q[b]=S})),q}return A._GetTypedArray(q,S.componentType,g,S.byteOffset,v)}))}if(S.sparse){const v=S.sparse;S._data=S._data.then((U=>{const g=U,r=o.Get(`${q}/sparse/indices/bufferView`,this._gltf.bufferViews,v.indices.bufferView),I=o.Get(`${q}/sparse/values/bufferView`,this._gltf.bufferViews,v.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${r.index}`,r),this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)]).then((U=>{let[r,I]=U;const V=A._GetTypedArray(`${q}/sparse/indices`,v.indices.componentType,r,v.indices.byteOffset,v.count),l=z*v.count;let y;if(5126!==S.componentType||S.normalized){const U=A._GetTypedArray(`${q}/sparse/values`,S.componentType,I,v.values.byteOffset,l);y=new b(l),X.f.ForEach(U,0,C,z,S.componentType,y.length,S.normalized||!1,((q,S)=>{y[S]=q}))}else y=A._GetTypedArray(`${q}/sparse/values`,S.componentType,I,v.values.byteOffset,l);let R=0;for(let q=0;q<V.length;q++){let S=V[q]*z;for(let q=0;q<z;q++)g[S++]=y[R++]}return g}))}))}return S._data}_loadFloatAccessorAsync(q,S){return this._loadAccessorAsync(q,S,Float32Array)}_loadIndicesAccessorAsync(q,S){if("SCALAR"!==S.type)throw new Error(`${q}/type: Invalid value ${S.type}`);if(5121!==S.componentType&&5123!==S.componentType&&5125!==S.componentType)throw new Error(`${q}/componentType: Invalid value ${S.componentType}`);if(S._data)return S._data;if(S.sparse){const b=A._GetTypedArrayConstructor(`${q}/componentType`,S.componentType);S._data=this._loadAccessorAsync(q,S,b)}else{const b=o.Get(`${q}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>A._GetTypedArray(q,S.componentType,b,S.byteOffset,S.count)))}return S._data}_loadVertexBufferViewAsync(q){if(q._babylonBuffer)return q._babylonBuffer;const S=this._babylonScene.getEngine();return q._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>new X.b(S,q,!1))),q._babylonBuffer}_loadVertexAccessorAsync(q,S,b){var z;if(null!==(z=S._babylonVertexBuffer)&&void 0!==z&&z[b])return S._babylonVertexBuffer[b];S._babylonVertexBuffer||(S._babylonVertexBuffer={});const C=this._babylonScene.getEngine();if(S.sparse||void 0==S.bufferView)S._babylonVertexBuffer[b]=this._loadFloatAccessorAsync(q,S).then((q=>new X.f(C,q,b,!1)));else{const z=o.Get(`${q}/bufferView`,this._gltf.bufferViews,S.bufferView);S._babylonVertexBuffer[b]=this._loadVertexBufferViewAsync(z).then((v=>{const U=A._GetNumComponents(q,S.type);return new X.f(C,v,b,!1,void 0,z.byteStride,void 0,S.byteOffset,U,S.componentType,S.normalized,!0,void 0,!0)}))}return S._babylonVertexBuffer[b]}_loadMaterialMetallicRoughnessPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return S&&(S.baseColorFactor?(b.albedoColor=v.HS.Hb(S.baseColorFactor),b.alpha=S.baseColorFactor[3]):b.albedoColor=v.HS.White(),b.metallic=void 0==S.metallicFactor?1:S.metallicFactor,b.roughness=void 0==S.roughnessFactor?1:S.roughnessFactor,S.baseColorTexture&&z.push(this.loadTextureInfoAsync(`${q}/baseColorTexture`,S.baseColorTexture,(q=>{q.name=`${b.name} (Base Color)`,b.albedoTexture=q}))),S.metallicRoughnessTexture&&(S.metallicRoughnessTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${q}/metallicRoughnessTexture`,S.metallicRoughnessTexture,(q=>{q.name=`${b.name} (Metallic Roughness)`,b.metallicTexture=q}))),b.useMetallnessFromMetallicTextureBlue=!0,b.useRoughnessFromMetallicTextureGreen=!0,b.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(z).then((()=>{}))}_loadMaterialAsync(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const v=this._extensionsLoadMaterialAsync(q,S,b,z,C);if(v)return v;S._data=S._data||{};let U=S._data[z];if(!U){this.logOpen(`${q} ${S.name||""}`);const b=this.createMaterial(q,S,z);U={babylonMaterial:b,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(q,S,b)},S._data[z]=U,A.AddPointerMetadata(b,q),this._parent.onMaterialLoadedObservable.notifyObservers(b),this.logClose()}return b&&(U.babylonMeshes.push(b),b.gb.addOnce((()=>{const q=U.babylonMeshes.indexOf(b);-1!==q&&U.babylonMeshes.splice(q,1)}))),C(U.babylonMaterial),U.promise.then((()=>U.babylonMaterial))}_createDefaultMaterial(q,S){this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new W.b(q,this._babylonScene);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b.fillMode=S,b.enableSpecularAntiAliasing=!0,b.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,b.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,b.transparencyMode=W.b.PBRMATERIAL_OPAQUE,b.metallic=1,b.roughness=1,b}createMaterial(q,S,b){const z=this._extensionsCreateMaterial(q,S,b);if(z)return z;const C=S.name||`material${S.index}`;return this._createDefaultMaterial(C,b)}loadMaterialPropertiesAsync(q,S,b){const z=this._extensionsLoadMaterialPropertiesAsync(q,S,b);if(z)return z;const C=new Array;return C.push(this.loadMaterialBasePropertiesAsync(q,S,b)),S.pbrMetallicRoughness&&C.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${q}/pbrMetallicRoughness`,S.pbrMetallicRoughness,b)),this.loadMaterialAlphaProperties(q,S,b),Promise.all(C).then((()=>{}))}loadMaterialBasePropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.emissiveColor=S.emissiveFactor?v.HS.Hb(S.emissiveFactor):new v.HS(0,0,0),S.doubleSided&&(b.Tb=!1,b.twoSidedLighting=!0),S.normalTexture&&(S.normalTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${q}/normalTexture`,S.normalTexture,(q=>{q.name=`${b.name} (Normal)`,b.bumpTexture=q}))),b.invertNormalMapX=!this._babylonScene.useRightHandedSystem,b.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=S.normalTexture.scale&&b.bumpTexture&&(b.bumpTexture.level=S.normalTexture.scale),b.forceIrradianceInFragment=!0),S.occlusionTexture&&(S.occlusionTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${q}/occlusionTexture`,S.occlusionTexture,(q=>{q.name=`${b.name} (Occlusion)`,b.ambientTexture=q}))),b.useAmbientInGrayScale=!0,void 0!=S.occlusionTexture.strength&&(b.ambientTextureStrength=S.occlusionTexture.strength)),S.emissiveTexture&&z.push(this.loadTextureInfoAsync(`${q}/emissiveTexture`,S.emissiveTexture,(q=>{q.name=`${b.name} (Emissive)`,b.emissiveTexture=q}))),Promise.all(z).then((()=>{}))}loadMaterialAlphaProperties(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);switch(S.alphaMode||"OPAQUE"){case"OPAQUE":b.transparencyMode=W.b.PBRMATERIAL_OPAQUE,b.alpha=1;break;case"MASK":b.transparencyMode=W.b.PBRMATERIAL_ALPHATEST,b.alphaCutOff=void 0==S.alphaCutoff?.5:S.alphaCutoff,b.albedoTexture&&(b.albedoTexture.Qb=!0);break;case"BLEND":b.transparencyMode=W.b.PBRMATERIAL_ALPHABLEND,b.albedoTexture&&(b.albedoTexture.Qb=!0,b.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${q}/alphaMode: Invalid value (${S.alphaMode})`)}}loadTextureInfoAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureInfoAsync(q,S,b);if(z)return z;if(this.logOpen(`${q}`),S.texCoord>=6)throw new Error(`${q}/texCoord: Invalid value (${S.texCoord})`);const C=o.Get(`${q}/index`,this._gltf.textures,S.index);C._textureInfo=S;const v=this._loadTextureAsync(`/textures/${S.index}`,C,(z=>{z.coordinatesIndex=S.texCoord||0,A.AddPointerMetadata(z,q),this._parent.onTextureLoadedObservable.notifyObservers(z),b(z)}));return this.logClose(),v}_loadTextureAsync(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureAsync(q,S,b);if(z)return z;this.logOpen(`${q} ${S.name||""}`);const C=void 0==S.sampler?A.DefaultSampler:o.Get(`${q}/sampler`,this._gltf.samplers,S.sampler),v=o.Get(`${q}/source`,this._gltf.images,S.source),U=this._createTextureAsync(q,C,v,b,void 0,!S._textureInfo.nonColorData);return this.logClose(),U}_createTextureAsync(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},v=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0;const g=this._loadSampler(`/samplers/${S.index}`,S),r=new Array,I=new z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V={noMipmap:g.noMipMaps,invertY:!1,samplingMode:g.samplingMode,M:()=>{this._disposed||I.resolve()},onError:(S,b)=>{this._disposed||I.reject(new Error(`${q}: ${b&&b.message?b.message:S||"Failed to load texture"}`))},mimeType:b.mimeType??(0,J.g)(b.uri??""),loaderOptions:v,useSRGBBuffer:!!U&&this._parent.useSRGBBuffers},l=new N.e(null,this._babylonScene,V);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.push(I.promise),r.push(this.loadImageAsync(`/images/${b.index}`,b).then((q=>{const S=b.uri||`${this._fileName}#image${b.index}`,z=`data:${this._uniqueRootUrl}${S}`;l.updateURL(z,q);const C=l.getInternalTexture();C&&(C.label=b.name)}))),l.wrapU=g.wrapU,l.wrapV=g.wrapV,C(l),this._parent.useGltfTextureNames&&(l.name=b.name||b.uri||`image${b.index}`),Promise.all(r).then((()=>l))}_loadSampler(q,S){return S._data||(S._data={noMipMaps:9728===S.minFilter||9729===S.minFilter,samplingMode:A._GetTextureSamplingMode(q,S),wrapU:A._GetTextureWrapMode(`${q}/wrapS`,S.wrapS),wrapV:A._GetTextureWrapMode(`${q}/wrapT`,S.wrapT)}),S._data}loadImageAsync(q,S){if(!S._data){if(this.logOpen(`${q} ${S.name||""}`),S.uri)S._data=this.loadUriAsync(`${q}/uri`,S,S.uri);else{const b=o.Get(`${q}/bufferView`,this._gltf.bufferViews,S.bufferView);S._data=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}this.logClose()}return S._data}loadUriAsync(q,S,b){const z=this._extensionsLoadUriAsync(q,S,b);if(z)return z;if(!A._ValidateUri(b))throw new Error(`${q}: '${b}' is invalid`);if((0,J.j)(b)){const S=new Uint8Array((0,J.b)(b));return this.log(`${q}: Decoded ${b.substring(0,64)}... (${S.length} bytes)`),Promise.resolve(S)}return this.log(`${q}: Loading ${b}`),this._parent.preprocessUrlAsync(this._rootUrl+b).then((S=>new Promise(((z,C)=>{this._parent._loadFile(this._babylonScene,S,(S=>{this._disposed||(this.log(`${q}: Loaded ${b} (${S.byteLength} bytes)`),z(new Uint8Array(S)))}),!0,(S=>{C(new J.n(`${q}: Failed to load '${b}'${S?": "+S.status+" "+S.statusText:""}`,S))}))}))))}static AddPointerMetadata(q,S){q.metadata=q.metadata||{};const b=q._internalMetadata=q._internalMetadata||{},z=b.lb=b.lb||{};(z.pointers=z.pointers||[]).push(S)}static _GetTextureWrapMode(q,S){switch(S=void 0==S?10497:S){case 33071:return N.e.CLAMP_ADDRESSMODE;case 33648:return N.e.MIRROR_ADDRESSMODE;case 10497:return N.e.WRAP_ADDRESSMODE;default:return Z.b.Warn(`${q}: Invalid value (${S})`),N.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(q,S){const b=void 0==S.magFilter?9729:S.magFilter,z=void 0==S.minFilter?9987:S.minFilter;if(9729===b)switch(z){case 9728:return N.e.LINEAR_NEAREST;case 9729:return N.e.LINEAR_LINEAR;case 9984:return N.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return N.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return N.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return N.e.LINEAR_LINEAR_MIPLINEAR;default:return Z.b.Warn(`${q}/minFilter: Invalid value (${z})`),N.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==b&&Z.b.Warn(`${q}/magFilter: Invalid value (${b})`),z){case 9728:return N.e.NEAREST_NEAREST;case 9729:return N.e.NEAREST_LINEAR;case 9984:return N.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return N.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return N.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return N.e.NEAREST_LINEAR_MIPLINEAR;default:return Z.b.Warn(`${q}/minFilter: Invalid value (${z})`),N.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(q,S){try{return(0,n.p)(S)}catch(b){throw new Error(`${q}: ${b.message}`)}}static _GetTypedArray(q,S,b,z,C){const v=b.buffer;z=b.byteOffset+(z||0);const U=A._GetTypedArrayConstructor(`${q}/componentType`,S),g=X.f.GetTypeByteLength(S);return z%g!==0?(Z.b.Warn(`${q}: Copying buffer as byte offset (${z}) is not a multiple of component type byte length (${g})`),new U(v.slice(z,z+C*g),0)):new U(v,z,C)}static _GetNumComponents(q,S){switch(S){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${q}: Invalid type (${S})`)}static _ValidateUri(q){return U.Tools.IsBase64(q)||-1===q.indexOf("..")}static _GetDrawMode(q,S){switch(void 0==S&&(S=4),S){case 0:return k.c.PointListDrawMode;case 1:return k.c.LineListDrawMode;case 2:return k.c.LineLoopDrawMode;case 3:return k.c.LineStripDrawMode;case 4:return k.c.TriangleFillMode;case 5:return k.c.TriangleStripDrawMode;case 6:return k.c.TriangleFanDrawMode}throw new Error(`${q}: Invalid mesh primitive mode (${S})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const q=new Array;if(this._gltf.materials)for(const S of this._gltf.materials)if(S._data)for(const b in S._data){const z=S._data[b];for(const S of z.babylonMeshes){S.Nb(!0);const b=z.babylonMaterial;q.push(b.forceCompilationAsync(S)),q.push(b.forceCompilationAsync(S,{useInstances:!0})),this._parent.useClipPlane&&(q.push(b.forceCompilationAsync(S,{clipPlane:!0})),q.push(b.forceCompilationAsync(S,{clipPlane:!0,useInstances:!0})))}}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const q=new Array,S=this._babylonScene.lights;for(const b of S){const S=b.getShadowGenerator();S&&q.push(S.forceCompilationAsync())}return Promise.all(q).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(q){for(const S of this._extensions)S.enabled&&q(S)}_applyExtensions(q,S,b){for(const z of this._extensions)if(z.enabled){const C=`${z.name}.${S}`,v=q;v._activeLoaderExtensionFunctions=v._activeLoaderExtensionFunctions||{};const U=v._activeLoaderExtensionFunctions;if(!U[C]){U[C]=!0;try{const q=b(z);if(q)return q}finally{delete U[C]}}}return null}_extensionsOnLoading(){this._forEachExtensions((q=>q.onLoading&&q.onLoading()))}_extensionsOnReady(){this._forEachExtensions((q=>q.onReady&&q.onReady()))}_extensionsLoadSceneAsync(q,S){return this._applyExtensions(S,"loadScene",(b=>b.loadSceneAsync&&b.loadSceneAsync(q,S)))}_extensionsLoadNodeAsync(q,S,b){return this._applyExtensions(S,"loadNode",(z=>z.loadNodeAsync&&z.loadNodeAsync(q,S,b)))}_extensionsLoadCameraAsync(q,S,b){return this._applyExtensions(S,"loadCamera",(z=>z.loadCameraAsync&&z.loadCameraAsync(q,S,b)))}_extensionsLoadVertexDataAsync(q,S,b){return this._applyExtensions(S,"loadVertexData",(z=>z._loadVertexDataAsync&&z._loadVertexDataAsync(q,S,b)))}_extensionsLoadMeshPrimitiveAsync(q,S,b,z,C,v){return this._applyExtensions(C,"loadMeshPrimitive",(U=>U._loadMeshPrimitiveAsync&&U._loadMeshPrimitiveAsync(q,S,b,z,C,v)))}_extensionsLoadMaterialAsync(q,S,b,z,C){return this._applyExtensions(S,"loadMaterial",(v=>v._loadMaterialAsync&&v._loadMaterialAsync(q,S,b,z,C)))}_extensionsCreateMaterial(q,S,b){return this._applyExtensions(S,"createMaterial",(z=>z.createMaterial&&z.createMaterial(q,S,b)))}_extensionsLoadMaterialPropertiesAsync(q,S,b){return this._applyExtensions(S,"loadMaterialProperties",(z=>z.loadMaterialPropertiesAsync&&z.loadMaterialPropertiesAsync(q,S,b)))}_extensionsLoadTextureInfoAsync(q,S,b){return this._applyExtensions(S,"loadTextureInfo",(z=>z.loadTextureInfoAsync&&z.loadTextureInfoAsync(q,S,b)))}_extensionsLoadTextureAsync(q,S,b){return this._applyExtensions(S,"loadTexture",(z=>z._loadTextureAsync&&z._loadTextureAsync(q,S,b)))}_extensionsLoadAnimationAsync(q,S){return this._applyExtensions(S,"loadAnimation",(b=>b.loadAnimationAsync&&b.loadAnimationAsync(q,S)))}_extensionsLoadAnimationChannelAsync(q,S,b,z,C){return this._applyExtensions(b,"loadAnimationChannel",(v=>v._loadAnimationChannelAsync&&v._loadAnimationChannelAsync(q,S,b,z,C)))}_extensionsLoadSkinAsync(q,S,b){return this._applyExtensions(b,"loadSkin",(z=>z._loadSkinAsync&&z._loadSkinAsync(q,S,b)))}_extensionsLoadUriAsync(q,S,b){return this._applyExtensions(S,"loadUri",(z=>z._loadUriAsync&&z._loadUriAsync(q,S,b)))}_extensionsLoadBufferViewAsync(q,S){return this._applyExtensions(S,"loadBufferView",(b=>b.loadBufferViewAsync&&b.loadBufferViewAsync(q,S)))}_extensionsLoadBufferAsync(q,S,b,z){return this._applyExtensions(S,"loadBuffer",(C=>C.loadBufferAsync&&C.loadBufferAsync(q,S,b,z)))}static LoadExtensionAsync(q,S,b,z){if(!S.extensions)return null;const C=S.extensions[b];return C?z(`${q}/extensions/${b}`,C):null}static LoadExtraAsync(q,S,b,z){if(!S.extras)return null;const C=S.extras[b];return C?z(`${q}/extras/${b}`,C):null}isExtensionUsed(q){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(q)}logOpen(q){this._parent._logOpen(q)}logClose(){this._parent._logClose()}log(q){this._parent._log(q)}startPerformanceCounter(q){this._parent._startPerformanceCounter(q)}endPerformanceCounter(q){this._parent._endPerformanceCounter(q)}}A.DefaultSampler={index:-1},i.b._CreateGLTF2Loader=q=>new A(q);var w=b(12787),P=b(11291),h=b(11137),O=b(12790),j=b(12799);class M extends j.e{constructor(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",q),this._texture=q.getEngine().createRawCubeTexture(S,b,z,C,v,U,g,r)}update(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,q,S,b,z,C)}updateRGBDAsync(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,O.m)(this._texture,q,S,b,z).then((()=>{}))}clone(){return h.b.Clone((()=>{const q=this.Tq(),S=this._texture,b=new M(q,S._bufferViewArray,S.width,S.format,S.type,S.generateMipMaps,S.invertY,S.samplingMode,S._compression);return 13===S.source&&b.updateRGBDAsync(S._bufferViewArrayArray,S._sphericalPolynomial,S._lodGenerationScale,S._lodGenerationOffset),b}),this)}}const p="EXT_lights_image_based";class Y{constructor(q){this.name=p,this._loader=q,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.lb.extensions;if(q&&q[this.name]){const S=q[this.name];this._lights=S.lights}}loadSceneAsync(q,S){return A.LoadExtensionAsync(q,S,this.name,(async(b,z)=>{this._loader._allMaterialsDirtyRequired=!0;const C=new Array;C.push(this._loader.loadSceneAsync(q,S)),this._loader.logOpen(`${b}`);const v=o.Get(`${b}/light`,this._lights,z.zb);return C.push(this._loadLightAsync(`/extensions/${this.name}/lights/${z.zb}`,v).then((q=>{this._loader.babylonScene.environmentTexture=q}))),this._loader.logClose(),await Promise.all(C).then((()=>{}))}))}_loadLightAsync(q,S){if(!S._loaded){const b=new Array;this._loader.logOpen(`${q}`);const z=new Array(S.specularImages.length);for(let C=0;C<S.specularImages.length;C++){const v=S.specularImages[C];z[C]=new Array(v.length);for(let S=0;S<v.length;S++){const U=`${q}/specularImages/${C}/${S}`;this._loader.logOpen(`${U}`);const g=v[S],r=o.Get(U,this._loader.lb.images,g);b.push(this._loader.loadImageAsync(`/images/${g}`,r).then((q=>{z[C][S]=q}))),this._loader.logClose()}}this._loader.logClose(),S._loaded=Promise.all(b).then((async()=>{const b=new M(this._loader.babylonScene,null,S.specularImageSize);if(b.name=S.name||"environment",S._babylonTexture=b,void 0!=S.eb&&(b.level=S.eb),S.rotation){let q=C.Quaternion.Hb(S.rotation);this._loader.babylonScene.useRightHandedSystem||(q=C.Quaternion.Inverse(q)),C.Matrix.FromQuaternionToRef(q,b.getReflectionTextureMatrix())}if(!S.irradianceCoefficients)throw new Error(`${q}: Irradiance coefficients are missing`);const v=P.b.Hb(S.irradianceCoefficients);v.scaleInPlace(S.eb),v.convertIrradianceToLambertianRadiance();const U=P.c.FromHarmonics(v),g=(z.length-1)/Math.log2(S.specularImageSize);return await b.updateRGBDAsync(z,U,g)}))}return S._loaded.then((()=>S._babylonTexture))}}x(p),D(p,!0,(q=>new Y(q)));b(11679);const c="EXT_mesh_gpu_instancing";class qq{constructor(q){this.name=c,this._loader=q,this.enabled=this._loader.isExtensionUsed(c)}dispose(){this._loader=null}loadNodeAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(q,z)=>{this._loader._disableInstancedMesh++;const v=this._loader.loadNodeAsync(`/nodes/${S.index}`,S,b);if(this._loader._disableInstancedMesh--,!S._primitiveBabylonMeshes)return await v;const U=new Array;let g=0;const r=S=>{if(void 0==z.attributes[S])return void U.push(Promise.resolve(null));const b=o.Get(`${q}/attributes/${S}`,this._loader.lb.accessors,z.attributes[S]);if(U.push(this._loader._loadFloatAccessorAsync(`/accessors/${b.bufferView}`,b)),0===g)g=b.count;else if(g!==b.count)throw new Error(`${q}/attributes: Instance buffer accessors do not have the same count.`)};return r("TRANSLATION"),r("ROTATION"),r("SCALE"),await v.then((async q=>{const[b,z,v]=await Promise.all(U),r=new Float32Array(16*g);C.TmpVectors.yS[0].Bb(0,0,0),C.TmpVectors.Quaternion[0].Bb(0,0,0,1),C.TmpVectors.yS[1].Bb(1,1,1);for(let S=0;S<g;++S)b&&C.yS.FromArrayToRef(b,3*S,C.TmpVectors.yS[0]),z&&C.Quaternion.FromArrayToRef(z,4*S,C.TmpVectors.Quaternion[0]),v&&C.yS.FromArrayToRef(v,3*S,C.TmpVectors.yS[1]),C.Matrix.ComposeToRef(C.TmpVectors.yS[1],C.TmpVectors.Quaternion[0],C.TmpVectors.yS[0],C.TmpVectors.Matrix[0]),C.TmpVectors.Matrix[0].copyToArray(r,16*S);for(const C of S._primitiveBabylonMeshes)C.dl("matrix",r,16,!0);return q}))}))}}x(c),D(c,!0,(q=>new qq(q)));let Sq=0,bq=null;class zq{static get Default(){return zq._Default||(zq._Default=new zq),zq._Default}constructor(){const q=zq.Configuration.decoder;this._decoderModulePromise=U.Tools.LoadBabylonScriptAsync(q.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(q,S,b,z,C){await this._decoderModulePromise,0===Sq&&(MeshoptDecoder.useWorkers(1),Sq=1);const v=await MeshoptDecoder.decodeGltfBufferAsync(S,b,q,z,C);return null!==bq&&clearTimeout(bq),bq=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Sq=0,bq=null}),1e3),v}}zq.Configuration={decoder:{url:`${U.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},zq._Default=null;const Cq="EXT_meshopt_compression";class vq{constructor(q){this.name=Cq,this.enabled=q.isExtensionUsed(Cq),this._loader=q}dispose(){this._loader=null}loadBufferViewAsync(q,S){return A.LoadExtensionAsync(q,S,this.name,(async(b,z)=>{const C=S;if(C._meshOptData)return await C._meshOptData;const v=o.Get(`${q}/buffer`,this._loader.lb.buffers,z.buffer);return C._meshOptData=this._loader.loadBufferAsync(`/buffers/${v.index}`,v,z.byteOffset||0,z.byteLength).then((async q=>await zq.Default.decodeGltfBufferAsync(q,z.count,z.byteStride,z.mode,z.filter))),await C._meshOptData}))}}x(Cq),D(Cq,!0,(q=>new vq(q)));const Uq="EXT_texture_webp";class gq{constructor(q){this.name=Uq,this._loader=q,this.enabled=q.isExtensionUsed(Uq)}dispose(){this._loader=null}_loadTextureAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=void 0==S.sampler?A.DefaultSampler:o.Get(`${q}/sampler`,this._loader.lb.samplers,S.sampler),U=o.Get(`${z}/source`,this._loader.lb.images,C.source);return await this._loader._createTextureAsync(q,v,U,(q=>{b(q)}),void 0,!S._textureInfo.nonColorData)}))}}x(Uq),D(Uq,!0,(q=>new gq(q)));const rq="EXT_texture_avif";class Iq{constructor(q){this.name=rq,this._loader=q,this.enabled=q.isExtensionUsed(rq)}dispose(){this._loader=null}_loadTextureAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=void 0==S.sampler?A.DefaultSampler:o.Get(`${q}/sampler`,this._loader.lb.samplers,S.sampler),U=o.Get(`${z}/source`,this._loader.lb.images,C.source);return await this._loader._createTextureAsync(q,v,U,(q=>{b(q)}),void 0,!S._textureInfo.nonColorData)}))}}x(rq),D(rq,!0,(q=>new Iq(q)));var Vq=b(12784),lq=b(11659);const yq="EXT_lights_ies";class Rq{constructor(q){this.name=yq,this._loader=q,this.enabled=this._loader.isExtensionUsed(yq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.lb.extensions;if(q&&q[this.name]){const S=q[this.name];this._lights=S.lights,o.Assign(this._lights)}}loadNodeAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,U)=>{let g,r;this._loader._allMaterialsDirtyRequired=!0;const I=await this._loader.loadNodeAsync(q,S,(q=>{r=o.Get(z,this._lights,U.zb);const S=r.name||q.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,g=new Vq.b(S,C.yS.Zero(),C.yS.Backward(),0,1,this._loader.babylonScene),g.angle=Math.PI/2,g.innerAngle=0,g._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,r._babylonLight=g,g.falloffType=lq.b.FALLOFF_GLTF,g.ib=U.color?v.HS.Hb(U.color):v.HS.White(),g.eb=U.multiplier||1,g.range=Number.MAX_VALUE,g.parent=q,this._loader._babylonLights.push(g),A.AddPointerMetadata(g,z),b(q)}));let V;if(r.uri)V=await this._loader.loadUriAsync(q,r,r.uri);else{const S=o.Get(`${q}/bufferView`,this._loader.lb.bufferViews,r.bufferView);V=await this._loader.loadBufferViewAsync(`/bufferViews/${S.index}`,S)}return g.iesProfileTexture=new N.e(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,V,!0,void 0,void 0,void 0,void 0,".ies"),I}))}}x(yq),D(yq,!0,(q=>new Rq(q)));var Gq=b(12807);const Zq="KHR_draco_mesh_compression";class Hq{constructor(q){this.name=Zq,this.useNormalizedFlagFromAccessor=!0,this._loader=q,this.enabled=Gq.b.DefaultAvailable&&this._loader.isExtensionUsed(Zq)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{if(void 0!=S.mode&&4!==S.mode&&5!==S.mode)throw new Error(`${q}: Unsupported mode ${S.mode}`);const v={},U={},g=(q,z)=>{const g=C.attributes[q];if(void 0!=g&&(b._delayInfo=b._delayInfo||[],-1===b._delayInfo.indexOf(z)&&b._delayInfo.push(z),v[z]=g,this.useNormalizedFlagFromAccessor)){const b=o.TryGet(this._loader.lb.accessors,S.attributes[q]);b&&(U[z]=b.normalized||!1)}};g("POSITION",X.f.PositionKind),g("NORMAL",X.f.NormalKind),g("TANGENT",X.f.TangentKind),g("TEXCOORD_0",X.f.UVKind),g("TEXCOORD_1",X.f.UV2Kind),g("TEXCOORD_2",X.f.UV3Kind),g("TEXCOORD_3",X.f.UV4Kind),g("TEXCOORD_4",X.f.UV5Kind),g("TEXCOORD_5",X.f.UV6Kind),g("JOINTS_0",X.f.MatricesIndicesKind),g("WEIGHTS_0",X.f.MatricesWeightsKind),g("COLOR_0",X.f.ColorKind);const r=o.Get(z,this._loader.lb.bufferViews,C.bufferView);return r._dracoBabylonGeometry||(r._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((async z=>{const C=this.dracoDecoder||Gq.b.Default,g=o.TryGet(this._loader.lb.accessors,S.attributes.POSITION),r=this._loader.parent.alwaysComputeBoundingBox||b.skeleton||!g?null:s(g);return await C._decodeMeshToGeometryForGltfAsync(b.name,this._loader.babylonScene,z,v,U,r).catch((S=>{throw new Error(`${q}: ${S.message}`)}))}))),await r._dracoBabylonGeometry}))}}x(Zq),D(Zq,!0,(q=>new Hq(q)));var Qq=b(12815),kq=b(11081),Wq=b(11090),Nq=b(11523),uq=b(11711),Xq=b(11058);Nq.e.AddNodeConstructor("Light_Type_0",((q,S)=>()=>new Tq(q,C.yS.Zero(),S)));class Tq extends uq.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(q){this._shadowAngle=q,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(q){const S=this.needCube();if(this._direction=q,this.needCube()!==S&&this._shadowGenerators){const q=this._shadowGenerators.values();for(let S=q.next();!0!==S.done;S=q.next()){S.value.recreateShadowMap()}}}constructor(q,S,b){super(q,b),this._shadowAngle=Math.PI/2,this.position=S}getClassName(){return"PointLight"}getTypeID(){return lq.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(q){if(this.direction)return super.getShadowDirection(q);switch(q){case 0:return new C.yS(1,0,0);case 1:return new C.yS(-1,0,0);case 2:return new C.yS(0,-1,0);case 3:return new C.yS(0,1,0);case 4:return new C.yS(0,0,1);case 5:return new C.yS(0,0,-1)}return C.yS.Zero()}_setDefaultShadowProjectionMatrix(q,S,b){const z=this.Tq().activeCamera;if(!z)return;const v=void 0!==this.shadowMinZ?this.shadowMinZ:z.kb,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,g=this.Tq().getEngine().useReverseDepthBuffer;C.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,g?U:v,g?v:U,q,!0,this._scene.getEngine().isNDCHalfZRange,void 0,g)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(q,S){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,S):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,S),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,S),this}transferToNodeMaterialEffect(q,S){return this.computeTransformedInformation()?q.setFloat3(S,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):q.setFloat3(S,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(q,S){q["POINTLIGHT"+S]=!0}}(0,kq.e)([(0,Wq.J)()],Tq.prototype,"shadowAngle",null),(0,Xq.f)("BABYLON.PointLight",Tq);const Bq="KHR_lights_punctual";class tq{constructor(q){this.name=Bq,this._loader=q,this.enabled=this._loader.isExtensionUsed(Bq)}dispose(){this._loader=null,delete this._lights}onLoading(){const q=this._loader.lb.extensions;if(q&&q[this.name]){const S=q[this.name];this._lights=S.lights,o.Assign(this._lights)}}loadNodeAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,U)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(q,S,(q=>{let S;const g=o.Get(z,this._lights,U.zb),r=g.name||q.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,g.type){case"directional":{const q=new Qq.b(r,C.yS.Backward(),this._loader.babylonScene);q.position.fb(0),S=q;break}case"point":S=new Tq(r,C.yS.Zero(),this._loader.babylonScene);break;case"spot":{const q=new Vq.b(r,C.yS.Zero(),C.yS.Backward(),0,1,this._loader.babylonScene);q.angle=2*(g.spot&&g.spot.outerConeAngle||Math.PI/4),q.innerAngle=2*(g.spot&&g.spot.innerConeAngle||0),S=q;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${z}: Invalid light type (${g.type})`)}S._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,g._babylonLight=S,S.falloffType=lq.b.FALLOFF_GLTF,S.ib=g.color?v.HS.Hb(g.color):v.HS.White(),S.eb=void 0==g.eb?1:g.eb,S.range=void 0==g.range?Number.MAX_VALUE:g.range,S.parent=q,this._loader._babylonLights.push(S),A.AddPointerMetadata(S,z),b(q)})))))}}x(Bq),D(Bq,!0,(q=>new tq(q)));const fq="KHR_materials_pbrSpecularGlossiness";class mq{constructor(q){this.name=fq,this.order=200,this._loader=q,this.enabled=this._loader.isExtensionUsed(fq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialBasePropertiesAsync(q,S,b)),v.push(this._loadSpecularGlossinessPropertiesAsync(z,C,b)),this._loader.loadMaterialAlphaProperties(q,S,b),await Promise.all(v).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.metallic=null,b.roughness=null,S.diffuseFactor?(b.albedoColor=v.HS.Hb(S.diffuseFactor),b.alpha=S.diffuseFactor[3]):b.albedoColor=v.HS.White(),b.reflectivityColor=S.specularFactor?v.HS.Hb(S.specularFactor):v.HS.White(),b.microSurface=void 0==S.glossinessFactor?1:S.glossinessFactor,S.diffuseTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTexture`,S.diffuseTexture,(q=>{q.name=`${b.name} (Diffuse)`,b.albedoTexture=q}))),S.specularGlossinessTexture&&(z.push(this._loader.loadTextureInfoAsync(`${q}/specularGlossinessTexture`,S.specularGlossinessTexture,(q=>{q.name=`${b.name} (Specular Glossiness)`,b.reflectivityTexture=q,b.reflectivityTexture.Qb=!0}))),b.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(z).then((()=>{}))}}x(fq),D(fq,!0,(q=>new mq(q)));const Eq="KHR_materials_unlit";class eq{constructor(q){this.name=Eq,this.order=210,this._loader=q,this.enabled=this._loader.isExtensionUsed(Eq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async()=>await this._loadUnlitPropertiesAsync(q,S,b)))}_loadUnlitPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;b.unlit=!0;const C=S.pbrMetallicRoughness;return C&&(C.baseColorFactor?(b.albedoColor=v.HS.Hb(C.baseColorFactor),b.alpha=C.baseColorFactor[3]):b.albedoColor=v.HS.White(),C.baseColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/baseColorTexture`,C.baseColorTexture,(q=>{q.name=`${b.name} (Base Color)`,b.albedoTexture=q})))),S.doubleSided&&(b.Tb=!1,b.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(q,S,b),Promise.all(z).then((()=>{}))}}x(Eq),D(Eq,!0,(q=>new eq(q)));const iq="KHR_materials_clearcoat";class Jq{constructor(q){this.name=iq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(iq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadClearCoatPropertiesAsync(z,C,b)),await Promise.all(v)}))}_loadClearCoatPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.clearCoat.isEnabled=!0,b.clearCoat.useRoughnessFromMainTexture=!1,b.clearCoat.remapF0OnInterfaceChange=!1,void 0!=S.clearcoatFactor?b.clearCoat.eb=S.clearcoatFactor:b.clearCoat.eb=0,S.clearcoatTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatTexture`,S.clearcoatTexture,(q=>{q.name=`${b.name} (ClearCoat)`,b.clearCoat.texture=q}))),void 0!=S.clearcoatRoughnessFactor?b.clearCoat.roughness=S.clearcoatRoughnessFactor:b.clearCoat.roughness=0,S.clearcoatRoughnessTexture&&(S.clearcoatRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatRoughnessTexture`,S.clearcoatRoughnessTexture,(q=>{q.name=`${b.name} (ClearCoat Roughness)`,b.clearCoat.textureRoughness=q})))),S.clearcoatNormalTexture&&(S.clearcoatNormalTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${q}/clearcoatNormalTexture`,S.clearcoatNormalTexture,(q=>{q.name=`${b.name} (ClearCoat Normal)`,b.clearCoat.bumpTexture=q}))),b.invertNormalMapX=!b.Tq().useRightHandedSystem,b.invertNormalMapY=b.Tq().useRightHandedSystem,void 0!=S.clearcoatNormalTexture.scale&&(b.clearCoat.bumpTexture.level=S.clearcoatNormalTexture.scale)),Promise.all(z).then((()=>{}))}}x(iq),D(iq,!0,(q=>new Jq(q)));const Lq="KHR_materials_iridescence";class dq{constructor(q){this.name=Lq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Lq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadIridescencePropertiesAsync(z,C,b)),await Promise.all(v).then((()=>{}))}))}_loadIridescencePropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.iridescence.isEnabled=!0,b.iridescence.eb=S.iridescenceFactor??0,b.iridescence.indexOfRefraction=S.iridescenceIor??S.iridescenceIOR??1.3,b.iridescence.minimumThickness=S.iridescenceThicknessMinimum??100,b.iridescence.maximumThickness=S.iridescenceThicknessMaximum??400,S.iridescenceTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceTexture`,S.iridescenceTexture,(q=>{q.name=`${b.name} (Iridescence)`,b.iridescence.texture=q}))),S.iridescenceThicknessTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/iridescenceThicknessTexture`,S.iridescenceThicknessTexture,(q=>{q.name=`${b.name} (Iridescence Thickness)`,b.iridescence.thicknessTexture=q}))),Promise.all(z).then((()=>{}))}}x(Lq),D(Lq,!0,(q=>new dq(q)));const Kq="KHR_materials_anisotropy";class Dq{constructor(q){this.name=Kq,this.order=195,this._loader=q,this.enabled=this._loader.isExtensionUsed(Kq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadIridescencePropertiesAsync(z,C,b)),await Promise.all(v)}))}async _loadIridescencePropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;b.anisotropy.isEnabled=!0,b.anisotropy.eb=S.anisotropyStrength??0,b.anisotropy.angle=S.anisotropyRotation??0,S.anisotropyTexture&&(S.anisotropyTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${q}/anisotropyTexture`,S.anisotropyTexture,(q=>{q.name=`${b.name} (Anisotropy Intensity)`,b.anisotropy.texture=q})))),await Promise.all(z)}}x(Kq),D(Kq,!0,(q=>new Dq(q)));const xq="KHR_materials_emissive_strength";class Fq{constructor(q){this.name=xq,this.order=170,this._loader=q,this.enabled=this._loader.isExtensionUsed(xq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>await this._loader.loadMaterialPropertiesAsync(q,S,b).then((()=>{this._loadEmissiveProperties(z,C,b)}))))}_loadEmissiveProperties(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);void 0!==S.emissiveStrength&&(b.emissiveIntensity=S.emissiveStrength)}}x(xq),D(xq,!0,(q=>new Fq(q)));const aq="KHR_materials_sheen";class nq{constructor(q){this.name=aq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(aq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadSheenPropertiesAsync(z,C,b)),await Promise.all(v).then((()=>{}))}))}_loadSheenPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.sheen.isEnabled=!0,b.sheen.eb=1,void 0!=S.sheenColorFactor?b.sheen.color=v.HS.Hb(S.sheenColorFactor):b.sheen.color=v.HS.Black(),S.sheenColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/sheenColorTexture`,S.sheenColorTexture,(q=>{q.name=`${b.name} (Sheen Color)`,b.sheen.texture=q}))),void 0!==S.sheenRoughnessFactor?b.sheen.roughness=S.sheenRoughnessFactor:b.sheen.roughness=0,S.sheenRoughnessTexture&&(S.sheenRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${q}/sheenRoughnessTexture`,S.sheenRoughnessTexture,(q=>{q.name=`${b.name} (Sheen Roughness)`,b.sheen.textureRoughness=q})))),b.sheen.albedoScaling=!0,b.sheen.useRoughnessFromMainTexture=!1,Promise.all(z).then((()=>{}))}}x(aq),D(aq,!0,(q=>new nq(q)));var oq=b(11575);const sq="KHR_materials_specular";class Aq{constructor(q){this.name=sq,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(sq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;if(v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadSpecularPropertiesAsync(z,C,b)),C.extensions&&C.extensions.EXT_materials_specular_edge_color&&b instanceof W.b){C.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(b.brdf.dielectricSpecularModel=oq.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,b.brdf.conductorSpecularModel=oq.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(v).then((()=>{}))}))}_loadSpecularPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return void 0!==S.specularFactor&&(b.metallicF0Factor=S.specularFactor),void 0!==S.specularColorFactor&&(b.metallicReflectanceColor=v.HS.Hb(S.specularColorFactor)),S.specularTexture&&(S.specularTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${q}/specularTexture`,S.specularTexture,(q=>{q.name=`${b.name} (Specular)`,b.metallicReflectanceTexture=q,b.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),S.specularColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/specularColorTexture`,S.specularColorTexture,(q=>{q.name=`${b.name} (Specular Color)`,b.reflectanceTexture=q}))),Promise.all(z).then((()=>{}))}}x(sq),D(sq,!0,(q=>new Aq(q)));const wq="KHR_materials_ior";class Pq{constructor(q){this.name=wq,this.order=180,this._loader=q,this.enabled=this._loader.isExtensionUsed(wq)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadIorPropertiesAsync(z,C,b)),await Promise.all(v).then((()=>{}))}))}_loadIorPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);return void 0!==S.ior?b.indexOfRefraction=S.ior:b.indexOfRefraction=Pq._DEFAULT_IOR,Promise.resolve()}}Pq._DEFAULT_IOR=1.5,x(wq),D(wq,!0,(q=>new Pq(q)));const hq="KHR_materials_variants";class Oq{constructor(q){this.name=hq,this._loader=q,this.enabled=this._loader.isExtensionUsed(hq)}dispose(){this._loader=null}static GetAvailableVariants(q){const S=this._GetExtensionMetadata(q);return S?Object.keys(S.variants):[]}getAvailableVariants(q){return Oq.GetAvailableVariants(q)}static SelectVariant(q,S){const b=this._GetExtensionMetadata(q);if(!b)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${hq} extension`);const z=q=>{const S=b.variants[q];if(S)for(const b of S)b.mesh.material=b.material};if(S instanceof Array)for(const C of S)z(C);else z(S);b.lastSelected=S}selectVariant(q,S){Oq.SelectVariant(q,S)}static Reset(q){const S=this._GetExtensionMetadata(q);if(!S)throw new Error(`Cannot reset on a glTF mesh that does not have the ${hq} extension`);for(const b of S.original)b.mesh.material=b.material;S.lastSelected=null}reset(q){Oq.Reset(q)}static GetLastSelectedVariant(q){const S=this._GetExtensionMetadata(q);if(!S)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${hq} extension`);return S.lastSelected}getLastSelectedVariant(q){return Oq.GetLastSelectedVariant(q)}static _GetExtensionMetadata(q){var S,b;return(null===q||void 0===q||null===(S=q._internalMetadata)||void 0===S||null===(b=S.lb)||void 0===b?void 0:b[hq])||null}onLoading(){const q=this._loader.lb.extensions;if(q&&q[this.name]){const S=q[this.name];this._variants=S.variants}}onReady(){const q=this._loader.rootBabylonMesh;if(q){var S;const b=this._loader.parent.extensionOptions[hq];null!==b&&void 0!==b&&b.defaultVariant&&Oq.SelectVariant(q,b.defaultVariant),null===b||void 0===b||null===(S=b.onLoaded)||void 0===S||S.call(b,{get variants(){return Oq.GetAvailableVariants(q)},get selectedVariant(){const S=Oq.GetLastSelectedVariant(q);return S?Array.isArray(S)?S[0]:S:Oq.GetAvailableVariants(q)[0]},set selectedVariant(S){Oq.SelectVariant(q,S)}})}}_loadMeshPrimitiveAsync(q,S,b,z,C,v){return A.LoadExtensionAsync(q,C,this.name,(async(U,g)=>{const r=new Array;return r.push(this._loader._loadMeshPrimitiveAsync(q,S,b,z,C,(S=>{if(v(S),S instanceof t.d){const b=A._GetDrawMode(q,C.mode),z=this._loader.rootBabylonMesh,v=z?z._internalMetadata=z._internalMetadata||{}:{},I=v.lb=v.lb||{},V=I[hq]=I[hq]||{lastSelected:null,original:[],variants:{}};V.original.push({mesh:S,material:S.material});for(let q=0;q<g.mappings.length;++q){const C=g.mappings[q],v=o.Get(`${U}/mappings/${q}/material`,this._loader.lb.materials,C.material);r.push(this._loader._loadMaterialAsync(`#/materials/${C.material}`,v,S,b,(q=>{for(let b=0;b<C.variants.length;++b){const v=C.variants[b],U=o.Get(`/extensions/${hq}/variants/${v}`,this._variants,v);V.variants[U.name]=V.variants[U.name]||[],V.variants[U.name].push({mesh:S,material:q}),S.onClonedObservable.add((q=>{const b=q;let C=null,v=b;do{if(v=v.parent,!v)return;C=Oq._GetExtensionMetadata(v)}while(null===C);if(z&&C===Oq._GetExtensionMetadata(z)){v._internalMetadata={};for(const q in z._internalMetadata)v._internalMetadata[q]=z._internalMetadata[q];v._internalMetadata.lb=[];for(const q in z._internalMetadata.lb)v._internalMetadata.lb[q]=z._internalMetadata.lb[q];v._internalMetadata.lb[hq]={lastSelected:null,original:[],variants:{}};for(const q of C.original)v._internalMetadata.lb[hq].original.push({mesh:q.mesh,material:q.material});for(const q in C.variants)if(Object.prototype.hasOwnProperty.call(C.variants,q)){v._internalMetadata.lb[hq].variants[q]=[];for(const S of C.variants[q])v._internalMetadata.lb[hq].variants[q].push({mesh:S.mesh,material:S.material})}C=v._internalMetadata.lb[hq]}for(const z of C.original)z.mesh===S&&(z.mesh=b);for(const z of C.variants[U.name])z.mesh===S&&(z.mesh=b)}))}})))}}}))),await Promise.all(r).then((q=>{let[S]=q;return S}))}))}}x(hq),D(hq,!0,(q=>new Oq(q)));var jq=b(11162);class Mq{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:oq.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(q,S){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Mq._GetDefaultOptions(),...q},this._scene=S,this._scene._transmissionHelper=this,this.onErrorObservable=new V.d,this._scene.gb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(q){if(!Object.keys(q).filter((S=>this._options[S]!==q[S])).length)return;const S={...this._options,...q},b=this._options;this._options=S,S.renderSize===b.renderSize&&S.renderTargetTextureType===b.renderTargetTextureType&&S.generateMipmaps===b.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=S.samples,this._opaqueRenderTarget.lodGenerationScale=S.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=S.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(q){return!!q&&!!(q instanceof W.b&&q.subSurface.isRefractionEnabled)}_addMesh(q){this._materialObservers[q.uniqueId]=q.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),U.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(q.material)?(q.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(q)&&this._transparentMeshesCache.push(q)):-1===this._opaqueMeshesCache.indexOf(q)&&this._opaqueMeshesCache.push(q)}))}_removeMesh(q){q.onMaterialChangedObservable.remove(this._materialObservers[q.uniqueId]),delete this._materialObservers[q.uniqueId];let S=this._transparentMeshesCache.indexOf(q);-1!==S&&this._transparentMeshesCache.splice(S,1),S=this._opaqueMeshesCache.indexOf(q),-1!==S&&this._opaqueMeshesCache.splice(S,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(q){const S=this._transparentMeshesCache.indexOf(q),b=this._opaqueMeshesCache.indexOf(q);this._shouldRenderAsTransmission(q.material)?(q.material instanceof W.b&&(q.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==b?(this._opaqueMeshesCache.splice(b,1),this._transparentMeshesCache.push(q)):-1===S&&this._transparentMeshesCache.push(q)):-1!==S?(this._transparentMeshesCache.splice(S,1),this._opaqueMeshesCache.push(q)):-1===b&&this._opaqueMeshesCache.push(q)}_isRenderTargetValid(){var q;return null!==(null===(q=this._opaqueRenderTarget)||void 0===q?void 0:q.getInternalTexture())}_setupRenderTargets(){var q;let S;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new jq.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(q=this._options.clearColor)||void 0===q?void 0:q.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((q=>{S=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?q.clearColor.v(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(q.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=S}));for(const b of this._transparentMeshesCache)this._shouldRenderAsTransmission(b.material)&&(b.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pq="KHR_materials_transmission";class Yq{constructor(q){this.name=pq,this.order=175,this._loader=q,this.enabled=this._loader.isExtensionUsed(pq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadTransparentPropertiesAsync(z,S,b,C)),await Promise.all(v).then((()=>{}))}))}_loadTransparentPropertiesAsync(q,S,b,z){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const C=b;if(C.subSurface.isRefractionEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.useAlbedoToTintRefraction=!0,void 0===z.transmissionFactor)return C.subSurface.refractionIntensity=0,C.subSurface.isRefractionEnabled=!1,Promise.resolve();{var v;C.subSurface.refractionIntensity=z.transmissionFactor;const q=C.Tq();if(C.subSurface.refractionIntensity&&!q._transmissionHelper)new Mq({},C.Tq());else if(C.subSurface.refractionIntensity&&(null===(v=q._transmissionHelper)||void 0===v||!v._isRenderTargetValid())){var U;null===(U=q._transmissionHelper)||void 0===U||U._setupRenderTargets()}}return C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,z.transmissionTexture?(z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/transmissionTexture`,z.transmissionTexture,void 0).then((q=>{q.name=`${b.name} (Transmission)`,C.subSurface.refractionIntensityTexture=q,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(pq),D(pq,!0,(q=>new Yq(q)));const cq="KHR_materials_diffuse_transmission";class qS{constructor(q){this.name=cq,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(cq),this.enabled&&(q.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadTranslucentPropertiesAsync(z,S,b,C)),await Promise.all(v).then((()=>{}))}))}_loadTranslucentPropertiesAsync(q,S,b,z){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const C=b;if(C.subSurface.isTranslucencyEnabled=!0,C.subSurface.volumeIndexOfRefraction=1,C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=0,C.subSurface.useAlbedoToTintTranslucency=!1,void 0===z.diffuseTransmissionFactor)return C.subSurface.translucencyIntensity=0,C.subSurface.isTranslucencyEnabled=!1,Promise.resolve();C.subSurface.translucencyIntensity=z.diffuseTransmissionFactor;const U=new Array;return C.subSurface.useGltfStyleTextures=!0,z.diffuseTransmissionTexture&&(z.diffuseTransmissionTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionTexture`,z.diffuseTransmissionTexture).then((q=>{q.name=`${b.name} (Diffuse Transmission)`,C.subSurface.translucencyIntensityTexture=q})))),void 0!==z.diffuseTransmissionColorFactor?C.subSurface.translucencyColor=v.HS.Hb(z.diffuseTransmissionColorFactor):C.subSurface.translucencyColor=v.HS.White(),z.diffuseTransmissionColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${q}/diffuseTransmissionColorTexture`,z.diffuseTransmissionColorTexture).then((q=>{q.name=`${b.name} (Diffuse Transmission Color)`,C.subSurface.translucencyColorTexture=q}))),Promise.all(U).then((()=>{}))}}x(cq),D(cq,!0,(q=>new qS(q)));const SS="KHR_materials_volume";class bS{constructor(q){this.name=SS,this.order=173,this._loader=q,this.enabled=this._loader.isExtensionUsed(SS),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadVolumePropertiesAsync(z,S,b,C)),await Promise.all(v).then((()=>{}))}))}_loadVolumePropertiesAsync(q,S,b,z){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);if(!b.subSurface.isRefractionEnabled&&!b.subSurface.isTranslucencyEnabled||!z.thicknessFactor)return Promise.resolve();b.subSurface.volumeIndexOfRefraction=b.indexOfRefraction;const C=void 0!==z.attenuationDistance?z.attenuationDistance:Number.MAX_VALUE;return b.subSurface.tintColorAtDistance=C,void 0!==z.attenuationColor&&3==z.attenuationColor.length&&b.subSurface.tintColor.Bb(z.attenuationColor[0],z.attenuationColor[1],z.attenuationColor[2]),b.subSurface.minimumThickness=0,b.subSurface.maximumThickness=z.thicknessFactor,b.subSurface.useThicknessAsDepth=!0,z.thicknessTexture?(z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${q}/thicknessTexture`,z.thicknessTexture).then((q=>{q.name=`${b.name} (Thickness)`,b.subSurface.thicknessTexture=q,b.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(SS),D(SS,!0,(q=>new bS(q)));const zS="KHR_materials_dispersion";class CS{constructor(q){this.name=zS,this.order=174,this._loader=q,this.enabled=this._loader.isExtensionUsed(zS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadDispersionPropertiesAsync(z,S,b,C)),await Promise.all(v).then((()=>{}))}))}_loadDispersionPropertiesAsync(q,S,b,z){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);return b.subSurface.isRefractionEnabled&&z.dispersion?(b.subSurface.isDispersionEnabled=!0,b.subSurface.dispersion=z.dispersion,Promise.resolve()):Promise.resolve()}}x(zS),D(zS,!0,(q=>new CS(q)));const vS="EXT_materials_diffuse_roughness";class US{constructor(q){this.name=vS,this.order=190,this._loader=q,this.enabled=this._loader.isExtensionUsed(vS)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=new Array;return v.push(this._loader.loadMaterialPropertiesAsync(q,S,b)),v.push(this._loadDiffuseRoughnessPropertiesAsync(z,C,b)),await Promise.all(v).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(q,S,b){if(!(b instanceof W.b))throw new Error(`${q}: Material type not supported`);const z=new Array;return b.brdf.baseDiffuseModel=oq.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=S.diffuseRoughnessFactor?b.baseDiffuseRoughness=S.diffuseRoughnessFactor:b.baseDiffuseRoughness=0,S.diffuseRoughnessTexture&&z.push(this._loader.loadTextureInfoAsync(`${q}/diffuseRoughnessTexture`,S.diffuseRoughnessTexture,(q=>{q.name=`${b.name} (Diffuse Roughness)`,b.baseDiffuseRoughnessTexture=q}))),Promise.all(z).then((()=>{}))}}x(vS),D(vS,!0,(q=>new US(q)));const gS="KHR_mesh_quantization";class rS{constructor(q){this.name=gS,this.enabled=q.isExtensionUsed(gS)}dispose(){}}x(gS),D(gS,!0,(q=>new rS(q)));const IS="KHR_texture_basisu";class VS{constructor(q){this.name=IS,this._loader=q,this.enabled=q.isExtensionUsed(IS)}dispose(){this._loader=null}_loadTextureAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>{const v=void 0==S.sampler?A.DefaultSampler:o.Get(`${q}/sampler`,this._loader.lb.samplers,S.sampler),U=o.Get(`${z}/source`,this._loader.lb.images,C.source);return await this._loader._createTextureAsync(q,v,U,(q=>{b(q)}),S._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!S._textureInfo.nonColorData)}))}}x(IS),D(IS,!0,(q=>new VS(q)));const lS="KHR_texture_transform";class yS{constructor(q){this.name=lS,this._loader=q,this.enabled=this._loader.isExtensionUsed(lS)}dispose(){this._loader=null}loadTextureInfoAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(z,C)=>await this._loader.loadTextureInfoAsync(q,S,(q=>{if(!(q instanceof N.e))throw new Error(`${z}: Texture type not supported`);C.offset&&(q.uOffset=C.offset[0],q.vOffset=C.offset[1]),q.uRotationCenter=0,q.vRotationCenter=0,C.rotation&&(q.wAng=-C.rotation),C.scale&&(q.uScale=C.scale[0],q.vScale=C.scale[1]),void 0!=C.texCoord&&(q.coordinatesIndex=C.texCoord),b(q)}))))}}x(lS),D(lS,!0,(q=>new yS(q)));const RS="KHR_xmp_json_ld";class GS{constructor(q){this.name=RS,this.order=100,this._loader=q,this.enabled=this._loader.isExtensionUsed(RS)}dispose(){this._loader=null}onLoading(){var q,S,b;if(null===this._loader.rootBabylonMesh)return;const z=null===(q=this._loader.lb.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld,C=null===(S=this._loader.lb.asset)||void 0===S||null===(b=S.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld;if(z&&C){const q=+C.packet;z.packets&&q<z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=z.packets[q])}}}function ZS(q,S,b,z){return v.HS.Hb(S,b).scale(z)}function HS(q,S,b,z){return S[b]*z}function QS(q,S,b,z){return-S[b]*z}function kS(q,S,b,z){return S[b+1]*z}function WS(q,S,b,z){return S[b]*z*2}function NS(q){return{scale:[new XS(y.d.ANIMATIONTYPE_FLOAT,`${q}.uScale`,HS,(()=>2)),new XS(y.d.ANIMATIONTYPE_FLOAT,`${q}.vScale`,kS,(()=>2))],offset:[new XS(y.d.ANIMATIONTYPE_FLOAT,`${q}.uOffset`,HS,(()=>2)),new XS(y.d.ANIMATIONTYPE_FLOAT,`${q}.vOffset`,kS,(()=>2))],rotation:[new XS(y.d.ANIMATIONTYPE_FLOAT,`${q}.wAng`,QS,(()=>1))]}}x(RS),D(RS,!0,(q=>new GS(q)));class uS extends w.AnimationPropertyInfo{buildAnimations(q,S,b,z){return[{babylonAnimatable:q._babylonCamera,babylonAnimation:this._buildAnimation(S,b,z)}]}}class XS extends w.AnimationPropertyInfo{buildAnimations(q,S,b,z){const C=[];for(const v in q._data)C.push({babylonAnimatable:q._data[v].babylonMaterial,babylonAnimation:this._buildAnimation(S,b,z)});return C}}class TS extends w.AnimationPropertyInfo{buildAnimations(q,S,b,z){return[{babylonAnimatable:q._babylonLight,babylonAnimation:this._buildAnimation(S,b,z)}]}}(0,F.i)("/cameras/{}/orthographic/xmag",[new uS(y.d.ANIMATIONTYPE_FLOAT,"orthoLeft",QS,(()=>1)),new uS(y.d.ANIMATIONTYPE_FLOAT,"orthoRight",kS,(()=>1))]),(0,F.i)("/cameras/{}/orthographic/ymag",[new uS(y.d.ANIMATIONTYPE_FLOAT,"orthoBottom",QS,(()=>1)),new uS(y.d.ANIMATIONTYPE_FLOAT,"orthoTop",kS,(()=>1))]),(0,F.i)("/cameras/{}/orthographic/zfar",[new uS(y.d.ANIMATIONTYPE_FLOAT,"maxZ",HS,(()=>1))]),(0,F.i)("/cameras/{}/orthographic/znear",[new uS(y.d.ANIMATIONTYPE_FLOAT,"kb",HS,(()=>1))]),(0,F.i)("/cameras/{}/perspective/yfov",[new uS(y.d.ANIMATIONTYPE_FLOAT,"fov",HS,(()=>1))]),(0,F.i)("/cameras/{}/perspective/zfar",[new uS(y.d.ANIMATIONTYPE_FLOAT,"maxZ",HS,(()=>1))]),(0,F.i)("/cameras/{}/perspective/znear",[new uS(y.d.ANIMATIONTYPE_FLOAT,"kb",HS,(()=>1))]),(0,F.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"albedoColor",ZS,(()=>4)),new XS(y.d.ANIMATIONTYPE_FLOAT,"alpha",(function(q,S,b,z){return S[b+3]*z}),(()=>4))]),(0,F.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"metallic",HS,(()=>1))]),(0,F.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"roughness",HS,(()=>1))]);const BS=NS("albedoTexture");(0,F.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",BS.scale),(0,F.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",BS.offset),(0,F.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",BS.rotation);const tS=NS("metallicTexture");(0,F.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",tS.scale),(0,F.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",tS.offset),(0,F.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",tS.rotation),(0,F.i)("/materials/{}/emissiveFactor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"emissiveColor",ZS,(()=>3))]);const fS=NS("bumpTexture");(0,F.i)("/materials/{}/normalTexture/scale",[new XS(y.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",HS,(()=>1))]),(0,F.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",fS.scale),(0,F.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",fS.offset),(0,F.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",fS.rotation),(0,F.i)("/materials/{}/occlusionTexture/strength",[new XS(y.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",HS,(()=>1))]);const mS=NS("ambientTexture");(0,F.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",mS.scale),(0,F.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",mS.offset),(0,F.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",mS.rotation);const ES=NS("emissiveTexture");(0,F.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ES.scale),(0,F.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ES.offset),(0,F.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ES.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new XS(y.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new XS(y.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",HS,(()=>1))]);const eS=NS("anisotropy.texture");(0,F.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",eS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",eS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",eS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",HS,(()=>1))]);const iS=NS("clearCoat.texture");(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",iS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",iS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",iS.rotation);const JS=NS("clearCoat.bumpTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new XS(y.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",JS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",JS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",JS.rotation);const LS=NS("clearCoat.textureRoughness");(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",LS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",LS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",LS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new XS(y.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new XS(y.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new XS(y.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new XS(y.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",HS,(()=>1))]);const dS=NS("iridescence.texture");(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",dS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",dS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",dS.rotation);const KS=NS("iridescence.thicknessTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",KS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",KS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",KS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"sheen.color",ZS,(()=>3))]),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",HS,(()=>1))]);const DS=NS("sheen.texture");(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",DS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",DS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",DS.rotation);const xS=NS("sheen.textureRoughness");(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",xS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",xS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",xS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ZS,(()=>3))]);const FS=NS("metallicReflectanceTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",FS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",FS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",FS.rotation);const aS=NS("reflectanceTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",aS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",aS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",aS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",HS,(()=>1))]);const nS=NS("subSurface.refractionIntensityTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",nS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",nS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",nS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ZS,(()=>3))]),(0,F.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new XS(y.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",HS,(()=>1))]),(0,F.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",HS,(()=>1))]);const oS=NS("subSurface.thicknessTexture");(0,F.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",oS.scale),(0,F.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",oS.offset),(0,F.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",oS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new XS(y.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",HS,(()=>1))]);const sS=NS("subSurface.translucencyIntensityTexture");(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",sS.scale),(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",sS.offset),(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",sS.rotation),(0,F.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new XS(y.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ZS,(()=>3))]);const AS=NS("subSurface.translucencyColorTexture");(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",AS.scale),(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",AS.offset),(0,F.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",AS.rotation),(0,F.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new TS(y.d.ANIMATIONTYPE_COLOR3,"diffuse",ZS,(()=>3))]),(0,F.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new TS(y.d.ANIMATIONTYPE_FLOAT,"intensity",HS,(()=>1))]),(0,F.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new TS(y.d.ANIMATIONTYPE_FLOAT,"range",HS,(()=>1))]),(0,F.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new TS(y.d.ANIMATIONTYPE_FLOAT,"innerAngle",WS,(()=>1))]),(0,F.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new TS(y.d.ANIMATIONTYPE_FLOAT,"angle",WS,(()=>1))]),(0,F.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new TS(y.d.ANIMATIONTYPE_COLOR3,"diffuse",ZS,(()=>3))]),(0,F.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new TS(y.d.ANIMATIONTYPE_FLOAT,"intensity",HS,(()=>1))]);const wS="KHR_animation_pointer";class PS{constructor(q){this.name=wS,this._loader=q,this._pathToObjectConverter=(0,F.g)(this._loader.lb)}get enabled(){return this._loader.isExtensionUsed(wS)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(q,S,b,z,C){var v;const U=null===(v=z.target.extensions)||void 0===v?void 0:v.KHR_animation_pointer;if(!U||!this._pathToObjectConverter)return null;"pointer"!==z.target.path&&Z.b.Warn(`${q}/target/path: Value (${z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=z.target.node&&Z.b.Warn(`${q}/target/node: Value (${z.target.node}) must not be present when using the ${this.name} extension`);const g=`${q}/extensions/${this.name}`,r=U.pointer;if(!r)throw new Error(`${g}: Pointer is missing`);try{const v=this._pathToObjectConverter.convert(r);if(!v.info.interpolation)throw new Error(`${g}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(q,S,b,z,{object:v.object,info:v.info.interpolation},C)}catch(I){return Z.b.Warn(`${g}/pointer: Invalid pointer (${r}) skipped`),null}}}x(wS),D(wS,!0,(q=>new PS(q)));class hS{constructor(q,S,b){this.frame=q,this.action=S,this.onlyOnce=b,this.isDone=!1}_clone(){return new hS(this.frame,this.action,this.onlyOnce)}}var OS=b(10964),jS=b(11006),MS=b(11e3);class pS{get loop(){return this._loop}set loop(q){q!==this._loop&&(this._loop=q,this.updateOptions({loop:q}))}get currentTime(){var q;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(q=jS.c.audioEngine)&&void 0!==q&&q.audioContext&&(this.isPlaying||this.isPaused)){const q=this.isPaused?0:jS.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+q}return 0}get spatialSound(){return this._spatialSound}set spatialSound(q){if(q==this._spatialSound)return;const S=this.isPlaying;this.pause(),q?(this._spatialSound=q,this._updateSpatialParameters()):this._disableSpatialSound(),S&&this.play()}constructor(q,S,b){var z;let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new V.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=C.yS.Zero(),this._localDirection=new C.yS(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=q,b=b||G.b.LastCreatedScene)if(this._scene=b,pS._SceneComponentInitialization(b),this._readyToPlayCallback=v,this._customAttenuationFunction=(q,S,b,z,C)=>S<b?q*(1-S/b):0,g&&(this.autoplay=g.autoplay||!1,this._loop=g.loop||!1,void 0!==g.volume&&(this._volume=g.volume),this._spatialSound=g.spatialSound??!1,this.maxDistance=g.maxDistance??100,this.useCustomAttenuation=g.useCustomAttenuation??!1,this.rolloffFactor=g.rolloffFactor||1,this.refDistance=g.refDistance||1,this.distanceModel=g.distanceModel||"linear",this._playbackRate=g.playbackRate||1,this._streaming=g.streaming??!1,this._length=g.length,this._offset=g.offset),null!==(z=jS.c.audioEngine)&&void 0!==z&&z.canUseWebAudio&&jS.c.audioEngine.audioContext){this._soundGain=jS.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let q=!0;if(S)try{"string"===typeof S?(this._urlType="String",this._url=S):S instanceof ArrayBuffer?this._urlType="ArrayBuffer":S instanceof HTMLMediaElement?this._urlType="MediaElement":S instanceof MediaStream?this._urlType="MediaStream":S instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(S)&&(this._urlType="Array");let b=[],z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=jS.c.audioEngine.audioContext.createMediaElementSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=jS.c.audioEngine.audioContext.createMediaStreamSource(S),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":S.byteLength>0&&(z=!0,this._soundLoaded(S));break;case"AudioBuffer":this._audioBufferLoaded(S);break;case"String":b.push(S);case"Array":0===b.length&&(b=S);for(let q=0;q<b.length;q++){const S=b[q];if(z=g&&g.skipCodecCheck||-1!==S.indexOf(".mp3",S.length-4)&&jS.c.audioEngine.isMP3supported||-1!==S.indexOf(".ogg",S.length-4)&&jS.c.audioEngine.isOGGsupported||-1!==S.indexOf(".wav",S.length-4)||-1!==S.indexOf(".m4a",S.length-4)||-1!==S.indexOf(".mp4",S.length-4)||-1!==S.indexOf("blob:"),z){this._streaming?(this._htmlAudioElement=new Audio(S),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,U.Tools.SetCorsBehavior(S,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(S,(q=>{this._soundLoaded(q)}),void 0,!0,!0,(q=>{q&&Z.b.Error("XHR "+q.status+" error on: "+S+"."),Z.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:q=!1}q?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Z.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(r){Z.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),jS.c.audioEngine&&!jS.c.audioEngine.WarnedWebAudioUnsupported&&(Z.b.Error("Web Audio is not supported by your browser."),jS.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var q;null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(q){var S;null!==(S=jS.c.audioEngine)&&void 0!==S&&S.audioContext&&(this._audioBuffer=q,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(q){var S;null!==(S=jS.c.audioEngine)&&void 0!==S&&S.audioContext&&jS.c.audioEngine.audioContext.decodeAudioData(q,(q=>{this._audioBufferLoaded(q)}),(q=>{Z.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+q)}))}setAudioBuffer(q){var S;null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&(this._audioBuffer=q,this._isReadyToPlay=!0)}updateOptions(q){q&&(this.loop=q.loop??this.loop,this.maxDistance=q.maxDistance??this.maxDistance,this.useCustomAttenuation=q.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=q.rolloffFactor??this.rolloffFactor,this.refDistance=q.refDistance??this.refDistance,this.distanceModel=q.distanceModel??this.distanceModel,this._playbackRate=q.playbackRate??this._playbackRate,this._length=q.length??void 0,this.spatialSound=q.spatialSound??this._spatialSound,this._setOffset(q.offset??void 0),this.setVolume(q.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var q;null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&jS.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??jS.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var q;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(q=this._soundPanner)||void 0===q||q.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var q;null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(q){var S;null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(q),this._isOutputConnected=!0)}setDirectionalCone(q,S,b){S<q?Z.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=q,this._coneOuterAngle=S,this._coneOuterGain=b,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!=this._coneInnerAngle){var S;if(this._coneOuterAngle<q)return void Z.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q,null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!=this._coneOuterAngle){var S;if(q<this._coneInnerAngle)return void Z.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q,null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(q){var S;q.equals(this._position)||(this._position.v(q),null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(q){var S;this._localDirection=q,null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const q=this._connectedTransformNode.getWorldMatrix(),S=C.yS.TransformNormal(this._localDirection,q);S.normalize(),this._soundPanner.orientationX.value=S.x,this._soundPanner.orientationY.value=S.y,this._soundPanner.orientationZ.value=S.z}updateDistanceFromListener(){var q;if(null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const q=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.RS(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,q,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(q){this._customAttenuationFunction=q}play(q,S,b){var z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(z=jS.c.audioEngine)&&void 0!==z&&z.audioContext)try{var C,v;this._clearTimeoutsAndObservers();let z=q?(null===(C=jS.c.audioEngine)||void 0===C?void 0:C.audioContext.currentTime)+q:null===(v=jS.c.audioEngine)||void 0===v?void 0:v.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=jS.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const q=()=>{var b;if(null!==(b=jS.c.audioEngine)&&void 0!==b&&b.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=S??0;const b=this._htmlAudioElement.play();void 0!==b&&b.catch((()=>{var S,b;(null===(S=jS.c.audioEngine)||void 0===S||S.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(b=jS.c.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{q()})))}))}else{var z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(z=jS.c.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{q()}))}};q()}}else{var U;const C=()=>{var C;if(null!==(C=jS.c.audioEngine)&&void 0!==C&&C.audioContext){var v;if(b=b||this._length,void 0!==S&&this._setOffset(S),this._soundSource){const q=this._soundSource;q.onended=()=>{q.disconnect()}}if(this._soundSource=null===(v=jS.c.audioEngine)||void 0===v?void 0:v.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var U;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==S&&(this._soundSource.loopStart=S),void 0!==b&&(this._soundSource.loopEnd=(0|S)+b),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},z=q?(null===(U=jS.c.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+q:jS.c.audioEngine.audioContext.currentTime;const C=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(z,C,this.loop?void 0:b)}}};"suspended"===(null===(U=jS.c.audioEngine)||void 0===U?void 0:U.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var q;"suspended"===(null===(q=jS.c.audioEngine)||void 0===q?void 0:q.audioContext.state)?(jS.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=jS.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{C()})))):C()}),500):C()}this._startTime=z,this.isPlaying=!0,this.isPaused=!1}catch(g){Z.b.Error("Error while trying to play audio: "+this.name+", "+g.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(q){var S;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1}else if(null!==(S=jS.c.audioEngine)&&void 0!==S&&S.audioContext&&this._soundSource){const S=q?jS.c.audioEngine.audioContext.currentTime+q:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(S)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var S;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(S=this._streamingSource)||void 0===S||S.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(q=jS.c.audioEngine)&&void 0!==q&&q.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=jS.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(q,S){var b;null!==(b=jS.c.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._soundGain&&(S&&jS.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(jS.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,jS.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(q,jS.c.audioEngine.audioContext.currentTime+S)):this._soundGain.gain.value=q),this._volume=q}setPlaybackRate(q){this._playbackRate=q,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(q){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=q,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=q=>this._onRegisterAfterWorldMatrixUpdate(q),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(q){var S;if(q.getBoundingInfo){const S=q.getBoundingInfo();this.setPosition(S.boundingSphere.centerWorld)}else this.setPosition(q.absolutePosition);null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const q=()=>{(0,MS.f)((()=>this._isReadyToPlay),(()=>{b._audioBuffer=this.getAudioBuffer(),b._isReadyToPlay=!0,b.autoplay&&b.play(0,this._offset,this._length)}),void 0,300)},S={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},b=new pS(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,S);return this.useCustomAttenuation&&b.setAttenuationFunction(this._customAttenuationFunction),b.setPosition(this._position),b.setPlaybackRate(this._playbackRate),q(),b}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const q={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(q.connectedMeshId=this._connectedTransformNode.id),q.position=this._position.Zb(),q.refDistance=this.refDistance,q.distanceModel=this.distanceModel,q.isDirectional=this._isDirectional,q.localDirectionToMesh=this._localDirection.Zb(),q.coneInnerAngle=this._coneInnerAngle,q.coneOuterAngle=this._coneOuterAngle,q.coneOuterGain=this._coneOuterGain),q}static Parse(q,S,b,z){const v=q.name;let U;U=q.url?b+q.url:b+v;const g={autoplay:q.autoplay,loop:q.loop,volume:q.volume,spatialSound:q.spatialSound,maxDistance:q.maxDistance,rolloffFactor:q.rolloffFactor,refDistance:q.refDistance,distanceModel:q.distanceModel,playbackRate:q.playbackRate};let r;if(z){const q=()=>{(0,MS.f)((()=>z._isReadyToPlay),(()=>{r._audioBuffer=z.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play(0,r._offset,r._length)}),void 0,300)};r=new pS(v,new ArrayBuffer(0),S,null,g),q()}else r=new pS(v,U,S,(()=>{S.removePendingData(r)}),g),S.addPendingData(r);if(q.position){const S=C.yS.Hb(q.position);r.setPosition(S)}if(q.isDirectional&&(r.setDirectionalCone(q.coneInnerAngle||360,q.coneOuterAngle||360,q.coneOuterGain||0),q.localDirectionToMesh)){const S=C.yS.Hb(q.localDirectionToMesh);r.setLocalDirectionToMesh(S)}if(q.connectedMeshId){const b=S.getMeshById(q.connectedMeshId);b&&r.attachToMesh(b)}return q.metadata&&(r.metadata=q.metadata),r}_setOffset(q){this._offset!==q&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=q)}_clearTimeoutsAndObservers(){var q;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(q=jS.c.audioEngine)||void 0===q||q.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}pS._SceneComponentInitialization=q=>{throw(0,OS.c)("AudioSceneComponent")},(0,Xq.f)("BABYLON.Sound",pS);class YS{constructor(q,S,b){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],S.length!==b.length)throw new Error("Sounds length does not equal weights length");this.loop=q,this._weights=b;let z=0;for(const v of b)z+=v;const C=z>0?1/z:0;for(let v=0;v<this._weights.length;v++)this._weights[v]*=C;this._sounds=S;for(const v of this._sounds)v.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(q){if(q!==this._coneInnerAngle){if(this._coneOuterAngle<q)return void Z.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=q;for(const S of this._sounds)S.directionalConeInnerAngle=q}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(q){if(q!==this._coneOuterAngle){if(q<this._coneInnerAngle)return void Z.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=q;for(const S of this._sounds)S.directionalConeOuterAngle=q}}get volume(){return this._volume}set volume(q){if(q!==this._volume)for(const S of this._sounds)S.setVolume(q)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(q){if(!this.isPaused){this.stop();const q=Math.random();let S=0;for(let b=0;b<this._weights.length;b++)if(S+=this._weights[b],q<=S){this._currentIndex=b;break}}const S=this._sounds[this._currentIndex??0];S.isReady()?S.play(0,this.isPaused?void 0:q):S.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class cS{constructor(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(q=q||G.b.LastCreatedScene)&&(this._scene=q,this.soundCollection=[],this._options=S,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var q;null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio&&jS.c.audioEngine.audioContext&&(this._outputAudioNode=jS.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(jS.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(jS.c.audioEngine&&jS.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(q){var S;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&q.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==q.soundTrackId&&(-1===q.soundTrackId?this._scene.mainSoundTrack.removeSound(q):this._scene.soundTracks&&this._scene.soundTracks[q.soundTrackId].removeSound(q)),this.soundCollection.push(q),q.soundTrackId=this.id}removeSound(q){const S=this.soundCollection.indexOf(q);-1!==S&&this.soundCollection.splice(S,1)}setVolume(q){var S;null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=q)}switchPanningModelToHRTF(){var q;if(null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var q;if(null!==(q=jS.c.audioEngine)&&void 0!==q&&q.canUseWebAudio)for(let S=0;S<this.soundCollection.length;S++)this.soundCollection[S].switchPanningModelToEqualPower()}connectToAnalyser(q){var S;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=q,null!==(S=jS.c.audioEngine)&&void 0!==S&&S.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,jS.c.audioEngine.masterGain))}}var qb=b(11379),Sb=b(11339),bb=b(10934);jS.c.AudioEngineFactory=(q,S,b)=>new zb(q,S,b);class zb{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new V.d,this.onAudioLockedObservable=new V.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,bb.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const z=document.createElement("audio");this._hostElement=q,this._audioContext=S,this._audioDestination=b;try{z&&z.canPlayType&&(z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(C){}try{z&&z.canPlayType&&z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(C){}}lock(){this._triggerSuspendedState()}unlock(){var q,S;if("running"===(null===(q=this._audioContext)||void 0===q?void 0:q.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(S=this._audioContext)||void 0===S||S.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{Z.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var q;null===(q=this._audioContext)||void 0===q||q.addEventListener("statechange",(()=>{var q;this.unlocked&&"running"!==(null===(q=this._audioContext)||void 0===q?void 0:q.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var q;return null!==(q=this._audioContext)&&void 0!==q&&q.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(q){this.canUseWebAudio=!1,Z.b.Error("Web Audio: "+q.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(q){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const q=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",S=document.createElement("style");S.appendChild(document.createTextNode(q)),document.getElementsByTagName("head")[0].appendChild(S),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var q;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(q=this._audioContext)||void 0===q||q.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(q){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=q)}connectToAnalyser(q){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=q,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Cb=b(10957);(0,b(12489).d)(qb.c.NAME_AUDIO,((q,S,b,z)=>{let C,v=[];if(b.SR=b.SR||[],void 0!==q.SR&&null!==q.SR)for(let g=0,r=q.SR.length;g<r;g++){var U;const r=q.SR[g];null!==(U=jS.c.audioEngine)&&void 0!==U&&U.canUseWebAudio?(r.url||(r.url=r.name),v[r.url]?b.SR.push(pS.Parse(r,S,z,v[r.url])):(C=pS.Parse(r,S,z),v[r.url]=C,b.SR.push(C))):b.SR.push(new pS(r.name,null,S))}v=[]})),Object.defineProperty(Sb.c.prototype,"mainSoundTrack",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),this._mainSoundTrack||(this._mainSoundTrack=new cS(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Sb.c.prototype.getSoundByName=function(q){let S;for(S=0;S<this.mainSoundTrack.soundCollection.length;S++)if(this.mainSoundTrack.soundCollection[S].name===q)return this.mainSoundTrack.soundCollection[S];if(this.soundTracks)for(let b=0;b<this.soundTracks.length;b++)for(S=0;S<this.soundTracks[b].soundCollection.length;S++)if(this.soundTracks[b].soundCollection[S].name===q)return this.soundTracks[b].soundCollection[S];return null},Object.defineProperty(Sb.c.prototype,"audioEnabled",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),q.audioEnabled},set:function(q){let S=this._getComponent(qb.c.NAME_AUDIO);S||(S=new vb(this),this.o(S)),q?S.enableAudio():S.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Sb.c.prototype,"headphone",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),q.headphone},set:function(q){let S=this._getComponent(qb.c.NAME_AUDIO);S||(S=new vb(this),this.o(S)),q?S.switchAudioModeForHeadphones():S.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Sb.c.prototype,"audioListenerPositionProvider",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),q.audioListenerPositionProvider},set:function(q){let S=this._getComponent(qb.c.NAME_AUDIO);if(S||(S=new vb(this),this.o(S)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");S.audioListenerPositionProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(Sb.c.prototype,"audioListenerRotationProvider",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),q.audioListenerRotationProvider},set:function(q){let S=this._getComponent(qb.c.NAME_AUDIO);if(S||(S=new vb(this),this.o(S)),q&&"function"!==typeof q)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");S.audioListenerRotationProvider=q},enumerable:!0,configurable:!0}),Object.defineProperty(Sb.c.prototype,"audioPositioningRefreshRate",{get:function(){let q=this._getComponent(qb.c.NAME_AUDIO);return q||(q=new vb(this),this.o(q)),q.audioPositioningRefreshRate},set:function(q){let S=this._getComponent(qb.c.NAME_AUDIO);S||(S=new vb(this),this.o(S)),S.audioPositioningRefreshRate=q},enumerable:!0,configurable:!0});class vb{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(q){this.name=qb.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new C.yS,this._cachedCameraPosition=new C.yS,this._lastCheck=0,this._invertMatrixTemp=new C.Matrix,this._cameraDirectionTemp=new C.yS,(q=q||G.b.LastCreatedScene)&&(this.GS=q,q.soundTracks=[],q.SR=[])}register(){this.GS._afterRenderStage.registerStep(qb.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(q){if(q.SR=[],this.GS.soundTracks)for(let S=0;S<this.GS.soundTracks.length;S++){const b=this.GS.soundTracks[S];for(let S=0;S<b.soundCollection.length;S++)q.SR.push(b.soundCollection[S].serialize())}}addFromContainer(q){if(q.SR)for(const S of q.SR)S.play(),S.autoplay=!0,this.GS.mainSoundTrack.addSound(S)}removeFromContainer(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q.SR)for(const b of q.SR)b.stop(),b.autoplay=!1,this.GS.mainSoundTrack.removeSound(b),S&&b.dispose()}dispose(){const q=this.GS;if(q._mainSoundTrack&&q.mainSoundTrack.dispose(),q.soundTracks)for(let S=0;S<q.soundTracks.length;S++)q.soundTracks[S].dispose()}disableAudio(){const q=this.GS;let S;for(this._audioEnabled=!1,jS.c.audioEngine&&jS.c.audioEngine.audioContext&&jS.c.audioEngine.audioContext.suspend(),S=0;S<q.mainSoundTrack.soundCollection.length;S++)q.mainSoundTrack.soundCollection[S].pause();if(q.soundTracks)for(S=0;S<q.soundTracks.length;S++)for(let b=0;b<q.soundTracks[S].soundCollection.length;b++)q.soundTracks[S].soundCollection[b].pause()}enableAudio(){const q=this.GS;let S;for(this._audioEnabled=!0,jS.c.audioEngine&&jS.c.audioEngine.audioContext&&jS.c.audioEngine.audioContext.resume(),S=0;S<q.mainSoundTrack.soundCollection.length;S++)q.mainSoundTrack.soundCollection[S].isPaused&&q.mainSoundTrack.soundCollection[S].play();if(q.soundTracks)for(S=0;S<q.soundTracks.length;S++)for(let b=0;b<q.soundTracks[S].soundCollection.length;b++)q.soundTracks[S].soundCollection[b].isPaused&&q.soundTracks[S].soundCollection[b].play()}switchAudioModeForHeadphones(){const q=this.GS;if(this._headphone=!0,q.mainSoundTrack.switchPanningModelToHRTF(),q.soundTracks)for(let S=0;S<q.soundTracks.length;S++)q.soundTracks[S].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const q=this.GS;if(this._headphone=!1,q.mainSoundTrack.switchPanningModelToEqualPower(),q.soundTracks)for(let S=0;S<q.soundTracks.length;S++)q.soundTracks[S].switchPanningModelToEqualPower()}_afterRender(){const q=Cb.e.Now;if(this._lastCheck&&q-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=q;const S=this.GS;if(!this._audioEnabled||!S._mainSoundTrack||!S.soundTracks||0===S._mainSoundTrack.soundCollection.length&&1===S.soundTracks.length)return;const b=jS.c.audioEngine;if(b&&b.audioContext){let q,z=S.activeCamera;if(S.activeCameras&&S.activeCameras.length>0&&(z=S.activeCameras[0]),this.audioListenerPositionProvider){const q=this.audioListenerPositionProvider();b.audioContext.listener.setPosition(q.x||0,q.y||0,q.z||0)}else z?this._cachedCameraPosition.equals(z.globalPosition)||(this._cachedCameraPosition.v(z.globalPosition),b.audioContext.listener.setPosition(z.globalPosition.x,z.globalPosition.y,z.globalPosition.z)):b.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const q=this.audioListenerRotationProvider();b.audioContext.listener.setOrientation(q.x||0,q.y||0,q.z||0,0,1,0)}else z?(z.rigCameras&&z.rigCameras.length>0&&(z=z.rigCameras[0]),z.getViewMatrix().invertToRef(this._invertMatrixTemp),C.yS.TransformNormalToRef(vb._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.v(this._cameraDirectionTemp),b.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):b.audioContext.listener.setOrientation(0,0,0,0,1,0);for(q=0;q<S.mainSoundTrack.soundCollection.length;q++){const b=S.mainSoundTrack.soundCollection[q];b.useCustomAttenuation&&b.updateDistanceFromListener()}if(S.soundTracks)for(q=0;q<S.soundTracks.length;q++)for(let b=0;b<S.soundTracks[q].soundCollection.length;b++){const z=S.soundTracks[q].soundCollection[b];z.useCustomAttenuation&&z.updateDistanceFromListener()}}}}vb._CameraDirection=new C.yS(0,0,-1),pS._SceneComponentInitialization=q=>{let S=q._getComponent(qb.c.NAME_AUDIO);S||(S=new vb(q),q.o(S))};const Ub="MSFT_audio_emitter";class gb{constructor(q){this.name=Ub,this._loader=q,this.enabled=this._loader.isExtensionUsed(Ub)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const q=this._loader.lb.extensions;if(q&&q[this.name]){const S=q[this.name];this._clips=S.clips,this._emitters=S.emitters,o.Assign(this._clips),o.Assign(this._emitters)}}loadSceneAsync(q,S){return A.LoadExtensionAsync(q,S,this.name,(async(b,z)=>{const C=new Array;C.push(this._loader.loadSceneAsync(q,S));for(const q of z.emitters){const S=o.Get(`${b}/emitters`,this._emitters,q);if(void 0!=S.refDistance||void 0!=S.maxDistance||void 0!=S.rolloffFactor||void 0!=S.distanceModel||void 0!=S.innerAngle||void 0!=S.outerAngle)throw new Error(`${b}: Direction or Distance properties are not allowed on emitters attached to a scene`);C.push(this._loadEmitterAsync(`${b}/emitters/${S.index}`,S))}await Promise.all(C)}))}loadNodeAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(q,z)=>{const v=new Array,g=await this._loader.loadNodeAsync(q,S,(S=>{for(const b of z.emitters){const z=o.Get(`${q}/emitters`,this._emitters,b);v.push(this._loadEmitterAsync(`${q}/emitters/${z.index}`,z).then((()=>{for(const q of z._babylonSounds)q.attachToMesh(S),void 0==z.innerAngle&&void 0==z.outerAngle||(q.setLocalDirectionToMesh(C.yS.Forward()),q.setDirectionalCone(2*U.Tools.ToDegrees(void 0==z.innerAngle?Math.PI:z.innerAngle),2*U.Tools.ToDegrees(void 0==z.outerAngle?Math.PI:z.outerAngle),0))})))}b(S)}));return await Promise.all(v),g}))}loadAnimationAsync(q,S){return A.LoadExtensionAsync(q,S,this.name,(async(b,z)=>{const C=await this._loader.loadAnimationAsync(q,S),v=new Array;o.Assign(z.events);for(const U of z.events)v.push(this._loadAnimationEventAsync(`${b}/events/${U.index}`,q,S,U,C));return await Promise.all(v),C}))}_loadClipAsync(q,S){if(S._objectURL)return S._objectURL;let b;if(S.uri)b=this._loader.loadUriAsync(q,S,S.uri);else{const z=o.Get(`${q}/bufferView`,this._loader.lb.bufferViews,S.bufferView);b=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}return S._objectURL=b.then((q=>URL.createObjectURL(new Blob([q],{type:S.mimeType})))),S._objectURL}_loadEmitterAsync(q,S){if(S._babylonSounds=S._babylonSounds||[],!S._babylonData){const q=new Array,b=S.name||`emitter${S.index}`,z={loop:!1,autoplay:!1,volume:void 0==S.volume?1:S.volume};for(let v=0;v<S.clips.length;v++){const C=`/extensions/${this.name}/clips`,U=o.Get(C,this._clips,S.clips[v].clip);q.push(this._loadClipAsync(`${C}/${S.clips[v].clip}`,U).then((q=>{const C=S._babylonSounds[v]=new pS(b,q,this._loader.babylonScene,null,z);C.refDistance=S.refDistance||1,C.maxDistance=S.maxDistance||256,C.rolloffFactor=S.rolloffFactor||1,C.distanceModel=S.distanceModel||"exponential"})))}const C=Promise.all(q).then((()=>{const q=S.clips.map((q=>q.weight||1)),b=new YS(S.loop||!1,S._babylonSounds,q);S.innerAngle&&(b.directionalConeInnerAngle=2*U.Tools.ToDegrees(S.innerAngle)),S.outerAngle&&(b.directionalConeOuterAngle=2*U.Tools.ToDegrees(S.outerAngle)),S.volume&&(b.volume=S.volume),S._babylonData.sound=b}));S._babylonData={loaded:C}}return S._babylonData.loaded}_getEventAction(q,S,b,z,C){switch(b){case"play":return q=>{const b=(C||0)+(q-z);S.play(b)};case"stop":return()=>{S.stop()};case"pause":return()=>{S.pause()};default:throw new Error(`${q}: Unsupported action ${b}`)}}_loadAnimationEventAsync(q,S,b,z,C){if(0==C.targetedAnimations.length)return Promise.resolve();const v=C.targetedAnimations[0],U=z.j,g=o.Get(`/extensions/${this.name}/emitters`,this._emitters,U);return this._loadEmitterAsync(q,g).then((()=>{const S=g._babylonData.sound;if(S){const b=new hS(z.time,this._getEventAction(q,S,z.action,z.time,z.startOffset));v.animation.addEvent(b),C.onAnimationGroupEndObservable.add((()=>{S.stop()})),C.onAnimationGroupPauseObservable.add((()=>{S.pause()}))}}))}}x(Ub),D(Ub,!0,(q=>new gb(q)));const rb="MSFT_lod";class Ib{constructor(q){var S;this.name=rb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new V.d,this.onMaterialLODsLoadedObservable=new V.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=q,this.maxLODsToLoad=(null===(S=this._loader.parent.extensionOptions[rb])||void 0===S?void 0:S.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(rb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let q=0;q<this._nodePromiseLODs.length;q++){const S=Promise.all(this._nodePromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Node LOD ${q}`),this._loader.log(`Loaded node LOD ${q}`)),this.onNodeLODsLoadedObservable.notifyObservers(q),q!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${q+1}`),this._loadBufferLOD(this._nodeBufferLODs,q+1),this._nodeSignalLODs[q]&&this._nodeSignalLODs[q].resolve())}));this._loader._completePromises.push(S)}for(let q=0;q<this._materialPromiseLODs.length;q++){const S=Promise.all(this._materialPromiseLODs[q]).then((()=>{0!==q&&(this._loader.endPerformanceCounter(`Material LOD ${q}`),this._loader.log(`Loaded material LOD ${q}`)),this.onMaterialLODsLoadedObservable.notifyObservers(q),q!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${q+1}`),this._loadBufferLOD(this._materialBufferLODs,q+1),this._materialSignalLODs[q]&&this._materialSignalLODs[q].resolve())}));this._loader._completePromises.push(S)}}loadSceneAsync(q,S){const b=this._loader.loadSceneAsync(q,S);return this._loadBufferLOD(this._bufferLODs,0),b}loadNodeAsync(q,S,b){return A.LoadExtensionAsync(q,S,this.name,(async(q,C)=>{let v;const U=this._getLODs(q,S,this._loader.lb.nodes,C.ids);this._loader.logOpen(`${q}`);for(let S=0;S<U.length;S++){const q=U[S];0!==S&&(this._nodeIndexLOD=S,this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new z);const C=q=>{b(q),q.br(!1)},g=this._loader.loadNodeAsync(`/nodes/${q.index}`,q,C).then((q=>{if(0!==S){const q=U[S-1];q._babylonTransformNode&&(this._disposeTransformNode(q._babylonTransformNode),delete q._babylonTransformNode)}return q.br(!0),q}));this._nodePromiseLODs[S]=this._nodePromiseLODs[S]||[],0===S?v=g:(this._nodeIndexLOD=null,this._nodePromiseLODs[S].push(g))}return this._loader.logClose(),await v}))}_loadMaterialAsync(q,S,b,z,C){return this._nodeIndexLOD?null:A.LoadExtensionAsync(q,S,this.name,(async(q,v)=>{let U;const g=this._getLODs(q,S,this._loader.lb.materials,v.ids);this._loader.logOpen(`${q}`);for(let S=0;S<g.length;S++){const q=g[S];0!==S&&(this._materialIndexLOD=S);const v=this._loader._loadMaterialAsync(`/materials/${q.index}`,q,b,z,(q=>{0===S&&C(q)})).then((q=>{if(0!==S){C(q);const b=g[S-1]._data;b[z]&&(this._disposeMaterials([b[z].babylonMaterial]),delete b[z])}return q}));this._materialPromiseLODs[S]=this._materialPromiseLODs[S]||[],0===S?U=v:(this._materialIndexLOD=null,this._materialPromiseLODs[S].push(v))}return this._loader.logClose(),await U}))}_loadUriAsync(q,S,b){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const C=this._nodeIndexLOD-1;return this._nodeSignalLODs[C]=this._nodeSignalLODs[C]||new z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(q,S,b)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const C=this._materialIndexLOD-1;return this._materialSignalLODs[C]=this._materialSignalLODs[C]||new z,this._materialSignalLODs[C].promise.then((async()=>await this._loader.loadUriAsync(q,S,b)))}return null}loadBufferAsync(q,S,b,C){if(this._loader.parent.useRangeRequests&&!S.uri){if(!this._loader.bin)throw new Error(`${q}: Uri is missing or the binary glTF is missing its binary chunk`);const S=async(q,S)=>{const v=b,U=v+C-1;let g=q[S];return g?(g.start=Math.min(g.start,v),g.end=Math.max(g.end,U)):(g={start:v,end:U,loaded:new z},q[S]=g),await g.loaded.promise.then((q=>new Uint8Array(q.buffer,q.byteOffset+b-g.start,C)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?S(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?S(this._materialBufferLODs,this._materialIndexLOD):S(this._bufferLODs,0)}return null}_loadBufferLOD(q,S){const b=q[S];b&&(this._loader.log(`Loading buffer range [${b.start}-${b.end}]`),this._loader.bin.readAsync(b.start,b.end-b.start+1).then((q=>{b.loaded.resolve(q)}),(q=>{b.loaded.reject(q)})))}_getLODs(q,S,b,z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const C=[];for(let v=z.length-1;v>=0;v--)if(C.push(o.Get(`${q}/ids/${z[v]}`,b,z[v])),C.length===this.maxLODsToLoad)return C;return C.push(S),C}_disposeTransformNode(q){const S=[],b=q.material;b&&S.push(b);for(const C of q.getChildMeshes())C.material&&S.push(C.material);q.dispose();const z=S.filter((q=>this._loader.babylonScene.meshes.every((S=>S.material!=q))));this._disposeMaterials(z)}_disposeMaterials(q){const S={};for(const b of q){for(const q of b.getActiveTextures())S[q.uniqueId]=q;b.dispose()}for(const b in S)for(const q of this._loader.babylonScene.materials)q.hasTexture(S[b])&&delete S[b];for(const b in S)S[b].dispose()}}x(rb),D(rb,!0,(q=>new Ib(q)));const Vb="MSFT_minecraftMesh";class lb{constructor(q){this.name=Vb,this._loader=q,this.enabled=this._loader.isExtensionUsed(Vb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtraAsync(q,S,this.name,(async(z,C)=>{if(C){if(!(b instanceof W.b))throw new Error(`${z}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(q,S,b);return b.needAlphaBlending()&&(b.forceDepthWrite=!0,b.separateCullingPass=!0),b.Tb=b.forceDepthWrite,b.twoSidedLighting=!0,await C}}))}}x(Vb),D(Vb,!0,(q=>new lb(q)));const yb="MSFT_sRGBFactors";class Rb{constructor(q){this.name=yb,this._loader=q,this.enabled=this._loader.isExtensionUsed(yb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(q,S,b){return A.LoadExtraAsync(q,S,this.name,(async(z,C)=>{if(C){if(!(b instanceof W.b))throw new Error(`${z}: Material type not supported`);const C=this._loader.loadMaterialPropertiesAsync(q,S,b),v=b.Tq().getEngine().useExactSrgbConversions;return b.albedoTexture||b.albedoColor.toLinearSpaceToRef(b.albedoColor,v),b.reflectivityTexture||b.reflectivityColor.toLinearSpaceToRef(b.reflectivityColor,v),await C}}))}}x(yb),D(yb,!0,(q=>new Rb(q)));var Gb=b(12821);const Zb={};var Hb=b(12860),Qb=b(12850),kb=b(12830),Wb=b(12839);function Nb(q,S){for(const b of q)for(const q of b.dataOutputs)if(q.uniqueId===S)return q;throw new Error("Could not find data out connection with unique id "+S)}function ub(q,S){for(const b of q)if(b instanceof Qb.e)for(const q of b.signalInputs)if(q.uniqueId===S)return q;throw new Error("Could not find signal in connection with unique id "+S)}async function Xb(q,S){const z=await Promise.all(q.allBlocks.map((async q=>{const S=function(q){switch(q){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([b.e(78),b.e(79)]).then(b.bind(b,14286))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await b.e(80).then(b.bind(b,14291))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await b.e(81).then(b.bind(b,14295))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await b.e(82).then(b.bind(b,14301))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await b.e(83).then(b.bind(b,14307))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await b.e(84).then(b.bind(b,14311))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await b.e(85).then(b.bind(b,14316))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await b.e(86).then(b.bind(b,14320))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await b.e(87).then(b.bind(b,14327))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await b.e(95).then(b.bind(b,14377))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await b.e(96).then(b.bind(b,14385))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await b.e(97).then(b.bind(b,14389))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await b.e(98).then(b.bind(b,14396))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await b.e(99).then(b.bind(b,14402))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await b.e(100).then(b.bind(b,14410))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await b.e(101).then(b.bind(b,14413))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await b.e(102).then(b.bind(b,14416))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await b.e(103).then(b.bind(b,14423))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await b.e(104).then(b.bind(b,14427))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await b.e(105).then(b.bind(b,14431))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await b.e(106).then(b.bind(b,14434))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await b.e(107).then(b.bind(b,14437))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await b.e(108).then(b.bind(b,14443))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await b.e(109).then(b.bind(b,14445))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await b.e(110).then(b.bind(b,14454))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await b.e(111).then(b.bind(b,14463))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await b.e(112).then(b.bind(b,14469))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await b.e(113).then(b.bind(b,14478))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await b.e(92).then(b.bind(b,14480))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await b.e(114).then(b.bind(b,14485))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await b.e(115).then(b.bind(b,14490))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await b.e(116).then(b.bind(b,14496))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await b.e(93).then(b.bind(b,14503))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await b.e(88).then(b.bind(b,14336))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await b.e(94).then(b.bind(b,14512))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await b.e(89).then(b.bind(b,14365))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await b.e(90).then(b.bind(b,14374))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await b.e(91).then(b.bind(b,14520))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await b.e(117).then(b.bind(b,14525))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await b.e(118).then(b.bind(b,14531))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await b.e(119).then(b.bind(b,14538))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await b.e(120).then(b.bind(b,14547))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await b.e(121).then(b.bind(b,14551))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await b.e(122).then(b.bind(b,14555))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await b.e(123).then(b.bind(b,14558))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await b.e(124).then(b.bind(b,14567))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await b.e(125).then(b.bind(b,14574))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await b.e(126).then(b.bind(b,14579))).FlowGraphDataSwitchBlock;default:if(Zb[q])return Zb[q];throw new Error(`Unknown block name ${q}`)}}(q.className);return await S()})));return function(q,S,b){const z=S.coordinator.createGraph(),C=[],v=S.valueParseFunction??kb.e;for(let U=0;U<q.allBlocks.length;U++){const g=Bb(q.allBlocks[U],{GS:S.coordinator.config.GS,pathConverter:S.pathConverter,assetsContainer:S.coordinator.config.GS,valueParseFunction:v},b[U]);C.push(g),g instanceof Hb.e&&z.addEventBlock(g)}for(const U of C){for(const q of U.dataInputs)for(const S of q.connectedPointIds){const b=Nb(C,S);q.connectTo(b)}if(U instanceof Qb.e)for(const q of U.signalOutputs)for(const S of q.connectedPointIds){const b=ub(C,S);q.connectTo(b)}}for(const U of q.executionContexts)Tb(U,{graph:z,valueParseFunction:v},q.rightHanded);return z}(q,S,z)}function Tb(q,S,b){const z=S.graph.createContext();q.enableLogging&&(z.enableLogging=!0),z.treatDataAsRightHanded=b||!1;const C=S.valueParseFunction??kb.e;z.uniqueId=q.uniqueId;const v=z.Tq();if(q._assetsContext){var U,g,r,I,V,l,y,R,G,Z;const S=q._assetsContext,b={meshes:null===(U=S.meshes)||void 0===U?void 0:U.map((q=>v.getMeshById(q))),lights:null===(g=S.lights)||void 0===g?void 0:g.map((q=>v.getLightByName(q))),cameras:null===(r=S.cameras)||void 0===r?void 0:r.map((q=>v.getCameraByName(q))),materials:null===(I=S.materials)||void 0===I?void 0:I.map((q=>v.getMaterialById(q))),textures:null===(V=S.textures)||void 0===V?void 0:V.map((q=>v.getTextureByName(q))),animations:null===(l=S.animations)||void 0===l?void 0:l.map((q=>v.animations.find((S=>S.name===q)))),skeletons:null===(y=S.skeletons)||void 0===y?void 0:y.map((q=>v.getSkeletonByName(q))),Gy:null===(R=S.Gy)||void 0===R?void 0:R.map((q=>v.getParticleSystemById(q))),animationGroups:null===(G=S.animationGroups)||void 0===G?void 0:G.map((q=>v.getAnimationGroupByName(q))),transformNodes:null===(Z=S.transformNodes)||void 0===Z?void 0:Z.map((q=>v.getTransformNodeById(q))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],SR:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};z.assetsContext=b}for(const H in q._userVariables){const S=C(H,q._userVariables,z.assetsContext,v);z.userVariables[H]=S}for(const H in q._connectionValues){const S=C(H,q._connectionValues,z.assetsContext,v);z._setConnectionValueByKey(H,S)}return z}function Bb(q,S,b){const z={},C=S.valueParseFunction??kb.e;if(q.config)for(const U in q.config)z[U]=C(U,q.config,S.assetsContainer||S.GS,S.GS);if((0,kb.j)(q.className)){if(!S.pathConverter)throw new Error("Path converter is required for this block");z.pathConverter=S.pathConverter}const v=new b(z);v.uniqueId=q.uniqueId;for(let U=0;U<q.dataInputs.length;U++){const S=v.getDataInput(q.dataInputs[U].name);if(!S)throw new Error("Could not find data input with name "+q.dataInputs[U].name+" in block "+q.className);S.deserialize(q.dataInputs[U])}for(let U=0;U<q.dataOutputs.length;U++){const S=v.getDataOutput(q.dataOutputs[U].name);if(!S)throw new Error("Could not find data output with name "+q.dataOutputs[U].name+" in block "+q.className);S.deserialize(q.dataOutputs[U])}return v.metadata=q.metadata,v.deserialize&&v.deserialize(q),v}function tb(q){const[S,b]=q.split(":");return fb({op:S,extension:b})}function fb(q){var S;let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const z=q.extension?null===(S=Eb[q.extension])||void 0===S?void 0:S[q.op]:eb[q.op];if(!z&&(Z.b.Warn(`No mapping found for operation ${q.op} and extension ${q.extension||"KHR_interactivity"}`),b)){const S={},b={flows:{}};if(q.inputValueSockets){S.values={};for(const b in q.inputValueSockets)S.values[b]={name:b}}return q.outputValueSockets&&(b.values={},Object.keys(q.outputValueSockets).forEach((q=>{b.values[q]={name:q}}))),{LV:[],inputs:S,outputs:b}}return z}function mb(q,S,b){Eb[S]||(Eb[S]={}),Eb[S][q]=b}const Eb={BABYLON:{"flow/log":{LV:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},eb={"event/onStart":{LV:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{LV:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{LV:["FlowGraphSendCustomEventBlock"],extraProcessor(q,S,b,z,C){if("event/send"!==S.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const v=q.configuration.event.value[0];if("number"!==typeof v)throw new Error("Event id should be a number");const U=z.arrays.events[v],g=C[0];return g.config||(g.config={}),g.config.eventId=U.eventId,g.config.eventData=U.eventData,C}},"event/receive":{LV:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(q,S){var b;if(!q.configuration)return Z.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const z=q.configuration.event;if(!z)return Z.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const C=z.value[0];if("number"!==typeof C)return Z.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(b=S.events)||void 0===b?void 0:b[C])?{valid:!0}:(Z.b.Error(`Event with id ${C} not found`),{valid:!1,error:`Event with id ${C} not found`})},extraProcessor(q,S,b,z,C){if("event/receive"!==S.op||!q.configuration||1!==Object.keys(q.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const v=q.configuration.event.value[0];if("number"!==typeof v)throw new Error("Event id should be a number");const U=z.arrays.events[v],g=C[0];return g.config||(g.config={}),g.config.eventId=U.eventId,g.config.eventData=U.eventData,C}},"math/e":ib("FlowGraphEBlock"),"math/pi":ib("FlowGraphPIBlock"),"math/inf":ib("FlowGraphInfBlock"),"math/nan":ib("FlowGraphNaNBlock"),"math/abs":ib("FlowGraphAbsBlock"),"math/sign":ib("FlowGraphSignBlock"),"math/trunc":ib("FlowGraphTruncBlock"),"math/floor":ib("FlowGraphFloorBlock"),"math/ceil":ib("FlowGraphCeilBlock"),"math/round":{LV:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C){var v;return(v=C[0]).config||(v.config={}),C[0].config.roundHalfAwayFromZero=!0,C}},"math/fract":ib("FlowGraphFractBlock"),"math/neg":ib("FlowGraphNegationBlock"),"math/add":ib("FlowGraphAddBlock",["a","b"],!0),"math/sub":ib("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{LV:["FlowGraphMultiplyBlock"],extraProcessor(q,S,b,z,C){var v;(v=C[0]).config||(v.config={}),C[0].config.useMatrixPerComponent=!0,C[0].config.preventIntegerFloatArithmetic=!0;let U=-1;return Object.keys(q.values||{}).find((S=>{var b;return void 0!==(null===(b=q.values)||void 0===b?void 0:b[S].type)&&(U=q.values[S].type,!0)})),-1!==U&&(C[0].config.type=z.arrays.types[U].flowGraphType),C},validation:q=>q.values?Jb(q):{valid:!0}},"math/div":ib("FlowGraphDivideBlock",["a","b"],!0),"math/rem":ib("FlowGraphModuloBlock",["a","b"]),"math/min":ib("FlowGraphMinBlock",["a","b"]),"math/max":ib("FlowGraphMaxBlock",["a","b"]),"math/clamp":ib("FlowGraphClampBlock",["a","b","c"]),"math/saturate":ib("FlowGraphSaturateBlock"),"math/mix":ib("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":ib("FlowGraphEqualityBlock",["a","b"]),"math/lt":ib("FlowGraphLessThanBlock",["a","b"]),"math/le":ib("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":ib("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":ib("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":ib("FlowGraphIsNaNBlock"),"math/isinf":ib("FlowGraphIsInfBlock"),"math/select":{LV:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{LV:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":ib("FlowGraphSinBlock"),"math/cos":ib("FlowGraphCosBlock"),"math/tan":ib("FlowGraphTanBlock"),"math/asin":ib("FlowGraphASinBlock"),"math/acos":ib("FlowGraphACosBlock"),"math/atan":ib("FlowGraphATanBlock"),"math/atan2":ib("FlowGraphATan2Block",["a","b"]),"math/sinh":ib("FlowGraphSinhBlock"),"math/cosh":ib("FlowGraphCoshBlock"),"math/tanh":ib("FlowGraphTanhBlock"),"math/asinh":ib("FlowGraphASinhBlock"),"math/acosh":ib("FlowGraphACoshBlock"),"math/atanh":ib("FlowGraphATanhBlock"),"math/exp":ib("FlowGraphExponentialBlock"),"math/log":ib("FlowGraphLogBlock"),"math/log2":ib("FlowGraphLog2Block"),"math/log10":ib("FlowGraphLog10Block"),"math/sqrt":ib("FlowGraphSquareRootBlock"),"math/cbrt":ib("FlowGraphCubeRootBlock"),"math/pow":ib("FlowGraphPowerBlock",["a","b"]),"math/length":ib("FlowGraphLengthBlock"),"math/normalize":ib("FlowGraphNormalizeBlock"),"math/dot":ib("FlowGraphDotBlock",["a","b"]),"math/cross":ib("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":ib("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":ib("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{LV:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{LV:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{LV:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{LV:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{LV:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{LV:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{LV:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":ib("FlowGraphTransposeBlock"),"math/determinant":ib("FlowGraphDeterminantBlock"),"math/inverse":ib("FlowGraphInvertMatrixBlock"),"math/matmul":ib("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{LV:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"tb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C,v){const U=C[0].dataInputs.find((q=>"rotationQuaternion"===q.name));if(!U)throw new Error("Rotation quaternion input not found");return v._connectionValues[U.uniqueId]&&(v._connectionValues[U.uniqueId].type="Quaternion"),C}},"math/matDecompose":{LV:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"tb"}}}},"math/quatConjugate":ib("FlowGraphConjugateBlock",["a"]),"math/quatMul":{LV:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C){var v;return(v=C[0]).config||(v.config={}),C[0].config.type="Quaternion",C}},"math/quatAngleBetween":ib("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{LV:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":ib("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":ib("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{LV:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C){var v;return(v=C[0]).config||(v.config={}),C[0].config.inputIsColumnMajor=!0,C}},"math/extract2x2":{LV:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{LV:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C){var v;return(v=C[0]).config||(v.config={}),C[0].config.inputIsColumnMajor=!0,C}},"math/extract3x3":{LV:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{LV:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C){var v;return(v=C[0]).config||(v.config={}),C[0].config.inputIsColumnMajor=!0,C}},"math/extract4x4":{LV:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{LV:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C,v){var U,g;(g=C[0]).config||(g.config={});const r=C[0].dataInputs[0];return C[0].config.valueType=(null===(U=v._connectionValues[r.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",C}},"math/and":{LV:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C,v){var U,g,r;(r=C[0]).config||(r.config={});const I=C[0].dataInputs[0],V=C[0].dataInputs[1];return C[0].config.valueType=(null===(U=v._connectionValues[I.uniqueId])||void 0===U?void 0:U.type)??(null===(g=v._connectionValues[V.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",C}},"math/or":{LV:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C,v){var U,g,r;(r=C[0]).config||(r.config={});const I=C[0].dataInputs[0],V=C[0].dataInputs[1];return C[0].config.valueType=(null===(U=v._connectionValues[I.uniqueId])||void 0===U?void 0:U.type)??(null===(g=v._connectionValues[V.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",C}},"math/xor":{LV:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(q,S,b,z,C,v){var U,g,r;(r=C[0]).config||(r.config={});const I=C[0].dataInputs[0],V=C[0].dataInputs[1];return C[0].config.valueType=(null===(U=v._connectionValues[I.uniqueId])||void 0===U?void 0:U.type)??(null===(g=v._connectionValues[V.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",C}},"math/asr":ib("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":ib("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":ib("FlowGraphLeadingZerosBlock"),"math/ctz":ib("FlowGraphTrailingZerosBlock"),"math/popcnt":ib("FlowGraphOneBitsCounterBlock"),"math/rad":ib("FlowGraphDegToRadBlock"),"math/deg":ib("FlowGraphRadToDegBlock"),"type/boolToInt":ib("FlowGraphBooleanToInt"),"type/boolToFloat":ib("FlowGraphBooleanToFloat"),"type/intToBool":ib("FlowGraphIntToBoolean"),"type/intToFloat":ib("FlowGraphIntToFloat"),"type/floatToInt":ib("FlowGraphFloatToInt"),"type/floatToBool":ib("FlowGraphFloatToBoolean"),"flow/sequence":{LV:["FlowGraphSequenceBlock"],extraProcessor(q,S,b,z,C){const v=C[0];return v.config||(v.config={}),v.config.outputSignalCount=Object.keys(q.flows||[]).length,v.signalOutputs.forEach(((q,S)=>{q.name="out_"+S})),C}},"flow/branch":{LV:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{LV:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(q){if(q.configuration&&q.configuration.cases){const S=q.configuration.cases.value;if(!S.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return Z.b.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const b=new Set(S);q.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(q,S,b,z,C){if("flow/switch"!==S.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return C[0].signalOutputs.forEach((q=>{"default"!==q.name&&(q.name="out_"+q.name)})),C}},"flow/while":{LV:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{LV:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(q,S,b,z,C){const v=C[0];return v.config||(v.config={}),v.config.incrementIndexWhenLoopDone=!0,C}},"flow/doN":{LV:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{LV:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(q,S,b,z,C){if("flow/multiGate"!==S.op||!q.flows||0===Object.keys(q.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const v=C[0];return v.config||(v.config={}),v.config.outputSignalCount=Object.keys(q.flows).length,v.signalOutputs.forEach(((q,S)=>{q.name="out_"+S})),C}},"flow/waitAll":{LV:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(q){var S,b;return"number"!==typeof(null===(S=q.configuration)||void 0===S||null===(b=S.inputFlows)||void 0===b?void 0:b.value[0])&&(q.configuration=q.configuration||{inputFlows:{value:[0]}},q.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{LV:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{LV:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{LV:["FlowGraphCancelDelayBlock"]},"variable/get":{LV:["FlowGraphGetVariableBlock"],validation(q){var S,b;return null!==(S=q.configuration)&&void 0!==S&&null!==(b=S.variable)&&void 0!==b&&b.value?{valid:!0}:(Z.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,S)=>[S.getVariableName(q[0])]}}},"variable/set":{LV:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(q,S)=>[S.getVariableName(q[0])]}}},"variable/setMultiple":{LV:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(q,S)=>[q[0].map((q=>S.getVariableName(q)))]}},extraProcessor:(q,S,b,z,C)=>(C[0].dataInputs.forEach((q=>{q.name=z.getVariableName(+q.name)})),C)},"variable/interpolate":{LV:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(q,S)=>[S.getVariableName(q[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:q=>!0===q[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rz:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rz:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rz:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rz:"FlowGraphPlayAnimationBlock"},out:{name:"out",rz:"FlowGraphPlayAnimationBlock"},done:{name:"done",rz:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(q,S,b,z,C){var v,U,g;const r=C[0],I=null===(v=q.configuration)||void 0===v?void 0:v.variable.value[0];if("number"!==typeof I)throw Z.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const V=z.arrays.staticVariables[I];"undefined"===typeof r.config.animationType.value&&(z.arrays.staticVariables,r.config.animationType.value=(0,Wb.F)(V.type));const l=C[4];return l.config||(l.config={}),(U=l.config).variable||(U.variable={}),l.config.variable.value=z.getVariableName(I),(g=C[3]).config||(g.config={}),C}},"pointer/get":{LV:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",rz:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,S,b,z,C)=>(C.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),C)},"pointer/set":{LV:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",rz:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,S,b,z,C)=>(C.forEach((q=>{"FlowGraphJsonPointerParserBlock"===q.className&&(q.config||(q.config={}),q.config.outputValue=!0)})),C)},"pointer/interpolate":{LV:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",rz:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",rz:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rz:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rz:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rz:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rz:"FlowGraphPlayAnimationBlock"},out:{name:"out",rz:"FlowGraphPlayAnimationBlock"},done:{name:"done",rz:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(q,S,b,z,C)=>(C.forEach((S=>{"FlowGraphJsonPointerParserBlock"===S.className?(S.config||(S.config={}),S.config.outputValue=!0):"FlowGraphInterpolationBlock"===S.className&&(S.config||(S.config={}),Object.keys(q.values||[]).forEach((b=>{var C;const v=null===(C=q.values)||void 0===C?void 0:C[b];if("value"===b&&v){const q=v.type;void 0!==q&&(S.config.animationType=z.arrays.types[q].flowGraphType)}})))})),C)},"animation/start":{LV:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rz:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(q,S)=>[q[0]*S._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(q,S)=>[q[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){const g=C[C.length-1];return g.config||(g.config={}),g.config.glTF=U,C}},"animation/stop":{LV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rz:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){const g=C[C.length-1];return g.config||(g.config={}),g.config.glTF=U,C}},"animation/stopAt":{LV:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",rz:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(q,S)=>[q[0]*S._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){const g=C[C.length-1];return g.config||(g.config={}),g.config.glTF=U,C}},"math/switch":{LV:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(q){if(q.configuration&&q.configuration.cases){const S=q.configuration.cases.value;if(!S.every((q=>"number"===typeof q&&/^-?\d+$/.test(q.toString()))))return Z.b.Warn("Switch cases should be integers. Using empty array instead."),q.configuration.cases.value=[],{valid:!0};const b=new Set(S);q.configuration.cases.value=Array.from(b)}return{valid:!0}},extraProcessor(q,S,b,z,C){const v=C[0];return v.dataInputs.forEach((q=>{"default"!==q.name&&"case"!==q.name&&(q.name="in_"+q.name)})),v.config||(v.config={}),v.config.treatCasesAsIntegers=!0,C}},"debug/log":{LV:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function ib(q){let S=arguments.length>2?arguments[2]:void 0;return{LV:[q],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((q,S)=>(q[S]={name:S},q)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(q,b,z,C,v){var U;if(S){(U=v[0]).config||(U.config={}),v[0].config.preventIntegerFloatArithmetic=!0;let S=-1;Object.keys(q.values||{}).find((b=>{var z;return void 0!==(null===(z=q.values)||void 0===z?void 0:z[b].type)&&(S=q.values[b].type,!0)})),-1!==S&&(v[0].config.type=C.arrays.types[S].flowGraphType)}return v},validation:q=>S?Jb(q):{valid:!0}}}function Jb(q){if(q.values){const S=Object.keys(q.values).map((S=>q.values[S].type)).filter((q=>void 0!==q));if(!S.every((q=>q===S[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}eb["math/compose"]=eb["math/matCompose"],eb["math/decompose"]=eb["math/matDecompose"];var Lb=b(11060);const db={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"yS",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Kb{constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=q,this._gltf=S,this._animationTargetFps=b,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const q of this._interactivityGraph.types)this._types.push(db[q.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const q of this._interactivityGraph.declarations){const S=fb(q);if(!S)throw Z.b.Error(["No mapping found for declaration",q]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:S,fullOperationName:q.extension?q.op+":"+q.extension:q.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const q of this._interactivityGraph.variables){const S=this._parseVariable(q);this._staticVariables.push(S)}}_parseVariable(q,S){const b=this._types[q.type];if(!b)throw Z.b.Error(["No type found for variable",q]),new Error("Error parsing variables");if(q.value&&q.value.length!==b.length)throw Z.b.Error(["Invalid value length for variable",q,b]),new Error("Error parsing variables");const z=q.value||[];if(!z.length)switch(b.flowGraphType){case"boolean":z.push(!1);break;case"FlowGraphInteger":z.push(0);break;case"number":z.push(NaN);break;case"Vector2":z.push(NaN,NaN);break;case"yS":z.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":z.fill(NaN,0,4);break;case"Matrix":z.fill(NaN,0,16);break;case"Matrix3D":z.fill(NaN,0,9)}return"number"===b.elementType&&"string"===typeof z[0]&&(z[0]=parseFloat(z[0])),{type:b.flowGraphType,value:S?S(z,this):z}}_parseEvents(){if(this._interactivityGraph.events)for(const q of this._interactivityGraph.events){const S={eventId:q.id||"internalEvent_"+this._internalEventsCounter++};q.values&&(S.eventData=Object.keys(q.values).map((S=>{var b;const z=null===(b=q.values)||void 0===b?void 0:b[S];if(!z)throw Z.b.Error(["No value found for event key",S]),new Error("Error parsing events");const C=this._types[z.type];if(!C)throw Z.b.Error(["No type found for event value",z]),new Error("Error parsing events");const v="undefined"!==typeof z.value?this._parseVariable(z):void 0;return{id:S,type:C.flowGraphType,eventData:!0,value:v}}))),this._events.push(S)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const S of this._interactivityGraph.nodes){if("number"!==typeof S.declaration)throw Z.b.Error(["No declaration found for node",S]),new Error("Error parsing nodes");const b=this._mappings[S.declaration];if(!b)throw Z.b.Error(["No mapping found for node",S]),new Error("Error parsing nodes");if(b.flowGraphMapping.validation){const z=b.flowGraphMapping.validation(S,this._interactivityGraph,this._gltf);var q;if(!z.valid)throw new Error(`Error validating interactivity node ${null===(q=this._interactivityGraph.declarations)||void 0===q?void 0:q[S.declaration].op} - ${z.error}`)}const z=[];for(const q of b.flowGraphMapping.LV){const C=this._getEmptyBlock(q,b.fullOperationName);this._parseNodeConfiguration(S,C,b.flowGraphMapping,q),z.push(C)}this._nodes.push({LV:z,fullOperationName:b.fullOperationName})}}_getEmptyBlock(q,S){return{uniqueId:(0,Lb.d)(),className:q,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:S,metadata:{}}}_parseNodeConfiguration(q,S,b,z){const C=S.config;if(q.configuration){const S=Object.keys(q.configuration);for(const g of S){var v,U;const S=null===(v=q.configuration)||void 0===v?void 0:v[g];if(!S)throw Z.b.Error(["No value found for node configuration",g]),new Error("Error parsing node configuration");const r=null===(U=b.configuration)||void 0===U?void 0:U[g];if(r&&r.rz?r.rz===z:0===b.LV.indexOf(z)){const q=(null===r||void 0===r?void 0:r.name)||g;S&&"undefined"!==typeof S.value||"undefined"===typeof(null===r||void 0===r?void 0:r.defaultValue)?S.value.length>=0?C[q]={value:1===S.value.length?S.value[0]:S.value}:Z.b.Warn(["Invalid value for node configuration",S]):C[q]={value:r.defaultValue},r&&r.dataTransformer&&(C[q].value=r.dataTransformer([C[q].value],this)[0])}}}}_parseNodeConnections(q){for(let X=0;X<this._nodes.length;X++){var S;const T=null===(S=this._interactivityGraph.nodes)||void 0===S?void 0:S[X];if(!T)throw Z.b.Error(["No node found for interactivity node",this._nodes[X]]),new Error("Error parsing node connections");const B=this._nodes[X],t=this._mappings[T.declaration];if(!t)throw Z.b.Error(["No mapping found for node",T]),new Error("Error parsing node connections");const f=T.flows||{},m=Object.keys(f).sort();for(const q of m){var b,z,C,v;const S=f[q],I=null===(b=t.flowGraphMapping.outputs)||void 0===b||null===(z=b.flows)||void 0===z?void 0:z[q],V=(null===I||void 0===I?void 0:I.name)||q,l=this._createNewSocketConnection(V,!0);(I&&I.rz&&B.LV.find((q=>q.className===I.rz))||B.LV[0]).signalOutputs.push(l);const y=S.node,R=this._nodes[y];if(!R)throw Z.b.Error(["No node found for input node id",y]),new Error("Error parsing node connections");const G=tb(R.fullOperationName);if(!G)throw Z.b.Error(["No mapping found for input node",R]),new Error("Error parsing node connections");let H=null===(C=G.inputs)||void 0===C||null===(v=C.flows)||void 0===v?void 0:v[S.socket||"in"],Q=!1;if(!H)for(const q in null===(U=G.inputs)||void 0===U?void 0:U.flows){var U,g,r;if(q.startsWith("[")&&q.endsWith("]"))Q=!0,H=null===(g=G.inputs)||void 0===g||null===(r=g.flows)||void 0===r?void 0:r[q]}const k=H?Q?H.name.replace("$1",S.socket||""):H.name:S.socket||"in",W=H&&H.rz&&R.LV.find((q=>q.className===H.rz))||R.LV[0];let N=W.signalInputs.find((q=>q.name===k));N||(N=this._createNewSocketConnection(k),W.signalInputs.push(N)),N.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(N.uniqueId)}const E=T.values||{},e=Object.keys(E);for(const S of e){var I,V;const b=E[S];let z=null===(I=t.flowGraphMapping.inputs)||void 0===I||null===(V=I.values)||void 0===V?void 0:V[S],C=!1;if(!z)for(const q in null===(l=t.flowGraphMapping.inputs)||void 0===l?void 0:l.values){var l,y,R;if(q.startsWith("[")&&q.endsWith("]"))C=!0,z=null===(y=t.flowGraphMapping.inputs)||void 0===y||null===(R=y.values)||void 0===R?void 0:R[q]}const v=z?C?z.name.replace("$1",S):z.name:S,U=this._createNewSocketConnection(v);if((z&&z.rz&&B.LV.find((q=>q.className===z.rz))||B.LV[0]).dataInputs.push(U),void 0!==b.value){const S=this._parseVariable(b,z&&z.dataTransformer);q._connectionValues[U.uniqueId]=S}else{if("undefined"===typeof b.node)throw Z.b.Error(["Invalid value for value connection",b]),new Error("Error parsing node connections");{var G,H,Q;const q=b.node,S=b.socket||"value",z=this._nodes[q];if(!z)throw Z.b.Error(["No node found for output socket reference",b]),new Error("Error parsing node connections");const C=tb(z.fullOperationName);if(!C)throw Z.b.Error(["No mapping found for output socket reference",b]),new Error("Error parsing node connections");let v=null===(G=C.outputs)||void 0===G||null===(H=G.values)||void 0===H?void 0:H[S],g=!1;if(!v)for(const b in null===(k=C.outputs)||void 0===k?void 0:k.values){var k,W,N;if(b.startsWith("[")&&b.endsWith("]"))g=!0,v=null===(W=C.outputs)||void 0===W||null===(N=W.values)||void 0===N?void 0:N[b]}const r=v?g?v.name.replace("$1",S):null===(Q=v)||void 0===Q?void 0:Q.name:S,I=v&&v.rz&&z.LV.find((q=>q.className===v.rz))||z.LV[0];let V=I.dataOutputs.find((q=>q.name===r));V||(V=this._createNewSocketConnection(r,!0),I.dataOutputs.push(V)),U.connectedPointIds.push(V.uniqueId),V.connectedPointIds.push(U.uniqueId)}}}if(t.flowGraphMapping.interBlockConnectors)for(const q of t.flowGraphMapping.interBlockConnectors){const S=q.input,b=q.output,z=q.isVariable;this._connectFlowGraphNodes(S,b,B.LV[q.inputBlockIndex],B.LV[q.outputBlockIndex],z)}if(t.flowGraphMapping.extraProcessor){var u;const S=null===(u=this._interactivityGraph.declarations)||void 0===u?void 0:u[T.declaration];if(!S)throw Z.b.Error(["No declaration found for extra processor",T]),new Error("Error parsing node connections");B.LV=t.flowGraphMapping.extraProcessor(T,S,t.flowGraphMapping,this,B.LV,q,this._gltf)}}}_createNewSocketConnection(q,S){return{uniqueId:(0,Lb.d)(),name:q,_connectionType:S?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(q,S,b,z,C){const v=C?b.dataInputs:b.signalInputs,U=C?z.dataOutputs:z.signalOutputs,g=v.find((S=>S.name===q))||this._createNewSocketConnection(q),r=U.find((q=>q.name===S))||this._createNewSocketConnection(S,!0);v.find((S=>S.name===q))||v.push(g),U.find((q=>q.name===S))||U.push(r),g.connectedPointIds.push(r.uniqueId),r.connectedPointIds.push(g.uniqueId)}getVariableName(q){return"staticVariable_"+q}serializeToFlowGraph(){const q={uniqueId:(0,Lb.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(q);for(let S=0;S<this._staticVariables.length;S++){const b=this._staticVariables[S];q._userVariables[this.getVariableName(S)]=b}return{rightHanded:!0,allBlocks:this._nodes.reduce(((q,S)=>q.concat(S.LV)),[]),executionContexts:[q]}}}const Db="KHR_interactivity";class xb{constructor(q){this._loader=q,this.name=Db,this.enabled=this._loader.isExtensionUsed(Db),this._pathConverter=(0,F.g)(this._loader.lb),q._skipStartAnimationStep=!0;const S=q.babylonScene;S&&function(q){(0,F.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!q.activeCamera)return new C.Quaternion(NaN,NaN,NaN,NaN);const S=C.Quaternion.FromRotationMatrix(q.activeCamera.getWorldMatrix()).normalize();return q.useRightHandedSystem||(S.w*=-1,S.x*=-1),S},type:"Quaternion",getTarget:()=>q.activeCamera}),(0,F.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!q.activeCamera)return new C.yS(NaN,NaN,NaN);const S=q.activeCamera.getWorldMatrix().getTranslation();return q.useRightHandedSystem||(S.x*=-1),S},type:"yS",getTarget:()=>q.activeCamera}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:q=>{var S;return(null===(S=q._babylonAnimationGroup)||void 0===S?void 0:S.isPlaying)??!1},type:"boolean",getTarget:q=>q._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:q=>{var S;return((null===(S=q._babylonAnimationGroup)||void 0===S?void 0:S.from)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:q=>{var S;return((null===(S=q._babylonAnimationGroup)||void 0===S?void 0:S.to)??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:q=>{var S;return((null===(S=q._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup}),(0,F.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:q=>{var S;return((null===(S=q._babylonAnimationGroup)||void 0===S?void 0:S.getCurrentFrame())??0)/60},type:"number",getTarget:q=>q._babylonAnimationGroup})}(S)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var q;if(!this._loader.babylonScene||!this._pathConverter)return;const S=this._loader.babylonScene,b=null===(q=this._loader.lb.extensions)||void 0===q?void 0:q.KHR_interactivity;if(!b)return;const z=new Gb.d({GS:S});z.dispatchEventsSynchronously=!1;const C=b.graphs.map((q=>new Kb(q,this._loader.lb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(C.map((async q=>await Xb(q,{coordinator:z,pathConverter:this._pathConverter})))),z.start()}}var Fb;Fb=async()=>(await Promise.resolve().then(b.bind(b,12875))).FlowGraphGLTFDataProvider,Zb[`${Db}/${"FlowGraphGLTFDataProvider"}`]=Fb,x(Db),D(Db,!0,(q=>new xb(q)));const ab="KHR_node_visibility";(0,F.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:q=>{const S=q._babylonTransformNode;return!S||void 0===S.isVisible||S.isVisible},set:(q,S)=>{var b,z;null===(b=S._primitiveBabylonMeshes)||void 0===b||b.forEach((q=>{q.inheritVisibility=!0})),S._babylonTransformNode&&(S._babylonTransformNode.isVisible=q),null===(z=S._primitiveBabylonMeshes)||void 0===z||z.forEach((S=>{S.isVisible=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class nb{constructor(q){this.name=ab,this._loader=q,this.enabled=q.isExtensionUsed(ab)}async onReady(){var q;null===(q=this._loader.lb.nodes)||void 0===q||q.forEach((q=>{var S,b,z,C;(null===(S=q._primitiveBabylonMeshes)||void 0===S||S.forEach((q=>{q.inheritVisibility=!0})),null!==(b=q.extensions)&&void 0!==b&&b.KHR_node_visibility)&&(!1===(null===(z=q.extensions)||void 0===z?void 0:z.KHR_node_visibility.visible)&&(q._babylonTransformNode&&(q._babylonTransformNode.isVisible=!1),null===(C=q._primitiveBabylonMeshes)||void 0===C||C.forEach((q=>{q.isVisible=!1}))))}))}dispose(){this._loader=null}}x(ab),D(ab,!0,(q=>new nb(q)));const ob="KHR_node_selectability";mb("event/onSelect",ob,{LV:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rz:"FlowGraphGetVariableBlock",dataTransformer:q=>["pickedMesh_"+q[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",rz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){var g,r,I,V,l,y;const R=C[C.length-1];R.config=R.config||{},R.config.glTF=U;const G=null===(g=q.configuration)||void 0===g||null===(r=g.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Z="pickedMesh_"+G;return C[1].config.variable=Z,v._userVariables[Z]={className:"Mesh",id:null===U||void 0===U||null===(I=U.nodes)||void 0===I||null===(V=I[G]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===U||void 0===U||null===(l=U.nodes)||void 0===l||null===(y=l[G]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},C}}),(0,F.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:q=>{const S=q._babylonTransformNode;return!S||void 0===S.gI||S.gI},set:(q,S)=>{var b;null===(b=S._primitiveBabylonMeshes)||void 0===b||b.forEach((S=>{S.gI=q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"gI"],type:"boolean"});class sb{constructor(q){this.name=ob,this._loader=q,this.enabled=q.isExtensionUsed(ob)}async onReady(){var q;null===(q=this._loader.lb.nodes)||void 0===q||q.forEach((q=>{var S,b,z;null!==(S=q.extensions)&&void 0!==S&&S.KHR_node_selectability&&!1===(null===(b=q.extensions)||void 0===b?void 0:b.KHR_node_selectability.selectable)&&(null===(z=q._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((q=>{q.gI=!1})))}))}dispose(){this._loader=null}}x(ob),D(ob,!0,(q=>new sb(q)));const Ab="KHR_node_hoverability",wb="targetMeshPointerOver_";mb("event/onHoverIn",Ab,{LV:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rz:"FlowGraphGetVariableBlock",dataTransformer:q=>[wb+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){var g,r,I,V,l,y;const R=C[C.length-1];R.config=R.config||{},R.config.glTF=U;const G=null===(g=q.configuration)||void 0===g||null===(r=g.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Z=wb+G;return C[1].config.variable=Z,v._userVariables[Z]={className:"Mesh",id:null===U||void 0===U||null===(I=U.nodes)||void 0===I||null===(V=I[G]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===U||void 0===U||null===(l=U.nodes)||void 0===l||null===(y=l[G]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},C}});const Pb="targetMeshPointerOut_";mb("event/onHoverOut",Ab,{LV:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rz:"FlowGraphGetVariableBlock",dataTransformer:q=>[Pb+q[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rz:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(q,S,b,z,C,v,U){var g,r,I,V,l,y;const R=C[C.length-1];R.config=R.config||{},R.config.glTF=U;const G=null===(g=q.configuration)||void 0===g||null===(r=g.nodeIndex)||void 0===r?void 0:r.value[0];if(void 0===G||"number"!==typeof G)throw new Error("nodeIndex not found in configuration");const Z=Pb+G;return C[1].config.variable=Z,v._userVariables[Z]={className:"Mesh",id:null===U||void 0===U||null===(I=U.nodes)||void 0===I||null===(V=I[G]._babylonTransformNode)||void 0===V?void 0:V.id,uniqueId:null===U||void 0===U||null===(l=U.nodes)||void 0===l||null===(y=l[G]._babylonTransformNode)||void 0===y?void 0:y.uniqueId},C}}),(0,F.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:q=>{const S=q._babylonTransformNode;return!S||void 0===S.pointerOverDisableMeshTesting||S.pointerOverDisableMeshTesting},set:(q,S)=>{var b;null===(b=S._primitiveBabylonMeshes)||void 0===b||b.forEach((S=>{S.pointerOverDisableMeshTesting=!q}))},getTarget:q=>q._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class hb{constructor(q){this.name=Ab,this._loader=q,this.enabled=q.isExtensionUsed(Ab)}async onReady(){var q;null===(q=this._loader.lb.nodes)||void 0===q||q.forEach((q=>{var S,b,z;null!==(S=q.extensions)&&void 0!==S&&S.KHR_node_hoverability&&!1===(null===(b=q.extensions)||void 0===b?void 0:b.KHR_node_hoverability.hoverable)&&(null===(z=q._babylonTransformNode)||void 0===z||z.getChildMeshes().forEach((q=>{q.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}x(Ab),D(Ab,!0,(q=>new hb(q)));const Ob="ExtrasAsMetadata";class jb{_assignExtras(q,S){if(S.extras&&Object.keys(S.extras).length>0){const b=q.metadata=q.metadata||{};(b.lb=b.lb||{}).extras=S.extras}}constructor(q){this.name=Ob,this.enabled=!0,this._loader=q}dispose(){this._loader=null}loadNodeAsync(q,S,b){return this._loader.loadNodeAsync(q,S,(q=>{this._assignExtras(q,S),b(q)}))}loadCameraAsync(q,S,b){return this._loader.loadCameraAsync(q,S,(q=>{this._assignExtras(q,S),b(q)}))}createMaterial(q,S,b){const z=this._loader.createMaterial(q,S,b);return this._assignExtras(z,S),z}}x(Ob),D(Ob,!1,(q=>new jb(q)));b(12875)},12763:(q,S,b)=>{"use strict";b.d(S,{b:()=>J,c:()=>t,d:()=>B,g:()=>f});var z=b(10929),C=b(10921),v=b(12372),U=b(11555),g=b(11520),r=b(11532),I=b(10943),V=b(10975),l=b(11549),y=b(11659),R=b(11557),G=b(11144);class Z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Gy=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.SR=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture=q}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const S of this.skeletons)q=q.concat(S.bones);return q}}class H extends Z{}class Q{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const q=this.rootNodes;for(const z of q)z.dispose();q.length=0;const S=this.skeletons;for(const z of S)z.dispose();S.length=0;const b=this.animationGroups;for(const z of b)z.dispose();b.length=0}}class k extends Z{constructor(q){super(),this._wasAddedToScene=!1,(q=q||V.b.LastCreatedScene)&&(this.GS=q,this.proceduralTextures=[],q.gb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=q.getEngine().onContextRestoredObservable.add((()=>{for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();for(const q of this.Gy)q.rebuild();for(const q of this.textures)q._rebuild()})))}_topologicalSort(q){const S=new Map;for(const U of q)S.set(U.uniqueId,U);const b={dependsOn:new Map,dependedBy:new Map};for(const U of q){const q=U.uniqueId;b.dependsOn.set(q,new Set),b.dependedBy.set(q,new Set)}for(const U of q){const q=U.uniqueId,z=b.dependsOn.get(q);if(U instanceof l.d){const C=U.sourceMesh;S.has(C.uniqueId)&&(z.add(C.uniqueId),b.dependedBy.get(C.uniqueId).add(q))}const C=b.dependedBy.get(q);for(const v of U.getDescendants()){const z=v.uniqueId;if(S.has(z)){C.add(z);b.dependsOn.get(z).add(q)}}}const z=[],C=[];for(const U of q){const q=U.uniqueId;0===b.dependsOn.get(q).size&&(C.push(U),S.delete(q))}const v=C;for(;v.length>0;){const q=v.shift();z.push(q);const C=b.dependedBy.get(q.uniqueId);for(const z of Array.from(C.values())){const C=b.dependsOn.get(z);C.delete(q.uniqueId),0===C.size&&S.get(z)&&(v.push(S.get(z)),S.delete(z))}}return S.size>0&&(I.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),S.forEach((q=>{I.b.Error(q.name)}))),z}_addNodeAndDescendantsToList(q,S,b,z){if(b&&(!z||z(b))&&!S.has(b.uniqueId)){q.push(b),S.add(b.uniqueId);for(const C of b.getDescendants(!0))this._addNodeAndDescendantsToList(q,S,C,z)}}_isNodeInContainer(q){return q instanceof r.c&&-1!==this.meshes.indexOf(q)||(q instanceof g.e&&-1!==this.transformNodes.indexOf(q)||(q instanceof y.b&&-1!==this.lights.indexOf(q)||q instanceof R.c&&-1!==this.cameras.indexOf(q)))}_isValidHierarchy(){for(const q of this.meshes)if(q.parent&&!this._isNodeInContainer(q.parent))return I.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.transformNodes)if(q.parent&&!this._isNodeInContainer(q.parent))return I.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.lights)if(q.parent&&!this._isNodeInContainer(q.parent))return I.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;for(const q of this.cameras)if(q.parent&&!this._isNodeInContainer(q.parent))return I.b.Warn(`Node ${q.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(q){let S=arguments.length>1&&void 0!==arguments[1]&&arguments[1],b=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||C.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const z={},v={},g=new Q,r=[],I=[],V={doNotInstantiate:!0,...b},l=[],y=new Set;for(const C of this.transformNodes)null===C.parent&&this._addNodeAndDescendantsToList(l,y,C,V.predicate);for(const C of this.meshes)null===C.parent&&this._addNodeAndDescendantsToList(l,y,C,V.predicate);const R=this._topologicalSort(l),G=(b,C)=>{if(((S,b)=>{if(z[S.uniqueId]=b.uniqueId,v[b.uniqueId]=b,q&&(b.name=q(S.name)),b instanceof U.d){const q=b;if(q.morphTargetManager){const b=S.morphTargetManager;q.morphTargetManager=b.clone();for(let S=0;S<b.numTargets;S++){const C=b.getTarget(S),U=q.morphTargetManager.getTarget(S);z[C.uniqueId]=U.uniqueId,v[U.uniqueId]=U}}}})(b,C),b.parent){const q=z[b.parent.uniqueId],S=v[q];C.parent=S||b.parent}if(C.position&&b.position&&C.position.v(b.position),C.rotationQuaternion&&b.rotationQuaternion&&C.rotationQuaternion.v(b.rotationQuaternion),C.rotation&&b.rotation&&C.rotation.v(b.rotation),C.tb&&b.tb&&C.tb.v(b.tb),C.material){const U=C;if(U.material)if(S){const S=b.material;if(-1===I.indexOf(S)){let b=S.clone(q?q(S.name):"Clone of "+S.name);if(I.push(S),z[S.uniqueId]=b.uniqueId,v[b.uniqueId]=b,"MultiMaterial"===S.getClassName()){const C=S;for(const S of C.mb)S&&(b=S.clone(q?q(S.name):"Clone of "+S.name),I.push(S),z[S.uniqueId]=b.uniqueId,v[b.uniqueId]=b);C.mb=C.mb.map((q=>q&&v[z[q.uniqueId]]))}}"InstancedMesh"!==U.getClassName()&&(U.material=v[z[S.uniqueId]])}else"MultiMaterial"===U.material.getClassName()?-1===this.GS.multiMaterials.indexOf(U.material)&&this.GS.addMultiMaterial(U.material):-1===this.GS.materials.indexOf(U.material)&&this.GS.addMaterial(U.material)}null===C.parent&&g.rootNodes.push(C)};for(const C of R)if("InstancedMesh"===C.getClassName()){const q=C,S=q.sourceMesh,b=z[S.uniqueId];G(q,("number"===typeof b?v[b]:S).createInstance(q.name))}else{let q=!0;"xb"===C.getClassName()||"Node"===C.getClassName()||C.skeleton||!C.getTotalVertices||0===C.getTotalVertices()?q=!1:V.doNotInstantiate&&(q="function"===typeof V.doNotInstantiate?!V.doNotInstantiate(C):!V.doNotInstantiate);const S=q?C.createInstance(`instance of ${C.name}`):C.clone(`Clone of ${C.name}`,null,!0);if(!S)throw new Error(`Could not clone or instantiate node on Asset Container ${C.name}`);G(C,S)}for(const C of this.skeletons){if(V.predicate&&!V.predicate(C))continue;const S=C.clone(q?q(C.name):"Clone of "+C.name);for(const q of this.meshes)if(q.skeleton===C&&!q.isAnInstance){const b=v[z[q.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=S,-1!==r.indexOf(S))continue;r.push(S);for(const q of S.bones)q._linkedTransformNode&&(q._linkedTransformNode=v[z[q._linkedTransformNode.uniqueId]])}g.skeletons.push(S)}for(const C of this.animationGroups){if(V.predicate&&!V.predicate(C))continue;const S=C.clone(q?q(C.name):"Clone of "+C.name,(q=>v[z[q.uniqueId]]||q));g.animationGroups.push(S)}return g}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||C.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.GS.environmentTexture=this.environmentTexture);for(const q of this.GS._serializableComponents)q.addFromContainer(this);this.GS.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const S=[];for(const b of this.cameras)q&&!q(b)||(this.GS.addCamera(b),S.push(b));for(const b of this.lights)q&&!q(b)||(this.GS.addLight(b),S.push(b));for(const b of this.meshes)q&&!q(b)||(this.GS.NV(b),S.push(b));for(const b of this.skeletons)q&&!q(b)||this.GS.addSkeleton(b);for(const b of this.animations)q&&!q(b)||this.GS.addAnimation(b);for(const b of this.animationGroups)q&&!q(b)||this.GS.addAnimationGroup(b);for(const b of this.multiMaterials)q&&!q(b)||this.GS.addMultiMaterial(b);for(const b of this.materials)q&&!q(b)||this.GS.addMaterial(b);for(const b of this.morphTargetManagers)q&&!q(b)||this.GS.addMorphTargetManager(b);for(const b of this.geometries)q&&!q(b)||this.GS.addGeometry(b);for(const b of this.transformNodes)q&&!q(b)||(this.GS.addTransformNode(b),S.push(b));for(const b of this.actionManagers)q&&!q(b)||this.GS.addActionManager(b);for(const b of this.textures)q&&!q(b)||this.GS.addTexture(b);for(const b of this.reflectionProbes)q&&!q(b)||this.GS.addReflectionProbe(b);for(const b of S)b.parent&&-1===this.GS.getNodes().indexOf(b.parent)&&(b.setParent?b.setParent(null):b.parent=null)}removeAllFromScene(){this._isValidHierarchy()||C.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.GS.environmentTexture&&(this.GS.environmentTexture=null);for(const q of this.GS._serializableComponents)q.removeFromContainer(this)}removeFromScene(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const S of this.cameras)q&&!q(S)||this.GS.removeCamera(S);for(const S of this.lights)q&&!q(S)||this.GS.removeLight(S);for(const S of this.meshes)q&&!q(S)||this.GS.WV(S,!0);for(const S of this.skeletons)q&&!q(S)||this.GS.removeSkeleton(S);for(const S of this.animations)q&&!q(S)||this.GS.removeAnimation(S);for(const S of this.animationGroups)q&&!q(S)||this.GS.removeAnimationGroup(S);for(const S of this.multiMaterials)q&&!q(S)||this.GS.removeMultiMaterial(S);for(const S of this.materials)q&&!q(S)||this.GS.removeMaterial(S);for(const S of this.morphTargetManagers)q&&!q(S)||this.GS.removeMorphTargetManager(S);for(const S of this.geometries)q&&!q(S)||this.GS.removeGeometry(S);for(const S of this.transformNodes)q&&!q(S)||this.GS.removeTransformNode(S);for(const S of this.actionManagers)q&&!q(S)||this.GS.removeActionManager(S);for(const S of this.textures)q&&!q(S)||this.GS.removeTexture(S);for(const S of this.reflectionProbes)q&&!q(S)||this.GS.removeReflectionProbe(S)}dispose(){const q=this.cameras.slice(0);for(const R of q)R.dispose();this.cameras.length=0;const S=this.lights.slice(0);for(const R of S)R.dispose();this.lights.length=0;const b=this.meshes.slice(0);for(const R of b)R.dispose();this.meshes.length=0;const z=this.skeletons.slice(0);for(const R of z)R.dispose();this.skeletons.length=0;const C=this.animationGroups.slice(0);for(const R of C)R.dispose();this.animationGroups.length=0;const v=this.multiMaterials.slice(0);for(const R of v)R.dispose();this.multiMaterials.length=0;const U=this.materials.slice(0);for(const R of U)R.dispose();this.materials.length=0;const g=this.geometries.slice(0);for(const R of g)R.dispose();this.geometries.length=0;const r=this.transformNodes.slice(0);for(const R of r)R.dispose();this.transformNodes.length=0;const I=this.actionManagers.slice(0);for(const R of I)R.dispose();this.actionManagers.length=0;const V=this.textures.slice(0);for(const R of V)R.dispose();this.textures.length=0;const l=this.reflectionProbes.slice(0);for(const R of l)R.dispose();this.reflectionProbes.length=0;const y=this.morphTargetManagers.slice(0);for(const R of y)R.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const R of this.GS._serializableComponents)R.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.GS.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(q,S,b){if(q&&S)for(const z of q){let q=!0;if(b)for(const S of b)if(z===S){q=!1;break}q&&(S.push(z),z._parentContainer=this)}}moveAllFromScene(q){this._wasAddedToScene=!1,void 0===q&&(q=new H);for(const S in this)Object.prototype.hasOwnProperty.call(this,S)&&(this[S]=this[S]||("_environmentTexture"===S?null:[]),this._moveAssets(this.GS[S],this[S],q[S]));this.environmentTexture=this.GS.environmentTexture,this.removeAllFromScene()}createRootMesh(){const q=new U.d("assetContainerRootMesh",this.GS);for(const S of this.meshes)S.parent||q.addChild(S);return this.meshes.unshift(q),q}mergeAnimationsTo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.b.LastCreatedScene,S=arguments.length>1?arguments[1]:void 0,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!q)return I.b.Error("No scene available to merge animations to"),[];const z=b||(S=>{let b=null;const z=S.animations.length?S.animations[0].targetProperty:"",C=S.name.split(".").join("").split("_primitive")[0];switch(z){case"position":case"rotationQuaternion":b=q.getTransformNodeByName(S.name)||q.getTransformNodeByName(C);break;case"influence":b=q.getMorphTargetByName(S.name)||q.getMorphTargetByName(C);break;default:b=q.getNodeByName(S.name)||q.getNodeByName(C)}return b}),C=this.getNodes();for(const g of C){const q=z(g);if(null!==q){for(const S of g.animations){const b=q.animations.filter((q=>q.targetProperty===S.targetProperty));for(const S of b){const b=q.animations.indexOf(S,0);b>-1&&q.animations.splice(b,1)}}q.animations=q.animations.concat(g.animations)}}const v=[],U=this.animationGroups.slice();for(const g of U){v.push(g.clone(g.name,z));for(const q of g.animatables)q.stop()}for(const g of S){const S=z(g.target);S&&(q.beginAnimation(S,g.fromFrame,g.toFrame,g.loopAnimation,g.speedRatio,g.onAnimationEnd?g.onAnimationEnd:void 0,void 0,!0,void 0,g.onAnimationLoop?g.onAnimationLoop:void 0),q.stopAnimation(g.target))}return v}populateRootNodes(){this.rootNodes.length=0;for(const q of this.meshes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.transformNodes)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.lights)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q);for(const q of this.cameras)q.parent||-1!==this.rootNodes.indexOf(q)||this.rootNodes.push(q)}addAllAssetsToContainer(q){if(!q)return;const S=[],b=new Set;for(S.push(q);S.length>0;){const q=S.pop();if(q instanceof U.d?(q.ub&&-1===this.geometries.indexOf(q.ub)&&this.geometries.push(q.ub),this.meshes.push(q)):q instanceof l.d?this.meshes.push(q):q instanceof g.e?this.transformNodes.push(q):q instanceof y.b?this.lights.push(q):q instanceof R.c&&this.cameras.push(q),q instanceof r.c){if(q.material&&-1===this.materials.indexOf(q.material)){this.materials.push(q.material);for(const S of q.material.getActiveTextures())-1===this.textures.indexOf(S)&&this.textures.push(S)}q.skeleton&&-1===this.skeletons.indexOf(q.skeleton)&&this.skeletons.push(q.skeleton),q.morphTargetManager&&-1===this.morphTargetManagers.indexOf(q.morphTargetManager)&&this.morphTargetManagers.push(q.morphTargetManager)}for(const z of q.getChildren())b.has(z)||S.push(z);b.add(q)}this.populateRootNodes()}_getByTags(q,S,b){if(void 0===S)return q;const z=[];for(const C in q){const v=q[C];G.b&&G.b.MatchesQuery(v,S)&&(!b||b(v))&&z.push(v)}return z}getMeshesByTags(q,S){return this._getByTags(this.meshes,q,S)}getCamerasByTags(q,S){return this._getByTags(this.cameras,q,S)}getLightsByTags(q,S){return this._getByTags(this.lights,q,S)}getMaterialsByTags(q,S){return this._getByTags(this.materials,q,S).concat(this._getByTags(this.multiMaterials,q,S))}getTransformNodesByTags(q,S){return this._getByTags(this.transformNodes,q,S)}}var W=b(10990);class N{constructor(q){this.byteOffset=0,this.buffer=q}async loadAsync(q){const S=await this.buffer.readAsync(this.byteOffset,q);this._dataView=new DataView(S.buffer,S.byteOffset,S.byteLength),this._dataByteOffset=0}readUint32(){const q=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,q}readUint8Array(q){const S=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,q);return this._dataByteOffset+=q,this.byteOffset+=q,S}readString(q){return(0,W.h)(this.readUint8Array(q))}skipBytes(q){this._dataByteOffset+=q,this.byteOffset+=q}}var u=b(12771);const X="Z2xURg",T={name:"lb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:q=>-1!==q.indexOf("asset")&&-1!==q.indexOf("version")||q.startsWith("data:base64,"+X)||q.startsWith("data:;base64,"+X)||q.startsWith("data:application/octet-stream;base64,"+X)||q.startsWith("data:model/gltf-binary;base64,"+X)};var B,t,f,m=b(10977),E=b(10982);function e(q,S,b){try{return Promise.resolve(new Uint8Array(q,S,b))}catch(z){return Promise.reject(z)}}!function(q){q[q.AUTO=0]="AUTO",q[q.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(B||(B={})),function(q){q[q.NONE=0]="NONE",q[q.FIRST=1]="FIRST",q[q.ALL=2]="ALL"}(t||(t={})),function(q){q[q.LOADING=0]="LOADING",q[q.READY=1]="READY",q[q.COMPLETE=2]="COMPLETE"}(f||(f={}));class i{constructor(){this.coordinateSystemMode=B.AUTO,this.animationStartMode=t.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=q=>Promise.resolve(q),this.extensionOptions={}}v(q){q&&(this.onParsed=q.onParsed,this.coordinateSystemMode=q.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=q.animationStartMode??this.animationStartMode,this.loadNodeAnimations=q.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=q.loadSkins??this.loadSkins,this.loadMorphTargets=q.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=q.compileMaterials??this.compileMaterials,this.useClipPlane=q.useClipPlane??this.useClipPlane,this.compileShadowGenerators=q.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=q.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=q.useRangeRequests??this.useRangeRequests,this.createInstances=q.createInstances??this.createInstances,this.alwaysComputeBoundingBox=q.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=q.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=q.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=q.skipMaterials??this.skipMaterials,this.useSRGBBuffers=q.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=q.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=q.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=q.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=q.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=q.customRootNode,this.onMeshLoaded=q.onMeshLoaded,this.onSkinLoaded=q.onSkinLoaded,this.onTextureLoaded=q.onTextureLoaded,this.onMaterialLoaded=q.onMaterialLoaded,this.onCameraLoaded=q.onCameraLoaded,this.extensionOptions=q.extensionOptions??this.extensionOptions)}}class J extends i{constructor(q){super(),this.onParsedObservable=new z.d,this.onMeshLoadedObservable=new z.d,this.onSkinLoadedObservable=new z.d,this.onTextureLoadedObservable=new z.d,this.onMaterialLoadedObservable=new z.d,this.onCameraLoadedObservable=new z.d,this.onCompleteObservable=new z.d,this.onErrorObservable=new z.d,this.gb=new z.d,this.onExtensionLoadedObservable=new z.d,this.validate=!1,this.onValidatedObservable=new z.d,this._loader=null,this._state=null,this._requests=new Array,this.name=T.name,this.extensions=T.extensions,this.onLoaderStateChangedObservable=new z.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.v(q)}set onParsed(q){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),q&&(this._onParsedObserver=this.onParsedObservable.add(q))}set onMeshLoaded(q){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),q&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(q))}set onSkinLoaded(q){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),q&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((S=>q(S.node,S.skinnedNode))))}set onTextureLoaded(q){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),q&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(q))}set onMaterialLoaded(q){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),q&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(q))}set onCameraLoaded(q){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),q&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(q))}set onComplete(q){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(q)}set onError(q){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(q)}set onDispose(q){this._onDisposeObserver&&this.gb.remove(this._onDisposeObserver),this._onDisposeObserver=this.gb.add(q)}set onExtensionLoaded(q){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(q)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(q){this._loggingEnabled!==q&&(this._loggingEnabled=q,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(q){this._capturePerformanceCounters!==q&&(this._capturePerformanceCounters=q,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(q){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(q)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const q of this._requests)q.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=q=>Promise.resolve(q),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.gb.notifyObservers(void 0),this.gb.clear()}loadFile(q,S,b,v,U,g,r,V){if(ArrayBuffer.isView(S))return this._loadBinary(q,S,b,v,r,V),null;this._progressCallback=U;const l=S.name||C.Tools.GetFilename(S);if(g){if(this.useRangeRequests){this.validate&&I.b.Warn("glTF validation is not supported when range requests are enabled");const b={abort:()=>{},onCompleteObservable:new z.d},C={readAsync:(b,z)=>new Promise(((C,v)=>{this._loadFile(q,S,(q=>{C(new Uint8Array(q))}),!0,(q=>{v(q)}),(q=>{q.setRequestHeader("Range",`bytes=${b}-${b+z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new N(C)).then((q=>{b.onCompleteObservable.notifyObservers(b),v(q)}),r?q=>r(void 0,q):void 0),b}return this._loadFile(q,S,(S=>{this._validate(q,new Uint8Array(S,0,S.byteLength),b,l),this._unpackBinaryAsync(new N({readAsync:(q,b)=>e(S,q,b),byteLength:S.byteLength})).then((q=>{v(q)}),r?q=>r(void 0,q):void 0)}),!0,r)}return this._loadFile(q,S,(S=>{try{this._validate(q,S,b,l),v({json:this._parseJson(S)})}catch{r&&r()}}),!1,r)}_loadBinary(q,S,b,z,C,v){this._validate(q,new Uint8Array(S.buffer,S.byteOffset,S.byteLength),b,v),this._unpackBinaryAsync(new N({readAsync:(q,b)=>function(q,S,b){try{if(S<0||S>=q.byteLength)throw new RangeError("Offset is out of range.");if(S+b>q.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(q.buffer,q.byteOffset+S,b))}catch(z){return Promise.reject(z)}}(S,q,b),byteLength:S.byteLength})).then((q=>{z(q)}),C?q=>C(void 0,q):void 0)}importMeshAsync(q,S,b,z,C,v){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${v||""}`),this._loader=this._getLoader(b),this._loader.importMeshAsync(q,S,null,b,z,C,v))))}loadAsync(q,S,b,z,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(S),this._loader.loadAsync(q,S,b,z,C))))}loadAssetContainerAsync(q,S,b,z,C){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(S),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(S);const v=new k(q),U=[];this.onMaterialLoadedObservable.add((q=>{U.push(q)}));const g=[];this.onTextureLoadedObservable.add((q=>{g.push(q)}));const r=[];this.onCameraLoadedObservable.add((q=>{r.push(q)}));const I=[];return this.onMeshLoadedObservable.add((q=>{q.morphTargetManager&&I.push(q.morphTargetManager)})),this._loader.importMeshAsync(null,q,v,S,b,z,C).then((q=>(Array.prototype.push.apply(v.geometries,q.geometries),Array.prototype.push.apply(v.meshes,q.meshes),Array.prototype.push.apply(v.Gy,q.Gy),Array.prototype.push.apply(v.skeletons,q.skeletons),Array.prototype.push.apply(v.animationGroups,q.animationGroups),Array.prototype.push.apply(v.materials,U),Array.prototype.push.apply(v.textures,g),Array.prototype.push.apply(v.lights,q.lights),Array.prototype.push.apply(v.transformNodes,q.transformNodes),Array.prototype.push.apply(v.cameras,r),Array.prototype.push.apply(v.morphTargetManagers,I),v)))}))}canDirectLoad(q){return T.canDirectLoad(q)}directLoad(q,S){if(S.startsWith("base64,"+X)||S.startsWith(";base64,"+X)||S.startsWith("application/octet-stream;base64,"+X)||S.startsWith("model/gltf-binary;base64,"+X)){const b=(0,m.b)(S);return this._validate(q,new Uint8Array(b,0,b.byteLength)),this._unpackBinaryAsync(new N({readAsync:(q,S)=>e(b,q,S),byteLength:b.byteLength}))}return this._validate(q,S),Promise.resolve({json:this._parseJson(S)})}createPlugin(q){return new J(q[T.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((q,S)=>{this.onCompleteObservable.addOnce((()=>{q()})),this.onErrorObservable.addOnce((q=>{S(q)}))}))}_setState(q){this._state!==q&&(this._state=q,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(f[this._state]))}_loadFile(q,S,b,z,C,v){const U=q._loadFile(S,b,(q=>{this._onProgress(q,U)}),!0,z,C,v);return U.onCompleteObservable.add((()=>{U._lengthComputable=!0,U._total=U._loaded})),this._requests.push(U),U}_onProgress(q,S){if(!this._progressCallback)return;S._lengthComputable=q.lengthComputable,S._loaded=q.loaded,S._total=q.total;let b=!0,z=0,C=0;for(const v of this._requests){if(void 0===v._lengthComputable||void 0===v._loaded||void 0===v._total)return;b=b&&v._lengthComputable,z+=v._loaded,C+=v._total}this._progressCallback({lengthComputable:b,loaded:z,total:b?C:0})}_validate(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),u.b.ValidateAsync(S,b,z,(S=>this.preprocessUrlAsync(b+S).then((S=>q._loadFileAsync(S,void 0,!0,!0).then((q=>new Uint8Array(q,0,q.byteLength))))))).then((q=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(q),this.onValidatedObservable.clear()}),(q=>{this._endPerformanceCounter("Validate JSON"),C.Tools.Warn(`Failed to validate: ${q.message}`),this.onValidatedObservable.clear()})))}_getLoader(q){const S=q.json.asset||{};this._log(`Asset version: ${S.version}`),S.minVersion&&this._log(`Asset minimum version: ${S.minVersion}`),S.generator&&this._log(`Asset generator: ${S.generator}`);const b=J._parseVersion(S.version);if(!b)throw new Error("Invalid version: "+S.version);if(void 0!==S.minVersion){const q=J._parseVersion(S.minVersion);if(!q)throw new Error("Invalid minimum version: "+S.minVersion);if(J._compareVersion(q,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+S.minVersion)}const z={1:J._CreateGLTF1Loader,2:J._CreateGLTF2Loader}[b.major];if(!z)throw new Error("Unsupported version: "+S.version);return z(this)}_parseJson(q){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${q.length}`);const S=JSON.parse(q);return this._endPerformanceCounter("Parse JSON"),S}_unpackBinaryAsync(q){return this._startPerformanceCounter("Unpack Binary"),q.loadAsync(20).then((()=>{const S=q.readUint32();if(1179937895!==S)throw new E.j("Unexpected magic: "+S,E.f.GLTFLoaderUnexpectedMagicError);const b=q.readUint32();this.loggingEnabled&&this._log(`Binary version: ${b}`);const z=q.readUint32();let C;switch(this.useRangeRequests||z===q.buffer.byteLength||I.b.Warn(`Length in header does not match actual data length: ${z} != ${q.buffer.byteLength}`),b){case 1:C=this._unpackBinaryV1Async(q,z);break;case 2:C=this._unpackBinaryV2Async(q,z);break;default:throw new Error("Unsupported version: "+b)}return this._endPerformanceCounter("Unpack Binary"),C}))}_unpackBinaryV1Async(q,S){const b=q.readUint32(),z=q.readUint32();if(0!==z)throw new Error(`Unexpected content format: ${z}`);const C=S-q.byteOffset,v={json:this._parseJson(q.readString(b)),bin:null};if(0!==C){const S=q.byteOffset;v.bin={readAsync:(b,z)=>q.buffer.readAsync(S+b,z),byteLength:C}}return Promise.resolve(v)}_unpackBinaryV2Async(q,S){const b=1313821514,z=5130562,C=q.readUint32();if(q.readUint32()!==b)throw new Error("First chunk format is not JSON");return q.byteOffset+C===S?q.loadAsync(C).then((()=>({json:this._parseJson(q.readString(C)),bin:null}))):q.loadAsync(C+8).then((()=>{const v={json:this._parseJson(q.readString(C)),bin:null},U=()=>{const C=q.readUint32();switch(q.readUint32()){case b:throw new Error("Unexpected JSON chunk");case z:{const S=q.byteOffset;v.bin={readAsync:(b,z)=>q.buffer.readAsync(S+b,z),byteLength:C},q.skipBytes(C);break}default:q.skipBytes(C)}return q.byteOffset!==S?q.loadAsync(8).then(U):Promise.resolve(v)};return U()}))}static _parseVersion(q){if("1.0"===q||"1.0.1"===q)return{major:1,minor:0};const S=(q+"").match(/^(\d+)\.(\d+)/);return S?{major:parseInt(S[1]),minor:parseInt(S[2])}:null}static _compareVersion(q,S){return q.major>S.major?1:q.major<S.major?-1:q.minor>S.minor?1:q.minor<S.minor?-1:0}_logOpen(q){this._log(q),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(q){const S=J._logSpaces.substring(0,2*this._logIndentLevel);I.b.Log(`${S}${q}`)}_logDisabled(q){}_startPerformanceCounterEnabled(q){C.Tools.StartPerformanceCounter(q)}_startPerformanceCounterDisabled(q){}_endPerformanceCounterEnabled(q){C.Tools.EndPerformanceCounter(q)}_endPerformanceCounterDisabled(q){}}J.IncrementalLoading=!0,J.HomogeneousCoordinates=!1,J._logSpaces="                                ",(0,v.d)(new J)},12771:(q,S,b)=>{"use strict";b.d(S,{b:()=>U});var z=b(10921);function C(q,S,b,z){const C={externalResourceFunction:z};return b&&(C.uri="file:"===S?b:S+b),ArrayBuffer.isView(q)?GLTFValidator.validateBytes(q,C):GLTFValidator.validateString(q,C)}function v(){const q=[];onmessage=S=>{const b=S.data;switch(b.id){case"init":importScripts(b.url);break;case"validate":C(b.data,b.rootUrl,b.fileName,(S=>new Promise(((b,z)=>{const C=q.length;q.push({resolve:b,reject:z}),postMessage({id:"getExternalResource",index:C,uri:S})})))).then((q=>{postMessage({id:"validate.resolve",value:q})}),(q=>{postMessage({id:"validate.reject",reason:q})}));break;case"getExternalResource.resolve":q[b.index].resolve(b.value);break;case"getExternalResource.reject":q[b.index].reject(b.reason)}}}class U{static ValidateAsync(q,S,b,U){return"function"===typeof Worker?new Promise(((g,r)=>{const I=`${C}(${v})()`,V=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),l=new Worker(V),y=q=>{l.removeEventListener("error",y),l.removeEventListener("message",R),r(q)},R=q=>{const S=q.data;switch(S.id){case"getExternalResource":U(S.uri).then((q=>{l.postMessage({id:"getExternalResource.resolve",index:S.index,value:q},[q.buffer])}),(q=>{l.postMessage({id:"getExternalResource.reject",index:S.index,reason:q})}));break;case"validate.resolve":l.removeEventListener("error",y),l.removeEventListener("message",R),g(S.value),l.terminate();break;case"validate.reject":l.removeEventListener("error",y),l.removeEventListener("message",R),r(S.reason),l.terminate()}};if(l.addEventListener("error",y),l.addEventListener("message",R),l.postMessage({id:"init",url:z.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(q)){const z=q.slice();l.postMessage({id:"validate",data:z,rootUrl:S,fileName:b},[z.buffer])}else l.postMessage({id:"validate",data:q,rootUrl:S,fileName:b})})):(this._LoadScriptPromise||(this._LoadScriptPromise=z.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>C(q,S,b,U))))}}U.Configuration={url:`${z.Tools._DefaultCdnUrl}/gltf_validator.js`}},13303:(q,S,b)=>{"use strict";b.d(S,{e:()=>T});var z=b(11081),C=b(11090),v=b(11137),U=b(11103),g=b(11496),r=b(11416),I=b(11172),V=b(11339),l=b(11058),y=b(11017);b(12515),b(12410),b(12428),b(12417),b(12435),b(12444),b(12452);const R="imageProcessingCompatibility",G="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";y.d.IncludesShadersStore[R]||(y.d.IncludesShadersStore[R]=G);const Z="skyPixelShader",H="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";y.d.ShadersStore[Z]||(y.d.ShadersStore[Z]=H);b(12520),b(12460),b(12468),b(12477),b(12474);const Q="skyVertexShader",k="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";y.d.ShadersStore[Q]||(y.d.ShadersStore[Q]=k);var W=b(11412),N=b(11476),u=b(11468);class X extends g.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class T extends r.b{constructor(q,S){super(q,S),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new U.yS(0,100,0),this.useSunPosition=!1,this.cameraOffset=U.yS.Zero(),this.up=U.yS.Up(),this.dithering=!1,this._cameraPosition=U.yS.Zero(),this._skyOrientation=new U.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(q,S){const b=S._drawWrapper;if(this.isFrozen&&b.effect&&b._wasPreviouslyReady)return!0;S.materialDefines||(S.materialDefines=new X);const z=S.materialDefines,C=this.Tq();if(this._isReadyForSubMesh(S))return!0;if((0,u.ab)(q,C,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,z),(0,u.S)(q,z,!0,!1),z.IMAGEPROCESSINGPOSTPROCESS!==C.imageProcessingConfiguration.applyByPostProcess&&z.markAsMiscDirty(),z.DITHER!==this.dithering&&z.markAsMiscDirty(),z.isDirty){z.markAsProcessed(),C.resetCachedMaterial();const q=new W.b;z.FOG&&q.addFallback(1,"FOG"),z.IMAGEPROCESSINGPOSTPROCESS=C.imageProcessingConfiguration.applyByPostProcess,z.DITHER=this.dithering;const b=[I.f.PositionKind];z.VERTEXCOLOR&&b.push(I.f.ColorKind);const v="sky",U=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,N.d)(U);const g=z.toString();S.setEffect(C.getEngine().createEffect(v,b,U,[],g,q,this.onCompiled,this.onError),z,this._materialContext)}return!(!S.effect||!S.effect.isReady())&&(z._renderId=C.getRenderId(),b._wasPreviouslyReady=!0,!0)}bindForSubMesh(q,S,b){const z=this.Tq(),C=b.materialDefines;if(!C)return;const v=b.effect;if(!v)return;this._activeEffect=v,this.bindOnlyWorldMatrix(q),this._activeEffect.setMatrix("viewProjection",z.getTransformMatrix()),this._mustRebind(z,v,b)&&((0,N.f)(v,this,z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,u.l)(C,v,z)),z.fogEnabled&&S.applyFog&&z.fogMode!==V.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",z.getViewMatrix()),(0,u.g)(z,S,this._activeEffect);const g=z.activeCamera;if(g){const q=g.getWorldMatrix();this._cameraPosition.x=q.m[12],this._cameraPosition.y=q.m[13],this._cameraPosition.z=q.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const q=Math.PI*(this.inclination-.5),S=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(S)*Math.cos(q),this.sunPosition.y=this.distance*Math.sin(-q),this.sunPosition.z=this.distance*Math.sin(S)*Math.cos(q),U.Quaternion.FromUnitVectorsToRef(U.yS.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(S,this._activeEffect,b)}getAnimatables(){return[]}dispose(q){super.dispose(q)}clone(q){return v.b.Clone((()=>new T(q,this.Tq())),this)}serialize(){const q=super.serialize();return q.customType="BABYLON.SkyMaterial",q}getClassName(){return"SkyMaterial"}static Parse(q,S,b){return v.b.Parse((()=>new T(q.name,S)),q,S,b)}}(0,z.e)([(0,C.J)()],T.prototype,"luminance",void 0),(0,z.e)([(0,C.J)()],T.prototype,"turbidity",void 0),(0,z.e)([(0,C.J)()],T.prototype,"rayleigh",void 0),(0,z.e)([(0,C.J)()],T.prototype,"mieCoefficient",void 0),(0,z.e)([(0,C.J)()],T.prototype,"mieDirectionalG",void 0),(0,z.e)([(0,C.J)()],T.prototype,"distance",void 0),(0,z.e)([(0,C.J)()],T.prototype,"inclination",void 0),(0,z.e)([(0,C.J)()],T.prototype,"azimuth",void 0),(0,z.e)([(0,C.F)()],T.prototype,"sunPosition",void 0),(0,z.e)([(0,C.J)()],T.prototype,"useSunPosition",void 0),(0,z.e)([(0,C.F)()],T.prototype,"cameraOffset",void 0),(0,z.e)([(0,C.F)()],T.prototype,"up",void 0),(0,z.e)([(0,C.J)()],T.prototype,"dithering",void 0),(0,l.f)("BABYLON.SkyMaterial",T)},11739:(q,S,b)=>{"use strict";function z(q,S){S.headers=q.headers||{},S.statusMessage=q.statusText,S.statusCode=q.status,S.data=q.response}function C(q,S,b){return new Promise((function(C,v){b=b||{};var U,g,r,I=new XMLHttpRequest,V=b.body,l=b.headers||{};for(U in b.timeout&&(I.timeout=b.timeout),I.ontimeout=I.onerror=function(q){q.timeout="timeout"==q.type,v(q)},I.open(q,S.href||S),I.onload=function(){for(r=I.getAllResponseHeaders().trim().split(/[\r\n]+/),z(I,I);g=r.shift();)g=g.split(": "),I.headers[g.shift().toLowerCase()]=g.join(": ");if((g=I.headers["content-type"])&&~g.indexOf("application/json"))try{I.data=JSON.parse(I.data,b.reviver)}catch(q){return z(I,q),v(q)}(I.status>=400?v:C)(I)},typeof FormData<"u"&&V instanceof FormData||V&&"object"==typeof V&&(l["content-type"]="application/json",V=JSON.stringify(V)),I.withCredentials=!!b.withCredentials,l)I.setRequestHeader(U,l[U]);I.send(V)}))}b.r(S),b.d(S,{del:()=>r,get:()=>v,patch:()=>g,post:()=>U,put:()=>I,send:()=>C});var v=C.bind(C,"GET"),U=C.bind(C,"POST"),g=C.bind(C,"PATCH"),r=C.bind(C,"DELETE"),I=C.bind(C,"PUT")},13405:(q,S,b)=>{"use strict";b.d(S,{c:()=>l});const z=.5*(Math.sqrt(3)-1),C=(3-Math.sqrt(3))/6,v=1/3,U=1/6,g=(Math.sqrt(5)-1)/4,r=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),V=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const l=class{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const S="function"==typeof q?q:function(q){let S=0,b=0,z=0,C=1;const v=function(){let q=4022871197;return function(S){S=S.toString();for(let b=0;b<S.length;b++){q+=S.charCodeAt(b);let z=.02519603282416938*q;q=z>>>0,z-=q,z*=q,q=z>>>0,z-=q,q+=4294967296*z}return 2.3283064365386963e-10*(q>>>0)}}();S=v(" "),b=v(" "),z=v(" "),S-=v(q),S<0&&(S+=1);b-=v(q),b<0&&(b+=1);z-=v(q),z<0&&(z+=1);return function(){const q=2091639*S+2.3283064365386963e-10*C;return S=b,b=z,z=q-(C=0|q)}}(q);this.p=function(q){const S=new Uint8Array(256);for(let b=0;b<256;b++)S[b]=b;for(let b=0;b<255;b++){const z=b+~~(q()*(256-b)),C=S[b];S[b]=S[z],S[z]=C}return S}(S),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let b=0;b<512;b++)this.perm[b]=this.p[255&b],this.permMod12[b]=this.perm[b]%12}noise2D(q,S){const b=this.permMod12,v=this.perm;let U=0,g=0,r=0;const V=(q+S)*z,l=Math.floor(q+V),y=Math.floor(S+V),R=(l+y)*C,G=q-(l-R),Z=S-(y-R);let H,Q;G>Z?(H=1,Q=0):(H=0,Q=1);const k=G-H+C,W=Z-Q+C,N=G-1+2*C,u=Z-1+2*C,X=255&l,T=255&y;let B=.5-G*G-Z*Z;if(B>=0){const q=3*b[X+v[T]];B*=B,U=B*B*(I[q]*G+I[q+1]*Z)}let t=.5-k*k-W*W;if(t>=0){const q=3*b[X+H+v[T+Q]];t*=t,g=t*t*(I[q]*k+I[q+1]*W)}let f=.5-N*N-u*u;if(f>=0){const q=3*b[X+1+v[T+1]];f*=f,r=f*f*(I[q]*N+I[q+1]*u)}return 70*(U+g+r)}noise3D(q,S,b){const z=this.permMod12,C=this.perm;let g,r,V,l;const y=(q+S+b)*v,R=Math.floor(q+y),G=Math.floor(S+y),Z=Math.floor(b+y),H=(R+G+Z)*U,Q=q-(R-H),k=S-(G-H),W=b-(Z-H);let N,u,X,T,B,t;Q>=k?k>=W?(N=1,u=0,X=0,T=1,B=1,t=0):Q>=W?(N=1,u=0,X=0,T=1,B=0,t=1):(N=0,u=0,X=1,T=1,B=0,t=1):k<W?(N=0,u=0,X=1,T=0,B=1,t=1):Q<W?(N=0,u=1,X=0,T=0,B=1,t=1):(N=0,u=1,X=0,T=1,B=1,t=0);const f=Q-N+U,m=k-u+U,E=W-X+U,e=Q-T+2*U,i=k-B+2*U,J=W-t+2*U,L=Q-1+.5,d=k-1+.5,K=W-1+.5,D=255&R,x=255&G,F=255&Z;let a=.6-Q*Q-k*k-W*W;if(a<0)g=0;else{const q=3*z[D+C[x+C[F]]];a*=a,g=a*a*(I[q]*Q+I[q+1]*k+I[q+2]*W)}let n=.6-f*f-m*m-E*E;if(n<0)r=0;else{const q=3*z[D+N+C[x+u+C[F+X]]];n*=n,r=n*n*(I[q]*f+I[q+1]*m+I[q+2]*E)}let o=.6-e*e-i*i-J*J;if(o<0)V=0;else{const q=3*z[D+T+C[x+B+C[F+t]]];o*=o,V=o*o*(I[q]*e+I[q+1]*i+I[q+2]*J)}let s=.6-L*L-d*d-K*K;if(s<0)l=0;else{const q=3*z[D+1+C[x+1+C[F+1]]];s*=s,l=s*s*(I[q]*L+I[q+1]*d+I[q+2]*K)}return 32*(g+r+V+l)}noise4D(q,S,b,z){const C=this.perm;let v,U,I,l,y;const R=(q+S+b+z)*g,G=Math.floor(q+R),Z=Math.floor(S+R),H=Math.floor(b+R),Q=Math.floor(z+R),k=(G+Z+H+Q)*r,W=q-(G-k),N=S-(Z-k),u=b-(H-k),X=z-(Q-k);let T=0,B=0,t=0,f=0;W>N?T++:B++,W>u?T++:t++,W>X?T++:f++,N>u?B++:t++,N>X?B++:f++,u>X?t++:f++;const m=T>=3?1:0,E=B>=3?1:0,e=t>=3?1:0,i=f>=3?1:0,J=T>=2?1:0,L=B>=2?1:0,d=t>=2?1:0,K=f>=2?1:0,D=T>=1?1:0,x=B>=1?1:0,F=t>=1?1:0,a=f>=1?1:0,n=W-m+r,o=N-E+r,s=u-e+r,A=X-i+r,w=W-J+2*r,P=N-L+2*r,h=u-d+2*r,O=X-K+2*r,j=W-D+3*r,M=N-x+3*r,p=u-F+3*r,Y=X-a+3*r,c=W-1+4*r,qq=N-1+4*r,Sq=u-1+4*r,bq=X-1+4*r,zq=255&G,Cq=255&Z,vq=255&H,Uq=255&Q;let gq=.6-W*W-N*N-u*u-X*X;if(gq<0)v=0;else{const q=C[zq+C[Cq+C[vq+C[Uq]]]]%32*4;gq*=gq,v=gq*gq*(V[q]*W+V[q+1]*N+V[q+2]*u+V[q+3]*X)}let rq=.6-n*n-o*o-s*s-A*A;if(rq<0)U=0;else{const q=C[zq+m+C[Cq+E+C[vq+e+C[Uq+i]]]]%32*4;rq*=rq,U=rq*rq*(V[q]*n+V[q+1]*o+V[q+2]*s+V[q+3]*A)}let Iq=.6-w*w-P*P-h*h-O*O;if(Iq<0)I=0;else{const q=C[zq+J+C[Cq+L+C[vq+d+C[Uq+K]]]]%32*4;Iq*=Iq,I=Iq*Iq*(V[q]*w+V[q+1]*P+V[q+2]*h+V[q+3]*O)}let Vq=.6-j*j-M*M-p*p-Y*Y;if(Vq<0)l=0;else{const q=C[zq+D+C[Cq+x+C[vq+F+C[Uq+a]]]]%32*4;Vq*=Vq,l=Vq*Vq*(V[q]*j+V[q+1]*M+V[q+2]*p+V[q+3]*Y)}let lq=.6-c*c-qq*qq-Sq*Sq-bq*bq;if(lq<0)y=0;else{const q=C[zq+1+C[Cq+1+C[vq+1+C[Uq+1]]]]%32*4;lq*=lq,y=lq*lq*(V[q]*c+V[q+1]*qq+V[q+2]*Sq+V[q+3]*bq)}return 27*(v+U+I+l+y)}}}}]);