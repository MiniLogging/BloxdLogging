/*! For license information please see w4s248.32.de25421d.chunk.js.LICENSE.txt */
(self.rsqbdnwe5e=self.rsqbdnwe5e||[]).push([[32],{14337:(N,p,T)=>{"use strict";var A=T(14339),a=T(14343),C=T(14350);T.g.__TYPEDARRAY_POOL||(T.g.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])});var U="undefined"!==typeof Uint8ClampedArray,X=T.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=a([32,0])),X.BUFFER||(X.BUFFER=a([32,0]));var y=X.DATA,e=X.BUFFER;function H(N){if(N){var p=N.length||N.byteLength,T=A.log2(p);y[T].push(N)}}function M(N){N=A.nextPow2(N);var p=A.log2(N),T=y[p];return T.length>0?T.pop():new ArrayBuffer(N)}function b(N){return new Uint8Array(M(N),0,N)}function l(N){return new Uint16Array(M(2*N),0,N)}function k(N){return new Uint32Array(M(4*N),0,N)}function x(N){return new Int8Array(M(N),0,N)}function I(N){return new Int16Array(M(2*N),0,N)}function L(N){return new Int32Array(M(4*N),0,N)}function n(N){return new Float32Array(M(4*N),0,N)}function w(N){return new Float64Array(M(8*N),0,N)}function g(N){return U?new Uint8ClampedArray(M(N),0,N):b(N)}function P(N){return new DataView(M(N),0,N)}p.free=function(N){if(C(N))e[A.log2(N.length)].push(N);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(N)&&(N=N.buffer),!N)return;var p=N.length||N.byteLength,T=0|A.log2(p);y[T].push(N)}},p.freeUint8=p.freeUint16=p.freeUint32=p.freeInt8=p.freeInt16=p.freeInt32=p.freeFloat32=p.freeFloat=p.freeFloat64=p.freeDouble=p.freeUint8Clamped=p.freeDataView=function(N){H(N.buffer)},p.freeArrayBuffer=H,p.freeBuffer=function(N){e[A.log2(N.length)].push(N)},p.malloc=function(N,p){if(void 0===p||"arraybuffer"===p)return M(N);switch(p){case"uint8":return b(N);case"uint16":return l(N);case"uint32":return k(N);case"int8":return x(N);case"int16":return I(N);case"int32":return L(N);case"float":case"float32":return n(N);case"double":case"float64":return w(N);case"uint8_clamped":return g(N);case"buffer":throw"Buffer not supported";case"data":case"dataview":return P(N);default:return null}return null},p.mallocArrayBuffer=M,p.mallocUint8=b,p.mallocUint16=l,p.mallocUint32=k,p.mallocInt8=x,p.mallocInt16=I,p.mallocInt32=L,p.mallocFloat32=p.mallocFloat=n,p.mallocFloat64=p.mallocDouble=w,p.mallocUint8Clamped=g,p.mallocDataView=P,p.clearCache=function(){for(var N=0;N<32;++N)X.UINT8[N].length=0,X.UINT16[N].length=0,X.UINT32[N].length=0,X.INT8[N].length=0,X.INT16[N].length=0,X.INT32[N].length=0,X.FLOAT[N].length=0,X.DOUBLE[N].length=0,X.UINT8C[N].length=0,y[N].length=0,e[N].length=0}},14412:(N,p,T)=>{N.exports=a;var A=T(13212);function a(N,p){if(!(this instanceof a))return new a(N,p);var T=A.create();A.add(T,N,p),this.base=A.min(A.create(),N,T),this.gH=A.clone(p),this.max=A.max(A.create(),N,T),this.mag=A.length(this.gH)}var C=a.prototype;C.width=function(){return this.gH[0]},C.height=function(){return this.gH[1]},C.depth=function(){return this.gH[2]},C.x0=function(){return this.base[0]},C.y0=function(){return this.base[1]},C.z0=function(){return this.base[2]},C.x1=function(){return this.max[0]},C.y1=function(){return this.max[1]},C.z1=function(){return this.max[2]},C.translate=function(N){return A.add(this.max,this.max,N),A.add(this.base,this.base,N),this},C.setPosition=function(N){return A.add(this.max,N,this.gH),A.j(this.base,N),this},C.expand=function(N){var p=A.create(),T=A.create();return A.max(p,N.max,this.max),A.min(T,N.base,this.base),A.Ip(p,p,T),new a(T,p)},C.intersects=function(N){return!(N.base[0]>this.max[0])&&(!(N.base[1]>this.max[1])&&(!(N.base[2]>this.max[2])&&(!(N.max[0]<this.base[0])&&(!(N.max[1]<this.base[1])&&!(N.max[2]<this.base[2])))))},C.touches=function(N){var p=this.union(N);return null!==p&&(0==p.width()||0==p.height()||0==p.depth())},C.union=function(N){if(!this.intersects(N))return null;var p=Math.max(N.base[0],this.base[0]),T=Math.max(N.base[1],this.base[1]),A=Math.max(N.base[2],this.base[2]);return new a([p,T,A],[Math.min(N.max[0],this.max[0])-p,Math.min(N.max[1],this.max[1])-T,Math.min(N.max[2],this.max[2])-A])}},14339:(N,p)=>{"use strict";function T(N){var p=32;return(N&=-N)&&p--,65535&N&&(p-=16),16711935&N&&(p-=8),252645135&N&&(p-=4),858993459&N&&(p-=2),1431655765&N&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(N){return(N>0)-(N<0)},p.abs=function(N){var p=N>>31;return(N^p)-p},p.min=function(N,p){return p^(N^p)&-(N<p)},p.max=function(N,p){return N^(N^p)&-(N<p)},p.isPow2=function(N){return!(N&N-1)&&!!N},p.log2=function(N){var p,T;return p=(N>65535)<<4,p|=T=((N>>>=p)>255)<<3,p|=T=((N>>>=T)>15)<<2,(p|=T=((N>>>=T)>3)<<1)|(N>>>=T)>>1},p.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},p.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},p.countTrailingZeros=T,p.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},p.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},p.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var A=new Array(256);!function(N){for(var p=0;p<256;++p){var T=p,A=p,a=7;for(T>>>=1;T;T>>>=1)A<<=1,A|=1&T,--a;N[p]=A<<a&255}}(A),p.reverse=function(N){return A[255&N]<<24|A[N>>>8&255]<<16|A[N>>>16&255]<<8|A[N>>>24&255]},p.interleave2=function(N,p){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(N,p){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>p&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},p.interleave3=function(N,p,T){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},p.deinterleave3=function(N,p){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>p&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},p.nextCombination=function(N){var p=N|N-1;return p+1|(~p&-~p)-1>>>T(N)+1}},14335:(N,p,T)=>{"use strict";N.exports=function(N,p,T){switch(arguments.length){case 1:return A=[],e(a=N,a,H,!0),A;case 2:return"function"===typeof p?e(N,N,p,!0):function(N,p){return A=[],e(N,p,H,!1),A}(N,p);case 3:return e(N,p,T,!1);default:throw new Error("box-intersect: Invalid arguments")}var a};var A,a=T(14337),C=T(14355),U=T(14363);function X(N,p){for(var T=0;T<N;++T)if(!(p[T]<=p[T+N]))return!0;return!1}function y(N,p,T,A){for(var a=0,C=0,U=0,y=N.length;U<y;++U){var e=N[U];if(!X(p,e)){for(var H=0;H<2*p;++H)T[a++]=e[H];A[C++]=U}}return C}function e(N,p,T,A){var X=N.length,e=p.length;if(!(X<=0||e<=0)){var H=N[0].length>>>1;if(!(H<=0)){var M,b=a.mallocDouble(2*H*X),l=a.mallocInt32(X);if((X=y(N,H,b,l))>0){if(1===H&&A)C.init(X),M=C.sweepComplete(H,T,0,X,b,l,0,X,b,l);else{var k=a.mallocDouble(2*H*e),x=a.mallocInt32(e);(e=y(p,H,k,x))>0&&(C.init(X+e),M=1===H?C.sweepBipartite(H,T,0,X,b,l,0,e,k,x):U(H,T,A,X,b,l,e,k,x),a.free(k),a.free(x))}a.free(b),a.free(l)}return M}}}function H(N,p){A.push([N,p])}},14371:(N,p)=>{"use strict";var T="d",A="ax",a="fp",C="es",U="rs",X="re",y="rb",e="bs",H="be",M="bb",b=[T,A,"vv",U,X,y,"ri",e,H,M,"bi"];function l(N){var p="bruteForce"+(N?"Full":"Partial"),A=[],U=b.slice();N||U.splice(3,0,a);var X=["function "+p+"("+U.join()+"){"];function y(p,a){var U=function(N,p,A){var a="bruteForce"+(N?"Red":"Blue")+(p?"Flip":"")+(A?"Full":""),U=["function ",a,"(",b.join(),"){","var ",C,"=2*",T,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",y="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(A?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return N?U.push(X,"Q",":",y):U.push(y,"Q",":",X),A?U.push("if(y1<x0||x1<y0)continue;"):p?U.push("if(y0<=x0||x1<y0)continue;"):U.push("if(y0<x0||x1<y0)continue;"),U.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),p?U.push("yi,xi"):U.push("xi,yi"),U.push(");if(rv!==void 0)return rv;}}}"),{name:a,code:U.join("")}}(p,a,N);A.push(U.code),X.push("return "+U.name+"("+b.join()+");")}X.push("if(re-rs>be-bs){"),N?(y(!0,!1),X.push("}else{"),y(!1,!1)):(X.push("if(fp){"),y(!0,!0),X.push("}else{"),y(!0,!1),X.push("}}else{if(fp){"),y(!1,!0),X.push("}else{"),y(!1,!1),X.push("}")),X.push("}}return "+p);var e=A.join("")+X.join("");return new Function(e)()}p.partial=l(!1),p.full=l(!0)},14363:(N,p,T)=>{"use strict";N.exports=function(N,p,T,C,H,z,R,J,f){!function(N,p){var T=8*a.log2(p+1)*(N+1)|0,C=a.nextPow2(g*T);i.length<C&&(A.free(i),i=A.mallocInt32(C));var U=a.nextPow2(P*T);K.length<U&&(A.free(K),K=A.mallocDouble(U))}(N,C+R);var G,o=0,Z=2*N;F(o++,0,0,C,0,R,T?16:0,-1/0,1/0),T||F(o++,0,0,R,0,C,1,-1/0,1/0);for(;o>0;){var mN=(o-=1)*g,q=i[mN],h=i[mN+1],j=i[mN+2],V=i[mN+3],r=i[mN+4],u=i[mN+5],Y=o*P,D=K[Y],c=K[Y+1],Q=1&u,E=!!(16&u),O=H,B=z,d=J,t=f;if(Q&&(O=J,B=f,d=H,t=z),!(2&u&&h>=(j=I(N,q,h,j,O,B,c)))&&!(4&u&&(h=L(N,q,h,j,O,B,D))>=j)){var S=j-h,s=r-V;if(E){if(N*S*(S+s)<l){if(void 0!==(G=y.scanComplete(N,q,p,h,j,O,B,V,r,d,t)))return G;continue}}else{if(N*Math.min(S,s)<M){if(void 0!==(G=U(N,q,p,Q,h,j,O,B,V,r,d,t)))return G;continue}if(N*S*s<b){if(void 0!==(G=y.scanBipartite(N,q,p,Q,h,j,O,B,V,r,d,t)))return G;continue}}var NN=k(N,q,h,j,O,B,D,c);if(h<NN)if(N*(NN-h)<M){if(void 0!==(G=X(N,q+1,p,h,NN,O,B,V,r,d,t)))return G}else if(q===N-2){if(void 0!==(G=Q?y.sweepBipartite(N,p,V,r,d,t,h,NN,O,B):y.sweepBipartite(N,p,h,NN,O,B,V,r,d,t)))return G}else F(o++,q+1,h,NN,V,r,Q,-1/0,1/0),F(o++,q+1,V,r,h,NN,1^Q,-1/0,1/0);if(NN<j){var pN=e(N,q,V,r,d,t),TN=d[Z*pN+q],AN=x(N,q,pN,r,d,t,TN);if(AN<r&&F(o++,q,NN,j,AN,r,(4|Q)+(E?16:0),TN,c),V<pN&&F(o++,q,NN,j,V,pN,(2|Q)+(E?16:0),D,TN),pN+1===AN){if(void 0!==(G=E?W(N,q,p,NN,j,O,B,pN,d,t[pN]):v(N,q,p,Q,NN,j,O,B,pN,d,t[pN])))return G}else if(pN<AN){var aN;if(E){if(NN<(aN=n(N,q,NN,j,O,B,TN))){var CN=x(N,q,NN,aN,O,B,TN);if(q===N-2){if(NN<CN&&void 0!==(G=y.sweepComplete(N,p,NN,CN,O,B,pN,AN,d,t)))return G;if(CN<aN&&void 0!==(G=y.sweepBipartite(N,p,CN,aN,O,B,pN,AN,d,t)))return G}else NN<CN&&F(o++,q+1,NN,CN,pN,AN,16,-1/0,1/0),CN<aN&&(F(o++,q+1,CN,aN,pN,AN,0,-1/0,1/0),F(o++,q+1,pN,AN,CN,aN,1,-1/0,1/0))}}else NN<(aN=Q?w(N,q,NN,j,O,B,TN):n(N,q,NN,j,O,B,TN))&&(q===N-2?G=Q?y.sweepBipartite(N,p,pN,AN,d,t,NN,aN,O,B):y.sweepBipartite(N,p,NN,aN,O,B,pN,AN,d,t):(F(o++,q+1,NN,aN,pN,AN,Q,-1/0,1/0),F(o++,q+1,pN,AN,NN,aN,1^Q,-1/0,1/0)))}}}}};var A=T(14337),a=T(14339),C=T(14371),U=C.partial,X=C.full,y=T(14355),e=T(14375),H=T(14381),M=128,b=1<<22,l=1<<22,k=H("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),x=H("lo===p0",["p0"]),I=H("lo<p0",["p0"]),L=H("hi<=p0",["p0"]),n=H("lo<=p0&&p0<=hi",["p0"]),w=H("lo<p0&&p0<=hi",["p0"]),g=6,P=2,i=A.mallocInt32(1024),K=A.mallocDouble(1024);function F(N,p,T,A,a,C,U,X,y){var e=g*N;i[e]=p,i[e+1]=T,i[e+2]=A,i[e+3]=a,i[e+4]=C,i[e+5]=U;var H=P*N;K[H]=X,K[H+1]=y}function v(N,p,T,A,a,C,U,X,y,e,H){var M=2*N,b=y*M,l=e[b+p];N:for(var k=a,x=a*M;k<C;++k,x+=M){var I=U[x+p],L=U[x+p+N];if(!(l<I||L<l)&&(!A||l!==I)){for(var n,w=X[k],g=p+1;g<N;++g){I=U[x+g],L=U[x+g+N];var P=e[b+g],i=e[b+g+N];if(L<P||i<I)continue N}if(void 0!==(n=A?T(H,w):T(w,H)))return n}}}function W(N,p,T,A,a,C,U,X,y,e){var H=2*N,M=X*H,b=y[M+p];N:for(var l=A,k=A*H;l<a;++l,k+=H){var x=U[l];if(x!==e){var I=C[k+p],L=C[k+p+N];if(!(b<I||L<b)){for(var n=p+1;n<N;++n){I=C[k+n],L=C[k+n+N];var w=y[M+n],g=y[M+n+N];if(L<w||g<I)continue N}var P=T(x,e);if(void 0!==P)return P}}}}},14375:(N,p,T)=>{"use strict";N.exports=function(N,p,T,U,X,y){if(U<=T+1)return T;var e=T,H=U,M=U+T>>>1,b=2*N,l=M,k=X[b*M+p];for(;e<H;){if(H-e<a){C(N,p,e,H,X,y),k=X[b*M+p];break}var x=H-e,I=Math.random()*x+e|0,L=X[b*I+p],n=Math.random()*x+e|0,w=X[b*n+p],g=Math.random()*x+e|0,P=X[b*g+p];L<=w?P>=w?(l=n,k=w):L>=P?(l=I,k=L):(l=g,k=P):w>=P?(l=n,k=w):P>=L?(l=I,k=L):(l=g,k=P);for(var i=b*(H-1),K=b*l,F=0;F<b;++F,++i,++K){var v=X[i];X[i]=X[K],X[K]=v}var W=y[H-1];y[H-1]=y[l],y[l]=W;for(i=b*(H-1),K=b*(l=A(N,p,e,H-1,X,y,k)),F=0;F<b;++F,++i,++K){v=X[i];X[i]=X[K],X[K]=v}W=y[H-1];if(y[H-1]=y[l],y[l]=W,M<l){for(H=l-1;e<H&&X[b*(H-1)+p]===k;)H-=1;H+=1}else{if(!(l<M))break;for(e=l+1;e<H&&X[b*e+p]===k;)e+=1}}return A(N,p,T,M,X,y,X[b*M+p])};var A=T(14381)("lo<p0",["p0"]),a=8;function C(N,p,T,A,a,C){for(var U=2*N,X=U*(T+1)+p,y=T+1;y<A;++y,X+=U)for(var e=a[X],H=y,M=U*(y-1);H>T&&a[M+p]>e;--H,M-=U){for(var b=M,l=M+U,k=0;k<U;++k,++b,++l){var x=a[b];a[b]=a[l],a[l]=x}var I=C[H];C[H]=C[H-1],C[H-1]=I}}},14381:N=>{"use strict";N.exports=function(N,T){var A="abcdef".split("").concat(T),a=[];N.indexOf("lo")>=0&&a.push("lo=e[k+n]");N.indexOf("hi")>=0&&a.push("hi=e[k+o]");return A.push(p.replace("_",a.join()).replace("$",N)),Function.apply(void 0,A)};var p="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14358:N=>{"use strict";N.exports=function(N,A){A<=4*p?T(0,A-1,N):e(0,A-1,N)};var p=32;function T(N,p,T){for(var A=2*(N+1),a=N+1;a<=p;++a){for(var C=T[A++],U=T[A++],X=a,y=A-2;X-- >N;){var e=T[y-2],H=T[y-1];if(e<C)break;if(e===C&&H<U)break;T[y]=e,T[y+1]=H,y-=2}T[y]=C,T[y+1]=U}}function A(N,p,T){p*=2;var A=T[N*=2],a=T[N+1];T[N]=T[p],T[N+1]=T[p+1],T[p]=A,T[p+1]=a}function a(N,p,T){p*=2,T[N*=2]=T[p],T[N+1]=T[p+1]}function C(N,p,T,A){p*=2,T*=2;var a=A[N*=2],C=A[N+1];A[N]=A[p],A[N+1]=A[p+1],A[p]=A[T],A[p+1]=A[T+1],A[T]=a,A[T+1]=C}function U(N,p,T,A,a){p*=2,a[N*=2]=a[p],a[p]=T,a[N+1]=a[p+1],a[p+1]=A}function X(N,p,T){p*=2;var A=T[N*=2],a=T[p];return!(A<a)&&(A!==a||T[N+1]>T[p+1])}function y(N,p,T,A){var a=A[N*=2];return a<p||a===p&&A[N+1]<T}function e(N,H,M){var b=(H-N+1)/6|0,l=N+b,k=H-b,x=N+H>>1,I=x-b,L=x+b,n=l,w=I,g=x,P=L,i=k,K=N+1,F=H-1,v=0;X(n,w,M)&&(v=n,n=w,w=v),X(P,i,M)&&(v=P,P=i,i=v),X(n,g,M)&&(v=n,n=g,g=v),X(w,g,M)&&(v=w,w=g,g=v),X(n,P,M)&&(v=n,n=P,P=v),X(g,P,M)&&(v=g,g=P,P=v),X(w,i,M)&&(v=w,w=i,i=v),X(w,g,M)&&(v=w,w=g,g=v),X(P,i,M)&&(v=P,P=i,i=v);for(var W=M[2*w],z=M[2*w+1],R=M[2*P],J=M[2*P+1],f=2*n,G=2*g,o=2*i,Z=2*l,mN=2*x,q=2*k,h=0;h<2;++h){var j=M[f+h],V=M[G+h],r=M[o+h];M[Z+h]=j,M[mN+h]=V,M[q+h]=r}a(I,N,M),a(L,H,M);for(var u=K;u<=F;++u)if(y(u,W,z,M))u!==K&&A(u,K,M),++K;else if(!y(u,R,J,M))for(;;){if(y(F,R,J,M)){y(F,W,z,M)?(C(u,K,F,M),++K,--F):(A(u,F,M),--F);break}if(--F<u)break}U(N,K-1,W,z,M),U(H,F+1,R,J,M),K-2-N<=p?T(N,K-2,M):e(N,K-2,M),H-(F+2)<=p?T(F+2,H,M):e(F+2,H,M),F-K<=p?T(K,F,M):e(K,F,M)}},14355:(N,p,T)=>{"use strict";N.exports={init:function(N){var p=a.nextPow2(N);y.length<p&&(A.free(y),y=A.mallocInt32(p));e.length<p&&(A.free(e),e=A.mallocInt32(p));H.length<p&&(A.free(H),H=A.mallocInt32(p));M.length<p&&(A.free(M),M=A.mallocInt32(p));b.length<p&&(A.free(b),b=A.mallocInt32(p));l.length<p&&(A.free(l),l=A.mallocInt32(p));var T=8*p;k.length<T&&(A.free(k),k=A.mallocDouble(T))},sweepBipartite:function(N,p,T,A,a,X,b,l,L,n){for(var w=0,g=2*N,P=N-1,i=g-1,K=T;K<A;++K){var F=X[K],v=g*K;k[w++]=a[v+P],k[w++]=-(F+1),k[w++]=a[v+i],k[w++]=F}for(K=b;K<l;++K){F=n[K]+U;var W=g*K;k[w++]=L[W+P],k[w++]=-F,k[w++]=L[W+i],k[w++]=F}var z=w>>>1;C(k,z);var R=0,J=0;for(K=0;K<z;++K){var f=0|k[2*K+1];if(f>=U)x(H,M,J--,f=f-U|0);else if(f>=0)x(y,e,R--,f);else if(f<=-U){f=-f-U|0;for(var G=0;G<R;++G){if(void 0!==(o=p(y[G],f)))return o}I(H,M,J++,f)}else{f=-f-1|0;for(G=0;G<J;++G){var o;if(void 0!==(o=p(f,H[G])))return o}I(y,e,R++,f)}}},sweepComplete:function(N,p,T,A,a,U,X,L,n,w){for(var g=0,P=2*N,i=N-1,K=P-1,F=T;F<A;++F){var v=U[F]+1<<1,W=P*F;k[g++]=a[W+i],k[g++]=-v,k[g++]=a[W+K],k[g++]=v}for(F=X;F<L;++F){v=w[F]+1<<1;var z=P*F;k[g++]=n[z+i],k[g++]=1|-v,k[g++]=n[z+K],k[g++]=1|v}var R=g>>>1;C(k,R);var J=0,f=0,G=0;for(F=0;F<R;++F){var o=0|k[2*F+1],Z=1&o;if(F<R-1&&o>>1===k[2*F+3]>>1&&(Z=2,F+=1),o<0){for(var mN=-(o>>1)-1,q=0;q<G;++q){if(void 0!==(h=p(b[q],mN)))return h}if(0!==Z)for(q=0;q<J;++q){if(void 0!==(h=p(y[q],mN)))return h}if(1!==Z)for(q=0;q<f;++q){var h;if(void 0!==(h=p(H[q],mN)))return h}0===Z?I(y,e,J++,mN):1===Z?I(H,M,f++,mN):2===Z&&I(b,l,G++,mN)}else{mN=(o>>1)-1;0===Z?x(y,e,J--,mN):1===Z?x(H,M,f--,mN):2===Z&&x(b,l,G--,mN)}}},scanBipartite:function(N,p,T,A,a,X,H,M,b,l,L,n){var w=0,g=2*N,P=p,i=p+N,K=1,F=1;A?F=U:K=U;for(var v=a;v<X;++v){var W=v+K,z=g*v;k[w++]=H[z+P],k[w++]=-W,k[w++]=H[z+i],k[w++]=W}for(v=b;v<l;++v){W=v+F;var R=g*v;k[w++]=L[R+P],k[w++]=-W}var J=w>>>1;C(k,J);var f=0;for(v=0;v<J;++v){var G=0|k[2*v+1];if(G<0){var o=!1;if((W=-G)>=U?(o=!A,W-=U):(o=!!A,W-=1),o)I(y,e,f++,W);else{var Z=n[W],mN=g*W,q=L[mN+p+1],h=L[mN+p+1+N];N:for(var j=0;j<f;++j){var V=y[j],r=g*V;if(!(h<H[r+p+1]||H[r+p+1+N]<q)){for(var u=p+2;u<N;++u)if(L[mN+u+N]<H[r+u]||H[r+u+N]<L[mN+u])continue N;var Y,D=M[V];if(void 0!==(Y=A?T(Z,D):T(D,Z)))return Y}}}}else x(y,e,f--,G-K)}},scanComplete:function(N,p,T,A,a,X,e,H,M,b,l){for(var x=0,I=2*N,L=p,n=p+N,w=A;w<a;++w){var g=w+U,P=I*w;k[x++]=X[P+L],k[x++]=-g,k[x++]=X[P+n],k[x++]=g}for(w=H;w<M;++w){g=w+1;var i=I*w;k[x++]=b[i+L],k[x++]=-g}var K=x>>>1;C(k,K);var F=0;for(w=0;w<K;++w){var v=0|k[2*w+1];if(v<0){if((g=-v)>=U)y[F++]=g-U;else{var W=l[g-=1],z=I*g,R=b[z+p+1],J=b[z+p+1+N];N:for(var f=0;f<F;++f){var G=y[f],o=e[G];if(o===W)break;var Z=I*G;if(!(J<X[Z+p+1]||X[Z+p+1+N]<R)){for(var mN=p+2;mN<N;++mN)if(b[z+mN+N]<X[Z+mN]||X[Z+mN+N]<b[z+mN])continue N;var q=T(o,W);if(void 0!==q)return q}}}}else{for(g=v-U,f=F-1;f>=0;--f)if(y[f]===g){for(mN=f+1;mN<F;++mN)y[mN-1]=y[mN];break}--F}}}};var A=T(14337),a=T(14339),C=T(14358),U=1<<28,X=1024,y=A.mallocInt32(X),e=A.mallocInt32(X),H=A.mallocInt32(X),M=A.mallocInt32(X),b=A.mallocInt32(X),l=A.mallocInt32(X),k=A.mallocDouble(8192);function x(N,p,T,A){var a=p[A],C=N[T-1];N[a]=C,p[C]=a}function I(N,p,T,A){N[T]=A,p[A]=T}},14343:N=>{"use strict";function p(N,T,A){var a=0|N[A];if(a<=0)return[];var C,U=new Array(a);if(A===N.length-1)for(C=0;C<a;++C)U[C]=T;else for(C=0;C<a;++C)U[C]=p(N,T,A+1);return U}N.exports=function(N,T){switch("undefined"===typeof T&&(T=0),typeof N){case"number":if(N>0)return function(N,p){var T,A;for(T=new Array(N),A=0;A<N;++A)T[A]=p;return T}(0|N,T);break;case"object":if("number"===typeof N.length)return p(N,T,0)}return[]}},14311:(N,p,T)=>{N.exports=function(){var N=this;this.components={},this.comps=this.components;var p=this.components,T=1,a={},C=[],U=[],X={timeout:!1,removals:[],multiComps:[]};function y(N,T){var A=p[T],C=a[T],U=C.hash[N];U&&(C.remove(N),A.Up&&(A.multi?(U.forEach((p=>{p&&A.Up(N,p)})),U.length=0):A.Up(N,U)),X.removals.push(C),e())}function e(){X.timeout||(X.timeout=!0,setTimeout(H,1))}function H(){X.timeout=!1,M()}function M(){X.multiComps.length&&function(N){for(var p=0;p<N.length;p++){var{entID:T,data:A}=N[p],a=A.hash[T];if(a){for(var C=0;C<a.length;C++)a[C]||(a.splice(C,1),C--);0===a.length&&(A.remove(T),X.removals.push(A))}}N.length=0}(X.multiComps),X.removals.length&&function(N){for(var p=0;p<N.length;p++){N[p].flush()}N.length=0}(X.removals)}this.mb=a,this._systems=C,this._renderSystems=U,this.KH=function(p){var A=T++;return Array.isArray(p)&&p.forEach((p=>N.me(A,p))),A},this.deleteEntity=function(p){return Object.keys(a).forEach((N=>{a[N].hash[p]&&y(p,N)})),N},this.VH=function(N){if(!N)throw new Error("Missing component definition");var T=N.name;if(!T)throw new Error("Component definition must have a name property.");if("string"!==typeof T)throw new Error("Component name must be a string.");if(""===T)throw new Error("Component name must be a non-empty string.");if(a[T])throw new Error(`Component ${T} already exists.`);var X={};return X.name=T,X.multi=!!N.multi,X.order=isNaN(N.order)?99:N.order,X.stateConstructor=N.stateConstructor||null,X.state=N.state||{},X.zX=N.zX||null,X.Up=N.Up||null,X.system=N.system||null,X.ZX=N.ZX||null,p[T]=X,a[T]=new A,a[T]._pendingMultiCleanup=!1,a[T]._multiCleanupIDs=X.multi?[]:null,X.system&&(C.push(T),C.sort(((N,T)=>p[N].order-p[T].order))),X.ZX&&(U.push(T),U.sort(((N,T)=>p[N].order-p[T].order))),T},this.overwriteComponent=function(N,T){var A=p[N];if(!A)throw new Error(`Unknown component: ${N}`);if(!T)throw new Error("Missing component definition");if(A.name!==T.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=N,X.multi=!!T.multi,X.order=isNaN(T.order)?99:T.order,X.state=T.state||{},X.zX=T.zX||null,X.Up=T.Up||null,X.system=T.system||null,X.ZX=T.ZX||null,p[N]=X,a[N]._pendingMultiCleanup=!1,a[N]._multiCleanupIDs=X.multi?[]:null;var y=C.indexOf(N);X.system&&y<0&&C.push(N),!X.system&&y>=0&&C.splice(y,1),C.sort(((N,T)=>p[N].order-p[T].order));var e=U.indexOf(N);X.ZX&&e<0&&U.push(N),!X.ZX&&e>=0&&U.splice(e,1),U.sort(((N,T)=>p[N].order-p[T].order));var H=X.state;return this.CH(N).forEach((N=>{for(var p in H)p in N||(N[p]=H[p]);X.zX&&X.zX(N.GX,N)})),N},this.deleteComponent=function(T){var A=a[T];if(!A)throw new Error(`Unknown component: ${T}`);A.flush(),A.list.forEach((N=>{N&&y(N.GX||N[0].GX,T)}));var X=C.indexOf(T),e=U.indexOf(T);return X>-1&&C.splice(X,1),e>-1&&U.splice(e,1),a[T].dispose(),delete a[T],delete p[T],N},this.me=function(N,T,A){var C,U=p[T],X=a[T];if(!X)throw new Error(`Unknown component: ${T}.`);if(X.hash[N]&&!U.multi)throw new Error(`Entity ${N} already has component: ${T}.`);if(U.stateConstructor){if(!(C=new U.stateConstructor).hasOwnProperty("GX"))throw new Error(`Component ${U.name} stateConstructor type does not have property __id`)}else C=Object.assign({},{GX:N},U.state,A);if(C.GX=N,U.multi){var y=X.hash[N];y||(y=[],X.add(N,y)),y.push(C)}else X.add(N,C);return U.zX&&U.zX(N,C),this},this.Oy=function(N,p){var T=a[p];if(!T)throw new Error(`Unknown component: ${p}.`);return!!T.hash[N]},this.Vy=function(p,T){if(!a[T])throw new Error(`Unknown component: ${T}.`);return y(p,T),N},this.getState=function(N,p){var T=a[p];if(!T)throw new Error(`Unknown component: ${p}.`);return T.hash[N]},this.CH=function(N){var p=a[N];if(!p)throw new Error(`Unknown component: ${N}.`);return M(),p.list},this.Mk=function(N){if(!a[N])throw new Error(`Unknown component: ${N}.`);var p=a[N].hash;return N=>p[N]},this.kk=function(N){if(!a[N])throw new Error(`Unknown component: ${N}.`);var p=a[N].hash;return N=>!!p[N]},this.OU=function(T){M();for(var A=0;A<C.length;A++){var U=C[A],X=p[U],y=a[U];X.system(T,y.list),M()}return N},this.render=function(T){M();for(var A=0;A<U.length;A++){var C=U[A],X=p[C],y=a[C];X.ZX(T,y.list),M()}return N},this.removeMultiComponent=function(T,A,C){var U=p[A],y=a[A];if(!y)throw new Error(`Unknown component: ${A}.`);if(!U.multi)throw new Error("removeMultiComponent called on non-multi component");return function(N,p,T,A){var a=T.hash[N];if(a){var C=a[A];C&&(a[A]=null,p.Up&&p.Up(N,C),X.multiComps.push({entID:N,data:T}),e())}}(T,U,y,C),N}};var A=T(14314)},14314:N=>{function p(N,p){var T=N._map[p];if(delete N.hash[p],delete N._map[p],T===N.list.length-1)N.list.pop();else{var A=N.list.pop();if(N.list[T]=A,null===A||null===A[0]){var a=N.list.length;for(var C in N._map)if(N._map[C]===a)return void(N._map[C]=T)}else{var U=A.GX||A[0].GX;N._map[U]=T}}}N.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(N,p){if("number"===typeof this._map[N]){var T=this._map[N];this.hash[N]=p,this.list[T]=p}else this._map[N]=this.list.length,this.hash[N]=p,this.list.push(p)}remove(N){var p=this._map[N];this.hash[N]=null,this.list[p]=null,this._pendingRemovals.push(N)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var N=0;N<this._pendingRemovals.length;N++){var T=this._pendingRemovals[N];null===this.hash[T]&&p(this,T)}this._pendingRemovals.length=0}}},14266:N=>{"use strict";var p,T="object"===typeof Reflect?Reflect:null,A=function(N,p,T){return Function.prototype.apply.call(N,p,T)};p=T&&"function"===typeof T.ownKeys?T.ownKeys:Object.getOwnPropertySymbols?function(N){return Object.getOwnPropertyNames(N).concat(Object.getOwnPropertySymbols(N))}:function(N){return Object.getOwnPropertyNames(N)};var a=Number.isNaN||function(N){return N!==N};function C(){C.init.call(this)}N.exports=C,N.exports.once=function(N,p){return new Promise((function(T,A){function a(T){N.removeListener(p,C),A(T)}function C(){"function"===typeof N.removeListener&&N.removeListener("error",a),T([].slice.call(arguments))}x(N,p,C,{once:!0}),"error"!==p&&function(N,p,T){"function"===typeof N.on&&x(N,"error",p,T)}(N,a,{once:!0})}))},C.EventEmitter=C,C.prototype._events=void 0,C.prototype._eventsCount=0,C.prototype._maxListeners=void 0;var U=10;function X(N){if("function"!==typeof N)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}function y(N){return void 0===N._maxListeners?C.defaultMaxListeners:N._maxListeners}function e(N,p,T,A){var a,C,U,e;if(X(T),void 0===(C=N._events)?(C=N._events=Object.create(null),N._eventsCount=0):(void 0!==C.newListener&&(N.emit("newListener",p,T.listener?T.listener:T),C=N._events),U=C[p]),void 0===U)U=C[p]=T,++N._eventsCount;else if("function"===typeof U?U=C[p]=A?[T,U]:[U,T]:A?U.unshift(T):U.push(T),(a=y(N))>0&&U.length>a&&!U.warned){U.warned=!0;var H=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(p)+" listeners added. Use emitter.setMaxListeners() to increase limit");H.name="MaxListenersExceededWarning",H.Ap=N,H.type=p,H.count=U.length,e=H,console&&console.warn&&console.warn(e)}return N}function H(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function M(N,p,T){var A={fired:!1,wrapFn:void 0,target:N,type:p,listener:T},a=H.bind(A);return a.listener=T,A.wrapFn=a,a}function b(N,p,T){var A=N._events;if(void 0===A)return[];var a=A[p];return void 0===a?[]:"function"===typeof a?T?[a.listener||a]:[a]:T?function(N){for(var p=new Array(N.length),T=0;T<p.length;++T)p[T]=N[T].listener||N[T];return p}(a):k(a,a.length)}function l(N){var p=this._events;if(void 0!==p){var T=p[N];if("function"===typeof T)return 1;if(void 0!==T)return T.length}return 0}function k(N,p){for(var T=new Array(p),A=0;A<p;++A)T[A]=N[A];return T}function x(N,p,T,A){if("function"===typeof N.on)A.once?N.once(p,T):N.on(p,T);else{if("function"!==typeof N.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N);N.addEventListener(p,(function a(C){A.once&&N.removeEventListener(p,a),T(C)}))}}Object.defineProperty(C,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(N){if("number"!==typeof N||N<0||a(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");U=N}}),C.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(N){if("number"!==typeof N||N<0||a(N))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+N+".");return this._maxListeners=N,this},C.prototype.getMaxListeners=function(){return y(this)},C.prototype.emit=function(N){for(var p=[],T=1;T<arguments.length;T++)p.push(arguments[T]);var a="error"===N,C=this._events;if(void 0!==C)a=a&&void 0===C.error;else if(!a)return!1;if(a){var U;if(p.length>0&&(U=p[0]),U instanceof Error)throw U;var X=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw X.context=U,X}var y=C[N];if(void 0===y)return!1;if("function"===typeof y)A(y,this,p);else{var e=y.length,H=k(y,e);for(T=0;T<e;++T)A(H[T],this,p)}return!0},C.prototype.addListener=function(N,p){return e(this,N,p,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(N,p){return e(this,N,p,!0)},C.prototype.once=function(N,p){return X(p),this.on(N,M(this,N,p)),this},C.prototype.prependOnceListener=function(N,p){return X(p),this.prependListener(N,M(this,N,p)),this},C.prototype.removeListener=function(N,p){var T,A,a,C,U;if(X(p),void 0===(A=this._events))return this;if(void 0===(T=A[N]))return this;if(T===p||T.listener===p)0===--this._eventsCount?this._events=Object.create(null):(delete A[N],A.removeListener&&this.emit("removeListener",N,T.listener||p));else if("function"!==typeof T){for(a=-1,C=T.length-1;C>=0;C--)if(T[C]===p||T[C].listener===p){U=T[C].listener,a=C;break}if(a<0)return this;0===a?T.shift():function(N,p){for(;p+1<N.length;p++)N[p]=N[p+1];N.pop()}(T,a),1===T.length&&(A[N]=T[0]),void 0!==A.removeListener&&this.emit("removeListener",N,U||p)}return this},C.prototype.off=C.prototype.removeListener,C.prototype.ap=function(N){var p,T,A;if(void 0===(T=this._events))return this;if(void 0===T.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==T[N]&&(0===--this._eventsCount?this._events=Object.create(null):delete T[N]),this;if(0===arguments.length){var a,C=Object.keys(T);for(A=0;A<C.length;++A)"removeListener"!==(a=C[A])&&this.ap(a);return this.ap("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(p=T[N]))this.removeListener(N,p);else if(void 0!==p)for(A=p.length-1;A>=0;A--)this.removeListener(N,p[A]);return this},C.prototype.listeners=function(N){return b(this,N,!0)},C.prototype.rawListeners=function(N){return b(this,N,!1)},C.listenerCount=function(N,p){return"function"===typeof N.listenerCount?N.listenerCount(p):l.call(N,p)},C.prototype.listenerCount=l,C.prototype.eventNames=function(){return this._eventsCount>0?p(this._events):[]}},14555:N=>{"use strict";N.exports=function(N,p,T,A,a,C){var U=+p[0],X=+p[1],y=+p[2],e=+T[0],H=+T[1],M=+T[2],b=Math.sqrt(e*e+H*H+M*M);if(0===b)throw new Error("Can't raycast along a zero vector");return function(N,p,T,A,a,C,U,X,y,e){for(var H=0,M=Math.floor,b=0|M(p),l=0|M(T),k=0|M(A),x=a>0?1:-1,I=C>0?1:-1,L=U>0?1:-1,n=Math.abs(1/a),w=Math.abs(1/C),g=Math.abs(1/U),P=n<1/0?n*(x>0?b+1-p:p-b):1/0,i=w<1/0?w*(I>0?l+1-T:T-l):1/0,K=g<1/0?g*(L>0?k+1-A:A-k):1/0,F=-1;H<=X;){var v=N(b,l,k);if(v)return y&&(y[0]=p+H*a,y[1]=T+H*C,y[2]=A+H*U),e&&(e[0]=e[1]=e[2]=0,0===F&&(e[0]=-x),1===F&&(e[1]=-I),2===F&&(e[2]=-L)),v;P<i?P<K?(b+=x,H=P,P+=n,F=0):(k+=L,H=K,K+=g,F=2):i<K?(l+=I,H=i,i+=w,F=1):(k+=L,H=K,K+=g,F=2)}return y&&(y[0]=p+H*a,y[1]=T+H*C,y[2]=A+H*U),e&&(e[0]=e[1]=e[2]=0),0}(N,U,X,y,e/=b,H/=b,M/=b,A="undefined"===typeof A?64:+A,a,C)}},14584:(N,p,T)=>{"use strict";T.d(p,{c:()=>C});var A=T(14266);function a(){this.Ml=!1,this.stopPropagation=!1,this.bl=!1,this.disabled=!1,this.maxPointerMovement=150}class C{constructor(N,p){this.version="0.7.0";var T=Object.assign({},new a,p||{});this.element=N||document,this.Ml=!!T.Ml,this.stopPropagation=!!T.stopPropagation,this.bl=!!T.bl,this.disabled=!!T.disabled,this.filterEvents=(N,p)=>!0,this.down=new A.EventEmitter,this.up=new A.EventEmitter,this.state={},this.se={dx:0,dy:0,Tk:0,Se:0,Ak:0},this.maxPointerMovement=T.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(N=>{X(this)}),{once:!0})}bind(N){for(var p=arguments.length,T=new Array(p>1?p-1:0),A=1;A<p;A++)T[A-1]=arguments[A];T.forEach((p=>{var T=this._keyBindmap[p]||[];T.includes(N)||(T.push(N),this._keyBindmap[p]=T)})),this.state[N]=!!this.state[N],this.pressCount[N]=this.pressCount[N]||0,this.releaseCount[N]=this.releaseCount[N]||0}unbind(N){for(var p in this._keyBindmap){var T=this._keyBindmap[p],A=T.indexOf(N);A>-1&&T.splice(A,1)}}getBindings(){var N={};for(var p in this._keyBindmap){this._keyBindmap[p].forEach((T=>{N[T]=N[T]||[],N[T].push(p)}))}return N}OU(){U(this.se),U(this.pressCount),U(this.releaseCount)}}function U(N){for(var p in N)N[p]=0}function X(N){window.addEventListener("keydown",k.bind(null,N,!0),!1),window.addEventListener("keyup",k.bind(null,N,!1),!1);var p={passive:!0};N.element.addEventListener("touchstart",M.bind(void 0,N),{passive:!1}),N.element.addEventListener("touchend",l.bind(void 0,N),p),N.element.addEventListener("mousedown",x.bind(null,N,!0),p),window.document.addEventListener("mouseup",x.bind(null,N,!1),p),N.element.addEventListener("touchmove",I.bind(null,N),p),N.element.addEventListener("mousemove",I.bind(null,N),p),window.PointerEvent,N.element.addEventListener("wheel",g.bind(null,N),p),N.element.addEventListener("contextmenu",P.bind(null,N),!1),window.addEventListener("blur",i.bind(null,N),!1)}var y=0,e=0,H=null;function M(N,p){p.preventDefault(),b(p)}function b(N){let p=!1;for(let T=0;T<N.touches.length;++T)if(N.touches[T].identifier===H){p=!0;break}if(!p){const p=N.changedTouches[0];y=p.clientX,e=p.clientY,H=p.identifier}}function l(N,p){for(var T=p.changedTouches,A=0;A<T.length;++A)T[A].identifier===H&&(H=null)}function k(N,p,T){K(T.code,p,N,T)}function x(N,p,T){if("pointerId"in T)if(p){if(null!==N._touches.currID)return;N._touches.currID=T.pointerId}else{if(N._touches.currID!==T.pointerId)return;N._touches.currID=null}return K("Mouse"+("button"in T?T.button+1:1),p,N,T),!1}function I(N,p){var T=p.movementX||p.mozMovementX||0,A=p.movementY||p.mozMovementY||0;if(p.touches&&0===(T|A)){var a=function(N){b(N);for(let p=0;p<N.changedTouches.length;++p)if(N.changedTouches[p].identifier==H){const T=N.changedTouches[p],A=[T.clientX-y,T.clientY-e];return y=T.clientX,e=T.clientY,A}return console.error(`Did not find touch id ${H}`),[0,0]}(p);T=a[0],A=a[1]}if((0!==T||0!==A)&&N.maxPointerMovement>0){var C=Math.abs(T-L),U=Math.abs(A-n),X=C>N.maxPointerMovement&&C/Math.abs(L||1)>12,M=U>N.maxPointerMovement&&U/Math.abs(n||1)>12,l=p.timeStamp;l-(w??l)<20&&(X||M)||(N.se.dx+=T,N.se.dy+=A,L=T||1,n=A||1),w=l}}var L=0,n=0,w=null;function g(N,p){var T=1;switch(p.deltaMode){case 0:T=1;break;case 1:T=12;break;case 2:T=N.element.clientHeight||window.innerHeight}N.se.Tk+=(p.deltaX||0)*T,N.se.Se+=(p.deltaY||0)*T,N.se.Ak+=(p.deltaZ||0)*T}function P(N,p){if(!N.bl)return p.preventDefault(),!1}function i(N){for(var p in N._keyStates)N._keyStates[p]&&(/^Mouse\d/.test(p)||K(p,!1,N,{code:p,note:"n0ygi9f377",preventDefault:()=>{},stopPropagation:()=>{}}))}function K(N,p,T,A){var a=T._keyBindmap[N];a&&(F(T._keyStates[N],p)&&(T._keyStates[N]=p,a.forEach((N=>{(!T.filterEvents||T.filterEvents(A,N))&&function(N,p,T,A){var a=p?T.pressCount:T.releaseCount;a[N]=(a[N]||0)+1;var C=T._bindPressCount[N]||0;(C+=p?1:-1)<0&&(C=0);T._bindPressCount[N]=C;var U=T.state[N];if(F(U,C)){T.state[N]=C>0;var X=p?T.down:T.up;T.disabled||X.emit(N,A)}}(N,p,T,A)}))),"button"in A||(T.Ml&&!A.defaultPrevented&&A.preventDefault(),T.stopPropagation&&A.stopPropagation()))}function F(N,p){return N?!p:p}},13300:N=>{N.exports=function(N,p,T){return N[0]=p[0]+T[0],N[1]=p[1]+T[1],N[2]=p[2]+T[2],N}},13239:(N,p,T)=>{N.exports=function(N,p){var T=A(N[0],N[1],N[2]),U=A(p[0],p[1],p[2]);a(T,T),a(U,U);var X=C(T,U);return X>1?0:Math.acos(X)};var A=T(13245),a=T(13253),C=T(13259)},13348:N=>{N.exports=function(N,p){return N[0]=Math.ceil(p[0]),N[1]=Math.ceil(p[1]),N[2]=Math.ceil(p[2]),N}},13234:N=>{N.exports=function(N){var p=new Float32Array(3);return p[0]=N[0],p[1]=N[1],p[2]=N[2],p}},13264:N=>{N.exports=function(N,p){return N[0]=p[0],N[1]=p[1],N[2]=p[2],N}},13226:N=>{N.exports=function(){var N=new Float32Array(3);return N[0]=0,N[1]=0,N[2]=0,N}},13418:N=>{N.exports=function(N,p,T){var A=p[0],a=p[1],C=p[2],U=T[0],X=T[1],y=T[2];return N[0]=a*y-C*X,N[1]=C*U-A*y,N[2]=A*X-a*U,N}},13374:(N,p,T)=>{N.exports=T(13367)},13367:N=>{N.exports=function(N,p){var T=p[0]-N[0],A=p[1]-N[1],a=p[2]-N[2];return Math.sqrt(T*T+A*A+a*a)}},13330:(N,p,T)=>{N.exports=T(13325)},13325:N=>{N.exports=function(N,p,T){return N[0]=p[0]/T[0],N[1]=p[1]/T[1],N[2]=p[2]/T[2],N}},13259:N=>{N.exports=function(N,p){return N[0]*p[0]+N[1]*p[1]+N[2]*p[2]}},13220:N=>{N.exports=1e-6},13282:(N,p,T)=>{N.exports=function(N,p){var T=N[0],a=N[1],C=N[2],U=p[0],X=p[1],y=p[2];return Math.abs(T-U)<=A*Math.max(1,Math.abs(T),Math.abs(U))&&Math.abs(a-X)<=A*Math.max(1,Math.abs(a),Math.abs(X))&&Math.abs(C-y)<=A*Math.max(1,Math.abs(C),Math.abs(y))};var A=T(13220)},13291:N=>{N.exports=function(N,p){return N[0]===p[0]&&N[1]===p[1]&&N[2]===p[2]}},13342:N=>{N.exports=function(N,p){return N[0]=Math.floor(p[0]),N[1]=Math.floor(p[1]),N[2]=Math.floor(p[2]),N}},13460:(N,p,T)=>{N.exports=function(N,p,T,a,C,U){var X,y;p||(p=3);T||(T=0);y=a?Math.min(a*p+T,N.length):N.length;for(X=T;X<y;X+=p)A[0]=N[X],A[1]=N[X+1],A[2]=N[X+2],C(A,A,U),N[X]=A[0],N[X+1]=A[1],N[X+2]=A[2];return N};var A=T(13226)()},13245:N=>{N.exports=function(N,p,T){var A=new Float32Array(3);return A[0]=N,A[1]=p,A[2]=T,A}},13212:(N,p,T)=>{N.exports={EPSILON:T(13220),create:T(13226),clone:T(13234),angle:T(13239),jU:T(13245),j:T(13264),set:T(13273),equals:T(13282),exactEquals:T(13291),add:T(13300),Ip:T(13306),sub:T(13311),multiply:T(13315),mul:T(13317),divide:T(13325),div:T(13330),min:T(13332),max:T(13338),floor:T(13342),ceil:T(13348),round:T(13350),scale:T(13353),VU:T(13362),distance:T(13367),k:T(13374),squaredDistance:T(13380),sqrDist:T(13384),length:T(13388),len:T(13391),squaredLength:T(13394),rU:T(13396),negate:T(13405),inverse:T(13410),normalize:T(13253),dot:T(13259),cross:T(13418),mX:T(13425),random:T(13433),transformMat4:T(13435),transformMat3:T(13439),transformQuat:T(13442),uU:T(13447),YU:T(13450),DU:T(13455),forEach:T(13460)}},13410:N=>{N.exports=function(N,p){return N[0]=1/p[0],N[1]=1/p[1],N[2]=1/p[2],N}},13391:(N,p,T)=>{N.exports=T(13388)},13388:N=>{N.exports=function(N){var p=N[0],T=N[1],A=N[2];return Math.sqrt(p*p+T*T+A*A)}},13425:N=>{N.exports=function(N,p,T,A){var a=p[0],C=p[1],U=p[2];return N[0]=a+A*(T[0]-a),N[1]=C+A*(T[1]-C),N[2]=U+A*(T[2]-U),N}},13338:N=>{N.exports=function(N,p,T){return N[0]=Math.max(p[0],T[0]),N[1]=Math.max(p[1],T[1]),N[2]=Math.max(p[2],T[2]),N}},13332:N=>{N.exports=function(N,p,T){return N[0]=Math.min(p[0],T[0]),N[1]=Math.min(p[1],T[1]),N[2]=Math.min(p[2],T[2]),N}},13317:(N,p,T)=>{N.exports=T(13315)},13315:N=>{N.exports=function(N,p,T){return N[0]=p[0]*T[0],N[1]=p[1]*T[1],N[2]=p[2]*T[2],N}},13405:N=>{N.exports=function(N,p){return N[0]=-p[0],N[1]=-p[1],N[2]=-p[2],N}},13253:N=>{N.exports=function(N,p){var T=p[0],A=p[1],a=p[2],C=T*T+A*A+a*a;C>0&&(C=1/Math.sqrt(C),N[0]=p[0]*C,N[1]=p[1]*C,N[2]=p[2]*C);return N}},13433:N=>{N.exports=function(N,p){p=p||1;var T=2*Math.random()*Math.PI,A=2*Math.random()-1,a=Math.sqrt(1-A*A)*p;return N[0]=Math.cos(T)*a,N[1]=Math.sin(T)*a,N[2]=A*p,N}},13447:N=>{N.exports=function(N,p,T,A){var a=T[1],C=T[2],U=p[1]-a,X=p[2]-C,y=Math.sin(A),e=Math.cos(A);return N[0]=p[0],N[1]=a+U*e-X*y,N[2]=C+U*y+X*e,N}},13450:N=>{N.exports=function(N,p,T,A){var a=T[0],C=T[2],U=p[0]-a,X=p[2]-C,y=Math.sin(A),e=Math.cos(A);return N[0]=a+X*y+U*e,N[1]=p[1],N[2]=C+X*e-U*y,N}},13455:N=>{N.exports=function(N,p,T,A){var a=T[0],C=T[1],U=p[0]-a,X=p[1]-C,y=Math.sin(A),e=Math.cos(A);return N[0]=a+U*e-X*y,N[1]=C+U*y+X*e,N[2]=p[2],N}},13350:N=>{N.exports=function(N,p){return N[0]=Math.round(p[0]),N[1]=Math.round(p[1]),N[2]=Math.round(p[2]),N}},13353:N=>{N.exports=function(N,p,T){return N[0]=p[0]*T,N[1]=p[1]*T,N[2]=p[2]*T,N}},13362:N=>{N.exports=function(N,p,T,A){return N[0]=p[0]+T[0]*A,N[1]=p[1]+T[1]*A,N[2]=p[2]+T[2]*A,N}},13273:N=>{N.exports=function(N,p,T,A){return N[0]=p,N[1]=T,N[2]=A,N}},13384:(N,p,T)=>{N.exports=T(13380)},13396:(N,p,T)=>{N.exports=T(13394)},13380:N=>{N.exports=function(N,p){var T=p[0]-N[0],A=p[1]-N[1],a=p[2]-N[2];return T*T+A*A+a*a}},13394:N=>{N.exports=function(N){var p=N[0],T=N[1],A=N[2];return p*p+T*T+A*A}},13311:(N,p,T)=>{N.exports=T(13306)},13306:N=>{N.exports=function(N,p,T){return N[0]=p[0]-T[0],N[1]=p[1]-T[1],N[2]=p[2]-T[2],N}},13439:N=>{N.exports=function(N,p,T){var A=p[0],a=p[1],C=p[2];return N[0]=A*T[0]+a*T[3]+C*T[6],N[1]=A*T[1]+a*T[4]+C*T[7],N[2]=A*T[2]+a*T[5]+C*T[8],N}},13435:N=>{N.exports=function(N,p,T){var A=p[0],a=p[1],C=p[2],U=T[3]*A+T[7]*a+T[11]*C+T[15];return U=U||1,N[0]=(T[0]*A+T[4]*a+T[8]*C+T[12])/U,N[1]=(T[1]*A+T[5]*a+T[9]*C+T[13])/U,N[2]=(T[2]*A+T[6]*a+T[10]*C+T[14])/U,N}},13442:N=>{N.exports=function(N,p,T){var A=p[0],a=p[1],C=p[2],U=T[0],X=T[1],y=T[2],e=T[3],H=e*A+X*C-y*a,M=e*a+y*A-U*C,b=e*C+U*a-X*A,l=-U*A-X*a-y*C;return N[0]=H*e+l*-U+M*-y-b*-X,N[1]=M*e+l*-X+b*-U-H*-y,N[2]=b*e+l*-y+H*-X-M*-U,N}},14290:N=>{"use strict";N.exports=function(N){for(var p=new Array(N),T=0;T<N;++T)p[T]=T;return p}},14350:N=>{N.exports=function(N){return null!=N&&null!=N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}},14559:(N,p,T)=>{"use strict";T.d(p,{e:()=>A});class A{constructor(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.UM=!1,this.XM=!1,this.aM=30,this.CM=0,this.xM=!1,this.fullscreen=!1,this.eM=function(N){},this.HM=function(){},this.lM=function(){},this.ip=function(){},this.MM=function(N){},this.onFullscreenChanged=function(N){},e((()=>{!function(N,p){N._nowObject=performance||Date,N._lastTick=0,N._renderAccum=0,N._rt=0,N._frameCB=X.bind(null,N),requestAnimationFrame(N._frameCB),p>0&&(N._intervalCB=U.bind(null,N),N._interval=setInterval(N._intervalCB,Math.max(p,1e3/N.aM/2)))}(this,p),function(N,p){if(!p)return;var T=!1,A=!1;document.addEventListener("pointerlockchange",(A=>{T=document.pointerLockElement===p,N.MM(T)})),document.addEventListener("fullscreenchange",(T=>{A=document.fullscreenElement===p,N.onFullscreenChanged(A)})),Object.defineProperty(N,"xM",{get:()=>T,set:N=>{N&&!T?y(p):T&&!N&&function(N){N.exitPointerLock&&N.exitPointerLock()}(document)}}),Object.defineProperty(N,"fullscreen",{get:()=>A,set:N=>{N&&!A?p.requestFullscreen():A&&!N&&document.exitFullscreen()}}),p.addEventListener("click",(a=>{N.UM&&!T&&y(p),N.XM&&!A&&p.requestFullscreen()}));var a=()=>N.ip();if(window.ResizeObserver){new ResizeObserver(a).observe(p)}else window.addEventListener("resize",a)}(this,N),this.lM()}))}}var a=3,C=20;function U(N){for(var p=1e3/N.aM,T=N._nowObject.now()+C,A=0;N._nowObject.now()>=N._lastTick+p&&N._nowObject.now()<T&&++A<=a;)N.eM(p),N._lastTick+=p;var U=5*(p+5),X=N._nowObject.now();if(X-N._lastTick>U)for(;X>=N._lastTick+p;)N._lastTick+=p}function X(N){requestAnimationFrame(N._frameCB),U(N);var p=N._nowObject.now(),T=p-N._rt;if(N._rt=p,N.CM>0){N._renderAccum+=T;var A=1e3/N.CM;if(N._renderAccum<A)return;N._renderAccum=Math.min(N._renderAccum-A,A)}var a=1e3/N.aM,C=(p-N._lastTick)/a;N.HM(T,C,a)}function y(N){N.requestPointerLock&&N.requestPointerLock()}var e=N=>{if("loading"===document.readyState){var p=()=>{document.removeEventListener("readystatechange",p),N()};document.addEventListener("readystatechange",p)}else setTimeout(N,1)}},14282:(N,p,T)=>{var A=T(14290),a=T(14297),C="undefined"!==typeof Float64Array;function U(N,p){return N[0]-p[0]}function X(){var N,p=this.stride,T=new Array(p.length);for(N=0;N<T.length;++N)T[N]=[Math.abs(p[N]),N];T.sort(U);var A=new Array(T.length);for(N=0;N<A.length;++N)A[N]=T[N][1];return A}function y(N,p){var T=["View",p,"d",N].join("");p<0&&(T="View_Nil"+N);var a="generic"===N;if(-1===p){var C="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(C)()}if(0===p){C="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",C)(e[N][0])}C=["'use strict'"];var U=A(p),y=U.map((function(N){return"i"+N})),H="this.offset+"+U.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),M=U.map((function(N){return"b"+N})).join(","),b=U.map((function(N){return"c"+N})).join(",");C.push("function "+T+"(a,"+M+","+b+",d){this.data=a","this.shape=["+M+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+N+"'","proto.dimension="+p),C.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+U.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===p?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),p<4?(C.push("function "+T+"_order(){"),2===p?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+T+"_set("+y.join(",")+",v){"),a?C.push("return this.data.set("+H+",v)}"):C.push("return this.data["+H+"]=v}"),C.push("proto.get=function "+T+"_get("+y.join(",")+"){"),a?C.push("return this.data.get("+H+")}"):C.push("return this.data["+H+"]}"),C.push("proto.index=function "+T+"_index(",y.join(),"){return "+H+"}"),C.push("proto.hi=function "+T+"_hi("+y.join(",")+"){return new "+T+"(this.data,"+U.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+U.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var l=U.map((function(N){return"a"+N+"=this.shape["+N+"]"})),k=U.map((function(N){return"c"+N+"=this.stride["+N+"]"}));C.push("proto.lo=function "+T+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+k.join(","));for(var x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");C.push("return new "+T+"(this.data,"+U.map((function(N){return"a"+N})).join(",")+","+U.map((function(N){return"c"+N})).join(",")+",b)}"),C.push("proto.step=function "+T+"_step("+y.join(",")+"){var "+U.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+U.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");C.push("return new "+T+"(this.data,"+U.map((function(N){return"a"+N})).join(",")+","+U.map((function(N){return"b"+N})).join(",")+",c)}");var I=new Array(p),L=new Array(p);for(x=0;x<p;++x)I[x]="a[i"+x+"]",L[x]="b[i"+x+"]";C.push("proto.transpose=function "+T+"_transpose("+y+"){"+y.map((function(N,p){return N+"=("+N+"===undefined?"+p+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+I.join(",")+","+L.join(",")+",this.offset)}"),C.push("proto.pick=function "+T+"_pick("+y+"){var a=[],b=[],c=this.offset");for(x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+U.map((function(N){return"shape["+N+"]"})).join(",")+","+U.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(e[N],X)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,p,T,A){if(void 0===N)return(0,e.array[0])([]);"number"===typeof N&&(N=[N]),void 0===p&&(p=[N.length]);var U=p.length;if(void 0===T){T=new Array(U);for(var X=U-1,H=1;X>=0;--X)T[X]=H,H*=p[X]}if(void 0===A){A=0;for(X=0;X<U;++X)T[X]<0&&(A-=(p[X]-1)*T[X])}for(var M=function(N){if(a(N))return"buffer";if(C)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),b=e[M];b.length<=U+1;)b.push(y(M,b.length-1));return(0,b[U+1])(N,p,T,A)}},14297:N=>{function p(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(p(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&p(N.slice(0,0))}(N)||!!N._isBuffer)}},14421:N=>{"use strict";var p=[],T=[],A=[],a=[],C=[],U=[],X=[],y=[],e=[],H=[],M=[],b=[];N.exports=function(N,l,k,x,I,L){for(var n=X,w=e,g=H,P=b,i=0;i<3;i++)n[i]=+k[i],g[i]=+l.max[i],w[i]=+l.base[i];L||(L=1e-10);var K=function(N,X,e,H,b,l){var k=p,x=T,I=A,L=a,n=C,w=U,g=y,P=Math.floor,i=0,K=0,F=0,v=0,W=0;if(z(),0===F)return 0;for(v=f();K<=F;){if(R(v)&&J())return i;v=f()}for(i+=F,W=0;W<3;W++)H[W]+=e[W],b[W]+=e[W];return i;function z(){if(K=0,0!==(F=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])))for(var N=0;N<3;N++){var p=e[N]>=0;L[N]=p?1:-1;var T=p?b[N]:H[N];k[N]=p?H[N]:b[N],x[N]=G(T,L[N]),I[N]=o(k[N],L[N]),g[N]=e[N]/F,n[N]=Math.abs(1/g[N]);var A=p?x[N]+1-T:T-x[N];w[N]=n[N]<1/0?n[N]*A:1/0}}function R(p){for(var T=L[0],A=0===p?x[0]:I[0],a=x[0]+T,C=L[1],U=1===p?x[1]:I[1],X=x[1]+C,y=L[2],e=2===p?x[2]:I[2],H=x[2]+y,M=A;M!=a;M+=T)for(var b=U;b!=X;b+=C)for(var l=e;l!=H;l+=y)if(N(M,b,l))return!0;return!1}function J(){i+=K;var N=L[v],p=K/F,T=M;for(W=0;W<3;W++){var A=e[W]*p;H[W]+=A,b[W]+=A,T[W]=e[W]-A}if(N>0?b[v]=Math.round(b[v]):H[v]=Math.round(H[v]),X(i,v,N,T))return!0;for(W=0;W<3;W++)e[W]=T[W];return z(),0===F}function f(){var N=w[0]<w[1]?w[0]<w[2]?0:2:w[1]<w[2]?1:2,p=w[N]-K;for(K=w[N],x[N]+=L[N],w[N]+=n[N],W=0;W<3;W++)k[W]+=p*g[W],I[W]=o(k[W],L[W]);return N}function G(N,p){return P(N-p*l)}function o(N,p){return P(N+p*l)}}(N,x,n,w,g,L);if(!I){for(i=0;i<3;i++)P[i]=k[i]>0?g[i]-l.max[i]:w[i]-l.base[i];l.translate(P)}return K}},14591:(N,p,T)=>{"use strict";T.d(p,{b:()=>M});var A=T(14412),a=T(13212);class C{constructor(N,p,T,C,U,X,y){this.aH=new A(N.base,N.gH),this.pA=p,this.friction=T,this.restitution=C,this.zU=U,this.ik=X,this.RU=!!y,this.wH=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.lx=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Le=a.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=a.create(),this._impulses=a.create(),this._sleepFrameCount=10}loadFromCopy(N){a.j(this.aH.base,N.aH.base),a.j(this.aH.gH,N.aH.gH),a.j(this.aH.max,N.aH.max),this.aH.mag=N.aH.mag,this.pA=N.pA,this.friction=N.friction,this.restitution=N.restitution,this.zU=N.zU,this.ik=N.ik,this.RU=N.RU,this.wH=N.wH,this.fluidDrag=N.fluidDrag,this.lx=N.lx,this.preventFallOffEdge=N.preventFallOffEdge,this.rolledBackLastTick=N.rolledBackLastTick,a.j(this.Le,N.Le),a.j(this.resting,N.resting),this.inFluid=N.inFluid,this._ratioInFluid=N._ratioInFluid,a.j(this._forces,N._forces),a.j(this._impulses,N._impulses),this._sleepFrameCount=N._sleepFrameCount}setPosition(N){U(N),a.Ip(N,N,this.aH.base),this.aH.translate(N),this.Pe()}dp(){return a.clone(this.aH.base)}applyForce(N){U(N),a.add(this._forces,this._forces,N),this.Pe()}applyImpulse(N){U(N),a.add(this._impulses,this._impulses,N),this.Pe()}Pe(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var U=N=>{};var X=T(14412),y=T(13212),e=T(14421);function H(){this.wH=.1,this.fluidDrag=.4,this.ZU=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function M(N,p,T){N=Object.assign(new H,N),this.gravity=N.gravity||[0,-10,0],this.wH=N.wH||.1,this.ZU=N.ZU||2,this.fluidDrag=N.fluidDrag||.4,this.minBounceImpulse=N.minBounceImpulse,this.bodies=[],this.Ql=N.Ql,this.testSolid=p,this.testFluid=T}M.prototype.Jk=function(N,p,T,A,a,U){N=N||new X([0,0,0],[1,1,1]),"undefined"==typeof p&&(p=1),"undefined"==typeof T&&(T=1),"undefined"==typeof A&&(A=0),"undefined"==typeof a&&(a=1);var y=new C(N,p,T,A,a,U);return this.bodies.push(y),y},M.prototype.fk=function(N){var p=this.bodies.indexOf(N);p<0||(this.bodies.splice(p,1),N.aH=N.ik=null)};var b=y.create(),l=y.create(),k=y.create(),x=y.create(),I=y.create(),L=y.create(),n=y.create(),w=new X([0,0,0],[1,1,1]),g=new C(w,1,1,0,1,(()=>{}),!1);function P(N,p,T){return p=T,p*=1-(1-N.ratioInFluid)**2}M.prototype.OU=function(N){N/=1e3;var p=j(0,y.squaredLength(this.gravity));this.bodies.forEach((T=>function(N,p,T,A){y.j(I,p.resting),N.Ql&&g.loadFromCopy(p);if(p.pA<=0)return y.set(p.Le,0,0,0),y.set(p._forces,0,0,0),void y.set(p._impulses,0,0,0);var a=A||0===p.zU;if(function(N,p,T,A){if(p._sleepFrameCount>0)return!1;if(A)return!0;var a=!1,C=.5*T*T*p.zU;return y.scale(h,N.gravity,C),e(N.testSolid,p.aH,h,(function(){return a=!0,!0}),!0),a}(N,p,T,a))return;p._sleepFrameCount--,function(N,p){var T=p.aH,A=Math.floor(T.base[0]),a=Math.floor(T.base[2]),C=Math.floor(T.base[1]),U=Math.floor(T.max[1]);if(!N.testFluid(A,C,a))return p.inFluid=!1,void(p.ratioInFluid=0);var X=1,e=C+1;for(;e<=U&&N.testFluid(A,e,a);)X++,e++;var H=(C+X-T.base[1])/T.gH[1];H>1&&(H=1);var M=T.gH[0]*T.gH[1]*T.gH[2]*H,b=K;y.scale(b,N.gravity,-N.ZU*M*p.zU),p.applyForce(b),p.inFluid=!0,p.ratioInFluid=H}(N,p),r(p._forces),r(p._impulses),r(p.Le),r(p.resting),y.scale(b,p._forces,1/p.pA),y.VU(b,b,N.gravity,p.zU),y.scale(l,p._impulses,1/p.pA),y.VU(l,l,b,T),y.add(p.Le,p.Le,l),p.friction&&(F(N,0,p,l,T),F(N,1,p,l,T),F(N,2,p,l,T));var C=p.fluidDrag>=0?p.fluidDrag:N.fluidDrag,U=p.wH>=0?p.wH:N.wH,X=U,H=U;p.inFluid&&(X=P(p,X,p.fluidDragHoriz>=0?p.fluidDragHoriz:C),H=P(p,H,p.fluidDragVert>=0?p.fluidDragVert:C));X=Math.max(1-X*T/p.pA,0),H=Math.max(1-H*T/p.pA,0),y.set(i,X,H,X),y.multiply(p.Le,p.Le,i),y.scale(k,p.Le,T),y.set(p._forces,0,0,0),y.set(p._impulses,0,0,0),p.RU&&V(z,p.aH);y.j(L,k),y.set(n,0,0,0),p.preventFallOffEdge&&function(N,p,T,A){if(!p.resting[1]||T[1]>0)return;var a=Z;V(a,p.aH);for(var C=0;C<3;C+=2){y.set(o,0,0,0),o[C]=T[C];var U=!0;(U=(U=(U=(U=U&&!q(N,a.base[0]+o[0]+1e-5,a.base[1],a.base[2]+o[2]+1e-5))&&!q(N,a.max[0]+o[0]-1e-5,a.base[1],a.base[2]+o[2]+1e-5))&&!q(N,a.base[0]+o[0]+1e-5,a.base[1],a.max[2]+o[2]-1e-5))&&!q(N,a.max[0]+o[0]-1e-5,a.base[1],a.max[2]+o[2]-1e-5))?(A[C]=T[C]>0?1:-1,T[C]=0):0===C&&(y.set(mN,T[0],0,0),W(N,a,mN,A,p.slideOnCollision))}}(N,p,k,n);W(N,p.aH,k,p.resting,p.slideOnCollision),p.RU&&function(N,p,T,A){if(p.resting[1]>=0&&!p.inFluid)return;var a=0!==p.resting[0],C=0!==p.resting[2];if(!a&&!C)return;var U=Math.abs(A[0]/A[2]),X=4;if(!a&&U>X)return;if(!C&&U<1/X)return;y.add(J,T.base,A);var H=N.testSolid;e(H,T,A,(function(N,p,T,A){if(1!==p)return!0;A[p]=0}));var M=T.base[1],b=p.inFluid?1.951:1.001,l=Math.floor(M+b)-M;y.set(f,0,l,0);var k=!1;if(e(H,T,f,(function(N,p,T,A){return k=!0,!0})),k)return;y.Ip(G,J,T.base),G[1]=0,W(N,T,G,R,!0);var x=j(T.base[0],J[0]),I=j(T.base[2],J[2]);if(a&&!x&&(!I||!C))return;if(C&&(!x||!a)&&!I)return;var L=!0;if(L=L&&!q(N,T.base[0]+1e-5,T.base[1],T.base[2]+1e-5),L=L&&!q(N,T.max[0]-1e-5,T.base[1],T.base[2]+1e-5),L=L&&!q(N,T.base[0]+1e-5,T.base[1],T.max[2]-1e-5),L=L&&!q(N,T.max[0]-1e-5,T.base[1],T.max[2]-1e-5),L)return;V(p.aH,T),p.resting[0]=R[0],p.resting[2]=R[2],p.lx&&p.lx()}(N,p,z,L);for(var M=0;M<3;++M)p.resting[M]=p.resting[M]||n[M],x[M]=0,p.resting[M]&&(I[M]||(x[M]=-p.Le[M]),p.Le[M]=0);var w=y.length(x);w>.001&&(y.scale(x,x,p.pA),p.ik&&p.ik(x),p.restitution>0&&w>N.minBounceImpulse&&(y.scale(x,x,p.restitution),p.applyImpulse(x)));var v=y.squaredLength(p.Le);v>1e-5&&p.Pe();N.Ql&&N.Ql(p)?(p.loadFromCopy(g),p.rolledBackLastTick=!0):p.rolledBackLastTick=!1}(this,T,N,p)))};var i=y.create([0,0,0]);var K=y.create();function F(N,p,T,A,a){var C=T.resting[p],U=A[p];if(!T.alwaysApplyHorizFriction||1!==p){if(0===C)return;if(C*U<=0)return}y.j(v,T.Le),v[p]=0;var X=y.length(v);if(!j(X,0)){var e=Math.abs(T.friction*N.gravity[p]*a),H=X>e?(X-e)/X:0;T.Le[(p+1)%3]*=H,T.Le[(p+2)%3]*=H}}var v=y.create();function W(N,p,T,A,a){return y.set(A,0,0,0),e(N.testSolid,p,T,(function(N,p,T,C){A[p]=T,C[p]=0,a||(C[0]=0,C[1]=0,C[2]=0)}))}var z=new X([],[]),R=y.create(),J=y.create(),f=y.create(),G=y.create();var o=y.create(),Z=new X([],[]),mN=y.create();function q(N,p,T,A){return N.testSolid(Math.floor(p),Math.floor(T-1),Math.floor(A))}var h=y.create();function j(N,p){return Math.abs(N-p)<1e-5}function V(N,p){for(var T=0;T<3;T++)N.base[T]=p.base[T],N.max[T]=p.max[T],N.gH[T]=p.gH[T]}var r=function(N){}},13071:function(N,p){!function(N){"use strict";var p=function(N,T){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,p){N.__proto__=p}||function(N,p){for(var T in p)Object.prototype.hasOwnProperty.call(p,T)&&(N[T]=p[T])},p(N,T)};function T(N,T){if("function"!==typeof T&&null!==T)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function A(){this.constructor=N}p(N,T),N.prototype=null===T?Object.create(T):(A.prototype=T.prototype,new A)}function A(N,p,T,A){var a,C=arguments.length,U=C<3?p:null===A?A=Object.getOwnPropertyDescriptor(p,T):A;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)U=Reflect.decorate(N,p,T,A);else for(var X=N.length-1;X>=0;X--)(a=N[X])&&(U=(C<3?a(U):C>3?a(p,T,U):a(p,T))||U);return C>3&&U&&Object.defineProperty(p,T,U),U}function a(N,p,T){if(T||2===arguments.length)for(var A,a=0,C=p.length;a<C;a++)!A&&a in p||(A||(A=Array.prototype.slice.call(p,0,a)),A[a]=p[a]);return N.concat(A||Array.prototype.slice.call(p))}var C,U=255,X=213;N.OPERATION=void 0,(C=N.OPERATION||(N.OPERATION={}))[C.ADD=128]="ADD",C[C.REPLACE=0]="REPLACE",C[C.DELETE=64]="DELETE",C[C.DELETE_AND_ADD=192]="DELETE_AND_ADD",C[C.TOUCH=1]="TOUCH",C[C.CLEAR=10]="CLEAR";var y=function(){function p(N,p,T){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=N,this.setParent(p,T)}return p.prototype.setParent=function(N,p,T){var A=this;if(this.indexes||(this.indexes=this.ref instanceof GN?this.ref._definition.indexes:{}),this.parent=N,this.parentIndex=T,p)if(this.root=p,this.ref instanceof GN){var a=this.ref._definition;for(var C in a.schema){var U=this.ref[C];if(U&&U.$changes){var X=a.indexes[C];U.$changes.setParent(this.ref,p,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(N,p){if(N instanceof GN){var T=N.$changes,a=A.ref.$changes.indexes[p];T.setParent(A.ref,A.root,a)}}))},p.prototype.operation=function(N){this.changes.set(--this.currentCustomOperation,N)},p.prototype.change=function(p,T){void 0===T&&(T=N.OPERATION.ADD);var A="number"===typeof p?p:this.indexes[p];this.assertValidIndex(A,p);var a=this.changes.get(A);a&&a.op!==N.OPERATION.DELETE&&a.op!==N.OPERATION.TOUCH||this.changes.set(A,{op:a&&a.op===N.OPERATION.DELETE?N.OPERATION.DELETE_AND_ADD:T,index:A}),this.allChanges.add(A),this.changed=!0,this.touchParents()},p.prototype.touch=function(p){var T="number"===typeof p?p:this.indexes[p];this.assertValidIndex(T,p),this.changes.has(T)||this.changes.set(T,{op:N.OPERATION.TOUCH,index:T}),this.allChanges.add(T),this.touchParents()},p.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},p.prototype.getType=function(N){if(this.ref._definition)return(p=this.ref._definition).schema[p.fieldsByIndex[N]];var p,T=(p=this.parent._definition).schema[p.fieldsByIndex[this.parentIndex]];return Object.values(T)[0]},p.prototype.getChildrenFilter=function(){var N=this.parent._definition.childFilters;return N&&N[this.parentIndex]},p.prototype.getValue=function(N){return this.ref.getByIndex(N)},p.prototype.delete=function(p){var T="number"===typeof p?p:this.indexes[p];if(void 0!==T){var A=this.getValue(T);this.changes.set(T,{op:N.OPERATION.DELETE,index:T}),this.allChanges.delete(T),delete this.caches[T],A&&A.$changes&&(A.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(p," (").concat(T,")"))},p.prototype.discard=function(p,T){var A=this;void 0===p&&(p=!1),void 0===T&&(T=!1),this.ref instanceof GN||this.changes.forEach((function(p){if(p.op===N.OPERATION.DELETE){var T=A.ref.getIndex(p.index);delete A.indexes[T]}})),this.changes.clear(),this.changed=p,T&&this.allChanges.clear(),this.currentCustomOperation=0},p.prototype.discardAll=function(){var N=this;this.changes.forEach((function(p){var T=N.getValue(p.index);T&&T.$changes&&T.$changes.discardAll()})),this.discard()},p.prototype.cache=function(N,p){this.caches[N]=p},p.prototype.clone=function(){return new p(this.ref,this.parent,this.root)},p.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},p.prototype.assertValidIndex=function(N,p){if(void 0===N)throw new Error('ChangeTree: missing index for field "'.concat(p,'"'))},p}();function e(N,p,T,A){return N[p]||(N[p]=[]),N[p].push(T),null===A||void 0===A||A.forEach((function(N,p){return T(N,p)})),function(){return M(N[p],N[p].indexOf(T))}}function H(p){var T=this,A="string"!==typeof this.$changes.getType();this.$items.forEach((function(a,C){p.push({refId:T.$changes.refId,op:N.OPERATION.DELETE,field:C,value:void 0,previousValue:a}),A&&T.$changes.root.removeRef(a.$changes.refId)}))}function M(N,p){if(-1===p||p>=N.length)return!1;for(var T=N.length-1,A=p;A<T;A++)N[A]=N[A+1];return N.length=T,!0}var b=function(N,p){var T=N.toString(),A=p.toString();return T<A?-1:T>A?1:0};function l(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,p){return"symbol"===typeof p||isNaN(p)?N[p]:N.at(p)},set:function(N,p,T){if("symbol"===typeof p||isNaN(p))N[p]=T;else{var A=Array.from(N.$items.keys()),a=parseInt(A[p]||p);void 0===T||null===T?N.deleteAt(a):N.setAt(a,T)}return!0},deleteProperty:function(N,p){return"number"===typeof p?N.deleteAt(p):delete N[p],!0}})}var k=function(){function p(){for(var N=[],p=0;p<arguments.length;p++)N[p]=arguments[p];this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,N)}return p.prototype.zX=function(p,T){return void 0===T&&(T=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,p,T?this.$items:void 0)},p.prototype.Up=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,p)},p.is=function(N){return Array.isArray(N)||void 0!==N.array},Object.defineProperty(p.prototype,"length",{get:function(){return this.$items.size},set:function(N){0===N?this.clear():this.splice(N,this.length-N)},enumerable:!1,configurable:!0}),p.prototype.push=function(){for(var N,p=this,T=[],A=0;A<arguments.length;A++)T[A]=arguments[A];return T.forEach((function(T){N=p.$refId++,p.setAt(N,T)})),N},p.prototype.pop=function(){var N=Array.from(this.$indexes.values()).pop();if(void 0!==N){this.$changes.delete(N),this.$indexes.delete(N);var p=this.$items.get(N);return this.$items.delete(N),p}},p.prototype.at=function(N){var p=Array.from(this.$items.keys())[N];return this.$items.get(p)},p.prototype.setAt=function(p,T){var A,a;if(void 0!==T&&null!==T){if(this.$items.get(p)!==T){void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,p);var C=null!==(a=null===(A=this.$changes.indexes[p])||void 0===A?void 0:A.op)&&void 0!==a?a:N.OPERATION.ADD;this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,T),this.$changes.change(p,C)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},p.prototype.deleteAt=function(N){var p=Array.from(this.$items.keys())[N];return void 0!==p&&this.$deleteAt(p)},p.prototype.$deleteAt=function(N){return this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.concat=function(){for(var N,T=[],A=0;A<arguments.length;A++)T[A]=arguments[A];return new(p.bind.apply(p,a([void 0],(N=Array.from(this.$items.values())).concat.apply(N,T),!1)))},p.prototype.join=function(N){return Array.from(this.$items.values()).join(N)},p.prototype.reverse=function(){var N=this,p=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(T,A){N.setAt(p[A],T)})),this},p.prototype.shift=function(){var N=Array.from(this.$items.keys()).shift();if(void 0!==N){var p=this.$items.get(N);return this.$deleteAt(N),p}},p.prototype.slice=function(N,T){var A=new p;return A.push.apply(A,Array.from(this.$items.values()).slice(N,T)),A},p.prototype.sort=function(N){var p=this;void 0===N&&(N=b);var T=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(N).forEach((function(N,A){p.setAt(T[A],N)})),this},p.prototype.splice=function(N,p){void 0===p&&(p=this.length-N);for(var T=Array.from(this.$items.keys()),A=[],a=N;a<N+p;a++)A.push(this.$items.get(T[a])),this.$deleteAt(T[a]);return A},p.prototype.unshift=function(){for(var N=this,p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];var A=this.length,a=p.length,C=Array.from(this.$items.values());return p.forEach((function(p,T){N.setAt(T,p)})),C.forEach((function(p,T){N.setAt(a+T,p)})),A+a},p.prototype.indexOf=function(N,p){return Array.from(this.$items.values()).indexOf(N,p)},p.prototype.lastIndexOf=function(N,p){return void 0===p&&(p=this.length-1),Array.from(this.$items.values()).lastIndexOf(N,p)},p.prototype.every=function(N,p){return Array.from(this.$items.values()).every(N,p)},p.prototype.some=function(N,p){return Array.from(this.$items.values()).some(N,p)},p.prototype.forEach=function(N,p){Array.from(this.$items.values()).forEach(N,p)},p.prototype.map=function(N,p){return Array.from(this.$items.values()).map(N,p)},p.prototype.filter=function(N,p){return Array.from(this.$items.values()).filter(N,p)},p.prototype.reduce=function(N,p){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},p.prototype.reduceRight=function(N,p){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},p.prototype.find=function(N,p){return Array.from(this.$items.values()).find(N,p)},p.prototype.findIndex=function(N,p){return Array.from(this.$items.values()).findIndex(N,p)},p.prototype.fill=function(N,p,T){throw new Error("ArraySchema#fill() not implemented")},p.prototype.copyWithin=function(N,p,T){throw new Error("ArraySchema#copyWithin() not implemented")},p.prototype.toString=function(){return this.$items.toString()},p.prototype.toLocaleString=function(){return this.$items.toLocaleString()},p.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},p.prototype.includes=function(N,p){return Array.from(this.$items.values()).includes(N,p)},p.prototype.flatMap=function(N,p){throw new Error("ArraySchema#flatMap() is not supported.")},p.prototype.flat=function(N){throw new Error("ArraySchema#flat() is not supported.")},p.prototype.findLast=function(){var N=Array.from(this.$items.values());return N.findLast.apply(N,arguments)},p.prototype.findLastIndex=function(){var N=Array.from(this.$items.values());return N.findLastIndex.apply(N,arguments)},p.prototype.setIndex=function(N,p){this.$indexes.set(N,p)},p.prototype.getIndex=function(N){return this.$indexes.get(N)},p.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},p.prototype.deleteByIndex=function(N){var p=this.$indexes.get(N);this.$items.delete(p),this.$indexes.delete(N)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){return this.toArray().map((function(N){return"function"===typeof N.toJSON?N.toJSON():N}))},p.prototype.clone=function(N){return N?new(p.bind.apply(p,a([void 0],Array.from(this.$items.values()),!1))):new(p.bind.apply(p,a([void 0],this.map((function(N){return N.$changes?N.clone():N})),!1)))},p}();function x(N){return N.$proxy=!0,N=new Proxy(N,{get:function(N,p){return"symbol"!==typeof p&&"undefined"===typeof N[p]?N.get(p):N[p]},set:function(N,p,T){return"symbol"!==typeof p&&-1===p.indexOf("$")&&"zX"!==p&&"Up"!==p&&"onChange"!==p?N.set(p,T):N[p]=T,!0},deleteProperty:function(N,p){return N.delete(p),!0}})}var I=function(){function p(N){var T=this;if(this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N)if(N instanceof Map||N instanceof p)N.forEach((function(N,p){return T.set(p,N)}));else for(var A in N)this.set(A,N[A])}return p.prototype.zX=function(p,T){return void 0===T&&(T=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,p,T?this.$items:void 0)},p.prototype.Up=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,p)},p.is=function(N){return void 0!==N.map},p.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(p.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(p,Symbol.species,{get:function(){return p},enumerable:!1,configurable:!0}),p.prototype.set=function(p,T){if(void 0===T||null===T)throw new Error("MapSchema#set('".concat(p,"', ").concat(T,"): trying to set ").concat(T," value on '").concat(p,"'."));p=p.toString();var A="undefined"!==typeof this.$changes.indexes[p],a=A?this.$changes.indexes[p]:this.$refId++,C=A?N.OPERATION.REPLACE:N.OPERATION.ADD,U=void 0!==T.$changes;if(U&&T.$changes.setParent(this,this.$changes.root,a),A){if(!U&&this.$items.get(p)===T)return;U&&this.$items.get(p)!==T&&(C=N.OPERATION.ADD)}else this.$changes.indexes[p]=a,this.$indexes.set(a,p);return this.$items.set(p,T),this.$changes.change(p,C),this},p.prototype.get=function(N){return this.$items.get(N)},p.prototype.delete=function(N){return this.$changes.delete(N),this.$items.delete(N)},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(N){return this.$items.has(N)},p.prototype.forEach=function(N){this.$items.forEach(N)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.keys=function(){return this.$items.keys()},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(N,p){this.$indexes.set(N,p)},p.prototype.getIndex=function(N){return this.$indexes.get(N)},p.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},p.prototype.deleteByIndex=function(N){var p=this.$indexes.get(N);this.$items.delete(p),this.$indexes.delete(N)},p.prototype.toJSON=function(){var N={};return this.forEach((function(p,T){N[T]="function"===typeof p.toJSON?p.toJSON():p})),N},p.prototype.clone=function(N){var T;return N?T=Object.assign(new p,this):(T=new p,this.forEach((function(N,p){N.$changes?T.set(p,N.clone()):T.set(p,N)}))),T},p}(),L={};function n(N,p){L[N]=p}function w(N){return L[N]}var g=function(){function N(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return N.create=function(p){var T=new N;return T.schema=Object.assign({},p&&p.schema||{}),T.indexes=Object.assign({},p&&p.indexes||{}),T.fieldsByIndex=Object.assign({},p&&p.fieldsByIndex||{}),T.descriptors=Object.assign({},p&&p.descriptors||{}),T.deprecated=Object.assign({},p&&p.deprecated||{}),T},N.prototype.addField=function(N,p){var T=this.getNextFieldIndex();this.fieldsByIndex[T]=N,this.indexes[N]=T,this.schema[N]=Array.isArray(p)?{array:p[0]}:p},N.prototype.hasField=function(N){return void 0!==this.indexes[N]},N.prototype.addFilter=function(N,p){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[N]]=p,this.indexesWithFilters.push(this.indexes[N]),!0},N.prototype.addChildrenFilter=function(N,p){var T=this.indexes[N],A=this.schema[N];if(w(Object.keys(A)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[T]=p,!0;console.warn("@filterChildren: field '".concat(N,"' can't have children. Ignoring filter."))},N.prototype.getChildrenFilter=function(N){return this.childFilters&&this.childFilters[this.indexes[N]]},N.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},N}();function P(N){return N._context&&N._context.useFilters}var i=function(){function N(){this.types={},this.schemas=new Map,this.useFilters=!1}return N.prototype.has=function(N){return this.schemas.has(N)},N.prototype.get=function(N){return this.types[N]},N.prototype.add=function(N,p){void 0===p&&(p=this.schemas.size),N._definition=g.create(N._definition),N._typeid=p,this.types[p]=N,this.schemas.set(N,p)},N.create=function(p){return void 0===p&&(p={}),function(T){return p.context||(p.context=new N),F(T,p)}},N}(),K=new i;function F(N,p){return void 0===p&&(p={}),function(T,A){var C=p.context||K,U=T.constructor;if(U._context=C,!N)throw new Error("".concat(U.name,': @type() reference provided for "').concat(A,"\" is undefined. Make sure you don't have any circular dependencies."));C.has(U)||C.add(U);var X=U._definition;if(X.addField(A,N),X.descriptors[A]){if(X.deprecated[A])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(A,"' definition on '").concat(U.name,"'.\nCheck @type() annotation"))}catch(L){var y=L.stack.split("\n")[4].trim();throw new Error("".concat(L.message," ").concat(y))}}var e=k.is(N),H=!e&&I.is(N);if("string"!==typeof N&&!GN.is(N)){var M=Object.values(N)[0];"string"===typeof M||C.has(M)||C.add(M)}if(p.manual)X.descriptors[A]={enumerable:!0,configurable:!0,writable:!0};else{var b="_".concat(A);X.descriptors[b]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[A]={get:function(){return this[b]},set:function(N){N!==this[b]&&(void 0!==N&&null!==N?(!e||N instanceof k||(N=new(k.bind.apply(k,a([void 0],N,!1)))),!H||N instanceof I||(N=new I(N)),void 0===N.$proxy&&(H?N=x(N):e&&(N=l(N))),this.$changes.change(A),N.$changes&&N.$changes.setParent(this,this.$changes.root,this._definition.indexes[A])):this[b]&&this.$changes.delete(A),this[b]=N)},enumerable:!0,configurable:!0}}}}function v(N){return function(p,T){var A=p.constructor;A._definition.addFilter(T,N)&&(A._context.useFilters=!0)}}function W(N){return function(p,T){var A=p.constructor;A._definition.addChildrenFilter(T,N)&&(A._context.useFilters=!0)}}function z(N){return void 0===N&&(N=!0),function(p,T){var A=p.constructor._definition;A.deprecated[T]=!0,N&&(A.descriptors[T]={get:function(){throw new Error("".concat(T," is deprecated."))},set:function(N){},enumerable:!1,configurable:!0})}}function R(N,p,T){for(var A in void 0===T&&(T={}),T.context||(T.context=N._context||T.context||K),p)F(p[A],T)(N.prototype,A);return N}function J(N){for(var p=0,T=0,A=0,a=N.length;A<a;A++)(p=N.charCodeAt(A))<128?T+=1:p<2048?T+=2:p<55296||p>=57344?T+=3:(A++,T+=4);return T}function f(N,p,T){for(var A=0,a=0,C=T.length;a<C;a++)(A=T.charCodeAt(a))<128?N[p++]=A:A<2048?(N[p++]=192|A>>6,N[p++]=128|63&A):A<55296||A>=57344?(N[p++]=224|A>>12,N[p++]=128|A>>6&63,N[p++]=128|63&A):(a++,A=65536+((1023&A)<<10|1023&T.charCodeAt(a)),N[p++]=240|A>>18,N[p++]=128|A>>12&63,N[p++]=128|A>>6&63,N[p++]=128|63&A)}function G(N,p){N.push(255&p)}function o(N,p){N.push(255&p)}function Z(N,p){N.push(255&p),N.push(p>>8&255)}function mN(N,p){N.push(255&p),N.push(p>>8&255)}function q(N,p){N.push(255&p),N.push(p>>8&255),N.push(p>>16&255),N.push(p>>24&255)}function h(N,p){var T=p>>24,A=p>>16,a=p>>8,C=p;N.push(255&C),N.push(255&a),N.push(255&A),N.push(255&T)}function j(N,p){var T=Math.floor(p/Math.pow(2,32));h(N,p>>>0),h(N,T)}function V(N,p){var T=p/Math.pow(2,32)|0;h(N,p>>>0),h(N,T)}function r(N,p){Q(N,p)}function u(N,p){E(N,p)}var Y=new Int32Array(2),D=new Float32Array(Y.buffer),c=new Float64Array(Y.buffer);function Q(N,p){D[0]=p,q(N,Y[0])}function E(N,p){c[0]=p,q(N,Y[0]),q(N,Y[1])}function O(N,p){return o(N,p?1:0)}function B(N,p){p||(p="");var T=J(p),A=0;if(T<32)N.push(160|T),A=1;else if(T<256)N.push(217),o(N,T),A=2;else if(T<65536)N.push(218),mN(N,T),A=3;else{if(!(T<4294967296))throw new Error("String too long");N.push(219),h(N,T),A=5}return f(N,N.length,p),A+T}function d(N,p){return isNaN(p)?d(N,0):isFinite(p)?p!==(0|p)?(N.push(203),E(N,p),9):p>=0?p<128?(o(N,p),1):p<256?(N.push(204),o(N,p),2):p<65536?(N.push(205),mN(N,p),3):p<4294967296?(N.push(206),h(N,p),5):(N.push(207),V(N,p),9):p>=-32?(N.push(224|p+32),1):p>=-128?(N.push(208),G(N,p),2):p>=-32768?(N.push(209),Z(N,p),3):p>=-2147483648?(N.push(210),q(N,p),5):(N.push(211),j(N,p),9):d(N,p>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var t=Object.freeze({__proto__:null,utf8Write:f,int8:G,uint8:o,int16:Z,uint16:mN,int32:q,uint32:h,int64:j,uint64:V,float32:r,float64:u,writeFloat32:Q,writeFloat64:E,boolean:O,string:B,number:d});function S(N,p,T){for(var A="",a=0,C=p,U=p+T;C<U;C++){var X=N[C];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(a=(7&X)<<18|(63&N[++C])<<12|(63&N[++C])<<6|63&N[++C])>=65536?(a-=65536,A+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):A+=String.fromCharCode(a):A+=String.fromCharCode((15&X)<<12|(63&N[++C])<<6|63&N[++C]):A+=String.fromCharCode((31&X)<<6|63&N[++C]):A+=String.fromCharCode(X)}return A}function s(N,p){return NN(N,p)<<24>>24}function NN(N,p){return N[p.offset++]}function pN(N,p){return TN(N,p)<<16>>16}function TN(N,p){return N[p.offset++]|N[p.offset++]<<8}function AN(N,p){return N[p.offset++]|N[p.offset++]<<8|N[p.offset++]<<16|N[p.offset++]<<24}function aN(N,p){return AN(N,p)>>>0}function CN(N,p){return bN(N,p)}function UN(N,p){return lN(N,p)}function XN(N,p){var T=aN(N,p);return AN(N,p)*Math.pow(2,32)+T}function yN(N,p){var T=aN(N,p);return aN(N,p)*Math.pow(2,32)+T}var eN=new Int32Array(2),HN=new Float32Array(eN.buffer),MN=new Float64Array(eN.buffer);function bN(N,p){return eN[0]=AN(N,p),HN[0]}function lN(N,p){return eN[0]=AN(N,p),eN[1]=AN(N,p),MN[0]}function kN(N,p){return NN(N,p)>0}function xN(N,p){var T,A=N[p.offset++];A<192?T=31&A:217===A?T=NN(N,p):218===A?T=TN(N,p):219===A&&(T=aN(N,p));var a=S(N,p.offset,T);return p.offset+=T,a}function IN(N,p){var T=N[p.offset];return T<192&&T>160||217===T||218===T||219===T}function LN(N,p){var T=N[p.offset++];return T<128?T:202===T?bN(N,p):203===T?lN(N,p):204===T?NN(N,p):205===T?TN(N,p):206===T?aN(N,p):207===T?yN(N,p):208===T?s(N,p):209===T?pN(N,p):210===T?AN(N,p):211===T?XN(N,p):T>223?-1*(255-T+1):void 0}function nN(N,p){var T=N[p.offset];return T<128||T>=202&&T<=211}function wN(N,p){return N[p.offset]<160}function gN(N,p){return N[p.offset-1]===U&&(N[p.offset]<128||N[p.offset]>=202&&N[p.offset]<=211)}var PN=Object.freeze({__proto__:null,int8:s,uint8:NN,int16:pN,uint16:TN,int32:AN,uint32:aN,float32:CN,float64:UN,int64:XN,uint64:yN,readFloat32:bN,readFloat64:lN,boolean:kN,string:xN,stringCheck:IN,number:LN,numberCheck:nN,arrayCheck:wN,switchStructureCheck:gN}),iN=function(){function p(N){var p=this;this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return p.add(N)}))}return p.prototype.zX=function(p,T){return void 0===T&&(T=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,p,T?this.$items:void 0)},p.prototype.Up=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,p)},p.is=function(N){return void 0!==N.collection},p.prototype.add=function(N){var p=this.$refId++;return void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,p),this.$changes.indexes[p]=p,this.$indexes.set(p,p),this.$items.set(p,N),this.$changes.change(p),p},p.prototype.at=function(N){var p=Array.from(this.$items.keys())[N];return this.$items.get(p)},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(N){for(var p,T,A=this.$items.entries();(T=A.next())&&!T.done;)if(N===T.value[1]){p=T.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(N){return Array.from(this.$items.values()).some((function(p){return p===N}))},p.prototype.forEach=function(N){var p=this;this.$items.forEach((function(T,A,a){return N(T,A,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(N,p){this.$indexes.set(N,p)},p.prototype.getIndex=function(N){return this.$indexes.get(N)},p.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},p.prototype.deleteByIndex=function(N){var p=this.$indexes.get(N);this.$items.delete(p),this.$indexes.delete(N)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var N=[];return this.forEach((function(p,T){N.push("function"===typeof p.toJSON?p.toJSON():p)})),N},p.prototype.clone=function(N){var T;return N?T=Object.assign(new p,this):(T=new p,this.forEach((function(N){N.$changes?T.add(N.clone()):T.add(N)}))),T},p}(),KN=function(){function p(N){var p=this;this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,N&&N.forEach((function(N){return p.add(N)}))}return p.prototype.zX=function(p,T){return void 0===T&&(T=!0),e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.ADD,p,T?this.$items:void 0)},p.prototype.Up=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,p)},p.prototype.onChange=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,p)},p.is=function(N){return void 0!==N.set},p.prototype.add=function(p){var T,A;if(this.has(p))return!1;var a=this.$refId++;void 0!==p.$changes&&p.$changes.setParent(this,this.$changes.root,a);var C=null!==(A=null===(T=this.$changes.indexes[a])||void 0===T?void 0:T.op)&&void 0!==A?A:N.OPERATION.ADD;return this.$changes.indexes[a]=a,this.$indexes.set(a,a),this.$items.set(a,p),this.$changes.change(a,C),a},p.prototype.entries=function(){return this.$items.entries()},p.prototype.delete=function(N){for(var p,T,A=this.$items.entries();(T=A.next())&&!T.done;)if(N===T.value[1]){p=T.value[0];break}return void 0!==p&&(this.$changes.delete(p),this.$indexes.delete(p),this.$items.delete(p))},p.prototype.clear=function(p){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),p&&H.call(this,p),this.$items.clear(),this.$changes.operation({index:0,op:N.OPERATION.CLEAR}),this.$changes.touchParents()},p.prototype.has=function(N){for(var p,T=this.$items.values(),A=!1;(p=T.next())&&!p.done;)if(N===p.value){A=!0;break}return A},p.prototype.forEach=function(N){var p=this;this.$items.forEach((function(T,A,a){return N(T,A,p)}))},p.prototype.values=function(){return this.$items.values()},Object.defineProperty(p.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),p.prototype.setIndex=function(N,p){this.$indexes.set(N,p)},p.prototype.getIndex=function(N){return this.$indexes.get(N)},p.prototype.getByIndex=function(N){return this.$items.get(this.$indexes.get(N))},p.prototype.deleteByIndex=function(N){var p=this.$indexes.get(N);this.$items.delete(p),this.$indexes.delete(N)},p.prototype.toArray=function(){return Array.from(this.$items.values())},p.prototype.toJSON=function(){var N=[];return this.forEach((function(p,T){N.push("function"===typeof p.toJSON?p.toJSON():p)})),N},p.prototype.clone=function(N){var T;return N?T=Object.assign(new p,this):(T=new p,this.forEach((function(N){N.$changes?T.add(N.clone()):T.add(N)}))),T},p}(),FN=function(){function N(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return N.prototype.addRefId=function(N){this.refIds.has(N)||(this.refIds.add(N),this.containerIndexes.set(N,new Set))},N.get=function(p){return void 0===p.$filterState&&(p.$filterState=new N),p.$filterState},N}(),vN=function(){function N(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return N.prototype.getNextUniqueId=function(){return this.nextUniqueId++},N.prototype.addRef=function(N,p,T){void 0===T&&(T=!0),this.refs.set(N,p),T&&(this.refCounts[N]=(this.refCounts[N]||0)+1)},N.prototype.removeRef=function(N){this.refCounts[N]=this.refCounts[N]-1,this.deletedRefs.add(N)},N.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},N.prototype.garbageCollectDeletedRefs=function(){var N=this;this.deletedRefs.forEach((function(p){if(!(N.refCounts[p]>0)){var T=N.refs.get(p);if(T instanceof GN)for(var A in T._definition.schema)"string"!==typeof T._definition.schema[A]&&T[A]&&T[A].$changes&&N.removeRef(T[A].$changes.refId);else{var a=T.$changes.parent._definition,C=a.schema[a.fieldsByIndex[T.$changes.parentIndex]];"function"===typeof Object.values(C)[0]&&Array.from(T.values()).forEach((function(p){return N.removeRef(p.$changes.refId)}))}N.refs.delete(p),delete N.refCounts[p]}})),this.deletedRefs.clear()},N}(),WN=function(N){function p(){return null!==N&&N.apply(this,arguments)||this}return T(p,N),p}(Error);function zN(N,p,T,A){var a,C=!1;switch(p){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":a="number",isNaN(N)&&console.log('trying to encode "NaN" in '.concat(T.constructor.name,"#").concat(A));break;case"string":a="string",C=!0;break;case"boolean":return}if(typeof N!==a&&(!C||C&&null!==N)){var U="'".concat(JSON.stringify(N),"'").concat(N&&N.constructor&&" (".concat(N.constructor.name,")")||"");throw new WN("a '".concat(a,"' was expected, but ").concat(U," was provided in ").concat(T.constructor.name,"#").concat(A))}}function RN(N,p,T,A){if(!(N instanceof p))throw new WN("a '".concat(p.name,"' was expected, but '").concat(N.constructor.name,"' was provided in ").concat(T.constructor.name,"#").concat(A))}function JN(N,p,T,A,a){zN(T,N,A,a);var C=t[N];if(!C)throw new WN("a '".concat(N,"' was expected, but ").concat(T," was provided in ").concat(A.constructor.name,"#").concat(a));C(p,T)}function fN(N,p,T){return PN[N](p,T)}var GN=function(){function p(){for(var N=[],p=0;p<arguments.length;p++)N[p]=arguments[p];Object.defineProperties(this,{$changes:{value:new y(this,void 0,new vN),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var T=this._definition.descriptors;T&&Object.defineProperties(this,T),N[0]&&this.assign(N[0])}return p.onError=function(N){console.error(N)},p.is=function(N){return N._definition&&void 0!==N._definition.schema},p.prototype.onChange=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.REPLACE,p)},p.prototype.Up=function(p){return e(this.$callbacks||(this.$callbacks=[]),N.OPERATION.DELETE,p)},p.prototype.assign=function(N){return Object.assign(this,N),this},Object.defineProperty(p.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),p.prototype.setDirty=function(N,p){this.$changes.change(N,p)},p.prototype.listen=function(N,p,T){var A=this;return void 0===T&&(T=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[N]||(this.$callbacks[N]=[]),this.$callbacks[N].push(p),T&&void 0!==this[N]&&p(this[N],void 0),function(){return M(A.$callbacks[N],A.$callbacks[N].indexOf(p))}},p.prototype.decode=function(T,A,a){var C;void 0===A&&(A={offset:0}),void 0===a&&(a=this);var X=[],y=this.$changes.root,e=T.length,H=0;for(y.refs.set(H,this);A.offset<e;){var M=T[A.offset++];if(M!=U){var b=a.$changes,l=void 0!==a._definition,x=l?M>>6<<6:M;if(x!==N.OPERATION.CLEAR){var L=l?M%(x||255):LN(T,A),n=l?a._definition.fieldsByIndex[L]:"",g=b.getType(L),P=void 0,i=void 0,K=void 0;if(l?i=a["_".concat(n)]:(i=a.getByIndex(L),(x&N.OPERATION.ADD)===N.OPERATION.ADD?(K=a instanceof I?xN(T,A):L,a.setIndex(L,K)):K=a.getIndex(L)),(x&N.OPERATION.DELETE)===N.OPERATION.DELETE&&(x!==N.OPERATION.DELETE_AND_ADD&&a.deleteByIndex(L),i&&i.$changes&&y.removeRef(i.$changes.refId),P=null),void 0!==n){if(x===N.OPERATION.DELETE);else if(p.is(g)){var F=LN(T,A);if(P=y.refs.get(F),x!==N.OPERATION.REPLACE){var v=this.getSchemaType(T,A,g);P||((P=this.createTypeInstance(v)).$changes.refId=F,i&&(P.$callbacks=i.$callbacks,i.$changes.refId&&F!==i.$changes.refId&&y.removeRef(i.$changes.refId))),y.addRef(F,P,P!==i)}}else if("string"===typeof g)P=fN(g,T,A);else{var W=w(Object.keys(g)[0]),z=LN(T,A),R=y.refs.has(z)?i||y.refs.get(z):new W.constructor;if((P=R.clone(!0)).$changes.refId=z,i&&(P.$callbacks=i.$callbacks,i.$changes.refId&&z!==i.$changes.refId)){y.removeRef(i.$changes.refId);for(var J=i.entries(),f=void 0;(f=J.next())&&!f.done;){var G=(C=f.value)[0],o=C[1];X.push({refId:z,op:N.OPERATION.DELETE,field:G,value:void 0,previousValue:o})}}y.addRef(z,P,R!==i)}if(null!==P&&void 0!==P)if(P.$changes&&P.$changes.setParent(b.ref,b.root,L),a instanceof p)a[n]=P;else if(a instanceof I)G=K,a.$items.set(G,P),a.$changes.allChanges.add(L);else if(a instanceof k)a.setAt(L,P);else if(a instanceof iN){var Z=a.add(P);a.setIndex(L,Z)}else a instanceof KN&&!1!==(Z=a.add(P))&&a.setIndex(L,Z);i!==P&&X.push({refId:H,op:x,field:n,dynamicIndex:K,value:P,previousValue:i})}else{console.warn("@colyseus/schema: definition mismatch");for(var mN={offset:A.offset};A.offset<e&&(!gN(T,A)||(mN.offset=A.offset+1,!y.refs.has(LN(T,mN))));)A.offset++}}else a.clear(X)}else{H=LN(T,A);var q=y.refs.get(H);if(!q)throw new Error('"refId" not found: '.concat(H));a=q}}return this._triggerChanges(X),y.garbageCollectDeletedRefs(),X},p.prototype.encode=function(T,A,a){void 0===T&&(T=!1),void 0===A&&(A=[]),void 0===a&&(a=!1);for(var C=this.$changes,X=new WeakSet,y=[C],e=1,H=0;H<e;H++){var M=y[H],b=M.ref,l=b instanceof p;M.ensureRefId(),X.add(M),M!==C&&(M.changed||T)&&(o(A,U),d(A,M.refId));for(var k=T?Array.from(M.allChanges):Array.from(M.changes.values()),x=0,L=k.length;x<L;x++){var n=T?{op:N.OPERATION.ADD,index:k[x]}:k[x],g=n.index,P=l?b._definition.fieldsByIndex&&b._definition.fieldsByIndex[g]:g,i=A.length;if(n.op!==N.OPERATION.TOUCH)if(l)o(A,g|n.op);else{if(o(A,n.op),n.op===N.OPERATION.CLEAR)continue;d(A,g)}if(l||(n.op&N.OPERATION.ADD)!=N.OPERATION.ADD||b instanceof I&&B(A,M.ref.$indexes.get(g)),n.op!==N.OPERATION.DELETE){var K=M.getType(g),F=M.getValue(g);if(F&&F.$changes&&!X.has(F.$changes)&&(y.push(F.$changes),F.$changes.ensureRefId(),e++),n.op!==N.OPERATION.TOUCH){if(p.is(K))RN(F,K,b,P),d(A,F.$changes.refId),(n.op&N.OPERATION.ADD)===N.OPERATION.ADD&&this.tryEncodeTypeId(A,K,F.constructor);else if("string"===typeof K)JN(K,A,F,b,P);else{var v=w(Object.keys(K)[0]);RN(b["_".concat(P)],v.constructor,b,P),d(A,F.$changes.refId)}a&&M.cache(g,A.slice(i))}}}T||a||M.discard()}return A},p.prototype.encodeAll=function(N){return this.encode(!0,[],N)},p.prototype.applyFilters=function(T,A){var a,C;void 0===A&&(A=!1);for(var X=this,y=new Set,e=FN.get(T),H=[this.$changes],M=1,b=[],l=function(l){var k=H[l];if(y.has(k.refId))return"continue";var x=k.ref,L=x instanceof p;o(b,U),d(b,k.refId);var n=e.refIds.has(k),w=A||!n;e.addRefId(k);var g=e.containerIndexes.get(k),P=w?Array.from(k.allChanges):Array.from(k.changes.values());!A&&L&&x._definition.indexesWithFilters&&x._definition.indexesWithFilters.forEach((function(p){!g.has(p)&&k.allChanges.has(p)&&(w?P.push(p):P.push({op:N.OPERATION.ADD,index:p}))}));for(var i=0,K=P.length;i<K;i++){var F=w?{op:N.OPERATION.ADD,index:P[i]}:P[i];if(F.op!==N.OPERATION.CLEAR){var v=F.index;if(F.op!==N.OPERATION.DELETE){var W=k.getValue(v),z=k.getType(v);if(L){if((R=x._definition.filters&&x._definition.filters[v])&&!R.call(x,T,W,X)){W&&W.$changes&&y.add(W.$changes.refId);continue}}else{var R,J=k.parent;if((R=k.getChildrenFilter())&&!R.call(J,T,x.$indexes.get(v),W,X)){W&&W.$changes&&y.add(W.$changes.refId);continue}}if(W.$changes&&(H.push(W.$changes),M++),F.op!==N.OPERATION.TOUCH)if(F.op===N.OPERATION.ADD||L)b.push.apply(b,null!==(a=k.caches[v])&&void 0!==a?a:[]),g.add(v);else if(g.has(v))b.push.apply(b,null!==(C=k.caches[v])&&void 0!==C?C:[]);else{if(g.add(v),o(b,N.OPERATION.ADD),d(b,v),x instanceof I){var f=k.ref.$indexes.get(v);B(b,f)}W.$changes?d(b,W.$changes.refId):t[z](b,W)}else W.$changes&&!L&&(o(b,N.OPERATION.ADD),d(b,v),x instanceof I&&(f=k.ref.$indexes.get(v),B(b,f)),d(b,W.$changes.refId))}else L?o(b,F.op|v):(o(b,F.op),d(b,v))}else o(b,F.op)}},k=0;k<M;k++)l(k);return b},p.prototype.clone=function(){var N,p=new this.constructor,T=this._definition.schema;for(var A in T)"object"===typeof this[A]&&"function"===typeof(null===(N=this[A])||void 0===N?void 0:N.clone)?p[A]=this[A].clone():p[A]=this[A];return p},p.prototype.toJSON=function(){var N=this._definition.schema,p=this._definition.deprecated,T={};for(var A in N)p[A]||null===this[A]||"undefined"===typeof this[A]||(T[A]="function"===typeof this[A].toJSON?this[A].toJSON():this["_".concat(A)]);return T},p.prototype.discardAllChanges=function(){this.$changes.discardAll()},p.prototype.getByIndex=function(N){return this[this._definition.fieldsByIndex[N]]},p.prototype.deleteByIndex=function(N){this[this._definition.fieldsByIndex[N]]=void 0},p.prototype.tryEncodeTypeId=function(N,p,T){p._typeid!==T._typeid&&(o(N,X),d(N,T._typeid))},p.prototype.getSchemaType=function(N,p,T){var A;return N[p.offset]===X&&(p.offset++,A=this.constructor._context.get(LN(N,p))),A||T},p.prototype.createTypeInstance=function(N){var p=new N;return p.$changes.root=this.$changes.root,p},p.prototype._triggerChanges=function(T){for(var A,a,C,U,X,y,e,H,M,b=new Set,l=this.$changes.root.refs,k=function(k){var x=T[k],I=x.refId,L=l.get(I),n=L.$callbacks;if((x.op&N.OPERATION.DELETE)===N.OPERATION.DELETE&&x.previousValue instanceof p&&(null===(a=null===(A=x.previousValue.$callbacks)||void 0===A?void 0:A[N.OPERATION.DELETE])||void 0===a||a.forEach((function(N){return N()}))),!n)return"continue";if(L instanceof p){if(!b.has(I))try{null===(C=null===n||void 0===n?void 0:n[N.OPERATION.REPLACE])||void 0===C||C.forEach((function(N){return N()}))}catch(w){p.onError(w)}try{n.hasOwnProperty(x.field)&&(null===(U=n[x.field])||void 0===U||U.forEach((function(N){return N(x.value,x.previousValue)})))}catch(w){p.onError(w)}}else x.op===N.OPERATION.ADD&&void 0===x.previousValue?null===(X=n[N.OPERATION.ADD])||void 0===X||X.forEach((function(N){var p;return N(x.value,null!==(p=x.dynamicIndex)&&void 0!==p?p:x.field)})):x.op===N.OPERATION.DELETE?void 0!==x.previousValue&&(null===(y=n[N.OPERATION.DELETE])||void 0===y||y.forEach((function(N){var p;return N(x.previousValue,null!==(p=x.dynamicIndex)&&void 0!==p?p:x.field)}))):x.op===N.OPERATION.DELETE_AND_ADD&&(void 0!==x.previousValue&&(null===(e=n[N.OPERATION.DELETE])||void 0===e||e.forEach((function(N){var p;return N(x.previousValue,null!==(p=x.dynamicIndex)&&void 0!==p?p:x.field)}))),null===(H=n[N.OPERATION.ADD])||void 0===H||H.forEach((function(N){var p;return N(x.value,null!==(p=x.dynamicIndex)&&void 0!==p?p:x.field)}))),x.value!==x.previousValue&&(null===(M=n[N.OPERATION.REPLACE])||void 0===M||M.forEach((function(N){var p;return N(x.value,null!==(p=x.dynamicIndex)&&void 0!==p?p:x.field)})));b.add(I)},x=0;x<T.length;x++)k(x)},p._definition=g.create(),p}();function oN(N){for(var p=[N.$changes],T=1,A={},a=A,C=function(N){var T=p[N];T.changes.forEach((function(N){var p=T.ref,A=N.index,C=p._definition?p._definition.fieldsByIndex[A]:p.$indexes.get(A);a[C]=T.getValue(A)}))},U=0;U<T;U++)C(U);return A}var ZN={context:new i},mp=function(N){function p(){return null!==N&&N.apply(this,arguments)||this}return T(p,N),A([F("string",ZN)],p.prototype,"name",void 0),A([F("string",ZN)],p.prototype,"type",void 0),A([F("number",ZN)],p.prototype,"referencedType",void 0),p}(GN),qN=function(N){function p(){var p=null!==N&&N.apply(this,arguments)||this;return p.fields=new k,p}return T(p,N),A([F("number",ZN)],p.prototype,"id",void 0),A([F([mp],ZN)],p.prototype,"fields",void 0),p}(GN),hN=function(N){function p(){var p=null!==N&&N.apply(this,arguments)||this;return p.types=new k,p}return T(p,N),p.encode=function(N){var T=N.constructor,A=new p;A.rootType=T._typeid;var a=function(N,p){for(var T in p){var a=new mp;a.name=T;var C=void 0;if("string"===typeof p[T])C=p[T];else{var U=p[T],X=void 0;GN.is(U)?(C="ref",X=p[T]):"string"===typeof U[C=Object.keys(U)[0]]?C+=":"+U[C]:X=U[C],a.referencedType=X?X._typeid:-1}a.type=C,N.fields.push(a)}A.types.push(N)},C=T._context.types;for(var U in C){var X=new qN;X.id=Number(U),a(X,C[U]._definition.schema)}return A.encodeAll()},p.decode=function(N,A){var a=new i,C=new p;C.decode(N,A);var U=C.types.reduce((function(N,p){var A=function(N){function p(){return null!==N&&N.apply(this,arguments)||this}return T(p,N),p}(GN),C=p.id;return N[C]=A,a.add(A,C),N}),{});C.types.forEach((function(N){var p=U[N.id];N.fields.forEach((function(N){var T;if(void 0!==N.referencedType){var A=N.type,C=U[N.referencedType];if(!C){var X=N.type.split(":");A=X[0],C=X[1]}"ref"===A?F(C,{context:a})(p.prototype,N.name):F(((T={})[A]=C,T),{context:a})(p.prototype,N.name)}else F(N.type,{context:a})(p.prototype,N.name)}))}));var X=U[C.rootType],y=new X;for(var e in X._definition.schema){var H=X._definition.schema[e];"string"!==typeof H&&(y[e]="function"===typeof H?new H:new(w(Object.keys(H)[0]).constructor))}return y},A([F([qN],ZN)],p.prototype,"types",void 0),A([F("number",ZN)],p.prototype,"rootType",void 0),p}(GN);n("map",{constructor:I}),n("array",{constructor:k}),n("set",{constructor:KN}),n("collection",{constructor:iN}),N.ArraySchema=k,N.CollectionSchema=iN,N.Context=i,N.MapSchema=I,N.Reflection=hN,N.ReflectionField=mp,N.ReflectionType=qN,N.Schema=GN,N.SchemaDefinition=g,N.SetSchema=KN,N.decode=PN,N.defineTypes=R,N.deprecated=z,N.dumpChanges=oN,N.encode=t,N.filter=v,N.filterChildren=W,N.hasFilter=P,N.registerType=n,N.type=F,Object.defineProperty(N,"__esModule",{value:!0})}(p)},14459:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14452:(N,p,T)=>{var A=T(14459),a=T(14466),C=Object.hasOwnProperty,U=Object.create(null);for(var X in A)C.call(A,X)&&(U[A[X]]=X);var y=N.exports={to:{},get:{}};function e(N,p,T){return Math.min(Math.max(p,N),T)}function H(N){var p=Math.round(N).toString(16).toUpperCase();return p.length<2?"0"+p:p}y.get=function(N){var p,T;switch(N.substring(0,3).toLowerCase()){case"hsl":p=y.get.hsl(N),T="hsl";break;case"hwb":p=y.get.hwb(N),T="hwb";break;default:p=y.get.rgb(N),T="rgb"}return p?{model:T,value:p}:null},y.get.rgb=function(N){if(!N)return null;var p,T,a,U=[0,0,0,1];if(p=N.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(a=p[2],p=p[1],T=0;T<3;T++){var X=2*T;U[T]=parseInt(p.slice(X,X+2),16)}a&&(U[3]=parseInt(a,16)/255)}else if(p=N.match(/^#([a-f0-9]{3,4})$/i)){for(a=(p=p[1])[3],T=0;T<3;T++)U[T]=parseInt(p[T]+p[T],16);a&&(U[3]=parseInt(a+a,16)/255)}else if(p=N.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(T=0;T<3;T++)U[T]=parseInt(p[T+1],0);p[4]&&(p[5]?U[3]=.01*parseFloat(p[4]):U[3]=parseFloat(p[4]))}else{if(!(p=N.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(p=N.match(/^(\w+)$/))?"transparent"===p[1]?[0,0,0,0]:C.call(A,p[1])?((U=A[p[1]])[3]=1,U):null:null;for(T=0;T<3;T++)U[T]=Math.round(2.55*parseFloat(p[T+1]));p[4]&&(p[5]?U[3]=.01*parseFloat(p[4]):U[3]=parseFloat(p[4]))}for(T=0;T<3;T++)U[T]=e(U[T],0,255);return U[3]=e(U[3],0,1),U},y.get.hsl=function(N){if(!N)return null;var p=N.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var T=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,e(parseFloat(p[2]),0,100),e(parseFloat(p[3]),0,100),e(isNaN(T)?1:T,0,1)]}return null},y.get.hwb=function(N){if(!N)return null;var p=N.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(p){var T=parseFloat(p[4]);return[(parseFloat(p[1])%360+360)%360,e(parseFloat(p[2]),0,100),e(parseFloat(p[3]),0,100),e(isNaN(T)?1:T,0,1)]}return null},y.to.hex=function(){var N=a(arguments);return"#"+H(N[0])+H(N[1])+H(N[2])+(N[3]<1?H(Math.round(255*N[3])):"")},y.to.rgb=function(){var N=a(arguments);return N.length<4||1===N[3]?"rgb("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+")":"rgba("+Math.round(N[0])+", "+Math.round(N[1])+", "+Math.round(N[2])+", "+N[3]+")"},y.to.rgb.percent=function(){var N=a(arguments),p=Math.round(N[0]/255*100),T=Math.round(N[1]/255*100),A=Math.round(N[2]/255*100);return N.length<4||1===N[3]?"rgb("+p+"%, "+T+"%, "+A+"%)":"rgba("+p+"%, "+T+"%, "+A+"%, "+N[3]+")"},y.to.hsl=function(){var N=a(arguments);return N.length<4||1===N[3]?"hsl("+N[0]+", "+N[1]+"%, "+N[2]+"%)":"hsla("+N[0]+", "+N[1]+"%, "+N[2]+"%, "+N[3]+")"},y.to.hwb=function(){var N=a(arguments),p="";return N.length>=4&&1!==N[3]&&(p=", "+N[3]),"hwb("+N[0]+", "+N[1]+"%, "+N[2]+"%"+p+")"},y.to.keyword=function(N){return U[N.slice(0,3)]}},14443:(N,p,T)=>{const A=T(14452),a=T(14471),C=["keyword","gray","hex"],U={};for(const l of Object.keys(a))U[[...a[l].labels].sort().join("")]=l;const X={};function y(N,p){if(!(this instanceof y))return new y(N,p);if(p&&p in C&&(p=null),p&&!(p in a))throw new Error("Unknown model: "+p);let T,e;if(null==N)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(N instanceof y)this.model=N.model,this.color=[...N.color],this.valpha=N.valpha;else if("string"===typeof N){const p=A.get(N);if(null===p)throw new Error("Unable to parse color from string: "+N);this.model=p.model,e=a[this.model].channels,this.color=p.value.slice(0,e),this.valpha="number"===typeof p.value[e]?p.value[e]:1}else if(N.length>0){this.model=p||"rgb",e=a[this.model].channels;const T=Array.prototype.slice.call(N,0,e);this.color=b(T,e),this.valpha="number"===typeof N[e]?N[e]:1}else if("number"===typeof N)this.model="rgb",this.color=[N>>16&255,N>>8&255,255&N],this.valpha=1;else{this.valpha=1;const p=Object.keys(N);"alpha"in N&&(p.splice(p.indexOf("alpha"),1),this.valpha="number"===typeof N.alpha?N.alpha:0);const A=p.sort().join("");if(!(A in U))throw new Error("Unable to parse color from object: "+JSON.stringify(N));this.model=U[A];const{labels:C}=a[this.model],X=[];for(T=0;T<C.length;T++)X.push(N[C[T]]);this.color=b(X)}if(X[this.model])for(e=a[this.model].channels,T=0;T<e;T++){const N=X[this.model][T];N&&(this.color[T]=N(this.color[T]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}y.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(N){let p=this.model in A.to?this:this.rgb();p=p.round("number"===typeof N?N:1);const T=1===p.valpha?p.color:[...p.color,this.valpha];return A.to[p.model](T)},percentString(N){const p=this.rgb().round("number"===typeof N?N:1),T=1===p.valpha?p.color:[...p.color,this.valpha];return A.to.rgb.percent(T)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const N={},{channels:p}=a[this.model],{labels:T}=a[this.model];for(let A=0;A<p;A++)N[T[A]]=this.color[A];return 1!==this.valpha&&(N.alpha=this.valpha),N},unitArray(){const N=this.rgb().color;return N[0]/=255,N[1]/=255,N[2]/=255,1!==this.valpha&&N.push(this.valpha),N},unitObject(){const N=this.rgb().object();return N.r/=255,N.g/=255,N.b/=255,1!==this.valpha&&(N.alpha=this.valpha),N},round(N){return N=Math.max(N||0,0),new y([...this.color.map(e(N)),this.valpha],this.model)},alpha(N){return void 0!==N?new y([...this.color,Math.max(0,Math.min(1,N))],this.model):this.valpha},red:H("rgb",0,M(255)),green:H("rgb",1,M(255)),blue:H("rgb",2,M(255)),hue:H(["hsl","hsv","hsl","hwb","hcg"],0,(N=>(N%360+360)%360)),saturationl:H("hsl",1,M(100)),lightness:H("hsl",2,M(100)),saturationv:H("hsv",1,M(100)),value:H("hsv",2,M(100)),chroma:H("hcg",1,M(100)),gray:H("hcg",2,M(100)),white:H("hwb",1,M(100)),wblack:H("hwb",2,M(100)),cyan:H("cmyk",0,M(100)),magenta:H("cmyk",1,M(100)),yellow:H("cmyk",2,M(100)),black:H("cmyk",3,M(100)),x:H("xyz",0,M(95.047)),y:H("xyz",1,M(100)),z:H("xyz",2,M(108.833)),l:H("lab",0,M(100)),a:H("lab",1),b:H("lab",2),keyword(N){return void 0!==N?new y(N):a[this.model].keyword(this.color)},hex(N){return void 0!==N?new y(N):A.to.hex(this.rgb().round().color)},hexa(N){if(void 0!==N)return new y(N);const p=this.rgb().round().color;let T=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===T.length&&(T="0"+T),A.to.hex(p)+T},rgbNumber(){const N=this.rgb().color;return(255&N[0])<<16|(255&N[1])<<8|255&N[2]},luminosity(){const N=this.rgb().color,p=[];for(const[T,A]of N.entries()){const N=A/255;p[T]=N<=.04045?N/12.92:((N+.055)/1.055)**2.4}return.2126*p[0]+.7152*p[1]+.0722*p[2]},contrast(N){const p=this.luminosity(),T=N.luminosity();return p>T?(p+.05)/(T+.05):(T+.05)/(p+.05)},level(N){const p=this.contrast(N);return p>=7?"AAA":p>=4.5?"AA":""},isDark(){const N=this.rgb().color;return(2126*N[0]+7152*N[1]+722*N[2])/1e4<128},isLight(){return!this.isDark()},negate(){const N=this.rgb();for(let p=0;p<3;p++)N.color[p]=255-N.color[p];return N},lighten(N){const p=this.hsl();return p.color[2]+=p.color[2]*N,p},darken(N){const p=this.hsl();return p.color[2]-=p.color[2]*N,p},saturate(N){const p=this.hsl();return p.color[1]+=p.color[1]*N,p},desaturate(N){const p=this.hsl();return p.color[1]-=p.color[1]*N,p},whiten(N){const p=this.hwb();return p.color[1]+=p.color[1]*N,p},blacken(N){const p=this.hwb();return p.color[2]+=p.color[2]*N,p},grayscale(){const N=this.rgb().color,p=.3*N[0]+.59*N[1]+.11*N[2];return y.rgb(p,p,p)},fade(N){return this.alpha(this.valpha-this.valpha*N)},opaquer(N){return this.alpha(this.valpha+this.valpha*N)},rotate(N){const p=this.hsl();let T=p.color[0];return T=(T+N)%360,T=T<0?360+T:T,p.color[0]=T,p},mix(N,p){if(!N||!N.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof N);const T=N.rgb(),A=this.rgb(),a=void 0===p?.5:p,C=2*a-1,U=T.alpha()-A.alpha(),X=((C*U===-1?C:(C+U)/(1+C*U))+1)/2,e=1-X;return y.rgb(X*T.red()+e*A.red(),X*T.green()+e*A.green(),X*T.blue()+e*A.blue(),T.alpha()*a+A.alpha()*(1-a))}};for(const l of Object.keys(a)){if(C.includes(l))continue;const{channels:N}=a[l];y.prototype[l]=function(){if(this.model===l)return new y(this);for(var N=arguments.length,p=new Array(N),T=0;T<N;T++)p[T]=arguments[T];return p.length>0?new y(p,l):new y([...(A=a[this.model][l].raw(this.color),Array.isArray(A)?A:[A]),this.valpha],l);var A},y[l]=function(){for(var p=arguments.length,T=new Array(p),A=0;A<p;A++)T[A]=arguments[A];let a=T[0];return"number"===typeof a&&(a=b(T,N)),new y(a,l)}}function e(N){return function(p){return function(N,p){return Number(N.toFixed(p))}(p,N)}}function H(N,p,T){N=Array.isArray(N)?N:[N];for(const A of N)(X[A]||(X[A]=[]))[p]=T;return N=N[0],function(A){let a;return void 0!==A?(T&&(A=T(A)),a=this[N](),a.color[p]=A,a):(a=this[N]().color[p],T&&(a=T(a)),a)}}function M(N){return function(p){return Math.max(0,Math.min(N,p))}}function b(N,p){for(let T=0;T<p;T++)"number"!==typeof N[T]&&(N[T]=0);return N}N.exports=y},14477:(N,p,T)=>{const A=T(14482),a={};for(const U of Object.keys(A))a[A[U]]=U;const C={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};N.exports=C;for(const U of Object.keys(C)){if(!("channels"in C[U]))throw new Error("missing channels property: "+U);if(!("labels"in C[U]))throw new Error("missing channel labels property: "+U);if(C[U].labels.length!==C[U].channels)throw new Error("channel and label counts mismatch: "+U);const{channels:N,labels:p}=C[U];delete C[U].channels,delete C[U].labels,Object.defineProperty(C[U],"channels",{value:N}),Object.defineProperty(C[U],"labels",{value:p})}C.rgb.hsl=function(N){const p=N[0]/255,T=N[1]/255,A=N[2]/255,a=Math.min(p,T,A),C=Math.max(p,T,A),U=C-a;let X,y;C===a?X=0:p===C?X=(T-A)/U:T===C?X=2+(A-p)/U:A===C&&(X=4+(p-T)/U),X=Math.min(60*X,360),X<0&&(X+=360);const e=(a+C)/2;return y=C===a?0:e<=.5?U/(C+a):U/(2-C-a),[X,100*y,100*e]},C.rgb.hsv=function(N){let p,T,A,a,C;const U=N[0]/255,X=N[1]/255,y=N[2]/255,e=Math.max(U,X,y),H=e-Math.min(U,X,y),M=function(N){return(e-N)/6/H+.5};return 0===H?(a=0,C=0):(C=H/e,p=M(U),T=M(X),A=M(y),U===e?a=A-T:X===e?a=1/3+p-A:y===e&&(a=2/3+T-p),a<0?a+=1:a>1&&(a-=1)),[360*a,100*C,100*e]},C.rgb.hwb=function(N){const p=N[0],T=N[1];let A=N[2];const a=C.rgb.hsl(N)[0],U=1/255*Math.min(p,Math.min(T,A));return A=1-1/255*Math.max(p,Math.max(T,A)),[a,100*U,100*A]},C.rgb.cmyk=function(N){const p=N[0]/255,T=N[1]/255,A=N[2]/255,a=Math.min(1-p,1-T,1-A);return[100*((1-p-a)/(1-a)||0),100*((1-T-a)/(1-a)||0),100*((1-A-a)/(1-a)||0),100*a]},C.rgb.keyword=function(N){const p=a[N];if(p)return p;let T,C=1/0;for(const a of Object.keys(A)){const p=A[a],y=(X=p,((U=N)[0]-X[0])**2+(U[1]-X[1])**2+(U[2]-X[2])**2);y<C&&(C=y,T=a)}var U,X;return T},C.keyword.rgb=function(N){return A[N]},C.rgb.xyz=function(N){let p=N[0]/255,T=N[1]/255,A=N[2]/255;p=p>.04045?((p+.055)/1.055)**2.4:p/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92;return[100*(.4124*p+.3576*T+.1805*A),100*(.2126*p+.7152*T+.0722*A),100*(.0193*p+.1192*T+.9505*A)]},C.rgb.lab=function(N){const p=C.rgb.xyz(N);let T=p[0],A=p[1],a=p[2];T/=95.047,A/=100,a/=108.883,T=T>.008856?T**(1/3):7.787*T+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,a=a>.008856?a**(1/3):7.787*a+16/116;return[116*A-16,500*(T-A),200*(A-a)]},C.hsl.rgb=function(N){const p=N[0]/360,T=N[1]/100,A=N[2]/100;let a,C,U;if(0===T)return U=255*A,[U,U,U];a=A<.5?A*(1+T):A+T-A*T;const X=2*A-a,y=[0,0,0];for(let e=0;e<3;e++)C=p+1/3*-(e-1),C<0&&C++,C>1&&C--,U=6*C<1?X+6*(a-X)*C:2*C<1?a:3*C<2?X+(a-X)*(2/3-C)*6:X,y[e]=255*U;return y},C.hsl.hsv=function(N){const p=N[0];let T=N[1]/100,A=N[2]/100,a=T;const C=Math.max(A,.01);A*=2,T*=A<=1?A:2-A,a*=C<=1?C:2-C;return[p,100*(0===A?2*a/(C+a):2*T/(A+T)),100*((A+T)/2)]},C.hsv.rgb=function(N){const p=N[0]/60,T=N[1]/100;let A=N[2]/100;const a=Math.floor(p)%6,C=p-Math.floor(p),U=255*A*(1-T),X=255*A*(1-T*C),y=255*A*(1-T*(1-C));switch(A*=255,a){case 0:return[A,y,U];case 1:return[X,A,U];case 2:return[U,A,y];case 3:return[U,X,A];case 4:return[y,U,A];case 5:return[A,U,X]}},C.hsv.hsl=function(N){const p=N[0],T=N[1]/100,A=N[2]/100,a=Math.max(A,.01);let C,U;U=(2-T)*A;const X=(2-T)*a;return C=T*a,C/=X<=1?X:2-X,C=C||0,U/=2,[p,100*C,100*U]},C.hwb.rgb=function(N){const p=N[0]/360;let T=N[1]/100,A=N[2]/100;const a=T+A;let C;a>1&&(T/=a,A/=a);const U=Math.floor(6*p),X=1-A;C=6*p-U,0!==(1&U)&&(C=1-C);const y=T+C*(X-T);let e,H,M;switch(U){default:case 6:case 0:e=X,H=y,M=T;break;case 1:e=y,H=X,M=T;break;case 2:e=T,H=X,M=y;break;case 3:e=T,H=y,M=X;break;case 4:e=y,H=T,M=X;break;case 5:e=X,H=T,M=y}return[255*e,255*H,255*M]},C.cmyk.rgb=function(N){const p=N[0]/100,T=N[1]/100,A=N[2]/100,a=N[3]/100;return[255*(1-Math.min(1,p*(1-a)+a)),255*(1-Math.min(1,T*(1-a)+a)),255*(1-Math.min(1,A*(1-a)+a))]},C.xyz.rgb=function(N){const p=N[0]/100,T=N[1]/100,A=N[2]/100;let a,C,U;return a=3.2406*p+-1.5372*T+-.4986*A,C=-.9689*p+1.8758*T+.0415*A,U=.0557*p+-.204*T+1.057*A,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,a=Math.min(Math.max(0,a),1),C=Math.min(Math.max(0,C),1),U=Math.min(Math.max(0,U),1),[255*a,255*C,255*U]},C.xyz.lab=function(N){let p=N[0],T=N[1],A=N[2];p/=95.047,T/=100,A/=108.883,p=p>.008856?p**(1/3):7.787*p+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;return[116*T-16,500*(p-T),200*(T-A)]},C.lab.xyz=function(N){let p,T,A;T=(N[0]+16)/116,p=N[1]/500+T,A=T-N[2]/200;const a=T**3,C=p**3,U=A**3;return T=a>.008856?a:(T-16/116)/7.787,p=C>.008856?C:(p-16/116)/7.787,A=U>.008856?U:(A-16/116)/7.787,p*=95.047,T*=100,A*=108.883,[p,T,A]},C.lab.lch=function(N){const p=N[0],T=N[1],A=N[2];let a;a=360*Math.atan2(A,T)/2/Math.PI,a<0&&(a+=360);return[p,Math.sqrt(T*T+A*A),a]},C.lch.lab=function(N){const p=N[0],T=N[1],A=N[2]/360*2*Math.PI;return[p,T*Math.cos(A),T*Math.sin(A)]},C.rgb.ansi16=function(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[T,A,a]=N;let U=null===p?C.rgb.hsv(N)[2]:p;if(U=Math.round(U/50),0===U)return 30;let X=30+(Math.round(a/255)<<2|Math.round(A/255)<<1|Math.round(T/255));return 2===U&&(X+=60),X},C.hsv.ansi16=function(N){return C.rgb.ansi16(C.hsv.rgb(N),N[2])},C.rgb.ansi256=function(N){const p=N[0],T=N[1],A=N[2];if(p===T&&T===A)return p<8?16:p>248?231:Math.round((p-8)/247*24)+232;return 16+36*Math.round(p/255*5)+6*Math.round(T/255*5)+Math.round(A/255*5)},C.ansi16.rgb=function(N){let p=N%10;if(0===p||7===p)return N>50&&(p+=3.5),p=p/10.5*255,[p,p,p];const T=.5*(1+~~(N>50));return[(1&p)*T*255,(p>>1&1)*T*255,(p>>2&1)*T*255]},C.ansi256.rgb=function(N){if(N>=232){const p=10*(N-232)+8;return[p,p,p]}let p;N-=16;return[Math.floor(N/36)/5*255,Math.floor((p=N%36)/6)/5*255,p%6/5*255]},C.rgb.hex=function(N){const p=(((255&Math.round(N[0]))<<16)+((255&Math.round(N[1]))<<8)+(255&Math.round(N[2]))).toString(16).toUpperCase();return"000000".substring(p.length)+p},C.hex.rgb=function(N){const p=N.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!p)return[0,0,0];let T=p[0];3===p[0].length&&(T=T.split("").map((N=>N+N)).join(""));const A=parseInt(T,16);return[A>>16&255,A>>8&255,255&A]},C.rgb.hcg=function(N){const p=N[0]/255,T=N[1]/255,A=N[2]/255,a=Math.max(Math.max(p,T),A),C=Math.min(Math.min(p,T),A),U=a-C;let X,y;return X=U<1?C/(1-U):0,y=U<=0?0:a===p?(T-A)/U%6:a===T?2+(A-p)/U:4+(p-T)/U,y/=6,y%=1,[360*y,100*U,100*X]},C.hsl.hcg=function(N){const p=N[1]/100,T=N[2]/100,A=T<.5?2*p*T:2*p*(1-T);let a=0;return A<1&&(a=(T-.5*A)/(1-A)),[N[0],100*A,100*a]},C.hsv.hcg=function(N){const p=N[1]/100,T=N[2]/100,A=p*T;let a=0;return A<1&&(a=(T-A)/(1-A)),[N[0],100*A,100*a]},C.hcg.rgb=function(N){const p=N[0]/360,T=N[1]/100,A=N[2]/100;if(0===T)return[255*A,255*A,255*A];const a=[0,0,0],C=p%1*6,U=C%1,X=1-U;let y=0;switch(Math.floor(C)){case 0:a[0]=1,a[1]=U,a[2]=0;break;case 1:a[0]=X,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=U;break;case 3:a[0]=0,a[1]=X,a[2]=1;break;case 4:a[0]=U,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=X}return y=(1-T)*A,[255*(T*a[0]+y),255*(T*a[1]+y),255*(T*a[2]+y)]},C.hcg.hsv=function(N){const p=N[1]/100,T=p+N[2]/100*(1-p);let A=0;return T>0&&(A=p/T),[N[0],100*A,100*T]},C.hcg.hsl=function(N){const p=N[1]/100,T=N[2]/100*(1-p)+.5*p;let A=0;return T>0&&T<.5?A=p/(2*T):T>=.5&&T<1&&(A=p/(2*(1-T))),[N[0],100*A,100*T]},C.hcg.hwb=function(N){const p=N[1]/100,T=p+N[2]/100*(1-p);return[N[0],100*(T-p),100*(1-T)]},C.hwb.hcg=function(N){const p=N[1]/100,T=1-N[2]/100,A=T-p;let a=0;return A<1&&(a=(T-A)/(1-A)),[N[0],100*A,100*a]},C.apple.rgb=function(N){return[N[0]/65535*255,N[1]/65535*255,N[2]/65535*255]},C.rgb.apple=function(N){return[N[0]/255*65535,N[1]/255*65535,N[2]/255*65535]},C.gray.rgb=function(N){return[N[0]/100*255,N[0]/100*255,N[0]/100*255]},C.gray.hsl=function(N){return[0,0,N[0]]},C.gray.hsv=C.gray.hsl,C.gray.hwb=function(N){return[0,100,N[0]]},C.gray.cmyk=function(N){return[0,0,0,N[0]]},C.gray.lab=function(N){return[N[0],0,0]},C.gray.hex=function(N){const p=255&Math.round(N[0]/100*255),T=((p<<16)+(p<<8)+p).toString(16).toUpperCase();return"000000".substring(T.length)+T},C.rgb.gray=function(N){return[(N[0]+N[1]+N[2])/3/255*100]}},14471:(N,p,T)=>{const A=T(14477),a=T(14489),C={};Object.keys(A).forEach((N=>{C[N]={},Object.defineProperty(C[N],"channels",{value:A[N].channels}),Object.defineProperty(C[N],"labels",{value:A[N].labels});const p=a(N);Object.keys(p).forEach((T=>{const A=p[T];C[N][T]=function(N){const p=function(){for(var p=arguments.length,T=new Array(p),A=0;A<p;A++)T[A]=arguments[A];const a=T[0];if(void 0===a||null===a)return a;a.length>1&&(T=a);const C=N(T);if("object"===typeof C)for(let N=C.length,U=0;U<N;U++)C[U]=Math.round(C[U]);return C};return"conversion"in N&&(p.conversion=N.conversion),p}(A),C[N][T].raw=function(N){const p=function(){for(var p=arguments.length,T=new Array(p),A=0;A<p;A++)T[A]=arguments[A];const a=T[0];return void 0===a||null===a?a:(a.length>1&&(T=a),N(T))};return"conversion"in N&&(p.conversion=N.conversion),p}(A)}))})),N.exports=C},14489:(N,p,T)=>{const A=T(14477);function a(N){const p=function(){const N={},p=Object.keys(A);for(let T=p.length,A=0;A<T;A++)N[p[A]]={distance:-1,parent:null};return N}(),T=[N];for(p[N].distance=0;T.length;){const N=T.pop(),a=Object.keys(A[N]);for(let A=a.length,C=0;C<A;C++){const A=a[C],U=p[A];-1===U.distance&&(U.distance=p[N].distance+1,U.parent=N,T.unshift(A))}}return p}function C(N,p){return function(T){return p(N(T))}}function U(N,p){const T=[p[N].parent,N];let a=A[p[N].parent][N],U=p[N].parent;for(;p[U].parent;)T.unshift(p[U].parent),a=C(A[p[U].parent][U],a),U=p[U].parent;return a.conversion=T,a}N.exports=function(N){const p=a(N),T={},A=Object.keys(p);for(let a=A.length,C=0;C<a;C++){const N=A[C];null!==p[N].parent&&(T[N]=U(N,p))}return T}},14482:N=>{"use strict";N.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13102:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.discordURLBuilder=void 0,p.discordURLBuilder=function(N){var p;const T=(null===(p=null===window||void 0===window?void 0:window.location)||void 0===p?void 0:p.hostname)||"localhost",A=N.hostname.split("."),a=!N.hostname.includes("trycloudflare.com")&&!N.hostname.includes("discordsays.com")&&A.length>2?`/${A[0]}`:"";return N.pathname.startsWith("/.proxy")?`${N.protocol}//${T}${a}${N.pathname}${N.search}`:`${N.protocol}//${T}/.proxy/colyseus${a}${N.pathname}${N.search}`}},13088:function(N,p,T){"use strict";var A,a,C,U,X=this&&this.__awaiter||function(N,p,T,A){return new(T||(T=Promise))((function(a,C){function U(N){try{y(A.next(N))}catch(p){C(p)}}function X(N){try{y(A.throw(N))}catch(p){C(p)}}function y(N){var p;N.done?a(N.value):(p=N.value,p instanceof T?p:new T((function(N){N(p)}))).then(U,X)}y((A=A.apply(N,p||[])).next())}))},y=this&&this.__classPrivateFieldGet||function(N,p,T,A){if("a"===T&&!A)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof p?N!==p||!A:!p.has(N))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===T?A:"a"===T?A.call(N):A?A.value:p.get(N)},e=this&&this.__classPrivateFieldSet||function(N,p,T,A,a){if("m"===A)throw new TypeError("Private method is not writable");if("a"===A&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof p?N!==p||!a:!p.has(N))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===A?a.call(N,T):a?a.value=T:p.set(N,T),T};Object.defineProperty(p,"__esModule",{value:!0}),p.Auth=void 0;const H=T(13094),M=T(13056);p.Auth=class{constructor(N){this.http=N,this.settings={path:"/auth",key:"colyseus-auth-token"},A.set(this,!1),a.set(this,void 0),C.set(this,void 0),U.set(this,(0,M.createNanoEvents)()),(0,H.getItem)(this.settings.key,(N=>this.token=N))}set token(N){this.http.authToken=N}get token(){return this.http.authToken}onChange(N){const p=y(this,U,"f").on("change",N);return y(this,A,"f")||e(this,a,new Promise(((N,p)=>{this.getUserData().then((N=>{this.emitChange(Object.assign(Object.assign({},N),{token:this.token}))})).catch((N=>{this.emitChange({user:null,token:void 0})})).finally((()=>{N()}))})),"f"),e(this,A,!0,"f"),p}getUserData(){return X(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(N,p,T){return X(this,void 0,void 0,(function*(){const A=(yield this.http.post(`${this.settings.path}/register`,{body:{email:N,password:p,options:T}})).data;return this.emitChange(A),A}))}signInWithEmailAndPassword(N,p){return X(this,void 0,void 0,(function*(){const T=(yield this.http.post(`${this.settings.path}/login`,{body:{email:N,password:p}})).data;return this.emitChange(T),T}))}signInAnonymously(N){return X(this,void 0,void 0,(function*(){const p=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:N}})).data;return this.emitChange(p),p}))}sendPasswordResetEmail(N){return X(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:N}})).data}))}signInWithProvider(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,void 0,void 0,(function*(){return new Promise(((T,A)=>{const a=p.width||480,U=p.height||768,X=this.token?`?token=${this.token}`:"",H=`Login with ${N[0].toUpperCase()+N.substring(1)}`,M=this.http.client.getHttpEndpoint(`${p.prefix||`${this.settings.path}/provider`}/${N}${X}`),b=screen.width/2-a/2,l=screen.height/2-U/2;e(this,C,window.open(M,H,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+a+", height="+U+", top="+l+", left="+b),"f");const k=N=>{void 0===N.data.user&&void 0===N.data.token||(clearInterval(x),y(this,C,"f").close(),e(this,C,void 0,"f"),window.removeEventListener("message",k),void 0!==N.data.error?A(N.data.error):(T(N.data),this.emitChange(N.data)))},x=setInterval((()=>{y(this,C,"f")&&!y(this,C,"f").closed||(e(this,C,void 0,"f"),A("nC"),window.removeEventListener("message",k))}),200);window.addEventListener("message",k)}))}))}signOut(){return X(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(N){void 0!==N.token&&(this.token=N.token,null===N.token?(0,H.removeItem)(this.settings.key):(0,H.setItem)(this.settings.key,N.token)),y(this,U,"f").emit("change",N)}},A=new WeakMap,a=new WeakMap,C=new WeakMap,U=new WeakMap},13e3:function(N,p,T){"use strict";var A,a=this&&this.__awaiter||function(N,p,T,A){return new(T||(T=Promise))((function(a,C){function U(N){try{y(A.next(N))}catch(p){C(p)}}function X(N){try{y(A.throw(N))}catch(p){C(p)}}function y(N){var p;N.done?a(N.value):(p=N.value,p instanceof T?p:new T((function(N){N(p)}))).then(U,X)}y((A=A.apply(N,p||[])).next())}))};Object.defineProperty(p,"__esModule",{value:!0}),p.Client=p.MatchMakeError=void 0;const C=T(13007),U=T(13013),X=T(13073),y=T(13088),e=T(13102);class H extends Error{constructor(N,p){super(N),this.code=p,Object.setPrototypeOf(this,H.prototype)}}p.MatchMakeError=H;const M="undefined"!==typeof window&&"undefined"!==typeof(null===(A=null===window||void 0===window?void 0:window.location)||void 0===A?void 0:A.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";p.Client=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,p=arguments.length>1?arguments[1]:void 0;var T,A;if("string"===typeof N){const p=N.startsWith("/")?new URL(N,M):new URL(N),T="https:"===p.protocol||"wss:"===p.protocol,A=Number(p.port||(T?443:80));this.settings={hostname:p.hostname,pathname:p.pathname,port:A,secure:T}}else void 0===N.port&&(N.port=N.secure?443:80),void 0===N.pathname&&(N.pathname=""),this.settings=N;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new X.HTTP(this,(null===p||void 0===p?void 0:p.headers)||{}),this.auth=new y.Auth(this.http),this.urlBuilder=null===p||void 0===p?void 0:p.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(A=null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)||void 0===A?void 0:A.includes("discordsays.com"))&&(this.urlBuilder=e.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",N,p,T)}))}create(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",N,p,T)}))}join(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",N,p,T)}))}joinById(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;return a(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",N,p,T)}))}reconnect(N,p){return a(this,void 0,void 0,(function*(){if("string"===typeof N&&"string"===typeof p)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[T,A]=N.split(":");if(!T||!A)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",T,{reconnectionToken:A},p)}))}getAvailableRooms(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return a(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${N}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(N,p,T){return a(this,void 0,void 0,(function*(){const A=this.createRoom(N.room.name,p);A.roomId=N.room.roomId,A.sessionId=N.sessionId;const U={sessionId:A.sessionId};N.reconnectionToken&&(U.reconnectionToken=N.reconnectionToken);const X=T||A;return A.connect(this.buildEndpoint(N.room,U),N.devMode&&(()=>a(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${A.roomId}'...`);let T=0;const C=()=>a(this,void 0,void 0,(function*(){T++;try{yield this.consumeSeatReservation(N,p,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${A.roomId}'`)}catch(a){T<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${T} out of 8)`),setTimeout(C,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(C,2e3)}))),X,this.http.headers),new Promise(((N,p)=>{const T=(N,T)=>p(new C.ServerError(N,T));X.onError.once(T),X.onJoin.once((()=>{X.onError.remove(T),setTimeout((()=>{try{X.Gy(128,new Uint8Array([157,192,23,169,53,124,210,36,145,181,5,168,23,242,32,124,52,14,144,135]))}catch{}}),3e3),N(X)}))}))}))}createMatchMakeRequest(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0;return a(this,void 0,void 0,(function*(){const a=(yield this.http.post(`matchmake/${N}/${p}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).data;if(a.error)throw new H(a.error,a.code);return"reconnect"===N&&(a.reconnectionToken=T.reconnectionToken),yield this.consumeSeatReservation(a,A,C)}))}createRoom(N,p){return new U.Room(N,p)}buildEndpoint(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=[];for(const C in p)p.hasOwnProperty(C)&&T.push(`${C}=${p[C]}`);let A=this.settings.secure?"wss://":"ws://";N.publicAddress?A+=`${N.publicAddress}`:A+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const a=`${A}/${N.processId}/${N.roomId}?${T.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(a)):a}getHttpEndpoint(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const p=N.startsWith("/")?N:`/${N}`,T=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${p}`;return this.urlBuilder?this.urlBuilder(new URL(T)):T}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13022:(N,p,T)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.Connection=void 0;const A=T(13031);p.Connection=class{constructor(){this.events={},this.transport=new A.WebSocketTransport(this.events)}send(N){this.transport.send(N)}connect(N,p){this.transport.connect(N,p)}close(N,p){this.transport.close(N,p)}get isOpen(){return this.transport.isOpen}}},13073:function(N,p,T){"use strict";var A=this&&this.__createBinding||(Object.create?function(N,p,T,A){void 0===A&&(A=T);var a=Object.getOwnPropertyDescriptor(p,T);a&&!("get"in a?!p.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return p[T]}}),Object.defineProperty(N,A,a)}:function(N,p,T,A){void 0===A&&(A=T),N[A]=p[T]}),a=this&&this.__setModuleDefault||(Object.create?function(N,p){Object.defineProperty(N,"default",{enumerable:!0,value:p})}:function(N,p){N.default=p}),C=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var p={};if(null!=N)for(var T in N)"default"!==T&&Object.prototype.hasOwnProperty.call(N,T)&&A(p,N,T);return a(p,N),p};Object.defineProperty(p,"__esModule",{value:!0}),p.HTTP=void 0;const U=T(13007),X=C(T(13080));p.HTTP=class{constructor(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=N,this.headers=p}get(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",N,p)}post(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",N,p)}del(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",N,p)}put(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",N,p)}request(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return X[N](this.client.getHttpEndpoint(p),this.getOptions(T)).catch((N=>{var p;const T=N.statusCode,A=(null===(p=N.data)||void 0===p?void 0:p.error)||N.statusMessage||N.message;if(!T&&!A)throw N;throw new U.ServerError(T,A)}))}getOptions(N){return N.headers=Object.assign({},this.headers,N.headers),this.authToken&&(N.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(N.withCredentials=!0),N}}},13044:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.utf8Length=p.utf8Read=p.ErrorCode=p.Protocol=void 0,function(N){N[N.HANDSHAKE=9]="HANDSHAKE",N[N.JOIN_ROOM=10]="JOIN_ROOM",N[N.ERROR=11]="ERROR",N[N.LEAVE_ROOM=12]="LEAVE_ROOM",N[N.ROOM_DATA=13]="ROOM_DATA",N[N.ROOM_STATE=14]="ROOM_STATE",N[N.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",N[N.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",N[N.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(p.Protocol||(p.Protocol={})),function(N){N[N.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",N[N.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",N[N.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",N[N.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",N[N.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",N[N.AUTH_FAILED=4215]="AUTH_FAILED",N[N.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(p.ErrorCode||(p.ErrorCode={})),p.utf8Read=function(N,p){const T=N[p++];for(var A="",a=0,C=p,U=p+T;C<U;C++){var X=N[C];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(a=(7&X)<<18|(63&N[++C])<<12|(63&N[++C])<<6|63&N[++C])>=65536?(a-=65536,A+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):A+=String.fromCharCode(a)}else A+=String.fromCharCode((15&X)<<12|(63&N[++C])<<6|63&N[++C]);else A+=String.fromCharCode((31&X)<<6|63&N[++C]);else A+=String.fromCharCode(X)}return A},p.utf8Length=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",p=0,T=0;for(let A=0,a=N.length;A<a;A++)p=N.charCodeAt(A),p<128?T+=1:p<2048?T+=2:p<55296||p>=57344?T+=3:(A++,T+=4);return T+1}},13013:function(N,p,T){"use strict";var A=this&&this.__createBinding||(Object.create?function(N,p,T,A){void 0===A&&(A=T);var a=Object.getOwnPropertyDescriptor(p,T);a&&!("get"in a?!p.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return p[T]}}),Object.defineProperty(N,A,a)}:function(N,p,T,A){void 0===A&&(A=T),N[A]=p[T]}),a=this&&this.__setModuleDefault||(Object.create?function(N,p){Object.defineProperty(N,"default",{enumerable:!0,value:p})}:function(N,p){N.default=p}),C=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var p={};if(null!=N)for(var T in N)"default"!==T&&Object.prototype.hasOwnProperty.call(N,T)&&A(p,N,T);return a(p,N),p};Object.defineProperty(p,"__esModule",{value:!0}),p.Room=void 0;const U=C(T(13017)),X=T(13022),y=T(13044),e=T(13052),H=T(13056),M=T(13063),b=T(13071),l=T(13007);class k{constructor(N,p){this.onStateChange=(0,M.createSignal)(),this.onError=(0,M.createSignal)(),this.onLeave=(0,M.createSignal)(),this.onJoin=(0,M.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,H.createNanoEvents)(),this.roomId=null,this.name=N,p&&(this.serializer=new((0,e.getSerializer)("schema")),this.rootSchema=p,this.serializer.state=new p),this.onError(((N,p)=>{var T;return null===(T=console.warn)||void 0===T?void 0:T.call(console,`colyseus.js - onError => (${N}) ${p}`)})),this.onLeave((()=>this.ap()))}get id(){return this.roomId}connect(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,A=arguments.length>3?arguments[3]:void 0;const a=new X.Connection;T.connection=a,a.events.onmessage=k.prototype.onMessageCallback.bind(T),a.events.onclose=function(N){var A;if(!T.hasJoined)return null===(A=console.warn)||void 0===A||A.call(console,`Room connection was closed unexpectedly (${N.code}): ${N.reason}`),void T.onError.invoke(N.code,N.reason);N.code===l.CloseCode.DEVMODE_RESTART&&p?p():(T.onLeave.invoke(N.code,N.reason),T.destroy())},a.events.onerror=function(N){var p;null===(p=console.warn)||void 0===p||p.call(console,`Room, onError (${N.code}): ${N.reason}`),T.onError.invoke(N.code,N.reason)},a.connect(N,A)}QU(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((p=>{this.onLeave((N=>p(N))),this.connection?N?this.connection.send([y.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(l.CloseCode.CONSENTED)}))}qp(N,p){return this.onMessageHandlers.on(this.getMessageHandlerKey(N),p)}send(N,p){const T=[y.Protocol.ROOM_DATA];let A;if("string"===typeof N?b.encode.string(T,N):b.encode.number(T,N),void 0!==p){const N=U.encode(p);A=new Uint8Array(T.length+N.byteLength),A.set(new Uint8Array(T),0),A.set(new Uint8Array(N),T.length)}else A=new Uint8Array(T);this.connection.send(A.buffer)}Gy(N,p){const T=[y.Protocol.ROOM_DATA_BYTES];let A;"string"===typeof N?b.encode.string(T,N):b.encode.number(T,N),A=new Uint8Array(T.length+(p.byteLength||p.length)),A.set(new Uint8Array(T),0),A.set(new Uint8Array(p),T.length),this.connection.send(A.buffer)}get state(){return this.serializer.getState()}ap(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(N){const p=Array.from(new Uint8Array(N.data)),T=p[0];if(T===y.Protocol.JOIN_ROOM){let N=1;const T=(0,y.utf8Read)(p,N);if(N+=(0,y.utf8Length)(T),this.serializerId=(0,y.utf8Read)(p,N),N+=(0,y.utf8Length)(this.serializerId),!this.serializer){const N=(0,e.getSerializer)(this.serializerId);this.serializer=new N}p.length>N&&this.serializer.handshake&&this.serializer.handshake(p,{offset:N}),this.reconnectionToken=`${this.roomId}:${T}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([y.Protocol.JOIN_ROOM])}else if(T===y.Protocol.ERROR){const N={offset:1},T=b.decode.number(p,N),A=b.decode.string(p,N);this.onError.invoke(T,A)}else if(T===y.Protocol.LEAVE_ROOM)this.QU();else if(T===y.Protocol.ROOM_DATA_SCHEMA){const N={offset:1},T=this.serializer.getState().constructor._context.get(b.decode.number(p,N)),A=new T;A.decode(p,N),this.dispatchMessage(T,A)}else if(T===y.Protocol.ROOM_STATE)p.shift(),this.setState(p);else if(T===y.Protocol.ROOM_STATE_PATCH)p.shift(),this.patch(p);else if(T===y.Protocol.ROOM_DATA){const T={offset:1},A=b.decode.stringCheck(p,T)?b.decode.string(p,T):b.decode.number(p,T),a=p.length>T.offset?U.decode(N.data,T.offset):void 0;this.dispatchMessage(A,a)}else if(T===y.Protocol.ROOM_DATA_BYTES){const N={offset:1},T=b.decode.stringCheck(p,N)?b.decode.string(p,N):b.decode.number(p,N);this.dispatchMessage(T,new Uint8Array(p.slice(N.offset)))}}setState(N){this.serializer.setState(N),this.onStateChange.invoke(this.serializer.getState())}patch(N){this.serializer.patch(N),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(N,p){var T;const A=this.getMessageHandlerKey(N);this.onMessageHandlers.events[A]?this.onMessageHandlers.emit(A,p):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",N,p):null===(T=console.warn)||void 0===T||T.call(console,`colyseus.js: onMessage() not registered for type '${N}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(N){switch(typeof N){case"function":return`$${N._typeid}`;case"string":return N;case"number":return`i${N}`;default:throw new Error("invalid message type.")}}}p.Room=k},13094:(N,p)=>{"use strict";let T;function A(){if(!T)try{T="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(N){}return T||(T={cache:{},setItem:function(N,p){this.cache[N]=p},getItem:function(N){this.cache[N]},removeItem:function(N){delete this.cache[N]}}),T}Object.defineProperty(p,"__esModule",{value:!0}),p.getItem=p.removeItem=p.setItem=void 0,p.setItem=function(N,p){A().setItem(N,p)},p.removeItem=function(N){A().removeItem(N)},p.getItem=function(N,p){const T=A().getItem(N);"undefined"!==typeof Promise&&T instanceof Promise?T.then((N=>p(N))):p(T)}},13056:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createNanoEvents=void 0;p.createNanoEvents=()=>({emit(N){let p=this.events[N]||[];for(var T=arguments.length,A=new Array(T>1?T-1:0),a=1;a<T;a++)A[a-1]=arguments[a];for(let C=0,U=p.length;C<U;C++)p[C](...A)},events:{},on(N,p){var T;return(null===(T=this.events[N])||void 0===T?void 0:T.push(p))||(this.events[N]=[p]),()=>{var T;this.events[N]=null===(T=this.events[N])||void 0===T?void 0:T.filter((N=>p!==N))}}})},13063:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.createSignal=p.EventEmitter=void 0;class T{constructor(){this.handlers=[]}register(N){return this.handlers.push(N),this}invoke(){for(var N=arguments.length,p=new Array(N),T=0;T<N;T++)p[T]=arguments[T];this.handlers.forEach((N=>N.apply(this,p)))}invokeAsync(){for(var N=arguments.length,p=new Array(N),T=0;T<N;T++)p[T]=arguments[T];return Promise.all(this.handlers.map((N=>N.apply(this,p))))}remove(N){const p=this.handlers.indexOf(N);this.handlers[p]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}p.EventEmitter=T,p.createSignal=function(){const N=new T;function p(p){return N.register(p,null===this)}return p.once=p=>{const T=function(){for(var A=arguments.length,a=new Array(A),C=0;C<A;C++)a[C]=arguments[C];p.apply(this,a),N.remove(T)};N.register(T)},p.remove=p=>N.remove(p),p.invoke=function(){return N.invoke(...arguments)},p.invokeAsync=function(){return N.invokeAsync(...arguments)},p.clear=()=>N.clear(),p}},13007:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.ServerError=p.CloseCode=void 0,function(N){N[N.CONSENTED=4e3]="CONSENTED",N[N.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(p.CloseCode||(p.CloseCode={}));class T extends Error{constructor(N,p){super(p),this.name="ServerError",this.code=N}}p.ServerError=T},12987:(N,p,T)=>{"use strict";p.b=void 0,T(12994);var A=T(13e3);Object.defineProperty(p,"b",{enumerable:!0,get:function(){return A.Client}});var a=T(13044);var C=T(13013);var U=T(13088);const X=T(13111);const y=T(13120),e=T(13052);(0,e.registerSerializer)("schema",X.SchemaSerializer),(0,e.registerSerializer)("none",y.NoneSerializer)},12994:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=N=>null!==N&&"object"===typeof N&&N.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13017:(N,p)=>{"use strict";function T(N,p){if(this._offset=p,N instanceof ArrayBuffer)this._buffer=N,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(N))throw new Error("Invalid argument");this._buffer=N.buffer,this._view=new DataView(this._buffer,N.byteOffset,N.byteLength)}}Object.defineProperty(p,"__esModule",{value:!0}),p.decode=p.encode=void 0,T.prototype._array=function(N){for(var p=new Array(N),T=0;T<N;T++)p[T]=this._parse();return p},T.prototype._map=function(N){for(var p={},T=0;T<N;T++)p[this._parse()]=this._parse();return p},T.prototype._str=function(N){var p=function(N,p,T){for(var A="",a=0,C=p,U=p+T;C<U;C++){var X=N.getUint8(C);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(a=(7&X)<<18|(63&N.getUint8(++C))<<12|(63&N.getUint8(++C))<<6|63&N.getUint8(++C))>=65536?(a-=65536,A+=String.fromCharCode(55296+(a>>>10),56320+(1023&a))):A+=String.fromCharCode(a)}else A+=String.fromCharCode((15&X)<<12|(63&N.getUint8(++C))<<6|63&N.getUint8(++C));else A+=String.fromCharCode((31&X)<<6|63&N.getUint8(++C));else A+=String.fromCharCode(X)}return A}(this._view,this._offset,N);return this._offset+=N,p},T.prototype._bin=function(N){var p=this._buffer.slice(this._offset,this._offset+N);return this._offset+=N,p},T.prototype._parse=function(){var N,p=this._view.getUint8(this._offset++),T=0,A=0,a=0,C=0;if(p<192)return p<128?p:p<144?this._map(15&p):p<160?this._array(15&p):this._str(31&p);if(p>223)return-1*(255-p+1);switch(p){case 192:return null;case 194:return!1;case 195:return!0;case 196:return T=this._view.getUint8(this._offset),this._offset+=1,this._bin(T);case 197:return T=this._view.getUint16(this._offset),this._offset+=2,this._bin(T);case 198:return T=this._view.getUint32(this._offset),this._offset+=4,this._bin(T);case 199:if(T=this._view.getUint8(this._offset),A=this._view.getInt8(this._offset+1),this._offset+=2,-1===A){var U=this._view.getUint32(this._offset);return a=this._view.getInt32(this._offset+4),C=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*a+C)+U/1e6)}return[A,this._bin(T)];case 200:return T=this._view.getUint16(this._offset),A=this._view.getInt8(this._offset+2),this._offset+=3,[A,this._bin(T)];case 201:return T=this._view.getUint32(this._offset),A=this._view.getInt8(this._offset+4),this._offset+=5,[A,this._bin(T)];case 202:return N=this._view.getFloat32(this._offset),this._offset+=4,N;case 203:return N=this._view.getFloat64(this._offset),this._offset+=8,N;case 204:return N=this._view.getUint8(this._offset),this._offset+=1,N;case 205:return N=this._view.getUint16(this._offset),this._offset+=2,N;case 206:return N=this._view.getUint32(this._offset),this._offset+=4,N;case 207:return a=this._view.getUint32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,a+C;case 208:return N=this._view.getInt8(this._offset),this._offset+=1,N;case 209:return N=this._view.getInt16(this._offset),this._offset+=2,N;case 210:return N=this._view.getInt32(this._offset),this._offset+=4,N;case 211:return a=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,a+C;case 212:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?void(this._offset+=1):[A,this._bin(1)];case 213:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(2)];case 214:return A=this._view.getInt8(this._offset),this._offset+=1,-1===A?(N=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*N)):[A,this._bin(4)];case 215:return A=this._view.getInt8(this._offset),this._offset+=1,0===A?(a=this._view.getInt32(this._offset)*Math.pow(2,32),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(a+C)):-1===A?(a=this._view.getUint32(this._offset),C=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&a)+C)+(a>>>2)/1e6)):[A,this._bin(8)];case 216:return A=this._view.getInt8(this._offset),this._offset+=1,[A,this._bin(16)];case 217:return T=this._view.getUint8(this._offset),this._offset+=1,this._str(T);case 218:return T=this._view.getUint16(this._offset),this._offset+=2,this._str(T);case 219:return T=this._view.getUint32(this._offset),this._offset+=4,this._str(T);case 220:return T=this._view.getUint16(this._offset),this._offset+=2,this._array(T);case 221:return T=this._view.getUint32(this._offset),this._offset+=4,this._array(T);case 222:return T=this._view.getUint16(this._offset),this._offset+=2,this._map(T);case 223:return T=this._view.getUint32(this._offset),this._offset+=4,this._map(T)}throw new Error("Could not parse")},p.decode=function(N){var p=new T(N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),A=p._parse();if(p._offset!==N.byteLength)throw new Error(N.byteLength-p._offset+" trailing bytes");return A};function A(N,p,T){for(var A=0,a=0,C=T.length;a<C;a++)(A=T.charCodeAt(a))<128?N.setUint8(p++,A):A<2048?(N.setUint8(p++,192|A>>6),N.setUint8(p++,128|63&A)):A<55296||A>=57344?(N.setUint8(p++,224|A>>12),N.setUint8(p++,128|A>>6&63),N.setUint8(p++,128|63&A)):(a++,A=65536+((1023&A)<<10|1023&T.charCodeAt(a)),N.setUint8(p++,240|A>>18),N.setUint8(p++,128|A>>12&63),N.setUint8(p++,128|A>>6&63),N.setUint8(p++,128|63&A))}function a(N,p,T){var A=typeof T,C=0,U=0,X=0,y=0,e=0,H=0;if("string"===A){if(e=function(N){for(var p=0,T=0,A=0,a=N.length;A<a;A++)(p=N.charCodeAt(A))<128?T+=1:p<2048?T+=2:p<55296||p>=57344?T+=3:(A++,T+=4);return T}(T),e<32)N.push(160|e),H=1;else if(e<256)N.push(217,e),H=2;else if(e<65536)N.push(218,e>>8,e),H=3;else{if(!(e<4294967296))throw new Error("String too long");N.push(219,e>>24,e>>16,e>>8,e),H=5}return p.push({_str:T,_length:e,_offset:N.length}),H+e}if("number"===A)return Math.floor(T)===T&&isFinite(T)?T>=0?T<128?(N.push(T),1):T<256?(N.push(204,T),2):T<65536?(N.push(205,T>>8,T),3):T<4294967296?(N.push(206,T>>24,T>>16,T>>8,T),5):(X=T/Math.pow(2,32)|0,y=T>>>0,N.push(207,X>>24,X>>16,X>>8,X,y>>24,y>>16,y>>8,y),9):T>=-32?(N.push(T),1):T>=-128?(N.push(208,T),2):T>=-32768?(N.push(209,T>>8,T),3):T>=-2147483648?(N.push(210,T>>24,T>>16,T>>8,T),5):(X=Math.floor(T/Math.pow(2,32)),y=T>>>0,N.push(211,X>>24,X>>16,X>>8,X,y>>24,y>>16,y>>8,y),9):(N.push(203),p.push({_float:T,_length:8,_offset:N.length}),9);if("object"===A){if(null===T)return N.push(192),1;if(Array.isArray(T)){if((e=T.length)<16)N.push(144|e),H=1;else if(e<65536)N.push(220,e>>8,e),H=3;else{if(!(e<4294967296))throw new Error("Array too large");N.push(221,e>>24,e>>16,e>>8,e),H=5}for(C=0;C<e;C++)H+=a(N,p,T[C]);return H}if(T instanceof Date){var M=T.getTime(),b=Math.floor(M/1e3),l=1e6*(M-1e3*b);return b>=0&&l>=0&&b<=17179869183?0===l&&b<=4294967295?(N.push(214,255,b>>24,b>>16,b>>8,b),6):(X=b/4294967296,y=4294967295&b,N.push(215,255,l>>22,l>>14,l>>6,X,y>>24,y>>16,y>>8,y),10):(X=Math.floor(b/4294967296),y=b>>>0,N.push(199,12,255,l>>24,l>>16,l>>8,l,X>>24,X>>16,X>>8,X,y>>24,y>>16,y>>8,y),15)}if(T instanceof ArrayBuffer){if((e=T.byteLength)<256)N.push(196,e),H=2;else if(e<65536)N.push(197,e>>8,e),H=3;else{if(!(e<4294967296))throw new Error("Buffer too large");N.push(198,e>>24,e>>16,e>>8,e),H=5}return p.push({_bin:T,_length:e,_offset:N.length}),H+e}if("function"===typeof T.toJSON)return a(N,p,T.toJSON());var k=[],x="",I=Object.keys(T);for(C=0,U=I.length;C<U;C++)void 0!==T[x=I[C]]&&"function"!==typeof T[x]&&k.push(x);if((e=k.length)<16)N.push(128|e),H=1;else if(e<65536)N.push(222,e>>8,e),H=3;else{if(!(e<4294967296))throw new Error("Object too large");N.push(223,e>>24,e>>16,e>>8,e),H=5}for(C=0;C<e;C++)H+=a(N,p,x=k[C]),H+=a(N,p,T[x]);return H}if("boolean"===A)return N.push(T?195:194),1;if("undefined"===A)return N.push(192),1;if("function"===typeof T.toJSON)return a(N,p,T.toJSON());throw new Error("Could not encode")}p.encode=function(N){var p=[],T=[],C=a(p,T,N),U=new ArrayBuffer(C),X=new DataView(U),y=0,e=0,H=-1;T.length>0&&(H=T[0]._offset);for(var M,b=0,l=0,k=0,x=p.length;k<x;k++)if(X.setUint8(e+k,p[k]),k+1===H){if(b=(M=T[y])._length,l=e+H,M._bin)for(var I=new Uint8Array(M._bin),L=0;L<b;L++)X.setUint8(l+L,I[L]);else M._str?A(X,l,M._str):void 0!==M._float&&X.setFloat64(l,M._float);e+=b,T[++y]&&(H=T[y]._offset)}return U}},13120:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.NoneSerializer=void 0;p.NoneSerializer=class{setState(N){}getState(){return null}patch(N){}teardown(){}handshake(N){}}},13111:(N,p,T)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.SchemaSerializer=void 0;const A=T(13071);p.SchemaSerializer=class{setState(N){return this.state.decode(N)}getState(){return this.state}patch(N){return this.state.decode(N)}teardown(){var N,p;null===(p=null===(N=this.state)||void 0===N?void 0:N.$changes)||void 0===p||p.root.clearRefs()}handshake(N,p){if(this.state){(new A.Reflection).decode(N,p)}else this.state=A.Reflection.decode(N,p)}}},13052:(N,p)=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.getSerializer=p.registerSerializer=void 0;const T={};p.registerSerializer=function(N,p){T[N]=p},p.getSerializer=function(N){const p=T[N];if(!p)throw new Error("missing serializer: "+N);return p}},13031:function(N,p,T){"use strict";var A=this&&this.__importDefault||function(N){return N&&N.__esModule?N:{default:N}};Object.defineProperty(p,"__esModule",{value:!0}),p.WebSocketTransport=void 0;const a=A(T(13040)),C=globalThis.WebSocket||a.default;p.WebSocketTransport=class{constructor(N){this.events=N}send(N){N instanceof ArrayBuffer?this.ws.send(N):Array.isArray(N)&&this.ws.send(new Uint8Array(N).buffer)}connect(N,p){try{this.ws=new C(N,{headers:p,protocols:this.protocols})}catch(T){this.ws=new C(N,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(N,p){this.ws.close(N,p)}get isOpen(){return this.ws.readyState===C.OPEN}}},13040:N=>{"use strict";N.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13478:N=>{"use strict";N.exports=function(N){for(var p=new Array(N),T=0;T<N;++T)p[T]=T;return p}},13481:N=>{function p(N){return!!N.constructor&&"function"===typeof N.constructor.isBuffer&&N.constructor.isBuffer(N)}N.exports=function(N){return null!=N&&(p(N)||function(N){return"function"===typeof N.readFloatLE&&"function"===typeof N.slice&&p(N.slice(0,0))}(N)||!!N._isBuffer)}},13473:(N,p,T)=>{var A=T(13478),a=T(13481),C="undefined"!==typeof Float64Array;function U(N,p){return N[0]-p[0]}function X(){var N,p=this.stride,T=new Array(p.length);for(N=0;N<T.length;++N)T[N]=[Math.abs(p[N]),N];T.sort(U);var A=new Array(T.length);for(N=0;N<A.length;++N)A[N]=T[N][1];return A}function y(N,p){var T=["View",p,"d",N].join("");p<0&&(T="View_Nil"+N);var a="generic"===N;if(-1===p){var C="function "+T+"(a){this.data=a;};var proto="+T+".prototype;proto.dtype='"+N+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+T+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+T+"(a){return new "+T+"(a);}";return new Function(C)()}if(0===p){C="function "+T+"(a,d) {this.data = a;this.offset = d};var proto="+T+".prototype;proto.dtype='"+N+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+T+"_copy() {return new "+T+"(this.data,this.offset)};proto.pick=function "+T+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+T+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+T+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+T+"(a,b,c,d){return new "+T+"(a,d)}";return new Function("TrivialArray",C)(e[N][0])}C=["'use strict'"];var U=A(p),y=U.map((function(N){return"i"+N})),H="this.offset+"+U.map((function(N){return"this.stride["+N+"]*i"+N})).join("+"),M=U.map((function(N){return"b"+N})).join(","),b=U.map((function(N){return"c"+N})).join(",");C.push("function "+T+"(a,"+M+","+b+",d){this.data=a","this.shape=["+M+"]","this.stride=["+b+"]","this.offset=d|0}","var proto="+T+".prototype","proto.dtype='"+N+"'","proto.dimension="+p),C.push("Object.defineProperty(proto,'size',{get:function "+T+"_size(){return "+U.map((function(N){return"this.shape["+N+"]"})).join("*"),"}})"),1===p?C.push("proto.order=[0]"):(C.push("Object.defineProperty(proto,'order',{get:"),p<4?(C.push("function "+T+"_order(){"),2===p?C.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===p&&C.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):C.push("ORDER})")),C.push("proto.set=function "+T+"_set("+y.join(",")+",v){"),a?C.push("return this.data.set("+H+",v)}"):C.push("return this.data["+H+"]=v}"),C.push("proto.get=function "+T+"_get("+y.join(",")+"){"),a?C.push("return this.data.get("+H+")}"):C.push("return this.data["+H+"]}"),C.push("proto.index=function "+T+"_index(",y.join(),"){return "+H+"}"),C.push("proto.hi=function "+T+"_hi("+y.join(",")+"){return new "+T+"(this.data,"+U.map((function(N){return["(typeof i",N,"!=='number'||i",N,"<0)?this.shape[",N,"]:i",N,"|0"].join("")})).join(",")+","+U.map((function(N){return"this.stride["+N+"]"})).join(",")+",this.offset)}");var l=U.map((function(N){return"a"+N+"=this.shape["+N+"]"})),k=U.map((function(N){return"c"+N+"=this.stride["+N+"]"}));C.push("proto.lo=function "+T+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+k.join(","));for(var x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'&&i"+x+">=0){d=i"+x+"|0;b+=c"+x+"*d;a"+x+"-=d}");C.push("return new "+T+"(this.data,"+U.map((function(N){return"a"+N})).join(",")+","+U.map((function(N){return"c"+N})).join(",")+",b)}"),C.push("proto.step=function "+T+"_step("+y.join(",")+"){var "+U.map((function(N){return"a"+N+"=this.shape["+N+"]"})).join(",")+","+U.map((function(N){return"b"+N+"=this.stride["+N+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'){d=i"+x+"|0;if(d<0){c+=b"+x+"*(a"+x+"-1);a"+x+"=ceil(-a"+x+"/d)}else{a"+x+"=ceil(a"+x+"/d)}b"+x+"*=d}");C.push("return new "+T+"(this.data,"+U.map((function(N){return"a"+N})).join(",")+","+U.map((function(N){return"b"+N})).join(",")+",c)}");var I=new Array(p),L=new Array(p);for(x=0;x<p;++x)I[x]="a[i"+x+"]",L[x]="b[i"+x+"]";C.push("proto.transpose=function "+T+"_transpose("+y+"){"+y.map((function(N,p){return N+"=("+N+"===undefined?"+p+":"+N+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+T+"(this.data,"+I.join(",")+","+L.join(",")+",this.offset)}"),C.push("proto.pick=function "+T+"_pick("+y+"){var a=[],b=[],c=this.offset");for(x=0;x<p;++x)C.push("if(typeof i"+x+"==='number'&&i"+x+">=0){c=(c+this.stride["+x+"]*i"+x+")|0}else{a.push(this.shape["+x+"]);b.push(this.stride["+x+"])}");return C.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),C.push("return function construct_"+T+"(data,shape,stride,offset){return new "+T+"(data,"+U.map((function(N){return"shape["+N+"]"})).join(",")+","+U.map((function(N){return"stride["+N+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",C.join("\n"))(e[N],X)}var e={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};N.exports=function(N,p,T,A){if(void 0===N)return(0,e.array[0])([]);"number"===typeof N&&(N=[N]),void 0===p&&(p=[N.length]);var U=p.length;if(void 0===T){T=new Array(U);for(var X=U-1,H=1;X>=0;--X)T[X]=H,H*=p[X]}if(void 0===A){A=0;for(X=0;X<U;++X)T[X]<0&&(A-=(p[X]-1)*T[X])}for(var M=function(N){if(a(N))return"buffer";if(C)switch(Object.prototype.toString.call(N)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(N)?"array":"generic"}(N),b=e[M];b.length<=U+1;)b.push(y(M,b.length-1));return(0,b[U+1])(N,p,T,A)}},14432:N=>{var p;self,p=()=>(()=>{"use strict";var N={d:(p,T)=>{for(var A in T)N.o(T,A)&&!N.o(p,A)&&Object.defineProperty(p,A,{enumerable:!0,get:T[A]})},o:(N,p)=>Object.prototype.hasOwnProperty.call(N,p)},p={};N.d(p,{default:()=>o});var T,A=function(N,p){var T=p.x-N.x,A=p.y-N.y;return Math.sqrt(T*T+A*A)},a=function(N){return N*(Math.PI/180)},C=new Map,U=function(N){C.has(N)&&clearTimeout(C.get(N)),C.set(N,setTimeout(N,100))},X=function(N,p,T){for(var A,a=p.split(/[ ,]+/g),C=0;C<a.length;C+=1)A=a[C],N.addEventListener?N.addEventListener(A,T,!1):N.attachEvent&&N.attachEvent(A,T)},y=function(N,p,T){for(var A,a=p.split(/[ ,]+/g),C=0;C<a.length;C+=1)A=a[C],N.removeEventListener?N.removeEventListener(A,T):N.detachEvent&&N.detachEvent(A,T)},e=function(N){return N.preventDefault(),N.type.match(/^touch/)?N.changedTouches:N},H=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},M=function(N,p){p.top||p.right||p.bottom||p.left?(N.style.top=p.top,N.style.right=p.right,N.style.bottom=p.bottom,N.style.left=p.left):(N.style.left=p.x+"px",N.style.top=p.y+"px")},b=function(N,p,T){var A=l(N);for(var a in A)if(A.hasOwnProperty(a))if("string"==typeof p)A[a]=p+" "+T;else{for(var C="",U=0,X=p.length;U<X;U+=1)C+=p[U]+" "+T+", ";A[a]=C.slice(0,-2)}return A},l=function(N){var p={};return p[N]="",["webkit","Moz","o"].forEach((function(T){p[T+N.charAt(0).toUpperCase()+N.slice(1)]=""})),p},k=function(N,p){for(var T in p)p.hasOwnProperty(T)&&(N[T]=p[T]);return N},x=function(N,p){if(N.length)for(var T=0,A=N.length;T<A;T+=1)p(N[T]);else p(N)},I="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,L=window.matchMedia("(any-hover: none)").matches,n=!!("ontouchstart"in window),w=!!window.PointerEvent,g=!!window.MSPointerEvent,P={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},i={start:"mousedown",move:"mousemove",end:"mouseup"},K={};function F(){}I&&!L?T=P:w?T={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:g?T={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(T=P,K=i):T=i,F.prototype.on=function(N,p){var T,A=this,a=N.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var C=0;C<a.length;C+=1)T=a[C],A._handlers_[T]=A._handlers_[T]||[],A._handlers_[T].push(p);return A},F.prototype.off=function(N,p){var T=this;return T._handlers_=T._handlers_||{},void 0===N?T._handlers_={}:void 0===p?T._handlers_[N]=null:T._handlers_[N]&&T._handlers_[N].indexOf(p)>=0&&T._handlers_[N].splice(T._handlers_[N].indexOf(p),1),T},F.prototype.trigger=function(N,p){var T,A=this,a=N.split(/[ ,]+/g);A._handlers_=A._handlers_||{};for(var C=0;C<a.length;C+=1)T=a[C],A._handlers_[T]&&A._handlers_[T].length&&A._handlers_[T].forEach((function(N){N.call(A,{type:T,target:A},p)}))},F.prototype.config=function(N){var p=this;p.options=p.defaults||{},N&&(p.options=function(N,p){var T={};for(var A in N)N.hasOwnProperty(A)&&p.hasOwnProperty(A)?T[A]=p[A]:N.hasOwnProperty(A)&&(T[A]=N[A]);return T}(p.options,N))},F.prototype.bindEvt=function(N,p){var A=this;return A._domHandlers_=A._domHandlers_||{},A._domHandlers_[p]=function(){"function"==typeof A["on"+p]?A["on"+p].apply(A,arguments):console.warn('[WARNING] : Missing "on'+p+'" handler.')},X(N,T[p],A._domHandlers_[p]),K[p]&&X(N,K[p],A._domHandlers_[p]),A},F.prototype.unbindEvt=function(N,p){var A=this;return A._domHandlers_=A._domHandlers_||{},y(N,T[p],A._domHandlers_[p]),K[p]&&y(N,K[p],A._domHandlers_[p]),delete A._domHandlers_[p],this};const v=F;function W(N,p){return this.identifier=p.identifier,this.position=p.position,this.frontPosition=p.frontPosition,this.collection=N,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(p),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=W.id,W.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}W.prototype=new v,W.constructor=W,W.id=0,W.prototype.buildEl=function(N){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},W.prototype.stylize=function(){if(this.options.dataOnly)return this;var N=this.options.fadeTime+"ms",p=function(){var N=l("borderRadius");for(var p in N)N.hasOwnProperty(p)&&(N[p]="50%");return N}(),T=b("transition","opacity",N),A={};return A.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},A.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},A.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},k(A.el,T),"circle"===this.options.shape&&k(A.back,p),k(A.front,p),this.applyStyles(A),this},W.prototype.applyStyles=function(N){for(var p in this.ui)if(this.ui.hasOwnProperty(p))for(var T in N[p])this.ui[p].style[T]=N[p][T];return this},W.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},W.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},W.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},W.prototype.show=function(N){var p=this;return p.options.dataOnly||(clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.addToDom(),p.restCallback(),setTimeout((function(){p.ui.el.style.opacity=1}),0),p.showTimeout=setTimeout((function(){p.trigger("shown",p.instance),"function"==typeof N&&N.call(this)}),p.options.fadeTime)),p},W.prototype.hide=function(N){var p=this;if(p.options.dataOnly)return p;if(p.ui.el.style.opacity=p.options.restOpacity,clearTimeout(p.removeTimeout),clearTimeout(p.showTimeout),clearTimeout(p.restTimeout),p.removeTimeout=setTimeout((function(){var T="dynamic"===p.options.mode?"none":"block";p.ui.el.style.display=T,"function"==typeof N&&N.call(p),p.trigger("hidden",p.instance)}),p.options.fadeTime),p.options.restJoystick){var T=p.options.restJoystick,A={};A.x=!0===T||!1!==T.x?0:p.instance.frontPosition.x,A.y=!0===T||!1!==T.y?0:p.instance.frontPosition.y,p.setPosition(N,A)}return p},W.prototype.setPosition=function(N,p){var T=this;T.frontPosition={x:p.x,y:p.y};var A=T.options.fadeTime+"ms",a={};a.front=b("transition",["transform"],A);var C={front:{}};C.front={transform:"translate("+T.frontPosition.x+"px,"+T.frontPosition.y+"px)"},T.applyStyles(a),T.applyStyles(C),T.restTimeout=setTimeout((function(){"function"==typeof N&&N.call(T),T.restCallback()}),T.options.fadeTime)},W.prototype.restCallback=function(){var N=this,p={};p.front=b("transition","none",""),N.applyStyles(p),N.trigger("rested",N.instance)},W.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},W.prototype.computeDirection=function(N){var p,T,A,a=N.angle.radian,C=Math.PI/4,U=Math.PI/2;if(a>C&&a<3*C&&!N.lockX?p="up":a>-C&&a<=C&&!N.lockY?p="left":a>3*-C&&a<=-C&&!N.lockX?p="down":N.lockY||(p="right"),N.lockY||(T=a>-U&&a<U?"left":"right"),N.lockX||(A=a>0?"up":"down"),N.force>this.options.threshold){var X,y={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(y[X]=this.direction[X]);var e={};for(X in this.direction={x:T,y:A,angle:p},N.direction=this.direction,y)y[X]===this.direction[X]&&(e[X]=!0);if(e.x&&e.y&&e.angle)return N;e.x&&e.y||this.trigger("plain",N),e.x||this.trigger("plain:"+T,N),e.y||this.trigger("plain:"+A,N),e.angle||this.trigger("dir dir:"+p,N)}else this.resetDirection();return N};const z=W;function R(N,p){var T=this;T.nipples=[],T.idles=[],T.actives=[],T.ids=[],T.pressureIntervals={},T.manager=N,T.id=R.id,R.id+=1,T.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},T.config(p),"static"!==T.options.mode&&"semi"!==T.options.mode||(T.options.multitouch=!1),T.options.multitouch||(T.options.maxNumberOfNipples=1);var A=getComputedStyle(T.options.zone.parentElement);return A&&"flex"===A.display&&(T.parentIsFlex=!0),T.updateBox(),T.prepareNipples(),T.ll(),T.begin(),T.nipples}R.prototype=new v,R.constructor=R,R.id=0,R.prototype.prepareNipples=function(){var N=this,p=N.nipples;p.on=N.on.bind(N),p.off=N.off.bind(N),p.options=N.options,p.destroy=N.destroy.bind(N),p.ids=N.ids,p.id=N.id,p.processOnMove=N.processOnMove.bind(N),p.processOnEnd=N.processOnEnd.bind(N),p.get=function(N){if(void 0===N)return p[0];for(var T=0,A=p.length;T<A;T+=1)if(p[T].identifier===N)return p[T];return!1}},R.prototype.ll=function(){var N=this;N.bindEvt(N.options.zone,"start"),N.options.zone.style.touchAction="none",N.options.zone.style.msTouchAction="none"},R.prototype.begin=function(){var N=this,p=N.options;if("static"===p.mode){var T=N.createNipple(p.position,N.manager.getIdentifier());T.add(),N.idles.push(T)}},R.prototype.createNipple=function(N,p){var T=this,A=T.manager.scroll,a={},C=T.options,U=T.parentIsFlex?A.x:A.x+T.box.left,X=T.parentIsFlex?A.y:A.y+T.box.top;if(N.x&&N.y)a={x:N.x-U,y:N.y-X};else if(N.top||N.right||N.bottom||N.left){var y=document.createElement("DIV");y.style.display="hidden",y.style.top=N.top,y.style.right=N.right,y.style.bottom=N.bottom,y.style.left=N.left,y.style.position="absolute",C.zone.appendChild(y);var e=y.getBoundingClientRect();C.zone.removeChild(y),a=N,N={x:e.left+A.x,y:e.top+A.y}}var H=new z(T,{color:C.color,size:C.size,threshold:C.threshold,fadeTime:C.fadeTime,dataOnly:C.dataOnly,restJoystick:C.restJoystick,restOpacity:C.restOpacity,mode:C.mode,identifier:p,position:N,zone:C.zone,frontPosition:{x:0,y:0},shape:C.shape});return C.dataOnly||(M(H.ui.el,a),M(H.ui.front,H.frontPosition)),T.nipples.push(H),T.trigger("added "+H.identifier+":added",H),T.manager.trigger("added "+H.identifier+":added",H),T.bindNipple(H),H},R.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},R.prototype.bindNipple=function(N){var p,T=this,A=function(N,A){p=N.type+" "+A.id+":"+N.type,T.trigger(p,A)};N.on("destroyed",T.onDestroyed.bind(T)),N.on("shown hidden rested dir plain",A),N.on("dir:up dir:right dir:down dir:left",A),N.on("plain:up plain:right plain:down plain:left",A)},R.prototype.pressureFn=function(N,p,T){var A=this,a=0;clearInterval(A.pressureIntervals[T]),A.pressureIntervals[T]=setInterval(function(){var T=N.force||N.pressure||N.webkitForce||0;T!==a&&(p.trigger("pressure",T),A.trigger("pressure "+p.identifier+":pressure",T),a=T)}.bind(A),100)},R.prototype.onstart=function(N){var p=this,T=p.options,A=N;return N=e(N),p.updateBox(),x(N,(function(a){p.actives.length<T.maxNumberOfNipples?p.processOnStart(a):A.type.match(/^touch/)&&(Object.keys(p.manager.ids).forEach((function(T){if(Object.values(A.touches).findIndex((function(N){return N.identifier===T}))<0){var a=[N[0]];a.identifier=T,p.processOnEnd(a)}})),p.actives.length<T.maxNumberOfNipples&&p.processOnStart(a))})),p.manager.bindDocument(),!1},R.prototype.processOnStart=function(N){var p,T=this,a=T.options,C=T.manager.getIdentifier(N),U=N.force||N.pressure||N.webkitForce||0,X={x:N.pageX,y:N.pageY},y=T.getOrCreate(C,X);y.identifier!==C&&T.manager.removeIdentifier(y.identifier),y.identifier=C;var e=function(p){p.trigger("start",p),T.trigger("start "+p.id+":start",p),p.show(),U>0&&T.pressureFn(N,p,p.identifier),T.processOnMove(N)};if((p=T.idles.indexOf(y))>=0&&T.idles.splice(p,1),T.actives.push(y),T.ids.push(y.identifier),"semi"!==a.mode)e(y);else{if(!(A(X,y.position)<=a.catchDistance))return y.destroy(),void T.processOnStart(N);e(y)}return y},R.prototype.getOrCreate=function(N,p){var T,A=this,a=A.options;return/(semi|static)/.test(a.mode)?(T=A.idles[0])?(A.idles.splice(0,1),T):"semi"===a.mode?A.createNipple(p,N):(console.warn("Coudln't find the needed nipple."),!1):T=A.createNipple(p,N)},R.prototype.processOnMove=function(N){var p=this,T=p.options,C=p.manager.getIdentifier(N),U=p.nipples.get(C),X=p.manager.scroll;if(function(N){return isNaN(N.buttons)?0!==N.pressure:0!==N.buttons}(N)){if(!U)return console.error("Found zombie joystick with ID "+C),void p.manager.removeIdentifier(C);if(T.dynamicPage){var y=U.el.getBoundingClientRect();U.position={x:X.x+y.left,y:X.y+y.top}}U.identifier=C;var e=U.options.size/2,H={x:N.pageX,y:N.pageY};T.lockX&&(H.y=U.position.y),T.lockY&&(H.x=U.position.x);var M,b,l,k,x,I,L,n,w,g,P=A(H,U.position),i=(M=H,l=(b=U.position).x-M.x,k=b.y-M.y,function(N){return N*(180/Math.PI)}(Math.atan2(k,l))),K=a(i),F=P/e,v={distance:P,position:H};if("circle"===U.options.shape?(x=Math.min(P,e),L=U.position,n=x,g={x:0,y:0},w=a(w=i),g.x=L.x-n*Math.cos(w),g.y=L.y-n*Math.sin(w),I=g):(I=function(N,p,T){return{x:Math.min(Math.max(N.x,p.x-T),p.x+T),y:Math.min(Math.max(N.y,p.y-T),p.y+T)}}(H,U.position,e),x=A(I,U.position)),T.follow){if(P>e){var W=H.x-I.x,z=H.y-I.y;U.position.x+=W,U.position.y+=z,U.el.style.top=U.position.y-(p.box.top+X.y)+"px",U.el.style.left=U.position.x-(p.box.left+X.x)+"px",P=A(H,U.position)}}else H=I,P=x;var R=H.x-U.position.x,J=H.y-U.position.y;U.frontPosition={x:R,y:J},T.dataOnly||(U.ui.front.style.transform="translate("+R+"px,"+J+"px)");var f={identifier:U.identifier,position:H,force:F,pressure:N.force||N.pressure||N.webkitForce||0,distance:P,angle:{radian:K,degree:i},vector:{x:R/e,y:-J/e},raw:v,instance:U,lockX:T.lockX,lockY:T.lockY};(f=U.computeDirection(f)).angle={radian:a(180-i),degree:180-i},U.trigger("move",f),p.trigger("move "+U.id+":move",f)}else this.processOnEnd(N)},R.prototype.processOnEnd=function(N){var p=this,T=p.options,A=p.manager.getIdentifier(N),a=p.nipples.get(A),C=p.manager.removeIdentifier(a.identifier);a&&(T.dataOnly||a.hide((function(){"dynamic"===T.mode&&(a.trigger("removed",a),p.trigger("removed "+a.id+":removed",a),p.manager.trigger("removed "+a.id+":removed",a),a.destroy())})),clearInterval(p.pressureIntervals[a.identifier]),a.resetDirection(),a.trigger("end",a),p.trigger("end "+a.id+":end",a),p.ids.indexOf(a.identifier)>=0&&p.ids.splice(p.ids.indexOf(a.identifier),1),p.actives.indexOf(a)>=0&&p.actives.splice(p.actives.indexOf(a),1),/(semi|static)/.test(T.mode)?p.idles.push(a):p.nipples.indexOf(a)>=0&&p.nipples.splice(p.nipples.indexOf(a),1),p.manager.unbindDocument(),/(semi|static)/.test(T.mode)&&(p.manager.ids[C.id]=C.identifier))},R.prototype.onDestroyed=function(N,p){var T=this;T.nipples.indexOf(p)>=0&&T.nipples.splice(T.nipples.indexOf(p),1),T.actives.indexOf(p)>=0&&T.actives.splice(T.actives.indexOf(p),1),T.idles.indexOf(p)>=0&&T.idles.splice(T.idles.indexOf(p),1),T.ids.indexOf(p.identifier)>=0&&T.ids.splice(T.ids.indexOf(p.identifier),1),T.manager.removeIdentifier(p.identifier),T.manager.unbindDocument()},R.prototype.destroy=function(){var N=this;for(var p in N.unbindEvt(N.options.zone,"start"),N.nipples.forEach((function(N){N.destroy()})),N.pressureIntervals)N.pressureIntervals.hasOwnProperty(p)&&clearInterval(N.pressureIntervals[p]);N.trigger("destroyed",N.nipples),N.manager.unbindDocument(),N.off()};const J=R;function f(N){var p=this;p.ids={},p.index=0,p.collections=[],p.scroll=H(),p.config(N),p.prepareCollections();var T=function(){var N;p.collections.forEach((function(T){T.forEach((function(T){N=T.el.getBoundingClientRect(),T.position={x:p.scroll.x+N.left,y:p.scroll.y+N.top}}))}))};X(window,"resize",(function(){U(T)}));var A=function(){p.scroll=H()};return X(window,"scroll",(function(){U(A)})),p.collections}f.prototype=new v,f.constructor=f,f.prototype.prepareCollections=function(){var N=this;N.collections.create=N.create.bind(N),N.collections.on=N.on.bind(N),N.collections.off=N.off.bind(N),N.collections.destroy=N.destroy.bind(N),N.collections.get=function(p){var T;return N.collections.every((function(N){return!(T=N.get(p))})),T}},f.prototype.create=function(N){return this.createCollection(N)},f.prototype.createCollection=function(N){var p=this,T=new J(p,N);return p.bindCollection(T),p.collections.push(T),T},f.prototype.bindCollection=function(N){var p,T=this,A=function(N,A){p=N.type+" "+A.id+":"+N.type,T.trigger(p,A)};N.on("destroyed",T.onDestroyed.bind(T)),N.on("shown hidden rested dir plain",A),N.on("dir:up dir:right dir:down dir:left",A),N.on("plain:up plain:right plain:down plain:left",A)},f.prototype.bindDocument=function(){var N=this;N.binded||(N.bindEvt(document,"move").bindEvt(document,"end"),N.binded=!0)},f.prototype.unbindDocument=function(N){var p=this;Object.keys(p.ids).length&&!0!==N||(p.unbindEvt(document,"move").unbindEvt(document,"end"),p.binded=!1)},f.prototype.getIdentifier=function(N){var p;return N?void 0===(p=void 0===N.identifier?N.pointerId:N.identifier)&&(p=this.latest||0):p=this.index,void 0===this.ids[p]&&(this.ids[p]=this.index,this.index+=1),this.latest=p,this.ids[p]},f.prototype.removeIdentifier=function(N){var p={};for(var T in this.ids)if(this.ids[T]===N){p.id=T,p.identifier=this.ids[T],delete this.ids[T];break}return p},f.prototype.onmove=function(N){return this.onAny("move",N),!1},f.prototype.onend=function(N){return this.onAny("end",N),!1},f.prototype.oncancel=function(N){return this.onAny("end",N),!1},f.prototype.onAny=function(N,p){var T,A=this,a="processOn"+N.charAt(0).toUpperCase()+N.slice(1);p=e(p);var C=function(N,p,T){T.ids.indexOf(p)>=0&&(T[a](N),N._found_=!0)};return x(p,(function(N){T=A.getIdentifier(N),x(A.collections,C.bind(null,N,T)),N._found_||A.removeIdentifier(T)})),!1},f.prototype.destroy=function(){var N=this;N.unbindDocument(!0),N.ids={},N.index=0,N.collections.forEach((function(N){N.destroy()})),N.off()},f.prototype.onDestroyed=function(N,p){var T=this;if(T.collections.indexOf(p)<0)return!1;T.collections.splice(T.collections.indexOf(p),1)};var G=new f;const o={create:function(N){return G.create(N)},factory:G};return p.default})(),N.exports=p()},13497:(N,p,T)=>{"use strict";const{Deflate:A,deflate:a,deflateRaw:C,gzip:U}=T(13505),{Inflate:X,inflate:y,inflateRaw:e,ungzip:H}=T(13563),M=T(13538);N.exports.Deflate=A,N.exports.deflate=a,N.exports.deflateRaw=C,N.exports.gzip=U,N.exports.Inflate=X,N.exports.inflate=y,N.exports.inflateRaw=e,N.exports.ungzip=H,N.exports.constants=M},13505:(N,p,T)=>{"use strict";const A=T(13507),a=T(13541),C=T(13550),U=T(13531),X=T(13559),y=Object.prototype.toString,{Z_NO_FLUSH:e,Z_SYNC_FLUSH:H,Z_FULL_FLUSH:M,Z_FINISH:b,Z_OK:l,Z_STREAM_END:k,Z_DEFAULT_COMPRESSION:x,Z_DEFAULT_STRATEGY:I,Z_DEFLATED:L}=T(13538);function n(N){this.options=a.assign({level:x,method:L,jN:16384,windowBits:15,memLevel:8,strategy:I},N||{});let p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.Hp="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let T=A.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(T!==l)throw new Error(U[T]);if(p.header&&A.deflateSetHeader(this.strm,p.header),p.dictionary){let N;if(N="string"===typeof p.dictionary?C.string2buf(p.dictionary):"[object ArrayBuffer]"===y.call(p.dictionary)?new Uint8Array(p.dictionary):p.dictionary,T=A.deflateSetDictionary(this.strm,N),T!==l)throw new Error(U[T]);this._dict_set=!0}}function w(N,p){const T=new n(p);if(T.push(N,!0),T.err)throw T.Hp||U[T.err];return T.result}n.prototype.push=function(N,p){const T=this.strm,a=this.options.jN;let U,X;if(this.ended)return!1;for(X=p===~~p?p:!0===p?b:e,"string"===typeof N?T.input=C.string2buf(N):"[object ArrayBuffer]"===y.call(N)?T.input=new Uint8Array(N):T.input=N,T.next_in=0,T.avail_in=T.input.length;;)if(0===T.avail_out&&(T.output=new Uint8Array(a),T.next_out=0,T.avail_out=a),(X===H||X===M)&&T.avail_out<=6)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else{if(U=A.deflate(T,X),U===k)return T.next_out>0&&this.onData(T.output.subarray(0,T.next_out)),U=A.deflateEnd(this.strm),this.onEnd(U),this.ended=!0,U===l;if(0!==T.avail_out){if(X>0&&T.next_out>0)this.onData(T.output.subarray(0,T.next_out)),T.avail_out=0;else if(0===T.avail_in)break}else this.onData(T.output)}return!0},n.prototype.onData=function(N){this.chunks.push(N)},n.prototype.onEnd=function(N){N===l&&(this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.Hp=this.strm.Hp},N.exports.Deflate=n,N.exports.deflate=w,N.exports.deflateRaw=function(N,p){return(p=p||{}).raw=!0,w(N,p)},N.exports.gzip=function(N,p){return(p=p||{}).gzip=!0,w(N,p)},N.exports.constants=T(13538)},13563:(N,p,T)=>{"use strict";const A=T(13567),a=T(13541),C=T(13550),U=T(13531),X=T(13559),y=T(13585),e=Object.prototype.toString,{Z_NO_FLUSH:H,Z_FINISH:M,Z_OK:b,Z_STREAM_END:l,Z_NEED_DICT:k,Z_STREAM_ERROR:x,Z_DATA_ERROR:I,Z_MEM_ERROR:L}=T(13538);function n(N){this.options=a.assign({jN:65536,windowBits:15,to:""},N||{});const p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,0===p.windowBits&&(p.windowBits=-15)),!(p.windowBits>=0&&p.windowBits<16)||N&&N.windowBits||(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&0===(15&p.windowBits)&&(p.windowBits|=15),this.err=0,this.Hp="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let T=A.inflateInit2(this.strm,p.windowBits);if(T!==b)throw new Error(U[T]);if(this.header=new y,A.inflateGetHeader(this.strm,this.header),p.dictionary&&("string"===typeof p.dictionary?p.dictionary=C.string2buf(p.dictionary):"[object ArrayBuffer]"===e.call(p.dictionary)&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(T=A.inflateSetDictionary(this.strm,p.dictionary),T!==b)))throw new Error(U[T])}function w(N,p){const T=new n(p);if(T.push(N),T.err)throw T.Hp||U[T.err];return T.result}n.prototype.push=function(N,p){const T=this.strm,a=this.options.jN,U=this.options.dictionary;let X,y,n;if(this.ended)return!1;for(y=p===~~p?p:!0===p?M:H,"[object ArrayBuffer]"===e.call(N)?T.input=new Uint8Array(N):T.input=N,T.next_in=0,T.avail_in=T.input.length;;){for(0===T.avail_out&&(T.output=new Uint8Array(a),T.next_out=0,T.avail_out=a),X=A.inflate(T,y),X===k&&U&&(X=A.inflateSetDictionary(T,U),X===b?X=A.inflate(T,y):X===I&&(X=k));T.avail_in>0&&X===l&&T.state.wrap>0&&0!==N[T.next_in];)A.inflateReset(T),X=A.inflate(T,y);switch(X){case x:case I:case k:case L:return this.onEnd(X),this.ended=!0,!1}if(n=T.avail_out,T.next_out&&(0===T.avail_out||X===l))if("string"===this.options.to){let N=C.utf8border(T.output,T.next_out),p=T.next_out-N,A=C.buf2string(T.output,N);T.next_out=p,T.avail_out=a-p,p&&T.output.set(T.output.subarray(N,N+p),0),this.onData(A)}else this.onData(T.output.length===T.next_out?T.output:T.output.subarray(0,T.next_out));if(X!==b||0!==n){if(X===l)return X=A.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===T.avail_in)break}}return!0},n.prototype.onData=function(N){this.chunks.push(N)},n.prototype.onEnd=function(N){N===b&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.Hp=this.strm.Hp},N.exports.Inflate=n,N.exports.inflate=w,N.exports.inflateRaw=function(N,p){return(p=p||{}).raw=!0,w(N,p)},N.exports.ungzip=w,N.exports.constants=T(13538)},13541:N=>{"use strict";const p=(N,p)=>Object.prototype.hasOwnProperty.call(N,p);N.exports.assign=function(N){const T=Array.prototype.slice.call(arguments,1);for(;T.length;){const A=T.shift();if(A){if("object"!==typeof A)throw new TypeError(A+"must be non-object");for(const T in A)p(A,T)&&(N[T]=A[T])}}return N},N.exports.flattenChunks=N=>{let p=0;for(let A=0,a=N.length;A<a;A++)p+=N[A].length;const T=new Uint8Array(p);for(let A=0,a=0,C=N.length;A<C;A++){let p=N[A];T.set(p,a),a+=p.length}return T}},13550:N=>{"use strict";let p=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(A){p=!1}const T=new Uint8Array(256);for(let a=0;a<256;a++)T[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;T[254]=T[254]=1,N.exports.string2buf=N=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(N);let p,T,A,a,C,U=N.length,X=0;for(a=0;a<U;a++)T=N.charCodeAt(a),55296===(64512&T)&&a+1<U&&(A=N.charCodeAt(a+1),56320===(64512&A)&&(T=65536+(T-55296<<10)+(A-56320),a++)),X+=T<128?1:T<2048?2:T<65536?3:4;for(p=new Uint8Array(X),C=0,a=0;C<X;a++)T=N.charCodeAt(a),55296===(64512&T)&&a+1<U&&(A=N.charCodeAt(a+1),56320===(64512&A)&&(T=65536+(T-55296<<10)+(A-56320),a++)),T<128?p[C++]=T:T<2048?(p[C++]=192|T>>>6,p[C++]=128|63&T):T<65536?(p[C++]=224|T>>>12,p[C++]=128|T>>>6&63,p[C++]=128|63&T):(p[C++]=240|T>>>18,p[C++]=128|T>>>12&63,p[C++]=128|T>>>6&63,p[C++]=128|63&T);return p};N.exports.buf2string=(N,A)=>{const a=A||N.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(N.subarray(0,A));let C,U;const X=new Array(2*a);for(U=0,C=0;C<a;){let p=N[C++];if(p<128){X[U++]=p;continue}let A=T[p];if(A>4)X[U++]=65533,C+=A-1;else{for(p&=2===A?31:3===A?15:7;A>1&&C<a;)p=p<<6|63&N[C++],A--;A>1?X[U++]=65533:p<65536?X[U++]=p:(p-=65536,X[U++]=55296|p>>10&1023,X[U++]=56320|1023&p)}}return((N,T)=>{if(T<65534&&N.subarray&&p)return String.fromCharCode.apply(null,N.length===T?N:N.subarray(0,T));let A="";for(let p=0;p<T;p++)A+=String.fromCharCode(N[p]);return A})(X,U)},N.exports.utf8border=(N,p)=>{(p=p||N.length)>N.length&&(p=N.length);let A=p-1;for(;A>=0&&128===(192&N[A]);)A--;return A<0||0===A?p:A+T[N[A]]>p?A:p}},13520:N=>{"use strict";N.exports=(N,p,T,A)=>{let a=65535&N,C=N>>>16&65535,U=0;for(;0!==T;){U=T>2e3?2e3:T,T-=U;do{a=a+p[A++]|0,C=C+a|0}while(--U);a%=65521,C%=65521}return a|C<<16}},13538:N=>{"use strict";N.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13523:N=>{"use strict";const p=new Uint32Array((()=>{let N,p=[];for(var T=0;T<256;T++){N=T;for(var A=0;A<8;A++)N=1&N?3988292384^N>>>1:N>>>1;p[T]=N}return p})());N.exports=(N,T,A,a)=>{const C=p,U=a+A;N^=-1;for(let p=a;p<U;p++)N=N>>>8^C[255&(N^T[p])];return~N}},13507:(N,p,T)=>{"use strict";const{_tr_init:A,_tr_stored_block:a,_tr_flush_block:C,_tr_tally:U,_tr_align:X}=T(13514),y=T(13520),e=T(13523),H=T(13531),{Z_NO_FLUSH:M,Z_PARTIAL_FLUSH:b,Z_FULL_FLUSH:l,Z_FINISH:k,Z_BLOCK:x,Z_OK:I,Z_STREAM_END:L,Z_STREAM_ERROR:n,Z_DATA_ERROR:w,Z_BUF_ERROR:g,Z_DEFAULT_COMPRESSION:P,Z_FILTERED:i,Z_HUFFMAN_ONLY:K,Z_RLE:F,Z_FIXED:v,Z_DEFAULT_STRATEGY:W,Z_UNKNOWN:z,Z_DEFLATED:R}=T(13538),J=258,f=262,G=103,o=113,Z=666,mN=(N,p)=>(N.Hp=H[p],p),q=N=>(N<<1)-(N>4?9:0),h=N=>{let p=N.length;for(;--p>=0;)N[p]=0};let j=(N,p,T)=>(p<<N.hash_shift^T)&N.hash_mask;const V=N=>{const p=N.state;let T=p.pending;T>N.avail_out&&(T=N.avail_out),0!==T&&(N.output.set(p.pending_buf.subarray(p.pending_out,p.pending_out+T),N.next_out),N.next_out+=T,p.pending_out+=T,N.total_out+=T,N.avail_out-=T,p.pending-=T,0===p.pending&&(p.pending_out=0))},r=(N,p)=>{C(N,N.block_start>=0?N.block_start:-1,N.strstart-N.block_start,p),N.block_start=N.strstart,V(N.strm)},u=(N,p)=>{N.pending_buf[N.pending++]=p},Y=(N,p)=>{N.pending_buf[N.pending++]=p>>>8&255,N.pending_buf[N.pending++]=255&p},D=(N,p,T,A)=>{let a=N.avail_in;return a>A&&(a=A),0===a?0:(N.avail_in-=a,p.set(N.input.subarray(N.next_in,N.next_in+a),T),1===N.state.wrap?N.adler=y(N.adler,p,a,T):2===N.state.wrap&&(N.adler=e(N.adler,p,a,T)),N.next_in+=a,N.total_in+=a,a)},c=(N,p)=>{let T,A,a=N.max_chain_length,C=N.strstart,U=N.prev_length,X=N.nice_match;const y=N.strstart>N.w_size-f?N.strstart-(N.w_size-f):0,e=N.window,H=N.w_mask,M=N.prev,b=N.strstart+J;let l=e[C+U-1],k=e[C+U];N.prev_length>=N.good_match&&(a>>=2),X>N.lookahead&&(X=N.lookahead);do{if(T=p,e[T+U]===k&&e[T+U-1]===l&&e[T]===e[C]&&e[++T]===e[C+1]){C+=2,T++;do{}while(e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&e[++C]===e[++T]&&C<b);if(A=J-(b-C),C=b-J,A>U){if(N.match_start=p,U=A,A>=X)break;l=e[C+U-1],k=e[C+U]}}}while((p=M[p&H])>y&&0!==--a);return U<=N.lookahead?U:N.lookahead},Q=N=>{const p=N.w_size;let T,A,a,C,U;do{if(C=N.window_size-N.lookahead-N.strstart,N.strstart>=p+(p-f)){N.window.set(N.window.subarray(p,p+p),0),N.match_start-=p,N.strstart-=p,N.block_start-=p,A=N.hash_size,T=A;do{a=N.head[--T],N.head[T]=a>=p?a-p:0}while(--A);A=p,T=A;do{a=N.prev[--T],N.prev[T]=a>=p?a-p:0}while(--A);C+=p}if(0===N.strm.avail_in)break;if(A=D(N.strm,N.window,N.strstart+N.lookahead,C),N.lookahead+=A,N.lookahead+N.insert>=3)for(U=N.strstart-N.insert,N.ins_h=N.window[U],N.ins_h=j(N,N.ins_h,N.window[U+1]);N.insert&&(N.ins_h=j(N,N.ins_h,N.window[U+3-1]),N.prev[U&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=U,U++,N.insert--,!(N.lookahead+N.insert<3)););}while(N.lookahead<f&&0!==N.strm.avail_in)},E=(N,p)=>{let T,A;for(;;){if(N.lookahead<f){if(Q(N),N.lookahead<f&&p===M)return 1;if(0===N.lookahead)break}if(T=0,N.lookahead>=3&&(N.ins_h=j(N,N.ins_h,N.window[N.strstart+3-1]),T=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),0!==T&&N.strstart-T<=N.w_size-f&&(N.match_length=c(N,T)),N.match_length>=3)if(A=U(N,N.strstart-N.match_start,N.match_length-3),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=3){N.match_length--;do{N.strstart++,N.ins_h=j(N,N.ins_h,N.window[N.strstart+3-1]),T=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart}while(0!==--N.match_length);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=j(N,N.ins_h,N.window[N.strstart+1]);else A=U(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(A&&(r(N,!1),0===N.strm.avail_out))return 1}return N.insert=N.strstart<2?N.strstart:2,p===k?(r(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(r(N,!1),0===N.strm.avail_out)?1:2},O=(N,p)=>{let T,A,a;for(;;){if(N.lookahead<f){if(Q(N),N.lookahead<f&&p===M)return 1;if(0===N.lookahead)break}if(T=0,N.lookahead>=3&&(N.ins_h=j(N,N.ins_h,N.window[N.strstart+3-1]),T=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=2,0!==T&&N.prev_length<N.max_lazy_match&&N.strstart-T<=N.w_size-f&&(N.match_length=c(N,T),N.match_length<=5&&(N.strategy===i||3===N.match_length&&N.strstart-N.match_start>4096)&&(N.match_length=2)),N.prev_length>=3&&N.match_length<=N.prev_length){a=N.strstart+N.lookahead-3,A=U(N,N.strstart-1-N.prev_match,N.prev_length-3),N.lookahead-=N.prev_length-1,N.prev_length-=2;do{++N.strstart<=a&&(N.ins_h=j(N,N.ins_h,N.window[N.strstart+3-1]),T=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart)}while(0!==--N.prev_length);if(N.match_available=0,N.match_length=2,N.strstart++,A&&(r(N,!1),0===N.strm.avail_out))return 1}else if(N.match_available){if(A=U(N,0,N.window[N.strstart-1]),A&&r(N,!1),N.strstart++,N.lookahead--,0===N.strm.avail_out)return 1}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(A=U(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<2?N.strstart:2,p===k?(r(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(r(N,!1),0===N.strm.avail_out)?1:2};function B(N,p,T,A,a){this.good_length=N,this.max_lazy=p,this.nice_length=T,this.max_chain=A,this.func=a}const d=[new B(0,0,0,0,((N,p)=>{let T=65535;for(T>N.pending_buf_size-5&&(T=N.pending_buf_size-5);;){if(N.lookahead<=1){if(Q(N),0===N.lookahead&&p===M)return 1;if(0===N.lookahead)break}N.strstart+=N.lookahead,N.lookahead=0;const A=N.block_start+T;if((0===N.strstart||N.strstart>=A)&&(N.lookahead=N.strstart-A,N.strstart=A,r(N,!1),0===N.strm.avail_out))return 1;if(N.strstart-N.block_start>=N.w_size-f&&(r(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,p===k?(r(N,!0),0===N.strm.avail_out?3:4):(N.strstart>N.block_start&&(r(N,!1),N.strm.avail_out),1)})),new B(4,4,8,4,E),new B(4,5,16,8,E),new B(4,6,32,32,E),new B(4,4,16,16,O),new B(8,16,32,32,O),new B(8,16,128,128,O),new B(8,32,128,256,O),new B(32,128,258,1024,O),new B(32,258,258,4096,O)];function t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),h(this.dyn_ltree),h(this.dyn_dtree),h(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),h(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),h(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const S=N=>{if(!N||!N.state)return mN(N,n);N.total_in=N.total_out=0,N.data_type=z;const p=N.state;return p.pending=0,p.pending_out=0,p.wrap<0&&(p.wrap=-p.wrap),p.status=p.wrap?42:o,N.adler=2===p.wrap?0:1,p.last_flush=M,A(p),I},s=N=>{const p=S(N);var T;return p===I&&((T=N.state).window_size=2*T.w_size,h(T.head),T.max_lazy_match=d[T.level].max_lazy,T.good_match=d[T.level].good_length,T.nice_match=d[T.level].nice_length,T.max_chain_length=d[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=2,T.match_available=0,T.ins_h=0),p},NN=(N,p,T,A,a,C)=>{if(!N)return n;let U=1;if(p===P&&(p=6),A<0?(U=0,A=-A):A>15&&(U=2,A-=16),a<1||a>9||T!==R||A<8||A>15||p<0||p>9||C<0||C>v)return mN(N,n);8===A&&(A=9);const X=new t;return N.state=X,X.strm=N,X.wrap=U,X.gzhead=null,X.w_bits=A,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=a+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<a+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=p,X.strategy=C,X.method=T,s(N)};N.exports.deflateInit=(N,p)=>NN(N,p,R,15,8,W),N.exports.deflateInit2=NN,N.exports.deflateReset=s,N.exports.deflateResetKeep=S,N.exports.deflateSetHeader=(N,p)=>N&&N.state?2!==N.state.wrap?n:(N.state.gzhead=p,I):n,N.exports.deflate=(N,p)=>{let T,A;if(!N||!N.state||p>x||p<0)return N?mN(N,n):n;const C=N.state;if(!N.output||!N.input&&0!==N.avail_in||C.status===Z&&p!==k)return mN(N,0===N.avail_out?g:n);C.strm=N;const y=C.last_flush;if(C.last_flush=p,42===C.status)if(2===C.wrap)N.adler=0,u(C,31),u(C,139),u(C,8),C.gzhead?(u(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),u(C,255&C.gzhead.time),u(C,C.gzhead.time>>8&255),u(C,C.gzhead.time>>16&255),u(C,C.gzhead.time>>24&255),u(C,9===C.level?2:C.strategy>=K||C.level<2?4:0),u(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(u(C,255&C.gzhead.extra.length),u(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(N.adler=e(N.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(u(C,0),u(C,0),u(C,0),u(C,0),u(C,0),u(C,9===C.level?2:C.strategy>=K||C.level<2?4:0),u(C,3),C.status=o);else{let p=R+(C.w_bits-8<<4)<<8,T=-1;T=C.strategy>=K||C.level<2?0:C.level<6?1:6===C.level?2:3,p|=T<<6,0!==C.strstart&&(p|=32),p+=31-p%31,C.status=o,Y(C,p),0!==C.strstart&&(Y(C,N.adler>>>16),Y(C,65535&N.adler)),N.adler=1}if(69===C.status)if(C.gzhead.extra){for(T=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),V(N),T=C.pending,C.pending!==C.pending_buf_size));)u(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(73===C.status)if(C.gzhead.name){T=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),V(N),T=C.pending,C.pending===C.pending_buf_size)){A=1;break}A=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,u(C,A)}while(0!==A);C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),0===A&&(C.gzindex=0,C.status=91)}else C.status=91;if(91===C.status)if(C.gzhead.comment){T=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),V(N),T=C.pending,C.pending===C.pending_buf_size)){A=1;break}A=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,u(C,A)}while(0!==A);C.gzhead.hcrc&&C.pending>T&&(N.adler=e(N.adler,C.pending_buf,C.pending-T,T)),0===A&&(C.status=G)}else C.status=G;if(C.status===G&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&V(N),C.pending+2<=C.pending_buf_size&&(u(C,255&N.adler),u(C,N.adler>>8&255),N.adler=0,C.status=o)):C.status=o),0!==C.pending){if(V(N),0===N.avail_out)return C.last_flush=-1,I}else if(0===N.avail_in&&q(p)<=q(y)&&p!==k)return mN(N,g);if(C.status===Z&&0!==N.avail_in)return mN(N,g);if(0!==N.avail_in||0!==C.lookahead||p!==M&&C.status!==Z){let T=C.strategy===K?((N,p)=>{let T;for(;;){if(0===N.lookahead&&(Q(N),0===N.lookahead)){if(p===M)return 1;break}if(N.match_length=0,T=U(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++,T&&(r(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,p===k?(r(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(r(N,!1),0===N.strm.avail_out)?1:2})(C,p):C.strategy===F?((N,p)=>{let T,A,a,C;const X=N.window;for(;;){if(N.lookahead<=J){if(Q(N),N.lookahead<=J&&p===M)return 1;if(0===N.lookahead)break}if(N.match_length=0,N.lookahead>=3&&N.strstart>0&&(a=N.strstart-1,A=X[a],A===X[++a]&&A===X[++a]&&A===X[++a])){C=N.strstart+J;do{}while(A===X[++a]&&A===X[++a]&&A===X[++a]&&A===X[++a]&&A===X[++a]&&A===X[++a]&&A===X[++a]&&A===X[++a]&&a<C);N.match_length=J-(C-a),N.match_length>N.lookahead&&(N.match_length=N.lookahead)}if(N.match_length>=3?(T=U(N,1,N.match_length-3),N.lookahead-=N.match_length,N.strstart+=N.match_length,N.match_length=0):(T=U(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++),T&&(r(N,!1),0===N.strm.avail_out))return 1}return N.insert=0,p===k?(r(N,!0),0===N.strm.avail_out?3:4):N.last_lit&&(r(N,!1),0===N.strm.avail_out)?1:2})(C,p):d[C.level].func(C,p);if(3!==T&&4!==T||(C.status=Z),1===T||3===T)return 0===N.avail_out&&(C.last_flush=-1),I;if(2===T&&(p===b?X(C):p!==x&&(a(C,0,0,!1),p===l&&(h(C.head),0===C.lookahead&&(C.strstart=0,C.block_start=0,C.insert=0))),V(N),0===N.avail_out))return C.last_flush=-1,I}return p!==k?I:C.wrap<=0?L:(2===C.wrap?(u(C,255&N.adler),u(C,N.adler>>8&255),u(C,N.adler>>16&255),u(C,N.adler>>24&255),u(C,255&N.total_in),u(C,N.total_in>>8&255),u(C,N.total_in>>16&255),u(C,N.total_in>>24&255)):(Y(C,N.adler>>>16),Y(C,65535&N.adler)),V(N),C.wrap>0&&(C.wrap=-C.wrap),0!==C.pending?I:L)},N.exports.deflateEnd=N=>{if(!N||!N.state)return n;const p=N.state.status;return 42!==p&&69!==p&&73!==p&&91!==p&&p!==G&&p!==o&&p!==Z?mN(N,n):(N.state=null,p===o?mN(N,w):I)},N.exports.deflateSetDictionary=(N,p)=>{let T=p.length;if(!N||!N.state)return n;const A=N.state,a=A.wrap;if(2===a||1===a&&42!==A.status||A.lookahead)return n;if(1===a&&(N.adler=y(N.adler,p,T,0)),A.wrap=0,T>=A.w_size){0===a&&(h(A.head),A.strstart=0,A.block_start=0,A.insert=0);let N=new Uint8Array(A.w_size);N.set(p.subarray(T-A.w_size,T),0),p=N,T=A.w_size}const C=N.avail_in,U=N.next_in,X=N.input;for(N.avail_in=T,N.next_in=0,N.input=p,Q(A);A.lookahead>=3;){let N=A.strstart,p=A.lookahead-2;do{A.ins_h=j(A,A.ins_h,A.window[N+3-1]),A.prev[N&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=N,N++}while(--p);A.strstart=N,A.lookahead=2,Q(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=2,A.match_available=0,N.next_in=U,N.input=X,N.avail_in=C,A.wrap=a,I},N.exports.deflateInfo="pako deflate (from Nodeca project)"},13585:N=>{"use strict";N.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13573:N=>{"use strict";N.exports=function(N,p){let T,A,a,C,U,X,y,e,H,M,b,l,k,x,I,L,n,w,g,P,i,K,F,v;const W=N.state;T=N.next_in,F=N.input,A=T+(N.avail_in-5),a=N.next_out,v=N.output,C=a-(p-N.avail_out),U=a+(N.avail_out-257),X=W.dmax,y=W.wsize,e=W.whave,H=W.wnext,M=W.window,b=W.hold,l=W.bits,k=W.lencode,x=W.distcode,I=(1<<W.lenbits)-1,L=(1<<W.distbits)-1;N:do{l<15&&(b+=F[T++]<<l,l+=8,b+=F[T++]<<l,l+=8),n=k[b&I];p:for(;;){if(w=n>>>24,b>>>=w,l-=w,w=n>>>16&255,0===w)v[a++]=65535&n;else{if(!(16&w)){if(0===(64&w)){n=k[(65535&n)+(b&(1<<w)-1)];continue p}if(32&w){W.mode=12;break N}N.Hp="invalid literal/length code",W.mode=30;break N}g=65535&n,w&=15,w&&(l<w&&(b+=F[T++]<<l,l+=8),g+=b&(1<<w)-1,b>>>=w,l-=w),l<15&&(b+=F[T++]<<l,l+=8,b+=F[T++]<<l,l+=8),n=x[b&L];T:for(;;){if(w=n>>>24,b>>>=w,l-=w,w=n>>>16&255,!(16&w)){if(0===(64&w)){n=x[(65535&n)+(b&(1<<w)-1)];continue T}N.Hp="invalid distance code",W.mode=30;break N}if(P=65535&n,w&=15,l<w&&(b+=F[T++]<<l,l+=8,l<w&&(b+=F[T++]<<l,l+=8)),P+=b&(1<<w)-1,P>X){N.Hp="invalid distance too far back",W.mode=30;break N}if(b>>>=w,l-=w,w=a-C,P>w){if(w=P-w,w>e&&W.sane){N.Hp="invalid distance too far back",W.mode=30;break N}if(i=0,K=M,0===H){if(i+=y-w,w<g){g-=w;do{v[a++]=M[i++]}while(--w);i=a-P,K=v}}else if(H<w){if(i+=y+H-w,w-=H,w<g){g-=w;do{v[a++]=M[i++]}while(--w);if(i=0,H<g){w=H,g-=w;do{v[a++]=M[i++]}while(--w);i=a-P,K=v}}}else if(i+=H-w,w<g){g-=w;do{v[a++]=M[i++]}while(--w);i=a-P,K=v}for(;g>2;)v[a++]=K[i++],v[a++]=K[i++],v[a++]=K[i++],g-=3;g&&(v[a++]=K[i++],g>1&&(v[a++]=K[i++]))}else{i=a-P;do{v[a++]=v[i++],v[a++]=v[i++],v[a++]=v[i++],g-=3}while(g>2);g&&(v[a++]=v[i++],g>1&&(v[a++]=v[i++]))}break}}break}}while(T<A&&a<U);g=l>>3,T-=g,l-=g<<3,b&=(1<<l)-1,N.next_in=T,N.next_out=a,N.avail_in=T<A?A-T+5:5-(T-A),N.avail_out=a<U?U-a+257:257-(a-U),W.hold=b,W.bits=l}},13567:(N,p,T)=>{"use strict";const A=T(13520),a=T(13523),C=T(13573),U=T(13580),{Z_FINISH:X,Z_BLOCK:y,Z_TREES:e,Z_OK:H,Z_STREAM_END:M,Z_NEED_DICT:b,Z_STREAM_ERROR:l,Z_DATA_ERROR:k,Z_MEM_ERROR:x,Z_BUF_ERROR:I,Z_DEFLATED:L}=T(13538),n=12,w=30,g=N=>(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24);function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const i=N=>{if(!N||!N.state)return l;const p=N.state;return N.total_in=N.total_out=p.total=0,N.Hp="",p.wrap&&(N.adler=1&p.wrap),p.mode=1,p.last=0,p.havedict=0,p.dmax=32768,p.head=null,p.hold=0,p.bits=0,p.lencode=p.lendyn=new Int32Array(852),p.distcode=p.distdyn=new Int32Array(592),p.sane=1,p.back=-1,H},K=N=>{if(!N||!N.state)return l;const p=N.state;return p.wsize=0,p.whave=0,p.wnext=0,i(N)},F=(N,p)=>{let T;if(!N||!N.state)return l;const A=N.state;return p<0?(T=0,p=-p):(T=1+(p>>4),p<48&&(p&=15)),p&&(p<8||p>15)?l:(null!==A.window&&A.wbits!==p&&(A.window=null),A.wrap=T,A.wbits=p,K(N))},v=(N,p)=>{if(!N)return l;const T=new P;N.state=T,T.window=null;const A=F(N,p);return A!==H&&(N.state=null),A};let W,z,R=!0;const J=N=>{if(R){W=new Int32Array(512),z=new Int32Array(32);let p=0;for(;p<144;)N.lens[p++]=8;for(;p<256;)N.lens[p++]=9;for(;p<280;)N.lens[p++]=7;for(;p<288;)N.lens[p++]=8;for(U(1,N.lens,0,288,W,0,N.work,{bits:9}),p=0;p<32;)N.lens[p++]=5;U(2,N.lens,0,32,z,0,N.work,{bits:5}),R=!1}N.lencode=W,N.lenbits=9,N.distcode=z,N.distbits=5},f=(N,p,T,A)=>{let a;const C=N.state;return null===C.window&&(C.wsize=1<<C.wbits,C.wnext=0,C.whave=0,C.window=new Uint8Array(C.wsize)),A>=C.wsize?(C.window.set(p.subarray(T-C.wsize,T),0),C.wnext=0,C.whave=C.wsize):(a=C.wsize-C.wnext,a>A&&(a=A),C.window.set(p.subarray(T-A,T-A+a),C.wnext),(A-=a)?(C.window.set(p.subarray(T-A,T),0),C.wnext=A,C.whave=C.wsize):(C.wnext+=a,C.wnext===C.wsize&&(C.wnext=0),C.whave<C.wsize&&(C.whave+=a))),0};N.exports.inflateReset=K,N.exports.inflateReset2=F,N.exports.inflateResetKeep=i,N.exports.inflateInit=N=>v(N,15),N.exports.inflateInit2=v,N.exports.inflate=(N,p)=>{let T,P,i,K,F,v,W,z,R,G,o,Z,mN,q,h,j,V,r,u,Y,D,c,Q=0;const E=new Uint8Array(4);let O,B;const d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!N||!N.state||!N.output||!N.input&&0!==N.avail_in)return l;T=N.state,T.mode===n&&(T.mode=13),F=N.next_out,i=N.output,W=N.avail_out,K=N.next_in,P=N.input,v=N.avail_in,z=T.hold,R=T.bits,G=v,o=W,c=H;N:for(;;)switch(T.mode){case 1:if(0===T.wrap){T.mode=13;break}for(;R<16;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(2&T.wrap&&35615===z){T.check=0,E[0]=255&z,E[1]=z>>>8&255,T.check=a(T.check,E,2,0),z=0,R=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&z)<<8)+(z>>8))%31){N.Hp="incorrect header check",T.mode=w;break}if((15&z)!==L){N.Hp="unknown compression method",T.mode=w;break}if(z>>>=4,R-=4,D=8+(15&z),0===T.wbits)T.wbits=D;else if(D>T.wbits){N.Hp="invalid window size",T.mode=w;break}T.dmax=1<<T.wbits,N.adler=T.check=1,T.mode=512&z?10:n,z=0,R=0;break;case 2:for(;R<16;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(T.flags=z,(255&T.flags)!==L){N.Hp="unknown compression method",T.mode=w;break}if(57344&T.flags){N.Hp="unknown header flags set",T.mode=w;break}T.head&&(T.head.text=z>>8&1),512&T.flags&&(E[0]=255&z,E[1]=z>>>8&255,T.check=a(T.check,E,2,0)),z=0,R=0,T.mode=3;case 3:for(;R<32;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.head&&(T.head.time=z),512&T.flags&&(E[0]=255&z,E[1]=z>>>8&255,E[2]=z>>>16&255,E[3]=z>>>24&255,T.check=a(T.check,E,4,0)),z=0,R=0,T.mode=4;case 4:for(;R<16;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.head&&(T.head.xflags=255&z,T.head.os=z>>8),512&T.flags&&(E[0]=255&z,E[1]=z>>>8&255,T.check=a(T.check,E,2,0)),z=0,R=0,T.mode=5;case 5:if(1024&T.flags){for(;R<16;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.length=z,T.head&&(T.head.extra_len=z),512&T.flags&&(E[0]=255&z,E[1]=z>>>8&255,T.check=a(T.check,E,2,0)),z=0,R=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(Z=T.length,Z>v&&(Z=v),Z&&(T.head&&(D=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Uint8Array(T.head.extra_len)),T.head.extra.set(P.subarray(K,K+Z),D)),512&T.flags&&(T.check=a(T.check,P,Z,K)),v-=Z,K+=Z,T.length-=Z),T.length))break N;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(0===v)break N;Z=0;do{D=P[K+Z++],T.head&&D&&T.length<65536&&(T.head.name+=String.fromCharCode(D))}while(D&&Z<v);if(512&T.flags&&(T.check=a(T.check,P,Z,K)),v-=Z,K+=Z,D)break N}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(0===v)break N;Z=0;do{D=P[K+Z++],T.head&&D&&T.length<65536&&(T.head.comment+=String.fromCharCode(D))}while(D&&Z<v);if(512&T.flags&&(T.check=a(T.check,P,Z,K)),v-=Z,K+=Z,D)break N}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;R<16;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(z!==(65535&T.check)){N.Hp="header crc mismatch",T.mode=w;break}z=0,R=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),N.adler=T.check=0,T.mode=n;break;case 10:for(;R<32;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}N.adler=T.check=g(z),z=0,R=0,T.mode=11;case 11:if(0===T.havedict)return N.next_out=F,N.avail_out=W,N.next_in=K,N.avail_in=v,T.hold=z,T.bits=R,b;N.adler=T.check=1,T.mode=n;case n:if(p===y||p===e)break N;case 13:if(T.last){z>>>=7&R,R-=7&R,T.mode=27;break}for(;R<3;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}switch(T.last=1&z,z>>>=1,R-=1,3&z){case 0:T.mode=14;break;case 1:if(J(T),T.mode=20,p===e){z>>>=2,R-=2;break N}break;case 2:T.mode=17;break;case 3:N.Hp="invalid block type",T.mode=w}z>>>=2,R-=2;break;case 14:for(z>>>=7&R,R-=7&R;R<32;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if((65535&z)!==(z>>>16^65535)){N.Hp="invalid stored block lengths",T.mode=w;break}if(T.length=65535&z,z=0,R=0,T.mode=15,p===e)break N;case 15:T.mode=16;case 16:if(Z=T.length,Z){if(Z>v&&(Z=v),Z>W&&(Z=W),0===Z)break N;i.set(P.subarray(K,K+Z),F),v-=Z,K+=Z,W-=Z,F+=Z,T.length-=Z;break}T.mode=n;break;case 17:for(;R<14;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(T.nlen=257+(31&z),z>>>=5,R-=5,T.ndist=1+(31&z),z>>>=5,R-=5,T.ncode=4+(15&z),z>>>=4,R-=4,T.nlen>286||T.ndist>30){N.Hp="too many length or distance symbols",T.mode=w;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;R<3;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.lens[d[T.have++]]=7&z,z>>>=3,R-=3}for(;T.have<19;)T.lens[d[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,O={bits:T.lenbits},c=U(0,T.lens,0,19,T.lencode,0,T.work,O),T.lenbits=O.bits,c){N.Hp="invalid code lengths set",T.mode=w;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;Q=T.lencode[z&(1<<T.lenbits)-1],h=Q>>>24,j=Q>>>16&255,V=65535&Q,!(h<=R);){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(V<16)z>>>=h,R-=h,T.lens[T.have++]=V;else{if(16===V){for(B=h+2;R<B;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(z>>>=h,R-=h,0===T.have){N.Hp="invalid bit length repeat",T.mode=w;break}D=T.lens[T.have-1],Z=3+(3&z),z>>>=2,R-=2}else if(17===V){for(B=h+3;R<B;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}z>>>=h,R-=h,D=0,Z=3+(7&z),z>>>=3,R-=3}else{for(B=h+7;R<B;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}z>>>=h,R-=h,D=0,Z=11+(127&z),z>>>=7,R-=7}if(T.have+Z>T.nlen+T.ndist){N.Hp="invalid bit length repeat",T.mode=w;break}for(;Z--;)T.lens[T.have++]=D}}if(T.mode===w)break;if(0===T.lens[256]){N.Hp="invalid code -- missing end-of-block",T.mode=w;break}if(T.lenbits=9,O={bits:T.lenbits},c=U(1,T.lens,0,T.nlen,T.lencode,0,T.work,O),T.lenbits=O.bits,c){N.Hp="invalid literal/lengths set",T.mode=w;break}if(T.distbits=6,T.distcode=T.distdyn,O={bits:T.distbits},c=U(2,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,O),T.distbits=O.bits,c){N.Hp="invalid distances set",T.mode=w;break}if(T.mode=20,p===e)break N;case 20:T.mode=21;case 21:if(v>=6&&W>=258){N.next_out=F,N.avail_out=W,N.next_in=K,N.avail_in=v,T.hold=z,T.bits=R,C(N,o),F=N.next_out,i=N.output,W=N.avail_out,K=N.next_in,P=N.input,v=N.avail_in,z=T.hold,R=T.bits,T.mode===n&&(T.back=-1);break}for(T.back=0;Q=T.lencode[z&(1<<T.lenbits)-1],h=Q>>>24,j=Q>>>16&255,V=65535&Q,!(h<=R);){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(j&&0===(240&j)){for(r=h,u=j,Y=V;Q=T.lencode[Y+((z&(1<<r+u)-1)>>r)],h=Q>>>24,j=Q>>>16&255,V=65535&Q,!(r+h<=R);){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}z>>>=r,R-=r,T.back+=r}if(z>>>=h,R-=h,T.back+=h,T.length=V,0===j){T.mode=26;break}if(32&j){T.back=-1,T.mode=n;break}if(64&j){N.Hp="invalid literal/length code",T.mode=w;break}T.extra=15&j,T.mode=22;case 22:if(T.extra){for(B=T.extra;R<B;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.length+=z&(1<<T.extra)-1,z>>>=T.extra,R-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;Q=T.distcode[z&(1<<T.distbits)-1],h=Q>>>24,j=Q>>>16&255,V=65535&Q,!(h<=R);){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(0===(240&j)){for(r=h,u=j,Y=V;Q=T.distcode[Y+((z&(1<<r+u)-1)>>r)],h=Q>>>24,j=Q>>>16&255,V=65535&Q,!(r+h<=R);){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}z>>>=r,R-=r,T.back+=r}if(z>>>=h,R-=h,T.back+=h,64&j){N.Hp="invalid distance code",T.mode=w;break}T.offset=V,T.extra=15&j,T.mode=24;case 24:if(T.extra){for(B=T.extra;R<B;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}T.offset+=z&(1<<T.extra)-1,z>>>=T.extra,R-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){N.Hp="invalid distance too far back",T.mode=w;break}T.mode=25;case 25:if(0===W)break N;if(Z=o-W,T.offset>Z){if(Z=T.offset-Z,Z>T.whave&&T.sane){N.Hp="invalid distance too far back",T.mode=w;break}Z>T.wnext?(Z-=T.wnext,mN=T.wsize-Z):mN=T.wnext-Z,Z>T.length&&(Z=T.length),q=T.window}else q=i,mN=F-T.offset,Z=T.length;Z>W&&(Z=W),W-=Z,T.length-=Z;do{i[F++]=q[mN++]}while(--Z);0===T.length&&(T.mode=21);break;case 26:if(0===W)break N;i[F++]=T.length,W--,T.mode=21;break;case 27:if(T.wrap){for(;R<32;){if(0===v)break N;v--,z|=P[K++]<<R,R+=8}if(o-=W,N.total_out+=o,T.total+=o,o&&(N.adler=T.check=T.flags?a(T.check,i,o,F-o):A(T.check,i,o,F-o)),o=W,(T.flags?z:g(z))!==T.check){N.Hp="incorrect data check",T.mode=w;break}z=0,R=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;R<32;){if(0===v)break N;v--,z+=P[K++]<<R,R+=8}if(z!==(4294967295&T.total)){N.Hp="incorrect length check",T.mode=w;break}z=0,R=0}T.mode=29;case 29:c=M;break N;case w:c=k;break N;case 31:return x;default:return l}return N.next_out=F,N.avail_out=W,N.next_in=K,N.avail_in=v,T.hold=z,T.bits=R,(T.wsize||o!==N.avail_out&&T.mode<w&&(T.mode<27||p!==X))&&f(N,N.output,N.next_out,o-N.avail_out)?(T.mode=31,x):(G-=N.avail_in,o-=N.avail_out,N.total_in+=G,N.total_out+=o,T.total+=o,T.wrap&&o&&(N.adler=T.check=T.flags?a(T.check,i,o,N.next_out-o):A(T.check,i,o,N.next_out-o)),N.data_type=T.bits+(T.last?64:0)+(T.mode===n?128:0)+(20===T.mode||15===T.mode?256:0),(0===G&&0===o||p===X)&&c===H&&(c=I),c)},N.exports.inflateEnd=N=>{if(!N||!N.state)return l;let p=N.state;return p.window&&(p.window=null),N.state=null,H},N.exports.inflateGetHeader=(N,p)=>{if(!N||!N.state)return l;const T=N.state;return 0===(2&T.wrap)?l:(T.head=p,p.done=!1,H)},N.exports.inflateSetDictionary=(N,p)=>{const T=p.length;let a,C,U;return N&&N.state?(a=N.state,0!==a.wrap&&11!==a.mode?l:11===a.mode&&(C=1,C=A(C,p,T,0),C!==a.check)?k:(U=f(N,p,T,T),U?(a.mode=31,x):(a.havedict=1,H))):l},N.exports.inflateInfo="pako inflate (from Nodeca project)"},13580:N=>{"use strict";const p=15,T=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),A=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),C=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);N.exports=(N,U,X,y,e,H,M,b)=>{const l=b.bits;let k,x,I,L,n,w,g=0,P=0,i=0,K=0,F=0,v=0,W=0,z=0,R=0,J=0,f=null,G=0;const o=new Uint16Array(16),Z=new Uint16Array(16);let mN,q,h,j=null,V=0;for(g=0;g<=p;g++)o[g]=0;for(P=0;P<y;P++)o[U[X+P]]++;for(F=l,K=p;K>=1&&0===o[K];K--);if(F>K&&(F=K),0===K)return e[H++]=20971520,e[H++]=20971520,b.bits=1,0;for(i=1;i<K&&0===o[i];i++);for(F<i&&(F=i),z=1,g=1;g<=p;g++)if(z<<=1,z-=o[g],z<0)return-1;if(z>0&&(0===N||1!==K))return-1;for(Z[1]=0,g=1;g<p;g++)Z[g+1]=Z[g]+o[g];for(P=0;P<y;P++)0!==U[X+P]&&(M[Z[U[X+P]]++]=P);if(0===N?(f=j=M,w=19):1===N?(f=T,G-=257,j=A,V-=257,w=256):(f=a,j=C,w=-1),J=0,P=0,g=i,n=H,v=F,W=0,I=-1,R=1<<F,L=R-1,1===N&&R>852||2===N&&R>592)return 1;for(;;){mN=g-W,M[P]<w?(q=0,h=M[P]):M[P]>w?(q=j[V+M[P]],h=f[G+M[P]]):(q=96,h=0),k=1<<g-W,x=1<<v,i=x;do{x-=k,e[n+(J>>W)+x]=mN<<24|q<<16|h}while(0!==x);for(k=1<<g-1;J&k;)k>>=1;if(0!==k?(J&=k-1,J+=k):J=0,P++,0===--o[g]){if(g===K)break;g=U[X+M[P]]}if(g>F&&(J&L)!==I){for(0===W&&(W=F),n+=i,v=g-W,z=1<<v;v+W<K&&(z-=o[v+W],!(z<=0));)v++,z<<=1;if(R+=1<<v,1===N&&R>852||2===N&&R>592)return 1;I=J&L,e[I]=F<<24|v<<16|n-H}}return 0!==J&&(e[n+J]=g-W<<24|64<<16),b.bits=F,0}},13531:N=>{"use strict";N.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13514:N=>{"use strict";function p(N){let p=N.length;for(;--p>=0;)N[p]=0}const T=256,A=286,a=30,C=15,U=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H=new Array(576);p(H);const M=new Array(60);p(M);const b=new Array(512);p(b);const l=new Array(256);p(l);const k=new Array(29);p(k);const x=new Array(a);function I(N,p,T,A,a){this.static_tree=N,this.extra_bits=p,this.extra_base=T,this.elems=A,this.max_length=a,this.has_stree=N&&N.length}let L,n,w;function g(N,p){this.dyn_tree=N,this.max_code=0,this.stat_desc=p}p(x);const P=N=>N<256?b[N]:b[256+(N>>>7)],i=(N,p)=>{N.pending_buf[N.pending++]=255&p,N.pending_buf[N.pending++]=p>>>8&255},K=(N,p,T)=>{N.bi_valid>16-T?(N.bi_buf|=p<<N.bi_valid&65535,i(N,N.bi_buf),N.bi_buf=p>>16-N.bi_valid,N.bi_valid+=T-16):(N.bi_buf|=p<<N.bi_valid&65535,N.bi_valid+=T)},F=(N,p,T)=>{K(N,T[2*p],T[2*p+1])},v=(N,p)=>{let T=0;do{T|=1&N,N>>>=1,T<<=1}while(--p>0);return T>>>1},W=(N,p,T)=>{const A=new Array(16);let a,U,X=0;for(a=1;a<=C;a++)A[a]=X=X+T[a-1]<<1;for(U=0;U<=p;U++){let p=N[2*U+1];0!==p&&(N[2*U]=v(A[p]++,p))}},z=N=>{let p;for(p=0;p<A;p++)N.dyn_ltree[2*p]=0;for(p=0;p<a;p++)N.dyn_dtree[2*p]=0;for(p=0;p<19;p++)N.bl_tree[2*p]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0},R=N=>{N.bi_valid>8?i(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0},J=(N,p,T,A)=>{const a=2*p,C=2*T;return N[a]<N[C]||N[a]===N[C]&&A[p]<=A[T]},f=(N,p,T)=>{const A=N.heap[T];let a=T<<1;for(;a<=N.heap_len&&(a<N.heap_len&&J(p,N.heap[a+1],N.heap[a],N.depth)&&a++,!J(p,A,N.heap[a],N.depth));)N.heap[T]=N.heap[a],T=a,a<<=1;N.heap[T]=A},G=(N,p,A)=>{let a,C,y,e,H=0;if(0!==N.last_lit)do{a=N.pending_buf[N.d_buf+2*H]<<8|N.pending_buf[N.d_buf+2*H+1],C=N.pending_buf[N.l_buf+H],H++,0===a?F(N,C,p):(y=l[C],F(N,y+T+1,p),e=U[y],0!==e&&(C-=k[y],K(N,C,e)),a--,y=P(a),F(N,y,A),e=X[y],0!==e&&(a-=x[y],K(N,a,e)))}while(H<N.last_lit);F(N,256,p)},o=(N,p)=>{const T=p.dyn_tree,A=p.stat_desc.static_tree,a=p.stat_desc.has_stree,U=p.stat_desc.elems;let X,y,e,H=-1;for(N.heap_len=0,N.heap_max=573,X=0;X<U;X++)0!==T[2*X]?(N.heap[++N.heap_len]=H=X,N.depth[X]=0):T[2*X+1]=0;for(;N.heap_len<2;)e=N.heap[++N.heap_len]=H<2?++H:0,T[2*e]=1,N.depth[e]=0,N.opt_len--,a&&(N.static_len-=A[2*e+1]);for(p.max_code=H,X=N.heap_len>>1;X>=1;X--)f(N,T,X);e=U;do{X=N.heap[1],N.heap[1]=N.heap[N.heap_len--],f(N,T,1),y=N.heap[1],N.heap[--N.heap_max]=X,N.heap[--N.heap_max]=y,T[2*e]=T[2*X]+T[2*y],N.depth[e]=(N.depth[X]>=N.depth[y]?N.depth[X]:N.depth[y])+1,T[2*X+1]=T[2*y+1]=e,N.heap[1]=e++,f(N,T,1)}while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],((N,p)=>{const T=p.dyn_tree,A=p.max_code,a=p.stat_desc.static_tree,U=p.stat_desc.has_stree,X=p.stat_desc.extra_bits,y=p.stat_desc.extra_base,e=p.stat_desc.max_length;let H,M,b,l,k,x,I=0;for(l=0;l<=C;l++)N.bl_count[l]=0;for(T[2*N.heap[N.heap_max]+1]=0,H=N.heap_max+1;H<573;H++)M=N.heap[H],l=T[2*T[2*M+1]+1]+1,l>e&&(l=e,I++),T[2*M+1]=l,M>A||(N.bl_count[l]++,k=0,M>=y&&(k=X[M-y]),x=T[2*M],N.opt_len+=x*(l+k),U&&(N.static_len+=x*(a[2*M+1]+k)));if(0!==I){do{for(l=e-1;0===N.bl_count[l];)l--;N.bl_count[l]--,N.bl_count[l+1]+=2,N.bl_count[e]--,I-=2}while(I>0);for(l=e;0!==l;l--)for(M=N.bl_count[l];0!==M;)b=N.heap[--H],b>A||(T[2*b+1]!==l&&(N.opt_len+=(l-T[2*b+1])*T[2*b],T[2*b+1]=l),M--)}})(N,p),W(T,H,N.bl_count)},Z=(N,p,T)=>{let A,a,C=-1,U=p[1],X=0,y=7,e=4;for(0===U&&(y=138,e=3),p[2*(T+1)+1]=65535,A=0;A<=T;A++)a=U,U=p[2*(A+1)+1],++X<y&&a===U||(X<e?N.bl_tree[2*a]+=X:0!==a?(a!==C&&N.bl_tree[2*a]++,N.bl_tree[32]++):X<=10?N.bl_tree[34]++:N.bl_tree[36]++,X=0,C=a,0===U?(y=138,e=3):a===U?(y=6,e=3):(y=7,e=4))},mN=(N,p,T)=>{let A,a,C=-1,U=p[1],X=0,y=7,e=4;for(0===U&&(y=138,e=3),A=0;A<=T;A++)if(a=U,U=p[2*(A+1)+1],!(++X<y&&a===U)){if(X<e)do{F(N,a,N.bl_tree)}while(0!==--X);else 0!==a?(a!==C&&(F(N,a,N.bl_tree),X--),F(N,16,N.bl_tree),K(N,X-3,2)):X<=10?(F(N,17,N.bl_tree),K(N,X-3,3)):(F(N,18,N.bl_tree),K(N,X-11,7));X=0,C=a,0===U?(y=138,e=3):a===U?(y=6,e=3):(y=7,e=4)}};let q=!1;const h=(N,p,T,A)=>{K(N,0+(A?1:0),3),((N,p,T,A)=>{R(N),A&&(i(N,T),i(N,~T)),N.pending_buf.set(N.window.subarray(p,p+T),N.pending),N.pending+=T})(N,p,T,!0)};N.exports._tr_init=N=>{q||((()=>{let N,p,T,e,g;const P=new Array(16);for(T=0,e=0;e<28;e++)for(k[e]=T,N=0;N<1<<U[e];N++)l[T++]=e;for(l[T-1]=e,g=0,e=0;e<16;e++)for(x[e]=g,N=0;N<1<<X[e];N++)b[g++]=e;for(g>>=7;e<a;e++)for(x[e]=g<<7,N=0;N<1<<X[e]-7;N++)b[256+g++]=e;for(p=0;p<=C;p++)P[p]=0;for(N=0;N<=143;)H[2*N+1]=8,N++,P[8]++;for(;N<=255;)H[2*N+1]=9,N++,P[9]++;for(;N<=279;)H[2*N+1]=7,N++,P[7]++;for(;N<=287;)H[2*N+1]=8,N++,P[8]++;for(W(H,287,P),N=0;N<a;N++)M[2*N+1]=5,M[2*N]=v(N,5);L=new I(H,U,257,A,C),n=new I(M,X,0,a,C),w=new I(new Array(0),y,0,19,7)})(),q=!0),N.l_desc=new g(N.dyn_ltree,L),N.d_desc=new g(N.dyn_dtree,n),N.bl_desc=new g(N.bl_tree,w),N.bi_buf=0,N.bi_valid=0,z(N)},N.exports._tr_stored_block=h,N.exports._tr_flush_block=(N,p,A,a)=>{let C,U,X=0;N.level>0?(2===N.strm.data_type&&(N.strm.data_type=(N=>{let p,A=4093624447;for(p=0;p<=31;p++,A>>>=1)if(1&A&&0!==N.dyn_ltree[2*p])return 0;if(0!==N.dyn_ltree[18]||0!==N.dyn_ltree[20]||0!==N.dyn_ltree[26])return 1;for(p=32;p<T;p++)if(0!==N.dyn_ltree[2*p])return 1;return 0})(N)),o(N,N.l_desc),o(N,N.d_desc),X=(N=>{let p;for(Z(N,N.dyn_ltree,N.l_desc.max_code),Z(N,N.dyn_dtree,N.d_desc.max_code),o(N,N.bl_desc),p=18;p>=3&&0===N.bl_tree[2*e[p]+1];p--);return N.opt_len+=3*(p+1)+5+5+4,p})(N),C=N.opt_len+3+7>>>3,U=N.static_len+3+7>>>3,U<=C&&(C=U)):C=U=A+5,A+4<=C&&-1!==p?h(N,p,A,a):4===N.strategy||U===C?(K(N,2+(a?1:0),3),G(N,H,M)):(K(N,4+(a?1:0),3),((N,p,T,A)=>{let a;for(K(N,p-257,5),K(N,T-1,5),K(N,A-4,4),a=0;a<A;a++)K(N,N.bl_tree[2*e[a]+1],3);mN(N,N.dyn_ltree,p-1),mN(N,N.dyn_dtree,T-1)})(N,N.l_desc.max_code+1,N.d_desc.max_code+1,X+1),G(N,N.dyn_ltree,N.dyn_dtree)),z(N),a&&R(N)},N.exports._tr_tally=(N,p,A)=>(N.pending_buf[N.d_buf+2*N.last_lit]=p>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&p,N.pending_buf[N.l_buf+N.last_lit]=255&A,N.last_lit++,0===p?N.dyn_ltree[2*A]++:(N.matches++,p--,N.dyn_ltree[2*(l[A]+T+1)]++,N.dyn_dtree[2*P(p)]++),N.last_lit===N.lit_bufsize-1),N.exports._tr_align=N=>{K(N,2,3),F(N,256,H),(N=>{16===N.bi_valid?(i(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)})(N)}},13559:N=>{"use strict";N.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Hp="",this.state=null,this.data_type=2,this.adler=0}},13201:N=>{function p(N,p,T){for(var A=N.length,a=-1/0,C=1/0,U=0;U<A;U++){var X=(T[0][U]-N[U])/p[U],y=(T[1][U]-N[U])/p[U];if(X>y){var e=X;X=y,y=e}if(y<a||X>C)return 1/0;X>a&&(a=X),y<C&&(C=y)}return a>C?1/0:a}N.exports=function(N,T,A,a){var C=p(T,A,a);if(C===1/0)N=null;else{N=N||[];for(var U=0;U<T.length;U++)N[U]=T[U]+A[U]*C}return N},N.exports.distance=p},14516:(N,p,T)=>{"use strict";T.d(p,{e:()=>U});var A=T(27);const a=A.useLayoutEffect;const C=function(N){var p=(0,A.useRef)(N);return a((function(){p.current=N})),p};var U=function(N){var p=C(N);(0,A.Xp)((function(){var N=function(N){var T;if(null!=p.current&&(T=p.current(N)),N.defaultPrevented&&(N.returnValue=""),"string"===typeof T)return N.returnValue=T,T};return window.addEventListener("beforeunload",N),function(){window.removeEventListener("beforeunload",N)}}),[])}},14466:(N,p,T)=>{"use strict";var A=T(14468),a=Array.prototype.concat,C=Array.prototype.slice,U=N.exports=function(N){for(var p=[],T=0,U=N.length;T<U;T++){var X=N[T];A(X)?p=a.call(p,C.call(X)):p.push(X)}return p};U.wrap=function(N){return function(){return N(U(arguments))}}},14468:N=>{N.exports=function(N){return!(!N||"string"===typeof N)&&(N instanceof Array||Array.isArray(N)||N.length>=0&&(N.splice instanceof Function||Object.getOwnPropertyDescriptor(N,N.length-1)&&"String"!==N.constructor.name))}},13467:(N,p,T)=>{var A=T(13469);function a(N){for(var p,T,a=0,C=N.length,U=0;U<N.length;){for(p=N[U],T=0;U<C&&N[U]===p;)++U,++T;a+=A.log2(T)/7|0,a+=A.log2(p>>>0)/7|0,a+=2}return a}p.size=a,p.encode=function(N,p){p||(p=new Uint8Array(a(N)));for(var T,A,C=0,U=p.length,X=0;X<N.length;){for(T=N[X],A=0;X<N.length&&N[X]===T;)++X,++A;for(;C<U&&A>=128;)p[C++]=128+(127&A),A>>>=7;if(C>=U)throw new Error("RLE buffer overflow");for(p[C++]=A,T>>>=0;C<U&&T>=128;)p[C++]=128+(127&T),T>>>=7;if(C>=U)throw new Error("RLE buffer overflow");p[C++]=T}return p},p.decode=function(N,p){for(var T,A,a,C,U=p.length,X=N.length,y=0,e=0;e<X;){for(T=0,A=0;e<X&&N[e]>=128;)T+=(127&N[e++])<<A,A+=7;if(T+=N[e++]<<A,e>=X)throw new Error("RLE buffer underrun");if(y+T>U)throw new Error("Chunk buffer overflow");for(a=0,A=0;e<X&&N[e]>=128;)a+=(127&N[e++])<<A,A+=7;if(e>=X)throw new Error("RLE buffer underrun");for(a+=N[e++]<<A,C=0;C<T;++C)p[y++]=a}return p}},13469:(N,p)=>{"use strict";function T(N){var p=32;return(N&=-N)&&p--,65535&N&&(p-=16),16711935&N&&(p-=8),252645135&N&&(p-=4),858993459&N&&(p-=2),1431655765&N&&(p-=1),p}p.INT_BITS=32,p.INT_MAX=2147483647,p.INT_MIN=-1<<31,p.sign=function(N){return(N>0)-(N<0)},p.abs=function(N){var p=N>>31;return(N^p)-p},p.min=function(N,p){return p^(N^p)&-(N<p)},p.max=function(N,p){return N^(N^p)&-(N<p)},p.isPow2=function(N){return!(N&N-1)&&!!N},p.log2=function(N){var p,T;return p=(N>65535)<<4,p|=T=((N>>>=p)>255)<<3,p|=T=((N>>>=T)>15)<<2,(p|=T=((N>>>=T)>3)<<1)|(N>>>=T)>>1},p.log10=function(N){return N>=1e9?9:N>=1e8?8:N>=1e7?7:N>=1e6?6:N>=1e5?5:N>=1e4?4:N>=1e3?3:N>=100?2:N>=10?1:0},p.popCount=function(N){return 16843009*((N=(858993459&(N-=N>>>1&1431655765))+(N>>>2&858993459))+(N>>>4)&252645135)>>>24},p.countTrailingZeros=T,p.nextPow2=function(N){return N+=0===N,--N,N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)+1},p.prevPow2=function(N){return N|=N>>>1,N|=N>>>2,N|=N>>>4,N|=N>>>8,(N|=N>>>16)-(N>>>1)},p.parity=function(N){return N^=N>>>16,N^=N>>>8,N^=N>>>4,27030>>>(N&=15)&1};var A=new Array(256);!function(N){for(var p=0;p<256;++p){var T=p,A=p,a=7;for(T>>>=1;T;T>>>=1)A<<=1,A|=1&T,--a;N[p]=A<<a&255}}(A),p.reverse=function(N){return A[255&N]<<24|A[N>>>8&255]<<16|A[N>>>16&255]<<8|A[N>>>24&255]},p.interleave2=function(N,p){return(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p&=65535)|p<<8))|p<<4))|p<<2))|p<<1))<<1},p.deinterleave2=function(N,p){return(N=65535&((N=16711935&((N=252645135&((N=858993459&((N=N>>>p&1431655765)|N>>>1))|N>>>2))|N>>>4))|N>>>16))<<16>>16},p.interleave3=function(N,p,T){return N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2),(N|=(p=1227133513&((p=3272356035&((p=251719695&((p=4278190335&((p&=1023)|p<<16))|p<<8))|p<<4))|p<<2))<<1)|(T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2))<<2},p.deinterleave3=function(N,p){return(N=1023&((N=4278190335&((N=251719695&((N=3272356035&((N=N>>>p&1227133513)|N>>>2))|N>>>4))|N>>>8))|N>>>16))<<22>>22},p.nextCombination=function(N){var p=N|N-1;return p+1|(~p&-~p)-1>>>T(N)+1}},13489:N=>{"use strict";N.exports=function(N,p,T,A){var a=self||window;try{try{var C;try{C=new a.Blob([N])}catch(e){(C=new(a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder)).append(N),C=C.getBlob()}var U=a.URL||a.webkitURL,X=U.createObjectURL(C),y=new a[p](X,T);return U.revokeObjectURL(X),y}catch(e){return new a[p]("data:application/javascript,".concat(encodeURIComponent(N)),T)}}catch(e){if(!A)throw Error("Inline worker is not supported");return new a[p](A,T)}}},13186:(N,p,T)=>{"use strict";function A(N,p,T,A,a){var C={};return Object.keys(A).forEach((function(N){C[N]=A[N]})),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=T.slice().reverse().reduce((function(T,A){return A(N,p,T)||T}),C),a&&void 0!==C.initializer&&(C.value=C.initializer?C.initializer.call(a):void 0,C.initializer=void 0),void 0===C.initializer&&(Object.defineProperty(N,p,C),C=null),C}T.d(p,{e:()=>A})},13184:(N,p,T)=>{"use strict";function A(N,p,T,A){T&&Object.defineProperty(N,p,{enumerable:T.enumerable,configurable:T.configurable,writable:T.writable,value:T.initializer?T.initializer.call(A):void 0})}T.d(p,{d:()=>A})},14505:(N,p,T)=>{"use strict";T.d(p,{e:()=>U,h:()=>M,i:()=>X,k:()=>C,m:()=>y,p:()=>a,q:()=>e,r:()=>H});var A=T(12589);class a{constructor(){this._easingMode=a.EASINGMODE_EASEIN}setEasingMode(N){const p=Math.min(Math.max(N,0),2);this._easingMode=p}getEasingMode(){return this._easingMode}easeInCore(N){throw new Error("You must implement this method")}ease(N){switch(this._easingMode){case a.EASINGMODE_EASEIN:return this.easeInCore(N);case a.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-N)}return N>=.5?.5*(1-this.easeInCore(2*(1-N)))+.5:.5*this.easeInCore(2*N)}}a.EASINGMODE_EASEIN=0,a.EASINGMODE_EASEOUT=1,a.EASINGMODE_EASEINOUT=2;class C extends a{easeInCore(N){return N=Math.max(0,Math.min(1,N)),1-Math.sqrt(1-N*N)}}class U extends a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=N}easeInCore(N){const p=Math.max(0,this.amplitude);return Math.pow(N,3)-N*p*Math.sin(3.141592653589793*N)}}class X extends a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=N,this.bounciness=p}easeInCore(N){const p=Math.max(0,this.bounces);let T=this.bounciness;T<=1&&(T=1.001);const A=Math.pow(T,p),a=1-T,C=(1-A)/a+.5*A,U=N*C,X=Math.log(-U*(1-T)+1)/Math.log(T),y=Math.floor(X),e=y+1,H=(1-Math.pow(T,y))/(a*C),M=.5*(H+(1-Math.pow(T,e))/(a*C)),b=N-M,l=M-H;return-Math.pow(1/T,p-y)/(l*l)*(b-l)*(b+l)}}class y extends a{easeInCore(N){return N*N*N}}class e extends a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=N,this.springiness=p}easeInCore(N){let p;const T=Math.max(0,this.oscillations),A=Math.max(0,this.springiness);return p=0==A?N:(Math.exp(A*N)-1)/(Math.exp(A)-1),p*Math.sin((6.283185307179586*T+1.5707963267948966)*N)}}class H extends a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=N}easeInCore(N){return this.exponent<=0?N:(Math.exp(this.exponent*N)-1)/(Math.exp(this.exponent)-1)}}class M extends a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=N,this.y1=p,this.x2=T,this.y2=A}easeInCore(N){return A.e.Interpolate(N,this.x1,this.y1,this.x2,this.y2)}}},14004:(N,p,T)=>{"use strict";T.d(p,{e:()=>U});var A=T(12371),a=T(12384),C=T(12797);class U extends C.d{get _matrix(){return this._compose(),this.Rl}set _matrix(N){(N.updateFlag!==this.Rl.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Rl.A(N),this._markAsDirtyAndDecompose())}constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(N,p.KN(),!1),this.name=N,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=p,this.Rl=(null===a||void 0===a?void 0:a.clone())??A.Matrix.Identity(),this._restMatrix=C??this.Rl.clone(),this._bindMatrix=U??this.Rl.clone(),this._index=X,this._absoluteMatrix=new A.Matrix,this._absoluteBindMatrix=new A.Matrix,this._absoluteInverseBindMatrix=new A.Matrix,this._finalMatrix=new A.Matrix,p.bones.push(this),this.setParent(T,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(N){this.setParent(N)}setParent(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==N){if(this.parent){const N=this.parent.children.indexOf(this);-1!==N&&this.parent.children.splice(N,1)}this._parentNode=N,this.parent&&this.parent.children.push(this),p&&this._updateAbsoluteBindMatrices(),this.bH()}}getLocalMatrix(){return this._compose(),this.Rl}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(N){this._restMatrix.A(N)}setRestPose(N){this.setRestMatrix(N)}getBindPose(){return this.getBindMatrix()}setBindMatrix(N){this.eX(N)}setBindPose(N){this.setBindMatrix(N)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const N=A.TmpVectors.xp[0],p=A.TmpVectors.Quaternion[0],T=A.TmpVectors.xp[1];this.getRestMatrix().decompose(N,p,T),this._linkedTransformNode.position.A(T),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??A.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.A(p),this._linkedTransformNode.xX.A(N)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(N){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=N,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.rX}set position(N){this._decompose(),this.rX.A(N),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(N){this.setRotation(N)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(N){this.setRotationQuaternion(N)}get xX(){return this.getScale()}set xX(N){this.setScale(N)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.xp.Zero(),this._localRotation=A.Quaternion.Zero(),this.rX=A.xp.Zero()),this.Rl.decompose(this._localScaling,this._localRotation,this.rX))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,A.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.rX,this.Rl)):this._needToCompose=!1)}eX(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.A(N),p&&this._updateAbsoluteBindMatrices(),T?this._matrix=N:this.bH()}_updateAbsoluteBindMatrices(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(N||(N=this._bindMatrix),this.parent?N.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.A(N),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),p)for(let T=0;T<this.children.length;T++)this.children[T]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}bH(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.bH(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.bH(),this._needToDecompose=!0}_updatePosition(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const C=this.getLocalMatrix();if(0==p)a?(C.addAtIndex(12,N.x),C.addAtIndex(13,N.y),C.addAtIndex(14,N.z)):C.setTranslationFromFloats(N.x,N.y,N.z);else{let p=null;T&&(p=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=U._TmpMats[0],y=U._TmpVecs[0];this.parent?T&&p?(X.A(this.parent.getAbsoluteMatrix()),X.multiplyToRef(p,X)):X.A(this.parent.getAbsoluteMatrix()):A.Matrix.IdentityToRef(X),a&&X.setTranslationFromFloats(0,0,0),X.invert(),A.xp.TransformCoordinatesToRef(N,X,y),a?(C.addAtIndex(12,y.x),C.addAtIndex(13,y.y),C.addAtIndex(14,y.z)):C.setTranslationFromFloats(y.x,y.y,y.z)}this._markAsDirtyAndDecompose()}translate(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,p,T,!0)}setPosition(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this._updatePosition(N,p,T,!1)}setAbsolutePosition(N,p){this.setPosition(N,1,p)}scale(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.getLocalMatrix(),X=U._TmpMats[0];A.Matrix.ScalingToRef(N,p,T,X),X.multiplyToRef(C,C),X.invert();for(const A of this.children){const a=A.getLocalMatrix();a.multiplyToRef(X,a),a.multiplyAtIndex(12,N),a.multiplyAtIndex(13,p),a.multiplyAtIndex(14,T),A._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),a)for(const A of this.children)A.scale(N,p,T,a)}setScale(N){this._decompose(),this._localScaling.A(N),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(N){this._decompose(),N.A(this._localScaling)}setYawPitchRoll(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0;if(0===a){const X=U._TmpQuat;return A.Quaternion.RotationYawPitchRollToRef(N,p,T,X),void this.setRotationQuaternion(X,a,C)}const X=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,C))return;const y=U._TmpMats[1];A.Matrix.RotationYawPitchRollToRef(N,p,T,y),X.multiplyToRef(y,y),this._rotateWithMatrix(y,a,C)}rotate(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;const C=U._TmpMats[0];C.setTranslationFromFloats(0,0,0),A.Matrix.RotationAxisToRef(N,p,C),this._rotateWithMatrix(C,T,a)}setAxisAngle(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;if(0===T){const C=U._TmpQuat;return A.Quaternion.RotationAxisToRef(N,p,C),void this.setRotationQuaternion(C,T,a)}const C=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,a))return;const X=U._TmpMats[1];A.Matrix.RotationAxisToRef(N,p,X),C.multiplyToRef(X,X),this._rotateWithMatrix(X,T,a)}setRotation(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(N.y,N.x,N.z,p,T)}setRotationQuaternion(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===p)return this._decompose(),this._localRotation.A(N),void this._markAsDirtyAndCompose();const a=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,T))return;const C=U._TmpMats[1];A.Matrix.FromQuaternionToRef(N,C),a.multiplyToRef(C,C),this._rotateWithMatrix(C,p,T)}setRotationMatrix(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;if(0===p){const a=U._TmpQuat;return A.Quaternion.FromRotationMatrixToRef(N,a),void this.setRotationQuaternion(a,p,T)}const a=U._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,T))return;const C=U._TmpMats[1];C.A(N),a.multiplyToRef(N,C),this._rotateWithMatrix(C,p,T)}_rotateWithMatrix(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const A=this.getLocalMatrix(),a=A.m[12],C=A.m[13],X=A.m[14],y=this.getParent(),e=U._TmpMats[3],H=U._TmpMats[4];y&&1==p?(T?(e.A(T.getWorldMatrix()),y.getAbsoluteMatrix().multiplyToRef(e,e)):e.A(y.getAbsoluteMatrix()),H.A(e),H.invert(),A.multiplyToRef(e,A),A.multiplyToRef(N,A),A.multiplyToRef(H,A)):1==p&&T?(e.A(T.getWorldMatrix()),H.A(e),H.invert(),A.multiplyToRef(e,A),A.multiplyToRef(N,A),A.multiplyToRef(H,A)):A.multiplyToRef(N,A),A.setTranslationFromFloats(a,C,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(N,p){const T=U._TmpMats[2];return N.A(this.getAbsoluteMatrix()),p?(N.multiplyToRef(p.getWorldMatrix(),N),A.Matrix.ScalingToRef(p.xX.x,p.xX.y,p.xX.z,T)):A.Matrix.IdentityToRef(T),N.invert(),!isNaN(N.m[0])&&(T.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyToRef(T,N),!0)}dp(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.xp.Zero();return this.getPositionToRef(N,p,T),T}getPositionToRef(){let N=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const N=this.getLocalMatrix();p.x=N.m[12],p.y=N.m[13],p.z=N.m[14]}else{let T=null;N&&(T=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let A=U._TmpMats[0];N&&T?(A.A(this.getAbsoluteMatrix()),A.multiplyToRef(T,A)):A=this.getAbsoluteMatrix(),p.x=A.m[12],p.y=A.m[13],p.z=A.m[14]}}getAbsolutePosition(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=A.xp.Zero();return this.getPositionToRef(1,N,p),p}getAbsolutePositionToRef(N,p){this.getPositionToRef(1,N,p)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Rl.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.A(this.Rl);const N=this._skeleton.getPoseMatrix();N&&this._absoluteMatrix.multiplyToRef(N,this._absoluteMatrix)}const N=this.children,p=N.length;for(let T=0;T<p;T++)N[T].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ly(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.xp.Zero();return this.getDirectionToRef(N,p,T),T}getDirectionToRef(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,a=null;p&&(a=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=U._TmpMats[0];C.A(this.getAbsoluteMatrix()),p&&a&&C.multiplyToRef(a,C),A.xp.TransformNormalToRef(N,C,T),T.normalize()}getRotation(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.xp.Zero();return this.getRotationToRef(N,p,T),T}getRotationToRef(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0;const A=U._TmpQuat;this.getRotationQuaternionToRef(N,p,A),A.toEulerAnglesToRef(T)}getRotationQuaternion(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.Quaternion.Identity();return this.getRotationQuaternionToRef(N,p,T),T}getRotationQuaternionToRef(){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),p.A(this._localRotation);else{const T=U._TmpMats[0],A=this.getAbsoluteMatrix();N?A.multiplyToRef(N.getWorldMatrix(),T):T.A(A),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.decompose(void 0,p,void 0)}}getRotationMatrix(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1?arguments[1]:void 0;const T=A.Matrix.Identity();return this.getRotationMatrixToRef(N,p,T),T}getRotationMatrixToRef(){let N=arguments.length>1?arguments[1]:void 0,p=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(p);else{const T=U._TmpMats[0],A=this.getAbsoluteMatrix();N?A.multiplyToRef(N.getWorldMatrix(),T):T.A(A),T.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyAtIndex(1,this._scalingDeterminant),T.multiplyAtIndex(2,this._scalingDeterminant),T.getRotationMatrixToRef(p)}}getAbsolutePositionFromLocal(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.xp.Zero();return this.getAbsolutePositionFromLocalToRef(N,p,T),T}getAbsolutePositionFromLocalToRef(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,a=null;p&&(a=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=U._TmpMats[0];C.A(this.getAbsoluteMatrix()),p&&a&&C.multiplyToRef(a,C),A.xp.TransformCoordinatesToRef(N,C,T)}getLocalPositionFromAbsolute(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=A.xp.Zero();return this.getLocalPositionFromAbsoluteToRef(N,p,T),T}getLocalPositionFromAbsoluteToRef(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2?arguments[2]:void 0,a=null;p&&(a=p.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=U._TmpMats[0];C.A(this.getAbsoluteMatrix()),p&&a&&C.multiplyToRef(a,C),C.invert(),A.xp.TransformCoordinatesToRef(N,C,T)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const N=this._skeleton.bones.indexOf(this);if(-1!==N&&this._skeleton.bones.splice(N,1),this._parentNode&&this._parentNode.children){const N=this._parentNode.children,p=N.indexOf(this);-1!==p&&N.splice(p,1)}super.dispose()}}U._TmpVecs=(0,a.e)(2,A.xp.Zero),U._TmpQuat=A.Quaternion.Identity(),U._TmpMats=(0,a.e)(5,A.Matrix.Identity)},14498:(N,p,T)=>{"use strict";T.d(p,{c:()=>o});var A=T(12354),a=T(12359),C=T(12194),U=T(12371),X=T(12390),y=T(12797),e=T(12833),H=T(12658),M=T(12216),b=T(12376);class l{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(N){this._idleRotationSpeed=N}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(N){this._idleRotationWaitTime=N}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(N){this._idleRotationSpinupTime=N}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(N){this._attachedCamera=N;const p=this._attachedCamera.KN();this._onPrePointerObservableObserver=p.onPrePointerObservable.add((N=>{N.type!==H.d.POINTERDOWN?N.type===H.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const N=M.d.Now;let p=0;null!=this._lastFrameTime&&(p=N-this._lastFrameTime),this._lastFrameTime=N,this._applyUserInteraction();const T=N-this._lastInteractionTime-this._idleRotationWaitTime,A=Math.max(Math.min(T/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*A,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(p/1e3))}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.KN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(N){this._lastInteractionTime=N??M.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<b.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let N=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(N=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?N:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=M.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var k=T(14505),x=T(12912);class I{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(N){if(this._autoTransitionRange===N)return;this._autoTransitionRange=N;const p=this._attachedCamera;p&&(N?this._onMeshTargetChangedObserver=p.onMeshTargetChangedObservable.add((N=>{if(N&&(N.HX(!0),N.getBoundingInfo)){const p=N.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*p,this.upperRadiusTransitionRange=.05*p}})):this._onMeshTargetChangedObserver&&p.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(N){this._attachedCamera=N,this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(N){return!!this._attachedCamera&&(this._attachedCamera.radius===N&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(N){if(!this._attachedCamera)return;this._radiusBounceTransition||(I.EasingFunction.setEasingMode(I.EasingMode),this._radiusBounceTransition=x.b.CreateAnimation("radius",x.b.ANIMATIONTYPE_FLOAT,60,I.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const p=x.b.TransitionTo("radius",this._attachedCamera.radius+N,this._attachedCamera,this._attachedCamera.KN(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));p&&this._animatables.push(p)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}I.EasingFunction=new k.e(.3),I.EasingMode=k.p.EASINGMODE_EASEOUT;class L{constructor(){this.onTargetFramingAnimationEndObservable=new C.c,this._mode=L.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(N){this._mode=N}get mode(){return this._mode}set radiusScale(N){this._radiusScale=N}get radiusScale(){return this._radiusScale}set positionScale(N){this._positionScale=N}get positionScale(){return this._positionScale}set defaultElevation(N){this._defaultElevation=N}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(N){this._elevationReturnTime=N}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(N){this._elevationReturnWaitTime=N}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(N){this._zoomStopsAnimation=N}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(N){this._framingTime=N}get framingTime(){return this._framingTime}init(){}attach(N){this._attachedCamera=N;const p=this._attachedCamera.KN();L.EasingFunction.setEasingMode(L.EasingMode),this._onPrePointerObservableObserver=p.onPrePointerObservable.add((N=>{N.type!==H.d.POINTERDOWN?N.type===H.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((N=>{N&&N.getBoundingInfo&&this.zoomOnMesh(N,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=N.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const N=this._attachedCamera.KN();this._onPrePointerObservableObserver&&N.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.HX(!0);const A=N.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(A.minimumWorld,A.maximumWorld,p,T)}zoomOnMeshHierarchy(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.HX(!0);const A=N.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(A.min,A.max,p,T)}zoomOnMeshesHierarchy(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new U.xp(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new U.xp(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let C=0;C<N.length;C++){const p=N[C].getHierarchyBoundingVectors(!0);U.xp.CheckExtends(p.min,A,a),U.xp.CheckExtends(p.max,A,a)}this.zoomOnBoundingInfo(A,a,p,T)}zoomOnBoundingInfo(N,p){let T,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const C=N.y,X=C+(p.y-C)*this._positionScale,y=p.Ip(N).scale(.5);if(!isFinite(X))return!1;if(A)T=new U.xp(0,X,0);else{const p=N.add(y);T=new U.xp(p.x,X,p.z)}this._vectorTransition||(this._vectorTransition=x.b.CreateAnimation("target",x.b.ANIMATIONTYPE_VECTOR3,60,L.EasingFunction)),this._betaIsAnimating=!0;let e=x.b.TransitionTo("target",T,this._attachedCamera,this._attachedCamera.KN(),60,this._vectorTransition,this._framingTime);e&&this._animatables.push(e);let H=0;if(this._mode===L.FitFrustumSidesMode){const T=this._calculateLowerRadiusFromModelBoundingSphere(N,p);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=y.length()+this._attachedCamera.yX),H=T}else this._mode===L.IgnoreBoundsSizeMode&&(H=this._calculateLowerRadiusFromModelBoundingSphere(N,p),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.yX));if(this.autoCorrectCameraLimitsAndSensibility){const T=p.Ip(N).length();this._attachedCamera.panningSensibility=5e3/T,this._attachedCamera.wheelPrecision=100/H}return this._radiusTransition||(this._radiusTransition=x.b.CreateAnimation("radius",x.b.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),e=x.b.TransitionTo("radius",H,this._attachedCamera,this._attachedCamera.KN(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),a&&a(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),e&&this._animatables.push(e),!0}_calculateLowerRadiusFromModelBoundingSphere(N,p){const T=this._attachedCamera;if(!T)return 0;let A=T._calculateLowerRadiusFromModelBoundingSphere(N,p,this._radiusScale);return T.lowerRadiusLimit&&this._mode===L.IgnoreBoundsSizeMode&&(A=A<T.lowerRadiusLimit?T.lowerRadiusLimit:A),T.upperRadiusLimit&&(A=A>T.upperRadiusLimit?T.upperRadiusLimit:A),A}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const N=M.d.Now-this._lastInteractionTime,p=.5*Math.PI-this._defaultElevation,T=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>T&&N>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=x.b.CreateAnimation("beta",x.b.ANIMATIONTYPE_FLOAT,60,L.EasingFunction));const N=x.b.TransitionTo("beta",p,this._attachedCamera,this._attachedCamera.KN(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));N&&this._animatables.push(N)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=M.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}L.EasingFunction=new k.r,L.EasingMode=k.p.EASINGMODE_EASEINOUT,L.IgnoreBoundsSizeMode=0,L.FitFrustumSidesMode=1;var n=T(12837),w=T(12871),g=T(13995),P=T(12190);class i{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(N){N=P.Tools.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),T=p.getInputElement();let A=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=C=>{var U,X;const y=C.event,e="touch"===y.pointerType;if(C.type!==H.d.POINTERMOVE&&-1===this.buttons.indexOf(y.button))return;const M=y.target;if(this._altKey=y.altKey,this._ctrlKey=y.ctrlKey,this._metaKey=y.metaKey,this._shiftKey=y.shiftKey,this._buttonsPressed=y.buttons,p.isPointerLock){const N=y.movementX,p=y.movementY;this.onTouch(null,N,p),this._pointA=null,this._pointB=null}else{if(C.type!==H.d.POINTERDOWN&&C.type!==H.d.POINTERDOUBLETAP&&e&&(null===(U=this._pointA)||void 0===U?void 0:U.pointerId)!==y.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==y.pointerId)return;if(C.type!==H.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!e)if(C.type===H.d.POINTERDOUBLETAP)this.onDoubleTap(y.pointerType);else if(C.type!==H.d.POINTERUP||this._currentMousePointerIdDown!==y.pointerId&&!e){if(C.type===H.d.POINTERMOVE)if(N||y.preventDefault(),this._pointA&&null===this._pointB){const N=y.clientX-this._pointA.x,p=y.clientY-this._pointA.y;this._pointA.x=y.clientX,this._pointA.y=y.clientY,this.onTouch(this._pointA,N,p)}else if(this._pointA&&this._pointB){const N=this._pointA.pointerId===y.pointerId?this._pointA:this._pointB;N.x=y.clientX,N.y=y.clientY;const p=this._pointA.x-this._pointB.x,T=this._pointA.y-this._pointB.y,U=p*p+T*T,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:y.pointerId,type:C.type};this.onMultiTouch(this._pointA,this._pointB,A,U,a,X),a=X,A=U}}else{try{null===M||void 0===M||M.releasePointerCapture(y.pointerId)}catch(b){}e||(this._pointB=null),p._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==y.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==y.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==A||a)&&(this.onMultiTouch(this._pointA,this._pointB,A,0,a,null),A=0,a=null),this._currentMousePointerIdDown=-1,this.onButtonUp(y),N||y.preventDefault()}else{try{null===M||void 0===M||M.setPointerCapture(y.pointerId)}catch(b){}if(null===this._pointA)this._pointA={x:y.clientX,y:y.clientY,pointerId:y.pointerId,type:y.pointerType};else{if(null!==this._pointB)return;this._pointB={x:y.clientX,y:y.clientY,pointerId:y.pointerId,type:y.pointerType}}-1!==this._currentMousePointerIdDown||e||(this._currentMousePointerIdDown=y.pointerId),this.onButtonDown(y),N||(y.preventDefault(),T&&T.focus())}}},this._observer=this.camera.KN()._inputManager._addCameraPointerObserver(this._pointerInput,H.d.POINTERDOWN|H.d.POINTERUP|H.d.POINTERMOVE|H.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,A=0,a=null,this.onLostFocus()},this._contextMenuBind=N=>this.onContextMenu(N),T&&T.addEventListener("contextmenu",this._contextMenuBind,!1);const C=this.camera.KN().getEngine().getHostWindow();C&&P.Tools.RegisterTopRootEvents(C,[{name:"blur",handler:this._onLostFocus}])}sM(){if(this._onLostFocus){const N=this.camera.KN().getEngine().getHostWindow();N&&P.Tools.UnregisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.KN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const N=this.camera.KN().getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(N){}onTouch(N,p,T){}onMultiTouch(N,p,T,A,a,C){}onContextMenu(N){N.preventDefault()}onButtonDown(N){}onButtonUp(N){}onLostFocus(){}}(0,A.b)([(0,a.H)()],i.prototype,"buttons",void 0);class K extends i{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(N,p){if(0!==this.panningSensibility&&N&&p){const T=p.x-N.x,A=p.y-N.y;this.camera.inertialPanningX+=-T/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility}}_computePinchZoom(N,p){const T=this.camera.radius||K.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=T*Math.sqrt(N)/Math.sqrt(p):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(p-N)*T*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(p-N)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(N,p,T){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility):(this.camera.inertialAlphaOffset-=p/this.angularSensibilityX,this.camera.inertialBetaOffset-=T/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(N,p,T,A,a,C){0===T&&null===a||0===A&&null===C||(this.multiTouchPanAndZoom?(this._computePinchZoom(T,A),this._computeMultiTouchPanning(a,C)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(A)-Math.sqrt(T))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(T,A),this._isPinching=!0):this._computeMultiTouchPanning(a,C)):this.multiTouchPanning?this._computeMultiTouchPanning(a,C):this.pinchZoom&&this._computePinchZoom(T,A))}onButtonDown(N){this._isPanClick=N.button===this.camera._panningMouseButton}onButtonUp(N){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}K.MinimumRadiusForPinch=.001,(0,A.b)([(0,a.H)()],K.prototype,"buttons",void 0),(0,A.b)([(0,a.H)()],K.prototype,"angularSensibilityX",void 0),(0,A.b)([(0,a.H)()],K.prototype,"angularSensibilityY",void 0),(0,A.b)([(0,a.H)()],K.prototype,"pinchPrecision",void 0),(0,A.b)([(0,a.H)()],K.prototype,"pinchDeltaPercentage",void 0),(0,A.b)([(0,a.H)()],K.prototype,"useNaturalPinchZoom",void 0),(0,A.b)([(0,a.H)()],K.prototype,"pinchZoom",void 0),(0,A.b)([(0,a.H)()],K.prototype,"panningSensibility",void 0),(0,A.b)([(0,a.H)()],K.prototype,"multiTouchPanning",void 0),(0,A.b)([(0,a.H)()],K.prototype,"multiTouchPanAndZoom",void 0),g.d.ArcRotateCameraPointersInput=K;var F=T(12666);class v{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(N){N=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.KN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const T=p.event;if(!T.metaKey)if(p.type===F.e.KEYDOWN){if(this._ctrlPressed=T.ctrlKey,this._altPressed=T.altKey,-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),T.preventDefault&&(N||T.preventDefault())}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysReset.indexOf(T.keyCode)){const p=this._keys.indexOf(T.keyCode);p>=0&&this._keys.splice(p,1),T.preventDefault&&(N||T.preventDefault())}})))}sM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let p=0;p<this._keys.length;p++){const T=this._keys[p];-1!==this.keysLeft.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX-=1/this.panningSensibility:N.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset+=1/this.zoomingSensibility:N.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningX+=1/this.panningSensibility:N.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(T)?this._ctrlPressed&&this.camera._useCtrlForPanning?N.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?N.inertialRadiusOffset-=1/this.zoomingSensibility:N.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(T)&&N.useInputToRestoreState&&N.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,A.b)([(0,a.H)()],v.prototype,"keysUp",void 0),(0,A.b)([(0,a.H)()],v.prototype,"keysDown",void 0),(0,A.b)([(0,a.H)()],v.prototype,"keysLeft",void 0),(0,A.b)([(0,a.H)()],v.prototype,"keysRight",void 0),(0,A.b)([(0,a.H)()],v.prototype,"keysReset",void 0),(0,A.b)([(0,a.H)()],v.prototype,"panningSensibility",void 0),(0,A.b)([(0,a.H)()],v.prototype,"zoomingSensibility",void 0),(0,A.b)([(0,a.H)()],v.prototype,"useAltToZoom",void 0),(0,A.b)([(0,a.H)()],v.prototype,"angularSpeed",void 0),g.d.ArcRotateCameraKeyboardMoveInput=v;var W=T(12429),z=T(12673);class R{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new U.xp(0,0,0),this._globalOffset=new U.xp(0,0,0),this._inertialPanning=U.xp.Zero()}_computeDeltaFromMouseWheelLegacyEvent(N,p){let T=0;const A=.01*N*this.wheelDeltaPercentage*p;return T=N>0?A/(1+this.wheelDeltaPercentage):A*(1+this.wheelDeltaPercentage),T}attachControl(N){N=P.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==H.d.POINTERWHEEL)return;const T=p.event;let A=0;const a=T.deltaMode===z.e.DOM_DELTA_LINE?40:1,C=-T.deltaY*a;if(this.customComputeDeltaFromMouseWheel)A=this.customComputeDeltaFromMouseWheel(C,this,T);else if(this.wheelDeltaPercentage){if(A=this._computeDeltaFromMouseWheelLegacyEvent(C,this.camera.radius),A>0){let N=this.camera.radius,p=this.camera.inertialRadiusOffset+A;for(let T=0;T<20&&!(N<=p)&&!(Math.abs(p*this.camera.inertia)<.001);T++)N-=p,p*=this.camera.inertia;N=(0,X.Clamp)(N,0,Number.MAX_VALUE),A=this._computeDeltaFromMouseWheelLegacyEvent(C,N)}}else A=C/(40*this.wheelPrecision);A&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(A)):this.camera.inertialRadiusOffset+=A),T.preventDefault&&(N||T.preventDefault())},this._observer=this.camera.KN()._inputManager._addCameraPointerObserver(this._wheel,H.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.IX(0)}sM(){this._observer&&(this.camera.KN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const N=this.camera;0+N.inertialAlphaOffset+N.inertialBetaOffset+N.inertialRadiusOffset&&(this._updateHitPlane(),N.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(N.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const N=this.camera,p=N.target.Ip(N.position);this._hitPlane=W.b.FromPositionAndNormal(N.target,p)}_getPosition(){const N=this.camera,p=N.KN(),T=p.createPickingRay(p.pointerX,p.pointerY,U.Matrix.Identity(),N,!1);0===N.targetScreenOffset.x&&0===N.targetScreenOffset.y||(this._viewOffset.set(N.targetScreenOffset.x,N.targetScreenOffset.y,0),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),this._globalOffset=U.xp.TransformNormal(this._viewOffset,N._cameraTransformMatrix),T.origin.addInPlace(this._globalOffset));let A=0;return this._hitPlane&&(A=T.intersectsPlane(this._hitPlane)??0),T.origin.addInPlace(T.direction.scaleInPlace(A))}_zoomToMouse(N){const p=this.camera,T=1-p.inertia;if(p.lowerRadiusLimit){const A=p.lowerRadiusLimit??0;p.radius-(p.inertialRadiusOffset+N)/T<A&&(N=(p.radius-A)*T-p.inertialRadiusOffset)}if(p.upperRadiusLimit){const A=p.upperRadiusLimit??0;p.radius-(p.inertialRadiusOffset+N)/T>A&&(N=(p.radius-A)*T-p.inertialRadiusOffset)}const A=N/T/p.radius,a=this._getPosition(),C=U.TmpVectors.xp[6];a.subtractToRef(p.target,C),C.scaleInPlace(A),C.scaleInPlace(T),this._inertialPanning.addInPlace(C),p.inertialRadiusOffset+=N}_zeroIfClose(N){Math.abs(N.x)<b.b&&(N.x=0),Math.abs(N.y)<b.b&&(N.y=0),Math.abs(N.z)<b.b&&(N.z=0)}}(0,A.b)([(0,a.H)()],R.prototype,"wheelPrecision",void 0),(0,A.b)([(0,a.H)()],R.prototype,"zoomToMouseLocation",void 0),(0,A.b)([(0,a.H)()],R.prototype,"wheelDeltaPercentage",void 0),g.d.ArcRotateCameraMouseWheelInput=R;class J extends g.h{constructor(N){super(N)}addMouseWheel(){return this.add(new R),this}addPointers(){return this.add(new K),this}addKeyboard(){return this.add(new v),this}}var f=T(12331);function G(N,p){return isNaN(N)?p:N}y.d.AddNodeConstructor("ArcRotateCamera",((N,p)=>()=>new o(N,0,0,1,U.xp.Zero(),p)));class o extends w.c{get target(){return this._target}set target(N){this.setTarget(N)}get targetHost(){return this._targetHost}set targetHost(N){N&&this.setTarget(N)}getTarget(){return this.target}get position(){return this._position}set position(N){this.setPosition(N)}set upVector(N){this._upToYMatrix||(this._yToUpMatrix=new U.Matrix,this._upToYMatrix=new U.Matrix,this._upVector=U.xp.Zero()),N.normalize(),this._upVector.A(N),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){U.Matrix.RotationAlignToRef(U.xp.UpReadOnly,this._upVector,this._yToUpMatrix),U.Matrix.RotationAlignToRef(this._upVector,U.xp.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityX:0}set angularSensibilityX(N){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityX=N)}get angularSensibilityY(){const N=this.inputs.attached.pointers;return N?N.angularSensibilityY:0}set angularSensibilityY(N){const p=this.inputs.attached.pointers;p&&(p.angularSensibilityY=N)}get pinchPrecision(){const N=this.inputs.attached.pointers;return N?N.pinchPrecision:0}set pinchPrecision(N){const p=this.inputs.attached.pointers;p&&(p.pinchPrecision=N)}get pinchDeltaPercentage(){const N=this.inputs.attached.pointers;return N?N.pinchDeltaPercentage:0}set pinchDeltaPercentage(N){const p=this.inputs.attached.pointers;p&&(p.pinchDeltaPercentage=N)}get useNaturalPinchZoom(){const N=this.inputs.attached.pointers;return!!N&&N.useNaturalPinchZoom}set useNaturalPinchZoom(N){const p=this.inputs.attached.pointers;p&&(p.useNaturalPinchZoom=N)}get panningSensibility(){const N=this.inputs.attached.pointers;return N?N.panningSensibility:0}set panningSensibility(N){const p=this.inputs.attached.pointers;p&&(p.panningSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const p=this.inputs.attached.keyboard;p&&(p.keysUp=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const p=this.inputs.attached.keyboard;p&&(p.keysDown=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const p=this.inputs.attached.keyboard;p&&(p.keysRight=N)}get wheelPrecision(){const N=this.inputs.attached.mousewheel;return N?N.wheelPrecision:0}set wheelPrecision(N){const p=this.inputs.attached.mousewheel;p&&(p.wheelPrecision=N)}get zoomToMouseLocation(){const N=this.inputs.attached.mousewheel;return!!N&&N.zoomToMouseLocation}set zoomToMouseLocation(N){const p=this.inputs.attached.mousewheel;p&&(p.zoomToMouseLocation=N)}get wheelDeltaPercentage(){const N=this.inputs.attached.mousewheel;return N?N.wheelDeltaPercentage:0}set wheelDeltaPercentage(N){const p=this.inputs.attached.mousewheel;p&&(p.wheelDeltaPercentage=N)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(N){N!==this.useBouncingBehavior&&(N?(this._bouncingBehavior=new I,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(N){N!==this.useFramingBehavior&&(N?(this._framingBehavior=new L,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(N){N!==this.useAutoRotationBehavior&&(N?(this._autoRotationBehavior=new l,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(N,p,T,A,a,X){var y;let e=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(N,U.xp.Zero(),X,e),y=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=U.xp.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=U.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new U.Matrix,this.panningAxis=new U.xp(1,1,0),this._transformedDirection=new U.xp,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new C.c,this.checkCollisions=!1,this.collisionRadius=new U.xp(.5,.5,.5),this._previousPosition=U.xp.Zero(),this._collisionVelocity=U.xp.Zero(),this._newPosition=U.xp.Zero(),this._computationVector=U.xp.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new U.xp(NaN,NaN,NaN),this._goalTargetScreenOffset=new U.Vector2(NaN,NaN),this._onCollisionPositionChange=function(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T?(y.setPosition(p),y.ik&&y.ik(T)):y._previousPosition.A(y._position);const A=Math.cos(y.alpha),a=Math.sin(y.alpha),C=Math.cos(y.beta);let U=Math.sin(y.beta);0===U&&(U=1e-4);const X=y._getTargetPosition();y._computationVector.kX(y.radius*A*U,y.radius*C,y.radius*a*U),X.addToRef(y._computationVector,y._newPosition),y._position.A(y._newPosition);let e=y.upVector;y.allowUpsideDown&&y.beta<0&&(e=e.clone(),e=e.negate()),y._computeViewMatrix(y._position,X,e),y._viewMatrix.addAtIndex(12,y.targetScreenOffset.x),y._viewMatrix.addAtIndex(13,y.targetScreenOffset.y),y._collisionTriggered=!1},this._target=U.xp.Zero(),a&&this.setTarget(a),this.alpha=p,this.beta=T,this.radius=A,this.getViewMatrix(),this.inputs=new J(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new U.xp(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=U.Vector2.Zero()}_updateCache(N){N||super._updateCache(),this._cache._target.A(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.A(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const N=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?N.addToRef(this._targetBoundingCenter,this._target):this._target.A(N)}const N=this._getLockedTargetPosition();return N||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>b.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,C=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=C?this._currentInterpolationFactor=C:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=G(N,this._goalAlpha),this._goalBeta=G(p,this._goalBeta),this._goalRadius=G(T,this._goalRadius),this._goalTarget.set(G(A.x,this._goalTarget.x),G(A.y,this._goalTarget.y),G(A.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(G(a.x,this._goalTargetScreenOffset.x),G(a.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,X.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,X.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,X.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,X.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(N,p){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const a=arguments;p=P.Tools.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=T,this._panningMouseButton=A,"boolean"===typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(p),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}sM(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let N=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){N=!0;const p=this.invertRotation?-1:1,T=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*T;this.beta<0&&(A*=-1),this.alpha+=A*p,this.beta+=this.inertialBetaOffset*p,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<b.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<b.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*b.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){N=!0;const p=new U.xp(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),p.multiplyInPlace(this.panningAxis),U.xp.TransformNormalToRef(p,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const N=this.upVector,p=U.xp.CrossToRef(this._transformedDirection,N,this._transformedDirection);U.xp.CrossToRef(N,p,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);U.xp.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.A(this._transformedDirection)}else{if(this.parent){const N=U.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.transposeToRef(N),U.xp.TransformCoordinatesToRef(this._transformedDirection,N,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*b.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*b.b&&(this.inertialPanningY=0)}if(N)this.stopInterpolation();else if(this._isInterpolating){let N=!1;const p=this._scene.getEngine().getDeltaTime()/1e3,T=1-Math.pow(2,-p/this._currentInterpolationFactor),A=G(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const p=U.TmpVectors.xp[0].set(G(this._goalTarget.x,this._target.x),G(this._goalTarget.y,this._target.y),G(this._goalTarget.z,this._target.z));U.xp.LerpToRef(this.target,p,T,this._target),10*U.xp.Distance(this.target,p)/A<b.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.A(p),this.setTarget(this.target,!1,!0,!0)):N=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const p=U.Quaternion.RotationAlphaBetaGammaToRef(G(this._goalAlpha,this.alpha),G(this._goalBeta,this.beta),0,U.TmpVectors.Quaternion[0]),A=U.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,U.TmpVectors.Quaternion[1]),a=U.Quaternion.SlerpToRef(A,p,T,U.TmpVectors.Quaternion[2]);a.normalize();const C=a.toAlphaBetaGammaToRef(U.TmpVectors.xp[0]);if(this.alpha=C.x,this.beta=C.y,a.isApprox(p,b.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const N=p.toAlphaBetaGammaToRef(U.TmpVectors.xp[0]);this.alpha=N.x,this.beta=N.y}else N=!0}if(isNaN(this._goalRadius)||(this.radius+=(A-this.radius)*T,Math.abs(A/this.radius-1)<b.b?(this._goalRadius=NaN,this.radius=A):N=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const p=U.TmpVectors.Vector2[0].set(G(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),G(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));U.Vector2.LerpToRef(this.targetScreenOffset,p,T,this.targetScreenOffset),U.Vector2.Distance(this.targetScreenOffset,p)<b.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.A(p)):N=!0}this._isInterpolating=N}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.xp.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const N=this.alpha;var p,T;this.alpha=function(N){let p=Math.PI/2;return 0===N.x&&0===N.z||(p=Math.acos(N.x/Math.sqrt(Math.pow(N.x,2)+Math.pow(N.z,2)))),N.z<0&&(p=2*Math.PI-p),p}(this._computationVector),this.beta=(p=this._computationVector.y,T=this.radius,Math.acos(p/T));const A=Math.round((N-this.alpha)/(2*Math.PI));this.alpha+=2*A*Math.PI,this._checkLimits()}setPosition(N){this._position.equals(N)||(this._position.A(N),this.rebuildAnglesAndRadius())}setTarget(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(A=this.overrideCloneAlphaBetaRadius??A,N.HX)p&&N.getBoundingInfo?this._targetBoundingCenter=N.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,N.HX(),this._targetHost=N,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const p=N,A=this._getTargetPosition();if(A&&!T&&A.equals(p))return;this._targetHost=null,this._target=p,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}A||this.rebuildAnglesAndRadius()}_getViewMatrix(){const N=Math.cos(this.alpha),p=Math.sin(this.alpha),T=Math.cos(this.beta);let A=Math.sin(this.beta);0===A&&(A=1e-4),0===this.radius&&(this.radius=1e-4);const a=this._getTargetPosition();if(this._computationVector.kX(this.radius*N*A,this.radius*T,this.radius*p*A),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||U.xp.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),a.addToRef(this._computationVector,this._newPosition),this.KN().collisionsEnabled&&this.checkCollisions){const N=this.KN().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,N.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.A(this._newPosition);let N=this.upVector;this.allowUpsideDown&&A<0&&(N=N.negate()),this._computeViewMatrix(this._position,a,N),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.A(a),this._viewMatrix}zoomOn(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];N=N||this.KN().meshes;const T=e.d.MinMax(N);let A=this._calculateLowerRadiusFromModelBoundingSphere(T.min,T.max);if(A=Math.max(Math.min(A,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=A*this.zoomOnFactor,this.mode===n.d.ORTHOGRAPHIC_CAMERA){const N=this.KN().getEngine().getAspectRatio(this),p=A*this.zoomOnFactor/2;this.orthoLeft=-p*N,this.orthoRight=p*N,this.orthoBottom=-p,this.orthoTop=p}this.focusOn({min:T.min,max:T.max,distance:A},p)}focusOn(N){let p,T,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===N.min){const A=N||this.KN().meshes;p=e.d.MinMax(A),T=U.xp.Distance(p.min,p.max)}else{p=N,T=N.distance}this._target=e.d.Center(p),A||(this.maxZ=2*T)}createRigCamera(N,p){let T=0;switch(this.cameraRigMode){case n.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.d.RIG_MODE_VR:T=this._cameraRigParams.stereoHalfAngle*(0===p?1:-1);break;case n.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:T=this._cameraRigParams.stereoHalfAngle*(0===p?-1:1)}const A=new o(N,this.alpha+T,this.beta,this.radius,this._target,this.KN());return A._cameraRigParams={},A.isRigCamera=!0,A.rigParent=this,A.upVector=this.upVector,A.mode=this.mode,A.orthoLeft=this.orthoLeft,A.orthoRight=this.orthoRight,A.orthoBottom=this.orthoBottom,A.orthoTop=this.orthoTop,A}_updateRigCameras(){const N=this._rigCameras[0],p=this._rigCameras[1];switch(N.beta=p.beta=this.beta,this.cameraRigMode){case n.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.d.RIG_MODE_VR:N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case n.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,p.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const A=U.xp.Distance(N,p),a=this.KN().getEngine().getAspectRatio(this),C=Math.tan(this.fov/2),X=C*a,y=.5*A*T,e=y*Math.sqrt(1+1/(X*X)),H=y*Math.sqrt(1+1/(C*C));return Math.max(e,H)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,A.b)([(0,a.H)()],o.prototype,"alpha",void 0),(0,A.b)([(0,a.H)()],o.prototype,"beta",void 0),(0,A.b)([(0,a.H)()],o.prototype,"radius",void 0),(0,A.b)([(0,a.H)()],o.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,A.b)([(0,a.E)("target")],o.prototype,"_target",void 0),(0,A.b)([(0,a.w)("targetHost")],o.prototype,"_targetHost",void 0),(0,A.b)([(0,a.H)()],o.prototype,"inertialAlphaOffset",void 0),(0,A.b)([(0,a.H)()],o.prototype,"inertialBetaOffset",void 0),(0,A.b)([(0,a.H)()],o.prototype,"inertialRadiusOffset",void 0),(0,A.b)([(0,a.H)()],o.prototype,"lowerAlphaLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"upperAlphaLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"lowerBetaLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"upperBetaLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"lowerRadiusLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"upperRadiusLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"lowerTargetYLimit",void 0),(0,A.b)([(0,a.H)()],o.prototype,"inertialPanningX",void 0),(0,A.b)([(0,a.H)()],o.prototype,"inertialPanningY",void 0),(0,A.b)([(0,a.H)()],o.prototype,"pinchToPanMaxDistance",void 0),(0,A.b)([(0,a.H)()],o.prototype,"panningDistanceLimit",void 0),(0,A.b)([(0,a.E)()],o.prototype,"panningOriginTarget",void 0),(0,A.b)([(0,a.H)()],o.prototype,"panningInertia",void 0),(0,A.b)([(0,a.H)()],o.prototype,"zoomToMouseLocation",null),(0,A.b)([(0,a.H)()],o.prototype,"zoomOnFactor",void 0),(0,A.b)([(0,a.B)()],o.prototype,"targetScreenOffset",void 0),(0,A.b)([(0,a.H)()],o.prototype,"allowUpsideDown",void 0),(0,A.b)([(0,a.H)()],o.prototype,"useInputToRestoreState",void 0),(0,A.b)([(0,a.H)()],o.prototype,"restoreStateInterpolationFactor",void 0),(0,f.d)("BABYLON.ArcRotateCamera",o)},13995:(N,p,T)=>{"use strict";T.d(p,{d:()=>U,h:()=>X});var A=T(12205),a=T(12409),C=T(12837),U={};class X{constructor(N){this.attachedToElement=!1,this.attached={},this.camera=N,this.checkInputs=()=>{}}add(N){const p=N.getSimpleName();this.attached[p]?A.d.Warn("camera input of type "+p+" already exists on camera"):(this.attached[p]=N,N.camera=this.camera,N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N))),this.attachedToElement&&N.attachControl(this.noPreventDefault))}remove(N){for(const p in this.attached){const T=this.attached[p];if(T===N)return T.sM(),T.camera=null,delete this.attached[p],void this.rebuildInputCheck()}}removeByType(N){for(const p in this.attached){const T=this.attached[p];T.getClassName()===N&&(T.sM(),T.camera=null,delete this.attached[p],this.rebuildInputCheck())}}_addCheckInputs(N){const p=this.checkInputs;return()=>{p(),N()}}attachInput(N){this.attachedToElement&&N.attachControl(this.noPreventDefault)}attachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){N=!C.d.ForceAttachControlToAlwaysPreventDefault&&N,this.attachedToElement=!0,this.noPreventDefault=N;for(const p in this.attached)this.attached[p].attachControl(N)}}detachElement(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const p in this.attached)this.attached[p].sM(),N&&(this.attached[p].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const N in this.attached){const p=this.attached[N];p.checkInputs&&(this.checkInputs=this._addCheckInputs(p.checkInputs.bind(p)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(N){const p={};for(const T in this.attached){const N=this.attached[T],A=a.e.Serialize(N);p[N.getClassName()]=A}N.inputsmgr=p}parse(N){const p=N.inputsmgr;if(p){this.clear();for(const N in p){const T=U[N];if(T){const A=p[N],C=a.e.Parse((()=>new T),A,null);this.add(C)}}}else for(const T in this.attached){const p=U[this.attached[T].getClassName()];if(p){const A=a.e.Parse((()=>new p),N,null);this.remove(this.attached[T]),this.add(A)}}}}},13986:(N,p,T)=>{"use strict";T.d(p,{e:()=>i});var A=T(12354),a=T(12359),C=T(12371),U=T(12871),X=T(13995),y=T(12666),e=T(12190);class H{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(N){N=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.KN(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((p=>{const T=p.event;if(!T.metaKey)if(p.type===y.e.KEYDOWN){if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){-1===this._keys.indexOf(T.keyCode)&&this._keys.push(T.keyCode),N||T.preventDefault()}}else if(-1!==this.keysUp.indexOf(T.keyCode)||-1!==this.keysDown.indexOf(T.keyCode)||-1!==this.keysLeft.indexOf(T.keyCode)||-1!==this.keysRight.indexOf(T.keyCode)||-1!==this.keysUpward.indexOf(T.keyCode)||-1!==this.keysDownward.indexOf(T.keyCode)||-1!==this.keysRotateLeft.indexOf(T.keyCode)||-1!==this.keysRotateRight.indexOf(T.keyCode)||-1!==this.keysRotateUp.indexOf(T.keyCode)||-1!==this.keysRotateDown.indexOf(T.keyCode)){const p=this._keys.indexOf(T.keyCode);p>=0&&this._keys.splice(p,1),N||T.preventDefault()}})))}sM(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const N=this.camera;for(let p=0;p<this._keys.length;p++){const T=this._keys[p],A=N._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(T)?N._localDirection.kX(-A,0,0):-1!==this.keysUp.indexOf(T)?N._localDirection.kX(0,0,A):-1!==this.keysRight.indexOf(T)?N._localDirection.kX(A,0,0):-1!==this.keysDown.indexOf(T)?N._localDirection.kX(0,0,-A):-1!==this.keysUpward.indexOf(T)?N._localDirection.kX(0,A,0):-1!==this.keysDownward.indexOf(T)?N._localDirection.kX(0,-A,0):-1!==this.keysRotateLeft.indexOf(T)?(N._localDirection.kX(0,0,0),N.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(T)?(N._localDirection.kX(0,0,0),N.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(T)?(N._localDirection.kX(0,0,0),N.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(T)&&(N._localDirection.kX(0,0,0),N.cameraRotation.x+=this._getLocalRotation()),N.KN().useRightHandedSystem&&(N._localDirection.z*=-1),N.getViewMatrix().invertToRef(N._cameraTransformMatrix),C.xp.TransformNormalToRef(N._localDirection,N._cameraTransformMatrix,N._transformedDirection),N.cameraDirection.addInPlace(N._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const N=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*N}}(0,A.b)([(0,a.H)()],H.prototype,"keysUp",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysUpward",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysDown",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysDownward",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysLeft",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysRight",void 0),(0,A.b)([(0,a.H)()],H.prototype,"rotationSpeed",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysRotateLeft",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysRotateRight",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysRotateUp",void 0),(0,A.b)([(0,a.H)()],H.prototype,"keysRotateDown",void 0),X.d.FreeCameraKeyboardMoveInput=H;var M=T(12194),b=T(12658);class l{constructor(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=N,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new M.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(N){N=e.Tools.BackCompatCameraNoPreventDefault(arguments);const p=this.camera.getEngine(),T=p.getInputElement();this._pointerInput||(this._pointerInput=A=>{const a=A.event,C="touch"===a.pointerType;if(!this.touchEnabled&&C)return;if(A.type!==b.d.POINTERMOVE&&-1===this.buttons.indexOf(a.button))return;const U=a.target;if(A.type===b.d.POINTERDOWN){if(C&&-1!==this._activePointerId||!C&&-1!==this._currentActiveButton)return;this._activePointerId=a.pointerId;try{null===U||void 0===U||U.setPointerCapture(a.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=a.button),this._previousPosition={x:a.clientX,y:a.clientY},N||(a.preventDefault(),T&&T.focus()),p.isPointerLock&&this._onMouseMove&&this._onMouseMove(A.event)}else if(A.type===b.d.POINTERUP){if(C&&this._activePointerId!==a.pointerId||!C&&this._currentActiveButton!==a.button)return;try{null===U||void 0===U||U.releasePointerCapture(a.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,N||a.preventDefault(),this._activePointerId=-1}else if(A.type===b.d.POINTERMOVE&&(this._activePointerId===a.pointerId||!C))if(p.isPointerLock&&this._onMouseMove)this._onMouseMove(A.event);else if(this._previousPosition){const p=this.camera._calculateHandednessMultiplier(),T=(a.clientX-this._previousPosition.x)*p,A=a.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=T/this.angularSensibility,this.camera.cameraRotation.x+=A/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:T,offsetY:A}),this._previousPosition={x:a.clientX,y:a.clientY},N||a.preventDefault()}}),this._onMouseMove=T=>{if(!p.isPointerLock)return;const A=this.camera._calculateHandednessMultiplier(),a=T.movementX*A;this.camera.cameraRotation.y+=a/this.angularSensibility;const C=T.movementY;this.camera.cameraRotation.x+=C/this.angularSensibility,this._previousPosition=null,N||T.preventDefault()},this._observer=this.camera.KN()._inputManager._addCameraPointerObserver(this._pointerInput,b.d.POINTERDOWN|b.d.POINTERUP|b.d.POINTERMOVE),T&&(this._contextMenuBind=N=>this.onContextMenu(N),T.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(N){N.preventDefault()}sM(){if(this._observer){if(this.camera.KN()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,A.b)([(0,a.H)()],l.prototype,"buttons",void 0),(0,A.b)([(0,a.H)()],l.prototype,"angularSensibility",void 0),X.d.FreeCameraMouseInput=l;var k,x=T(12673);class I{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new M.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(N){N=e.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=p=>{if(p.type!==b.d.POINTERWHEEL)return;const T=p.event,A=T.deltaMode===x.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*A*T.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*A*T.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*A*T.deltaZ/this._normalize,T.preventDefault&&(N||T.preventDefault())},this._observer=this.camera.KN()._inputManager._addCameraPointerObserver(this._wheel,b.d.POINTERWHEEL)}sM(){this._observer&&(this.camera.KN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,A.b)([(0,a.H)()],I.prototype,"wheelPrecisionX",void 0),(0,A.b)([(0,a.H)()],I.prototype,"wheelPrecisionY",void 0),(0,A.b)([(0,a.H)()],I.prototype,"wheelPrecisionZ",void 0),function(N){N[N.MoveRelative=0]="MoveRelative",N[N.RotateRelative=1]="RotateRelative",N[N.MoveScene=2]="MoveScene"}(k||(k={}));class L extends I{constructor(){super(...arguments),this._moveRelative=C.xp.Zero(),this._rotateRelative=C.xp.Zero(),this._moveScene=C.xp.Zero(),this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(N){null===N&&this._wheelXAction!==k.MoveRelative||(this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=N)}get wheelXMoveRelative(){return this._wheelXAction!==k.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(N){null===N&&this._wheelYAction!==k.MoveRelative||(this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=N)}get wheelYMoveRelative(){return this._wheelYAction!==k.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(N){null===N&&this._wheelZAction!==k.MoveRelative||(this._wheelZAction=k.MoveRelative,this._wheelZActionCoordinate=N)}get wheelZMoveRelative(){return this._wheelZAction!==k.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(N){null===N&&this._wheelXAction!==k.RotateRelative||(this._wheelXAction=k.RotateRelative,this._wheelXActionCoordinate=N)}get wheelXRotateRelative(){return this._wheelXAction!==k.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(N){null===N&&this._wheelYAction!==k.RotateRelative||(this._wheelYAction=k.RotateRelative,this._wheelYActionCoordinate=N)}get wheelYRotateRelative(){return this._wheelYAction!==k.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(N){null===N&&this._wheelZAction!==k.RotateRelative||(this._wheelZAction=k.RotateRelative,this._wheelZActionCoordinate=N)}get wheelZRotateRelative(){return this._wheelZAction!==k.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(N){null===N&&this._wheelXAction!==k.MoveScene||(this._wheelXAction=k.MoveScene,this._wheelXActionCoordinate=N)}get wheelXMoveScene(){return this._wheelXAction!==k.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(N){null===N&&this._wheelYAction!==k.MoveScene||(this._wheelYAction=k.MoveScene,this._wheelYActionCoordinate=N)}get wheelYMoveScene(){return this._wheelYAction!==k.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(N){null===N&&this._wheelZAction!==k.MoveScene||(this._wheelZAction=k.MoveScene,this._wheelZActionCoordinate=N)}get wheelZMoveScene(){return this._wheelZAction!==k.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.IX(0),this._rotateRelative.IX(0),this._moveScene.IX(0),this._updateCamera(),this.camera.KN().useRightHandedSystem&&(this._moveRelative.z*=-1);const N=C.Matrix.Zero();this.camera.getViewMatrix().invertToRef(N);const p=C.xp.Zero();C.xp.TransformNormalToRef(this._moveRelative,N,p),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(p),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(N,p,T){if(0===N)return;if(null===p||null===T)return;let A=null;switch(p){case k.MoveRelative:A=this._moveRelative;break;case k.RotateRelative:A=this._rotateRelative;break;case k.MoveScene:A=this._moveScene}switch(T){case 0:A.set(N,0,0);break;case 1:A.set(0,N,0);break;case 2:A.set(0,0,N)}}}(0,A.b)([(0,a.H)()],L.prototype,"wheelXMoveRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelYMoveRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelZMoveRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelXRotateRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelYRotateRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelZRotateRelative",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelXMoveScene",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelYMoveScene",null),(0,A.b)([(0,a.H)()],L.prototype,"wheelZMoveScene",null),X.d.FreeCameraMouseWheelInput=L;class n{constructor(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=N,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=e.Tools.IsSafari()}attachControl(N){N=e.Tools.BackCompatCameraNoPreventDefault(arguments);let p=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=T=>{const A=T.event,a="mouse"===A.pointerType||this._isSafari&&"undefined"===typeof A.pointerType;if(this.allowMouse||!a)if(T.type===b.d.POINTERDOWN){if(N||A.preventDefault(),this._pointerPressed.push(A.pointerId),1!==this._pointerPressed.length)return;p={x:A.clientX,y:A.clientY}}else if(T.type===b.d.POINTERUP){N||A.preventDefault();const T=this._pointerPressed.indexOf(A.pointerId);if(-1===T)return;if(this._pointerPressed.splice(T,1),0!=T)return;p=null,this._offsetX=null,this._offsetY=null}else if(T.type===b.d.POINTERMOVE){if(N||A.preventDefault(),!p)return;if(0!=this._pointerPressed.indexOf(A.pointerId))return;this._offsetX=A.clientX-p.x,this._offsetY=-(A.clientY-p.y)}}),this._observer=this.camera.KN()._inputManager._addCameraPointerObserver(this._pointerInput,b.d.POINTERDOWN|b.d.POINTERUP|b.d.POINTERMOVE),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.addEventListener("blur",this._onLostFocus)}}sM(){if(this._pointerInput){if(this._observer&&(this.camera.KN()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const N=this.camera.getEngine().getInputElement();N&&N.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const N=this.camera,p=N._calculateHandednessMultiplier();N.cameraRotation.y=p*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)N.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const p=N._computeLocalCameraSpeed(),T=new C.xp(0,0,0!==this.touchMoveSensibility?p*this._offsetY/this.touchMoveSensibility:0);C.Matrix.RotationYawPitchRollToRef(N.rotation.y,N.rotation.x,0,N._cameraRotationMatrix),N.cameraDirection.addInPlace(C.xp.TransformCoordinates(T,N._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,A.b)([(0,a.H)()],n.prototype,"touchAngularSensibility",void 0),(0,A.b)([(0,a.H)()],n.prototype,"touchMoveSensibility",void 0),X.d.FreeCameraTouchInput=n;class w extends X.h{constructor(N){super(N),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new H),this}addMouse(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new l(N),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new L,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new n),this}clear(){super.clear(),this._mouseInput=null}}var g=T(12331),P=T(12270);class i extends U.c{get angularSensibility(){const N=this.inputs.attached.mouse;return N?N.angularSensibility:0}set angularSensibility(N){const p=this.inputs.attached.mouse;p&&(p.angularSensibility=N)}get keysUp(){const N=this.inputs.attached.keyboard;return N?N.keysUp:[]}set keysUp(N){const p=this.inputs.attached.keyboard;p&&(p.keysUp=N)}get keysUpward(){const N=this.inputs.attached.keyboard;return N?N.keysUpward:[]}set keysUpward(N){const p=this.inputs.attached.keyboard;p&&(p.keysUpward=N)}get keysDown(){const N=this.inputs.attached.keyboard;return N?N.keysDown:[]}set keysDown(N){const p=this.inputs.attached.keyboard;p&&(p.keysDown=N)}get keysDownward(){const N=this.inputs.attached.keyboard;return N?N.keysDownward:[]}set keysDownward(N){const p=this.inputs.attached.keyboard;p&&(p.keysDownward=N)}get keysLeft(){const N=this.inputs.attached.keyboard;return N?N.keysLeft:[]}set keysLeft(N){const p=this.inputs.attached.keyboard;p&&(p.keysLeft=N)}get keysRight(){const N=this.inputs.attached.keyboard;return N?N.keysRight:[]}set keysRight(N){const p=this.inputs.attached.keyboard;p&&(p.keysRight=N)}get keysRotateLeft(){const N=this.inputs.attached.keyboard;return N?N.keysRotateLeft:[]}set keysRotateLeft(N){const p=this.inputs.attached.keyboard;p&&(p.keysRotateLeft=N)}get keysRotateRight(){const N=this.inputs.attached.keyboard;return N?N.keysRotateRight:[]}set keysRotateRight(N){const p=this.inputs.attached.keyboard;p&&(p.keysRotateRight=N)}get keysRotateUp(){const N=this.inputs.attached.keyboard;return N?N.keysRotateUp:[]}set keysRotateUp(N){const p=this.inputs.attached.keyboard;p&&(p.keysRotateUp=N)}get keysRotateDown(){const N=this.inputs.attached.keyboard;return N?N.keysRotateDown:[]}set keysRotateDown(N){const p=this.inputs.attached.keyboard;p&&(p.keysRotateDown=N)}constructor(N,p,T){var A;super(N,p,T,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),A=this,this.ellipsoid=new C.xp(.5,1,.5),this.ellipsoidOffset=new C.xp(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=C.xp.Zero(),this._diffPosition=C.xp.Zero(),this._newPosition=C.xp.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A._newPosition.A(p),A._newPosition.subtractToRef(A._oldPosition,A._diffPosition),A._diffPosition.length()>P.c.CollisionsEpsilon&&(A.position.addToRef(A._diffPosition,A._deferredPositionUpdate),A._deferOnly?A._deferredUpdated=!0:A.position.A(A._deferredPositionUpdate),A.ik&&T&&A.ik(T))},this.inputs=new w(this),this.inputs.addKeyboard().addMouse()}attachControl(N,p){p=e.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(p)}sM(){this.inputs.detachElement(),this.cameraDirection=new C.xp(0,0,0),this.cameraRotation=new C.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(N){this._collisionMask=isNaN(N)?-1:N}_collideWithWorld(N){let p;p=this.parent?C.xp.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,p.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const T=this.KN().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let A=N;this.applyGravity&&(A=N.add(this.KN().gravity)),T.getNewPosition(this._oldPosition,A,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=C.xp.Zero(),this._transformedDirection=C.xp.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(N){this._needMoveForGravity=N}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.KN().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"pe"}}(0,A.b)([(0,a.E)()],i.prototype,"ellipsoid",void 0),(0,A.b)([(0,a.E)()],i.prototype,"ellipsoidOffset",void 0),(0,A.b)([(0,a.H)()],i.prototype,"checkCollisions",void 0),(0,A.b)([(0,a.H)()],i.prototype,"applyGravity",void 0),(0,g.d)("BABYLON.FreeCamera",i)},14561:(N,p,T)=>{"use strict";T.d(p,{b:()=>C});var A=T(12471),a=T(14568);class C{constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=T,this.nM=[],this._maxBlockCapacity=p||64,this._selectionContent=new A.b(1024),this._creationFunc=N}update(N,p,T){a.e._CreateBlocks(N,p,T,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}vH(N){for(let p=0;p<this.jH.length;p++){this.jH[p].addEntry(N)}}FH(N){for(let p=0;p<this.jH.length;p++){this.jH[p].removeEntry(N)}}select(N,p){this._selectionContent.reset();for(let T=0;T<this.jH.length;T++){this.jH[T].select(N,this._selectionContent,p)}return p?this._selectionContent.concat(this.nM):this._selectionContent.concatWithNoDuplicate(this.nM),this._selectionContent}intersects(N,p,T){this._selectionContent.reset();for(let A=0;A<this.jH.length;A++){this.jH[A].intersects(N,p,this._selectionContent,T)}return T?this._selectionContent.concat(this.nM):this._selectionContent.concatWithNoDuplicate(this.nM),this._selectionContent}intersectsRay(N){this._selectionContent.reset();for(let p=0;p<this.jH.length;p++){this.jH[p].intersectsRay(N,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.nM),this._selectionContent}}C.CreationFuncForMeshes=(N,p)=>{const T=N.getBoundingInfo();!N.isBlocked&&T.boundingBox.intersectsMinMax(p.KM,p.FM)&&p.entries.push(N)},C.CreationFuncForSubMeshes=(N,p)=>{N.getBoundingInfo().boundingBox.intersectsMinMax(p.KM,p.FM)&&p.entries.push(N)}},14568:(N,p,T)=>{"use strict";T.d(p,{e:()=>C});var A=T(12371),a=T(12719);class C{constructor(N,p,T,A,a,C){this.entries=[],this.vM=new Array,this._capacity=T,this._depth=A,this._maxDepth=a,this._creationFunc=C,this._minPoint=N,this._maxPoint=p,this.vM.push(N.clone()),this.vM.push(p.clone()),this.vM.push(N.clone()),this.vM[2].x=p.x,this.vM.push(N.clone()),this.vM[3].y=p.y,this.vM.push(N.clone()),this.vM[4].z=p.z,this.vM.push(p.clone()),this.vM[5].z=N.z,this.vM.push(p.clone()),this.vM[6].x=N.x,this.vM.push(p.clone()),this.vM[7].y=N.y}get Kp(){return this._capacity}get KM(){return this._minPoint}get FM(){return this._maxPoint}addEntry(N){if(this.jH)for(let p=0;p<this.jH.length;p++){this.jH[p].addEntry(N)}else this._creationFunc(N,this),this.entries.length>this.Kp&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(N){if(this.jH){for(let p=0;p<this.jH.length;p++){this.jH[p].removeEntry(N)}return}const p=this.entries.indexOf(N);p>-1&&this.entries.splice(p,1)}addEntries(N){for(let p=0;p<N.length;p++){const T=N[p];this.addEntry(T)}}select(N,p,T){if(a.d.IsInFrustum(this.vM,N)){if(this.jH){for(let A=0;A<this.jH.length;A++){this.jH[A].select(N,p,T)}return}T?p.concat(this.entries):p.concatWithNoDuplicate(this.entries)}}intersects(N,p,T,A){if(a.d.IntersectsSphere(this._minPoint,this._maxPoint,N,p)){if(this.jH){for(let a=0;a<this.jH.length;a++){this.jH[a].intersects(N,p,T,A)}return}A?T.concat(this.entries):T.concatWithNoDuplicate(this.entries)}}intersectsRay(N,p){if(N.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.jH){for(let T=0;T<this.jH.length;T++){this.jH[T].intersectsRay(N,p)}return}p.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){C._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(N,p,T,a,U,X,y,e){y.jH=new Array;const H=new A.xp((p.x-N.x)/2,(p.y-N.y)/2,(p.z-N.z)/2);for(let A=0;A<2;A++)for(let p=0;p<2;p++)for(let M=0;M<2;M++){const b=N.add(H.multiplyByFloats(A,p,M)),l=N.add(H.multiplyByFloats(A+1,p+1,M+1)),k=new C(b,l,a,U+1,X,e);k.addEntries(T),y.jH.push(k)}}}},14570:(N,p,T)=>{"use strict";T.d(p,{b:()=>H});var A=T(12617),a=T(12371),C=T(12806),U=T(13773),X=T(12656),y=T(14561),e=T(12231);A.c.prototype.createOrUpdateSelectionOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,T=this._getComponent(X.c.NAME_OCTREE);T||(T=new H(this),this.o(T)),this.IM||(this.IM=new y.b(y.b.CreationFuncForMeshes,N,p));const A=this.getWorldExtends();return this.IM.update(A.min,A.max,this.meshes),this.IM},Object.defineProperty(A.c.prototype,"selectionOctree",{get:function(){return this.IM},enumerable:!0,configurable:!0}),C.c.prototype.createOrUpdateSubmeshesOctree=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const T=this.KN();let A=T._getComponent(X.c.NAME_OCTREE);A||(A=new H(T),T.o(A)),this._submeshesOctree||(this._submeshesOctree=new y.b(y.b.CreationFuncForSubMeshes,N,p)),this.HX(!0);const a=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(a.minimumWorld,a.maximumWorld,this.CX),this._submeshesOctree};class H{constructor(N){this.name=X.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new U.e(a.xp.Zero(),new a.xp(1,1,1)),(N=N||e.b.LastCreatedScene)&&(this.Lp=N,this.Lp.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Lp.getActiveSubMeshCandidates=N=>this.getActiveSubMeshCandidates(N),this.Lp.getCollidingSubMeshCandidates=(N,p)=>this.getCollidingSubMeshCandidates(N,p),this.Lp.getIntersectingSubMeshCandidates=(N,p)=>this.getIntersectingSubMeshCandidates(N,p))}register(){this.Lp.onMeshRemovedObservable.add((N=>{const p=this.Lp.selectionOctree;if(void 0!==p&&null!==p){const T=p.nM.indexOf(N);-1!==T&&p.nM.splice(T,1)}})),this.Lp.onMeshImportedObservable.add((N=>{const p=this.Lp.selectionOctree;void 0!==p&&null!==p&&p.vH(N)}))}getActiveMeshCandidates(){var N;return(null===(N=this.Lp.IM)||void 0===N?void 0:N.select(this.Lp.frustumPlanes))||this.Lp._getDefaultMeshCandidates()}getActiveSubMeshCandidates(N){if(N._submeshesOctree&&N.useOctreeForRenderingSelection){return N._submeshesOctree.select(this.Lp.frustumPlanes)}return this.Lp._getDefaultSubMeshCandidates(N)}getIntersectingSubMeshCandidates(N,p){if(N._submeshesOctree&&N.useOctreeForPicking){U.e.TransformToRef(p,N.getWorldMatrix(),this._tempRay);return N._submeshesOctree.intersectsRay(this._tempRay)}return this.Lp._getDefaultSubMeshCandidates(N)}getCollidingSubMeshCandidates(N,p){if(N._submeshesOctree&&N.useOctreeForCollisions){const T=p._velocityWorldLength+Math.max(p._radius.x,p._radius.y,p._radius.z);return N._submeshesOctree.intersects(p._basePointWorld,T)}return this.Lp._getDefaultSubMeshCandidates(N)}rebuild(){}dispose(){}}},13773:(N,p,T)=>{"use strict";T.d(p,{e:()=>l});var A=T(12617),a=T(12837),C=T(12376),U=T(12371),X=T(12384),y=T(12711),e=T(12651),H=T(12231),M=T(12676);const b={internalPickerForMesh:void 0};class l{constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.b;this.origin=N,this.direction=p,this.length=T,this.epsilon=A}clone(){return new l(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const A=l._TmpVector3[0].kX(N.x-T,N.y-T,N.z-T),a=l._TmpVector3[1].kX(p.x+T,p.y+T,p.z+T);let C,U,X,y,e=0,H=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<A.x||this.origin.x>a.x)return!1}else if(C=1/this.direction.x,U=(A.x-this.origin.x)*C,X=(a.x-this.origin.x)*C,X===-1/0&&(X=1/0),U>X&&(y=U,U=X,X=y),e=Math.max(U,e),H=Math.min(X,H),e>H)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<A.y||this.origin.y>a.y)return!1}else if(C=1/this.direction.y,U=(A.y-this.origin.y)*C,X=(a.y-this.origin.y)*C,X===-1/0&&(X=1/0),U>X&&(y=U,U=X,X=y),e=Math.max(U,e),H=Math.min(X,H),e>H)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<A.z||this.origin.z>a.z)return!1}else if(C=1/this.direction.z,U=(A.z-this.origin.z)*C,X=(a.z-this.origin.z)*C,X===-1/0&&(X=1/0),U>X&&(y=U,U=X,X=y),e=Math.max(U,e),H=Math.min(X,H),e>H)return!1;return!0}intersectsBox(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(N.minimum,N.maximum,p)}intersectsSphere(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=N.center.x-this.origin.x,A=N.center.y-this.origin.y,a=N.center.z-this.origin.z,C=T*T+A*A+a*a,U=N.radius+p,X=U*U;if(C<=X)return!0;const y=T*this.direction.x+A*this.direction.y+a*this.direction.z;if(y<0)return!1;return C-y*y<=X}intersectsTriangle(N,p,T){const A=l._TmpVector3[0],a=l._TmpVector3[1],C=l._TmpVector3[2],X=l._TmpVector3[3],e=l._TmpVector3[4];p.subtractToRef(N,A),T.subtractToRef(N,a),U.xp.CrossToRef(this.direction,a,C);const H=U.xp.Dot(A,C);if(0===H)return null;const M=1/H;this.origin.subtractToRef(N,X);const b=U.xp.Dot(X,C)*M;if(b<-this.epsilon||b>1+this.epsilon)return null;U.xp.CrossToRef(X,A,e);const k=U.xp.Dot(this.direction,e)*M;if(k<-this.epsilon||b+k>1+this.epsilon)return null;const x=U.xp.Dot(a,e)*M;return x>this.length?null:new y.b(1-b-k,b,x)}intersectsPlane(N){let p;const T=U.xp.Dot(N.normal,this.direction);if(Math.abs(T)<9.99999997475243e-7)return null;{const A=U.xp.Dot(N.normal,this.origin);return p=(-N.d-A)/T,p<0?p<-9.99999997475243e-7?null:0:p}}intersectsAxis(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(N){case"y":{const N=(this.origin.y-p)/this.direction.y;return N>0?null:new U.xp(this.origin.x+this.direction.x*-N,p,this.origin.z+this.direction.z*-N)}case"x":{const N=(this.origin.x-p)/this.direction.x;return N>0?null:new U.xp(p,this.origin.y+this.direction.y*-N,this.origin.z+this.direction.z*-N)}case"z":{const N=(this.origin.z-p)/this.direction.z;return N>0?null:new U.xp(this.origin.x+this.direction.x*-N,this.origin.y+this.direction.y*-N,p)}default:return null}}intersectsMesh(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=U.TmpVectors.Matrix[0];return N.getWorldMatrix().invertToRef(X),this._tmpRay?l.TransformToRef(this,X,this._tmpRay):this._tmpRay=l.Transform(this,X),N.intersects(this._tmpRay,p,T,A,a,C)}intersectsMeshes(N,p,T){T?T.length=0:T=[];for(let A=0;A<N.length;A++){const a=this.intersectsMesh(N[A],p);a.hit&&T.push(a)}return T.sort(this._comparePickingInfo),T}_comparePickingInfo(N,p){return N.distance<p.distance?-1:N.distance>p.distance?1:0}intersectionSegment(N,p,T){const A=this.origin,a=U.TmpVectors.xp[0],C=U.TmpVectors.xp[1],X=U.TmpVectors.xp[2],y=U.TmpVectors.xp[3];p.subtractToRef(N,a),this.direction.scaleToRef(l._Rayl,X),A.addToRef(X,C),N.subtractToRef(A,y);const e=U.xp.Dot(a,a),H=U.xp.Dot(a,X),M=U.xp.Dot(X,X),b=U.xp.Dot(a,y),k=U.xp.Dot(X,y),x=e*M-H*H;let I,L,n=x,w=x;x<l._Smallnum?(I=0,n=1,L=k,w=M):(I=H*k-M*b,L=e*k-H*b,I<0?(I=0,L=k,w=M):I>n&&(I=n,L=k+H,w=M)),L<0?(L=0,-b<0?I=0:-b>e?I=n:(I=-b,n=e)):L>w&&(L=w,-b+H<0?I=0:-b+H>e?I=n:(I=-b+H,n=e));const g=Math.abs(I)<l._Smallnum?0:I/n,P=Math.abs(L)<l._Smallnum?0:L/w,i=U.TmpVectors.xp[4];X.scaleToRef(P,i);const K=U.TmpVectors.xp[5];a.scaleToRef(g,K),K.addInPlace(y);const F=U.TmpVectors.xp[6];K.subtractToRef(i,F);return P>0&&P<=this.length&&F.lengthSquared()<T*T?K.length():-1}update(N,p,T,A,a,C,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){l._RayDistant||(l._RayDistant=l.Zero()),l._RayDistant.unprojectRayToRef(N,p,T,A,U.Matrix.IdentityReadOnly,C,X);const y=U.TmpVectors.Matrix[0];a.invertToRef(y),l.TransformToRef(l._RayDistant,y,this)}else this.unprojectRayToRef(N,p,T,A,a,C,X);return this}static Zero(){return new l(U.xp.Zero(),U.xp.Zero())}static CreateNew(N,p,T,A,a,C,U){return l.Zero().update(N,p,T,A,a,C,U)}static CreateNewFromTo(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.Matrix.IdentityReadOnly;const A=new l(new U.xp(0,0,0),new U.xp(0,0,0));return l.CreateFromToToRef(N,p,A,T)}static CreateFromToToRef(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:U.Matrix.IdentityReadOnly;T.origin.A(N);const a=p.subtractToRef(N,T.direction),C=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return T.length=C,T.direction.normalize(),l.TransformToRef(T,A,T)}static Transform(N,p){const T=new l(new U.xp(0,0,0),new U.xp(0,0,0));return l.TransformToRef(N,p,T),T}static TransformToRef(N,p,T){U.xp.TransformCoordinatesToRef(N.origin,p,T.origin),U.xp.TransformNormalToRef(N.direction,p,T.direction),T.length=N.length,T.epsilon=N.epsilon;const A=T.direction,a=A.length();if(0!==a&&1!==a){const N=1/a;A.x*=N,A.y*=N,A.z*=N,T.length*=a}return T}unprojectRayToRef(N,p,T,A,a,C,X){const y=U.TmpVectors.Matrix[0];a.multiplyToRef(C,y),y.multiplyToRef(X,y),y.invert();const e=H.b.LastCreatedEngine,M=U.TmpVectors.xp[0];M.x=N/T*2-1,M.y=-(p/A*2-1),M.z=null!==e&&void 0!==e&&e.BU?1:null!==e&&void 0!==e&&e.isNDCHalfZRange?0:-1;const b=U.TmpVectors.xp[1].kX(M.x,M.y,1-1e-8),l=U.TmpVectors.xp[2],k=U.TmpVectors.xp[3];U.xp._UnprojectFromInvertedMatrixToRef(M,y,l),U.xp._UnprojectFromInvertedMatrixToRef(b,y,k),this.origin.A(l),k.subtractToRef(l,this.direction),this.direction.normalize()}}function k(N,p,T,A,a){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const U=l.Zero();return x(N,p,T,A,U,a,C),U}function x(N,p,T,A,a,C){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const e=N.getEngine();if(!C&&!(C=N.activeCamera))return N;const H=C.viewport,M=e.getRenderHeight(),{x:b,y:l,width:k,height:x}=H.toGlobal(e.getRenderWidth(),M),I=1/e.getHardwareScalingLevel();return p=p*I-b,T=T*I-(M-l-x),a.update(p,T,k,x,A||U.Matrix.IdentityReadOnly,X?U.Matrix.IdentityReadOnly:C.getViewMatrix(),C.getProjectionMatrix(),y),N}function I(N,p,T,A,a){if(!e.c)return N;const C=N.getEngine();if(!a&&!(a=N.activeCamera))throw new Error("Active camera not set");const X=a.viewport,y=C.getRenderHeight(),{x:H,y:M,width:b,height:l}=X.toGlobal(C.getRenderWidth(),y),k=U.Matrix.Identity(),x=1/C.getHardwareScalingLevel();return p=p*x-H,T=T*x-(y-M-l),A.update(p,T,b,l,k,k,a.getProjectionMatrix()),N}function L(N,p,T,A,a,C,U,X){const y=p(A,T.enableDistantPicking),e=T.intersects(y,a,U,C,A,X);return e&&e.hit?!a&&null!=N&&e.distance>=N.distance?null:e:null}function n(N,p,T,A,a,C){let X=null;const y=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),H=N.cameraToUseForPointers||N.activeCamera,M=b.internalPickerForMesh||L;for(let e=0;e<N.meshes.length;e++){const b=N.meshes[e];if(T){if(!T(b,-1))continue}else if(!b.isEnabled()||!b.isVisible||!b.hy)continue;const l=y&&b.isWorldMatrixCameraDependent(),k=b.HX(l,H);if(b.hasThinInstances&&b.Ze){const N=M(X,p,b,k,!0,!0,C);if(N){if(a)return N;const y=U.TmpVectors.Matrix[1],e=b.thinInstanceGetWorldMatrices();for(let N=0;N<e.length;N++){if(T&&!T(b,N))continue;e[N].multiplyToRef(k,y);const U=M(X,p,b,y,A,a,C,!0);if(U&&(X=U,X.thinInstanceIndex=N,A))return X}}}else{const N=M(X,p,b,k,A,a,C);if(N&&(X=N,A))return X}}return X||new e.c}function w(N,p,T,A){if(!e.c)return null;const a=[],C=!!(N.activeCameras&&N.activeCameras.length>1&&N.cameraToUseForPointers!==N.activeCamera),X=N.cameraToUseForPointers||N.activeCamera,y=b.internalPickerForMesh||L;for(let e=0;e<N.meshes.length;e++){const H=N.meshes[e];if(T){if(!T(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.hy)continue;const M=C&&H.isWorldMatrixCameraDependent(),b=H.HX(M,X);if(H.hasThinInstances&&H.Ze){if(y(null,p,H,b,!0,!0,A)){const N=U.TmpVectors.Matrix[1],C=H.thinInstanceGetWorldMatrices();for(let U=0;U<C.length;U++){if(T&&!T(H,U))continue;C[U].multiplyToRef(b,N);const X=y(null,p,H,N,!1,!1,A,!0);X&&(X.thinInstanceIndex=U,a.push(X))}}}else{const N=y(null,p,H,b,!1,!1,A);N&&a.push(N)}}return a}function g(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,A=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;A||(A=N.getWorldMatrix()),p.length=T,a?p.origin.A(a):p.origin.A(N.position);const C=U.TmpVectors.xp[2];C.set(0,0,N._scene.useRightHandedSystem?-1:1);const X=U.TmpVectors.xp[3];return U.xp.TransformNormalToRef(C,A,X),U.xp.NormalizeToRef(X,p.direction),p}var P,i;l._TmpVector3=(0,X.e)(6,U.xp.Zero),l._RayDistant=l.Zero(),l._Smallnum=1e-8,l._Rayl=1e9,P=A.c,(i=a.d)&&(i.prototype.getForwardRay=function(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,p=arguments.length>1?arguments[1]:void 0,T=arguments.length>2?arguments[2]:void 0;return g(this,new l(U.xp.Zero(),U.xp.Zero(),N),N,p,T)},i.prototype.getForwardRayToRef=function(N){return g(this,N,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),P&&(M.c._IsPickingAvailable=!0,P.prototype.createPickingRay=function(N,p,T,A){return k(this,N,p,T,A,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),A.c.prototype.createPickingRayToRef=function(N,p,T,A,a){return x(this,N,p,T,A,a,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},A.c.prototype.createPickingRayInCameraSpace=function(N,p,T){return function(N,p,T,A){const a=l.Zero();return I(N,p,T,a,A),a}(this,N,p,T)},A.c.prototype.createPickingRayInCameraSpaceToRef=function(N,p,T,A){return I(this,N,p,T,A)},A.c.prototype.pickWithBoundingInfo=function(N,p,T,A,a){return function(N,p,T,A,a,C){if(!e.c)return null;const X=n(N,(A=>(N._tempPickingRay||(N._tempPickingRay=l.Zero()),x(N,p,T,A,N._tempPickingRay,C||null),N._tempPickingRay)),A,a,!0);return X&&(X.ray=k(N,p,T,U.Matrix.Identity(),C||null)),X}(this,N,p,T,A,a)},A.c.prototype.xT=function(N,p,T,A,a,C){return function(N,p,T,A,a,C,X){const y=n(N,((A,a)=>(N._tempPickingRay||(N._tempPickingRay=l.Zero()),x(N,p,T,A,N._tempPickingRay,C||null,!1,a),N._tempPickingRay)),A,a,!1,X);return y&&(y.ray=k(N,p,T,U.Matrix.Identity(),C||null)),y}(this,N,p,T,A,a,C)},A.c.prototype.pickWithRay=function(N,p,T,A){return function(N,p,T,A,a){const C=n(N,(T=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=U.Matrix.Identity()),T.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=l.Zero()),l.TransformToRef(p,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),T,A,!1,a);return C&&(C.ray=p),C}(this,N,p,T,A)},A.c.prototype.multiPick=function(N,p,T,A,a){return function(N,p,T,A,a,C){return w(N,(A=>k(N,p,T,A,a||null)),A,C)}(this,N,p,T,A,a)},A.c.prototype.multiPickWithRay=function(N,p,T){return function(N,p,T,A){return w(N,(T=>(N._pickWithRayInverseMatrix||(N._pickWithRayInverseMatrix=U.Matrix.Identity()),T.invertToRef(N._pickWithRayInverseMatrix),N._cachedRayForTransform||(N._cachedRayForTransform=l.Zero()),l.TransformToRef(p,N._pickWithRayInverseMatrix,N._cachedRayForTransform),N._cachedRayForTransform)),T,A)}(this,N,p,T)}},14051:(N,p,T)=>{"use strict";var A=T(12302),a=T(12205),C=T(12240),U=T(12333),X=T(12270),y=T(12314);X.c.prototype._partialLoadFile=function(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(N,(N=>{T[p]=N,T._internalCount++,6===T._internalCount&&A(T)}),void 0,void 0,!0,((N,p)=>{a&&N&&a(N.status+" "+N.statusText,p)}))},X.c.prototype._cascadeLoadFiles=function(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=[];a._internalCount=0;for(let C=0;C<6;C++)this._partialLoadFile(T[C],C,a,p,A)},X.c.prototype._cascadeLoadImgs=function(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5?arguments[5]:void 0;const U=[];U._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(A[X],X,U,N,p,T,a,C)},X.c.prototype._partialLoadImg=function(N,p,T,A,a,X){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0;const H=(0,U.b)();(0,C.q)(N,(N=>{T[p]=N,T._internalCount++,A&&A.removePendingData(H),6===T._internalCount&&X&&X(a,T)}),((N,p)=>{A&&A.removePendingData(H),y&&y(N,p)}),A?A.offlineProvider:null,e),A&&A.addPendingData(H)},X.c.prototype.createCubeTextureBase=function(N,p,T,C){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6?arguments[6]:void 0,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,I=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,L=arguments.length>14&&void 0!==arguments[14]&&arguments[14],n=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const w=k||new A.d(this,7);w.isCube=!0,w.url=N,w.generateMipMaps=!C,w._lodGenerationScale=b,w._lodGenerationOffset=l,w._useSRGBBuffer=!!L&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!C),w!==k&&(w.label=N.substring(0,60)),this._doNotHandleContextLost||(w._extension=H,w._files=T,w._buffer=n);const g=N;this._transformTextureUrl&&!k&&(N=this._transformTextureUrl(N));const P=H??function(N){const p=N.split("?")[0],T=p.lastIndexOf(".");return T>-1?p.substring(T).toLowerCase():""}(N),i=(0,y.e)(P),K=(N,p)=>{w.dispose(),X?X(N,p):N&&a.d.Warn(N)},F=(A,X)=>{N===g?A&&K(A.status+" "+A.statusText,X):(a.d.Warn(`Failed to load ${N}, falling back to the ${g}`),this.createCubeTextureBase(g,p,T,!!C,U,K,e,H,M,b,l,w,x,I,L,n))};if(i)i.then((A=>{const a=N=>{x&&x(w,N),A.loadCubeData(N,w,M,U,((N,p)=>{K(N,p)}))};n?a(n):T&&6===T.length?A.supportCascades?this._cascadeLoadFiles(p,(N=>a(N.map((N=>new Uint8Array(N))))),T,K):K("Textures type does not support cascades."):this._loadFile(N,(N=>a(new Uint8Array(N))),void 0,void 0,!0,F)}));else{if(!T||0===T.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(p,w,((N,p)=>{I&&I(N,p)}),T,K)}return this._internalTexturesCache.push(w),w}},14578:(N,p,T)=>{"use strict";T(12205);var A=T(12505);T(12302),T(12454),T(12297),T(12555),T(12513);A.d},14079:(N,p,T)=>{"use strict";T.d(p,{c:()=>a});var A=T(12331);class a{constructor(N){this.value=this._toInt(N)}_toInt(N){return 0|N}add(N){return new a(this.value+N.value)}Ip(N){return new a(this.value-N.value)}multiply(N){return new a(Math.imul(this.value,N.value))}divide(N){return new a(this.value/N.value)}getClassName(){return a.ClassName}equals(N){return this.value===N.value}static FromValue(N){return new a(N)}toString(){return this.value.toString()}}a.ClassName="FlowGraphInteger",(0,A.d)("FlowGraphInteger",a)},14084:(N,p,T)=>{"use strict";T.d(p,{c:()=>a,g:()=>C});var A=T(12371);class a{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.NX=N}get m(){return this.NX}transformVector(N){return this.transformVectorToRef(N,new A.Vector2)}transformVectorToRef(N,p){return p.x=N.x*this.NX[0]+N.y*this.NX[1],p.y=N.x*this.NX[2]+N.y*this.NX[3],p}UX(){return this.toArray()}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<4;p++)N[p]=this.NX[p];return N}IT(N){for(let p=0;p<4;p++)this.NX[p]=N[p];return this}multiplyToRef(N,p){const T=N.NX,A=this.NX,a=p.NX;return a[0]=T[0]*A[0]+T[1]*A[2],a[1]=T[0]*A[1]+T[1]*A[3],a[2]=T[2]*A[0]+T[3]*A[2],a[3]=T[2]*A[1]+T[3]*A[3],p}multiply(N){return this.multiplyToRef(N,new a)}divideToRef(N,p){const T=this.NX,A=N.NX,a=p.NX;return a[0]=T[0]/A[0],a[1]=T[1]/A[1],a[2]=T[2]/A[2],a[3]=T[3]/A[3],p}divide(N){return this.divideToRef(N,new a)}addToRef(N,p){const T=this.NX,A=N.m,a=p.m;return a[0]=T[0]+A[0],a[1]=T[1]+A[1],a[2]=T[2]+A[2],a[3]=T[3]+A[3],p}add(N){return this.addToRef(N,new a)}subtractToRef(N,p){const T=this.NX,A=N.m,a=p.m;return a[0]=T[0]-A[0],a[1]=T[1]-A[1],a[2]=T[2]-A[2],a[3]=T[3]-A[3],p}Ip(N){return this.subtractToRef(N,new a)}transpose(){const N=this.NX;return new a([N[0],N[2],N[1],N[3]])}determinant(){const N=this.NX;return N[0]*N[3]-N[1]*N[2]}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const p=this.NX,T=1/N;return new a([p[3]*T,-p[1]*T,-p[2]*T,p[0]*T])}equals(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.NX,A=N.m;return 0===p?T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]&&T[3]===A[3]:Math.abs(T[0]-A[0])<p&&Math.abs(T[1]-A[1])<p&&Math.abs(T[2]-A[2])<p&&Math.abs(T[3]-A[3])<p}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.NX.join(", ")})`}}class C{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.NX=N}get m(){return this.NX}transformVector(N){return this.transformVectorToRef(N,new A.xp)}transformVectorToRef(N,p){const T=this.NX;return p.x=N.x*T[0]+N.y*T[1]+N.z*T[2],p.y=N.x*T[3]+N.y*T[4]+N.z*T[5],p.z=N.x*T[6]+N.y*T[7]+N.z*T[8],p}multiplyToRef(N,p){const T=N.NX,A=this.NX,a=p.m;return a[0]=T[0]*A[0]+T[1]*A[3]+T[2]*A[6],a[1]=T[0]*A[1]+T[1]*A[4]+T[2]*A[7],a[2]=T[0]*A[2]+T[1]*A[5]+T[2]*A[8],a[3]=T[3]*A[0]+T[4]*A[3]+T[5]*A[6],a[4]=T[3]*A[1]+T[4]*A[4]+T[5]*A[7],a[5]=T[3]*A[2]+T[4]*A[5]+T[5]*A[8],a[6]=T[6]*A[0]+T[7]*A[3]+T[8]*A[6],a[7]=T[6]*A[1]+T[7]*A[4]+T[8]*A[7],a[8]=T[6]*A[2]+T[7]*A[5]+T[8]*A[8],p}multiply(N){return this.multiplyToRef(N,new C)}divideToRef(N,p){const T=this.NX,A=N.m,a=p.m;return a[0]=T[0]/A[0],a[1]=T[1]/A[1],a[2]=T[2]/A[2],a[3]=T[3]/A[3],a[4]=T[4]/A[4],a[5]=T[5]/A[5],a[6]=T[6]/A[6],a[7]=T[7]/A[7],a[8]=T[8]/A[8],p}divide(N){return this.divideToRef(N,new C)}addToRef(N,p){const T=this.NX,A=N.m,a=p.m;return a[0]=T[0]+A[0],a[1]=T[1]+A[1],a[2]=T[2]+A[2],a[3]=T[3]+A[3],a[4]=T[4]+A[4],a[5]=T[5]+A[5],a[6]=T[6]+A[6],a[7]=T[7]+A[7],a[8]=T[8]+A[8],p}add(N){return this.addToRef(N,new C)}subtractToRef(N,p){const T=this.NX,A=N.m,a=p.m;return a[0]=T[0]-A[0],a[1]=T[1]-A[1],a[2]=T[2]-A[2],a[3]=T[3]-A[3],a[4]=T[4]-A[4],a[5]=T[5]-A[5],a[6]=T[6]-A[6],a[7]=T[7]-A[7],a[8]=T[8]-A[8],p}Ip(N){return this.subtractToRef(N,new C)}toArray(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let p=0;p<9;p++)N[p]=this.NX[p];return N}UX(){return this.toArray()}IT(N){for(let p=0;p<9;p++)this.NX[p]=N[p];return this}transpose(){const N=this.NX;return new C([N[0],N[3],N[6],N[1],N[4],N[7],N[2],N[5],N[8]])}determinant(){const N=this.NX;return N[0]*(N[4]*N[8]-N[5]*N[7])-N[1]*(N[3]*N[8]-N[5]*N[6])+N[2]*(N[3]*N[7]-N[4]*N[6])}inverse(){const N=this.determinant();if(0===N)throw new Error("Matrix is not invertible");const p=this.NX,T=1/N;return new C([(p[4]*p[8]-p[5]*p[7])*T,(p[2]*p[7]-p[1]*p[8])*T,(p[1]*p[5]-p[2]*p[4])*T,(p[5]*p[6]-p[3]*p[8])*T,(p[0]*p[8]-p[2]*p[6])*T,(p[2]*p[3]-p[0]*p[5])*T,(p[3]*p[7]-p[4]*p[6])*T,(p[1]*p[6]-p[0]*p[7])*T,(p[0]*p[4]-p[1]*p[3])*T])}equals(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const T=this.NX,A=N.m;return 0===p?T[0]===A[0]&&T[1]===A[1]&&T[2]===A[2]&&T[3]===A[3]&&T[4]===A[4]&&T[5]===A[5]&&T[6]===A[6]&&T[7]===A[7]&&T[8]===A[8]:Math.abs(T[0]-A[0])<p&&Math.abs(T[1]-A[1])<p&&Math.abs(T[2]-A[2])<p&&Math.abs(T[3]-A[3])<p&&Math.abs(T[4]-A[4])<p&&Math.abs(T[5]-A[5])<p&&Math.abs(T[6]-A[6])<p&&Math.abs(T[7]-A[7])<p&&Math.abs(T[8]-A[8])<p}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.NX.join(", ")})`}}},14091:(N,p,T)=>{"use strict";var A;function a(N,p,T,A){switch(p){case"Animation":return A?N.animations.find((N=>N.uniqueId===T))??null:N.animations[T]??null;case"AnimationGroup":return A?N.animationGroups.find((N=>N.uniqueId===T))??null:N.animationGroups[T]??null;case"Mesh":return A?N.meshes.find((N=>N.uniqueId===T))??null:N.meshes[T]??null;case"Material":return A?N.materials.find((N=>N.uniqueId===T))??null:N.materials[T]??null;case"ZH":return A?N.cameras.find((N=>N.uniqueId===T))??null:N.cameras[T]??null;case"Light":return A?N.lights.find((N=>N.uniqueId===T))??null:N.lights[T]??null;default:return null}}T.d(p,{b:()=>a}),function(N){N.Animation="Animation",N.AnimationGroup="AnimationGroup",N.Mesh="Mesh",N.Material="Material",N.ZH="ZH",N.Light="Light"}(A||(A={}))},14127:(N,p,T)=>{"use strict";T.d(p,{e:()=>a});var A=T(14129);class a extends A.d{constructor(N,p){if(super(N),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),p)for(const T of p)this._eventsSignalOutputs[T]=this._registerSignalOutput(T+"Event")}_executeOnTick(N){}_startPendingTasks(N){N._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(N),this._resetAfterCanceled(N)),this._preparePendingTasks(N),N._addPendingBlock(this),this.out._activateSignal(N),N._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(N){N._deleteExecutionVariable(this,"_initialized"),N._removePendingBlock(this)}}},14108:(N,p,T)=>{"use strict";T.d(p,{c:()=>e});var A=T(12333),a=T(12331),C=T(14111),U=T(12194),X=T(14071);class y extends C.b{constructor(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:A.defaultValue,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(N,p,T),this.richType=A,this._defaultValue=a,this._optional=C,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new U.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(N){this._isDisabled!==N&&(this._isDisabled=N,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(N,p){p._getConnectionValue(this)!==N&&(p._setConnectionValue(this,N),this.onValueChangedObservable.notifyObservers(N))}resetToDefaultValue(N){N._setConnectionValue(this,this._defaultValue)}connectTo(N){this._isDisabled||super.connectTo(N)}_getValueOrDefault(N){const p=N._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(p):p}getValue(N){if(1===this.connectionType){N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(N);const p=this._getValueOrDefault(N);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}const p=this.isConnected()?this._connectedPoint[0].getValue(N):this._getValueOrDefault(N);return this._lastValue=p,this.richType.typeTransformer?this.richType.typeTransformer(p):p}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.richType={},this.richType.serialize(N.richType),N.optional=this._optional,(0,X.c)("defaultValue",this._defaultValue,N)}}(0,a.d)("FlowGraphDataConnection",y);class e{constructor(N){var p;this.config=N,this.uniqueId=(0,A.b)(),this.name=(null===(p=this.config)||void 0===p?void 0:p.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(N){}registerDataInput(N,p,T){const A=new y(N,0,this,p,T);return this.dataInputs.push(A),A}registerDataOutput(N,p,T){const A=new y(N,1,this,p,T);return this.dataOutputs.push(A),A}getDataInput(N){return this.dataInputs.find((p=>p.name===N))}getDataOutput(N){return this.dataOutputs.find((p=>p.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.c;if(N.uniqueId=this.uniqueId,N.config={},this.config){const T=this.config,A=Object.keys(T);for(const a of A)p(a,T[a],N.config)}N.dataInputs=[],N.dataOutputs=[],N.className=this.getClassName();for(const T of this.dataInputs){const p={};T.serialize(p),N.dataInputs.push(p)}for(const T of this.dataOutputs){const p={};T.serialize(p),N.dataOutputs.push(p)}}deserialize(N){}_log(N,p,T){var A;null===(A=N.logger)||void 0===A||A.addLogItem({action:p,LT:T,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14111:(N,p,T)=>{"use strict";T.d(p,{b:()=>C});var A,a=T(12333);!function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(A||(A={}));class C{constructor(N,p,T){this._ownerBlock=T,this._connectedPoint=[],this.uniqueId=(0,a.b)(),this.connectedPointIds=[],this.name=N,this._connectionType=p}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(N){if(this._connectionType===N._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||N._isSingularConnection()&&N._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(N),N._connectedPoint.push(this)}disconnectFrom(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const T=this._connectedPoint.indexOf(N),A=N._connectedPoint.indexOf(this);-1!==T&&-1!==A&&(p&&this._connectedPoint.splice(T,1),N._connectedPoint.splice(A,1))}disconnectFromAll(){for(const N of this._connectedPoint)this.disconnectFrom(N,!1);this._connectedPoint.length=0}dispose(){for(const N of this._connectedPoint)this.disconnectFrom(N)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N.uniqueId=this.uniqueId,N.name=this.name,N._connectionType=this._connectionType,N.connectedPointIds=[],N.className=this.getClassName();for(const p of this._connectedPoint)N.connectedPointIds.push(p.uniqueId)}getClassName(){return"FGConnection"}deserialize(N){this.uniqueId=N.uniqueId,this.name=N.name,this._connectionType=N._connectionType,this.connectedPointIds=N.connectedPointIds}}},14066:(N,p,T)=>{"use strict";T.d(p,{b:()=>w});var A,a=T(12194),C=T(12354),U=T(12359),X=T(12333),y=T(14071),e=T(14091),H=T(12205);!function(N){N.ExecuteBlock="ExecuteBlock",N.ExecuteEvent="ExecuteEvent",N.TriggerConnection="TriggerConnection",N.ContextVariableSet="ContextVariableSet",N.GlobalVariableSet="GlobalVariableSet",N.GlobalVariableDelete="GlobalVariableDelete",N.GlobalVariableGet="GlobalVariableGet",N.AddConnection="AddConnection",N.GetConnectionValue="GetConnectionValue",N.SetConnectionValue="SetConnectionValue",N.ActivateSignal="ActivateSignal",N.ContextVariableGet="ContextVariableGet"}(A||(A={}));class M{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(N){if(N.time||(N.time=Date.now()),this.log.push(N),this.logToConsole){var p;const T=null===(p=N.LT)||void 0===p?void 0:p.value;"object"===typeof T&&T.getClassName?H.d.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(T.getClassName())}: ${T.toString()}`):H.d.Log(`[FGLog] ${N.className}:${N.uniqueId.split("-")[0]} ${N.action} - ${JSON.stringify(N.LT)}`)}}getItemsOfType(N){return this.log.filter((p=>p.action===N))}}class b{get enableLogging(){return this._enableLogging}set enableLogging(N){this._enableLogging!==N&&(this._enableLogging=N,this._enableLogging?(this.logger=new M,this.logger.logToConsole=!0):this.logger=null)}constructor(N){this.uniqueId=(0,X.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new a.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=N,this.assetsContext=N.assetsContext??N.Lp}hasVariable(N){return N in this._userVariables}setVariable(N,p){var T;this._userVariables[N]=p,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",LT:{name:N,value:p}})}getAsset(N,p){return(0,e.b)(this.assetsContext,N,p)}getVariable(N){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",LT:{name:N,value:this._userVariables[N]}}),this._userVariables[N]}get userVariables(){return this._userVariables}KN(){return this._configuration.Lp}_getUniqueIdPrefixedName(N,p){return`${N.uniqueId}_${p}`}_getGlobalContextVariable(N,p){var T;return null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",LT:{name:N,defaultValue:p,possibleValue:this._globalContextVariables[N]}}),this._hasGlobalContextVariable(N)?this._globalContextVariables[N]:p}_setGlobalContextVariable(N,p){var T;null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",LT:{name:N,value:p}}),this._globalContextVariables[N]=p}_deleteGlobalContextVariable(N){var p;null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",LT:{name:N}}),delete this._globalContextVariables[N]}_hasGlobalContextVariable(N){return N in this._globalContextVariables}_setExecutionVariable(N,p,T){this._executionVariables[this._getUniqueIdPrefixedName(N,p)]=T}_getExecutionVariable(N,p,T){return this._hasExecutionVariable(N,p)?this._executionVariables[this._getUniqueIdPrefixedName(N,p)]:T}_deleteExecutionVariable(N,p){delete this._executionVariables[this._getUniqueIdPrefixedName(N,p)]}_hasExecutionVariable(N,p){return this._getUniqueIdPrefixedName(N,p)in this._executionVariables}_hasConnectionValue(N){return N.uniqueId in this._connectionValues}_setConnectionValue(N,p){var T;this._connectionValues[N.uniqueId]=p,null===(T=this.logger)||void 0===T||T.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",LT:{connectionPointId:N.uniqueId,value:p}})}_setConnectionValueByKey(N,p){this._connectionValues[N]=p}_getConnectionValue(N){var p;return null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",LT:{connectionPointId:N.uniqueId,value:this._connectionValues[N.uniqueId]}}),this._connectionValues[N.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(N){this._pendingBlocks.includes(N)||(this._pendingBlocks.push(N),this._pendingBlocks.sort(((N,p)=>N.priority-p.priority)))}_removePendingBlock(N){const p=this._pendingBlocks.indexOf(N);-1!==p&&this._pendingBlocks.splice(p,1)}_clearPendingBlocks(){for(const N of this._pendingBlocks)N._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(N){var p;this.onNodeExecutedObservable.notifyObservers(N),null===(p=this.logger)||void 0===p||p.addLogItem({time:Date.now(),className:N.getClassName(),uniqueId:N.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(N){this._setGlobalContextVariable("timeSinceStart",N.timeSinceStart),this._setGlobalContextVariable("deltaTime",N.deltaTime);for(const T of this._pendingBlocks){var p;null===(p=T._executeOnTick)||void 0===p||p.call(T,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.c;N.uniqueId=this.uniqueId,N._userVariables={};for(const A in this._userVariables)p(A,this._userVariables[A],N._userVariables);N._connectionValues={};for(const A in this._connectionValues)p(A,this._connectionValues[A],N._connectionValues);var T;this.assetsContext!==this.KN()&&(N._assetsContext={meshes:this.assetsContext.meshes.map((N=>N.id)),materials:this.assetsContext.materials.map((N=>N.id)),textures:this.assetsContext.textures.map((N=>N.name)),animations:this.assetsContext.animations.map((N=>N.name)),lights:this.assetsContext.lights.map((N=>N.id)),cameras:this.assetsContext.cameras.map((N=>N.id)),ul:null===(T=this.assetsContext.ul)||void 0===T?void 0:T.map((N=>N.name)),skeletons:this.assetsContext.skeletons.map((N=>N.id)),Ul:this.assetsContext.Ul.map((N=>N.name)),geometries:this.assetsContext.geometries.map((N=>N.id)),multiMaterials:this.assetsContext.multiMaterials.map((N=>N.id)),transformNodes:this.assetsContext.transformNodes.map((N=>N.id))})}getClassName(){return"FlowGraphContext"}}(0,C.b)([(0,U.H)()],b.prototype,"uniqueId",void 0);var l=T(14099),k=T(12658);class x{constructor(N){this.onEventTriggeredObservable=new a.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=N,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.SU.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const N=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",LT:{timeSinceStart:this._startingTime,deltaTime:N}}),this._startingTime+=N})),this._meshPickedObserver=this._scene.onPointerObservable.add((N=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",LT:N})}),k.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((N=>{const p=N.pointerId,T=N.mesh,A=this._pointerUnderMeshState[p];!A&&T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",LT:{pointerId:p,mesh:T}}):A&&!T?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",LT:{pointerId:p,mesh:A}}):A&&T&&A!==T&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",LT:{pointerId:p,mesh:A,over:T}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",LT:{pointerId:p,mesh:T,out:A}})),this._pointerUnderMeshState[p]=T}),k.d.POINTERMOVE)}dispose(){var N,p,T,A,a;null===(N=this._sceneDisposeObserver)||void 0===N||N.remove(),null===(p=this._sceneReadyObserver)||void 0===p||p.remove(),null===(T=this._sceneOnBeforeRenderObserver)||void 0===T||T.remove(),null===(A=this._meshPickedObserver)||void 0===A||A.remove(),null===(a=this._meshUnderPointerObserver)||void 0===a||a.remove(),this.onEventTriggeredObservable.clear()}}var I,L=T(14120);!function(N){N[N.Stopped=0]="Stopped",N[N.Started=1]="Started"}(I||(I={}));class n{get state(){return this._state}set state(N){this._state=N,this.onStateChangedObservable.notifyObservers(N)}constructor(N){this.onStateChangedObservable=new a.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=N.Lp,this._sceneEventCoordinator=new x(this._scene),this._coordinator=N.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((N=>{for(const p of this._executionContexts){const T=this._getContextualOrder(N.type,p);for(const A of T)if(!A._executeEvent(p,N.LT))break}switch(N.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const p of this._executionContexts)p._notifyOnTick(N.LT);break;case"SceneDispose":this.dispose()}}))}createContext(){const N=new b({Lp:this._scene,coordinator:this._coordinator});return this._executionContexts.push(N),N}getContext(N){return this._executionContexts[N]}addEventBlock(N){if("PointerOver"!==N.type&&"PointerOut"!==N.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==N.type&&this._eventBlocks[N.type].push(N),1===this.state)for(const p of this._executionContexts)N._startPendingTasks(p);else this.onStateChangedObservable.addOnce((p=>{if(1===p)for(const T of this._executionContexts)N._startPendingTasks(T)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((N=>{1===N&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const N of this._executionContexts)for(const p in this._eventBlocks){const T=this._getContextualOrder(p,N);for(const p of T)p._startPendingTasks(N)}}_getContextualOrder(N,p){const T=this._eventBlocks[N].sort(((N,p)=>p.initPriority-N.initPriority));if("MeshPick"===N){const N=[];for(const A of T){const a=A.asset.getValue(p);let C=0;for(;C<T.length;C++){const N=T[C].asset.getValue(p);if(a&&N&&(0,L.o)(a,N))break}N.splice(C,0,A)}return N}return T}dispose(){var N;if(0!==this.state){this.state=0;for(const N of this._executionContexts)N._clearPendingBlocks();this._executionContexts.length=0;for(const N in this._eventBlocks)this._eventBlocks[N].length=0;null===(N=this._eventObserver)||void 0===N||N.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(N){const p=[],T=new Set;for(const A in this._eventBlocks)for(const N of this._eventBlocks[A])p.push(N),T.add(N.uniqueId);for(;p.length>0;){const A=p.pop();N(A);for(const N of A.dataInputs)for(const A of N._connectedPoint)T.has(A._ownerBlock.uniqueId)||(p.push(A._ownerBlock),T.add(A._ownerBlock.uniqueId));if(A instanceof l.c)for(const N of A.signalOutputs)for(const A of N._connectedPoint)T.has(A._ownerBlock.uniqueId)||(p.push(A._ownerBlock),T.add(A._ownerBlock.uniqueId))}}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=arguments.length>1?arguments[1]:void 0;N.allBlocks=[],this.visitAllBlocks((p=>{const T={};p.serialize(T),N.allBlocks.push(T)})),N.executionContexts=[];for(const T of this._executionContexts){const A={};T.serialize(A,p),N.executionContexts.push(A)}}}class w{constructor(N){this.config=N,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Lp.SU.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Lp.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const N=this._executeOnNextFrame.slice(0);if(N.length)for(const p of N){this.notifyCustomEvent(p.id,p.data,!1);const N=this._executeOnNextFrame.findIndex((N=>N.uniqueId===p.uniqueId));-1!==N&&this._executeOnNextFrame.splice(N,1)}}));(w.SceneCoordinators.get(this.config.Lp)??[]).push(this)}createGraph(){const N=new n({Lp:this.config.Lp,coordinator:this});return this._flowGraphs.push(N),N}removeGraph(N){const p=this._flowGraphs.indexOf(N);-1!==p&&(N.dispose(),this._flowGraphs.splice(p,1))}start(){for(const N of this._flowGraphs)N.start()}dispose(){var N,p;for(const a of this._flowGraphs)a.dispose();this._flowGraphs.length=0,null===(N=this._disposeObserver)||void 0===N||N.remove(),null===(p=this._onBeforeRenderObserver)||void 0===p||p.remove();const T=w.SceneCoordinators.get(this.config.Lp)??[],A=T.indexOf(this);-1!==A&&T.splice(A,1)}serialize(N,p){N._flowGraphs=[];for(const T of this._flowGraphs){const A={};T.serialize(A,p),N._flowGraphs.push(A)}N.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(N){let p=this._customEventsMap.get(N);return p||(p=new a.c,this._customEventsMap.set(N,p)),p}notifyCustomEvent(N,p){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:N,data:p,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(N)){const p=this._eventExecutionCounter.get(N);if(this._eventExecutionCounter.set(N,p+1),p>=w.MaxEventTypeExecutionPerFrame)return void(p===w.MaxEventTypeExecutionPerFrame&&H.d.Warn(`FlowGraphCoordinator: Too many executions of event "${N}".`))}else this._eventExecutionCounter.set(N,1);const T=this._customEventsMap.get(N);T&&T.notifyObservers(p)}}w.MaxEventsPerType=30,w.MaxEventTypeExecutionPerFrame=30,w.SceneCoordinators=new Map},14123:(N,p,T)=>{"use strict";T.d(p,{d:()=>a});var A=T(14127);class a extends A.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(N){N._notifyExecuteNode(this),this.done._activateSignal(N)}}},14099:(N,p,T)=>{"use strict";T.d(p,{c:()=>X});var A=T(14108),a=T(14111),C=T(12331);class U extends a.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(N){super.connectTo(N),this._connectedPoint.sort(((N,p)=>p.priority-N.priority))}_activateSignal(N){var p;if(null===(p=N.logger)||void 0===p||p.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,LT:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)N._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(N,this),N._increaseExecutionId();else for(const T of this._connectedPoint)T._activateSignal(N)}}(0,C.d)("FlowGraphSignalConnection",U);class X extends A.c{constructor(N){super(N),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(N){const p=new U(N,0,this);return this.signalInputs.push(p),p}_registerSignalOutput(N){const p=new U(N,1,this);return this.signalOutputs.push(p),p}_unregisterSignalInput(N){const p=this.signalInputs.findIndex((p=>p.name===N));-1!==p&&(this.signalInputs[p].dispose(),this.signalInputs.splice(p,1))}_unregisterSignalOutput(N){const p=this.signalOutputs.findIndex((p=>p.name===N));-1!==p&&(this.signalOutputs[p].dispose(),this.signalOutputs.splice(p,1))}_reportError(N,p){this.error.LT="string"===typeof p?new Error(p):p,this.error._activateSignal(N)}getSignalInput(N){return this.signalInputs.find((p=>p.name===N))}getSignalOutput(N){return this.signalOutputs.find((p=>p.name===N))}serialize(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(N),N.signalInputs=[],N.signalOutputs=[];for(const p of this.signalInputs){const T={};p.serialize(T),N.signalInputs.push(T)}for(const p of this.signalOutputs){const T={};p.serialize(T),N.signalOutputs.push(T)}}deserialize(N){for(let p=0;p<N.signalInputs.length;p++){const T=this.getSignalInput(N.signalInputs[p].name);if(!T)throw new Error("Could not find signal input with name "+N.signalInputs[p].name+" in block "+N.className);T.deserialize(N.signalInputs[p])}for(let p=0;p<N.signalOutputs.length;p++){const T=this.getSignalOutput(N.signalOutputs[p].name);if(!T)throw new Error("Could not find signal output with name "+N.signalOutputs[p].name+" in block "+N.className);T.deserialize(N.signalOutputs[p])}}getClassName(){return"FlowGraphExecutionBlock"}}},14129:(N,p,T)=>{"use strict";T.d(p,{d:()=>a});var A=T(14099);class a extends A.c{constructor(N){super(N),this.out=this._registerSignalOutput("out")}}},14082:(N,p,T)=>{"use strict";T.d(p,{A:()=>l,D:()=>k,E:()=>x,G:()=>v,J:()=>W,K:()=>F,O:()=>K,d:()=>e,g:()=>b,h:()=>i,i:()=>I,k:()=>L,n:()=>n,r:()=>M,v:()=>P,z:()=>H});var A,a=T(12371),C=T(12421),U=T(14079),X=T(14084);!function(N){N.Any="any",N.String="string",N.Number="number",N.Boolean="boolean",N.Object="object",N.Integer="FlowGraphInteger",N.Vector2="Vector2",N.xp="xp",N.Vector4="Vector4",N.Quaternion="Quaternion",N.Matrix="Matrix",N.Matrix2D="Matrix2D",N.Matrix3D="Matrix3D",N.wp="wp",N.LX="LX"}(A||(A={}));class y{constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=N,this.defaultValue=p,this.animationType=T}serialize(N){N.typeName=this.typeName,N.defaultValue=this.defaultValue}}const e=new y("any",void 0),H=new y("string",""),M=new y("number",0,0),b=new y("boolean",!1),l=new y("Vector2",a.Vector2.Zero(),5),k=new y("xp",a.xp.Zero(),1),x=new y("Vector4",a.Vector4.Zero()),I=new y("Matrix",a.Matrix.Identity(),3),L=new y("Matrix2D",new X.c),n=new y("Matrix3D",new X.g),w=new y("wp",C.wp.Black(),4),g=new y("LX",new C.LX(0,0,0,0),7),P=new y("Quaternion",a.Quaternion.Identity(),2);P.typeTransformer=N=>{if(N.getClassName){if("Vector4"===N.getClassName())return a.Quaternion.gp(N.UX());if("xp"===N.getClassName())return a.Quaternion.FromEulerVector(N);if("Matrix"===N.getClassName())return a.Quaternion.FromRotationMatrix(N)}return N};const i=new y("FlowGraphInteger",new U.c(0),0);function K(N){const p=N;switch(typeof N){case"string":return H;case"number":return M;case"boolean":return b;case"object":if(p.getClassName)switch(p.getClassName()){case"Vector2":return l;case"xp":return k;case"Vector4":return x;case"Matrix":return I;case"wp":return w;case"LX":return g;case"Quaternion":return P;case"FlowGraphInteger":return i;case"Matrix2D":return L;case"Matrix3D":return n}return e;default:return e}}function F(N){switch(N){case"string":return H;case"number":return M;case"boolean":return b;case"Vector2":return l;case"xp":return k;case"Vector4":return x;case"Matrix":return I;case"wp":return w;case"LX":return g;case"Quaternion":return P;case"FlowGraphInteger":return i;case"Matrix2D":return L;case"Matrix3D":return n;default:return e}}function v(N){switch(N){case"number":default:return 0;case"Vector2":return 5;case"xp":return 1;case"Matrix":return 3;case"wp":return 4;case"LX":return 7;case"Quaternion":return 2}}function W(N){switch(N){case 0:return M;case 5:return l;case 1:return k;case 3:return I;case 4:return w;case 7:return g;case 2:return P;default:return e}}},14071:(N,p,T)=>{"use strict";T.d(p,{b:()=>H,c:()=>e,f:()=>M});var A=T(12421),a=T(12371),C=T(14079),U=T(14082),X=T(14084);function y(N){return"Vector2"===N||"xp"===N||"Vector4"===N||"Quaternion"===N||"wp"===N||"LX"===N}function e(N,p,T){var A;const a=(null===p||void 0===p||null===(A=p.getClassName)||void 0===A?void 0:A.call(p))??"";if(y(a)||function(N){return"Matrix"===N||"Matrix2D"===N||"Matrix3D"===N}(a))T[N]={value:p.UX(),className:a};else if("FlowGraphInteger"===a)T[N]={value:p.value,className:a};else if(a&&(p.id||p.name))T[N]={id:p.id,name:p.name,className:a};else{if("object"===typeof p)throw new Error(`Could not serialize value ${p}`);T[N]=p}}function H(N,p,T,e){const M=p[N];let b;const l=(null===M||void 0===M?void 0:M.type)??(null===M||void 0===M?void 0:M.className);if(function(N){return"Mesh"===N||"AbstractMesh"===N||"GroundMesh"===N||"InstanceMesh"===N||"LinesMesh"===N||"GoldbergMesh"===N||"GreasedLineMesh"===N||"TrailMesh"===N}(l)){let N=e.meshes.filter((N=>M.id?N.id===M.id:N.name===M.name));0===N.length&&(N=e.transformNodes.filter((N=>M.id?N.id===M.id:N.name===M.name))),b=M.uniqueId?N.find((N=>N.uniqueId===M.uniqueId)):N[0]}else if(y(l))b=function(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===N)return a.Vector2.gp(p);if("xp"===N)return T&&(p[2]*=-1),a.xp.gp(p);if("Vector4"===N)return a.Vector4.gp(p);if("Quaternion"===N)return T&&(p[2]*=-1,p[3]*=-1),a.Quaternion.gp(p);if("wp"===N)return new A.wp(p[0],p[1],p[2]);if("LX"===N)return new A.LX(p[0],p[1],p[2],p[3]);throw new Error(`Unknown vector class name ${N}`)}(l,M.value);else if(function(N){return"AnimationGroup"===N}(l)){const N=e.animationGroups.filter((N=>N.name===M.name));b=1===N.length?N[0]:N.find((N=>N.uniqueId===M.uniqueId))}else b="Matrix"===l?a.Matrix.gp(M.value):"Matrix2D"===l?new X.c(M.value):"Matrix3D"===l?new X.g(M.value):"FlowGraphInteger"===l?C.c.FromValue(M.value):"number"===l||"string"===l||"boolean"===l?M.value[0]:M&&void 0!==M.value?M.value:Array.isArray(M)?M.reduce(((N,p)=>p.eventData?(N[p.id]={type:(0,U.K)(p.type)},"undefined"!==typeof p.value&&(N[p.id].value=H("value",p,T,e)),N):N),{}):M;return b}function M(N){return"FlowGraphJsonPointerParserBlock"===N}},14120:(N,p,T)=>{"use strict";function A(N,p){return!(!N.parent||N.parent!==p&&!A(N.parent,p))}function a(N){if(N.getClassName)return N.getClassName()}function C(N,p){return N===p&&("Vector2"===N||"xp"===N||"Vector4"===N||"Quaternion"===N)}function U(N,p){return N===p&&("Matrix"===N||"Matrix2D"===N||"Matrix3D"===N)}function X(N,p){return"FlowGraphInteger"===N&&"FlowGraphInteger"===p}function y(N,p){const T="number"===typeof N||"number"===typeof(null===N||void 0===N?void 0:N.value);return T&&!p?!isNaN(e(N)):T}function e(N){return"number"===typeof N?N:N.value}T.d(p,{e:()=>X,f:()=>U,j:()=>C,n:()=>a,o:()=>A,s:()=>e,u:()=>y})},13484:(N,p,T)=>{"use strict";T.r(p),T.d(p,{SceneInstrumentation:()=>C});var A=T(12190),a=T(12597);class C{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(N){N!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=N,N?(this._onBeforeActiveMeshesEvaluationObserver=this.Lp.onBeforeActiveMeshesEvaluationObservable.add((()=>{A.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Lp.onAfterActiveMeshesEvaluationObservable.add((()=>{A.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Lp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Lp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(N){N!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=N,N?(this._onBeforeRenderTargetsRenderObserver=this.Lp.onBeforeRenderTargetsRenderObservable.add((()=>{A.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Lp.onAfterRenderTargetsRenderObservable.add((()=>{A.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Lp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Lp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(N){N!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=N,N?(this._onBeforeParticlesRenderingObserver=this.Lp.onBeforeParticlesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Lp.onAfterParticlesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Lp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Lp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(N){N!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=N,this.Lp.spriteManagers&&(N?(this._onBeforeSpritesRenderingObserver=this.Lp.onBeforeSpritesRenderingObservable.add((()=>{A.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Lp.onAfterSpritesRenderingObservable.add((()=>{A.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Lp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Lp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(N){N!==this._capturePhysicsTime&&this.Lp.onBeforePhysicsObservable&&(this._capturePhysicsTime=N,N?(this._onBeforePhysicsObserver=this.Lp.onBeforePhysicsObservable.add((()=>{A.Tools.StartPerformanceCounter("ae"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Lp.onAfterPhysicsObservable.add((()=>{A.Tools.EndPerformanceCounter("ae"),this._physicsTime.endMonitoring()}))):(this.Lp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Lp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(N){N!==this._captureAnimationsTime&&(this._captureAnimationsTime=N,N?this._onAfterAnimationsObserver=this.Lp.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Lp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(N){this._captureFrameTime=N}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(N){this._captureInterFrameTime=N}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(N){N!==this._captureRenderTime&&(this._captureRenderTime=N,N?(this._onBeforeDrawPhaseObserver=this.Lp.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),A.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Lp.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter("Main render")}))):(this.Lp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Lp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(N){N!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=N,N?(this._onBeforeCameraRenderObserver=this.Lp.onBeforeCameraRenderObservable.add((N=>{this._cameraRenderTime.beginMonitoring(),A.Tools.StartPerformanceCounter(`Rendering camera ${N.name}`)})),this._onAfterCameraRenderObserver=this.Lp.onAfterCameraRenderObservable.add((N=>{this._cameraRenderTime.endMonitoring(!1),A.Tools.EndPerformanceCounter(`Rendering camera ${N.name}`)}))):(this.Lp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Lp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Lp.getEngine()._drawCalls}constructor(N){this.Lp=N,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new a.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new a.c,this._captureFrameTime=!1,this._frameTime=new a.c,this._captureRenderTime=!1,this._renderTime=new a.c,this._captureInterFrameTime=!1,this._interFrameTime=new a.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new a.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new a.c,this._capturePhysicsTime=!1,this._physicsTime=new a.c,this._captureAnimationsTime=!1,this._animationsTime=new a.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new a.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=N.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(A.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Lp.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=N.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(A.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.tU(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.tU(),this._captureParticlesRenderTime&&this._particlesRenderTime.tU(),this._captureSpritesRenderTime&&this._spritesRenderTime.tU(),this._captureRenderTime&&this._renderTime.tU(),this._captureCameraRenderTime&&this._cameraRenderTime.tU()}))}dispose(){this._disposed||(this.Lp.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Lp.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Lp.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Lp.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Lp.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Lp.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Lp.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Lp.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Lp.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Lp.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Lp.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Lp.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Lp.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Lp.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Lp.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Lp.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Lp.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Lp=null,this._disposed=!0)}}},14063:(N,p,T)=>{"use strict";T.d(p,{c:()=>H});var A=T(12354),a=T(12359),C=T(12371),U=T(12797),X=T(12921),y=T(12978),e=T(12331);U.d.AddNodeConstructor("Light_Type_1",((N,p)=>()=>new H(N,C.xp.Zero(),p)));class H extends y.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(N){this._shadowFrustumSize=N,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(N){this._shadowOrthoScale=N,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(N){this._orthoLeft=N}get orthoRight(){return this._orthoRight}set orthoRight(N){this._orthoRight=N}get orthoTop(){return this._orthoTop}set orthoTop(N){this._orthoTop=N}get orthoBottom(){return this._orthoBottom}set orthoBottom(N){this._orthoBottom=N}constructor(N,p,T){super(N,T),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=p.scale(-1),this.direction=p}getClassName(){return"Ue"}getTypeID(){return X.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(N,p,T){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(N):this._setDefaultAutoExtendShadowProjectionMatrix(N,p,T)}_setDefaultFixedFrustumShadowProjectionMatrix(N){const p=this.KN().activeCamera;p&&C.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:p.yX,void 0!==this.shadowMaxZ?this.shadowMaxZ:p.maxZ,N,this.KN().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(N,p,T){const A=this.KN().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const N=C.xp.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let A=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let U=0;U<T.length;U++){const X=T[U];if(!X)continue;const y=X.getBoundingInfo().boundingBox;for(let T=0;T<y.vectorsWorld.length;T++)C.xp.TransformCoordinatesToRef(y.vectorsWorld[T],p,N),N.x<this._orthoLeft&&(this._orthoLeft=N.x),N.y<this._orthoBottom&&(this._orthoBottom=N.y),N.x>this._orthoRight&&(this._orthoRight=N.x),N.y>this._orthoTop&&(this._orthoTop=N.y),this.autoCalcShadowZBounds&&(N.z<A&&(A=N.z),N.z>a&&(a=N.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=A,this._shadowMaxZ=a)}const a=this._orthoRight-this._orthoLeft,U=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:(null===A||void 0===A?void 0:A.yX)||0,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===A||void 0===A?void 0:A.maxZ)||1e4,e=this.KN().getEngine().BU;C.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-a*this.shadowOrthoScale,this._orthoRight+a*this.shadowOrthoScale,this._orthoBottom-U*this.shadowOrthoScale,this._orthoTop+U*this.shadowOrthoScale,e?y:X,e?X:y,N,this.KN().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,p){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,p),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,p),this)}transferToNodeMaterialEffect(N,p){return this.computeTransformedInformation()?(N.setFloat3(p,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(N.setFloat3(p,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(N){const p=this._scene.getEngine();return!p.BU&&p.isNDCHalfZRange?0:1}getDepthMaxZ(N){const p=this._scene.getEngine();return p.BU&&p.isNDCHalfZRange?0:1}prepareLightSpecificDefines(N,p){N["DIRLIGHT"+p]=!0}}(0,A.b)([(0,a.H)()],H.prototype,"shadowFrustumSize",null),(0,A.b)([(0,a.H)()],H.prototype,"shadowOrthoScale",null),(0,A.b)([(0,a.H)()],H.prototype,"autoUpdateExtends",void 0),(0,A.b)([(0,a.H)()],H.prototype,"autoCalcShadowZBounds",void 0),(0,A.b)([(0,a.H)("orthoLeft")],H.prototype,"_orthoLeft",void 0),(0,A.b)([(0,a.H)("orthoRight")],H.prototype,"_orthoRight",void 0),(0,A.b)([(0,a.H)("orthoTop")],H.prototype,"_orthoTop",void 0),(0,A.b)([(0,a.H)("orthoBottom")],H.prototype,"_orthoBottom",void 0),(0,e.d)("BABYLON.DirectionalLight",H)},14508:(N,p,T)=>{"use strict";T.d(p,{e:()=>H});var A=T(12354),a=T(12359),C=T(12371),U=T(12421),X=T(12797),y=T(12921),e=T(12331);X.d.AddNodeConstructor("Light_Type_3",((N,p)=>()=>new H(N,C.xp.Zero(),p)));class H extends y.c{constructor(N,p,T){super(N,T),this.groundColor=new U.wp(0,0,0),this.direction=p||C.xp.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ee"}setDirectionToTarget(N){return this.direction=C.xp.Normalize(N.Ip(C.xp.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(N,p){const T=C.xp.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",T.x,T.y,T.z,0,p),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.gX),p),this}transferToNodeMaterialEffect(N,p){const T=C.xp.Normalize(this.direction);return N.setFloat3(p,T.x,T.y,T.z),this}HX(){return this._worldMatrix||(this._worldMatrix=C.Matrix.Identity()),this._worldMatrix}getTypeID(){return y.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(N,p){N["HEMILIGHT"+p]=!0}}(0,A.b)([(0,a.j)()],H.prototype,"groundColor",void 0),(0,A.b)([(0,a.E)()],H.prototype,"direction",void 0),(0,e.d)("BABYLON.HemisphericLight",H)},14030:(N,p,T)=>{"use strict";T.d(p,{d:()=>M});var A=T(12354),a=T(12359),C=T(12371),U=T(12797),X=T(12921),y=T(12978),e=T(12352),H=T(12331);U.d.AddNodeConstructor("Light_Type_2",((N,p)=>()=>new M(N,C.xp.Zero(),C.xp.Zero(),0,0,p)));class M extends y.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(N){this._iesProfileTexture!==N&&(this._iesProfileTexture=N,this._iesProfileTexture&&M._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(N){this._angle=N,this._cosHalfAngle=Math.cos(.5*N),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(N){this._innerAngle=N,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(N){this._shadowAngleScale=N,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(N){this._projectionTextureLightNear=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(N){this._projectionTextureLightFar=N,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(N){this._projectionTextureUpDirection=N,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(N){this._projectionTexture!==N&&(this._projectionTexture=N,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(M._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):M._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(N){return void 0!==N.onGeneratedObservable}static _IsTexture(N){return void 0!==N.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(N){this._projectionTextureProjectionLightMatrix=N,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(N,p,T,A,a,U){super(N,U),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=C.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=C.xp.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=C.xp.Zero(),this._projectionTextureViewLightMatrix=C.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=C.Matrix.Zero(),this._projectionTextureScalingMatrix=C.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=p,this.direction=T,this.angle=A,this.exponent=a}getClassName(){return"SpotLight"}getTypeID(){return X.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(N){super._setDirection(N),this._projectionTextureViewLightDirty=!0}_setPosition(N){super._setPosition(N),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(N,p,T){const A=this.KN().activeCamera;if(!A)return;this._shadowAngleScale=this._shadowAngleScale||1;const a=this._shadowAngleScale*this._angle,U=void 0!==this.shadowMinZ?this.shadowMinZ:A.yX,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,y=this.KN().getEngine().BU;C.Matrix.PerspectiveFovLHToRef(a,1,y?X:U,y?U:X,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,y)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),C.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const N=this.projectionTextureLightFar,p=this.projectionTextureLightNear,T=N/(N-p),A=-T*p,a=1/Math.tan(this._angle/2);C.Matrix.FromValuesToRef(a/1,0,0,0,0,a,0,0,0,0,T,1,0,0,A,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof e.c){const N=this._projectionTexture.uScale/2,p=this._projectionTexture.vScale/2;C.Matrix.FromValuesToRef(N,0,0,0,0,p,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(N,p){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),N.setMatrix("textureProjectionMatrix"+p,this._projectionTextureMatrix),N.setTexture("projectionLightTexture"+p,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&N.setTexture("iesLightTexture"+p,this._iesProfileTexture),this}transferToEffect(N,p){let T;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,p),T=C.xp.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,p),T=C.xp.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",T.x,T.y,T.z,this._cosHalfAngle,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,p),this}transferToNodeMaterialEffect(N,p){let T;return T=this.computeTransformedInformation()?C.xp.Normalize(this.transformedDirection):C.xp.Normalize(this.direction),this.KN().useRightHandedSystem?N.setFloat3(p,-T.x,-T.y,-T.z):N.setFloat3(p,T.x,T.y,T.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(N){const p=this._scene.getEngine(),T=void 0!==this.shadowMinZ?this.shadowMinZ:(null===N||void 0===N?void 0:N.yX)??0;return p.BU&&p.isNDCHalfZRange?T:this._scene.getEngine().isNDCHalfZRange?0:T}getDepthMaxZ(N){const p=this._scene.getEngine(),T=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===N||void 0===N?void 0:N.maxZ)??1e4;return p.BU&&p.isNDCHalfZRange?0:T}prepareLightSpecificDefines(N,p){N["SPOTLIGHT"+p]=!0,N["PROJECTEDLIGHTTEXTURE"+p]=!(!this.projectionTexture||!this.projectionTexture.isReady()),N["IESLIGHTTEXTURE"+p]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,A.b)([(0,a.H)()],M.prototype,"angle",null),(0,A.b)([(0,a.H)()],M.prototype,"innerAngle",null),(0,A.b)([(0,a.H)()],M.prototype,"shadowAngleScale",null),(0,A.b)([(0,a.H)()],M.prototype,"exponent",void 0),(0,A.b)([(0,a.H)()],M.prototype,"projectionTextureLightNear",null),(0,A.b)([(0,a.H)()],M.prototype,"projectionTextureLightFar",null),(0,A.b)([(0,a.H)()],M.prototype,"projectionTextureUpDirection",null),(0,A.b)([(0,a.z)("projectedLightTexture")],M.prototype,"_projectionTexture",void 0),(0,H.d)("BABYLON.SpotLight",M)},13761:(N,p,T)=>{"use strict";T.d(p,{b:()=>U,d:()=>C,e:()=>X});const A={},a={};function C(N,p){A[N]=p}function U(N,p){a[N]=p}function X(N){return a[N]?a[N]:null}},13664:(N,p,T)=>{"use strict";T.d(p,{c:()=>K,f:()=>mN});var A,a=T(12190),C=T(12194),U=T(12617),X=T(12231),y=T(12205),e=T(12844),H=T(12240),M=T(12245),b=T(12333),l=T(12270),k=T(12223);!function(N){N[N.Clean=0]="Clean",N[N.Stop=1]="Stop",N[N.Sync=2]="Sync",N[N.NoSync=3]="NoSync"}(A||(A={}));const x=new C.c,I={};let L=!1;function n(){return I[".babylon"]}function w(N,p){const T=I[N];return T||(y.d.Warn("Unable to find a plugin to load "+N+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),p?n():void 0)}function g(N,p,T){let A="Unable to load from "+(N.rawData?"binary data":N.url);return p?A+=`: ${p}`:T&&(A+=`: ${T}`),A}async function P(N,p,T,A,a,C,U,X,y){var e;const M="data:"===(b=N.url).substring(0,5)?b.substring(5):null;var b;if(N.rawData&&!U)throw"When using ArrayBufferView to load data the file extension must be provided.";const L=M||U?"":function(N){const p=N.indexOf("?");-1!==p&&(N=N.substring(0,p));const T=N.lastIndexOf(".");return N.substring(T,N.length).toLowerCase()}(N.url);let g=U?w(U,!0):M?function(N){for(const p in I){const T=I[p].plugin;if(T.canDirectLoad&&T.canDirectLoad(N))return I[p]}return n()}(N.url):w(L,!1);if(!g&&L){if(N.url&&!N.url.startsWith("blob:")){const p=await async function(N,p){const T=p.method||"GET";return await new Promise(((A,a)=>{const C=new k.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const N={};if(p.responseHeaders)for(const T of p.responseHeaders)N[T]=C.getResponseHeader(T)||"";A({response:C.response,headerValues:N})}else a(`Unable to fetch data from ${N}. Error code: ${C.status}`)})),C.open(T,N),C.send()}))}(N.url,{method:"HEAD",responseHeaders:["Content-Type"]}),T=p.headerValues?p.headerValues["Content-Type"]:"";T&&(g=function(N){for(const p in I){const T=I[p];if(T.mimeType===N)return T}}(T))}g||(g=n())}if(!g)throw new Error(`No plugin or fallback for ${U??N.url}`);if(!1===(null===y||void 0===y||null===(e=y[g.plugin.name])||void 0===e?void 0:e.enabled))throw new Error(`The '${g.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(N.rawData&&!g.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(N=>{if(g.plugin.createPlugin){const p=g.plugin.createPlugin(y??{});return p instanceof Promise?(p.then(N).catch((N=>{a("Error instantiating plugin.",N)})),null):(N(p),p)}return N(g.plugin),g.plugin})((y=>{var e;if(!y)throw`The loader plugin corresponding to the '${U}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(x.notifyObservers(y),M&&(y.canDirectLoad&&y.canDirectLoad(N.url)||!(0,H.i)(N.url))){if(y.directLoad){const N=y.directLoad(p,M);N instanceof Promise?N.then((N=>{T(y,N)})).catch((N=>{a("Error in directLoad of _loadData: "+N,N)})):T(y,N)}else T(y,M);return}const b=g.isBinary,k=(N,A)=>{p.X?a("Scene has been disposed"):T(y,N,A)};let I=null,L=!1;null===(e=y.SU)||void 0===e||e.add((()=>{L=!0,I&&(I.abort(),I=null),C()}));const n=()=>{if(L)return;const T=(N,p)=>{a(null===N||void 0===N?void 0:N.statusText,p)};if(!y.loadFile&&N.rawData)throw"Plugin does not support loading ArrayBufferView.";I=y.loadFile?y.loadFile(p,N.rawData||N.file||N.url,N.rootUrl,k,A,b,T,X):p._loadFile(N.file||N.url,k,A,!0,b,T)},w=p.getEngine();let P=w.enableOfflineSupport;if(P){let T=!1;for(const A of p.disableOfflineSupportExceptionRules)if(A.test(N.url)){T=!0;break}P=!T}P&&l.c.OfflineProviderFactory?p.offlineProvider=l.c.OfflineProviderFactory(N.url,n,w.disableManifestCheck):n()}))}function i(N,p){let T,A,C=null,U=null;if(p)if(p.name)T=`file:${p.name}`,A=p.name,C=p;else if(ArrayBuffer.isView(p))T="",A=(0,b.b)(),U=p;else if(p.startsWith("data:"))T=p,A="";else if(N){const C=p;if("/"===C.substring(0,1))return a.Tools.Error("Wrong sceneFilename parameter"),null;T=N+C,A=C}else T=p,A=a.Tools.GetFilename(p),N=a.Tools.GetFolderPath(p);else T=N,A=a.Tools.GetFilename(N),N=a.Tools.GetFolderPath(N);return{url:T,rootUrl:N,name:A,file:C,rawData:U}}function K(N){if("string"===typeof N.extensions){const p=N.extensions;I[p.toLowerCase()]={plugin:N,isBinary:!1}}else{const p=N.extensions,T=Object.keys(p);for(const A of T)I[A.toLowerCase()]={plugin:N,isBinary:p[A].isBinary,mimeType:p[A].mimeType}}}async function F(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.b.LastCreatedScene,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!A)return y.d.Error("No scene available to import mesh to"),null;const l=i(p,T);if(!l)return null;const k={};A.addPendingData(k);const x=()=>{A.removePendingData(k)},I=(N,p)=>{const T=g(l,N,p);U?U(A,T,new M.l(T,M.i.SceneLoaderError,p)):y.d.Error(T),x()},L=C?N=>{try{C(N)}catch(p){I("Error in onProgress callback: "+p,p)}}:void 0,n=(N,p,T,C,U,X,y,e)=>{if(A.importedMeshesFiles.push(l.url),a)try{a(N,p,T,C,U,X,y,e)}catch(H){I("Error in onSuccess callback: "+H,H)}A.removePendingData(k)};return await P(l,A,((p,T,a)=>{if(p.rewriteRootURL&&(l.rootUrl=p.rewriteRootURL(l.rootUrl,a)),p.importMesh){const a=[],C=[],U=[];if(!p.importMesh(N,A,T,l.rootUrl,a,C,U,I))return;A.loadingPluginName=p.name,n(a,C,U,[],[],[],[],[])}else{p.importMeshAsync(N,A,T,l.rootUrl,L,l.name).then((N=>{A.loadingPluginName=p.name,n(N.meshes,N.Ul,N.skeletons,N.animationGroups,N.transformNodes,N.geometries,N.lights,N.spriteManagers)})).catch((N=>{I(N.message,N)}))}}),L,I,x,e,H,b)}async function v(N,p,T,A,a,C,U,X){return await new Promise(((y,e)=>{try{F(N,p,T,A,((N,p,T,A,a,C,U,X)=>{y({meshes:N,Ul:p,skeletons:T,animationGroups:A,transformNodes:a,geometries:C,lights:U,spriteManagers:X})}),a,((N,p,T)=>{e(T||new Error(p))}),C,U,X).catch(e)}catch(M){e(M)}}))}async function W(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.b.LastCreatedEngine,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};T?await R(N,p,new U.c(T),A,C,y,e,H,M):a.Tools.Error("No engine available")}async function z(N,p,T,A,a,C,U){return await new Promise(((X,y)=>{W(N,p,T,(N=>{X(N)}),A,((N,p,T)=>{y(T||new Error(p))}),a,C,U)}))}async function R(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return y.d.Error("No scene available to append to"),null;const l=i(N,p);if(!l)return null;const k={};T.addPendingData(k);const x=()=>{T.removePendingData(k)};e.b.ShowLoadingScreen&&!L&&(L=!0,T.getEngine().displayLoadingUI(),T.executeWhenReady((()=>{T.getEngine().hideLoadingUI(),L=!1})));const I=(N,p)=>{const A=g(l,N,p);C?C(T,A,new M.l(A,M.i.SceneLoaderError,p)):y.d.Error(A),x()},n=a?N=>{try{a(N)}catch(p){I("Error in onProgress callback",p)}}:void 0,w=()=>{if(A)try{A(T)}catch(N){I("Error in onSuccess callback",N)}T.removePendingData(k)};return await P(l,T,((N,p)=>{if(N.load){if(!N.load(T,p,l.rootUrl,I))return;T.loadingPluginName=N.name,w()}else{N.loadAsync(T,p,l.rootUrl,n,l.name).then((()=>{T.loadingPluginName=N.name,w()})).catch((N=>{I(N.message,N)}))}}),n,I,x,U,H,b)}async function J(N,p,T,A,a,C,U){return await new Promise(((X,y)=>{try{R(N,p,T,(N=>{X(N)}),A,((N,p,T)=>{y(T||new Error(p))}),a,C,U).catch(y)}catch(M){y(M)}}))}async function f(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.b.LastCreatedScene,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!T)return y.d.Error("No scene available to load asset container to"),null;const b=i(N,p);if(!b)return null;const l={};T.addPendingData(l);const k=()=>{T.removePendingData(l)},x=(N,p)=>{const A=g(b,N,p);C?C(T,A,new M.l(A,M.i.SceneLoaderError,p)):y.d.Error(A),k()},I=a?N=>{try{a(N)}catch(p){x("Error in onProgress callback",p)}}:void 0,L=N=>{if(A)try{A(N)}catch(p){x("Error in onSuccess callback",p)}T.removePendingData(l)};return await P(b,T,((N,p)=>{if(N.loadAssetContainer){const A=N.loadAssetContainer(T,p,b.rootUrl,x);if(!A)return;A.populateRootNodes(),T.loadingPluginName=N.name,L(A)}else if(N.loadAssetContainerAsync){N.loadAssetContainerAsync(T,p,b.rootUrl,I,b.name).then((p=>{p.populateRootNodes(),T.loadingPluginName=N.name,L(p)})).catch((N=>{x(N.message,N)}))}else x("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),I,x,k,U,e,H)}async function G(N,p,T,A,a,C,U){return await new Promise(((X,y)=>{try{f(N,p,T,(N=>{X(N)}),A,((N,p,T)=>{y(T||new Error(p))}),a,C,U).catch(y)}catch(M){y(M)}}))}async function o(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.b.LastCreatedScene,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!T)return void y.d.Error("No scene available to load animations to");if(A){for(const A of T.animatables)A.reset();T.stopAllAnimations();const N=T.animationGroups.slice();for(const T of N)T.dispose();const p=T.getNodes();for(const T of p)T.animations&&(T.animations=[])}else switch(a){case 0:const N=T.animationGroups.slice();for(const p of N)p.dispose();break;case 1:for(const p of T.animationGroups)p.stop();break;case 2:for(const p of T.animationGroups)p.reset(),p.restart();break;case 3:break;default:return void y.d.Error("Unknown animation group loading mode value '"+a+"'")}const k=T.animatables.length;await f(N,p,T,(N=>{N.mergeAnimationsTo(T,T.animatables.slice(k),C),N.dispose(),T.onAnimationFileImportedObservable.notifyObservers(T),U&&U(T)}),e,H,M,b,l)}async function Z(N,p,T,A,a,C,U,X,y,e){return await new Promise(((H,b)=>{try{o(N,p,T,A,a,C,(N=>{H(N)}),U,((N,p,T)=>{b(T||new Error(p))}),X,y,e).catch(b)}catch(M){b(M)}}))}class mN{static get ForceFullSceneLoadingForIncremental(){return e.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(N){e.b.ForceFullSceneLoadingForIncremental=N}static get ShowLoadingScreen(){return e.b.ShowLoadingScreen}static set ShowLoadingScreen(N){e.b.ShowLoadingScreen=N}static get loggingLevel(){return e.b.loggingLevel}static set loggingLevel(N){e.b.loggingLevel=N}static get CleanBoneMatrixWeights(){return e.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(N){e.b.CleanBoneMatrixWeights=N}static GetDefaultPlugin(){return n()}static GetPluginForExtension(N){var p;return null===(p=w(N,!0))||void 0===p?void 0:p.plugin}static IsPluginForExtensionAvailable(N){return function(N){return!!I[N]}(N)}static RegisterPlugin(N){K(N)}static ImportMesh(N,p,T,A,a,C,U,y,e){F(N,p,T,A,a,C,U,y,e).catch((N=>null===U||void 0===U?void 0:U(X.b.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportMeshAsync(N,p,T,A,a,C,U){return await v(N,p,T,A,a,C,U)}static Load(N,p,T,A,a,C,U,y){W(N,p,T,A,a,C,U,y).catch((N=>null===C||void 0===C?void 0:C(X.b.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAsync(N,p,T,A,a,C){return await z(N,p,T,A,a,C)}static Append(N,p,T,A,a,C,U,y){R(N,p,T,A,a,C,U,y).catch((N=>null===C||void 0===C?void 0:C(T??X.b.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async AppendAsync(N,p,T,A,a,C){return await J(N,p,T,A,a,C)}static LoadAssetContainer(N,p,T,A,a,C,U,y){f(N,p,T,A,a,C,U,y).catch((N=>null===C||void 0===C?void 0:C(T??X.b.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async LoadAssetContainerAsync(N,p,T,A,a,C){return await G(N,p,T,A,a,C)}static ImportAnimations(N,p,T,A,a,C,U,y,e,H,M){o(N,p,T,A,a,C,U,y,e,H,M).catch((N=>null===e||void 0===e?void 0:e(T??X.b.LastCreatedScene,null===N||void 0===N?void 0:N.message,N)))}static async ImportAnimationsAsync(N,p,T,A,a,C,U,X,y,e,H){return await Z(N,p,T,A,a,C,X,e,H)}}mN.NO_LOGGING=0,mN.MINIMAL_LOGGING=1,mN.SUMMARY_LOGGING=2,mN.DETAILED_LOGGING=3,mN.OnPluginActivatedObservable=x},14047:(N,p,T)=>{"use strict";T.d(p,{d:()=>b});var A=T(12354),a=T(12359),C=T(12190),U=T(12371),X=T(12398),y=T(12352),e=T(12331),H=T(12194),M=T(12409);T(14051);class b extends X.c{set boundingBoxSize(N){if(this._boundingBoxSize&&this._boundingBoxSize.equals(N))return;this._boundingBoxSize=N;const p=this.KN();p&&p.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(N){this._rotationY=N,this.setReflectionTextureMatrix(U.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(N,p,T){let A="";for(const a of N)A+=a;return new b(A,p,null,T,N)}static CreateFromPrefilteredData(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=p.useDelayedTextureLoading;p.useDelayedTextureLoading=!1;const C=new b(N,p,null,!1,null,null,null,void 0,!0,T,A);return p.useDelayedTextureLoading=a,C}constructor(N,p){var T;let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,M=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]&&arguments[10],x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,L=arguments.length>13?arguments[13]:void 0,n=arguments.length>14?arguments[14]:void 0;super(p),this.onLoadObservable=new H.c,this.boundingBoxPosition=U.xp.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new U.Matrix,this._buffer=null,this.name=N,this.url=N,this._noMipmap=a,this.XX=!1,this.isCube=!0,this._textureMatrix=U.Matrix.Identity(),this.coordinatesMode=y.c.CUBIC_MODE;let w=null,g=null;null===A||Array.isArray(A)?(this._noMipmap=a,this._format=M,this._createPolynomials=k,w=A,this._loaderOptions=L,this._useSRGBBuffer=n,this._lodScale=x,this._lodOffset=I):(w=A.extensions??null,this._noMipmap=A.noMipmap??!1,C=A.files??null,g=A.buffer??null,this._format=A.format??5,b=A.prefiltered??!1,l=A.forcedExtension??null,this._createPolynomials=A.createPolynomials??!1,this._lodScale=A.lodScale??.8,this._lodOffset=A.lodOffset??0,this._loaderOptions=A.loaderOptions,this._useSRGBBuffer=A.useSRGBBuffer,X=A.B??null,e=A.onError??null),(N||C)&&this.updateURL(N,l,X,b,e,w,null===(T=this.KN())||void 0===T?void 0:T.useDelayedTextureLoading,C,g)}getClassName(){return"CubeTexture"}updateURL(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=N),this.url=N,p&&(this._forcedExtension=p);const e=N.lastIndexOf("."),H=p||(e>-1?N.substring(e).toLowerCase():""),M=0===H.indexOf(".dds"),b=0===H.indexOf(".env"),l=0===H.indexOf(".basis");if(b?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=A,A&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(l||b||M||C||(C=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,C){for(let p=0;p<C.length;p++)this._files.push(N+C[p]);this._extensions=C}this._buffer=y,U?(this.delayLoadState=4,this._delayedOnLoad=T,this._delayedOnError=a):this._loadTexture(T,a)}delayLoad(N){4===this.delayLoadState&&(N&&(this._forcedExtension=N),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(N){var p,T;if(N.updateFlag===this._textureMatrix.updateFlag)return;N.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(T=this.KN())||void 0===T||T.markAllMaterialsAsDirty(1,(N=>-1!==N.getActiveTextures().indexOf(this))));if(this._textureMatrix=N,null===(p=this.KN())||void 0===p||!p.useRightHandedSystem)return;const A=U.TmpVectors.xp[0],a=U.TmpVectors.Quaternion[0],C=U.TmpVectors.xp[1];this._textureMatrix.decompose(A,a,C),a.z*=-1,a.w*=-1,U.Matrix.ComposeToRef(A,a,C,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var N;return null!==(N=this.KN())&&void 0!==N&&N.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this.KN(),A=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const a=()=>{var p;(this.onLoadObservable.notifyObservers(this),A)&&(A.dispose(),null===(p=this.KN())||void 0===p||p.markAllMaterialsAsDirty(1));N&&N()},U=(N,T)=>{this._loadingError=!0,this._errorObject={message:N,exception:T},p&&p(N,T),y.c.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?C.Tools.SetImmediate((()=>a())):this._texture.onLoadedObservable.add((()=>a())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,T,this._lodScale,this._lodOffset,N,U,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,T,this._files,this._noMipmap,N,U,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(N,p,T){const A=M.e.Parse((()=>{let A=!1;return N.prefiltered&&(A=N.prefiltered),new b(T+(N.url??N.name),p,N.extensions,!1,N.files||null,null,null,void 0,A,N.forcedExtension)}),N,p);if(N.boundingBoxPosition&&(A.boundingBoxPosition=U.xp.gp(N.boundingBoxPosition)),N.boundingBoxSize&&(A.boundingBoxSize=U.xp.gp(N.boundingBoxSize)),N.animations)for(let a=0;a<N.animations.length;a++){const p=N.animations[a],T=(0,e.c)("BABYLON.Animation");T&&A.animations.push(T.Parse(p))}return A}clone(){let N=0;const p=M.e.Clone((()=>{const p=new b(this.url,this.KN()||this._getEngine(),this._extensions,this._noMipmap,this._files);return N=p.uniqueId,p}),this);return p.uniqueId=N,p}}(0,A.b)([(0,a.H)()],b.prototype,"url",void 0),(0,A.b)([(0,a.E)()],b.prototype,"boundingBoxPosition",void 0),(0,A.b)([(0,a.E)()],b.prototype,"boundingBoxSize",null),(0,A.b)([(0,a.H)("rotationY")],b.prototype,"rotationY",null),(0,A.b)([(0,a.H)("files")],b.prototype,"_files",void 0),(0,A.b)([(0,a.H)("forcedExtension")],b.prototype,"_forcedExtension",void 0),(0,A.b)([(0,a.H)("extensions")],b.prototype,"_extensions",void 0),(0,A.b)([(0,a.s)("textureMatrix")],b.prototype,"_textureMatrix",void 0),(0,A.b)([(0,a.s)("textureMatrixRefraction")],b.prototype,"_textureMatrixRefraction",void 0),y.c._CubeTextureParser=b.Parse,(0,e.d)("BABYLON.CubeTexture",b)},14520:(N,p,T)=>{"use strict";T.d(p,{e:()=>y});var A=T(12205),a=T(12352),C=T(12341),U=T(12511),X=T(12302);U.ThinEngine.prototype.createDynamicTexture=function(N,p,T,A){const a=new X.d(this,4);return a.baseWidth=N,a.baseHeight=p,T&&(N=this.needPOTTextures?(0,C.e)(N,this._caps.maxTextureSize):N,p=this.needPOTTextures?(0,C.e)(p,this._caps.maxTextureSize):p),a.width=N,a.height=p,a.isReady=!1,a.generateMipMaps=T,a.samplingMode=A,this.updateTextureSamplingMode(A,a),this._internalTexturesCache.push(a),a},U.ThinEngine.prototype.updateDynamicTexture=function(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!N)return;const U=this._gl,X=U.TEXTURE_2D,y=this._bindTextureDirectly(X,N,!0,C);this._unpackFlipY(void 0===T?N.invertY:T),A&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const e=this._getWebGLTextureType(N.type),H=this._getInternalFormat(a||N.format),M=this._getRGBABufferInternalSizedFormat(N.type,H);U.texImage2D(X,0,M,H,e,p),N.generateMipMaps&&U.generateMipmap(X),y||this._bindTextureDirectly(X,null),A&&U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),a&&(N.format=a),N._dynamicTextureSource=p,N._premulAlpha=A,N.invertY=T||!1,N.isReady=!0};class y extends a.c{constructor(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const y=!T||T._isScene;super(null,y?T:null===T||void 0===T?void 0:T.Lp,y?!A:T,X,C,void 0,void 0,void 0,void 0,U),this.name=N,this.wrapU=a.c.CLAMP_ADDRESSMODE,this.wrapV=a.c.CLAMP_ADDRESSMODE,this._generateMipMaps=A;const e=this._getEngine();if(!e)return;if(p.getContext)this._canvas=p,this._ownCanvas=!1,this._texture=e.createDynamicTexture(this._canvas.width,this._canvas.height,A,C);else{this._canvas=e.createCanvas(1,1),this._ownCanvas=!0;const N=p;N.width||0===N.width?this._texture=e.createDynamicTexture(N.width,N.height,A,C):this._texture=e.createDynamicTexture(p,p,A,C)}const H=this.getSize();this._canvas.width!==H.width&&(this._canvas.width=H.width),this._canvas.height!==H.height&&(this._canvas.height=H.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(N){this._canvas.width=N.width,this._canvas.height=N.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(N.width,N.height,this._generateMipMaps,this.samplingMode)}scale(N){const p=this.getSize();p.width*=N,p.height*=N,this._recreate(p)}scaleTo(N,p){const T=this.getSize();T.width=N,T.height=p,this._recreate(T)}getContext(){return this._context}clear(N){const p=this.getSize();N&&(this._context.fillStyle=N),this._context.clearRect(0,0,p.width,p.height)}update(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===N||N,p,this._format||void 0,void 0,T)}drawText(N,p,T,A,a,C,U){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const y=this.getSize();if(C&&(this._context.fillStyle=C,this._context.fillRect(0,0,y.width,y.height)),this._context.font=A,null===p||void 0===p){const T=this._context.measureText(N);p=(y.width-T.width)/2}if(null===T||void 0===T){const N=parseInt(A.replace(/\D/g,""));T=y.height/2+N/3.65}this._context.fillStyle=a||"",this._context.fillText(N,p,T),X&&this.update(U)}dispose(){var N,p;(super.dispose(),this._ownCanvas)&&(null===(N=this._canvas)||void 0===N||null===(p=N.remove)||void 0===p||p.call(N));this._canvas=null,this._context=null}clone(){const N=this.KN();if(!N)return this;const p=this.getSize(),T=new y(this.name,p,N,this._generateMipMaps);return T.XX=this.XX,T.level=this.level,T.wrapU=this.wrapU,T.wrapV=this.wrapV,T}serialize(){const N=this.KN();N&&!N.isReady()&&A.d.Warn("The scene must be ready before serializing the dynamic texture");const p=super.serialize();return y._IsCanvasElement(this._canvas)&&(p.base64String=this._canvas.toDataURL()),p.invertY=this._invertY,p.samplingMode=this.samplingMode,p}static _IsCanvasElement(N){return void 0!==N.toDataURL}_rebuild(){this.update()}}},13955:(N,p,T)=>{"use strict";T.d(p,{c:()=>a});var A=T(12352);class a extends A.c{get depth(){return this._depth}constructor(N,p,T,a,C,U){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:A.c.TRILINEAR_SAMPLINGMODE,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10?arguments[10]:void 0;super(null,U,!X,y),this.format=C,this._texture=U.getEngine().createRawTexture2DArray(N,p,T,a,C,X,y,e,null,H,M),this._depth=a,this.is2DArray=!0}update(N){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,N,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(N,p,T,A,C){return new a(N,p,T,A,5,C,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13779:(N,p,T)=>{"use strict";T.d(p,{b:()=>X,d:()=>y,h:()=>C,j:()=>U});var A=T(12390),a=T(12371);function C(N,p){return`{X: ${N.x.toFixed(p)} Y: ${N.y.toFixed(p)}}`}function U(N,p){return`{X: ${N._x.toFixed(p)} Y: ${N._y.toFixed(p)} Z: ${N._z.toFixed(p)}}`}function X(N,p){return 2*Math.acos((0,A.Clamp)(a.Quaternion.Dot(N,p)))}function y(N,p){const T=new a.Quaternion;return function(N,p,T){const C=a.xp.Cross(N,p),U=Math.acos((0,A.Clamp)(a.xp.Dot(N,p),-1,1));a.Quaternion.RotationAxisToRef(C,U,T)}(N,p,T),T}},13609:(N,p,T)=>{"use strict";T.d(p,{d:()=>e});var A=T(12371),a=T(12421),C=T(12833),U=T(12813),X=T(12433);T(13617);function y(N){let p=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const T=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],C=[];let y=[];const e=N.width||N.size||1,H=N.height||N.size||1,M=N.depth||N.size||1,b=N.wrap||!1;let l=void 0===N.topBaseAt?1:N.topBaseAt,k=void 0===N.bottomBaseAt?0:N.bottomBaseAt;l=(l+4)%4,k=(k+4)%4;let x=[2,0,3,1][l],I=[2,0,1,3][k],L=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(b){p=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],L=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let N=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],T=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const A=[17,18,19,16],a=[22,23,20,21];for(;x>0;)N.unshift(N.pop()),A.unshift(A.pop()),x--;for(;I>0;)T.unshift(T.pop()),a.unshift(a.pop()),I--;N=N.flat(),T=T.flat(),L=L.concat(N).concat(T),p.push(A[0],A[2],A[3],A[0],A[1],A[2]),p.push(a[0],a[2],a[3],a[0],a[1],a[2])}const n=[e/2,H/2,M/2];y=L.reduce(((N,p,T)=>N.concat(p*n[T%3])),[]);const w=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,g=N.faceUV||new Array(6),P=N.faceColors,i=[];for(let U=0;U<6;U++)void 0===g[U]&&(g[U]=new A.Vector4(0,0,1,1)),P&&void 0===P[U]&&(P[U]=new a.LX(1,1,1,1));for(let A=0;A<6;A++)if(C.push(g[A].z,X.d?1-g[A].w:g[A].w),C.push(g[A].x,X.d?1-g[A].w:g[A].w),C.push(g[A].x,X.d?1-g[A].y:g[A].y),C.push(g[A].z,X.d?1-g[A].y:g[A].y),P)for(let N=0;N<4;N++)i.push(P[A].r,P[A].g,P[A].b,P[A].a);U.c._ComputeSides(w,y,p,T,C,N.frontUVs,N.backUVs);const K=new U.c;if(K.indices=p,K.vN=y,K.WN=T,K.RN=C,P){const N=w===U.c.DOUBLESIDE?i.concat(i):i;K.zN=N}return K}function e(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new C.d(N,T);p.sideOrientation=C.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return y(p).fN(A,p.updatable),A}U.c.CreateBox=y,C.d.CreateBox=function(N,p){return e(N,{size:p,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13767:(N,p,T)=>{"use strict";T.d(p,{d:()=>X});var A=T(12833),a=T(12813),C=T(12433);function U(N){const p=[],T=[],A=[],U=[],X=N.radius||.5,y=N.tessellation||64,e=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,H=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE;p.push(0,0,0),U.push(.5,.5);const M=2*Math.PI*e,b=1===e?M/y:M/(y-1);let l=0;for(let a=0;a<y;a++){const N=Math.cos(l),T=Math.sin(l),A=(N+1)/2,a=(1-T)/2;p.push(X*N,X*T,0),U.push(A,C.d?1-a:a),l+=b}1===e&&(p.push(p[3],p[4],p[5]),U.push(U[2],C.d?1-U[3]:U[3]));const k=p.length/3;for(let a=1;a<k-1;a++)T.push(a+1,0,a);a.c.ComputeNormals(p,T,A),a.c._ComputeSides(H,p,T,A,U,N.frontUVs,N.backUVs);const x=new a.c;return x.indices=T,x.vN=p,x.WN=A,x.RN=U,x}function X(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.d(N,T);p.sideOrientation=A.d._GetDefaultSideOrientation(p.sideOrientation),a._originalBuilderSideOrientation=p.sideOrientation;return U(p).fN(a,p.updatable),a}a.c.CreateDisc=U,A.d.CreateDisc=function(N,p,T){return X(N,{radius:p,tessellation:T,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13617:(N,p,T)=>{"use strict";T.d(p,{h:()=>I,e:()=>n,i:()=>L});var A=T(12371),a=T(12421),C=T(12833),U=T(12813),X=T(12451);C.d._GroundMeshParser=(N,p)=>y.Parse(N,p);class y extends C.d{constructor(N,p){super(N,p),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=N,this._subdivisionsY=N,this.subdivide(N);const T=this;T.createOrUpdateSubmeshesOctree&&T.createOrUpdateSubmeshesOctree(p)}getHeightAtCoordinates(N,p){const T=this.getWorldMatrix(),a=A.TmpVectors.Matrix[5];T.invertToRef(a);const C=A.TmpVectors.xp[8];if(A.xp.TransformCoordinatesFromFloatsToRef(N,0,p,a,C),N=C.x,p=C.z,N<this._minX||N>=this._maxX||p<=this._minZ||p>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const U=this._getFacetAt(N,p),X=-(U.x*N+U.z*p+U.w)/U.y;return A.xp.TransformCoordinatesFromFloatsToRef(0,X,0,T,C),C.y}getNormalAtCoordinates(N,p){const T=new A.xp(0,1,0);return this.getNormalAtCoordinatesToRef(N,p,T),T}getNormalAtCoordinatesToRef(N,p,T){const a=this.getWorldMatrix(),C=A.TmpVectors.Matrix[5];a.invertToRef(C);const U=A.TmpVectors.xp[8];if(A.xp.TransformCoordinatesFromFloatsToRef(N,0,p,C,U),N=U.x,p=U.z,N<this._minX||N>this._maxX||p<this._minZ||p>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(N,p);return A.xp.TransformNormalFromFloatsToRef(X.x,X.y,X.z,a,T),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(N,p){const T=Math.floor((N+this._maxX)*this._subdivisionsX/this._width),A=Math.floor(-(p+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),a=this._heightQuads[A*this._subdivisionsX+T];let C;return C=p<a.slope.x*N+a.slope.y?a.facet1:a.facet2,C}_initHeightQuads(){const N=this._subdivisionsX,p=this._subdivisionsY;this._heightQuads=[];for(let T=0;T<p;T++)for(let p=0;p<N;p++){const a={slope:A.Vector2.Zero(),facet1:new A.Vector4(0,0,0,0),facet2:new A.Vector4(0,0,0,0)};this._heightQuads[T*N+p]=a}return this}_computeHeightQuads(){const N=this.getVerticesData(X.f.PositionKind);if(!N)return this;const p=A.TmpVectors.xp[3],T=A.TmpVectors.xp[2],a=A.TmpVectors.xp[1],C=A.TmpVectors.xp[0],U=A.TmpVectors.xp[4],y=A.TmpVectors.xp[5],e=A.TmpVectors.xp[6],H=A.TmpVectors.xp[7],M=A.TmpVectors.xp[8];let b=0,l=0,k=0,x=0,I=0,L=0,n=0;const w=this._subdivisionsX,g=this._subdivisionsY;for(let X=0;X<g;X++)for(let g=0;g<w;g++){b=3*g,l=X*(w+1)*3,k=(X+1)*(w+1)*3,p.x=N[l+b],p.y=N[l+b+1],p.z=N[l+b+2],T.x=N[l+b+3],T.y=N[l+b+4],T.z=N[l+b+5],a.x=N[k+b],a.y=N[k+b+1],a.z=N[k+b+2],C.x=N[k+b+3],C.y=N[k+b+4],C.z=N[k+b+5],x=(C.z-p.z)/(C.x-p.x),I=p.z-x*p.x,T.subtractToRef(p,U),a.subtractToRef(p,y),C.subtractToRef(p,e),A.xp.CrossToRef(e,y,H),A.xp.CrossToRef(U,e,M),H.normalize(),M.normalize(),L=-(H.x*p.x+H.y*p.y+H.z*p.z),n=-(M.x*T.x+M.y*T.y+M.z*T.z);const P=this._heightQuads[X*w+g];P.slope.kX(x,I),P.facet1.kX(H.x,H.y,H.z,L),P.facet2.kX(M.x,M.y,M.z,n)}return this}serialize(N){super.serialize(N),N.subdivisionsX=this._subdivisionsX,N.subdivisionsY=this._subdivisionsY,N.minX=this._minX,N.maxX=this._maxX,N.yX=this._minZ,N.maxZ=this._maxZ,N.width=this._width,N.height=this._height}static Parse(N,p){const T=new y(N.name,p);return T._subdivisionsX=N.subdivisionsX||1,T._subdivisionsY=N.subdivisionsY||1,T._minX=N.minX,T._maxX=N.maxX,T._minZ=N.yX,T._maxZ=N.maxZ,T._width=N.width,T._height=N.height,T}}var e=T(12190),H=T(12231),M=T(12376),b=T(12433);function l(N){const p=[],T=[],a=[],C=[];let X,y;const e=N.width||N.size||1,H=N.height||N.size||1,M=0|(N.subdivisionsX||N.subdivisions||1),l=0|(N.subdivisionsY||N.subdivisions||1);for(X=0;X<=l;X++)for(y=0;y<=M;y++){const N=new A.xp(y*e/M-e/2,0,(l-X)*H/l-H/2),p=new A.xp(0,1,0);T.push(N.x,N.y,N.z),a.push(p.x,p.y,p.z),C.push(y/M,b.d?X/l:1-X/l)}for(X=0;X<l;X++)for(y=0;y<M;y++)p.push(y+1+(X+1)*(M+1)),p.push(y+1+X*(M+1)),p.push(y+X*(M+1)),p.push(y+(X+1)*(M+1)),p.push(y+1+(X+1)*(M+1)),p.push(y+X*(M+1));const k=new U.c;return k.indices=p,k.vN=T,k.WN=a,k.RN=C,k}function k(N){const p=void 0!==N.xmin&&null!==N.xmin?N.xmin:-1,T=void 0!==N.zmin&&null!==N.zmin?N.zmin:-1,a=void 0!==N.xmax&&null!==N.xmax?N.xmax:1,C=void 0!==N.zmax&&null!==N.zmax?N.zmax:1,X=N.subdivisions||{w:1,h:1},y=N.precision||{w:1,h:1},e=[],H=[],M=[],b=[];let l,k,x,I;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,y.w=y.w<1?1:y.w,y.h=y.h<1?1:y.h;const L=(a-p)/X.w,n=(C-T)/X.h;function w(N,p,T,a){const C=H.length/3,U=y.w+1;for(l=0;l<y.h;l++)for(k=0;k<y.w;k++){const N=[C+k+l*U,C+(k+1)+l*U,C+(k+1)+(l+1)*U,C+k+(l+1)*U];e.push(N[1]),e.push(N[2]),e.push(N[3]),e.push(N[0]),e.push(N[1]),e.push(N[3])}const X=A.xp.Zero(),x=new A.xp(0,1,0);for(l=0;l<=y.h;l++)for(X.z=l*(a-p)/y.h+p,k=0;k<=y.w;k++)X.x=k*(T-N)/y.w+N,X.y=0,H.push(X.x,X.y,X.z),M.push(x.x,x.y,x.z),b.push(k/y.w,l/y.h)}for(x=0;x<X.h;x++)for(I=0;I<X.w;I++)w(p+I*L,T+x*n,p+(I+1)*L,T+(x+1)*n);const g=new U.c;return g.indices=e,g.vN=H,g.WN=M,g.RN=b,g}function x(N){const p=[],T=[],C=[],X=[];let y,e;const H=N.colorFilter||new a.wp(.3,.59,.11),b=N.alphaFilter||0;let l=!1;if(N.minHeight>N.maxHeight){l=!0;const p=N.maxHeight;N.maxHeight=N.minHeight,N.minHeight=p}for(y=0;y<=N.subdivisions;y++)for(e=0;e<=N.subdivisions;e++){const p=new A.xp(e*N.width/N.subdivisions-N.width/2,0,(N.subdivisions-y)*N.height/N.subdivisions-N.height/2),a=4*(((p.x+N.width/2)/N.width*(N.bufferWidth-1)|0)+((1-(p.z+N.height/2)/N.height)*(N.bufferHeight-1)|0)*N.bufferWidth);let U=N.buffer[a]/255,k=N.buffer[a+1]/255,x=N.buffer[a+2]/255;const I=N.buffer[a+3]/255;l&&(U=1-U,k=1-k,x=1-x);const L=U*H.r+k*H.g+x*H.b;p.y=I>=b?N.minHeight+(N.maxHeight-N.minHeight)*L:N.minHeight-M.b,N.heightBuffer&&(N.heightBuffer[y*(N.subdivisions+1)+e]=p.y),T.push(p.x,p.y,p.z),C.push(0,0,0),X.push(e/N.subdivisions,1-y/N.subdivisions)}for(y=0;y<N.subdivisions;y++)for(e=0;e<N.subdivisions;e++){const A=e+1+(y+1)*(N.subdivisions+1),a=e+1+y*(N.subdivisions+1),C=e+y*(N.subdivisions+1),U=e+(y+1)*(N.subdivisions+1),X=T[3*A+1]>=N.minHeight,H=T[3*a+1]>=N.minHeight,M=T[3*C+1]>=N.minHeight;X&&H&&M&&(p.push(A),p.push(a),p.push(C));T[3*U+1]>=N.minHeight&&X&&M&&(p.push(U),p.push(A),p.push(C))}U.c.ComputeNormals(T,p,C);const k=new U.c;return k.indices=p,k.vN=T,k.WN=C,k.RN=X,k}function I(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const T=new y(N,arguments.length>2?arguments[2]:void 0);T._setReady(!1),T._subdivisionsX=p.subdivisionsX||p.subdivisions||1,T._subdivisionsY=p.subdivisionsY||p.subdivisions||1,T._width=p.width||1,T._height=p.height||1,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ;return l(p).fN(T,p.updatable),T._setReady(!0),T}function L(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new C.d(N,T);return k(p).fN(A,p.updatable),A}function n(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=T.width||10,U=T.height||10,X=T.subdivisions||1,M=T.minHeight||0,b=T.maxHeight||1,l=T.colorFilter||new a.wp(.3,.59,.11),k=T.alphaFilter||0,I=T.updatable,L=T.onReady;A=A||H.b.LastCreatedScene;const n=new y(N,A);let w;n._subdivisionsX=X,n._subdivisionsY=X,n._width=C,n._height=U,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,n._setReady(!1),T.passHeightBufferInCallback&&(w=new Float32Array((X+1)*(X+1)));const g=(N,p,T)=>{x({width:C,height:U,subdivisions:X,minHeight:M,maxHeight:b,colorFilter:l,buffer:N,bufferWidth:p,bufferHeight:T,alphaFilter:k,heightBuffer:w}).fN(n,I),L&&L(n,w),n._setReady(!0)};if("string"===typeof p){const N=N=>{var p;const T=N.width,a=N.height;if(A.X)return;const C=null===(p=A)||void 0===p?void 0:p.getEngine().resizeImageBitmap(N,T,a);g(C,T,a)};e.Tools.LoadImage(p,N,T.onError?T.onError:()=>{},A.offlineProvider)}else g(p.data,p.width,p.height);return n}U.c.CreateGround=l,U.c.CreateTiledGround=k,U.c.CreateGroundFromHeightMap=x,C.d.CreateGround=(N,p,T,A,a,C)=>I(N,{width:p,height:T,subdivisions:A,updatable:C},a),C.d.CreateTiledGround=(N,p,T,A,a,C,U,X,y)=>L(N,{xmin:p,zmin:T,xmax:A,zmax:a,subdivisions:C,precision:U,updatable:y},X),C.d.CreateGroundFromHeightMap=(N,p,T,A,a,C,U,X,y,e,H)=>n(N,p,{width:T,height:A,subdivisions:a,minHeight:C,maxHeight:U,updatable:y,onReady:e,alphaFilter:H},X)},14242:(N,p,T)=>{"use strict";T.d(p,{e:()=>l,i:()=>M,k:()=>b});var A=T(12371),a=T(12833),C=T(12813),U=T(12930),X=T(12451),y=T(12205);function e(N){const p=[],T=[],A=N.lines,a=N.zN,U=[];let X=0;for(let C=0;C<A.length;C++){const N=A[C];for(let A=0;A<N.length;A++){const{x:y,y:e,z:H}=N[A];if(T.push(y,e,H),a){const N=a[C],{r:p,g:T,b:X,a:y}=N[A];U.push(p,T,X,y)}A>0&&(p.push(X-1),p.push(X)),X++}}const y=new C.c;return y.indices=p,y.vN=T,a&&(y.zN=U),y}function H(N){const p=N.dashSize||3,T=N.gapSize||1,a=N.dashNb||200,U=N.points,X=[],y=[],e=A.xp.Zero();let H=0,M=0,b=0,l=0,k=0,x=0,I=0;for(I=0;I<U.length-1;I++)U[I+1].subtractToRef(U[I],e),H+=e.length();for(b=H/a,l=p*b/(p+T),I=0;I<U.length-1;I++){U[I+1].subtractToRef(U[I],e),M=Math.floor(e.length()/b),e.normalize();for(let N=0;N<M;N++)k=b*N,X.push(U[I].x+k*e.x,U[I].y+k*e.y,U[I].z+k*e.z),X.push(U[I].x+(k+l)*e.x,U[I].y+(k+l)*e.y,U[I].z+(k+l)*e.z),y.push(x,x+1),x+=2}const L=new C.c;return L.vN=X,L.indices=y,L}function M(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=p.instance,a=p.lines,C=p.zN;if(A){const N=A.getVerticesData(X.f.PositionKind);let p,T;C&&(p=A.getVerticesData(X.f.ColorKind));let U=0,y=0;for(let A=0;A<a.length;A++){const X=a[A];for(let a=0;a<X.length;a++)N[U]=X[a].x,N[U+1]=X[a].y,N[U+2]=X[a].z,C&&p&&(T=C[A],p[y]=T[a].r,p[y+1]=T[a].g,p[y+2]=T[a].b,p[y+3]=T[a].a,y+=4),U+=3}return A.updateVerticesData(X.f.PositionKind,N,!1,!1),C&&p&&A.updateVerticesData(X.f.ColorKind,p,!1,!1),A.refreshBoundingInfo(),A}const y=!!C,H=new U.b(N,T,null,void 0,void 0,y,p.useVertexAlpha,p.material);return e(p).fN(H,p.updatable),H}function b(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=p.zN?[p.zN]:null;return M(N,{lines:[p.points],updatable:p.updatable,instance:p.instance,zN:A,useVertexAlpha:p.useVertexAlpha,material:p.material},T)}function l(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=p.points,X=p.instance,e=p.gapSize||1,M=p.dashSize||3;if(X){const N=N=>{const p=A.xp.Zero(),T=N.length/6;let a=0,U=0,y=0,e=0,H=0,M=0,b=0,l=0;for(b=0;b<C.length-1;b++)C[b+1].subtractToRef(C[b],p),a+=p.length();y=a/T;const k=X._creationDataStorage.dashSize;for(e=k*y/(k+X._creationDataStorage.gapSize),b=0;b<C.length-1;b++)for(C[b+1].subtractToRef(C[b],p),U=Math.floor(p.length()/y),p.normalize(),l=0;l<U&&M<N.length;)H=y*l,N[M]=C[b].x+H*p.x,N[M+1]=C[b].y+H*p.y,N[M+2]=C[b].z+H*p.z,N[M+3]=C[b].x+(H+e)*p.x,N[M+4]=C[b].y+(H+e)*p.y,N[M+5]=C[b].z+(H+e)*p.z,M+=6,l++;for(;M<N.length;)N[M]=C[b].x,N[M+1]=C[b].y,N[M+2]=C[b].z,M+=3};return(p.dashNb||p.dashSize||p.gapSize||p.useVertexAlpha||p.material)&&y.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),X.updateMeshPositions(N,!1),X}const b=new U.b(N,T,null,void 0,void 0,void 0,p.useVertexAlpha,p.material);return H(p).fN(b,p.updatable),b._creationDataStorage=new a.h,b._creationDataStorage.dashSize=M,b._creationDataStorage.gapSize=e,b}C.c.CreateLineSystem=e,C.c.CreateDashedLines=H,a.d.fe=function(N,p){return b(N,{points:p,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},a.d.CreateDashedLines=function(N,p,T,A,a){return l(N,{points:p,dashSize:T,gapSize:A,dashNb:a,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13666:(N,p,T)=>{"use strict";T.d(p,{d:()=>X,e:()=>y});var A=T(12833),a=T(12813),C=T(12433);function U(N){const p=[],T=[],A=[],U=[],X=void 0!==N.width?N.width:void 0!==N.size?N.size:1,y=void 0!==N.height?N.height:void 0!==N.size?N.size:1,e=0===N.sideOrientation?0:N.sideOrientation||a.c.DEFAULTSIDE,H=X/2,M=y/2;T.push(-H,-M,0),A.push(0,0,-1),U.push(0,C.d?1:0),T.push(H,-M,0),A.push(0,0,-1),U.push(1,C.d?1:0),T.push(H,M,0),A.push(0,0,-1),U.push(1,C.d?0:1),T.push(-H,M,0),A.push(0,0,-1),U.push(0,C.d?0:1),p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),a.c._ComputeSides(e,T,p,A,U,N.frontUVs,N.backUVs);const b=new a.c;return b.indices=p,b.vN=T,b.WN=A,b.RN=U,b}function X(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new A.d(N,T);p.sideOrientation=A.d._GetDefaultSideOrientation(p.sideOrientation),a._originalBuilderSideOrientation=p.sideOrientation;return U(p).fN(a,p.updatable),p.sourcePlane&&(a.translate(p.sourcePlane.normal,-p.sourcePlane.d),a.setDirection(p.sourcePlane.normal.scale(-1))),a}const y={Ye:X};a.c.Ye=U,A.d.Ye=(N,p,T,A,a)=>X(N,{size:p,width:p,height:p,sideOrientation:a,updatable:A},T)},13753:(N,p,T)=>{"use strict";T.d(p,{e:()=>y});var A=T(12371),a=T(12833),C=T(12813),U=T(12433);function X(N){const p=0|(N.segments||32),T=N.diameterX||N.diameter||1,a=N.diameterY||N.diameter||1,X=N.diameterZ||N.diameter||1,y=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,e=N.slice&&N.slice<=0?1:N.slice||1,H=0===N.sideOrientation?0:N.sideOrientation||C.c.DEFAULTSIDE,M=!!N.dedupTopBottomIndices,b=new A.xp(T/2,a/2,X/2),l=2+p,k=2*l,x=[],I=[],L=[],n=[];for(let C=0;C<=l;C++){const N=C/l,p=N*Math.PI*e;for(let T=0;T<=k;T++){const a=T/k,C=a*Math.PI*2*y,X=A.Matrix.RotationZ(-p),e=A.Matrix.RotationY(C),H=A.xp.TransformCoordinates(A.xp.Up(),X),M=A.xp.TransformCoordinates(H,e),l=M.multiply(b),x=M.divide(b).normalize();I.push(l.x,l.y,l.z),L.push(x.x,x.y,x.z),n.push(a,U.d?1-N:N)}if(C>0){const N=I.length/3;for(let p=N-2*(k+1);p+k+2<N;p++)M?(C>1&&(x.push(p),x.push(p+1),x.push(p+k+1)),(C<l||e<1)&&(x.push(p+k+1),x.push(p+1),x.push(p+k+2))):(x.push(p),x.push(p+1),x.push(p+k+1),x.push(p+k+1),x.push(p+1),x.push(p+k+2))}}C.c._ComputeSides(H,I,x,L,n,N.frontUVs,N.backUVs);const w=new C.c;return w.indices=x,w.vN=I,w.WN=L,w.RN=n,w}function y(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return X(p).fN(A,p.updatable),A}C.c.CreateSphere=X,a.d.CreateSphere=(N,p,T,A,a,C)=>y(N,{segments:p,diameterX:T,diameterY:T,diameterZ:T,sideOrientation:C,updatable:a},A)},14536:(N,p,T)=>{"use strict";T.d(p,{c:()=>X});var A=T(12950),a=T(14060),C=T(12963),U=T(12813);class X{static get Configuration(){return{get decoder(){return a.c.DefaultConfiguration},set decoder(N){a.c.DefaultConfiguration=N}}}static set Configuration(N){a.c.DefaultConfiguration=N.decoder}static get DecoderAvailable(){return(0,A.j)(a.c.DefaultConfiguration)}static get Default(){return X._Default??(X._Default=new X),X._Default}static ResetDefault(N){X._Default&&(N||X._Default.dispose(),X._Default=null)}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const p="number"===typeof N?{...a.c.DefaultConfiguration,numWorkers:N}:{...a.c.DefaultConfiguration,...N};this._decoder=new a.c(p)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(N,p,T){return this._decoder.decodeMeshToMeshDataAsync(N,p,T)}async decodeMeshToGeometryAsync(N,p,T,A){return await this._decoder.decodeMeshToGeometryAsync(N,p,T,A)}async _decodeMeshToGeometryForGltfAsync(N,p,T,A,a,C){return await this._decoder._decodeMeshToGeometryForGltfAsync(N,p,T,A,a,C)}async decodeMeshAsync(N,p){const T=await this._decoder.decodeMeshToMeshDataAsync(N,p),A=new U.c;T.indices&&(A.indices=T.indices);for(const a of T.attributes){const N=C.b.GetFloatData(a.data,a.size,C.b.GetDataType(a.data),a.byteOffset,a.byteStride,a.normalized,T.totalVertices);A.set(N,a.kind)}return A}}X.DefaultNumWorkers=(0,A.f)(),X._Default=null},14060:(N,p,T)=>{"use strict";T.d(p,{c:()=>e});var A=T(12950),a=T(12190),C=T(12839),U=T(12963),X=T(12205),y=T(12960);class e extends A.c{static get DefaultAvailable(){return(0,A.j)(e.DefaultConfiguration)}static get Default(){return e._Default??(e._Default=new e),e._Default}static ResetDefault(N){e._Default&&(N||e._Default.dispose(),e._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(N,p){return{module:await(p||DracoDecoderModule)({wasmBinary:N})}}_getWorkerContent(){return`${y.b}(${y.f})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DefaultConfiguration)}decodeMeshToMeshDataAsync(N,p,T){const A=N instanceof ArrayBuffer?new Int8Array(N):new Int8Array(N.buffer,N.byteOffset,N.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async N=>await new Promise(((a,C)=>{N.push(((N,U)=>{let y=null;const e=[],H=p=>{N.removeEventListener("error",H),N.removeEventListener("message",M),C(p),U()},M=p=>{const A=p.data;switch(A.id){case"indices":y=A.data;break;case"attribute":e.push({kind:A.kind,data:A.data,size:A.size,byteOffset:A.byteOffset,byteStride:A.byteStride,normalized:(C=A.kind,b=A.normalized,T&&void 0!==T[C]?(b!==T[C]&&X.d.Warn(`Normalized flag from Draco data (${b}) does not match normalized flag from glTF accessor (${T[C]}). Using flag from glTF accessor.`),T[C]):b)});break;case"decodeMeshDone":N.removeEventListener("error",H),N.removeEventListener("message",M),a({indices:y,attributes:e,totalVertices:A.totalVertices}),U()}var C,b};N.addEventListener("error",H),N.addEventListener("message",M);const b=A.slice();N.postMessage({id:"decodeMesh",dataView:b,attributes:p},[b.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((N=>{let T=null;const a=[],C=(0,y.b)(N.module,A,p,(N=>{T=N}),((N,p,T,A,C,U)=>{a.push({kind:N,data:p,size:T,byteOffset:A,byteStride:C,normalized:U})}));return{indices:T,attributes:a,totalVertices:C}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(N,p,T,A){const a=await this.decodeMeshToMeshDataAsync(T,A),X=new C.e(N,p);a.indices&&X.setIndices(a.indices);for(const C of a.attributes)X.setVerticesBuffer(new U.b(p.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),a.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(N,p,T,A,a,X){const y=await this.decodeMeshToMeshDataAsync(T,A,a),e=new C.e(N,p);X&&(e._boundingInfo=X,e.useBoundingInfoFromGeometry=!0),y.indices&&e.setIndices(y.indices);for(const C of y.attributes)e.setVerticesBuffer(new U.b(p.getEngine(),C.data,C.kind,!1,void 0,C.byteStride,void 0,C.byteOffset,C.size,void 0,C.normalized,!0),y.totalVertices);return e}}e.DefaultConfiguration={wasmUrl:`${a.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${a.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${a.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},e._Default=null},14234:(N,p,T)=>{"use strict";T.d(p,{c:()=>XN});var A=T(12371),a=T(12833),C=T(12451),U=T(12813),X=T(12433);function y(N){let p=N.pathArray;const T=N.closeArray||!1,A=N.closePath||!1,a=N.invertUV||!1,y=Math.floor(p[0].length/2);let e=N.offset||y;e=e>y?y:Math.floor(e);const H=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,M=N.RN,b=N.zN,l=[],k=[],x=[],I=[],L=[],n=[],w=[],g=[];let P;const i=[],K=[];let F,v,W;if(p.length<2){const N=[],T=[];for(v=0;v<p[0].length-e;v++)N.push(p[0][v]),T.push(p[0][v+e]);p=[N,T]}let z=0;const R=A?1:0,J=T?1:0;let f,G,o,Z,mN,q;for(P=p[0].length,F=0;F<p.length+J;F++){for(w[F]=0,L[F]=[0],f=F===p.length?p[0]:p[F],G=f.length,P=P<G?P:G,W=0;W<G;)l.push(f[W].x,f[W].y,f[W].z),W>0&&(o=f[W].Ip(f[W-1]).length(),Z=o+w[F],L[F].push(Z),w[F]=Z),W++;A&&(W--,l.push(f[0].x,f[0].y,f[0].z),o=f[W].Ip(f[0]).length(),Z=o+w[F],L[F].push(Z),w[F]=Z),i[F]=G+R,K[F]=z,z+=G+R}let h,j,V=null,r=null;for(v=0;v<P+R;v++)for(g[v]=0,n[v]=[0],F=0;F<p.length-1+J;F++)mN=p[F],q=F===p.length-1?p[0]:p[F+1],v===P?(V=mN[0],r=q[0]):(V=mN[v],r=q[v]),o=r.Ip(V).length(),Z=o+g[v],n[v].push(Z),g[v]=Z;if(M)for(F=0;F<M.length;F++)I.push(M[F].x,X.d?1-M[F].y:M[F].y);else for(F=0;F<p.length+J;F++)for(v=0;v<P+R;v++)h=0!=w[F]?L[F][v]/w[F]:0,j=0!=g[v]?n[v][F]/g[v]:0,a?I.push(j,h):I.push(h,X.d?1-j:j);F=0;let u=0,Y=i[F]-1,D=i[F+1]-1,c=Y<D?Y:D,Q=K[1]-K[0];const E=i.length-1;for(;u<=c&&F<E;)k.push(u,u+Q,u+1),k.push(u+Q+1,u+1,u+Q),u+=1,u===c&&(F++,Q=K[F+1]-K[F],Y=i[F]-1,D=i[F+1]-1,u=K[F],c=Y<D?Y+u:D+u);if(U.c.ComputeNormals(l,k,x),A){let N=0,T=0;for(F=0;F<p.length;F++){N=3*K[F],T=F+1<p.length?3*(K[F+1]-1):x.length-3,x[N]=.5*(x[N]+x[T]),x[N+1]=.5*(x[N+1]+x[T+1]),x[N+2]=.5*(x[N+2]+x[T+2]);const A=Math.sqrt(x[N]*x[N]+x[N+1]*x[N+1]+x[N+2]*x[N+2]);x[N]/=A,x[N+1]/=A,x[N+2]/=A,x[T]=x[N],x[T+1]=x[N+1],x[T+2]=x[N+2]}}if(T){let N=3*K[0],T=3*K[p.length];for(v=0;v<P+R;v++){x[N]=.5*(x[N]+x[T]),x[N+1]=.5*(x[N+1]+x[T+1]),x[N+2]=.5*(x[N+2]+x[T+2]);const p=Math.sqrt(x[N]*x[N]+x[N+1]*x[N+1]+x[N+2]*x[N+2]);x[N]/=p,x[N+1]/=p,x[N+2]/=p,x[T]=x[N],x[T+1]=x[N+1],x[T+2]=x[N+2],N+=3,T+=3}}U.c._ComputeSides(H,l,k,x,I,N.frontUVs,N.backUVs);let O=null;if(b){O=new Float32Array(4*b.length);for(let N=0;N<b.length;N++)O[4*N]=b[N].r,O[4*N+1]=b[N].g,O[4*N+2]=b[N].b,O[4*N+3]=b[N].a}const B=new U.c,d=new Float32Array(l),t=new Float32Array(x),S=new Float32Array(I);return B.indices=k,B.vN=d,B.WN=t,B.RN=S,O&&B.set(O,C.f.ColorKind),A&&(B._idx=K),B}function e(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=p.pathArray,H=p.closeArray,M=p.closePath,b=a.d._GetDefaultSideOrientation(p.sideOrientation),l=p.instance,k=p.updatable;if(l){const N=A.TmpVectors.xp[0].IX(Number.MAX_VALUE),T=A.TmpVectors.xp[1].IX(-Number.MAX_VALUE),y=p=>{let A=e[0].length;const C=l;let U=0;const X=C._originalBuilderSideOrientation===a.d.DOUBLESIDE?2:1;for(let a=1;a<=X;++a)for(let X=0;X<e.length;++X){const a=e[X],y=a.length;A=A<y?A:y;for(let C=0;C<A;++C){const A=a[C];p[U]=A.x,p[U+1]=A.y,p[U+2]=A.z,N.minimizeInPlaceFromFloats(A.x,A.y,A.z),T.maximizeInPlaceFromFloats(A.x,A.y,A.z),U+=3}if(C._creationDataStorage&&C._creationDataStorage.closePath){const N=a[0];p[U]=N.x,p[U+1]=N.y,p[U+2]=N.z,U+=3}}},H=l.getVerticesData(C.f.PositionKind);if(y(H),l.hasBoundingInfo?l.getBoundingInfo().reConstruct(N,T,l._worldMatrix):l.buildBoundingInfo(N,T,l._worldMatrix),l.updateVerticesData(C.f.PositionKind,H,!1,!1),p.zN){const N=l.getVerticesData(C.f.ColorKind);for(let T=0,A=0;T<p.zN.length;T++,A+=4){const a=p.zN[T];N[A]=a.r,N[A+1]=a.g,N[A+2]=a.b,N[A+3]=a.a}l.updateVerticesData(C.f.ColorKind,N,!1,!1)}if(p.RN){const N=l.getVerticesData(C.f.UVKind);for(let T=0;T<p.RN.length;T++)N[2*T]=p.RN[T].x,N[2*T+1]=X.d?1-p.RN[T].y:p.RN[T].y;l.updateVerticesData(C.f.UVKind,N,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){const N=l.bX(),p=l.getVerticesData(C.f.NormalKind),T=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(U.c.ComputeNormals(H,N,p,T),l._creationDataStorage&&l._creationDataStorage.closePath){let N=0,T=0;for(let A=0;A<e.length;A++)N=3*l._creationDataStorage.idx[A],T=A+1<e.length?3*(l._creationDataStorage.idx[A+1]-1):p.length-3,p[N]=.5*(p[N]+p[T]),p[N+1]=.5*(p[N+1]+p[T+1]),p[N+2]=.5*(p[N+2]+p[T+2]),p[T]=p[N],p[T+1]=p[N+1],p[T+2]=p[N+2]}l.areNormalsFrozen||l.updateVerticesData(C.f.NormalKind,p,!1,!1)}return l}{const A=new a.d(N,T);A._originalBuilderSideOrientation=b,A._creationDataStorage=new a.h;const C=y(p);return M&&(A._creationDataStorage.idx=C._idx),A._creationDataStorage.closePath=M,A._creationDataStorage.closeArray=H,C.fN(A,k),A}}U.c.CreateRibbon=y,a.d.CreateRibbon=function(N,p){return e(N,{pathArray:p,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var H=T(13767),M=T(13609),b=T(12421);function l(N){const p=N.pattern||a.d.NO_FLIP,T=N.tileWidth||N.tileSize||1,A=N.tileHeight||N.tileSize||1,C=N.alignHorizontal||0,X=N.alignVertical||0,y=N.width||N.size||1,e=Math.floor(y/T);let H=y-e*T;const M=N.height||N.size||1,b=Math.floor(M/A);let l=M-b*A;const k=T*e/2,x=A*b/2;let I=0,L=0,n=0,w=0,g=0,P=0;if(H>0||l>0){switch(n=-k,w=-x,g=k,P=x,C){case a.d.CENTER:H/=2,n-=H,g+=H;break;case a.d.LEFT:g+=H,I=-H/2;break;case a.d.RIGHT:n-=H,I=H/2}switch(X){case a.d.CENTER:l/=2,w-=l,P+=l;break;case a.d.BOTTOM:P+=l,L=-l/2;break;case a.d.TOP:w-=l,L=l/2}}const i=[],K=[],F=[];F[0]=[0,0,1,0,1,1,0,1],F[1]=[0,0,1,0,1,1,0,1],p!==a.d.ROTATE_TILE&&p!==a.d.ROTATE_ROW||(F[1]=[1,1,0,1,0,0,1,0]),p!==a.d.FLIP_TILE&&p!==a.d.FLIP_ROW||(F[1]=[1,0,0,0,0,1,1,1]),p!==a.d.FLIP_N_ROTATE_TILE&&p!==a.d.FLIP_N_ROTATE_ROW||(F[1]=[0,1,1,1,1,0,0,0]);let v=[];const W=[],z=[];let R=0;for(let U=0;U<b;U++)for(let N=0;N<e;N++)i.push(N*T-k+I,U*A-x+L,0),i.push((N+1)*T-k+I,U*A-x+L,0),i.push((N+1)*T-k+I,(U+1)*A-x+L,0),i.push(N*T-k+I,(U+1)*A-x+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),v=p===a.d.FLIP_TILE||p===a.d.ROTATE_TILE||p===a.d.FLIP_N_ROTATE_TILE?v.concat(F[(N%2+U%2)%2]):p===a.d.FLIP_ROW||p===a.d.ROTATE_ROW||p===a.d.FLIP_N_ROTATE_ROW?v.concat(F[U%2]):v.concat(F[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),R+=4;if(H>0||l>0){const N=l>0&&(X===a.d.CENTER||X===a.d.TOP),U=l>0&&(X===a.d.CENTER||X===a.d.BOTTOM),y=H>0&&(C===a.d.CENTER||C===a.d.RIGHT),M=H>0&&(C===a.d.CENTER||C===a.d.LEFT);let F,J,f,G,o=[];if(N&&y&&(i.push(n+I,w+L,0),i.push(-k+I,w+L,0),i.push(-k+I,w+l+L,0),i.push(n+I,w+l+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,F=1-H/T,J=1-l/A,f=1,G=1,o=[F,J,f,J,f,G,F,G],p===a.d.ROTATE_ROW&&(o=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),p===a.d.FLIP_ROW&&(o=[1-F,J,1-f,J,1-f,G,1-F,G]),p===a.d.FLIP_N_ROTATE_ROW&&(o=[F,1-J,f,1-J,f,1-G,F,1-G]),v=v.concat(o),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N&&M&&(i.push(k+I,w+L,0),i.push(g+I,w+L,0),i.push(g+I,w+l+L,0),i.push(k+I,w+l+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,F=0,J=1-l/A,f=H/T,G=1,o=[F,J,f,J,f,G,F,G],(p===a.d.ROTATE_ROW||p===a.d.ROTATE_TILE&&e%2===0)&&(o=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),(p===a.d.FLIP_ROW||p===a.d.FLIP_TILE&&e%2===0)&&(o=[1-F,J,1-f,J,1-f,G,1-F,G]),(p===a.d.FLIP_N_ROTATE_ROW||p===a.d.FLIP_N_ROTATE_TILE&&e%2===0)&&(o=[F,1-J,f,1-J,f,1-G,F,1-G]),v=v.concat(o),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&y&&(i.push(n+I,x+L,0),i.push(-k+I,x+L,0),i.push(-k+I,P+L,0),i.push(n+I,P+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,F=1-H/T,J=0,f=1,G=l/A,o=[F,J,f,J,f,G,F,G],(p===a.d.ROTATE_ROW&&b%2===1||p===a.d.ROTATE_TILE&&b%1===0)&&(o=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),(p===a.d.FLIP_ROW&&b%2===1||p===a.d.FLIP_TILE&&b%2===0)&&(o=[1-F,J,1-f,J,1-f,G,1-F,G]),(p===a.d.FLIP_N_ROTATE_ROW&&b%2===1||p===a.d.FLIP_N_ROTATE_TILE&&b%2===0)&&(o=[F,1-J,f,1-J,f,1-G,F,1-G]),v=v.concat(o),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),U&&M&&(i.push(k+I,x+L,0),i.push(g+I,x+L,0),i.push(g+I,P+L,0),i.push(k+I,P+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,F=0,J=0,f=H/T,G=l/A,o=[F,J,f,J,f,G,F,G],(p===a.d.ROTATE_ROW&&b%2===1||p===a.d.ROTATE_TILE&&(b+e)%2===1)&&(o=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),(p===a.d.FLIP_ROW&&b%2===1||p===a.d.FLIP_TILE&&(b+e)%2===1)&&(o=[1-F,J,1-f,J,1-f,G,1-F,G]),(p===a.d.FLIP_N_ROTATE_ROW&&b%2===1||p===a.d.FLIP_N_ROTATE_TILE&&(b+e)%2===1)&&(o=[F,1-J,f,1-J,f,1-G,F,1-G]),v=v.concat(o),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),N){const N=[];F=0,J=1-l/A,f=1,G=1,N[0]=[F,J,f,J,f,G,F,G],N[1]=[F,J,f,J,f,G,F,G],p!==a.d.ROTATE_TILE&&p!==a.d.ROTATE_ROW||(N[1]=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),p!==a.d.FLIP_TILE&&p!==a.d.FLIP_ROW||(N[1]=[1-F,J,1-f,J,1-f,G,1-F,G]),p!==a.d.FLIP_N_ROTATE_TILE&&p!==a.d.FLIP_N_ROTATE_ROW||(N[1]=[F,1-J,f,1-J,f,1-G,F,1-G]);for(let A=0;A<e;A++)i.push(A*T-k+I,w+L,0),i.push((A+1)*T-k+I,w+L,0),i.push((A+1)*T-k+I,w+l+L,0),i.push(A*T-k+I,w+l+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=p===a.d.FLIP_TILE||p===a.d.ROTATE_TILE||p===a.d.FLIP_N_ROTATE_TILE?v.concat(N[(A+1)%2]):p===a.d.FLIP_ROW||p===a.d.ROTATE_ROW||p===a.d.FLIP_N_ROTATE_ROW?v.concat(N[1]):v.concat(N[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const N=[];F=0,J=0,f=1,G=l/A,N[0]=[F,J,f,J,f,G,F,G],N[1]=[F,J,f,J,f,G,F,G],p!==a.d.ROTATE_TILE&&p!==a.d.ROTATE_ROW||(N[1]=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),p!==a.d.FLIP_TILE&&p!==a.d.FLIP_ROW||(N[1]=[1-F,J,1-f,J,1-f,G,1-F,G]),p!==a.d.FLIP_N_ROTATE_TILE&&p!==a.d.FLIP_N_ROTATE_ROW||(N[1]=[F,1-J,f,1-J,f,1-G,F,1-G]);for(let A=0;A<e;A++)i.push(A*T-k+I,P-l+L,0),i.push((A+1)*T-k+I,P-l+L,0),i.push((A+1)*T-k+I,P+L,0),i.push(A*T-k+I,P+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=p===a.d.FLIP_TILE||p===a.d.ROTATE_TILE||p===a.d.FLIP_N_ROTATE_TILE?v.concat(N[(A+b)%2]):p===a.d.FLIP_ROW||p===a.d.ROTATE_ROW||p===a.d.FLIP_N_ROTATE_ROW?v.concat(N[b%2]):v.concat(N[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const N=[];F=1-H/T,J=0,f=1,G=1,N[0]=[F,J,f,J,f,G,F,G],N[1]=[F,J,f,J,f,G,F,G],p!==a.d.ROTATE_TILE&&p!==a.d.ROTATE_ROW||(N[1]=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),p!==a.d.FLIP_TILE&&p!==a.d.FLIP_ROW||(N[1]=[1-F,J,1-f,J,1-f,G,1-F,G]),p!==a.d.FLIP_N_ROTATE_TILE&&p!==a.d.FLIP_N_ROTATE_ROW||(N[1]=[F,1-J,f,1-J,f,1-G,F,1-G]);for(let T=0;T<b;T++)i.push(n+I,T*A-x+L,0),i.push(n+H+I,T*A-x+L,0),i.push(n+H+I,(T+1)*A-x+L,0),i.push(n+I,(T+1)*A-x+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=p===a.d.FLIP_TILE||p===a.d.ROTATE_TILE||p===a.d.FLIP_N_ROTATE_TILE?v.concat(N[(T+1)%2]):p===a.d.FLIP_ROW||p===a.d.ROTATE_ROW||p===a.d.FLIP_N_ROTATE_ROW?v.concat(N[T%2]):v.concat(N[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(M){const N=[];F=0,J=0,f=H/A,G=1,N[0]=[F,J,f,J,f,G,F,G],N[1]=[F,J,f,J,f,G,F,G],p!==a.d.ROTATE_TILE&&p!==a.d.ROTATE_ROW||(N[1]=[1-F,1-J,1-f,1-J,1-f,1-G,1-F,1-G]),p!==a.d.FLIP_TILE&&p!==a.d.FLIP_ROW||(N[1]=[1-F,J,1-f,J,1-f,G,1-F,G]),p!==a.d.FLIP_N_ROTATE_TILE&&p!==a.d.FLIP_N_ROTATE_ROW||(N[1]=[F,1-J,f,1-J,f,1-G,F,1-G]);for(let T=0;T<b;T++)i.push(g-H+I,T*A-x+L,0),i.push(g+I,T*A-x+L,0),i.push(g+I,(T+1)*A-x+L,0),i.push(g-H+I,(T+1)*A-x+L,0),z.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,v=p===a.d.FLIP_TILE||p===a.d.ROTATE_TILE||p===a.d.FLIP_N_ROTATE_TILE?v.concat(N[(T+e)%2]):p===a.d.FLIP_ROW||p===a.d.ROTATE_ROW||p===a.d.FLIP_N_ROTATE_ROW?v.concat(N[T%2]):v.concat(N[0]),W.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),K.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const J=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE;U.c._ComputeSides(J,i,z,K,v,N.frontUVs,N.backUVs);const f=new U.c;f.indices=z,f.vN=i,f.WN=K,f.RN=v;const G=J===U.c.DOUBLESIDE?W.concat(W):W;return f.zN=G,f}function k(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return l(p).fN(A,p.updatable),A}function x(N){const p=N.faceUV||new Array(6),T=N.faceColors,C=N.pattern||a.d.NO_FLIP,y=N.width||N.size||1,e=N.height||N.size||1,H=N.depth||N.size||1,M=N.tileWidth||N.tileSize||1,k=N.tileHeight||N.tileSize||1,x=N.alignHorizontal||0,I=N.alignVertical||0,L=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE;for(let a=0;a<6;a++)void 0===p[a]&&(p[a]=new A.Vector4(0,0,1,1)),T&&void 0===T[a]&&(T[a]=new b.LX(1,1,1,1));const n=y/2,w=e/2,g=H/2,P=[];for(let A=0;A<2;A++)P[A]=l({pattern:C,tileWidth:M,tileHeight:k,width:y,height:e,alignVertical:I,alignHorizontal:x,sideOrientation:L});for(let A=2;A<4;A++)P[A]=l({pattern:C,tileWidth:M,tileHeight:k,width:H,height:e,alignVertical:I,alignHorizontal:x,sideOrientation:L});let i=I;I===a.d.BOTTOM?i=a.d.TOP:I===a.d.TOP&&(i=a.d.BOTTOM);for(let A=4;A<6;A++)P[A]=l({pattern:C,tileWidth:M,tileHeight:k,width:y,height:H,alignVertical:i,alignHorizontal:x,sideOrientation:L});let K=[],F=[],v=[],W=[];const z=[],R=[],J=[],f=[];let G=0,o=0;for(let a=0;a<6;a++){const N=P[a].vN.length;R[a]=[],J[a]=[];for(let p=0;p<N/3;p++)R[a].push(new A.xp(P[a].vN[3*p],P[a].vN[3*p+1],P[a].vN[3*p+2])),J[a].push(new A.xp(P[a].WN[3*p],P[a].WN[3*p+1],P[a].WN[3*p+2]));G=P[a].RN.length,f[a]=[];for(let T=0;T<G;T+=2)f[a][T]=p[a].x+(p[a].z-p[a].x)*P[a].RN[T],f[a][T+1]=p[a].y+(p[a].w-p[a].y)*P[a].RN[T+1],X.d&&(f[a][T+1]=1-f[a][T+1]);if(v=v.concat(f[a]),W=W.concat(P[a].indices.map((N=>N+o))),o+=R[a].length,T)for(let p=0;p<4;p++)z.push(T[a].r,T[a].g,T[a].b,T[a].a)}const Z=new A.xp(0,0,g),mN=A.Matrix.RotationY(Math.PI);K=R[0].map((N=>A.xp.TransformNormal(N,mN).add(Z))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]),F=J[0].map((N=>A.xp.TransformNormal(N,mN))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]),K=K.concat(R[1].map((N=>N.Ip(Z))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),F=F.concat(J[1].map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]));const q=new A.xp(n,0,0),h=A.Matrix.RotationY(-Math.PI/2);K=K.concat(R[2].map((N=>A.xp.TransformNormal(N,h).add(q))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),F=F.concat(J[2].map((N=>A.xp.TransformNormal(N,h))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]));const j=A.Matrix.RotationY(Math.PI/2);K=K.concat(R[3].map((N=>A.xp.TransformNormal(N,j).Ip(q))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),F=F.concat(J[3].map((N=>A.xp.TransformNormal(N,j))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]));const V=new A.xp(0,w,0),r=A.Matrix.RotationX(Math.PI/2);K=K.concat(R[4].map((N=>A.xp.TransformNormal(N,r).add(V))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),F=F.concat(J[4].map((N=>A.xp.TransformNormal(N,r))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[]));const u=A.Matrix.RotationX(-Math.PI/2);K=K.concat(R[5].map((N=>A.xp.TransformNormal(N,u).Ip(V))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),F=F.concat(J[5].map((N=>A.xp.TransformNormal(N,u))).map((N=>[N.x,N.y,N.z])).reduce(((N,p)=>N.concat(p)),[])),U.c._ComputeSides(L,K,W,F,v);const Y=new U.c;if(Y.indices=W,Y.vN=K,Y.WN=F,Y.RN=v,T){const N=L===U.c.DOUBLESIDE?z.concat(z):z;Y.zN=N}return Y}function I(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return x(p).fN(A,p.updatable),A}U.c.CreateTiledPlane=l;U.c.CreateTiledBox=x;var L=T(13753),n=T(12617),w=T(12581);function g(N){const p=N.height||2;let T=0===N.diameterTop?0:N.diameterTop||N.diameter||1,C=0===N.diameterBottom?0:N.diameterBottom||N.diameter||1;T=T||1e-5,C=C||1e-5;const y=0|(N.tessellation||24),e=0|(N.subdivisions||1),H=!!N.hasRings,M=!!N.enclose,l=0===N.cap?0:N.cap||a.d.CAP_ALL,k=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1,x=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,I=N.faceUV||new Array(3),L=N.faceColors,n=2+(1+(1!==k&&M?2:0))*(H?e:1);let g;for(g=0;g<n;g++)L&&void 0===L[g]&&(L[g]=new b.LX(1,1,1,1));for(g=0;g<n;g++)I&&void 0===I[g]&&(I[g]=new A.Vector4(0,0,1,1));const P=[],i=[],K=[],F=[],v=[],W=2*Math.PI*k/y;let z,R,J;const f=(C-T)/2/p,G=A.xp.Zero(),o=A.xp.Zero(),Z=A.xp.Zero(),mN=A.xp.Zero(),q=A.xp.Zero(),h=w.b.Y;let j,V,r,u=1,Y=1,D=0,c=0;for(j=0;j<=e;j++)for(R=j/e,J=(R*(T-C)+C)/2,u=H&&0!==j&&j!==e?2:1,r=0;r<u;r++){for(H&&(Y+=r),M&&(Y+=2*r),V=0;V<=y;V++)z=V*W,G.x=Math.cos(-z)*J,G.y=-p/2+R*p,G.z=Math.sin(-z)*J,0===T&&j===e?(o.x=K[K.length-3*(y+1)],o.y=K[K.length-3*(y+1)+1],o.z=K[K.length-3*(y+1)+2]):(o.x=G.x,o.z=G.z,o.y=Math.sqrt(o.x*o.x+o.z*o.z)*f,o.normalize()),0===V&&(Z.A(G),mN.A(o)),i.push(G.x,G.y,G.z),K.push(o.x,o.y,o.z),c=H?D!==Y?I[Y].y:I[Y].w:I[Y].y+(I[Y].w-I[Y].y)*R,F.push(I[Y].x+(I[Y].z-I[Y].x)*V/y,X.d?1-c:c),L&&v.push(L[Y].r,L[Y].g,L[Y].b,L[Y].a);1!==k&&M&&(i.push(G.x,G.y,G.z),i.push(0,G.y,0),i.push(0,G.y,0),i.push(Z.x,Z.y,Z.z),A.xp.CrossToRef(h,o,q),q.normalize(),K.push(q.x,q.y,q.z,q.x,q.y,q.z),A.xp.CrossToRef(mN,h,q),q.normalize(),K.push(q.x,q.y,q.z,q.x,q.y,q.z),c=H?D!==Y?I[Y+1].y:I[Y+1].w:I[Y+1].y+(I[Y+1].w-I[Y+1].y)*R,F.push(I[Y+1].x,X.d?1-c:c),F.push(I[Y+1].z,X.d?1-c:c),c=H?D!==Y?I[Y+2].y:I[Y+2].w:I[Y+2].y+(I[Y+2].w-I[Y+2].y)*R,F.push(I[Y+2].x,X.d?1-c:c),F.push(I[Y+2].z,X.d?1-c:c),L&&(v.push(L[Y+1].r,L[Y+1].g,L[Y+1].b,L[Y+1].a),v.push(L[Y+1].r,L[Y+1].g,L[Y+1].b,L[Y+1].a),v.push(L[Y+2].r,L[Y+2].g,L[Y+2].b,L[Y+2].a),v.push(L[Y+2].r,L[Y+2].g,L[Y+2].b,L[Y+2].a))),D!==Y&&(D=Y)}const Q=1!==k&&M?y+4:y;for(j=0,Y=0;Y<e;Y++){let N=0,p=0,T=0,A=0;for(V=0;V<y;V++)N=j*(Q+1)+V,p=(j+1)*(Q+1)+V,T=j*(Q+1)+(V+1),A=(j+1)*(Q+1)+(V+1),P.push(N,p,T),P.push(A,T,p);1!==k&&M&&(P.push(N+2,p+2,T+2),P.push(A+2,T+2,p+2),P.push(N+4,p+4,T+4),P.push(A+4,T+4,p+4)),j=H?j+2:j+1}const E=N=>{const a=N?T/2:C/2;if(0===a)return;let U,e,H;const M=N?I[n-1]:I[0];let b=null;L&&(b=N?L[n-1]:L[0]);const l=i.length/3,x=N?p/2:-p/2,w=new A.xp(0,x,0);i.push(w.x,w.y,w.z),K.push(0,N?1:-1,0);const g=M.y+.5*(M.w-M.y);F.push(M.x+.5*(M.z-M.x),X.d?1-g:g),b&&v.push(b.r,b.g,b.b,b.a);const W=new A.Vector2(.5,.5);for(H=0;H<=y;H++){U=2*Math.PI*H*k/y;const p=Math.cos(-U),T=Math.sin(-U);e=new A.xp(p*a,x,T*a);const C=new A.Vector2(p*W.x+.5,T*W.y+.5);i.push(e.x,e.y,e.z),K.push(0,N?1:-1,0);const l=M.y+(M.w-M.y)*C.y;F.push(M.x+(M.z-M.x)*C.x,X.d?1-l:l),b&&v.push(b.r,b.g,b.b,b.a)}for(H=0;H<y;H++)N?(P.push(l),P.push(l+(H+2)),P.push(l+(H+1))):(P.push(l),P.push(l+(H+1)),P.push(l+(H+2)))};l!==a.d.CAP_START&&l!==a.d.CAP_ALL||E(!1),l!==a.d.CAP_END&&l!==a.d.CAP_ALL||E(!0),U.c._ComputeSides(x,i,P,K,F,N.frontUVs,N.backUVs);const O=new U.c;return O.indices=P,O.vN=i,O.WN=K,O.RN=F,L&&(O.zN=v),O}function P(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return g(p).fN(A,p.updatable),A}function i(N){const p=[],T=[],a=[],C=[],y=N.diameter||1,e=N.thickness||.5,H=0|(N.tessellation||16),M=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,b=H+1;for(let U=0;U<=H;U++){const N=U/H,M=U*Math.PI*2/H-Math.PI/2,l=A.Matrix.Translation(y/2,0,0).multiply(A.Matrix.RotationY(M));for(let y=0;y<=H;y++){const M=1-y/H,k=y*Math.PI*2/H+Math.PI,x=Math.cos(k),I=Math.sin(k);let L=new A.xp(x,I,0),n=L.scale(e/2);const w=new A.Vector2(N,M);n=A.xp.TransformCoordinates(n,l),L=A.xp.TransformNormal(L,l),T.push(n.x,n.y,n.z),a.push(L.x,L.y,L.z),C.push(w.x,X.d?1-w.y:w.y);const g=(U+1)%b,P=(y+1)%b;p.push(U*b+y),p.push(U*b+P),p.push(g*b+y),p.push(U*b+P),p.push(g*b+P),p.push(g*b+y)}}U.c._ComputeSides(M,T,p,a,C,N.frontUVs,N.backUVs);const l=new U.c;return l.indices=p,l.vN=T,l.WN=a,l.RN=C,l}function K(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return i(p).fN(A,p.updatable),A}U.c.CreateCylinder=g,a.d.CreateCylinder=(N,p,T,A,C,U,X,y,e)=>{void 0!==X&&X instanceof n.c||(void 0!==X&&(e=y||a.d.DEFAULTSIDE,y=X),X=U,U=1);return P(N,{height:p,diameterTop:T,diameterBottom:A,tessellation:C,subdivisions:U,sideOrientation:e,updatable:y},X)};function F(N){const p=[],T=[],a=[],C=[],y=N.radius||2,e=N.tube||.5,H=N.radialSegments||32,M=N.tubularSegments||32,b=N.p||2,l=N.q||3,k=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,x=N=>{const p=Math.cos(N),T=Math.sin(N),a=l/b*N,C=Math.cos(a),U=y*(2+C)*.5*p,X=y*(2+C)*T*.5,e=y*Math.sin(a)*.5;return new A.xp(U,X,e)};let I,L;for(I=0;I<=H;I++){const N=I%H/H*2*b*Math.PI,p=x(N),a=x(N+.01),U=a.Ip(p);let y=a.add(p);const l=A.xp.Cross(U,y);for(y=A.xp.Cross(l,U),l.normalize(),y.normalize(),L=0;L<M;L++){const N=L%M/M*2*Math.PI,A=-e*Math.cos(N),a=e*Math.sin(N);T.push(p.x+A*y.x+a*l.x),T.push(p.y+A*y.y+a*l.y),T.push(p.z+A*y.z+a*l.z),C.push(I/H),C.push(X.d?1-L/M:L/M)}}for(I=0;I<H;I++)for(L=0;L<M;L++){const N=(L+1)%M,T=I*M+L,A=(I+1)*M+L,a=(I+1)*M+N,C=I*M+N;p.push(C),p.push(A),p.push(T),p.push(C),p.push(a),p.push(A)}U.c.ComputeNormals(T,p,a),U.c._ComputeSides(k,T,p,a,C,N.frontUVs,N.backUVs);const n=new U.c;return n.indices=p,n.vN=T,n.WN=a,n.RN=C,n}function v(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2?arguments[2]:void 0;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return F(p).fN(A,p.updatable),A}U.c.CreateTorus=i,a.d.CreateTorus=(N,p,T,A,a,C,U)=>K(N,{diameter:p,thickness:T,tessellation:A,sideOrientation:U,updatable:C},a);U.c.CreateTorusKnot=F,a.d.CreateTorusKnot=(N,p,T,A,a,C,U,X,y,e)=>v(N,{radius:p,tube:T,radialSegments:A,tubularSegments:a,p:C,q:U,sideOrientation:e,updatable:y},X);var W=T(14242),z=T(12941),R=T(12589);function J(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=p.path,C=p.shape,U=p.scale||1,X=p.rotation||0,y=0===p.cap?0:p.cap||a.d.NO_CAP,e=p.updatable,H=a.d._GetDefaultSideOrientation(p.sideOrientation),M=p.instance||null,b=p.invertUV||!1,l=p.closeShape||!1,k=p.closePath||!1,x=p.capFunction||null;return G(N,C,A,U,X,null,null,k,l,y,!1,T,!!e,H,M,b,p.frontUVs||null,p.backUVs||null,p.firstNormal||null,!!p.adjustFrame,x)}function f(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=p.path,C=p.shape,U=p.scaleFunction||(()=>1),X=p.rotationFunction||(()=>0),y=p.closePath||p.ribbonCloseArray||!1,e=p.closeShape||p.ribbonClosePath||!1,H=0===p.cap?0:p.cap||a.d.NO_CAP,M=p.updatable,b=p.firstNormal||null,l=p.adjustFrame||!1,k=a.d._GetDefaultSideOrientation(p.sideOrientation),x=p.instance,I=p.invertUV||!1,L=p.capFunction||null;return G(N,C,A,null,null,U,X,y,e,H,!0,T,!!M,k,x||null,I,p.frontUVs||null,p.backUVs||null,b,l,L||null)}function G(N,p,T,C,U,X,y,H,M,b,l,k,x,I,L,n,w,g,P,i,K){const F=(N,p,T,C,U,X,y,e,H,M,b)=>{const l=T.getTangents(),k=T.getNormals(),x=T.getBinormals(),I=T.getDistances();if(b)for(let a=0;a<l.length;a++)if(0==l[a].x&&0==l[a].y&&0==l[a].z&&l[a].A(l[a-1]),0==k[a].x&&0==k[a].y&&0==k[a].z&&k[a].A(k[a-1]),0==x[a].x&&0==x[a].y&&0==x[a].z&&x[a].A(x[a-1]),a>0){let N=l[a-1];A.xp.Dot(N,l[a])<0&&l[a].scaleInPlace(-1),N=k[a-1],A.xp.Dot(N,k[a])<0&&k[a].scaleInPlace(-1),N=x[a-1],A.xp.Dot(N,x[a])<0&&x[a].scaleInPlace(-1)}let L=0;const n=M&&e?e:()=>null!==X?X:0,w=M&&y?y:()=>null!==U?U:1;let g=H===a.d.NO_CAP||H===a.d.CAP_END?0:2;const P=A.TmpVectors.Matrix[0];for(let a=0;a<p.length;a++){const T=[],U=n(a,I[a]),X=w(a,I[a]);A.Matrix.RotationAxisToRef(l[a],L,P);for(let C=0;C<N.length;C++){const U=l[a].scale(N[C].z).add(k[a].scale(N[C].x)).add(x[a].scale(N[C].y)),y=A.xp.Zero();A.xp.TransformCoordinatesToRef(U,P,y),y.scaleInPlace(X).addInPlace(p[a]),T[C]=y}C[g]=T,L+=U,g++}const i=K||(N=>{const p=Array(),T=A.xp.Zero();let a;for(a=0;a<N.length;a++)T.addInPlace(N[a]);for(T.scaleInPlace(1/N.length),a=0;a<N.length;a++)p.push(T);return p});switch(H){case a.d.NO_CAP:break;case a.d.CAP_START:C[0]=i(C[2]),C[1]=C[2];break;case a.d.CAP_END:C[g]=C[g-1],C[g+1]=i(C[g-1]);break;case a.d.CAP_ALL:C[0]=i(C[2]),C[1]=C[2],C[g]=C[g-1],C[g+1]=i(C[g-1])}return C};let v,W;if(L){const N=L._creationDataStorage;return v=P?N.path3D.update(T,P):N.path3D.update(T),W=F(p,T,N.path3D,N.pathArray,C,U,X,y,N.cap,l,i),L=e("",{pathArray:W,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:L},k||void 0)}v=P?new R.j(T,P):new R.j(T);W=F(p,T,v,new Array,C,U,X,y,b=b<0||b>3?0:b,l,i);const z=e(N,{pathArray:W,closeArray:H,closePath:M,updatable:x,sideOrientation:I,invertUV:n,frontUVs:w||void 0,backUVs:g||void 0},k);return z._creationDataStorage.pathArray=W,z._creationDataStorage.path3D=v,z._creationDataStorage.cap=b,z}function o(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=p.arc?p.arc<=0||p.arc>1?1:p.arc:1,U=void 0===p.closed||p.closed,X=p.shape,y=p.radius||1,H=p.tessellation||64,M=p.clip||0,b=p.updatable,l=a.d._GetDefaultSideOrientation(p.sideOrientation),k=p.cap||a.d.NO_CAP,x=2*Math.PI,I=[],L=p.invertUV||!1;let n=0,w=0;const g=x/H*C;let P,i;for(n=0;n<=H-M;n++){for(i=[],k!=a.d.CAP_START&&k!=a.d.CAP_ALL||(i.push(new A.xp(0,X[0].y,0)),i.push(new A.xp(Math.cos(n*g)*X[0].x*y,X[0].y,Math.sin(n*g)*X[0].x*y))),w=0;w<X.length;w++)P=new A.xp(Math.cos(n*g)*X[w].x*y,X[w].y,Math.sin(n*g)*X[w].x*y),i.push(P);k!=a.d.CAP_END&&k!=a.d.CAP_ALL||(i.push(new A.xp(Math.cos(n*g)*X[X.length-1].x*y,X[X.length-1].y,Math.sin(n*g)*X[X.length-1].x*y)),i.push(new A.xp(0,X[X.length-1].y,0))),I.push(i)}return e(N,{pathArray:I,closeArray:U,sideOrientation:l,updatable:b,invertUV:L,frontUVs:p.frontUVs,backUVs:p.backUVs},T)}a.d.ExtrudeShape=function(N,p,T,A,C,U){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0,H=arguments.length>9?arguments[9]:void 0;return J(N,{shape:p,path:T,scale:A,rotation:C,cap:0===U?0:U||a.d.NO_CAP,sideOrientation:e,instance:H,updatable:y},X)},a.d.ExtrudeShapeCustom=(N,p,T,A,C,U,X,y,e,H,M,b)=>f(N,{shape:p,path:T,scaleFunction:A,rotationFunction:C,ribbonCloseArray:U,ribbonClosePath:X,cap:0===y?0:y||a.d.NO_CAP,sideOrientation:M,instance:b,updatable:H},e);a.d.CreateLathe=(N,p,T,A,a,C,U)=>o(N,{shape:p,radius:T,tessellation:A,sideOrientation:U,updatable:C},a);var Z=T(13666),mN=T(13617);function q(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=p.path;let U=p.instance,X=1;void 0!==p.radius?X=p.radius:U&&(X=U._creationDataStorage.radius);const y=p.tessellation||64,H=p.radiusFunction||null;let M=p.cap||a.d.NO_CAP;const b=p.invertUV||!1,l=p.updatable,k=a.d._GetDefaultSideOrientation(p.sideOrientation);p.arc=p.arc&&(p.arc<=0||p.arc>1)?1:p.arc||1;const x=(N,p,T,C,U,X,y,e)=>{const H=p.getTangents(),M=p.getNormals(),b=p.getDistances(),l=2*Math.PI/U*e,k=X||(()=>C);let x,I,L,n;const w=A.TmpVectors.Matrix[0];let g=y===a.d.NO_CAP||y===a.d.CAP_END?0:2;for(let a=0;a<N.length;a++){I=k(a,b[a]),x=Array(),L=M[a];for(let p=0;p<U;p++)A.Matrix.RotationAxisToRef(H[a],l*p,w),n=x[p]?x[p]:A.xp.Zero(),A.xp.TransformCoordinatesToRef(L,w,n),n.scaleInPlace(I).addInPlace(N[a]),x[p]=n;T[g]=x,g++}const P=(p,T)=>{const A=Array();for(let a=0;a<p;a++)A.push(N[T]);return A};switch(y){case a.d.NO_CAP:break;case a.d.CAP_START:T[0]=P(U,0),T[1]=T[2].slice(0);break;case a.d.CAP_END:T[g]=T[g-1].slice(0),T[g+1]=P(U,N.length-1);break;case a.d.CAP_ALL:T[0]=P(U,0),T[1]=T[2].slice(0),T[g]=T[g-1].slice(0),T[g+1]=P(U,N.length-1)}return T};let I,L;if(U){const N=U._creationDataStorage,T=p.arc||N.arc;return I=N.path3D.update(C),L=x(C,I,N.pathArray,X,N.tessellation,H,N.cap,T),U=e("",{pathArray:L,instance:U}),N.path3D=I,N.pathArray=L,N.arc=T,N.radius=X,U}I=new R.j(C);M=M<0||M>3?0:M,L=x(C,I,new Array,X,y,H,M,p.arc);const n=e(N,{pathArray:L,closePath:!0,closeArray:!1,updatable:l,sideOrientation:k,invertUV:b,frontUVs:p.frontUVs,backUVs:p.backUVs},T);return n._creationDataStorage.pathArray=L,n._creationDataStorage.path3D=I,n._creationDataStorage.tessellation=y,n._creationDataStorage.cap=M,n._creationDataStorage.arc=p.arc,n._creationDataStorage.radius=X,n}function h(N){const p=[];p[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},p[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},p[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},p[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},p[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},p[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},p[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},p[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},p[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},p[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},p[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},p[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},p[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},p[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},p[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const T=N.type&&(N.type<0||N.type>=p.length)?0:N.type||0,a=N.size,C=N.sizeX||a||1,y=N.sizeY||a||1,e=N.sizeZ||a||1,H=N.custom||p[T],M=H.face.length,l=N.faceUV||new Array(M),k=N.faceColors,x=void 0===N.flat||N.flat,I=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,L=[],n=[],w=[],g=[],P=[];let i=0,K=0;const F=[];let v,W,z,R,J,f,G=0,o=0;if(x)for(o=0;o<M;o++)k&&void 0===k[o]&&(k[o]=new b.LX(1,1,1,1)),l&&void 0===l[o]&&(l[o]=new A.Vector4(0,0,1,1));if(x)for(o=0;o<M;o++){const N=H.face[o].length;for(z=2*Math.PI/N,R=.5*Math.tan(z/2),J=.5,G=0;G<N;G++)L.push(H.vertex[H.face[o][G]][0]*C,H.vertex[H.face[o][G]][1]*y,H.vertex[H.face[o][G]][2]*e),F.push(i),i++,v=l[o].x+(l[o].z-l[o].x)*(.5+R),W=l[o].y+(l[o].w-l[o].y)*(J-.5),g.push(v,X.d?1-W:W),f=R*Math.cos(z)-J*Math.sin(z),J=R*Math.sin(z)+J*Math.cos(z),R=f,k&&P.push(k[o].r,k[o].g,k[o].b,k[o].a);for(G=0;G<N-2;G++)n.push(F[0+K],F[G+2+K],F[G+1+K]);K+=N}else{for(G=0;G<H.vertex.length;G++)L.push(H.vertex[G][0]*C,H.vertex[G][1]*y,H.vertex[G][2]*e),g.push(0,X.d?1:0);for(o=0;o<M;o++)for(G=0;G<H.face[o].length-2;G++)n.push(H.face[o][0],H.face[o][G+2],H.face[o][G+1])}U.c.ComputeNormals(L,n,w),U.c._ComputeSides(I,L,n,w,g,N.frontUVs,N.backUVs);const Z=new U.c;return Z.vN=L,Z.indices=n,Z.WN=w,Z.RN=g,k&&x&&(Z.zN=P),Z}function j(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return h(p).fN(A,p.updatable),A}a.d.CreateTube=(N,p,T,A,a,C,U,X,y,e)=>q(N,{path:p,radius:T,tessellation:A,radiusFunction:a,arc:1,cap:C,updatable:X,sideOrientation:y,instance:e},U);function V(N){const p=N.sideOrientation||U.c.DEFAULTSIDE,T=N.radius||1,a=void 0===N.flat||N.flat,C=0|(N.subdivisions||4),y=N.radiusX||T,e=N.radiusY||T,H=N.radiusZ||T,M=(1+Math.sqrt(5))/2,b=[-1,M,-0,1,M,0,-1,-M,0,1,-M,0,0,-1,-M,0,1,-M,0,-1,M,0,1,M,M,0,1,M,0,-1,-M,0,1,-M,0,-1],l=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],k=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],x=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],I=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],L=[],n=[],w=[],g=[];let P=0;const i=new Array(3),K=new Array(3);let F;for(F=0;F<3;F++)i[F]=A.xp.Zero(),K[F]=A.Vector2.Zero();for(let U=0;U<20;U++){for(F=0;F<3;F++){const N=l[3*U+F];i[F].kX(b[3*k[N]],b[3*k[N]+1],b[3*k[N]+2]),i[F].normalize(),K[F].kX(.134765625*x[2*N]+.05859375+-.0390625*I[U],.2333984375*x[2*N+1]+.025390625+.01953125*I[U])}const N=(N,p,T,U)=>{const M=A.xp.Lerp(i[0],i[2],p/C),b=A.xp.Lerp(i[1],i[2],p/C),l=C===p?i[2]:A.xp.Lerp(M,b,N/(C-p));let k;if(l.normalize(),a){const N=A.xp.Lerp(i[0],i[2],U/C),p=A.xp.Lerp(i[1],i[2],U/C);k=A.xp.Lerp(N,p,T/(C-U))}else k=new A.xp(l.x,l.y,l.z);k.x/=y,k.y/=e,k.z/=H,k.normalize();const x=A.Vector2.Lerp(K[0],K[2],p/C),I=A.Vector2.Lerp(K[1],K[2],p/C),F=C===p?K[2]:A.Vector2.Lerp(x,I,N/(C-p));n.push(l.x*y,l.y*e,l.z*H),w.push(k.x,k.y,k.z),g.push(F.x,X.d?1-F.y:F.y),L.push(P),P++};for(let p=0;p<C;p++)for(let T=0;T+p<C;T++)N(T,p,T+1/3,p+1/3),N(T+1,p,T+1/3,p+1/3),N(T,p+1,T+1/3,p+1/3),T+p+1<C&&(N(T+1,p,T+2/3,p+2/3),N(T+1,p+1,T+2/3,p+2/3),N(T,p+1,T+2/3,p+2/3))}U.c._ComputeSides(p,n,L,w,g,N.frontUVs,N.backUVs);const v=new U.c;return v.indices=L,v.vN=n,v.WN=w,v.RN=g,v}function r(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new a.d(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),A._originalBuilderSideOrientation=p.sideOrientation;return V(p).fN(A,p.updatable),A}U.c.CreatePolyhedron=h,a.d.CreatePolyhedron=(N,p,T)=>j(N,p,T);U.c.CreateIcoSphere=V,a.d.CreateIcoSphere=(N,p,T)=>r(N,p,T);var u=T(12390);const Y=new A.xp(1,0,0),D=new A.xp(-1,0,0),c=new A.xp(0,1,0),Q=new A.xp(0,-1,0),E=new A.xp(0,0,1),O=new A.xp(0,0,-1);class B{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.xp.Zero(),p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.xp.Up(),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Vector2.Zero(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=N,this.normal=p,this.uv=T,this.vertexIdx=a,this.vertexIdxForBones=C,this.localPositionOverride=U,this.localNormalOverride=X,this.matrixIndicesOverride=y,this.matrixWeightsOverride=e}clone(){var N,p,T,A;return new B(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(N=this.localPositionOverride)||void 0===N?void 0:N.slice(),null===(p=this.localNormalOverride)||void 0===p?void 0:p.slice(),null===(T=this.matrixIndicesOverride)||void 0===T?void 0:T.slice(),null===(A=this.matrixWeightsOverride)||void 0===A?void 0:A.slice())}}function d(N,p,T){var y,e,H,M,b;const l=!!p.skeleton,k=!(null===(y=p.morphTargetManager)||void 0===y||!y.numTargets),x=T.localMode||l,I=p.bX(),L=l||k?p.JX(!0,!0):p.getVerticesData(C.f.PositionKind),n=l||k?p.getNormalsData(!0,!0):p.getVerticesData(C.f.NormalKind),w=x?l?p.getVerticesData(C.f.PositionKind):L:null,g=x?l?p.getVerticesData(C.f.NormalKind):n:null,P=p.getVerticesData(C.f.UVKind),i=l?p.getVerticesData(C.f.MatricesIndicesKind):null,K=l?p.getVerticesData(C.f.MatricesWeightsKind):null,F=l?p.getVerticesData(C.f.MatricesIndicesExtraKind):null,v=l?p.getVerticesData(C.f.MatricesWeightsExtraKind):null,W=T.position||A.xp.Zero();let z=T.normal||A.xp.Up();const R=T.size||A.xp.One(),J=T.angle||0;if(!z){const N=new A.xp(0,0,1),T=p.KN().activeCamera,a=A.xp.TransformCoordinates(N,T.getWorldMatrix());z=T.globalPosition.Ip(a)}const f=-Math.atan2(z.z,z.x)-Math.PI/2,G=Math.sqrt(z.x*z.x+z.z*z.z),o=Math.atan2(z.y,G),Z=new U.c;Z.indices=[],Z.vN=[],Z.WN=[],Z.RN=[],Z.matricesIndices=l?[]:null,Z.matricesWeights=l?[]:null,Z.matricesIndicesExtra=F?[]:null,Z.matricesWeightsExtra=v?[]:null;let mN=0;const q=(N,p)=>{const a=new B;if(!I||!L||!n)return a;const C=I[N];if(a.vertexIdx=3*C,a.vertexIdxForBones=4*C,a.position=new A.xp(L[3*C],L[3*C+1],L[3*C+2]),A.xp.TransformCoordinatesToRef(a.position,p,a.position),a.normal=new A.xp(n[3*C],n[3*C+1],n[3*C+2]),A.xp.TransformNormalToRef(a.normal,p,a.normal),T.captureUVS&&P){const N=P[2*C+1];a.uv=new A.Vector2(P[2*C],X.d?1-N:N)}return a},h=[0,0,0,0],j=(N,p)=>{if(0===N.length)return N;const T=.5*Math.abs(A.xp.Dot(R,p)),a=(N,p,T,A)=>{for(let a=0;a<A;++a)if(N[T+a]===p)return T+a;return-1},C=(N,C)=>{const U=A.xp.GetClipFactor(N.position,C.position,p,T);let X=h,y=h;if(i&&K){const p=N.matrixIndicesOverride?0:N.vertexIdxForBones,T=N.matrixIndicesOverride??i,A=N.matrixWeightsOverride??K,e=C.matrixIndicesOverride?0:C.vertexIdxForBones,H=C.matrixIndicesOverride??i,M=C.matrixWeightsOverride??K;X=[0,0,0,0],y=[0,0,0,0];let b=0;for(let N=0;N<4;++N)if(A[p+N]>0){const C=a(H,T[p+N],e,4);X[b]=T[p+N],y[b]=(0,u.Lerp)(A[p+N],C>=0?M[C]:0,U),b++}for(let N=0;N<4&&b<4;++N){const A=H[e+N];-1===a(T,A,p,4)&&(X[b]=A,y[b]=(0,u.Lerp)(0,M[e+N],U),b++)}const l=y[0]+y[1]+y[2]+y[3];y[0]/=l,y[1]/=l,y[2]/=l,y[3]/=l}const e=N.localPositionOverride?N.localPositionOverride[0]:(null===w||void 0===w?void 0:w[N.vertexIdx])??0,H=N.localPositionOverride?N.localPositionOverride[1]:(null===w||void 0===w?void 0:w[N.vertexIdx+1])??0,M=N.localPositionOverride?N.localPositionOverride[2]:(null===w||void 0===w?void 0:w[N.vertexIdx+2])??0,b=C.localPositionOverride?C.localPositionOverride[0]:(null===w||void 0===w?void 0:w[C.vertexIdx])??0,l=C.localPositionOverride?C.localPositionOverride[1]:(null===w||void 0===w?void 0:w[C.vertexIdx+1])??0,k=C.localPositionOverride?C.localPositionOverride[2]:(null===w||void 0===w?void 0:w[C.vertexIdx+2])??0,x=N.localNormalOverride?N.localNormalOverride[0]:(null===g||void 0===g?void 0:g[N.vertexIdx])??0,I=N.localNormalOverride?N.localNormalOverride[1]:(null===g||void 0===g?void 0:g[N.vertexIdx+1])??0,L=N.localNormalOverride?N.localNormalOverride[2]:(null===g||void 0===g?void 0:g[N.vertexIdx+2])??0,n=x+((C.localNormalOverride?C.localNormalOverride[0]:(null===g||void 0===g?void 0:g[C.vertexIdx])??0)-x)*U,P=I+((C.localNormalOverride?C.localNormalOverride[1]:(null===g||void 0===g?void 0:g[C.vertexIdx+1])??0)-I)*U,F=L+((C.localNormalOverride?C.localNormalOverride[2]:(null===g||void 0===g?void 0:g[C.vertexIdx+2])??0)-L)*U,v=Math.sqrt(n*n+P*P+F*F);return new B(A.xp.Lerp(N.position,C.position,U),A.xp.Lerp(N.normal,C.normal,U).normalize(),A.Vector2.Lerp(N.uv,C.uv,U),-1,-1,w?[e+(b-e)*U,H+(l-H)*U,M+(k-M)*U]:null,g?[n/v,P/v,F/v]:null,X,y)};let U=null;N.length>3&&(U=[]);for(let X=0;X<N.length;X+=3){let a=0,y=null,e=null,H=null,M=null;const b=A.xp.Dot(N[X].position,p)-T>0,l=A.xp.Dot(N[X+1].position,p)-T>0,k=A.xp.Dot(N[X+2].position,p)-T>0;switch(a=(b?1:0)+(l?1:0)+(k?1:0),a){case 0:N.length>3?(U.push(N[X]),U.push(N[X+1]),U.push(N[X+2])):U=N;break;case 1:if(U=U??new Array,b&&(y=N[X+1],e=N[X+2],H=C(N[X],y),M=C(N[X],e)),l){y=N[X],e=N[X+2],H=C(N[X+1],y),M=C(N[X+1],e),U.push(H),U.push(e.clone()),U.push(y.clone()),U.push(e.clone()),U.push(H.clone()),U.push(M);break}k&&(y=N[X],e=N[X+1],H=C(N[X+2],y),M=C(N[X+2],e)),y&&e&&H&&M&&(U.push(y.clone()),U.push(e.clone()),U.push(H),U.push(M),U.push(H.clone()),U.push(e.clone()));break;case 2:U=U??new Array,b||(y=N[X].clone(),e=C(y,N[X+1]),H=C(y,N[X+2]),U.push(y),U.push(e),U.push(H)),l||(y=N[X+1].clone(),e=C(y,N[X+2]),H=C(y,N[X]),U.push(y),U.push(e),U.push(H)),k||(y=N[X+2].clone(),e=C(y,N[X]),H=C(y,N[X+1]),U.push(y),U.push(e),U.push(H))}}return U},V=p instanceof a.d?p:null,r=null===V||void 0===V?void 0:V._thinInstanceDataStorage.matrixData,d=(null===V||void 0===V?void 0:V.wX)||1,t=A.TmpVectors.Matrix[0];t.A(A.Matrix.IdentityReadOnly);for(let a=0;a<d;++a){if(null!==V&&void 0!==V&&V.hasThinInstances&&r){const N=16*a;t.setRowFromFloats(0,r[N+0],r[N+1],r[N+2],r[N+3]),t.setRowFromFloats(1,r[N+4],r[N+5],r[N+6],r[N+7]),t.setRowFromFloats(2,r[N+8],r[N+9],r[N+10],r[N+11]),t.setRowFromFloats(3,r[N+12],r[N+13],r[N+14],r[N+15])}const N=A.Matrix.RotationYawPitchRoll(f,o,J).multiply(A.Matrix.Translation(W.x,W.y,W.z)),C=A.Matrix.Invert(N),U=p.getWorldMatrix(),y=t.multiply(U).multiply(C),e=new Array(3);for(let p=0;p<I.length;p+=3){let N=e;if(N[0]=q(p,y),N[1]=q(p+1,y),N[2]=q(p+2,y),!(T.cullBackFaces&&-N[0].normal.z<=0&&-N[1].normal.z<=0&&-N[2].normal.z<=0)&&(N=j(N,Y),N&&(N=j(N,D),N&&(N=j(N,c),N&&(N=j(N,Q),N&&(N=j(N,E),N&&(N=j(N,O),N)))))))for(let p=0;p<N.length;p++){const A=N[p];if(Z.indices.push(mN),x?(A.localPositionOverride?(Z.vN[3*mN]=A.localPositionOverride[0],Z.vN[3*mN+1]=A.localPositionOverride[1],Z.vN[3*mN+2]=A.localPositionOverride[2]):w&&(Z.vN[3*mN]=w[A.vertexIdx],Z.vN[3*mN+1]=w[A.vertexIdx+1],Z.vN[3*mN+2]=w[A.vertexIdx+2]),A.localNormalOverride?(Z.WN[3*mN]=A.localNormalOverride[0],Z.WN[3*mN+1]=A.localNormalOverride[1],Z.WN[3*mN+2]=A.localNormalOverride[2]):g&&(Z.WN[3*mN]=g[A.vertexIdx],Z.WN[3*mN+1]=g[A.vertexIdx+1],Z.WN[3*mN+2]=g[A.vertexIdx+2])):(A.position.toArray(Z.vN,3*mN),A.normal.toArray(Z.WN,3*mN)),Z.matricesIndices&&Z.matricesWeights&&(A.matrixIndicesOverride?(Z.matricesIndices[4*mN]=A.matrixIndicesOverride[0],Z.matricesIndices[4*mN+1]=A.matrixIndicesOverride[1],Z.matricesIndices[4*mN+2]=A.matrixIndicesOverride[2],Z.matricesIndices[4*mN+3]=A.matrixIndicesOverride[3]):(i&&(Z.matricesIndices[4*mN]=i[A.vertexIdxForBones],Z.matricesIndices[4*mN+1]=i[A.vertexIdxForBones+1],Z.matricesIndices[4*mN+2]=i[A.vertexIdxForBones+2],Z.matricesIndices[4*mN+3]=i[A.vertexIdxForBones+3]),F&&Z.matricesIndicesExtra&&(Z.matricesIndicesExtra[4*mN]=F[A.vertexIdxForBones],Z.matricesIndicesExtra[4*mN+1]=F[A.vertexIdxForBones+1],Z.matricesIndicesExtra[4*mN+2]=F[A.vertexIdxForBones+2],Z.matricesIndicesExtra[4*mN+3]=F[A.vertexIdxForBones+3])),A.matrixWeightsOverride?(Z.matricesWeights[4*mN]=A.matrixWeightsOverride[0],Z.matricesWeights[4*mN+1]=A.matrixWeightsOverride[1],Z.matricesWeights[4*mN+2]=A.matrixWeightsOverride[2],Z.matricesWeights[4*mN+3]=A.matrixWeightsOverride[3]):(K&&(Z.matricesWeights[4*mN]=K[A.vertexIdxForBones],Z.matricesWeights[4*mN+1]=K[A.vertexIdxForBones+1],Z.matricesWeights[4*mN+2]=K[A.vertexIdxForBones+2],Z.matricesWeights[4*mN+3]=K[A.vertexIdxForBones+3]),v&&Z.matricesWeightsExtra&&(Z.matricesWeightsExtra[4*mN]=v[A.vertexIdxForBones],Z.matricesWeightsExtra[4*mN+1]=v[A.vertexIdxForBones+1],Z.matricesWeightsExtra[4*mN+2]=v[A.vertexIdxForBones+2],Z.matricesWeightsExtra[4*mN+3]=v[A.vertexIdxForBones+3]))),T.captureUVS)A.uv.toArray(Z.RN,2*mN);else{Z.RN.push(.5+A.position.x/R.x);const N=.5+A.position.y/R.y;Z.RN.push(X.d?1-N:N)}mN++}}}0===Z.indices.length&&(Z.indices=null),0===Z.vN.length&&(Z.vN=null),0===Z.WN.length&&(Z.WN=null),0===Z.RN.length&&(Z.RN=null),0===(null===(e=Z.matricesIndices)||void 0===e?void 0:e.length)&&(Z.matricesIndices=null),0===(null===(H=Z.matricesWeights)||void 0===H?void 0:H.length)&&(Z.matricesWeights=null),0===(null===(M=Z.matricesIndicesExtra)||void 0===M?void 0:M.length)&&(Z.matricesIndicesExtra=null),0===(null===(b=Z.matricesWeightsExtra)||void 0===b?void 0:b.length)&&(Z.matricesWeightsExtra=null);const S=new a.d(N,p.KN());return Z.fN(S),x?(S.skeleton=p.skeleton,S.parent=p):(S.position=W.clone(),S.rotation=new A.xp(o,f,J)),S.HX(!0),S.refreshBoundingInfo(!0,!0),S}function t(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const p=0|Math.max(N.subdivisions?N.subdivisions:2,1),T=0|Math.max(N.tessellation?N.tessellation:16,3),a=Math.max(N.height?N.height:1,0),C=Math.max(N.radius?N.radius:.25,0),y=0|Math.max(N.capSubdivisions?N.capSubdivisions:6,1),e=T,H=p,M=Math.max(N.radiusTop?N.radiusTop:C,0),b=Math.max(N.radiusBottom?N.radiusBottom:C,0),l=a-(M+b),k=2*Math.PI,x=Math.max(N.topCapSubdivisions?N.topCapSubdivisions:y,1),I=Math.max(N.bottomCapSubdivisions?N.bottomCapSubdivisions:y,1),L=Math.acos((b-M)/a);let n=[];const w=[],g=[],P=[];let i=0;const K=[],F=.5*l,v=.5*Math.PI;let W,z;const R=A.xp.Zero(),J=A.xp.Zero(),f=Math.cos(L),G=Math.sin(L),o=new A.Vector2(M*G,F+M*f).Ip(new A.Vector2(b*G,b*f-F)).length(),Z=M*L+o+b*(v-L);let mN=0;for(z=0;z<=x;z++){const N=[],p=v-L*(z/x);mN+=M*L/x;const T=Math.cos(p),A=Math.sin(p),a=T*M;for(W=0;W<=e;W++){const p=W/e,C=p*k+0,U=Math.sin(C),y=Math.cos(C);J.x=a*U,J.y=F+A*M,J.z=a*y,w.push(J.x,J.y,J.z),R.set(T*U,A,T*y),g.push(R.x,R.y,R.z),P.push(p,X.d?mN/Z:1-mN/Z),N.push(i),i++}K.push(N)}const q=a-M-b+f*M-f*b,h=G*(b-M)/q;for(z=1;z<=H;z++){const N=[];mN+=o/H;const p=G*(z*(b-M)/H+M);for(W=0;W<=e;W++){const T=W/e,A=T*k+0,a=Math.sin(A),C=Math.cos(A);J.x=p*a,J.y=F+f*M-z*q/H,J.z=p*C,w.push(J.x,J.y,J.z),R.set(a,h,C).normalize(),g.push(R.x,R.y,R.z),P.push(T,X.d?mN/Z:1-mN/Z),N.push(i),i++}K.push(N)}for(z=1;z<=I;z++){const N=[],p=v-L-(Math.PI-L)*(z/I);mN+=b*L/I;const T=Math.cos(p),A=Math.sin(p),a=T*b;for(W=0;W<=e;W++){const p=W/e,C=p*k+0,U=Math.sin(C),y=Math.cos(C);J.x=a*U,J.y=A*b-F,J.z=a*y,w.push(J.x,J.y,J.z),R.set(T*U,A,T*y),g.push(R.x,R.y,R.z),P.push(p,X.d?mN/Z:1-mN/Z),N.push(i),i++}K.push(N)}for(W=0;W<e;W++)for(z=0;z<x+H+I;z++){const N=K[z][W],p=K[z+1][W],T=K[z+1][W+1],A=K[z][W+1];n.push(N),n.push(p),n.push(A),n.push(p),n.push(T),n.push(A)}if(n=n.reverse(),N.orientation&&!N.orientation.equals(A.xp.Up())){const p=new A.Matrix;N.orientation.clone().scale(.5*Math.PI).cross(A.xp.Up()).toQuaternion().toRotationMatrix(p);const T=A.xp.Zero();for(let N=0;N<w.length;N+=3)T.set(w[N],w[N+1],w[N+2]),A.xp.TransformCoordinatesToRef(T.clone(),p,T),w[N]=T.x,w[N+1]=T.y,w[N+2]=T.z}const j=new U.c;return j.vN=w,j.WN=g,j.RN=P,j.indices=n,j}function S(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:A.xp.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new a.d(N,T);return t(p).fN(C,p.updatable),C}a.d.CreateDecal=(N,p,T,A,a,C)=>d(N,p,{position:T,normal:A,size:a,angle:C});a.d.CreateCapsule=(N,p,T)=>S(N,p,T),U.c.CreateCapsule=t;var s=T(12205),NN=T(12376);class pN{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=N,this.y=p,N!==Math.floor(N)&&(N=Math.floor(N),s.d.Warn("x is not an integer, floor(x) used")),p!==Math.floor(p)&&(p=Math.floor(p),s.d.Warn("y is not an integer, floor(y) used"))}clone(){return new pN(this.x,this.y)}rotate60About(N){const p=this.x;return this.x=N.x+N.y-this.y,this.y=p+this.y-N.x,this}rotateNeg60About(N){const p=this.x;return this.x=p+this.y-N.y,this.y=N.x+N.y-p,this}rotate120(N,p){N!==Math.floor(N)&&(N=Math.floor(N),s.d.Warn("m not an integer only floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),s.d.Warn("n not an integer only floor(n) used"));const T=this.x;return this.x=N-T-this.y,this.y=p+T,this}rotateNeg120(N,p){N!==Math.floor(N)&&(N=Math.floor(N),s.d.Warn("m is not an integer, floor(m) used")),p!==Math.floor(p)&&(p=Math.floor(p),s.d.Warn("n is not an integer,   floor(n) used"));const T=this.x;return this.x=this.y-p,this.y=N+p-T-this.y,this}toCartesianOrigin(N,p){const T=A.xp.Zero();return T.x=N.x+2*this.x*p+this.y*p,T.y=N.y+Math.sqrt(3)*this.y*p,T}static Zero(){return new pN(0,0)}}class TN{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new AN("icosahedron","Regular",[[0,NN.d,-1],[-NN.d,1,0],[-1,0,-NN.d],[1,0,-NN.d],[NN.d,1,0],[0,NN.d,1],[-1,0,NN.d],[-NN.d,-1,0],[0,-NN.d,-1],[NN.d,-1,0],[1,0,NN.d],[0,-NN.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let N=12;const p={},T=this.m,A=this.n;let a,C,U,X,y,e=T,H=1,M=0;0!==A&&(e=(0,u.HighestCommonFactor)(T,A)),H=T/e,M=A/e;const b=pN.Zero(),l=new pN(T,A),k=new pN(-A,T+A),x=pN.Zero(),I=pN.Zero(),L=pN.Zero();let n,w,g,P,i=[];const K=[],F=this.vertByDist,v=(T,A,a,C)=>{n=T+"|"+a,w=A+"|"+C,n in p||w in p?n in p&&!(w in p)?p[w]=p[n]:w in p&&!(n in p)&&(p[n]=p[w]):(p[n]=N,p[w]=N,N++),F[a][0]>2?K[p[n]]=[-F[a][0],F[a][1],p[n]]:K[p[n]]=[i[F[a][0]],F[a][1],p[n]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let W=0;W<20;W++){if(i=this.IDATA.face[W],U=i[2],X=i[1],y=i[0],g=b.x+"|"+b.y,n=W+"|"+g,n in p||(p[n]=U,K[U]=[i[F[g][0]],F[g][1]]),g=l.x+"|"+l.y,n=W+"|"+g,n in p||(p[n]=X,K[X]=[i[F[g][0]],F[g][1]]),g=k.x+"|"+k.y,n=W+"|"+g,n in p||(p[n]=y,K[y]=[i[F[g][0]],F[g][1]]),a=this.IDATA.edgematch[W][0],C=this.IDATA.edgematch[W][1],"B"===C)for(let N=1;N<e;N++)I.x=T-N*(H+M),I.y=A+N*H,L.x=-N*M,L.y=N*(H+M),g=I.x+"|"+I.y,P=L.x+"|"+L.y,v(W,a,g,P);if("O"===C)for(let N=1;N<e;N++)L.x=-N*M,L.y=N*(H+M),x.x=N*H,x.y=N*M,g=L.x+"|"+L.y,P=x.x+"|"+x.y,v(W,a,g,P);if(a=this.IDATA.edgematch[W][2],C=this.IDATA.edgematch[W][3],C&&"A"===C)for(let N=1;N<e;N++)x.x=N*H,x.y=N*M,I.x=T-(e-N)*(H+M),I.y=A+(e-N)*H,g=x.x+"|"+x.y,P=I.x+"|"+I.y,v(W,a,g,P);for(let T=0;T<this.vertices.length;T++)g=this.vertices[T].x+"|"+this.vertices[T].y,n=W+"|"+g,n in p||(p[n]=N++,F[g][0]>2?K[p[n]]=[-F[g][0],F[g][1],p[n]]:K[p[n]]=[i[F[g][0]],F[g][1],p[n]])}this.closestTo=K,this.vecToidx=p}calcCoeffs(){const N=this.m,p=this.n,T=Math.sqrt(3)/3,A=N*N+p*p+N*p;this.coau=(N+p)/A,this.cobu=-p/A,this.coav=-T*(N-p)/A,this.cobv=T*(2*N+p)/A}createInnerFacets(){const N=this.m,p=this.n;for(let T=0;T<p+N+1;T++)for(let N=this.min[T];N<this.max[T]+1;N++)N<this.max[T]&&N<this.max[T+1]+1&&this.innerFacets.push(["|"+N+"|"+T,"|"+N+"|"+(T+1),"|"+(N+1)+"|"+T]),T>0&&N<this.max[T-1]&&N+1<this.max[T]+1&&this.innerFacets.push(["|"+N+"|"+T,"|"+(N+1)+"|"+T,"|"+(N+1)+"|"+(T-1)])}edgeVecsABOB(){const N=this.m,p=this.n,T=new pN(-p,N+p);for(let A=1;A<N+p;A++){const N=new pN(this.min[A],A),p=new pN(this.min[A-1],A-1),a=new pN(this.min[A+1],A+1),C=N.clone(),U=p.clone(),X=a.clone();C.rotate60About(T),U.rotate60About(T),X.rotate60About(T);const y=new pN(this.max[C.y],C.y),e=new pN(this.max[C.y-1],C.y-1),H=new pN(this.max[C.y-1]-1,C.y-1);C.x===y.x&&C.y===y.y||(C.x!==e.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,e,H]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,H,y])):C.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,p,e]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([N,e,a])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([N,p,e]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([N,e,y])))}}mapABOBtoOBOA(){const N=new pN(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const T=[];for(let A=0;A<3;A++)N.x=this.isoVecsABOB[p][A].x,N.y=this.isoVecsABOB[p][A].y,0===this.vertexTypes[p][A]&&N.rotateNeg120(this.m,this.n),T.push(N.clone());this.isoVecsOBOA.push(T)}}mapABOBtoBAOA(){const N=new pN(0,0);for(let p=0;p<this.isoVecsABOB.length;p++){const T=[];for(let A=0;A<3;A++)N.x=this.isoVecsABOB[p][A].x,N.y=this.isoVecsABOB[p][A].y,1===this.vertexTypes[p][A]&&N.rotate120(this.m,this.n),T.push(N.clone());this.isoVecsBAOA.push(T)}}MapToFace(N,p){const T=this.IDATA.face[N],a=T[2],C=T[1],U=T[0],X=A.xp.gp(this.IDATA.vertex[a]),y=A.xp.gp(this.IDATA.vertex[C]),e=A.xp.gp(this.IDATA.vertex[U]),H=y.Ip(X),M=e.Ip(X),b=H.scale(this.coau).add(M.scale(this.cobu)),l=H.scale(this.coav).add(M.scale(this.cobv)),k=[];let x,I=A.TmpVectors.xp[0];for(let A=0;A<this.cartesian.length;A++)I=b.scale(this.cartesian[A].x).add(l.scale(this.cartesian[A].y)).add(X),k[A]=[I.x,I.y,I.z],x=N+"|"+this.vertices[A].x+"|"+this.vertices[A].y,p.vertex[this.vecToidx[x]]=[I.x,I.y,I.z]}build(N,p){const T=[],A=pN.Zero(),a=new pN(N,p),C=new pN(-p,N+p);T.push(A,a,C);for(let g=p;g<N+1;g++)for(let p=0;p<N+1-g;p++)T.push(new pN(p,g));if(p>0){const A=(0,u.HighestCommonFactor)(N,p),a=N/A,C=p/A;for(let X=1;X<A;X++)T.push(new pN(X*a,X*C)),T.push(new pN(-X*C,X*(a+C))),T.push(new pN(N-X*(a+C),p+X*a));const U=N/p;for(let X=1;X<p;X++)for(let A=0;A<X*U;A++)T.push(new pN(A,X)),T.push(new pN(A,X).rotate120(N,p)),T.push(new pN(A,X).rotateNeg120(N,p))}T.sort(((N,p)=>N.x-p.x)),T.sort(((N,p)=>N.y-p.y));const U=new Array(N+p+1),X=new Array(N+p+1);for(let g=0;g<U.length;g++)U[g]=1/0,X[g]=-1/0;let y=0,e=0;const H=T.length;for(let g=0;g<H;g++)e=T[g].x,y=T[g].y,U[y]=Math.min(e,U[y]),X[y]=Math.max(e,X[y]);const M=(T,A)=>{const a=T.clone();return"A"===A&&a.rotateNeg120(N,p),"B"===A&&a.rotate120(N,p),a.x<0?a.y:a.x+a.y},b=[],l=[],k=[],x=[],I={},L=[];let n=-1,w=-1;for(let g=0;g<H;g++)b[g]=T[g].toCartesianOrigin(new pN(0,0),.5),l[g]=M(T[g],"O"),k[g]=M(T[g],"A"),x[g]=M(T[g],"B"),l[g]===k[g]&&k[g]===x[g]?(n=3,w=l[g]):l[g]===k[g]?(n=4,w=l[g]):k[g]===x[g]?(n=5,w=k[g]):x[g]===l[g]&&(n=6,w=l[g]),l[g]<k[g]&&l[g]<x[g]&&(n=2,w=l[g]),k[g]<l[g]&&k[g]<x[g]&&(n=1,w=k[g]),x[g]<k[g]&&x[g]<l[g]&&(n=0,w=x[g]),L.push([n,w,T[g].x,T[g].y]);L.sort(((N,p)=>N[2]-p[2])),L.sort(((N,p)=>N[3]-p[3])),L.sort(((N,p)=>N[1]-p[1])),L.sort(((N,p)=>N[0]-p[0]));for(let g=0;g<L.length;g++)I[L[g][2]+"|"+L[g][3]]=[L[g][0],L[g][1],g];return this.m=N,this.n=p,this.vertices=T,this.vertByDist=I,this.cartesian=b,this.min=U,this.max=X,this}}class AN{constructor(N,p,T,A){this.name=N,this.category=p,this.vertex=T,this.face=A}}class aN extends AN{innerToData(N,p){for(let T=0;T<p.innerFacets.length;T++)this.face.push(p.innerFacets[T].map((T=>p.vecToidx[N+T])))}mapABOBtoDATA(N,p){const T=p.IDATA.edgematch[N][0];for(let A=0;A<p.isoVecsABOB.length;A++){const a=[];for(let C=0;C<3;C++)0===p.vertexTypes[A][C]?a.push(N+"|"+p.isoVecsABOB[A][C].x+"|"+p.isoVecsABOB[A][C].y):a.push(T+"|"+p.isoVecsABOB[A][C].x+"|"+p.isoVecsABOB[A][C].y);this.face.push([p.vecToidx[a[0]],p.vecToidx[a[1]],p.vecToidx[a[2]]])}}mapOBOAtoDATA(N,p){const T=p.IDATA.edgematch[N][0];for(let A=0;A<p.isoVecsOBOA.length;A++){const a=[];for(let C=0;C<3;C++)1===p.vertexTypes[A][C]?a.push(N+"|"+p.isoVecsOBOA[A][C].x+"|"+p.isoVecsOBOA[A][C].y):a.push(T+"|"+p.isoVecsOBOA[A][C].x+"|"+p.isoVecsOBOA[A][C].y);this.face.push([p.vecToidx[a[0]],p.vecToidx[a[1]],p.vecToidx[a[2]]])}}mapBAOAtoDATA(N,p){const T=p.IDATA.edgematch[N][2];for(let A=0;A<p.isoVecsBAOA.length;A++){const a=[];for(let C=0;C<3;C++)1===p.vertexTypes[A][C]?a.push(N+"|"+p.isoVecsBAOA[A][C].x+"|"+p.isoVecsBAOA[A][C].y):a.push(T+"|"+p.isoVecsBAOA[A][C].x+"|"+p.isoVecsBAOA[A][C].y);this.face.push([p.vecToidx[a[0]],p.vecToidx[a[1]],p.vecToidx[a[2]]])}}orderData(N){const p=[];for(let C=0;C<13;C++)p[C]=[];const T=N.closestTo;for(let C=0;C<T.length;C++)T[C][0]>-1?T[C][1]>0&&p[T[C][0]].push([C,T[C][1]]):p[12].push([C,T[C][0]]);const A=[];for(let C=0;C<12;C++)A[C]=C;let a=12;for(let C=0;C<12;C++){p[C].sort(((N,p)=>N[1]-p[1]));for(let N=0;N<p[C].length;N++)A[p[C][N][0]]=a++}for(let C=0;C<p[12].length;C++)A[p[12][C][0]]=a++;for(let C=0;C<this.vertex.length;C++)this.vertex[C].push(A[C]);this.vertex.sort(((N,p)=>N[3]-p[3]));for(let C=0;C<this.vertex.length;C++)this.vertex[C].pop();for(let C=0;C<this.face.length;C++)for(let N=0;N<this.face[C].length;N++)this.face[C][N]=A[this.face[C][N]];this.sharedNodes=p[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(N,p){const T=[],A=[];let a=p.pop();A.push(a);let C=this.face[a].indexOf(N);C=(C+2)%3;let U=this.face[a][C];T.push(U);let X=0;for(;p.length>0;)a=p[X],this.face[a].indexOf(U)>-1?(C=(this.face[a].indexOf(U)+1)%3,U=this.face[a][C],T.push(U),A.push(a),p.splice(X,1),X=0):X++;return this.adjacentFaces.push(T),A}toGoldbergPolyhedronData(){const N=new AN("GeoDual","Goldberg",[],[]);N.name="GD dual";const p=this.vertex.length,T=new Array(p);for(let y=0;y<p;y++)T[y]=[];for(let y=0;y<this.face.length;y++)for(let N=0;N<3;N++)T[this.face[y][N]].push(y);let A=0,a=0,C=0,U=[],X=[];this.adjacentFaces=[];for(let y=0;y<T.length;y++){N.face[y]=this.setOrder(y,T[y].concat([]));for(const p of T[y]){A=0,a=0,C=0,U=this.face[p];for(let N=0;N<3;N++)X=this.vertex[U[N]],A+=X[0],a+=X[1],C+=X[2];N.vertex[p]=[A/3,a/3,C/3]}}return N}static BuildGeodesicData(N){const p=new aN("Geodesic-m-n","Geodesic",[[0,NN.d,-1],[-NN.d,1,0],[-1,0,-NN.d],[1,0,-NN.d],[NN.d,1,0],[0,NN.d,1],[-1,0,NN.d],[-NN.d,-1,0],[0,-NN.d,-1],[NN.d,-1,0],[1,0,NN.d],[0,-NN.d,1]],[]);N.setIndices(),N.calcCoeffs(),N.createInnerFacets(),N.edgeVecsABOB(),N.mapABOBtoOBOA(),N.mapABOBtoBAOA();for(let T=0;T<N.IDATA.face.length;T++)N.MapToFace(T,p),p.innerToData(T,N),"B"===N.IDATA.edgematch[T][1]&&p.mapABOBtoDATA(T,N),"O"===N.IDATA.edgematch[T][1]&&p.mapOBOAtoDATA(T,N),"A"===N.IDATA.edgematch[T][3]&&p.mapBAOAtoDATA(T,N);p.orderData(N);return p.vertex=p.vertex.map((function(N){const p=N[0],T=N[1],A=N[2],a=Math.sqrt(p*p+T*T+A*A);return N[0]*=1/a,N[1]*=1/a,N[2]*=1/a,N})),p}}a.d._GoldbergMeshParser=(N,p)=>CN.Parse(N,p);class CN extends a.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(N,p){return void 0===p?(N>this.goldbergData.nbUnsharedFaces-1&&(s.d.Warn("Maximum number of unshared faces used"),N=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+N):(N>11&&(s.d.Warn("Last pole used"),N=11),p>this.goldbergData.nbFacesAtPole-1&&(s.d.Warn("Maximum number of faces at a pole used"),p=this.goldbergData.nbFacesAtPole-1),12+N*this.goldbergData.nbFacesAtPole+p)}_changeGoldbergFaceColors(N){for(let T=0;T<N.length;T++){const p=N[T][0],A=N[T][1],a=N[T][2];for(let N=p;N<A+1;N++)this.goldbergData.faceColors[N]=a}const p=[];for(let T=0;T<12;T++)for(let N=0;N<5;N++)p.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);for(let T=12;T<this.goldbergData.faceColors.length;T++)for(let N=0;N<6;N++)p.push(this.goldbergData.faceColors[T].r,this.goldbergData.faceColors[T].g,this.goldbergData.faceColors[T].b,this.goldbergData.faceColors[T].a);return p}setGoldbergFaceColors(N){const p=this._changeGoldbergFaceColors(N);this.mp(C.f.ColorKind,p)}updateGoldbergFaceColors(N){const p=this._changeGoldbergFaceColors(N);this.updateVerticesData(C.f.ColorKind,p)}_changeGoldbergFaceUVs(N){const p=this.getVerticesData(C.f.UVKind);for(let T=0;T<N.length;T++){const A=N[T][0],a=N[T][1],C=N[T][2],U=N[T][3],X=N[T][4],y=[],e=[];let H,M;for(let N=0;N<5;N++)H=C.x+U*Math.cos(X+N*Math.PI/2.5),M=C.y+U*Math.sin(X+N*Math.PI/2.5),H<0&&(H=0),H>1&&(H=1),y.push(H,M);for(let N=0;N<6;N++)H=C.x+U*Math.cos(X+N*Math.PI/3),M=C.y+U*Math.sin(X+N*Math.PI/3),H<0&&(H=0),H>1&&(H=1),e.push(H,M);for(let N=A;N<Math.min(12,a+1);N++)for(let T=0;T<5;T++)p[10*N+2*T]=y[2*T],p[10*N+2*T+1]=y[2*T+1];for(let N=Math.max(12,A);N<a+1;N++)for(let T=0;T<6;T++)p[12*N-24+2*T]=e[2*T],p[12*N-23+2*T]=e[2*T+1]}return p}setGoldbergFaceUVs(N){const p=this._changeGoldbergFaceUVs(N);this.mp(C.f.UVKind,p)}updateGoldbergFaceUVs(N){const p=this._changeGoldbergFaceUVs(N);this.updateVerticesData(C.f.UVKind,p)}placeOnGoldbergFaceAt(N,p,T){const a=A.xp.RotationFromAxis(this.goldbergData.faceXaxis[p],this.goldbergData.faceYaxis[p],this.goldbergData.faceZaxis[p]);N.rotation=a,N.position=this.goldbergData.faceCenters[p].add(this.goldbergData.faceXaxis[p].scale(T.x)).add(this.goldbergData.faceYaxis[p].scale(T.y)).add(this.goldbergData.faceZaxis[p].scale(T.z))}serialize(N){super.serialize(N),N.type="GoldbergMesh";const p={};if(p.adjacentFaces=this.goldbergData.adjacentFaces,p.nbSharedFaces=this.goldbergData.nbSharedFaces,p.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,p.nbFaces=this.goldbergData.nbFaces,p.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){p.faceColors=[];for(const N of this.goldbergData.faceColors)p.faceColors.push(N.UX())}if(this.goldbergData.faceCenters){p.faceCenters=[];for(const N of this.goldbergData.faceCenters)p.faceCenters.push(N.UX())}if(this.goldbergData.faceZaxis){p.faceZaxis=[];for(const N of this.goldbergData.faceZaxis)p.faceZaxis.push(N.UX())}if(this.goldbergData.faceYaxis){p.faceYaxis=[];for(const N of this.goldbergData.faceYaxis)p.faceYaxis.push(N.UX())}if(this.goldbergData.faceXaxis){p.faceXaxis=[];for(const N of this.goldbergData.faceXaxis)p.faceXaxis.push(N.UX())}N.goldbergData=p}static Parse(N,p){const T=N.goldbergData;T.faceColors=T.faceColors.map((N=>b.LX.gp(N))),T.faceCenters=T.faceCenters.map((N=>A.xp.gp(N))),T.faceZaxis=T.faceZaxis.map((N=>A.xp.gp(N))),T.faceXaxis=T.faceXaxis.map((N=>A.xp.gp(N))),T.faceYaxis=T.faceYaxis.map((N=>A.xp.gp(N)));const a=new CN(N.name,p);return a.goldbergData=T,a}}var UN=T(12938);const XN={CreateBox:M.d,CreateTiledBox:I,CreateSphere:L.e,CreateDisc:H.d,CreateIcoSphere:r,CreateRibbon:e,CreateCylinder:P,CreateTorus:K,CreateTorusKnot:v,CreateLineSystem:W.i,fe:W.k,CreateDashedLines:W.e,ExtrudeShape:J,ExtrudeShapeCustom:f,CreateLathe:o,CreateTiledPlane:k,Ye:Z.d,CreateGround:mN.h,CreateTiledGround:mN.i,CreateGroundFromHeightMap:mN.e,CreatePolygon:z.d,ExtrudePolygon:z.f,CreateTube:q,CreatePolyhedron:j,CreateGeodesic:function(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=p.m||1;A!==Math.floor(A)&&(A=Math.floor(A),s.d.Warn("m not an integer only floor(m) used"));let a=p.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),s.d.Warn("n not an integer only floor(n) used")),a>A){const N=a;a=A,A=N,s.d.Warn("n > m therefore m and n swapped")}const C=new TN;return C.build(A,a),j(N,{custom:aN.BuildGeodesicData(C),size:p.size,sizeX:p.sizeX,sizeY:p.sizeY,sizeZ:p.sizeZ,faceUV:p.faceUV,faceColors:p.faceColors,flat:p.flat,updatable:p.updatable,sideOrientation:p.sideOrientation,frontUVs:p.frontUVs,backUVs:p.backUVs},T)},CreateGoldberg:function(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=p.size,y=p.sizeX||C||1,e=p.sizeY||C||1,H=p.sizeZ||C||1;let M=p.m||1;M!==Math.floor(M)&&(M=Math.floor(M),s.d.Warn("m not an integer only floor(m) used"));let l=p.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),s.d.Warn("n not an integer only floor(n) used")),l>M){const N=l;l=M,M=N,s.d.Warn("n > m therefore m and n swapped")}const k=new TN;k.build(M,l);const x=aN.BuildGeodesicData(k),I=x.toGoldbergPolyhedronData(),L=new CN(N,T);p.sideOrientation=a.d._GetDefaultSideOrientation(p.sideOrientation),L._originalBuilderSideOrientation=p.sideOrientation;(function(N,p){const T=N.size,a=N.sizeX||T||1,C=N.sizeY||T||1,y=N.sizeZ||T||1,e=0===N.sideOrientation?0:N.sideOrientation||U.c.DEFAULTSIDE,H=[],M=[],b=[],l=[];let k=1/0,x=-1/0,I=1/0,L=-1/0;for(let A=0;A<p.vertex.length;A++)k=Math.min(k,p.vertex[A][0]*a),x=Math.max(x,p.vertex[A][0]*a),I=Math.min(I,p.vertex[A][1]*C),L=Math.max(L,p.vertex[A][1]*C);let n=0;for(let U=0;U<p.face.length;U++){const N=p.face[U],T=A.xp.gp(p.vertex[N[0]]),e=A.xp.gp(p.vertex[N[2]]),w=A.xp.gp(p.vertex[N[1]]),g=e.Ip(T),P=w.Ip(T),i=A.xp.Cross(P,g).normalize();for(let A=0;A<N.length;A++){b.push(i.x,i.y,i.z);const T=p.vertex[N[A]];H.push(T[0]*a,T[1]*C,T[2]*y);const U=(T[1]*C-I)/(L-I);l.push((T[0]*a-k)/(x-k),X.d?1-U:U)}for(let p=0;p<N.length-2;p++)M.push(n,n+p+2,n+p+1);n+=N.length}U.c._ComputeSides(e,H,M,b,l);const w=new U.c;return w.vN=H,w.indices=M,w.WN=b,w.RN=l,w})(p,I).fN(L,p.updatable),L.goldbergData.nbSharedFaces=x.sharedNodes,L.goldbergData.nbUnsharedFaces=x.poleNodes,L.goldbergData.adjacentFaces=x.adjacentFaces,L.goldbergData.nbFaces=L.goldbergData.nbSharedFaces+L.goldbergData.nbUnsharedFaces,L.goldbergData.nbFacesAtPole=(L.goldbergData.nbUnsharedFaces-12)/12;for(let a=0;a<x.vertex.length;a++)L.goldbergData.faceCenters.push(A.xp.gp(x.vertex[a])),L.goldbergData.faceCenters[a].x*=y,L.goldbergData.faceCenters[a].y*=e,L.goldbergData.faceCenters[a].z*=H,L.goldbergData.faceColors.push(new b.LX(1,1,1,1));for(let a=0;a<I.face.length;a++){const N=I.face[a],p=A.xp.gp(I.vertex[N[0]]),T=A.xp.gp(I.vertex[N[2]]),C=A.xp.gp(I.vertex[N[1]]),U=T.Ip(p),X=C.Ip(p),y=A.xp.Cross(X,U).normalize(),e=A.xp.Cross(X,y).normalize();L.goldbergData.faceXaxis.push(X.normalize()),L.goldbergData.faceYaxis.push(y),L.goldbergData.faceZaxis.push(e)}return L},CreateDecal:d,CreateCapsule:S,CreateText:UN.h}},13682:(N,p,T)=>{"use strict";T.d(p,{c:()=>Xp});var A=T(12371),a=T(12761);class C extends a.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var U=T(12421),X=(T(12543),T(12331));class y{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this._targetStopDuration!==N&&(this._targetStopDuration=N)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){this._noiseTexture!==N&&(this._noiseTexture=N,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(N){this._isAnimationSheetEnabled!=N&&(this._isAnimationSheetEnabled=N,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(N){this._useLogarithmicDepth=N&&this.KN().getEngine().getCaps().fragmentDepthSupported}KN(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(N){switch(N){case y.BLENDMODE_MULTIPLYADD:return;case y.BLENDMODE_ADD:N=1;break;case y.BLENDMODE_ONEONE:N=6;break;case y.BLENDMODE_STANDARD:N=2;break;case y.BLENDMODE_MULTIPLY:N=4;break;case y.BLENDMODE_SUBTRACT:N=3}this._engine.setAlphaMode(N)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:A.xp.Zero()}set direction1(N){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=N)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:A.xp.Zero()}set direction2(N){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=N)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:A.xp.Zero()}set minEmitBox(N){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=N)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:A.xp.Zero()}set maxEmitBox(N){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=N)}get billboardMode(){return this._billboardMode}set billboardMode(N){this._billboardMode!==N&&(this._billboardMode=N,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(N){this._isBillboardBased!==N&&(this._isBillboardBased=N,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(N){this._attachImageProcessingConfiguration(N)}_attachImageProcessingConfiguration(N){N!==this._imageProcessingConfiguration&&(!N&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=N)}_reset(){}_removeGradientAndTexture(N,p,T){if(!p)return this;let A=0;for(const a of p){if(a.gradient===N){p.splice(A,1);break}A++}return T&&T.dispose(),this}constructor(N){this.animations=[],this.renderingGroupId=0,this.Ap=A.xp.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new A.xp(10,10,10),this.onAnimationEnd=null,this.blendMode=y.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new A.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.ve=new A.xp(0,0,0),this._useLogarithmicDepth=!1,this.gravity=A.xp.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new U.LX(1,1,1,1),this.color2=new U.LX(1,1,1,1),this.colorDead=new U.LX(0,0,0,1),this.textureMask=new U.LX(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new C,this.id=N,this.name=N}createPointEmitter(N,p){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new A.xp(0,1,0),arguments.length>2&&void 0!==arguments[2]||new A.xp(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new A.xp(0,1,0),arguments.length>4&&void 0!==arguments[4]||new A.xp(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new A.xp(0,1,0),arguments.length>3&&void 0!==arguments[3]||new A.xp(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(N,p,T,A){throw new Error("Method not implemented.")}}y.BLENDMODE_ONEONE=0,y.BLENDMODE_STANDARD=1,y.BLENDMODE_ADD=2,y.BLENDMODE_MULTIPLY=3,y.BLENDMODE_MULTIPLYADD=4,y.BLENDMODE_SUBTRACT=-1,(0,X.d)("BABYLON.BaseParticleSystem",y);var e=T(12390),H=T(12211);class M{constructor(){this.direction1=new A.xp(0,1,0),this.direction2=new A.xp(0,1,0),this.minEmitBox=new A.xp(-.5,-.5,-.5),this.maxEmitBox=new A.xp(.5,.5,.5)}startDirectionFunction(N,p,T,a){const C=(0,e.RandomRange)(this.direction1.x,this.direction2.x),U=(0,e.RandomRange)(this.direction1.y,this.direction2.y),X=(0,e.RandomRange)(this.direction1.z,this.direction2.z);if(a)return p.x=C,p.y=U,void(p.z=X);A.xp.TransformNormalFromFloatsToRef(C,U,X,N,p)}startPositionFunction(N,p,T,a){const C=(0,e.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),U=(0,e.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,e.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(a)return p.x=C,p.y=U,void(p.z=X);A.xp.TransformCoordinatesFromFloatsToRef(C,U,X,N,p)}clone(){const N=new M;return H.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2),N.setVector3("minEmitBox",this.minEmitBox),N.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3),N.addUniform("minEmitBox",3),N.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.UX(),N.direction2=this.direction2.UX(),N.minEmitBox=this.minEmitBox.UX(),N.maxEmitBox=this.maxEmitBox.UX(),N}parse(N){A.xp.FromArrayToRef(N.direction1,0,this.direction1),A.xp.FromArrayToRef(N.direction2,0,this.direction2),A.xp.FromArrayToRef(N.minEmitBox,0,this.minEmitBox),A.xp.FromArrayToRef(N.maxEmitBox,0,this.maxEmitBox)}}class b{get radius(){return this._radius}set radius(N){this._radius=N,this._buildHeight()}get angle(){return this._angle}set angle(N){this._angle=N,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=T,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=p,this.radius=N}startDirectionFunction(N,p,T,a){a?A.TmpVectors.xp[0].A(T.rX).normalize():T.position.subtractToRef(N.getTranslation(),A.TmpVectors.xp[0]).normalize();const C=(0,e.RandomRange)(0,this.directionRandomizer),U=(0,e.RandomRange)(0,this.directionRandomizer),X=(0,e.RandomRange)(0,this.directionRandomizer);p.x=A.TmpVectors.xp[0].x+C,p.y=A.TmpVectors.xp[0].y+U,p.z=A.TmpVectors.xp[0].z+X,p.normalize()}startPositionFunction(N,p,T,a){const C=(0,e.RandomRange)(0,2*Math.PI);let U;this.emitFromSpawnPointOnly?U=1e-4:(U=(0,e.RandomRange)(0,this.heightRange),U=1-U*U);let X=this._radius-(0,e.RandomRange)(0,this._radius*this.radiusRange);X*=U;const y=X*Math.sin(C),H=X*Math.cos(C),M=U*this._height;if(a)return p.x=y,p.y=M,void(p.z=H);A.xp.TransformCoordinatesFromFloatsToRef(y,M,H,N,p)}clone(){const N=new b(this._radius,this._angle,this.directionRandomizer);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat2("radius",this._radius,this.radiusRange),N.setFloat("coneAngle",this._angle),N.setFloat2("height",this._height,this.heightRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",2),N.addUniform("coneAngle",1),N.addUniform("height",2),N.addUniform("directionRandomizer",1)}getEffectDefines(){let N="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(N+="\n#define CONEEMITTERSPAWNPOINT"),N}getClassName(){return"ConeParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this._radius,N.angle=this._angle,N.directionRandomizer=this.directionRandomizer,N.radiusRange=this.radiusRange,N.heightRange=this.heightRange,N.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,N}parse(N){this.radius=N.radius,this.angle=N.angle,this.directionRandomizer=N.directionRandomizer,this.radiusRange=void 0!==N.radiusRange?N.radiusRange:1,this.heightRange=void 0!==N.radiusRange?N.heightRange:1,this.emitFromSpawnPointOnly=void 0!==N.emitFromSpawnPointOnly&&N.emitFromSpawnPointOnly}}class l extends b{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0);super(N,p),this.direction1=T,this.direction2=a}startDirectionFunction(N,p){const T=(0,e.RandomRange)(this.direction1.x,this.direction2.x),a=(0,e.RandomRange)(this.direction1.y,this.direction2.y),C=(0,e.RandomRange)(this.direction1.z,this.direction2.z);A.xp.TransformNormalFromFloatsToRef(T,a,C,N,p)}clone(){const N=new l(this.radius,this.angle,this.direction1,this.direction2);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.UX(),N.direction2=this.direction2.UX(),N}parse(N){super.parse(N),this.direction1.A(N.direction1),this.direction2.A(N.direction2)}}class k{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=N,this.height=p,this.radiusRange=T,this.directionRandomizer=a,this._tempVector=A.xp.Zero()}startDirectionFunction(N,p,T,a,C){T.position.subtractToRef(N.getTranslation(),this._tempVector),this._tempVector.normalize(),A.xp.TransformNormalToRef(this._tempVector,C,this._tempVector);const U=(0,e.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,e.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=U,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),a?p.A(this._tempVector):A.xp.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N,p)}startPositionFunction(N,p,T,a){const C=(0,e.RandomRange)(-this.height/2,this.height/2),U=(0,e.RandomRange)(0,2*Math.PI),X=(0,e.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),y=Math.sqrt(X)*this.radius,H=y*Math.cos(U),M=y*Math.sin(U);a?p.kX(H,C,M):A.xp.TransformCoordinatesFromFloatsToRef(H,C,M,N,p)}clone(){const N=new k(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.height=this.height,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.height=N.height,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class x extends k{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.xp(0,1,0);super(N,p,T),this.direction1=a,this.direction2=C}startDirectionFunction(N,p,T,a){const C=(0,e.RandomRange)(this.direction1.x,this.direction2.x),U=(0,e.RandomRange)(this.direction1.y,this.direction2.y),X=(0,e.RandomRange)(this.direction1.z,this.direction2.z);a?p.kX(C,U,X):A.xp.TransformNormalFromFloatsToRef(C,U,X,N,p)}clone(){const N=new x(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("height",this.height),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("height",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.UX(),N.direction2=this.direction2.UX(),N}parse(N){super.parse(N),A.xp.FromArrayToRef(N.direction1,0,this.direction1),A.xp.FromArrayToRef(N.direction2,0,this.direction2)}}class I{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=p,this.directionRandomizer=T}startDirectionFunction(N,p,T,a){const C=T.position.Ip(N.getTranslation()).normalize(),U=(0,e.RandomRange)(0,this.directionRandomizer),X=(0,e.RandomRange)(0,this.directionRandomizer),y=(0,e.RandomRange)(0,this.directionRandomizer);C.x+=U,C.y+=X,C.z+=y,C.normalize(),a?p.A(C):A.xp.TransformNormalFromFloatsToRef(C.x,C.y,C.z,N,p)}startPositionFunction(N,p,T,a){const C=this.radius-(0,e.RandomRange)(0,this.radius*this.radiusRange),U=(0,e.RandomRange)(0,1),X=(0,e.RandomRange)(0,2*Math.PI),y=Math.acos(2*U-1),H=C*Math.cos(X)*Math.sin(y),M=C*Math.cos(y),b=C*Math.sin(X)*Math.sin(y);a?p.kX(H,Math.abs(M),b):A.xp.TransformCoordinatesFromFloatsToRef(H,Math.abs(M),b,N,p)}clone(){const N=new I(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class L{constructor(){this.direction1=new A.xp(0,1,0),this.direction2=new A.xp(0,1,0)}startDirectionFunction(N,p,T,a){const C=(0,e.RandomRange)(this.direction1.x,this.direction2.x),U=(0,e.RandomRange)(this.direction1.y,this.direction2.y),X=(0,e.RandomRange)(this.direction1.z,this.direction2.z);a?p.kX(C,U,X):A.xp.TransformNormalFromFloatsToRef(C,U,X,N,p)}startPositionFunction(N,p,T,a){a?p.kX(0,0,0):A.xp.TransformCoordinatesFromFloatsToRef(0,0,0,N,p)}clone(){const N=new L;return H.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.direction1=this.direction1.UX(),N.direction2=this.direction2.UX(),N}parse(N){A.xp.FromArrayToRef(N.direction1,0,this.direction1),A.xp.FromArrayToRef(N.direction2,0,this.direction2)}}class n{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=N,this.radiusRange=p,this.directionRandomizer=T}startDirectionFunction(N,p,T,a){const C=T.position.Ip(N.getTranslation()).normalize(),U=(0,e.RandomRange)(0,this.directionRandomizer),X=(0,e.RandomRange)(0,this.directionRandomizer),y=(0,e.RandomRange)(0,this.directionRandomizer);C.x+=U,C.y+=X,C.z+=y,C.normalize(),a?p.A(C):A.xp.TransformNormalFromFloatsToRef(C.x,C.y,C.z,N,p)}startPositionFunction(N,p,T,a){const C=this.radius-(0,e.RandomRange)(0,this.radius*this.radiusRange),U=(0,e.RandomRange)(0,1),X=(0,e.RandomRange)(0,2*Math.PI),y=Math.acos(2*U-1),H=C*Math.cos(X)*Math.sin(y),M=C*Math.cos(y),b=C*Math.sin(X)*Math.sin(y);a?p.kX(H,M,b):A.xp.TransformCoordinatesFromFloatsToRef(H,M,b,N,p)}clone(){const N=new n(this.radius,this.directionRandomizer);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.radius=this.radius,N.radiusRange=this.radiusRange,N.directionRandomizer=this.directionRandomizer,N}parse(N){this.radius=N.radius,this.radiusRange=N.radiusRange,this.directionRandomizer=N.directionRandomizer}}class w extends n{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.xp(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0);super(N),this.direction1=p,this.direction2=T}startDirectionFunction(N,p){const T=(0,e.RandomRange)(this.direction1.x,this.direction2.x),a=(0,e.RandomRange)(this.direction1.y,this.direction2.y),C=(0,e.RandomRange)(this.direction1.z,this.direction2.z);A.xp.TransformNormalFromFloatsToRef(T,a,C,N,p)}clone(){const N=new w(this.radius,this.direction1,this.direction2);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setFloat("radius",this.radius),N.setFloat("radiusRange",this.radiusRange),N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("radius",1),N.addUniform("radiusRange",1),N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const N=super.serialize();return N.direction1=this.direction1.UX(),N.direction2=this.direction2.UX(),N}parse(N){super.parse(N),this.direction1.A(N.direction1),this.direction2.A(N.direction2)}}class g{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(N,p,T,a){const C=A.TmpVectors.xp[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,T,C);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,T,C);const N=A.TmpVectors.xp[1];C.subtractToRef(T.position,N),N.scaleToRef(1/T.lifeTime,C)}else C.set(0,0,0);a?p.A(C):A.xp.TransformNormalToRef(C,N,p)}startPositionFunction(N,p,T,a){const C=A.TmpVectors.xp[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,T,C):C.set(0,0,0),a?p.A(C):A.xp.TransformCoordinatesToRef(C,N,p)}clone(){const N=new g;return H.d.DeepCopy(this,N),N}applyToShader(N){}buildUniformLayout(N){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const N={};return N.type=this.getClassName(),N.particlePositionGenerator=this.particlePositionGenerator,N.particleDestinationGenerator=this.particleDestinationGenerator,N}parse(N){N.particlePositionGenerator&&(this.particlePositionGenerator=N.particlePositionGenerator),N.particleDestinationGenerator&&(this.particleDestinationGenerator=N.particleDestinationGenerator)}}var P=T(12451);class i{get mesh(){return this._mesh}set mesh(N){this._mesh!==N&&(this._mesh=N,N?(this._indices=N.bX(),this._positions=N.getVerticesData(P.f.PositionKind),this._normals=N.getVerticesData(P.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=A.xp.Zero(),this._mesh=null,this.direction1=new A.xp(0,1,0),this.direction2=new A.xp(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=N}startDirectionFunction(N,p,T,a){if(this.useMeshNormalsForDirection&&this._normals)return void A.xp.TransformNormalToRef(this._storedNormal,N,p);const C=(0,e.RandomRange)(this.direction1.x,this.direction2.x),U=(0,e.RandomRange)(this.direction1.y,this.direction2.y),X=(0,e.RandomRange)(this.direction1.z,this.direction2.z);a?p.kX(C,U,X):A.xp.TransformNormalFromFloatsToRef(C,U,X,N,p)}startPositionFunction(N,p,T,a){if(!this._indices||!this._positions)return;const C=3*(Math.random()*(this._indices.length/3)|0),U=Math.random(),X=Math.random()*(1-U),y=1-U-X,e=this._indices[C],H=this._indices[C+1],M=this._indices[C+2],b=A.TmpVectors.xp[0],l=A.TmpVectors.xp[1],k=A.TmpVectors.xp[2],x=A.TmpVectors.xp[3];A.xp.FromArrayToRef(this._positions,3*e,b),A.xp.FromArrayToRef(this._positions,3*H,l),A.xp.FromArrayToRef(this._positions,3*M,k),x.x=U*b.x+X*l.x+y*k.x,x.y=U*b.y+X*l.y+y*k.y,x.z=U*b.z+X*l.z+y*k.z,a?p.kX(x.x,x.y,x.z):A.xp.TransformCoordinatesFromFloatsToRef(x.x,x.y,x.z,N,p),this.useMeshNormalsForDirection&&this._normals&&(A.xp.FromArrayToRef(this._normals,3*e,b),A.xp.FromArrayToRef(this._normals,3*H,l),A.xp.FromArrayToRef(this._normals,3*M,k),this._storedNormal.x=U*b.x+X*l.x+y*k.x,this._storedNormal.y=U*b.y+X*l.y+y*k.y,this._storedNormal.z=U*b.z+X*l.z+y*k.z)}clone(){const N=new i(this.mesh);return H.d.DeepCopy(this,N),N}applyToShader(N){N.setVector3("direction1",this.direction1),N.setVector3("direction2",this.direction2)}buildUniformLayout(N){N.addUniform("direction1",3),N.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var N;const p={};return p.type=this.getClassName(),p.direction1=this.direction1.UX(),p.direction2=this.direction2.UX(),p.meshId=null===(N=this.mesh)||void 0===N?void 0:N.id,p.useMeshNormalsForDirection=this.useMeshNormalsForDirection,p}parse(N,p){A.xp.FromArrayToRef(N.direction1,0,this.direction1),A.xp.FromArrayToRef(N.direction2,0,this.direction2),N.meshId&&p&&(this.mesh=p.getLastMeshById(N.meshId)),this.useMeshNormalsForDirection=N.useMeshNormalsForDirection}}class K{_isUbo(N){return void 0!==N.addUniform}constructor(N){this._isUbo(N)?(this.setMatrix3x3=N.updateMatrix3x3.bind(N),this.setMatrix2x2=N.updateMatrix2x2.bind(N),this.setFloat=N.updateFloat.bind(N),this.setFloat2=N.updateFloat2.bind(N),this.setFloat3=N.updateFloat3.bind(N),this.setFloat4=N.updateFloat4.bind(N),this.setFloatArray=N.updateFloatArray.bind(N),this.setArray=N.updateArray.bind(N),this.setIntArray=N.updateIntArray.bind(N),this.setMatrix=N.eX.bind(N),this.setMatrices=N.updateMatrices.bind(N),this.setVector3=N.updateVector3.bind(N),this.setVector4=N.updateVector4.bind(N),this.setColor3=N.updateColor3.bind(N),this.setColor4=N.updateColor4.bind(N),this.setDirectColor4=N.updateDirectColor4.bind(N),this.setInt=N.updateInt.bind(N),this.setInt2=N.updateInt2.bind(N),this.setInt3=N.updateInt3.bind(N),this.setInt4=N.updateInt4.bind(N)):(this.setMatrix3x3=N.setMatrix3x3.bind(N),this.setMatrix2x2=N.setMatrix2x2.bind(N),this.setFloat=N.setFloat.bind(N),this.setFloat2=N.setFloat2.bind(N),this.setFloat3=N.setFloat3.bind(N),this.setFloat4=N.setFloat4.bind(N),this.setFloatArray=N.setFloatArray.bind(N),this.setArray=N.setArray.bind(N),this.setIntArray=N.setIntArray.bind(N),this.setMatrix=N.setMatrix.bind(N),this.setMatrices=N.setMatrices.bind(N),this.setVector3=N.setVector3.bind(N),this.setVector4=N.setVector4.bind(N),this.setColor3=N.setColor3.bind(N),this.setColor4=N.setColor4.bind(N),this.setDirectColor4=N.setDirectColor4.bind(N),this.setInt=N.setInt.bind(N),this.setInt2=N.setInt2.bind(N),this.setInt3=N.setInt3.bind(N),this.setInt4=N.setInt4.bind(N))}}var F=T(12281);const v="gpuUpdateParticlesPixelShader",W="#version 300 es\nvoid main() {discard;}\n";F.b.ShadersStore[v]||(F.b.ShadersStore[v]=W);const z="gpuUpdateParticlesVertexShader",R="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";F.b.ShadersStore[z]||(F.b.ShadersStore[z]=R);(0,X.d)("BABYLON.WebGL2ParticleSystem",class{constructor(N,p){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=N,this._engine=p,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var N;return(null===(N=this._updateEffect)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof g&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=N,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new K(this._updateEffect)}createVertexBuffers(N,p){this._updateVAO.push(this._createUpdateVAO(N)),this._renderVAO.push(this._engine.recordVertexArrayObject(p,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=p}createParticleBuffer(N){return N}bindDrawBuffers(N,p,T){T?this._engine.bindBuffers(this._renderVertexBuffers,T,p):this._engine.bindVertexArrayObject(this._renderVAO[N],null)}preUpdateParticleBuffer(){const N=this._engine;if(this._engine.enableEffect(this._updateEffect),!N.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(N,p,T){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[N],null);const A=this._engine;A.bindTransformFeedbackBuffer(p.getBuffer()),A.setRasterizerState(!1),A.beginTransformFeedback(!0),A.drawArraysType(3,0,T),A.endTransformFeedback(),A.setRasterizerState(!0),A.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let N=0;N<this._updateVAO.length;N++)this._engine.releaseVertexArrayObject(this._updateVAO[N]);this._updateVAO.length=0;for(let N=0;N<this._renderVAO.length;N++)this._engine.releaseVertexArrayObject(this._renderVAO[N]);this._renderVAO.length=0}_createUpdateVAO(N){const p={};p.position=N.createVertexBuffer("position",0,3);let T=3;p.age=N.createVertexBuffer("age",T,1),T+=1,p.size=N.createVertexBuffer("size",T,3),T+=3,p.life=N.createVertexBuffer("life",T,1),T+=1,p.seed=N.createVertexBuffer("seed",T,4),T+=4,p.direction=N.createVertexBuffer("direction",T,3),T+=3,this._parent.particleEmitterType instanceof g&&(p.initialPosition=N.createVertexBuffer("initialPosition",T,3),T+=3),this._parent._colorGradientsTexture||(p.color=N.createVertexBuffer("color",T,4),T+=4),this._parent._isBillboardBased||(p.initialDirection=N.createVertexBuffer("initialDirection",T,3),T+=3),this._parent.noiseTexture&&(p.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",T,3),T+=3,p.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",T,3),T+=3),this._parent._angularSpeedGradientsTexture?(p.angle=N.createVertexBuffer("angle",T,1),T+=1):(p.angle=N.createVertexBuffer("angle",T,2),T+=2),this._parent._isAnimationSheetEnabled&&(p.cellIndex=N.createVertexBuffer("cellIndex",T,1),T+=1,this._parent.spriteRandomStartCell&&(p.cellStartOffset=N.createVertexBuffer("cellStartOffset",T,1),T+=1));const A=this._engine.recordVertexArrayObject(p,null,this._updateEffect);return this._engine.bindArrayBuffer(null),A}});class J{constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,A=arguments.length>3?arguments[3]:void 0;this._engine=N,this._label=A,this._engine._storageBuffers.push(this),this._create(p,T)}_create(N,p){this._bufferSize=N,this._creationFlags=p,this._buffer=this._engine.createStorageBuffer(N,p,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(N,p,T){this._buffer&&this._engine.updateStorageBuffer(this._buffer,N,p,T)}async read(N,p,T,A){return await this._engine.readFromStorageBuffer(this._buffer,N,p,T,A)}dispose(){const N=this._engine._storageBuffers,p=N.indexOf(this);-1!==p&&(N[p]=N[N.length-1],N.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var f=T(12354),G=T(12359),o=T(12409),Z=T(12352),mN=T(12684),q=T(12205),h=T(12309),j=T(12597);class V{constructor(){this._gpuTimeInFrameId=-1,this.counter=new j.c}_addDuration(N,p){N<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==N?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(p,!1),this._gpuTimeInFrameId=N):this.counter.addCount(p,!1))}}var r=T(12264);class u{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=N,this._engine=p,this.uniqueId=mN.d.UniqueId,p.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new V),this._engine.getCaps().supportComputeShaders?A.bindingsMapping?(this._context=p.createComputeContext(),this._shaderPath=T,this._options={bindingsMapping:{},defines:[],...A}):q.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):q.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(N,p){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const A=this._bindings[N];this._bindings[N]={type:T?0:4,object:p,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!A||A.object!==p||A.type!==this._bindings[N].type)}setStorageTexture(N,p){const T=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==p),this._bindings[N]={type:1,object:p,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setExternalTexture(N,p){const T=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==p),this._bindings[N]={type:6,object:p,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setVideoTexture(N,p){return!!p.externalTexture&&(this.setExternalTexture(N,p.externalTexture),!0)}setUniformBuffer(N,p){const T=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==p),this._bindings[N]={type:u._BufferIsDataBuffer(p)?7:2,object:p,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setStorageBuffer(N,p){const T=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!T||T.object!==p),this._bindings[N]={type:u._BufferIsDataBuffer(p)?7:3,object:p,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}setTextureSampler(N,p){const T=this._bindings[N];this._contextIsDirty||(this._contextIsDirty=!T||!p.compareSampler(T.object)),this._bindings[N]={type:5,object:p,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries}}isReady(){let N=this._effect;for(const a in this._bindings){const N=this._bindings[a],p=N.type,T=N.object;switch(p){case 0:case 4:case 1:if(!T.isReady())return!1;break;case 6:if(!T.isReady())return!1;break}}const p=[],T=this._shaderPath;if(this._options.defines)for(let a=0;a<this._options.defines.length;a++)p.push(this._options.defines[a]);const A=p.join("\n");return this._cachedDefines!==A&&(this._cachedDefines=A,N=this._engine.createComputeEffect(T,{defines:A,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=N),!!N.isReady()}dispatch(N,p,T){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,N,p,T,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const T=u._BufferIsDataBuffer(N)?N:N.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,T,p,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const p in this._bindings){const T=this._bindings[p];if(!this._options.bindingsMapping[p])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+p+"'");switch(T.type){case 0:{const A=this._samplers[p],a=T.object;var N;if(!A||!a._texture||!A.compareSampler(a._texture))this._samplers[p]=(new h.c).setParameters(a.wrapU,a.wrapV,a.wrapR,a.anisotropicFilteringLevel,a._texture.samplingMode,null===(N=a._texture)||void 0===N?void 0:N._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const N=T.object;N.getBuffer()!==T.buffer&&(T.buffer=N.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((a=>{(0,r.g)((()=>this.dispatch(N,p,T)),a,void 0,A)}))}serialize(){const N=o.e.Serialize(this);N.options=this._options,N.shaderPath=this._shaderPath,N.ll={},N.textures={};for(const p in this._bindings){const T=this._bindings[p],A=T.object;switch(T.type){case 0:case 4:case 1:{const a=A.serialize();a&&(N.textures[p]=a,N.ll[p]={type:T.type});break}}}return N}static Parse(N,p,T){const A=o.e.Parse((()=>new u(N.name,p.getEngine(),N.shaderPath,N.options)),N,p,T);for(const a in N.textures){const C=N.ll[a],U=Z.c.Parse(N.textures[a],p,T);0===C.type?A.setTexture(a,U):4===C.type?A.setTexture(a,U,!1):A.setStorageTexture(a,U)}return A}static _BufferIsDataBuffer(N){return void 0!==N.underlyingResource}}(0,f.b)([(0,G.H)()],u.prototype,"name",void 0),(0,f.b)([(0,G.H)()],u.prototype,"fastMode",void 0),(0,X.d)("BABYLON.ComputeShader",u);var Y=T(12647);const D="gpuUpdateParticlesComputeShader",c="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";F.b.ShadersStoreWGSL[D]||(F.b.ShadersStoreWGSL[D]=c);(0,X.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(N,p){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=N,this._engine=p}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var N;return(null===(N=this._updateComputeShader)||void 0===N?void 0:N.isReady())??!1}createUpdateBuffer(N){var p;const T={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(T.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(T.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(T.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(T.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(T.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(T.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(T.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new u("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:T,defines:N.split("\n")}),null===(p=this._simParamsComputeShader)||void 0===p||p.dispose(),this._simParamsComputeShader=new Y.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new K(this._simParamsComputeShader)}createVertexBuffers(N,p){this._renderVertexBuffers.push(p)}createParticleBuffer(N){const p=new J(this._engine,4*N.length,11,"ComputeShaderParticleSystemBuffer");return p.update(N),this._bufferComputeShader.push(p),p.getBuffer()}bindDrawBuffers(N,p,T){this._engine.bindBuffers(this._renderVertexBuffers[N],T,p)}preUpdateParticleBuffer(){}updateParticleBuffer(N,p,T){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[N]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^N]),this._updateComputeShader.dispatch(Math.ceil(T/64))}releaseBuffers(){var N;for(let p=0;p<this._bufferComputeShader.length;++p)this._bufferComputeShader[p].dispose();this._bufferComputeShader.length=0,null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Q{constructor(N,p,T){this.gradient=N,this.color1=p,this.color2=T}getColorToRef(N){this.color2?U.LX.LerpToRef(this.color1,this.color2,Math.random(),N):N.A(this.color1)}}class E{constructor(N,p){this.gradient=N,this.color=p}}class O{constructor(N,p,T){this.gradient=N,this.factor1=p,this.factor2=T}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class B{static GetCurrentGradient(N,p,T){if(p[0].gradient>N)return void T(p[0],p[0],1);for(let a=0;a<p.length-1;a++){const A=p[a],C=p[a+1];if(N>=A.gradient&&N<=C.gradient){return void T(A,C,(N-A.gradient)/(C.gradient-A.gradient))}}const A=p.length-1;T(p[A],p[A],1)}}var d=T(12194),t=T(12856),S=T(12231);class s{constructor(N){this.particleSystem=N,this.position=A.xp.Zero(),this.direction=A.xp.Zero(),this.color=new U.LX(0,0,0,0),this.colorStep=new U.LX(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new A.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new U.LX(0,0,0,0),this._currentColor2=new U.LX(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=s._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let N=this.age,p=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===p?(p=1,N=this._randomCellOffset):N+=this._randomCellOffset);const T=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let A;A=this._initialSpriteCellLoop?(0,e.Clamp)(N*p%this.lifeTime/this.lifeTime):(0,e.Clamp)(N*p/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+A*T|0}_inheritParticleInfoToSubEmitter(N){if(N.particleSystem.Ap.position){const p=N.particleSystem.Ap;if(p.position.A(this.position),N.inheritDirection){const N=A.TmpVectors.xp[0];this.direction.normalizeToRef(N),p.setDirection(N,0,Math.PI/2)}}else{N.particleSystem.Ap.A(this.position)}this.direction.scaleToRef(N.inheritedVelocityAmount/2,A.TmpVectors.xp[0]),N.particleSystem._inheritedVelocityOffset.A(A.TmpVectors.xp[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const N of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(N)}_reset(){this.age=0,this.id=s._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(N){N.position.A(this.position),this._initialDirection?N._initialDirection?N._initialDirection.A(this._initialDirection):N._initialDirection=this._initialDirection.clone():N._initialDirection=null,N.direction.A(this.direction),this.rX&&(N.rX?N.rX.A(this.rX):N.rX=this.rX.clone()),N.color.A(this.color),N.colorStep.A(this.colorStep),N.lifeTime=this.lifeTime,N.age=this.age,N._randomCellOffset=this._randomCellOffset,N.size=this.size,N.scale.A(this.scale),N.angle=this.angle,N.angularSpeed=this.angularSpeed,N.particleSystem=this.particleSystem,N.cellIndex=this.cellIndex,N.id=this.id,N._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(N._currentColorGradient=this._currentColorGradient,N._currentColor1.A(this._currentColor1),N._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(N._currentSizeGradient=this._currentSizeGradient,N._currentSize1=this._currentSize1,N._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(N._currentAngularSpeedGradient=this._currentAngularSpeedGradient,N._currentAngularSpeed1=this._currentAngularSpeed1,N._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(N._currentVelocityGradient=this._currentVelocityGradient,N._currentVelocity1=this._currentVelocity1,N._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(N._currentLimitVelocityGradient=this._currentLimitVelocityGradient,N._currentLimitVelocity1=this._currentLimitVelocity1,N._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(N._currentDragGradient=this._currentDragGradient,N._currentDrag1=this._currentDrag1,N._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(N._initialStartSpriteCellId=this._initialStartSpriteCellId,N._initialEndSpriteCellId=this._initialEndSpriteCellId,N._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(N.remapData&&this.remapData?N.remapData.A(this.remapData):N.remapData=new A.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),N._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(N._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),N._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}s._Count=0;var NN=T(12494),pN=(T(12538),T(12736)),TN=T(12731),AN=T(12638);function aN(N,p){const T=(0,e.RandomRange)(0,1);U.LX.LerpToRef(p.color1,p.color2,T,N.color),p.colorDead.subtractToRef(N.color,p._colorDiff),p._colorDiff.scaleToRef(1/N.lifeTime,N.colorStep)}function CN(N,p){N._currentColorGradient=p._colorGradients[0],N._currentColorGradient.getColorToRef(N.color),N._currentColor1.A(N.color),p._colorGradients.length>1?p._colorGradients[1].getColorToRef(N._currentColor2):N._currentColor2.A(N.color)}function UN(N,p){const T=p._colorGradients;B.GetCurrentGradient(p._ratio,T,((p,T,A)=>{p!==N._currentColorGradient&&(N._currentColor1.A(N._currentColor2),T.getColorToRef(N._currentColor2),N._currentColorGradient=p),U.LX.LerpToRef(N._currentColor1,N._currentColor2,A,N.color)}))}function XN(N,p){N.colorStep.scaleToRef(p._scaledUpdateSpeed,p._scaledColorStep),N.color.addInPlace(p._scaledColorStep),N.color.a<0&&(N.color.a=0)}function yN(N,p){B.GetCurrentGradient(p._ratio,p._angularSpeedGradients,((p,T,A)=>{p!==N._currentAngularSpeedGradient&&(N._currentAngularSpeed1=N._currentAngularSpeed2,N._currentAngularSpeed2=T.getFactor(),N._currentAngularSpeedGradient=p),N.angularSpeed=(0,e.Lerp)(N._currentAngularSpeed1,N._currentAngularSpeed2,A)}))}function eN(N,p){N.angle+=N.angularSpeed*p._scaledUpdateSpeed}function HN(N,p){p.particleEmitterType.startDirectionFunction(p._emitterWorldMatrix,N.direction,N,p.isLocal,p._emitterInverseWorldMatrix)}function MN(N,p){p.startDirectionFunction(p._emitterWorldMatrix,N.direction,N,p.isLocal)}function bN(N,p){N._currentVelocityGradient=p._velocityGradients[0],N._currentVelocity1=N._currentVelocityGradient.getFactor(),p._velocityGradients.length>1?N._currentVelocity2=p._velocityGradients[1].getFactor():N._currentVelocity2=N._currentVelocity1}function lN(N,p){N._currentLimitVelocityGradient=p._limitVelocityGradients[0],N._currentLimitVelocity1=N._currentLimitVelocityGradient.getFactor(),p._limitVelocityGradients.length>1?N._currentLimitVelocity2=p._limitVelocityGradients[1].getFactor():N._currentLimitVelocity2=N._currentLimitVelocity1}function kN(N,p){B.GetCurrentGradient(p._ratio,p._velocityGradients,((T,A,a)=>{T!==N._currentVelocityGradient&&(N._currentVelocity1=N._currentVelocity2,N._currentVelocity2=A.getFactor(),N._currentVelocityGradient=T),p._directionScale*=(0,e.Lerp)(N._currentVelocity1,N._currentVelocity2,a)}))}function xN(N,p){B.GetCurrentGradient(p._ratio,p._limitVelocityGradients,((T,A,a)=>{T!==N._currentLimitVelocityGradient&&(N._currentLimitVelocity1=N._currentLimitVelocity2,N._currentLimitVelocity2=A.getFactor(),N._currentLimitVelocityGradient=T);const C=(0,e.Lerp)(N._currentLimitVelocity1,N._currentLimitVelocity2,a);N.direction.length()>C&&N.direction.scaleInPlace(p.limitVelocityDamping)}))}function IN(N,p){N.direction.scaleToRef(p._directionScale,p._scaledDirection)}function LN(N,p){p.particleEmitterType.startPositionFunction(p._emitterWorldMatrix,N.position,N,p.isLocal)}function nN(N,p){p.startPositionFunction(p._emitterWorldMatrix,N.position,N,p.isLocal)}function wN(N,p){N.rX?N.rX.A(N.position):N.rX=N.position.clone(),A.xp.TransformCoordinatesToRef(N.rX,p._emitterWorldMatrix,N.position)}function gN(N,p){p.isLocal&&N.rX?(N.rX.addInPlace(p._scaledDirection),A.xp.TransformCoordinatesToRef(N.rX,p._emitterWorldMatrix,N.position)):N.position.addInPlace(p._scaledDirection)}function PN(N,p){N._currentDragGradient=p._dragGradients[0],N._currentDrag1=N._currentDragGradient.getFactor(),p._dragGradients.length>1?N._currentDrag2=p._dragGradients[1].getFactor():N._currentDrag2=N._currentDrag1}function iN(N,p){B.GetCurrentGradient(p._ratio,p._dragGradients,((T,A,a)=>{T!==N._currentDragGradient&&(N._currentDrag1=N._currentDrag2,N._currentDrag2=A.getFactor(),N._currentDragGradient=T);const C=(0,e.Lerp)(N._currentDrag1,N._currentDrag2,a);p._scaledDirection.scaleInPlace(1-C)}))}function KN(N,p){N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.kX(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2.kX(Math.random(),Math.random(),Math.random())):(N._randomNoiseCoordinates1=new A.xp(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2=new A.xp(Math.random(),Math.random(),Math.random()))}function FN(N,p){const T=p._noiseTextureData,a=p._noiseTextureSize;if(T&&a&&N._randomNoiseCoordinates1){const C=p._fetchR(N._randomNoiseCoordinates1.x,N._randomNoiseCoordinates1.y,a.width,a.height,T),U=p._fetchR(N._randomNoiseCoordinates1.z,N._randomNoiseCoordinates2.x,a.width,a.height,T),X=p._fetchR(N._randomNoiseCoordinates2.y,N._randomNoiseCoordinates2.z,a.width,a.height,T),y=A.TmpVectors.xp[0],e=A.TmpVectors.xp[1];y.kX((2*C-1)*p.noiseStrength.x,(2*U-1)*p.noiseStrength.y,(2*X-1)*p.noiseStrength.z),y.scaleToRef(p._tempScaledUpdateSpeed,e),N.direction.addInPlace(e)}}function vN(N,p){p.gravity.scaleToRef(p._tempScaledUpdateSpeed,p._scaledGravity),N.direction.addInPlace(p._scaledGravity)}function WN(N,p){N.size=(0,e.RandomRange)(p.minSize,p.maxSize),N.scale.kX((0,e.RandomRange)(p.minScaleX,p.maxScaleX),(0,e.RandomRange)(p.minScaleY,p.maxScaleY))}function zN(N,p){N._currentSizeGradient=p._sizeGradients[0],N._currentSize1=N._currentSizeGradient.getFactor(),N.size=N._currentSize1,p._sizeGradients.length>1?N._currentSize2=p._sizeGradients[1].getFactor():N._currentSize2=N._currentSize1,N.scale.kX((0,e.RandomRange)(p.minScaleX,p.maxScaleX),(0,e.RandomRange)(p.minScaleY,p.maxScaleY))}function RN(N,p){const T=p._actualFrame/p.targetStopDuration;B.GetCurrentGradient(T,p._startSizeGradients,((T,A,a)=>{T!==p._currentStartSizeGradient&&(p._currentStartSize1=p._currentStartSize2,p._currentStartSize2=A.getFactor(),p._currentStartSizeGradient=T);const C=(0,e.Lerp)(p._currentStartSize1,p._currentStartSize2,a);N.scale.scaleInPlace(C)}))}function JN(N,p){B.GetCurrentGradient(p._ratio,p._sizeGradients,((p,T,A)=>{p!==N._currentSizeGradient&&(N._currentSize1=N._currentSize2,N._currentSize2=T.getFactor(),N._currentSizeGradient=p),N.size=(0,e.Lerp)(N._currentSize1,N._currentSize2,A)}))}function fN(N,p){N.remapData=new A.Vector4(0,1,0,1)}function GN(N,p){p._colorRemapGradients&&p._colorRemapGradients.length>0&&B.GetCurrentGradient(p._ratio,p._colorRemapGradients,((p,T,A)=>{const a=(0,e.Lerp)(p.factor1,T.factor1,A),C=(0,e.Lerp)(p.factor2,T.factor2,A);N.remapData.x=a,N.remapData.y=C-a})),p._alphaRemapGradients&&p._alphaRemapGradients.length>0&&B.GetCurrentGradient(p._ratio,p._alphaRemapGradients,((p,T,A)=>{const a=(0,e.Lerp)(p.factor1,T.factor1,A),C=(0,e.Lerp)(p.factor2,T.factor2,A);N.remapData.z=a,N.remapData.w=C-a}))}function oN(N,p){const T=(0,e.Clamp)(p._actualFrame/p.targetStopDuration);B.GetCurrentGradient(T,p._lifeTimeGradients,((p,A)=>{const a=p,C=A,U=a.getFactor(),X=C.getFactor(),y=(T-a.gradient)/(C.gradient-a.gradient);N.lifeTime=(0,e.Lerp)(U,X,y)})),p._emitPower=(0,e.RandomRange)(p.minEmitPower,p.maxEmitPower)}function ZN(N,p){N.lifeTime=(0,e.RandomRange)(p.minLifeTime,p.maxLifeTime),p._emitPower=(0,e.RandomRange)(p.minEmitPower,p.maxEmitPower)}function mp(N,p){0===p._emitPower?(N._initialDirection?N._initialDirection.A(N.direction):N._initialDirection=N.direction.clone(),N.direction.set(0,0,0)):(N._initialDirection=null,N.direction.scaleInPlace(p._emitPower)),N.direction.addInPlace(p._inheritedVelocityOffset)}function qN(N,p){N.angularSpeed=(0,e.RandomRange)(p.minAngularSpeed,p.maxAngularSpeed),N.angle=(0,e.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function hN(N,p){N._currentAngularSpeedGradient=p._angularSpeedGradients[0],N.angularSpeed=N._currentAngularSpeedGradient.getFactor(),N._currentAngularSpeed1=N.angularSpeed,p._angularSpeedGradients.length>1?N._currentAngularSpeed2=p._angularSpeedGradients[1].getFactor():N._currentAngularSpeed2=N._currentAngularSpeed1,N.angle=(0,e.RandomRange)(p.minInitialRotation,p.maxInitialRotation)}function jN(N,p){N._initialStartSpriteCellId=p.startSpriteCellID,N._initialEndSpriteCellId=p.endSpriteCellID,N._initialSpriteCellLoop=p.spriteCellLoop}function VN(N,p){N.previousItem=p.previousItem,N.nextItem=p,p.previousItem&&(p.previousItem.nextItem=N),p.previousItem=N}function rN(N,p){N.previousItem=p,N.nextItem=p.nextItem,p.nextItem&&(p.nextItem.previousItem=N),p.nextItem=N}function uN(N,p){let T=p;for(;T.nextItem;)T=T.nextItem;N.previousItem=T,N.nextItem=T.nextItem,T.nextItem=N}function YN(N){N.previousItem&&(N.previousItem.nextItem=N.nextItem),N.nextItem&&(N.nextItem.previousItem=N.previousItem)}class DN extends y{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(N){this._startDirectionFunction!==N&&(this._startDirectionFunction=N,this._directionProcessing.process=N?MN:HN)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(N){this._startPositionFunction!==N&&(this._startPositionFunction=N,this._positionCreation.process=N?nN:LN)}set onDispose(N){this._onDisposeObserver&&this.SU.remove(this._onDisposeObserver),this._onDisposeObserver=this.SU.add(N)}get X(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(N){this._useRampGradients!==N&&(this._useRampGradients=N,this._resetEffect(),N?(this._rampCreation={process:fN,previousItem:null,nextItem:null},rN(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:GN,previousItem:null,nextItem:null},rN(this._remapGradientProcessing,this._gravityProcessing)):(YN(this._rampCreation),YN(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(N){this._isLocal!==N&&(this._isLocal=N,N?(this._isLocalCreation={process:wN,previousItem:null,nextItem:null},rN(this._isLocalCreation,this._positionCreation)):YN(this._isLocalCreation))}get particles(){return this.yl}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(N){this._animationSheetEnabled!==N&&(this._animationSheetEnabled=N,N?(this._sheetCreation={process:jN,previousItem:null,nextItem:null},rN(this._sheetCreation,this._colorCreation)):YN(this._sheetCreation),this._reset())}getActiveCount(){return this.yl.length}getClassName(){return"dX"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var N;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[p])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new NN.c(this._engine),this._customWrappers[p].effect=N,this._customWrappers[p].drawContext&&(this._customWrappers[p].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new d.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(N){if(this.noiseTexture!==N){if(this._noiseTexture=N,!N)return YN(this._noiseCreation),void YN(this._noiseProcessing);this._noiseCreation={process:KN,previousItem:null,nextItem:null},rN(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:FN,previousItem:null,nextItem:null},rN(this._noiseProcessing,this._positionProcessing)}}constructor(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(N),this._emitterInverseWorldMatrix=A.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new A.xp,this.SU=new d.c,this.onStoppedObservable=new d.c,this.onStartedObservable=new d.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.yl=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new U.LX(0,0,0,0),this._colorDiff=new U.LX(0,0,0,0),this._scaledDirection=A.xp.Zero(),this._scaledGravity=A.xp.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=N=>{},this.recycleParticle=N=>{const p=this.yl.pop();p!==N&&p.copyTo(N),this._stockParticles.push(p)},this._createParticle=()=>{let N;return 0!==this._stockParticles.length?(N=this._stockParticles.pop(),N._reset()):N=new s(this),this._prepareParticle(N),N},this.paused=!1,this._shadersLoaded=!1,this._capacity=p,this._epsilon=X,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||S.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ul.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:ZN,previousItem:null,nextItem:null},this._positionCreation={process:LN,previousItem:null,nextItem:null},rN(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:HN,previousItem:null,nextItem:null},rN(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:mp,previousItem:null,nextItem:null},rN(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:WN,previousItem:null,nextItem:null},rN(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:qN,previousItem:null,nextItem:null},rN(this._angleCreation,this._sizeCreation),this._colorCreation={process:aN,previousItem:null,nextItem:null},rN(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,y||(this._colorProcessing={process:XN,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:eN,previousItem:null,nextItem:null},rN(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:IN,previousItem:null,nextItem:null},rN(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:gN,previousItem:null,nextItem:null},rN(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:vN,previousItem:null,nextItem:null},rN(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=C,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new NN.c(this._engine)},this._customWrappers[0].effect=a,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new M,this.updateFunction=N=>{var p;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(p=this.noiseTexture.getContent())||void 0===p||p.then((N=>{this._noiseTextureData=N})));const T=N===this.yl;for(let A=0;A<N.length;A++){const p=N[A];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const a=p.age;if(p.age+=this._tempScaledUpdateSpeed,p.age>p.lifeTime){const N=p.age-a,T=p.lifeTime-a;this._tempScaledUpdateSpeed=T*this._tempScaledUpdateSpeed/N,p.age=p.lifeTime}this._ratio=p.age/p.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let C=this._updateQueueStart;for(;C;)C.process(p,this),C=C.nextItem;if(this._isAnimationSheetEnabled&&!y&&p.updateCellIndex(),p._inheritParticleInfoToSubEmitters(),p.age>=p.lifeTime){if(this._emitFromParticle(p),p._attachedSubEmitters){for(const N of p._attachedSubEmitters)N.particleSystem.disposeOnStop=!0,N.particleSystem.stop();p._attachedSubEmitters=null}this.recycleParticle(p),T&&A--}else;}}}serialize(N){throw new Error("Method not implemented.")}clone(N,p){throw new Error("Method not implemented.")}_addFactorGradient(N,p,T,A){const a=new O(p,T,A);N.push(a),N.sort(((N,p)=>N.gradient<p.gradient?-1:N.gradient>p.gradient?1:0))}_removeFactorGradient(N,p){if(!N)return;let T=0;for(const A of N){if(A.gradient===p){N.splice(T,1);break}T++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=oN:this._lifeTimeCreation.process=ZN}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:RN,previousItem:null,nextItem:null},rN(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(YN(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(N){this.targetStopDuration!==N&&(this._targetStopDuration=N,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(N,p,T){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,N,p,T),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(N){return this._removeFactorGradient(this._lifeTimeGradients,N),this._syncLifeTimeCreation(),this}addSizeGradient(N,p,T){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=zN,this._sizeGradientProcessing={process:JN,previousItem:null,nextItem:null},VN(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,N,p,T),this}removeSizeGradient(N){var p;return this._removeFactorGradient(this._sizeGradients,N),0===(null===(p=this._sizeGradients)||void 0===p?void 0:p.length)&&(YN(this._sizeGradientProcessing),this._sizeCreation.process=WN),this}addColorRemapGradient(N,p,T){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,N,p,T),this}removeColorRemapGradient(N){return this._removeFactorGradient(this._colorRemapGradients,N),this}addAlphaRemapGradient(N,p,T){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,N,p,T),this}removeAlphaRemapGradient(N){return this._removeFactorGradient(this._alphaRemapGradients,N),this}addAngularSpeedGradient(N,p,T){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=hN,this._angularSpeedGradientProcessing={process:yN,previousItem:null,nextItem:null},VN(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,N,p,T),this}removeAngularSpeedGradient(N){var p;return this._removeFactorGradient(this._angularSpeedGradients,N),0===(null===(p=this._angularSpeedGradients)||void 0===p?void 0:p.length)&&(this._angleCreation.process=qN,YN(this._angularSpeedGradientProcessing)),this}addVelocityGradient(N,p,T){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:bN,previousItem:null,nextItem:null},rN(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:kN,previousItem:null,nextItem:null},VN(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,N,p,T),this}removeVelocityGradient(N){var p;return this._removeFactorGradient(this._velocityGradients,N),0===(null===(p=this._velocityGradients)||void 0===p?void 0:p.length)&&(YN(this._velocityCreation),YN(this._velocityGradientProcessing)),this}addLimitVelocityGradient(N,p,T){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:lN,previousItem:null,nextItem:null},rN(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:xN,previousItem:null,nextItem:null},rN(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,N,p,T),this}removeLimitVelocityGradient(N){var p;return this._removeFactorGradient(this._limitVelocityGradients,N),0===(null===(p=this._limitVelocityGradients)||void 0===p?void 0:p.length)&&(YN(this._limitVelocityCreation),YN(this._limitVelocityGradientProcessing)),this}addDragGradient(N,p,T){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:PN,previousItem:null,nextItem:null},VN(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:iN,previousItem:null,nextItem:null},VN(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,N,p,T),this}removeDragGradient(N){var p;return this._removeFactorGradient(this._dragGradients,N),0===(null===(p=this._dragGradients)||void 0===p?void 0:p.length)&&(YN(this._dragCreation),YN(this._dragGradientProcessing)),this}addEmitRateGradient(N,p,T){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,N,p,T),this}removeEmitRateGradient(N){return this._removeFactorGradient(this._emitRateGradients,N),this}addStartSizeGradient(N,p,T){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,N,p,T),this._syncStartSizeCreation(),this}removeStartSizeGradient(N){return this._removeFactorGradient(this._startSizeGradients,N),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const N=new Uint8Array(4*this._rawTextureWidth),p=U.TmpColors.wp[0];for(let T=0;T<this._rawTextureWidth;T++){const A=T/this._rawTextureWidth;B.GetCurrentGradient(A,this._rampGradients,((A,a,C)=>{U.wp.LerpToRef(A.color,a.color,C,p),N[4*T]=255*p.r,N[4*T+1]=255*p.g,N[4*T+2]=255*p.b,N[4*T+3]=255}))}this._rampGradientsTexture=t.d.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((N,p)=>N.gradient<p.gradient?-1:N.gradient>p.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(N,p){this._rampGradients||(this._rampGradients=[]);const T=new E(N,p);return this._rampGradients.push(T),this._syncRampGradientTexture(),this}removeRampGradient(N){return this._removeGradientAndTexture(N,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(N,p,T){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=CN,this._colorProcessing.process=UN);const A=new Q(N,p,T);return this._colorGradients.push(A),this._colorGradients.sort(((N,p)=>N.gradient<p.gradient?-1:N.gradient>p.gradient?1:0)),this}removeColorGradient(N){if(!this._colorGradients)return this;let p=0;for(const T of this._colorGradients){if(T.gradient===N){this._colorGradients.splice(p,1);break}p++}return 0===this._colorGradients.length&&(this._colorCreation.process=aN,this._colorProcessing.process=XN),this}resetDrawCache(){if(this._drawWrappers){for(const N of this._drawWrappers)if(N)for(const p of N)null===p||void 0===p||p.dispose();this._drawWrappers=[]}}_fetchR(N,p,T,A,a){return a[4*(((N=.5*Math.abs(N)+.5)*T%T|0)+((p=.5*Math.abs(p)+.5)*A%A|0)*T)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const N=this._engine,p=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*p),this._vertexBuffer=new P.e(N,this._vertexData,!0,p);let T=0;const A=this._vertexBuffer.createVertexBuffer(P.f.PositionKind,T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.f.PositionKind]=A,T+=3;const a=this._vertexBuffer.createVertexBuffer(P.f.ColorKind,T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[P.f.ColorKind]=a,T+=4;const C=this._vertexBuffer.createVertexBuffer("angle",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=C,T+=1;const U=this._vertexBuffer.createVertexBuffer("size",T,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=U,T+=2,this._isAnimationSheetEnabled){const N=this._vertexBuffer.createVertexBuffer("cellIndex",T,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=N,T+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const N=this._vertexBuffer.createVertexBuffer("direction",T,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=N,T+=3}if(this._useRampGradients){const N=this._vertexBuffer.createVertexBuffer("remapData",T,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=N,T+=4}let X;if(this._useInstancing){const p=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new P.e(N,p,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",T,2,this._vertexBufferSize,this._useInstancing),T+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const N=[],p=[];let T=0;for(let A=0;A<this._capacity;A++)N.push(T),N.push(T+1),N.push(T+2),N.push(T),N.push(T+2),N.push(T+3),p.push(T,T+1,T+1,T+2,T+2,T+3,T+3,T,T,T+3),T+=4;this._indexBuffer=this._engine.createIndexBuffer(N),this._linesIndexBuffer=this._engine.createIndexBuffer(p)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(N)setTimeout((()=>{this.start(0)}),N);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var p;-1!==(null===(p=this.Ap)||void 0===p?void 0:p.getClassName().indexOf("Mesh"))&&this.Ap.HX(!0);const N=this.noiseTexture;if(N&&N.onGeneratedObservable)N.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let p=0;p<this.preWarmCycles;p++)this.animate(!0),N.render()}))}));else for(let p=0;p<this.preWarmCycles;p++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(N))}_postStop(N){}reset(){this._stockParticles.length=0,this.yl.length=0}_appendParticleVertex(N,p,T,a){let C=N*this._vertexBufferSize;if(this._vertexData[C++]=p.position.x+this.ve.x,this._vertexData[C++]=p.position.y+this.ve.y,this._vertexData[C++]=p.position.z+this.ve.z,this._vertexData[C++]=p.color.r,this._vertexData[C++]=p.color.g,this._vertexData[C++]=p.color.b,this._vertexData[C++]=p.color.a,this._vertexData[C++]=p.angle,this._vertexData[C++]=p.scale.x*p.size,this._vertexData[C++]=p.scale.y*p.size,this._isAnimationSheetEnabled&&(this._vertexData[C++]=p.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[C++]=p.direction.x,this._vertexData[C++]=p.direction.y,this._vertexData[C++]=p.direction.z);else if(p._initialDirection){let N=p._initialDirection;this.isLocal&&(A.xp.TransformNormalToRef(N,this._emitterWorldMatrix,A.TmpVectors.xp[0]),N=A.TmpVectors.xp[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[C++]=N.x,this._vertexData[C++]=N.y,this._vertexData[C++]=N.z}else{let N=p.direction;this.isLocal&&(A.xp.TransformNormalToRef(N,this._emitterWorldMatrix,A.TmpVectors.xp[0]),N=A.TmpVectors.xp[0]),0===N.x&&0===N.z&&(N.x=.001),this._vertexData[C++]=N.x,this._vertexData[C++]=N.y,this._vertexData[C++]=N.z}this._useRampGradients&&p.remapData&&(this._vertexData[C++]=p.remapData.x,this._vertexData[C++]=p.remapData.y,this._vertexData[C++]=p.remapData.z,this._vertexData[C++]=p.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===T?T=this._epsilon:1===T&&(T=1-this._epsilon),0===a?a=this._epsilon:1===a&&(a=1-this._epsilon)),this._vertexData[C++]=T,this._vertexData[C++]=a)}_prepareParticle(N){}_createNewOnes(N){let p;for(let T=0;T<N&&this.yl.length!==this._capacity;T++){p=this._createParticle(),this.yl.push(p);let N=this._createQueueStart;for(;N;)N.process(p,this),N=N.nextItem;p._inheritParticleInfoToSubEmitters()}}_update(N){if(this._alive=this.yl.length>0,this.Ap.position){const N=this.Ap;this._emitterWorldMatrix=N.getWorldMatrix()}else{const N=this.Ap;this._emitterWorldMatrix=A.Matrix.Translation(N.x,N.y,N.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.yl),this._createNewOnes(N)}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=[P.f.PositionKind,P.f.ColorKind,"angle","offset","size"];return N&&A.push("cellIndex"),p||A.push("direction"),T&&A.push("remapData"),A}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,pN.e)(A),N&&A.push("particlesInfos"),p&&A.push("logarithmicDepthConstant"),T&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(N,p){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pN.p)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&N.push("#define FOG")),this._isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),p===y.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&N.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case 2:N.push("#define BILLBOARDY");break;case 8:case 9:N.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&N.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:N.push("#define BILLBOARDMODE_ALL")}T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,p,T){p.push(...DN._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),N.push(...DN._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,AN.h)(N,this._imageProcessingConfigurationDefines),(0,AN.e)(T,this._imageProcessingConfigurationDefines))}_getWrapper(N){const p=this._getCustomDrawWrapper(N);if(null!==p&&void 0!==p&&p.effect)return p;const T=[];this.fillDefines(T,N);const A=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let a=this._drawWrappers[A];a||(a=this._drawWrappers[A]=[]);let C=a[N];C||(C=new NN.c(this._engine),C.drawContext&&(C.drawContext.useInstancing=this._useInstancing),a[N]=C);const U=T.join("\n");if(C.defines!==U){const N=[],p=[],T=[];this.fillUniformsAttributesAndSamplerNames(p,N,T),C.setEffect(this._engine.createEffect("particles",N,p,T,U,void 0,void 0,void 0,void 0,this._shaderLanguage),U)}return C}animate(){var N;let p,T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!T&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(T?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this.manualEmitCount>-1)p=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let N=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const p=this._actualFrame/this.targetStopDuration;B.GetCurrentGradient(p,this._emitRateGradients,((p,T,A)=>{p!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=T.getFactor(),this._currentEmitRateGradient=p),N=(0,e.Lerp)(this._currentEmitRate1,this._currentEmitRate2,A)}))}p=N*this._scaledUpdateSpeed|0,this._newPartsExcess+=N*this._scaledUpdateSpeed-p}if(this._newPartsExcess>1&&(p+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?p=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(p),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!T){let N=0;for(let p=0;p<this.yl.length;p++){const T=this.yl[p];this._appendParticleVertices(N,T),N+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.yl.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(N,p){this._appendParticleVertex(N++,p,0,0),this._useInstancing||(this._appendParticleVertex(N++,p,1,0),this._appendParticleVertex(N++,p,1,1),this._appendParticleVertex(N++,p,0,1))}rebuild(){var N;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(N=this._spriteBuffer)||void 0===N||N._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!DN.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(T.bind(T,13855)),Promise.resolve().then(T.bind(T,13804))])):await Promise.all([Promise.resolve().then(T.bind(T,13793)),Promise.resolve().then(T.bind(T,13781))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Ap||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==y.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(y.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(y.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(N){const p=this._getWrapper(N),T=p.effect,a=this._engine;a.enableEffect(p);const C=this.defaultViewMatrix??this._scene.getViewMatrix();if(T.setTexture("diffuseSampler",this.particleTexture),T.setMatrix("view",C),T.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();T.setFloat3("particlesInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,this.spriteCellWidth/N.width)}if(T.setVector2("translationPivot",this.translationPivot),T.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;T.setVector3("eyePosition",N.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),T.setTexture("rampSampler",this._rampGradientsTexture));const U=T.defines;var X,y,e,H,M,b;(this._scene&&((0,pN.i)(T,this,this._scene),this.applyFog&&(0,TN.c)(this._scene,void 0,T)),U.indexOf("#define BILLBOARDMODE_ALL")>=0&&(C.invertToRef(A.TmpVectors.Matrix[0]),T.setMatrix("invView",A.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?a.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,T):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,T)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?a.bindBuffers(this._vertexBuffers,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBuffer:this._indexBuffer,T):a.bindBuffers(this._vertexBuffers,null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?this._linesIndexBufferUseInstancing:null,T);(this.useLogarithmicDepth&&this._scene&&(0,TN.h)(U,T,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(T),this._setEngineBasedOnBlendMode(N),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(T),this._useInstancing)?null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?a.drawElementsType(6,0,10,this.yl.length):a.drawArraysType(7,0,4,this.yl.length):null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?a.drawElementsType(1,0,10*this.yl.length):a.drawElementsType(0,0,6*this.yl.length);return this.yl.length}render(){if(!this.isReady()||!this.yl.length)return 0;const N=this._engine;N.setState&&(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0));let p=0;return p=this.blendMode===y.BLENDMODE_MULTIPLYADD?this._render(y.BLENDMODE_MULTIPLY)+this._render(y.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),p}_onDispose(){}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(p,T),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const N=this._scene.Ul.indexOf(this);N>-1&&this._scene.Ul.splice(N,1),this._scene._activeParticleSystems.dispose()}this.SU.notifyObservers(this),this.SU.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}DN.ForceGLSL=!1;var cN,QN=T(12218);!function(N){N[N.ATTACHED=0]="ATTACHED",N[N.END=1]="END"}(cN||(cN={}));class EN{constructor(N){if(this.particleSystem=N,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!N.Ap||!N.Ap.dispose){const p=(0,X.c)("BABYLON.AbstractMesh");N.Ap=new p("SubemitterSystemEmitter",N.KN()),N._disposeEmitterOnDispose=!0}}clone(){let N=this.particleSystem.Ap;if(N){if(N instanceof A.xp)N=N.clone();else if(-1!==N.getClassName().indexOf("Mesh")){N=new((0,X.c)("BABYLON.Mesh"))("",N.KN()),N.isVisible=!1}}else N=new A.xp;const p=new EN(this.particleSystem.clone(this.particleSystem.name,N));return p.particleSystem.name+="Clone",p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem._disposeEmitterOnDispose=!0,p.particleSystem.disposeOnStop=!0,p}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return p.type=this.type,p.inheritDirection=this.inheritDirection,p.inheritedVelocityAmount=this.inheritedVelocityAmount,p.particleSystem=this.particleSystem.serialize(N),p}static _ParseParticleSystem(N,p,T){throw(0,QN.c)("ParseParticle")}static Parse(N,p,T){const A=N.particleSystem,a=new EN(EN._ParseParticleSystem(A,p,T,!0));return a.type=N.type,a.inheritDirection=N.inheritDirection,a.inheritedVelocityAmount=N.inheritedVelocityAmount,a.particleSystem._isSubEmitter=!0,a}dispose(){this.particleSystem.dispose()}}var ON=T(12270);function BN(N,p){const T=new L;return T.direction1=N,T.direction2=p,T}function dN(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function tN(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function SN(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.xp(0,1,0),T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0);return new w(N,p,T)}function sN(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Np(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0),C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.xp(0,1,0);return new x(N,p,T,a,C)}function pp(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new b(N,p)}function Tp(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0);return new l(N,p,T,a)}const Ap=A.xp.Zero(),ap=A.xp.Zero(),Cp=A.xp.Zero();class Up{constructor(){this.strength=0,this.position=A.xp.Zero()}_processParticle(N,p){this.position.subtractToRef(N.position,Ap);const T=Ap.lengthSquared()+1;Ap.normalize().scaleToRef(this.strength/T,ap),ap.scaleToRef(p._tempScaledUpdateSpeed,Cp),N.direction.addInPlace(Cp)}serialize(){return{position:this.position.UX(),strength:this.strength}}}class Xp extends DN{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=N=>{if(!this._subEmitters||0===this._subEmitters.length)return;const p=Math.floor(Math.random()*this._subEmitters.length);for(const T of this._subEmitters[p])if(1===T.type){const p=T.clone();N._inheritParticleInfoToSubEmitter(p),p.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(p.particleSystem),p.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(N,p){const T=BN(N,p);return this.particleEmitterType=T,T}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N,this._flowMapUpdate&&(YN(this._flowMapUpdate),this._flowMapUpdate=null),N&&(this._flowMapUpdate={process:N=>{var p;const T=null===(p=this.KN())||void 0===p?void 0:p.getTransformMatrix();this._flowMap._processParticle(N,this.flowMapStrength*this._tempScaledUpdateSpeed,T)},previousItem:null,nextItem:null},rN(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(N){this._attractors.push(N),1===this._attractors.length&&(this._attractorUpdate={process:N=>{for(const p of this._attractors)p._processParticle(N,this)},previousItem:null,nextItem:null},rN(this._attractorUpdate,this._directionProcessing))}removeAttractor(N){const p=this._attractors.indexOf(N);-1!==p&&this._attractors.splice(p,1),0===this._attractors.length&&YN(this._attractorUpdate)}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(N)}createHemisphericEmitter(){const N=dN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=tN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=SN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.xp(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=sN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=Np(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=Tp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,p,T,A){const a=new M;return this.particleEmitterType=a,this.direction1=N,this.direction2=p,this.minEmitBox=T,this.maxEmitBox=A,a}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const N of this.subEmitters)N instanceof Xp?this._subEmitters.push([new EN(N)]):N instanceof EN?this._subEmitters.push([N]):N instanceof Array&&this._subEmitters.push(N)}_stopSubEmitters(){if(this.activeSubSystems){for(const N of this.activeSubSystems)N.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const N=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==N&&this._rootParticleSystem.activeSubSystems.splice(N,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(N){N&&this._stopSubEmitters()}_prepareParticle(N){if(this._subEmitters&&this._subEmitters.length>0){const p=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];N._attachedSubEmitters=[];for(const T of p)if(0===T.type){const p=T.clone();N._attachedSubEmitters.push(p),p.particleSystem.start()}}}_onDispose(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),N&&this.particles)for(const T of this.particles)if(T._attachedSubEmitters)for(let N=T._attachedSubEmitters.length-1;N>=0;N-=1)T._attachedSubEmitters[N].dispose();if(p&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let N=0;N<this._subEmitters.length;N++)for(const p of this._subEmitters[N])p.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Ap&&this.Ap.dispose&&this.Ap.dispose(!0)}static _Parse(N,p,T,a){let C;C=T instanceof ON.c?null:T;const y=(0,X.c)("BABYLON.Texture");if(y&&C&&(N.texture?p.particleTexture=y.Parse(N.texture,C,a):N.textureName&&(p.particleTexture=new y(a+N.textureName,C,!1,void 0===N.invertY||N.invertY),p.particleTexture.name=N.textureName)),N.emitterId||0===N.emitterId||void 0!==N.Ap?N.emitterId&&C?p.Ap=C.getLastMeshById(N.emitterId):p.Ap=A.xp.gp(N.Ap):p.Ap=A.xp.Zero(),p.isLocal=!!N.isLocal,void 0!==N.renderingGroupId&&(p.renderingGroupId=N.renderingGroupId),void 0!==N.isBillboardBased&&(p.isBillboardBased=N.isBillboardBased),void 0!==N.billboardMode&&(p.billboardMode=N.billboardMode),void 0!==N.useLogarithmicDepth&&(p.useLogarithmicDepth=N.useLogarithmicDepth),N.animations){for(let T=0;T<N.animations.length;T++){const A=N.animations[T],a=(0,X.c)("BABYLON.Animation");a&&p.animations.push(a.Parse(A))}p.beginAnimationOnStart=N.beginAnimationOnStart,p.beginAnimationFrom=N.beginAnimationFrom,p.beginAnimationTo=N.beginAnimationTo,p.beginAnimationLoop=N.beginAnimationLoop}if(N.autoAnimate&&C&&C.beginAnimation(p,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1),p.startDelay=0|N.startDelay,p.minAngularSpeed=N.minAngularSpeed,p.maxAngularSpeed=N.maxAngularSpeed,p.minSize=N.minSize,p.maxSize=N.maxSize,N.minScaleX&&(p.minScaleX=N.minScaleX,p.maxScaleX=N.maxScaleX,p.minScaleY=N.minScaleY,p.maxScaleY=N.maxScaleY),void 0!==N.preWarmCycles&&(p.preWarmCycles=N.preWarmCycles,p.preWarmStepOffset=N.preWarmStepOffset),void 0!==N.minInitialRotation&&(p.minInitialRotation=N.minInitialRotation,p.maxInitialRotation=N.maxInitialRotation),p.minLifeTime=N.minLifeTime,p.maxLifeTime=N.maxLifeTime,p.minEmitPower=N.minEmitPower,p.maxEmitPower=N.maxEmitPower,p.emitRate=N.emitRate,p.gravity=A.xp.gp(N.gravity),N.noiseStrength&&(p.noiseStrength=A.xp.gp(N.noiseStrength)),p.color1=U.LX.gp(N.color1),p.color2=U.LX.gp(N.color2),p.colorDead=U.LX.gp(N.colorDead),p.updateSpeed=N.updateSpeed,p.targetStopDuration=N.targetStopDuration,p.blendMode=N.blendMode,N.colorGradients)for(const A of N.colorGradients)p.addColorGradient(A.gradient,U.LX.gp(A.color1),A.color2?U.LX.gp(A.color2):void 0);if(N.rampGradients){for(const T of N.rampGradients)p.addRampGradient(T.gradient,U.wp.gp(T.color));p.useRampGradients=N.useRampGradients}if(N.colorRemapGradients)for(const A of N.colorRemapGradients)p.addColorRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.alphaRemapGradients)for(const A of N.alphaRemapGradients)p.addAlphaRemapGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.sizeGradients)for(const A of N.sizeGradients)p.addSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.angularSpeedGradients)for(const A of N.angularSpeedGradients)p.addAngularSpeedGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.velocityGradients)for(const A of N.velocityGradients)p.addVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.dragGradients)for(const A of N.dragGradients)p.addDragGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.emitRateGradients)for(const A of N.emitRateGradients)p.addEmitRateGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.startSizeGradients)for(const A of N.startSizeGradients)p.addStartSizeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.lifeTimeGradients)for(const A of N.lifeTimeGradients)p.addLifeTimeGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);if(N.limitVelocityGradients){for(const T of N.limitVelocityGradients)p.addLimitVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);p.limitVelocityDamping=N.limitVelocityDamping}if(N.noiseTexture&&C){const T=(0,X.c)("BABYLON.ProceduralTexture");p.noiseTexture=T.Parse(N.noiseTexture,C,a)}let e;if(N.particleEmitterType){switch(N.particleEmitterType.type){case"SphereParticleEmitter":e=new n;break;case"SphereDirectedParticleEmitter":e=new w;break;case"ConeEmitter":case"ConeParticleEmitter":e=new b;break;case"ConeDirectedParticleEmitter":e=new l;break;case"CylinderParticleEmitter":e=new k;break;case"CylinderDirectedParticleEmitter":e=new x;break;case"HemisphericParticleEmitter":e=new I;break;case"PointParticleEmitter":e=new L;break;case"MeshParticleEmitter":e=new i;break;case"CustomParticleEmitter":e=new g;break;default:e=new M}e.parse(N.particleEmitterType,C)}else e=new M,e.parse(N,C);p.particleEmitterType=e,p.startSpriteCellID=N.startSpriteCellID,p.endSpriteCellID=N.endSpriteCellID,p.spriteCellLoop=N.spriteCellLoop??!0,p.spriteCellWidth=N.spriteCellWidth,p.spriteCellHeight=N.spriteCellHeight,p.spriteCellChangeSpeed=N.spriteCellChangeSpeed,p.spriteRandomStartCell=N.spriteRandomStartCell,p.disposeOnStop=N.disposeOnStop??!1,p.manualEmitCount=N.manualEmitCount??-1}static Parse(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0;const X=N.name;let y,e,H=null,M=null;if(p instanceof ON.c?y=p:(e=p,y=e.getEngine()),N.customShader&&y.createEffectForParticles){M=N.customShader;const p=M.shaderOptions.defines.length>0?M.shaderOptions.defines.join("\n"):"";H=y.createEffectForParticles(M.shaderPath.fragmentElement,M.shaderOptions.uniforms,M.shaderOptions.samplers,p)}const b=new Xp(X,C||N.Kp,p,H,N.isAnimationSheetEnabled);if(b.customShader=M,b._rootUrl=T,N.id&&(b.id=N.id),N.subEmitters){b.subEmitters=[];for(const A of N.subEmitters){const N=[];for(const a of A)N.push(EN.Parse(a,p,T));b.subEmitters.push(N)}}if(N.attractors)for(const U of N.attractors){const N=new Up;N.position=A.xp.gp(U.position),N.strength=U.strength,b.addAttractor(N)}return Xp._Parse(N,b,p,T),N.textureMask&&(b.textureMask=U.LX.gp(N.textureMask)),N.ve&&(b.ve=A.xp.gp(N.ve)),N.preventAutoStart&&(b.preventAutoStart=N.preventAutoStart),a||b.preventAutoStart||b.start(),b}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};if(Xp._Serialize(p,this,N),p.textureMask=this.textureMask.UX(),p.customShader=this.customShader,p.preventAutoStart=this.preventAutoStart,p.ve=this.ve.UX(),this.subEmitters){p.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const T of this._subEmitters){const A=[];for(const p of T)A.push(p.serialize(N));p.subEmitters.push(A)}}if(this._attractors&&this._attractors.length){p.attractors=[];for(const N of this._attractors)p.attractors.push(N.serialize())}return p}static _Serialize(N,p,T){if(N.name=p.name,N.id=p.id,N.Kp=p.getCapacity(),N.disposeOnStop=p.disposeOnStop,N.manualEmitCount=p.manualEmitCount,p.Ap.position){const T=p.Ap;N.emitterId=T.id}else{const T=p.Ap;N.Ap=T.UX()}p.particleEmitterType&&(N.particleEmitterType=p.particleEmitterType.serialize()),p.particleTexture&&(T?N.texture=p.particleTexture.serialize():(N.textureName=p.particleTexture.name,N.invertY=!!p.particleTexture._invertY)),N.isLocal=p.isLocal,o.e.AppendSerializedAnimations(p,N),N.beginAnimationOnStart=p.beginAnimationOnStart,N.beginAnimationFrom=p.beginAnimationFrom,N.beginAnimationTo=p.beginAnimationTo,N.beginAnimationLoop=p.beginAnimationLoop,N.startDelay=p.startDelay,N.renderingGroupId=p.renderingGroupId,N.isBillboardBased=p.isBillboardBased,N.billboardMode=p.billboardMode,N.minAngularSpeed=p.minAngularSpeed,N.maxAngularSpeed=p.maxAngularSpeed,N.minSize=p.minSize,N.maxSize=p.maxSize,N.minScaleX=p.minScaleX,N.maxScaleX=p.maxScaleX,N.minScaleY=p.minScaleY,N.maxScaleY=p.maxScaleY,N.minEmitPower=p.minEmitPower,N.maxEmitPower=p.maxEmitPower,N.minLifeTime=p.minLifeTime,N.maxLifeTime=p.maxLifeTime,N.emitRate=p.emitRate,N.gravity=p.gravity.UX(),N.noiseStrength=p.noiseStrength.UX(),N.color1=p.color1.UX(),N.color2=p.color2.UX(),N.colorDead=p.colorDead.UX(),N.updateSpeed=p.updateSpeed,N.targetStopDuration=p.targetStopDuration,N.blendMode=p.blendMode,N.preWarmCycles=p.preWarmCycles,N.preWarmStepOffset=p.preWarmStepOffset,N.minInitialRotation=p.minInitialRotation,N.maxInitialRotation=p.maxInitialRotation,N.startSpriteCellID=p.startSpriteCellID,N.spriteCellLoop=p.spriteCellLoop,N.endSpriteCellID=p.endSpriteCellID,N.spriteCellChangeSpeed=p.spriteCellChangeSpeed,N.spriteCellWidth=p.spriteCellWidth,N.spriteCellHeight=p.spriteCellHeight,N.spriteRandomStartCell=p.spriteRandomStartCell,N.isAnimationSheetEnabled=p.isAnimationSheetEnabled,N.useLogarithmicDepth=p.useLogarithmicDepth;const A=p.getColorGradients();if(A){N.colorGradients=[];for(const p of A){const T={gradient:p.gradient,color1:p.color1.UX()};p.color2?T.color2=p.color2.UX():T.color2=p.color1.UX(),N.colorGradients.push(T)}}const a=p.getRampGradients();if(a){N.rampGradients=[];for(const p of a){const T={gradient:p.gradient,color:p.color.UX()};N.rampGradients.push(T)}N.useRampGradients=p.useRampGradients}const C=p.getColorRemapGradients();if(C){N.colorRemapGradients=[];for(const p of C){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.colorRemapGradients.push(T)}}const U=p.getAlphaRemapGradients();if(U){N.alphaRemapGradients=[];for(const p of U){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.alphaRemapGradients.push(T)}}const X=p.getSizeGradients();if(X){N.sizeGradients=[];for(const p of X){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.sizeGradients.push(T)}}const y=p.getAngularSpeedGradients();if(y){N.angularSpeedGradients=[];for(const p of y){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.angularSpeedGradients.push(T)}}const e=p.getVelocityGradients();if(e){N.velocityGradients=[];for(const p of e){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.velocityGradients.push(T)}}const H=p.getDragGradients();if(H){N.dragGradients=[];for(const p of H){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.dragGradients.push(T)}}const M=p.getEmitRateGradients();if(M){N.emitRateGradients=[];for(const p of M){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.emitRateGradients.push(T)}}const b=p.getStartSizeGradients();if(b){N.startSizeGradients=[];for(const p of b){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.startSizeGradients.push(T)}}const l=p.getLifeTimeGradients();if(l){N.lifeTimeGradients=[];for(const p of l){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.lifeTimeGradients.push(T)}}const k=p.getLimitVelocityGradients();if(k){N.limitVelocityGradients=[];for(const p of k){const T={gradient:p.gradient,factor1:p.factor1};void 0!==p.factor2?T.factor2=p.factor2:T.factor2=p.factor1,N.limitVelocityGradients.push(T)}N.limitVelocityDamping=p.limitVelocityDamping}p.noiseTexture&&(N.noiseTexture=p.noiseTexture.serialize())}clone(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let a=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){a=this.customShader;const N=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"",p=C.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,N);A[0]?A[0].effect=p:this.setCustomEffect(p,0)}const U=this.serialize(T),X=Xp.Parse(U,this._scene||this._engine,this._rootUrl);return X.name=N,X.customShader=a,X._customWrappers=A,void 0===p&&(p=this.Ap),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Ap=p,this.preventAutoStart||X.start(),X}}Xp.BILLBOARDMODE_Y=2,Xp.BILLBOARDMODE_ALL=7,Xp.BILLBOARDMODE_STRETCHED=8,Xp.BILLBOARDMODE_STRETCHED_LOCAL=9,EN._ParseParticleSystem=Xp.Parse;var yp=T(12623),ep=T(12617),Hp=T(12505);Hp.d.prototype.createTransformFeedback=function(){const N=this._gl.createTransformFeedback();if(!N)throw new Error("Unable to create Transform Feedback");return N},Hp.d.prototype.deleteTransformFeedback=function(N){this._gl.deleteTransformFeedback(N)},Hp.d.prototype.bindTransformFeedback=function(N){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,N)},Hp.d.prototype.beginTransformFeedback=function(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(N?this._gl.POINTS:this._gl.TRIANGLES)},Hp.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Hp.d.prototype.setTranformFeedbackVaryings=function(N,p){this._gl.transformFeedbackVaryings(N,p,this._gl.INTERLEAVED_ATTRIBS)},Hp.d.prototype.bindTransformFeedbackBuffer=function(N){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N?N.underlyingResource:null)},Hp.d.prototype.readTransformFeedbackBuffer=function(N){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,N)};const Mp="clipPlaneFragmentDeclaration2",bp="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";F.b.IncludesShadersStore[Mp]||(F.b.IncludesShadersStore[Mp]=bp);T(13687),T(13695),T(13703),T(13710),T(13716),T(13720),T(13724),T(13727);const lp="gpuRenderParticlesPixelShader",kp="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";F.b.ShadersStore[lp]||(F.b.ShadersStore[lp]=kp);const xp="clipPlaneVertexDeclaration2",Ip="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";F.b.IncludesShadersStore[xp]||(F.b.IncludesShadersStore[xp]=Ip);T(13734),T(13738),T(13740),T(13749);const Lp="gpuRenderParticlesVertexShader",np="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";F.b.ShadersStore[Lp]||(F.b.ShadersStore[Lp]=np);class wp extends y{static get IsSupported(){if(!S.b.LastCreatedEngine)return!1;const N=S.b.LastCreatedEngine.getCaps();return N.supportTransformFeedbacks||N.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(N){this._maxActiveParticleCount=Math.min(N,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(N){this.maxActiveParticleCount=N}createPointEmitter(N,p){const T=BN(N,p);return this.particleEmitterType=T,T}createHemisphericEmitter(){const N=dN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createSphereEmitter(){const N=tN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=N,N}createDirectedSphereEmitter(){const N=SN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A.xp(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createCylinderEmitter(){const N=sN(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=N,N}createDirectedCylinderEmitter(){const N=Np(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createConeEmitter(){const N=pp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=N,N}createDirectedConeEmitter(){const N=Tp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new A.xp(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new A.xp(0,1,0));return this.particleEmitterType=N,N}createBoxEmitter(N,p,T,A){const a=new M;return this.particleEmitterType=a,this.direction1=N,this.direction2=p,this.minEmitBox=T,this.maxEmitBox=A,a}get flowMap(){return this._flowMap}set flowMap(N){this._flowMap!==N&&(this._flowMap=N)}isReady(){if(!this.Ap||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Xp.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Xp.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Xp.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";N?setTimeout((()=>{this.start(0)}),N):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var N;let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(N=this._customWrappers[p])||void 0===N?void 0:N.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[N]??this._customWrappers[0]}setCustomEffect(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[p]=new NN.c(this._engine),this._customWrappers[p].effect=N}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new d.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(N,p,T){return super._removeGradientAndTexture(N,p,T),this._releaseBuffers(),this}addColorGradient(N,p){this._colorGradients||(this._colorGradients=[]);const T=new Q(N,p);return this._colorGradients.push(T),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(N&&this._colorGradients.sort(((N,p)=>N.gradient<p.gradient?-1:N.gradient>p.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(N){return this._removeGradientAndTexture(N,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const p in this._drawWrappers){var N;null===(N=this._drawWrappers[p].drawContext)||void 0===N||N.reset()}}_addFactorGradient(N,p,T){const A=new O(p,T);N.push(A),this._releaseBuffers()}addSizeGradient(N,p){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,N,p),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(N){return this._removeGradientAndTexture(N,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(N,p){if(!N)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&N.sort(((N,p)=>N.gradient<p.gradient?-1:N.gradient>p.gradient?1:0));const T=this;T[p]&&(T[p].dispose(),T[p]=null)}addAngularSpeedGradient(N,p){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,N,p),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(N){return this._removeGradientAndTexture(N,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(N,p){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,N,p),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(N){return this._removeGradientAndTexture(N,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(N,p){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,N,p),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(N){return this._removeGradientAndTexture(N,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(N,p){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,N,p),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(N){return this._removeGradientAndTexture(N,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(N){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(N),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.SU=new d.c,this.onStoppedObservable=new d.c,this.onStartedObservable=new d.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,T&&"Scene"!==T.getClassName()?(this._engine=T,this.defaultProjectionMatrix=A.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=T||S.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Ul.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new NN.c(this._engine)},this._customWrappers[0].effect=a,this._drawWrappers={0:new NN.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(p=p??{}).randomTextureSize||delete p.randomTextureSize;const U={Kp:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...p},y=p;isFinite(y)&&(U.Kp=y),this._capacity=U.Kp,this._maxActiveParticleCount=U.Kp,this._currentActiveCount=0,this._isAnimationSheetEnabled=C,this.particleEmitterType=new M;const e=Math.min(this._engine.getCaps().maxTextureSize,U.randomTextureSize);let H=[];for(let A=0;A<e;++A)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture=new t.d(new Float32Array(H),e,1,5,T,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,H=[];for(let A=0;A<e;++A)H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random());this._randomTexture2=new t.d(new Float32Array(H),e,1,5,T,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=e}_reset(){this._releaseBuffers()}_createVertexBuffers(N,p,T){const A={};A.position=p.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let a=3;A.age=p.createVertexBuffer("age",a,1,this._attributesStrideSize,!0),a+=1,A.size=p.createVertexBuffer("size",a,3,this._attributesStrideSize,!0),a+=3,A.life=p.createVertexBuffer("life",a,1,this._attributesStrideSize,!0),a+=1,a+=4,this.billboardMode===Xp.BILLBOARDMODE_STRETCHED&&(A.direction=p.createVertexBuffer("direction",a,3,this._attributesStrideSize,!0)),a+=3,this._platform.alignDataInBuffer&&(a+=1),this.particleEmitterType instanceof g&&(a+=3,this._platform.alignDataInBuffer&&(a+=1)),this._colorGradientsTexture||(A.color=p.createVertexBuffer("color",a,4,this._attributesStrideSize,!0),a+=4),this._isBillboardBased||(A.initialDirection=p.createVertexBuffer("initialDirection",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1)),this.noiseTexture&&(A.noiseCoordinates1=p.createVertexBuffer("noiseCoordinates1",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1),A.noiseCoordinates2=p.createVertexBuffer("noiseCoordinates2",a,3,this._attributesStrideSize,!0),a+=3,this._platform.alignDataInBuffer&&(a+=1)),A.angle=p.createVertexBuffer("angle",a,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?a++:a+=2,this._isAnimationSheetEnabled&&(A.cellIndex=p.createVertexBuffer("cellIndex",a,1,this._attributesStrideSize,!0),a+=1,this.spriteRandomStartCell&&(A.cellStartOffset=p.createVertexBuffer("cellStartOffset",a,1,this._attributesStrideSize,!0),a+=1)),A.offset=T.createVertexBuffer("offset",0,2),A.uv=T.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(A),this._platform.createVertexBuffers(N,A),this.resetDrawCache()}_initialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!N)return;const p=this._engine,T=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof g&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const a=this.particleEmitterType instanceof g,C=A.TmpVectors.xp[0];let U=0;for(let A=0;A<this._capacity;A++)if(T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),a?(this.particleEmitterType.particleDestinationGenerator(A,null,C),T.push(C.x),T.push(C.y),T.push(C.z)):(T.push(0),T.push(0),T.push(0)),this._platform.alignDataInBuffer&&T.push(0),U+=16,a&&(this.particleEmitterType.particlePositionGenerator(A,null,C),T.push(C.x),T.push(C.y),T.push(C.z),this._platform.alignDataInBuffer&&T.push(0),U+=4),this._colorGradientsTexture||(T.push(0),T.push(0),T.push(0),T.push(0),U+=4),this.isBillboardBased||(T.push(0),T.push(0),T.push(0),this._platform.alignDataInBuffer&&T.push(0),U+=4),this.noiseTexture&&(T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),T.push(Math.random()),T.push(Math.random()),T.push(Math.random()),this._platform.alignDataInBuffer&&T.push(0),U+=8),T.push(0),U+=1,this._angularSpeedGradientsTexture||(T.push(0),U+=1),this._isAnimationSheetEnabled&&(T.push(0),U+=1,this.spriteRandomStartCell&&(T.push(0),U+=1)),this._platform.alignDataInBuffer){let N=3-(U+3&3);for(U+=N;N-- >0;)T.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),y=this._platform.createParticleBuffer(T),e=this._platform.createParticleBuffer(T);this._buffer0=new P.e(p,y,!1,this._attributesStrideSize),this._buffer1=new P.e(p,e,!1,this._attributesStrideSize),this._spriteBuffer=new P.e(p,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let N=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(N+="\n#define BILLBOARD"),this._colorGradientsTexture&&(N+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(N+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(N+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(N+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(N+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(N+="\n#define DRAGGRADIENTS"),this._flowMap&&(N+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(N+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(N+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(N+="\n#define NOISE"),this.isLocal&&(N+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===N||(this._cachedUpdateDefines=N,this._updateBuffer=this._platform.createUpdateBuffer(N)),this._platform.isUpdateBufferReady()}_getWrapper(N){const p=this._getCustomDrawWrapper(N);if(null!==p&&void 0!==p&&p.effect)return p;const T=[];this.fillDefines(T,N);let A=this._drawWrappers[N];A||(A=new NN.c(this._engine),A.drawContext&&(A.drawContext.useInstancing=!0),this._drawWrappers[N]=A);const a=T.join("\n");if(A.defines!==a){const N=[],p=[],T=[];this.fillUniformsAttributesAndSamplerNames(p,N,T),A.setEffect(this._engine.createEffect("gpuRenderParticles",N,p,T,a),a)}return A}static _GetAttributeNamesOrOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=[P.f.PositionKind,"age","life","size","angle"];return N||a.push(P.f.ColorKind),p&&a.push("cellIndex"),T||a.push("initialDirection"),A&&a.push("direction"),a.push("offset",P.f.UVKind),a}static _GetEffectCreationOptions(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A=["emitterWM","ve","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,pN.e)(A),N&&A.push("sheetInfos"),p&&A.push("logarithmicDepthConstant"),T&&(A.push("vFogInfos"),A.push("vFogColor")),A}fillDefines(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,pN.p)(this,this._scene,N),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==ep.c.FOGMODE_NONE&&N.push("#define FOG")),p===Xp.BLENDMODE_MULTIPLY&&N.push("#define BLENDMULTIPLYMODE"),this.isLocal&&N.push("#define LOCAL"),this.useLogarithmicDepth&&N.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(N.push("#define BILLBOARD"),this.billboardMode){case Xp.BILLBOARDMODE_Y:N.push("#define BILLBOARDY");break;case Xp.BILLBOARDMODE_STRETCHED:N.push("#define BILLBOARDSTRETCHED");break;case Xp.BILLBOARDMODE_ALL:N.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&N.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&N.push("#define ANIMATESHEET"),T&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),N.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(N,p,T){p.push(...wp._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Xp.BILLBOARDMODE_STRETCHED)),N.push(...wp._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),T.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(yp.e.PrepareUniforms(N,this._imageProcessingConfigurationDefines),yp.e.PrepareSamplers(T,this._imageProcessingConfigurationDefines))}animate(){var N;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(p?this.preWarmStepOffset:(null===(N=this._scene)||void 0===N?void 0:N.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(N,p){const T=this[p];if(!N||!N.length||T)return;const A=new Float32Array(this._rawTextureWidth);for(let a=0;a<this._rawTextureWidth;a++){const p=a/this._rawTextureWidth;B.GetCurrentGradient(p,N,((N,p,T)=>{A[a]=(0,e.Lerp)(N.factor1,p.factor1,T)}))}this[p]=t.d.CreateRTexture(A,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[p].name=p.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const N=new Uint8Array(4*this._rawTextureWidth),p=U.TmpColors.LX[0];for(let T=0;T<this._rawTextureWidth;T++){const A=T/this._rawTextureWidth;B.GetCurrentGradient(A,this._colorGradients,((A,a,C)=>{U.LX.LerpToRef(A.color1,a.color1,C,p),N[4*T]=255*p.r,N[4*T+1]=255*p.g,N[4*T+2]=255*p.b,N[4*T+3]=255*p.a}))}this._colorGradientsTexture=t.d.CreateRGBATexture(N,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(N,p){var T,a,C,U;const X=this._getWrapper(N),y=X.effect;this._engine.enableEffect(X);const e=(null===(T=this._scene)||void 0===T?void 0:T.getViewMatrix())||A.Matrix.IdentityReadOnly;if(y.setMatrix("view",e),y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),y.setTexture("diffuseSampler",this.particleTexture),y.setVector2("translationPivot",this.translationPivot),y.setVector3("ve",this.ve),this.isLocal&&y.setMatrix("emitterWM",p),this._colorGradientsTexture?y.setTexture("colorGradientSampler",this._colorGradientsTexture):y.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const N=this.particleTexture.getBaseSize();y.setFloat3("sheetInfos",this.spriteCellWidth/N.width,this.spriteCellHeight/N.height,N.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const N=this._scene.activeCamera;y.setVector3("eyePosition",N.globalPosition)}const H=y.defines;if(this._scene&&((0,pN.i)(y,this,this._scene),this.applyFog&&(0,TN.c)(this._scene,void 0,y)),H.indexOf("#define BILLBOARDMODE_ALL")>=0){const N=e.clone();N.invert(),y.setMatrix("invView",N)}return this.useLogarithmicDepth&&this._scene&&(0,TN.h)(H,y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(y),this._setEngineBasedOnBlendMode(N),this._platform.bindDrawBuffers(this._targetIndex,y,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(y),null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(U=this._scene)&&void 0!==U&&U.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(N){if(!this.Ap||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!N)if(this.Ap.position){N=this.Ap.getWorldMatrix()}else{const p=this.Ap;N=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(p.x,p.y,p.z,N)}const p=this._engine,T=p.getDepthWrite();if(p.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const N=this.KN();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",N.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",N),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const a=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=a,p.setDepthWrite(T)}render(){let N,p=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!p&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const N=0|this._accumulatedCount;this._accumulatedCount-=N,this._currentActiveCount+=N}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Ap.position){N=this.Ap.getWorldMatrix()}else{const p=this.Ap;N=A.TmpVectors.Matrix[0],A.Matrix.TranslationToRef(p.x,p.y,p.z,N)}const a=this._engine;this.updateInAnimate||this._update(N);let C=0;return p||T||(a.setState(!1),this.forceDepthWrite&&a.setDepthWrite(!0),C=this.blendMode===Xp.BLENDMODE_MULTIPLYADD?this._render(Xp.BLENDMODE_MULTIPLY,N)+this._render(Xp.BLENDMODE_ADD,N):this._render(this.blendMode,N),this._engine.setAlphaMode(0)),C}rebuild(){const N=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(N,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,N()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const p in this._drawWrappers){this._drawWrappers[p].dispose()}if(this._drawWrappers={},this._scene){const N=this._scene.Ul.indexOf(this);N>-1&&this._scene.Ul.splice(N,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let p=0;p<this._renderVertexBuffers.length;++p){const N=this._renderVertexBuffers[p];for(const p in N)N[p].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),N&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),N&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.SU.notifyObservers(this),this.SU.clear()}clone(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const A={...this._customWrappers};let a=null;const C=this._engine;if(C.createEffectForParticles&&null!=this.customShader){a=this.customShader;const N=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"";A[0]=C.createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,N,void 0,void 0,void 0,this)}const U=this.serialize(T),X=wp.Parse(U,this._scene||this._engine,this._rootUrl);return X.name=N,X.customShader=a,X._customWrappers=A,void 0===p&&(p=this.Ap),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.Ap=p,X}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={};return Xp._Serialize(p,this,N),p.activeParticleCount=this.activeParticleCount,p.randomTextureSize=this._randomTextureSize,p.customShader=this.customShader,p}static Parse(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const C=N.name;let U,X;p instanceof ON.c?U=p:(X=p,U=X.getEngine());const y=new wp(C,{Kp:a||N.Kp,randomTextureSize:N.randomTextureSize},p,null,N.isAnimationSheetEnabled);if(y._rootUrl=T,N.customShader&&U.createEffectForParticles){const p=N.customShader,T=p.shaderOptions.defines.length>0?p.shaderOptions.defines.join("\n"):"",A=U.createEffectForParticles(p.shaderPath.fragmentElement,p.shaderOptions.uniforms,p.shaderOptions.samplers,T,void 0,void 0,void 0,y);y.setCustomEffect(A,0),y.customShader=p}return N.id&&(y.id=N.id),N.activeParticleCount&&(y.activeParticleCount=N.activeParticleCount),Xp._Parse(N,y,p,T),N.preventAutoStart&&(y.preventAutoStart=N.preventAutoStart),A||y.preventAutoStart||y.start(),y}}var gp=T(12190),Pp=T(13753),ip=T(12745);class Kp{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(N){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const p of this.systems)p.Ap=N;this._emitterNode=N}setEmitterAsSphere(N,p,T){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:N,renderingGroupId:p};const A=(0,Pp.e)("emitterSphere",{diameter:N.diameter,segments:N.segments},T);A.renderingGroupId=p;const a=new ip.np("emitterSphereMaterial",T);a.emissiveColor=N.color,A.material=a;for(const C of this.systems)C.Ap=A;this._emitterNode=A}start(N){for(const p of this.systems)N&&(p.Ap=N),p.start()}dispose(){for(const N of this.systems)N.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const p={systems:[]};for(const T of this.systems)p.systems.push(T.serialize(N));return this._emitterNode&&(p.Ap=this._emitterCreationOptions),p}static Parse(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;const a=new Kp,C=this.BaseAssetsUrl+"/textures/";p=p||S.b.LastCreatedScene;for(const U of N.systems)a.systems.push(T?wp.Parse(U,p,C,!0,A):Xp.Parse(U,p,C,!0,A));if(N.Ap){const T=N.Ap.options;if("Sphere"===N.Ap.kind)a.setEmitterAsSphere({diameter:T.diameter,segments:T.segments,color:U.wp.gp(T.color)},N.Ap.renderingGroupId,p)}return a}}Kp.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Fp=T(12223);class vp{static CreateDefault(N){let p,T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,A=arguments.length>2?arguments[2]:void 0;p=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new wp("default system",{Kp:T},A):new Xp("default system",T,A),p.Ap=N;const a=gp.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return p.particleTexture=new Z.c(a,p.KN()),p.createConeEmitter(.1,Math.PI/4),p.color1=new U.LX(1,1,1,1),p.color2=new U.LX(1,1,1,1),p.colorDead=new U.LX(1,1,1,0),p.minSize=.1,p.maxSize=.1,p.minEmitPower=2,p.maxEmitPower=2,p.updateSpeed=1/60,p.emitRate=30,p}static CreateAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0;p||(p=S.b.LastCreatedScene);const a={};return p.addPendingData(a),new Promise(((C,U)=>{if(T&&!wp.IsSupported)return p.removePendingData(a),U("Particle system with GPU is not supported.");gp.Tools.LoadFile(`${vp.BaseAssetsUrl}/systems/${N}.json`,(N=>{p.removePendingData(a);const U=JSON.parse(N.toString());return C(Kp.Parse(U,p,T,A))}),void 0,void 0,void 0,(()=>(p.removePendingData(a),U(`An error occurred with the creation of your particle system. Check if your type '${N}' exists.`))))}))}static ExportSet(N){const p=new Kp;for(const T of N)p.systems.push(T);return p}static ParseFromFileAsync(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",C=arguments.length>5?arguments[5]:void 0;return new Promise(((U,X)=>{const y=new Fp.b;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const p=JSON.parse(y.responseText);let X;X=A?wp.Parse(p,T,a,!1,C):Xp.Parse(p,T,a,!1,C),N&&(X.name=N),U(X)}else X("Unable to load the particle system")})),y.open("GET",p),y.send()}))}static ParseFromSnippetAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0;if("_BLANK"===N){const N=this.CreateDefault(null);return N.start(),Promise.resolve(N)}return new Promise(((C,U)=>{const X=new Fp.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const U=JSON.parse(JSON.parse(X.responseText).jsonPayload),y=JSON.parse(U.particleSystem);let e;e=T?wp.Parse(y,p,A,!1,a):Xp.Parse(y,p,A,!1,a),e.snippetId=N,C(e)}else U("Unable to load the snippet "+N)})),X.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),X.send()}))}}vp.BaseAssetsUrl=Kp.BaseAssetsUrl,vp.SnippetUrl="https://snippet.babylonjs.com",vp.CreateFromSnippetAsync=vp.ParseFromSnippetAsync;var Wp=T(12833),zp=T(12656),Rp=T(13761);(0,Rp.d)(zp.c.NAME_PARTICLESYSTEM,((N,p,T,A)=>{const a=(0,Rp.e)(zp.c.NAME_PARTICLESYSTEM);if(a&&void 0!==N.Ul&&null!==N.Ul)for(let C=0,U=N.Ul.length;C<U;C++){const U=N.Ul[C];T.Ul.push(a(U,p,A))}})),(0,Rp.b)(zp.c.NAME_PARTICLESYSTEM,((N,p,T)=>{if(N.activeParticleCount){return wp.Parse(N,p,T)}return Xp.Parse(N,p,T)})),ON.c.prototype.createEffectForParticles=function(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",C=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,y=arguments.length>7?arguments[7]:void 0,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,H=arguments.length>9?arguments[9]:void 0,M=[],b=[];const l=[];return y?y.fillUniformsAttributesAndSamplerNames(b,M,l):(M=Xp._GetAttributeNamesOrOptions(),b=Xp._GetEffectCreationOptions()),-1===a.indexOf(" BILLBOARD")&&(a+="\n#define BILLBOARD\n"),null!==y&&void 0!==y&&y.isAnimationSheetEnabled&&-1===a.indexOf(" ANIMATESHEET")&&(a+="\n#define ANIMATESHEET\n"),-1===A.indexOf("diffuseSampler")&&A.push("diffuseSampler"),this.createEffect({vertex:H??(null===y||void 0===y?void 0:y.vertexShaderName)??"particles",fragmentElement:N},M,b.concat(p),l.concat(A),a,C,U,X,void 0,e,(async()=>{0===e?await Promise.resolve().then(T.bind(T,13793)):await Promise.resolve().then(T.bind(T,13855))}))},Wp.d.prototype.getEmittedParticleSystems=function(){const N=[];for(let p=0;p<this.KN().Ul.length;p++){const T=this.KN().Ul[p];T.Ap===this&&N.push(T)}return N},Wp.d.prototype.getHierarchyEmittedParticleSystems=function(){const N=[],p=this.getDescendants();p.push(this);for(let T=0;T<this.KN().Ul.length;T++){const A=this.KN().Ul[T],a=A.Ap;a.position&&-1!==p.indexOf(a)&&N.push(A)}return N};T(12717),T(12721),T(12806);T(12813),T(13767),T(12581),T(12708),T(12847);T(12573);var Jp;T(13773),T(12398);!function(N){N[N.Color=2]="Color",N[N.UV=1]="UV",N[N.Random=0]="Random",N[N.Stated=3]="Stated"}(Jp||(Jp={}));var fp=T(12608);const Gp=new A.xp(0,0,0),op=new A.xp(0,0,0),Zp=new A.xp(0,0,0);class mT{constructor(N,p,T){this.width=N,this.height=p,this.data=T}processFlowable(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;if(!T)return;T instanceof A.Matrix?A.xp.TransformCoordinatesToRef(N.position,T,Zp):(Zp.x=T.x,Zp.y=T.y,Zp.z=T.z);const a=.5*Zp.x+.5,C=1-(.5*Zp.y+.5),U=Math.floor(a*this.width),X=Math.floor(C*this.height);if(U<0||U>=this.width||X<0||X>=this.height)return;const y=4*(X*this.width+U),e=this.data[y]/255*2-1,H=this.data[y+1]/255*2-1,M=this.data[y+2]/255*2-1,b=this.data[y+3]/255;Gp.set(e,H,M),Gp.scaleToRef(p*b,op),N.direction.addInPlace(op)}_processParticle(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,T=arguments.length>2?arguments[2]:void 0;this.processFlowable(N,p,T)}static async FromUrlAsync(N){return await new Promise(((p,T)=>{const A=document.createElement("canvas"),a=A.getContext("2d");let C=null;const U=new Image;U.crossOrigin="anonymous",U.src=N,U.onerror=p=>{T(new Error(`Failed to load image: ${N} : ${p}`))},U.onload=()=>{A.width=U.width,A.height=U.height,a.drawImage(U,0,0),C=a.getImageData(0,0,A.width,A.height),p(new mT(A.width,A.height,C.data))}}))}static async ExtractFromTextureAsync(N){return await new Promise(((p,T)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{const T=await this.ExtractFromTextureAsync(N);p(T)}catch(A){T(A)}}));const A=N.getSize();fp.j.GetTextureDataAsync(N,A.width,A.height).then((N=>{p(new mT(A.width,A.height,new Uint8ClampedArray(N)))})).catch(T)}))}}var qp,hp,jp,Vp,rp,upN,Yp,Dp,cp;!function(N){N[N.Int=1]="Int",N[N.Float=2]="Float",N[N.Vector2=4]="Vector2",N[N.xp=8]="xp",N[N.Matrix=16]="Matrix",N[N.Particle=32]="Particle",N[N.Texture=64]="Texture",N[N.LX=128]="LX",N[N.FloatGradient=256]="FloatGradient",N[N.Vector2Gradient=512]="Vector2Gradient",N[N.Vector3Gradient=1024]="Vector3Gradient",N[N.Color4Gradient=2048]="Color4Gradient",N[N.System=4096]="System",N[N.AutoDetect=8192]="AutoDetect",N[N.BasedOnInput=16384]="BasedOnInput",N[N.Undefined=32768]="Undefined",N[N.All=65535]="All"}(qp||(qp={})),function(N){N[N.Compatible=0]="Compatible",N[N.TypeIncompatible=1]="TypeIncompatible",N[N.HierarchyIssue=2]="HierarchyIssue"}(hp||(hp={})),function(N){N[N.Input=0]="Input",N[N.Output=1]="Output"}(jp||(jp={}));class Qp{get direction(){return this._direction}get type(){if(this._type===qp.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===qp.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(N){this._type=N}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((N=>N.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(N,p,T){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=qp.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new d.c,this.onDisconnectionObservable=new d.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=p,this.name=N,this._direction=T}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(N){var p;return this.isConnected?null!==(p=this._connectedPoint)&&void 0!==p&&p._storedFunction?this._connectedPoint._storedFunction(N):this._connectedPoint._storedValue:this.value}canConnectTo(N){return 0===this.checkCompatibilityState(N)}checkCompatibilityState(N){const p=this._ownerBlock,T=N.ownerBlock;if(this.type!==N.type&&N.innerType!==qp.AutoDetect)return N.acceptedConnectionPointTypes&&-1!==N.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(N.excludedConnectionPointTypes&&-1!==N.excludedConnectionPointTypes.indexOf(this.type))return 1;let A=T,a=p;return 0===this.direction&&(A=p,a=T),A.isAnAncestorOf(a)?2:0}connectTo(N){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(N))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${N.ownerBlock.name}".${N.name}`;return this._endpoints.push(N),N._connectedPoint=this,this.onConnectionObservable.notifyObservers(N),N.onConnectionObservable.notifyObservers(this),this}disconnectFrom(N){const p=this._endpoints.indexOf(N);return-1===p||(this._endpoints.splice(p,1),N._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(N),N.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(N){let p=1;for(;p<qp.All;)N&p||this.excludedConnectionPointTypes.push(p),p<<=1}serialize(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const p={};return p.name=this.name,p.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.UX?(p.valueType="BABYLON."+this.value.getClassName(),p.value=this.value.UX()):(p.valueType="number",p.value=this.value)),N&&this.connectedPoint&&(p.inputName=this.name,p.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,p.targetConnectionName=this.connectedPoint.name,p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(p.isExposedOnFrame=!0,p.exposedPortPosition=this.exposedPortPosition),p}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Ep{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(N){this._name=N}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(N){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new d.c,this.SU=new d.c,this.onInputChangedObservable=new d.c,this.visibleOnFrame=!1,this._name=N,this.uniqueId=mN.d.UniqueId}_inputRename(N){return N}_outputRename(N){return N}isAnAncestorOf(N){for(const p of this._outputs)if(p.hasEndpoints)for(const T of p.endpoints){if(T.ownerBlock===N)return!0;if(T.ownerBlock.isAnAncestorOf(N))return!0}return!1}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const p of this._outputs)if(p.hasEndpoints)for(const T of p.endpoints)if(T.ownerBlock.isAnAncestorOfType(N))return!0;return!1}getInputByName(N){const p=this._inputs.filter((p=>p.name===N));return p.length?p[0]:null}_linkConnectionTypes(N,p){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[p]._acceptedConnectionPointType=this._inputs[N]:(this._inputs[N]._linkedConnectionSource=this._inputs[p],this._inputs[N]._isMainLinkSource=!0),this._inputs[p]._linkedConnectionSource=this._inputs[N]}registerInput(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,C=arguments.length>5?arguments[5]:void 0;const U=new Qp(N,this,0);return U.type=p,U.isOptional=T,U.defaultValue=A,U.value=A,U.valueMin=a,U.valueMax=C,this._inputs.push(U),this.onInputChangedObservable.notifyObservers(U),this}registerOutput(N,p,T){return(T=T??new Qp(N,this,1)).type=p,this._outputs.push(T),this}_build(N){}_customBuildStep(N){}build(N){if(this._buildId===N.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((N=>N.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=N.buildId;for(const p of this._inputs){if(!p.connectedPoint){p.isOptional||N.notConnectedNonOptionalInputs.push(p);continue}const T=p.connectedPoint.ownerBlock;T&&T!==this&&!T.isSystem&&T.build(N)}return this._customBuildStep(N),N.verbose&&q.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(N),this.onBuildObservable.notifyObservers(this),!1}serialize(){const N={};N.customType="BABYLON."+this.getClassName(),N.id=this.uniqueId,N.name=this.name,N.visibleOnFrame=this.visibleOnFrame,N.inputs=[],N.outputs=[];for(const p of this.inputs)N.inputs.push(p.serialize());for(const p of this.outputs)N.outputs.push(p.serialize(!1));return N}_deserialize(N){this._name=N.name,this.comments=N.comments,this.visibleOnFrame=!!N.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(N)}_deserializePortDisplayNamesAndExposedOnFrame(N){const p=N.inputs,T=N.outputs;if(p)for(const A of p){const N=this.inputs.find((N=>N.name===A.name));if(!N)return;if(A.displayName&&(N.displayName=A.displayName),A.isExposedOnFrame&&(N.isExposedOnFrame=A.isExposedOnFrame,N.exposedPortPosition=A.exposedPortPosition),void 0!==A.value&&null!==A.value)if("number"===A.valueType)N.value=A.value;else{const p=(0,X.c)(A.valueType);p&&(N.value=p.gp(A.value))}}if(T)for(let A=0;A<T.length;A++){const N=T[A];N.displayName&&(this.outputs[A].displayName=N.displayName),N.isExposedOnFrame&&(this.outputs[A].isExposedOnFrame=N.isExposedOnFrame,this.outputs[A].exposedPortPosition=N.exposedPortPosition)}}clone(){const N=this.serialize(),p=(0,X.c)(N.customType);if(p){const T=new p;return T._deserialize(N),T}return null}dispose(){this.SU.notifyObservers(this),this.SU.clear();for(const N of this.inputs)N.dispose();for(const N of this.outputs)N.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Op(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",A=arguments.length>3?arguments[3]:void 0;return(a,C)=>{let U=a._propStore;U||(U=[],a._propStore=U),U.push({propertyName:C,displayName:N,type:p,groupName:T,options:A??{},className:a.getClassName()})}}(0,f.b)([(0,G.H)("comment")],Ep.prototype,"comments",void 0),function(N){N[N.Boolean=0]="Boolean",N[N.Float=1]="Float",N[N.Int=2]="Int",N[N.Vector2=3]="Vector2",N[N.List=4]="List",N[N.LX=5]="LX",N[N.SamplingMode=6]="SamplingMode",N[N.TextureFormat=7]="TextureFormat",N[N.TextureType=8]="TextureType"}(Vp||(Vp={})),function(N){N[N.None=0]="None",N[N.Position=1]="Position",N[N.Direction=2]="Direction",N[N.Age=3]="Age",N[N.Lifetime=4]="Lifetime",N[N.Color=5]="Color",N[N.ScaledDirection=6]="ScaledDirection",N[N.Scale=7]="Scale",N[N.AgeGradient=8]="AgeGradient",N[N.Angle=9]="Angle",N[N.SpriteCellIndex=16]="SpriteCellIndex",N[N.SpriteCellStart=17]="SpriteCellStart",N[N.SpriteCellEnd=18]="SpriteCellEnd"}(rp||(rp={})),function(N){N[N.None=0]="None",N[N.Time=1]="Time",N[N.Delta=2]="Delta",N[N.Emitter=3]="Emitter"}(upN||(upN={}));class Bp{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let N="";for(const p of this.notConnectedNonOptionalInputs)N+=`input ${p.name} from block ${p.ownerBlock.name}[${p.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(N)throw"Build of Node Particle System Set failed:\n"+N}adapt(N,p){const T=N.getConnectedValue(this)||0;if(N.type===p)return T;switch(p){case qp.Vector2:return new A.Vector2(T,T);case qp.xp:return new A.xp(T,T,T);case qp.LX:return new U.LX(T,T,T,T)}return null}getContextualValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case rp.Position:return this.particleContext.position;case rp.Direction:return this.particleContext.direction;case rp.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case rp.Color:return this.particleContext.color;case rp.Age:return this.particleContext.age;case rp.Lifetime:return this.particleContext.lifeTime;case rp.Angle:return this.particleContext.angle;case rp.Scale:return this.particleContext.scale;case rp.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case rp.SpriteCellEnd:return this.systemContext.endSpriteCellID;case rp.SpriteCellIndex:return this.particleContext.cellIndex;case rp.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Ap.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Ap.absolutePosition:this.systemContext.Ap:null}getSystemValue(N){if(!this.particleContext||!this.systemContext)return null;switch(N){case upN.Time:return this.systemContext._actualFrame;case upN.Delta:return this.systemContext._scaledUpdateSpeed;case upN.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Ap.absolutePosition}return this.systemContext.Ap}return null}}function dp(N,p,T){const A=new Bp;A.Lp=p;const a=N.createSystem(A);return a.canStart=()=>!0,a.Ap=T.clone(),a.disposeOnStop=!0,a.start(),a}class tp extends Ep{constructor(N){super(N),this.blendMode=y.BLENDMODE_ONEONE,this.Kp=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",qp.Particle),this.registerInput("texture",qp.Texture),this.registerInput("onStart",qp.System,!0),this.registerInput("onEnd",qp.System,!0),this.registerOutput("system",qp.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(N){N.Kp=this.Kp,N.buildId=this._buildId++,this.build(N);const p=this.particle.getConnectedValue(N);return p.particleTexture=this.texture.getConnectedValue(N),p.emitRate=this.emitRate,p.blendMode=this.blendMode,p.name=this.name,p._nodeGenerated=!0,p._targetStopDuration=this.targetStopDuration,p.startDelay=this.startDelay,this.system._storedValue=this,p.canStart=()=>!this.doNoStart,p.onStartedObservable.add((T=>{const A=this.onStart.getConnectedValue(N);A&&T.onStartedObservable.addOnce((()=>{N.systemContext=p;const T=dp(A,N.Lp,N.emitterPosition);this.SU.addOnce((()=>{T.dispose()}))}));const a=this.onEnd.getConnectedValue(N);a&&T.onStoppedObservable.addOnce((()=>{N.systemContext=p;const T=dp(a,N.Lp,N.emitterPosition);this.SU.addOnce((()=>{T.dispose()}))}))})),this.SU.addOnce((()=>{p.dispose()})),p}serialize(){const N=super.serialize();return N.Kp=this.Kp,N.emitRate=this.emitRate,N.blendMode=this.blendMode,N.doNoStart=this.doNoStart,N.targetStopDuration=this.targetStopDuration,N.startDelay=this.startDelay,N}_deserialize(N){super._deserialize(N),this.Kp=N.Kp,this.emitRate=N.emitRate,this.doNoStart=!!N.doNoStart,void 0!==N.blendMode&&(this.blendMode=N.blendMode),void 0!==N.targetStopDuration&&(this.targetStopDuration=N.targetStopDuration),void 0!==N.startDelay&&(this.startDelay=N.startDelay)}}(0,f.b)([Op("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:y.BLENDMODE_ONEONE},{label:"Standard",value:y.BLENDMODE_STANDARD},{label:"Add",value:y.BLENDMODE_ADD},{label:"Multiply",value:y.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:y.BLENDMODE_MULTIPLYADD}]})],tp.prototype,"blendMode",void 0),(0,f.b)([Op("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],tp.prototype,"Kp",void 0),(0,f.b)([Op("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tp.prototype,"emitRate",void 0),(0,f.b)([Op("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tp.prototype,"targetStopDuration",void 0),(0,f.b)([Op("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tp.prototype,"startDelay",void 0),(0,f.b)([Op("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],tp.prototype,"doNoStart",void 0),(0,X.d)("BABYLON.SystemBlock",tp);class Sp extends Ep{get type(){if(this._type===qp.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=qp.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=qp.Vector2,this._type;case"xp":return this._type=qp.xp,this._type;case"LX":return this._type=qp.LX,this._type;case"Matrix":return this._type=qp.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===rp.None&&this._systemSource!==upN.None}get systemSource(){return this._systemSource}set systemSource(N){if(this._systemSource=N,N!==upN.None){switch(this._contextualSource=rp.None,this._type=qp.Float,N){case upN.Time:case upN.Delta:this._type=qp.Float;break;case upN.Emitter:this._type=qp.xp}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==rp.None}get contextualValue(){return this._contextualSource}set contextualValue(N){if(this._contextualSource=N,N!==rp.None){switch(this._systemSource=upN.None,N){case rp.Scale:this._type=qp.Vector2;break;case rp.Position:case rp.Direction:case rp.ScaledDirection:this._type=qp.xp;break;case rp.Color:this._type=qp.LX;break;case rp.Age:case rp.Lifetime:case rp.Angle:case rp.AgeGradient:this._type=qp.Float;break;case rp.SpriteCellEnd:case rp.SpriteCellStart:case rp.SpriteCellIndex:this._type=qp.Int}this.output&&(this.output.type=this._type)}}constructor(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qp.AutoDetect;super(N),this._type=qp.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new d.c,this._systemSource=upN.None,this._contextualSource=rp.None,this._type=p,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",p)}get value(){return this._storedValue}set value(N){this.type===qp.Float&&this.min!==this.max&&(N=Math.max(this.min,N),N=Math.min(this.max,N)),this._storedValue=N,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(N){this._valueCallback=N}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case qp.Int:case qp.Float:this.value=0;break;case qp.Vector2:this.value=A.Vector2.Zero();break;case qp.xp:this.value=A.xp.Zero();break;case qp.LX:this.value=new U.LX(1,1,1,1);break;case qp.Matrix:this.value=A.Matrix.Identity()}}_build(N){super._build(N),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=N=>N.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=N=>N.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const N=super.serialize();return N.type=this.type,N.contextualValue=this.contextualValue,N.systemSource=this.systemSource,N.min=this.min,N.max=this.max,N.groupInInspector=this.groupInInspector,N.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.UX?(N.valueType="BABYLON."+this._storedValue.getClassName(),N.value=this._storedValue.UX()):(N.valueType="number",N.value=this._storedValue)),N}_deserialize(N){if(super._deserialize(N),this._type=N.type,this.contextualValue=N.contextualValue,this.systemSource=N.systemSource||upN.None,this.min=N.min||0,this.max=N.max||0,this.groupInInspector=N.groupInInspector||"",void 0!==N.displayInInspector&&(this.displayInInspector=N.displayInInspector),N.valueType)if("number"===N.valueType)this._storedValue=N.value;else{const p=(0,X.c)(N.valueType);p&&(this._storedValue=p.gp(N.value))}}}(0,X.d)("BABYLON.ParticleInputBlock",Sp);class sp extends Ep{get url(){return this._url}set url(N){this._url!==N&&(this._cachedData=null,this._url=N,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(N){this._textureDataUrl!==N&&(this._cachedData=null,this._textureDataUrl=N,this._url="",this._sourceTexture=null)}set sourceTexture(N){this._sourceTexture!==N&&(this._cachedData=null,this._sourceTexture=N,this._url="",this._textureDataUrl="")}constructor(N){super(N),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",qp.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const N=this.texture._storedValue;return await new Promise(((p,T)=>{if(!N.isReady())return void N.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),p(this._cachedData)}catch(N){T(N)}}));const A=N.getSize();fp.j.GetTextureDataAsync(N,A.width,A.height).then((T=>{this._cachedData={width:A.width,height:A.height,data:new Uint8ClampedArray(T)},N.dispose(),p(this._cachedData)})).catch(T)}))}_build(N){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Z.c(this._textureDataUrl,N.Lp):this.texture._storedValue=new Z.c(this._url,N.Lp):this.texture._storedValue=null}serialize(){const N=super.serialize();return N.url=this.url,N.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(N.textureDataUrl=this.textureDataUrl),N}_deserialize(N){super._deserialize(N),this.url=N.url,this.serializedCachedData=!!N.serializedCachedData,N.textureDataUrl&&(this.textureDataUrl=N.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,X.d)("BABYLON.ParticleTextureSourceBlock",sp);class NT extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("position",qp.xp),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.position.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.position.A(this.position.getConnectedValue(N))},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}}(0,X.d)("BABYLON.UpdatePositionBlock",NT),function(N){N[N.Add=0]="Add",N[N.Subtract=1]="Subtract",N[N.Multiply=2]="Multiply",N[N.Divide=3]="Divide",N[N.Max=4]="Max",N[N.Min=5]="Min"}(Yp||(Yp={}));class pT extends Ep{constructor(N){super(N),this.operation=Yp.Add,this.registerInput("left",qp.AutoDetect),this.registerInput("right",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this.output._typeConnectionSource=this.left;const p=[qp.Matrix,qp.Particle,qp.Texture,qp.System,qp.FloatGradient,qp.Color4Gradient,qp.Vector2Gradient,qp.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...p),this.right.excludedConnectionPointTypes.push(...p),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(N){let p;const T=this.left,a=this.right;if(!T.isConnected||!a.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const C=T.type===qp.Float||T.type===qp.Int,X=a.type===qp.Float||a.type===qp.Int,y=C&&X;switch(this.operation){case Yp.Add:p=y?N=>T.getConnectedValue(N)+a.getConnectedValue(N):C?N=>N.adapt(T,a.type).add(a.getConnectedValue(N)):N=>T.getConnectedValue(N).add(N.adapt(a,T.type));break;case Yp.Subtract:p=y?N=>T.getConnectedValue(N)-a.getConnectedValue(N):C?N=>N.adapt(T,a.type).Ip(a.getConnectedValue(N)):N=>T.getConnectedValue(N).Ip(N.adapt(a,T.type));break;case Yp.Multiply:p=y?N=>T.getConnectedValue(N)*a.getConnectedValue(N):C?N=>N.adapt(T,a.type).multiply(a.getConnectedValue(N)):N=>T.getConnectedValue(N).multiply(N.adapt(a,T.type));break;case Yp.Divide:p=y?N=>T.getConnectedValue(N)/a.getConnectedValue(N):C?N=>N.adapt(T,a.type).divide(a.getConnectedValue(N)):N=>T.getConnectedValue(N).divide(N.adapt(a,T.type));break;case Yp.Min:if(y)p=N=>Math.min(T.getConnectedValue(N),a.getConnectedValue(N));else{const[N,X]=C?[a,T]:[T,a];switch(N.type){case qp.Vector2:p=p=>A.Vector2.Minimize(N.getConnectedValue(p),p.adapt(X,N.type));break;case qp.xp:p=p=>A.xp.Minimize(N.getConnectedValue(p),p.adapt(X,N.type));break;case qp.LX:p=p=>{const T=N.getConnectedValue(p),{r:A,g:a,b:C,a:y}=p.adapt(X,N.type);return new U.LX(Math.min(T.r,A),Math.min(T.g,a),Math.min(T.b,C),Math.min(T.a,y))}}}break;case Yp.Max:if(!y){const[N,X]=C?[a,T]:[T,a];switch(N.type){case qp.Vector2:p=p=>A.Vector2.Maximize(N.getConnectedValue(p),p.adapt(X,N.type));break;case qp.xp:p=p=>A.xp.Maximize(N.getConnectedValue(p),p.adapt(X,N.type));break;case qp.LX:p=p=>{const T=N.getConnectedValue(p),{r:A,g:a,b:C,a:y}=p.adapt(X,N.type);return new U.LX(Math.max(T.r,A),Math.min(T.g,a),Math.min(T.b,C),Math.min(T.a,y))}}break}p=N=>Math.max(T.getConnectedValue(N),a.getConnectedValue(N))}this.output._storedFunction=N=>T.type===qp.Int?0|p(N):p(N)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===qp.Int||this.left.type===qp.Float&&this.right.type!==qp.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[N,p]of[[this.left,this.right],[this.right,this.left]])N.acceptedConnectionPointTypes=[qp.Int,qp.Float],p.isConnected&&(N.acceptedConnectionPointTypes.push(p.type),p.type!==qp.Int&&p.type!==qp.Float||N.acceptedConnectionPointTypes.push(qp.Vector2,qp.xp,qp.LX))}dispose(){super.dispose();for(const N of this._connectionObservers)N.remove();this._connectionObservers.length=0}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,f.b)([Op("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Yp.Add},{label:"Subtract",value:Yp.Subtract},{label:"Multiply",value:Yp.Multiply},{label:"Divide",value:Yp.Divide},{label:"Max",value:Yp.Max},{label:"Min",value:Yp.Min}]})],pT.prototype,"operation",void 0),(0,X.d)("BABYLON.ParticleMathBlock",pT);class TT extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("direction1",qp.xp,!0,new A.xp(0,1,0)),this.registerInput("direction2",qp.xp,!0,new A.xp(0,1,0)),this.registerInput("minEmitBox",qp.xp,!0,new A.xp(-.5,-.5,-.5)),this.registerInput("maxEmitBox",qp.xp,!0,new A.xp(.5,.5,.5)),this.registerOutput("output",qp.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const p=this.particle.getConnectedValue(N);p._directionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.direction1.getConnectedValue(N),C=this.direction2.getConnectedValue(N),U=(0,e.RandomRange)(a.x,C.x),X=(0,e.RandomRange)(a.y,C.y),y=(0,e.RandomRange)(a.z,C.z);N.isEmitterTransformNode?A.xp.TransformNormalFromFloatsToRef(U,X,y,N.emitterWorldMatrix,T.direction):T.direction.kX(U,X,y)},p._positionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.minEmitBox.getConnectedValue(N),C=this.maxEmitBox.getConnectedValue(N),U=(0,e.RandomRange)(a.x,C.x),X=(0,e.RandomRange)(a.y,C.y),y=(0,e.RandomRange)(a.z,C.z);N.isEmitterTransformNode?A.xp.TransformCoordinatesFromFloatsToRef(U,X,y,N.emitterWorldMatrix,T.position):(T.position.kX(U,X,y),T.position.addInPlace(N.emitterPosition))},this.output._storedValue=p}}(0,X.d)("BABYLON.BoxShapeBlock",TT);class AT extends Ep{constructor(N){super(N),this.registerInput("emitPower",qp.Float,!0,1),this.registerInput("lifeTime",qp.Float,!0,1),this.registerInput("color",qp.LX,!0,new U.LX(1,1,1,1)),this.registerInput("scale",qp.Vector2,!0,new A.Vector2(1,1)),this.registerInput("angle",qp.Float,!0,0),this.registerOutput("particle",qp.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(N){const p=new Xp(this.name,N.Kp,N.Lp,null,!1,void 0,!0);p.particleEmitterType=new L,p._lifeTimeCreation.process=(p,T)=>{N.particleContext=p,p.lifeTime=this.lifeTime.getConnectedValue(N),T._emitPower=this.emitPower.getConnectedValue(N)},p._colorCreation.process=p=>{N.particleContext=p,p.color.A(this.color.getConnectedValue(N))},p._sizeCreation.process=p=>{N.particleContext=p,p.size=1,p.scale.A(this.scale.getConnectedValue(N))},p._angleCreation.process=p=>{N.particleContext=p,p.angle=this.angle.getConnectedValue(N)},this.particle._storedValue=p}}(0,X.d)("BABYLON.CreateParticleBlock",AT);class aT{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const N=[];for(const p of this.attachedBlocks)p.isInput&&N.push(p);return N}constructor(N){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new d.c,this.name=N}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(N)&&this.attachedBlocks.push(N);for(const T of N.inputs){const A=T.connectedPoint;if(A){const T=A.ownerBlock;T!==N&&this._initializeBlock(T,p)}}}async buildAsync(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((T=>{const A=new Kp;for(const N of this._systemBlocks)this._initializeBlock(N);for(const a of this.systemBlocks){const T=new Bp;T.buildId=this._buildId++,T.Lp=N,T.verbose=p;const C=a.createSystem(T);T.emitErrors(),A.systems.push(C)}this.onBuildObservable.notifyObservers(this),T(A)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const N=new tp("Particle system"),p=new NT("Update position");p.output.connectTo(N.particle);const T=new Sp("Position");T.contextualValue=rp.Position;const A=new Sp("Scaled direction");A.contextualValue=rp.ScaledDirection;const a=new pT("Add");a.operation=Yp.Add,T.output.connectTo(a.left),A.output.connectTo(a.right),a.output.connectTo(p.position);const C=new AT("Create particle"),U=new TT("Box shape");C.particle.connectTo(U.particle),U.output.connectTo(p.particle);const X=new sp("Texture");X.texture.connectTo(N.texture),X.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(N)}removeBlock(N){const p=this.attachedBlocks.indexOf(N);if(p>-1&&this.attachedBlocks.splice(p,1),N.isSystem){const p=this._systemBlocks.indexOf(N);p>-1&&this._systemBlocks.splice(p,1)}}parseSerializedObject(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p||this.clear();const T={};for(const A of N.jH){const N=(0,X.c)(A.customType);if(N){const p=new N;p._deserialize(A),T[A.id]=p,this.attachedBlocks.push(p),p.isSystem&&this._systemBlocks.push(p)}}for(const A of this.attachedBlocks)if(A.isTeleportOut){const N=A,p=N._tempEntryPointUniqueId;if(p){const A=T[p];A&&A.attachToEndpoint(N)}}for(let A=0;A<N.jH.length;A++){const a=N.jH[A],C=T[a.id];C&&(C.inputs.length&&a.inputs.some((N=>N.targetConnectionName))&&!p||this._restoreConnections(C,N,T))}if(N.locations||N.editorData&&N.editorData.locations){const A=N.locations||N.editorData.locations;for(const N of A)T[N.hT]&&(N.hT=T[N.hT].uniqueId);p&&this.editorData&&this.editorData.locations&&A.concat(this.editorData.locations),N.locations?this.editorData={locations:A}:(this.editorData=N.editorData,this.editorData.locations=A);const a=[];for(const N in T)a[N]=T[N].uniqueId;this.editorData.map=a}this.comment=N.comment}_restoreConnections(N,p,T){for(const A of N.outputs)for(const a of p.jH){const C=T[a.id];if(C)for(const U of a.inputs)if(T[U.targetBlockId]!==N||U.targetConnectionName!==A.name);else{const N=C.getInputByName(U.inputName);if(!N||N.isConnected)continue;A.connectTo(N,!0),this._restoreConnections(C,p,T)}}}serialize(N){const p=N?{}:o.e.Serialize(this);p.editorData=JSON.parse(JSON.stringify(this.editorData));let T=[];N?T=N:p.customType="BABYLON.NodeParticleSystemSet",p.jH=[];for(const A of T)p.jH.push(A.serialize());if(!N)for(const A of this.attachedBlocks)-1===T.indexOf(A)&&p.jH.push(A.serialize());return p}dispose(){for(const N of this.attachedBlocks)N.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(N){const p=new aT(N);return p.setToDefault(),p}static Parse(N){const p=o.e.Parse((()=>new aT(N.name)),N,null);return p.parseSerializedObject(N),p}static ParseFromSnippetAsync(N,p){return"_BLANK"===N?Promise.resolve(aT.CreateDefault("blank")):new Promise(((T,A)=>{const a=new Fp.b;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const U=JSON.parse(JSON.parse(a.responseText).jsonPayload),X=JSON.parse(U.nodeParticle);p||(p=o.e.Parse((()=>new aT(N)),X,null)),p.parseSerializedObject(X),p.snippetId=N;try{T(p)}catch(C){A(C)}}else A("Unable to load the snippet "+N)})),a.open("GET",this.SnippetUrl+"/"+N.replace(/#/g,"/")),a.send()}))}}aT.EditorURL=`${gp.Tools._DefaultCdnUrl}/v${ON.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,aT.SnippetUrl="https://snippet.babylonjs.com",(0,f.b)([(0,G.H)()],aT.prototype,"name",void 0),(0,f.b)([(0,G.H)("comment")],aT.prototype,"comment",void 0),function(N){N[N.None=0]="None",N[N.PerParticle=1]="PerParticle",N[N.PerSystem=2]="PerSystem"}(Dp||(Dp={}));class CT extends Ep{constructor(N){super(N),this._currentLockId=-2,this.lockMode=Dp.PerParticle,this.registerInput("min",qp.AutoDetect,!0,0),this.registerInput("max",qp.AutoDetect,!0,1),this.registerOutput("output",qp.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qp.Float|qp.Int|qp.Vector2|qp.xp|qp.LX),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(qp.Float|qp.Int|qp.Vector2|qp.xp|qp.LX),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=qp.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case qp.AutoDetect:case qp.Int:case qp.Float:N=N=>{const p=this.min.getConnectedValue(N)||0,T=this.max.getConnectedValue(N)||1;return p+Math.random()*(T-p)};break;case qp.Vector2:N=N=>{const p=this.min.getConnectedValue(N)||A.Vector2.Zero(),T=this.max.getConnectedValue(N)||A.Vector2.One();return new A.Vector2(p.x+Math.random()*(T.x-p.x),p.y+Math.random()*(T.y-p.y))};break;case qp.xp:N=N=>{const p=this.min.getConnectedValue(N)||A.xp.Zero(),T=this.max.getConnectedValue(N)||A.xp.One();return new A.xp(p.x+Math.random()*(T.x-p.x),p.y+Math.random()*(T.y-p.y),p.z+Math.random()*(T.z-p.z))};break;case qp.LX:N=N=>{const p=this.min.getConnectedValue(N)||new U.LX(0,0,0,0),T=this.max.getConnectedValue(N)||new U.LX(1,1,1,1);return new U.LX(p.x+Math.random()*(T.x-p.x),p.y+Math.random()*(T.y-p.y),p.z+Math.random()*(T.z-p.z),p.w+Math.random()*(T.w-p.w))}}this.output._storedFunction=p=>{var T;let A=0;switch(this.lockMode){case Dp.PerParticle:A=(null===(T=p.particleContext)||void 0===T?void 0:T.id)||-1;break;case Dp.PerSystem:A=p.buildId||0}return this._currentLockId!==A&&(this.lockMode!==Dp.None&&(this._currentLockId=A),this.output._storedValue=N(p)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),this.lockMode=N.lockMode}}(0,f.b)([Op("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Dp.None},{label:"Per particle",value:Dp.PerParticle},{label:"Per system",value:Dp.PerSystem}]})],CT.prototype,"lockMode",void 0),(0,X.d)("BABYLON.ParticleRandomBlock",CT);class UT extends Ep{constructor(N){super(N),this._currentLockId=-2,this.lockMode=Dp.PerParticle,this.registerInput("min",qp.AutoDetect),this.registerInput("max",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const p=[qp.Matrix,qp.Particle,qp.Texture,qp.System,qp.FloatGradient,qp.Color4Gradient,qp.Vector2Gradient,qp.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...p),this.max.excludedConnectionPointTypes.push(...p)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let N=null;switch(this._currentLockId=-2,this.min.type){case qp.Float:case qp.Int:N=N=>{const p=this.min.getConnectedValue(N),T=this.max.getConnectedValue(N);return Math.random()*(T-p)+p};break;case qp.Vector2:N=N=>{const p=this.min.getConnectedValue(N),T=this.max.getConnectedValue(N);return new A.Vector2(Math.random()*(T.x-p.x)+p.x,Math.random()*(T.y-p.y)+p.y)};break;case qp.xp:N=N=>{const p=this.min.getConnectedValue(N),T=this.max.getConnectedValue(N);return new A.xp(Math.random()*(T.x-p.x)+p.x,Math.random()*(T.y-p.y)+p.y,Math.random()*(T.z-p.z)+p.z)};break;case qp.LX:N=N=>{const p=this.min.getConnectedValue(N),T=this.max.getConnectedValue(N);return new U.LX(Math.random()*(T.r-p.r)+p.r,Math.random()*(T.g-p.g)+p.g,Math.random()*(T.b-p.b)+p.b,Math.random()*(T.a-p.a)+p.a)}}this.output._storedFunction=p=>{var T;let A=0;switch(this.lockMode){case Dp.PerParticle:A=(null===(T=p.particleContext)||void 0===T?void 0:T.id)||-1;break;case Dp.PerSystem:A=p.buildId||0}return this._currentLockId!==A&&(this.lockMode!==Dp.None&&(this._currentLockId=A),this.output._storedValue=N(p)),this.output._storedValue}}serialize(){const N=super.serialize();return N.lockMode=this.lockMode,N}_deserialize(N){super._deserialize(N),void 0!==N.lockMode&&(this.lockMode=N.lockMode)}}(0,f.b)([Op("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Dp.None},{label:"Per particle",value:Dp.PerParticle},{label:"Per system",value:Dp.PerSystem}]})],UT.prototype,"lockMode",void 0),(0,X.d)("BABYLON.RandomRangeBlock",UT);(0,X.d)("BABYLON.ParticleLerpBlock",class extends Ep{constructor(N){super(N),this.registerInput("left",qp.AutoDetect),this.registerInput("right",qp.AutoDetect),this.registerInput("gradient",qp.Float,!0,0,0,1),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qp.Float|qp.Int|qp.Vector2|qp.xp|qp.LX)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=(N,p,T)=>(1-N)*p+N*T;this.output._storedFunction=p=>{const T=this.left.getConnectedValue(p),a=this.right.getConnectedValue(p),C=this.gradient.getConnectedValue(p);switch(this.left.type){case qp.Int:case qp.Float:return N(C,T,a);case qp.Vector2:return new A.Vector2(N(C,T.x,a.x),N(C,T.y,a.y));case qp.xp:return new A.xp(N(C,T.x,a.x),N(C,T.y,a.y),N(C,T.z,a.z));case qp.LX:return new U.LX(N(C,T.r,a.r),N(C,T.g,a.g),N(C,T.b,a.b),N(C,T.a,a.a))}return 0}}});(0,X.d)("BABYLON.UpdateDirectionBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("direction",qp.xp),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.direction.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.direction.A(this.direction.getConnectedValue(N))},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}});(0,X.d)("BABYLON.UpdateColorBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("color",qp.LX),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.color.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.color.A(this.color.getConnectedValue(N))},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}});(0,X.d)("BABYLON.UpdateScaleBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("scale",qp.Vector2),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.scale.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.scale.A(this.scale.getConnectedValue(N))},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}});(0,X.d)("BABYLON.UpdateAngleBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("angle",qp.Float),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.angle.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.angle=this.angle.getConnectedValue(N)},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}});(0,X.d)("BABYLON.BasicPositionUpdateBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(N){const p=this.particle.getConnectedValue(N),T={process:T=>{N.particleContext=T,N.systemContext=p,T.direction.scaleToRef(p._directionScale,p._scaledDirection),T.position.addInPlace(p._scaledDirection)},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T,this.output._storedValue=p}});(0,X.d)("BABYLON.BasicSpriteUpdateBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(N){const p=this.particle.getConnectedValue(N),T={process:T=>{N.particleContext=T,N.systemContext=p,T.updateCellIndex()},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T,this.output._storedValue=p}});(0,X.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("cellIndex",qp.Int),this.registerOutput("output",qp.Particle),this.cellIndex.acceptedConnectionPointTypes=[qp.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(N){const p=this.particle.getConnectedValue(N);if(this.output._storedValue=p,!this.cellIndex.isConnected)return;const T={process:T=>{N.particleContext=T,N.systemContext=p,T.cellIndex=Math.floor(this.cellIndex.getConnectedValue(N))},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T}});class XT extends Ep{constructor(N){super(N),this.strength=1,this.registerInput("particle",qp.Particle),this.registerInput("flowMap",qp.Texture),this.registerOutput("output",qp.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(N){var p;const T=this.particle.getConnectedValue(N),A=N.Lp;let a;(null===(p=this.flowMap.connectedPoint)||void 0===p?void 0:p.ownerBlock).extractTextureContentAsync().then((N=>{N&&(a=new mT(N.width,N.height,N.data))}));const C={process:N=>{const p=A.getTransformMatrix();a&&a._processParticle(N,this.strength*T._tempScaledUpdateSpeed,p)},previousItem:null,nextItem:null};T._updateQueueStart?uN(C,T._updateQueueStart):T._updateQueueStart=C,this.output._storedValue=T}serialize(){const N=super.serialize();return N.strength=this.strength,N}_deserialize(N){super._deserialize(N),this.strength=N.strength}}(0,f.b)([Op("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],XT.prototype,"strength",void 0),(0,X.d)("BABYLON.UpdateFlowMapBlock",XT);(0,X.d)("BABYLON.SphereShapeBlock",class extends Ep{constructor(N){super(N),this.registerInput("input",qp.Particle),this.registerInput("radius",qp.Float,!0,1),this.registerInput("radiusRange",qp.Float,!0,1,0,1),this.registerInput("directionRandomizer",qp.Float,!0,0,0,1),this.registerOutput("output",qp.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(N){const p=this.input.getConnectedValue(N);p._directionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.directionRandomizer.getConnectedValue(N),C=T.position.Ip(N.emitterPosition).normalize(),U=(0,e.RandomRange)(0,a),X=(0,e.RandomRange)(0,a),y=(0,e.RandomRange)(0,a);C.x+=U,C.y+=X,C.z+=y,C.normalize(),N.isEmitterTransformNode?A.xp.TransformNormalFromFloatsToRef(U,X,y,N.emitterWorldMatrix,T.direction):T.direction.kX(U,X,y)},p._positionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.radius.getConnectedValue(N),C=this.radiusRange.getConnectedValue(N),U=a-(0,e.RandomRange)(0,a*C),X=(0,e.RandomRange)(0,1),y=(0,e.RandomRange)(0,2*Math.PI),H=Math.acos(2*X-1),M=U*Math.cos(y)*Math.sin(H),b=U*Math.cos(H),l=U*Math.sin(y)*Math.sin(H);N.isEmitterTransformNode?A.xp.TransformCoordinatesFromFloatsToRef(M,b,l,N.emitterWorldMatrix,T.position):(T.position.kX(M,b,l),T.position.addInPlace(N.emitterPosition))},this.output._storedValue=p}});(0,X.d)("BABYLON.PointShapeBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("direction1",qp.xp,!0,new A.xp(0,1,0)),this.registerInput("direction2",qp.xp,!0,new A.xp(0,1,0)),this.registerOutput("output",qp.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const p=this.particle.getConnectedValue(N);p._directionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.direction1.getConnectedValue(N),C=this.direction2.getConnectedValue(N),U=(0,e.RandomRange)(a.x,C.x),X=(0,e.RandomRange)(a.y,C.y),y=(0,e.RandomRange)(a.z,C.z);N.isEmitterTransformNode?A.xp.TransformNormalFromFloatsToRef(U,X,y,N.emitterWorldMatrix,T.direction):T.direction.kX(U,X,y)},p._positionCreation.process=T=>{N.systemContext=p,N.isEmitterTransformNode?A.xp.TransformCoordinatesFromFloatsToRef(0,0,0,N.emitterWorldMatrix,T.position):T.position.A(N.emitterPosition)},this.output._storedValue=p}});(0,X.d)("BABYLON.CustomShapeBlock",class extends Ep{constructor(N){super(N),this.registerInput("particle",qp.Particle),this.registerInput("position",qp.xp,!0,new A.xp(0,0,0)),this.registerInput("direction",qp.xp,!0,new A.xp(0,1,0)),this.registerOutput("output",qp.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){const p=this.particle.getConnectedValue(N);p._directionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.direction.getConnectedValue(N);N.isEmitterTransformNode?A.xp.TransformNormalToRef(a,N.emitterWorldMatrix,T.direction):T.direction.A(a)},p._positionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.position.getConnectedValue(N);N.isEmitterTransformNode?A.xp.TransformCoordinatesToRef(a,N.emitterWorldMatrix,T.position):(T.position.A(a),T.position.addInPlace(N.emitterPosition))},this.output._storedValue=p}});(0,X.d)("BABYLON.CylinderShapeBlock",class extends Ep{constructor(N){super(N),this._tempVector=A.xp.Zero(),this.registerInput("particle",qp.Particle),this.registerInput("radius",qp.Float,!0,1),this.registerInput("height",qp.Float,!0,1,0),this.registerInput("radiusRange",qp.Float,!0,1,0,1),this.registerInput("directionRandomizer",qp.Float,!0,0,0,1),this.registerOutput("output",qp.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(N){const p=this.particle.getConnectedValue(N);p._directionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.directionRandomizer.getConnectedValue(N);T.position.subtractToRef(N.emitterPosition,this._tempVector),this._tempVector.normalize(),N.isEmitterTransformNode&&A.xp.TransformNormalToRef(this._tempVector,N.emitterInverseWorldMatrix,this._tempVector);const C=(0,e.RandomRange)(-a/2,a/2);let U=Math.atan2(this._tempVector.x,this._tempVector.z);U+=(0,e.RandomRange)(-Math.PI/2,Math.PI/2)*a,this._tempVector.y=C,this._tempVector.x=Math.sin(U),this._tempVector.z=Math.cos(U),this._tempVector.normalize(),N.isEmitterTransformNode?A.xp.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,N.emitterWorldMatrix,T.direction):T.direction.A(this._tempVector)},p._positionCreation.process=T=>{N.particleContext=T,N.systemContext=p;const a=this.height.getConnectedValue(N),C=this.radiusRange.getConnectedValue(N),U=this.radius.getConnectedValue(N),X=(0,e.RandomRange)(-a/2,a/2),y=(0,e.RandomRange)(0,2*Math.PI),H=(0,e.RandomRange)((1-C)*(1-C),1),M=Math.sqrt(H)*U,b=M*Math.cos(y),l=M*Math.sin(y);N.isEmitterTransformNode?A.xp.TransformCoordinatesFromFloatsToRef(b,X,l,N.emitterWorldMatrix,T.position):(T.position.kX(b,X,l),T.position.addInPlace(N.emitterPosition))},this.output._storedValue=p}});class yT extends Ep{constructor(N){super(N),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",qp.Particle),this.registerOutput("output",qp.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const p=this.particle.getConnectedValue(N);p._isAnimationSheetEnabled=!0,p.spriteCellWidth=this.width,p.spriteCellHeight=this.height,p.startSpriteCellID=this.start,p.endSpriteCellID=this.end,p.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=p}serialize(){const N=super.serialize();return N.width=this.width,N.height=this.height,N.start=this.start,N.end=this.end,N.randomStartCell=this.randomStartCell,N}_deserialize(N){super._deserialize(N),this.width=N.width,this.height=N.height,this.start=N.start,this.end=N.end,this.randomStartCell=N.randomStartCell}}(0,f.b)([Op("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yT.prototype,"start",void 0),(0,f.b)([Op("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yT.prototype,"end",void 0),(0,f.b)([Op("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yT.prototype,"width",void 0),(0,f.b)([Op("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yT.prototype,"height",void 0),(0,f.b)([Op("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],yT.prototype,"loop",void 0),(0,f.b)([Op("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],yT.prototype,"randomStartCell",void 0),(0,X.d)("BABYLON.SetupSpriteSheetBlock",yT);class eT extends Ep{constructor(N){super(N),this.reference=0,this.registerInput("value",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case qp.Float:return qp.FloatGradient;case qp.Vector2:return qp.Vector2Gradient;case qp.xp:return qp.Vector3Gradient;case qp.LX:return qp.Color4Gradient}return N},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qp.Float|qp.Vector2|qp.xp|qp.LX)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=N=>null}serialize(){const N=super.serialize();return N.reference=this.reference,N}_deserialize(N){super._deserialize(N),this.reference=N.reference}}(0,f.b)([Op("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],eT.prototype,"reference",void 0),(0,X.d)("BABYLON.ParticleGradientValueBlock",eT);(0,X.d)("BABYLON.ParticleGradientBlock",class extends Ep{constructor(N){super(N),this._entryCount=1,this.registerInput("gradient",qp.Float,!0,1,0,1),this.registerInput("value0",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=N=>{switch(N){case qp.FloatGradient:return qp.Float;case qp.Vector2Gradient:return qp.Vector2;case qp.Vector3Gradient:return qp.xp;case qp.Color4Gradient:return qp.LX}return N},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(qp.FloatGradient|qp.Vector2Gradient|qp.Vector3Gradient|qp.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(N){this._inputs[N].onConnectionObservable.add((()=>{this._entryCount>N||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),qp.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const N=[];for(let T=1;T<this._inputs.length;T++){var p;if(this._inputs[T].isConnected)N.push(null===(p=this._inputs[T].connectedPoint)||void 0===p?void 0:p.ownerBlock)}N.sort(((N,p)=>N.reference-p.reference)),this.output._storedFunction=p=>{const T=this.gradient.getConnectedValue(p);if(1===N.length)return N[0].value.getConnectedValue(p);let a=null;for(let C=N.length-1;C>=0;C--){const X=N[C];if(X.reference<=T){const N=X.value.getConnectedValue(p);if(a){const C=a.value.getConnectedValue(p),y=a.reference,H=X.reference,M=Math.max(0,Math.min(1,(T-H)/(y-H)));switch(this.output.type){case qp.Float:return(0,e.Lerp)(N,C,M);case qp.Vector2:return A.Vector2.Lerp(N,C,M);case qp.xp:return A.xp.Lerp(N,C,M);case qp.LX:return U.LX.Lerp(N,C,M)}}return N}a=X}return 0}}});(0,X.d)("BABYLON.ParticleConverterBlock",class extends Ep{constructor(N){super(N),this.registerInput("color ",qp.LX,!0),this.registerInput("xyz ",qp.xp,!0),this.registerInput("xy ",qp.Vector2,!0),this.registerInput("zw ",qp.Vector2,!0),this.registerInput("x ",qp.Float,!0),this.registerInput("y ",qp.Float,!0),this.registerInput("z ",qp.Float,!0),this.registerInput("w ",qp.Float,!0),this.registerOutput("color",qp.LX),this.registerOutput("xyz",qp.xp),this.registerOutput("xy",qp.Vector2),this.registerOutput("zw",qp.Vector2),this.registerOutput("x",qp.Float),this.registerOutput("y",qp.Float),this.registerOutput("z",qp.Float),this.registerOutput("w",qp.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(N){return"color "===N?"colorIn":"xyz "===N?"xyzIn":"xy "===N?"xyIn":"zw "===N?"zwIn":"x "===N?"xIn":"y "===N?"yIn":"z "===N?"zIn":"w "===N?"wIn":N}_outputRename(N){switch(N){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return N}}_build(N){super._build(N);const p=this.xIn,T=this.yIn,a=this.zIn,C=this.wIn,X=this.xyIn,y=this.zwIn,e=this.xyzIn,H=this.colorIn,M=this.colorOut,b=this.xyzOut,l=this.xyOut,k=this.zwOut,x=this.xOut,I=this.yOut,L=this.zOut,n=this.wOut,w=N=>{if(H.isConnected)return H.getConnectedValue(N);let A=0,M=0,b=0,l=0;if(p.isConnected&&(A=p.getConnectedValue(N)),T.isConnected&&(M=T.getConnectedValue(N)),a.isConnected&&(b=a.getConnectedValue(N)),C.isConnected&&(l=C.getConnectedValue(N)),X.isConnected){const p=X.getConnectedValue(N);p&&(A=p.x,M=p.y)}if(y.isConnected){const p=y.getConnectedValue(N);p&&(b=p.x,l=p.y)}if(e.isConnected){const p=e.getConnectedValue(N);p&&(A=p.x,M=p.y,b=p.z)}return new U.LX(A,M,b,l)};M._storedFunction=N=>w(N),b._storedFunction=N=>{const p=w(N);return new A.xp(p.r,p.g,p.b)},l._storedFunction=N=>{const p=w(N);return new A.Vector2(p.r,p.g)},k._storedFunction=N=>{const p=w(N);return new A.Vector2(p.b,p.a)},x._storedFunction=N=>w(N).r,I._storedFunction=N=>w(N).g,L._storedFunction=N=>w(N).b,n._storedFunction=N=>w(N).a}}),function(N){N[N.Cos=0]="Cos",N[N.Sin=1]="Sin",N[N.Abs=2]="Abs",N[N.Exp=3]="Exp",N[N.Exp2=4]="Exp2",N[N.Round=5]="Round",N[N.Floor=6]="Floor",N[N.Ceiling=7]="Ceiling",N[N.Sqrt=8]="Sqrt",N[N.Log=9]="Log",N[N.Tan=10]="Tan",N[N.ArcTan=11]="ArcTan",N[N.ArcCos=12]="ArcCos",N[N.ArcSin=13]="ArcSin",N[N.Sign=14]="Sign",N[N.Negate=15]="Negate",N[N.OneMinus=16]="OneMinus",N[N.Reciprocal=17]="Reciprocal",N[N.ToDegrees=18]="ToDegrees",N[N.ToRadians=19]="ToRadians",N[N.Fract=20]="Fract"}(cp||(cp={}));class HT extends Ep{constructor(N){super(N),this.operation=cp.Cos,this.registerInput("input",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(qp.Float|qp.Int|qp.Vector2|qp.xp|qp.LX)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);let p=null;switch(this.operation){case cp.Cos:p=N=>Math.cos(N);break;case cp.Sin:p=N=>Math.sin(N);break;case cp.Abs:p=N=>Math.abs(N);break;case cp.Exp:p=N=>Math.exp(N);break;case cp.Exp2:p=N=>Math.pow(2,N);break;case cp.Round:p=N=>Math.round(N);break;case cp.Floor:p=N=>Math.floor(N);break;case cp.Ceiling:p=N=>Math.ceil(N);break;case cp.Sqrt:p=N=>Math.sqrt(N);break;case cp.Log:p=N=>Math.log(N);break;case cp.Tan:p=N=>Math.tan(N);break;case cp.ArcTan:p=N=>Math.atan(N);break;case cp.ArcCos:p=N=>Math.acos(N);break;case cp.ArcSin:p=N=>Math.asin(N);break;case cp.Sign:p=N=>Math.sign(N);break;case cp.Negate:p=N=>-N;break;case cp.OneMinus:p=N=>1-N;break;case cp.Reciprocal:p=N=>1/N;break;case cp.ToRadians:p=N=>N*Math.PI/180;break;case cp.ToDegrees:p=N=>180*N/Math.PI;break;case cp.Fract:p=N=>N>=0?N-Math.floor(N):N-Math.ceil(N)}if(!p)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case qp.Int:case qp.Float:this.output._storedFunction=N=>{const T=this.input.getConnectedValue(N);return p(T)};break;case qp.Vector2:this.output._storedFunction=N=>{const T=this.input.getConnectedValue(N);return new A.Vector2(p(T.x),p(T.y))};break;case qp.xp:this.output._storedFunction=N=>{const T=this.input.getConnectedValue(N);return new A.xp(p(T.x),p(T.y),p(T.z))};break;case qp.LX:this.output._storedFunction=N=>{const T=this.input.getConnectedValue(N);return new U.LX(p(T.r),p(T.g),p(T.b),p(T.a))}}return this}serialize(){const N=super.serialize();return N.operation=this.operation,N}_deserialize(N){super._deserialize(N),this.operation=N.operation}}(0,f.b)([Op("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:cp.Cos},{label:"Sin",value:cp.Sin},{label:"Abs",value:cp.Abs},{label:"Exp",value:cp.Exp},{label:"Exp2",value:cp.Exp2},{label:"Round",value:cp.Round},{label:"Floor",value:cp.Floor},{label:"Ceiling",value:cp.Ceiling},{label:"Sqrt",value:cp.Sqrt},{label:"Log",value:cp.Log},{label:"Tan",value:cp.Tan},{label:"ArcTan",value:cp.ArcTan},{label:"ArcCos",value:cp.ArcCos},{label:"ArcSin",value:cp.ArcSin},{label:"Sign",value:cp.Sign},{label:"Negate",value:cp.Negate},{label:"OneMinus",value:cp.OneMinus},{label:"Reciprocal",value:cp.Reciprocal},{label:"ToDegrees",value:cp.ToDegrees},{label:"ToRadians",value:cp.ToRadians},{label:"Fract",value:cp.Fract}]})],HT.prototype,"operation",void 0),(0,X.d)("BABYLON.ParticleTrigonometryBlock",HT);var MT,bT=T(13779);class lT extends Ep{constructor(N){super(N),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(qp.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(qp.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(qp.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(qp.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(qp.System),this._inputs[0].excludedConnectionPointTypes.push(qp.Particle),this._inputs[0].excludedConnectionPointTypes.push(qp.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const p=N=>{const p=this.input.getConnectedValue(N);if(this.log.length>=this.stackSize)return p;if(null===p||void 0===p)return this.log.push(["null",""]),p;switch(this.input.type){case qp.Vector2:this.log.push([(0,bT.h)(p,4),p.toString()]);break;case qp.xp:this.log.push([(0,bT.j)(p,4),p.toString()]);break;case qp.LX:this.log.push([`{R: ${p.r.toFixed(4)} G: ${p.g.toFixed(4)} B: ${p.b.toFixed(4)} A: ${p.a.toFixed(4)}}`,p.toString()]);break;default:this.log.push([p.toString(),p.toString()])}return p};this.output.isConnected?this.output._storedFunction=p:this.output._storedValue=p(N)}serialize(){const N=super.serialize();return N.stackSize=this.stackSize,N}_deserialize(N){super._deserialize(N),this.stackSize=N.stackSize}}(0,f.b)([Op("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],lT.prototype,"stackSize",void 0),(0,X.d)("BABYLON.ParticleDebugBlock",lT);(0,X.d)("BABYLON.ParticleElbowBlock",class extends Ep{constructor(N){super(N),this.registerInput("input",qp.AutoDetect),this.registerOutput("output",qp.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(N){super._build(N);const p=this._outputs[0],T=this._inputs[0];p._storedFunction=N=>T.getConnectedValue(N)}});(0,X.d)("BABYLON.ParticleTeleportInBlock",class extends Ep{get endpoints(){return this._endpoints}constructor(N){super(N),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",qp.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(N){if(this.getClassName()===N)return!0;for(const p of this.endpoints)if(p.isAnAncestorOfType(N))return!0;return!1}isAnAncestorOf(N){for(const p of this.endpoints){if(p===N)return!0;if(p.isAnAncestorOf(N))return!0}return!1}attachToEndpoint(N){N.detach(),this._endpoints.push(N),N._entryPoint=this,N._outputs[0]._typeConnectionSource=this._inputs[0],N._tempEntryPointUniqueId=null,N.name="> "+this.name}detachFromEndpoint(N){const p=this._endpoints.indexOf(N);-1!==p&&(this._endpoints.splice(p,1),N._outputs[0]._typeConnectionSource=null,N._entryPoint=null)}_build(){for(const N of this._endpoints)N.output._storedFunction=N=>this.input.getConnectedValue(N)}});(0,X.d)("BABYLON.ParticleTeleportOutBlock",class extends Ep{constructor(N){super(N),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",qp.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(N){this.entryPoint&&this.entryPoint.build(N)}clone(){const N=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(N),N}serialize(){var N;const p=super.serialize();return p.entryPoint=(null===(N=this.entryPoint)||void 0===N?void 0:N.uniqueId)??"",p}_deserialize(N){super._deserialize(N),this._tempEntryPointUniqueId=N.entryPoint}}),function(N){N[N.Equal=0]="Equal",N[N.NotEqual=1]="NotEqual",N[N.LessThan=2]="LessThan",N[N.GreaterThan=3]="GreaterThan",N[N.LessOrEqual=4]="LessOrEqual",N[N.GreaterOrEqual=5]="GreaterOrEqual",N[N.Xor=6]="Xor",N[N.Or=7]="Or",N[N.And=8]="And"}(MT||(MT={}));class kT extends Ep{constructor(N){super(N),this.test=MT.Equal,this.epsilon=0,this.registerInput("left",qp.Float),this.registerInput("right",qp.Float,!0,0),this.registerInput("ifTrue",qp.AutoDetect,!0,1),this.registerInput("ifFalse",qp.AutoDetect,!0,0),this.registerOutput("output",qp.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=qp.Float,this._inputs[0].acceptedConnectionPointTypes.push(qp.Int),this._inputs[1].acceptedConnectionPointTypes.push(qp.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const N=N=>{const p=this.left.getConnectedValue(N),T=this.right.getConnectedValue(N);let A=!1;switch(this.test){case MT.Equal:A=(0,e.WithinEpsilon)(p,T,this.epsilon);break;case MT.NotEqual:A=!(0,e.WithinEpsilon)(p,T,this.epsilon);break;case MT.LessThan:A=p<T+this.epsilon;break;case MT.GreaterThan:A=p>T-this.epsilon;break;case MT.LessOrEqual:A=p<=T+this.epsilon;break;case MT.GreaterOrEqual:A=p>=T-this.epsilon;break;case MT.Xor:A=!!p&&!T||!p&&!!T;break;case MT.Or:A=!!p||!!T;break;case MT.And:A=!!p&&!!T}return A};this.output._storedFunction=p=>N(p)?this.ifTrue.getConnectedValue(p):this.ifFalse.getConnectedValue(p)}serialize(){const N=super.serialize();return N.test=this.test,N.epsilon=this.epsilon,N}_deserialize(N){super._deserialize(N),this.test=N.test,void 0!==N.epsilon&&(this.epsilon=N.epsilon)}}(0,f.b)([Op("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:MT.Equal},{label:"NotEqual",value:MT.NotEqual},{label:"LessThan",value:MT.LessThan},{label:"GreaterThan",value:MT.GreaterThan},{label:"LessOrEqual",value:MT.LessOrEqual},{label:"GreaterOrEqual",value:MT.GreaterOrEqual},{label:"Xor",value:MT.Xor},{label:"Or",value:MT.Or},{label:"And",value:MT.And}]})],kT.prototype,"test",void 0),(0,f.b)([Op("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kT.prototype,"epsilon",void 0),(0,X.d)("BABYLON.ParticleConditionBlock",kT);class xT extends Ep{constructor(N){super(N),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",qp.Particle),this.registerInput("condition",qp.Float,!0,0),this.registerInput("system",qp.System),this.registerOutput("output",qp.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(N){this._triggerCount=0;const p=this.input.getConnectedValue(N),T={process:T=>{if(N.particleContext=T,N.systemContext=p,0!==this.condition.getConnectedValue(N)&&(0===this.limit||this._triggerCount<this.limit)){const A=(new Date).getTime();if(this._previousOne&&A-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=A;const a=this.system.getConnectedValue(N);if(a){const A=dp(a,N.Lp,T.position);A.SU.addOnce((()=>{this._triggerCount--})),p.SU.addOnce((()=>{A.dispose()}))}}},previousItem:null,nextItem:null};p._updateQueueStart?uN(T,p._updateQueueStart):p._updateQueueStart=T,this.output._storedValue=p}serialize(){const N=super.serialize();return N.limit=this.limit,N.delay=this.delay,N}_deserialize(N){super._deserialize(N),void 0!==N.limit&&(this.limit=N.limit),void 0!==N.delay&&(this.delay=N.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,f.b)([Op("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xT.prototype,"limit",void 0),(0,f.b)([Op("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],xT.prototype,"delay",void 0),(0,X.d)("BABYLON.ParticleTriggerBlock",xT);T(13781),T(13793),T(13804),T(13855)},13846:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13808:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13871:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneVertex",C="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13860:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13852:(N,p,T)=>{"use strict";var A=T(12281);const a="fogFragment",C="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13838:(N,p,T)=>{"use strict";var A=T(12281);const a="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13873:(N,p,T)=>{"use strict";var A=T(12281);const a="fogVertex",C="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13863:(N,p,T)=>{"use strict";var A=T(12281);const a="fogVertexDeclaration",C="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13827:(N,p,T)=>{"use strict";var A=T(12281);const a="helperFunctions",C="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13817:(N,p,T)=>{"use strict";var A=T(12281);const a="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13834:(N,p,T)=>{"use strict";var A=T(12281);const a="imageProcessingFunctions",C="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13822:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13850:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13882:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A.b.IncludesShadersStoreWGSL[a]||(A.b.IncludesShadersStoreWGSL[a]=C)},13804:(N,p,T)=>{"use strict";T.r(p),T.d(p,{particlesPixelShaderWGSL:()=>U});var A=T(12281);T(13808),T(13817),T(13822),T(13827),T(13834),T(13838),T(13846),T(13850),T(13852);const a="particlesPixelShader",C="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.b.ShadersStoreWGSL[a]||(A.b.ShadersStoreWGSL[a]=C);const U={name:a,shader:C}},13855:(N,p,T)=>{"use strict";T.r(p),T.d(p,{particlesVertexShaderWGSL:()=>U});var A=T(12281);T(13860),T(13863),T(13822),T(13871),T(13873),T(13882);const a="particlesVertexShader",C="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.b.ShadersStoreWGSL[a]||(A.b.ShadersStoreWGSL[a]=C);const U={name:a,shader:C}},13720:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneFragment",C="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13790:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneFragmentDeclaration",C="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13738:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneVertex",C="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13796:(N,p,T)=>{"use strict";var A=T(12281);const a="clipPlaneVertexDeclaration",C="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13727:(N,p,T)=>{"use strict";var A=T(12281);const a="fogFragment",C="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13716:(N,p,T)=>{"use strict";var A=T(12281);const a="fogFragmentDeclaration",C="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13740:(N,p,T)=>{"use strict";var A=T(12281);const a="fogVertex",C="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13734:(N,p,T)=>{"use strict";var A=T(12281);const a="fogVertexDeclaration",C="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13703:(N,p,T)=>{"use strict";var A=T(12281);const a="helperFunctions",C="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13687:(N,p,T)=>{"use strict";var A=T(12281);const a="imageProcessingDeclaration",C="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13710:(N,p,T)=>{"use strict";var A=T(12281);const a="imageProcessingFunctions",C="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13695:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthDeclaration",C="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13724:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthFragment",C="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13749:(N,p,T)=>{"use strict";var A=T(12281);const a="logDepthVertex",C="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A.b.IncludesShadersStore[a]||(A.b.IncludesShadersStore[a]=C)},13781:(N,p,T)=>{"use strict";T.r(p),T.d(p,{particlesPixelShader:()=>U});var A=T(12281);T(13790),T(13687),T(13695),T(13703),T(13710),T(13716),T(13720),T(13724),T(13727);const a="particlesPixelShader",C="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";A.b.ShadersStore[a]||(A.b.ShadersStore[a]=C);const U={name:a,shader:C}},13793:(N,p,T)=>{"use strict";T.r(p),T.d(p,{particlesVertexShader:()=>U});var A=T(12281);T(13796),T(13734),T(13695),T(13738),T(13740),T(13749);const a="particlesVertexShader",C="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";A.b.ShadersStore[a]||(A.b.ShadersStore[a]=C);const U={name:a,shader:C}},14132:(N,p,T)=>{"use strict";T.r(p),T.d(p,{FlowGraphGLTFDataProvider:()=>C});var A=T(14108),a=T(14082);class C extends A.c{constructor(N){var p,T;super();const A=N.glTF,C=(null===(p=A.animations)||void 0===p?void 0:p.map((N=>N._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",a.d,C);const U=(null===(T=A.nodes)||void 0===T?void 0:T.map((N=>N._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",a.d,U)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14021:(N,p,T)=>{"use strict";T.d(p,{e:()=>I,g:()=>k,k:()=>l,m:()=>x});var A=T(12371),a=T(12862),C=T(12421),U=T(14030);const X=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class y{constructor(N,p){this._gltf=N,this._infoTree=p}convert(N){let p,T=this._gltf,A=this._infoTree;if(!N.startsWith("/"))throw new Error("Path must start with a /");const a=N.split("/");if(a.shift(),a[a.length-1].includes(".length")){const N=a[a.length-1].split(".");a.pop(),a.push(...N)}let C=!1;for(const y of a){const a="length"===y;if(a&&!A.__array__)throw new Error(`Path ${N} is invalid`);if(A.__ignoreObjectTree__&&(C=!0),A.__array__&&!a)A=A.__array__;else if(A=A[y],!A)throw new Error(`Path ${N} is invalid`);if(!C)if(void 0===T){if(!X.find((p=>p.regex.test(N))))throw new Error(`Path ${N} is invalid`)}else if(!a){var U;T=null===(U=T)||void 0===U?void 0:U[y]}(A.__target__||a)&&(p=T)}return{object:p,info:A}}}function e(N,p,T,A){const a=H(N,p);return A?a[T][A]:a[T]}function H(N,p,T){var A,C;return null===(A=N._data)||void 0===A||null===(C=A[(null===T||void 0===T?void 0:T.fillMode)??a.e.MATERIAL_TriangleFillMode])||void 0===C?void 0:C.babylonMaterial}function M(N,p){return{offset:{componentsCount:2,type:"Vector2",get:(T,a,C)=>{const U=e(T,C,N,p);return new A.Vector2(null===U||void 0===U?void 0:U.uOffset,null===U||void 0===U?void 0:U.vOffset)},getTarget:H,set:(T,A,a,C)=>{const U=e(A,C,N,p);U.uOffset=T.x,U.vOffset=T.y},getPropertyName:[()=>`${N}${p?"."+p:""}.uOffset`,()=>`${N}${p?"."+p:""}.vOffset`]},rotation:{type:"number",get:(T,A,a)=>{var C;return null===(C=e(T,a,N,p))||void 0===C?void 0:C.wAng},getTarget:H,set:(T,A,a,C)=>e(A,C,N,p).wAng=T,getPropertyName:[()=>`${N}${p?"."+p:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(T,a,C)=>{const U=e(T,C,N,p);return new A.Vector2(null===U||void 0===U?void 0:U.uScale,null===U||void 0===U?void 0:U.vScale)},getTarget:H,set:(T,A,a,C)=>{const U=e(A,C,N,p);U.uScale=T.x,U.vScale=T.y},getPropertyName:[()=>`${N}${p?"."+p:""}.uScale`,()=>`${N}${p?"."+p:""}.vScale`]}}}const b={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:N=>{var p,T;return new A.Vector2((null===(p=N._babylonCamera)||void 0===p?void 0:p.orthoLeft)??0,(null===(T=N._babylonCamera)||void 0===T?void 0:T.orthoRight)??0)},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.orthoLeft=N.x,p._babylonCamera.orthoRight=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:N=>{var p,T;return new A.Vector2((null===(p=N._babylonCamera)||void 0===p?void 0:p.orthoBottom)??0,(null===(T=N._babylonCamera)||void 0===T?void 0:T.orthoTop)??0)},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.orthoBottom=N.x,p._babylonCamera.orthoTop=N.y)},getTarget:N=>N,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.maxZ},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.yX},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.yX=N)},getTarget:N=>N,getPropertyName:[()=>"yX"]}},perspective:{aspectRatio:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.getEngine().getAspectRatio(N._babylonCamera)},getTarget:N=>N,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.fov},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.fov=N)},getTarget:N=>N,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.maxZ},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.maxZ=N)},getTarget:N=>N,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:N=>{var p;return null===(p=N._babylonCamera)||void 0===p?void 0:p.yX},set:(N,p)=>{p._babylonCamera&&(p._babylonCamera.yX=N)},getTarget:N=>N,getPropertyName:[()=>"yX"]}}}},nodes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"xp",get:N=>{var p;return null===(p=N._babylonTransformNode)||void 0===p?void 0:p.position},set:(N,p)=>{var T;return null===(T=p._babylonTransformNode)||void 0===T?void 0:T.position.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:N=>{var p;return null===(p=N._babylonTransformNode)||void 0===p?void 0:p.rotationQuaternion},set:(N,p)=>{var T,A;return null===(T=p._babylonTransformNode)||void 0===T||null===(A=T.rotationQuaternion)||void 0===A?void 0:A.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"xp",get:N=>{var p;return null===(p=N._babylonTransformNode)||void 0===p?void 0:p.xX},set:(N,p)=>{var T;return null===(T=p._babylonTransformNode)||void 0===T?void 0:T.xX.A(N)},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"xX"]},weights:{length:{type:"number",get:N=>N._numMorphTargets,getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(N,p)=>{var T,A;return void 0!==p?null===(T=N._primitiveBabylonMeshes)||void 0===T||null===(A=T[0].morphTargetManager)||void 0===A?void 0:A.getTarget(p).influence:void 0},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(N,p)=>[0],getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:N=>{var p,T,a;return A.Matrix.Compose(null===(p=N._babylonTransformNode)||void 0===p?void 0:p.xX,null===(T=N._babylonTransformNode)||void 0===T?void 0:T.rotationQuaternion,null===(a=N._babylonTransformNode)||void 0===a?void 0:a.position)},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:N=>{var p,T,a,C;const U=A.Matrix.Identity();let X=N.parent;for(;X&&X.parent;)X=X.parent;const y=(null===(p=N._babylonTransformNode)||void 0===p?void 0:p.position._isDirty)||(null===(T=N._babylonTransformNode)||void 0===T||null===(a=T.rotationQuaternion)||void 0===a?void 0:a._isDirty)||(null===(C=N._babylonTransformNode)||void 0===C?void 0:C.xX._isDirty);if(X){var e;const p=null===(e=X._babylonTransformNode)||void 0===e?void 0:e.HX(!0).invert();var H,M;if(p)null===(H=N._babylonTransformNode)||void 0===H||null===(M=H.HX(y))||void 0===M||M.multiplyToRef(p,U)}else N._babylonTransformNode&&U.A(N._babylonTransformNode.HX(y));return U},getTarget:N=>N._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:N=>{var p,T;return null===(p=N._babylonTransformNode)||void 0===p||null===(T=p.getChildren((N=>N instanceof U.d),!0)[0])||void 0===T?void 0:T.gX},getTarget:N=>{var p;return null===(p=N._babylonTransformNode)||void 0===p?void 0:p.getChildren((N=>N instanceof U.d),!0)[0]},set:(N,p)=>{if(p._babylonTransformNode){const T=p._babylonTransformNode.getChildren((N=>N instanceof U.d),!0)[0];T&&(T.gX=N)}}},color:{type:"wp",get:N=>{var p,T;return null===(p=N._babylonTransformNode)||void 0===p||null===(T=p.getChildren((N=>N instanceof U.d),!0)[0])||void 0===T?void 0:T.PX},getTarget:N=>{var p;return null===(p=N._babylonTransformNode)||void 0===p?void 0:p.getChildren((N=>N instanceof U.d),!0)[0]},set:(N,p)=>{if(p._babylonTransformNode){const T=p._babylonTransformNode.getChildren((N=>N instanceof U.d),!0)[0];T&&(T.PX=N)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"wp",get:(N,p,T)=>H(N,p,T).emissiveColor,set:(N,p,T,A)=>H(p,T,A).emissiveColor.A(N),getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:M("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(N,p,T)=>{var A;return null===(A=e(N,T,"bumpTexture"))||void 0===A?void 0:A.level},set:(N,p,T,A)=>{const a=e(p,A,"bumpTexture");a&&(a.level=N)},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:M("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(N,p,T)=>H(N,p,T).ambientTextureStrength,set:(N,p,T,A)=>{const a=H(p,T,A);a&&(a.ambientTextureStrength=N)},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:M("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"LX",get:(N,p,T)=>{const A=H(N,p,T);return C.LX.FromColor3(A.albedoColor,A.alpha)},set:(N,p,T,A)=>{const a=H(p,T,A);a.albedoColor.set(N.r,N.g,N.b),a.alpha=N.a},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:M("albedoTexture")}},metallicFactor:{type:"number",get:(N,p,T)=>H(N,p,T).metallic,set:(N,p,T,A)=>{const a=H(p,T,A);a&&(a.metallic=N)},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(N,p,T)=>H(N,p,T).roughness,set:(N,p,T,A)=>{const a=H(p,T,A);a&&(a.roughness=N)},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:M("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(N,p,T)=>H(N,p,T).anisotropy.gX,set:(N,p,T,A)=>{H(p,T,A).anisotropy.gX=N},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(N,p,T)=>H(N,p,T).anisotropy.angle,set:(N,p,T,A)=>{H(p,T,A).anisotropy.angle=N},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:M("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(N,p,T)=>H(N,p,T).clearCoat.gX,set:(N,p,T,A)=>{H(p,T,A).clearCoat.gX=N},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(N,p,T)=>H(N,p,T).clearCoat.roughness,set:(N,p,T,A)=>{H(p,T,A).clearCoat.roughness=N},getTarget:(N,p,T)=>H(N,p,T),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:M("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(N,p,T)=>{var A;return null===(A=H(N,p,T).clearCoat.bumpTexture)||void 0===A?void 0:A.level},getTarget:H,set:(N,p,T,A)=>H(p,T,A).clearCoat.bumpTexture.level=N},extensions:{KHR_texture_transform:M("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:M("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(N,p,T)=>H(N,p,T).subSurface.dispersion,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.dispersion=N}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(N,p,T)=>H(N,p,T).emissiveIntensity,getTarget:H,set:(N,p,T,A)=>H(p,T,A).emissiveIntensity=N}},KHR_materials_ior:{ior:{type:"number",get:(N,p,T)=>H(N,p,T).indexOfRefraction,getTarget:H,set:(N,p,T,A)=>H(p,T,A).indexOfRefraction=N}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(N,p,T)=>H(N,p,T).iridescence.gX,getTarget:H,set:(N,p,T,A)=>H(p,T,A).iridescence.gX=N},iridescenceIor:{type:"number",get:(N,p,T)=>H(N,p,T).iridescence.indexOfRefraction,getTarget:H,set:(N,p,T,A)=>H(p,T,A).iridescence.indexOfRefraction=N},iridescenceTexture:{extensions:{KHR_texture_transform:M("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(N,p,T)=>H(N,p,T).iridescence.maximumThickness,getTarget:H,set:(N,p,T,A)=>H(p,T,A).iridescence.maximumThickness=N},iridescenceThicknessMinimum:{type:"number",get:(N,p,T)=>H(N,p,T).iridescence.minimumThickness,getTarget:H,set:(N,p,T,A)=>H(p,T,A).iridescence.minimumThickness=N},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:M("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"wp",get:(N,p,T)=>H(N,p,T).sheen.color,getTarget:H,set:(N,p,T,A)=>H(p,T,A).sheen.color.A(N)},sheenColorTexture:{extensions:{KHR_texture_transform:M("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(N,p,T)=>H(N,p,T).sheen.gX,getTarget:H,set:(N,p,T,A)=>H(p,T,A).sheen.gX=N},sheenRoughnessTexture:{extensions:{KHR_texture_transform:M("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(N,p,T)=>H(N,p,T).metallicF0Factor,getTarget:H,set:(N,p,T,A)=>H(p,T,A).metallicF0Factor=N,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"wp",get:(N,p,T)=>H(N,p,T).metallicReflectanceColor,getTarget:H,set:(N,p,T,A)=>H(p,T,A).metallicReflectanceColor.A(N),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:M("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:M("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(N,p,T)=>H(N,p,T).subSurface.refractionIntensity,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.refractionIntensity=N,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:M("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(N,p,T)=>H(N,p,T).subSurface.translucencyIntensity,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.translucencyIntensity=N},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:M("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"wp",get:(N,p,T)=>H(N,p,T).subSurface.translucencyColor,getTarget:H,set:(N,p,T,A)=>{var a;return N&&(null===(a=H(p,T,A).subSurface.translucencyColor)||void 0===a?void 0:a.A(N))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:M("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"wp",get:(N,p,T)=>H(N,p,T).subSurface.tintColor,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.tintColor.A(N)},attenuationDistance:{type:"number",get:(N,p,T)=>H(N,p,T).subSurface.tintColorAtDistance,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.tintColorAtDistance=N},thicknessFactor:{type:"number",get:(N,p,T)=>H(N,p,T).subSurface.maximumThickness,getTarget:H,set:(N,p,T,A)=>H(p,T,A).subSurface.maximumThickness=N},thicknessTexture:{extensions:{KHR_texture_transform:M("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,color:{type:"wp",get:N=>{var p;return null===(p=N._babylonLight)||void 0===p?void 0:p.PX},set:(N,p)=>{var T;return null===(T=p._babylonLight)||void 0===T?void 0:T.PX.A(N)},getTarget:N=>N._babylonLight,getPropertyName:[N=>"diffuse"]},gX:{type:"number",get:N=>{var p;return null===(p=N._babylonLight)||void 0===p?void 0:p.gX},set:(N,p)=>p._babylonLight?p._babylonLight.gX=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"intensity"]},range:{type:"number",get:N=>{var p;return null===(p=N._babylonLight)||void 0===p?void 0:p.range},set:(N,p)=>p._babylonLight?p._babylonLight.range=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"range"]},spot:{innerConeAngle:{type:"number",get:N=>{var p;return null===(p=N._babylonLight)||void 0===p?void 0:p.innerAngle},set:(N,p)=>p._babylonLight?p._babylonLight.innerAngle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"innerConeAngle"]},outerConeAngle:{type:"number",get:N=>{var p;return null===(p=N._babylonLight)||void 0===p?void 0:p.angle},set:(N,p)=>p._babylonLight?p._babylonLight.angle=N:void 0,getTarget:N=>N._babylonLight,getPropertyName:[N=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonLight)),getPropertyName:[N=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonTexture)),getPropertyName:[N=>"length"]},__array__:{__target__:!0,gX:{type:"number",get:N=>{var p;return null===(p=N._babylonTexture)||void 0===p?void 0:p.level},set:(N,p)=>{p._babylonTexture&&(p._babylonTexture.level=N)},getTarget:N=>N._babylonTexture},rotation:{type:"Quaternion",get:N=>{var p;return N._babylonTexture&&A.Quaternion.FromRotationMatrix(null===(p=N._babylonTexture)||void 0===p?void 0:p.getReflectionTextureMatrix())},set:(N,p)=>{var T;p._babylonTexture&&(null!==(T=p._babylonTexture.KN())&&void 0!==T&&T.useRightHandedSystem||(N=A.Quaternion.Inverse(N)),A.Matrix.FromQuaternionToRef(N,p._babylonTexture.getReflectionTextureMatrix()))},getTarget:N=>N._babylonTexture}}}}},animations:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>N._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:N=>N.length,getTarget:N=>N.map((N=>{var p;return null===(p=N.primitives[0]._instanceData)||void 0===p?void 0:p.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function l(N){return new y(N,b)}function k(N){const p=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let T=b;for(const A of p)A&&(T=T[A]);if(T&&T.type&&T.get)return T}function x(N,p){const T=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let A=b;for(const a of T)a&&(A=A[a]);A&&A.type&&A.get&&(A.interpolation=p)}function I(N,p){const T=N.split("/").map((N=>N.replace(/{}/g,"__array__")));let A=b;for(const a of T)if(a){if(!A[a]){if("?"===a){A.__ignoreObjectTree__=!0;continue}A[a]={},"__array__"===a&&(A[a].__target__=!0)}A=A[a]}Object.assign(A,p)}},14034:(N,p,T)=>{"use strict";T.r(p),T.d(p,{AnimationPropertyInfo:()=>e,TransformNodeAnimationPropertyInfo:()=>H,WeightAnimationPropertyInfo:()=>M,getQuaternion:()=>X,getVector3:()=>U,getWeights:()=>y});var A=T(12912),a=T(12371),C=T(14021);function U(N,p,T,A){return a.xp.gp(p,T).scaleInPlace(A)}function X(N,p,T,A){return a.Quaternion.gp(p,T).scaleInPlace(A)}function y(N,p,T,A){const a=new Array(N._numMorphTargets);for(let C=0;C<a.length;C++)a[C]=p[T++]*A;return a}class e{constructor(N,p,T,A){this.type=N,this.name=p,this.getValue=T,this.getStride=A}_buildAnimation(N,p,T){const a=new A.b(N,this.name,p,this.type);return a.setKeys(T),a}}class H extends e{buildAnimations(N,p,T,A){const a=[];return a.push({babylonAnimatable:N._babylonTransformNode,babylonAnimation:this._buildAnimation(p,T,A)}),a}}class M extends e{buildAnimations(N,p,T,a){const C=[];if(N._numMorphTargets)for(let U=0;U<N._numMorphTargets;U++){const X=new A.b(`${p}_${U}`,this.name,T,this.type);if(X.setKeys(a.map((N=>({frame:N.frame,inTangent:N.inTangent?N.inTangent[U]:void 0,value:N.value[U],outTangent:N.outTangent?N.outTangent[U]:void 0,interpolation:N.interpolation})))),N._primitiveBabylonMeshes)for(const p of N._primitiveBabylonMeshes)if(p.morphTargetManager){const N=p.morphTargetManager.getTarget(U),T=X.clone();N.animations.push(T),C.push({babylonAnimatable:N,babylonAnimation:T})}}return C}}(0,C.m)("/nodes/{}/translation",[new H(A.b.ANIMATIONTYPE_VECTOR3,"position",U,(()=>3))]),(0,C.m)("/nodes/{}/rotation",[new H(A.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",X,(()=>4))]),(0,C.m)("/nodes/{}/scale",[new H(A.b.ANIMATIONTYPE_VECTOR3,"xX",U,(()=>3))]),(0,C.m)("/nodes/{}/weights",[new M(A.b.ANIMATIONTYPE_FLOAT,"influence",y,(N=>N._numMorphTargets))])},13984:(N,p,T)=>{"use strict";class A{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((N,p)=>{this._resolve=N,this._reject=p}))}}var a=T(12371),C=T(12421),U=T(12190),X=T(12837),y=T(13986),e=T(14004),H=T(12194),M=T(12856),b=T(12912),l=T(12914),k=T(12231),x=T(12205),I=T(12211);class L{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(N){this._useTextureToStoreBoneMatrices=N,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(N){this._animationPropertiesOverride=N}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(N,p,T){this.name=N,this.id=p,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=a.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new H.c,this.bones=[],this._scene=T||k.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const A=this._scene.getEngine().getCaps();this._canUseTextureForBones=A.textureFloat&&A.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((N=>!N.getParent()))}getTransformMatrices(N){if(this.needInitialSkinMatrix){if(!N)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return N._bonesTransformMatrices||this.prepare(!0),N._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(N){return this.needInitialSkinMatrix&&N._transformMatrixTexture?N._transformMatrixTexture:this._transformMatrixTexture}KN(){return this._scene}toString(N){let p=`Name: ${this.name}, nBones: ${this.bones.length}`;if(p+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,N){p+=", Ranges: {";let N=!0;for(const T in this._ranges)N&&(p+=", ",N=!1),p+=T;p+="}"}return p}getBoneIndexByName(N){for(let p=0,T=this.bones.length;p<T;p++)if(this.bones[p].name===N)return p;return-1}createAnimationRange(N,p,T){if(!this._ranges[N]){this._ranges[N]=new l.b(N,p,T);for(let A=0,a=this.bones.length;A<a;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].createRange(N,p,T)}}deleteAnimationRange(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let T=0,A=this.bones.length;T<A;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].deleteRange(N,p);this._ranges[N]=null}getAnimationRange(N){return this._ranges[N]||null}getAnimationRanges(){const N=[];let p;for(p in this._ranges)N.push(this._ranges[p]);return N}copyAnimationRange(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[p]||!N.getAnimationRange(p))return!1;let A=!0;const a=this._getHighestAnimationFrame()+1,C={},U=N.bones;let X,y;for(y=0,X=U.length;y<X;y++)C[U[y].name]=U[y];this.bones.length!==U.length&&(x.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${U.length}`),A=!1);const e=T&&this.dimensionsAtRest&&N.dimensionsAtRest?this.dimensionsAtRest.divide(N.dimensionsAtRest):null;for(y=0,X=this.bones.length;y<X;y++){const N=this.bones[y].name,U=C[N];U?A=A&&this.bones[y].copyAnimationRange(U,p,a,T,e):(x.d.Warn("copyAnimationRange: not same rig, missing source bone "+N),A=!1)}const H=N.getAnimationRange(p);return H&&(this._ranges[p]=new l.b(p,H.from+a,H.to+a)),A}returnToRest(){for(const N of this.bones)-1!==N._index&&N.returnToRest()}_getHighestAnimationFrame(){let N=0;for(let p=0,T=this.bones.length;p<T;p++)if(this.bones[p].animations[0]){const T=this.bones[p].animations[0].getHighestFrame();N<T&&(N=T)}return N}beginAnimation(N,p,T,A){const a=this.getAnimationRange(N);return a?this._scene.beginAnimation(this,a.from,a.to,p,T,A):null}static MakeAnimationAdditive(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,T=arguments.length>2?arguments[2]:void 0;const A=N.getAnimationRange(T);if(!A)return null;const a=N._scene.getAllAnimatablesByTarget(N);let C=null;for(let X=0;X<a.length;X++){const N=a[X];if(N.fromFrame===(null===A||void 0===A?void 0:A.from)&&N.toFrame===(null===A||void 0===A?void 0:A.to)){C=N;break}}const U=N.getAnimatables();for(let X=0;X<U.length;X++){const N=U[X].animations;if(N)for(let A=0;A<N.length;A++)b.b.MakeAnimationAdditive(N[A],p,T)}return C&&(C.isAdditive=!0),N}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(N){this._meshesWithPoseMatrix.push(N)}_unregisterMeshWithPoseMatrix(N){const p=this._meshesWithPoseMatrix.indexOf(N);p>-1&&this._meshesWithPoseMatrix.splice(p,1)}_computeTransformMatrices(N,p){this.onBeforeComputeObservable.notifyObservers(this);for(let T=0;T<this.bones.length;T++){const A=this.bones[T];A._childUpdateId++;const a=A.getParent();if(a?A.getLocalMatrix().multiplyToRef(a.getFinalMatrix(),A.getFinalMatrix()):p?A.getLocalMatrix().multiplyToRef(p,A.getFinalMatrix()):A.getFinalMatrix().A(A.getLocalMatrix()),-1!==A._index){const p=null===A._index?T:A._index;A.getAbsoluteInverseBindMatrix().multiplyToArray(A.getFinalMatrix(),N,16*p)}}this._identity.copyToArray(N,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const N=this.KN().getRenderId();if(this._currentRenderId===N)return;this._currentRenderId=N}if(this._numBonesWithLinkedTransformNode>0)for(const N of this.bones)if(N._linkedTransformNode){const p=N._linkedTransformNode;N.position=p.position,p.rotationQuaternion?N.rotationQuaternion=p.rotationQuaternion:N.rotation=p.rotation,N.xX=p.xX}if(this.needInitialSkinMatrix)for(const N of this._meshesWithPoseMatrix){const p=N.getPoseMatrix();let T=this._isDirty;if(N._bonesTransformMatrices&&N._bonesTransformMatrices.length===16*(this.bones.length+1)||(N._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),T=!0),T){if(this._synchronizedWithMesh!==N){this._synchronizedWithMesh=N;for(const N of this.bones)if(!N.getParent()){N.getBindMatrix().multiplyToRef(p,a.TmpVectors.Matrix[1]),N._updateAbsoluteBindMatrices(a.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const p=4*(this.bones.length+1);N._transformMatrixTexture&&N._transformMatrixTexture.getSize().width===p||(N._transformMatrixTexture&&N._transformMatrixTexture.dispose(),N._transformMatrixTexture=M.d.CreateRGBATexture(N._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(N._bonesTransformMatrices,p),this.isUsingTextureForMatrices&&N._transformMatrixTexture&&N._transformMatrixTexture.update(N._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=M.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let N=0;N<this.bones.length;N++)this._animatables.push(this.bones[N])}return this._animatables}clone(N,p){const T=new L(N,p||N,this._scene);T.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){const N=this.bones[A];let p=null;const a=N.getParent();if(a){const N=this.bones.indexOf(a);p=T.bones[N]}const C=new e.e(N.name,T,p,N.getBindMatrix().clone(),N.getRestMatrix().clone());C._index=N._index,N._linkedTransformNode&&C.linkTransformNode(N._linkedTransformNode),I.d.DeepCopy(N.animations,C.animations)}if(this._ranges){T._ranges={};for(const N in this._ranges){const p=this._ranges[N];p&&(T._ranges[N]=p.clone())}}return this._isDirty=!0,T.prepare(!0),T}enableBlending(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const p of this.bones)for(const T of p.animations)T.enableBlending=!0,T.blendingSpeed=N}dispose(){if(this._meshesWithPoseMatrix.length=0,this.KN().stopAnimation(this),this.KN().removeSkeleton(this),this._parentContainer){const N=this._parentContainer.skeletons.indexOf(this);N>-1&&this._parentContainer.skeletons.splice(N,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const N={};N.name=this.name,N.id=this.id,this.dimensionsAtRest&&(N.dimensionsAtRest=this.dimensionsAtRest.UX()),N.bones=[],N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){var p;const A=this.bones[T],a=A.getParent(),C={parentBoneIndex:a?this.bones.indexOf(a):-1,index:A.getIndex(),name:A.name,id:A.id,matrix:A.getBindMatrix().UX(),rest:A.getRestMatrix().UX(),linkedTransformNodeId:null===(p=A.getTransformNode())||void 0===p?void 0:p.id};N.bones.push(C),A.length&&(C.length=A.length),A.metadata&&(C.metadata=A.metadata),A.animations&&A.animations.length>0&&(C.animation=A.animations[0].serialize()),N.ranges=[];for(const p in this._ranges){const T=this._ranges[p];if(!T)continue;const A={};A.name=p,A.from=T.from,A.to=T.to,N.ranges.push(A)}}return N}static Parse(N,p){const T=new L(N.name,N.id,p);let A;for(N.dimensionsAtRest&&(T.dimensionsAtRest=a.xp.gp(N.dimensionsAtRest)),T.needInitialSkinMatrix=N.needInitialSkinMatrix,A=0;A<N.bones.length;A++){const p=N.bones[A],C=N.bones[A].index;let U=null;p.parentBoneIndex>-1&&(U=T.bones[p.parentBoneIndex]);const X=p.rest?a.Matrix.gp(p.rest):null,y=new e.e(p.name,T,U,a.Matrix.gp(p.matrix),X,null,C);void 0!==p.id&&null!==p.id&&(y.id=p.id),p.length&&(y.length=p.length),p.metadata&&(y.metadata=p.metadata),p.animation&&y.animations.push(b.b.Parse(p.animation)),void 0!==p.linkedTransformNodeId&&null!==p.linkedTransformNodeId&&(T._hasWaitingData=!0,y._waitingTransformNodeId=p.linkedTransformNodeId)}if(N.ranges)for(A=0;A<N.ranges.length;A++){const p=N.ranges[A];T.createAnimationRange(p.name,p.from,p.to)}return T}computeAbsoluteMatrices(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||N)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(N)}getPoseMatrix(){let N=null;return this._meshesWithPoseMatrix.length>0&&(N=this._meshesWithPoseMatrix[0].getPoseMatrix()),N}sortBones(){const N=[],p=new Array(this.bones.length);for(let T=0;T<this.bones.length;T++)this._sortBones(T,N,p);this.bones=N}_sortBones(N,p,T){if(T[N])return;T[N]=!0;const A=this.bones[N];if(!A)return;void 0===A._index&&(A._index=N);const a=A.getParent();a&&this._sortBones(this.bones.indexOf(a),p,T),p.push(A)}setCurrentPoseAsRest(){for(const N of this.bones)N.setCurrentPoseAsRest()}}var n=T(12705),w=T(12880),g=T(12352),P=T(12794),i=T(12451),K=T(12839),F=T(12806),v=T(12833),W=T(12916),z=T(12471),R=T(13955);class J{set areUpdatesFrozen(N){N?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new z.c(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,N||(N=k.b.LastCreatedScene),this._scene=N,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const N=this._scene.getEngine().getCaps();this._canUseTextureForTargets=N.canUseGLVertexID&&N.textureFloat&&N.maxVertexTextureImageUnits>0&&N.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return J.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?J.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(N){this._numMaxInfluencers!==N&&(this._numMaxInfluencers=N,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(N){this._useTextureToStoreTargets!==N&&(this._useTextureToStoreTargets=N,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var N;return J.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(N=this._scene)&&void 0!==N&&N.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(N){return this._activeTargets.data[N]}getTarget(N){return this._targets[N]}getTargetByName(N){for(const p of this._targets)if(p.name===N)return p;return null}addTarget(N){this._targets.push(N),this._targetInfluenceChangedObservers.push(N.onInfluenceChanged.add((N=>{this.areUpdatesFrozen&&N&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(N)}))),this._targetDataLayoutChangedObservers.push(N._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(N){const p=this._targets.indexOf(N);p>=0&&(this._targets.splice(p,1),N.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(p,1)[0]),N._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(p,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(N)}_bind(N){N.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),N.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),N.setTexture("morphTargets",this._targetStoreTexture),N.setInt("morphTargetCount",this.numInfluencers)}clone(){const N=new J(this._scene);for(const p of this._targets)N.addTarget(p.clone());return N.enablePositionMorphing=this.enablePositionMorphing,N.enableNormalMorphing=this.enableNormalMorphing,N.enableTangentMorphing=this.enableTangentMorphing,N.enableUVMorphing=this.enableUVMorphing,N.enableUV2Morphing=this.enableUV2Morphing,N.enableColorMorphing=this.enableColorMorphing,N}serialize(){const N={};N.id=this.uniqueId,N.targets=[];for(const p of this._targets)N.targets.push(p.serialize());return N}_syncActiveTargets(){let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const p=!!this._targetStoreTexture,T=this.isUsingTextureForTargets;(this._mustSynchronize||p!==T)&&(this._mustSynchronize=!1,this.synchronize());let A=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let a=-1;for(const C of this._targets)if(a++,0!==C.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=J.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(C),this._morphTargetTextureIndices[A]=a,this._tempInfluences[A++]=C.influence}this._morphTargetTextureIndices.length!==A&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,A)),this._influences&&this._influences.length===A||(this._influences=new Float32Array(A));for(let C=0;C<A;C++)this._influences[C]=this._tempInfluences[C];if(N&&this._scene)for(const C of this._scene.meshes)C.morphTargetManager===this&&(T?C._markSubMeshesAsAttributesDirty():C._syncGeometryWithMorphTargetManager())}synchronize(){var N;if(!this._scene||this.areUpdatesFrozen)return;const p=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(N=this._targetStoreTexture)||void 0===N||N.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>p.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const T of this._targets){this._supportsPositions=this._supportsPositions&&T.hasPositions,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs,this._supportsUV2s=this._supportsUV2s&&T.hasUV2s,this._supportsColors=this._supportsColors&&T.hasColors;const N=T.vertexCount;if(0===this._vertexCount)this._vertexCount=N;else if(this._vertexCount!==N)return void x.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${T.name}": ${N}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const N=p.getCaps().maxTextureSize;this._textureWidth>N&&(this._textureHeight=Math.ceil(this._textureWidth/N),this._textureWidth=N);const T=this._targets.length,A=new Float32Array(T*this._textureWidth*this._textureHeight*4);let a=0;for(let p=0;p<T;p++){const N=this._targets[p],T=N.getPositions(),C=N.getNormals(),U=N.getUVs(),X=N.getTangents(),y=N.getUV2s(),e=N.getColors();a=p*this._textureWidth*this._textureHeight*4;for(let p=0;p<this._vertexCount;p++)this._supportsPositions&&T&&(A[a]=T[3*p],A[a+1]=T[3*p+1],A[a+2]=T[3*p+2],a+=4),this._supportsNormals&&C&&(A[a]=C[3*p],A[a+1]=C[3*p+1],A[a+2]=C[3*p+2],a+=4),this._supportsUVs&&U&&(A[a]=U[2*p],A[a+1]=U[2*p+1],a+=4),this._supportsTangents&&X&&(A[a]=X[3*p],A[a+1]=X[3*p+1],A[a+2]=X[3*p+2],a+=4),this._supportsUV2s&&y&&(A[a]=y[2*p],A[a+1]=y[2*p+1],a+=4),this._supportsColors&&e&&(A[a]=e[4*p],A[a+1]=e[4*p+1],A[a+2]=e[4*p+2],A[a+3]=e[4*p+3],a+=4)}this._targetStoreTexture=R.c.CreateRGBATexture(A,this._textureWidth,this._textureHeight,T,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const T of this._scene.meshes)T.morphTargetManager===this&&T._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const N=this._parentContainer.morphTargetManagers.indexOf(this);N>-1&&this._parentContainer.morphTargetManagers.splice(N,1),this._parentContainer=null}for(const N of this._targets)this._scene.stopAnimation(N)}}static Parse(N,p){const T=new J(p);for(const A of N.targets)T.addTarget(W.c.Parse(A,p));return T}}J.EnableTextureStorage=!0,J.MaxActiveMorphTargetsInVertexAttributeMode=8,J.ConstantTargetCountForTextureMode=0;var f=T(14007),G=T(12240),o=T(12717);const Z=new Map,mN=Z;function q(N,p,T){h(N)&&x.d.Warn(`Extension with the name '${N}' already exists`),Z.set(N,{isGLTFExtension:p,factory:T})}function h(N){return Z.delete(N)}var j=T(14021),V=T(12972),r=T(12459);class u{static Get(N,p,T){if(!p||void 0==T||!p[T])throw new Error(`${N}: Failed to find index (${T})`);return p[T]}static TryGet(N,p){return N&&void 0!=p&&N[p]?N[p]:null}static Assign(N){if(N)for(let p=0;p<N.length;p++)N[p].index=p}}function Y(N){if(N.min&&N.max){const p=N.min,T=N.max,A=a.TmpVectors.xp[0].kX(p[0],p[1],p[2]),C=a.TmpVectors.xp[1].kX(T[0],T[1],T[2]);if(N.normalized&&5126!==N.componentType){let p=1;switch(N.componentType){case 5120:p=127;break;case 5121:p=255;break;case 5122:p=32767;break;case 5123:p=65535}const T=1/p;A.scaleInPlace(T),C.scaleInPlace(T)}return new o.d(A,C)}return null}class D{static RegisterExtension(N,p){q(N,!1,p)}static UnregisterExtension(N){return h(N)}get TX(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(N){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=N}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((N=>N.dispose&&N.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(N,p,T,A,a,C){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=p,this._assetContainer=T,this._loadData(A);let C=null;if(N){const p={};if(this._gltf.nodes)for(const N of this._gltf.nodes)N.name&&(p[N.name]=N.index);C=(N instanceof Array?N:[N]).map((N=>{const T=p[N];if(void 0===T)throw new Error(`Failed to find node '${N}'`);return T}))}return await this._loadAsync(a,U,C,(()=>({meshes:this._getMeshes(),Ul:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=N,this._loadData(p),await this._loadAsync(T,a,null,(()=>{}))}async _loadAsync(N,p,T,A){return await Promise.resolve().then((async()=>{this._rootUrl=N,this._uniqueRootUrl=!N.startsWith("file:")&&p?N:`${N}${Date.now()}/`,this._fileName=p,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const a=`${f.n[f.n.LOADING]} => ${f.n[f.n.READY]}`,C=`${f.n[f.n.LOADING]} => ${f.n[f.n.COMPLETE]}`;this._parent._startPerformanceCounter(a),this._parent._startPerformanceCounter(C),this._parent._setState(f.n.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(T)X.push(this.loadSceneAsync("/nodes",{nodes:T,index:-1}));else if(void 0!=this._gltf.Lp||this._gltf.scenes&&this._gltf.scenes[0]){const N=u.Get("/scene",this._gltf.scenes,this._gltf.Lp||0);X.push(this.loadSceneAsync(`/scenes/${N.index}`,N))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let N=0;N<this._gltf.materials.length;++N){const p=this._gltf.materials[N],T="/materials/"+N,A=n.c.TriangleFillMode;X.push(this._loadMaterialAsync(T,p,null,A,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());const y=Promise.all(X).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.jX(!0);for(const N of this._babylonScene.materials){const p=N;void 0!==p.maxSimultaneousLights&&(p.maxSimultaneousLights=Math.max(p.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(f.n.READY),this._skipStartAnimationStep||this._startAnimations(),A()}));return await y.then((N=>(this._parent._endPerformanceCounter(a),U.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(C),this._parent._setState(f.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(N=>{this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()}))})),N)))})).catch((N=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(N),this._parent.onErrorObservable.clear(),this.dispose()),N}))}_loadData(N){if(this._gltf=N.json,this._setupData(),N.bin){const p=this._gltf.buffers;if(p&&p[0]&&!p[0].uri){const T=p[0];(T.byteLength<N.bin.byteLength-3||T.byteLength>N.bin.byteLength)&&x.d.Warn(`Binary buffer length (${T.byteLength}) from JSON does not match chunk length (${N.bin.byteLength})`),this._bin=N.bin}else x.d.Warn("Unexpected BIN chunk")}}_setupData(){if(u.Assign(this._gltf.accessors),u.Assign(this._gltf.animations),u.Assign(this._gltf.buffers),u.Assign(this._gltf.bufferViews),u.Assign(this._gltf.cameras),u.Assign(this._gltf.images),u.Assign(this._gltf.materials),u.Assign(this._gltf.meshes),u.Assign(this._gltf.nodes),u.Assign(this._gltf.samplers),u.Assign(this._gltf.scenes),u.Assign(this._gltf.skins),u.Assign(this._gltf.textures),this._gltf.nodes){const N={};for(const T of this._gltf.nodes)if(T.children)for(const p of T.children)N[p]=T.index;const p=this._createRootNode();for(const T of this._gltf.nodes){const A=N[T.index];T.parent=void 0===A?p:this._gltf.nodes[A]}}}async _loadExtensionsAsync(){const N=[];if(mN.forEach(((p,T)=>{var A;!1===(null===(A=this.parent.extensionOptions[T])||void 0===A?void 0:A.enabled)?p.isGLTFExtension&&this.isExtensionUsed(T)&&x.d.Warn(`Extension ${T} is used but has been explicitly disabled.`):p.isGLTFExtension&&!this.isExtensionUsed(T)||N.push((async()=>{const N=await p.factory(this);return N.name!==T&&x.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${N.name} !== ${T}`),this._parent.onExtensionLoadedObservable.notifyObservers(N),N})())})),this._extensions.push(...await Promise.all(N)),this._extensions.sort(((N,p)=>(N.order||Number.MAX_VALUE)-(p.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const T of this._gltf.extensionsRequired){if(!this._extensions.some((N=>N.name===T&&N.enabled))){var p;if(!1===(null===(p=this.parent.extensionOptions[T])||void 0===p?void 0:p.enabled))throw new Error(`Required extension ${T} is disabled`);throw new Error(`Required extension ${T} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new v.d("__root__",this._babylonScene);this._rootBabylonMesh=N,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.jX(!1);const p={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.k.AUTO:this._babylonScene.useRightHandedSystem||(p.rotation=[0,1,0,0],p.scale=[1,1,-1],D._LoadTransform(p,this._rootBabylonMesh));break;case f.k.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(N),p}loadSceneAsync(N,p){const T=this._extensionsLoadSceneAsync(N,p);if(T)return T;const A=new Array;if(this.logOpen(`${N} ${p.name||""}`),p.nodes)for(const a of p.nodes){const p=u.Get(`${N}/nodes/${a}`,this._gltf.nodes,a);A.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(N=>{N.parent=this._rootBabylonMesh})))}for(const a of this._postSceneLoadActions)a();return A.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(A).then((()=>{}))}_forEachPrimitive(N,p){if(N._primitiveBabylonMeshes)for(const T of N._primitiveBabylonMeshes)p(T)}_getGeometries(){const N=[],p=this._gltf.nodes;if(p)for(const T of p)this._forEachPrimitive(T,(p=>{const T=p.MX;T&&-1===N.indexOf(T)&&N.push(T)}));return N}_getMeshes(){const N=[];this._rootBabylonMesh instanceof F.c&&N.push(this._rootBabylonMesh);const p=this._gltf.nodes;if(p)for(const T of p)this._forEachPrimitive(T,(p=>{N.push(p)}));return N}_getTransformNodes(){const N=[],p=this._gltf.nodes;if(p)for(const T of p)T._babylonTransformNode&&"ny"===T._babylonTransformNode.getClassName()&&N.push(T._babylonTransformNode),T._babylonTransformNodeForSkin&&N.push(T._babylonTransformNodeForSkin);return N}_getSkeletons(){const N=[],p=this._gltf.skins;if(p)for(const T of p)T._data&&N.push(T._data.babylonSkeleton);return N}_getAnimationGroups(){const N=[],p=this._gltf.animations;if(p)for(const T of p)T._babylonAnimationGroup&&N.push(T._babylonAnimationGroup);return N}_startAnimations(){switch(this._parent.animationStartMode){case f.h.NONE:break;case f.h.FIRST:{const N=this._getAnimationGroups();0!==N.length&&N[0].start(!0);break}case f.h.ALL:{const N=this._getAnimationGroups();for(const p of N)p.start(!0);break}default:return void x.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadNodeAsync(N,p,T);if(A)return A;if(p._babylonTransformNode)throw new Error(`${N}: Invalid recursive node hierarchy`);const a=new Array;this.logOpen(`${N} ${p.name||""}`);const C=A=>{if(D.AddPointerMetadata(A,N),D._LoadTransform(p,A),void 0!=p.camera){const T=u.Get(`${N}/camera`,this._gltf.cameras,p.camera);a.push(this.loadCameraAsync(`/cameras/${T.index}`,T,(N=>{N.parent=A,this._babylonScene.useRightHandedSystem||(A.xX.x=-1)})))}if(p.children)for(const T of p.children){const p=u.Get(`${N}/children/${T}`,this._gltf.nodes,T);a.push(this.loadNodeAsync(`/nodes/${p.index}`,p,(N=>{N.parent=A})))}T(A)},U=void 0!=p.mesh,X=this._parent.loadSkins&&void 0!=p.skin;if(!U||X){const N=p.name||`node${p.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new P.b(N,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==p.mesh?p._babylonTransformNode=T:p._babylonTransformNodeForSkin=T,C(T)}if(U)if(X){const T=u.Get(`${N}/mesh`,this._gltf.meshes,p.mesh);a.push(this._loadMeshAsync(`/meshes/${T.index}`,p,T,(T=>{const A=p._babylonTransformNodeForSkin;T.metadata=(0,V.e)(A.metadata,T.metadata||{});const C=u.Get(`${N}/skin`,this._gltf.skins,p.skin);a.push(this._loadSkinAsync(`/skins/${C.index}`,p,C,(N=>{this._forEachPrimitive(p,(p=>{p.skeleton=N})),this._postSceneLoadActions.push((()=>{if(void 0!=C.skeleton){const N=u.Get(`/skins/${C.index}/skeleton`,this._gltf.nodes,C.skeleton).parent;p.index===N.index?T.parent=A.parent:T.parent=N._babylonTransformNode}else T.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:A,skinnedNode:T})}))})))})))}else{const T=u.Get(`${N}/mesh`,this._gltf.meshes,p.mesh);a.push(this._loadMeshAsync(`/meshes/${T.index}`,p,T,C))}return this.logClose(),Promise.all(a).then((()=>(this._forEachPrimitive(p,(N=>{const p=N;!p.isAnInstance&&p.MX&&p.MX.useBoundingInfoFromGeometry?N.oN():N.refreshBoundingInfo(!0,!0)})),p._babylonTransformNode)))}_loadMeshAsync(N,p,T,A){const a=T.primitives;if(!a||!a.length)throw new Error(`${N}: Primitives are missing`);void 0==a[0].index&&u.Assign(a);const C=new Array;this.logOpen(`${N} ${T.name||""}`);const U=p.name||`node${p.index}`;if(1===a.length){const A=T.primitives[0];C.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${A.index}`,U,p,T,A,(N=>{p._babylonTransformNode=N,p._primitiveBabylonMeshes=[N]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,p._babylonTransformNode=new P.b(U,this._babylonScene),p._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._primitiveBabylonMeshes=[];for(const A of a)C.push(this._loadMeshPrimitiveAsync(`${N}/primitives/${A.index}`,`${U}_primitive${A.index}`,p,T,A,(N=>{N.parent=p._babylonTransformNode,p._primitiveBabylonMeshes.push(N)})))}return A(p._babylonTransformNode),this.logClose(),Promise.all(C).then((()=>p._babylonTransformNode))}_loadMeshPrimitiveAsync(N,p,T,A,a,C){const U=this._extensionsLoadMeshPrimitiveAsync(N,p,T,A,a,C);if(U)return U;this.logOpen(`${N}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==T.skin&&!A.primitives[0].targets;let y,e;if(X&&a._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,y=a._instanceData.babylonSourceMesh.createInstance(p),y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e=a._instanceData.promise;else{const C=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new v.d(p,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.sideOrientation=this._babylonScene.useRightHandedSystem?n.c.CounterClockWiseSideOrientation:n.c.ClockWiseSideOrientation,this._createMorphTargets(N,T,A,a,U),C.push(this._loadVertexDataAsync(N,a,U).then((async p=>await this._loadMorphTargetsAsync(N,a,U,p).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,p.fN(U),p._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const H=D._GetDrawMode(N,a.mode);if(void 0==a.material){let N=this._defaultBabylonMaterialData[H];N||(N=this._createDefaultMaterial("__GLTFLoader._default",H),this._parent.onMaterialLoadedObservable.notifyObservers(N),this._defaultBabylonMaterialData[H]=N),U.material=N}else if(!this.parent.skipMaterials){const p=u.Get(`${N}/material`,this._gltf.materials,a.material);C.push(this._loadMaterialAsync(`/materials/${p.index}`,p,U,H,(N=>{U.material=N})))}e=Promise.all(C),X&&(a._instanceData={babylonSourceMesh:U,promise:e}),y=U}return D.AddPointerMetadata(y,N),this._parent.onMeshLoadedObservable.notifyObservers(y),C(y),this.logClose(),e.then((()=>y))}_loadVertexDataAsync(N,p,T){const A=this._extensionsLoadVertexDataAsync(N,p,T);if(A)return A;const a=p.attributes;if(!a)throw new Error(`${N}: Attributes are missing`);const C=new Array,U=new K.e(T.name,this._babylonScene);if(void 0==p.indices)T.isUnIndexed=!0;else{const T=u.Get(`${N}/indices`,this._gltf.accessors,p.indices);C.push(this._loadIndicesAccessorAsync(`/accessors/${T.index}`,T).then((N=>{U.setIndices(N)})))}const X=(p,A,X)=>{if(void 0==a[p])return;T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(A)&&T._delayInfo.push(A);const y=u.Get(`${N}/attributes/${p}`,this._gltf.accessors,a[p]);C.push(this._loadVertexAccessorAsync(`/accessors/${y.index}`,y,A).then((N=>{if(N.getKind()===i.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!T.skeleton){const N=Y(y);N&&(U._boundingInfo=N,U.useBoundingInfoFromGeometry=!0)}U.setVerticesBuffer(N,y.count)}))),A==i.f.MatricesIndicesExtraKind&&(T.numBoneInfluencers=8),X&&X(y)};return X("POSITION",i.f.PositionKind),X("NORMAL",i.f.NormalKind),X("TANGENT",i.f.TangentKind),X("TEXCOORD_0",i.f.UVKind),X("TEXCOORD_1",i.f.UV2Kind),X("TEXCOORD_2",i.f.UV3Kind),X("TEXCOORD_3",i.f.UV4Kind),X("TEXCOORD_4",i.f.UV5Kind),X("TEXCOORD_5",i.f.UV6Kind),X("JOINTS_0",i.f.MatricesIndicesKind),X("WEIGHTS_0",i.f.MatricesWeightsKind),X("JOINTS_1",i.f.MatricesIndicesExtraKind),X("WEIGHTS_1",i.f.MatricesWeightsExtraKind),X("COLOR_0",i.f.ColorKind,(N=>{"VEC4"===N.type&&(T.hasVertexAlpha=!0)})),Promise.all(C).then((()=>U))}_createMorphTargets(N,p,T,A,a){if(!A.targets||!this._parent.loadMorphTargets)return;if(void 0==p._numMorphTargets)p._numMorphTargets=A.targets.length;else if(A.targets.length!==p._numMorphTargets)throw new Error(`${N}: Primitives do not have the same number of targets`);const C=T.extras?T.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,a.morphTargetManager=new J(this._babylonScene),a.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.morphTargetManager.areUpdatesFrozen=!0;for(let U=0;U<A.targets.length;U++){const N=p.weights?p.weights[U]:T.weights?T.weights[U]:0,A=C?C[U]:`morphTarget${U}`;a.morphTargetManager.addTarget(new W.c(A,N,a.KN()))}}_loadMorphTargetsAsync(N,p,T,A){if(!p.targets||!this._parent.loadMorphTargets)return Promise.resolve();const a=new Array,C=T.morphTargetManager;for(let U=0;U<C.numTargets;U++){const T=C.getTarget(U);a.push(this._loadMorphTargetVertexDataAsync(`${N}/targets/${U}`,A,p.targets[U],T))}return Promise.all(a).then((()=>{C.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(N,p,T,A){const a=new Array,C=(A,C,U)=>{if(void 0==T[A])return;const X=p.getVertexBuffer(C);if(!X)return;const y=u.Get(`${N}/${A}`,this._gltf.accessors,T[A]);a.push(this._loadFloatAccessorAsync(`/accessors/${y.index}`,y).then((N=>{U(X,N)})))};return C("POSITION",i.f.PositionKind,((N,p)=>{const T=new Float32Array(p.length);N.forEach(p.length,((N,A)=>{T[A]=p[A]+N})),A.setPositions(T)})),C("NORMAL",i.f.NormalKind,((N,p)=>{const T=new Float32Array(p.length);N.forEach(T.length,((N,A)=>{T[A]=p[A]+N})),A.setNormals(T)})),C("TANGENT",i.f.TangentKind,((N,p)=>{const T=new Float32Array(p.length/3*4);let a=0;N.forEach(p.length/3*4,((N,A)=>{(A+1)%4!==0&&(T[a]=p[a]+N,a++)})),A.setTangents(T)})),C("TEXCOORD_0",i.f.UVKind,((N,p)=>{const T=new Float32Array(p.length);N.forEach(p.length,((N,A)=>{T[A]=p[A]+N})),A.setUVs(T)})),C("TEXCOORD_1",i.f.UV2Kind,((N,p)=>{const T=new Float32Array(p.length);N.forEach(p.length,((N,A)=>{T[A]=p[A]+N})),A.setUV2s(T)})),C("COLOR_0",i.f.ColorKind,((p,T)=>{let a=null;const C=p.getSize();if(3===C){a=new Float32Array(T.length/3*4),p.forEach(T.length,((N,p)=>{const A=Math.floor(p/3),C=p%3;a[4*A+C]=T[3*A+C]+N}));for(let N=0;N<T.length/3;++N)a[4*N+3]=1}else{if(4!==C)throw new Error(`${N}: Invalid number of components (${C}) for COLOR_0 attribute`);a=new Float32Array(T.length),p.forEach(T.length,((N,p)=>{a[p]=T[p]+N}))}A.setColors(a)})),await Promise.all(a).then((()=>{}))}static _LoadTransform(N,p){if(void 0!=N.skin)return;let T=a.xp.Zero(),A=a.Quaternion.Identity(),C=a.xp.One();if(N.matrix){a.Matrix.gp(N.matrix).decompose(C,A,T)}else N.translation&&(T=a.xp.gp(N.translation)),N.rotation&&(A=a.Quaternion.gp(N.rotation)),N.scale&&(C=a.xp.gp(N.scale));p.position=T,p.rotationQuaternion=A,p.xX=C}_loadSkinAsync(N,p,T,A){if(!this._parent.loadSkins)return Promise.resolve();const a=this._extensionsLoadSkinAsync(N,p,T);if(a)return a;if(T._data)return A(T._data.babylonSkeleton),T._data.promise;const C=`skeleton${T.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new L(T.name||C,C,this._babylonScene);U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(N,T,U);const X=this._loadSkinInverseBindMatricesDataAsync(N,T).then((N=>{this._updateBoneMatrices(U,N)}));return T._data={babylonSkeleton:U,promise:X},A(U),X}_loadBones(N,p,T){if(void 0==p.skeleton||this._parent.alwaysComputeSkeletonRootNode){const T=this._findSkeletonRootNode(`${N}/joints`,p.joints);if(T)if(void 0===p.skeleton)p.skeleton=T.index;else{const A=(N,p)=>{for(;p.parent;p=p.parent)if(p.parent===N)return!0;return!1},a=u.Get(`${N}/skeleton`,this._gltf.nodes,p.skeleton);a===T||A(a,T)||(x.d.Warn(`${N}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),p.skeleton=T.index)}else x.d.Warn(`${N}: Failed to find common root`)}const A={};for(const a of p.joints){const C=u.Get(`${N}/joints/${a}`,this._gltf.nodes,a);this._loadBone(C,p,T,A)}}_findSkeletonRootNode(N,p){if(0===p.length)return null;const T={};for(const a of p){const p=[];let A=u.Get(`${N}/${a}`,this._gltf.nodes,a);for(;-1!==A.index;)p.unshift(A),A=A.parent;T[a]=p}let A=null;for(let a=0;;++a){let N=T[p[0]];if(a>=N.length)return A;const C=N[a];for(let U=1;U<p.length;++U)if(N=T[p[U]],a>=N.length||C!==N[a])return A;A=C}}_loadBone(N,p,T,A){N._isJoint=!0;let a=A[N.index];if(a)return a;let C=null;N.index!==p.skeleton&&(N.parent&&-1!==N.parent.index?C=this._loadBone(N.parent,p,T,A):void 0!==p.skeleton&&x.d.Warn(`/skins/${p.index}/skeleton: Skeleton node is not a common root`));const U=p.joints.indexOf(N.index);return a=new e.e(N.name||`joint${N.index}`,T,C,this._getNodeMatrix(N),null,null,U),A[N.index]=a,this._postSceneLoadActions.push((()=>{a.linkTransformNode(N._babylonTransformNode)})),a}_loadSkinInverseBindMatricesDataAsync(N,p){if(void 0==p.inverseBindMatrices)return Promise.resolve(null);const T=u.Get(`${N}/inverseBindMatrices`,this._gltf.accessors,p.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${T.index}`,T)}_updateBoneMatrices(N,p){for(const T of N.bones){const N=a.Matrix.Identity(),A=T._index;p&&-1!==A&&(a.Matrix.FromArrayToRef(p,16*A,N),N.invertToRef(N));const C=T.getParent();C&&N.multiplyToRef(C.getAbsoluteInverseBindMatrix(),N),T.eX(N,!1,!1),T._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(N){return N.matrix?a.Matrix.gp(N.matrix):a.Matrix.Compose(N.scale?a.xp.gp(N.scale):a.xp.One(),N.rotation?a.Quaternion.gp(N.rotation):a.Quaternion.Identity(),N.translation?a.xp.gp(N.translation):a.xp.Zero())}loadCameraAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadCameraAsync(N,p,T);if(A)return A;const C=new Array;this.logOpen(`${N} ${p.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const U=new y.e(p.name||`camera${p.index}`,a.xp.Zero(),this._babylonScene,!1);switch(U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonCamera=U,U.setTarget(new a.xp(0,0,-1)),p.type){case"perspective":{const T=p.perspective;if(!T)throw new Error(`${N}: Camera perspective properties are missing`);U.fov=T.yfov,U.yX=T.znear,U.maxZ=T.zfar||0;break}case"orthographic":if(!p.orthographic)throw new Error(`${N}: Camera orthographic properties are missing`);U.mode=X.d.ORTHOGRAPHIC_CAMERA,U.orthoLeft=-p.orthographic.xmag,U.orthoRight=p.orthographic.xmag,U.orthoBottom=-p.orthographic.ymag,U.orthoTop=p.orthographic.ymag,U.yX=p.orthographic.znear,U.maxZ=p.orthographic.zfar;break;default:throw new Error(`${N}: Invalid camera type (${p.type})`)}return D.AddPointerMetadata(U,N),this._parent.onCameraLoadedObservable.notifyObservers(U),T(U),this.logClose(),Promise.all(C).then((()=>U))}_loadAnimationsAsync(){const N=this._gltf.animations;if(!N)return Promise.resolve();const p=new Array;for(let T=0;T<N.length;T++){const A=N[T];p.push(this.loadAnimationAsync(`/animations/${A.index}`,A).then((N=>{0===N.targetedAnimations.length&&N.dispose()})))}return Promise.all(p).then((()=>{}))}loadAnimationAsync(N,p){const A=this._extensionsLoadAnimationAsync(N,p);return A||T.e(78).then(T.bind(T,15484)).then((T=>{let{AnimationGroup:A}=T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a=new A(p.name||`animation${p.index}`,this._babylonScene);a._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,p._babylonAnimationGroup=a;const C=new Array;u.Assign(p.channels),u.Assign(p.samplers);for(const U of p.channels)C.push(this._loadAnimationChannelAsync(`${N}/channels/${U.index}`,N,p,U,((N,p)=>{N.animations=N.animations||[],N.animations.push(p),a.addTargetedAnimation(p,N)})));return Promise.all(C).then((()=>(a.normalize(0),a)))}))}async _loadAnimationChannelAsync(N,p,A,a,C){const U=this._extensionsLoadAnimationChannelAsync(N,p,A,a,C);if(U)return await U;if(void 0==a.target.node)return await Promise.resolve();const X=u.Get(`${N}/target/node`,this._gltf.nodes,a.target.node),y=a.target.path,e="weights"===y;if(e&&!X._numMorphTargets||!e&&!X._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!e&&!X._isJoint)return await Promise.resolve();let H;switch(await Promise.resolve().then(T.bind(T,14034)),y){case"translation":var M;H=null===(M=(0,j.g)("/nodes/{}/translation"))||void 0===M?void 0:M.interpolation;break;case"rotation":var b;H=null===(b=(0,j.g)("/nodes/{}/rotation"))||void 0===b?void 0:b.interpolation;break;case"scale":var l;H=null===(l=(0,j.g)("/nodes/{}/scale"))||void 0===l?void 0:l.interpolation;break;case"weights":var k;H=null===(k=(0,j.g)("/nodes/{}/weights"))||void 0===k?void 0:k.interpolation;break;default:throw new Error(`${N}/target/path: Invalid value (${a.target.path})`)}if(!H)throw new Error(`${N}/target/path: Could not find interpolation properties for target path (${a.target.path})`);const x={object:X,info:H};return await this._loadAnimationChannelFromTargetInfoAsync(N,p,A,a,x,C)}_loadAnimationChannelFromTargetInfoAsync(N,p,T,A,a,C){const U=this.parent.targetFps,X=1/U,y=u.Get(`${N}/sampler`,T.samplers,A.sampler);return this._loadAnimationSamplerAsync(`${p}/samplers/${A.sampler}`,y).then((N=>{let p=0;const y=a.object,e=a.info;for(const a of e){const e=a.getStride(y),H=N.input,M=N.output,b=new Array(H.length);let l=0;switch(N.interpolation){case"STEP":for(let N=0;N<H.length;N++){const p=a.getValue(y,M,l,1);l+=e,b[N]={frame:H[N]*U,value:p,interpolation:1}}break;case"CUBICSPLINE":for(let N=0;N<H.length;N++){const p=a.getValue(y,M,l,X);l+=e;const T=a.getValue(y,M,l,1);l+=e;const A=a.getValue(y,M,l,X);l+=e,b[N]={frame:H[N]*U,inTangent:p,value:T,outTangent:A}}break;case"LINEAR":for(let N=0;N<H.length;N++){const p=a.getValue(y,M,l,1);l+=e,b[N]={frame:H[N]*U,value:p}}}if(l>0){const N=`${T.name||`animation${T.index}`}_channel${A.index}_${p}`,X=a.buildAnimations(y,N,U,b);for(const T of X)p++,C(T.babylonAnimatable,T.babylonAnimation)}}}))}_loadAnimationSamplerAsync(N,p){if(p._data)return p._data;const T=p.interpolation||"LINEAR";switch(T){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${N}/interpolation: Invalid value (${p.interpolation})`)}const A=u.Get(`${N}/input`,this._gltf.accessors,p.input),a=u.Get(`${N}/output`,this._gltf.accessors,p.output);return p._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${A.index}`,A),this._loadFloatAccessorAsync(`/accessors/${a.index}`,a)]).then((N=>{let[p,A]=N;return{input:p,interpolation:T,output:A}})),p._data}loadBufferAsync(N,p,T,A){const a=this._extensionsLoadBufferAsync(N,p,T,A);if(a)return a;if(!p._data)if(p.uri)p._data=this.loadUriAsync(`${N}/uri`,p,p.uri);else{if(!this._bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);p._data=this._bin.readAsync(0,p.byteLength)}return p._data.then((p=>{try{return new Uint8Array(p.buffer,p.byteOffset+T,A)}catch(a){throw new Error(`${N}: ${a.message}`)}}))}loadBufferViewAsync(N,p){const T=this._extensionsLoadBufferViewAsync(N,p);if(T)return T;if(p._data)return p._data;const A=u.Get(`${N}/buffer`,this._gltf.buffers,p.buffer);return p._data=this.loadBufferAsync(`/buffers/${A.index}`,A,p.byteOffset||0,p.byteLength),p._data}_loadAccessorAsync(N,p,T){if(p._data)return p._data;const A=D._GetNumComponents(N,p.type),a=A*i.f.GetTypeByteLength(p.componentType),C=A*p.count;if(void 0==p.bufferView)p._data=Promise.resolve(new T(C));else{const U=u.Get(`${N}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((X=>{if(5126!==p.componentType||p.normalized||U.byteStride&&U.byteStride!==a){const N=new T(C);return i.f.ForEach(X,p.byteOffset||0,U.byteStride||a,A,p.componentType,N.length,p.normalized||!1,((p,T)=>{N[T]=p})),N}return D._GetTypedArray(N,p.componentType,X,p.byteOffset,C)}))}if(p.sparse){const C=p.sparse;p._data=p._data.then((U=>{const X=U,y=u.Get(`${N}/sparse/indices/bufferView`,this._gltf.bufferViews,C.indices.bufferView),e=u.Get(`${N}/sparse/values/bufferView`,this._gltf.bufferViews,C.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${y.index}`,y),this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)]).then((U=>{let[y,e]=U;const H=D._GetTypedArray(`${N}/sparse/indices`,C.indices.componentType,y,C.indices.byteOffset,C.count),M=A*C.count;let b;if(5126!==p.componentType||p.normalized){const U=D._GetTypedArray(`${N}/sparse/values`,p.componentType,e,C.values.byteOffset,M);b=new T(M),i.f.ForEach(U,0,a,A,p.componentType,b.length,p.normalized||!1,((N,p)=>{b[p]=N}))}else b=D._GetTypedArray(`${N}/sparse/values`,p.componentType,e,C.values.byteOffset,M);let l=0;for(let N=0;N<H.length;N++){let p=H[N]*A;for(let N=0;N<A;N++)X[p++]=b[l++]}return X}))}))}return p._data}_loadFloatAccessorAsync(N,p){return this._loadAccessorAsync(N,p,Float32Array)}_loadIndicesAccessorAsync(N,p){if("SCALAR"!==p.type)throw new Error(`${N}/type: Invalid value ${p.type}`);if(5121!==p.componentType&&5123!==p.componentType&&5125!==p.componentType)throw new Error(`${N}/componentType: Invalid value ${p.componentType}`);if(p._data)return p._data;if(p.sparse){const T=D._GetTypedArrayConstructor(`${N}/componentType`,p.componentType);p._data=this._loadAccessorAsync(N,p,T)}else{const T=u.Get(`${N}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((T=>D._GetTypedArray(N,p.componentType,T,p.byteOffset,p.count)))}return p._data}_loadVertexBufferViewAsync(N){if(N._babylonBuffer)return N._babylonBuffer;const p=this._babylonScene.getEngine();return N._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>new i.e(p,N,!1))),N._babylonBuffer}_loadVertexAccessorAsync(N,p,T){var A;if(null!==(A=p._babylonVertexBuffer)&&void 0!==A&&A[T])return p._babylonVertexBuffer[T];p._babylonVertexBuffer||(p._babylonVertexBuffer={});const a=this._babylonScene.getEngine();if(p.sparse||void 0==p.bufferView)p._babylonVertexBuffer[T]=this._loadFloatAccessorAsync(N,p).then((N=>new i.f(a,N,T,!1)));else{const A=u.Get(`${N}/bufferView`,this._gltf.bufferViews,p.bufferView);p._babylonVertexBuffer[T]=this._loadVertexBufferViewAsync(A).then((C=>{const U=D._GetNumComponents(N,p.type);return new i.f(a,C,T,!1,void 0,A.byteStride,void 0,p.byteOffset,U,p.componentType,p.normalized,!0,void 0,!0)}))}return p._babylonVertexBuffer[T]}_loadMaterialMetallicRoughnessPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return p&&(p.baseColorFactor?(T.albedoColor=C.wp.gp(p.baseColorFactor),T.alpha=p.baseColorFactor[3]):T.albedoColor=C.wp.White(),T.metallic=void 0==p.metallicFactor?1:p.metallicFactor,T.roughness=void 0==p.roughnessFactor?1:p.roughnessFactor,p.baseColorTexture&&A.push(this.loadTextureInfoAsync(`${N}/baseColorTexture`,p.baseColorTexture,(N=>{N.name=`${T.name} (Base Color)`,T.albedoTexture=N}))),p.metallicRoughnessTexture&&(p.metallicRoughnessTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/metallicRoughnessTexture`,p.metallicRoughnessTexture,(N=>{N.name=`${T.name} (Metallic Roughness)`,T.metallicTexture=N}))),T.useMetallnessFromMetallicTextureBlue=!0,T.useRoughnessFromMetallicTextureGreen=!0,T.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(A).then((()=>{}))}_loadMaterialAsync(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const C=this._extensionsLoadMaterialAsync(N,p,T,A,a);if(C)return C;p._data=p._data||{};let U=p._data[A];if(!U){this.logOpen(`${N} ${p.name||""}`);const T=this.createMaterial(N,p,A);U={babylonMaterial:T,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(N,p,T)},p._data[A]=U,D.AddPointerMetadata(T,N),this._parent.onMaterialLoadedObservable.notifyObservers(T),this.logClose()}return T&&(U.babylonMeshes.push(T),T.SU.addOnce((()=>{const N=U.babylonMeshes.indexOf(T);-1!==N&&U.babylonMeshes.splice(N,1)}))),a(U.babylonMaterial),U.promise.then((()=>U.babylonMaterial))}_createDefaultMaterial(N,p){this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new w.b(N,this._babylonScene);return T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.fillMode=p,T.enableSpecularAntiAliasing=!0,T.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,T.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,T.transparencyMode=w.b.PBRMATERIAL_OPAQUE,T.metallic=1,T.roughness=1,T}createMaterial(N,p,T){const A=this._extensionsCreateMaterial(N,p,T);if(A)return A;const a=p.name||`material${p.index}`;return this._createDefaultMaterial(a,T)}loadMaterialPropertiesAsync(N,p,T){const A=this._extensionsLoadMaterialPropertiesAsync(N,p,T);if(A)return A;const a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(N,p,T)),p.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${N}/pbrMetallicRoughness`,p.pbrMetallicRoughness,T)),this.loadMaterialAlphaProperties(N,p,T),Promise.all(a).then((()=>{}))}loadMaterialBasePropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.emissiveColor=p.emissiveFactor?C.wp.gp(p.emissiveFactor):new C.wp(0,0,0),p.doubleSided&&(T.lX=!1,T.twoSidedLighting=!0),p.normalTexture&&(p.normalTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/normalTexture`,p.normalTexture,(N=>{N.name=`${T.name} (Normal)`,T.bumpTexture=N}))),T.invertNormalMapX=!this._babylonScene.useRightHandedSystem,T.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=p.normalTexture.scale&&T.bumpTexture&&(T.bumpTexture.level=p.normalTexture.scale),T.forceIrradianceInFragment=!0),p.occlusionTexture&&(p.occlusionTexture.nonColorData=!0,A.push(this.loadTextureInfoAsync(`${N}/occlusionTexture`,p.occlusionTexture,(N=>{N.name=`${T.name} (Occlusion)`,T.ambientTexture=N}))),T.useAmbientInGrayScale=!0,void 0!=p.occlusionTexture.strength&&(T.ambientTextureStrength=p.occlusionTexture.strength)),p.emissiveTexture&&A.push(this.loadTextureInfoAsync(`${N}/emissiveTexture`,p.emissiveTexture,(N=>{N.name=`${T.name} (Emissive)`,T.emissiveTexture=N}))),Promise.all(A).then((()=>{}))}loadMaterialAlphaProperties(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);switch(p.alphaMode||"OPAQUE"){case"OPAQUE":T.transparencyMode=w.b.PBRMATERIAL_OPAQUE,T.alpha=1;break;case"MASK":T.transparencyMode=w.b.PBRMATERIAL_ALPHATEST,T.alphaCutOff=void 0==p.alphaCutoff?.5:p.alphaCutoff,T.albedoTexture&&(T.albedoTexture.XX=!0);break;case"BLEND":T.transparencyMode=w.b.PBRMATERIAL_ALPHABLEND,T.albedoTexture&&(T.albedoTexture.XX=!0,T.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${N}/alphaMode: Invalid value (${p.alphaMode})`)}}loadTextureInfoAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureInfoAsync(N,p,T);if(A)return A;if(this.logOpen(`${N}`),p.texCoord>=6)throw new Error(`${N}/texCoord: Invalid value (${p.texCoord})`);const a=u.Get(`${N}/index`,this._gltf.textures,p.index);a._textureInfo=p;const C=this._loadTextureAsync(`/textures/${p.index}`,a,(A=>{A.coordinatesIndex=p.texCoord||0,D.AddPointerMetadata(A,N),this._parent.onTextureLoadedObservable.notifyObservers(A),T(A)}));return this.logClose(),C}_loadTextureAsync(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const A=this._extensionsLoadTextureAsync(N,p,T);if(A)return A;this.logOpen(`${N} ${p.name||""}`);const a=void 0==p.sampler?D.DefaultSampler:u.Get(`${N}/sampler`,this._gltf.samplers,p.sampler),C=u.Get(`${N}/source`,this._gltf.images,p.source),U=this._createTextureAsync(N,a,C,T,void 0,!p._textureInfo.nonColorData);return this.logClose(),U}_createTextureAsync(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},C=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${p.index}`,p),y=new Array,e=new A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,B:()=>{this._disposed||e.resolve()},onError:(p,T)=>{this._disposed||e.reject(new Error(`${N}: ${T&&T.message?T.message:p||"Failed to load texture"}`))},mimeType:T.mimeType??(0,G.h)(T.uri??""),loaderOptions:C,useSRGBBuffer:!!U&&this._parent.useSRGBBuffers},M=new g.c(null,this._babylonScene,H);return M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.push(e.promise),y.push(this.loadImageAsync(`/images/${T.index}`,T).then((N=>{const p=T.uri||`${this._fileName}#image${T.index}`,A=`data:${this._uniqueRootUrl}${p}`;M.updateURL(A,N);const a=M.getInternalTexture();a&&(a.label=T.name)}))),M.wrapU=X.wrapU,M.wrapV=X.wrapV,a(M),this._parent.useGltfTextureNames&&(M.name=T.name||T.uri||`image${T.index}`),Promise.all(y).then((()=>M))}_loadSampler(N,p){return p._data||(p._data={noMipMaps:9728===p.minFilter||9729===p.minFilter,samplingMode:D._GetTextureSamplingMode(N,p),wrapU:D._GetTextureWrapMode(`${N}/wrapS`,p.wrapS),wrapV:D._GetTextureWrapMode(`${N}/wrapT`,p.wrapT)}),p._data}loadImageAsync(N,p){if(!p._data){if(this.logOpen(`${N} ${p.name||""}`),p.uri)p._data=this.loadUriAsync(`${N}/uri`,p,p.uri);else{const T=u.Get(`${N}/bufferView`,this._gltf.bufferViews,p.bufferView);p._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}this.logClose()}return p._data}loadUriAsync(N,p,T){const A=this._extensionsLoadUriAsync(N,p,T);if(A)return A;if(!D._ValidateUri(T))throw new Error(`${N}: '${T}' is invalid`);if((0,G.i)(T)){const p=new Uint8Array((0,G.e)(T));return this.log(`${N}: Decoded ${T.substring(0,64)}... (${p.length} bytes)`),Promise.resolve(p)}return this.log(`${N}: Loading ${T}`),this._parent.preprocessUrlAsync(this._rootUrl+T).then((p=>new Promise(((A,a)=>{this._parent._loadFile(this._babylonScene,p,(p=>{this._disposed||(this.log(`${N}: Loaded ${T} (${p.byteLength} bytes)`),A(new Uint8Array(p)))}),!0,(p=>{a(new G.k(`${N}: Failed to load '${T}'${p?": "+p.status+" "+p.statusText:""}`,p))}))}))))}static AddPointerMetadata(N,p){N.metadata=N.metadata||{};const T=N._internalMetadata=N._internalMetadata||{},A=T.TX=T.TX||{};(A.pointers=A.pointers||[]).push(p)}static _GetTextureWrapMode(N,p){switch(p=void 0==p?10497:p){case 33071:return g.c.CLAMP_ADDRESSMODE;case 33648:return g.c.MIRROR_ADDRESSMODE;case 10497:return g.c.WRAP_ADDRESSMODE;default:return x.d.Warn(`${N}: Invalid value (${p})`),g.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(N,p){const T=void 0==p.magFilter?9729:p.magFilter,A=void 0==p.minFilter?9987:p.minFilter;if(9729===T)switch(A){case 9728:return g.c.LINEAR_NEAREST;case 9729:return g.c.LINEAR_LINEAR;case 9984:return g.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return g.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return g.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return g.c.LINEAR_LINEAR_MIPLINEAR;default:return x.d.Warn(`${N}/minFilter: Invalid value (${A})`),g.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==T&&x.d.Warn(`${N}/magFilter: Invalid value (${T})`),A){case 9728:return g.c.NEAREST_NEAREST;case 9729:return g.c.NEAREST_LINEAR;case 9984:return g.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return g.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return g.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return g.c.NEAREST_LINEAR_MIPLINEAR;default:return x.d.Warn(`${N}/minFilter: Invalid value (${A})`),g.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(N,p){try{return(0,r.k)(p)}catch(T){throw new Error(`${N}: ${T.message}`)}}static _GetTypedArray(N,p,T,A,a){const C=T.buffer;A=T.byteOffset+(A||0);const U=D._GetTypedArrayConstructor(`${N}/componentType`,p),X=i.f.GetTypeByteLength(p);return A%X!==0?(x.d.Warn(`${N}: Copying buffer as byte offset (${A}) is not a multiple of component type byte length (${X})`),new U(C.slice(A,A+a*X),0)):new U(C,A,a)}static _GetNumComponents(N,p){switch(p){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${N}: Invalid type (${p})`)}static _ValidateUri(N){return U.Tools.IsBase64(N)||-1===N.indexOf("..")}static _GetDrawMode(N,p){switch(void 0==p&&(p=4),p){case 0:return n.c.PointListDrawMode;case 1:return n.c.LineListDrawMode;case 2:return n.c.LineLoopDrawMode;case 3:return n.c.LineStripDrawMode;case 4:return n.c.TriangleFillMode;case 5:return n.c.TriangleStripDrawMode;case 6:return n.c.TriangleFanDrawMode}throw new Error(`${N}: Invalid mesh primitive mode (${p})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const N=new Array;if(this._gltf.materials)for(const p of this._gltf.materials)if(p._data)for(const T in p._data){const A=p._data[T];for(const p of A.babylonMeshes){p.HX(!0);const T=A.babylonMaterial;N.push(T.forceCompilationAsync(p)),N.push(T.forceCompilationAsync(p,{useInstances:!0})),this._parent.useClipPlane&&(N.push(T.forceCompilationAsync(p,{clipPlane:!0})),N.push(T.forceCompilationAsync(p,{clipPlane:!0,useInstances:!0})))}}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const N=new Array,p=this._babylonScene.lights;for(const T of p){const p=T.getShadowGenerator();p&&N.push(p.forceCompilationAsync())}return Promise.all(N).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(N){for(const p of this._extensions)p.enabled&&N(p)}_applyExtensions(N,p,T){for(const A of this._extensions)if(A.enabled){const a=`${A.name}.${p}`,C=N;C._activeLoaderExtensionFunctions=C._activeLoaderExtensionFunctions||{};const U=C._activeLoaderExtensionFunctions;if(!U[a]){U[a]=!0;try{const N=T(A);if(N)return N}finally{delete U[a]}}}return null}_extensionsOnLoading(){this._forEachExtensions((N=>N.onLoading&&N.onLoading()))}_extensionsOnReady(){this._forEachExtensions((N=>N.onReady&&N.onReady()))}_extensionsLoadSceneAsync(N,p){return this._applyExtensions(p,"loadScene",(T=>T.loadSceneAsync&&T.loadSceneAsync(N,p)))}_extensionsLoadNodeAsync(N,p,T){return this._applyExtensions(p,"loadNode",(A=>A.loadNodeAsync&&A.loadNodeAsync(N,p,T)))}_extensionsLoadCameraAsync(N,p,T){return this._applyExtensions(p,"loadCamera",(A=>A.loadCameraAsync&&A.loadCameraAsync(N,p,T)))}_extensionsLoadVertexDataAsync(N,p,T){return this._applyExtensions(p,"loadVertexData",(A=>A._loadVertexDataAsync&&A._loadVertexDataAsync(N,p,T)))}_extensionsLoadMeshPrimitiveAsync(N,p,T,A,a,C){return this._applyExtensions(a,"loadMeshPrimitive",(U=>U._loadMeshPrimitiveAsync&&U._loadMeshPrimitiveAsync(N,p,T,A,a,C)))}_extensionsLoadMaterialAsync(N,p,T,A,a){return this._applyExtensions(p,"loadMaterial",(C=>C._loadMaterialAsync&&C._loadMaterialAsync(N,p,T,A,a)))}_extensionsCreateMaterial(N,p,T){return this._applyExtensions(p,"createMaterial",(A=>A.createMaterial&&A.createMaterial(N,p,T)))}_extensionsLoadMaterialPropertiesAsync(N,p,T){return this._applyExtensions(p,"loadMaterialProperties",(A=>A.loadMaterialPropertiesAsync&&A.loadMaterialPropertiesAsync(N,p,T)))}_extensionsLoadTextureInfoAsync(N,p,T){return this._applyExtensions(p,"loadTextureInfo",(A=>A.loadTextureInfoAsync&&A.loadTextureInfoAsync(N,p,T)))}_extensionsLoadTextureAsync(N,p,T){return this._applyExtensions(p,"loadTexture",(A=>A._loadTextureAsync&&A._loadTextureAsync(N,p,T)))}_extensionsLoadAnimationAsync(N,p){return this._applyExtensions(p,"loadAnimation",(T=>T.loadAnimationAsync&&T.loadAnimationAsync(N,p)))}_extensionsLoadAnimationChannelAsync(N,p,T,A,a){return this._applyExtensions(T,"loadAnimationChannel",(C=>C._loadAnimationChannelAsync&&C._loadAnimationChannelAsync(N,p,T,A,a)))}_extensionsLoadSkinAsync(N,p,T){return this._applyExtensions(T,"loadSkin",(A=>A._loadSkinAsync&&A._loadSkinAsync(N,p,T)))}_extensionsLoadUriAsync(N,p,T){return this._applyExtensions(p,"loadUri",(A=>A._loadUriAsync&&A._loadUriAsync(N,p,T)))}_extensionsLoadBufferViewAsync(N,p){return this._applyExtensions(p,"loadBufferView",(T=>T.loadBufferViewAsync&&T.loadBufferViewAsync(N,p)))}_extensionsLoadBufferAsync(N,p,T,A){return this._applyExtensions(p,"loadBuffer",(a=>a.loadBufferAsync&&a.loadBufferAsync(N,p,T,A)))}static LoadExtensionAsync(N,p,T,A){if(!p.extensions)return null;const a=p.extensions[T];return a?A(`${N}/extensions/${T}`,a):null}static LoadExtraAsync(N,p,T,A){if(!p.extras)return null;const a=p.extras[T];return a?A(`${N}/extras/${T}`,a):null}isExtensionUsed(N){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(N)}logOpen(N){this._parent._logOpen(N)}logClose(){this._parent._logClose()}log(N){this._parent._log(N)}startPerformanceCounter(N){this._parent._startPerformanceCounter(N)}endPerformanceCounter(N){this._parent._endPerformanceCounter(N)}}D.DefaultSampler={index:-1},f.e._CreateGLTF2Loader=N=>new D(N);var c=T(14034),Q=T(12564),E=T(12409),O=T(14041),B=T(14047);class d extends B.d{constructor(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",N),this._texture=N.getEngine().createRawCubeTexture(p,T,A,a,C,U,X,y)}update(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,N,p,T,A,a)}updateRGBDAsync(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,O.k)(this._texture,N,p,T,A).then((()=>{}))}clone(){return E.e.Clone((()=>{const N=this.KN(),p=this._texture,T=new d(N,p._bufferViewArray,p.width,p.format,p.type,p.generateMipMaps,p.invertY,p.samplingMode,p._compression);return 13===p.source&&T.updateRGBDAsync(p._bufferViewArrayArray,p._sphericalPolynomial,p._lodGenerationScale,p._lodGenerationOffset),T}),this)}}const t="EXT_lights_image_based";class S{constructor(N){this.name=t,this._loader=N,this.enabled=this._loader.isExtensionUsed(t)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.TX.extensions;if(N&&N[this.name]){const p=N[this.name];this._lights=p.lights}}loadSceneAsync(N,p){return D.LoadExtensionAsync(N,p,this.name,(async(T,A)=>{this._loader._allMaterialsDirtyRequired=!0;const a=new Array;a.push(this._loader.loadSceneAsync(N,p)),this._loader.logOpen(`${T}`);const C=u.Get(`${T}/light`,this._lights,A.XC);return a.push(this._loadLightAsync(`/extensions/${this.name}/lights/${A.XC}`,C).then((N=>{this._loader.babylonScene.environmentTexture=N}))),this._loader.logClose(),await Promise.all(a).then((()=>{}))}))}_loadLightAsync(N,p){if(!p._loaded){const T=new Array;this._loader.logOpen(`${N}`);const A=new Array(p.specularImages.length);for(let a=0;a<p.specularImages.length;a++){const C=p.specularImages[a];A[a]=new Array(C.length);for(let p=0;p<C.length;p++){const U=`${N}/specularImages/${a}/${p}`;this._loader.logOpen(`${U}`);const X=C[p],y=u.Get(U,this._loader.TX.images,X);T.push(this._loader.loadImageAsync(`/images/${X}`,y).then((N=>{A[a][p]=N}))),this._loader.logClose()}}this._loader.logClose(),p._loaded=Promise.all(T).then((async()=>{const T=new d(this._loader.babylonScene,null,p.specularImageSize);if(T.name=p.name||"environment",p._babylonTexture=T,void 0!=p.gX&&(T.level=p.gX),p.rotation){let N=a.Quaternion.gp(p.rotation);this._loader.babylonScene.useRightHandedSystem||(N=a.Quaternion.Inverse(N)),a.Matrix.FromQuaternionToRef(N,T.getReflectionTextureMatrix())}if(!p.irradianceCoefficients)throw new Error(`${N}: Irradiance coefficients are missing`);const C=Q.d.gp(p.irradianceCoefficients);C.scaleInPlace(p.gX),C.convertIrradianceToLambertianRadiance();const U=Q.f.FromHarmonics(C),X=(A.length-1)/Math.log2(p.specularImageSize);return await T.updateRGBDAsync(A,U,X)}))}return p._loaded.then((()=>p._babylonTexture))}}h(t),q(t,!0,(N=>new S(N)));T(12943);const s="EXT_mesh_gpu_instancing";class NN{constructor(N){this.name=s,this._loader=N,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null}loadNodeAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(N,A)=>{this._loader._disableInstancedMesh++;const C=this._loader.loadNodeAsync(`/nodes/${p.index}`,p,T);if(this._loader._disableInstancedMesh--,!p._primitiveBabylonMeshes)return await C;const U=new Array;let X=0;const y=p=>{if(void 0==A.attributes[p])return void U.push(Promise.resolve(null));const T=u.Get(`${N}/attributes/${p}`,this._loader.TX.accessors,A.attributes[p]);if(U.push(this._loader._loadFloatAccessorAsync(`/accessors/${T.bufferView}`,T)),0===X)X=T.count;else if(X!==T.count)throw new Error(`${N}/attributes: Instance buffer accessors do not have the same count.`)};return y("TRANSLATION"),y("ROTATION"),y("SCALE"),await C.then((async N=>{const[T,A,C]=await Promise.all(U),y=new Float32Array(16*X);a.TmpVectors.xp[0].kX(0,0,0),a.TmpVectors.Quaternion[0].kX(0,0,0,1),a.TmpVectors.xp[1].kX(1,1,1);for(let p=0;p<X;++p)T&&a.xp.FromArrayToRef(T,3*p,a.TmpVectors.xp[0]),A&&a.Quaternion.FromArrayToRef(A,4*p,a.TmpVectors.Quaternion[0]),C&&a.xp.FromArrayToRef(C,3*p,a.TmpVectors.xp[1]),a.Matrix.ComposeToRef(a.TmpVectors.xp[1],a.TmpVectors.Quaternion[0],a.TmpVectors.xp[0],a.TmpVectors.Matrix[0]),a.TmpVectors.Matrix[0].copyToArray(y,16*p);for(const a of p._primitiveBabylonMeshes)a.VM("matrix",y,16,!0);return N}))}))}}h(s),q(s,!0,(N=>new NN(N)));let pN=0,TN=null;class AN{static get Default(){return AN._Default||(AN._Default=new AN),AN._Default}constructor(){const N=AN.Configuration.decoder;this._decoderModulePromise=U.Tools.LoadBabylonScriptAsync(N.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(N,p,T,A,a){await this._decoderModulePromise,0===pN&&(MeshoptDecoder.useWorkers(1),pN=1);const C=await MeshoptDecoder.decodeGltfBufferAsync(p,T,N,A,a);return null!==TN&&clearTimeout(TN),TN=setTimeout((()=>{MeshoptDecoder.useWorkers(0),pN=0,TN=null}),1e3),C}}AN.Configuration={decoder:{url:`${U.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},AN._Default=null;const aN="EXT_meshopt_compression";class CN{constructor(N){this.name=aN,this.enabled=N.isExtensionUsed(aN),this._loader=N}dispose(){this._loader=null}loadBufferViewAsync(N,p){return D.LoadExtensionAsync(N,p,this.name,(async(T,A)=>{const a=p;if(a._meshOptData)return await a._meshOptData;const C=u.Get(`${N}/buffer`,this._loader.TX.buffers,A.buffer);return a._meshOptData=this._loader.loadBufferAsync(`/buffers/${C.index}`,C,A.byteOffset||0,A.byteLength).then((async N=>await AN.Default.decodeGltfBufferAsync(N,A.count,A.byteStride,A.mode,A.filter))),await a._meshOptData}))}}h(aN),q(aN,!0,(N=>new CN(N)));const UN="EXT_texture_webp";class XN{constructor(N){this.name=UN,this._loader=N,this.enabled=N.isExtensionUsed(UN)}dispose(){this._loader=null}_loadTextureAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=void 0==p.sampler?D.DefaultSampler:u.Get(`${N}/sampler`,this._loader.TX.samplers,p.sampler),U=u.Get(`${A}/source`,this._loader.TX.images,a.source);return await this._loader._createTextureAsync(N,C,U,(N=>{T(N)}),void 0,!p._textureInfo.nonColorData)}))}}h(UN),q(UN,!0,(N=>new XN(N)));const yN="EXT_texture_avif";class eN{constructor(N){this.name=yN,this._loader=N,this.enabled=N.isExtensionUsed(yN)}dispose(){this._loader=null}_loadTextureAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=void 0==p.sampler?D.DefaultSampler:u.Get(`${N}/sampler`,this._loader.TX.samplers,p.sampler),U=u.Get(`${A}/source`,this._loader.TX.images,a.source);return await this._loader._createTextureAsync(N,C,U,(N=>{T(N)}),void 0,!p._textureInfo.nonColorData)}))}}h(yN),q(yN,!0,(N=>new eN(N)));var HN=T(14030),MN=T(12921);const bN="EXT_lights_ies";class lN{constructor(N){this.name=bN,this._loader=N,this.enabled=this._loader.isExtensionUsed(bN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.TX.extensions;if(N&&N[this.name]){const p=N[this.name];this._lights=p.lights,u.Assign(this._lights)}}loadNodeAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,U)=>{let X,y;this._loader._allMaterialsDirtyRequired=!0;const e=await this._loader.loadNodeAsync(N,p,(N=>{y=u.Get(A,this._lights,U.XC);const p=y.name||N.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X=new HN.d(p,a.xp.Zero(),a.xp.Backward(),0,1,this._loader.babylonScene),X.angle=Math.PI/2,X.innerAngle=0,X._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,y._babylonLight=X,X.falloffType=MN.c.FALLOFF_GLTF,X.PX=U.color?C.wp.gp(U.color):C.wp.White(),X.gX=U.multiplier||1,X.range=Number.MAX_VALUE,X.parent=N,this._loader._babylonLights.push(X),D.AddPointerMetadata(X,A),T(N)}));let H;if(y.uri)H=await this._loader.loadUriAsync(N,y,y.uri);else{const p=u.Get(`${N}/bufferView`,this._loader.TX.bufferViews,y.bufferView);H=await this._loader.loadBufferViewAsync(`/bufferViews/${p.index}`,p)}return X.iesProfileTexture=new g.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,H,!0,void 0,void 0,void 0,void 0,".ies"),e}))}}h(bN),q(bN,!0,(N=>new lN(N)));var kN=T(14060);const xN="KHR_draco_mesh_compression";class IN{constructor(N){this.name=xN,this.useNormalizedFlagFromAccessor=!0,this._loader=N,this.enabled=kN.c.DefaultAvailable&&this._loader.isExtensionUsed(xN)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{if(void 0!=p.mode&&4!==p.mode&&5!==p.mode)throw new Error(`${N}: Unsupported mode ${p.mode}`);const C={},U={},X=(N,A)=>{const X=a.attributes[N];if(void 0!=X&&(T._delayInfo=T._delayInfo||[],-1===T._delayInfo.indexOf(A)&&T._delayInfo.push(A),C[A]=X,this.useNormalizedFlagFromAccessor)){const T=u.TryGet(this._loader.TX.accessors,p.attributes[N]);T&&(U[A]=T.normalized||!1)}};X("POSITION",i.f.PositionKind),X("NORMAL",i.f.NormalKind),X("TANGENT",i.f.TangentKind),X("TEXCOORD_0",i.f.UVKind),X("TEXCOORD_1",i.f.UV2Kind),X("TEXCOORD_2",i.f.UV3Kind),X("TEXCOORD_3",i.f.UV4Kind),X("TEXCOORD_4",i.f.UV5Kind),X("TEXCOORD_5",i.f.UV6Kind),X("JOINTS_0",i.f.MatricesIndicesKind),X("WEIGHTS_0",i.f.MatricesWeightsKind),X("COLOR_0",i.f.ColorKind);const y=u.Get(A,this._loader.TX.bufferViews,a.bufferView);return y._dracoBabylonGeometry||(y._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((async A=>{const a=this.dracoDecoder||kN.c.Default,X=u.TryGet(this._loader.TX.accessors,p.attributes.POSITION),y=this._loader.parent.alwaysComputeBoundingBox||T.skeleton||!X?null:Y(X);return await a._decodeMeshToGeometryForGltfAsync(T.name,this._loader.babylonScene,A,C,U,y).catch((p=>{throw new Error(`${N}: ${p.message}`)}))}))),await y._dracoBabylonGeometry}))}}h(xN),q(xN,!0,(N=>new IN(N)));var LN=T(14063),nN=T(12354),wN=T(12359),gN=T(12797),PN=T(12978),iN=T(12331);gN.d.AddNodeConstructor("Light_Type_0",((N,p)=>()=>new KN(N,a.xp.Zero(),p)));class KN extends PN.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(N){this._shadowAngle=N,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(N){const p=this.needCube();if(this._direction=N,this.needCube()!==p&&this._shadowGenerators){const N=this._shadowGenerators.values();for(let p=N.next();!0!==p.done;p=N.next()){p.value.recreateShadowMap()}}}constructor(N,p,T){super(N,T),this._shadowAngle=Math.PI/2,this.position=p}getClassName(){return"PointLight"}getTypeID(){return MN.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(N){if(this.direction)return super.getShadowDirection(N);switch(N){case 0:return new a.xp(1,0,0);case 1:return new a.xp(-1,0,0);case 2:return new a.xp(0,-1,0);case 3:return new a.xp(0,1,0);case 4:return new a.xp(0,0,1);case 5:return new a.xp(0,0,-1)}return a.xp.Zero()}_setDefaultShadowProjectionMatrix(N,p,T){const A=this.KN().activeCamera;if(!A)return;const C=void 0!==this.shadowMinZ?this.shadowMinZ:A.yX,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:A.maxZ,X=this.KN().getEngine().BU;a.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,X?U:C,X?C:U,N,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(N,p){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,p):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,p),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,p),this}transferToNodeMaterialEffect(N,p){return this.computeTransformedInformation()?N.setFloat3(p,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):N.setFloat3(p,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(N,p){N["POINTLIGHT"+p]=!0}}(0,nN.b)([(0,wN.H)()],KN.prototype,"shadowAngle",null),(0,iN.d)("BABYLON.PointLight",KN);const FN="KHR_lights_punctual";class vN{constructor(N){this.name=FN,this._loader=N,this.enabled=this._loader.isExtensionUsed(FN)}dispose(){this._loader=null,delete this._lights}onLoading(){const N=this._loader.TX.extensions;if(N&&N[this.name]){const p=N[this.name];this._lights=p.lights,u.Assign(this._lights)}}loadNodeAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,U)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(N,p,(N=>{let p;const X=u.Get(A,this._lights,U.XC),y=X.name||N.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const N=new LN.c(y,a.xp.Backward(),this._loader.babylonScene);N.position.IX(0),p=N;break}case"point":p=new KN(y,a.xp.Zero(),this._loader.babylonScene);break;case"spot":{const N=new HN.d(y,a.xp.Zero(),a.xp.Backward(),0,1,this._loader.babylonScene);N.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),N.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),p=N;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${A}: Invalid light type (${X.type})`)}p._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=p,p.falloffType=MN.c.FALLOFF_GLTF,p.PX=X.color?C.wp.gp(X.color):C.wp.White(),p.gX=void 0==X.gX?1:X.gX,p.range=void 0==X.range?Number.MAX_VALUE:X.range,p.parent=N,this._loader._babylonLights.push(p),D.AddPointerMetadata(p,A),T(N)})))))}}h(FN),q(FN,!0,(N=>new vN(N)));const WN="KHR_materials_pbrSpecularGlossiness";class zN{constructor(N){this.name=WN,this.order=200,this._loader=N,this.enabled=this._loader.isExtensionUsed(WN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialBasePropertiesAsync(N,p,T)),C.push(this._loadSpecularGlossinessPropertiesAsync(A,a,T)),this._loader.loadMaterialAlphaProperties(N,p,T),await Promise.all(C).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.metallic=null,T.roughness=null,p.diffuseFactor?(T.albedoColor=C.wp.gp(p.diffuseFactor),T.alpha=p.diffuseFactor[3]):T.albedoColor=C.wp.White(),T.reflectivityColor=p.specularFactor?C.wp.gp(p.specularFactor):C.wp.White(),T.microSurface=void 0==p.glossinessFactor?1:p.glossinessFactor,p.diffuseTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTexture`,p.diffuseTexture,(N=>{N.name=`${T.name} (Diffuse)`,T.albedoTexture=N}))),p.specularGlossinessTexture&&(A.push(this._loader.loadTextureInfoAsync(`${N}/specularGlossinessTexture`,p.specularGlossinessTexture,(N=>{N.name=`${T.name} (Specular Glossiness)`,T.reflectivityTexture=N,T.reflectivityTexture.XX=!0}))),T.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(A).then((()=>{}))}}h(WN),q(WN,!0,(N=>new zN(N)));const RN="KHR_materials_unlit";class JN{constructor(N){this.name=RN,this.order=210,this._loader=N,this.enabled=this._loader.isExtensionUsed(RN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async()=>await this._loadUnlitPropertiesAsync(N,p,T)))}_loadUnlitPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;T.unlit=!0;const a=p.pbrMetallicRoughness;return a&&(a.baseColorFactor?(T.albedoColor=C.wp.gp(a.baseColorFactor),T.alpha=a.baseColorFactor[3]):T.albedoColor=C.wp.White(),a.baseColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/baseColorTexture`,a.baseColorTexture,(N=>{N.name=`${T.name} (Base Color)`,T.albedoTexture=N})))),p.doubleSided&&(T.lX=!1,T.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(N,p,T),Promise.all(A).then((()=>{}))}}h(RN),q(RN,!0,(N=>new JN(N)));const fN="KHR_materials_clearcoat";class GN{constructor(N){this.name=fN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(fN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadClearCoatPropertiesAsync(A,a,T)),await Promise.all(C)}))}_loadClearCoatPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.clearCoat.isEnabled=!0,T.clearCoat.useRoughnessFromMainTexture=!1,T.clearCoat.remapF0OnInterfaceChange=!1,void 0!=p.clearcoatFactor?T.clearCoat.gX=p.clearcoatFactor:T.clearCoat.gX=0,p.clearcoatTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatTexture`,p.clearcoatTexture,(N=>{N.name=`${T.name} (ClearCoat)`,T.clearCoat.texture=N}))),void 0!=p.clearcoatRoughnessFactor?T.clearCoat.roughness=p.clearcoatRoughnessFactor:T.clearCoat.roughness=0,p.clearcoatRoughnessTexture&&(p.clearcoatRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatRoughnessTexture`,p.clearcoatRoughnessTexture,(N=>{N.name=`${T.name} (ClearCoat Roughness)`,T.clearCoat.textureRoughness=N})))),p.clearcoatNormalTexture&&(p.clearcoatNormalTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/clearcoatNormalTexture`,p.clearcoatNormalTexture,(N=>{N.name=`${T.name} (ClearCoat Normal)`,T.clearCoat.bumpTexture=N}))),T.invertNormalMapX=!T.KN().useRightHandedSystem,T.invertNormalMapY=T.KN().useRightHandedSystem,void 0!=p.clearcoatNormalTexture.scale&&(T.clearCoat.bumpTexture.level=p.clearcoatNormalTexture.scale)),Promise.all(A).then((()=>{}))}}h(fN),q(fN,!0,(N=>new GN(N)));const oN="KHR_materials_iridescence";class ZN{constructor(N){this.name=oN,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(oN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadIridescencePropertiesAsync(A,a,T)),await Promise.all(C).then((()=>{}))}))}_loadIridescencePropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.iridescence.isEnabled=!0,T.iridescence.gX=p.iridescenceFactor??0,T.iridescence.indexOfRefraction=p.iridescenceIor??p.iridescenceIOR??1.3,T.iridescence.minimumThickness=p.iridescenceThicknessMinimum??100,T.iridescence.maximumThickness=p.iridescenceThicknessMaximum??400,p.iridescenceTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceTexture`,p.iridescenceTexture,(N=>{N.name=`${T.name} (Iridescence)`,T.iridescence.texture=N}))),p.iridescenceThicknessTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/iridescenceThicknessTexture`,p.iridescenceThicknessTexture,(N=>{N.name=`${T.name} (Iridescence Thickness)`,T.iridescence.thicknessTexture=N}))),Promise.all(A).then((()=>{}))}}h(oN),q(oN,!0,(N=>new ZN(N)));const mp="KHR_materials_anisotropy";class qN{constructor(N){this.name=mp,this.order=195,this._loader=N,this.enabled=this._loader.isExtensionUsed(mp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadIridescencePropertiesAsync(A,a,T)),await Promise.all(C)}))}async _loadIridescencePropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;T.anisotropy.isEnabled=!0,T.anisotropy.gX=p.anisotropyStrength??0,T.anisotropy.angle=p.anisotropyRotation??0,p.anisotropyTexture&&(p.anisotropyTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/anisotropyTexture`,p.anisotropyTexture,(N=>{N.name=`${T.name} (Anisotropy Intensity)`,T.anisotropy.texture=N})))),await Promise.all(A)}}h(mp),q(mp,!0,(N=>new qN(N)));const hN="KHR_materials_emissive_strength";class jN{constructor(N){this.name=hN,this.order=170,this._loader=N,this.enabled=this._loader.isExtensionUsed(hN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>await this._loader.loadMaterialPropertiesAsync(N,p,T).then((()=>{this._loadEmissiveProperties(A,a,T)}))))}_loadEmissiveProperties(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);void 0!==p.emissiveStrength&&(T.emissiveIntensity=p.emissiveStrength)}}h(hN),q(hN,!0,(N=>new jN(N)));const VN="KHR_materials_sheen";class rN{constructor(N){this.name=VN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(VN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadSheenPropertiesAsync(A,a,T)),await Promise.all(C).then((()=>{}))}))}_loadSheenPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.sheen.isEnabled=!0,T.sheen.gX=1,void 0!=p.sheenColorFactor?T.sheen.color=C.wp.gp(p.sheenColorFactor):T.sheen.color=C.wp.Black(),p.sheenColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/sheenColorTexture`,p.sheenColorTexture,(N=>{N.name=`${T.name} (Sheen Color)`,T.sheen.texture=N}))),void 0!==p.sheenRoughnessFactor?T.sheen.roughness=p.sheenRoughnessFactor:T.sheen.roughness=0,p.sheenRoughnessTexture&&(p.sheenRoughnessTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/sheenRoughnessTexture`,p.sheenRoughnessTexture,(N=>{N.name=`${T.name} (Sheen Roughness)`,T.sheen.textureRoughness=N})))),T.sheen.albedoScaling=!0,T.sheen.useRoughnessFromMainTexture=!1,Promise.all(A).then((()=>{}))}}h(VN),q(VN,!0,(N=>new rN(N)));var uN=T(12862);const YN="KHR_materials_specular";class DN{constructor(N){this.name=YN,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(YN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;if(C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadSpecularPropertiesAsync(A,a,T)),a.extensions&&a.extensions.EXT_materials_specular_edge_color&&T instanceof w.b){a.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(T.brdf.dielectricSpecularModel=uN.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,T.brdf.conductorSpecularModel=uN.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(C).then((()=>{}))}))}_loadSpecularPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return void 0!==p.specularFactor&&(T.metallicF0Factor=p.specularFactor),void 0!==p.specularColorFactor&&(T.metallicReflectanceColor=C.wp.gp(p.specularColorFactor)),p.specularTexture&&(p.specularTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${N}/specularTexture`,p.specularTexture,(N=>{N.name=`${T.name} (Specular)`,T.metallicReflectanceTexture=N,T.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),p.specularColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/specularColorTexture`,p.specularColorTexture,(N=>{N.name=`${T.name} (Specular Color)`,T.reflectanceTexture=N}))),Promise.all(A).then((()=>{}))}}h(YN),q(YN,!0,(N=>new DN(N)));const cN="KHR_materials_ior";class QN{constructor(N){this.name=cN,this.order=180,this._loader=N,this.enabled=this._loader.isExtensionUsed(cN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadIorPropertiesAsync(A,a,T)),await Promise.all(C).then((()=>{}))}))}_loadIorPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);return void 0!==p.ior?T.indexOfRefraction=p.ior:T.indexOfRefraction=QN._DEFAULT_IOR,Promise.resolve()}}QN._DEFAULT_IOR=1.5,h(cN),q(cN,!0,(N=>new QN(N)));const EN="KHR_materials_variants";class ON{constructor(N){this.name=EN,this._loader=N,this.enabled=this._loader.isExtensionUsed(EN)}dispose(){this._loader=null}static GetAvailableVariants(N){const p=this._GetExtensionMetadata(N);return p?Object.keys(p.variants):[]}getAvailableVariants(N){return ON.GetAvailableVariants(N)}static SelectVariant(N,p){const T=this._GetExtensionMetadata(N);if(!T)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${EN} extension`);const A=N=>{const p=T.variants[N];if(p)for(const T of p)T.mesh.material=T.material};if(p instanceof Array)for(const a of p)A(a);else A(p);T.lastSelected=p}selectVariant(N,p){ON.SelectVariant(N,p)}static Reset(N){const p=this._GetExtensionMetadata(N);if(!p)throw new Error(`Cannot reset on a glTF mesh that does not have the ${EN} extension`);for(const T of p.original)T.mesh.material=T.material;p.lastSelected=null}reset(N){ON.Reset(N)}static GetLastSelectedVariant(N){const p=this._GetExtensionMetadata(N);if(!p)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${EN} extension`);return p.lastSelected}getLastSelectedVariant(N){return ON.GetLastSelectedVariant(N)}static _GetExtensionMetadata(N){var p,T;return(null===N||void 0===N||null===(p=N._internalMetadata)||void 0===p||null===(T=p.TX)||void 0===T?void 0:T[EN])||null}onLoading(){const N=this._loader.TX.extensions;if(N&&N[this.name]){const p=N[this.name];this._variants=p.variants}}onReady(){const N=this._loader.rootBabylonMesh;if(N){var p;const T=this._loader.parent.extensionOptions[EN];null!==T&&void 0!==T&&T.defaultVariant&&ON.SelectVariant(N,T.defaultVariant),null===T||void 0===T||null===(p=T.onLoaded)||void 0===p||p.call(T,{get variants(){return ON.GetAvailableVariants(N)},get selectedVariant(){const p=ON.GetLastSelectedVariant(N);return p?Array.isArray(p)?p[0]:p:ON.GetAvailableVariants(N)[0]},set selectedVariant(p){ON.SelectVariant(N,p)}})}}_loadMeshPrimitiveAsync(N,p,T,A,a,C){return D.LoadExtensionAsync(N,a,this.name,(async(U,X)=>{const y=new Array;return y.push(this._loader._loadMeshPrimitiveAsync(N,p,T,A,a,(p=>{if(C(p),p instanceof v.d){const T=D._GetDrawMode(N,a.mode),A=this._loader.rootBabylonMesh,C=A?A._internalMetadata=A._internalMetadata||{}:{},e=C.TX=C.TX||{},H=e[EN]=e[EN]||{lastSelected:null,original:[],variants:{}};H.original.push({mesh:p,material:p.material});for(let N=0;N<X.mappings.length;++N){const a=X.mappings[N],C=u.Get(`${U}/mappings/${N}/material`,this._loader.TX.materials,a.material);y.push(this._loader._loadMaterialAsync(`#/materials/${a.material}`,C,p,T,(N=>{for(let T=0;T<a.variants.length;++T){const C=a.variants[T],U=u.Get(`/extensions/${EN}/variants/${C}`,this._variants,C);H.variants[U.name]=H.variants[U.name]||[],H.variants[U.name].push({mesh:p,material:N}),p.onClonedObservable.add((N=>{const T=N;let a=null,C=T;do{if(C=C.parent,!C)return;a=ON._GetExtensionMetadata(C)}while(null===a);if(A&&a===ON._GetExtensionMetadata(A)){C._internalMetadata={};for(const N in A._internalMetadata)C._internalMetadata[N]=A._internalMetadata[N];C._internalMetadata.TX=[];for(const N in A._internalMetadata.TX)C._internalMetadata.TX[N]=A._internalMetadata.TX[N];C._internalMetadata.TX[EN]={lastSelected:null,original:[],variants:{}};for(const N of a.original)C._internalMetadata.TX[EN].original.push({mesh:N.mesh,material:N.material});for(const N in a.variants)if(Object.prototype.hasOwnProperty.call(a.variants,N)){C._internalMetadata.TX[EN].variants[N]=[];for(const p of a.variants[N])C._internalMetadata.TX[EN].variants[N].push({mesh:p.mesh,material:p.material})}a=C._internalMetadata.TX[EN]}for(const A of a.original)A.mesh===p&&(A.mesh=T);for(const A of a.variants[U.name])A.mesh===p&&(A.mesh=T)}))}})))}}}))),await Promise.all(y).then((N=>{let[p]=N;return p}))}))}}h(EN),q(EN,!0,(N=>new ON(N)));var BN=T(12435);class dN{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:uN.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(N,p){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...dN._GetDefaultOptions(),...N},this._scene=p,this._scene._transmissionHelper=this,this.onErrorObservable=new H.c,this._scene.SU.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(N){if(!Object.keys(N).filter((p=>this._options[p]!==N[p])).length)return;const p={...this._options,...N},T=this._options;this._options=p,p.renderSize===T.renderSize&&p.renderTargetTextureType===T.renderTargetTextureType&&p.generateMipmaps===T.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=p.samples,this._opaqueRenderTarget.lodGenerationScale=p.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=p.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(N){return!!N&&!!(N instanceof w.b&&N.subSurface.isRefractionEnabled)}_addMesh(N){this._materialObservers[N.uniqueId]=N.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),U.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(N.material)?(N.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(N)&&this._transparentMeshesCache.push(N)):-1===this._opaqueMeshesCache.indexOf(N)&&this._opaqueMeshesCache.push(N)}))}_removeMesh(N){N.onMaterialChangedObservable.remove(this._materialObservers[N.uniqueId]),delete this._materialObservers[N.uniqueId];let p=this._transparentMeshesCache.indexOf(N);-1!==p&&this._transparentMeshesCache.splice(p,1),p=this._opaqueMeshesCache.indexOf(N),-1!==p&&this._opaqueMeshesCache.splice(p,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(N){const p=this._transparentMeshesCache.indexOf(N),T=this._opaqueMeshesCache.indexOf(N);this._shouldRenderAsTransmission(N.material)?(N.material instanceof w.b&&(N.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==T?(this._opaqueMeshesCache.splice(T,1),this._transparentMeshesCache.push(N)):-1===p&&this._transparentMeshesCache.push(N)):-1!==p?(this._transparentMeshesCache.splice(p,1),this._opaqueMeshesCache.push(N)):-1===T&&this._opaqueMeshesCache.push(N)}_isRenderTargetValid(){var N;return null!==(null===(N=this._opaqueRenderTarget)||void 0===N?void 0:N.getInternalTexture())}_setupRenderTargets(){var N;let p;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new BN.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(N=this._options.clearColor)||void 0===N?void 0:N.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((N=>{p=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?N.clearColor.A(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(N.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=p}));for(const T of this._transparentMeshesCache)this._shouldRenderAsTransmission(T.material)&&(T.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const tN="KHR_materials_transmission";class SN{constructor(N){this.name=tN,this.order=175,this._loader=N,this.enabled=this._loader.isExtensionUsed(tN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadTransparentPropertiesAsync(A,p,T,a)),await Promise.all(C).then((()=>{}))}))}_loadTransparentPropertiesAsync(N,p,T,A){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const a=T;if(a.subSurface.isRefractionEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.useAlbedoToTintRefraction=!0,void 0===A.transmissionFactor)return a.subSurface.refractionIntensity=0,a.subSurface.isRefractionEnabled=!1,Promise.resolve();{var C;a.subSurface.refractionIntensity=A.transmissionFactor;const N=a.KN();if(a.subSurface.refractionIntensity&&!N._transmissionHelper)new dN({},a.KN());else if(a.subSurface.refractionIntensity&&(null===(C=N._transmissionHelper)||void 0===C||!C._isRenderTargetValid())){var U;null===(U=N._transmissionHelper)||void 0===U||U._setupRenderTargets()}}return a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,A.transmissionTexture?(A.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/transmissionTexture`,A.transmissionTexture,void 0).then((N=>{N.name=`${T.name} (Transmission)`,a.subSurface.refractionIntensityTexture=N,a.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(tN),q(tN,!0,(N=>new SN(N)));const sN="KHR_materials_diffuse_transmission";class Np{constructor(N){this.name=sN,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(sN),this.enabled&&(N.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadTranslucentPropertiesAsync(A,p,T,a)),await Promise.all(C).then((()=>{}))}))}_loadTranslucentPropertiesAsync(N,p,T,A){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const a=T;if(a.subSurface.isTranslucencyEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,a.subSurface.useAlbedoToTintTranslucency=!1,void 0===A.diffuseTransmissionFactor)return a.subSurface.translucencyIntensity=0,a.subSurface.isTranslucencyEnabled=!1,Promise.resolve();a.subSurface.translucencyIntensity=A.diffuseTransmissionFactor;const U=new Array;return a.subSurface.useGltfStyleTextures=!0,A.diffuseTransmissionTexture&&(A.diffuseTransmissionTexture.nonColorData=!0,U.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionTexture`,A.diffuseTransmissionTexture).then((N=>{N.name=`${T.name} (Diffuse Transmission)`,a.subSurface.translucencyIntensityTexture=N})))),void 0!==A.diffuseTransmissionColorFactor?a.subSurface.translucencyColor=C.wp.gp(A.diffuseTransmissionColorFactor):a.subSurface.translucencyColor=C.wp.White(),A.diffuseTransmissionColorTexture&&U.push(this._loader.loadTextureInfoAsync(`${N}/diffuseTransmissionColorTexture`,A.diffuseTransmissionColorTexture).then((N=>{N.name=`${T.name} (Diffuse Transmission Color)`,a.subSurface.translucencyColorTexture=N}))),Promise.all(U).then((()=>{}))}}h(sN),q(sN,!0,(N=>new Np(N)));const pp="KHR_materials_volume";class Tp{constructor(N){this.name=pp,this.order=173,this._loader=N,this.enabled=this._loader.isExtensionUsed(pp),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadVolumePropertiesAsync(A,p,T,a)),await Promise.all(C).then((()=>{}))}))}_loadVolumePropertiesAsync(N,p,T,A){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);if(!T.subSurface.isRefractionEnabled&&!T.subSurface.isTranslucencyEnabled||!A.thicknessFactor)return Promise.resolve();T.subSurface.volumeIndexOfRefraction=T.indexOfRefraction;const a=void 0!==A.attenuationDistance?A.attenuationDistance:Number.MAX_VALUE;return T.subSurface.tintColorAtDistance=a,void 0!==A.attenuationColor&&3==A.attenuationColor.length&&T.subSurface.tintColor.kX(A.attenuationColor[0],A.attenuationColor[1],A.attenuationColor[2]),T.subSurface.minimumThickness=0,T.subSurface.maximumThickness=A.thicknessFactor,T.subSurface.useThicknessAsDepth=!0,A.thicknessTexture?(A.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${N}/thicknessTexture`,A.thicknessTexture).then((N=>{N.name=`${T.name} (Thickness)`,T.subSurface.thicknessTexture=N,T.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(pp),q(pp,!0,(N=>new Tp(N)));const Ap="KHR_materials_dispersion";class ap{constructor(N){this.name=Ap,this.order=174,this._loader=N,this.enabled=this._loader.isExtensionUsed(Ap)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadDispersionPropertiesAsync(A,p,T,a)),await Promise.all(C).then((()=>{}))}))}_loadDispersionPropertiesAsync(N,p,T,A){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);return T.subSurface.isRefractionEnabled&&A.dispersion?(T.subSurface.isDispersionEnabled=!0,T.subSurface.dispersion=A.dispersion,Promise.resolve()):Promise.resolve()}}h(Ap),q(Ap,!0,(N=>new ap(N)));const Cp="EXT_materials_diffuse_roughness";class Up{constructor(N){this.name=Cp,this.order=190,this._loader=N,this.enabled=this._loader.isExtensionUsed(Cp)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=new Array;return C.push(this._loader.loadMaterialPropertiesAsync(N,p,T)),C.push(this._loadDiffuseRoughnessPropertiesAsync(A,a,T)),await Promise.all(C).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(N,p,T){if(!(T instanceof w.b))throw new Error(`${N}: Material type not supported`);const A=new Array;return T.brdf.baseDiffuseModel=uN.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=p.diffuseRoughnessFactor?T.baseDiffuseRoughness=p.diffuseRoughnessFactor:T.baseDiffuseRoughness=0,p.diffuseRoughnessTexture&&A.push(this._loader.loadTextureInfoAsync(`${N}/diffuseRoughnessTexture`,p.diffuseRoughnessTexture,(N=>{N.name=`${T.name} (Diffuse Roughness)`,T.baseDiffuseRoughnessTexture=N}))),Promise.all(A).then((()=>{}))}}h(Cp),q(Cp,!0,(N=>new Up(N)));const Xp="KHR_mesh_quantization";class yp{constructor(N){this.name=Xp,this.enabled=N.isExtensionUsed(Xp)}dispose(){}}h(Xp),q(Xp,!0,(N=>new yp(N)));const ep="KHR_texture_basisu";class Hp{constructor(N){this.name=ep,this._loader=N,this.enabled=N.isExtensionUsed(ep)}dispose(){this._loader=null}_loadTextureAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>{const C=void 0==p.sampler?D.DefaultSampler:u.Get(`${N}/sampler`,this._loader.TX.samplers,p.sampler),U=u.Get(`${A}/source`,this._loader.TX.images,a.source);return await this._loader._createTextureAsync(N,C,U,(N=>{T(N)}),p._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!p._textureInfo.nonColorData)}))}}h(ep),q(ep,!0,(N=>new Hp(N)));const Mp="KHR_texture_transform";class bp{constructor(N){this.name=Mp,this._loader=N,this.enabled=this._loader.isExtensionUsed(Mp)}dispose(){this._loader=null}loadTextureInfoAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(A,a)=>await this._loader.loadTextureInfoAsync(N,p,(N=>{if(!(N instanceof g.c))throw new Error(`${A}: Texture type not supported`);a.offset&&(N.uOffset=a.offset[0],N.vOffset=a.offset[1]),N.uRotationCenter=0,N.vRotationCenter=0,a.rotation&&(N.wAng=-a.rotation),a.scale&&(N.uScale=a.scale[0],N.vScale=a.scale[1]),void 0!=a.texCoord&&(N.coordinatesIndex=a.texCoord),T(N)}))))}}h(Mp),q(Mp,!0,(N=>new bp(N)));const lp="KHR_xmp_json_ld";class kp{constructor(N){this.name=lp,this.order=100,this._loader=N,this.enabled=this._loader.isExtensionUsed(lp)}dispose(){this._loader=null}onLoading(){var N,p,T;if(null===this._loader.rootBabylonMesh)return;const A=null===(N=this._loader.TX.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld,a=null===(p=this._loader.TX.asset)||void 0===p||null===(T=p.extensions)||void 0===T?void 0:T.KHR_xmp_json_ld;if(A&&a){const N=+a.packet;A.packets&&N<A.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=A.packets[N])}}}function xp(N,p,T,A){return C.wp.gp(p,T).scale(A)}function Ip(N,p,T,A){return p[T]*A}function Lp(N,p,T,A){return-p[T]*A}function np(N,p,T,A){return p[T+1]*A}function wp(N,p,T,A){return p[T]*A*2}function gp(N){return{scale:[new ip(b.b.ANIMATIONTYPE_FLOAT,`${N}.uScale`,Ip,(()=>2)),new ip(b.b.ANIMATIONTYPE_FLOAT,`${N}.vScale`,np,(()=>2))],offset:[new ip(b.b.ANIMATIONTYPE_FLOAT,`${N}.uOffset`,Ip,(()=>2)),new ip(b.b.ANIMATIONTYPE_FLOAT,`${N}.vOffset`,np,(()=>2))],rotation:[new ip(b.b.ANIMATIONTYPE_FLOAT,`${N}.wAng`,Lp,(()=>1))]}}h(lp),q(lp,!0,(N=>new kp(N)));class Pp extends c.AnimationPropertyInfo{buildAnimations(N,p,T,A){return[{babylonAnimatable:N._babylonCamera,babylonAnimation:this._buildAnimation(p,T,A)}]}}class ip extends c.AnimationPropertyInfo{buildAnimations(N,p,T,A){const a=[];for(const C in N._data)a.push({babylonAnimatable:N._data[C].babylonMaterial,babylonAnimation:this._buildAnimation(p,T,A)});return a}}class Kp extends c.AnimationPropertyInfo{buildAnimations(N,p,T,A){return[{babylonAnimatable:N._babylonLight,babylonAnimation:this._buildAnimation(p,T,A)}]}}(0,j.m)("/cameras/{}/orthographic/xmag",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Lp,(()=>1)),new Pp(b.b.ANIMATIONTYPE_FLOAT,"orthoRight",np,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/ymag",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Lp,(()=>1)),new Pp(b.b.ANIMATIONTYPE_FLOAT,"orthoTop",np,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/zfar",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"maxZ",Ip,(()=>1))]),(0,j.m)("/cameras/{}/orthographic/znear",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"yX",Ip,(()=>1))]),(0,j.m)("/cameras/{}/perspective/yfov",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"fov",Ip,(()=>1))]),(0,j.m)("/cameras/{}/perspective/zfar",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"maxZ",Ip,(()=>1))]),(0,j.m)("/cameras/{}/perspective/znear",[new Pp(b.b.ANIMATIONTYPE_FLOAT,"yX",Ip,(()=>1))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"albedoColor",xp,(()=>4)),new ip(b.b.ANIMATIONTYPE_FLOAT,"alpha",(function(N,p,T,A){return p[T+3]*A}),(()=>4))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"metallic",Ip,(()=>1))]),(0,j.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"roughness",Ip,(()=>1))]);const Fp=gp("albedoTexture");(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Fp.scale),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Fp.offset),(0,j.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Fp.rotation);const vp=gp("metallicTexture");(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",vp.scale),(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",vp.offset),(0,j.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",vp.rotation),(0,j.m)("/materials/{}/emissiveFactor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"emissiveColor",xp,(()=>3))]);const Wp=gp("bumpTexture");(0,j.m)("/materials/{}/normalTexture/scale",[new ip(b.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Ip,(()=>1))]),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Wp.scale),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Wp.offset),(0,j.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Wp.rotation),(0,j.m)("/materials/{}/occlusionTexture/strength",[new ip(b.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Ip,(()=>1))]);const zp=gp("ambientTexture");(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",zp.scale),(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",zp.offset),(0,j.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",zp.rotation);const Rp=gp("emissiveTexture");(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Rp.scale),(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Rp.offset),(0,j.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Rp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new ip(b.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new ip(b.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Ip,(()=>1))]);const Jp=gp("anisotropy.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Jp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Jp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Jp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Ip,(()=>1))]);const fp=gp("clearCoat.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",fp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",fp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",fp.rotation);const Gp=gp("clearCoat.bumpTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new ip(b.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Gp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Gp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Gp.rotation);const op=gp("clearCoat.textureRoughness");(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",op.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",op.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",op.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new ip(b.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new ip(b.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new ip(b.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new ip(b.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Ip,(()=>1))]);const Zp=gp("iridescence.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Zp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Zp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Zp.rotation);const mT=gp("iridescence.thicknessTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",mT.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",mT.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",mT.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"sheen.color",xp,(()=>3))]),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Ip,(()=>1))]);const qp=gp("sheen.texture");(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",qp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",qp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",qp.rotation);const hp=gp("sheen.textureRoughness");(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",hp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",hp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",hp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",xp,(()=>3))]);const jp=gp("metallicReflectanceTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",jp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",jp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",jp.rotation);const Vp=gp("reflectanceTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Vp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Vp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Vp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Ip,(()=>1))]);const rp=gp("subSurface.refractionIntensityTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",rp.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",rp.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",rp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",xp,(()=>3))]),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new ip(b.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Ip,(()=>1))]),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Ip,(()=>1))]);const upN=gp("subSurface.thicknessTexture");(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",upN.scale),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",upN.offset),(0,j.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",upN.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new ip(b.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Ip,(()=>1))]);const Yp=gp("subSurface.translucencyIntensityTexture");(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Yp.scale),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Yp.offset),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Yp.rotation),(0,j.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new ip(b.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",xp,(()=>3))]);const Dp=gp("subSurface.translucencyColorTexture");(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Dp.scale),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Dp.offset),(0,j.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Dp.rotation),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Kp(b.b.ANIMATIONTYPE_COLOR3,"diffuse",xp,(()=>3))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Kp(b.b.ANIMATIONTYPE_FLOAT,"intensity",Ip,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Kp(b.b.ANIMATIONTYPE_FLOAT,"range",Ip,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Kp(b.b.ANIMATIONTYPE_FLOAT,"innerAngle",wp,(()=>1))]),(0,j.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Kp(b.b.ANIMATIONTYPE_FLOAT,"angle",wp,(()=>1))]),(0,j.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Kp(b.b.ANIMATIONTYPE_COLOR3,"diffuse",xp,(()=>3))]),(0,j.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Kp(b.b.ANIMATIONTYPE_FLOAT,"intensity",Ip,(()=>1))]);const cp="KHR_animation_pointer";class Qp{constructor(N){this.name=cp,this._loader=N,this._pathToObjectConverter=(0,j.k)(this._loader.TX)}get enabled(){return this._loader.isExtensionUsed(cp)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(N,p,T,A,a){var C;const U=null===(C=A.target.extensions)||void 0===C?void 0:C.KHR_animation_pointer;if(!U||!this._pathToObjectConverter)return null;"pointer"!==A.target.path&&x.d.Warn(`${N}/target/path: Value (${A.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=A.target.node&&x.d.Warn(`${N}/target/node: Value (${A.target.node}) must not be present when using the ${this.name} extension`);const X=`${N}/extensions/${this.name}`,y=U.pointer;if(!y)throw new Error(`${X}: Pointer is missing`);try{const C=this._pathToObjectConverter.convert(y);if(!C.info.interpolation)throw new Error(`${X}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(N,p,T,A,{object:C.object,info:C.info.interpolation},a)}catch(e){return x.d.Warn(`${X}/pointer: Invalid pointer (${y}) skipped`),null}}}h(cp),q(cp,!0,(N=>new Qp(N)));class Ep{constructor(N,p,T){this.frame=N,this.action=p,this.onlyOnce=T,this.isDone=!1}_clone(){return new Ep(this.frame,this.action,this.onlyOnce)}}var Op=T(12218),Bp=T(12270),dp=T(12264);class tp{get loop(){return this._loop}set loop(N){N!==this._loop&&(this._loop=N,this.updateOptions({loop:N}))}get currentTime(){var N;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.audioContext&&(this.isPlaying||this.isPaused)){const N=this.isPaused?0:Bp.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+N}return 0}get spatialSound(){return this._spatialSound}set spatialSound(N){if(N==this._spatialSound)return;const p=this.isPlaying;this.pause(),N?(this._spatialSound=N,this._updateSpatialParameters()):this._disableSpatialSound(),p&&this.play()}constructor(N,p,T){var A;let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new H.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=a.xp.Zero(),this._localDirection=new a.xp(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=N,T=T||k.b.LastCreatedScene)if(this._scene=T,tp._SceneComponentInitialization(T),this._readyToPlayCallback=C,this._customAttenuationFunction=(N,p,T,A,a)=>p<T?N*(1-p/T):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(A=Bp.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&Bp.c.audioEngine.audioContext){this._soundGain=Bp.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let N=!0;if(p)try{"string"===typeof p?(this._urlType="String",this._url=p):p instanceof ArrayBuffer?this._urlType="ArrayBuffer":p instanceof HTMLMediaElement?this._urlType="MediaElement":p instanceof MediaStream?this._urlType="MediaStream":p instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(p)&&(this._urlType="Array");let T=[],A=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Bp.c.audioEngine.audioContext.createMediaElementSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Bp.c.audioEngine.audioContext.createMediaStreamSource(p),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":p.byteLength>0&&(A=!0,this._soundLoaded(p));break;case"AudioBuffer":this._audioBufferLoaded(p);break;case"String":T.push(p);case"Array":0===T.length&&(T=p);for(let N=0;N<T.length;N++){const p=T[N];if(A=X&&X.skipCodecCheck||-1!==p.indexOf(".mp3",p.length-4)&&Bp.c.audioEngine.isMP3supported||-1!==p.indexOf(".ogg",p.length-4)&&Bp.c.audioEngine.isOGGsupported||-1!==p.indexOf(".wav",p.length-4)||-1!==p.indexOf(".m4a",p.length-4)||-1!==p.indexOf(".mp4",p.length-4)||-1!==p.indexOf("blob:"),A){this._streaming?(this._htmlAudioElement=new Audio(p),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,U.Tools.SetCorsBehavior(p,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(p,(N=>{this._soundLoaded(N)}),void 0,!0,!0,(N=>{N&&x.d.Error("XHR "+N.status+" error on: "+p+"."),x.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:N=!1}N?A||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):x.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(y){x.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Bp.c.audioEngine&&!Bp.c.audioEngine.WarnedWebAudioUnsupported&&(x.d.Error("Web Audio is not supported by your browser."),Bp.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var N;null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(N){var p;null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.audioContext&&(this._audioBuffer=N,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(N){var p;null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.audioContext&&Bp.c.audioEngine.audioContext.decodeAudioData(N,(N=>{this._audioBufferLoaded(N)}),(N=>{x.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+N)}))}setAudioBuffer(N){var p;null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&(this._audioBuffer=N,this._isReadyToPlay=!0)}updateOptions(N){N&&(this.loop=N.loop??this.loop,this.maxDistance=N.maxDistance??this.maxDistance,this.useCustomAttenuation=N.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=N.rolloffFactor??this.rolloffFactor,this.refDistance=N.refDistance??this.refDistance,this.distanceModel=N.distanceModel??this.distanceModel,this._playbackRate=N.playbackRate??this._playbackRate,this._length=N.length??void 0,this.spatialSound=N.spatialSound??this._spatialSound,this._setOffset(N.offset??void 0),this.setVolume(N.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var N;null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&Bp.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Bp.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var N;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(N=this._soundPanner)||void 0===N||N.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var N;null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(N){var p;null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(N),this._isOutputConnected=!0)}setDirectionalCone(N,p,T){p<N?x.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=N,this._coneOuterAngle=p,this._coneOuterGain=T,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!=this._coneInnerAngle){var p;if(this._coneOuterAngle<N)return void x.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N,null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!=this._coneOuterAngle){var p;if(N<this._coneInnerAngle)return void x.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N,null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(N){var p;N.equals(this._position)||(this._position.A(N),null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(N){var p;this._localDirection=N,null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const N=this._connectedTransformNode.getWorldMatrix(),p=a.xp.TransformNormal(this._localDirection,N);p.normalize(),this._soundPanner.orientationX.value=p.x,this._soundPanner.orientationY.value=p.y,this._soundPanner.orientationZ.value=p.z}updateDistanceFromListener(){var N;if(null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const N=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Ip(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,N,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(N){this._customAttenuationFunction=N}play(N,p,T){var A;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(A=Bp.c.audioEngine)&&void 0!==A&&A.audioContext)try{var a,C;this._clearTimeoutsAndObservers();let A=N?(null===(a=Bp.c.audioEngine)||void 0===a?void 0:a.audioContext.currentTime)+N:null===(C=Bp.c.audioEngine)||void 0===C?void 0:C.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Bp.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const N=()=>{var T;if(null!==(T=Bp.c.audioEngine)&&void 0!==T&&T.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=p??0;const T=this._htmlAudioElement.play();void 0!==T&&T.catch((()=>{var p,T;(null===(p=Bp.c.audioEngine)||void 0===p||p.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(T=Bp.c.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{N()})))}))}else{var A;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(A=Bp.c.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{N()}))}};N()}}else{var U;const a=()=>{var a;if(null!==(a=Bp.c.audioEngine)&&void 0!==a&&a.audioContext){var C;if(T=T||this._length,void 0!==p&&this._setOffset(p),this._soundSource){const N=this._soundSource;N.onended=()=>{N.disconnect()}}if(this._soundSource=null===(C=Bp.c.audioEngine)||void 0===C?void 0:C.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var U;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==p&&(this._soundSource.loopStart=p),void 0!==T&&(this._soundSource.loopEnd=(0|p)+T),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},A=N?(null===(U=Bp.c.audioEngine)||void 0===U?void 0:U.audioContext.currentTime)+N:Bp.c.audioEngine.audioContext.currentTime;const a=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(A,a,this.loop?void 0:T)}}};"suspended"===(null===(U=Bp.c.audioEngine)||void 0===U?void 0:U.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var N;"suspended"===(null===(N=Bp.c.audioEngine)||void 0===N?void 0:N.audioContext.state)?(Bp.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Bp.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{a()})))):a()}),500):a()}this._startTime=A,this.isPlaying=!0,this.isPaused=!1}catch(X){x.d.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(N){var p;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var T;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(T=this._streamingSource)||void 0===T||T.disconnect();this.isPlaying=!1}else if(null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.audioContext&&this._soundSource){const p=N?Bp.c.audioEngine.audioContext.currentTime+N:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(p)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var p;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(p=this._streamingSource)||void 0===p||p.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Bp.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(N,p){var T;null!==(T=Bp.c.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._soundGain&&(p&&Bp.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Bp.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Bp.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(N,Bp.c.audioEngine.audioContext.currentTime+p)):this._soundGain.gain.value=N),this._volume=N}setPlaybackRate(N){this._playbackRate=N,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(N){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=N,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=N=>this._onRegisterAfterWorldMatrixUpdate(N),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(N){var p;if(N.getBoundingInfo){const p=N.getBoundingInfo();this.setPosition(p.boundingSphere.centerWorld)}else this.setPosition(N.absolutePosition);null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const N=()=>{(0,dp.g)((()=>this._isReadyToPlay),(()=>{T._audioBuffer=this.getAudioBuffer(),T._isReadyToPlay=!0,T.autoplay&&T.play(0,this._offset,this._length)}),void 0,300)},p={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},T=new tp(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,p);return this.useCustomAttenuation&&T.setAttenuationFunction(this._customAttenuationFunction),T.setPosition(this._position),T.setPlaybackRate(this._playbackRate),N(),T}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const N={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(N.connectedMeshId=this._connectedTransformNode.id),N.position=this._position.UX(),N.refDistance=this.refDistance,N.distanceModel=this.distanceModel,N.isDirectional=this._isDirectional,N.localDirectionToMesh=this._localDirection.UX(),N.coneInnerAngle=this._coneInnerAngle,N.coneOuterAngle=this._coneOuterAngle,N.coneOuterGain=this._coneOuterGain),N}static Parse(N,p,T,A){const C=N.name;let U;U=N.url?T+N.url:T+C;const X={autoplay:N.autoplay,loop:N.loop,volume:N.volume,spatialSound:N.spatialSound,maxDistance:N.maxDistance,rolloffFactor:N.rolloffFactor,refDistance:N.refDistance,distanceModel:N.distanceModel,playbackRate:N.playbackRate};let y;if(A){const N=()=>{(0,dp.g)((()=>A._isReadyToPlay),(()=>{y._audioBuffer=A.getAudioBuffer(),y._isReadyToPlay=!0,y.autoplay&&y.play(0,y._offset,y._length)}),void 0,300)};y=new tp(C,new ArrayBuffer(0),p,null,X),N()}else y=new tp(C,U,p,(()=>{p.removePendingData(y)}),X),p.addPendingData(y);if(N.position){const p=a.xp.gp(N.position);y.setPosition(p)}if(N.isDirectional&&(y.setDirectionalCone(N.coneInnerAngle||360,N.coneOuterAngle||360,N.coneOuterGain||0),N.localDirectionToMesh)){const p=a.xp.gp(N.localDirectionToMesh);y.setLocalDirectionToMesh(p)}if(N.connectedMeshId){const T=p.getMeshById(N.connectedMeshId);T&&y.attachToMesh(T)}return N.metadata&&(y.metadata=N.metadata),y}_setOffset(N){this._offset!==N&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=N)}_clearTimeoutsAndObservers(){var N;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(N=Bp.c.audioEngine)||void 0===N||N.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}tp._SceneComponentInitialization=N=>{throw(0,Op.c)("AudioSceneComponent")},(0,iN.d)("BABYLON.Sound",tp);class Sp{constructor(N,p,T){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],p.length!==T.length)throw new Error("Sounds length does not equal weights length");this.loop=N,this._weights=T;let A=0;for(const C of T)A+=C;const a=A>0?1/A:0;for(let C=0;C<this._weights.length;C++)this._weights[C]*=a;this._sounds=p;for(const C of this._sounds)C.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(N){if(N!==this._coneInnerAngle){if(this._coneOuterAngle<N)return void x.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=N;for(const p of this._sounds)p.directionalConeInnerAngle=N}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(N){if(N!==this._coneOuterAngle){if(N<this._coneInnerAngle)return void x.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=N;for(const p of this._sounds)p.directionalConeOuterAngle=N}}get volume(){return this._volume}set volume(N){if(N!==this._volume)for(const p of this._sounds)p.setVolume(N)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(N){if(!this.isPaused){this.stop();const N=Math.random();let p=0;for(let T=0;T<this._weights.length;T++)if(p+=this._weights[T],N<=p){this._currentIndex=T;break}}const p=this._sounds[this._currentIndex??0];p.isReady()?p.play(0,this.isPaused?void 0:N):p.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class sp{constructor(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(N=N||k.b.LastCreatedScene)&&(this._scene=N,this.soundCollection=[],this._options=p,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var N;null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio&&Bp.c.audioEngine.audioContext&&(this._outputAudioNode=Bp.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Bp.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Bp.c.audioEngine&&Bp.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(N){var p;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&N.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==N.soundTrackId&&(-1===N.soundTrackId?this._scene.mainSoundTrack.removeSound(N):this._scene.soundTracks&&this._scene.soundTracks[N.soundTrackId].removeSound(N)),this.soundCollection.push(N),N.soundTrackId=this.id}removeSound(N){const p=this.soundCollection.indexOf(N);-1!==p&&this.soundCollection.splice(p,1)}setVolume(N){var p;null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=N)}switchPanningModelToHRTF(){var N;if(null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var N;if(null!==(N=Bp.c.audioEngine)&&void 0!==N&&N.canUseWebAudio)for(let p=0;p<this.soundCollection.length;p++)this.soundCollection[p].switchPanningModelToEqualPower()}connectToAnalyser(N){var p;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=N,null!==(p=Bp.c.audioEngine)&&void 0!==p&&p.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Bp.c.audioEngine.masterGain))}}var NT=T(12656),pT=T(12617),TT=T(12198);Bp.c.AudioEngineFactory=(N,p,T)=>new AT(N,p,T);class AT{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new H.c,this.onAudioLockedObservable=new H.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,TT.h)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const A=document.createElement("audio");this._hostElement=N,this._audioContext=p,this._audioDestination=T;try{A&&A.canPlayType&&(A.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||A.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(a){}try{A&&A.canPlayType&&A.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(a){}}lock(){this._triggerSuspendedState()}unlock(){var N,p;if("running"===(null===(N=this._audioContext)||void 0===N?void 0:N.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(p=this._audioContext)||void 0===p||p.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{x.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var N;null===(N=this._audioContext)||void 0===N||N.addEventListener("statechange",(()=>{var N;this.unlocked&&"running"!==(null===(N=this._audioContext)||void 0===N?void 0:N.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var N;return null!==(N=this._audioContext)&&void 0!==N&&N.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(N){this.canUseWebAudio=!1,x.d.Error("Web Audio: "+N.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(N){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const N=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",p=document.createElement("style");p.appendChild(document.createTextNode(N)),document.getElementsByTagName("head")[0].appendChild(p),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var N;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(N=this._audioContext)||void 0===N||N.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(N){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=N)}connectToAnalyser(N){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=N,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var aT=T(12216);(0,T(13761).d)(NT.c.NAME_AUDIO,((N,p,T,A)=>{let a,C=[];if(T.ul=T.ul||[],void 0!==N.ul&&null!==N.ul)for(let X=0,y=N.ul.length;X<y;X++){var U;const y=N.ul[X];null!==(U=Bp.c.audioEngine)&&void 0!==U&&U.canUseWebAudio?(y.url||(y.url=y.name),C[y.url]?T.ul.push(tp.Parse(y,p,A,C[y.url])):(a=tp.Parse(y,p,A),C[y.url]=a,T.ul.push(a))):T.ul.push(new tp(y.name,null,p))}C=[]})),Object.defineProperty(pT.c.prototype,"mainSoundTrack",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),this._mainSoundTrack||(this._mainSoundTrack=new sp(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),pT.c.prototype.getSoundByName=function(N){let p;for(p=0;p<this.mainSoundTrack.soundCollection.length;p++)if(this.mainSoundTrack.soundCollection[p].name===N)return this.mainSoundTrack.soundCollection[p];if(this.soundTracks)for(let T=0;T<this.soundTracks.length;T++)for(p=0;p<this.soundTracks[T].soundCollection.length;p++)if(this.soundTracks[T].soundCollection[p].name===N)return this.soundTracks[T].soundCollection[p];return null},Object.defineProperty(pT.c.prototype,"audioEnabled",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),N.audioEnabled},set:function(N){let p=this._getComponent(NT.c.NAME_AUDIO);p||(p=new CT(this),this.o(p)),N?p.enableAudio():p.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(pT.c.prototype,"headphone",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),N.headphone},set:function(N){let p=this._getComponent(NT.c.NAME_AUDIO);p||(p=new CT(this),this.o(p)),N?p.switchAudioModeForHeadphones():p.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(pT.c.prototype,"audioListenerPositionProvider",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),N.audioListenerPositionProvider},set:function(N){let p=this._getComponent(NT.c.NAME_AUDIO);if(p||(p=new CT(this),this.o(p)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");p.audioListenerPositionProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(pT.c.prototype,"audioListenerRotationProvider",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),N.audioListenerRotationProvider},set:function(N){let p=this._getComponent(NT.c.NAME_AUDIO);if(p||(p=new CT(this),this.o(p)),N&&"function"!==typeof N)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");p.audioListenerRotationProvider=N},enumerable:!0,configurable:!0}),Object.defineProperty(pT.c.prototype,"audioPositioningRefreshRate",{get:function(){let N=this._getComponent(NT.c.NAME_AUDIO);return N||(N=new CT(this),this.o(N)),N.audioPositioningRefreshRate},set:function(N){let p=this._getComponent(NT.c.NAME_AUDIO);p||(p=new CT(this),this.o(p)),p.audioPositioningRefreshRate=N},enumerable:!0,configurable:!0});class CT{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(N){this.name=NT.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new a.xp,this._cachedCameraPosition=new a.xp,this._lastCheck=0,this._invertMatrixTemp=new a.Matrix,this._cameraDirectionTemp=new a.xp,(N=N||k.b.LastCreatedScene)&&(this.Lp=N,N.soundTracks=[],N.ul=[])}register(){this.Lp._afterRenderStage.registerStep(NT.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(N){if(N.ul=[],this.Lp.soundTracks)for(let p=0;p<this.Lp.soundTracks.length;p++){const T=this.Lp.soundTracks[p];for(let p=0;p<T.soundCollection.length;p++)N.ul.push(T.soundCollection[p].serialize())}}addFromContainer(N){if(N.ul)for(const p of N.ul)p.play(),p.autoplay=!0,this.Lp.mainSoundTrack.addSound(p)}removeFromContainer(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(N.ul)for(const T of N.ul)T.stop(),T.autoplay=!1,this.Lp.mainSoundTrack.removeSound(T),p&&T.dispose()}dispose(){const N=this.Lp;if(N._mainSoundTrack&&N.mainSoundTrack.dispose(),N.soundTracks)for(let p=0;p<N.soundTracks.length;p++)N.soundTracks[p].dispose()}disableAudio(){const N=this.Lp;let p;for(this._audioEnabled=!1,Bp.c.audioEngine&&Bp.c.audioEngine.audioContext&&Bp.c.audioEngine.audioContext.suspend(),p=0;p<N.mainSoundTrack.soundCollection.length;p++)N.mainSoundTrack.soundCollection[p].pause();if(N.soundTracks)for(p=0;p<N.soundTracks.length;p++)for(let T=0;T<N.soundTracks[p].soundCollection.length;T++)N.soundTracks[p].soundCollection[T].pause()}enableAudio(){const N=this.Lp;let p;for(this._audioEnabled=!0,Bp.c.audioEngine&&Bp.c.audioEngine.audioContext&&Bp.c.audioEngine.audioContext.resume(),p=0;p<N.mainSoundTrack.soundCollection.length;p++)N.mainSoundTrack.soundCollection[p].isPaused&&N.mainSoundTrack.soundCollection[p].play();if(N.soundTracks)for(p=0;p<N.soundTracks.length;p++)for(let T=0;T<N.soundTracks[p].soundCollection.length;T++)N.soundTracks[p].soundCollection[T].isPaused&&N.soundTracks[p].soundCollection[T].play()}switchAudioModeForHeadphones(){const N=this.Lp;if(this._headphone=!0,N.mainSoundTrack.switchPanningModelToHRTF(),N.soundTracks)for(let p=0;p<N.soundTracks.length;p++)N.soundTracks[p].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const N=this.Lp;if(this._headphone=!1,N.mainSoundTrack.switchPanningModelToEqualPower(),N.soundTracks)for(let p=0;p<N.soundTracks.length;p++)N.soundTracks[p].switchPanningModelToEqualPower()}_afterRender(){const N=aT.d.Now;if(this._lastCheck&&N-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=N;const p=this.Lp;if(!this._audioEnabled||!p._mainSoundTrack||!p.soundTracks||0===p._mainSoundTrack.soundCollection.length&&1===p.soundTracks.length)return;const T=Bp.c.audioEngine;if(T&&T.audioContext){let N,A=p.activeCamera;if(p.activeCameras&&p.activeCameras.length>0&&(A=p.activeCameras[0]),this.audioListenerPositionProvider){const N=this.audioListenerPositionProvider();T.audioContext.listener.setPosition(N.x||0,N.y||0,N.z||0)}else A?this._cachedCameraPosition.equals(A.globalPosition)||(this._cachedCameraPosition.A(A.globalPosition),T.audioContext.listener.setPosition(A.globalPosition.x,A.globalPosition.y,A.globalPosition.z)):T.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const N=this.audioListenerRotationProvider();T.audioContext.listener.setOrientation(N.x||0,N.y||0,N.z||0,0,1,0)}else A?(A.rigCameras&&A.rigCameras.length>0&&(A=A.rigCameras[0]),A.getViewMatrix().invertToRef(this._invertMatrixTemp),a.xp.TransformNormalToRef(CT._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.A(this._cameraDirectionTemp),T.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):T.audioContext.listener.setOrientation(0,0,0,0,1,0);for(N=0;N<p.mainSoundTrack.soundCollection.length;N++){const T=p.mainSoundTrack.soundCollection[N];T.useCustomAttenuation&&T.updateDistanceFromListener()}if(p.soundTracks)for(N=0;N<p.soundTracks.length;N++)for(let T=0;T<p.soundTracks[N].soundCollection.length;T++){const A=p.soundTracks[N].soundCollection[T];A.useCustomAttenuation&&A.updateDistanceFromListener()}}}}CT._CameraDirection=new a.xp(0,0,-1),tp._SceneComponentInitialization=N=>{let p=N._getComponent(NT.c.NAME_AUDIO);p||(p=new CT(N),N.o(p))};const UT="MSFT_audio_emitter";class XT{constructor(N){this.name=UT,this._loader=N,this.enabled=this._loader.isExtensionUsed(UT)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const N=this._loader.TX.extensions;if(N&&N[this.name]){const p=N[this.name];this._clips=p.clips,this._emitters=p.emitters,u.Assign(this._clips),u.Assign(this._emitters)}}loadSceneAsync(N,p){return D.LoadExtensionAsync(N,p,this.name,(async(T,A)=>{const a=new Array;a.push(this._loader.loadSceneAsync(N,p));for(const N of A.emitters){const p=u.Get(`${T}/emitters`,this._emitters,N);if(void 0!=p.refDistance||void 0!=p.maxDistance||void 0!=p.rolloffFactor||void 0!=p.distanceModel||void 0!=p.innerAngle||void 0!=p.outerAngle)throw new Error(`${T}: Direction or Distance properties are not allowed on emitters attached to a scene`);a.push(this._loadEmitterAsync(`${T}/emitters/${p.index}`,p))}await Promise.all(a)}))}loadNodeAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(N,A)=>{const C=new Array,X=await this._loader.loadNodeAsync(N,p,(p=>{for(const T of A.emitters){const A=u.Get(`${N}/emitters`,this._emitters,T);C.push(this._loadEmitterAsync(`${N}/emitters/${A.index}`,A).then((()=>{for(const N of A._babylonSounds)N.attachToMesh(p),void 0==A.innerAngle&&void 0==A.outerAngle||(N.setLocalDirectionToMesh(a.xp.Forward()),N.setDirectionalCone(2*U.Tools.ToDegrees(void 0==A.innerAngle?Math.PI:A.innerAngle),2*U.Tools.ToDegrees(void 0==A.outerAngle?Math.PI:A.outerAngle),0))})))}T(p)}));return await Promise.all(C),X}))}loadAnimationAsync(N,p){return D.LoadExtensionAsync(N,p,this.name,(async(T,A)=>{const a=await this._loader.loadAnimationAsync(N,p),C=new Array;u.Assign(A.events);for(const U of A.events)C.push(this._loadAnimationEventAsync(`${T}/events/${U.index}`,N,p,U,a));return await Promise.all(C),a}))}_loadClipAsync(N,p){if(p._objectURL)return p._objectURL;let T;if(p.uri)T=this._loader.loadUriAsync(N,p,p.uri);else{const A=u.Get(`${N}/bufferView`,this._loader.TX.bufferViews,p.bufferView);T=this._loader.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}return p._objectURL=T.then((N=>URL.createObjectURL(new Blob([N],{type:p.mimeType})))),p._objectURL}_loadEmitterAsync(N,p){if(p._babylonSounds=p._babylonSounds||[],!p._babylonData){const N=new Array,T=p.name||`emitter${p.index}`,A={loop:!1,autoplay:!1,volume:void 0==p.volume?1:p.volume};for(let C=0;C<p.clips.length;C++){const a=`/extensions/${this.name}/clips`,U=u.Get(a,this._clips,p.clips[C].clip);N.push(this._loadClipAsync(`${a}/${p.clips[C].clip}`,U).then((N=>{const a=p._babylonSounds[C]=new tp(T,N,this._loader.babylonScene,null,A);a.refDistance=p.refDistance||1,a.maxDistance=p.maxDistance||256,a.rolloffFactor=p.rolloffFactor||1,a.distanceModel=p.distanceModel||"exponential"})))}const a=Promise.all(N).then((()=>{const N=p.clips.map((N=>N.weight||1)),T=new Sp(p.loop||!1,p._babylonSounds,N);p.innerAngle&&(T.directionalConeInnerAngle=2*U.Tools.ToDegrees(p.innerAngle)),p.outerAngle&&(T.directionalConeOuterAngle=2*U.Tools.ToDegrees(p.outerAngle)),p.volume&&(T.volume=p.volume),p._babylonData.sound=T}));p._babylonData={loaded:a}}return p._babylonData.loaded}_getEventAction(N,p,T,A,a){switch(T){case"play":return N=>{const T=(a||0)+(N-A);p.play(T)};case"stop":return()=>{p.stop()};case"pause":return()=>{p.pause()};default:throw new Error(`${N}: Unsupported action ${T}`)}}_loadAnimationEventAsync(N,p,T,A,a){if(0==a.targetedAnimations.length)return Promise.resolve();const C=a.targetedAnimations[0],U=A.Ap,X=u.Get(`/extensions/${this.name}/emitters`,this._emitters,U);return this._loadEmitterAsync(N,X).then((()=>{const p=X._babylonData.sound;if(p){const T=new Ep(A.time,this._getEventAction(N,p,A.action,A.time,A.startOffset));C.animation.addEvent(T),a.onAnimationGroupEndObservable.add((()=>{p.stop()})),a.onAnimationGroupPauseObservable.add((()=>{p.pause()}))}}))}}h(UT),q(UT,!0,(N=>new XT(N)));const yT="MSFT_lod";class eT{constructor(N){var p;this.name=yT,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new H.c,this.onMaterialLODsLoadedObservable=new H.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=N,this.maxLODsToLoad=(null===(p=this._loader.parent.extensionOptions[yT])||void 0===p?void 0:p.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(yT)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let N=0;N<this._nodePromiseLODs.length;N++){const p=Promise.all(this._nodePromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Node LOD ${N}`),this._loader.log(`Loaded node LOD ${N}`)),this.onNodeLODsLoadedObservable.notifyObservers(N),N!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${N+1}`),this._loadBufferLOD(this._nodeBufferLODs,N+1),this._nodeSignalLODs[N]&&this._nodeSignalLODs[N].resolve())}));this._loader._completePromises.push(p)}for(let N=0;N<this._materialPromiseLODs.length;N++){const p=Promise.all(this._materialPromiseLODs[N]).then((()=>{0!==N&&(this._loader.endPerformanceCounter(`Material LOD ${N}`),this._loader.log(`Loaded material LOD ${N}`)),this.onMaterialLODsLoadedObservable.notifyObservers(N),N!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${N+1}`),this._loadBufferLOD(this._materialBufferLODs,N+1),this._materialSignalLODs[N]&&this._materialSignalLODs[N].resolve())}));this._loader._completePromises.push(p)}}loadSceneAsync(N,p){const T=this._loader.loadSceneAsync(N,p);return this._loadBufferLOD(this._bufferLODs,0),T}loadNodeAsync(N,p,T){return D.LoadExtensionAsync(N,p,this.name,(async(N,a)=>{let C;const U=this._getLODs(N,p,this._loader.TX.nodes,a.ids);this._loader.logOpen(`${N}`);for(let p=0;p<U.length;p++){const N=U[p];0!==p&&(this._nodeIndexLOD=p,this._nodeSignalLODs[p]=this._nodeSignalLODs[p]||new A);const a=N=>{T(N),N.jX(!1)},X=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,a).then((N=>{if(0!==p){const N=U[p-1];N._babylonTransformNode&&(this._disposeTransformNode(N._babylonTransformNode),delete N._babylonTransformNode)}return N.jX(!0),N}));this._nodePromiseLODs[p]=this._nodePromiseLODs[p]||[],0===p?C=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[p].push(X))}return this._loader.logClose(),await C}))}_loadMaterialAsync(N,p,T,A,a){return this._nodeIndexLOD?null:D.LoadExtensionAsync(N,p,this.name,(async(N,C)=>{let U;const X=this._getLODs(N,p,this._loader.TX.materials,C.ids);this._loader.logOpen(`${N}`);for(let p=0;p<X.length;p++){const N=X[p];0!==p&&(this._materialIndexLOD=p);const C=this._loader._loadMaterialAsync(`/materials/${N.index}`,N,T,A,(N=>{0===p&&a(N)})).then((N=>{if(0!==p){a(N);const T=X[p-1]._data;T[A]&&(this._disposeMaterials([T[A].babylonMaterial]),delete T[A])}return N}));this._materialPromiseLODs[p]=this._materialPromiseLODs[p]||[],0===p?U=C:(this._materialIndexLOD=null,this._materialPromiseLODs[p].push(C))}return this._loader.logClose(),await U}))}_loadUriAsync(N,p,T){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const a=this._nodeIndexLOD-1;return this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new A,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(N,p,T)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const a=this._materialIndexLOD-1;return this._materialSignalLODs[a]=this._materialSignalLODs[a]||new A,this._materialSignalLODs[a].promise.then((async()=>await this._loader.loadUriAsync(N,p,T)))}return null}loadBufferAsync(N,p,T,a){if(this._loader.parent.useRangeRequests&&!p.uri){if(!this._loader.bin)throw new Error(`${N}: Uri is missing or the binary glTF is missing its binary chunk`);const p=async(N,p)=>{const C=T,U=C+a-1;let X=N[p];return X?(X.start=Math.min(X.start,C),X.end=Math.max(X.end,U)):(X={start:C,end:U,loaded:new A},N[p]=X),await X.loaded.promise.then((N=>new Uint8Array(N.buffer,N.byteOffset+T-X.start,a)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?p(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?p(this._materialBufferLODs,this._materialIndexLOD):p(this._bufferLODs,0)}return null}_loadBufferLOD(N,p){const T=N[p];T&&(this._loader.log(`Loading buffer range [${T.start}-${T.end}]`),this._loader.bin.readAsync(T.start,T.end-T.start+1).then((N=>{T.loaded.resolve(N)}),(N=>{T.loaded.reject(N)})))}_getLODs(N,p,T,A){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const a=[];for(let C=A.length-1;C>=0;C--)if(a.push(u.Get(`${N}/ids/${A[C]}`,T,A[C])),a.length===this.maxLODsToLoad)return a;return a.push(p),a}_disposeTransformNode(N){const p=[],T=N.material;T&&p.push(T);for(const a of N.getChildMeshes())a.material&&p.push(a.material);N.dispose();const A=p.filter((N=>this._loader.babylonScene.meshes.every((p=>p.material!=N))));this._disposeMaterials(A)}_disposeMaterials(N){const p={};for(const T of N){for(const N of T.getActiveTextures())p[N.uniqueId]=N;T.dispose()}for(const T in p)for(const N of this._loader.babylonScene.materials)N.hasTexture(p[T])&&delete p[T];for(const T in p)p[T].dispose()}}h(yT),q(yT,!0,(N=>new eT(N)));const HT="MSFT_minecraftMesh";class MT{constructor(N){this.name=HT,this._loader=N,this.enabled=this._loader.isExtensionUsed(HT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtraAsync(N,p,this.name,(async(A,a)=>{if(a){if(!(T instanceof w.b))throw new Error(`${A}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(N,p,T);return T.needAlphaBlending()&&(T.forceDepthWrite=!0,T.separateCullingPass=!0),T.lX=T.forceDepthWrite,T.twoSidedLighting=!0,await a}}))}}h(HT),q(HT,!0,(N=>new MT(N)));const bT="MSFT_sRGBFactors";class lT{constructor(N){this.name=bT,this._loader=N,this.enabled=this._loader.isExtensionUsed(bT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(N,p,T){return D.LoadExtraAsync(N,p,this.name,(async(A,a)=>{if(a){if(!(T instanceof w.b))throw new Error(`${A}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(N,p,T),C=T.KN().getEngine().useExactSrgbConversions;return T.albedoTexture||T.albedoColor.toLinearSpaceToRef(T.albedoColor,C),T.reflectivityTexture||T.reflectivityColor.toLinearSpaceToRef(T.reflectivityColor,C),await a}}))}}h(bT),q(bT,!0,(N=>new lT(N)));var kT=T(14066);const xT={};var IT=T(14123),LT=T(14099),nT=T(14071),wT=T(14082);function gT(N,p){for(const T of N)for(const N of T.dataOutputs)if(N.uniqueId===p)return N;throw new Error("Could not find data out connection with unique id "+p)}function PT(N,p){for(const T of N)if(T instanceof LT.c)for(const N of T.signalInputs)if(N.uniqueId===p)return N;throw new Error("Could not find signal in connection with unique id "+p)}async function iT(N,p){const A=await Promise.all(N.allBlocks.map((async N=>{const p=function(N){switch(N){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([T.e(78),T.e(79)]).then(T.bind(T,15488))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await T.e(80).then(T.bind(T,15494))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await T.e(81).then(T.bind(T,15499))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await T.e(82).then(T.bind(T,15502))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await T.e(83).then(T.bind(T,15507))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await T.e(84).then(T.bind(T,15509))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await T.e(85).then(T.bind(T,15514))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await T.e(86).then(T.bind(T,15519))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await T.e(87).then(T.bind(T,15525))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await T.e(95).then(T.bind(T,15563))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await T.e(96).then(T.bind(T,15569))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await T.e(97).then(T.bind(T,15576))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await T.e(98).then(T.bind(T,15583))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await T.e(99).then(T.bind(T,15589))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await T.e(100).then(T.bind(T,15596))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await T.e(101).then(T.bind(T,15599))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await T.e(102).then(T.bind(T,15603))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await T.e(103).then(T.bind(T,15606))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await T.e(104).then(T.bind(T,15608))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await T.e(105).then(T.bind(T,15615))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await T.e(106).then(T.bind(T,15621))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await T.e(107).then(T.bind(T,15628))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await T.e(108).then(T.bind(T,15634))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await T.e(109).then(T.bind(T,15637))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await T.e(110).then(T.bind(T,15639))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await T.e(111).then(T.bind(T,15648))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await T.e(112).then(T.bind(T,15656))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await T.e(113).then(T.bind(T,15663))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await T.e(92).then(T.bind(T,15665))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await T.e(114).then(T.bind(T,15668))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await T.e(115).then(T.bind(T,15671))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await T.e(116).then(T.bind(T,15678))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await T.e(93).then(T.bind(T,15686))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await T.e(88).then(T.bind(T,15528))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await T.e(94).then(T.bind(T,15695))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await T.e(89).then(T.bind(T,15553))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await T.e(90).then(T.bind(T,15556))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await T.e(91).then(T.bind(T,15698))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await T.e(117).then(T.bind(T,15700))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await T.e(118).then(T.bind(T,15706))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await T.e(119).then(T.bind(T,15712))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await T.e(120).then(T.bind(T,15716))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await T.e(121).then(T.bind(T,15721))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await T.e(122).then(T.bind(T,15725))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await T.e(123).then(T.bind(T,15727))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await T.e(124).then(T.bind(T,15733))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await T.e(125).then(T.bind(T,15742))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await T.e(126).then(T.bind(T,15746))).FlowGraphDataSwitchBlock;default:if(xT[N])return xT[N];throw new Error(`Unknown block name ${N}`)}}(N.className);return await p()})));return function(N,p,T){const A=p.coordinator.createGraph(),a=[],C=p.valueParseFunction??nT.b;for(let U=0;U<N.allBlocks.length;U++){const X=FT(N.allBlocks[U],{Lp:p.coordinator.config.Lp,pathConverter:p.pathConverter,assetsContainer:p.coordinator.config.Lp,valueParseFunction:C},T[U]);a.push(X),X instanceof IT.d&&A.addEventBlock(X)}for(const U of a){for(const N of U.dataInputs)for(const p of N.connectedPointIds){const T=gT(a,p);N.connectTo(T)}if(U instanceof LT.c)for(const N of U.signalOutputs)for(const p of N.connectedPointIds){const T=PT(a,p);N.connectTo(T)}}for(const U of N.executionContexts)KT(U,{graph:A,valueParseFunction:C},N.rightHanded);return A}(N,p,A)}function KT(N,p,T){const A=p.graph.createContext();N.enableLogging&&(A.enableLogging=!0),A.treatDataAsRightHanded=T||!1;const a=p.valueParseFunction??nT.b;A.uniqueId=N.uniqueId;const C=A.KN();if(N._assetsContext){var U,X,y,e,H,M,b,l,k,x;const p=N._assetsContext,T={meshes:null===(U=p.meshes)||void 0===U?void 0:U.map((N=>C.getMeshById(N))),lights:null===(X=p.lights)||void 0===X?void 0:X.map((N=>C.getLightByName(N))),cameras:null===(y=p.cameras)||void 0===y?void 0:y.map((N=>C.getCameraByName(N))),materials:null===(e=p.materials)||void 0===e?void 0:e.map((N=>C.getMaterialById(N))),textures:null===(H=p.textures)||void 0===H?void 0:H.map((N=>C.getTextureByName(N))),animations:null===(M=p.animations)||void 0===M?void 0:M.map((N=>C.animations.find((p=>p.name===N)))),skeletons:null===(b=p.skeletons)||void 0===b?void 0:b.map((N=>C.getSkeletonByName(N))),Ul:null===(l=p.Ul)||void 0===l?void 0:l.map((N=>C.getParticleSystemById(N))),animationGroups:null===(k=p.animationGroups)||void 0===k?void 0:k.map((N=>C.getAnimationGroupByName(N))),transformNodes:null===(x=p.transformNodes)||void 0===x?void 0:x.map((N=>C.getTransformNodeById(N))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ul:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};A.assetsContext=T}for(const I in N._userVariables){const p=a(I,N._userVariables,A.assetsContext,C);A.userVariables[I]=p}for(const I in N._connectionValues){const p=a(I,N._connectionValues,A.assetsContext,C);A._setConnectionValueByKey(I,p)}return A}function FT(N,p,T){const A={},a=p.valueParseFunction??nT.b;if(N.config)for(const U in N.config)A[U]=a(U,N.config,p.assetsContainer||p.Lp,p.Lp);if((0,nT.f)(N.className)){if(!p.pathConverter)throw new Error("Path converter is required for this block");A.pathConverter=p.pathConverter}const C=new T(A);C.uniqueId=N.uniqueId;for(let U=0;U<N.dataInputs.length;U++){const p=C.getDataInput(N.dataInputs[U].name);if(!p)throw new Error("Could not find data input with name "+N.dataInputs[U].name+" in block "+N.className);p.deserialize(N.dataInputs[U])}for(let U=0;U<N.dataOutputs.length;U++){const p=C.getDataOutput(N.dataOutputs[U].name);if(!p)throw new Error("Could not find data output with name "+N.dataOutputs[U].name+" in block "+N.className);p.deserialize(N.dataOutputs[U])}return C.metadata=N.metadata,C.deserialize&&C.deserialize(N),C}function vT(N){const[p,T]=N.split(":");return WT({op:p,extension:T})}function WT(N){var p;let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=N.extension?null===(p=RT[N.extension])||void 0===p?void 0:p[N.op]:JT[N.op];if(!A&&(x.d.Warn(`No mapping found for operation ${N.op} and extension ${N.extension||"KHR_interactivity"}`),T)){const p={},T={flows:{}};if(N.inputValueSockets){p.values={};for(const T in N.inputValueSockets)p.values[T]={name:T}}return N.outputValueSockets&&(T.values={},Object.keys(N.outputValueSockets).forEach((N=>{T.values[N]={name:N}}))),{jH:[],inputs:p,outputs:T}}return A}function zT(N,p,T){RT[p]||(RT[p]={}),RT[p][N]=T}const RT={BABYLON:{"flow/log":{jH:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},JT={"event/onStart":{jH:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{jH:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{jH:["FlowGraphSendCustomEventBlock"],extraProcessor(N,p,T,A,a){if("event/send"!==p.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=N.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const U=A.arrays.events[C],X=a[0];return X.config||(X.config={}),X.config.eventId=U.eventId,X.config.eventData=U.eventData,a}},"event/receive":{jH:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(N,p){var T;if(!N.configuration)return x.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const A=N.configuration.event;if(!A)return x.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const a=A.value[0];if("number"!==typeof a)return x.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(T=p.events)||void 0===T?void 0:T[a])?{valid:!0}:(x.d.Error(`Event with id ${a} not found`),{valid:!1,error:`Event with id ${a} not found`})},extraProcessor(N,p,T,A,a){if("event/receive"!==p.op||!N.configuration||1!==Object.keys(N.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const C=N.configuration.event.value[0];if("number"!==typeof C)throw new Error("Event id should be a number");const U=A.arrays.events[C],X=a[0];return X.config||(X.config={}),X.config.eventId=U.eventId,X.config.eventData=U.eventData,a}},"math/e":fT("FlowGraphEBlock"),"math/pi":fT("FlowGraphPIBlock"),"math/inf":fT("FlowGraphInfBlock"),"math/nan":fT("FlowGraphNaNBlock"),"math/abs":fT("FlowGraphAbsBlock"),"math/sign":fT("FlowGraphSignBlock"),"math/trunc":fT("FlowGraphTruncBlock"),"math/floor":fT("FlowGraphFloorBlock"),"math/ceil":fT("FlowGraphCeilBlock"),"math/round":{jH:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a){var C;return(C=a[0]).config||(C.config={}),a[0].config.roundHalfAwayFromZero=!0,a}},"math/fract":fT("FlowGraphFractBlock"),"math/neg":fT("FlowGraphNegationBlock"),"math/add":fT("FlowGraphAddBlock",["a","b"],!0),"math/sub":fT("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{jH:["FlowGraphMultiplyBlock"],extraProcessor(N,p,T,A,a){var C;(C=a[0]).config||(C.config={}),a[0].config.useMatrixPerComponent=!0,a[0].config.preventIntegerFloatArithmetic=!0;let U=-1;return Object.keys(N.values||{}).find((p=>{var T;return void 0!==(null===(T=N.values)||void 0===T?void 0:T[p].type)&&(U=N.values[p].type,!0)})),-1!==U&&(a[0].config.type=A.arrays.types[U].flowGraphType),a},validation:N=>N.values?GT(N):{valid:!0}},"math/div":fT("FlowGraphDivideBlock",["a","b"],!0),"math/rem":fT("FlowGraphModuloBlock",["a","b"]),"math/min":fT("FlowGraphMinBlock",["a","b"]),"math/max":fT("FlowGraphMaxBlock",["a","b"]),"math/clamp":fT("FlowGraphClampBlock",["a","b","c"]),"math/saturate":fT("FlowGraphSaturateBlock"),"math/mix":fT("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":fT("FlowGraphEqualityBlock",["a","b"]),"math/lt":fT("FlowGraphLessThanBlock",["a","b"]),"math/le":fT("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":fT("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":fT("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":fT("FlowGraphIsNaNBlock"),"math/isinf":fT("FlowGraphIsInfBlock"),"math/select":{jH:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{jH:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":fT("FlowGraphSinBlock"),"math/cos":fT("FlowGraphCosBlock"),"math/tan":fT("FlowGraphTanBlock"),"math/asin":fT("FlowGraphASinBlock"),"math/acos":fT("FlowGraphACosBlock"),"math/atan":fT("FlowGraphATanBlock"),"math/atan2":fT("FlowGraphATan2Block",["a","b"]),"math/sinh":fT("FlowGraphSinhBlock"),"math/cosh":fT("FlowGraphCoshBlock"),"math/tanh":fT("FlowGraphTanhBlock"),"math/asinh":fT("FlowGraphASinhBlock"),"math/acosh":fT("FlowGraphACoshBlock"),"math/atanh":fT("FlowGraphATanhBlock"),"math/exp":fT("FlowGraphExponentialBlock"),"math/log":fT("FlowGraphLogBlock"),"math/log2":fT("FlowGraphLog2Block"),"math/log10":fT("FlowGraphLog10Block"),"math/sqrt":fT("FlowGraphSquareRootBlock"),"math/cbrt":fT("FlowGraphCubeRootBlock"),"math/pow":fT("FlowGraphPowerBlock",["a","b"]),"math/length":fT("FlowGraphLengthBlock"),"math/normalize":fT("FlowGraphNormalizeBlock"),"math/dot":fT("FlowGraphDotBlock",["a","b"]),"math/cross":fT("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":fT("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":fT("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{jH:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{jH:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{jH:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{jH:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{jH:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{jH:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{jH:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":fT("FlowGraphTransposeBlock"),"math/determinant":fT("FlowGraphDeterminantBlock"),"math/inverse":fT("FlowGraphInvertMatrixBlock"),"math/matmul":fT("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{jH:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"xX",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a,C){const U=a[0].dataInputs.find((N=>"rotationQuaternion"===N.name));if(!U)throw new Error("Rotation quaternion input not found");return C._connectionValues[U.uniqueId]&&(C._connectionValues[U.uniqueId].type="Quaternion"),a}},"math/matDecompose":{jH:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"xX"}}}},"math/quatConjugate":fT("FlowGraphConjugateBlock",["a"]),"math/quatMul":{jH:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a){var C;return(C=a[0]).config||(C.config={}),a[0].config.type="Quaternion",a}},"math/quatAngleBetween":fT("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{jH:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":fT("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":fT("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{jH:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a){var C;return(C=a[0]).config||(C.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract2x2":{jH:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{jH:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a){var C;return(C=a[0]).config||(C.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract3x3":{jH:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{jH:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a){var C;return(C=a[0]).config||(C.config={}),a[0].config.inputIsColumnMajor=!0,a}},"math/extract4x4":{jH:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{jH:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a,C){var U,X;(X=a[0]).config||(X.config={});const y=a[0].dataInputs[0];return a[0].config.valueType=(null===(U=C._connectionValues[y.uniqueId])||void 0===U?void 0:U.type)??"FlowGraphInteger",a}},"math/and":{jH:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a,C){var U,X,y;(y=a[0]).config||(y.config={});const e=a[0].dataInputs[0],H=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=C._connectionValues[e.uniqueId])||void 0===U?void 0:U.type)??(null===(X=C._connectionValues[H.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",a}},"math/or":{jH:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a,C){var U,X,y;(y=a[0]).config||(y.config={});const e=a[0].dataInputs[0],H=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=C._connectionValues[e.uniqueId])||void 0===U?void 0:U.type)??(null===(X=C._connectionValues[H.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",a}},"math/xor":{jH:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(N,p,T,A,a,C){var U,X,y;(y=a[0]).config||(y.config={});const e=a[0].dataInputs[0],H=a[0].dataInputs[1];return a[0].config.valueType=(null===(U=C._connectionValues[e.uniqueId])||void 0===U?void 0:U.type)??(null===(X=C._connectionValues[H.uniqueId])||void 0===X?void 0:X.type)??"FlowGraphInteger",a}},"math/asr":fT("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":fT("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":fT("FlowGraphLeadingZerosBlock"),"math/ctz":fT("FlowGraphTrailingZerosBlock"),"math/popcnt":fT("FlowGraphOneBitsCounterBlock"),"math/rad":fT("FlowGraphDegToRadBlock"),"math/deg":fT("FlowGraphRadToDegBlock"),"type/boolToInt":fT("FlowGraphBooleanToInt"),"type/boolToFloat":fT("FlowGraphBooleanToFloat"),"type/intToBool":fT("FlowGraphIntToBoolean"),"type/intToFloat":fT("FlowGraphIntToFloat"),"type/floatToInt":fT("FlowGraphFloatToInt"),"type/floatToBool":fT("FlowGraphFloatToBoolean"),"flow/sequence":{jH:["FlowGraphSequenceBlock"],extraProcessor(N,p,T,A,a){const C=a[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(N.flows||[]).length,C.signalOutputs.forEach(((N,p)=>{N.name="out_"+p})),a}},"flow/branch":{jH:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{jH:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(N){if(N.configuration&&N.configuration.cases){const p=N.configuration.cases.value;if(!p.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return x.d.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const T=new Set(p);N.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(N,p,T,A,a){if("flow/switch"!==p.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return a[0].signalOutputs.forEach((N=>{"default"!==N.name&&(N.name="out_"+N.name)})),a}},"flow/while":{jH:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{jH:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(N,p,T,A,a){const C=a[0];return C.config||(C.config={}),C.config.incrementIndexWhenLoopDone=!0,a}},"flow/doN":{jH:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{jH:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(N,p,T,A,a){if("flow/multiGate"!==p.op||!N.flows||0===Object.keys(N.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const C=a[0];return C.config||(C.config={}),C.config.outputSignalCount=Object.keys(N.flows).length,C.signalOutputs.forEach(((N,p)=>{N.name="out_"+p})),a}},"flow/waitAll":{jH:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(N){var p,T;return"number"!==typeof(null===(p=N.configuration)||void 0===p||null===(T=p.inputFlows)||void 0===T?void 0:T.value[0])&&(N.configuration=N.configuration||{inputFlows:{value:[0]}},N.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{jH:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{jH:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{jH:["FlowGraphCancelDelayBlock"]},"variable/get":{jH:["FlowGraphGetVariableBlock"],validation(N){var p,T;return null!==(p=N.configuration)&&void 0!==p&&null!==(T=p.variable)&&void 0!==T&&T.value?{valid:!0}:(x.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,p)=>[p.getVariableName(N[0])]}}},"variable/set":{jH:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(N,p)=>[p.getVariableName(N[0])]}}},"variable/setMultiple":{jH:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(N,p)=>[N[0].map((N=>p.getVariableName(N)))]}},extraProcessor:(N,p,T,A,a)=>(a[0].dataInputs.forEach((N=>{N.name=A.getVariableName(+N.name)})),a)},"variable/interpolate":{jH:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(N,p)=>[p.getVariableName(N[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:N=>!0===N[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",wT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",wT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",wT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",wT:"FlowGraphPlayAnimationBlock"},out:{name:"out",wT:"FlowGraphPlayAnimationBlock"},done:{name:"done",wT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(N,p,T,A,a){var C,U,X;const y=a[0],e=null===(C=N.configuration)||void 0===C?void 0:C.variable.value[0];if("number"!==typeof e)throw x.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const H=A.arrays.staticVariables[e];"undefined"===typeof y.config.animationType.value&&(A.arrays.staticVariables,y.config.animationType.value=(0,wT.G)(H.type));const M=a[4];return M.config||(M.config={}),(U=M.config).variable||(U.variable={}),M.config.variable.value=A.getVariableName(e),(X=a[3]).config||(X.config={}),a}},"pointer/get":{jH:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",wT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",wT:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,p,T,A,a)=>(a.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),a)},"pointer/set":{jH:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",wT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",wT:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,p,T,A,a)=>(a.forEach((N=>{"FlowGraphJsonPointerParserBlock"===N.className&&(N.config||(N.config={}),N.config.outputValue=!0)})),a)},"pointer/interpolate":{jH:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",wT:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",wT:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",wT:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",wT:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",wT:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",wT:"FlowGraphPlayAnimationBlock"},out:{name:"out",wT:"FlowGraphPlayAnimationBlock"},done:{name:"done",wT:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(N,p,T,A,a)=>(a.forEach((p=>{"FlowGraphJsonPointerParserBlock"===p.className?(p.config||(p.config={}),p.config.outputValue=!0):"FlowGraphInterpolationBlock"===p.className&&(p.config||(p.config={}),Object.keys(N.values||[]).forEach((T=>{var a;const C=null===(a=N.values)||void 0===a?void 0:a[T];if("value"===T&&C){const N=C.type;void 0!==N&&(p.config.animationType=A.arrays.types[N].flowGraphType)}})))})),a)},"animation/start":{jH:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",wT:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(N,p)=>[N[0]*p._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(N,p)=>[N[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){const X=a[a.length-1];return X.config||(X.config={}),X.config.glTF=U,a}},"animation/stop":{jH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",wT:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){const X=a[a.length-1];return X.config||(X.config={}),X.config.glTF=U,a}},"animation/stopAt":{jH:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",wT:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(N,p)=>[N[0]*p._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){const X=a[a.length-1];return X.config||(X.config={}),X.config.glTF=U,a}},"math/switch":{jH:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(N){if(N.configuration&&N.configuration.cases){const p=N.configuration.cases.value;if(!p.every((N=>"number"===typeof N&&/^-?\d+$/.test(N.toString()))))return x.d.Warn("Switch cases should be integers. Using empty array instead."),N.configuration.cases.value=[],{valid:!0};const T=new Set(p);N.configuration.cases.value=Array.from(T)}return{valid:!0}},extraProcessor(N,p,T,A,a){const C=a[0];return C.dataInputs.forEach((N=>{"default"!==N.name&&"case"!==N.name&&(N.name="in_"+N.name)})),C.config||(C.config={}),C.config.treatCasesAsIntegers=!0,a}},"debug/log":{jH:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function fT(N){let p=arguments.length>2?arguments[2]:void 0;return{jH:[N],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((N,p)=>(N[p]={name:p},N)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(N,T,A,a,C){var U;if(p){(U=C[0]).config||(U.config={}),C[0].config.preventIntegerFloatArithmetic=!0;let p=-1;Object.keys(N.values||{}).find((T=>{var A;return void 0!==(null===(A=N.values)||void 0===A?void 0:A[T].type)&&(p=N.values[T].type,!0)})),-1!==p&&(C[0].config.type=a.arrays.types[p].flowGraphType)}return C},validation:N=>p?GT(N):{valid:!0}}}function GT(N){if(N.values){const p=Object.keys(N.values).map((p=>N.values[p].type)).filter((N=>void 0!==N));if(!p.every((N=>N===p[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}JT["math/compose"]=JT["math/matCompose"],JT["math/decompose"]=JT["math/matDecompose"];var oT=T(12333);const ZT={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"xp",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class mA{constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=N,this._gltf=p,this._animationTargetFps=T,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const N of this._interactivityGraph.types)this._types.push(ZT[N.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const N of this._interactivityGraph.declarations){const p=WT(N);if(!p)throw x.d.Error(["No mapping found for declaration",N]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:p,fullOperationName:N.extension?N.op+":"+N.extension:N.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const N of this._interactivityGraph.variables){const p=this._parseVariable(N);this._staticVariables.push(p)}}_parseVariable(N,p){const T=this._types[N.type];if(!T)throw x.d.Error(["No type found for variable",N]),new Error("Error parsing variables");if(N.value&&N.value.length!==T.length)throw x.d.Error(["Invalid value length for variable",N,T]),new Error("Error parsing variables");const A=N.value||[];if(!A.length)switch(T.flowGraphType){case"boolean":A.push(!1);break;case"FlowGraphInteger":A.push(0);break;case"number":A.push(NaN);break;case"Vector2":A.push(NaN,NaN);break;case"xp":A.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":A.fill(NaN,0,4);break;case"Matrix":A.fill(NaN,0,16);break;case"Matrix3D":A.fill(NaN,0,9)}return"number"===T.elementType&&"string"===typeof A[0]&&(A[0]=parseFloat(A[0])),{type:T.flowGraphType,value:p?p(A,this):A}}_parseEvents(){if(this._interactivityGraph.events)for(const N of this._interactivityGraph.events){const p={eventId:N.id||"internalEvent_"+this._internalEventsCounter++};N.values&&(p.eventData=Object.keys(N.values).map((p=>{var T;const A=null===(T=N.values)||void 0===T?void 0:T[p];if(!A)throw x.d.Error(["No value found for event key",p]),new Error("Error parsing events");const a=this._types[A.type];if(!a)throw x.d.Error(["No type found for event value",A]),new Error("Error parsing events");const C="undefined"!==typeof A.value?this._parseVariable(A):void 0;return{id:p,type:a.flowGraphType,eventData:!0,value:C}}))),this._events.push(p)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const p of this._interactivityGraph.nodes){if("number"!==typeof p.declaration)throw x.d.Error(["No declaration found for node",p]),new Error("Error parsing nodes");const T=this._mappings[p.declaration];if(!T)throw x.d.Error(["No mapping found for node",p]),new Error("Error parsing nodes");if(T.flowGraphMapping.validation){const A=T.flowGraphMapping.validation(p,this._interactivityGraph,this._gltf);var N;if(!A.valid)throw new Error(`Error validating interactivity node ${null===(N=this._interactivityGraph.declarations)||void 0===N?void 0:N[p.declaration].op} - ${A.error}`)}const A=[];for(const N of T.flowGraphMapping.jH){const a=this._getEmptyBlock(N,T.fullOperationName);this._parseNodeConfiguration(p,a,T.flowGraphMapping,N),A.push(a)}this._nodes.push({jH:A,fullOperationName:T.fullOperationName})}}_getEmptyBlock(N,p){return{uniqueId:(0,oT.b)(),className:N,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:p,metadata:{}}}_parseNodeConfiguration(N,p,T,A){const a=p.config;if(N.configuration){const p=Object.keys(N.configuration);for(const X of p){var C,U;const p=null===(C=N.configuration)||void 0===C?void 0:C[X];if(!p)throw x.d.Error(["No value found for node configuration",X]),new Error("Error parsing node configuration");const y=null===(U=T.configuration)||void 0===U?void 0:U[X];if(y&&y.wT?y.wT===A:0===T.jH.indexOf(A)){const N=(null===y||void 0===y?void 0:y.name)||X;p&&"undefined"!==typeof p.value||"undefined"===typeof(null===y||void 0===y?void 0:y.defaultValue)?p.value.length>=0?a[N]={value:1===p.value.length?p.value[0]:p.value}:x.d.Warn(["Invalid value for node configuration",p]):a[N]={value:y.defaultValue},y&&y.dataTransformer&&(a[N].value=y.dataTransformer([a[N].value],this)[0])}}}}_parseNodeConnections(N){for(let i=0;i<this._nodes.length;i++){var p;const K=null===(p=this._interactivityGraph.nodes)||void 0===p?void 0:p[i];if(!K)throw x.d.Error(["No node found for interactivity node",this._nodes[i]]),new Error("Error parsing node connections");const F=this._nodes[i],v=this._mappings[K.declaration];if(!v)throw x.d.Error(["No mapping found for node",K]),new Error("Error parsing node connections");const W=K.flows||{},z=Object.keys(W).sort();for(const N of z){var T,A,a,C;const p=W[N],e=null===(T=v.flowGraphMapping.outputs)||void 0===T||null===(A=T.flows)||void 0===A?void 0:A[N],H=(null===e||void 0===e?void 0:e.name)||N,M=this._createNewSocketConnection(H,!0);(e&&e.wT&&F.jH.find((N=>N.className===e.wT))||F.jH[0]).signalOutputs.push(M);const b=p.node,l=this._nodes[b];if(!l)throw x.d.Error(["No node found for input node id",b]),new Error("Error parsing node connections");const k=vT(l.fullOperationName);if(!k)throw x.d.Error(["No mapping found for input node",l]),new Error("Error parsing node connections");let I=null===(a=k.inputs)||void 0===a||null===(C=a.flows)||void 0===C?void 0:C[p.socket||"in"],L=!1;if(!I)for(const N in null===(U=k.inputs)||void 0===U?void 0:U.flows){var U,X,y;if(N.startsWith("[")&&N.endsWith("]"))L=!0,I=null===(X=k.inputs)||void 0===X||null===(y=X.flows)||void 0===y?void 0:y[N]}const n=I?L?I.name.replace("$1",p.socket||""):I.name:p.socket||"in",w=I&&I.wT&&l.jH.find((N=>N.className===I.wT))||l.jH[0];let g=w.signalInputs.find((N=>N.name===n));g||(g=this._createNewSocketConnection(n),w.signalInputs.push(g)),g.connectedPointIds.push(M.uniqueId),M.connectedPointIds.push(g.uniqueId)}const R=K.values||{},J=Object.keys(R);for(const p of J){var e,H;const T=R[p];let A=null===(e=v.flowGraphMapping.inputs)||void 0===e||null===(H=e.values)||void 0===H?void 0:H[p],a=!1;if(!A)for(const N in null===(M=v.flowGraphMapping.inputs)||void 0===M?void 0:M.values){var M,b,l;if(N.startsWith("[")&&N.endsWith("]"))a=!0,A=null===(b=v.flowGraphMapping.inputs)||void 0===b||null===(l=b.values)||void 0===l?void 0:l[N]}const C=A?a?A.name.replace("$1",p):A.name:p,U=this._createNewSocketConnection(C);if((A&&A.wT&&F.jH.find((N=>N.className===A.wT))||F.jH[0]).dataInputs.push(U),void 0!==T.value){const p=this._parseVariable(T,A&&A.dataTransformer);N._connectionValues[U.uniqueId]=p}else{if("undefined"===typeof T.node)throw x.d.Error(["Invalid value for value connection",T]),new Error("Error parsing node connections");{var k,I,L;const N=T.node,p=T.socket||"value",A=this._nodes[N];if(!A)throw x.d.Error(["No node found for output socket reference",T]),new Error("Error parsing node connections");const a=vT(A.fullOperationName);if(!a)throw x.d.Error(["No mapping found for output socket reference",T]),new Error("Error parsing node connections");let C=null===(k=a.outputs)||void 0===k||null===(I=k.values)||void 0===I?void 0:I[p],X=!1;if(!C)for(const T in null===(n=a.outputs)||void 0===n?void 0:n.values){var n,w,g;if(T.startsWith("[")&&T.endsWith("]"))X=!0,C=null===(w=a.outputs)||void 0===w||null===(g=w.values)||void 0===g?void 0:g[T]}const y=C?X?C.name.replace("$1",p):null===(L=C)||void 0===L?void 0:L.name:p,e=C&&C.wT&&A.jH.find((N=>N.className===C.wT))||A.jH[0];let H=e.dataOutputs.find((N=>N.name===y));H||(H=this._createNewSocketConnection(y,!0),e.dataOutputs.push(H)),U.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(U.uniqueId)}}}if(v.flowGraphMapping.interBlockConnectors)for(const N of v.flowGraphMapping.interBlockConnectors){const p=N.input,T=N.output,A=N.isVariable;this._connectFlowGraphNodes(p,T,F.jH[N.inputBlockIndex],F.jH[N.outputBlockIndex],A)}if(v.flowGraphMapping.extraProcessor){var P;const p=null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[K.declaration];if(!p)throw x.d.Error(["No declaration found for extra processor",K]),new Error("Error parsing node connections");F.jH=v.flowGraphMapping.extraProcessor(K,p,v.flowGraphMapping,this,F.jH,N,this._gltf)}}}_createNewSocketConnection(N,p){return{uniqueId:(0,oT.b)(),name:N,_connectionType:p?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(N,p,T,A,a){const C=a?T.dataInputs:T.signalInputs,U=a?A.dataOutputs:A.signalOutputs,X=C.find((p=>p.name===N))||this._createNewSocketConnection(N),y=U.find((N=>N.name===p))||this._createNewSocketConnection(p,!0);C.find((p=>p.name===N))||C.push(X),U.find((N=>N.name===p))||U.push(y),X.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(X.uniqueId)}getVariableName(N){return"staticVariable_"+N}serializeToFlowGraph(){const N={uniqueId:(0,oT.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(N);for(let p=0;p<this._staticVariables.length;p++){const T=this._staticVariables[p];N._userVariables[this.getVariableName(p)]=T}return{rightHanded:!0,allBlocks:this._nodes.reduce(((N,p)=>N.concat(p.jH)),[]),executionContexts:[N]}}}const qT="KHR_interactivity";class hT{constructor(N){this._loader=N,this.name=qT,this.enabled=this._loader.isExtensionUsed(qT),this._pathConverter=(0,j.k)(this._loader.TX),N._skipStartAnimationStep=!0;const p=N.babylonScene;p&&function(N){(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!N.activeCamera)return new a.Quaternion(NaN,NaN,NaN,NaN);const p=a.Quaternion.FromRotationMatrix(N.activeCamera.getWorldMatrix()).normalize();return N.useRightHandedSystem||(p.w*=-1,p.x*=-1),p},type:"Quaternion",getTarget:()=>N.activeCamera}),(0,j.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!N.activeCamera)return new a.xp(NaN,NaN,NaN);const p=N.activeCamera.getWorldMatrix().getTranslation();return N.useRightHandedSystem||(p.x*=-1),p},type:"xp",getTarget:()=>N.activeCamera}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:N=>{var p;return(null===(p=N._babylonAnimationGroup)||void 0===p?void 0:p.isPlaying)??!1},type:"boolean",getTarget:N=>N._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:N=>{var p;return((null===(p=N._babylonAnimationGroup)||void 0===p?void 0:p.from)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:N=>{var p;return((null===(p=N._babylonAnimationGroup)||void 0===p?void 0:p.to)??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:N=>{var p;return((null===(p=N._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup}),(0,j.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:N=>{var p;return((null===(p=N._babylonAnimationGroup)||void 0===p?void 0:p.getCurrentFrame())??0)/60},type:"number",getTarget:N=>N._babylonAnimationGroup})}(p)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var N;if(!this._loader.babylonScene||!this._pathConverter)return;const p=this._loader.babylonScene,T=null===(N=this._loader.TX.extensions)||void 0===N?void 0:N.KHR_interactivity;if(!T)return;const A=new kT.b({Lp:p});A.dispatchEventsSynchronously=!1;const a=T.graphs.map((N=>new mA(N,this._loader.TX,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(a.map((async N=>await iT(N,{coordinator:A,pathConverter:this._pathConverter})))),A.start()}}var jT;jT=async()=>(await Promise.resolve().then(T.bind(T,14132))).FlowGraphGLTFDataProvider,xT[`${qT}/${"FlowGraphGLTFDataProvider"}`]=jT,h(qT),q(qT,!0,(N=>new hT(N)));const VT="KHR_node_visibility";(0,j.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:N=>{const p=N._babylonTransformNode;return!p||void 0===p.isVisible||p.isVisible},set:(N,p)=>{var T,A;null===(T=p._primitiveBabylonMeshes)||void 0===T||T.forEach((N=>{N.inheritVisibility=!0})),p._babylonTransformNode&&(p._babylonTransformNode.isVisible=N),null===(A=p._primitiveBabylonMeshes)||void 0===A||A.forEach((p=>{p.isVisible=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class rT{constructor(N){this.name=VT,this._loader=N,this.enabled=N.isExtensionUsed(VT)}async onReady(){var N;null===(N=this._loader.TX.nodes)||void 0===N||N.forEach((N=>{var p,T,A,a;(null===(p=N._primitiveBabylonMeshes)||void 0===p||p.forEach((N=>{N.inheritVisibility=!0})),null!==(T=N.extensions)&&void 0!==T&&T.KHR_node_visibility)&&(!1===(null===(A=N.extensions)||void 0===A?void 0:A.KHR_node_visibility.visible)&&(N._babylonTransformNode&&(N._babylonTransformNode.isVisible=!1),null===(a=N._primitiveBabylonMeshes)||void 0===a||a.forEach((N=>{N.isVisible=!1}))))}))}dispose(){this._loader=null}}h(VT),q(VT,!0,(N=>new rT(N)));const uT="KHR_node_selectability";zT("event/onSelect",uT,{jH:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",wT:"FlowGraphGetVariableBlock",dataTransformer:N=>["pickedMesh_"+N[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",wT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){var X,y,e,H,M,b;const l=a[a.length-1];l.config=l.config||{},l.config.glTF=U;const k=null===(X=N.configuration)||void 0===X||null===(y=X.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const x="pickedMesh_"+k;return a[1].config.variable=x,C._userVariables[x]={className:"Mesh",id:null===U||void 0===U||null===(e=U.nodes)||void 0===e||null===(H=e[k]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===U||void 0===U||null===(M=U.nodes)||void 0===M||null===(b=M[k]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},a}}),(0,j.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:N=>{const p=N._babylonTransformNode;return!p||void 0===p.hy||p.hy},set:(N,p)=>{var T;null===(T=p._primitiveBabylonMeshes)||void 0===T||T.forEach((p=>{p.hy=N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"hy"],type:"boolean"});class YT{constructor(N){this.name=uT,this._loader=N,this.enabled=N.isExtensionUsed(uT)}async onReady(){var N;null===(N=this._loader.TX.nodes)||void 0===N||N.forEach((N=>{var p,T,A;null!==(p=N.extensions)&&void 0!==p&&p.KHR_node_selectability&&!1===(null===(T=N.extensions)||void 0===T?void 0:T.KHR_node_selectability.selectable)&&(null===(A=N._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((N=>{N.hy=!1})))}))}dispose(){this._loader=null}}h(uT),q(uT,!0,(N=>new YT(N)));const DT="KHR_node_hoverability",cT="targetMeshPointerOver_";zT("event/onHoverIn",DT,{jH:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",wT:"FlowGraphGetVariableBlock",dataTransformer:N=>[cT+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",wT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){var X,y,e,H,M,b;const l=a[a.length-1];l.config=l.config||{},l.config.glTF=U;const k=null===(X=N.configuration)||void 0===X||null===(y=X.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const x=cT+k;return a[1].config.variable=x,C._userVariables[x]={className:"Mesh",id:null===U||void 0===U||null===(e=U.nodes)||void 0===e||null===(H=e[k]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===U||void 0===U||null===(M=U.nodes)||void 0===M||null===(b=M[k]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},a}});const QT="targetMeshPointerOut_";zT("event/onHoverOut",DT,{jH:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",wT:"FlowGraphGetVariableBlock",dataTransformer:N=>[QT+N[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",wT:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(N,p,T,A,a,C,U){var X,y,e,H,M,b;const l=a[a.length-1];l.config=l.config||{},l.config.glTF=U;const k=null===(X=N.configuration)||void 0===X||null===(y=X.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const x=QT+k;return a[1].config.variable=x,C._userVariables[x]={className:"Mesh",id:null===U||void 0===U||null===(e=U.nodes)||void 0===e||null===(H=e[k]._babylonTransformNode)||void 0===H?void 0:H.id,uniqueId:null===U||void 0===U||null===(M=U.nodes)||void 0===M||null===(b=M[k]._babylonTransformNode)||void 0===b?void 0:b.uniqueId},a}}),(0,j.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:N=>{const p=N._babylonTransformNode;return!p||void 0===p.pointerOverDisableMeshTesting||p.pointerOverDisableMeshTesting},set:(N,p)=>{var T;null===(T=p._primitiveBabylonMeshes)||void 0===T||T.forEach((p=>{p.pointerOverDisableMeshTesting=!N}))},getTarget:N=>N._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class ET{constructor(N){this.name=DT,this._loader=N,this.enabled=N.isExtensionUsed(DT)}async onReady(){var N;null===(N=this._loader.TX.nodes)||void 0===N||N.forEach((N=>{var p,T,A;null!==(p=N.extensions)&&void 0!==p&&p.KHR_node_hoverability&&!1===(null===(T=N.extensions)||void 0===T?void 0:T.KHR_node_hoverability.hoverable)&&(null===(A=N._babylonTransformNode)||void 0===A||A.getChildMeshes().forEach((N=>{N.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}h(DT),q(DT,!0,(N=>new ET(N)));const OT="ExtrasAsMetadata";class BT{_assignExtras(N,p){if(p.extras&&Object.keys(p.extras).length>0){const T=N.metadata=N.metadata||{};(T.TX=T.TX||{}).extras=p.extras}}constructor(N){this.name=OT,this.enabled=!0,this._loader=N}dispose(){this._loader=null}loadNodeAsync(N,p,T){return this._loader.loadNodeAsync(N,p,(N=>{this._assignExtras(N,p),T(N)}))}loadCameraAsync(N,p,T){return this._loader.loadCameraAsync(N,p,(N=>{this._assignExtras(N,p),T(N)}))}createMaterial(N,p,T){const A=this._loader.createMaterial(N,p,T);return this._assignExtras(A,p),A}}h(OT),q(OT,!1,(N=>new BT(N)));T(14132)},14007:(N,p,T)=>{"use strict";T.d(p,{e:()=>G,h:()=>v,k:()=>F,n:()=>W});var A=T(12194),a=T(12190),C=T(13664),U=T(12833),X=T(12794),y=T(12806),e=T(12205),H=T(12231),M=T(12829),b=T(12921),l=T(12837),k=T(12416);class x{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Ul=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ul=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(N){this._environmentTexture=N}getNodes(){let N=[];N=N.concat(this.meshes),N=N.concat(this.lights),N=N.concat(this.cameras),N=N.concat(this.transformNodes);for(const p of this.skeletons)N=N.concat(p.bones);return N}}class I extends x{}class L{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const N=this.rootNodes;for(const A of N)A.dispose();N.length=0;const p=this.skeletons;for(const A of p)A.dispose();p.length=0;const T=this.animationGroups;for(const A of T)A.dispose();T.length=0}}class n extends x{constructor(N){super(),this._wasAddedToScene=!1,(N=N||H.b.LastCreatedScene)&&(this.Lp=N,this.proceduralTextures=[],N.SU.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=N.getEngine().onContextRestoredObservable.add((()=>{for(const N of this.geometries)N._rebuild();for(const N of this.meshes)N._rebuild();for(const N of this.Ul)N.rebuild();for(const N of this.textures)N._rebuild()})))}_topologicalSort(N){const p=new Map;for(const U of N)p.set(U.uniqueId,U);const T={dependsOn:new Map,dependedBy:new Map};for(const U of N){const N=U.uniqueId;T.dependsOn.set(N,new Set),T.dependedBy.set(N,new Set)}for(const U of N){const N=U.uniqueId,A=T.dependsOn.get(N);if(U instanceof M.d){const a=U.sourceMesh;p.has(a.uniqueId)&&(A.add(a.uniqueId),T.dependedBy.get(a.uniqueId).add(N))}const a=T.dependedBy.get(N);for(const C of U.getDescendants()){const A=C.uniqueId;if(p.has(A)){a.add(A);T.dependsOn.get(A).add(N)}}}const A=[],a=[];for(const U of N){const N=U.uniqueId;0===T.dependsOn.get(N).size&&(a.push(U),p.delete(N))}const C=a;for(;C.length>0;){const N=C.shift();A.push(N);const a=T.dependedBy.get(N.uniqueId);for(const A of Array.from(a.values())){const a=T.dependsOn.get(A);a.delete(N.uniqueId),0===a.size&&p.get(A)&&(C.push(p.get(A)),p.delete(A))}}return p.size>0&&(e.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),p.forEach((N=>{e.d.Error(N.name)}))),A}_addNodeAndDescendantsToList(N,p,T,A){if(T&&(!A||A(T))&&!p.has(T.uniqueId)){N.push(T),p.add(T.uniqueId);for(const a of T.getDescendants(!0))this._addNodeAndDescendantsToList(N,p,a,A)}}_isNodeInContainer(N){return N instanceof y.c&&-1!==this.meshes.indexOf(N)||(N instanceof X.b&&-1!==this.transformNodes.indexOf(N)||(N instanceof b.c&&-1!==this.lights.indexOf(N)||N instanceof l.d&&-1!==this.cameras.indexOf(N)))}_isValidHierarchy(){for(const N of this.meshes)if(N.parent&&!this._isNodeInContainer(N.parent))return e.d.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.transformNodes)if(N.parent&&!this._isNodeInContainer(N.parent))return e.d.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.lights)if(N.parent&&!this._isNodeInContainer(N.parent))return e.d.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;for(const N of this.cameras)if(N.parent&&!this._isNodeInContainer(N.parent))return e.d.Warn(`Node ${N.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(N){let p=arguments.length>1&&void 0!==arguments[1]&&arguments[1],T=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const A={},C={},X=new L,y=[],e=[],H={doNotInstantiate:!0,...T},M=[],b=new Set;for(const a of this.transformNodes)null===a.parent&&this._addNodeAndDescendantsToList(M,b,a,H.predicate);for(const a of this.meshes)null===a.parent&&this._addNodeAndDescendantsToList(M,b,a,H.predicate);const l=this._topologicalSort(M),k=(T,a)=>{if(((p,T)=>{if(A[p.uniqueId]=T.uniqueId,C[T.uniqueId]=T,N&&(T.name=N(p.name)),T instanceof U.d){const N=T;if(N.morphTargetManager){const T=p.morphTargetManager;N.morphTargetManager=T.clone();for(let p=0;p<T.numTargets;p++){const a=T.getTarget(p),U=N.morphTargetManager.getTarget(p);A[a.uniqueId]=U.uniqueId,C[U.uniqueId]=U}}}})(T,a),T.parent){const N=A[T.parent.uniqueId],p=C[N];a.parent=p||T.parent}if(a.position&&T.position&&a.position.A(T.position),a.rotationQuaternion&&T.rotationQuaternion&&a.rotationQuaternion.A(T.rotationQuaternion),a.rotation&&T.rotation&&a.rotation.A(T.rotation),a.xX&&T.xX&&a.xX.A(T.xX),a.material){const U=a;if(U.material)if(p){const p=T.material;if(-1===e.indexOf(p)){let T=p.clone(N?N(p.name):"Clone of "+p.name);if(e.push(p),A[p.uniqueId]=T.uniqueId,C[T.uniqueId]=T,"MultiMaterial"===p.getClassName()){const a=p;for(const p of a.nX)p&&(T=p.clone(N?N(p.name):"Clone of "+p.name),e.push(p),A[p.uniqueId]=T.uniqueId,C[T.uniqueId]=T);a.nX=a.nX.map((N=>N&&C[A[N.uniqueId]]))}}"InstancedMesh"!==U.getClassName()&&(U.material=C[A[p.uniqueId]])}else"MultiMaterial"===U.material.getClassName()?-1===this.Lp.multiMaterials.indexOf(U.material)&&this.Lp.addMultiMaterial(U.material):-1===this.Lp.materials.indexOf(U.material)&&this.Lp.addMaterial(U.material)}null===a.parent&&X.rootNodes.push(a)};for(const a of l)if("InstancedMesh"===a.getClassName()){const N=a,p=N.sourceMesh,T=A[p.uniqueId];k(N,("number"===typeof T?C[T]:p).createInstance(N.name))}else{let N=!0;"ny"===a.getClassName()||"Node"===a.getClassName()||a.skeleton||!a.getTotalVertices||0===a.getTotalVertices()?N=!1:H.doNotInstantiate&&(N="function"===typeof H.doNotInstantiate?!H.doNotInstantiate(a):!H.doNotInstantiate);const p=N?a.createInstance(`instance of ${a.name}`):a.clone(`Clone of ${a.name}`,null,!0);if(!p)throw new Error(`Could not clone or instantiate node on Asset Container ${a.name}`);k(a,p)}for(const a of this.skeletons){if(H.predicate&&!H.predicate(a))continue;const p=a.clone(N?N(a.name):"Clone of "+a.name);for(const N of this.meshes)if(N.skeleton===a&&!N.isAnInstance){const T=C[A[N.uniqueId]];if(!T||T.isAnInstance)continue;if(T.skeleton=p,-1!==y.indexOf(p))continue;y.push(p);for(const N of p.bones)N._linkedTransformNode&&(N._linkedTransformNode=C[A[N._linkedTransformNode.uniqueId]])}X.skeletons.push(p)}for(const a of this.animationGroups){if(H.predicate&&!H.predicate(a))continue;const p=a.clone(N?N(a.name):"Clone of "+a.name,(N=>C[A[N.uniqueId]]||N));X.animationGroups.push(p)}return X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Lp.environmentTexture=this.environmentTexture);for(const N of this.Lp._serializableComponents)N.addFromContainer(this);this.Lp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const p=[];for(const T of this.cameras)N&&!N(T)||(this.Lp.addCamera(T),p.push(T));for(const T of this.lights)N&&!N(T)||(this.Lp.addLight(T),p.push(T));for(const T of this.meshes)N&&!N(T)||(this.Lp.vH(T),p.push(T));for(const T of this.skeletons)N&&!N(T)||this.Lp.addSkeleton(T);for(const T of this.animations)N&&!N(T)||this.Lp.addAnimation(T);for(const T of this.animationGroups)N&&!N(T)||this.Lp.addAnimationGroup(T);for(const T of this.multiMaterials)N&&!N(T)||this.Lp.addMultiMaterial(T);for(const T of this.materials)N&&!N(T)||this.Lp.addMaterial(T);for(const T of this.morphTargetManagers)N&&!N(T)||this.Lp.addMorphTargetManager(T);for(const T of this.geometries)N&&!N(T)||this.Lp.addGeometry(T);for(const T of this.transformNodes)N&&!N(T)||(this.Lp.addTransformNode(T),p.push(T));for(const T of this.actionManagers)N&&!N(T)||this.Lp.addActionManager(T);for(const T of this.textures)N&&!N(T)||this.Lp.addTexture(T);for(const T of this.reflectionProbes)N&&!N(T)||this.Lp.addReflectionProbe(T);for(const T of p)T.parent&&-1===this.Lp.getNodes().indexOf(T.parent)&&(T.setParent?T.setParent(null):T.parent=null)}removeAllFromScene(){this._isValidHierarchy()||a.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Lp.environmentTexture&&(this.Lp.environmentTexture=null);for(const N of this.Lp._serializableComponents)N.removeFromContainer(this)}removeFromScene(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const p of this.cameras)N&&!N(p)||this.Lp.removeCamera(p);for(const p of this.lights)N&&!N(p)||this.Lp.removeLight(p);for(const p of this.meshes)N&&!N(p)||this.Lp.FH(p,!0);for(const p of this.skeletons)N&&!N(p)||this.Lp.removeSkeleton(p);for(const p of this.animations)N&&!N(p)||this.Lp.removeAnimation(p);for(const p of this.animationGroups)N&&!N(p)||this.Lp.removeAnimationGroup(p);for(const p of this.multiMaterials)N&&!N(p)||this.Lp.removeMultiMaterial(p);for(const p of this.materials)N&&!N(p)||this.Lp.removeMaterial(p);for(const p of this.morphTargetManagers)N&&!N(p)||this.Lp.removeMorphTargetManager(p);for(const p of this.geometries)N&&!N(p)||this.Lp.removeGeometry(p);for(const p of this.transformNodes)N&&!N(p)||this.Lp.removeTransformNode(p);for(const p of this.actionManagers)N&&!N(p)||this.Lp.removeActionManager(p);for(const p of this.textures)N&&!N(p)||this.Lp.removeTexture(p);for(const p of this.reflectionProbes)N&&!N(p)||this.Lp.removeReflectionProbe(p)}dispose(){const N=this.cameras.slice(0);for(const l of N)l.dispose();this.cameras.length=0;const p=this.lights.slice(0);for(const l of p)l.dispose();this.lights.length=0;const T=this.meshes.slice(0);for(const l of T)l.dispose();this.meshes.length=0;const A=this.skeletons.slice(0);for(const l of A)l.dispose();this.skeletons.length=0;const a=this.animationGroups.slice(0);for(const l of a)l.dispose();this.animationGroups.length=0;const C=this.multiMaterials.slice(0);for(const l of C)l.dispose();this.multiMaterials.length=0;const U=this.materials.slice(0);for(const l of U)l.dispose();this.materials.length=0;const X=this.geometries.slice(0);for(const l of X)l.dispose();this.geometries.length=0;const y=this.transformNodes.slice(0);for(const l of y)l.dispose();this.transformNodes.length=0;const e=this.actionManagers.slice(0);for(const l of e)l.dispose();this.actionManagers.length=0;const H=this.textures.slice(0);for(const l of H)l.dispose();this.textures.length=0;const M=this.reflectionProbes.slice(0);for(const l of M)l.dispose();this.reflectionProbes.length=0;const b=this.morphTargetManagers.slice(0);for(const l of b)l.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const l of this.Lp._serializableComponents)l.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Lp.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(N,p,T){if(N&&p)for(const A of N){let N=!0;if(T)for(const p of T)if(A===p){N=!1;break}N&&(p.push(A),A._parentContainer=this)}}moveAllFromScene(N){this._wasAddedToScene=!1,void 0===N&&(N=new I);for(const p in this)Object.prototype.hasOwnProperty.call(this,p)&&(this[p]=this[p]||("_environmentTexture"===p?null:[]),this._moveAssets(this.Lp[p],this[p],N[p]));this.environmentTexture=this.Lp.environmentTexture,this.removeAllFromScene()}createRootMesh(){const N=new U.d("assetContainerRootMesh",this.Lp);for(const p of this.meshes)p.parent||N.addChild(p);return this.meshes.unshift(N),N}mergeAnimationsTo(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H.b.LastCreatedScene,p=arguments.length>1?arguments[1]:void 0,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!N)return e.d.Error("No scene available to merge animations to"),[];const A=T||(p=>{let T=null;const A=p.animations.length?p.animations[0].targetProperty:"",a=p.name.split(".").join("").split("_primitive")[0];switch(A){case"position":case"rotationQuaternion":T=N.getTransformNodeByName(p.name)||N.getTransformNodeByName(a);break;case"influence":T=N.getMorphTargetByName(p.name)||N.getMorphTargetByName(a);break;default:T=N.getNodeByName(p.name)||N.getNodeByName(a)}return T}),a=this.getNodes();for(const X of a){const N=A(X);if(null!==N){for(const p of X.animations){const T=N.animations.filter((N=>N.targetProperty===p.targetProperty));for(const p of T){const T=N.animations.indexOf(p,0);T>-1&&N.animations.splice(T,1)}}N.animations=N.animations.concat(X.animations)}}const C=[],U=this.animationGroups.slice();for(const X of U){C.push(X.clone(X.name,A));for(const N of X.animatables)N.stop()}for(const X of p){const p=A(X.target);p&&(N.beginAnimation(p,X.fromFrame,X.toFrame,X.loopAnimation,X.speedRatio,X.onAnimationEnd?X.onAnimationEnd:void 0,void 0,!0,void 0,X.onAnimationLoop?X.onAnimationLoop:void 0),N.stopAnimation(X.target))}return C}populateRootNodes(){this.rootNodes.length=0;for(const N of this.meshes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.transformNodes)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.lights)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N);for(const N of this.cameras)N.parent||-1!==this.rootNodes.indexOf(N)||this.rootNodes.push(N)}addAllAssetsToContainer(N){if(!N)return;const p=[],T=new Set;for(p.push(N);p.length>0;){const N=p.pop();if(N instanceof U.d?(N.MX&&-1===this.geometries.indexOf(N.MX)&&this.geometries.push(N.MX),this.meshes.push(N)):N instanceof M.d?this.meshes.push(N):N instanceof X.b?this.transformNodes.push(N):N instanceof b.c?this.lights.push(N):N instanceof l.d&&this.cameras.push(N),N instanceof y.c){if(N.material&&-1===this.materials.indexOf(N.material)){this.materials.push(N.material);for(const p of N.material.getActiveTextures())-1===this.textures.indexOf(p)&&this.textures.push(p)}N.skeleton&&-1===this.skeletons.indexOf(N.skeleton)&&this.skeletons.push(N.skeleton),N.morphTargetManager&&-1===this.morphTargetManagers.indexOf(N.morphTargetManager)&&this.morphTargetManagers.push(N.morphTargetManager)}for(const A of N.getChildren())T.has(A)||p.push(A);T.add(N)}this.populateRootNodes()}_getByTags(N,p,T){if(void 0===p)return N;const A=[];for(const a in N){const C=N[a];k.b&&k.b.MatchesQuery(C,p)&&(!T||T(C))&&A.push(C)}return A}getMeshesByTags(N,p){return this._getByTags(this.meshes,N,p)}getCamerasByTags(N,p){return this._getByTags(this.cameras,N,p)}getLightsByTags(N,p){return this._getByTags(this.lights,N,p)}getMaterialsByTags(N,p){return this._getByTags(this.materials,N,p).concat(this._getByTags(this.multiMaterials,N,p))}getTransformNodesByTags(N,p){return this._getByTags(this.transformNodes,N,p)}}var w=T(12253);class g{constructor(N){this.byteOffset=0,this.buffer=N}async loadAsync(N){const p=await this.buffer.readAsync(this.byteOffset,N);this._dataView=new DataView(p.buffer,p.byteOffset,p.byteLength),this._dataByteOffset=0}readUint32(){const N=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,N}readUint8Array(N){const p=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,N);return this._dataByteOffset+=N,this.byteOffset+=N,p}readString(N){return(0,w.f)(this.readUint8Array(N))}skipBytes(N){this._dataByteOffset+=N,this.byteOffset+=N}}var P=T(14014);const i="Z2xURg",K={name:"TX",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:N=>-1!==N.indexOf("asset")&&-1!==N.indexOf("version")||N.startsWith("data:base64,"+i)||N.startsWith("data:;base64,"+i)||N.startsWith("data:application/octet-stream;base64,"+i)||N.startsWith("data:model/gltf-binary;base64,"+i)};var F,v,W,z=T(12240),R=T(12245);function J(N,p,T){try{return Promise.resolve(new Uint8Array(N,p,T))}catch(A){return Promise.reject(A)}}!function(N){N[N.AUTO=0]="AUTO",N[N.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(F||(F={})),function(N){N[N.NONE=0]="NONE",N[N.FIRST=1]="FIRST",N[N.ALL=2]="ALL"}(v||(v={})),function(N){N[N.LOADING=0]="LOADING",N[N.READY=1]="READY",N[N.COMPLETE=2]="COMPLETE"}(W||(W={}));class f{constructor(){this.coordinateSystemMode=F.AUTO,this.animationStartMode=v.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=N=>Promise.resolve(N),this.extensionOptions={}}A(N){N&&(this.onParsed=N.onParsed,this.coordinateSystemMode=N.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=N.animationStartMode??this.animationStartMode,this.loadNodeAnimations=N.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=N.loadSkins??this.loadSkins,this.loadMorphTargets=N.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=N.compileMaterials??this.compileMaterials,this.useClipPlane=N.useClipPlane??this.useClipPlane,this.compileShadowGenerators=N.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=N.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=N.useRangeRequests??this.useRangeRequests,this.createInstances=N.createInstances??this.createInstances,this.alwaysComputeBoundingBox=N.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=N.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=N.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=N.skipMaterials??this.skipMaterials,this.useSRGBBuffers=N.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=N.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=N.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=N.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=N.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=N.customRootNode,this.onMeshLoaded=N.onMeshLoaded,this.onSkinLoaded=N.onSkinLoaded,this.onTextureLoaded=N.onTextureLoaded,this.onMaterialLoaded=N.onMaterialLoaded,this.onCameraLoaded=N.onCameraLoaded,this.extensionOptions=N.extensionOptions??this.extensionOptions)}}class G extends f{constructor(N){super(),this.onParsedObservable=new A.c,this.onMeshLoadedObservable=new A.c,this.onSkinLoadedObservable=new A.c,this.onTextureLoadedObservable=new A.c,this.onMaterialLoadedObservable=new A.c,this.onCameraLoadedObservable=new A.c,this.onCompleteObservable=new A.c,this.onErrorObservable=new A.c,this.SU=new A.c,this.onExtensionLoadedObservable=new A.c,this.validate=!1,this.onValidatedObservable=new A.c,this._loader=null,this._state=null,this._requests=new Array,this.name=K.name,this.extensions=K.extensions,this.onLoaderStateChangedObservable=new A.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.A(N)}set onParsed(N){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),N&&(this._onParsedObserver=this.onParsedObservable.add(N))}set onMeshLoaded(N){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),N&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(N))}set onSkinLoaded(N){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),N&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((p=>N(p.node,p.skinnedNode))))}set onTextureLoaded(N){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),N&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(N))}set onMaterialLoaded(N){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),N&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(N))}set onCameraLoaded(N){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),N&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(N))}set onComplete(N){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(N)}set onError(N){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(N)}set onDispose(N){this._onDisposeObserver&&this.SU.remove(this._onDisposeObserver),this._onDisposeObserver=this.SU.add(N)}set onExtensionLoaded(N){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(N)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(N){this._loggingEnabled!==N&&(this._loggingEnabled=N,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(N){this._capturePerformanceCounters!==N&&(this._capturePerformanceCounters=N,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(N){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(N)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const N of this._requests)N.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=N=>Promise.resolve(N),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.SU.notifyObservers(void 0),this.SU.clear()}loadFile(N,p,T,C,U,X,y,H){if(ArrayBuffer.isView(p))return this._loadBinary(N,p,T,C,y,H),null;this._progressCallback=U;const M=p.name||a.Tools.GetFilename(p);if(X){if(this.useRangeRequests){this.validate&&e.d.Warn("glTF validation is not supported when range requests are enabled");const T={abort:()=>{},onCompleteObservable:new A.c},a={readAsync:(T,A)=>new Promise(((a,C)=>{this._loadFile(N,p,(N=>{a(new Uint8Array(N))}),!0,(N=>{C(N)}),(N=>{N.setRequestHeader("Range",`bytes=${T}-${T+A-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new g(a)).then((N=>{T.onCompleteObservable.notifyObservers(T),C(N)}),y?N=>y(void 0,N):void 0),T}return this._loadFile(N,p,(p=>{this._validate(N,new Uint8Array(p,0,p.byteLength),T,M),this._unpackBinaryAsync(new g({readAsync:(N,T)=>J(p,N,T),byteLength:p.byteLength})).then((N=>{C(N)}),y?N=>y(void 0,N):void 0)}),!0,y)}return this._loadFile(N,p,(p=>{try{this._validate(N,p,T,M),C({json:this._parseJson(p)})}catch{y&&y()}}),!1,y)}_loadBinary(N,p,T,A,a,C){this._validate(N,new Uint8Array(p.buffer,p.byteOffset,p.byteLength),T,C),this._unpackBinaryAsync(new g({readAsync:(N,T)=>function(N,p,T){try{if(p<0||p>=N.byteLength)throw new RangeError("Offset is out of range.");if(p+T>N.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(N.buffer,N.byteOffset+p,T))}catch(A){return Promise.reject(A)}}(p,N,T),byteLength:p.byteLength})).then((N=>{A(N)}),a?N=>a(void 0,N):void 0)}importMeshAsync(N,p,T,A,a,C){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(T),this.onParsedObservable.clear(),this._log(`Loading ${C||""}`),this._loader=this._getLoader(T),this._loader.importMeshAsync(N,p,null,T,A,a,C))))}loadAsync(N,p,T,A,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(p),this._loader.loadAsync(N,p,T,A,a))))}loadAssetContainerAsync(N,p,T,A,a){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(p),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(p);const C=new n(N),U=[];this.onMaterialLoadedObservable.add((N=>{U.push(N)}));const X=[];this.onTextureLoadedObservable.add((N=>{X.push(N)}));const y=[];this.onCameraLoadedObservable.add((N=>{y.push(N)}));const e=[];return this.onMeshLoadedObservable.add((N=>{N.morphTargetManager&&e.push(N.morphTargetManager)})),this._loader.importMeshAsync(null,N,C,p,T,A,a).then((N=>(Array.prototype.push.apply(C.geometries,N.geometries),Array.prototype.push.apply(C.meshes,N.meshes),Array.prototype.push.apply(C.Ul,N.Ul),Array.prototype.push.apply(C.skeletons,N.skeletons),Array.prototype.push.apply(C.animationGroups,N.animationGroups),Array.prototype.push.apply(C.materials,U),Array.prototype.push.apply(C.textures,X),Array.prototype.push.apply(C.lights,N.lights),Array.prototype.push.apply(C.transformNodes,N.transformNodes),Array.prototype.push.apply(C.cameras,y),Array.prototype.push.apply(C.morphTargetManagers,e),C)))}))}canDirectLoad(N){return K.canDirectLoad(N)}directLoad(N,p){if(p.startsWith("base64,"+i)||p.startsWith(";base64,"+i)||p.startsWith("application/octet-stream;base64,"+i)||p.startsWith("model/gltf-binary;base64,"+i)){const T=(0,z.e)(p);return this._validate(N,new Uint8Array(T,0,T.byteLength)),this._unpackBinaryAsync(new g({readAsync:(N,p)=>J(T,N,p),byteLength:T.byteLength}))}return this._validate(N,p),Promise.resolve({json:this._parseJson(p)})}createPlugin(N){return new G(N[K.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((N,p)=>{this.onCompleteObservable.addOnce((()=>{N()})),this.onErrorObservable.addOnce((N=>{p(N)}))}))}_setState(N){this._state!==N&&(this._state=N,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(W[this._state]))}_loadFile(N,p,T,A,a,C){const U=N._loadFile(p,T,(N=>{this._onProgress(N,U)}),!0,A,a,C);return U.onCompleteObservable.add((()=>{U._lengthComputable=!0,U._total=U._loaded})),this._requests.push(U),U}_onProgress(N,p){if(!this._progressCallback)return;p._lengthComputable=N.lengthComputable,p._loaded=N.loaded,p._total=N.total;let T=!0,A=0,a=0;for(const C of this._requests){if(void 0===C._lengthComputable||void 0===C._loaded||void 0===C._total)return;T=T&&C._lengthComputable,A+=C._loaded,a+=C._total}this._progressCallback({lengthComputable:T,loaded:A,total:T?a:0})}_validate(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),P.b.ValidateAsync(p,T,A,(p=>this.preprocessUrlAsync(T+p).then((p=>N._loadFileAsync(p,void 0,!0,!0).then((N=>new Uint8Array(N,0,N.byteLength))))))).then((N=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(N),this.onValidatedObservable.clear()}),(N=>{this._endPerformanceCounter("Validate JSON"),a.Tools.Warn(`Failed to validate: ${N.message}`),this.onValidatedObservable.clear()})))}_getLoader(N){const p=N.json.asset||{};this._log(`Asset version: ${p.version}`),p.minVersion&&this._log(`Asset minimum version: ${p.minVersion}`),p.generator&&this._log(`Asset generator: ${p.generator}`);const T=G._parseVersion(p.version);if(!T)throw new Error("Invalid version: "+p.version);if(void 0!==p.minVersion){const N=G._parseVersion(p.minVersion);if(!N)throw new Error("Invalid minimum version: "+p.minVersion);if(G._compareVersion(N,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+p.minVersion)}const A={1:G._CreateGLTF1Loader,2:G._CreateGLTF2Loader}[T.major];if(!A)throw new Error("Unsupported version: "+p.version);return A(this)}_parseJson(N){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${N.length}`);const p=JSON.parse(N);return this._endPerformanceCounter("Parse JSON"),p}_unpackBinaryAsync(N){return this._startPerformanceCounter("Unpack Binary"),N.loadAsync(20).then((()=>{const p=N.readUint32();if(1179937895!==p)throw new R.l("Unexpected magic: "+p,R.i.GLTFLoaderUnexpectedMagicError);const T=N.readUint32();this.loggingEnabled&&this._log(`Binary version: ${T}`);const A=N.readUint32();let a;switch(this.useRangeRequests||A===N.buffer.byteLength||e.d.Warn(`Length in header does not match actual data length: ${A} != ${N.buffer.byteLength}`),T){case 1:a=this._unpackBinaryV1Async(N,A);break;case 2:a=this._unpackBinaryV2Async(N,A);break;default:throw new Error("Unsupported version: "+T)}return this._endPerformanceCounter("Unpack Binary"),a}))}_unpackBinaryV1Async(N,p){const T=N.readUint32(),A=N.readUint32();if(0!==A)throw new Error(`Unexpected content format: ${A}`);const a=p-N.byteOffset,C={json:this._parseJson(N.readString(T)),bin:null};if(0!==a){const p=N.byteOffset;C.bin={readAsync:(T,A)=>N.buffer.readAsync(p+T,A),byteLength:a}}return Promise.resolve(C)}_unpackBinaryV2Async(N,p){const T=1313821514,A=5130562,a=N.readUint32();if(N.readUint32()!==T)throw new Error("First chunk format is not JSON");return N.byteOffset+a===p?N.loadAsync(a).then((()=>({json:this._parseJson(N.readString(a)),bin:null}))):N.loadAsync(a+8).then((()=>{const C={json:this._parseJson(N.readString(a)),bin:null},U=()=>{const a=N.readUint32();switch(N.readUint32()){case T:throw new Error("Unexpected JSON chunk");case A:{const p=N.byteOffset;C.bin={readAsync:(T,A)=>N.buffer.readAsync(p+T,A),byteLength:a},N.skipBytes(a);break}default:N.skipBytes(a)}return N.byteOffset!==p?N.loadAsync(8).then(U):Promise.resolve(C)};return U()}))}static _parseVersion(N){if("1.0"===N||"1.0.1"===N)return{major:1,minor:0};const p=(N+"").match(/^(\d+)\.(\d+)/);return p?{major:parseInt(p[1]),minor:parseInt(p[2])}:null}static _compareVersion(N,p){return N.major>p.major?1:N.major<p.major?-1:N.minor>p.minor?1:N.minor<p.minor?-1:0}_logOpen(N){this._log(N),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(N){const p=G._logSpaces.substring(0,2*this._logIndentLevel);e.d.Log(`${p}${N}`)}_logDisabled(N){}_startPerformanceCounterEnabled(N){a.Tools.StartPerformanceCounter(N)}_startPerformanceCounterDisabled(N){}_endPerformanceCounterEnabled(N){a.Tools.EndPerformanceCounter(N)}_endPerformanceCounterDisabled(N){}}G.IncrementalLoading=!0,G.HomogeneousCoordinates=!1,G._logSpaces="                                ",(0,C.c)(new G)},14014:(N,p,T)=>{"use strict";T.d(p,{b:()=>U});var A=T(12190);function a(N,p,T,A){const a={externalResourceFunction:A};return T&&(a.uri="file:"===p?T:p+T),ArrayBuffer.isView(N)?GLTFValidator.validateBytes(N,a):GLTFValidator.validateString(N,a)}function C(){const N=[];onmessage=p=>{const T=p.data;switch(T.id){case"init":importScripts(T.url);break;case"validate":a(T.data,T.rootUrl,T.fileName,(p=>new Promise(((T,A)=>{const a=N.length;N.push({resolve:T,reject:A}),postMessage({id:"getExternalResource",index:a,uri:p})})))).then((N=>{postMessage({id:"validate.resolve",value:N})}),(N=>{postMessage({id:"validate.reject",reason:N})}));break;case"getExternalResource.resolve":N[T.index].resolve(T.value);break;case"getExternalResource.reject":N[T.index].reject(T.reason)}}}class U{static ValidateAsync(N,p,T,U){return"function"===typeof Worker?new Promise(((X,y)=>{const e=`${a}(${C})()`,H=URL.createObjectURL(new Blob([e],{type:"application/javascript"})),M=new Worker(H),b=N=>{M.removeEventListener("error",b),M.removeEventListener("message",l),y(N)},l=N=>{const p=N.data;switch(p.id){case"getExternalResource":U(p.uri).then((N=>{M.postMessage({id:"getExternalResource.resolve",index:p.index,value:N},[N.buffer])}),(N=>{M.postMessage({id:"getExternalResource.reject",index:p.index,reason:N})}));break;case"validate.resolve":M.removeEventListener("error",b),M.removeEventListener("message",l),X(p.value),M.terminate();break;case"validate.reject":M.removeEventListener("error",b),M.removeEventListener("message",l),y(p.reason),M.terminate()}};if(M.addEventListener("error",b),M.addEventListener("message",l),M.postMessage({id:"init",url:A.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(N)){const A=N.slice();M.postMessage({id:"validate",data:A,rootUrl:p,fileName:T},[A.buffer])}else M.postMessage({id:"validate",data:N,rootUrl:p,fileName:T})})):(this._LoadScriptPromise||(this._LoadScriptPromise=A.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>a(N,p,T,U))))}}U.Configuration={url:`${A.Tools._DefaultCdnUrl}/gltf_validator.js`}},14527:(N,p,T)=>{"use strict";T.d(p,{e:()=>K});var A=T(12354),a=T(12359),C=T(12409),U=T(12371),X=T(12761),y=T(12702),e=T(12451),H=T(12617),M=T(12331),b=T(12281);T(13790),T(13695),T(13716),T(13703),T(13720),T(13724),T(13727);const l="imageProcessingCompatibility",k="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";b.b.IncludesShadersStore[l]||(b.b.IncludesShadersStore[l]=k);const x="skyPixelShader",I="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";b.b.ShadersStore[x]||(b.b.ShadersStore[x]=I);T(13796),T(13734),T(13738),T(13749),T(13740);const L="skyVertexShader",n="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";b.b.ShadersStore[L]||(b.b.ShadersStore[L]=n);var w=T(12700),g=T(12736),P=T(12731);class i extends X.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class K extends y.e{constructor(N,p){super(N,p),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new U.xp(0,100,0),this.useSunPosition=!1,this.cameraOffset=U.xp.Zero(),this.up=U.xp.Up(),this.dithering=!1,this._cameraPosition=U.xp.Zero(),this._skyOrientation=new U.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(N,p){const T=p._drawWrapper;if(this.isFrozen&&T.effect&&T._wasPreviouslyReady)return!0;p.materialDefines||(p.materialDefines=new i);const A=p.materialDefines,a=this.KN();if(this._isReadyForSubMesh(p))return!0;if((0,P.O)(N,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,A),(0,P.F)(N,A,!0,!1),A.IMAGEPROCESSINGPOSTPROCESS!==a.imageProcessingConfiguration.applyByPostProcess&&A.markAsMiscDirty(),A.DITHER!==this.dithering&&A.markAsMiscDirty(),A.isDirty){A.markAsProcessed(),a.resetCachedMaterial();const N=new w.e;A.FOG&&N.addFallback(1,"FOG"),A.IMAGEPROCESSINGPOSTPROCESS=a.imageProcessingConfiguration.applyByPostProcess,A.DITHER=this.dithering;const T=[e.f.PositionKind];A.VERTEXCOLOR&&T.push(e.f.ColorKind);const C="sky",U=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,g.e)(U);const X=A.toString();p.setEffect(a.getEngine().createEffect(C,T,U,[],X,N,this.onCompiled,this.onError),A,this._materialContext)}return!(!p.effect||!p.effect.isReady())&&(A._renderId=a.getRenderId(),T._wasPreviouslyReady=!0,!0)}bindForSubMesh(N,p,T){const A=this.KN(),a=T.materialDefines;if(!a)return;const C=T.effect;if(!C)return;this._activeEffect=C,this.bindOnlyWorldMatrix(N),this._activeEffect.setMatrix("viewProjection",A.getTransformMatrix()),this._mustRebind(A,C,T)&&((0,g.i)(C,this,A),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,P.h)(a,C,A)),A.fogEnabled&&p.applyFog&&A.fogMode!==H.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",A.getViewMatrix()),(0,P.c)(A,p,this._activeEffect);const X=A.activeCamera;if(X){const N=X.getWorldMatrix();this._cameraPosition.x=N.m[12],this._cameraPosition.y=N.m[13],this._cameraPosition.z=N.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const N=Math.PI*(this.inclination-.5),p=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(p)*Math.cos(N),this.sunPosition.y=this.distance*Math.sin(-N),this.sunPosition.z=this.distance*Math.sin(p)*Math.cos(N),U.Quaternion.FromUnitVectorsToRef(U.xp.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(p,this._activeEffect,T)}getAnimatables(){return[]}dispose(N){super.dispose(N)}clone(N){return C.e.Clone((()=>new K(N,this.KN())),this)}serialize(){const N=super.serialize();return N.customType="BABYLON.SkyMaterial",N}getClassName(){return"SkyMaterial"}static Parse(N,p,T){return C.e.Parse((()=>new K(N.name,p)),N,p,T)}}(0,A.b)([(0,a.H)()],K.prototype,"luminance",void 0),(0,A.b)([(0,a.H)()],K.prototype,"turbidity",void 0),(0,A.b)([(0,a.H)()],K.prototype,"rayleigh",void 0),(0,A.b)([(0,a.H)()],K.prototype,"mieCoefficient",void 0),(0,A.b)([(0,a.H)()],K.prototype,"mieDirectionalG",void 0),(0,A.b)([(0,a.H)()],K.prototype,"distance",void 0),(0,A.b)([(0,a.H)()],K.prototype,"inclination",void 0),(0,A.b)([(0,a.H)()],K.prototype,"azimuth",void 0),(0,A.b)([(0,a.E)()],K.prototype,"sunPosition",void 0),(0,A.b)([(0,a.H)()],K.prototype,"useSunPosition",void 0),(0,A.b)([(0,a.E)()],K.prototype,"cameraOffset",void 0),(0,A.b)([(0,a.E)()],K.prototype,"up",void 0),(0,A.b)([(0,a.H)()],K.prototype,"dithering",void 0),(0,M.d)("BABYLON.SkyMaterial",K)},13080:(N,p,T)=>{"use strict";function A(N,p){p.headers=N.headers||{},p.statusMessage=N.statusText,p.statusCode=N.status,p.data=N.response}function a(N,p,T){return new Promise((function(a,C){T=T||{};var U,X,y,e=new XMLHttpRequest,H=T.body,M=T.headers||{};for(U in T.timeout&&(e.timeout=T.timeout),e.ontimeout=e.onerror=function(N){N.timeout="timeout"==N.type,C(N)},e.open(N,p.href||p),e.onload=function(){for(y=e.getAllResponseHeaders().trim().split(/[\r\n]+/),A(e,e);X=y.shift();)X=X.split(": "),e.headers[X.shift().toLowerCase()]=X.join(": ");if((X=e.headers["content-type"])&&~X.indexOf("application/json"))try{e.data=JSON.parse(e.data,T.reviver)}catch(N){return A(e,N),C(N)}(e.status>=400?C:a)(e)},typeof FormData<"u"&&H instanceof FormData||H&&"object"==typeof H&&(M["content-type"]="application/json",H=JSON.stringify(H)),e.withCredentials=!!T.withCredentials,M)e.setRequestHeader(U,M[U]);e.send(H)}))}T.r(p),T.d(p,{del:()=>y,get:()=>C,patch:()=>X,post:()=>U,put:()=>e,send:()=>a});var C=a.bind(a,"GET"),U=a.bind(a,"POST"),X=a.bind(a,"PATCH"),y=a.bind(a,"DELETE"),e=a.bind(a,"PUT")},14642:(N,p,T)=>{"use strict";T.d(p,{c:()=>M});const A=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6,C=1/3,U=1/6,X=(Math.sqrt(5)-1)/4,y=(5-Math.sqrt(5))/20,e=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),H=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const M=class{constructor(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const p="function"==typeof N?N:function(N){let p=0,T=0,A=0,a=1;const C=function(){let N=4022871197;return function(p){p=p.toString();for(let T=0;T<p.length;T++){N+=p.charCodeAt(T);let A=.02519603282416938*N;N=A>>>0,A-=N,A*=N,N=A>>>0,A-=N,N+=4294967296*A}return 2.3283064365386963e-10*(N>>>0)}}();p=C(" "),T=C(" "),A=C(" "),p-=C(N),p<0&&(p+=1);T-=C(N),T<0&&(T+=1);A-=C(N),A<0&&(A+=1);return function(){const N=2091639*p+2.3283064365386963e-10*a;return p=T,T=A,A=N-(a=0|N)}}(N);this.p=function(N){const p=new Uint8Array(256);for(let T=0;T<256;T++)p[T]=T;for(let T=0;T<255;T++){const A=T+~~(N()*(256-T)),a=p[T];p[T]=p[A],p[A]=a}return p}(p),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let T=0;T<512;T++)this.perm[T]=this.p[255&T],this.permMod12[T]=this.perm[T]%12}noise2D(N,p){const T=this.permMod12,C=this.perm;let U=0,X=0,y=0;const H=(N+p)*A,M=Math.floor(N+H),b=Math.floor(p+H),l=(M+b)*a,k=N-(M-l),x=p-(b-l);let I,L;k>x?(I=1,L=0):(I=0,L=1);const n=k-I+a,w=x-L+a,g=k-1+2*a,P=x-1+2*a,i=255&M,K=255&b;let F=.5-k*k-x*x;if(F>=0){const N=3*T[i+C[K]];F*=F,U=F*F*(e[N]*k+e[N+1]*x)}let v=.5-n*n-w*w;if(v>=0){const N=3*T[i+I+C[K+L]];v*=v,X=v*v*(e[N]*n+e[N+1]*w)}let W=.5-g*g-P*P;if(W>=0){const N=3*T[i+1+C[K+1]];W*=W,y=W*W*(e[N]*g+e[N+1]*P)}return 70*(U+X+y)}noise3D(N,p,T){const A=this.permMod12,a=this.perm;let X,y,H,M;const b=(N+p+T)*C,l=Math.floor(N+b),k=Math.floor(p+b),x=Math.floor(T+b),I=(l+k+x)*U,L=N-(l-I),n=p-(k-I),w=T-(x-I);let g,P,i,K,F,v;L>=n?n>=w?(g=1,P=0,i=0,K=1,F=1,v=0):L>=w?(g=1,P=0,i=0,K=1,F=0,v=1):(g=0,P=0,i=1,K=1,F=0,v=1):n<w?(g=0,P=0,i=1,K=0,F=1,v=1):L<w?(g=0,P=1,i=0,K=0,F=1,v=1):(g=0,P=1,i=0,K=1,F=1,v=0);const W=L-g+U,z=n-P+U,R=w-i+U,J=L-K+2*U,f=n-F+2*U,G=w-v+2*U,o=L-1+.5,Z=n-1+.5,mN=w-1+.5,q=255&l,h=255&k,j=255&x;let V=.6-L*L-n*n-w*w;if(V<0)X=0;else{const N=3*A[q+a[h+a[j]]];V*=V,X=V*V*(e[N]*L+e[N+1]*n+e[N+2]*w)}let r=.6-W*W-z*z-R*R;if(r<0)y=0;else{const N=3*A[q+g+a[h+P+a[j+i]]];r*=r,y=r*r*(e[N]*W+e[N+1]*z+e[N+2]*R)}let u=.6-J*J-f*f-G*G;if(u<0)H=0;else{const N=3*A[q+K+a[h+F+a[j+v]]];u*=u,H=u*u*(e[N]*J+e[N+1]*f+e[N+2]*G)}let Y=.6-o*o-Z*Z-mN*mN;if(Y<0)M=0;else{const N=3*A[q+1+a[h+1+a[j+1]]];Y*=Y,M=Y*Y*(e[N]*o+e[N+1]*Z+e[N+2]*mN)}return 32*(X+y+H+M)}noise4D(N,p,T,A){const a=this.perm;let C,U,e,M,b;const l=(N+p+T+A)*X,k=Math.floor(N+l),x=Math.floor(p+l),I=Math.floor(T+l),L=Math.floor(A+l),n=(k+x+I+L)*y,w=N-(k-n),g=p-(x-n),P=T-(I-n),i=A-(L-n);let K=0,F=0,v=0,W=0;w>g?K++:F++,w>P?K++:v++,w>i?K++:W++,g>P?F++:v++,g>i?F++:W++,P>i?v++:W++;const z=K>=3?1:0,R=F>=3?1:0,J=v>=3?1:0,f=W>=3?1:0,G=K>=2?1:0,o=F>=2?1:0,Z=v>=2?1:0,mN=W>=2?1:0,q=K>=1?1:0,h=F>=1?1:0,j=v>=1?1:0,V=W>=1?1:0,r=w-z+y,u=g-R+y,Y=P-J+y,D=i-f+y,c=w-G+2*y,Q=g-o+2*y,E=P-Z+2*y,O=i-mN+2*y,B=w-q+3*y,d=g-h+3*y,t=P-j+3*y,S=i-V+3*y,s=w-1+4*y,NN=g-1+4*y,pN=P-1+4*y,TN=i-1+4*y,AN=255&k,aN=255&x,CN=255&I,UN=255&L;let XN=.6-w*w-g*g-P*P-i*i;if(XN<0)C=0;else{const N=a[AN+a[aN+a[CN+a[UN]]]]%32*4;XN*=XN,C=XN*XN*(H[N]*w+H[N+1]*g+H[N+2]*P+H[N+3]*i)}let yN=.6-r*r-u*u-Y*Y-D*D;if(yN<0)U=0;else{const N=a[AN+z+a[aN+R+a[CN+J+a[UN+f]]]]%32*4;yN*=yN,U=yN*yN*(H[N]*r+H[N+1]*u+H[N+2]*Y+H[N+3]*D)}let eN=.6-c*c-Q*Q-E*E-O*O;if(eN<0)e=0;else{const N=a[AN+G+a[aN+o+a[CN+Z+a[UN+mN]]]]%32*4;eN*=eN,e=eN*eN*(H[N]*c+H[N+1]*Q+H[N+2]*E+H[N+3]*O)}let HN=.6-B*B-d*d-t*t-S*S;if(HN<0)M=0;else{const N=a[AN+q+a[aN+h+a[CN+j+a[UN+V]]]]%32*4;HN*=HN,M=HN*HN*(H[N]*B+H[N+1]*d+H[N+2]*t+H[N+3]*S)}let MN=.6-s*s-NN*NN-pN*pN-TN*TN;if(MN<0)b=0;else{const N=a[AN+1+a[aN+1+a[CN+1+a[UN+1]]]]%32*4;MN*=MN,b=MN*MN*(H[N]*s+H[N+1]*NN+H[N+2]*pN+H[N+3]*TN)}return 27*(C+U+e+M+b)}}}}]);