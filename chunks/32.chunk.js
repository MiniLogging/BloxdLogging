/*! For license information please see 2gujt.32.93040134.chunk.js.LICENSE.txt */
(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[32],{14690:(t,b,Z)=>{"use strict";var J=Z(14698),S=Z(14707),P=Z(14715);Z.g.__TYPEDARRAY_POOL||(Z.g.__TYPEDARRAY_POOL={UINT8:S([32,0]),UINT16:S([32,0]),UINT32:S([32,0]),INT8:S([32,0]),INT16:S([32,0]),INT32:S([32,0]),FLOAT:S([32,0]),DOUBLE:S([32,0]),DATA:S([32,0]),UINT8C:S([32,0]),BUFFER:S([32,0])});var v="undefined"!==typeof Uint8ClampedArray,h=Z.g.__TYPEDARRAY_POOL;h.UINT8C||(h.UINT8C=S([32,0])),h.BUFFER||(h.BUFFER=S([32,0]));var C=h.DATA,Y=h.BUFFER;function g(t){if(t){var b=t.length||t.byteLength,Z=J.log2(b);C[Z].push(t)}}function I(t){t=J.nextPow2(t);var b=J.log2(t),Z=C[b];return Z.length>0?Z.pop():new ArrayBuffer(t)}function r(t){return new Uint8Array(I(t),0,t)}function M(t){return new Uint16Array(I(2*t),0,t)}function T(t){return new Uint32Array(I(4*t),0,t)}function a(t){return new Int8Array(I(t),0,t)}function k(t){return new Int16Array(I(2*t),0,t)}function u(t){return new Int32Array(I(4*t),0,t)}function l(t){return new Float32Array(I(4*t),0,t)}function U(t){return new Float64Array(I(8*t),0,t)}function E(t){return v?new Uint8ClampedArray(I(t),0,t):r(t)}function c(t){return new DataView(I(t),0,t)}b.free=function(t){if(P(t))Y[J.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var b=t.length||t.byteLength,Z=0|J.log2(b);C[Z].push(t)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(t){g(t.buffer)},b.freeArrayBuffer=g,b.freeBuffer=function(t){Y[J.log2(t.length)].push(t)},b.malloc=function(t,b){if(void 0===b||"arraybuffer"===b)return I(t);switch(b){case"uint8":return r(t);case"uint16":return M(t);case"uint32":return T(t);case"int8":return a(t);case"int16":return k(t);case"int32":return u(t);case"float":case"float32":return l(t);case"double":case"float64":return U(t);case"uint8_clamped":return E(t);case"buffer":throw"Buffer not supported";case"data":case"dataview":return c(t);default:return null}return null},b.mallocArrayBuffer=I,b.mallocUint8=r,b.mallocUint16=M,b.mallocUint32=T,b.mallocInt8=a,b.mallocInt16=k,b.mallocInt32=u,b.mallocFloat32=b.mallocFloat=l,b.mallocFloat64=b.mallocDouble=U,b.mallocUint8Clamped=E,b.mallocDataView=c,b.clearCache=function(){for(var t=0;t<32;++t)h.UINT8[t].length=0,h.UINT16[t].length=0,h.UINT32[t].length=0,h.INT8[t].length=0,h.INT16[t].length=0,h.INT32[t].length=0,h.FLOAT[t].length=0,h.DOUBLE[t].length=0,h.UINT8C[t].length=0,C[t].length=0,Y[t].length=0}},14786:(t,b,Z)=>{t.exports=S;var J=Z(13530);function S(t,b){if(!(this instanceof S))return new S(t,b);var Z=J.create();J.add(Z,t,b),this.base=J.min(J.create(),t,Z),this.Qg=J.clone(b),this.max=J.max(J.create(),t,Z),this.mag=J.length(this.Qg)}var P=S.prototype;P.width=function(){return this.Qg[0]},P.height=function(){return this.Qg[1]},P.depth=function(){return this.Qg[2]},P.x0=function(){return this.base[0]},P.y0=function(){return this.base[1]},P.z0=function(){return this.base[2]},P.x1=function(){return this.max[0]},P.y1=function(){return this.max[1]},P.z1=function(){return this.max[2]},P.translate=function(t){return J.add(this.max,this.max,t),J.add(this.base,this.base,t),this},P.setPosition=function(t){return J.add(this.max,t,this.Qg),J.i(this.base,t),this},P.expand=function(t){var b=J.create(),Z=J.create();return J.max(b,t.max,this.max),J.min(Z,t.base,this.base),J.SZ(b,b,Z),new S(Z,b)},P.intersects=function(t){return!(t.base[0]>this.max[0])&&(!(t.base[1]>this.max[1])&&(!(t.base[2]>this.max[2])&&(!(t.max[0]<this.base[0])&&(!(t.max[1]<this.base[1])&&!(t.max[2]<this.base[2])))))},P.touches=function(t){var b=this.union(t);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},P.union=function(t){if(!this.intersects(t))return null;var b=Math.max(t.base[0],this.base[0]),Z=Math.max(t.base[1],this.base[1]),J=Math.max(t.base[2],this.base[2]);return new S([b,Z,J],[Math.min(t.max[0],this.max[0])-b,Math.min(t.max[1],this.max[1])-Z,Math.min(t.max[2],this.max[2])-J])}},14698:(t,b)=>{"use strict";function Z(t){var b=32;return(t&=-t)&&b--,65535&t&&(b-=16),16711935&t&&(b-=8),252645135&t&&(b-=4),858993459&t&&(b-=2),1431655765&t&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(t){return(t>0)-(t<0)},b.abs=function(t){var b=t>>31;return(t^b)-b},b.min=function(t,b){return b^(t^b)&-(t<b)},b.max=function(t,b){return t^(t^b)&-(t<b)},b.isPow2=function(t){return!(t&t-1)&&!!t},b.log2=function(t){var b,Z;return b=(t>65535)<<4,b|=Z=((t>>>=b)>255)<<3,b|=Z=((t>>>=Z)>15)<<2,(b|=Z=((t>>>=Z)>3)<<1)|(t>>>=Z)>>1},b.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},b.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},b.countTrailingZeros=Z,b.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},b.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},b.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var J=new Array(256);!function(t){for(var b=0;b<256;++b){var Z=b,J=b,S=7;for(Z>>>=1;Z;Z>>>=1)J<<=1,J|=1&Z,--S;t[b]=J<<S&255}}(J),b.reverse=function(t){return J[255&t]<<24|J[t>>>8&255]<<16|J[t>>>16&255]<<8|J[t>>>24&255]},b.interleave2=function(t,b){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(t,b){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>b&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},b.interleave3=function(t,b,Z){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},b.deinterleave3=function(t,b){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>b&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},b.nextCombination=function(t){var b=t|t-1;return b+1|(~b&-~b)-1>>>Z(t)+1}},14688:(t,b,Z)=>{"use strict";t.exports=function(t,b,Z){switch(arguments.length){case 1:return J=[],Y(S=t,S,g,!0),J;case 2:return"function"===typeof b?Y(t,t,b,!0):function(t,b){return J=[],Y(t,b,g,!1),J}(t,b);case 3:return Y(t,b,Z,!1);default:throw new Error("box-intersect: Invalid arguments")}var S};var J,S=Z(14690),P=Z(14717),v=Z(14734);function h(t,b){for(var Z=0;Z<t;++Z)if(!(b[Z]<=b[Z+t]))return!0;return!1}function C(t,b,Z,J){for(var S=0,P=0,v=0,C=t.length;v<C;++v){var Y=t[v];if(!h(b,Y)){for(var g=0;g<2*b;++g)Z[S++]=Y[g];J[P++]=v}}return P}function Y(t,b,Z,J){var h=t.length,Y=b.length;if(!(h<=0||Y<=0)){var g=t[0].length>>>1;if(!(g<=0)){var I,r=S.mallocDouble(2*g*h),M=S.mallocInt32(h);if((h=C(t,g,r,M))>0){if(1===g&&J)P.init(h),I=P.sweepComplete(g,Z,0,h,r,M,0,h,r,M);else{var T=S.mallocDouble(2*g*Y),a=S.mallocInt32(Y);(Y=C(b,g,T,a))>0&&(P.init(h+Y),I=1===g?P.sweepBipartite(g,Z,0,h,r,M,0,Y,T,a):v(g,Z,J,h,r,M,Y,T,a),S.free(T),S.free(a))}S.free(r),S.free(M)}return I}}}function g(t,b){J.push([t,b])}},14741:(t,b)=>{"use strict";var Z="d",J="ax",S="fp",P="es",v="rs",h="re",C="rb",Y="bs",g="be",I="bb",r=[Z,J,"vv",v,h,C,"ri",Y,g,I,"bi"];function M(t){var b="bruteForce"+(t?"Full":"Partial"),J=[],v=r.slice();t||v.splice(3,0,S);var h=["function "+b+"("+v.join()+"){"];function C(b,S){var v=function(t,b,J){var S="bruteForce"+(t?"Red":"Blue")+(b?"Flip":"")+(J?"Full":""),v=["function ",S,"(",r.join(),"){","var ",P,"=2*",Z,";"],h="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(J?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return t?v.push(h,"Q",":",C):v.push(C,"Q",":",h),J?v.push("if(y1<x0||x1<y0)continue;"):b?v.push("if(y0<=x0||x1<y0)continue;"):v.push("if(y0<x0||x1<y0)continue;"),v.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?v.push("yi,xi"):v.push("xi,yi"),v.push(");if(rv!==void 0)return rv;}}}"),{name:S,code:v.join("")}}(b,S,t);J.push(v.code),h.push("return "+v.name+"("+r.join()+");")}h.push("if(re-rs>be-bs){"),t?(C(!0,!1),h.push("}else{"),C(!1,!1)):(h.push("if(fp){"),C(!0,!0),h.push("}else{"),C(!0,!1),h.push("}}else{if(fp){"),C(!1,!0),h.push("}else{"),C(!1,!1),h.push("}")),h.push("}}return "+b);var Y=J.join("")+h.join("");return new Function(Y)()}b.partial=M(!1),b.full=M(!0)},14734:(t,b,Z)=>{"use strict";t.exports=function(t,b,Z,P,g,W,j,V,n){!function(t,b){var Z=8*S.log2(b+1)*(t+1)|0,P=S.nextPow2(E*Z);H.length<P&&(J.free(H),H=J.mallocInt32(P));var v=S.nextPow2(c*Z);o.length<v&&(J.free(o),o=J.mallocDouble(v))}(t,P+j);var y,d=0,s=2*t;O(d++,0,0,P,0,j,Z?16:0,-1/0,1/0),Z||O(d++,0,0,j,0,P,1,-1/0,1/0);for(;d>0;){var q=(d-=1)*E,Q=H[q],N=H[q+1],A=H[q+2],K=H[q+3],L=H[q+4],F=H[q+5],B=d*c,X=o[B],x=o[B+1],i=1&F,z=!!(16&F),D=g,f=W,mt=V,R=n;if(i&&(D=V,f=n,mt=g,R=W),!(2&F&&N>=(A=k(t,Q,N,A,D,f,x)))&&!(4&F&&(N=u(t,Q,N,A,D,f,X))>=A)){var w=A-N,G=L-K;if(z){if(t*w*(w+G)<M){if(void 0!==(y=C.scanComplete(t,Q,b,N,A,D,f,K,L,mt,R)))return y;continue}}else{if(t*Math.min(w,G)<I){if(void 0!==(y=v(t,Q,b,i,N,A,D,f,K,L,mt,R)))return y;continue}if(t*w*G<r){if(void 0!==(y=C.scanBipartite(t,Q,b,i,N,A,D,f,K,L,mt,R)))return y;continue}}var tt=T(t,Q,N,A,D,f,X,x);if(N<tt)if(t*(tt-N)<I){if(void 0!==(y=h(t,Q+1,b,N,tt,D,f,K,L,mt,R)))return y}else if(Q===t-2){if(void 0!==(y=i?C.sweepBipartite(t,b,K,L,mt,R,N,tt,D,f):C.sweepBipartite(t,b,N,tt,D,f,K,L,mt,R)))return y}else O(d++,Q+1,N,tt,K,L,i,-1/0,1/0),O(d++,Q+1,K,L,N,tt,1^i,-1/0,1/0);if(tt<A){var bt=Y(t,Q,K,L,mt,R),Zt=mt[s*bt+Q],Jt=a(t,Q,bt,L,mt,R,Zt);if(Jt<L&&O(d++,Q,tt,A,Jt,L,(4|i)+(z?16:0),Zt,x),K<bt&&O(d++,Q,tt,A,K,bt,(2|i)+(z?16:0),X,Zt),bt+1===Jt){if(void 0!==(y=z?e(t,Q,b,tt,A,D,f,bt,mt,R[bt]):p(t,Q,b,i,tt,A,D,f,bt,mt,R[bt])))return y}else if(bt<Jt){var St;if(z){if(tt<(St=l(t,Q,tt,A,D,f,Zt))){var Pt=a(t,Q,tt,St,D,f,Zt);if(Q===t-2){if(tt<Pt&&void 0!==(y=C.sweepComplete(t,b,tt,Pt,D,f,bt,Jt,mt,R)))return y;if(Pt<St&&void 0!==(y=C.sweepBipartite(t,b,Pt,St,D,f,bt,Jt,mt,R)))return y}else tt<Pt&&O(d++,Q+1,tt,Pt,bt,Jt,16,-1/0,1/0),Pt<St&&(O(d++,Q+1,Pt,St,bt,Jt,0,-1/0,1/0),O(d++,Q+1,bt,Jt,Pt,St,1,-1/0,1/0))}}else tt<(St=i?U(t,Q,tt,A,D,f,Zt):l(t,Q,tt,A,D,f,Zt))&&(Q===t-2?y=i?C.sweepBipartite(t,b,bt,Jt,mt,R,tt,St,D,f):C.sweepBipartite(t,b,tt,St,D,f,bt,Jt,mt,R):(O(d++,Q+1,tt,St,bt,Jt,i,-1/0,1/0),O(d++,Q+1,bt,Jt,tt,St,1^i,-1/0,1/0)))}}}}};var J=Z(14690),S=Z(14698),P=Z(14741),v=P.partial,h=P.full,C=Z(14717),Y=Z(14750),g=Z(14754),I=128,r=1<<22,M=1<<22,T=g("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),a=g("lo===p0",["p0"]),k=g("lo<p0",["p0"]),u=g("hi<=p0",["p0"]),l=g("lo<=p0&&p0<=hi",["p0"]),U=g("lo<p0&&p0<=hi",["p0"]),E=6,c=2,H=J.mallocInt32(1024),o=J.mallocDouble(1024);function O(t,b,Z,J,S,P,v,h,C){var Y=E*t;H[Y]=b,H[Y+1]=Z,H[Y+2]=J,H[Y+3]=S,H[Y+4]=P,H[Y+5]=v;var g=c*t;o[g]=h,o[g+1]=C}function p(t,b,Z,J,S,P,v,h,C,Y,g){var I=2*t,r=C*I,M=Y[r+b];t:for(var T=S,a=S*I;T<P;++T,a+=I){var k=v[a+b],u=v[a+b+t];if(!(M<k||u<M)&&(!J||M!==k)){for(var l,U=h[T],E=b+1;E<t;++E){k=v[a+E],u=v[a+E+t];var c=Y[r+E],H=Y[r+E+t];if(u<c||H<k)continue t}if(void 0!==(l=J?Z(g,U):Z(U,g)))return l}}}function e(t,b,Z,J,S,P,v,h,C,Y){var g=2*t,I=h*g,r=C[I+b];t:for(var M=J,T=J*g;M<S;++M,T+=g){var a=v[M];if(a!==Y){var k=P[T+b],u=P[T+b+t];if(!(r<k||u<r)){for(var l=b+1;l<t;++l){k=P[T+l],u=P[T+l+t];var U=C[I+l],E=C[I+l+t];if(u<U||E<k)continue t}var c=Z(a,Y);if(void 0!==c)return c}}}}},14750:(t,b,Z)=>{"use strict";t.exports=function(t,b,Z,v,h,C){if(v<=Z+1)return Z;var Y=Z,g=v,I=v+Z>>>1,r=2*t,M=I,T=h[r*I+b];for(;Y<g;){if(g-Y<S){P(t,b,Y,g,h,C),T=h[r*I+b];break}var a=g-Y,k=Math.random()*a+Y|0,u=h[r*k+b],l=Math.random()*a+Y|0,U=h[r*l+b],E=Math.random()*a+Y|0,c=h[r*E+b];u<=U?c>=U?(M=l,T=U):u>=c?(M=k,T=u):(M=E,T=c):U>=c?(M=l,T=U):c>=u?(M=k,T=u):(M=E,T=c);for(var H=r*(g-1),o=r*M,O=0;O<r;++O,++H,++o){var p=h[H];h[H]=h[o],h[o]=p}var e=C[g-1];C[g-1]=C[M],C[M]=e;for(H=r*(g-1),o=r*(M=J(t,b,Y,g-1,h,C,T)),O=0;O<r;++O,++H,++o){p=h[H];h[H]=h[o],h[o]=p}e=C[g-1];if(C[g-1]=C[M],C[M]=e,I<M){for(g=M-1;Y<g&&h[r*(g-1)+b]===T;)g-=1;g+=1}else{if(!(M<I))break;for(Y=M+1;Y<g&&h[r*Y+b]===T;)Y+=1}}return J(t,b,Z,I,h,C,h[r*I+b])};var J=Z(14754)("lo<p0",["p0"]),S=8;function P(t,b,Z,J,S,P){for(var v=2*t,h=v*(Z+1)+b,C=Z+1;C<J;++C,h+=v)for(var Y=S[h],g=C,I=v*(C-1);g>Z&&S[I+b]>Y;--g,I-=v){for(var r=I,M=I+v,T=0;T<v;++T,++r,++M){var a=S[r];S[r]=S[M],S[M]=a}var k=P[g];P[g]=P[g-1],P[g-1]=k}}},14754:t=>{"use strict";t.exports=function(t,Z){var J="abcdef".split("").concat(Z),S=[];t.indexOf("lo")>=0&&S.push("lo=e[k+n]");t.indexOf("hi")>=0&&S.push("hi=e[k+o]");return J.push(b.replace("_",S.join()).replace("$",t)),Function.apply(void 0,J)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14725:t=>{"use strict";t.exports=function(t,J){J<=4*b?Z(0,J-1,t):Y(0,J-1,t)};var b=32;function Z(t,b,Z){for(var J=2*(t+1),S=t+1;S<=b;++S){for(var P=Z[J++],v=Z[J++],h=S,C=J-2;h-- >t;){var Y=Z[C-2],g=Z[C-1];if(Y<P)break;if(Y===P&&g<v)break;Z[C]=Y,Z[C+1]=g,C-=2}Z[C]=P,Z[C+1]=v}}function J(t,b,Z){b*=2;var J=Z[t*=2],S=Z[t+1];Z[t]=Z[b],Z[t+1]=Z[b+1],Z[b]=J,Z[b+1]=S}function S(t,b,Z){b*=2,Z[t*=2]=Z[b],Z[t+1]=Z[b+1]}function P(t,b,Z,J){b*=2,Z*=2;var S=J[t*=2],P=J[t+1];J[t]=J[b],J[t+1]=J[b+1],J[b]=J[Z],J[b+1]=J[Z+1],J[Z]=S,J[Z+1]=P}function v(t,b,Z,J,S){b*=2,S[t*=2]=S[b],S[b]=Z,S[t+1]=S[b+1],S[b+1]=J}function h(t,b,Z){b*=2;var J=Z[t*=2],S=Z[b];return!(J<S)&&(J!==S||Z[t+1]>Z[b+1])}function C(t,b,Z,J){var S=J[t*=2];return S<b||S===b&&J[t+1]<Z}function Y(t,g,I){var r=(g-t+1)/6|0,M=t+r,T=g-r,a=t+g>>1,k=a-r,u=a+r,l=M,U=k,E=a,c=u,H=T,o=t+1,O=g-1,p=0;h(l,U,I)&&(p=l,l=U,U=p),h(c,H,I)&&(p=c,c=H,H=p),h(l,E,I)&&(p=l,l=E,E=p),h(U,E,I)&&(p=U,U=E,E=p),h(l,c,I)&&(p=l,l=c,c=p),h(E,c,I)&&(p=E,E=c,c=p),h(U,H,I)&&(p=U,U=H,H=p),h(U,E,I)&&(p=U,U=E,E=p),h(c,H,I)&&(p=c,c=H,H=p);for(var e=I[2*U],W=I[2*U+1],j=I[2*c],V=I[2*c+1],n=2*l,y=2*E,d=2*H,s=2*M,q=2*a,Q=2*T,N=0;N<2;++N){var A=I[n+N],K=I[y+N],L=I[d+N];I[s+N]=A,I[q+N]=K,I[Q+N]=L}S(k,t,I),S(u,g,I);for(var F=o;F<=O;++F)if(C(F,e,W,I))F!==o&&J(F,o,I),++o;else if(!C(F,j,V,I))for(;;){if(C(O,j,V,I)){C(O,e,W,I)?(P(F,o,O,I),++o,--O):(J(F,O,I),--O);break}if(--O<F)break}v(t,o-1,e,W,I),v(g,O+1,j,V,I),o-2-t<=b?Z(t,o-2,I):Y(t,o-2,I),g-(O+2)<=b?Z(O+2,g,I):Y(O+2,g,I),O-o<=b?Z(o,O,I):Y(o,O,I)}},14717:(t,b,Z)=>{"use strict";t.exports={init:function(t){var b=S.nextPow2(t);C.length<b&&(J.free(C),C=J.mallocInt32(b));Y.length<b&&(J.free(Y),Y=J.mallocInt32(b));g.length<b&&(J.free(g),g=J.mallocInt32(b));I.length<b&&(J.free(I),I=J.mallocInt32(b));r.length<b&&(J.free(r),r=J.mallocInt32(b));M.length<b&&(J.free(M),M=J.mallocInt32(b));var Z=8*b;T.length<Z&&(J.free(T),T=J.mallocDouble(Z))},sweepBipartite:function(t,b,Z,J,S,h,r,M,u,l){for(var U=0,E=2*t,c=t-1,H=E-1,o=Z;o<J;++o){var O=h[o],p=E*o;T[U++]=S[p+c],T[U++]=-(O+1),T[U++]=S[p+H],T[U++]=O}for(o=r;o<M;++o){O=l[o]+v;var e=E*o;T[U++]=u[e+c],T[U++]=-O,T[U++]=u[e+H],T[U++]=O}var W=U>>>1;P(T,W);var j=0,V=0;for(o=0;o<W;++o){var n=0|T[2*o+1];if(n>=v)a(g,I,V--,n=n-v|0);else if(n>=0)a(C,Y,j--,n);else if(n<=-v){n=-n-v|0;for(var y=0;y<j;++y){if(void 0!==(d=b(C[y],n)))return d}k(g,I,V++,n)}else{n=-n-1|0;for(y=0;y<V;++y){var d;if(void 0!==(d=b(n,g[y])))return d}k(C,Y,j++,n)}}},sweepComplete:function(t,b,Z,J,S,v,h,u,l,U){for(var E=0,c=2*t,H=t-1,o=c-1,O=Z;O<J;++O){var p=v[O]+1<<1,e=c*O;T[E++]=S[e+H],T[E++]=-p,T[E++]=S[e+o],T[E++]=p}for(O=h;O<u;++O){p=U[O]+1<<1;var W=c*O;T[E++]=l[W+H],T[E++]=1|-p,T[E++]=l[W+o],T[E++]=1|p}var j=E>>>1;P(T,j);var V=0,n=0,y=0;for(O=0;O<j;++O){var d=0|T[2*O+1],s=1&d;if(O<j-1&&d>>1===T[2*O+3]>>1&&(s=2,O+=1),d<0){for(var q=-(d>>1)-1,Q=0;Q<y;++Q){if(void 0!==(N=b(r[Q],q)))return N}if(0!==s)for(Q=0;Q<V;++Q){if(void 0!==(N=b(C[Q],q)))return N}if(1!==s)for(Q=0;Q<n;++Q){var N;if(void 0!==(N=b(g[Q],q)))return N}0===s?k(C,Y,V++,q):1===s?k(g,I,n++,q):2===s&&k(r,M,y++,q)}else{q=(d>>1)-1;0===s?a(C,Y,V--,q):1===s?a(g,I,n--,q):2===s&&a(r,M,y--,q)}}},scanBipartite:function(t,b,Z,J,S,h,g,I,r,M,u,l){var U=0,E=2*t,c=b,H=b+t,o=1,O=1;J?O=v:o=v;for(var p=S;p<h;++p){var e=p+o,W=E*p;T[U++]=g[W+c],T[U++]=-e,T[U++]=g[W+H],T[U++]=e}for(p=r;p<M;++p){e=p+O;var j=E*p;T[U++]=u[j+c],T[U++]=-e}var V=U>>>1;P(T,V);var n=0;for(p=0;p<V;++p){var y=0|T[2*p+1];if(y<0){var d=!1;if((e=-y)>=v?(d=!J,e-=v):(d=!!J,e-=1),d)k(C,Y,n++,e);else{var s=l[e],q=E*e,Q=u[q+b+1],N=u[q+b+1+t];t:for(var A=0;A<n;++A){var K=C[A],L=E*K;if(!(N<g[L+b+1]||g[L+b+1+t]<Q)){for(var F=b+2;F<t;++F)if(u[q+F+t]<g[L+F]||g[L+F+t]<u[q+F])continue t;var B,X=I[K];if(void 0!==(B=J?Z(s,X):Z(X,s)))return B}}}}else a(C,Y,n--,y-o)}},scanComplete:function(t,b,Z,J,S,h,Y,g,I,r,M){for(var a=0,k=2*t,u=b,l=b+t,U=J;U<S;++U){var E=U+v,c=k*U;T[a++]=h[c+u],T[a++]=-E,T[a++]=h[c+l],T[a++]=E}for(U=g;U<I;++U){E=U+1;var H=k*U;T[a++]=r[H+u],T[a++]=-E}var o=a>>>1;P(T,o);var O=0;for(U=0;U<o;++U){var p=0|T[2*U+1];if(p<0){if((E=-p)>=v)C[O++]=E-v;else{var e=M[E-=1],W=k*E,j=r[W+b+1],V=r[W+b+1+t];t:for(var n=0;n<O;++n){var y=C[n],d=Y[y];if(d===e)break;var s=k*y;if(!(V<h[s+b+1]||h[s+b+1+t]<j)){for(var q=b+2;q<t;++q)if(r[W+q+t]<h[s+q]||h[s+q+t]<r[W+q])continue t;var Q=Z(d,e);if(void 0!==Q)return Q}}}}else{for(E=p-v,n=O-1;n>=0;--n)if(C[n]===E){for(q=n+1;q<O;++q)C[q-1]=C[q];break}--O}}}};var J=Z(14690),S=Z(14698),P=Z(14725),v=1<<28,h=1024,C=J.mallocInt32(h),Y=J.mallocInt32(h),g=J.mallocInt32(h),I=J.mallocInt32(h),r=J.mallocInt32(h),M=J.mallocInt32(h),T=J.mallocDouble(8192);function a(t,b,Z,J){var S=b[J],P=t[Z-1];t[S]=P,b[P]=S}function k(t,b,Z,J){t[Z]=J,b[J]=Z}},14707:t=>{"use strict";function b(t,Z,J){var S=0|t[J];if(S<=0)return[];var P,v=new Array(S);if(J===t.length-1)for(P=0;P<S;++P)v[P]=Z;else for(P=0;P<S;++P)v[P]=b(t,Z,J+1);return v}t.exports=function(t,Z){switch("undefined"===typeof Z&&(Z=0),typeof t){case"number":if(t>0)return function(t,b){var Z,J;for(Z=new Array(t),J=0;J<t;++J)Z[J]=b;return Z}(0|t,Z);break;case"object":if("number"===typeof t.length)return b(t,Z,0)}return[]}},14658:(t,b,Z)=>{t.exports=function(){var t=this;this.components={},this.comps=this.components;var b=this.components,Z=1,S={},P=[],v=[],h={timeout:!1,removals:[],multiComps:[]};function C(t,Z){var J=b[Z],P=S[Z],v=P.hash[t];v&&(P.remove(t),J.Yb&&(J.multi?(v.forEach((b=>{b&&J.Yb(t,b)})),v.length=0):J.Yb(t,v)),h.removals.push(P),Y())}function Y(){h.timeout||(h.timeout=!0,setTimeout(g,1))}function g(){h.timeout=!1,I()}function I(){h.multiComps.length&&function(t){for(var b=0;b<t.length;b++){var{entID:Z,data:J}=t[b],S=J.hash[Z];if(S){for(var P=0;P<S.length;P++)S[P]||(S.splice(P,1),P--);0===S.length&&(J.remove(Z),h.removals.push(J))}}t.length=0}(h.multiComps),h.removals.length&&function(t){for(var b=0;b<t.length;b++){t[b].flush()}t.length=0}(h.removals)}this.Zr=S,this._systems=P,this._renderSystems=v,this.uY=function(b){var J=Z++;return Array.isArray(b)&&b.forEach((b=>t.YY(J,b))),J},this.deleteEntity=function(b){return Object.keys(S).forEach((t=>{S[t].hash[b]&&C(b,t)})),t},this.vI=function(t){if(!t)throw new Error("Missing component definition");var Z=t.name;if(!Z)throw new Error("Component definition must have a name property.");if("string"!==typeof Z)throw new Error("Component name must be a string.");if(""===Z)throw new Error("Component name must be a non-empty string.");if(S[Z])throw new Error(`Component ${Z} already exists.`);var h={};return h.name=Z,h.multi=!!t.multi,h.order=isNaN(t.order)?99:t.order,h.stateConstructor=t.stateConstructor||null,h.state=t.state||{},h.hC=t.hC||null,h.Yb=t.Yb||null,h.system=t.system||null,h.MC=t.MC||null,b[Z]=h,S[Z]=new J,S[Z]._pendingMultiCleanup=!1,S[Z]._multiCleanupIDs=h.multi?[]:null,h.system&&(P.push(Z),P.sort(((t,Z)=>b[t].order-b[Z].order))),h.MC&&(v.push(Z),v.sort(((t,Z)=>b[t].order-b[Z].order))),Z},this.overwriteComponent=function(t,Z){var J=b[t];if(!J)throw new Error(`Unknown component: ${t}`);if(!Z)throw new Error("Missing component definition");if(J.name!==Z.name)throw new Error("Overwriting component must use the same name property.");var h={};h.name=t,h.multi=!!Z.multi,h.order=isNaN(Z.order)?99:Z.order,h.state=Z.state||{},h.hC=Z.hC||null,h.Yb=Z.Yb||null,h.system=Z.system||null,h.MC=Z.MC||null,b[t]=h,S[t]._pendingMultiCleanup=!1,S[t]._multiCleanupIDs=h.multi?[]:null;var C=P.indexOf(t);h.system&&C<0&&P.push(t),!h.system&&C>=0&&P.splice(C,1),P.sort(((t,Z)=>b[t].order-b[Z].order));var Y=v.indexOf(t);h.MC&&Y<0&&v.push(t),!h.MC&&Y>=0&&v.splice(Y,1),v.sort(((t,Z)=>b[t].order-b[Z].order));var g=h.state;return this.ag(t).forEach((t=>{for(var b in g)b in t||(t[b]=g[b]);h.hC&&h.hC(t.IC,t)})),t},this.deleteComponent=function(Z){var J=S[Z];if(!J)throw new Error(`Unknown component: ${Z}`);J.flush(),J.list.forEach((t=>{t&&C(t.IC||t[0].IC,Z)}));var h=P.indexOf(Z),Y=v.indexOf(Z);return h>-1&&P.splice(h,1),Y>-1&&v.splice(Y,1),S[Z].dispose(),delete S[Z],delete b[Z],t},this.YY=function(t,Z,J){var P,v=b[Z],h=S[Z];if(!h)throw new Error(`Unknown component: ${Z}.`);if(h.hash[t]&&!v.multi)throw new Error(`Entity ${t} already has component: ${Z}.`);if(v.stateConstructor){if(!(P=new v.stateConstructor).hasOwnProperty("IC"))throw new Error(`Component ${v.name} stateConstructor type does not have property __id`)}else P=Object.assign({},{IC:t},v.state,J);if(P.IC=t,v.multi){var C=h.hash[t];C||(C=[],h.add(t,C)),C.push(P)}else h.add(t,P);return v.hC&&v.hC(t,P),this},this.EY=function(t,b){var Z=S[b];if(!Z)throw new Error(`Unknown component: ${b}.`);return!!Z.hash[t]},this.MY=function(b,Z){if(!S[Z])throw new Error(`Unknown component: ${Z}.`);return C(b,Z),t},this.getState=function(t,b){var Z=S[b];if(!Z)throw new Error(`Unknown component: ${b}.`);return Z.hash[t]},this.ag=function(t){var b=S[t];if(!b)throw new Error(`Unknown component: ${t}.`);return I(),b.list},this.zM=function(t){if(!S[t])throw new Error(`Unknown component: ${t}.`);var b=S[t].hash;return t=>b[t]},this.mT=function(t){if(!S[t])throw new Error(`Unknown component: ${t}.`);var b=S[t].hash;return t=>!!b[t]},this.PC=function(Z){I();for(var J=0;J<P.length;J++){var v=P[J],h=b[v],C=S[v];h.system(Z,C.list),I()}return t},this.render=function(Z){I();for(var J=0;J<v.length;J++){var P=v[J],h=b[P],C=S[P];h.MC(Z,C.list),I()}return t},this.removeMultiComponent=function(Z,J,P){var v=b[J],C=S[J];if(!C)throw new Error(`Unknown component: ${J}.`);if(!v.multi)throw new Error("removeMultiComponent called on non-multi component");return function(t,b,Z,J){var S=Z.hash[t];if(S){var P=S[J];P&&(S[J]=null,b.Yb&&b.Yb(t,P),h.multiComps.push({entID:t,data:Z}),Y())}}(Z,v,C,P),t}};var J=Z(14662)},14662:t=>{function b(t,b){var Z=t._map[b];if(delete t.hash[b],delete t._map[b],Z===t.list.length-1)t.list.pop();else{var J=t.list.pop();if(t.list[Z]=J,null===J||null===J[0]){var S=t.list.length;for(var P in t._map)if(t._map[P]===S)return void(t._map[P]=Z)}else{var v=J.IC||J[0].IC;t._map[v]=Z}}}t.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(t,b){if("number"===typeof this._map[t]){var Z=this._map[t];this.hash[t]=b,this.list[Z]=b}else this._map[t]=this.list.length,this.hash[t]=b,this.list.push(b)}remove(t){var b=this._map[t];this.hash[t]=null,this.list[b]=null,this._pendingRemovals.push(t)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var t=0;t<this._pendingRemovals.length;t++){var Z=this._pendingRemovals[t];null===this.hash[Z]&&b(this,Z)}this._pendingRemovals.length=0}}},14621:t=>{"use strict";var b,Z="object"===typeof Reflect?Reflect:null,J=function(t,b,Z){return Function.prototype.apply.call(t,b,Z)};b=Z&&"function"===typeof Z.ownKeys?Z.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var S=Number.isNaN||function(t){return t!==t};function P(){P.init.call(this)}t.exports=P,t.exports.once=function(t,b){return new Promise((function(Z,J){function S(Z){t.removeListener(b,P),J(Z)}function P(){"function"===typeof t.removeListener&&t.removeListener("error",S),Z([].slice.call(arguments))}a(t,b,P,{once:!0}),"error"!==b&&function(t,b,Z){"function"===typeof t.on&&a(t,"error",b,Z)}(t,S,{once:!0})}))},P.EventEmitter=P,P.prototype._events=void 0,P.prototype._eventsCount=0,P.prototype._maxListeners=void 0;var v=10;function h(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function C(t){return void 0===t._maxListeners?P.defaultMaxListeners:t._maxListeners}function Y(t,b,Z,J){var S,P,v,Y;if(h(Z),void 0===(P=t._events)?(P=t._events=Object.create(null),t._eventsCount=0):(void 0!==P.newListener&&(t.emit("newListener",b,Z.listener?Z.listener:Z),P=t._events),v=P[b]),void 0===v)v=P[b]=Z,++t._eventsCount;else if("function"===typeof v?v=P[b]=J?[Z,v]:[v,Z]:J?v.unshift(Z):v.push(Z),(S=C(t))>0&&v.length>S&&!v.warned){v.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.hb=t,g.type=b,g.count=v.length,Y=g,console&&console.warn&&console.warn(Y)}return t}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(t,b,Z){var J={fired:!1,wrapFn:void 0,target:t,type:b,listener:Z},S=g.bind(J);return S.listener=Z,J.wrapFn=S,S}function r(t,b,Z){var J=t._events;if(void 0===J)return[];var S=J[b];return void 0===S?[]:"function"===typeof S?Z?[S.listener||S]:[S]:Z?function(t){for(var b=new Array(t.length),Z=0;Z<b.length;++Z)b[Z]=t[Z].listener||t[Z];return b}(S):T(S,S.length)}function M(t){var b=this._events;if(void 0!==b){var Z=b[t];if("function"===typeof Z)return 1;if(void 0!==Z)return Z.length}return 0}function T(t,b){for(var Z=new Array(b),J=0;J<b;++J)Z[J]=t[J];return Z}function a(t,b,Z,J){if("function"===typeof t.on)J.once?t.once(b,Z):t.on(b,Z);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(b,(function S(P){J.once&&t.removeEventListener(b,S),Z(P)}))}}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(t){if("number"!==typeof t||t<0||S(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");v=t}}),P.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||S(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},P.prototype.getMaxListeners=function(){return C(this)},P.prototype.emit=function(t){for(var b=[],Z=1;Z<arguments.length;Z++)b.push(arguments[Z]);var S="error"===t,P=this._events;if(void 0!==P)S=S&&void 0===P.error;else if(!S)return!1;if(S){var v;if(b.length>0&&(v=b[0]),v instanceof Error)throw v;var h=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw h.context=v,h}var C=P[t];if(void 0===C)return!1;if("function"===typeof C)J(C,this,b);else{var Y=C.length,g=T(C,Y);for(Z=0;Z<Y;++Z)J(g[Z],this,b)}return!0},P.prototype.addListener=function(t,b){return Y(this,t,b,!1)},P.prototype.on=P.prototype.addListener,P.prototype.prependListener=function(t,b){return Y(this,t,b,!0)},P.prototype.once=function(t,b){return h(b),this.on(t,I(this,t,b)),this},P.prototype.prependOnceListener=function(t,b){return h(b),this.prependListener(t,I(this,t,b)),this},P.prototype.removeListener=function(t,b){var Z,J,S,P,v;if(h(b),void 0===(J=this._events))return this;if(void 0===(Z=J[t]))return this;if(Z===b||Z.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete J[t],J.removeListener&&this.emit("removeListener",t,Z.listener||b));else if("function"!==typeof Z){for(S=-1,P=Z.length-1;P>=0;P--)if(Z[P]===b||Z[P].listener===b){v=Z[P].listener,S=P;break}if(S<0)return this;0===S?Z.shift():function(t,b){for(;b+1<t.length;b++)t[b]=t[b+1];t.pop()}(Z,S),1===Z.length&&(J[t]=Z[0]),void 0!==J.removeListener&&this.emit("removeListener",t,v||b)}return this},P.prototype.off=P.prototype.removeListener,P.prototype.Cb=function(t){var b,Z,J;if(void 0===(Z=this._events))return this;if(void 0===Z.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Z[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete Z[t]),this;if(0===arguments.length){var S,P=Object.keys(Z);for(J=0;J<P.length;++J)"removeListener"!==(S=P[J])&&this.Cb(S);return this.Cb("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(b=Z[t]))this.removeListener(t,b);else if(void 0!==b)for(J=b.length-1;J>=0;J--)this.removeListener(t,b[J]);return this},P.prototype.listeners=function(t){return r(this,t,!0)},P.prototype.rawListeners=function(t){return r(this,t,!1)},P.listenerCount=function(t,b){return"function"===typeof t.listenerCount?t.listenerCount(b):M.call(t,b)},P.prototype.listenerCount=M,P.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},14942:t=>{"use strict";t.exports=function(t,b,Z,J,S,P){var v=+b[0],h=+b[1],C=+b[2],Y=+Z[0],g=+Z[1],I=+Z[2],r=Math.sqrt(Y*Y+g*g+I*I);if(0===r)throw new Error("Can't raycast along a zero vector");return function(t,b,Z,J,S,P,v,h,C,Y){for(var g=0,I=Math.floor,r=0|I(b),M=0|I(Z),T=0|I(J),a=S>0?1:-1,k=P>0?1:-1,u=v>0?1:-1,l=Math.abs(1/S),U=Math.abs(1/P),E=Math.abs(1/v),c=l<1/0?l*(a>0?r+1-b:b-r):1/0,H=U<1/0?U*(k>0?M+1-Z:Z-M):1/0,o=E<1/0?E*(u>0?T+1-J:J-T):1/0,O=-1;g<=h;){var p=t(r,M,T);if(p)return C&&(C[0]=b+g*S,C[1]=Z+g*P,C[2]=J+g*v),Y&&(Y[0]=Y[1]=Y[2]=0,0===O&&(Y[0]=-a),1===O&&(Y[1]=-k),2===O&&(Y[2]=-u)),p;c<H?c<o?(r+=a,g=c,c+=l,O=0):(T+=u,g=o,o+=E,O=2):H<o?(M+=k,g=H,H+=U,O=1):(T+=u,g=o,o+=E,O=2)}return C&&(C[0]=b+g*S,C[1]=Z+g*P,C[2]=J+g*v),Y&&(Y[0]=Y[1]=Y[2]=0),0}(t,v,h,C,Y/=r,g/=r,I/=r,J="undefined"===typeof J?64:+J,S,P)}},14969:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>P});var J=Z(14621);function S(){this.zr=!1,this.stopPropagation=!1,this.Dr=!1,this.disabled=!1}class P{constructor(t,b){this.version="0.7.0";var Z=Object.assign({},new S,b||{});this.element=t||document,this.zr=!!Z.zr,this.stopPropagation=!!Z.stopPropagation,this.Dr=!!Z.Dr,this.disabled=!!Z.disabled,this.filterEvents=(t,b)=>!0,this.down=new J.EventEmitter,this.up=new J.EventEmitter,this.state={},this.Pg={dx:0,dy:0,NM:0,Sg:0,AM:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?h(this):document.addEventListener("DOMContentLoaded",(t=>{h(this)}),{once:!0})}bind(t){for(var b=arguments.length,Z=new Array(b>1?b-1:0),J=1;J<b;J++)Z[J-1]=arguments[J];Z.forEach((b=>{var Z=this._keyBindmap[b]||[];Z.includes(t)||(Z.push(t),this._keyBindmap[b]=Z)})),this.state[t]=!!this.state[t],this.pressCount[t]=this.pressCount[t]||0,this.releaseCount[t]=this.releaseCount[t]||0}unbind(t){for(var b in this._keyBindmap){var Z=this._keyBindmap[b],J=Z.indexOf(t);J>-1&&Z.splice(J,1)}}getBindings(){var t={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((Z=>{t[Z]=t[Z]||[],t[Z].push(b)}))}return t}PC(){v(this.Pg),v(this.pressCount),v(this.releaseCount)}}function v(t){for(var b in t)t[b]=0}function h(t){window.addEventListener("keydown",T.bind(null,t,!0),!1),window.addEventListener("keyup",T.bind(null,t,!1),!1);var b={passive:!0};t.element.addEventListener("touchstart",I.bind(void 0,t),{passive:!1}),t.element.addEventListener("touchend",M.bind(void 0,t),b),t.element.addEventListener("mousedown",a.bind(null,t,!0),b),window.document.addEventListener("mouseup",a.bind(null,t,!1),b),t.element.addEventListener("touchmove",k.bind(null,t),b),t.element.addEventListener("mousemove",k.bind(null,t),b),window.PointerEvent,t.element.addEventListener("wheel",u.bind(null,t),b),t.element.addEventListener("contextmenu",l.bind(null,t),!1),window.addEventListener("blur",U.bind(null,t),!1)}var C=0,Y=0,g=null;function I(t,b){b.preventDefault(),r(b)}function r(t){let b=!1;for(let Z=0;Z<t.touches.length;++Z)if(t.touches[Z].identifier===g){b=!0;break}if(!b){const b=t.changedTouches[0];C=b.clientX,Y=b.clientY,g=b.identifier}}function M(t,b){for(var Z=b.changedTouches,J=0;J<Z.length;++J)Z[J].identifier===g&&(g=null)}function T(t,b,Z){E(Z.code,b,t,Z)}function a(t,b,Z){if("pointerId"in Z)if(b){if(null!==t._touches.currID)return;t._touches.currID=Z.pointerId}else{if(t._touches.currID!==Z.pointerId)return;t._touches.currID=null}return E("Mouse"+("button"in Z?Z.button+1:1),b,t,Z),!1}function k(t,b){var Z=b.movementX||b.mozMovementX||0,J=b.movementY||b.mozMovementY||0;if(b.touches&&0===(Z|J)){var S=function(t){r(t);for(let b=0;b<t.changedTouches.length;++b)if(t.changedTouches[b].identifier==g){const Z=t.changedTouches[b],J=[Z.clientX-C,Z.clientY-Y];return C=Z.clientX,Y=Z.clientY,J}return console.error(`Did not find touch id ${g}`),[0,0]}(b);Z=S[0],J=S[1]}t.Pg.dx+=Z,t.Pg.dy+=J}function u(t,b){var Z=1;switch(b.deltaMode){case 0:Z=1;break;case 1:Z=12;break;case 2:Z=t.element.clientHeight||window.innerHeight}t.Pg.NM+=(b.deltaX||0)*Z,t.Pg.Sg+=(b.deltaY||0)*Z,t.Pg.AM+=(b.deltaZ||0)*Z}function l(t,b){if(!t.Dr)return b.preventDefault(),!1}function U(t){for(var b in t._keyStates)t._keyStates[b]&&(/^Mouse\d/.test(b)||E(b,!1,t,{code:b,note:"zcftufhbjp",preventDefault:()=>{},stopPropagation:()=>{}}))}function E(t,b,Z,J){var S=Z._keyBindmap[t];S&&(c(Z._keyStates[t],b)&&(Z._keyStates[t]=b,S.forEach((t=>{(!Z.filterEvents||Z.filterEvents(J,t))&&function(t,b,Z,J){var S=b?Z.pressCount:Z.releaseCount;S[t]=(S[t]||0)+1;var P=Z._bindPressCount[t]||0;(P+=b?1:-1)<0&&(P=0);Z._bindPressCount[t]=P;var v=Z.state[t];if(c(v,P)){Z.state[t]=P>0;var h=b?Z.down:Z.up;Z.disabled||h.emit(t,J)}}(t,b,Z,J)}))),"button"in J||(Z.zr&&!J.defaultPrevented&&J.preventDefault(),Z.stopPropagation&&J.stopPropagation()))}function c(t,b){return t?!b:b}},13590:t=>{t.exports=function(t,b,Z){return t[0]=b[0]+Z[0],t[1]=b[1]+Z[1],t[2]=b[2]+Z[2],t}},13544:(t,b,Z)=>{t.exports=function(t,b){var Z=J(t[0],t[1],t[2]),v=J(b[0],b[1],b[2]);S(Z,Z),S(v,v);var h=P(Z,v);return h>1?0:Math.acos(h)};var J=Z(13548),S=Z(13556),P=Z(13564)},13639:t=>{t.exports=function(t,b){return t[0]=Math.ceil(b[0]),t[1]=Math.ceil(b[1]),t[2]=Math.ceil(b[2]),t}},13542:t=>{t.exports=function(t){var b=new Float32Array(3);return b[0]=t[0],b[1]=t[1],b[2]=t[2],b}},13570:t=>{t.exports=function(t,b){return t[0]=b[0],t[1]=b[1],t[2]=b[2],t}},13540:t=>{t.exports=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}},13711:t=>{t.exports=function(t,b,Z){var J=b[0],S=b[1],P=b[2],v=Z[0],h=Z[1],C=Z[2];return t[0]=S*C-P*h,t[1]=P*v-J*C,t[2]=J*h-S*v,t}},13675:(t,b,Z)=>{t.exports=Z(13669)},13669:t=>{t.exports=function(t,b){var Z=b[0]-t[0],J=b[1]-t[1],S=b[2]-t[2];return Math.sqrt(Z*Z+J*J+S*S)}},13619:(t,b,Z)=>{t.exports=Z(13617)},13617:t=>{t.exports=function(t,b,Z){return t[0]=b[0]/Z[0],t[1]=b[1]/Z[1],t[2]=b[2]/Z[2],t}},13564:t=>{t.exports=function(t,b){return t[0]*b[0]+t[1]*b[1]+t[2]*b[2]}},13536:t=>{t.exports=1e-6},13580:(t,b,Z)=>{t.exports=function(t,b){var Z=t[0],S=t[1],P=t[2],v=b[0],h=b[1],C=b[2];return Math.abs(Z-v)<=J*Math.max(1,Math.abs(Z),Math.abs(v))&&Math.abs(S-h)<=J*Math.max(1,Math.abs(S),Math.abs(h))&&Math.abs(P-C)<=J*Math.max(1,Math.abs(P),Math.abs(C))};var J=Z(13536)},13582:t=>{t.exports=function(t,b){return t[0]===b[0]&&t[1]===b[1]&&t[2]===b[2]}},13634:t=>{t.exports=function(t,b){return t[0]=Math.floor(b[0]),t[1]=Math.floor(b[1]),t[2]=Math.floor(b[2]),t}},13755:(t,b,Z)=>{t.exports=function(t,b,Z,S,P,v){var h,C;b||(b=3);Z||(Z=0);C=S?Math.min(S*b+Z,t.length):t.length;for(h=Z;h<C;h+=b)J[0]=t[h],J[1]=t[h+1],J[2]=t[h+2],P(J,J,v),t[h]=J[0],t[h+1]=J[1],t[h+2]=J[2];return t};var J=Z(13540)()},13548:t=>{t.exports=function(t,b,Z){var J=new Float32Array(3);return J[0]=t,J[1]=b,J[2]=Z,J}},13530:(t,b,Z)=>{t.exports={EPSILON:Z(13536),create:Z(13540),clone:Z(13542),angle:Z(13544),mC:Z(13548),i:Z(13570),set:Z(13575),equals:Z(13580),exactEquals:Z(13582),add:Z(13590),SZ:Z(13595),sub:Z(13600),multiply:Z(13609),mul:Z(13611),divide:Z(13617),div:Z(13619),min:Z(13626),max:Z(13629),floor:Z(13634),ceil:Z(13639),round:Z(13644),scale:Z(13653),Rh:Z(13661),distance:Z(13669),k:Z(13675),squaredDistance:Z(13679),sqrDist:Z(13681),length:Z(13683),len:Z(13687),squaredLength:Z(13692),wh:Z(13696),negate:Z(13702),inverse:Z(13709),normalize:Z(13556),dot:Z(13564),cross:Z(13711),yh:Z(13715),random:Z(13718),transformMat4:Z(13720),transformMat3:Z(13728),transformQuat:Z(13732),Gh:Z(13739),tC:Z(13745),bC:Z(13752),forEach:Z(13755)}},13709:t=>{t.exports=function(t,b){return t[0]=1/b[0],t[1]=1/b[1],t[2]=1/b[2],t}},13687:(t,b,Z)=>{t.exports=Z(13683)},13683:t=>{t.exports=function(t){var b=t[0],Z=t[1],J=t[2];return Math.sqrt(b*b+Z*Z+J*J)}},13715:t=>{t.exports=function(t,b,Z,J){var S=b[0],P=b[1],v=b[2];return t[0]=S+J*(Z[0]-S),t[1]=P+J*(Z[1]-P),t[2]=v+J*(Z[2]-v),t}},13629:t=>{t.exports=function(t,b,Z){return t[0]=Math.max(b[0],Z[0]),t[1]=Math.max(b[1],Z[1]),t[2]=Math.max(b[2],Z[2]),t}},13626:t=>{t.exports=function(t,b,Z){return t[0]=Math.min(b[0],Z[0]),t[1]=Math.min(b[1],Z[1]),t[2]=Math.min(b[2],Z[2]),t}},13611:(t,b,Z)=>{t.exports=Z(13609)},13609:t=>{t.exports=function(t,b,Z){return t[0]=b[0]*Z[0],t[1]=b[1]*Z[1],t[2]=b[2]*Z[2],t}},13702:t=>{t.exports=function(t,b){return t[0]=-b[0],t[1]=-b[1],t[2]=-b[2],t}},13556:t=>{t.exports=function(t,b){var Z=b[0],J=b[1],S=b[2],P=Z*Z+J*J+S*S;P>0&&(P=1/Math.sqrt(P),t[0]=b[0]*P,t[1]=b[1]*P,t[2]=b[2]*P);return t}},13718:t=>{t.exports=function(t,b){b=b||1;var Z=2*Math.random()*Math.PI,J=2*Math.random()-1,S=Math.sqrt(1-J*J)*b;return t[0]=Math.cos(Z)*S,t[1]=Math.sin(Z)*S,t[2]=J*b,t}},13739:t=>{t.exports=function(t,b,Z,J){var S=Z[1],P=Z[2],v=b[1]-S,h=b[2]-P,C=Math.sin(J),Y=Math.cos(J);return t[0]=b[0],t[1]=S+v*Y-h*C,t[2]=P+v*C+h*Y,t}},13745:t=>{t.exports=function(t,b,Z,J){var S=Z[0],P=Z[2],v=b[0]-S,h=b[2]-P,C=Math.sin(J),Y=Math.cos(J);return t[0]=S+h*C+v*Y,t[1]=b[1],t[2]=P+h*Y-v*C,t}},13752:t=>{t.exports=function(t,b,Z,J){var S=Z[0],P=Z[1],v=b[0]-S,h=b[1]-P,C=Math.sin(J),Y=Math.cos(J);return t[0]=S+v*Y-h*C,t[1]=P+v*C+h*Y,t[2]=b[2],t}},13644:t=>{t.exports=function(t,b){return t[0]=Math.round(b[0]),t[1]=Math.round(b[1]),t[2]=Math.round(b[2]),t}},13653:t=>{t.exports=function(t,b,Z){return t[0]=b[0]*Z,t[1]=b[1]*Z,t[2]=b[2]*Z,t}},13661:t=>{t.exports=function(t,b,Z,J){return t[0]=b[0]+Z[0]*J,t[1]=b[1]+Z[1]*J,t[2]=b[2]+Z[2]*J,t}},13575:t=>{t.exports=function(t,b,Z,J){return t[0]=b,t[1]=Z,t[2]=J,t}},13681:(t,b,Z)=>{t.exports=Z(13679)},13696:(t,b,Z)=>{t.exports=Z(13692)},13679:t=>{t.exports=function(t,b){var Z=b[0]-t[0],J=b[1]-t[1],S=b[2]-t[2];return Z*Z+J*J+S*S}},13692:t=>{t.exports=function(t){var b=t[0],Z=t[1],J=t[2];return b*b+Z*Z+J*J}},13600:(t,b,Z)=>{t.exports=Z(13595)},13595:t=>{t.exports=function(t,b,Z){return t[0]=b[0]-Z[0],t[1]=b[1]-Z[1],t[2]=b[2]-Z[2],t}},13728:t=>{t.exports=function(t,b,Z){var J=b[0],S=b[1],P=b[2];return t[0]=J*Z[0]+S*Z[3]+P*Z[6],t[1]=J*Z[1]+S*Z[4]+P*Z[7],t[2]=J*Z[2]+S*Z[5]+P*Z[8],t}},13720:t=>{t.exports=function(t,b,Z){var J=b[0],S=b[1],P=b[2],v=Z[3]*J+Z[7]*S+Z[11]*P+Z[15];return v=v||1,t[0]=(Z[0]*J+Z[4]*S+Z[8]*P+Z[12])/v,t[1]=(Z[1]*J+Z[5]*S+Z[9]*P+Z[13])/v,t[2]=(Z[2]*J+Z[6]*S+Z[10]*P+Z[14])/v,t}},13732:t=>{t.exports=function(t,b,Z){var J=b[0],S=b[1],P=b[2],v=Z[0],h=Z[1],C=Z[2],Y=Z[3],g=Y*J+h*P-C*S,I=Y*S+C*J-v*P,r=Y*P+v*S-h*J,M=-v*J-h*S-C*P;return t[0]=g*Y+M*-v+I*-C-r*-h,t[1]=I*Y+M*-h+r*-v-g*-C,t[2]=r*Y+M*-C+g*-h-I*-v,t}},14640:t=>{"use strict";t.exports=function(t){for(var b=new Array(t),Z=0;Z<t;++Z)b[Z]=Z;return b}},14715:t=>{t.exports=function(t){return null!=t&&null!=t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},14947:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>J});class J{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.eI=!1,this.WI=!1,this.OI=30,this.pI=0,this.QI=!1,this.fullscreen=!1,this.VI=function(t){},this.nI=function(){},this.sI=function(){},this.gb=function(){},this.yI=function(t){},this.onFullscreenChanged=function(t){},Y((()=>{!function(t,b){t._nowObject=performance||Date,t._lastTick=0,t._renderAccum=0,t._rt=0,t._frameCB=h.bind(null,t),requestAnimationFrame(t._frameCB),b>0&&(t._intervalCB=v.bind(null,t),t._interval=setInterval(t._intervalCB,Math.max(b,1e3/t.OI/2)))}(this,b),function(t,b){if(!b)return;var Z=!1,J=!1;document.addEventListener("pointerlockchange",(J=>{Z=document.pointerLockElement===b,t.yI(Z)})),document.addEventListener("fullscreenchange",(Z=>{J=document.fullscreenElement===b,t.onFullscreenChanged(J)})),Object.defineProperty(t,"QI",{get:()=>Z,set:t=>{t&&!Z?C(b):Z&&!t&&function(t){t.exitPointerLock&&t.exitPointerLock()}(document)}}),Object.defineProperty(t,"fullscreen",{get:()=>J,set:t=>{t&&!J?b.requestFullscreen():J&&!t&&document.exitFullscreen()}}),b.addEventListener("click",(S=>{t.eI&&!Z&&C(b),t.WI&&!J&&b.requestFullscreen()}));var S=()=>t.gb();if(window.ResizeObserver){new ResizeObserver(S).observe(b)}else window.addEventListener("resize",S)}(this,t),this.sI()}))}}var S=3,P=20;function v(t){for(var b=1e3/t.OI,Z=t._nowObject.now()+P,J=0;t._nowObject.now()>=t._lastTick+b&&t._nowObject.now()<Z&&++J<=S;)t.VI(b),t._lastTick+=b;var v=5*(b+5),h=t._nowObject.now();if(h-t._lastTick>v)for(;h>=t._lastTick+b;)t._lastTick+=b}function h(t){requestAnimationFrame(t._frameCB),v(t);var b=t._nowObject.now(),Z=b-t._rt;if(t._rt=b,t.pI>0){t._renderAccum+=Z;var J=1e3/t.pI;if(t._renderAccum<J)return;t._renderAccum=Math.min(t._renderAccum-J,J)}var S=1e3/t.OI,P=(b-t._lastTick)/S;t.nI(Z,P,S)}function C(t){t.requestPointerLock&&t.requestPointerLock()}var Y=t=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),t()};document.addEventListener("readystatechange",b)}else setTimeout(t,1)}},14635:(t,b,Z)=>{var J=Z(14640),S=Z(14646),P="undefined"!==typeof Float64Array;function v(t,b){return t[0]-b[0]}function h(){var t,b=this.stride,Z=new Array(b.length);for(t=0;t<Z.length;++t)Z[t]=[Math.abs(b[t]),t];Z.sort(v);var J=new Array(Z.length);for(t=0;t<J.length;++t)J[t]=Z[t][1];return J}function C(t,b){var Z=["View",b,"d",t].join("");b<0&&(Z="View_Nil"+t);var S="generic"===t;if(-1===b){var P="function "+Z+"(a){this.data=a;};var proto="+Z+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Z+"(a){return new "+Z+"(a);}";return new Function(P)()}if(0===b){P="function "+Z+"(a,d) {this.data = a;this.offset = d};var proto="+Z+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Z+"_copy() {return new "+Z+"(this.data,this.offset)};proto.pick=function "+Z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Z+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Z+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Z+"(a,b,c,d){return new "+Z+"(a,d)}";return new Function("TrivialArray",P)(Y[t][0])}P=["'use strict'"];var v=J(b),C=v.map((function(t){return"i"+t})),g="this.offset+"+v.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),I=v.map((function(t){return"b"+t})).join(","),r=v.map((function(t){return"c"+t})).join(",");P.push("function "+Z+"(a,"+I+","+r+",d){this.data=a","this.shape=["+I+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+Z+".prototype","proto.dtype='"+t+"'","proto.dimension="+b),P.push("Object.defineProperty(proto,'size',{get:function "+Z+"_size(){return "+v.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===b?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),b<4?(P.push("function "+Z+"_order(){"),2===b?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+Z+"_set("+C.join(",")+",v){"),S?P.push("return this.data.set("+g+",v)}"):P.push("return this.data["+g+"]=v}"),P.push("proto.get=function "+Z+"_get("+C.join(",")+"){"),S?P.push("return this.data.get("+g+")}"):P.push("return this.data["+g+"]}"),P.push("proto.index=function "+Z+"_index(",C.join(),"){return "+g+"}"),P.push("proto.hi=function "+Z+"_hi("+C.join(",")+"){return new "+Z+"(this.data,"+v.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+v.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var M=v.map((function(t){return"a"+t+"=this.shape["+t+"]"})),T=v.map((function(t){return"c"+t+"=this.stride["+t+"]"}));P.push("proto.lo=function "+Z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+M.join(",")+","+T.join(","));for(var a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'&&i"+a+">=0){d=i"+a+"|0;b+=c"+a+"*d;a"+a+"-=d}");P.push("return new "+Z+"(this.data,"+v.map((function(t){return"a"+t})).join(",")+","+v.map((function(t){return"c"+t})).join(",")+",b)}"),P.push("proto.step=function "+Z+"_step("+C.join(",")+"){var "+v.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+v.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'){d=i"+a+"|0;if(d<0){c+=b"+a+"*(a"+a+"-1);a"+a+"=ceil(-a"+a+"/d)}else{a"+a+"=ceil(a"+a+"/d)}b"+a+"*=d}");P.push("return new "+Z+"(this.data,"+v.map((function(t){return"a"+t})).join(",")+","+v.map((function(t){return"b"+t})).join(",")+",c)}");var k=new Array(b),u=new Array(b);for(a=0;a<b;++a)k[a]="a[i"+a+"]",u[a]="b[i"+a+"]";P.push("proto.transpose=function "+Z+"_transpose("+C+"){"+C.map((function(t,b){return t+"=("+t+"===undefined?"+b+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Z+"(this.data,"+k.join(",")+","+u.join(",")+",this.offset)}"),P.push("proto.pick=function "+Z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'&&i"+a+">=0){c=(c+this.stride["+a+"]*i"+a+")|0}else{a.push(this.shape["+a+"]);b.push(this.stride["+a+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+Z+"(data,shape,stride,offset){return new "+Z+"(data,"+v.map((function(t){return"shape["+t+"]"})).join(",")+","+v.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(Y[t],h)}var Y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,b,Z,J){if(void 0===t)return(0,Y.array[0])([]);"number"===typeof t&&(t=[t]),void 0===b&&(b=[t.length]);var v=b.length;if(void 0===Z){Z=new Array(v);for(var h=v-1,g=1;h>=0;--h)Z[h]=g,g*=b[h]}if(void 0===J){J=0;for(h=0;h<v;++h)Z[h]<0&&(J-=(b[h]-1)*Z[h])}for(var I=function(t){if(S(t))return"buffer";if(P)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),r=Y[I];r.length<=v+1;)r.push(C(I,r.length-1));return(0,r[v+1])(t,b,Z,J)}},14646:t=>{function b(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(b(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&b(t.slice(0,0))}(t)||!!t._isBuffer)}},14791:t=>{"use strict";var b=[],Z=[],J=[],S=[],P=[],v=[],h=[],C=[],Y=[],g=[],I=[],r=[];t.exports=function(t,M,T,a,k,u){for(var l=h,U=Y,E=g,c=r,H=0;H<3;H++)l[H]=+T[H],E[H]=+M.max[H],U[H]=+M.base[H];u||(u=1e-10);var o=function(t,h,Y,g,r,M){var T=b,a=Z,k=J,u=S,l=P,U=v,E=C,c=Math.floor,H=0,o=0,O=0,p=0,e=0;if(W(),0===O)return 0;for(p=n();o<=O;){if(j(p)&&V())return H;p=n()}for(H+=O,e=0;e<3;e++)g[e]+=Y[e],r[e]+=Y[e];return H;function W(){if(o=0,0!==(O=Math.sqrt(Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2])))for(var t=0;t<3;t++){var b=Y[t]>=0;u[t]=b?1:-1;var Z=b?r[t]:g[t];T[t]=b?g[t]:r[t],a[t]=y(Z,u[t]),k[t]=d(T[t],u[t]),E[t]=Y[t]/O,l[t]=Math.abs(1/E[t]);var J=b?a[t]+1-Z:Z-a[t];U[t]=l[t]<1/0?l[t]*J:1/0}}function j(b){for(var Z=u[0],J=0===b?a[0]:k[0],S=a[0]+Z,P=u[1],v=1===b?a[1]:k[1],h=a[1]+P,C=u[2],Y=2===b?a[2]:k[2],g=a[2]+C,I=J;I!=S;I+=Z)for(var r=v;r!=h;r+=P)for(var M=Y;M!=g;M+=C)if(t(I,r,M))return!0;return!1}function V(){H+=o;var t=u[p],b=o/O,Z=I;for(e=0;e<3;e++){var J=Y[e]*b;g[e]+=J,r[e]+=J,Z[e]=Y[e]-J}if(t>0?r[p]=Math.round(r[p]):g[p]=Math.round(g[p]),h(H,p,t,Z))return!0;for(e=0;e<3;e++)Y[e]=Z[e];return W(),0===O}function n(){var t=U[0]<U[1]?U[0]<U[2]?0:2:U[1]<U[2]?1:2,b=U[t]-o;for(o=U[t],a[t]+=u[t],U[t]+=l[t],e=0;e<3;e++)T[e]+=b*E[e],k[e]=d(T[e],u[e]);return t}function y(t,b){return c(t-b*M)}function d(t,b){return c(t+b*M)}}(t,a,l,U,E,u);if(!k){for(H=0;H<3;H++)c[H]=T[H]>0?E[H]-M.max[H]:U[H]-M.base[H];M.translate(c)}return o}},14978:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>I});var J=Z(14786),S=Z(13530);class P{constructor(t,b,Z,P,v,h,C){this.rg=new J(t.base,t.Qg),this.KS=b,this.friction=Z,this.restitution=P,this.oh=v,this.ST=h,this.Oh=!!C,this.qg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xT=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.NY=S.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=S.create(),this._impulses=S.create(),this._sleepFrameCount=10}loadFromCopy(t){S.i(this.rg.base,t.rg.base),S.i(this.rg.Qg,t.rg.Qg),S.i(this.rg.max,t.rg.max),this.rg.mag=t.rg.mag,this.KS=t.KS,this.friction=t.friction,this.restitution=t.restitution,this.oh=t.oh,this.ST=t.ST,this.Oh=t.Oh,this.qg=t.qg,this.fluidDrag=t.fluidDrag,this.xT=t.xT,this.preventFallOffEdge=t.preventFallOffEdge,this.rolledBackLastTick=t.rolledBackLastTick,S.i(this.NY,t.NY),S.i(this.resting,t.resting),this.inFluid=t.inFluid,this._ratioInFluid=t._ratioInFluid,S.i(this._forces,t._forces),S.i(this._impulses,t._impulses),this._sleepFrameCount=t._sleepFrameCount}setPosition(t){v(t),S.SZ(t,t,this.rg.base),this.rg.translate(t),this.LY()}Ib(){return S.clone(this.rg.base)}applyForce(t){v(t),S.add(this._forces,this._forces,t),this.LY()}applyImpulse(t){v(t),S.add(this._impulses,this._impulses,t),this.LY()}LY(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var v=t=>{};var h=Z(14786),C=Z(13530),Y=Z(14791);function g(){this.qg=.1,this.fluidDrag=.4,this.Vh=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function I(t,b,Z){t=Object.assign(new g,t),this.gravity=t.gravity||[0,-10,0],this.qg=t.qg||.1,this.Vh=t.Vh||2,this.fluidDrag=t.fluidDrag||.4,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.eM=t.eM,this.testSolid=b,this.testFluid=Z}I.prototype.IT=function(t,b,Z,J,S,v){t=t||new h([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof Z&&(Z=1),"undefined"==typeof J&&(J=0),"undefined"==typeof S&&(S=1);var C=new P(t,b,Z,J,S,v);return this.bodies.push(C),C},I.prototype.rT=function(t){var b=this.bodies.indexOf(t);b<0||(this.bodies.splice(b,1),t.rg=t.ST=null)};var r=C.create(),M=C.create(),T=C.create(),a=C.create(),k=C.create(),u=C.create(),l=C.create(),U=new h([0,0,0],[1,1,1]),E=new P(U,1,1,0,1,(()=>{}),!1);function c(t,b,Z){return b=Z,b*=1-(1-t.ratioInFluid)**2}I.prototype.PC=function(t){t/=1e3;var b=A(0,C.squaredLength(this.gravity));this.bodies.forEach((Z=>function(t,b,Z,J){C.i(k,b.resting),t.eM&&E.loadFromCopy(b);if(b.KS<=0)return C.set(b.NY,0,0,0),C.set(b._forces,0,0,0),void C.set(b._impulses,0,0,0);var S=J||0===b.oh;if(function(t,b,Z,J){if(b._sleepFrameCount>0)return!1;if(J)return!0;var S=!1,P=.5*Z*Z*b.oh;return C.scale(N,t.gravity,P),Y(t.testSolid,b.rg,N,(function(){return S=!0,!0}),!0),S}(t,b,Z,S))return;b._sleepFrameCount--,function(t,b){var Z=b.rg,J=Math.floor(Z.base[0]),S=Math.floor(Z.base[2]),P=Math.floor(Z.base[1]),v=Math.floor(Z.max[1]);if(!t.testFluid(J,P,S))return b.inFluid=!1,void(b.ratioInFluid=0);var h=1,Y=P+1;for(;Y<=v&&t.testFluid(J,Y,S);)h++,Y++;var g=(P+h-Z.base[1])/Z.Qg[1];g>1&&(g=1);var I=Z.Qg[0]*Z.Qg[1]*Z.Qg[2]*g,r=o;C.scale(r,t.gravity,-t.Vh*I*b.oh),b.applyForce(r),b.inFluid=!0,b.ratioInFluid=g}(t,b),L(b._forces),L(b._impulses),L(b.NY),L(b.resting),C.scale(r,b._forces,1/b.KS),C.Rh(r,r,t.gravity,b.oh),C.scale(M,b._impulses,1/b.KS),C.Rh(M,M,r,Z),C.add(b.NY,b.NY,M),b.friction&&(O(t,0,b,M,Z),O(t,1,b,M,Z),O(t,2,b,M,Z));var P=b.fluidDrag>=0?b.fluidDrag:t.fluidDrag,v=b.qg>=0?b.qg:t.qg,h=v,g=v;b.inFluid&&(h=c(b,h,b.fluidDragHoriz>=0?b.fluidDragHoriz:P),g=c(b,g,b.fluidDragVert>=0?b.fluidDragVert:P));h=Math.max(1-h*Z/b.KS,0),g=Math.max(1-g*Z/b.KS,0),C.set(H,h,g,h),C.multiply(b.NY,b.NY,H),C.scale(T,b.NY,Z),C.set(b._forces,0,0,0),C.set(b._impulses,0,0,0),b.Oh&&K(W,b.rg);C.i(u,T),C.set(l,0,0,0),b.preventFallOffEdge&&function(t,b,Z,J){if(!b.resting[1]||Z[1]>0)return;var S=s;K(S,b.rg);for(var P=0;P<3;P+=2){C.set(d,0,0,0),d[P]=Z[P];var v=!0;(v=(v=(v=(v=v&&!Q(t,S.base[0]+d[0]+1e-5,S.base[1],S.base[2]+d[2]+1e-5))&&!Q(t,S.max[0]+d[0]-1e-5,S.base[1],S.base[2]+d[2]+1e-5))&&!Q(t,S.base[0]+d[0]+1e-5,S.base[1],S.max[2]+d[2]-1e-5))&&!Q(t,S.max[0]+d[0]-1e-5,S.base[1],S.max[2]+d[2]-1e-5))?(J[P]=Z[P]>0?1:-1,Z[P]=0):0===P&&(C.set(q,Z[0],0,0),e(t,S,q,J,b.slideOnCollision))}}(t,b,T,l);e(t,b.rg,T,b.resting,b.slideOnCollision),b.Oh&&function(t,b,Z,J){if(b.resting[1]>=0&&!b.inFluid)return;var S=0!==b.resting[0],P=0!==b.resting[2];if(!S&&!P)return;var v=Math.abs(J[0]/J[2]),h=4;if(!S&&v>h)return;if(!P&&v<1/h)return;C.add(V,Z.base,J);var g=t.testSolid;Y(g,Z,J,(function(t,b,Z,J){if(1!==b)return!0;J[b]=0}));var I=Z.base[1],r=b.inFluid?1.951:1.001,M=Math.floor(I+r)-I;C.set(n,0,M,0);var T=!1;if(Y(g,Z,n,(function(t,b,Z,J){return T=!0,!0})),T)return;C.SZ(y,V,Z.base),y[1]=0,e(t,Z,y,j,!0);var a=A(Z.base[0],V[0]),k=A(Z.base[2],V[2]);if(S&&!a&&(!k||!P))return;if(P&&(!a||!S)&&!k)return;var u=!0;if(u=u&&!Q(t,Z.base[0]+1e-5,Z.base[1],Z.base[2]+1e-5),u=u&&!Q(t,Z.max[0]-1e-5,Z.base[1],Z.base[2]+1e-5),u=u&&!Q(t,Z.base[0]+1e-5,Z.base[1],Z.max[2]-1e-5),u=u&&!Q(t,Z.max[0]-1e-5,Z.base[1],Z.max[2]-1e-5),u)return;K(b.rg,Z),b.resting[0]=j[0],b.resting[2]=j[2],b.xT&&b.xT()}(t,b,W,u);for(var I=0;I<3;++I)b.resting[I]=b.resting[I]||l[I],a[I]=0,b.resting[I]&&(k[I]||(a[I]=-b.NY[I]),b.NY[I]=0);var U=C.length(a);U>.001&&(C.scale(a,a,b.KS),b.ST&&b.ST(a),b.restitution>0&&U>t.minBounceImpulse&&(C.scale(a,a,b.restitution),b.applyImpulse(a)));var p=C.squaredLength(b.NY);p>1e-5&&b.LY();t.eM&&t.eM(b)?(b.loadFromCopy(E),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,Z,t,b)))};var H=C.create([0,0,0]);var o=C.create();function O(t,b,Z,J,S){var P=Z.resting[b],v=J[b];if(!Z.alwaysApplyHorizFriction||1!==b){if(0===P)return;if(P*v<=0)return}C.i(p,Z.NY),p[b]=0;var h=C.length(p);if(!A(h,0)){var Y=Math.abs(Z.friction*t.gravity[b]*S),g=h>Y?(h-Y)/h:0;Z.NY[(b+1)%3]*=g,Z.NY[(b+2)%3]*=g}}var p=C.create();function e(t,b,Z,J,S){return C.set(J,0,0,0),Y(t.testSolid,b,Z,(function(t,b,Z,P){J[b]=Z,P[b]=0,S||(P[0]=0,P[1]=0,P[2]=0)}))}var W=new h([],[]),j=C.create(),V=C.create(),n=C.create(),y=C.create();var d=C.create(),s=new h([],[]),q=C.create();function Q(t,b,Z,J){return t.testSolid(Math.floor(b),Math.floor(Z-1),Math.floor(J))}var N=C.create();function A(t,b){return Math.abs(t-b)<1e-5}function K(t,b){for(var Z=0;Z<3;Z++)t.base[Z]=b.base[Z],t.max[Z]=b.max[Z],t.Qg[Z]=b.Qg[Z]}var L=function(t){}},13413:function(t,b){!function(t){"use strict";var b=function(t,Z){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,b){t.__proto__=b}||function(t,b){for(var Z in b)Object.prototype.hasOwnProperty.call(b,Z)&&(t[Z]=b[Z])},b(t,Z)};function Z(t,Z){if("function"!==typeof Z&&null!==Z)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function J(){this.constructor=t}b(t,Z),t.prototype=null===Z?Object.create(Z):(J.prototype=Z.prototype,new J)}function J(t,b,Z,J){var S,P=arguments.length,v=P<3?b:null===J?J=Object.getOwnPropertyDescriptor(b,Z):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)v=Reflect.decorate(t,b,Z,J);else for(var h=t.length-1;h>=0;h--)(S=t[h])&&(v=(P<3?S(v):P>3?S(b,Z,v):S(b,Z))||v);return P>3&&v&&Object.defineProperty(b,Z,v),v}function S(t,b,Z){if(Z||2===arguments.length)for(var J,S=0,P=b.length;S<P;S++)!J&&S in b||(J||(J=Array.prototype.slice.call(b,0,S)),J[S]=b[S]);return t.concat(J||Array.prototype.slice.call(b))}var P,v=255,h=213;t.OPERATION=void 0,(P=t.OPERATION||(t.OPERATION={}))[P.ADD=128]="ADD",P[P.REPLACE=0]="REPLACE",P[P.DELETE=64]="DELETE",P[P.DELETE_AND_ADD=192]="DELETE_AND_ADD",P[P.TOUCH=1]="TOUCH",P[P.CLEAR=10]="CLEAR";var C=function(){function b(t,b,Z){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=t,this.setParent(b,Z)}return b.prototype.setParent=function(t,b,Z){var J=this;if(this.indexes||(this.indexes=this.ref instanceof yt?this.ref._definition.indexes:{}),this.parent=t,this.parentIndex=Z,b)if(this.root=b,this.ref instanceof yt){var S=this.ref._definition;for(var P in S.schema){var v=this.ref[P];if(v&&v.$changes){var h=S.indexes[P];v.$changes.setParent(this.ref,b,h)}}}else"object"===typeof this.ref&&this.ref.forEach((function(t,b){if(t instanceof yt){var Z=t.$changes,S=J.ref.$changes.indexes[b];Z.setParent(J.ref,J.root,S)}}))},b.prototype.operation=function(t){this.changes.set(--this.currentCustomOperation,t)},b.prototype.change=function(b,Z){void 0===Z&&(Z=t.OPERATION.ADD);var J="number"===typeof b?b:this.indexes[b];this.assertValidIndex(J,b);var S=this.changes.get(J);S&&S.op!==t.OPERATION.DELETE&&S.op!==t.OPERATION.TOUCH||this.changes.set(J,{op:S&&S.op===t.OPERATION.DELETE?t.OPERATION.DELETE_AND_ADD:Z,index:J}),this.allChanges.add(J),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var Z="number"===typeof b?b:this.indexes[b];this.assertValidIndex(Z,b),this.changes.has(Z)||this.changes.set(Z,{op:t.OPERATION.TOUCH,index:Z}),this.allChanges.add(Z),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(t){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[t]];var b,Z=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(Z)[0]},b.prototype.getChildrenFilter=function(){var t=this.parent._definition.childFilters;return t&&t[this.parentIndex]},b.prototype.getValue=function(t){return this.ref.getByIndex(t)},b.prototype.delete=function(b){var Z="number"===typeof b?b:this.indexes[b];if(void 0!==Z){var J=this.getValue(Z);this.changes.set(Z,{op:t.OPERATION.DELETE,index:Z}),this.allChanges.delete(Z),delete this.caches[Z],J&&J.$changes&&(J.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(Z,")"))},b.prototype.discard=function(b,Z){var J=this;void 0===b&&(b=!1),void 0===Z&&(Z=!1),this.ref instanceof yt||this.changes.forEach((function(b){if(b.op===t.OPERATION.DELETE){var Z=J.ref.getIndex(b.index);delete J.indexes[Z]}})),this.changes.clear(),this.changed=b,Z&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var t=this;this.changes.forEach((function(b){var Z=t.getValue(b.index);Z&&Z.$changes&&Z.$changes.discardAll()})),this.discard()},b.prototype.cache=function(t,b){this.caches[t]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(t,b){if(void 0===t)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function Y(t,b,Z,J){return t[b]||(t[b]=[]),t[b].push(Z),null===J||void 0===J||J.forEach((function(t,b){return Z(t,b)})),function(){return I(t[b],t[b].indexOf(Z))}}function g(b){var Z=this,J="string"!==typeof this.$changes.getType();this.$items.forEach((function(S,P){b.push({refId:Z.$changes.refId,op:t.OPERATION.DELETE,field:P,value:void 0,previousValue:S}),J&&Z.$changes.root.removeRef(S.$changes.refId)}))}function I(t,b){if(-1===b||b>=t.length)return!1;for(var Z=t.length-1,J=b;J<Z;J++)t[J]=t[J+1];return t.length=Z,!0}var r=function(t,b){var Z=t.toString(),J=b.toString();return Z<J?-1:Z>J?1:0};function M(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,b){return"symbol"===typeof b||isNaN(b)?t[b]:t.at(b)},set:function(t,b,Z){if("symbol"===typeof b||isNaN(b))t[b]=Z;else{var J=Array.from(t.$items.keys()),S=parseInt(J[b]||b);void 0===Z||null===Z?t.deleteAt(S):t.setAt(S,Z)}return!0},deleteProperty:function(t,b){return"number"===typeof b?t.deleteAt(b):delete t[b],!0}})}var T=function(){function b(){for(var t=[],b=0;b<arguments.length;b++)t[b]=arguments[b];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,t)}return b.prototype.hC=function(b,Z){return void 0===Z&&(Z=!0),Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Z?this.$items:void 0)},b.prototype.Yb=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return Array.isArray(t)||void 0!==t.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(t){0===t?this.clear():this.splice(t,this.length-t)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var t,b=this,Z=[],J=0;J<arguments.length;J++)Z[J]=arguments[J];return Z.forEach((function(Z){t=b.$refId++,b.setAt(t,Z)})),t},b.prototype.pop=function(){var t=Array.from(this.$indexes.values()).pop();if(void 0!==t){this.$changes.delete(t),this.$indexes.delete(t);var b=this.$items.get(t);return this.$items.delete(t),b}},b.prototype.at=function(t){var b=Array.from(this.$items.keys())[t];return this.$items.get(b)},b.prototype.setAt=function(b,Z){var J,S;if(void 0!==Z&&null!==Z){if(this.$items.get(b)!==Z){void 0!==Z.$changes&&Z.$changes.setParent(this,this.$changes.root,b);var P=null!==(S=null===(J=this.$changes.indexes[b])||void 0===J?void 0:J.op)&&void 0!==S?S:t.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,Z),this.$changes.change(b,P)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(t){var b=Array.from(this.$items.keys())[t];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(t){return this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&g.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var t,Z=[],J=0;J<arguments.length;J++)Z[J]=arguments[J];return new(b.bind.apply(b,S([void 0],(t=Array.from(this.$items.values())).concat.apply(t,Z),!1)))},b.prototype.join=function(t){return Array.from(this.$items.values()).join(t)},b.prototype.reverse=function(){var t=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Z,J){t.setAt(b[J],Z)})),this},b.prototype.shift=function(){var t=Array.from(this.$items.keys()).shift();if(void 0!==t){var b=this.$items.get(t);return this.$deleteAt(t),b}},b.prototype.slice=function(t,Z){var J=new b;return J.push.apply(J,Array.from(this.$items.values()).slice(t,Z)),J},b.prototype.sort=function(t){var b=this;void 0===t&&(t=r);var Z=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(t).forEach((function(t,J){b.setAt(Z[J],t)})),this},b.prototype.splice=function(t,b){void 0===b&&(b=this.length-t);for(var Z=Array.from(this.$items.keys()),J=[],S=t;S<t+b;S++)J.push(this.$items.get(Z[S])),this.$deleteAt(Z[S]);return J},b.prototype.unshift=function(){for(var t=this,b=[],Z=0;Z<arguments.length;Z++)b[Z]=arguments[Z];var J=this.length,S=b.length,P=Array.from(this.$items.values());return b.forEach((function(b,Z){t.setAt(Z,b)})),P.forEach((function(b,Z){t.setAt(S+Z,b)})),J+S},b.prototype.indexOf=function(t,b){return Array.from(this.$items.values()).indexOf(t,b)},b.prototype.lastIndexOf=function(t,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(t,b)},b.prototype.every=function(t,b){return Array.from(this.$items.values()).every(t,b)},b.prototype.some=function(t,b){return Array.from(this.$items.values()).some(t,b)},b.prototype.forEach=function(t,b){Array.from(this.$items.values()).forEach(t,b)},b.prototype.map=function(t,b){return Array.from(this.$items.values()).map(t,b)},b.prototype.filter=function(t,b){return Array.from(this.$items.values()).filter(t,b)},b.prototype.reduce=function(t,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(t,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(t,b){return Array.from(this.$items.values()).find(t,b)},b.prototype.findIndex=function(t,b){return Array.from(this.$items.values()).findIndex(t,b)},b.prototype.fill=function(t,b,Z){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(t,b,Z){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(t,b){return Array.from(this.$items.values()).includes(t,b)},b.prototype.flatMap=function(t,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(t){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var t=Array.from(this.$items.values());return t.findLast.apply(t,arguments)},b.prototype.findLastIndex=function(){var t=Array.from(this.$items.values());return t.findLastIndex.apply(t,arguments)},b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(t){return"function"===typeof t.toJSON?t.toJSON():t}))},b.prototype.clone=function(t){return t?new(b.bind.apply(b,S([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,S([void 0],this.map((function(t){return t.$changes?t.clone():t})),!1)))},b}();function a(t){return t.$proxy=!0,t=new Proxy(t,{get:function(t,b){return"symbol"!==typeof b&&"undefined"===typeof t[b]?t.get(b):t[b]},set:function(t,b,Z){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"hC"!==b&&"Yb"!==b&&"onChange"!==b?t.set(b,Z):t[b]=Z,!0},deleteProperty:function(t,b){return t.delete(b),!0}})}var k=function(){function b(t){var Z=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t)if(t instanceof Map||t instanceof b)t.forEach((function(t,b){return Z.set(b,t)}));else for(var J in t)this.set(J,t[J])}return b.prototype.hC=function(b,Z){return void 0===Z&&(Z=!0),Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Z?this.$items:void 0)},b.prototype.Yb=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,Z){if(void 0===Z||null===Z)throw new Error("MapSchema#set('".concat(b,"', ").concat(Z,"): trying to set ").concat(Z," value on '").concat(b,"'."));b=b.toString();var J="undefined"!==typeof this.$changes.indexes[b],S=J?this.$changes.indexes[b]:this.$refId++,P=J?t.OPERATION.REPLACE:t.OPERATION.ADD,v=void 0!==Z.$changes;if(v&&Z.$changes.setParent(this,this.$changes.root,S),J){if(!v&&this.$items.get(b)===Z)return;v&&this.$items.get(b)!==Z&&(P=t.OPERATION.ADD)}else this.$changes.indexes[b]=S,this.$indexes.set(S,b);return this.$items.set(b,Z),this.$changes.change(b,P),this},b.prototype.get=function(t){return this.$items.get(t)},b.prototype.delete=function(t){return this.$changes.delete(t),this.$items.delete(t)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&g.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){return this.$items.has(t)},b.prototype.forEach=function(t){this.$items.forEach(t)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toJSON=function(){var t={};return this.forEach((function(b,Z){t[Z]="function"===typeof b.toJSON?b.toJSON():b})),t},b.prototype.clone=function(t){var Z;return t?Z=Object.assign(new b,this):(Z=new b,this.forEach((function(t,b){t.$changes?Z.set(b,t.clone()):Z.set(b,t)}))),Z},b}(),u={};function l(t,b){u[t]=b}function U(t){return u[t]}var E=function(){function t(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return t.create=function(b){var Z=new t;return Z.schema=Object.assign({},b&&b.schema||{}),Z.indexes=Object.assign({},b&&b.indexes||{}),Z.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),Z.descriptors=Object.assign({},b&&b.descriptors||{}),Z.deprecated=Object.assign({},b&&b.deprecated||{}),Z},t.prototype.addField=function(t,b){var Z=this.getNextFieldIndex();this.fieldsByIndex[Z]=t,this.indexes[t]=Z,this.schema[t]=Array.isArray(b)?{array:b[0]}:b},t.prototype.hasField=function(t){return void 0!==this.indexes[t]},t.prototype.addFilter=function(t,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[t]]=b,this.indexesWithFilters.push(this.indexes[t]),!0},t.prototype.addChildrenFilter=function(t,b){var Z=this.indexes[t],J=this.schema[t];if(U(Object.keys(J)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Z]=b,!0;console.warn("@filterChildren: field '".concat(t,"' can't have children. Ignoring filter."))},t.prototype.getChildrenFilter=function(t){return this.childFilters&&this.childFilters[this.indexes[t]]},t.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},t}();function c(t){return t._context&&t._context.useFilters}var H=function(){function t(){this.types={},this.schemas=new Map,this.useFilters=!1}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t,b){void 0===b&&(b=this.schemas.size),t._definition=E.create(t._definition),t._typeid=b,this.types[b]=t,this.schemas.set(t,b)},t.create=function(b){return void 0===b&&(b={}),function(Z){return b.context||(b.context=new t),O(Z,b)}},t}(),o=new H;function O(t,b){return void 0===b&&(b={}),function(Z,J){var P=b.context||o,v=Z.constructor;if(v._context=P,!t)throw new Error("".concat(v.name,': @type() reference provided for "').concat(J,"\" is undefined. Make sure you don't have any circular dependencies."));P.has(v)||P.add(v);var h=v._definition;if(h.addField(J,t),h.descriptors[J]){if(h.deprecated[J])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(J,"' definition on '").concat(v.name,"'.\nCheck @type() annotation"))}catch(u){var C=u.stack.split("\n")[4].trim();throw new Error("".concat(u.message," ").concat(C))}}var Y=T.is(t),g=!Y&&k.is(t);if("string"!==typeof t&&!yt.is(t)){var I=Object.values(t)[0];"string"===typeof I||P.has(I)||P.add(I)}if(b.manual)h.descriptors[J]={enumerable:!0,configurable:!0,writable:!0};else{var r="_".concat(J);h.descriptors[r]={enumerable:!1,configurable:!1,writable:!0},h.descriptors[J]={get:function(){return this[r]},set:function(t){t!==this[r]&&(void 0!==t&&null!==t?(!Y||t instanceof T||(t=new(T.bind.apply(T,S([void 0],t,!1)))),!g||t instanceof k||(t=new k(t)),void 0===t.$proxy&&(g?t=a(t):Y&&(t=M(t))),this.$changes.change(J),t.$changes&&t.$changes.setParent(this,this.$changes.root,this._definition.indexes[J])):this[r]&&this.$changes.delete(J),this[r]=t)},enumerable:!0,configurable:!0}}}}function p(t){return function(b,Z){var J=b.constructor;J._definition.addFilter(Z,t)&&(J._context.useFilters=!0)}}function e(t){return function(b,Z){var J=b.constructor;J._definition.addChildrenFilter(Z,t)&&(J._context.useFilters=!0)}}function W(t){return void 0===t&&(t=!0),function(b,Z){var J=b.constructor._definition;J.deprecated[Z]=!0,t&&(J.descriptors[Z]={get:function(){throw new Error("".concat(Z," is deprecated."))},set:function(t){},enumerable:!1,configurable:!0})}}function j(t,b,Z){for(var J in void 0===Z&&(Z={}),Z.context||(Z.context=t._context||Z.context||o),b)O(b[J],Z)(t.prototype,J);return t}function V(t){for(var b=0,Z=0,J=0,S=t.length;J<S;J++)(b=t.charCodeAt(J))<128?Z+=1:b<2048?Z+=2:b<55296||b>=57344?Z+=3:(J++,Z+=4);return Z}function n(t,b,Z){for(var J=0,S=0,P=Z.length;S<P;S++)(J=Z.charCodeAt(S))<128?t[b++]=J:J<2048?(t[b++]=192|J>>6,t[b++]=128|63&J):J<55296||J>=57344?(t[b++]=224|J>>12,t[b++]=128|J>>6&63,t[b++]=128|63&J):(S++,J=65536+((1023&J)<<10|1023&Z.charCodeAt(S)),t[b++]=240|J>>18,t[b++]=128|J>>12&63,t[b++]=128|J>>6&63,t[b++]=128|63&J)}function y(t,b){t.push(255&b)}function d(t,b){t.push(255&b)}function s(t,b){t.push(255&b),t.push(b>>8&255)}function q(t,b){t.push(255&b),t.push(b>>8&255)}function Q(t,b){t.push(255&b),t.push(b>>8&255),t.push(b>>16&255),t.push(b>>24&255)}function N(t,b){var Z=b>>24,J=b>>16,S=b>>8,P=b;t.push(255&P),t.push(255&S),t.push(255&J),t.push(255&Z)}function A(t,b){var Z=Math.floor(b/Math.pow(2,32));N(t,b>>>0),N(t,Z)}function K(t,b){var Z=b/Math.pow(2,32)|0;N(t,b>>>0),N(t,Z)}function L(t,b){i(t,b)}function F(t,b){z(t,b)}var B=new Int32Array(2),X=new Float32Array(B.buffer),x=new Float64Array(B.buffer);function i(t,b){X[0]=b,Q(t,B[0])}function z(t,b){x[0]=b,Q(t,B[0]),Q(t,B[1])}function D(t,b){return d(t,b?1:0)}function f(t,b){b||(b="");var Z=V(b),J=0;if(Z<32)t.push(160|Z),J=1;else if(Z<256)t.push(217),d(t,Z),J=2;else if(Z<65536)t.push(218),q(t,Z),J=3;else{if(!(Z<4294967296))throw new Error("String too long");t.push(219),N(t,Z),J=5}return n(t,t.length,b),J+Z}function mt(t,b){return isNaN(b)?mt(t,0):isFinite(b)?b!==(0|b)?(t.push(203),z(t,b),9):b>=0?b<128?(d(t,b),1):b<256?(t.push(204),d(t,b),2):b<65536?(t.push(205),q(t,b),3):b<4294967296?(t.push(206),N(t,b),5):(t.push(207),K(t,b),9):b>=-32?(t.push(224|b+32),1):b>=-128?(t.push(208),y(t,b),2):b>=-32768?(t.push(209),s(t,b),3):b>=-2147483648?(t.push(210),Q(t,b),5):(t.push(211),A(t,b),9):mt(t,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var R=Object.freeze({__proto__:null,utf8Write:n,int8:y,uint8:d,int16:s,uint16:q,int32:Q,uint32:N,int64:A,uint64:K,float32:L,float64:F,writeFloat32:i,writeFloat64:z,boolean:D,string:f,number:mt});function w(t,b,Z){for(var J="",S=0,P=b,v=b+Z;P<v;P++){var h=t[P];0!==(128&h)?192!==(224&h)?224!==(240&h)?240!==(248&h)?console.error("Invalid byte "+h.toString(16)):(S=(7&h)<<18|(63&t[++P])<<12|(63&t[++P])<<6|63&t[++P])>=65536?(S-=65536,J+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):J+=String.fromCharCode(S):J+=String.fromCharCode((15&h)<<12|(63&t[++P])<<6|63&t[++P]):J+=String.fromCharCode((31&h)<<6|63&t[++P]):J+=String.fromCharCode(h)}return J}function G(t,b){return tt(t,b)<<24>>24}function tt(t,b){return t[b.offset++]}function bt(t,b){return Zt(t,b)<<16>>16}function Zt(t,b){return t[b.offset++]|t[b.offset++]<<8}function Jt(t,b){return t[b.offset++]|t[b.offset++]<<8|t[b.offset++]<<16|t[b.offset++]<<24}function St(t,b){return Jt(t,b)>>>0}function Pt(t,b){return rt(t,b)}function vt(t,b){return Mt(t,b)}function ht(t,b){var Z=St(t,b);return Jt(t,b)*Math.pow(2,32)+Z}function Ct(t,b){var Z=St(t,b);return St(t,b)*Math.pow(2,32)+Z}var Yt=new Int32Array(2),gt=new Float32Array(Yt.buffer),It=new Float64Array(Yt.buffer);function rt(t,b){return Yt[0]=Jt(t,b),gt[0]}function Mt(t,b){return Yt[0]=Jt(t,b),Yt[1]=Jt(t,b),It[0]}function Tt(t,b){return tt(t,b)>0}function at(t,b){var Z,J=t[b.offset++];J<192?Z=31&J:217===J?Z=tt(t,b):218===J?Z=Zt(t,b):219===J&&(Z=St(t,b));var S=w(t,b.offset,Z);return b.offset+=Z,S}function kt(t,b){var Z=t[b.offset];return Z<192&&Z>160||217===Z||218===Z||219===Z}function ut(t,b){var Z=t[b.offset++];return Z<128?Z:202===Z?rt(t,b):203===Z?Mt(t,b):204===Z?tt(t,b):205===Z?Zt(t,b):206===Z?St(t,b):207===Z?Ct(t,b):208===Z?G(t,b):209===Z?bt(t,b):210===Z?Jt(t,b):211===Z?ht(t,b):Z>223?-1*(255-Z+1):void 0}function lt(t,b){var Z=t[b.offset];return Z<128||Z>=202&&Z<=211}function Ut(t,b){return t[b.offset]<160}function Et(t,b){return t[b.offset-1]===v&&(t[b.offset]<128||t[b.offset]>=202&&t[b.offset]<=211)}var ct=Object.freeze({__proto__:null,int8:G,uint8:tt,int16:bt,uint16:Zt,int32:Jt,uint32:St,float32:Pt,float64:vt,int64:ht,uint64:Ct,readFloat32:rt,readFloat64:Mt,boolean:Tt,string:at,stringCheck:kt,number:ut,numberCheck:lt,arrayCheck:Ut,switchStructureCheck:Et}),Ht=function(){function b(t){var b=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return b.add(t)}))}return b.prototype.hC=function(b,Z){return void 0===Z&&(Z=!0),Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Z?this.$items:void 0)},b.prototype.Yb=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.collection},b.prototype.add=function(t){var b=this.$refId++;return void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,t),this.$changes.change(b),b},b.prototype.at=function(t){var b=Array.from(this.$items.keys())[t];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(t){for(var b,Z,J=this.$items.entries();(Z=J.next())&&!Z.done;)if(t===Z.value[1]){b=Z.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&g.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){return Array.from(this.$items.values()).some((function(b){return b===t}))},b.prototype.forEach=function(t){var b=this;this.$items.forEach((function(Z,J,S){return t(Z,J,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var t=[];return this.forEach((function(b,Z){t.push("function"===typeof b.toJSON?b.toJSON():b)})),t},b.prototype.clone=function(t){var Z;return t?Z=Object.assign(new b,this):(Z=new b,this.forEach((function(t){t.$changes?Z.add(t.clone()):Z.add(t)}))),Z},b}(),ot=function(){function b(t){var b=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,t&&t.forEach((function(t){return b.add(t)}))}return b.prototype.hC=function(b,Z){return void 0===Z&&(Z=!0),Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.ADD,b,Z?this.$items:void 0)},b.prototype.Yb=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.is=function(t){return void 0!==t.set},b.prototype.add=function(b){var Z,J;if(this.has(b))return!1;var S=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,S);var P=null!==(J=null===(Z=this.$changes.indexes[S])||void 0===Z?void 0:Z.op)&&void 0!==J?J:t.OPERATION.ADD;return this.$changes.indexes[S]=S,this.$indexes.set(S,S),this.$items.set(S,b),this.$changes.change(S,P),S},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(t){for(var b,Z,J=this.$items.entries();(Z=J.next())&&!Z.done;)if(t===Z.value[1]){b=Z.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&g.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:t.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(t){for(var b,Z=this.$items.values(),J=!1;(b=Z.next())&&!b.done;)if(t===b.value){J=!0;break}return J},b.prototype.forEach=function(t){var b=this;this.$items.forEach((function(Z,J,S){return t(Z,J,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(t,b){this.$indexes.set(t,b)},b.prototype.getIndex=function(t){return this.$indexes.get(t)},b.prototype.getByIndex=function(t){return this.$items.get(this.$indexes.get(t))},b.prototype.deleteByIndex=function(t){var b=this.$indexes.get(t);this.$items.delete(b),this.$indexes.delete(t)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var t=[];return this.forEach((function(b,Z){t.push("function"===typeof b.toJSON?b.toJSON():b)})),t},b.prototype.clone=function(t){var Z;return t?Z=Object.assign(new b,this):(Z=new b,this.forEach((function(t){t.$changes?Z.add(t.clone()):Z.add(t)}))),Z},b}(),Ot=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(t){this.refIds.has(t)||(this.refIds.add(t),this.containerIndexes.set(t,new Set))},t.get=function(b){return void 0===b.$filterState&&(b.$filterState=new t),b.$filterState},t}(),pt=function(){function t(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return t.prototype.getNextUniqueId=function(){return this.nextUniqueId++},t.prototype.addRef=function(t,b,Z){void 0===Z&&(Z=!0),this.refs.set(t,b),Z&&(this.refCounts[t]=(this.refCounts[t]||0)+1)},t.prototype.removeRef=function(t){this.refCounts[t]=this.refCounts[t]-1,this.deletedRefs.add(t)},t.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},t.prototype.garbageCollectDeletedRefs=function(){var t=this;this.deletedRefs.forEach((function(b){if(!(t.refCounts[b]>0)){var Z=t.refs.get(b);if(Z instanceof yt)for(var J in Z._definition.schema)"string"!==typeof Z._definition.schema[J]&&Z[J]&&Z[J].$changes&&t.removeRef(Z[J].$changes.refId);else{var S=Z.$changes.parent._definition,P=S.schema[S.fieldsByIndex[Z.$changes.parentIndex]];"function"===typeof Object.values(P)[0]&&Array.from(Z.values()).forEach((function(b){return t.removeRef(b.$changes.refId)}))}t.refs.delete(b),delete t.refCounts[b]}})),this.deletedRefs.clear()},t}(),et=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Z(b,t),b}(Error);function Wt(t,b,Z,J){var S,P=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":S="number",isNaN(t)&&console.log('trying to encode "NaN" in '.concat(Z.constructor.name,"#").concat(J));break;case"string":S="string",P=!0;break;case"boolean":return}if(typeof t!==S&&(!P||P&&null!==t)){var v="'".concat(JSON.stringify(t),"'").concat(t&&t.constructor&&" (".concat(t.constructor.name,")")||"");throw new et("a '".concat(S,"' was expected, but ").concat(v," was provided in ").concat(Z.constructor.name,"#").concat(J))}}function jt(t,b,Z,J){if(!(t instanceof b))throw new et("a '".concat(b.name,"' was expected, but '").concat(t.constructor.name,"' was provided in ").concat(Z.constructor.name,"#").concat(J))}function Vt(t,b,Z,J,S){Wt(Z,t,J,S);var P=R[t];if(!P)throw new et("a '".concat(t,"' was expected, but ").concat(Z," was provided in ").concat(J.constructor.name,"#").concat(S));P(b,Z)}function nt(t,b,Z){return ct[t](b,Z)}var yt=function(){function b(){for(var t=[],b=0;b<arguments.length;b++)t[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new pt),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Z=this._definition.descriptors;Z&&Object.defineProperties(this,Z),t[0]&&this.assign(t[0])}return b.onError=function(t){console.error(t)},b.is=function(t){return t._definition&&void 0!==t._definition.schema},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.REPLACE,b)},b.prototype.Yb=function(b){return Y(this.$callbacks||(this.$callbacks=[]),t.OPERATION.DELETE,b)},b.prototype.assign=function(t){return Object.assign(this,t),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(t,b){this.$changes.change(t,b)},b.prototype.listen=function(t,b,Z){var J=this;return void 0===Z&&(Z=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[t]||(this.$callbacks[t]=[]),this.$callbacks[t].push(b),Z&&void 0!==this[t]&&b(this[t],void 0),function(){return I(J.$callbacks[t],J.$callbacks[t].indexOf(b))}},b.prototype.decode=function(Z,J,S){var P;void 0===J&&(J={offset:0}),void 0===S&&(S=this);var h=[],C=this.$changes.root,Y=Z.length,g=0;for(C.refs.set(g,this);J.offset<Y;){var I=Z[J.offset++];if(I!=v){var r=S.$changes,M=void 0!==S._definition,a=M?I>>6<<6:I;if(a!==t.OPERATION.CLEAR){var u=M?I%(a||255):ut(Z,J),l=M?S._definition.fieldsByIndex[u]:"",E=r.getType(u),c=void 0,H=void 0,o=void 0;if(M?H=S["_".concat(l)]:(H=S.getByIndex(u),(a&t.OPERATION.ADD)===t.OPERATION.ADD?(o=S instanceof k?at(Z,J):u,S.setIndex(u,o)):o=S.getIndex(u)),(a&t.OPERATION.DELETE)===t.OPERATION.DELETE&&(a!==t.OPERATION.DELETE_AND_ADD&&S.deleteByIndex(u),H&&H.$changes&&C.removeRef(H.$changes.refId),c=null),void 0!==l){if(a===t.OPERATION.DELETE);else if(b.is(E)){var O=ut(Z,J);if(c=C.refs.get(O),a!==t.OPERATION.REPLACE){var p=this.getSchemaType(Z,J,E);c||((c=this.createTypeInstance(p)).$changes.refId=O,H&&(c.$callbacks=H.$callbacks,H.$changes.refId&&O!==H.$changes.refId&&C.removeRef(H.$changes.refId))),C.addRef(O,c,c!==H)}}else if("string"===typeof E)c=nt(E,Z,J);else{var e=U(Object.keys(E)[0]),W=ut(Z,J),j=C.refs.has(W)?H||C.refs.get(W):new e.constructor;if((c=j.clone(!0)).$changes.refId=W,H&&(c.$callbacks=H.$callbacks,H.$changes.refId&&W!==H.$changes.refId)){C.removeRef(H.$changes.refId);for(var V=H.entries(),n=void 0;(n=V.next())&&!n.done;){var y=(P=n.value)[0],d=P[1];h.push({refId:W,op:t.OPERATION.DELETE,field:y,value:void 0,previousValue:d})}}C.addRef(W,c,j!==H)}if(null!==c&&void 0!==c)if(c.$changes&&c.$changes.setParent(r.ref,r.root,u),S instanceof b)S[l]=c;else if(S instanceof k)y=o,S.$items.set(y,c),S.$changes.allChanges.add(u);else if(S instanceof T)S.setAt(u,c);else if(S instanceof Ht){var s=S.add(c);S.setIndex(u,s)}else S instanceof ot&&!1!==(s=S.add(c))&&S.setIndex(u,s);H!==c&&h.push({refId:g,op:a,field:l,dynamicIndex:o,value:c,previousValue:H})}else{console.warn("@colyseus/schema: definition mismatch");for(var q={offset:J.offset};J.offset<Y&&(!Et(Z,J)||(q.offset=J.offset+1,!C.refs.has(ut(Z,q))));)J.offset++}}else S.clear(h)}else{g=ut(Z,J);var Q=C.refs.get(g);if(!Q)throw new Error('"refId" not found: '.concat(g));S=Q}}return this._triggerChanges(h),C.garbageCollectDeletedRefs(),h},b.prototype.encode=function(Z,J,S){void 0===Z&&(Z=!1),void 0===J&&(J=[]),void 0===S&&(S=!1);for(var P=this.$changes,h=new WeakSet,C=[P],Y=1,g=0;g<Y;g++){var I=C[g],r=I.ref,M=r instanceof b;I.ensureRefId(),h.add(I),I!==P&&(I.changed||Z)&&(d(J,v),mt(J,I.refId));for(var T=Z?Array.from(I.allChanges):Array.from(I.changes.values()),a=0,u=T.length;a<u;a++){var l=Z?{op:t.OPERATION.ADD,index:T[a]}:T[a],E=l.index,c=M?r._definition.fieldsByIndex&&r._definition.fieldsByIndex[E]:E,H=J.length;if(l.op!==t.OPERATION.TOUCH)if(M)d(J,E|l.op);else{if(d(J,l.op),l.op===t.OPERATION.CLEAR)continue;mt(J,E)}if(M||(l.op&t.OPERATION.ADD)!=t.OPERATION.ADD||r instanceof k&&f(J,I.ref.$indexes.get(E)),l.op!==t.OPERATION.DELETE){var o=I.getType(E),O=I.getValue(E);if(O&&O.$changes&&!h.has(O.$changes)&&(C.push(O.$changes),O.$changes.ensureRefId(),Y++),l.op!==t.OPERATION.TOUCH){if(b.is(o))jt(O,o,r,c),mt(J,O.$changes.refId),(l.op&t.OPERATION.ADD)===t.OPERATION.ADD&&this.tryEncodeTypeId(J,o,O.constructor);else if("string"===typeof o)Vt(o,J,O,r,c);else{var p=U(Object.keys(o)[0]);jt(r["_".concat(c)],p.constructor,r,c),mt(J,O.$changes.refId)}S&&I.cache(E,J.slice(H))}}}Z||S||I.discard()}return J},b.prototype.encodeAll=function(t){return this.encode(!0,[],t)},b.prototype.applyFilters=function(Z,J){var S,P;void 0===J&&(J=!1);for(var h=this,C=new Set,Y=Ot.get(Z),g=[this.$changes],I=1,r=[],M=function(M){var T=g[M];if(C.has(T.refId))return"continue";var a=T.ref,u=a instanceof b;d(r,v),mt(r,T.refId);var l=Y.refIds.has(T),U=J||!l;Y.addRefId(T);var E=Y.containerIndexes.get(T),c=U?Array.from(T.allChanges):Array.from(T.changes.values());!J&&u&&a._definition.indexesWithFilters&&a._definition.indexesWithFilters.forEach((function(b){!E.has(b)&&T.allChanges.has(b)&&(U?c.push(b):c.push({op:t.OPERATION.ADD,index:b}))}));for(var H=0,o=c.length;H<o;H++){var O=U?{op:t.OPERATION.ADD,index:c[H]}:c[H];if(O.op!==t.OPERATION.CLEAR){var p=O.index;if(O.op!==t.OPERATION.DELETE){var e=T.getValue(p),W=T.getType(p);if(u){if((j=a._definition.filters&&a._definition.filters[p])&&!j.call(a,Z,e,h)){e&&e.$changes&&C.add(e.$changes.refId);continue}}else{var j,V=T.parent;if((j=T.getChildrenFilter())&&!j.call(V,Z,a.$indexes.get(p),e,h)){e&&e.$changes&&C.add(e.$changes.refId);continue}}if(e.$changes&&(g.push(e.$changes),I++),O.op!==t.OPERATION.TOUCH)if(O.op===t.OPERATION.ADD||u)r.push.apply(r,null!==(S=T.caches[p])&&void 0!==S?S:[]),E.add(p);else if(E.has(p))r.push.apply(r,null!==(P=T.caches[p])&&void 0!==P?P:[]);else{if(E.add(p),d(r,t.OPERATION.ADD),mt(r,p),a instanceof k){var n=T.ref.$indexes.get(p);f(r,n)}e.$changes?mt(r,e.$changes.refId):R[W](r,e)}else e.$changes&&!u&&(d(r,t.OPERATION.ADD),mt(r,p),a instanceof k&&(n=T.ref.$indexes.get(p),f(r,n)),mt(r,e.$changes.refId))}else u?d(r,O.op|p):(d(r,O.op),mt(r,p))}else d(r,O.op)}},T=0;T<I;T++)M(T);return r},b.prototype.clone=function(){var t,b=new this.constructor,Z=this._definition.schema;for(var J in Z)"object"===typeof this[J]&&"function"===typeof(null===(t=this[J])||void 0===t?void 0:t.clone)?b[J]=this[J].clone():b[J]=this[J];return b},b.prototype.toJSON=function(){var t=this._definition.schema,b=this._definition.deprecated,Z={};for(var J in t)b[J]||null===this[J]||"undefined"===typeof this[J]||(Z[J]="function"===typeof this[J].toJSON?this[J].toJSON():this["_".concat(J)]);return Z},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(t){return this[this._definition.fieldsByIndex[t]]},b.prototype.deleteByIndex=function(t){this[this._definition.fieldsByIndex[t]]=void 0},b.prototype.tryEncodeTypeId=function(t,b,Z){b._typeid!==Z._typeid&&(d(t,h),mt(t,Z._typeid))},b.prototype.getSchemaType=function(t,b,Z){var J;return t[b.offset]===h&&(b.offset++,J=this.constructor._context.get(ut(t,b))),J||Z},b.prototype.createTypeInstance=function(t){var b=new t;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(Z){for(var J,S,P,v,h,C,Y,g,I,r=new Set,M=this.$changes.root.refs,T=function(T){var a=Z[T],k=a.refId,u=M.get(k),l=u.$callbacks;if((a.op&t.OPERATION.DELETE)===t.OPERATION.DELETE&&a.previousValue instanceof b&&(null===(S=null===(J=a.previousValue.$callbacks)||void 0===J?void 0:J[t.OPERATION.DELETE])||void 0===S||S.forEach((function(t){return t()}))),!l)return"continue";if(u instanceof b){if(!r.has(k))try{null===(P=null===l||void 0===l?void 0:l[t.OPERATION.REPLACE])||void 0===P||P.forEach((function(t){return t()}))}catch(U){b.onError(U)}try{l.hasOwnProperty(a.field)&&(null===(v=l[a.field])||void 0===v||v.forEach((function(t){return t(a.value,a.previousValue)})))}catch(U){b.onError(U)}}else a.op===t.OPERATION.ADD&&void 0===a.previousValue?null===(h=l[t.OPERATION.ADD])||void 0===h||h.forEach((function(t){var b;return t(a.value,null!==(b=a.dynamicIndex)&&void 0!==b?b:a.field)})):a.op===t.OPERATION.DELETE?void 0!==a.previousValue&&(null===(C=l[t.OPERATION.DELETE])||void 0===C||C.forEach((function(t){var b;return t(a.previousValue,null!==(b=a.dynamicIndex)&&void 0!==b?b:a.field)}))):a.op===t.OPERATION.DELETE_AND_ADD&&(void 0!==a.previousValue&&(null===(Y=l[t.OPERATION.DELETE])||void 0===Y||Y.forEach((function(t){var b;return t(a.previousValue,null!==(b=a.dynamicIndex)&&void 0!==b?b:a.field)}))),null===(g=l[t.OPERATION.ADD])||void 0===g||g.forEach((function(t){var b;return t(a.value,null!==(b=a.dynamicIndex)&&void 0!==b?b:a.field)}))),a.value!==a.previousValue&&(null===(I=l[t.OPERATION.REPLACE])||void 0===I||I.forEach((function(t){var b;return t(a.value,null!==(b=a.dynamicIndex)&&void 0!==b?b:a.field)})));r.add(k)},a=0;a<Z.length;a++)T(a)},b._definition=E.create(),b}();function dt(t){for(var b=[t.$changes],Z=1,J={},S=J,P=function(t){var Z=b[t];Z.changes.forEach((function(t){var b=Z.ref,J=t.index,P=b._definition?b._definition.fieldsByIndex[J]:b.$indexes.get(J);S[P]=Z.getValue(J)}))},v=0;v<Z;v++)P(v);return J}var st={context:new H},qt=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Z(b,t),J([O("string",st)],b.prototype,"name",void 0),J([O("string",st)],b.prototype,"type",void 0),J([O("number",st)],b.prototype,"referencedType",void 0),b}(yt),Qt=function(t){function b(){var b=null!==t&&t.apply(this,arguments)||this;return b.fields=new T,b}return Z(b,t),J([O("number",st)],b.prototype,"id",void 0),J([O([qt],st)],b.prototype,"fields",void 0),b}(yt),Nt=function(t){function b(){var b=null!==t&&t.apply(this,arguments)||this;return b.types=new T,b}return Z(b,t),b.encode=function(t){var Z=t.constructor,J=new b;J.rootType=Z._typeid;var S=function(t,b){for(var Z in b){var S=new qt;S.name=Z;var P=void 0;if("string"===typeof b[Z])P=b[Z];else{var v=b[Z],h=void 0;yt.is(v)?(P="ref",h=b[Z]):"string"===typeof v[P=Object.keys(v)[0]]?P+=":"+v[P]:h=v[P],S.referencedType=h?h._typeid:-1}S.type=P,t.fields.push(S)}J.types.push(t)},P=Z._context.types;for(var v in P){var h=new Qt;h.id=Number(v),S(h,P[v]._definition.schema)}return J.encodeAll()},b.decode=function(t,J){var S=new H,P=new b;P.decode(t,J);var v=P.types.reduce((function(t,b){var J=function(t){function b(){return null!==t&&t.apply(this,arguments)||this}return Z(b,t),b}(yt),P=b.id;return t[P]=J,S.add(J,P),t}),{});P.types.forEach((function(t){var b=v[t.id];t.fields.forEach((function(t){var Z;if(void 0!==t.referencedType){var J=t.type,P=v[t.referencedType];if(!P){var h=t.type.split(":");J=h[0],P=h[1]}"ref"===J?O(P,{context:S})(b.prototype,t.name):O(((Z={})[J]=P,Z),{context:S})(b.prototype,t.name)}else O(t.type,{context:S})(b.prototype,t.name)}))}));var h=v[P.rootType],C=new h;for(var Y in h._definition.schema){var g=h._definition.schema[Y];"string"!==typeof g&&(C[Y]="function"===typeof g?new g:new(U(Object.keys(g)[0]).constructor))}return C},J([O([Qt],st)],b.prototype,"types",void 0),J([O("number",st)],b.prototype,"rootType",void 0),b}(yt);l("map",{constructor:k}),l("array",{constructor:T}),l("set",{constructor:ot}),l("collection",{constructor:Ht}),t.ArraySchema=T,t.CollectionSchema=Ht,t.Context=H,t.MapSchema=k,t.Reflection=Nt,t.ReflectionField=qt,t.ReflectionType=Qt,t.Schema=yt,t.SchemaDefinition=E,t.SetSchema=ot,t.decode=ct,t.defineTypes=j,t.deprecated=W,t.dumpChanges=dt,t.encode=R,t.filter=p,t.filterChildren=e,t.hasFilter=c,t.registerType=l,t.type=O,Object.defineProperty(t,"__esModule",{value:!0})}(b)},14825:function(t,b,Z){var J,S,P;function v(){const t=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(v=function(){return t})()}function h(t,b){const Z=v();return(h=function(t,b){return Z[t-=212]})(t,b)}t=Z.nmd(t),function(t){const b=h,Z=t();for(;;)try{if(368192===parseInt(b(328))/1+parseInt(b(379))/2*(-parseInt(b(226))/3)+parseInt(b(348))/4*(parseInt(b(264))/5)+parseInt(b(224))/6*(-parseInt(b(223))/7)+-parseInt(b(345))/8*(parseInt(b(325))/9)+-parseInt(b(215))/10+-parseInt(b(275))/11*(-parseInt(b(383))/12))break;Z.push(Z.shift())}catch(J){Z.push(Z.shift())}}(v),function(v,C){const Y=h;Y(262)==typeof b&&"object"==Y(262)?t[Y(337)]=C():"function"==Y(237)&&Z.amdD[Y(400)]?(S=[],void 0===(P="function"===typeof(J=C)?J.apply(b,S):J)||(t.exports=P)):Y(262)==typeof b?b[Y(277)]=C():v[Y(277)]=C()}(this,(()=>(()=>{var t={646:function(t){t[h(337)]=function(){"use strict";function t(t){const b=h;for(var Z=1;Z<arguments[b(302)];Z++){var J=arguments[Z];for(var S in J)t[S]=J[S]}return t}return function b(Z,J){const S=h;function P(b,S,P){const v=h;if(v(363)!=typeof document){"number"==typeof(P=t({},J,P))[v(278)]&&(P[v(278)]=new Date(Date[v(235)]()+864e5*P[v(278)])),P[v(278)]&&(P[v(278)]=P[v(278)][v(351)]()),b=encodeURIComponent(b).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[v(320)](/[()]/g,escape);var C="";for(var Y in P)P[Y]&&(C+="; "+Y,!0!==P[Y]&&(C+="="+P[Y][v(335)](";")[0]));return document[v(295)]=b+"="+Z[v(349)](S,b)+C}}return Object[S(260)]({set:P,get:function(t){const b=h;if(b(363)!=typeof document&&(!arguments[b(302)]||t)){for(var J=document.cookie?document[b(295)][b(335)]("; "):[],S={},P=0;P<J[b(302)];P++){var v=J[P][b(335)]("="),C=v[b(396)](1)[b(323)]("=");try{var Y=decodeURIComponent(v[0]);if(S[Y]=Z[b(366)](C,Y),t===Y)break}catch(g){}}return t?S[t]:S}},remove:function(b,Z){P(b,"",t({},Z,{expires:-1}))},withAttributes:function(Z){return b(this[S(359)],t({},this.attributes,Z))},withConverter:function(Z){const J=S;return b(t({},this[J(359)],Z),this[J(398)])}},{attributes:{value:Object[S(315)](J)},converter:{value:Object.freeze(Z)}})}({read:function(t){const b=h;return'"'===t[0]&&(t=t[b(396)](1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){const b=h;return encodeURIComponent(t)[b(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(382)]=void 0;const S=Z(284);class P{static[J(218)](){const t=J;console[t(395)](t(212)),window.addEventListener(t(297),P[t(258)])}static onBeforeUnload(){const t=J;S[t(313)][t(236)]()}}b[J(382)]=P},719:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,"__esModule",{value:!0}),b[J(290)]=void 0;const S=Z(284),P=Z(878);b[J(290)]=class{static[J(307)](t,b,Z){const P=J;S.ByteBrewCore[P(307)](t,b,Z)}static[J(339)](){const t=J;return S[t(313)][t(393)]}static[J(239)](t,b){const Z=J;void 0===b?S.ByteBrewCore[Z(239)](t):Z(240)==typeof b?S.ByteBrewCore[Z(247)](t,b):Z(270)==typeof b?S[Z(313)][Z(243)](t,b):Z(262)==typeof b&&S[Z(313)][Z(286)](t,b)}static loadRemoteConfigs(t){const b=J;P.RemoteConfigHandler[b(282)](t)}static[J(233)](t,b){const Z=J;return P[Z(272)][Z(233)](t,b)}static[J(369)](){const t=J;return P[t(272)][t(369)]()}static[J(391)](){const t=J;S[t(313)][t(391)]()}static[J(384)](){const t=J;S[t(313)][t(384)]()}static[J(213)](){return S.ByteBrewCore.userID}}},441:function(t,b,Z){"use strict";const J=h;var S=this&&this[J(329)]||function(t){return t&&t[J(220)]?t:{default:t}};Object[J(228)](b,J(220),{value:!0}),b[J(397)]=void 0;const P=S(Z(646)),v=Z(429);class C{static[J(332)](){const t=J,b=P[t(334)][t(311)](C[t(231)]);return b?{userID:b,isNewUser:!1,hasSuccessfullyInitialized:C[t(394)]()}:{userID:C.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[J(230)](){const t=J,b=(0,v.v4)();return P.default[t(242)](C[t(231)],b,{expires:365}),b}static setTrackingSettingsCookie(t){const b=J,Z=b(t?248:367);P[b(334)].set(C[b(225)],Z,{expires:365})}static[J(314)](){const t=J,b=P[t(334)][t(311)](C.trackingSettingsIDCookieKey);return!b||"true"===b}static[J(356)](){return C.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const t=J,b=P.default[t(311)](C[t(231)]);b&&P.default[t(242)](C.userHasInitializedSuccessfullyCookieKey,b,{expires:365})}static[J(330)](){const t=J,b=P[t(334)][t(311)](C[t(326)]),Z=P[t(334)][t(311)](C[t(231)]);return!(!b||!Z)&&b===Z}static hasUserInitialized(){return C[J(330)]()}}b.ByteBrewCookieManager=C,C.userIDCookieKey=J(361),C.trackingSettingsIDCookieKey=J(357),C[J(326)]="bb_u_h_init"},284:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(313)]=void 0;const S=Z(441),P=Z(797),v=Z(334),C=Z(429),Y=Z(147);class g{static[J(246)](){const t=J;let b=navigator[t(281)][t(335)]("-");return b.length<2?"??":b[b.length-1]||"??"}static[J(307)](t,b,Z){const P=J;if(g[P(393)])return;if(console[P(395)]("ByteBrew: Starting Initialization"),!t||!b)return void console.log(P(256));if(g[P(221)]=S[P(397)][P(356)](),!g.trackingEnabled)return void console[P(395)](P(362));g[P(399)]=t,g[P(249)]=b,g[P(336)]=Z,g.sessionID=(0,C.v4)(),g.sessionKey="",g[P(300)]=Y[P(305)],g.language=navigator[P(281)],g[P(385)]=g[P(246)]();const h=S[P(397)][P(332)]();g[P(308)]=h[P(308)],h.isNewUser||!h[P(293)]?g.createNewUserEvent():g[P(344)](),g[P(331)]=new Date,v[P(382)][P(218)]()}static reinitializeByteBrew(){const t=J;console[t(395)](t(306)),g.initializeByteBrew(g[t(399)],g[t(249)],g[t(336)])}static[J(387)](t){const b=J;g[b(214)]=t,g[b(393)]=!0,g.hasBeenInitializedWhilePageOpen=!0,S[b(397)][b(296)](),console[b(395)](b(386))}static[J(301)](){const t=J;g[t(303)]&&(console.log(t(341)),this[t(217)]())}static[J(372)](){return g[J(393)]&&g.trackingEnabled}static getScreenResolution(){return window[J(227)]+"x"+window.innerHeight}static[J(241)](){const t=J;return{game_id:g[t(399)],user_id:g[t(308)],session_id:g[t(318)],session_key:g.sessionKey,platform:g.platform}}static[J(244)](){const t=J;return Object[t(219)](Object[t(219)]({},g[t(241)]()),{version_number:g[t(336)],sdk_version:g[t(300)],deviceScreenSize:g[t(280)](),tracking_enabled:g[t(221)]})}static[J(283)](t,b){const Z=J;P.ByteBrewWebRequestor[Z(380)](t,b).then((t=>{const b=Z;if(t&&t.ok){const Z=t.headers.get(b(354));Z?g.onInitializationSuccessful(Z):console[b(395)](b(381))}else console[b(395)](b(232)+(t?t[b(259)]:"No Response"))}))}static createUserEvent(){const t=J;if(!g[t(221)])return;console.log(t(353));let b={eventType:"game_open",userLocale:g[t(281)]};const Z=Object[t(219)](Object[t(219)]({},g[t(244)]()),{category:t(269),geo:g[t(385)],externalData:b});g[t(283)](P.ByteBrewWebRequestor[t(238)],Z)}static[J(285)](){const t=J;if(!g[t(221)])return;console[t(395)](t(352));let b={eventType:t(309),userLocale:g[t(281)]};const Z=Object.assign(Object.assign({},g.getFullEventObject()),{category:t(269),geo:g[t(385)],externalData:b});g[t(283)](P[t(265)][t(238)],Z)}static endCurrentSession(){const t=J;if(!g[t(372)]())return;g[t(393)]=!1,console.log(t(350));const b=new Date;let Z={sessionLength:Math[t(287)]((b[t(253)]()-g[t(331)].getTime())/1e3)[t(251)]()};const S=Object[t(219)](Object[t(219)]({},g[t(244)]()),{category:t(401),externalData:Z});P.ByteBrewWebRequestor[t(380)](P[t(265)][t(238)],S)}static[J(252)](t){const b=J;let Z="";if(!t)return Z;for(const[J,S]of Object.entries(t))Z+=J+"="+S+";";return Z[b(302)]>0&&(Z=Z[b(396)](0,-1)),Z}static[J(368)](t,b){const Z=J;if(!g.canSendData())return;console[Z(395)](Z(374)+t);let S={eventType:t};b&&(S=Object.assign(Object[Z(219)]({},S),{value:"object"==typeof b?g[Z(252)](b):b[Z(251)]()}));const v=Object[Z(219)](Object[Z(219)]({},g[Z(244)]()),{category:"custom",externalData:S});P.ByteBrewWebRequestor[Z(380)](P[Z(265)][Z(238)],v)[Z(378)]((t=>{const b=Z;t&&t.ok?console.log(b(274)):console[b(395)](b(294)+(t?t.status:b(267)))}))}static[J(239)](t){g[J(368)](t,null)}static[J(247)](t,b){g.sendCustomEvent(t,b)}static newCustomEventWithNumber(t,b){g.sendCustomEvent(t,b)}static[J(286)](t,b){g[J(368)](t,b)}static[J(391)](){const t=J;console[t(395)]("ByteBrew: Restarting Tracking"),g[t(221)]=!0,S[t(397)][t(360)](!0),g[t(217)]()}static[J(384)](){const t=J;console[t(395)](t(257)),g[t(221)]=!1,S.ByteBrewCookieManager[t(360)](!1)}}b[J(313)]=g,g[J(393)]=!1,g[J(303)]=!1,g[J(261)]="Web"},797:function(t,b,Z){"use strict";const J=h;var S=this&&this[J(342)]||function(t,b,Z,J){return new(Z||(Z=Promise))((function(S,P){const v=h;function C(t){try{g(J.next(t))}catch(b){P(b)}}function Y(t){try{g(J.throw(t))}catch(b){P(b)}}function g(t){const b=h;var J;t.done?S(t.value):(J=t[b(234)],J instanceof Z?J:new Z((function(t){t(J)})))[b(378)](C,Y)}g((J=J[v(222)](t,b||[]))[v(255)]())}))};Object[J(228)](b,J(220),{value:!0}),b[J(265)]=void 0;const P=Z(284);class v{static sendBasicRequest(t,b){return S(this,void 0,void 0,(function*(){const Z=h;try{const J={method:"POST",mode:Z(358),headers:{Accept:Z(304),"Content-Type":Z(289),"sdk-key":P[Z(313)][Z(249)]},body:JSON.stringify(b),keepalive:!0};return yield v[Z(298)](t,J)}catch(J){console[Z(284)](J)}}))}static[J(343)](t){return S(this,void 0,void 0,(function*(){const b=h;try{const Z={method:b(392),mode:"cors",headers:{Accept:b(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":P[b(313)][b(249)],user_id:P[b(313)][b(308)]}};return yield v[b(298)](t,Z)}catch(Z){console[b(284)](Z)}}))}static[J(298)](t,b){return S(this,void 0,void 0,(function*(){const Z=h;try{const J=yield fetch(t,b);return J.ok||console[Z(284)]("Request failed with status "+J[Z(259)]),J}catch(J){console[Z(284)](J)}}))}}b.ByteBrewWebRequestor=v,v[J(238)]=J(390),v[J(268)]=J(389)},878:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,J(220),{value:!0}),b[J(272)]=void 0;const S=Z(284),P=Z(797);class v{static[J(292)](t){v.remoteConfigs=t}static hasRemoteConfigsBeenSet(){return!!v[J(216)]}static loadRemoteConfigs(t){const b=J;P[b(265)][b(343)](P[b(265)][b(268)]+S[b(313)].appID)[b(378)]((Z=>{const J=b;Z&&Z.ok?Z[J(371)]()[J(378)]((b=>{const Z=J;let S=null;try{S=new Map(Object[Z(370)](JSON[Z(250)](b))),console[Z(395)](Z(266))}catch(P){S=null,console[Z(284)](Z(388))}finally{v[Z(292)](S),S&&t(S)}})):Z?console.error(J(322)+(Z?Z[J(259)]:J(267))+" "+(Z?Z.statusText:"")):console[J(284)](J(279))}))}static[J(233)](t,b){const Z=J;return v[Z(369)]()&&v.remoteConfigs[Z(364)](t)?v[Z(216)][Z(311)](t):b}}b[J(272)]=v,v[J(216)]=null},429:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,J(220),{value:!0}),Object[J(228)](b,J(319),{enumerable:!0,get:function(){return Y[J(334)]}}),Object[J(228)](b,J(250),{enumerable:!0,get:function(){return M.default}}),Object[J(228)](b,J(333),{enumerable:!0,get:function(){return r[J(334)]}}),Object.defineProperty(b,"v1",{enumerable:!0,get:function(){return S[J(334)]}}),Object[J(228)](b,"v3",{enumerable:!0,get:function(){return P[J(334)]}}),Object[J(228)](b,"v4",{enumerable:!0,get:function(){return v[J(334)]}}),Object[J(228)](b,"v5",{enumerable:!0,get:function(){return C[J(334)]}}),Object.defineProperty(b,J(310),{enumerable:!0,get:function(){return I[J(334)]}}),Object[J(228)](b,"version",{enumerable:!0,get:function(){return g[J(334)]}});var S=T(Z(990)),P=T(Z(237)),v=T(Z(355)),C=T(Z(764)),Y=T(Z(314)),g=T(Z(464)),I=T(Z(435)),r=T(Z(8)),M=T(Z(222));function T(t){return t&&t[J(220)]?t:{default:t}}},163:(t,b)=>{"use strict";const Z=h;function J(t){return 14+(t+64>>>9<<4)+1}function S(t,b){const Z=(65535&t)+(65535&b);return(t>>16)+(b>>16)+(Z>>16)<<16|65535&Z}function P(t,b,Z,J,P,v){return S((h=S(S(b,t),S(J,v)))<<(C=P)|h>>>32-C,Z);var h,C}function v(t,b,Z,J,S,v,h){return P(b&Z|~b&J,t,b,S,v,h)}function C(t,b,Z,J,S,v,h){return P(b&J|Z&~J,t,b,S,v,h)}function Y(t,b,Z,J,S,v,h){return P(b^Z^J,t,b,S,v,h)}function g(t,b,Z,J,S,v,h){return P(Z^(b|~J),t,b,S,v,h)}Object.defineProperty(b,Z(220),{value:!0}),b[Z(334)]=void 0;b.default=function(t){const b=Z;if(b(240)==typeof t){const Z=unescape(encodeURIComponent(t));t=new Uint8Array(Z[b(302)]);for(let J=0;J<Z[b(302)];++J)t[J]=Z[b(312)](J)}return function(t){const Z=b,J=[],S=32*t.length,P=Z(276);for(let b=0;b<S;b+=8){const S=t[b>>5]>>>b%32&255,v=parseInt(P[Z(376)](S>>>4&15)+P[Z(376)](15&S),16);J[Z(288)](v)}return J}(function(t,Z){const P=b;t[Z>>5]|=128<<Z%32,t[J(Z)-1]=Z;let h=1732584193,I=-271733879,r=-1732584194,M=271733878;for(let b=0;b<t[P(302)];b+=16){const Z=h,J=I,P=r,T=M;h=v(h,I,r,M,t[b],7,-680876936),M=v(M,h,I,r,t[b+1],12,-389564586),r=v(r,M,h,I,t[b+2],17,606105819),I=v(I,r,M,h,t[b+3],22,-1044525330),h=v(h,I,r,M,t[b+4],7,-176418897),M=v(M,h,I,r,t[b+5],12,1200080426),r=v(r,M,h,I,t[b+6],17,-1473231341),I=v(I,r,M,h,t[b+7],22,-45705983),h=v(h,I,r,M,t[b+8],7,1770035416),M=v(M,h,I,r,t[b+9],12,-1958414417),r=v(r,M,h,I,t[b+10],17,-42063),I=v(I,r,M,h,t[b+11],22,-1990404162),h=v(h,I,r,M,t[b+12],7,1804603682),M=v(M,h,I,r,t[b+13],12,-40341101),r=v(r,M,h,I,t[b+14],17,-1502002290),I=v(I,r,M,h,t[b+15],22,1236535329),h=C(h,I,r,M,t[b+1],5,-165796510),M=C(M,h,I,r,t[b+6],9,-1069501632),r=C(r,M,h,I,t[b+11],14,643717713),I=C(I,r,M,h,t[b],20,-373897302),h=C(h,I,r,M,t[b+5],5,-701558691),M=C(M,h,I,r,t[b+10],9,38016083),r=C(r,M,h,I,t[b+15],14,-660478335),I=C(I,r,M,h,t[b+4],20,-405537848),h=C(h,I,r,M,t[b+9],5,568446438),M=C(M,h,I,r,t[b+14],9,-1019803690),r=C(r,M,h,I,t[b+3],14,-187363961),I=C(I,r,M,h,t[b+8],20,1163531501),h=C(h,I,r,M,t[b+13],5,-1444681467),M=C(M,h,I,r,t[b+2],9,-51403784),r=C(r,M,h,I,t[b+7],14,1735328473),I=C(I,r,M,h,t[b+12],20,-1926607734),h=Y(h,I,r,M,t[b+5],4,-378558),M=Y(M,h,I,r,t[b+8],11,-2022574463),r=Y(r,M,h,I,t[b+11],16,1839030562),I=Y(I,r,M,h,t[b+14],23,-35309556),h=Y(h,I,r,M,t[b+1],4,-1530992060),M=Y(M,h,I,r,t[b+4],11,1272893353),r=Y(r,M,h,I,t[b+7],16,-155497632),I=Y(I,r,M,h,t[b+10],23,-1094730640),h=Y(h,I,r,M,t[b+13],4,681279174),M=Y(M,h,I,r,t[b],11,-358537222),r=Y(r,M,h,I,t[b+3],16,-722521979),I=Y(I,r,M,h,t[b+6],23,76029189),h=Y(h,I,r,M,t[b+9],4,-640364487),M=Y(M,h,I,r,t[b+12],11,-421815835),r=Y(r,M,h,I,t[b+15],16,530742520),I=Y(I,r,M,h,t[b+2],23,-995338651),h=g(h,I,r,M,t[b],6,-198630844),M=g(M,h,I,r,t[b+7],10,1126891415),r=g(r,M,h,I,t[b+14],15,-1416354905),I=g(I,r,M,h,t[b+5],21,-57434055),h=g(h,I,r,M,t[b+12],6,1700485571),M=g(M,h,I,r,t[b+3],10,-1894986606),r=g(r,M,h,I,t[b+10],15,-1051523),I=g(I,r,M,h,t[b+1],21,-2054922799),h=g(h,I,r,M,t[b+8],6,1873313359),M=g(M,h,I,r,t[b+15],10,-30611744),r=g(r,M,h,I,t[b+6],15,-1560198380),I=g(I,r,M,h,t[b+13],21,1309151649),h=g(h,I,r,M,t[b+4],6,-145523070),M=g(M,h,I,r,t[b+11],10,-1120210379),r=g(r,M,h,I,t[b+2],15,718787259),I=g(I,r,M,h,t[b+9],21,-343485551),h=S(h,Z),I=S(I,J),r=S(r,P),M=S(M,T)}return[h,I,r,M]}(function(t){const Z=b;if(0===t[Z(302)])return[];const S=8*t[Z(302)],P=new Uint32Array(J(S));for(let b=0;b<S;b+=8)P[b>>5]|=(255&t[b/8])<<b%32;return P}(t),8*t[b(302)]))}},790:(t,b)=>{"use strict";const Z=h;Object[Z(228)](b,Z(220),{value:!0}),b[Z(334)]=void 0;var J={randomUUID:Z(363)!=typeof crypto&&crypto[Z(273)]&&crypto[Z(273)][Z(229)](crypto)};b.default=J},314:(t,b)=>{"use strict";const Z=h;Object[Z(228)](b,"__esModule",{value:!0}),b.default=void 0,b[Z(334)]="00000000-0000-0000-0000-000000000000"},222:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,J(220),{value:!0}),b[J(334)]=void 0;var S,P=(S=Z(435))&&S.__esModule?S:{default:S};b[J(334)]=function(t){const b=J;if(!(0,P.default)(t))throw TypeError(b(271));let Z;const S=new Uint8Array(16);return S[0]=(Z=parseInt(t[b(396)](0,8),16))>>>24,S[1]=Z>>>16&255,S[2]=Z>>>8&255,S[3]=255&Z,S[4]=(Z=parseInt(t[b(396)](9,13),16))>>>8,S[5]=255&Z,S[6]=(Z=parseInt(t[b(396)](14,18),16))>>>8,S[7]=255&Z,S[8]=(Z=parseInt(t[b(396)](19,23),16))>>>8,S[9]=255&Z,S[10]=(Z=parseInt(t[b(396)](24,36),16))/1099511627776&255,S[11]=Z/4294967296&255,S[12]=Z>>>24&255,S[13]=Z>>>16&255,S[14]=Z>>>8&255,S[15]=255&Z,S}},58:(t,b)=>{"use strict";const Z=h;Object[Z(228)](b,"__esModule",{value:!0}),b[Z(334)]=void 0,b[Z(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(t,b)=>{"use strict";const Z=h;let J;Object[Z(228)](b,"__esModule",{value:!0}),b[Z(334)]=function(){const t=Z;if(!J&&(J="undefined"!=typeof crypto&&crypto[t(254)]&&crypto.getRandomValues.bind(crypto),!J))throw new Error(t(299));return J(S)};const S=new Uint8Array(16)},757:(t,b)=>{"use strict";const Z=h;function J(t,b,Z,J){switch(t){case 0:return b&Z^~b&J;case 1:case 3:return b^Z^J;case 2:return b&Z^b&J^Z&J}}function S(t,b){return t<<b|t>>>32-b}Object.defineProperty(b,Z(220),{value:!0}),b[Z(334)]=void 0;b[Z(334)]=function(t){const b=Z,P=[1518500249,1859775393,2400959708,3395469782],v=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const Z=unescape(encodeURIComponent(t));t=[];for(let J=0;J<Z[b(302)];++J)t[b(288)](Z.charCodeAt(J))}else Array[b(338)](t)||(t=Array[b(340)][b(396)].call(t));t[b(288)](128);const h=t[b(302)]/4+2,C=Math[b(375)](h/16),Y=new Array(C);for(let Z=0;Z<C;++Z){const b=new Uint32Array(16);for(let J=0;J<16;++J)b[J]=t[64*Z+4*J]<<24|t[64*Z+4*J+1]<<16|t[64*Z+4*J+2]<<8|t[64*Z+4*J+3];Y[Z]=b}Y[C-1][14]=8*(t[b(302)]-1)/Math.pow(2,32),Y[C-1][14]=Math.floor(Y[C-1][14]),Y[C-1][15]=8*(t.length-1)&4294967295;for(let Z=0;Z<C;++Z){const t=new Uint32Array(80);for(let b=0;b<16;++b)t[b]=Y[Z][b];for(let b=16;b<80;++b)t[b]=S(t[b-3]^t[b-8]^t[b-14]^t[b-16],1);let h=v[0],C=v[1],g=v[2],I=v[3],r=v[4];for(let Z=0;Z<80;++Z){const v=Math[b(365)](Z/20),Y=S(h,5)+J(v,C,g,I)+r+P[v]+t[Z]>>>0;r=I,I=g,g=S(C,30)>>>0,C=h,h=Y}v[0]=v[0]+h>>>0,v[1]=v[1]+C>>>0,v[2]=v[2]+g>>>0,v[3]=v[3]+I>>>0,v[4]=v[4]+r>>>0}return[v[0]>>24&255,v[0]>>16&255,v[0]>>8&255,255&v[0],v[1]>>24&255,v[1]>>16&255,v[1]>>8&255,255&v[1],v[2]>>24&255,v[2]>>16&255,v[2]>>8&255,255&v[2],v[3]>>24&255,v[3]>>16&255,v[3]>>8&255,255&v[3],v[4]>>24&255,v[4]>>16&255,v[4]>>8&255,255&v[4]]}},8:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(334)]=void 0,b[J(263)]=C;var S,P=(S=Z(435))&&S[J(220)]?S:{default:S};const v=[];for(let h=0;h<256;++h)v[J(288)]((h+256)[J(251)](16)[J(396)](1));function C(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=J;return(v[t[b+0]]+v[t[b+1]]+v[t[b+2]]+v[t[b+3]]+"-"+v[t[b+4]]+v[t[b+5]]+"-"+v[t[b+6]]+v[t[b+7]]+"-"+v[t[b+8]]+v[t[b+9]]+"-"+v[t[b+10]]+v[t[b+11]]+v[t[b+12]]+v[t[b+13]]+v[t[b+14]]+v[t[b+15]])[Z(317)]()}b[J(334)]=function(t){const b=J,Z=C(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,P.default)(Z))throw TypeError(b(321));return Z}},990:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,"__esModule",{value:!0}),b[J(334)]=void 0;var S,P=(S=Z(319))&&S[J(220)]?S:{default:S},v=Z(8);let C,Y,g=0,I=0;b[J(334)]=function(t,b,Z){const S=J;let h=b&&Z||0;const r=b||new Array(16);let M=(t=t||{}).node||C,T=void 0!==t[S(324)]?t[S(324)]:Y;if(null==M||null==T){const b=t[S(347)]||(t[S(355)]||P[S(334)])();null==M&&(M=C=[1|b[0],b[1],b[2],b[3],b[4],b[5]]),null==T&&(T=Y=16383&(b[6]<<8|b[7]))}let a=void 0!==t[S(327)]?t.msecs:Date.now(),k=void 0!==t[S(316)]?t.nsecs:I+1;const u=a-g+(k-I)/1e4;if(u<0&&void 0===t[S(324)]&&(T=T+1&16383),(u<0||a>g)&&void 0===t[S(316)]&&(k=0),k>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=a,I=k,Y=T,a+=122192928e5;const l=(1e4*(268435455&a)+k)%4294967296;r[h++]=l>>>24&255,r[h++]=l>>>16&255,r[h++]=l>>>8&255,r[h++]=255&l;const U=a/4294967296*1e4&268435455;r[h++]=U>>>8&255,r[h++]=255&U,r[h++]=U>>>24&15|16,r[h++]=U>>>16&255,r[h++]=T>>>8|128,r[h++]=255&T;for(let J=0;J<6;++J)r[h+J]=M[J];return b||(0,v[S(263)])(r)}},237:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(334)]=void 0;var S=v(Z(925)),P=v(Z(163));function v(t){return t&&t[J(220)]?t:{default:t}}var C=(0,S.default)("v3",48,P[J(334)]);b[J(334)]=C},925:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(291)]=b.DNS=void 0,b[J(334)]=function(t,b,Z){const S=J;function g(t,J,S,C){const Y=h;var g;if(Y(240)==typeof t&&(t=function(t){const b=Y;t=unescape(encodeURIComponent(t));const Z=[];for(let J=0;J<t.length;++J)Z[b(288)](t.charCodeAt(J));return Z}(t)),Y(240)==typeof J&&(J=(0,v[Y(334)])(J)),16!==(null===(g=J)||void 0===g?void 0:g[Y(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let I=new Uint8Array(16+t[Y(302)]);if(I.set(J),I[Y(242)](t,J[Y(302)]),I=Z(I),I[6]=15&I[6]|b,I[8]=63&I[8]|128,S){C=C||0;for(let t=0;t<16;++t)S[C+t]=I[t];return S}return(0,P.unsafeStringify)(I)}try{g.name=t}catch(I){}return g[S(245)]=C,g[S(291)]=Y,g};var S,P=Z(8),v=(S=Z(222))&&S[J(220)]?S:{default:S};const C="6ba7b810-9dad-11d1-80b4-00c04fd430c8";b.DNS=C;const Y="6ba7b811-9dad-11d1-80b4-00c04fd430c8";b.URL=Y},355:(t,b,Z)=>{"use strict";const J=h;Object.defineProperty(b,"__esModule",{value:!0}),b[J(334)]=void 0;var S=C(Z(790)),P=C(Z(319)),v=Z(8);function C(t){return t&&t.__esModule?t:{default:t}}b[J(334)]=function(t,b,Z){const h=J;if(S[h(334)][h(273)]&&!b&&!t)return S.default[h(273)]();const C=(t=t||{}).random||(t[h(355)]||P.default)();if(C[6]=15&C[6]|64,C[8]=63&C[8]|128,b){Z=Z||0;for(let t=0;t<16;++t)b[Z+t]=C[t];return b}return(0,v.unsafeStringify)(C)}},764:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,"__esModule",{value:!0}),b[J(334)]=void 0;var S=v(Z(925)),P=v(Z(757));function v(t){return t&&t[J(220)]?t:{default:t}}var C=(0,S[J(334)])("v5",80,P.default);b.default=C},435:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(334)]=void 0;var S,P=(S=Z(58))&&S.__esModule?S:{default:S};b[J(334)]=function(t){const b=J;return b(240)==typeof t&&P[b(334)][b(346)](t)}},464:(t,b,Z)=>{"use strict";const J=h;Object[J(228)](b,J(220),{value:!0}),b[J(334)]=void 0;var S,P=(S=Z(435))&&S[J(220)]?S:{default:S};b[J(334)]=function(t){const b=J;if(!(0,P[b(334)])(t))throw TypeError(b(271));return parseInt(t[b(396)](14,15),16)}},147:t=>{"use strict";const b=h;t[b(337)]=JSON[b(250)](b(373))}},b={};function Z(J){const S=h;var P=b[J];if(void 0!==P)return P[S(337)];var v=b[J]={exports:{}};return t[J][S(377)](v[S(337)],v,v[S(337)],Z),v.exports}var J={};return(()=>{"use strict";const t=h;var b=J;Object[t(228)](b,"__esModule",{value:!0}),b.ByteBrew=void 0;var S=Z(719);Object[t(228)](b,t(290),{enumerable:!0,get:function(){return S[t(290)]}})})(),J})()))},14851:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14846:(t,b,Z)=>{var J=Z(14851),S=Z(14860),P=Object.hasOwnProperty,v=Object.create(null);for(var h in J)P.call(J,h)&&(v[J[h]]=h);var C=t.exports={to:{},get:{}};function Y(t,b,Z){return Math.min(Math.max(b,t),Z)}function g(t){var b=Math.round(t).toString(16).toUpperCase();return b.length<2?"0"+b:b}C.get=function(t){var b,Z;switch(t.substring(0,3).toLowerCase()){case"hsl":b=C.get.hsl(t),Z="hsl";break;case"hwb":b=C.get.hwb(t),Z="hwb";break;default:b=C.get.rgb(t),Z="rgb"}return b?{model:Z,value:b}:null},C.get.rgb=function(t){if(!t)return null;var b,Z,S,v=[0,0,0,1];if(b=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(S=b[2],b=b[1],Z=0;Z<3;Z++){var h=2*Z;v[Z]=parseInt(b.slice(h,h+2),16)}S&&(v[3]=parseInt(S,16)/255)}else if(b=t.match(/^#([a-f0-9]{3,4})$/i)){for(S=(b=b[1])[3],Z=0;Z<3;Z++)v[Z]=parseInt(b[Z]+b[Z],16);S&&(v[3]=parseInt(S+S,16)/255)}else if(b=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Z=0;Z<3;Z++)v[Z]=parseInt(b[Z+1],0);b[4]&&(b[5]?v[3]=.01*parseFloat(b[4]):v[3]=parseFloat(b[4]))}else{if(!(b=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=t.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:P.call(J,b[1])?((v=J[b[1]])[3]=1,v):null:null;for(Z=0;Z<3;Z++)v[Z]=Math.round(2.55*parseFloat(b[Z+1]));b[4]&&(b[5]?v[3]=.01*parseFloat(b[4]):v[3]=parseFloat(b[4]))}for(Z=0;Z<3;Z++)v[Z]=Y(v[Z],0,255);return v[3]=Y(v[3],0,1),v},C.get.hsl=function(t){if(!t)return null;var b=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Z=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,Y(parseFloat(b[2]),0,100),Y(parseFloat(b[3]),0,100),Y(isNaN(Z)?1:Z,0,1)]}return null},C.get.hwb=function(t){if(!t)return null;var b=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Z=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,Y(parseFloat(b[2]),0,100),Y(parseFloat(b[3]),0,100),Y(isNaN(Z)?1:Z,0,1)]}return null},C.to.hex=function(){var t=S(arguments);return"#"+g(t[0])+g(t[1])+g(t[2])+(t[3]<1?g(Math.round(255*t[3])):"")},C.to.rgb=function(){var t=S(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},C.to.rgb.percent=function(){var t=S(arguments),b=Math.round(t[0]/255*100),Z=Math.round(t[1]/255*100),J=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+b+"%, "+Z+"%, "+J+"%)":"rgba("+b+"%, "+Z+"%, "+J+"%, "+t[3]+")"},C.to.hsl=function(){var t=S(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},C.to.hwb=function(){var t=S(arguments),b="";return t.length>=4&&1!==t[3]&&(b=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+b+")"},C.to.keyword=function(t){return v[t.slice(0,3)]}},14837:(t,b,Z)=>{const J=Z(14846),S=Z(14875),P=["keyword","gray","hex"],v={};for(const M of Object.keys(S))v[[...S[M].labels].sort().join("")]=M;const h={};function C(t,b){if(!(this instanceof C))return new C(t,b);if(b&&b in P&&(b=null),b&&!(b in S))throw new Error("Unknown model: "+b);let Z,Y;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof C)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if("string"===typeof t){const b=J.get(t);if(null===b)throw new Error("Unable to parse color from string: "+t);this.model=b.model,Y=S[this.model].channels,this.color=b.value.slice(0,Y),this.valpha="number"===typeof b.value[Y]?b.value[Y]:1}else if(t.length>0){this.model=b||"rgb",Y=S[this.model].channels;const Z=Array.prototype.slice.call(t,0,Y);this.color=r(Z,Y),this.valpha="number"===typeof t[Y]?t[Y]:1}else if("number"===typeof t)this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;const b=Object.keys(t);"alpha"in t&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof t.alpha?t.alpha:0);const J=b.sort().join("");if(!(J in v))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=v[J];const{labels:P}=S[this.model],h=[];for(Z=0;Z<P.length;Z++)h.push(t[P[Z]]);this.color=r(h)}if(h[this.model])for(Y=S[this.model].channels,Z=0;Z<Y;Z++){const t=h[this.model][Z];t&&(this.color[Z]=t(this.color[Z]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let b=this.model in J.to?this:this.rgb();b=b.round("number"===typeof t?t:1);const Z=1===b.valpha?b.color:[...b.color,this.valpha];return J.to[b.model](Z)},percentString(t){const b=this.rgb().round("number"===typeof t?t:1),Z=1===b.valpha?b.color:[...b.color,this.valpha];return J.to.rgb.percent(Z)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:b}=S[this.model],{labels:Z}=S[this.model];for(let J=0;J<b;J++)t[Z[J]]=this.color[J];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new C([...this.color.map(Y(t)),this.valpha],this.model)},alpha(t){return void 0!==t?new C([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:g("rgb",0,I(255)),green:g("rgb",1,I(255)),blue:g("rgb",2,I(255)),hue:g(["hsl","hsv","hsl","hwb","hcg"],0,(t=>(t%360+360)%360)),saturationl:g("hsl",1,I(100)),lightness:g("hsl",2,I(100)),saturationv:g("hsv",1,I(100)),value:g("hsv",2,I(100)),chroma:g("hcg",1,I(100)),gray:g("hcg",2,I(100)),white:g("hwb",1,I(100)),wblack:g("hwb",2,I(100)),cyan:g("cmyk",0,I(100)),magenta:g("cmyk",1,I(100)),yellow:g("cmyk",2,I(100)),black:g("cmyk",3,I(100)),x:g("xyz",0,I(95.047)),y:g("xyz",1,I(100)),z:g("xyz",2,I(108.833)),l:g("lab",0,I(100)),a:g("lab",1),b:g("lab",2),keyword(t){return void 0!==t?new C(t):S[this.model].keyword(this.color)},hex(t){return void 0!==t?new C(t):J.to.hex(this.rgb().round().color)},hexa(t){if(void 0!==t)return new C(t);const b=this.rgb().round().color;let Z=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Z.length&&(Z="0"+Z),J.to.hex(b)+Z},rgbNumber(){const t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity(){const t=this.rgb().color,b=[];for(const[Z,J]of t.entries()){const t=J/255;b[Z]=t<=.04045?t/12.92:((t+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(t){const b=this.luminosity(),Z=t.luminosity();return b>Z?(b+.05)/(Z+.05):(Z+.05)/(b+.05)},level(t){const b=this.contrast(t);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(2126*t[0]+7152*t[1]+722*t[2])/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let b=0;b<3;b++)t.color[b]=255-t.color[b];return t},lighten(t){const b=this.hsl();return b.color[2]+=b.color[2]*t,b},darken(t){const b=this.hsl();return b.color[2]-=b.color[2]*t,b},saturate(t){const b=this.hsl();return b.color[1]+=b.color[1]*t,b},desaturate(t){const b=this.hsl();return b.color[1]-=b.color[1]*t,b},whiten(t){const b=this.hwb();return b.color[1]+=b.color[1]*t,b},blacken(t){const b=this.hwb();return b.color[2]+=b.color[2]*t,b},grayscale(){const t=this.rgb().color,b=.3*t[0]+.59*t[1]+.11*t[2];return C.rgb(b,b,b)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const b=this.hsl();let Z=b.color[0];return Z=(Z+t)%360,Z=Z<0?360+Z:Z,b.color[0]=Z,b},mix(t,b){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const Z=t.rgb(),J=this.rgb(),S=void 0===b?.5:b,P=2*S-1,v=Z.alpha()-J.alpha(),h=((P*v===-1?P:(P+v)/(1+P*v))+1)/2,Y=1-h;return C.rgb(h*Z.red()+Y*J.red(),h*Z.green()+Y*J.green(),h*Z.blue()+Y*J.blue(),Z.alpha()*S+J.alpha()*(1-S))}};for(const M of Object.keys(S)){if(P.includes(M))continue;const{channels:t}=S[M];C.prototype[M]=function(){if(this.model===M)return new C(this);for(var t=arguments.length,b=new Array(t),Z=0;Z<t;Z++)b[Z]=arguments[Z];return b.length>0?new C(b,M):new C([...(J=S[this.model][M].raw(this.color),Array.isArray(J)?J:[J]),this.valpha],M);var J},C[M]=function(){for(var b=arguments.length,Z=new Array(b),J=0;J<b;J++)Z[J]=arguments[J];let S=Z[0];return"number"===typeof S&&(S=r(Z,t)),new C(S,M)}}function Y(t){return function(b){return function(t,b){return Number(t.toFixed(b))}(b,t)}}function g(t,b,Z){t=Array.isArray(t)?t:[t];for(const J of t)(h[J]||(h[J]=[]))[b]=Z;return t=t[0],function(J){let S;return void 0!==J?(Z&&(J=Z(J)),S=this[t](),S.color[b]=J,S):(S=this[t]().color[b],Z&&(S=Z(S)),S)}}function I(t){return function(b){return Math.max(0,Math.min(t,b))}}function r(t,b){for(let Z=0;Z<b;Z++)"number"!==typeof t[Z]&&(t[Z]=0);return t}t.exports=C},14881:(t,b,Z)=>{const J=Z(14886),S={};for(const v of Object.keys(J))S[J[v]]=v;const P={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};t.exports=P;for(const v of Object.keys(P)){if(!("channels"in P[v]))throw new Error("missing channels property: "+v);if(!("labels"in P[v]))throw new Error("missing channel labels property: "+v);if(P[v].labels.length!==P[v].channels)throw new Error("channel and label counts mismatch: "+v);const{channels:t,labels:b}=P[v];delete P[v].channels,delete P[v].labels,Object.defineProperty(P[v],"channels",{value:t}),Object.defineProperty(P[v],"labels",{value:b})}P.rgb.hsl=function(t){const b=t[0]/255,Z=t[1]/255,J=t[2]/255,S=Math.min(b,Z,J),P=Math.max(b,Z,J),v=P-S;let h,C;P===S?h=0:b===P?h=(Z-J)/v:Z===P?h=2+(J-b)/v:J===P&&(h=4+(b-Z)/v),h=Math.min(60*h,360),h<0&&(h+=360);const Y=(S+P)/2;return C=P===S?0:Y<=.5?v/(P+S):v/(2-P-S),[h,100*C,100*Y]},P.rgb.hsv=function(t){let b,Z,J,S,P;const v=t[0]/255,h=t[1]/255,C=t[2]/255,Y=Math.max(v,h,C),g=Y-Math.min(v,h,C),I=function(t){return(Y-t)/6/g+.5};return 0===g?(S=0,P=0):(P=g/Y,b=I(v),Z=I(h),J=I(C),v===Y?S=J-Z:h===Y?S=1/3+b-J:C===Y&&(S=2/3+Z-b),S<0?S+=1:S>1&&(S-=1)),[360*S,100*P,100*Y]},P.rgb.hwb=function(t){const b=t[0],Z=t[1];let J=t[2];const S=P.rgb.hsl(t)[0],v=1/255*Math.min(b,Math.min(Z,J));return J=1-1/255*Math.max(b,Math.max(Z,J)),[S,100*v,100*J]},P.rgb.cmyk=function(t){const b=t[0]/255,Z=t[1]/255,J=t[2]/255,S=Math.min(1-b,1-Z,1-J);return[100*((1-b-S)/(1-S)||0),100*((1-Z-S)/(1-S)||0),100*((1-J-S)/(1-S)||0),100*S]},P.rgb.keyword=function(t){const b=S[t];if(b)return b;let Z,P=1/0;for(const S of Object.keys(J)){const b=J[S],C=(h=b,((v=t)[0]-h[0])**2+(v[1]-h[1])**2+(v[2]-h[2])**2);C<P&&(P=C,Z=S)}var v,h;return Z},P.keyword.rgb=function(t){return J[t]},P.rgb.xyz=function(t){let b=t[0]/255,Z=t[1]/255,J=t[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92,J=J>.04045?((J+.055)/1.055)**2.4:J/12.92;return[100*(.4124*b+.3576*Z+.1805*J),100*(.2126*b+.7152*Z+.0722*J),100*(.0193*b+.1192*Z+.9505*J)]},P.rgb.lab=function(t){const b=P.rgb.xyz(t);let Z=b[0],J=b[1],S=b[2];Z/=95.047,J/=100,S/=108.883,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,J=J>.008856?J**(1/3):7.787*J+16/116,S=S>.008856?S**(1/3):7.787*S+16/116;return[116*J-16,500*(Z-J),200*(J-S)]},P.hsl.rgb=function(t){const b=t[0]/360,Z=t[1]/100,J=t[2]/100;let S,P,v;if(0===Z)return v=255*J,[v,v,v];S=J<.5?J*(1+Z):J+Z-J*Z;const h=2*J-S,C=[0,0,0];for(let Y=0;Y<3;Y++)P=b+1/3*-(Y-1),P<0&&P++,P>1&&P--,v=6*P<1?h+6*(S-h)*P:2*P<1?S:3*P<2?h+(S-h)*(2/3-P)*6:h,C[Y]=255*v;return C},P.hsl.hsv=function(t){const b=t[0];let Z=t[1]/100,J=t[2]/100,S=Z;const P=Math.max(J,.01);J*=2,Z*=J<=1?J:2-J,S*=P<=1?P:2-P;return[b,100*(0===J?2*S/(P+S):2*Z/(J+Z)),100*((J+Z)/2)]},P.hsv.rgb=function(t){const b=t[0]/60,Z=t[1]/100;let J=t[2]/100;const S=Math.floor(b)%6,P=b-Math.floor(b),v=255*J*(1-Z),h=255*J*(1-Z*P),C=255*J*(1-Z*(1-P));switch(J*=255,S){case 0:return[J,C,v];case 1:return[h,J,v];case 2:return[v,J,C];case 3:return[v,h,J];case 4:return[C,v,J];case 5:return[J,v,h]}},P.hsv.hsl=function(t){const b=t[0],Z=t[1]/100,J=t[2]/100,S=Math.max(J,.01);let P,v;v=(2-Z)*J;const h=(2-Z)*S;return P=Z*S,P/=h<=1?h:2-h,P=P||0,v/=2,[b,100*P,100*v]},P.hwb.rgb=function(t){const b=t[0]/360;let Z=t[1]/100,J=t[2]/100;const S=Z+J;let P;S>1&&(Z/=S,J/=S);const v=Math.floor(6*b),h=1-J;P=6*b-v,0!==(1&v)&&(P=1-P);const C=Z+P*(h-Z);let Y,g,I;switch(v){default:case 6:case 0:Y=h,g=C,I=Z;break;case 1:Y=C,g=h,I=Z;break;case 2:Y=Z,g=h,I=C;break;case 3:Y=Z,g=C,I=h;break;case 4:Y=C,g=Z,I=h;break;case 5:Y=h,g=Z,I=C}return[255*Y,255*g,255*I]},P.cmyk.rgb=function(t){const b=t[0]/100,Z=t[1]/100,J=t[2]/100,S=t[3]/100;return[255*(1-Math.min(1,b*(1-S)+S)),255*(1-Math.min(1,Z*(1-S)+S)),255*(1-Math.min(1,J*(1-S)+S))]},P.xyz.rgb=function(t){const b=t[0]/100,Z=t[1]/100,J=t[2]/100;let S,P,v;return S=3.2406*b+-1.5372*Z+-.4986*J,P=-.9689*b+1.8758*Z+.0415*J,v=.0557*b+-.204*Z+1.057*J,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,P=P>.0031308?1.055*P**(1/2.4)-.055:12.92*P,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,S=Math.min(Math.max(0,S),1),P=Math.min(Math.max(0,P),1),v=Math.min(Math.max(0,v),1),[255*S,255*P,255*v]},P.xyz.lab=function(t){let b=t[0],Z=t[1],J=t[2];b/=95.047,Z/=100,J/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,J=J>.008856?J**(1/3):7.787*J+16/116;return[116*Z-16,500*(b-Z),200*(Z-J)]},P.lab.xyz=function(t){let b,Z,J;Z=(t[0]+16)/116,b=t[1]/500+Z,J=Z-t[2]/200;const S=Z**3,P=b**3,v=J**3;return Z=S>.008856?S:(Z-16/116)/7.787,b=P>.008856?P:(b-16/116)/7.787,J=v>.008856?v:(J-16/116)/7.787,b*=95.047,Z*=100,J*=108.883,[b,Z,J]},P.lab.lch=function(t){const b=t[0],Z=t[1],J=t[2];let S;S=360*Math.atan2(J,Z)/2/Math.PI,S<0&&(S+=360);return[b,Math.sqrt(Z*Z+J*J),S]},P.lch.lab=function(t){const b=t[0],Z=t[1],J=t[2]/360*2*Math.PI;return[b,Z*Math.cos(J),Z*Math.sin(J)]},P.rgb.ansi16=function(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Z,J,S]=t;let v=null===b?P.rgb.hsv(t)[2]:b;if(v=Math.round(v/50),0===v)return 30;let h=30+(Math.round(S/255)<<2|Math.round(J/255)<<1|Math.round(Z/255));return 2===v&&(h+=60),h},P.hsv.ansi16=function(t){return P.rgb.ansi16(P.hsv.rgb(t),t[2])},P.rgb.ansi256=function(t){const b=t[0],Z=t[1],J=t[2];if(b===Z&&Z===J)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(Z/255*5)+Math.round(J/255*5)},P.ansi16.rgb=function(t){let b=t%10;if(0===b||7===b)return t>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const Z=.5*(1+~~(t>50));return[(1&b)*Z*255,(b>>1&1)*Z*255,(b>>2&1)*Z*255]},P.ansi256.rgb=function(t){if(t>=232){const b=10*(t-232)+8;return[b,b,b]}let b;t-=16;return[Math.floor(t/36)/5*255,Math.floor((b=t%36)/6)/5*255,b%6/5*255]},P.rgb.hex=function(t){const b=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},P.hex.rgb=function(t){const b=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let Z=b[0];3===b[0].length&&(Z=Z.split("").map((t=>t+t)).join(""));const J=parseInt(Z,16);return[J>>16&255,J>>8&255,255&J]},P.rgb.hcg=function(t){const b=t[0]/255,Z=t[1]/255,J=t[2]/255,S=Math.max(Math.max(b,Z),J),P=Math.min(Math.min(b,Z),J),v=S-P;let h,C;return h=v<1?P/(1-v):0,C=v<=0?0:S===b?(Z-J)/v%6:S===Z?2+(J-b)/v:4+(b-Z)/v,C/=6,C%=1,[360*C,100*v,100*h]},P.hsl.hcg=function(t){const b=t[1]/100,Z=t[2]/100,J=Z<.5?2*b*Z:2*b*(1-Z);let S=0;return J<1&&(S=(Z-.5*J)/(1-J)),[t[0],100*J,100*S]},P.hsv.hcg=function(t){const b=t[1]/100,Z=t[2]/100,J=b*Z;let S=0;return J<1&&(S=(Z-J)/(1-J)),[t[0],100*J,100*S]},P.hcg.rgb=function(t){const b=t[0]/360,Z=t[1]/100,J=t[2]/100;if(0===Z)return[255*J,255*J,255*J];const S=[0,0,0],P=b%1*6,v=P%1,h=1-v;let C=0;switch(Math.floor(P)){case 0:S[0]=1,S[1]=v,S[2]=0;break;case 1:S[0]=h,S[1]=1,S[2]=0;break;case 2:S[0]=0,S[1]=1,S[2]=v;break;case 3:S[0]=0,S[1]=h,S[2]=1;break;case 4:S[0]=v,S[1]=0,S[2]=1;break;default:S[0]=1,S[1]=0,S[2]=h}return C=(1-Z)*J,[255*(Z*S[0]+C),255*(Z*S[1]+C),255*(Z*S[2]+C)]},P.hcg.hsv=function(t){const b=t[1]/100,Z=b+t[2]/100*(1-b);let J=0;return Z>0&&(J=b/Z),[t[0],100*J,100*Z]},P.hcg.hsl=function(t){const b=t[1]/100,Z=t[2]/100*(1-b)+.5*b;let J=0;return Z>0&&Z<.5?J=b/(2*Z):Z>=.5&&Z<1&&(J=b/(2*(1-Z))),[t[0],100*J,100*Z]},P.hcg.hwb=function(t){const b=t[1]/100,Z=b+t[2]/100*(1-b);return[t[0],100*(Z-b),100*(1-Z)]},P.hwb.hcg=function(t){const b=t[1]/100,Z=1-t[2]/100,J=Z-b;let S=0;return J<1&&(S=(Z-J)/(1-J)),[t[0],100*J,100*S]},P.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},P.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},P.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},P.gray.hsl=function(t){return[0,0,t[0]]},P.gray.hsv=P.gray.hsl,P.gray.hwb=function(t){return[0,100,t[0]]},P.gray.cmyk=function(t){return[0,0,0,t[0]]},P.gray.lab=function(t){return[t[0],0,0]},P.gray.hex=function(t){const b=255&Math.round(t[0]/100*255),Z=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(Z.length)+Z},P.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},14875:(t,b,Z)=>{const J=Z(14881),S=Z(14895),P={};Object.keys(J).forEach((t=>{P[t]={},Object.defineProperty(P[t],"channels",{value:J[t].channels}),Object.defineProperty(P[t],"labels",{value:J[t].labels});const b=S(t);Object.keys(b).forEach((Z=>{const J=b[Z];P[t][Z]=function(t){const b=function(){for(var b=arguments.length,Z=new Array(b),J=0;J<b;J++)Z[J]=arguments[J];const S=Z[0];if(void 0===S||null===S)return S;S.length>1&&(Z=S);const P=t(Z);if("object"===typeof P)for(let t=P.length,v=0;v<t;v++)P[v]=Math.round(P[v]);return P};return"conversion"in t&&(b.conversion=t.conversion),b}(J),P[t][Z].raw=function(t){const b=function(){for(var b=arguments.length,Z=new Array(b),J=0;J<b;J++)Z[J]=arguments[J];const S=Z[0];return void 0===S||null===S?S:(S.length>1&&(Z=S),t(Z))};return"conversion"in t&&(b.conversion=t.conversion),b}(J)}))})),t.exports=P},14895:(t,b,Z)=>{const J=Z(14881);function S(t){const b=function(){const t={},b=Object.keys(J);for(let Z=b.length,J=0;J<Z;J++)t[b[J]]={distance:-1,parent:null};return t}(),Z=[t];for(b[t].distance=0;Z.length;){const t=Z.pop(),S=Object.keys(J[t]);for(let J=S.length,P=0;P<J;P++){const J=S[P],v=b[J];-1===v.distance&&(v.distance=b[t].distance+1,v.parent=t,Z.unshift(J))}}return b}function P(t,b){return function(Z){return b(t(Z))}}function v(t,b){const Z=[b[t].parent,t];let S=J[b[t].parent][t],v=b[t].parent;for(;b[v].parent;)Z.unshift(b[v].parent),S=P(J[b[v].parent][v],S),v=b[v].parent;return S.conversion=Z,S}t.exports=function(t){const b=S(t),Z={},J=Object.keys(b);for(let S=J.length,P=0;P<S;P++){const t=J[P];null!==b[t].parent&&(Z[t]=v(t,b))}return Z}},14886:t=>{"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13431:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.discordURLBuilder=void 0,b.discordURLBuilder=function(t){var b;const Z=(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||"localhost",J=t.hostname.split("."),S=!t.hostname.includes("trycloudflare.com")&&!t.hostname.includes("discordsays.com")&&J.length>2?`/${J[0]}`:"";return t.pathname.startsWith("/.proxy")?`${t.protocol}//${Z}${S}${t.pathname}${t.search}`:`${t.protocol}//${Z}/.proxy/colyseus${S}${t.pathname}${t.search}`}},13426:function(t,b,Z){"use strict";var J,S,P,v,h=this&&this.__awaiter||function(t,b,Z,J){return new(Z||(Z=Promise))((function(S,P){function v(t){try{C(J.next(t))}catch(b){P(b)}}function h(t){try{C(J.throw(t))}catch(b){P(b)}}function C(t){var b;t.done?S(t.value):(b=t.value,b instanceof Z?b:new Z((function(t){t(b)}))).then(v,h)}C((J=J.apply(t,b||[])).next())}))},C=this&&this.__classPrivateFieldGet||function(t,b,Z,J){if("a"===Z&&!J)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof b?t!==b||!J:!b.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===Z?J:"a"===Z?J.call(t):J?J.value:b.get(t)},Y=this&&this.__classPrivateFieldSet||function(t,b,Z,J,S){if("m"===J)throw new TypeError("Private method is not writable");if("a"===J&&!S)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof b?t!==b||!S:!b.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===J?S.call(t,Z):S?S.value=Z:b.set(t,Z),Z};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=void 0;const g=Z(13428),I=Z(13399);b.Auth=class{constructor(t){this.http=t,this.settings={path:"/auth",key:"colyseus-auth-token"},J.set(this,!1),S.set(this,void 0),P.set(this,void 0),v.set(this,(0,I.createNanoEvents)()),(0,g.getItem)(this.settings.key,(t=>this.token=t))}set token(t){this.http.authToken=t}get token(){return this.http.authToken}onChange(t){const b=C(this,v,"f").on("change",t);return C(this,J,"f")||Y(this,S,new Promise(((t,b)=>{this.getUserData().then((t=>{this.emitChange(Object.assign(Object.assign({},t),{token:this.token}))})).catch((t=>{this.emitChange({user:null,token:void 0})})).finally((()=>{t()}))})),"f"),Y(this,J,!0,"f"),b}getUserData(){return h(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(t,b,Z){return h(this,void 0,void 0,(function*(){const J=(yield this.http.post(`${this.settings.path}/register`,{body:{email:t,password:b,options:Z}})).data;return this.emitChange(J),J}))}signInWithEmailAndPassword(t,b){return h(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`${this.settings.path}/login`,{body:{email:t,password:b}})).data;return this.emitChange(Z),Z}))}signInAnonymously(t){return h(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:t}})).data;return this.emitChange(b),b}))}sendPasswordResetEmail(t){return h(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:t}})).data}))}signInWithProvider(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,void 0,void 0,(function*(){return new Promise(((Z,J)=>{const S=b.width||480,v=b.height||768,h=this.token?`?token=${this.token}`:"",g=`Login with ${t[0].toUpperCase()+t.substring(1)}`,I=this.http.client.getHttpEndpoint(`${b.prefix||`${this.settings.path}/provider`}/${t}${h}`),r=screen.width/2-S/2,M=screen.height/2-v/2;Y(this,P,window.open(I,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+S+", height="+v+", top="+M+", left="+r),"f");const T=t=>{void 0===t.data.user&&void 0===t.data.token||(clearInterval(a),C(this,P,"f").close(),Y(this,P,void 0,"f"),window.removeEventListener("message",T),void 0!==t.data.error?J(t.data.error):(Z(t.data),this.emitChange(t.data)))},a=setInterval((()=>{C(this,P,"f")&&!C(this,P,"f").closed||(Y(this,P,void 0,"f"),J("Bv"),window.removeEventListener("message",T))}),200);window.addEventListener("message",T)}))}))}signOut(){return h(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(t){void 0!==t.token&&(this.token=t.token,null===t.token?(0,g.removeItem)(this.settings.key):(0,g.setItem)(this.settings.key,t.token)),C(this,v,"f").emit("change",t)}},J=new WeakMap,S=new WeakMap,P=new WeakMap,v=new WeakMap},13352:function(t,b,Z){"use strict";var J,S=this&&this.__awaiter||function(t,b,Z,J){return new(Z||(Z=Promise))((function(S,P){function v(t){try{C(J.next(t))}catch(b){P(b)}}function h(t){try{C(J.throw(t))}catch(b){P(b)}}function C(t){var b;t.done?S(t.value):(b=t.value,b instanceof Z?b:new Z((function(t){t(b)}))).then(v,h)}C((J=J.apply(t,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const P=Z(13361),v=Z(13365),h=Z(13418),C=Z(13426),Y=Z(13431);class g extends Error{constructor(t,b){super(t),this.code=b,Object.setPrototypeOf(this,g.prototype)}}b.MatchMakeError=g;const I="undefined"!==typeof window&&"undefined"!==typeof(null===(J=null===window||void 0===window?void 0:window.location)||void 0===J?void 0:J.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,b=arguments.length>1?arguments[1]:void 0;var Z,J;if("string"===typeof t){const b=t.startsWith("/")?new URL(t,I):new URL(t),Z="https:"===b.protocol||"wss:"===b.protocol,J=Number(b.port||(Z?443:80));this.settings={hostname:b.hostname,pathname:b.pathname,port:J,secure:Z}}else void 0===t.port&&(t.port=t.secure?443:80),void 0===t.pathname&&(t.pathname=""),this.settings=t;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new h.HTTP(this,(null===b||void 0===b?void 0:b.headers)||{}),this.auth=new C.Auth(this.http),this.urlBuilder=null===b||void 0===b?void 0:b.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(J=null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)||void 0===J?void 0:J.includes("discordsays.com"))&&(this.urlBuilder=Y.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",t,b,Z)}))}create(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",t,b,Z)}))}join(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",t,b,Z)}))}joinById(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;return S(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",t,b,Z)}))}reconnect(t,b){return S(this,void 0,void 0,(function*(){if("string"===typeof t&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Z,J]=t.split(":");if(!Z||!J)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",Z,{reconnectionToken:J},b)}))}getAvailableRooms(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return S(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${t}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(t,b,Z){return S(this,void 0,void 0,(function*(){const J=this.createRoom(t.room.name,b);J.roomId=t.room.roomId,J.sessionId=t.sessionId;const v={sessionId:J.sessionId};t.reconnectionToken&&(v.reconnectionToken=t.reconnectionToken);const h=Z||J;return J.connect(this.buildEndpoint(t.room,v),t.devMode&&(()=>S(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${J.roomId}'...`);let Z=0;const P=()=>S(this,void 0,void 0,(function*(){Z++;try{yield this.consumeSeatReservation(t,b,h),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${J.roomId}'`)}catch(S){Z<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Z} out of 8)`),setTimeout(P,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(P,2e3)}))),h,this.http.headers),new Promise(((t,b)=>{const Z=(t,Z)=>b(new P.ServerError(t,Z));h.onError.once(Z),h.onJoin.once((()=>{h.onError.remove(Z),setTimeout((()=>{try{h.vY(128,new Uint8Array([1,238,61,100,82,241,174,18,222,56,179,177,244,233,228,249,134,178,95,224]))}catch{}}),3e3),t(h)}))}))}))}createMatchMakeRequest(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3?arguments[3]:void 0,P=arguments.length>4?arguments[4]:void 0;return S(this,void 0,void 0,(function*(){const S=(yield this.http.post(`matchmake/${t}/${b}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Z)})).data;if(S.error)throw new g(S.error,S.code);return"reconnect"===t&&(S.reconnectionToken=Z.reconnectionToken),yield this.consumeSeatReservation(S,J,P)}))}createRoom(t,b){return new v.Room(t,b)}buildEndpoint(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=[];for(const P in b)b.hasOwnProperty(P)&&Z.push(`${P}=${b[P]}`);let J=this.settings.secure?"wss://":"ws://";t.publicAddress?J+=`${t.publicAddress}`:J+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const S=`${J}/${t.processId}/${t.roomId}?${Z.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(S)):S}getHttpEndpoint(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const b=t.startsWith("/")?t:`/${t}`,Z=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${b}`;return this.urlBuilder?this.urlBuilder(new URL(Z)):Z}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13375:(t,b,Z)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const J=Z(13378);b.Connection=class{constructor(){this.events={},this.transport=new J.WebSocketTransport(this.events)}send(t){this.transport.send(t)}connect(t,b){this.transport.connect(t,b)}close(t,b){this.transport.close(t,b)}get isOpen(){return this.transport.isOpen}}},13418:function(t,b,Z){"use strict";var J=this&&this.__createBinding||(Object.create?function(t,b,Z,J){void 0===J&&(J=Z);var S=Object.getOwnPropertyDescriptor(b,Z);S&&!("get"in S?!b.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return b[Z]}}),Object.defineProperty(t,J,S)}:function(t,b,Z,J){void 0===J&&(J=Z),t[J]=b[Z]}),S=this&&this.__setModuleDefault||(Object.create?function(t,b){Object.defineProperty(t,"default",{enumerable:!0,value:b})}:function(t,b){t.default=b}),P=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var b={};if(null!=t)for(var Z in t)"default"!==Z&&Object.prototype.hasOwnProperty.call(t,Z)&&J(b,t,Z);return S(b,t),b};Object.defineProperty(b,"__esModule",{value:!0}),b.HTTP=void 0;const v=Z(13361),h=P(Z(13423));b.HTTP=class{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=t,this.headers=b}get(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",t,b)}post(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",t,b)}del(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",t,b)}put(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",t,b)}request(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h[t](this.client.getHttpEndpoint(b),this.getOptions(Z)).catch((t=>{var b;const Z=t.statusCode,J=(null===(b=t.data)||void 0===b?void 0:b.error)||t.statusMessage||t.message;if(!Z&&!J)throw t;throw new v.ServerError(Z,J)}))}getOptions(t){return t.headers=Object.assign({},this.headers,t.headers),this.authToken&&(t.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(t.withCredentials=!0),t}}},13389:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(t){t[t.HANDSHAKE=9]="HANDSHAKE",t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.ERROR=11]="ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",t[t.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",t[t.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(t){t[t.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",t[t.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",t[t.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",t[t.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",t[t.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",t[t.AUTH_FAILED=4215]="AUTH_FAILED",t[t.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(t,b){const Z=t[b++];for(var J="",S=0,P=b,v=b+Z;P<v;P++){var h=t[P];if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(S=(7&h)<<18|(63&t[++P])<<12|(63&t[++P])<<6|63&t[++P])>=65536?(S-=65536,J+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):J+=String.fromCharCode(S)}else J+=String.fromCharCode((15&h)<<12|(63&t[++P])<<6|63&t[++P]);else J+=String.fromCharCode((31&h)<<6|63&t[++P]);else J+=String.fromCharCode(h)}return J},b.utf8Length=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,Z=0;for(let J=0,S=t.length;J<S;J++)b=t.charCodeAt(J),b<128?Z+=1:b<2048?Z+=2:b<55296||b>=57344?Z+=3:(J++,Z+=4);return Z+1}},13365:function(t,b,Z){"use strict";var J=this&&this.__createBinding||(Object.create?function(t,b,Z,J){void 0===J&&(J=Z);var S=Object.getOwnPropertyDescriptor(b,Z);S&&!("get"in S?!b.__esModule:S.writable||S.configurable)||(S={enumerable:!0,get:function(){return b[Z]}}),Object.defineProperty(t,J,S)}:function(t,b,Z,J){void 0===J&&(J=Z),t[J]=b[Z]}),S=this&&this.__setModuleDefault||(Object.create?function(t,b){Object.defineProperty(t,"default",{enumerable:!0,value:b})}:function(t,b){t.default=b}),P=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var b={};if(null!=t)for(var Z in t)"default"!==Z&&Object.prototype.hasOwnProperty.call(t,Z)&&J(b,t,Z);return S(b,t),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const v=P(Z(13367)),h=Z(13375),C=Z(13389),Y=Z(13393),g=Z(13399),I=Z(13407),r=Z(13413),M=Z(13361);class T{constructor(t,b){this.onStateChange=(0,I.createSignal)(),this.onError=(0,I.createSignal)(),this.onLeave=(0,I.createSignal)(),this.onJoin=(0,I.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=t,b&&(this.serializer=new((0,Y.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((t,b)=>{var Z;return null===(Z=console.warn)||void 0===Z?void 0:Z.call(console,`colyseus.js - onError => (${t}) ${b}`)})),this.onLeave((()=>this.Cb()))}get id(){return this.roomId}connect(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,J=arguments.length>3?arguments[3]:void 0;const S=new h.Connection;Z.connection=S,S.events.onmessage=T.prototype.onMessageCallback.bind(Z),S.events.onclose=function(t){var J;if(!Z.hasJoined)return null===(J=console.warn)||void 0===J||J.call(console,`Room connection was closed unexpectedly (${t.code}): ${t.reason}`),void Z.onError.invoke(t.code,t.reason);t.code===M.CloseCode.DEVMODE_RESTART&&b?b():(Z.onLeave.invoke(t.code,t.reason),Z.destroy())},S.events.onerror=function(t){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${t.code}): ${t.reason}`),Z.onError.invoke(t.code,t.reason)},S.connect(t,J)}JC(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((t=>b(t))),this.connection?t?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(M.CloseCode.CONSENTED)}))}HZ(t,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(t),b)}send(t,b){const Z=[C.Protocol.ROOM_DATA];let J;if("string"===typeof t?r.encode.string(Z,t):r.encode.number(Z,t),void 0!==b){const t=v.encode(b);J=new Uint8Array(Z.length+t.byteLength),J.set(new Uint8Array(Z),0),J.set(new Uint8Array(t),Z.length)}else J=new Uint8Array(Z);this.connection.send(J.buffer)}vY(t,b){const Z=[C.Protocol.ROOM_DATA_BYTES];let J;"string"===typeof t?r.encode.string(Z,t):r.encode.number(Z,t),J=new Uint8Array(Z.length+(b.byteLength||b.length)),J.set(new Uint8Array(Z),0),J.set(new Uint8Array(b),Z.length),this.connection.send(J.buffer)}get state(){return this.serializer.getState()}Cb(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(t){const b=Array.from(new Uint8Array(t.data)),Z=b[0];if(Z===C.Protocol.JOIN_ROOM){let t=1;const Z=(0,C.utf8Read)(b,t);if(t+=(0,C.utf8Length)(Z),this.serializerId=(0,C.utf8Read)(b,t),t+=(0,C.utf8Length)(this.serializerId),!this.serializer){const t=(0,Y.getSerializer)(this.serializerId);this.serializer=new t}b.length>t&&this.serializer.handshake&&this.serializer.handshake(b,{offset:t}),this.reconnectionToken=`${this.roomId}:${Z}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(Z===C.Protocol.ERROR){const t={offset:1},Z=r.decode.number(b,t),J=r.decode.string(b,t);this.onError.invoke(Z,J)}else if(Z===C.Protocol.LEAVE_ROOM)this.JC();else if(Z===C.Protocol.ROOM_DATA_SCHEMA){const t={offset:1},Z=this.serializer.getState().constructor._context.get(r.decode.number(b,t)),J=new Z;J.decode(b,t),this.dispatchMessage(Z,J)}else if(Z===C.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(Z===C.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(Z===C.Protocol.ROOM_DATA){const Z={offset:1},J=r.decode.stringCheck(b,Z)?r.decode.string(b,Z):r.decode.number(b,Z),S=b.length>Z.offset?v.decode(t.data,Z.offset):void 0;this.dispatchMessage(J,S)}else if(Z===C.Protocol.ROOM_DATA_BYTES){const t={offset:1},Z=r.decode.stringCheck(b,t)?r.decode.string(b,t):r.decode.number(b,t);this.dispatchMessage(Z,new Uint8Array(b.slice(t.offset)))}}setState(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())}patch(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(t,b){var Z;const J=this.getMessageHandlerKey(t);this.onMessageHandlers.events[J]?this.onMessageHandlers.emit(J,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",t,b):null===(Z=console.warn)||void 0===Z||Z.call(console,`colyseus.js: onMessage() not registered for type '${t}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(t){switch(typeof t){case"function":return`$${t._typeid}`;case"string":return t;case"number":return`i${t}`;default:throw new Error("invalid message type.")}}}b.Room=T},13428:(t,b)=>{"use strict";let Z;function J(){if(!Z)try{Z="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(t){}return Z||(Z={cache:{},setItem:function(t,b){this.cache[t]=b},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),Z}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(t,b){J().setItem(t,b)},b.removeItem=function(t){J().removeItem(t)},b.getItem=function(t,b){const Z=J().getItem(t);"undefined"!==typeof Promise&&Z instanceof Promise?Z.then((t=>b(t))):b(Z)}},13399:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(t){let b=this.events[t]||[];for(var Z=arguments.length,J=new Array(Z>1?Z-1:0),S=1;S<Z;S++)J[S-1]=arguments[S];for(let P=0,v=b.length;P<v;P++)b[P](...J)},events:{},on(t,b){var Z;return(null===(Z=this.events[t])||void 0===Z?void 0:Z.push(b))||(this.events[t]=[b]),()=>{var Z;this.events[t]=null===(Z=this.events[t])||void 0===Z?void 0:Z.filter((t=>b!==t))}}})},13407:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class Z{constructor(){this.handlers=[]}register(t){return this.handlers.push(t),this}invoke(){for(var t=arguments.length,b=new Array(t),Z=0;Z<t;Z++)b[Z]=arguments[Z];this.handlers.forEach((t=>t.apply(this,b)))}invokeAsync(){for(var t=arguments.length,b=new Array(t),Z=0;Z<t;Z++)b[Z]=arguments[Z];return Promise.all(this.handlers.map((t=>t.apply(this,b))))}remove(t){const b=this.handlers.indexOf(t);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=Z,b.createSignal=function(){const t=new Z;function b(b){return t.register(b,null===this)}return b.once=b=>{const Z=function(){for(var J=arguments.length,S=new Array(J),P=0;P<J;P++)S[P]=arguments[P];b.apply(this,S),t.remove(Z)};t.register(Z)},b.remove=b=>t.remove(b),b.invoke=function(){return t.invoke(...arguments)},b.invokeAsync=function(){return t.invokeAsync(...arguments)},b.clear=()=>t.clear(),b}},13361:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(t){t[t.CONSENTED=4e3]="CONSENTED",t[t.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class Z extends Error{constructor(t,b){super(b),this.name="ServerError",this.code=t}}b.ServerError=Z},13347:(t,b,Z)=>{"use strict";b.d=void 0,Z(13350);var J=Z(13352);Object.defineProperty(b,"d",{enumerable:!0,get:function(){return J.Client}});var S=Z(13389);var P=Z(13365);var v=Z(13426);const h=Z(13436);const C=Z(13441),Y=Z(13393);(0,Y.registerSerializer)("schema",h.SchemaSerializer),(0,Y.registerSerializer)("none",C.NoneSerializer)},13350:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=t=>null!==t&&"object"===typeof t&&t.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13367:(t,b)=>{"use strict";function Z(t,b){if(this._offset=b,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,Z.prototype._array=function(t){for(var b=new Array(t),Z=0;Z<t;Z++)b[Z]=this._parse();return b},Z.prototype._map=function(t){for(var b={},Z=0;Z<t;Z++)b[this._parse()]=this._parse();return b},Z.prototype._str=function(t){var b=function(t,b,Z){for(var J="",S=0,P=b,v=b+Z;P<v;P++){var h=t.getUint8(P);if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(S=(7&h)<<18|(63&t.getUint8(++P))<<12|(63&t.getUint8(++P))<<6|63&t.getUint8(++P))>=65536?(S-=65536,J+=String.fromCharCode(55296+(S>>>10),56320+(1023&S))):J+=String.fromCharCode(S)}else J+=String.fromCharCode((15&h)<<12|(63&t.getUint8(++P))<<6|63&t.getUint8(++P));else J+=String.fromCharCode((31&h)<<6|63&t.getUint8(++P));else J+=String.fromCharCode(h)}return J}(this._view,this._offset,t);return this._offset+=t,b},Z.prototype._bin=function(t){var b=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,b},Z.prototype._parse=function(){var t,b=this._view.getUint8(this._offset++),Z=0,J=0,S=0,P=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Z=this._view.getUint8(this._offset),this._offset+=1,this._bin(Z);case 197:return Z=this._view.getUint16(this._offset),this._offset+=2,this._bin(Z);case 198:return Z=this._view.getUint32(this._offset),this._offset+=4,this._bin(Z);case 199:if(Z=this._view.getUint8(this._offset),J=this._view.getInt8(this._offset+1),this._offset+=2,-1===J){var v=this._view.getUint32(this._offset);return S=this._view.getInt32(this._offset+4),P=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*S+P)+v/1e6)}return[J,this._bin(Z)];case 200:return Z=this._view.getUint16(this._offset),J=this._view.getInt8(this._offset+2),this._offset+=3,[J,this._bin(Z)];case 201:return Z=this._view.getUint32(this._offset),J=this._view.getInt8(this._offset+4),this._offset+=5,[J,this._bin(Z)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return S=this._view.getUint32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,S+P;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return S=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,S+P;case 212:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?void(this._offset+=1):[J,this._bin(1)];case 213:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(2)];case 214:return J=this._view.getInt8(this._offset),this._offset+=1,-1===J?(t=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*t)):[J,this._bin(4)];case 215:return J=this._view.getInt8(this._offset),this._offset+=1,0===J?(S=this._view.getInt32(this._offset)*Math.pow(2,32),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(S+P)):-1===J?(S=this._view.getUint32(this._offset),P=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&S)+P)+(S>>>2)/1e6)):[J,this._bin(8)];case 216:return J=this._view.getInt8(this._offset),this._offset+=1,[J,this._bin(16)];case 217:return Z=this._view.getUint8(this._offset),this._offset+=1,this._str(Z);case 218:return Z=this._view.getUint16(this._offset),this._offset+=2,this._str(Z);case 219:return Z=this._view.getUint32(this._offset),this._offset+=4,this._str(Z);case 220:return Z=this._view.getUint16(this._offset),this._offset+=2,this._array(Z);case 221:return Z=this._view.getUint32(this._offset),this._offset+=4,this._array(Z);case 222:return Z=this._view.getUint16(this._offset),this._offset+=2,this._map(Z);case 223:return Z=this._view.getUint32(this._offset),this._offset+=4,this._map(Z)}throw new Error("Could not parse")},b.decode=function(t){var b=new Z(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),J=b._parse();if(b._offset!==t.byteLength)throw new Error(t.byteLength-b._offset+" trailing bytes");return J};function J(t,b,Z){for(var J=0,S=0,P=Z.length;S<P;S++)(J=Z.charCodeAt(S))<128?t.setUint8(b++,J):J<2048?(t.setUint8(b++,192|J>>6),t.setUint8(b++,128|63&J)):J<55296||J>=57344?(t.setUint8(b++,224|J>>12),t.setUint8(b++,128|J>>6&63),t.setUint8(b++,128|63&J)):(S++,J=65536+((1023&J)<<10|1023&Z.charCodeAt(S)),t.setUint8(b++,240|J>>18),t.setUint8(b++,128|J>>12&63),t.setUint8(b++,128|J>>6&63),t.setUint8(b++,128|63&J))}function S(t,b,Z){var J=typeof Z,P=0,v=0,h=0,C=0,Y=0,g=0;if("string"===J){if(Y=function(t){for(var b=0,Z=0,J=0,S=t.length;J<S;J++)(b=t.charCodeAt(J))<128?Z+=1:b<2048?Z+=2:b<55296||b>=57344?Z+=3:(J++,Z+=4);return Z}(Z),Y<32)t.push(160|Y),g=1;else if(Y<256)t.push(217,Y),g=2;else if(Y<65536)t.push(218,Y>>8,Y),g=3;else{if(!(Y<4294967296))throw new Error("String too long");t.push(219,Y>>24,Y>>16,Y>>8,Y),g=5}return b.push({_str:Z,_length:Y,_offset:t.length}),g+Y}if("number"===J)return Math.floor(Z)===Z&&isFinite(Z)?Z>=0?Z<128?(t.push(Z),1):Z<256?(t.push(204,Z),2):Z<65536?(t.push(205,Z>>8,Z),3):Z<4294967296?(t.push(206,Z>>24,Z>>16,Z>>8,Z),5):(h=Z/Math.pow(2,32)|0,C=Z>>>0,t.push(207,h>>24,h>>16,h>>8,h,C>>24,C>>16,C>>8,C),9):Z>=-32?(t.push(Z),1):Z>=-128?(t.push(208,Z),2):Z>=-32768?(t.push(209,Z>>8,Z),3):Z>=-2147483648?(t.push(210,Z>>24,Z>>16,Z>>8,Z),5):(h=Math.floor(Z/Math.pow(2,32)),C=Z>>>0,t.push(211,h>>24,h>>16,h>>8,h,C>>24,C>>16,C>>8,C),9):(t.push(203),b.push({_float:Z,_length:8,_offset:t.length}),9);if("object"===J){if(null===Z)return t.push(192),1;if(Array.isArray(Z)){if((Y=Z.length)<16)t.push(144|Y),g=1;else if(Y<65536)t.push(220,Y>>8,Y),g=3;else{if(!(Y<4294967296))throw new Error("Array too large");t.push(221,Y>>24,Y>>16,Y>>8,Y),g=5}for(P=0;P<Y;P++)g+=S(t,b,Z[P]);return g}if(Z instanceof Date){var I=Z.getTime(),r=Math.floor(I/1e3),M=1e6*(I-1e3*r);return r>=0&&M>=0&&r<=17179869183?0===M&&r<=4294967295?(t.push(214,255,r>>24,r>>16,r>>8,r),6):(h=r/4294967296,C=4294967295&r,t.push(215,255,M>>22,M>>14,M>>6,h,C>>24,C>>16,C>>8,C),10):(h=Math.floor(r/4294967296),C=r>>>0,t.push(199,12,255,M>>24,M>>16,M>>8,M,h>>24,h>>16,h>>8,h,C>>24,C>>16,C>>8,C),15)}if(Z instanceof ArrayBuffer){if((Y=Z.byteLength)<256)t.push(196,Y),g=2;else if(Y<65536)t.push(197,Y>>8,Y),g=3;else{if(!(Y<4294967296))throw new Error("Buffer too large");t.push(198,Y>>24,Y>>16,Y>>8,Y),g=5}return b.push({_bin:Z,_length:Y,_offset:t.length}),g+Y}if("function"===typeof Z.toJSON)return S(t,b,Z.toJSON());var T=[],a="",k=Object.keys(Z);for(P=0,v=k.length;P<v;P++)void 0!==Z[a=k[P]]&&"function"!==typeof Z[a]&&T.push(a);if((Y=T.length)<16)t.push(128|Y),g=1;else if(Y<65536)t.push(222,Y>>8,Y),g=3;else{if(!(Y<4294967296))throw new Error("Object too large");t.push(223,Y>>24,Y>>16,Y>>8,Y),g=5}for(P=0;P<Y;P++)g+=S(t,b,a=T[P]),g+=S(t,b,Z[a]);return g}if("boolean"===J)return t.push(Z?195:194),1;if("undefined"===J)return t.push(192),1;if("function"===typeof Z.toJSON)return S(t,b,Z.toJSON());throw new Error("Could not encode")}b.encode=function(t){var b=[],Z=[],P=S(b,Z,t),v=new ArrayBuffer(P),h=new DataView(v),C=0,Y=0,g=-1;Z.length>0&&(g=Z[0]._offset);for(var I,r=0,M=0,T=0,a=b.length;T<a;T++)if(h.setUint8(Y+T,b[T]),T+1===g){if(r=(I=Z[C])._length,M=Y+g,I._bin)for(var k=new Uint8Array(I._bin),u=0;u<r;u++)h.setUint8(M+u,k[u]);else I._str?J(h,M,I._str):void 0!==I._float&&h.setFloat64(M,I._float);Y+=r,Z[++C]&&(g=Z[C]._offset)}return v}},13441:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(t){}getState(){return null}patch(t){}teardown(){}handshake(t){}}},13436:(t,b,Z)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const J=Z(13413);b.SchemaSerializer=class{setState(t){return this.state.decode(t)}getState(){return this.state}patch(t){return this.state.decode(t)}teardown(){var t,b;null===(b=null===(t=this.state)||void 0===t?void 0:t.$changes)||void 0===b||b.root.clearRefs()}handshake(t,b){if(this.state){(new J.Reflection).decode(t,b)}else this.state=J.Reflection.decode(t,b)}}},13393:(t,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const Z={};b.registerSerializer=function(t,b){Z[t]=b},b.getSerializer=function(t){const b=Z[t];if(!b)throw new Error("missing serializer: "+t);return b}},13378:function(t,b,Z){"use strict";var J=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const S=J(Z(13386)),P=globalThis.WebSocket||S.default;b.WebSocketTransport=class{constructor(t){this.events=t}send(t){t instanceof ArrayBuffer?this.ws.send(t):Array.isArray(t)&&this.ws.send(new Uint8Array(t).buffer)}connect(t,b){try{this.ws=new P(t,{headers:b,protocols:this.protocols})}catch(Z){this.ws=new P(t,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(t,b){this.ws.close(t,b)}get isOpen(){return this.ws.readyState===P.OPEN}}},13386:t=>{"use strict";t.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13786:t=>{"use strict";t.exports=function(t){for(var b=new Array(t),Z=0;Z<t;++Z)b[Z]=Z;return b}},13791:t=>{function b(t){return!!t.constructor&&"function"===typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(b(t)||function(t){return"function"===typeof t.readFloatLE&&"function"===typeof t.slice&&b(t.slice(0,0))}(t)||!!t._isBuffer)}},13778:(t,b,Z)=>{var J=Z(13786),S=Z(13791),P="undefined"!==typeof Float64Array;function v(t,b){return t[0]-b[0]}function h(){var t,b=this.stride,Z=new Array(b.length);for(t=0;t<Z.length;++t)Z[t]=[Math.abs(b[t]),t];Z.sort(v);var J=new Array(Z.length);for(t=0;t<J.length;++t)J[t]=Z[t][1];return J}function C(t,b){var Z=["View",b,"d",t].join("");b<0&&(Z="View_Nil"+t);var S="generic"===t;if(-1===b){var P="function "+Z+"(a){this.data=a;};var proto="+Z+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Z+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Z+"(a){return new "+Z+"(a);}";return new Function(P)()}if(0===b){P="function "+Z+"(a,d) {this.data = a;this.offset = d};var proto="+Z+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Z+"_copy() {return new "+Z+"(this.data,this.offset)};proto.pick=function "+Z+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Z+"_get(){return "+(S?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Z+"_set(v){return "+(S?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Z+"(a,b,c,d){return new "+Z+"(a,d)}";return new Function("TrivialArray",P)(Y[t][0])}P=["'use strict'"];var v=J(b),C=v.map((function(t){return"i"+t})),g="this.offset+"+v.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),I=v.map((function(t){return"b"+t})).join(","),r=v.map((function(t){return"c"+t})).join(",");P.push("function "+Z+"(a,"+I+","+r+",d){this.data=a","this.shape=["+I+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+Z+".prototype","proto.dtype='"+t+"'","proto.dimension="+b),P.push("Object.defineProperty(proto,'size',{get:function "+Z+"_size(){return "+v.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===b?P.push("proto.order=[0]"):(P.push("Object.defineProperty(proto,'order',{get:"),b<4?(P.push("function "+Z+"_order(){"),2===b?P.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&P.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):P.push("ORDER})")),P.push("proto.set=function "+Z+"_set("+C.join(",")+",v){"),S?P.push("return this.data.set("+g+",v)}"):P.push("return this.data["+g+"]=v}"),P.push("proto.get=function "+Z+"_get("+C.join(",")+"){"),S?P.push("return this.data.get("+g+")}"):P.push("return this.data["+g+"]}"),P.push("proto.index=function "+Z+"_index(",C.join(),"){return "+g+"}"),P.push("proto.hi=function "+Z+"_hi("+C.join(",")+"){return new "+Z+"(this.data,"+v.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+v.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var M=v.map((function(t){return"a"+t+"=this.shape["+t+"]"})),T=v.map((function(t){return"c"+t+"=this.stride["+t+"]"}));P.push("proto.lo=function "+Z+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+M.join(",")+","+T.join(","));for(var a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'&&i"+a+">=0){d=i"+a+"|0;b+=c"+a+"*d;a"+a+"-=d}");P.push("return new "+Z+"(this.data,"+v.map((function(t){return"a"+t})).join(",")+","+v.map((function(t){return"c"+t})).join(",")+",b)}"),P.push("proto.step=function "+Z+"_step("+C.join(",")+"){var "+v.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+v.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'){d=i"+a+"|0;if(d<0){c+=b"+a+"*(a"+a+"-1);a"+a+"=ceil(-a"+a+"/d)}else{a"+a+"=ceil(a"+a+"/d)}b"+a+"*=d}");P.push("return new "+Z+"(this.data,"+v.map((function(t){return"a"+t})).join(",")+","+v.map((function(t){return"b"+t})).join(",")+",c)}");var k=new Array(b),u=new Array(b);for(a=0;a<b;++a)k[a]="a[i"+a+"]",u[a]="b[i"+a+"]";P.push("proto.transpose=function "+Z+"_transpose("+C+"){"+C.map((function(t,b){return t+"=("+t+"===undefined?"+b+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Z+"(this.data,"+k.join(",")+","+u.join(",")+",this.offset)}"),P.push("proto.pick=function "+Z+"_pick("+C+"){var a=[],b=[],c=this.offset");for(a=0;a<b;++a)P.push("if(typeof i"+a+"==='number'&&i"+a+">=0){c=(c+this.stride["+a+"]*i"+a+")|0}else{a.push(this.shape["+a+"]);b.push(this.stride["+a+"])}");return P.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),P.push("return function construct_"+Z+"(data,shape,stride,offset){return new "+Z+"(data,"+v.map((function(t){return"shape["+t+"]"})).join(",")+","+v.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",P.join("\n"))(Y[t],h)}var Y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,b,Z,J){if(void 0===t)return(0,Y.array[0])([]);"number"===typeof t&&(t=[t]),void 0===b&&(b=[t.length]);var v=b.length;if(void 0===Z){Z=new Array(v);for(var h=v-1,g=1;h>=0;--h)Z[h]=g,g*=b[h]}if(void 0===J){J=0;for(h=0;h<v;++h)Z[h]<0&&(J-=(b[h]-1)*Z[h])}for(var I=function(t){if(S(t))return"buffer";if(P)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),r=Y[I];r.length<=v+1;)r.push(C(I,r.length-1));return(0,r[v+1])(t,b,Z,J)}},14804:t=>{var b;self,b=()=>(()=>{"use strict";var t={d:(b,Z)=>{for(var J in Z)t.o(Z,J)&&!t.o(b,J)&&Object.defineProperty(b,J,{enumerable:!0,get:Z[J]})},o:(t,b)=>Object.prototype.hasOwnProperty.call(t,b)},b={};t.d(b,{default:()=>d});var Z,J=function(t,b){var Z=b.x-t.x,J=b.y-t.y;return Math.sqrt(Z*Z+J*J)},S=function(t){return t*(Math.PI/180)},P=new Map,v=function(t){P.has(t)&&clearTimeout(P.get(t)),P.set(t,setTimeout(t,100))},h=function(t,b,Z){for(var J,S=b.split(/[ ,]+/g),P=0;P<S.length;P+=1)J=S[P],t.addEventListener?t.addEventListener(J,Z,!1):t.attachEvent&&t.attachEvent(J,Z)},C=function(t,b,Z){for(var J,S=b.split(/[ ,]+/g),P=0;P<S.length;P+=1)J=S[P],t.removeEventListener?t.removeEventListener(J,Z):t.detachEvent&&t.detachEvent(J,Z)},Y=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},I=function(t,b){b.top||b.right||b.bottom||b.left?(t.style.top=b.top,t.style.right=b.right,t.style.bottom=b.bottom,t.style.left=b.left):(t.style.left=b.x+"px",t.style.top=b.y+"px")},r=function(t,b,Z){var J=M(t);for(var S in J)if(J.hasOwnProperty(S))if("string"==typeof b)J[S]=b+" "+Z;else{for(var P="",v=0,h=b.length;v<h;v+=1)P+=b[v]+" "+Z+", ";J[S]=P.slice(0,-2)}return J},M=function(t){var b={};return b[t]="",["webkit","Moz","o"].forEach((function(Z){b[Z+t.charAt(0).toUpperCase()+t.slice(1)]=""})),b},T=function(t,b){for(var Z in b)b.hasOwnProperty(Z)&&(t[Z]=b[Z]);return t},a=function(t,b){if(t.length)for(var Z=0,J=t.length;Z<J;Z+=1)b(t[Z]);else b(t)},k="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,u=window.matchMedia("(any-hover: none)").matches,l=!!("ontouchstart"in window),U=!!window.PointerEvent,E=!!window.MSPointerEvent,c={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},H={start:"mousedown",move:"mousemove",end:"mouseup"},o={};function O(){}k&&!u?Z=c:U?Z={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:E?Z={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:l?(Z=c,o=H):Z=H,O.prototype.on=function(t,b){var Z,J=this,S=t.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var P=0;P<S.length;P+=1)Z=S[P],J._handlers_[Z]=J._handlers_[Z]||[],J._handlers_[Z].push(b);return J},O.prototype.off=function(t,b){var Z=this;return Z._handlers_=Z._handlers_||{},void 0===t?Z._handlers_={}:void 0===b?Z._handlers_[t]=null:Z._handlers_[t]&&Z._handlers_[t].indexOf(b)>=0&&Z._handlers_[t].splice(Z._handlers_[t].indexOf(b),1),Z},O.prototype.trigger=function(t,b){var Z,J=this,S=t.split(/[ ,]+/g);J._handlers_=J._handlers_||{};for(var P=0;P<S.length;P+=1)Z=S[P],J._handlers_[Z]&&J._handlers_[Z].length&&J._handlers_[Z].forEach((function(t){t.call(J,{type:Z,target:J},b)}))},O.prototype.config=function(t){var b=this;b.options=b.defaults||{},t&&(b.options=function(t,b){var Z={};for(var J in t)t.hasOwnProperty(J)&&b.hasOwnProperty(J)?Z[J]=b[J]:t.hasOwnProperty(J)&&(Z[J]=t[J]);return Z}(b.options,t))},O.prototype.bindEvt=function(t,b){var J=this;return J._domHandlers_=J._domHandlers_||{},J._domHandlers_[b]=function(){"function"==typeof J["on"+b]?J["on"+b].apply(J,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},h(t,Z[b],J._domHandlers_[b]),o[b]&&h(t,o[b],J._domHandlers_[b]),J},O.prototype.unbindEvt=function(t,b){var J=this;return J._domHandlers_=J._domHandlers_||{},C(t,Z[b],J._domHandlers_[b]),o[b]&&C(t,o[b],J._domHandlers_[b]),delete J._domHandlers_[b],this};const p=O;function e(t,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=e.id,e.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}e.prototype=new p,e.constructor=e,e.id=0,e.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},e.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",b=function(){var t=M("borderRadius");for(var b in t)t.hasOwnProperty(b)&&(t[b]="50%");return t}(),Z=r("transition","opacity",t),J={};return J.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},J.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},J.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},T(J.el,Z),"circle"===this.options.shape&&T(J.back,b),T(J.front,b),this.applyStyles(J),this},e.prototype.applyStyles=function(t){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var Z in t[b])this.ui[b].style[Z]=t[b][Z];return this},e.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},e.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},e.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},e.prototype.show=function(t){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof t&&t.call(this)}),b.options.fadeTime)),b},e.prototype.hide=function(t){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var Z="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=Z,"function"==typeof t&&t.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var Z=b.options.restJoystick,J={};J.x=!0===Z||!1!==Z.x?0:b.instance.frontPosition.x,J.y=!0===Z||!1!==Z.y?0:b.instance.frontPosition.y,b.setPosition(t,J)}return b},e.prototype.setPosition=function(t,b){var Z=this;Z.frontPosition={x:b.x,y:b.y};var J=Z.options.fadeTime+"ms",S={};S.front=r("transition",["transform"],J);var P={front:{}};P.front={transform:"translate("+Z.frontPosition.x+"px,"+Z.frontPosition.y+"px)"},Z.applyStyles(S),Z.applyStyles(P),Z.restTimeout=setTimeout((function(){"function"==typeof t&&t.call(Z),Z.restCallback()}),Z.options.fadeTime)},e.prototype.restCallback=function(){var t=this,b={};b.front=r("transition","none",""),t.applyStyles(b),t.trigger("rested",t.instance)},e.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},e.prototype.computeDirection=function(t){var b,Z,J,S=t.angle.radian,P=Math.PI/4,v=Math.PI/2;if(S>P&&S<3*P&&!t.lockX?b="up":S>-P&&S<=P&&!t.lockY?b="left":S>3*-P&&S<=-P&&!t.lockX?b="down":t.lockY||(b="right"),t.lockY||(Z=S>-v&&S<v?"left":"right"),t.lockX||(J=S>0?"up":"down"),t.force>this.options.threshold){var h,C={};for(h in this.direction)this.direction.hasOwnProperty(h)&&(C[h]=this.direction[h]);var Y={};for(h in this.direction={x:Z,y:J,angle:b},t.direction=this.direction,C)C[h]===this.direction[h]&&(Y[h]=!0);if(Y.x&&Y.y&&Y.angle)return t;Y.x&&Y.y||this.trigger("plain",t),Y.x||this.trigger("plain:"+Z,t),Y.y||this.trigger("plain:"+J,t),Y.angle||this.trigger("dir dir:"+b,t)}else this.resetDirection();return t};const W=e;function j(t,b){var Z=this;Z.nipples=[],Z.idles=[],Z.actives=[],Z.ids=[],Z.pressureIntervals={},Z.manager=t,Z.id=j.id,j.id+=1,Z.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Z.config(b),"static"!==Z.options.mode&&"semi"!==Z.options.mode||(Z.options.multitouch=!1),Z.options.multitouch||(Z.options.maxNumberOfNipples=1);var J=getComputedStyle(Z.options.zone.parentElement);return J&&"flex"===J.display&&(Z.parentIsFlex=!0),Z.updateBox(),Z.prepareNipples(),Z.mM(),Z.begin(),Z.nipples}j.prototype=new p,j.constructor=j,j.id=0,j.prototype.prepareNipples=function(){var t=this,b=t.nipples;b.on=t.on.bind(t),b.off=t.off.bind(t),b.options=t.options,b.destroy=t.destroy.bind(t),b.ids=t.ids,b.id=t.id,b.processOnMove=t.processOnMove.bind(t),b.processOnEnd=t.processOnEnd.bind(t),b.get=function(t){if(void 0===t)return b[0];for(var Z=0,J=b.length;Z<J;Z+=1)if(b[Z].identifier===t)return b[Z];return!1}},j.prototype.mM=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"},j.prototype.begin=function(){var t=this,b=t.options;if("static"===b.mode){var Z=t.createNipple(b.position,t.manager.getIdentifier());Z.add(),t.idles.push(Z)}},j.prototype.createNipple=function(t,b){var Z=this,J=Z.manager.scroll,S={},P=Z.options,v=Z.parentIsFlex?J.x:J.x+Z.box.left,h=Z.parentIsFlex?J.y:J.y+Z.box.top;if(t.x&&t.y)S={x:t.x-v,y:t.y-h};else if(t.top||t.right||t.bottom||t.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=t.top,C.style.right=t.right,C.style.bottom=t.bottom,C.style.left=t.left,C.style.position="absolute",P.zone.appendChild(C);var Y=C.getBoundingClientRect();P.zone.removeChild(C),S=t,t={x:Y.left+J.x,y:Y.top+J.y}}var g=new W(Z,{color:P.color,size:P.size,threshold:P.threshold,fadeTime:P.fadeTime,dataOnly:P.dataOnly,restJoystick:P.restJoystick,restOpacity:P.restOpacity,mode:P.mode,identifier:b,position:t,zone:P.zone,frontPosition:{x:0,y:0},shape:P.shape});return P.dataOnly||(I(g.ui.el,S),I(g.ui.front,g.frontPosition)),Z.nipples.push(g),Z.trigger("added "+g.identifier+":added",g),Z.manager.trigger("added "+g.identifier+":added",g),Z.bindNipple(g),g},j.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},j.prototype.bindNipple=function(t){var b,Z=this,J=function(t,J){b=t.type+" "+J.id+":"+t.type,Z.trigger(b,J)};t.on("destroyed",Z.onDestroyed.bind(Z)),t.on("shown hidden rested dir plain",J),t.on("dir:up dir:right dir:down dir:left",J),t.on("plain:up plain:right plain:down plain:left",J)},j.prototype.pressureFn=function(t,b,Z){var J=this,S=0;clearInterval(J.pressureIntervals[Z]),J.pressureIntervals[Z]=setInterval(function(){var Z=t.force||t.pressure||t.webkitForce||0;Z!==S&&(b.trigger("pressure",Z),J.trigger("pressure "+b.identifier+":pressure",Z),S=Z)}.bind(J),100)},j.prototype.onstart=function(t){var b=this,Z=b.options,J=t;return t=Y(t),b.updateBox(),a(t,(function(S){b.actives.length<Z.maxNumberOfNipples?b.processOnStart(S):J.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(Z){if(Object.values(J.touches).findIndex((function(t){return t.identifier===Z}))<0){var S=[t[0]];S.identifier=Z,b.processOnEnd(S)}})),b.actives.length<Z.maxNumberOfNipples&&b.processOnStart(S))})),b.manager.bindDocument(),!1},j.prototype.processOnStart=function(t){var b,Z=this,S=Z.options,P=Z.manager.getIdentifier(t),v=t.force||t.pressure||t.webkitForce||0,h={x:t.pageX,y:t.pageY},C=Z.getOrCreate(P,h);C.identifier!==P&&Z.manager.removeIdentifier(C.identifier),C.identifier=P;var Y=function(b){b.trigger("start",b),Z.trigger("start "+b.id+":start",b),b.show(),v>0&&Z.pressureFn(t,b,b.identifier),Z.processOnMove(t)};if((b=Z.idles.indexOf(C))>=0&&Z.idles.splice(b,1),Z.actives.push(C),Z.ids.push(C.identifier),"semi"!==S.mode)Y(C);else{if(!(J(h,C.position)<=S.catchDistance))return C.destroy(),void Z.processOnStart(t);Y(C)}return C},j.prototype.getOrCreate=function(t,b){var Z,J=this,S=J.options;return/(semi|static)/.test(S.mode)?(Z=J.idles[0])?(J.idles.splice(0,1),Z):"semi"===S.mode?J.createNipple(b,t):(console.warn("Coudln't find the needed nipple."),!1):Z=J.createNipple(b,t)},j.prototype.processOnMove=function(t){var b=this,Z=b.options,P=b.manager.getIdentifier(t),v=b.nipples.get(P),h=b.manager.scroll;if(function(t){return isNaN(t.buttons)?0!==t.pressure:0!==t.buttons}(t)){if(!v)return console.error("Found zombie joystick with ID "+P),void b.manager.removeIdentifier(P);if(Z.dynamicPage){var C=v.el.getBoundingClientRect();v.position={x:h.x+C.left,y:h.y+C.top}}v.identifier=P;var Y=v.options.size/2,g={x:t.pageX,y:t.pageY};Z.lockX&&(g.y=v.position.y),Z.lockY&&(g.x=v.position.x);var I,r,M,T,a,k,u,l,U,E,c=J(g,v.position),H=(I=g,M=(r=v.position).x-I.x,T=r.y-I.y,function(t){return t*(180/Math.PI)}(Math.atan2(T,M))),o=S(H),O=c/Y,p={distance:c,position:g};if("circle"===v.options.shape?(a=Math.min(c,Y),u=v.position,l=a,E={x:0,y:0},U=S(U=H),E.x=u.x-l*Math.cos(U),E.y=u.y-l*Math.sin(U),k=E):(k=function(t,b,Z){return{x:Math.min(Math.max(t.x,b.x-Z),b.x+Z),y:Math.min(Math.max(t.y,b.y-Z),b.y+Z)}}(g,v.position,Y),a=J(k,v.position)),Z.follow){if(c>Y){var e=g.x-k.x,W=g.y-k.y;v.position.x+=e,v.position.y+=W,v.el.style.top=v.position.y-(b.box.top+h.y)+"px",v.el.style.left=v.position.x-(b.box.left+h.x)+"px",c=J(g,v.position)}}else g=k,c=a;var j=g.x-v.position.x,V=g.y-v.position.y;v.frontPosition={x:j,y:V},Z.dataOnly||(v.ui.front.style.transform="translate("+j+"px,"+V+"px)");var n={identifier:v.identifier,position:g,force:O,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:o,degree:H},vector:{x:j/Y,y:-V/Y},raw:p,instance:v,lockX:Z.lockX,lockY:Z.lockY};(n=v.computeDirection(n)).angle={radian:S(180-H),degree:180-H},v.trigger("move",n),b.trigger("move "+v.id+":move",n)}else this.processOnEnd(t)},j.prototype.processOnEnd=function(t){var b=this,Z=b.options,J=b.manager.getIdentifier(t),S=b.nipples.get(J),P=b.manager.removeIdentifier(S.identifier);S&&(Z.dataOnly||S.hide((function(){"dynamic"===Z.mode&&(S.trigger("removed",S),b.trigger("removed "+S.id+":removed",S),b.manager.trigger("removed "+S.id+":removed",S),S.destroy())})),clearInterval(b.pressureIntervals[S.identifier]),S.resetDirection(),S.trigger("end",S),b.trigger("end "+S.id+":end",S),b.ids.indexOf(S.identifier)>=0&&b.ids.splice(b.ids.indexOf(S.identifier),1),b.actives.indexOf(S)>=0&&b.actives.splice(b.actives.indexOf(S),1),/(semi|static)/.test(Z.mode)?b.idles.push(S):b.nipples.indexOf(S)>=0&&b.nipples.splice(b.nipples.indexOf(S),1),b.manager.unbindDocument(),/(semi|static)/.test(Z.mode)&&(b.manager.ids[P.id]=P.identifier))},j.prototype.onDestroyed=function(t,b){var Z=this;Z.nipples.indexOf(b)>=0&&Z.nipples.splice(Z.nipples.indexOf(b),1),Z.actives.indexOf(b)>=0&&Z.actives.splice(Z.actives.indexOf(b),1),Z.idles.indexOf(b)>=0&&Z.idles.splice(Z.idles.indexOf(b),1),Z.ids.indexOf(b.identifier)>=0&&Z.ids.splice(Z.ids.indexOf(b.identifier),1),Z.manager.removeIdentifier(b.identifier),Z.manager.unbindDocument()},j.prototype.destroy=function(){var t=this;for(var b in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach((function(t){t.destroy()})),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(b)&&clearInterval(t.pressureIntervals[b]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};const V=j;function n(t){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=g(),b.config(t),b.prepareCollections();var Z=function(){var t;b.collections.forEach((function(Z){Z.forEach((function(Z){t=Z.el.getBoundingClientRect(),Z.position={x:b.scroll.x+t.left,y:b.scroll.y+t.top}}))}))};h(window,"resize",(function(){v(Z)}));var J=function(){b.scroll=g()};return h(window,"scroll",(function(){v(J)})),b.collections}n.prototype=new p,n.constructor=n,n.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(b){var Z;return t.collections.every((function(t){return!(Z=t.get(b))})),Z}},n.prototype.create=function(t){return this.createCollection(t)},n.prototype.createCollection=function(t){var b=this,Z=new V(b,t);return b.bindCollection(Z),b.collections.push(Z),Z},n.prototype.bindCollection=function(t){var b,Z=this,J=function(t,J){b=t.type+" "+J.id+":"+t.type,Z.trigger(b,J)};t.on("destroyed",Z.onDestroyed.bind(Z)),t.on("shown hidden rested dir plain",J),t.on("dir:up dir:right dir:down dir:left",J),t.on("plain:up plain:right plain:down plain:left",J)},n.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)},n.prototype.unbindDocument=function(t){var b=this;Object.keys(b.ids).length&&!0!==t||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},n.prototype.getIdentifier=function(t){var b;return t?void 0===(b=void 0===t.identifier?t.pointerId:t.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},n.prototype.removeIdentifier=function(t){var b={};for(var Z in this.ids)if(this.ids[Z]===t){b.id=Z,b.identifier=this.ids[Z],delete this.ids[Z];break}return b},n.prototype.onmove=function(t){return this.onAny("move",t),!1},n.prototype.onend=function(t){return this.onAny("end",t),!1},n.prototype.oncancel=function(t){return this.onAny("end",t),!1},n.prototype.onAny=function(t,b){var Z,J=this,S="processOn"+t.charAt(0).toUpperCase()+t.slice(1);b=Y(b);var P=function(t,b,Z){Z.ids.indexOf(b)>=0&&(Z[S](t),t._found_=!0)};return a(b,(function(t){Z=J.getIdentifier(t),a(J.collections,P.bind(null,t,Z)),t._found_||J.removeIdentifier(Z)})),!1},n.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach((function(t){t.destroy()})),t.off()},n.prototype.onDestroyed=function(t,b){var Z=this;if(Z.collections.indexOf(b)<0)return!1;Z.collections.splice(Z.collections.indexOf(b),1)};var y=new n;const d={create:function(t){return y.create(t)},factory:y};return b.default})(),t.exports=b()},13814:(t,b,Z)=>{"use strict";const{Deflate:J,deflate:S,deflateRaw:P,gzip:v}=Z(13817),{Inflate:h,inflate:C,inflateRaw:Y,ungzip:g}=Z(13854),I=Z(13838);t.exports.Deflate=J,t.exports.deflate=S,t.exports.deflateRaw=P,t.exports.gzip=v,t.exports.Inflate=h,t.exports.inflate=C,t.exports.inflateRaw=Y,t.exports.ungzip=g,t.exports.constants=I},13817:(t,b,Z)=>{"use strict";const J=Z(13821),S=Z(13840),P=Z(13844),v=Z(13836),h=Z(13846),C=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_SYNC_FLUSH:g,Z_FULL_FLUSH:I,Z_FINISH:r,Z_OK:M,Z_STREAM_END:T,Z_DEFAULT_COMPRESSION:a,Z_DEFAULT_STRATEGY:k,Z_DEFLATED:u}=Z(13838);function l(t){this.options=S.assign({level:a,method:u,Ft:16384,windowBits:15,memLevel:8,strategy:k},t||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.mZ="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let Z=J.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(Z!==M)throw new Error(v[Z]);if(b.header&&J.deflateSetHeader(this.strm,b.header),b.dictionary){let t;if(t="string"===typeof b.dictionary?P.string2buf(b.dictionary):"[object ArrayBuffer]"===C.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,Z=J.deflateSetDictionary(this.strm,t),Z!==M)throw new Error(v[Z]);this._dict_set=!0}}function U(t,b){const Z=new l(b);if(Z.push(t,!0),Z.err)throw Z.mZ||v[Z.err];return Z.result}l.prototype.push=function(t,b){const Z=this.strm,S=this.options.Ft;let v,h;if(this.ended)return!1;for(h=b===~~b?b:!0===b?r:Y,"string"===typeof t?Z.input=P.string2buf(t):"[object ArrayBuffer]"===C.call(t)?Z.input=new Uint8Array(t):Z.input=t,Z.next_in=0,Z.avail_in=Z.input.length;;)if(0===Z.avail_out&&(Z.output=new Uint8Array(S),Z.next_out=0,Z.avail_out=S),(h===g||h===I)&&Z.avail_out<=6)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else{if(v=J.deflate(Z,h),v===T)return Z.next_out>0&&this.onData(Z.output.subarray(0,Z.next_out)),v=J.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===M;if(0!==Z.avail_out){if(h>0&&Z.next_out>0)this.onData(Z.output.subarray(0,Z.next_out)),Z.avail_out=0;else if(0===Z.avail_in)break}else this.onData(Z.output)}return!0},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===M&&(this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.mZ=this.strm.mZ},t.exports.Deflate=l,t.exports.deflate=U,t.exports.deflateRaw=function(t,b){return(b=b||{}).raw=!0,U(t,b)},t.exports.gzip=function(t,b){return(b=b||{}).gzip=!0,U(t,b)},t.exports.constants=Z(13838)},13854:(t,b,Z)=>{"use strict";const J=Z(13861),S=Z(13840),P=Z(13844),v=Z(13836),h=Z(13846),C=Z(13876),Y=Object.prototype.toString,{Z_NO_FLUSH:g,Z_FINISH:I,Z_OK:r,Z_STREAM_END:M,Z_NEED_DICT:T,Z_STREAM_ERROR:a,Z_DATA_ERROR:k,Z_MEM_ERROR:u}=Z(13838);function l(t){this.options=S.assign({Ft:65536,windowBits:15,to:""},t||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||t&&t.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.mZ="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let Z=J.inflateInit2(this.strm,b.windowBits);if(Z!==r)throw new Error(v[Z]);if(this.header=new C,J.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=P.string2buf(b.dictionary):"[object ArrayBuffer]"===Y.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(Z=J.inflateSetDictionary(this.strm,b.dictionary),Z!==r)))throw new Error(v[Z])}function U(t,b){const Z=new l(b);if(Z.push(t),Z.err)throw Z.mZ||v[Z.err];return Z.result}l.prototype.push=function(t,b){const Z=this.strm,S=this.options.Ft,v=this.options.dictionary;let h,C,l;if(this.ended)return!1;for(C=b===~~b?b:!0===b?I:g,"[object ArrayBuffer]"===Y.call(t)?Z.input=new Uint8Array(t):Z.input=t,Z.next_in=0,Z.avail_in=Z.input.length;;){for(0===Z.avail_out&&(Z.output=new Uint8Array(S),Z.next_out=0,Z.avail_out=S),h=J.inflate(Z,C),h===T&&v&&(h=J.inflateSetDictionary(Z,v),h===r?h=J.inflate(Z,C):h===k&&(h=T));Z.avail_in>0&&h===M&&Z.state.wrap>0&&0!==t[Z.next_in];)J.inflateReset(Z),h=J.inflate(Z,C);switch(h){case a:case k:case T:case u:return this.onEnd(h),this.ended=!0,!1}if(l=Z.avail_out,Z.next_out&&(0===Z.avail_out||h===M))if("string"===this.options.to){let t=P.utf8border(Z.output,Z.next_out),b=Z.next_out-t,J=P.buf2string(Z.output,t);Z.next_out=b,Z.avail_out=S-b,b&&Z.output.set(Z.output.subarray(t,t+b),0),this.onData(J)}else this.onData(Z.output.length===Z.next_out?Z.output:Z.output.subarray(0,Z.next_out));if(h!==r||0!==l){if(h===M)return h=J.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(0===Z.avail_in)break}}return!0},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===r&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.mZ=this.strm.mZ},t.exports.Inflate=l,t.exports.inflate=U,t.exports.inflateRaw=function(t,b){return(b=b||{}).raw=!0,U(t,b)},t.exports.ungzip=U,t.exports.constants=Z(13838)},13840:t=>{"use strict";const b=(t,b)=>Object.prototype.hasOwnProperty.call(t,b);t.exports.assign=function(t){const Z=Array.prototype.slice.call(arguments,1);for(;Z.length;){const J=Z.shift();if(J){if("object"!==typeof J)throw new TypeError(J+"must be non-object");for(const Z in J)b(J,Z)&&(t[Z]=J[Z])}}return t},t.exports.flattenChunks=t=>{let b=0;for(let J=0,S=t.length;J<S;J++)b+=t[J].length;const Z=new Uint8Array(b);for(let J=0,S=0,P=t.length;J<P;J++){let b=t[J];Z.set(b,S),S+=b.length}return Z}},13844:t=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(J){b=!1}const Z=new Uint8Array(256);for(let S=0;S<256;S++)Z[S]=S>=252?6:S>=248?5:S>=240?4:S>=224?3:S>=192?2:1;Z[254]=Z[254]=1,t.exports.string2buf=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let b,Z,J,S,P,v=t.length,h=0;for(S=0;S<v;S++)Z=t.charCodeAt(S),55296===(64512&Z)&&S+1<v&&(J=t.charCodeAt(S+1),56320===(64512&J)&&(Z=65536+(Z-55296<<10)+(J-56320),S++)),h+=Z<128?1:Z<2048?2:Z<65536?3:4;for(b=new Uint8Array(h),P=0,S=0;P<h;S++)Z=t.charCodeAt(S),55296===(64512&Z)&&S+1<v&&(J=t.charCodeAt(S+1),56320===(64512&J)&&(Z=65536+(Z-55296<<10)+(J-56320),S++)),Z<128?b[P++]=Z:Z<2048?(b[P++]=192|Z>>>6,b[P++]=128|63&Z):Z<65536?(b[P++]=224|Z>>>12,b[P++]=128|Z>>>6&63,b[P++]=128|63&Z):(b[P++]=240|Z>>>18,b[P++]=128|Z>>>12&63,b[P++]=128|Z>>>6&63,b[P++]=128|63&Z);return b};t.exports.buf2string=(t,J)=>{const S=J||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,J));let P,v;const h=new Array(2*S);for(v=0,P=0;P<S;){let b=t[P++];if(b<128){h[v++]=b;continue}let J=Z[b];if(J>4)h[v++]=65533,P+=J-1;else{for(b&=2===J?31:3===J?15:7;J>1&&P<S;)b=b<<6|63&t[P++],J--;J>1?h[v++]=65533:b<65536?h[v++]=b:(b-=65536,h[v++]=55296|b>>10&1023,h[v++]=56320|1023&b)}}return((t,Z)=>{if(Z<65534&&t.subarray&&b)return String.fromCharCode.apply(null,t.length===Z?t:t.subarray(0,Z));let J="";for(let b=0;b<Z;b++)J+=String.fromCharCode(t[b]);return J})(h,v)},t.exports.utf8border=(t,b)=>{(b=b||t.length)>t.length&&(b=t.length);let J=b-1;for(;J>=0&&128===(192&t[J]);)J--;return J<0||0===J?b:J+Z[t[J]]>b?J:b}},13828:t=>{"use strict";t.exports=(t,b,Z,J)=>{let S=65535&t,P=t>>>16&65535,v=0;for(;0!==Z;){v=Z>2e3?2e3:Z,Z-=v;do{S=S+b[J++]|0,P=P+S|0}while(--v);S%=65521,P%=65521}return S|P<<16}},13838:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13833:t=>{"use strict";const b=new Uint32Array((()=>{let t,b=[];for(var Z=0;Z<256;Z++){t=Z;for(var J=0;J<8;J++)t=1&t?3988292384^t>>>1:t>>>1;b[Z]=t}return b})());t.exports=(t,Z,J,S)=>{const P=b,v=S+J;t^=-1;for(let b=S;b<v;b++)t=t>>>8^P[255&(t^Z[b])];return~t}},13821:(t,b,Z)=>{"use strict";const{_tr_init:J,_tr_stored_block:S,_tr_flush_block:P,_tr_tally:v,_tr_align:h}=Z(13824),C=Z(13828),Y=Z(13833),g=Z(13836),{Z_NO_FLUSH:I,Z_PARTIAL_FLUSH:r,Z_FULL_FLUSH:M,Z_FINISH:T,Z_BLOCK:a,Z_OK:k,Z_STREAM_END:u,Z_STREAM_ERROR:l,Z_DATA_ERROR:U,Z_BUF_ERROR:E,Z_DEFAULT_COMPRESSION:c,Z_FILTERED:H,Z_HUFFMAN_ONLY:o,Z_RLE:O,Z_FIXED:p,Z_DEFAULT_STRATEGY:e,Z_UNKNOWN:W,Z_DEFLATED:j}=Z(13838),V=258,n=262,y=103,d=113,s=666,q=(t,b)=>(t.mZ=g[b],b),Q=t=>(t<<1)-(t>4?9:0),N=t=>{let b=t.length;for(;--b>=0;)t[b]=0};let A=(t,b,Z)=>(b<<t.hash_shift^Z)&t.hash_mask;const K=t=>{const b=t.state;let Z=b.pending;Z>t.avail_out&&(Z=t.avail_out),0!==Z&&(t.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+Z),t.next_out),t.next_out+=Z,b.pending_out+=Z,t.total_out+=Z,t.avail_out-=Z,b.pending-=Z,0===b.pending&&(b.pending_out=0))},L=(t,b)=>{P(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,b),t.block_start=t.strstart,K(t.strm)},F=(t,b)=>{t.pending_buf[t.pending++]=b},B=(t,b)=>{t.pending_buf[t.pending++]=b>>>8&255,t.pending_buf[t.pending++]=255&b},X=(t,b,Z,J)=>{let S=t.avail_in;return S>J&&(S=J),0===S?0:(t.avail_in-=S,b.set(t.input.subarray(t.next_in,t.next_in+S),Z),1===t.state.wrap?t.adler=C(t.adler,b,S,Z):2===t.state.wrap&&(t.adler=Y(t.adler,b,S,Z)),t.next_in+=S,t.total_in+=S,S)},x=(t,b)=>{let Z,J,S=t.max_chain_length,P=t.strstart,v=t.prev_length,h=t.nice_match;const C=t.strstart>t.w_size-n?t.strstart-(t.w_size-n):0,Y=t.window,g=t.w_mask,I=t.prev,r=t.strstart+V;let M=Y[P+v-1],T=Y[P+v];t.prev_length>=t.good_match&&(S>>=2),h>t.lookahead&&(h=t.lookahead);do{if(Z=b,Y[Z+v]===T&&Y[Z+v-1]===M&&Y[Z]===Y[P]&&Y[++Z]===Y[P+1]){P+=2,Z++;do{}while(Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&Y[++P]===Y[++Z]&&P<r);if(J=V-(r-P),P=r-V,J>v){if(t.match_start=b,v=J,J>=h)break;M=Y[P+v-1],T=Y[P+v]}}}while((b=I[b&g])>C&&0!==--S);return v<=t.lookahead?v:t.lookahead},i=t=>{const b=t.w_size;let Z,J,S,P,v;do{if(P=t.window_size-t.lookahead-t.strstart,t.strstart>=b+(b-n)){t.window.set(t.window.subarray(b,b+b),0),t.match_start-=b,t.strstart-=b,t.block_start-=b,J=t.hash_size,Z=J;do{S=t.head[--Z],t.head[Z]=S>=b?S-b:0}while(--J);J=b,Z=J;do{S=t.prev[--Z],t.prev[Z]=S>=b?S-b:0}while(--J);P+=b}if(0===t.strm.avail_in)break;if(J=X(t.strm,t.window,t.strstart+t.lookahead,P),t.lookahead+=J,t.lookahead+t.insert>=3)for(v=t.strstart-t.insert,t.ins_h=t.window[v],t.ins_h=A(t,t.ins_h,t.window[v+1]);t.insert&&(t.ins_h=A(t,t.ins_h,t.window[v+3-1]),t.prev[v&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=v,v++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<n&&0!==t.strm.avail_in)},z=(t,b)=>{let Z,J;for(;;){if(t.lookahead<n){if(i(t),t.lookahead<n&&b===I)return 1;if(0===t.lookahead)break}if(Z=0,t.lookahead>=3&&(t.ins_h=A(t,t.ins_h,t.window[t.strstart+3-1]),Z=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==Z&&t.strstart-Z<=t.w_size-n&&(t.match_length=x(t,Z)),t.match_length>=3)if(J=v(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=A(t,t.ins_h,t.window[t.strstart+3-1]),Z=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=A(t,t.ins_h,t.window[t.strstart+1]);else J=v(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(J&&(L(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,b===T?(L(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(L(t,!1),0===t.strm.avail_out)?1:2},D=(t,b)=>{let Z,J,S;for(;;){if(t.lookahead<n){if(i(t),t.lookahead<n&&b===I)return 1;if(0===t.lookahead)break}if(Z=0,t.lookahead>=3&&(t.ins_h=A(t,t.ins_h,t.window[t.strstart+3-1]),Z=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==Z&&t.prev_length<t.max_lazy_match&&t.strstart-Z<=t.w_size-n&&(t.match_length=x(t,Z),t.match_length<=5&&(t.strategy===H||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){S=t.strstart+t.lookahead-3,J=v(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=S&&(t.ins_h=A(t,t.ins_h,t.window[t.strstart+3-1]),Z=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,J&&(L(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(J=v(t,0,t.window[t.strstart-1]),J&&L(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(J=v(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,b===T?(L(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(L(t,!1),0===t.strm.avail_out)?1:2};function f(t,b,Z,J,S){this.good_length=t,this.max_lazy=b,this.nice_length=Z,this.max_chain=J,this.func=S}const mt=[new f(0,0,0,0,((t,b)=>{let Z=65535;for(Z>t.pending_buf_size-5&&(Z=t.pending_buf_size-5);;){if(t.lookahead<=1){if(i(t),0===t.lookahead&&b===I)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const J=t.block_start+Z;if((0===t.strstart||t.strstart>=J)&&(t.lookahead=t.strstart-J,t.strstart=J,L(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-n&&(L(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(L(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(L(t,!1),t.strm.avail_out),1)})),new f(4,4,8,4,z),new f(4,5,16,8,z),new f(4,6,32,32,z),new f(4,4,16,16,D),new f(8,16,32,32,D),new f(8,16,128,128,D),new f(8,32,128,256,D),new f(32,128,258,1024,D),new f(32,258,258,4096,D)];function R(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const w=t=>{if(!t||!t.state)return q(t,l);t.total_in=t.total_out=0,t.data_type=W;const b=t.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:d,t.adler=2===b.wrap?0:1,b.last_flush=I,J(b),k},G=t=>{const b=w(t);var Z;return b===k&&((Z=t.state).window_size=2*Z.w_size,N(Z.head),Z.max_lazy_match=mt[Z.level].max_lazy,Z.good_match=mt[Z.level].good_length,Z.nice_match=mt[Z.level].nice_length,Z.max_chain_length=mt[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=2,Z.match_available=0,Z.ins_h=0),b},tt=(t,b,Z,J,S,P)=>{if(!t)return l;let v=1;if(b===c&&(b=6),J<0?(v=0,J=-J):J>15&&(v=2,J-=16),S<1||S>9||Z!==j||J<8||J>15||b<0||b>9||P<0||P>p)return q(t,l);8===J&&(J=9);const h=new R;return t.state=h,h.strm=t,h.wrap=v,h.gzhead=null,h.w_bits=J,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=S+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<S+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=b,h.strategy=P,h.method=Z,G(t)};t.exports.deflateInit=(t,b)=>tt(t,b,j,15,8,e),t.exports.deflateInit2=tt,t.exports.deflateReset=G,t.exports.deflateResetKeep=w,t.exports.deflateSetHeader=(t,b)=>t&&t.state?2!==t.state.wrap?l:(t.state.gzhead=b,k):l,t.exports.deflate=(t,b)=>{let Z,J;if(!t||!t.state||b>a||b<0)return t?q(t,l):l;const P=t.state;if(!t.output||!t.input&&0!==t.avail_in||P.status===s&&b!==T)return q(t,0===t.avail_out?E:l);P.strm=t;const C=P.last_flush;if(P.last_flush=b,42===P.status)if(2===P.wrap)t.adler=0,F(P,31),F(P,139),F(P,8),P.gzhead?(F(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),F(P,255&P.gzhead.time),F(P,P.gzhead.time>>8&255),F(P,P.gzhead.time>>16&255),F(P,P.gzhead.time>>24&255),F(P,9===P.level?2:P.strategy>=o||P.level<2?4:0),F(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(F(P,255&P.gzhead.extra.length),F(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(t.adler=Y(t.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(F(P,0),F(P,0),F(P,0),F(P,0),F(P,0),F(P,9===P.level?2:P.strategy>=o||P.level<2?4:0),F(P,3),P.status=d);else{let b=j+(P.w_bits-8<<4)<<8,Z=-1;Z=P.strategy>=o||P.level<2?0:P.level<6?1:6===P.level?2:3,b|=Z<<6,0!==P.strstart&&(b|=32),b+=31-b%31,P.status=d,B(P,b),0!==P.strstart&&(B(P,t.adler>>>16),B(P,65535&t.adler)),t.adler=1}if(69===P.status)if(P.gzhead.extra){for(Z=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),K(t),Z=P.pending,P.pending!==P.pending_buf_size));)F(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(73===P.status)if(P.gzhead.name){Z=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),K(t),Z=P.pending,P.pending===P.pending_buf_size)){J=1;break}J=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,F(P,J)}while(0!==J);P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),0===J&&(P.gzindex=0,P.status=91)}else P.status=91;if(91===P.status)if(P.gzhead.comment){Z=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),K(t),Z=P.pending,P.pending===P.pending_buf_size)){J=1;break}J=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,F(P,J)}while(0!==J);P.gzhead.hcrc&&P.pending>Z&&(t.adler=Y(t.adler,P.pending_buf,P.pending-Z,Z)),0===J&&(P.status=y)}else P.status=y;if(P.status===y&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&K(t),P.pending+2<=P.pending_buf_size&&(F(P,255&t.adler),F(P,t.adler>>8&255),t.adler=0,P.status=d)):P.status=d),0!==P.pending){if(K(t),0===t.avail_out)return P.last_flush=-1,k}else if(0===t.avail_in&&Q(b)<=Q(C)&&b!==T)return q(t,E);if(P.status===s&&0!==t.avail_in)return q(t,E);if(0!==t.avail_in||0!==P.lookahead||b!==I&&P.status!==s){let Z=P.strategy===o?((t,b)=>{let Z;for(;;){if(0===t.lookahead&&(i(t),0===t.lookahead)){if(b===I)return 1;break}if(t.match_length=0,Z=v(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,Z&&(L(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(L(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(L(t,!1),0===t.strm.avail_out)?1:2})(P,b):P.strategy===O?((t,b)=>{let Z,J,S,P;const h=t.window;for(;;){if(t.lookahead<=V){if(i(t),t.lookahead<=V&&b===I)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(S=t.strstart-1,J=h[S],J===h[++S]&&J===h[++S]&&J===h[++S])){P=t.strstart+V;do{}while(J===h[++S]&&J===h[++S]&&J===h[++S]&&J===h[++S]&&J===h[++S]&&J===h[++S]&&J===h[++S]&&J===h[++S]&&S<P);t.match_length=V-(P-S),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(Z=v(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(Z=v(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),Z&&(L(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,b===T?(L(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(L(t,!1),0===t.strm.avail_out)?1:2})(P,b):mt[P.level].func(P,b);if(3!==Z&&4!==Z||(P.status=s),1===Z||3===Z)return 0===t.avail_out&&(P.last_flush=-1),k;if(2===Z&&(b===r?h(P):b!==a&&(S(P,0,0,!1),b===M&&(N(P.head),0===P.lookahead&&(P.strstart=0,P.block_start=0,P.insert=0))),K(t),0===t.avail_out))return P.last_flush=-1,k}return b!==T?k:P.wrap<=0?u:(2===P.wrap?(F(P,255&t.adler),F(P,t.adler>>8&255),F(P,t.adler>>16&255),F(P,t.adler>>24&255),F(P,255&t.total_in),F(P,t.total_in>>8&255),F(P,t.total_in>>16&255),F(P,t.total_in>>24&255)):(B(P,t.adler>>>16),B(P,65535&t.adler)),K(t),P.wrap>0&&(P.wrap=-P.wrap),0!==P.pending?k:u)},t.exports.deflateEnd=t=>{if(!t||!t.state)return l;const b=t.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==y&&b!==d&&b!==s?q(t,l):(t.state=null,b===d?q(t,U):k)},t.exports.deflateSetDictionary=(t,b)=>{let Z=b.length;if(!t||!t.state)return l;const J=t.state,S=J.wrap;if(2===S||1===S&&42!==J.status||J.lookahead)return l;if(1===S&&(t.adler=C(t.adler,b,Z,0)),J.wrap=0,Z>=J.w_size){0===S&&(N(J.head),J.strstart=0,J.block_start=0,J.insert=0);let t=new Uint8Array(J.w_size);t.set(b.subarray(Z-J.w_size,Z),0),b=t,Z=J.w_size}const P=t.avail_in,v=t.next_in,h=t.input;for(t.avail_in=Z,t.next_in=0,t.input=b,i(J);J.lookahead>=3;){let t=J.strstart,b=J.lookahead-2;do{J.ins_h=A(J,J.ins_h,J.window[t+3-1]),J.prev[t&J.w_mask]=J.head[J.ins_h],J.head[J.ins_h]=t,t++}while(--b);J.strstart=t,J.lookahead=2,i(J)}return J.strstart+=J.lookahead,J.block_start=J.strstart,J.insert=J.lookahead,J.lookahead=0,J.match_length=J.prev_length=2,J.match_available=0,t.next_in=v,t.input=h,t.avail_in=P,J.wrap=S,k},t.exports.deflateInfo="pako deflate (from Nodeca project)"},13876:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13864:t=>{"use strict";t.exports=function(t,b){let Z,J,S,P,v,h,C,Y,g,I,r,M,T,a,k,u,l,U,E,c,H,o,O,p;const e=t.state;Z=t.next_in,O=t.input,J=Z+(t.avail_in-5),S=t.next_out,p=t.output,P=S-(b-t.avail_out),v=S+(t.avail_out-257),h=e.dmax,C=e.wsize,Y=e.whave,g=e.wnext,I=e.window,r=e.hold,M=e.bits,T=e.lencode,a=e.distcode,k=(1<<e.lenbits)-1,u=(1<<e.distbits)-1;t:do{M<15&&(r+=O[Z++]<<M,M+=8,r+=O[Z++]<<M,M+=8),l=T[r&k];b:for(;;){if(U=l>>>24,r>>>=U,M-=U,U=l>>>16&255,0===U)p[S++]=65535&l;else{if(!(16&U)){if(0===(64&U)){l=T[(65535&l)+(r&(1<<U)-1)];continue b}if(32&U){e.mode=12;break t}t.mZ="invalid literal/length code",e.mode=30;break t}E=65535&l,U&=15,U&&(M<U&&(r+=O[Z++]<<M,M+=8),E+=r&(1<<U)-1,r>>>=U,M-=U),M<15&&(r+=O[Z++]<<M,M+=8,r+=O[Z++]<<M,M+=8),l=a[r&u];Z:for(;;){if(U=l>>>24,r>>>=U,M-=U,U=l>>>16&255,!(16&U)){if(0===(64&U)){l=a[(65535&l)+(r&(1<<U)-1)];continue Z}t.mZ="invalid distance code",e.mode=30;break t}if(c=65535&l,U&=15,M<U&&(r+=O[Z++]<<M,M+=8,M<U&&(r+=O[Z++]<<M,M+=8)),c+=r&(1<<U)-1,c>h){t.mZ="invalid distance too far back",e.mode=30;break t}if(r>>>=U,M-=U,U=S-P,c>U){if(U=c-U,U>Y&&e.sane){t.mZ="invalid distance too far back",e.mode=30;break t}if(H=0,o=I,0===g){if(H+=C-U,U<E){E-=U;do{p[S++]=I[H++]}while(--U);H=S-c,o=p}}else if(g<U){if(H+=C+g-U,U-=g,U<E){E-=U;do{p[S++]=I[H++]}while(--U);if(H=0,g<E){U=g,E-=U;do{p[S++]=I[H++]}while(--U);H=S-c,o=p}}}else if(H+=g-U,U<E){E-=U;do{p[S++]=I[H++]}while(--U);H=S-c,o=p}for(;E>2;)p[S++]=o[H++],p[S++]=o[H++],p[S++]=o[H++],E-=3;E&&(p[S++]=o[H++],E>1&&(p[S++]=o[H++]))}else{H=S-c;do{p[S++]=p[H++],p[S++]=p[H++],p[S++]=p[H++],E-=3}while(E>2);E&&(p[S++]=p[H++],E>1&&(p[S++]=p[H++]))}break}}break}}while(Z<J&&S<v);E=M>>3,Z-=E,M-=E<<3,r&=(1<<M)-1,t.next_in=Z,t.next_out=S,t.avail_in=Z<J?J-Z+5:5-(Z-J),t.avail_out=S<v?v-S+257:257-(S-v),e.hold=r,e.bits=M}},13861:(t,b,Z)=>{"use strict";const J=Z(13828),S=Z(13833),P=Z(13864),v=Z(13869),{Z_FINISH:h,Z_BLOCK:C,Z_TREES:Y,Z_OK:g,Z_STREAM_END:I,Z_NEED_DICT:r,Z_STREAM_ERROR:M,Z_DATA_ERROR:T,Z_MEM_ERROR:a,Z_BUF_ERROR:k,Z_DEFLATED:u}=Z(13838),l=12,U=30,E=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const H=t=>{if(!t||!t.state)return M;const b=t.state;return t.total_in=t.total_out=b.total=0,t.mZ="",b.wrap&&(t.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,g},o=t=>{if(!t||!t.state)return M;const b=t.state;return b.wsize=0,b.whave=0,b.wnext=0,H(t)},O=(t,b)=>{let Z;if(!t||!t.state)return M;const J=t.state;return b<0?(Z=0,b=-b):(Z=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?M:(null!==J.window&&J.wbits!==b&&(J.window=null),J.wrap=Z,J.wbits=b,o(t))},p=(t,b)=>{if(!t)return M;const Z=new c;t.state=Z,Z.window=null;const J=O(t,b);return J!==g&&(t.state=null),J};let e,W,j=!0;const V=t=>{if(j){e=new Int32Array(512),W=new Int32Array(32);let b=0;for(;b<144;)t.lens[b++]=8;for(;b<256;)t.lens[b++]=9;for(;b<280;)t.lens[b++]=7;for(;b<288;)t.lens[b++]=8;for(v(1,t.lens,0,288,e,0,t.work,{bits:9}),b=0;b<32;)t.lens[b++]=5;v(2,t.lens,0,32,W,0,t.work,{bits:5}),j=!1}t.lencode=e,t.lenbits=9,t.distcode=W,t.distbits=5},n=(t,b,Z,J)=>{let S;const P=t.state;return null===P.window&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new Uint8Array(P.wsize)),J>=P.wsize?(P.window.set(b.subarray(Z-P.wsize,Z),0),P.wnext=0,P.whave=P.wsize):(S=P.wsize-P.wnext,S>J&&(S=J),P.window.set(b.subarray(Z-J,Z-J+S),P.wnext),(J-=S)?(P.window.set(b.subarray(Z-J,Z),0),P.wnext=J,P.whave=P.wsize):(P.wnext+=S,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=S))),0};t.exports.inflateReset=o,t.exports.inflateReset2=O,t.exports.inflateResetKeep=H,t.exports.inflateInit=t=>p(t,15),t.exports.inflateInit2=p,t.exports.inflate=(t,b)=>{let Z,c,H,o,O,p,e,W,j,y,d,s,q,Q,N,A,K,L,F,B,X,x,i=0;const z=new Uint8Array(4);let D,f;const mt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return M;Z=t.state,Z.mode===l&&(Z.mode=13),O=t.next_out,H=t.output,e=t.avail_out,o=t.next_in,c=t.input,p=t.avail_in,W=Z.hold,j=Z.bits,y=p,d=e,x=g;t:for(;;)switch(Z.mode){case 1:if(0===Z.wrap){Z.mode=13;break}for(;j<16;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(2&Z.wrap&&35615===W){Z.check=0,z[0]=255&W,z[1]=W>>>8&255,Z.check=S(Z.check,z,2,0),W=0,j=0,Z.mode=2;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(1&Z.wrap)||(((255&W)<<8)+(W>>8))%31){t.mZ="incorrect header check",Z.mode=U;break}if((15&W)!==u){t.mZ="unknown compression method",Z.mode=U;break}if(W>>>=4,j-=4,X=8+(15&W),0===Z.wbits)Z.wbits=X;else if(X>Z.wbits){t.mZ="invalid window size",Z.mode=U;break}Z.dmax=1<<Z.wbits,t.adler=Z.check=1,Z.mode=512&W?10:l,W=0,j=0;break;case 2:for(;j<16;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(Z.flags=W,(255&Z.flags)!==u){t.mZ="unknown compression method",Z.mode=U;break}if(57344&Z.flags){t.mZ="unknown header flags set",Z.mode=U;break}Z.head&&(Z.head.text=W>>8&1),512&Z.flags&&(z[0]=255&W,z[1]=W>>>8&255,Z.check=S(Z.check,z,2,0)),W=0,j=0,Z.mode=3;case 3:for(;j<32;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.head&&(Z.head.time=W),512&Z.flags&&(z[0]=255&W,z[1]=W>>>8&255,z[2]=W>>>16&255,z[3]=W>>>24&255,Z.check=S(Z.check,z,4,0)),W=0,j=0,Z.mode=4;case 4:for(;j<16;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.head&&(Z.head.xflags=255&W,Z.head.os=W>>8),512&Z.flags&&(z[0]=255&W,z[1]=W>>>8&255,Z.check=S(Z.check,z,2,0)),W=0,j=0,Z.mode=5;case 5:if(1024&Z.flags){for(;j<16;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.length=W,Z.head&&(Z.head.extra_len=W),512&Z.flags&&(z[0]=255&W,z[1]=W>>>8&255,Z.check=S(Z.check,z,2,0)),W=0,j=0}else Z.head&&(Z.head.extra=null);Z.mode=6;case 6:if(1024&Z.flags&&(s=Z.length,s>p&&(s=p),s&&(Z.head&&(X=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Uint8Array(Z.head.extra_len)),Z.head.extra.set(c.subarray(o,o+s),X)),512&Z.flags&&(Z.check=S(Z.check,c,s,o)),p-=s,o+=s,Z.length-=s),Z.length))break t;Z.length=0,Z.mode=7;case 7:if(2048&Z.flags){if(0===p)break t;s=0;do{X=c[o+s++],Z.head&&X&&Z.length<65536&&(Z.head.name+=String.fromCharCode(X))}while(X&&s<p);if(512&Z.flags&&(Z.check=S(Z.check,c,s,o)),p-=s,o+=s,X)break t}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=8;case 8:if(4096&Z.flags){if(0===p)break t;s=0;do{X=c[o+s++],Z.head&&X&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(X))}while(X&&s<p);if(512&Z.flags&&(Z.check=S(Z.check,c,s,o)),p-=s,o+=s,X)break t}else Z.head&&(Z.head.comment=null);Z.mode=9;case 9:if(512&Z.flags){for(;j<16;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(W!==(65535&Z.check)){t.mZ="header crc mismatch",Z.mode=U;break}W=0,j=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),t.adler=Z.check=0,Z.mode=l;break;case 10:for(;j<32;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}t.adler=Z.check=E(W),W=0,j=0,Z.mode=11;case 11:if(0===Z.havedict)return t.next_out=O,t.avail_out=e,t.next_in=o,t.avail_in=p,Z.hold=W,Z.bits=j,r;t.adler=Z.check=1,Z.mode=l;case l:if(b===C||b===Y)break t;case 13:if(Z.last){W>>>=7&j,j-=7&j,Z.mode=27;break}for(;j<3;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}switch(Z.last=1&W,W>>>=1,j-=1,3&W){case 0:Z.mode=14;break;case 1:if(V(Z),Z.mode=20,b===Y){W>>>=2,j-=2;break t}break;case 2:Z.mode=17;break;case 3:t.mZ="invalid block type",Z.mode=U}W>>>=2,j-=2;break;case 14:for(W>>>=7&j,j-=7&j;j<32;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if((65535&W)!==(W>>>16^65535)){t.mZ="invalid stored block lengths",Z.mode=U;break}if(Z.length=65535&W,W=0,j=0,Z.mode=15,b===Y)break t;case 15:Z.mode=16;case 16:if(s=Z.length,s){if(s>p&&(s=p),s>e&&(s=e),0===s)break t;H.set(c.subarray(o,o+s),O),p-=s,o+=s,e-=s,O+=s,Z.length-=s;break}Z.mode=l;break;case 17:for(;j<14;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(Z.nlen=257+(31&W),W>>>=5,j-=5,Z.ndist=1+(31&W),W>>>=5,j-=5,Z.ncode=4+(15&W),W>>>=4,j-=4,Z.nlen>286||Z.ndist>30){t.mZ="too many length or distance symbols",Z.mode=U;break}Z.have=0,Z.mode=18;case 18:for(;Z.have<Z.ncode;){for(;j<3;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.lens[mt[Z.have++]]=7&W,W>>>=3,j-=3}for(;Z.have<19;)Z.lens[mt[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,D={bits:Z.lenbits},x=v(0,Z.lens,0,19,Z.lencode,0,Z.work,D),Z.lenbits=D.bits,x){t.mZ="invalid code lengths set",Z.mode=U;break}Z.have=0,Z.mode=19;case 19:for(;Z.have<Z.nlen+Z.ndist;){for(;i=Z.lencode[W&(1<<Z.lenbits)-1],N=i>>>24,A=i>>>16&255,K=65535&i,!(N<=j);){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(K<16)W>>>=N,j-=N,Z.lens[Z.have++]=K;else{if(16===K){for(f=N+2;j<f;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(W>>>=N,j-=N,0===Z.have){t.mZ="invalid bit length repeat",Z.mode=U;break}X=Z.lens[Z.have-1],s=3+(3&W),W>>>=2,j-=2}else if(17===K){for(f=N+3;j<f;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}W>>>=N,j-=N,X=0,s=3+(7&W),W>>>=3,j-=3}else{for(f=N+7;j<f;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}W>>>=N,j-=N,X=0,s=11+(127&W),W>>>=7,j-=7}if(Z.have+s>Z.nlen+Z.ndist){t.mZ="invalid bit length repeat",Z.mode=U;break}for(;s--;)Z.lens[Z.have++]=X}}if(Z.mode===U)break;if(0===Z.lens[256]){t.mZ="invalid code -- missing end-of-block",Z.mode=U;break}if(Z.lenbits=9,D={bits:Z.lenbits},x=v(1,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,D),Z.lenbits=D.bits,x){t.mZ="invalid literal/lengths set",Z.mode=U;break}if(Z.distbits=6,Z.distcode=Z.distdyn,D={bits:Z.distbits},x=v(2,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,D),Z.distbits=D.bits,x){t.mZ="invalid distances set",Z.mode=U;break}if(Z.mode=20,b===Y)break t;case 20:Z.mode=21;case 21:if(p>=6&&e>=258){t.next_out=O,t.avail_out=e,t.next_in=o,t.avail_in=p,Z.hold=W,Z.bits=j,P(t,d),O=t.next_out,H=t.output,e=t.avail_out,o=t.next_in,c=t.input,p=t.avail_in,W=Z.hold,j=Z.bits,Z.mode===l&&(Z.back=-1);break}for(Z.back=0;i=Z.lencode[W&(1<<Z.lenbits)-1],N=i>>>24,A=i>>>16&255,K=65535&i,!(N<=j);){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(A&&0===(240&A)){for(L=N,F=A,B=K;i=Z.lencode[B+((W&(1<<L+F)-1)>>L)],N=i>>>24,A=i>>>16&255,K=65535&i,!(L+N<=j);){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}W>>>=L,j-=L,Z.back+=L}if(W>>>=N,j-=N,Z.back+=N,Z.length=K,0===A){Z.mode=26;break}if(32&A){Z.back=-1,Z.mode=l;break}if(64&A){t.mZ="invalid literal/length code",Z.mode=U;break}Z.extra=15&A,Z.mode=22;case 22:if(Z.extra){for(f=Z.extra;j<f;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.length+=W&(1<<Z.extra)-1,W>>>=Z.extra,j-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=23;case 23:for(;i=Z.distcode[W&(1<<Z.distbits)-1],N=i>>>24,A=i>>>16&255,K=65535&i,!(N<=j);){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(0===(240&A)){for(L=N,F=A,B=K;i=Z.distcode[B+((W&(1<<L+F)-1)>>L)],N=i>>>24,A=i>>>16&255,K=65535&i,!(L+N<=j);){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}W>>>=L,j-=L,Z.back+=L}if(W>>>=N,j-=N,Z.back+=N,64&A){t.mZ="invalid distance code",Z.mode=U;break}Z.offset=K,Z.extra=15&A,Z.mode=24;case 24:if(Z.extra){for(f=Z.extra;j<f;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}Z.offset+=W&(1<<Z.extra)-1,W>>>=Z.extra,j-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){t.mZ="invalid distance too far back",Z.mode=U;break}Z.mode=25;case 25:if(0===e)break t;if(s=d-e,Z.offset>s){if(s=Z.offset-s,s>Z.whave&&Z.sane){t.mZ="invalid distance too far back",Z.mode=U;break}s>Z.wnext?(s-=Z.wnext,q=Z.wsize-s):q=Z.wnext-s,s>Z.length&&(s=Z.length),Q=Z.window}else Q=H,q=O-Z.offset,s=Z.length;s>e&&(s=e),e-=s,Z.length-=s;do{H[O++]=Q[q++]}while(--s);0===Z.length&&(Z.mode=21);break;case 26:if(0===e)break t;H[O++]=Z.length,e--,Z.mode=21;break;case 27:if(Z.wrap){for(;j<32;){if(0===p)break t;p--,W|=c[o++]<<j,j+=8}if(d-=e,t.total_out+=d,Z.total+=d,d&&(t.adler=Z.check=Z.flags?S(Z.check,H,d,O-d):J(Z.check,H,d,O-d)),d=e,(Z.flags?W:E(W))!==Z.check){t.mZ="incorrect data check",Z.mode=U;break}W=0,j=0}Z.mode=28;case 28:if(Z.wrap&&Z.flags){for(;j<32;){if(0===p)break t;p--,W+=c[o++]<<j,j+=8}if(W!==(4294967295&Z.total)){t.mZ="incorrect length check",Z.mode=U;break}W=0,j=0}Z.mode=29;case 29:x=I;break t;case U:x=T;break t;case 31:return a;default:return M}return t.next_out=O,t.avail_out=e,t.next_in=o,t.avail_in=p,Z.hold=W,Z.bits=j,(Z.wsize||d!==t.avail_out&&Z.mode<U&&(Z.mode<27||b!==h))&&n(t,t.output,t.next_out,d-t.avail_out)?(Z.mode=31,a):(y-=t.avail_in,d-=t.avail_out,t.total_in+=y,t.total_out+=d,Z.total+=d,Z.wrap&&d&&(t.adler=Z.check=Z.flags?S(Z.check,H,d,t.next_out-d):J(Z.check,H,d,t.next_out-d)),t.data_type=Z.bits+(Z.last?64:0)+(Z.mode===l?128:0)+(20===Z.mode||15===Z.mode?256:0),(0===y&&0===d||b===h)&&x===g&&(x=k),x)},t.exports.inflateEnd=t=>{if(!t||!t.state)return M;let b=t.state;return b.window&&(b.window=null),t.state=null,g},t.exports.inflateGetHeader=(t,b)=>{if(!t||!t.state)return M;const Z=t.state;return 0===(2&Z.wrap)?M:(Z.head=b,b.done=!1,g)},t.exports.inflateSetDictionary=(t,b)=>{const Z=b.length;let S,P,v;return t&&t.state?(S=t.state,0!==S.wrap&&11!==S.mode?M:11===S.mode&&(P=1,P=J(P,b,Z,0),P!==S.check)?T:(v=n(t,b,Z,Z),v?(S.mode=31,a):(S.havedict=1,g))):M},t.exports.inflateInfo="pako inflate (from Nodeca project)"},13869:t=>{"use strict";const b=15,Z=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),J=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),S=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),P=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,v,h,C,Y,g,I,r)=>{const M=r.bits;let T,a,k,u,l,U,E=0,c=0,H=0,o=0,O=0,p=0,e=0,W=0,j=0,V=0,n=null,y=0;const d=new Uint16Array(16),s=new Uint16Array(16);let q,Q,N,A=null,K=0;for(E=0;E<=b;E++)d[E]=0;for(c=0;c<C;c++)d[v[h+c]]++;for(O=M,o=b;o>=1&&0===d[o];o--);if(O>o&&(O=o),0===o)return Y[g++]=20971520,Y[g++]=20971520,r.bits=1,0;for(H=1;H<o&&0===d[H];H++);for(O<H&&(O=H),W=1,E=1;E<=b;E++)if(W<<=1,W-=d[E],W<0)return-1;if(W>0&&(0===t||1!==o))return-1;for(s[1]=0,E=1;E<b;E++)s[E+1]=s[E]+d[E];for(c=0;c<C;c++)0!==v[h+c]&&(I[s[v[h+c]]++]=c);if(0===t?(n=A=I,U=19):1===t?(n=Z,y-=257,A=J,K-=257,U=256):(n=S,A=P,U=-1),V=0,c=0,E=H,l=g,p=O,e=0,k=-1,j=1<<O,u=j-1,1===t&&j>852||2===t&&j>592)return 1;for(;;){q=E-e,I[c]<U?(Q=0,N=I[c]):I[c]>U?(Q=A[K+I[c]],N=n[y+I[c]]):(Q=96,N=0),T=1<<E-e,a=1<<p,H=a;do{a-=T,Y[l+(V>>e)+a]=q<<24|Q<<16|N}while(0!==a);for(T=1<<E-1;V&T;)T>>=1;if(0!==T?(V&=T-1,V+=T):V=0,c++,0===--d[E]){if(E===o)break;E=v[h+I[c]]}if(E>O&&(V&u)!==k){for(0===e&&(e=O),l+=H,p=E-e,W=1<<p;p+e<o&&(W-=d[p+e],!(W<=0));)p++,W<<=1;if(j+=1<<p,1===t&&j>852||2===t&&j>592)return 1;k=V&u,Y[k]=O<<24|p<<16|l-g}}return 0!==V&&(Y[l+V]=E-e<<24|64<<16),r.bits=O,0}},13836:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13824:t=>{"use strict";function b(t){let b=t.length;for(;--b>=0;)t[b]=0}const Z=256,J=286,S=30,P=15,v=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),h=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Array(576);b(g);const I=new Array(60);b(I);const r=new Array(512);b(r);const M=new Array(256);b(M);const T=new Array(29);b(T);const a=new Array(S);function k(t,b,Z,J,S){this.static_tree=t,this.extra_bits=b,this.extra_base=Z,this.elems=J,this.max_length=S,this.has_stree=t&&t.length}let u,l,U;function E(t,b){this.dyn_tree=t,this.max_code=0,this.stat_desc=b}b(a);const c=t=>t<256?r[t]:r[256+(t>>>7)],H=(t,b)=>{t.pending_buf[t.pending++]=255&b,t.pending_buf[t.pending++]=b>>>8&255},o=(t,b,Z)=>{t.bi_valid>16-Z?(t.bi_buf|=b<<t.bi_valid&65535,H(t,t.bi_buf),t.bi_buf=b>>16-t.bi_valid,t.bi_valid+=Z-16):(t.bi_buf|=b<<t.bi_valid&65535,t.bi_valid+=Z)},O=(t,b,Z)=>{o(t,Z[2*b],Z[2*b+1])},p=(t,b)=>{let Z=0;do{Z|=1&t,t>>>=1,Z<<=1}while(--b>0);return Z>>>1},e=(t,b,Z)=>{const J=new Array(16);let S,v,h=0;for(S=1;S<=P;S++)J[S]=h=h+Z[S-1]<<1;for(v=0;v<=b;v++){let b=t[2*v+1];0!==b&&(t[2*v]=p(J[b]++,b))}},W=t=>{let b;for(b=0;b<J;b++)t.dyn_ltree[2*b]=0;for(b=0;b<S;b++)t.dyn_dtree[2*b]=0;for(b=0;b<19;b++)t.bl_tree[2*b]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},j=t=>{t.bi_valid>8?H(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},V=(t,b,Z,J)=>{const S=2*b,P=2*Z;return t[S]<t[P]||t[S]===t[P]&&J[b]<=J[Z]},n=(t,b,Z)=>{const J=t.heap[Z];let S=Z<<1;for(;S<=t.heap_len&&(S<t.heap_len&&V(b,t.heap[S+1],t.heap[S],t.depth)&&S++,!V(b,J,t.heap[S],t.depth));)t.heap[Z]=t.heap[S],Z=S,S<<=1;t.heap[Z]=J},y=(t,b,J)=>{let S,P,C,Y,g=0;if(0!==t.last_lit)do{S=t.pending_buf[t.d_buf+2*g]<<8|t.pending_buf[t.d_buf+2*g+1],P=t.pending_buf[t.l_buf+g],g++,0===S?O(t,P,b):(C=M[P],O(t,C+Z+1,b),Y=v[C],0!==Y&&(P-=T[C],o(t,P,Y)),S--,C=c(S),O(t,C,J),Y=h[C],0!==Y&&(S-=a[C],o(t,S,Y)))}while(g<t.last_lit);O(t,256,b)},d=(t,b)=>{const Z=b.dyn_tree,J=b.stat_desc.static_tree,S=b.stat_desc.has_stree,v=b.stat_desc.elems;let h,C,Y,g=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<v;h++)0!==Z[2*h]?(t.heap[++t.heap_len]=g=h,t.depth[h]=0):Z[2*h+1]=0;for(;t.heap_len<2;)Y=t.heap[++t.heap_len]=g<2?++g:0,Z[2*Y]=1,t.depth[Y]=0,t.opt_len--,S&&(t.static_len-=J[2*Y+1]);for(b.max_code=g,h=t.heap_len>>1;h>=1;h--)n(t,Z,h);Y=v;do{h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],n(t,Z,1),C=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=C,Z[2*Y]=Z[2*h]+Z[2*C],t.depth[Y]=(t.depth[h]>=t.depth[C]?t.depth[h]:t.depth[C])+1,Z[2*h+1]=Z[2*C+1]=Y,t.heap[1]=Y++,n(t,Z,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,b)=>{const Z=b.dyn_tree,J=b.max_code,S=b.stat_desc.static_tree,v=b.stat_desc.has_stree,h=b.stat_desc.extra_bits,C=b.stat_desc.extra_base,Y=b.stat_desc.max_length;let g,I,r,M,T,a,k=0;for(M=0;M<=P;M++)t.bl_count[M]=0;for(Z[2*t.heap[t.heap_max]+1]=0,g=t.heap_max+1;g<573;g++)I=t.heap[g],M=Z[2*Z[2*I+1]+1]+1,M>Y&&(M=Y,k++),Z[2*I+1]=M,I>J||(t.bl_count[M]++,T=0,I>=C&&(T=h[I-C]),a=Z[2*I],t.opt_len+=a*(M+T),v&&(t.static_len+=a*(S[2*I+1]+T)));if(0!==k){do{for(M=Y-1;0===t.bl_count[M];)M--;t.bl_count[M]--,t.bl_count[M+1]+=2,t.bl_count[Y]--,k-=2}while(k>0);for(M=Y;0!==M;M--)for(I=t.bl_count[M];0!==I;)r=t.heap[--g],r>J||(Z[2*r+1]!==M&&(t.opt_len+=(M-Z[2*r+1])*Z[2*r],Z[2*r+1]=M),I--)}})(t,b),e(Z,g,t.bl_count)},s=(t,b,Z)=>{let J,S,P=-1,v=b[1],h=0,C=7,Y=4;for(0===v&&(C=138,Y=3),b[2*(Z+1)+1]=65535,J=0;J<=Z;J++)S=v,v=b[2*(J+1)+1],++h<C&&S===v||(h<Y?t.bl_tree[2*S]+=h:0!==S?(S!==P&&t.bl_tree[2*S]++,t.bl_tree[32]++):h<=10?t.bl_tree[34]++:t.bl_tree[36]++,h=0,P=S,0===v?(C=138,Y=3):S===v?(C=6,Y=3):(C=7,Y=4))},q=(t,b,Z)=>{let J,S,P=-1,v=b[1],h=0,C=7,Y=4;for(0===v&&(C=138,Y=3),J=0;J<=Z;J++)if(S=v,v=b[2*(J+1)+1],!(++h<C&&S===v)){if(h<Y)do{O(t,S,t.bl_tree)}while(0!==--h);else 0!==S?(S!==P&&(O(t,S,t.bl_tree),h--),O(t,16,t.bl_tree),o(t,h-3,2)):h<=10?(O(t,17,t.bl_tree),o(t,h-3,3)):(O(t,18,t.bl_tree),o(t,h-11,7));h=0,P=S,0===v?(C=138,Y=3):S===v?(C=6,Y=3):(C=7,Y=4)}};let Q=!1;const N=(t,b,Z,J)=>{o(t,0+(J?1:0),3),((t,b,Z,J)=>{j(t),J&&(H(t,Z),H(t,~Z)),t.pending_buf.set(t.window.subarray(b,b+Z),t.pending),t.pending+=Z})(t,b,Z,!0)};t.exports._tr_init=t=>{Q||((()=>{let t,b,Z,Y,E;const c=new Array(16);for(Z=0,Y=0;Y<28;Y++)for(T[Y]=Z,t=0;t<1<<v[Y];t++)M[Z++]=Y;for(M[Z-1]=Y,E=0,Y=0;Y<16;Y++)for(a[Y]=E,t=0;t<1<<h[Y];t++)r[E++]=Y;for(E>>=7;Y<S;Y++)for(a[Y]=E<<7,t=0;t<1<<h[Y]-7;t++)r[256+E++]=Y;for(b=0;b<=P;b++)c[b]=0;for(t=0;t<=143;)g[2*t+1]=8,t++,c[8]++;for(;t<=255;)g[2*t+1]=9,t++,c[9]++;for(;t<=279;)g[2*t+1]=7,t++,c[7]++;for(;t<=287;)g[2*t+1]=8,t++,c[8]++;for(e(g,287,c),t=0;t<S;t++)I[2*t+1]=5,I[2*t]=p(t,5);u=new k(g,v,257,J,P),l=new k(I,h,0,S,P),U=new k(new Array(0),C,0,19,7)})(),Q=!0),t.l_desc=new E(t.dyn_ltree,u),t.d_desc=new E(t.dyn_dtree,l),t.bl_desc=new E(t.bl_tree,U),t.bi_buf=0,t.bi_valid=0,W(t)},t.exports._tr_stored_block=N,t.exports._tr_flush_block=(t,b,J,S)=>{let P,v,h=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let b,J=4093624447;for(b=0;b<=31;b++,J>>>=1)if(1&J&&0!==t.dyn_ltree[2*b])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(b=32;b<Z;b++)if(0!==t.dyn_ltree[2*b])return 1;return 0})(t)),d(t,t.l_desc),d(t,t.d_desc),h=(t=>{let b;for(s(t,t.dyn_ltree,t.l_desc.max_code),s(t,t.dyn_dtree,t.d_desc.max_code),d(t,t.bl_desc),b=18;b>=3&&0===t.bl_tree[2*Y[b]+1];b--);return t.opt_len+=3*(b+1)+5+5+4,b})(t),P=t.opt_len+3+7>>>3,v=t.static_len+3+7>>>3,v<=P&&(P=v)):P=v=J+5,J+4<=P&&-1!==b?N(t,b,J,S):4===t.strategy||v===P?(o(t,2+(S?1:0),3),y(t,g,I)):(o(t,4+(S?1:0),3),((t,b,Z,J)=>{let S;for(o(t,b-257,5),o(t,Z-1,5),o(t,J-4,4),S=0;S<J;S++)o(t,t.bl_tree[2*Y[S]+1],3);q(t,t.dyn_ltree,b-1),q(t,t.dyn_dtree,Z-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),y(t,t.dyn_ltree,t.dyn_dtree)),W(t),S&&j(t)},t.exports._tr_tally=(t,b,J)=>(t.pending_buf[t.d_buf+2*t.last_lit]=b>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&b,t.pending_buf[t.l_buf+t.last_lit]=255&J,t.last_lit++,0===b?t.dyn_ltree[2*J]++:(t.matches++,b--,t.dyn_ltree[2*(M[J]+Z+1)]++,t.dyn_dtree[2*c(b)]++),t.last_lit===t.lit_bufsize-1),t.exports._tr_align=t=>{o(t,2,3),O(t,256,g),(t=>{16===t.bi_valid?(H(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},13846:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.mZ="",this.state=null,this.data_type=2,this.adler=0}},13515:t=>{function b(t,b,Z){for(var J=t.length,S=-1/0,P=1/0,v=0;v<J;v++){var h=(Z[0][v]-t[v])/b[v],C=(Z[1][v]-t[v])/b[v];if(h>C){var Y=h;h=C,C=Y}if(C<S||h>P)return 1/0;h>S&&(S=h),C<P&&(P=C)}return S>P?1/0:S}t.exports=function(t,Z,J,S){var P=b(Z,J,S);if(P===1/0)t=null;else{t=t||[];for(var v=0;v<Z.length;v++)t[v]=Z[v]+J[v]*P}return t},t.exports.distance=b},14915:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>v});var J=Z(27);const S=J.useLayoutEffect;const P=function(t){var b=(0,J.useRef)(t);return S((function(){b.current=t})),b};var v=function(t){var b=P(t);(0,J.Eb)((function(){var t=function(t){var Z;if(null!=b.current&&(Z=b.current(t)),t.defaultPrevented&&(t.returnValue=""),"string"===typeof Z)return t.returnValue=Z,Z};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[])}},14860:(t,b,Z)=>{"use strict";var J=Z(14868),S=Array.prototype.concat,P=Array.prototype.slice,v=t.exports=function(t){for(var b=[],Z=0,v=t.length;Z<v;Z++){var h=t[Z];J(h)?b=S.call(b,P.call(h)):b.push(h)}return b};v.wrap=function(t){return function(){return t(v(arguments))}}},14868:t=>{t.exports=function(t){return!(!t||"string"===typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))}},13771:(t,b,Z)=>{var J=Z(13775);function S(t){for(var b,Z,S=0,P=t.length,v=0;v<t.length;){for(b=t[v],Z=0;v<P&&t[v]===b;)++v,++Z;S+=J.log2(Z)/7|0,S+=J.log2(b>>>0)/7|0,S+=2}return S}b.size=S,b.encode=function(t,b){b||(b=new Uint8Array(S(t)));for(var Z,J,P=0,v=b.length,h=0;h<t.length;){for(Z=t[h],J=0;h<t.length&&t[h]===Z;)++h,++J;for(;P<v&&J>=128;)b[P++]=128+(127&J),J>>>=7;if(P>=v)throw new Error("RLE buffer overflow");for(b[P++]=J,Z>>>=0;P<v&&Z>=128;)b[P++]=128+(127&Z),Z>>>=7;if(P>=v)throw new Error("RLE buffer overflow");b[P++]=Z}return b},b.decode=function(t,b){for(var Z,J,S,P,v=b.length,h=t.length,C=0,Y=0;Y<h;){for(Z=0,J=0;Y<h&&t[Y]>=128;)Z+=(127&t[Y++])<<J,J+=7;if(Z+=t[Y++]<<J,Y>=h)throw new Error("RLE buffer underrun");if(C+Z>v)throw new Error("Chunk buffer overflow");for(S=0,J=0;Y<h&&t[Y]>=128;)S+=(127&t[Y++])<<J,J+=7;if(Y>=h)throw new Error("RLE buffer underrun");for(S+=t[Y++]<<J,P=0;P<Z;++P)b[C++]=S}return b}},13775:(t,b)=>{"use strict";function Z(t){var b=32;return(t&=-t)&&b--,65535&t&&(b-=16),16711935&t&&(b-=8),252645135&t&&(b-=4),858993459&t&&(b-=2),1431655765&t&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(t){return(t>0)-(t<0)},b.abs=function(t){var b=t>>31;return(t^b)-b},b.min=function(t,b){return b^(t^b)&-(t<b)},b.max=function(t,b){return t^(t^b)&-(t<b)},b.isPow2=function(t){return!(t&t-1)&&!!t},b.log2=function(t){var b,Z;return b=(t>65535)<<4,b|=Z=((t>>>=b)>255)<<3,b|=Z=((t>>>=Z)>15)<<2,(b|=Z=((t>>>=Z)>3)<<1)|(t>>>=Z)>>1},b.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},b.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},b.countTrailingZeros=Z,b.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},b.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},b.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var J=new Array(256);!function(t){for(var b=0;b<256;++b){var Z=b,J=b,S=7;for(Z>>>=1;Z;Z>>>=1)J<<=1,J|=1&Z,--S;t[b]=J<<S&255}}(J),b.reverse=function(t){return J[255&t]<<24|J[t>>>8&255]<<16|J[t>>>16&255]<<8|J[t>>>24&255]},b.interleave2=function(t,b){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(t,b){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>b&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},b.interleave3=function(t,b,Z){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Z=1227133513&((Z=3272356035&((Z=251719695&((Z=4278190335&((Z&=1023)|Z<<16))|Z<<8))|Z<<4))|Z<<2))<<2},b.deinterleave3=function(t,b){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>b&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},b.nextCombination=function(t){var b=t|t-1;return b+1|(~b&-~b)-1>>>Z(t)+1}},13809:t=>{"use strict";t.exports=function(t,b,Z,J){var S=self||window;try{try{var P;try{P=new S.Blob([t])}catch(Y){(P=new(S.BlobBuilder||S.WebKitBlobBuilder||S.MozBlobBuilder||S.MSBlobBuilder)).append(t),P=P.getBlob()}var v=S.URL||S.webkitURL,h=v.createObjectURL(P),C=new S[b](h,Z);return v.revokeObjectURL(h),C}catch(Y){return new S[b]("data:application/javascript,".concat(encodeURIComponent(t)),Z)}}catch(Y){if(!J)throw Error("Inline worker is not supported");return new S[b](J,Z)}}},13496:(t,b,Z)=>{"use strict";function J(t,b,Z,J,S){var P={};return Object.keys(J).forEach((function(t){P[t]=J[t]})),P.enumerable=!!P.enumerable,P.configurable=!!P.configurable,("value"in P||P.initializer)&&(P.writable=!0),P=Z.slice().reverse().reduce((function(Z,J){return J(t,b,Z)||Z}),P),S&&void 0!==P.initializer&&(P.value=P.initializer?P.initializer.call(S):void 0,P.initializer=void 0),void 0===P.initializer&&(Object.defineProperty(t,b,P),P=null),P}Z.d(b,{c:()=>J})},13492:(t,b,Z)=>{"use strict";function J(t,b,Z,J){Z&&Object.defineProperty(t,b,{enumerable:Z.enumerable,configurable:Z.configurable,writable:Z.writable,value:Z.initializer?Z.initializer.call(J):void 0})}Z.d(b,{d:()=>J})},14906:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>v,i:()=>I,l:()=>h,n:()=>P,p:()=>C,t:()=>S,v:()=>Y,y:()=>g});var J=Z(12944);class S{constructor(){this._easingMode=S.EASINGMODE_EASEIN}setEasingMode(t){const b=Math.min(Math.max(t,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case S.EASINGMODE_EASEIN:return this.easeInCore(t);case S.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}S.EASINGMODE_EASEIN=0,S.EASINGMODE_EASEOUT=1,S.EASINGMODE_EASEINOUT=2;class P extends S{easeInCore(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)}}class v extends S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=t}easeInCore(t){const b=Math.max(0,this.amplitude);return Math.pow(t,3)-t*b*Math.sin(3.141592653589793*t)}}class h extends S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=t,this.bounciness=b}easeInCore(t){const b=Math.max(0,this.bounces);let Z=this.bounciness;Z<=1&&(Z=1.001);const J=Math.pow(Z,b),S=1-Z,P=(1-J)/S+.5*J,v=t*P,h=Math.log(-v*(1-Z)+1)/Math.log(Z),C=Math.floor(h),Y=C+1,g=(1-Math.pow(Z,C))/(S*P),I=.5*(g+(1-Math.pow(Z,Y))/(S*P)),r=t-I,M=I-g;return-Math.pow(1/Z,b-C)/(M*M)*(r-M)*(r+M)}}class C extends S{easeInCore(t){return t*t*t}}class Y extends S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=t,this.springiness=b}easeInCore(t){let b;const Z=Math.max(0,this.oscillations),J=Math.max(0,this.springiness);return b=0==J?t:(Math.exp(J*t)-1)/(Math.exp(J)-1),b*Math.sin((6.283185307179586*Z+1.5707963267948966)*t)}}class g extends S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}}class I extends S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=t,this.y1=b,this.x2=Z,this.y2=J}easeInCore(t){return J.b.Interpolate(t,this.x1,this.y1,this.x2,this.y2)}}},14319:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>v});var J=Z(12735),S=Z(12742),P=Z(13155);class v extends P.e{get _matrix(){return this._compose(),this.IM}set _matrix(t){(t.updateFlag!==this.IM.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.IM.S(t),this._markAsDirtyAndDecompose())}constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(t,b.et(),!1),this.name=t,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.IM=(null===S||void 0===S?void 0:S.clone())??J.Matrix.Identity(),this._restMatrix=P??this.IM.clone(),this._bindMatrix=v??this.IM.clone(),this._index=h,this._absoluteMatrix=new J.Matrix,this._absoluteBindMatrix=new J.Matrix,this._absoluteInverseBindMatrix=new J.Matrix,this._finalMatrix=new J.Matrix,b.bones.push(this),this.setParent(Z,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(t){this.setParent(t)}setParent(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==t){if(this.parent){const t=this.parent.children.indexOf(this);-1!==t&&this.parent.children.splice(t,1)}this._parentNode=t,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.og()}}getLocalMatrix(){return this._compose(),this.IM}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(t){this._restMatrix.S(t)}setRestPose(t){this.setRestMatrix(t)}getBindPose(){return this.getBindMatrix()}setBindMatrix(t){this.yb(t)}setBindPose(t){this.setBindMatrix(t)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const t=J.TmpVectors.JZ[0],b=J.TmpVectors.Quaternion[0],Z=J.TmpVectors.JZ[1];this.getRestMatrix().decompose(t,b,Z),this._linkedTransformNode.position.S(Z),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??J.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.S(b),this._linkedTransformNode.Kb.S(t)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.UC}set position(t){this._decompose(),this.UC.S(t),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(t){this.setRotation(t)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(t){this.setRotationQuaternion(t)}get Kb(){return this.getScale()}set Kb(t){this.setScale(t)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=J.JZ.Zero(),this._localRotation=J.Quaternion.Zero(),this.UC=J.JZ.Zero()),this.IM.decompose(this._localScaling,this._localRotation,this.UC))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,J.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.UC,this.IM)):this._needToCompose=!1)}yb(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.S(t),b&&this._updateAbsoluteBindMatrices(),Z?this._matrix=t:this.og()}_updateAbsoluteBindMatrices(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t||(t=this._bindMatrix),this.parent?t.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.S(t),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let Z=0;Z<this.children.length;Z++)this.children[Z]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}og(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.og(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.og(),this._needToDecompose=!0}_updatePosition(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0,S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const P=this.getLocalMatrix();if(0==b)S?(P.addAtIndex(12,t.x),P.addAtIndex(13,t.y),P.addAtIndex(14,t.z)):P.setTranslationFromFloats(t.x,t.y,t.z);else{let b=null;Z&&(b=Z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=v._TmpMats[0],C=v._TmpVecs[0];this.parent?Z&&b?(h.S(this.parent.getAbsoluteMatrix()),h.multiplyToRef(b,h)):h.S(this.parent.getAbsoluteMatrix()):J.Matrix.IdentityToRef(h),S&&h.setTranslationFromFloats(0,0,0),h.invert(),J.JZ.TransformCoordinatesToRef(t,h,C),S?(P.addAtIndex(12,C.x),P.addAtIndex(13,C.y),P.addAtIndex(14,C.z)):P.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,b,Z,!0)}setPosition(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this._updatePosition(t,b,Z,!1)}setAbsolutePosition(t,b){this.setPosition(t,1,b)}scale(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const P=this.getLocalMatrix(),h=v._TmpMats[0];J.Matrix.ScalingToRef(t,b,Z,h),h.multiplyToRef(P,P),h.invert();for(const J of this.children){const S=J.getLocalMatrix();S.multiplyToRef(h,S),S.multiplyAtIndex(12,t),S.multiplyAtIndex(13,b),S.multiplyAtIndex(14,Z),J._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),S)for(const J of this.children)J.scale(t,b,Z,S)}setScale(t){this._decompose(),this._localScaling.S(t),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(t){this._decompose(),t.S(this._localScaling)}setYawPitchRoll(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4?arguments[4]:void 0;if(0===S){const h=v._TmpQuat;return J.Quaternion.RotationYawPitchRollToRef(t,b,Z,h),void this.setRotationQuaternion(h,S,P)}const h=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,P))return;const C=v._TmpMats[1];J.Matrix.RotationYawPitchRollToRef(t,b,Z,C),h.multiplyToRef(C,C),this._rotateWithMatrix(C,S,P)}rotate(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;const P=v._TmpMats[0];P.setTranslationFromFloats(0,0,0),J.Matrix.RotationAxisToRef(t,b,P),this._rotateWithMatrix(P,Z,S)}setAxisAngle(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3?arguments[3]:void 0;if(0===Z){const P=v._TmpQuat;return J.Quaternion.RotationAxisToRef(t,b,P),void this.setRotationQuaternion(P,Z,S)}const P=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(P,S))return;const h=v._TmpMats[1];J.Matrix.RotationAxisToRef(t,b,h),P.multiplyToRef(h,h),this._rotateWithMatrix(h,Z,S)}setRotation(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(t.y,t.x,t.z,b,Z)}setRotationQuaternion(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.S(t),void this._markAsDirtyAndCompose();const S=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,Z))return;const P=v._TmpMats[1];J.Matrix.FromQuaternionToRef(t,P),S.multiplyToRef(P,P),this._rotateWithMatrix(P,b,Z)}setRotationMatrix(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;if(0===b){const S=v._TmpQuat;return J.Quaternion.FromRotationMatrixToRef(t,S),void this.setRotationQuaternion(S,b,Z)}const S=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,Z))return;const P=v._TmpMats[1];P.S(t),S.multiplyToRef(t,P),this._rotateWithMatrix(P,b,Z)}_rotateWithMatrix(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const J=this.getLocalMatrix(),S=J.m[12],P=J.m[13],h=J.m[14],C=this.getParent(),Y=v._TmpMats[3],g=v._TmpMats[4];C&&1==b?(Z?(Y.S(Z.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(Y,Y)):Y.S(C.getAbsoluteMatrix()),g.S(Y),g.invert(),J.multiplyToRef(Y,J),J.multiplyToRef(t,J),J.multiplyToRef(g,J)):1==b&&Z?(Y.S(Z.getWorldMatrix()),g.S(Y),g.invert(),J.multiplyToRef(Y,J),J.multiplyToRef(t,J),J.multiplyToRef(g,J)):J.multiplyToRef(t,J),J.setTranslationFromFloats(S,P,h),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(t,b){const Z=v._TmpMats[2];return t.S(this.getAbsoluteMatrix()),b?(t.multiplyToRef(b.getWorldMatrix(),t),J.Matrix.ScalingToRef(b.Kb.x,b.Kb.y,b.Kb.z,Z)):J.Matrix.IdentityToRef(Z),t.invert(),!isNaN(t.m[0])&&(Z.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(Z,t),!0)}Ib(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.JZ.Zero();return this.getPositionToRef(t,b,Z),Z}getPositionToRef(){let t=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const t=this.getLocalMatrix();b.x=t.m[12],b.y=t.m[13],b.z=t.m[14]}else{let Z=null;t&&(Z=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let J=v._TmpMats[0];t&&Z?(J.S(this.getAbsoluteMatrix()),J.multiplyToRef(Z,J)):J=this.getAbsoluteMatrix(),b.x=J.m[12],b.y=J.m[13],b.z=J.m[14]}}getAbsolutePosition(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=J.JZ.Zero();return this.getPositionToRef(1,t,b),b}getAbsolutePositionToRef(t,b){this.getPositionToRef(1,t,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.IM.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.S(this.IM);const t=this._skeleton.getPoseMatrix();t&&this._absoluteMatrix.multiplyToRef(t,this._absoluteMatrix)}const t=this.children,b=t.length;for(let Z=0;Z<b;Z++)t[Z].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}DC(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.JZ.Zero();return this.getDirectionToRef(t,b,Z),Z}getDirectionToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,S=null;b&&(S=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=v._TmpMats[0];P.S(this.getAbsoluteMatrix()),b&&S&&P.multiplyToRef(S,P),J.JZ.TransformNormalToRef(t,P,Z),Z.normalize()}getRotation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.JZ.Zero();return this.getRotationToRef(t,b,Z),Z}getRotationToRef(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0;const J=v._TmpQuat;this.getRotationQuaternionToRef(t,b,J),J.toEulerAnglesToRef(Z)}getRotationQuaternion(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.Quaternion.Identity();return this.getRotationQuaternionToRef(t,b,Z),Z}getRotationQuaternionToRef(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.S(this._localRotation);else{const Z=v._TmpMats[0],J=this.getAbsoluteMatrix();t?J.multiplyToRef(t.getWorldMatrix(),Z):Z.S(J),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.decompose(void 0,b,void 0)}}getRotationMatrix(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const Z=J.Matrix.Identity();return this.getRotationMatrixToRef(t,b,Z),Z}getRotationMatrixToRef(){let t=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const Z=v._TmpMats[0],J=this.getAbsoluteMatrix();t?J.multiplyToRef(t.getWorldMatrix(),Z):Z.S(J),Z.multiplyAtIndex(0,this._scalingDeterminant),Z.multiplyAtIndex(1,this._scalingDeterminant),Z.multiplyAtIndex(2,this._scalingDeterminant),Z.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.JZ.Zero();return this.getAbsolutePositionFromLocalToRef(t,b,Z),Z}getAbsolutePositionFromLocalToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,S=null;b&&(S=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=v._TmpMats[0];P.S(this.getAbsoluteMatrix()),b&&S&&P.multiplyToRef(S,P),J.JZ.TransformCoordinatesToRef(t,P,Z)}getLocalPositionFromAbsolute(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=J.JZ.Zero();return this.getLocalPositionFromAbsoluteToRef(t,b,Z),Z}getLocalPositionFromAbsoluteToRef(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2?arguments[2]:void 0,S=null;b&&(S=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const P=v._TmpMats[0];P.S(this.getAbsoluteMatrix()),b&&S&&P.multiplyToRef(S,P),P.invert(),J.JZ.TransformCoordinatesToRef(t,P,Z)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const t=this._skeleton.bones.indexOf(this);if(-1!==t&&this._skeleton.bones.splice(t,1),this._parentNode&&this._parentNode.children){const t=this._parentNode.children,b=t.indexOf(this);-1!==b&&t.splice(b,1)}super.dispose()}}v._TmpVecs=(0,S.c)(2,J.JZ.Zero),v._TmpQuat=J.Quaternion.Identity(),v._TmpMats=(0,S.c)(5,J.Matrix.Identity)},14904:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>d});var J=Z(12721),S=Z(12726),P=Z(12551),v=Z(12735),h=Z(12745),C=Z(13155),Y=Z(13184),g=Z(13013),I=Z(12570),r=Z(12737);class M{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const b=this._attachedCamera.et();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((t=>{t.type!==g.e.POINTERDOWN?t.type===g.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=I.e.Now;let b=0;null!=this._lastFrameTime&&(b=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const Z=t-this._lastInteractionTime-this._idleRotationWaitTime,J=Math.max(Math.min(Z/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*J,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.et();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(t){this._lastInteractionTime=t??I.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<r.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=I.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var T=Z(14906),a=Z(13261);class k{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const b=this._attachedCamera;b&&(t?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((t=>{if(t&&(t.sb(!0),t.getBoundingInfo)){const b=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&(this._attachedCamera.radius===t&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(k.EasingFunction.setEasingMode(k.EasingMode),this._radiusBounceTransition=a.d.CreateAnimation("radius",a.d.ANIMATIONTYPE_FLOAT,60,k.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=a.d.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.et(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}k.EasingFunction=new T.e(.3),k.EasingMode=T.t.EASINGMODE_EASEOUT;class u{constructor(){this.onTargetFramingAnimationEndObservable=new P.d,this._mode=u.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const b=this._attachedCamera.et();u.EasingFunction.setEasingMode(u.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((t=>{t.type!==g.e.POINTERDOWN?t.type===g.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&t.getBoundingInfo&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.et();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sb(!0);const J=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(J.minimumWorld,J.maximumWorld,b,Z)}zoomOnMeshHierarchy(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sb(!0);const J=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(J.min,J.max,b,Z)}zoomOnMeshesHierarchy(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new v.JZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),S=new v.JZ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let P=0;P<t.length;P++){const b=t[P].getHierarchyBoundingVectors(!0);v.JZ.CheckExtends(b.min,J,S),v.JZ.CheckExtends(b.max,J,S)}this.zoomOnBoundingInfo(J,S,b,Z)}zoomOnBoundingInfo(t,b){let Z,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const P=t.y,h=P+(b.y-P)*this._positionScale,C=b.SZ(t).scale(.5);if(!isFinite(h))return!1;if(J)Z=new v.JZ(0,h,0);else{const b=t.add(C);Z=new v.JZ(b.x,h,b.z)}this._vectorTransition||(this._vectorTransition=a.d.CreateAnimation("target",a.d.ANIMATIONTYPE_VECTOR3,60,u.EasingFunction)),this._betaIsAnimating=!0;let Y=a.d.TransitionTo("target",Z,this._attachedCamera,this._attachedCamera.et(),60,this._vectorTransition,this._framingTime);Y&&this._animatables.push(Y);let g=0;if(this._mode===u.FitFrustumSidesMode){const Z=this._calculateLowerRadiusFromModelBoundingSphere(t,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.nb),g=Z}else this._mode===u.IgnoreBoundsSizeMode&&(g=this._calculateLowerRadiusFromModelBoundingSphere(t,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.nb));if(this.autoCorrectCameraLimitsAndSensibility){const Z=b.SZ(t).length();this._attachedCamera.panningSensibility=5e3/Z,this._attachedCamera.wheelPrecision=100/g}return this._radiusTransition||(this._radiusTransition=a.d.CreateAnimation("radius",a.d.ANIMATIONTYPE_FLOAT,60,u.EasingFunction)),Y=a.d.TransitionTo("radius",g,this._attachedCamera,this._attachedCamera.et(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),S&&S(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Y&&this._animatables.push(Y),!0}_calculateLowerRadiusFromModelBoundingSphere(t,b){const Z=this._attachedCamera;if(!Z)return 0;let J=Z._calculateLowerRadiusFromModelBoundingSphere(t,b,this._radiusScale);return Z.lowerRadiusLimit&&this._mode===u.IgnoreBoundsSizeMode&&(J=J<Z.lowerRadiusLimit?Z.lowerRadiusLimit:J),Z.upperRadiusLimit&&(J=J>Z.upperRadiusLimit?Z.upperRadiusLimit:J),J}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=I.e.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,Z=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Z&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=a.d.CreateAnimation("beta",a.d.ANIMATIONTYPE_FLOAT,60,u.EasingFunction));const t=a.d.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.et(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=I.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}u.EasingFunction=new T.y,u.EasingMode=T.t.EASINGMODE_EASEINOUT,u.IgnoreBoundsSizeMode=0,u.FitFrustumSidesMode=1;var l=Z(13193),U=Z(13222),E=Z(14314),c=Z(12549);class H{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(t){t=c.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Z=b.getInputElement();let J=0,S=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=P=>{var v,h;const C=P.event,Y="touch"===C.pointerType;if(P.type!==g.e.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const I=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,b.isPointerLock){const t=C.movementX,b=C.movementY;this.onTouch(null,t,b),this._pointA=null,this._pointB=null}else{if(P.type!==g.e.POINTERDOWN&&P.type!==g.e.POINTERDOUBLETAP&&Y&&(null===(v=this._pointA)||void 0===v?void 0:v.pointerId)!==C.pointerId&&(null===(h=this._pointB)||void 0===h?void 0:h.pointerId)!==C.pointerId)return;if(P.type!==g.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!Y)if(P.type===g.e.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(P.type!==g.e.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!Y){if(P.type===g.e.POINTERMOVE)if(t||C.preventDefault(),this._pointA&&null===this._pointB){const t=C.clientX-this._pointA.x,b=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,t,b)}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;t.x=C.clientX,t.y=C.clientY;const b=this._pointA.x-this._pointB.x,Z=this._pointA.y-this._pointB.y,v=b*b+Z*Z,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:P.type};this.onMultiTouch(this._pointA,this._pointB,J,v,S,h),S=h,J=v}}else{try{null===I||void 0===I||I.releasePointerCapture(C.pointerId)}catch(r){}Y||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==J||S)&&(this.onMultiTouch(this._pointA,this._pointB,J,0,S,null),J=0,S=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),t||C.preventDefault()}else{try{null===I||void 0===I||I.setPointerCapture(C.pointerId)}catch(r){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||Y||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),t||(C.preventDefault(),Z&&Z.focus())}}},this._observer=this.camera.et()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE|g.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,J=0,S=null,this.onLostFocus()},this._contextMenuBind=t=>this.onContextMenu(t),Z&&Z.addEventListener("contextmenu",this._contextMenuBind,!1);const P=this.camera.et().getEngine().getHostWindow();P&&c.Tools.RegisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}Ur(){if(this._onLostFocus){const t=this.camera.et().getEngine().getHostWindow();t&&c.Tools.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.et()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.et().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,b,Z){}onMultiTouch(t,b,Z,J,S,P){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,J.e)([(0,S.N)()],H.prototype,"buttons",void 0);class o extends H{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,b){if(0!==this.panningSensibility&&t&&b){const Z=b.x-t.x,J=b.y-t.y;this.camera.inertialPanningX+=-Z/this.panningSensibility,this.camera.inertialPanningY+=J/this.panningSensibility}}_computePinchZoom(t,b){const Z=this.camera.radius||o.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Z*Math.sqrt(t)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-t)*Z*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,b,Z){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=Z/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,b,Z,J,S,P){0===Z&&null===S||0===J&&null===P||(this.multiTouchPanAndZoom?(this._computePinchZoom(Z,J),this._computeMultiTouchPanning(S,P)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(J)-Math.sqrt(Z))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Z,J),this._isPinching=!0):this._computeMultiTouchPanning(S,P)):this.multiTouchPanning?this._computeMultiTouchPanning(S,P):this.pinchZoom&&this._computePinchZoom(Z,J))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(t){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}o.MinimumRadiusForPinch=.001,(0,J.e)([(0,S.N)()],o.prototype,"buttons",void 0),(0,J.e)([(0,S.N)()],o.prototype,"angularSensibilityX",void 0),(0,J.e)([(0,S.N)()],o.prototype,"angularSensibilityY",void 0),(0,J.e)([(0,S.N)()],o.prototype,"pinchPrecision",void 0),(0,J.e)([(0,S.N)()],o.prototype,"pinchDeltaPercentage",void 0),(0,J.e)([(0,S.N)()],o.prototype,"useNaturalPinchZoom",void 0),(0,J.e)([(0,S.N)()],o.prototype,"pinchZoom",void 0),(0,J.e)([(0,S.N)()],o.prototype,"panningSensibility",void 0),(0,J.e)([(0,S.N)()],o.prototype,"multiTouchPanning",void 0),(0,J.e)([(0,S.N)()],o.prototype,"multiTouchPanAndZoom",void 0),E.b.ArcRotateCameraPointersInput=o;var O=Z(13020);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.et(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Z=b.event;if(!Z.metaKey)if(b.type===O.d.KEYDOWN){if(this._ctrlPressed=Z.ctrlKey,this._altPressed=Z.altKey,-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),Z.preventDefault&&(t||Z.preventDefault())}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysReset.indexOf(Z.keyCode)){const b=this._keys.indexOf(Z.keyCode);b>=0&&this._keys.splice(b,1),Z.preventDefault&&(t||Z.preventDefault())}})))}Ur(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let b=0;b<this._keys.length;b++){const Z=this._keys[b];-1!==this.keysLeft.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Z)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Z)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,J.e)([(0,S.N)()],p.prototype,"keysUp",void 0),(0,J.e)([(0,S.N)()],p.prototype,"keysDown",void 0),(0,J.e)([(0,S.N)()],p.prototype,"keysLeft",void 0),(0,J.e)([(0,S.N)()],p.prototype,"keysRight",void 0),(0,J.e)([(0,S.N)()],p.prototype,"keysReset",void 0),(0,J.e)([(0,S.N)()],p.prototype,"panningSensibility",void 0),(0,J.e)([(0,S.N)()],p.prototype,"zoomingSensibility",void 0),(0,J.e)([(0,S.N)()],p.prototype,"useAltToZoom",void 0),(0,J.e)([(0,S.N)()],p.prototype,"angularSpeed",void 0),E.b.ArcRotateCameraKeyboardMoveInput=p;var e=Z(12778),W=Z(13022);class j{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new v.JZ(0,0,0),this._globalOffset=new v.JZ(0,0,0),this._inertialPanning=v.JZ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,b){let Z=0;const J=.01*t*this.wheelDeltaPercentage*b;return Z=t>0?J/(1+this.wheelDeltaPercentage):J*(1+this.wheelDeltaPercentage),Z}attachControl(t){t=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==g.e.POINTERWHEEL)return;const Z=b.event;let J=0;const S=Z.deltaMode===W.e.DOM_DELTA_LINE?40:1,P=-Z.deltaY*S;if(this.customComputeDeltaFromMouseWheel)J=this.customComputeDeltaFromMouseWheel(P,this,Z);else if(this.wheelDeltaPercentage){if(J=this._computeDeltaFromMouseWheelLegacyEvent(P,this.camera.radius),J>0){let t=this.camera.radius,b=this.camera.inertialRadiusOffset+J;for(let Z=0;Z<20&&!(t<=b)&&!(Math.abs(b*this.camera.inertia)<.001);Z++)t-=b,b*=this.camera.inertia;t=(0,h.Clamp)(t,0,Number.MAX_VALUE),J=this._computeDeltaFromMouseWheelLegacyEvent(P,t)}}else J=P/(40*this.wheelPrecision);J&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(J)):this.camera.inertialRadiusOffset+=J),Z.preventDefault&&(t||Z.preventDefault())},this._observer=this.camera.et()._inputManager._addCameraPointerObserver(this._wheel,g.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Lb(0)}Ur(){this._observer&&(this.camera.et()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,b=t.target.SZ(t.position);this._hitPlane=e.c.FromPositionAndNormal(t.target,b)}_getPosition(){const t=this.camera,b=t.et(),Z=b.createPickingRay(b.pointerX,b.pointerY,v.Matrix.Identity(),t,!1);0===t.targetScreenOffset.x&&0===t.targetScreenOffset.y||(this._viewOffset.set(t.targetScreenOffset.x,t.targetScreenOffset.y,0),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),this._globalOffset=v.JZ.TransformNormal(this._viewOffset,t._cameraTransformMatrix),Z.origin.addInPlace(this._globalOffset));let J=0;return this._hitPlane&&(J=Z.intersectsPlane(this._hitPlane)??0),Z.origin.addInPlace(Z.direction.scaleInPlace(J))}_zoomToMouse(t){const b=this.camera,Z=1-b.inertia;if(b.lowerRadiusLimit){const J=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+t)/Z<J&&(t=(b.radius-J)*Z-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const J=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+t)/Z>J&&(t=(b.radius-J)*Z-b.inertialRadiusOffset)}const J=t/Z/b.radius,S=this._getPosition(),P=v.TmpVectors.JZ[6];S.subtractToRef(b.target,P),P.scaleInPlace(J),P.scaleInPlace(Z),this._inertialPanning.addInPlace(P),b.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<r.e&&(t.x=0),Math.abs(t.y)<r.e&&(t.y=0),Math.abs(t.z)<r.e&&(t.z=0)}}(0,J.e)([(0,S.N)()],j.prototype,"wheelPrecision",void 0),(0,J.e)([(0,S.N)()],j.prototype,"zoomToMouseLocation",void 0),(0,J.e)([(0,S.N)()],j.prototype,"wheelDeltaPercentage",void 0),E.b.ArcRotateCameraMouseWheelInput=j;class V extends E.d{constructor(t){super(t)}addMouseWheel(){return this.add(new j),this}addPointers(){return this.add(new o),this}addKeyboard(){return this.add(new p),this}}var n=Z(12688);function y(t,b){return isNaN(t)?b:t}C.e.AddNodeConstructor("ArcRotateCamera",((t,b)=>()=>new d(t,0,0,1,v.JZ.Zero(),b)));class d extends U.b{get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new v.Matrix,this._upToYMatrix=new v.Matrix,this._upVector=v.JZ.Zero()),t.normalize(),this._upVector.S(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){v.Matrix.RotationAlignToRef(v.JZ.UpReadOnly,this._upVector,this._yToUpMatrix),v.Matrix.RotationAlignToRef(this._upVector,v.JZ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=t)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new k,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new u,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new M,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(t,b,Z,J,S,h){var C;let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(t,v.JZ.Zero(),h,Y),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=v.JZ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=v.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new v.Matrix,this.panningAxis=new v.JZ(1,1,0),this._transformedDirection=new v.JZ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new P.d,this.checkCollisions=!1,this.collisionRadius=new v.JZ(.5,.5,.5),this._previousPosition=v.JZ.Zero(),this._collisionVelocity=v.JZ.Zero(),this._newPosition=v.JZ.Zero(),this._computationVector=v.JZ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new v.JZ(NaN,NaN,NaN),this._goalTargetScreenOffset=new v.Vector2(NaN,NaN),this._onCollisionPositionChange=function(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z?(C.setPosition(b),C.ST&&C.ST(Z)):C._previousPosition.S(C._position);const J=Math.cos(C.alpha),S=Math.sin(C.alpha),P=Math.cos(C.beta);let v=Math.sin(C.beta);0===v&&(v=1e-4);const h=C._getTargetPosition();C._computationVector.Ab(C.radius*J*v,C.radius*P,C.radius*S*v),h.addToRef(C._computationVector,C._newPosition),C._position.S(C._newPosition);let Y=C.upVector;C.allowUpsideDown&&C.beta<0&&(Y=Y.clone(),Y=Y.negate()),C._computeViewMatrix(C._position,h,Y),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=v.JZ.Zero(),S&&this.setTarget(S),this.alpha=b,this.beta=Z,this.radius=J,this.getViewMatrix(),this.inputs=new V(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new v.JZ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=v.Vector2.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.S(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.S(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.S(t)}const t=this._getLockedTargetPosition();return t||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>r.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,P=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=P?this._currentInterpolationFactor=P:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=y(t,this._goalAlpha),this._goalBeta=y(b,this._goalBeta),this._goalRadius=y(Z,this._goalRadius),this._goalTarget.set(y(J.x,this._goalTarget.x),y(J.y,this._goalTarget.y),y(J.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(y(S.x,this._goalTargetScreenOffset.x),y(S.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,h.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,h.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,h.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,h.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const S=arguments;b=c.Tools.BackCompatCameraNoPreventDefault(S),this._useCtrlForPanning=Z,this._panningMouseButton=J,"boolean"===typeof S[0]&&(S.length>1&&(this._useCtrlForPanning=S[1]),S.length>2&&(this._panningMouseButton=S[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ur(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let t=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){t=!0;const b=this.invertRotation?-1:1,Z=this._calculateHandednessMultiplier();let J=this.inertialAlphaOffset*Z;this.beta<0&&(J*=-1),this.alpha+=J*b,this.beta+=this.inertialBetaOffset*b,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<r.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<r.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*r.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){t=!0;const b=new v.JZ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.multiplyInPlace(this.panningAxis),v.JZ.TransformNormalToRef(b,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const t=this.upVector,b=v.JZ.CrossToRef(this._transformedDirection,t,this._transformedDirection);v.JZ.CrossToRef(t,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);v.JZ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.S(this._transformedDirection)}else{if(this.parent){const t=v.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.transposeToRef(t),v.JZ.TransformCoordinatesToRef(this._transformedDirection,t,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*r.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*r.e&&(this.inertialPanningY=0)}if(t)this.stopInterpolation();else if(this._isInterpolating){let t=!1;const b=this._scene.getEngine().getDeltaTime()/1e3,Z=1-Math.pow(2,-b/this._currentInterpolationFactor),J=y(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const b=v.TmpVectors.JZ[0].set(y(this._goalTarget.x,this._target.x),y(this._goalTarget.y,this._target.y),y(this._goalTarget.z,this._target.z));v.JZ.LerpToRef(this.target,b,Z,this._target),10*v.JZ.Distance(this.target,b)/J<r.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.S(b),this.setTarget(this.target,!1,!0,!0)):t=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const b=v.Quaternion.RotationAlphaBetaGammaToRef(y(this._goalAlpha,this.alpha),y(this._goalBeta,this.beta),0,v.TmpVectors.Quaternion[0]),J=v.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,v.TmpVectors.Quaternion[1]),S=v.Quaternion.SlerpToRef(J,b,Z,v.TmpVectors.Quaternion[2]);S.normalize();const P=S.toAlphaBetaGammaToRef(v.TmpVectors.JZ[0]);if(this.alpha=P.x,this.beta=P.y,S.isApprox(b,r.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const t=b.toAlphaBetaGammaToRef(v.TmpVectors.JZ[0]);this.alpha=t.x,this.beta=t.y}else t=!0}if(isNaN(this._goalRadius)||(this.radius+=(J-this.radius)*Z,Math.abs(J/this.radius-1)<r.e?(this._goalRadius=NaN,this.radius=J):t=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const b=v.TmpVectors.Vector2[0].set(y(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),y(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));v.Vector2.LerpToRef(this.targetScreenOffset,b,Z,this.targetScreenOffset),v.Vector2.Distance(this.targetScreenOffset,b)<r.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.S(b)):t=!0}this._isInterpolating=t}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.JZ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;var b,Z;this.alpha=function(t){let b=Math.PI/2;return 0===t.x&&0===t.z||(b=Math.acos(t.x/Math.sqrt(Math.pow(t.x,2)+Math.pow(t.z,2)))),t.z<0&&(b=2*Math.PI-b),b}(this._computationVector),this.beta=(b=this._computationVector.y,Z=this.radius,Math.acos(b/Z));const J=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*J*Math.PI,this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.S(t),this.rebuildAnglesAndRadius())}setTarget(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(J=this.overrideCloneAlphaBetaRadius??J,t.sb)b&&t.getBoundingInfo?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.sb(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=t,J=this._getTargetPosition();if(J&&!Z&&J.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}J||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),b=Math.sin(this.alpha),Z=Math.cos(this.beta);let J=Math.sin(this.beta);0===J&&(J=1e-4),0===this.radius&&(this.radius=1e-4);const S=this._getTargetPosition();if(this._computationVector.Ab(this.radius*t*J,this.radius*Z,this.radius*b*J),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.JZ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),S.addToRef(this._computationVector,this._newPosition),this.et().collisionsEnabled&&this.checkCollisions){const t=this.et().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.S(this._newPosition);let t=this.upVector;this.allowUpsideDown&&J<0&&(t=t.negate()),this._computeViewMatrix(this._position,S,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.S(S),this._viewMatrix}zoomOn(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=t||this.et().meshes;const Z=Y.b.MinMax(t);let J=this._calculateLowerRadiusFromModelBoundingSphere(Z.min,Z.max);if(J=Math.max(Math.min(J,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=J*this.zoomOnFactor,this.mode===l.e.ORTHOGRAPHIC_CAMERA){const t=this.et().getEngine().getAspectRatio(this),b=J*this.zoomOnFactor/2;this.orthoLeft=-b*t,this.orthoRight=b*t,this.orthoBottom=-b,this.orthoTop=b}this.focusOn({min:Z.min,max:Z.max,distance:J},b)}focusOn(t){let b,Z,J=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===t.min){const J=t||this.et().meshes;b=Y.b.MinMax(J),Z=v.JZ.Distance(b.min,b.max)}else{b=t,Z=t.distance}this._target=Y.b.Center(b),J||(this.maxZ=2*Z)}createRigCamera(t,b){let Z=0;switch(this.cameraRigMode){case l.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.e.RIG_MODE_VR:Z=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Z=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const J=new d(t,this.alpha+Z,this.beta,this.radius,this._target,this.et());return J._cameraRigParams={},J.isRigCamera=!0,J.rigParent=this,J.upVector=this.upVector,J.mode=this.mode,J.orthoLeft=this.orthoLeft,J.orthoRight=this.orthoRight,J.orthoBottom=this.orthoBottom,J.orthoTop=this.orthoTop,J}_updateRigCameras(){const t=this._rigCameras[0],b=this._rigCameras[1];switch(t.beta=b.beta=this.beta,this.cameraRigMode){case l.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.e.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case l.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const J=v.JZ.Distance(t,b),S=this.et().getEngine().getAspectRatio(this),P=Math.tan(this.fov/2),h=P*S,C=.5*J*Z,Y=C*Math.sqrt(1+1/(h*h)),g=C*Math.sqrt(1+1/(P*P));return Math.max(Y,g)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,J.e)([(0,S.N)()],d.prototype,"alpha",void 0),(0,J.e)([(0,S.N)()],d.prototype,"beta",void 0),(0,J.e)([(0,S.N)()],d.prototype,"radius",void 0),(0,J.e)([(0,S.N)()],d.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,J.e)([(0,S.J)("target")],d.prototype,"_target",void 0),(0,J.e)([(0,S.v)("targetHost")],d.prototype,"_targetHost",void 0),(0,J.e)([(0,S.N)()],d.prototype,"inertialAlphaOffset",void 0),(0,J.e)([(0,S.N)()],d.prototype,"inertialBetaOffset",void 0),(0,J.e)([(0,S.N)()],d.prototype,"inertialRadiusOffset",void 0),(0,J.e)([(0,S.N)()],d.prototype,"lowerAlphaLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"upperAlphaLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"lowerBetaLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"upperBetaLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"lowerRadiusLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"upperRadiusLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"lowerTargetYLimit",void 0),(0,J.e)([(0,S.N)()],d.prototype,"inertialPanningX",void 0),(0,J.e)([(0,S.N)()],d.prototype,"inertialPanningY",void 0),(0,J.e)([(0,S.N)()],d.prototype,"pinchToPanMaxDistance",void 0),(0,J.e)([(0,S.N)()],d.prototype,"panningDistanceLimit",void 0),(0,J.e)([(0,S.J)()],d.prototype,"panningOriginTarget",void 0),(0,J.e)([(0,S.N)()],d.prototype,"panningInertia",void 0),(0,J.e)([(0,S.N)()],d.prototype,"zoomToMouseLocation",null),(0,J.e)([(0,S.N)()],d.prototype,"zoomOnFactor",void 0),(0,J.e)([(0,S.G)()],d.prototype,"targetScreenOffset",void 0),(0,J.e)([(0,S.N)()],d.prototype,"allowUpsideDown",void 0),(0,J.e)([(0,S.N)()],d.prototype,"useInputToRestoreState",void 0),(0,J.e)([(0,S.N)()],d.prototype,"restoreStateInterpolationFactor",void 0),(0,n.f)("BABYLON.ArcRotateCamera",d)},14314:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>v,d:()=>h});var J=Z(12557),S=Z(12760),P=Z(13193),v={};class h{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const b=t.getSimpleName();this.attached[b]?J.c.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const b in this.attached){const Z=this.attached[b];if(Z===t)return Z.Ur(),Z.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(t){for(const b in this.attached){const Z=this.attached[b];Z.getClassName()===t&&(Z.Ur(),Z.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(t){const b=this.checkInputs;return()=>{b(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){t=!P.e.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const b in this.attached)this.attached[b].attachControl(t)}}detachElement(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].Ur(),t&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const b=this.attached[t];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const b={};for(const Z in this.attached){const t=this.attached[Z],J=S.d.Serialize(t);b[t.getClassName()]=J}t.inputsmgr=b}parse(t){const b=t.inputsmgr;if(b){this.clear();for(const t in b){const Z=v[t];if(Z){const J=b[t],P=S.d.Parse((()=>new Z),J,null);this.add(P)}}}else for(const Z in this.attached){const b=v[this.attached[Z].getClassName()];if(b){const J=S.d.Parse((()=>new b),t,null);this.remove(this.attached[Z]),this.add(J)}}}}},14308:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>H});var J=Z(12721),S=Z(12726),P=Z(12735),v=Z(13222),h=Z(14314),C=Z(13020),Y=Z(12549);class g{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(t){t=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.et(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Z=b.event;if(!Z.metaKey)if(b.type===C.d.KEYDOWN){if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){-1===this._keys.indexOf(Z.keyCode)&&this._keys.push(Z.keyCode),t||Z.preventDefault()}}else if(-1!==this.keysUp.indexOf(Z.keyCode)||-1!==this.keysDown.indexOf(Z.keyCode)||-1!==this.keysLeft.indexOf(Z.keyCode)||-1!==this.keysRight.indexOf(Z.keyCode)||-1!==this.keysUpward.indexOf(Z.keyCode)||-1!==this.keysDownward.indexOf(Z.keyCode)||-1!==this.keysRotateLeft.indexOf(Z.keyCode)||-1!==this.keysRotateRight.indexOf(Z.keyCode)||-1!==this.keysRotateUp.indexOf(Z.keyCode)||-1!==this.keysRotateDown.indexOf(Z.keyCode)){const b=this._keys.indexOf(Z.keyCode);b>=0&&this._keys.splice(b,1),t||Z.preventDefault()}})))}Ur(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let b=0;b<this._keys.length;b++){const Z=this._keys[b],J=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Z)?t._localDirection.Ab(-J,0,0):-1!==this.keysUp.indexOf(Z)?t._localDirection.Ab(0,0,J):-1!==this.keysRight.indexOf(Z)?t._localDirection.Ab(J,0,0):-1!==this.keysDown.indexOf(Z)?t._localDirection.Ab(0,0,-J):-1!==this.keysUpward.indexOf(Z)?t._localDirection.Ab(0,J,0):-1!==this.keysDownward.indexOf(Z)?t._localDirection.Ab(0,-J,0):-1!==this.keysRotateLeft.indexOf(Z)?(t._localDirection.Ab(0,0,0),t.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Z)?(t._localDirection.Ab(0,0,0),t.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Z)?(t._localDirection.Ab(0,0,0),t.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Z)&&(t._localDirection.Ab(0,0,0),t.cameraRotation.x+=this._getLocalRotation()),t.et().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),P.JZ.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const t=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*t}}(0,J.e)([(0,S.N)()],g.prototype,"keysUp",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysUpward",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysDown",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysDownward",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysLeft",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysRight",void 0),(0,J.e)([(0,S.N)()],g.prototype,"rotationSpeed",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysRotateLeft",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysRotateRight",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysRotateUp",void 0),(0,J.e)([(0,S.N)()],g.prototype,"keysRotateDown",void 0),h.b.FreeCameraKeyboardMoveInput=g;var I=Z(12551),r=Z(13013);class M{constructor(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=t,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new I.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(t){t=Y.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Z=b.getInputElement();this._pointerInput||(this._pointerInput=J=>{const S=J.event,P="touch"===S.pointerType;if(!this.touchEnabled&&P)return;if(J.type!==r.e.POINTERMOVE&&-1===this.buttons.indexOf(S.button))return;const v=S.target;if(J.type===r.e.POINTERDOWN){if(P&&-1!==this._activePointerId||!P&&-1!==this._currentActiveButton)return;this._activePointerId=S.pointerId;try{null===v||void 0===v||v.setPointerCapture(S.pointerId)}catch(h){}-1===this._currentActiveButton&&(this._currentActiveButton=S.button),this._previousPosition={x:S.clientX,y:S.clientY},t||(S.preventDefault(),Z&&Z.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(J.event)}else if(J.type===r.e.POINTERUP){if(P&&this._activePointerId!==S.pointerId||!P&&this._currentActiveButton!==S.button)return;try{null===v||void 0===v||v.releasePointerCapture(S.pointerId)}catch(h){}this._currentActiveButton=-1,this._previousPosition=null,t||S.preventDefault(),this._activePointerId=-1}else if(J.type===r.e.POINTERMOVE&&(this._activePointerId===S.pointerId||!P))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(J.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),Z=(S.clientX-this._previousPosition.x)*b,J=S.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Z/this.angularSensibility,this.camera.cameraRotation.x+=J/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Z,offsetY:J}),this._previousPosition={x:S.clientX,y:S.clientY},t||S.preventDefault()}}),this._onMouseMove=Z=>{if(!b.isPointerLock)return;const J=this.camera._calculateHandednessMultiplier(),S=Z.movementX*J;this.camera.cameraRotation.y+=S/this.angularSensibility;const P=Z.movementY;this.camera.cameraRotation.x+=P/this.angularSensibility,this._previousPosition=null,t||Z.preventDefault()},this._observer=this.camera.et()._inputManager._addCameraPointerObserver(this._pointerInput,r.e.POINTERDOWN|r.e.POINTERUP|r.e.POINTERMOVE),Z&&(this._contextMenuBind=t=>this.onContextMenu(t),Z.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(t){t.preventDefault()}Ur(){if(this._observer){if(this.camera.et()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,J.e)([(0,S.N)()],M.prototype,"buttons",void 0),(0,J.e)([(0,S.N)()],M.prototype,"angularSensibility",void 0),h.b.FreeCameraMouseInput=M;var T,a=Z(13022);class k{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new I.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(t){t=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==r.e.POINTERWHEEL)return;const Z=b.event,J=Z.deltaMode===a.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*J*Z.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*J*Z.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*J*Z.deltaZ/this._normalize,Z.preventDefault&&(t||Z.preventDefault())},this._observer=this.camera.et()._inputManager._addCameraPointerObserver(this._wheel,r.e.POINTERWHEEL)}Ur(){this._observer&&(this.camera.et()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,J.e)([(0,S.N)()],k.prototype,"wheelPrecisionX",void 0),(0,J.e)([(0,S.N)()],k.prototype,"wheelPrecisionY",void 0),(0,J.e)([(0,S.N)()],k.prototype,"wheelPrecisionZ",void 0),function(t){t[t.MoveRelative=0]="MoveRelative",t[t.RotateRelative=1]="RotateRelative",t[t.MoveScene=2]="MoveScene"}(T||(T={}));class u extends k{constructor(){super(...arguments),this._moveRelative=P.JZ.Zero(),this._rotateRelative=P.JZ.Zero(),this._moveScene=P.JZ.Zero(),this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(t){null===t&&this._wheelXAction!==T.MoveRelative||(this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=t)}get wheelXMoveRelative(){return this._wheelXAction!==T.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(t){null===t&&this._wheelYAction!==T.MoveRelative||(this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=t)}get wheelYMoveRelative(){return this._wheelYAction!==T.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(t){null===t&&this._wheelZAction!==T.MoveRelative||(this._wheelZAction=T.MoveRelative,this._wheelZActionCoordinate=t)}get wheelZMoveRelative(){return this._wheelZAction!==T.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(t){null===t&&this._wheelXAction!==T.RotateRelative||(this._wheelXAction=T.RotateRelative,this._wheelXActionCoordinate=t)}get wheelXRotateRelative(){return this._wheelXAction!==T.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(t){null===t&&this._wheelYAction!==T.RotateRelative||(this._wheelYAction=T.RotateRelative,this._wheelYActionCoordinate=t)}get wheelYRotateRelative(){return this._wheelYAction!==T.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(t){null===t&&this._wheelZAction!==T.RotateRelative||(this._wheelZAction=T.RotateRelative,this._wheelZActionCoordinate=t)}get wheelZRotateRelative(){return this._wheelZAction!==T.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(t){null===t&&this._wheelXAction!==T.MoveScene||(this._wheelXAction=T.MoveScene,this._wheelXActionCoordinate=t)}get wheelXMoveScene(){return this._wheelXAction!==T.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(t){null===t&&this._wheelYAction!==T.MoveScene||(this._wheelYAction=T.MoveScene,this._wheelYActionCoordinate=t)}get wheelYMoveScene(){return this._wheelYAction!==T.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(t){null===t&&this._wheelZAction!==T.MoveScene||(this._wheelZAction=T.MoveScene,this._wheelZActionCoordinate=t)}get wheelZMoveScene(){return this._wheelZAction!==T.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Lb(0),this._rotateRelative.Lb(0),this._moveScene.Lb(0),this._updateCamera(),this.camera.et().useRightHandedSystem&&(this._moveRelative.z*=-1);const t=P.Matrix.Zero();this.camera.getViewMatrix().invertToRef(t);const b=P.JZ.Zero();P.JZ.TransformNormalToRef(this._moveRelative,t,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(t,b,Z){if(0===t)return;if(null===b||null===Z)return;let J=null;switch(b){case T.MoveRelative:J=this._moveRelative;break;case T.RotateRelative:J=this._rotateRelative;break;case T.MoveScene:J=this._moveScene}switch(Z){case 0:J.set(t,0,0);break;case 1:J.set(0,t,0);break;case 2:J.set(0,0,t)}}}(0,J.e)([(0,S.N)()],u.prototype,"wheelXMoveRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelYMoveRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelZMoveRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelXRotateRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelYRotateRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelZRotateRelative",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelXMoveScene",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelYMoveScene",null),(0,J.e)([(0,S.N)()],u.prototype,"wheelZMoveScene",null),h.b.FreeCameraMouseWheelInput=u;class l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=t,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Y.Tools.IsSafari()}attachControl(t){t=Y.Tools.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Z=>{const J=Z.event,S="mouse"===J.pointerType||this._isSafari&&"undefined"===typeof J.pointerType;if(this.allowMouse||!S)if(Z.type===r.e.POINTERDOWN){if(t||J.preventDefault(),this._pointerPressed.push(J.pointerId),1!==this._pointerPressed.length)return;b={x:J.clientX,y:J.clientY}}else if(Z.type===r.e.POINTERUP){t||J.preventDefault();const Z=this._pointerPressed.indexOf(J.pointerId);if(-1===Z)return;if(this._pointerPressed.splice(Z,1),0!=Z)return;b=null,this._offsetX=null,this._offsetY=null}else if(Z.type===r.e.POINTERMOVE){if(t||J.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(J.pointerId))return;this._offsetX=J.clientX-b.x,this._offsetY=-(J.clientY-b.y)}}),this._observer=this.camera.et()._inputManager._addCameraPointerObserver(this._pointerInput,r.e.POINTERDOWN|r.e.POINTERUP|r.e.POINTERMOVE),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.addEventListener("blur",this._onLostFocus)}}Ur(){if(this._pointerInput){if(this._observer&&(this.camera.et()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const t=this.camera.getEngine().getInputElement();t&&t.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const t=this.camera,b=t._calculateHandednessMultiplier();t.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)t.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=t._computeLocalCameraSpeed(),Z=new P.JZ(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);P.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(P.JZ.TransformCoordinates(Z,t._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,J.e)([(0,S.N)()],l.prototype,"touchAngularSensibility",void 0),(0,J.e)([(0,S.N)()],l.prototype,"touchMoveSensibility",void 0),h.b.FreeCameraTouchInput=l;class U extends h.d{constructor(t){super(t),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new g),this}addMouse(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new M(t),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new u,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new l),this}clear(){super.clear(),this._mouseInput=null}}var E=Z(12688),c=Z(12623);class H extends v.b{get angularSensibility(){const t=this.inputs.attached.mouse;return t?t.angularSensibility:0}set angularSensibility(t){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysUp=t)}get keysUpward(){const t=this.inputs.attached.keyboard;return t?t.keysUpward:[]}set keysUpward(t){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysDown=t)}get keysDownward(){const t=this.inputs.attached.keyboard;return t?t.keysDownward:[]}set keysDownward(t){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRight=t)}get keysRotateLeft(){const t=this.inputs.attached.keyboard;return t?t.keysRotateLeft:[]}set keysRotateLeft(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=t)}get keysRotateRight(){const t=this.inputs.attached.keyboard;return t?t.keysRotateRight:[]}set keysRotateRight(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=t)}get keysRotateUp(){const t=this.inputs.attached.keyboard;return t?t.keysRotateUp:[]}set keysRotateUp(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=t)}get keysRotateDown(){const t=this.inputs.attached.keyboard;return t?t.keysRotateDown:[]}set keysRotateDown(t){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=t)}constructor(t,b,Z){var J;super(t,b,Z,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),J=this,this.ellipsoid=new P.JZ(.5,1,.5),this.ellipsoidOffset=new P.JZ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=P.JZ.Zero(),this._diffPosition=P.JZ.Zero(),this._newPosition=P.JZ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;J._newPosition.S(b),J._newPosition.subtractToRef(J._oldPosition,J._diffPosition),J._diffPosition.length()>c.e.CollisionsEpsilon&&(J.position.addToRef(J._diffPosition,J._deferredPositionUpdate),J._deferOnly?J._deferredUpdated=!0:J.position.S(J._deferredPositionUpdate),J.ST&&Z&&J.ST(Z))},this.inputs=new U(this),this.inputs.addKeyboard().addMouse()}attachControl(t,b){b=Y.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}Ur(){this.inputs.detachElement(),this.cameraDirection=new P.JZ(0,0,0),this.cameraRotation=new P.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(t){this._collisionMask=isNaN(t)?-1:t}_collideWithWorld(t){let b;b=this.parent?P.JZ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Z=this.et().collisionCoordinator;this._collider||(this._collider=Z.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let J=t;this.applyGravity&&(J=t.add(this.et().gravity)),Z.getNewPosition(this._oldPosition,J,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=P.JZ.Zero(),this._transformedDirection=P.JZ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(t){this._needMoveForGravity=t}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.et().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"hh"}}(0,J.e)([(0,S.J)()],H.prototype,"ellipsoid",void 0),(0,J.e)([(0,S.J)()],H.prototype,"ellipsoidOffset",void 0),(0,J.e)([(0,S.N)()],H.prototype,"checkCollisions",void 0),(0,J.e)([(0,S.N)()],H.prototype,"applyGravity",void 0),(0,E.f)("BABYLON.FreeCamera",H)},14952:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>P});var J=Z(12826),S=Z(14959);class P{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Z,this.KI=[],this._maxBlockCapacity=b||64,this._selectionContent=new J.d(1024),this._creationFunc=t}update(t,b,Z){S.e._CreateBlocks(t,b,Z,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Fg(t){for(let b=0;b<this.SI.length;b++){this.SI[b].addEntry(t)}}Kg(t){for(let b=0;b<this.SI.length;b++){this.SI[b].removeEntry(t)}}select(t,b){this._selectionContent.reset();for(let Z=0;Z<this.SI.length;Z++){this.SI[Z].select(t,this._selectionContent,b)}return b?this._selectionContent.concat(this.KI):this._selectionContent.concatWithNoDuplicate(this.KI),this._selectionContent}intersects(t,b,Z){this._selectionContent.reset();for(let J=0;J<this.SI.length;J++){this.SI[J].intersects(t,b,this._selectionContent,Z)}return Z?this._selectionContent.concat(this.KI):this._selectionContent.concatWithNoDuplicate(this.KI),this._selectionContent}intersectsRay(t){this._selectionContent.reset();for(let b=0;b<this.SI.length;b++){this.SI[b].intersectsRay(t,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.KI),this._selectionContent}}P.CreationFuncForMeshes=(t,b)=>{const Z=t.getBoundingInfo();!t.isBlocked&&Z.boundingBox.intersectsMinMax(b.xI,b.iI)&&b.entries.push(t)},P.CreationFuncForSubMeshes=(t,b)=>{t.getBoundingInfo().boundingBox.intersectsMinMax(b.xI,b.iI)&&b.entries.push(t)}},14959:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>P});var J=Z(12735),S=Z(13084);class P{constructor(t,b,Z,J,S,P){this.entries=[],this.zI=new Array,this._capacity=Z,this._depth=J,this._maxDepth=S,this._creationFunc=P,this._minPoint=t,this._maxPoint=b,this.zI.push(t.clone()),this.zI.push(b.clone()),this.zI.push(t.clone()),this.zI[2].x=b.x,this.zI.push(t.clone()),this.zI[3].y=b.y,this.zI.push(t.clone()),this.zI[4].z=b.z,this.zI.push(b.clone()),this.zI[5].z=t.z,this.zI.push(b.clone()),this.zI[6].x=t.x,this.zI.push(b.clone()),this.zI[7].y=t.y}get gZ(){return this._capacity}get xI(){return this._minPoint}get iI(){return this._maxPoint}addEntry(t){if(this.SI)for(let b=0;b<this.SI.length;b++){this.SI[b].addEntry(t)}else this._creationFunc(t,this),this.entries.length>this.gZ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(t){if(this.SI){for(let b=0;b<this.SI.length;b++){this.SI[b].removeEntry(t)}return}const b=this.entries.indexOf(t);b>-1&&this.entries.splice(b,1)}addEntries(t){for(let b=0;b<t.length;b++){const Z=t[b];this.addEntry(Z)}}select(t,b,Z){if(S.b.IsInFrustum(this.zI,t)){if(this.SI){for(let J=0;J<this.SI.length;J++){this.SI[J].select(t,b,Z)}return}Z?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(t,b,Z,J){if(S.b.IntersectsSphere(this._minPoint,this._maxPoint,t,b)){if(this.SI){for(let S=0;S<this.SI.length;S++){this.SI[S].intersects(t,b,Z,J)}return}J?Z.concat(this.entries):Z.concatWithNoDuplicate(this.entries)}}intersectsRay(t,b){if(t.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.SI){for(let Z=0;Z<this.SI.length;Z++){this.SI[Z].intersectsRay(t,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){P._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(t,b,Z,S,v,h,C,Y){C.SI=new Array;const g=new J.JZ((b.x-t.x)/2,(b.y-t.y)/2,(b.z-t.z)/2);for(let J=0;J<2;J++)for(let b=0;b<2;b++)for(let I=0;I<2;I++){const r=t.add(g.multiplyByFloats(J,b,I)),M=t.add(g.multiplyByFloats(J+1,b+1,I+1)),T=new P(r,M,S,v+1,h,Y);T.addEntries(Z),C.SI.push(T)}}}},14961:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>g});var J=Z(12975),S=Z(12735),P=Z(13159),v=Z(14083),h=Z(13009),C=Z(14952),Y=Z(12585);J.d.prototype.createOrUpdateSelectionOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Z=this._getComponent(h.d.NAME_OCTREE);Z||(Z=new g(this),this.Mb(Z)),this.NI||(this.NI=new C.c(C.c.CreationFuncForMeshes,t,b));const J=this.getWorldExtends();return this.NI.update(J.min,J.max,this.meshes),this.NI},Object.defineProperty(J.d.prototype,"selectionOctree",{get:function(){return this.NI},enumerable:!0,configurable:!0}),P.b.prototype.createOrUpdateSubmeshesOctree=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Z=this.et();let J=Z._getComponent(h.d.NAME_OCTREE);J||(J=new g(Z),Z.Mb(J)),this._submeshesOctree||(this._submeshesOctree=new C.c(C.c.CreationFuncForSubMeshes,t,b)),this.sb(!0);const S=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(S.minimumWorld,S.maximumWorld,this.Wb),this._submeshesOctree};class g{constructor(t){this.name=h.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new v.e(S.JZ.Zero(),new S.JZ(1,1,1)),(t=t||Y.e.LastCreatedScene)&&(this.PZ=t,this.PZ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.PZ.getActiveSubMeshCandidates=t=>this.getActiveSubMeshCandidates(t),this.PZ.getCollidingSubMeshCandidates=(t,b)=>this.getCollidingSubMeshCandidates(t,b),this.PZ.getIntersectingSubMeshCandidates=(t,b)=>this.getIntersectingSubMeshCandidates(t,b))}register(){this.PZ.onMeshRemovedObservable.add((t=>{const b=this.PZ.selectionOctree;if(void 0!==b&&null!==b){const Z=b.KI.indexOf(t);-1!==Z&&b.KI.splice(Z,1)}})),this.PZ.onMeshImportedObservable.add((t=>{const b=this.PZ.selectionOctree;void 0!==b&&null!==b&&b.Fg(t)}))}getActiveMeshCandidates(){var t;return(null===(t=this.PZ.NI)||void 0===t?void 0:t.select(this.PZ.frustumPlanes))||this.PZ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(t){if(t._submeshesOctree&&t.useOctreeForRenderingSelection){return t._submeshesOctree.select(this.PZ.frustumPlanes)}return this.PZ._getDefaultSubMeshCandidates(t)}getIntersectingSubMeshCandidates(t,b){if(t._submeshesOctree&&t.useOctreeForPicking){v.e.TransformToRef(b,t.getWorldMatrix(),this._tempRay);return t._submeshesOctree.intersectsRay(this._tempRay)}return this.PZ._getDefaultSubMeshCandidates(t)}getCollidingSubMeshCandidates(t,b){if(t._submeshesOctree&&t.useOctreeForCollisions){const Z=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return t._submeshesOctree.intersects(b._basePointWorld,Z)}return this.PZ._getDefaultSubMeshCandidates(t)}rebuild(){}dispose(){}}},14083:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>M});var J=Z(12975),S=Z(13193),P=Z(12737),v=Z(12735),h=Z(12742),C=Z(13070),Y=Z(13007),g=Z(12585),I=Z(13024);const r={internalPickerForMesh:void 0};class M{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.e;this.origin=t,this.direction=b,this.length=Z,this.epsilon=J}clone(){return new M(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=M._TmpVector3[0].Ab(t.x-Z,t.y-Z,t.z-Z),S=M._TmpVector3[1].Ab(b.x+Z,b.y+Z,b.z+Z);let P,v,h,C,Y=0,g=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<J.x||this.origin.x>S.x)return!1}else if(P=1/this.direction.x,v=(J.x-this.origin.x)*P,h=(S.x-this.origin.x)*P,h===-1/0&&(h=1/0),v>h&&(C=v,v=h,h=C),Y=Math.max(v,Y),g=Math.min(h,g),Y>g)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<J.y||this.origin.y>S.y)return!1}else if(P=1/this.direction.y,v=(J.y-this.origin.y)*P,h=(S.y-this.origin.y)*P,h===-1/0&&(h=1/0),v>h&&(C=v,v=h,h=C),Y=Math.max(v,Y),g=Math.min(h,g),Y>g)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<J.z||this.origin.z>S.z)return!1}else if(P=1/this.direction.z,v=(J.z-this.origin.z)*P,h=(S.z-this.origin.z)*P,h===-1/0&&(h=1/0),v>h&&(C=v,v=h,h=C),Y=Math.max(v,Y),g=Math.min(h,g),Y>g)return!1;return!0}intersectsBox(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(t.minimum,t.maximum,b)}intersectsSphere(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=t.center.x-this.origin.x,J=t.center.y-this.origin.y,S=t.center.z-this.origin.z,P=Z*Z+J*J+S*S,v=t.radius+b,h=v*v;if(P<=h)return!0;const C=Z*this.direction.x+J*this.direction.y+S*this.direction.z;if(C<0)return!1;return P-C*C<=h}intersectsTriangle(t,b,Z){const J=M._TmpVector3[0],S=M._TmpVector3[1],P=M._TmpVector3[2],h=M._TmpVector3[3],Y=M._TmpVector3[4];b.subtractToRef(t,J),Z.subtractToRef(t,S),v.JZ.CrossToRef(this.direction,S,P);const g=v.JZ.Dot(J,P);if(0===g)return null;const I=1/g;this.origin.subtractToRef(t,h);const r=v.JZ.Dot(h,P)*I;if(r<-this.epsilon||r>1+this.epsilon)return null;v.JZ.CrossToRef(h,J,Y);const T=v.JZ.Dot(this.direction,Y)*I;if(T<-this.epsilon||r+T>1+this.epsilon)return null;const a=v.JZ.Dot(S,Y)*I;return a>this.length?null:new C.c(1-r-T,r,a)}intersectsPlane(t){let b;const Z=v.JZ.Dot(t.normal,this.direction);if(Math.abs(Z)<9.99999997475243e-7)return null;{const J=v.JZ.Dot(t.normal,this.origin);return b=(-t.d-J)/Z,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t){case"y":{const t=(this.origin.y-b)/this.direction.y;return t>0?null:new v.JZ(this.origin.x+this.direction.x*-t,b,this.origin.z+this.direction.z*-t)}case"x":{const t=(this.origin.x-b)/this.direction.x;return t>0?null:new v.JZ(b,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t)}case"z":{const t=(this.origin.z-b)/this.direction.z;return t>0?null:new v.JZ(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,b)}default:return null}}intersectsMesh(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=v.TmpVectors.Matrix[0];return t.getWorldMatrix().invertToRef(h),this._tmpRay?M.TransformToRef(this,h,this._tmpRay):this._tmpRay=M.Transform(this,h),t.intersects(this._tmpRay,b,Z,J,S,P)}intersectsMeshes(t,b,Z){Z?Z.length=0:Z=[];for(let J=0;J<t.length;J++){const S=this.intersectsMesh(t[J],b);S.hit&&Z.push(S)}return Z.sort(this._comparePickingInfo),Z}_comparePickingInfo(t,b){return t.distance<b.distance?-1:t.distance>b.distance?1:0}intersectionSegment(t,b,Z){const J=this.origin,S=v.TmpVectors.JZ[0],P=v.TmpVectors.JZ[1],h=v.TmpVectors.JZ[2],C=v.TmpVectors.JZ[3];b.subtractToRef(t,S),this.direction.scaleToRef(M._Rayl,h),J.addToRef(h,P),t.subtractToRef(J,C);const Y=v.JZ.Dot(S,S),g=v.JZ.Dot(S,h),I=v.JZ.Dot(h,h),r=v.JZ.Dot(S,C),T=v.JZ.Dot(h,C),a=Y*I-g*g;let k,u,l=a,U=a;a<M._Smallnum?(k=0,l=1,u=T,U=I):(k=g*T-I*r,u=Y*T-g*r,k<0?(k=0,u=T,U=I):k>l&&(k=l,u=T+g,U=I)),u<0?(u=0,-r<0?k=0:-r>Y?k=l:(k=-r,l=Y)):u>U&&(u=U,-r+g<0?k=0:-r+g>Y?k=l:(k=-r+g,l=Y));const E=Math.abs(k)<M._Smallnum?0:k/l,c=Math.abs(u)<M._Smallnum?0:u/U,H=v.TmpVectors.JZ[4];h.scaleToRef(c,H);const o=v.TmpVectors.JZ[5];S.scaleToRef(E,o),o.addInPlace(C);const O=v.TmpVectors.JZ[6];o.subtractToRef(H,O);return c>0&&c<=this.length&&O.lengthSquared()<Z*Z?o.length():-1}update(t,b,Z,J,S,P,h){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){M._RayDistant||(M._RayDistant=M.Zero()),M._RayDistant.unprojectRayToRef(t,b,Z,J,v.Matrix.IdentityReadOnly,P,h);const C=v.TmpVectors.Matrix[0];S.invertToRef(C),M.TransformToRef(M._RayDistant,C,this)}else this.unprojectRayToRef(t,b,Z,J,S,P,h);return this}static Zero(){return new M(v.JZ.Zero(),v.JZ.Zero())}static CreateNew(t,b,Z,J,S,P,v){return M.Zero().update(t,b,Z,J,S,P,v)}static CreateNewFromTo(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.Matrix.IdentityReadOnly;const J=new M(new v.JZ(0,0,0),new v.JZ(0,0,0));return M.CreateFromToToRef(t,b,J,Z)}static CreateFromToToRef(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.Matrix.IdentityReadOnly;Z.origin.S(t);const S=b.subtractToRef(t,Z.direction),P=Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z);return Z.length=P,Z.direction.normalize(),M.TransformToRef(Z,J,Z)}static Transform(t,b){const Z=new M(new v.JZ(0,0,0),new v.JZ(0,0,0));return M.TransformToRef(t,b,Z),Z}static TransformToRef(t,b,Z){v.JZ.TransformCoordinatesToRef(t.origin,b,Z.origin),v.JZ.TransformNormalToRef(t.direction,b,Z.direction),Z.length=t.length,Z.epsilon=t.epsilon;const J=Z.direction,S=J.length();if(0!==S&&1!==S){const t=1/S;J.x*=t,J.y*=t,J.z*=t,Z.length*=S}return Z}unprojectRayToRef(t,b,Z,J,S,P,h){const C=v.TmpVectors.Matrix[0];S.multiplyToRef(P,C),C.multiplyToRef(h,C),C.invert();const Y=g.e.LastCreatedEngine,I=v.TmpVectors.JZ[0];I.x=t/Z*2-1,I.y=-(b/J*2-1),I.z=null!==Y&&void 0!==Y&&Y.Tb?1:null!==Y&&void 0!==Y&&Y.isNDCHalfZRange?0:-1;const r=v.TmpVectors.JZ[1].Ab(I.x,I.y,1-1e-8),M=v.TmpVectors.JZ[2],T=v.TmpVectors.JZ[3];v.JZ._UnprojectFromInvertedMatrixToRef(I,C,M),v.JZ._UnprojectFromInvertedMatrixToRef(r,C,T),this.origin.S(M),T.subtractToRef(M,this.direction),this.direction.normalize()}}function T(t,b,Z,J,S){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=M.Zero();return a(t,b,Z,J,v,S,P),v}function a(t,b,Z,J,S,P){let h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Y=t.getEngine();if(!P&&!(P=t.activeCamera))return t;const g=P.viewport,I=Y.getRenderHeight(),{x:r,y:M,width:T,height:a}=g.toGlobal(Y.getRenderWidth(),I),k=1/Y.getHardwareScalingLevel();return b=b*k-r,Z=Z*k-(I-M-a),S.update(b,Z,T,a,J||v.Matrix.IdentityReadOnly,h?v.Matrix.IdentityReadOnly:P.getViewMatrix(),P.getProjectionMatrix(),C),t}function k(t,b,Z,J,S){if(!Y.d)return t;const P=t.getEngine();if(!S&&!(S=t.activeCamera))throw new Error("Active camera not set");const h=S.viewport,C=P.getRenderHeight(),{x:g,y:I,width:r,height:M}=h.toGlobal(P.getRenderWidth(),C),T=v.Matrix.Identity(),a=1/P.getHardwareScalingLevel();return b=b*a-g,Z=Z*a-(C-I-M),J.update(b,Z,r,M,T,T,S.getProjectionMatrix()),t}function u(t,b,Z,J,S,P,v,h){const C=b(J,Z.enableDistantPicking),Y=Z.intersects(C,S,v,P,J,h);return Y&&Y.hit?!S&&null!=t&&Y.distance>=t.distance?null:Y:null}function l(t,b,Z,J,S,P){let h=null;const C=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),g=t.cameraToUseForPointers||t.activeCamera,I=r.internalPickerForMesh||u;for(let Y=0;Y<t.meshes.length;Y++){const r=t.meshes[Y];if(Z){if(!Z(r,-1))continue}else if(!r.isEnabled()||!r.isVisible||!r.IY)continue;const M=C&&r.isWorldMatrixCameraDependent(),T=r.sb(M,g);if(r.hasThinInstances&&r.zY){const t=I(h,b,r,T,!0,!0,P);if(t){if(S)return t;const C=v.TmpVectors.Matrix[1],Y=r.thinInstanceGetWorldMatrices();for(let t=0;t<Y.length;t++){if(Z&&!Z(r,t))continue;Y[t].multiplyToRef(T,C);const v=I(h,b,r,C,J,S,P,!0);if(v&&(h=v,h.thinInstanceIndex=t,J))return h}}}else{const t=I(h,b,r,T,J,S,P);if(t&&(h=t,J))return h}}return h||new Y.d}function U(t,b,Z,J){if(!Y.d)return null;const S=[],P=!!(t.activeCameras&&t.activeCameras.length>1&&t.cameraToUseForPointers!==t.activeCamera),h=t.cameraToUseForPointers||t.activeCamera,C=r.internalPickerForMesh||u;for(let Y=0;Y<t.meshes.length;Y++){const g=t.meshes[Y];if(Z){if(!Z(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.IY)continue;const I=P&&g.isWorldMatrixCameraDependent(),r=g.sb(I,h);if(g.hasThinInstances&&g.zY){if(C(null,b,g,r,!0,!0,J)){const t=v.TmpVectors.Matrix[1],P=g.thinInstanceGetWorldMatrices();for(let v=0;v<P.length;v++){if(Z&&!Z(g,v))continue;P[v].multiplyToRef(r,t);const h=C(null,b,g,t,!1,!1,J,!0);h&&(h.thinInstanceIndex=v,S.push(h))}}}else{const t=C(null,b,g,r,!1,!1,J);t&&S.push(t)}}return S}function E(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,J=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0;J||(J=t.getWorldMatrix()),b.length=Z,S?b.origin.S(S):b.origin.S(t.position);const P=v.TmpVectors.JZ[2];P.set(0,0,t._scene.useRightHandedSystem?-1:1);const h=v.TmpVectors.JZ[3];return v.JZ.TransformNormalToRef(P,J,h),v.JZ.NormalizeToRef(h,b.direction),b}var c,H;M._TmpVector3=(0,h.c)(6,v.JZ.Zero),M._RayDistant=M.Zero(),M._Smallnum=1e-8,M._Rayl=1e9,c=J.d,(H=S.e)&&(H.prototype.getForwardRay=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2?arguments[2]:void 0;return E(this,new M(v.JZ.Zero(),v.JZ.Zero(),t),t,b,Z)},H.prototype.getForwardRayToRef=function(t){return E(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),c&&(I.d._IsPickingAvailable=!0,c.prototype.createPickingRay=function(t,b,Z,J){return T(this,t,b,Z,J,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),J.d.prototype.createPickingRayToRef=function(t,b,Z,J,S){return a(this,t,b,Z,J,S,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},J.d.prototype.createPickingRayInCameraSpace=function(t,b,Z){return function(t,b,Z,J){const S=M.Zero();return k(t,b,Z,S,J),S}(this,t,b,Z)},J.d.prototype.createPickingRayInCameraSpaceToRef=function(t,b,Z,J){return k(this,t,b,Z,J)},J.d.prototype.pickWithBoundingInfo=function(t,b,Z,J,S){return function(t,b,Z,J,S,P){if(!Y.d)return null;const h=l(t,(J=>(t._tempPickingRay||(t._tempPickingRay=M.Zero()),a(t,b,Z,J,t._tempPickingRay,P||null),t._tempPickingRay)),J,S,!0);return h&&(h.ray=T(t,b,Z,v.Matrix.Identity(),P||null)),h}(this,t,b,Z,J,S)},J.d.prototype.bJ=function(t,b,Z,J,S,P){return function(t,b,Z,J,S,P,h){const C=l(t,((J,S)=>(t._tempPickingRay||(t._tempPickingRay=M.Zero()),a(t,b,Z,J,t._tempPickingRay,P||null,!1,S),t._tempPickingRay)),J,S,!1,h);return C&&(C.ray=T(t,b,Z,v.Matrix.Identity(),P||null)),C}(this,t,b,Z,J,S,P)},J.d.prototype.pickWithRay=function(t,b,Z,J){return function(t,b,Z,J,S){const P=l(t,(Z=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=v.Matrix.Identity()),Z.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=M.Zero()),M.TransformToRef(b,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),Z,J,!1,S);return P&&(P.ray=b),P}(this,t,b,Z,J)},J.d.prototype.multiPick=function(t,b,Z,J,S){return function(t,b,Z,J,S,P){return U(t,(J=>T(t,b,Z,J,S||null)),J,P)}(this,t,b,Z,J,S)},J.d.prototype.multiPickWithRay=function(t,b,Z){return function(t,b,Z,J){return U(t,(Z=>(t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=v.Matrix.Identity()),Z.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=M.Zero()),M.TransformToRef(b,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform)),Z,J)}(this,t,b,Z)}},14368:(t,b,Z)=>{"use strict";var J=Z(12663),S=Z(12557),P=Z(12593),v=Z(12693),h=Z(12623),C=Z(12674);h.e.prototype._partialLoadFile=function(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(t,(t=>{Z[b]=t,Z._internalCount++,6===Z._internalCount&&J(Z)}),void 0,void 0,!0,((t,b)=>{S&&t&&S(t.status+" "+t.statusText,b)}))},h.e.prototype._cascadeLoadFiles=function(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=[];S._internalCount=0;for(let P=0;P<6;P++)this._partialLoadFile(Z[P],P,S,b,J)},h.e.prototype._cascadeLoadImgs=function(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5?arguments[5]:void 0;const v=[];v._internalCount=0;for(let h=0;h<6;h++)this._partialLoadImg(J[h],h,v,t,b,Z,S,P)},h.e.prototype._partialLoadImg=function(t,b,Z,J,S,h){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7?arguments[7]:void 0;const g=(0,v.c)();(0,P.r)(t,(t=>{Z[b]=t,Z._internalCount++,J&&J.removePendingData(g),6===Z._internalCount&&h&&h(S,Z)}),((t,b)=>{J&&J.removePendingData(g),C&&C(t,b)}),J?J.offlineProvider:null,Y),J&&J.addPendingData(g)},h.e.prototype.createCubeTextureBase=function(t,b,Z,P){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,M=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,a=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,k=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,u=arguments.length>14&&void 0!==arguments[14]&&arguments[14],l=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const U=T||new J.d(this,7);U.isCube=!0,U.url=t,U.generateMipMaps=!P,U._lodGenerationScale=r,U._lodGenerationOffset=M,U._useSRGBBuffer=!!u&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!P),U!==T&&(U.label=t.substring(0,60)),this._doNotHandleContextLost||(U._extension=g,U._files=Z,U._buffer=l);const E=t;this._transformTextureUrl&&!T&&(t=this._transformTextureUrl(t));const c=g??function(t){const b=t.split("?")[0],Z=b.lastIndexOf(".");return Z>-1?b.substring(Z).toLowerCase():""}(t),H=(0,C.b)(c),o=(t,b)=>{U.dispose(),h?h(t,b):t&&S.c.Warn(t)},O=(J,h)=>{t===E?J&&o(J.status+" "+J.statusText,h):(S.c.Warn(`Failed to load ${t}, falling back to the ${E}`),this.createCubeTextureBase(E,b,Z,!!P,v,o,Y,g,I,r,M,U,a,k,u,l))};if(H)H.then((J=>{const S=t=>{a&&a(U,t),J.loadCubeData(t,U,I,v,((t,b)=>{o(t,b)}))};l?S(l):Z&&6===Z.length?J.supportCascades?this._cascadeLoadFiles(b,(t=>S(t.map((t=>new Uint8Array(t))))),Z,o):o("Textures type does not support cascades."):this._loadFile(t,(t=>S(new Uint8Array(t))),void 0,void 0,!0,O)}));else{if(!Z||0===Z.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,U,((t,b)=>{k&&k(t,b)}),Z,o)}return this._internalTexturesCache.push(U),U}},14964:(t,b,Z)=>{"use strict";Z(12557);var J=Z(12860);Z(12663),Z(12805),Z(12658),Z(12915),Z(12873);J.b},14397:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>S});var J=Z(12688);class S{constructor(t){this.value=this._toInt(t)}_toInt(t){return 0|t}add(t){return new S(this.value+t.value)}SZ(t){return new S(this.value-t.value)}multiply(t){return new S(Math.imul(this.value,t.value))}divide(t){return new S(this.value/t.value)}getClassName(){return S.ClassName}equals(t){return this.value===t.value}static FromValue(t){return new S(t)}toString(){return this.value.toString()}}S.ClassName="FlowGraphInteger",(0,J.f)("FlowGraphInteger",S)},14414:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>S,g:()=>P});var J=Z(12735);class S{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.cb=t}get m(){return this.cb}transformVector(t){return this.transformVectorToRef(t,new J.Vector2)}transformVectorToRef(t,b){return b.x=t.x*this.cb[0]+t.y*this.cb[1],b.y=t.x*this.cb[2]+t.y*this.cb[3],b}jb(){return this.toArray()}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<4;b++)t[b]=this.cb[b];return t}ZJ(t){for(let b=0;b<4;b++)this.cb[b]=t[b];return this}multiplyToRef(t,b){const Z=t.cb,J=this.cb,S=b.cb;return S[0]=Z[0]*J[0]+Z[1]*J[2],S[1]=Z[0]*J[1]+Z[1]*J[3],S[2]=Z[2]*J[0]+Z[3]*J[2],S[3]=Z[2]*J[1]+Z[3]*J[3],b}multiply(t){return this.multiplyToRef(t,new S)}divideToRef(t,b){const Z=this.cb,J=t.cb,S=b.cb;return S[0]=Z[0]/J[0],S[1]=Z[1]/J[1],S[2]=Z[2]/J[2],S[3]=Z[3]/J[3],b}divide(t){return this.divideToRef(t,new S)}addToRef(t,b){const Z=this.cb,J=t.m,S=b.m;return S[0]=Z[0]+J[0],S[1]=Z[1]+J[1],S[2]=Z[2]+J[2],S[3]=Z[3]+J[3],b}add(t){return this.addToRef(t,new S)}subtractToRef(t,b){const Z=this.cb,J=t.m,S=b.m;return S[0]=Z[0]-J[0],S[1]=Z[1]-J[1],S[2]=Z[2]-J[2],S[3]=Z[3]-J[3],b}SZ(t){return this.subtractToRef(t,new S)}transpose(){const t=this.cb;return new S([t[0],t[2],t[1],t[3]])}determinant(){const t=this.cb;return t[0]*t[3]-t[1]*t[2]}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const b=this.cb,Z=1/t;return new S([b[3]*Z,-b[1]*Z,-b[2]*Z,b[0]*Z])}equals(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.cb,J=t.m;return 0===b?Z[0]===J[0]&&Z[1]===J[1]&&Z[2]===J[2]&&Z[3]===J[3]:Math.abs(Z[0]-J[0])<b&&Math.abs(Z[1]-J[1])<b&&Math.abs(Z[2]-J[2])<b&&Math.abs(Z[3]-J[3])<b}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.cb.join(", ")})`}}class P{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.cb=t}get m(){return this.cb}transformVector(t){return this.transformVectorToRef(t,new J.JZ)}transformVectorToRef(t,b){const Z=this.cb;return b.x=t.x*Z[0]+t.y*Z[1]+t.z*Z[2],b.y=t.x*Z[3]+t.y*Z[4]+t.z*Z[5],b.z=t.x*Z[6]+t.y*Z[7]+t.z*Z[8],b}multiplyToRef(t,b){const Z=t.cb,J=this.cb,S=b.m;return S[0]=Z[0]*J[0]+Z[1]*J[3]+Z[2]*J[6],S[1]=Z[0]*J[1]+Z[1]*J[4]+Z[2]*J[7],S[2]=Z[0]*J[2]+Z[1]*J[5]+Z[2]*J[8],S[3]=Z[3]*J[0]+Z[4]*J[3]+Z[5]*J[6],S[4]=Z[3]*J[1]+Z[4]*J[4]+Z[5]*J[7],S[5]=Z[3]*J[2]+Z[4]*J[5]+Z[5]*J[8],S[6]=Z[6]*J[0]+Z[7]*J[3]+Z[8]*J[6],S[7]=Z[6]*J[1]+Z[7]*J[4]+Z[8]*J[7],S[8]=Z[6]*J[2]+Z[7]*J[5]+Z[8]*J[8],b}multiply(t){return this.multiplyToRef(t,new P)}divideToRef(t,b){const Z=this.cb,J=t.m,S=b.m;return S[0]=Z[0]/J[0],S[1]=Z[1]/J[1],S[2]=Z[2]/J[2],S[3]=Z[3]/J[3],S[4]=Z[4]/J[4],S[5]=Z[5]/J[5],S[6]=Z[6]/J[6],S[7]=Z[7]/J[7],S[8]=Z[8]/J[8],b}divide(t){return this.divideToRef(t,new P)}addToRef(t,b){const Z=this.cb,J=t.m,S=b.m;return S[0]=Z[0]+J[0],S[1]=Z[1]+J[1],S[2]=Z[2]+J[2],S[3]=Z[3]+J[3],S[4]=Z[4]+J[4],S[5]=Z[5]+J[5],S[6]=Z[6]+J[6],S[7]=Z[7]+J[7],S[8]=Z[8]+J[8],b}add(t){return this.addToRef(t,new P)}subtractToRef(t,b){const Z=this.cb,J=t.m,S=b.m;return S[0]=Z[0]-J[0],S[1]=Z[1]-J[1],S[2]=Z[2]-J[2],S[3]=Z[3]-J[3],S[4]=Z[4]-J[4],S[5]=Z[5]-J[5],S[6]=Z[6]-J[6],S[7]=Z[7]-J[7],S[8]=Z[8]-J[8],b}SZ(t){return this.subtractToRef(t,new P)}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<9;b++)t[b]=this.cb[b];return t}jb(){return this.toArray()}ZJ(t){for(let b=0;b<9;b++)this.cb[b]=t[b];return this}transpose(){const t=this.cb;return new P([t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]])}determinant(){const t=this.cb;return t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6])}inverse(){const t=this.determinant();if(0===t)throw new Error("Matrix is not invertible");const b=this.cb,Z=1/t;return new P([(b[4]*b[8]-b[5]*b[7])*Z,(b[2]*b[7]-b[1]*b[8])*Z,(b[1]*b[5]-b[2]*b[4])*Z,(b[5]*b[6]-b[3]*b[8])*Z,(b[0]*b[8]-b[2]*b[6])*Z,(b[2]*b[3]-b[0]*b[5])*Z,(b[3]*b[7]-b[4]*b[6])*Z,(b[1]*b[6]-b[0]*b[7])*Z,(b[0]*b[4]-b[1]*b[3])*Z])}equals(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Z=this.cb,J=t.m;return 0===b?Z[0]===J[0]&&Z[1]===J[1]&&Z[2]===J[2]&&Z[3]===J[3]&&Z[4]===J[4]&&Z[5]===J[5]&&Z[6]===J[6]&&Z[7]===J[7]&&Z[8]===J[8]:Math.abs(Z[0]-J[0])<b&&Math.abs(Z[1]-J[1])<b&&Math.abs(Z[2]-J[2])<b&&Math.abs(Z[3]-J[3])<b&&Math.abs(Z[4]-J[4])<b&&Math.abs(Z[5]-J[5])<b&&Math.abs(Z[6]-J[6])<b&&Math.abs(Z[7]-J[7])<b&&Math.abs(Z[8]-J[8])<b}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.cb.join(", ")})`}}},14420:(t,b,Z)=>{"use strict";var J;function S(t,b,Z,J){switch(b){case"Animation":return J?t.animations.find((t=>t.uniqueId===Z))??null:t.animations[Z]??null;case"AnimationGroup":return J?t.animationGroups.find((t=>t.uniqueId===Z))??null:t.animationGroups[Z]??null;case"Mesh":return J?t.meshes.find((t=>t.uniqueId===Z))??null:t.meshes[Z]??null;case"Material":return J?t.materials.find((t=>t.uniqueId===Z))??null:t.materials[Z]??null;case"tI":return J?t.cameras.find((t=>t.uniqueId===Z))??null:t.cameras[Z]??null;case"Light":return J?t.lights.find((t=>t.uniqueId===Z))??null:t.lights[Z]??null;default:return null}}Z.d(b,{b:()=>S}),function(t){t.Animation="Animation",t.AnimationGroup="AnimationGroup",t.Mesh="Mesh",t.Material="Material",t.tI="tI",t.Light="Light"}(J||(J={}))},14458:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>S});var J=Z(14464);class S extends J.e{constructor(t,b){if(super(t),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),b)for(const Z of b)this._eventsSignalOutputs[Z]=this._registerSignalOutput(Z+"Event")}_executeOnTick(t){}_startPendingTasks(t){t._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(t),this._resetAfterCanceled(t)),this._preparePendingTasks(t),t._addPendingBlock(this),this.out._activateSignal(t),t._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(t){t._deleteExecutionVariable(this,"_initialized"),t._removePendingBlock(this)}}},14432:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>Y});var J=Z(12693),S=Z(12688),P=Z(14441),v=Z(12551),h=Z(14388);class C extends P.b{constructor(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:J.defaultValue,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(t,b,Z),this.richType=J,this._defaultValue=S,this._optional=P,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new v.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(t){this._isDisabled!==t&&(this._isDisabled=t,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(t,b){b._getConnectionValue(this)!==t&&(b._setConnectionValue(this,t),this.onValueChangedObservable.notifyObservers(t))}resetToDefaultValue(t){t._setConnectionValue(this,this._defaultValue)}connectTo(t){this._isDisabled||super.connectTo(t)}_getValueOrDefault(t){const b=t._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(b):b}getValue(t){if(1===this.connectionType){t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(t);const b=this._getValueOrDefault(t);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}const b=this.isConnected()?this._connectedPoint[0].getValue(t):this._getValueOrDefault(t);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.richType={},this.richType.serialize(t.richType),t.optional=this._optional,(0,h.g)("defaultValue",this._defaultValue,t)}}(0,S.f)("FlowGraphDataConnection",C);class Y{constructor(t){var b;this.config=t,this.uniqueId=(0,J.c)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(t){}registerDataInput(t,b,Z){const J=new C(t,0,this,b,Z);return this.dataInputs.push(J),J}registerDataOutput(t,b,Z){const J=new C(t,1,this,b,Z);return this.dataOutputs.push(J),J}getDataInput(t){return this.dataInputs.find((b=>b.name===t))}getDataOutput(t){return this.dataOutputs.find((b=>b.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.g;if(t.uniqueId=this.uniqueId,t.config={},this.config){const Z=this.config,J=Object.keys(Z);for(const S of J)b(S,Z[S],t.config)}t.dataInputs=[],t.dataOutputs=[],t.className=this.getClassName();for(const Z of this.dataInputs){const b={};Z.serialize(b),t.dataInputs.push(b)}for(const Z of this.dataOutputs){const b={};Z.serialize(b),t.dataOutputs.push(b)}}deserialize(t){}_log(t,b,Z){var J;null===(J=t.logger)||void 0===J||J.addLogItem({action:b,JJ:Z,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14441:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>P});var J,S=Z(12693);!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(J||(J={}));class P{constructor(t,b,Z){this._ownerBlock=Z,this._connectedPoint=[],this.uniqueId=(0,S.c)(),this.connectedPointIds=[],this.name=t,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(t){if(this._connectionType===t._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||t._isSingularConnection()&&t._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(t),t._connectedPoint.push(this)}disconnectFrom(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=this._connectedPoint.indexOf(t),J=t._connectedPoint.indexOf(this);-1!==Z&&-1!==J&&(b&&this._connectedPoint.splice(Z,1),t._connectedPoint.splice(J,1))}disconnectFromAll(){for(const t of this._connectedPoint)this.disconnectFrom(t,!1);this._connectedPoint.length=0}dispose(){for(const t of this._connectedPoint)this.disconnectFrom(t)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.uniqueId=this.uniqueId,t.name=this.name,t._connectionType=this._connectionType,t.connectedPointIds=[],t.className=this.getClassName();for(const b of this._connectedPoint)t.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(t){this.uniqueId=t.uniqueId,this.name=t.name,this._connectionType=t._connectionType,this.connectedPointIds=t.connectedPointIds}}},14386:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>U});var J,S=Z(12551),P=Z(12721),v=Z(12726),h=Z(12693),C=Z(14388),Y=Z(14420),g=Z(12557);!function(t){t.ExecuteBlock="ExecuteBlock",t.ExecuteEvent="ExecuteEvent",t.TriggerConnection="TriggerConnection",t.ContextVariableSet="ContextVariableSet",t.GlobalVariableSet="GlobalVariableSet",t.GlobalVariableDelete="GlobalVariableDelete",t.GlobalVariableGet="GlobalVariableGet",t.AddConnection="AddConnection",t.GetConnectionValue="GetConnectionValue",t.SetConnectionValue="SetConnectionValue",t.ActivateSignal="ActivateSignal",t.ContextVariableGet="ContextVariableGet"}(J||(J={}));class I{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(t){if(t.time||(t.time=Date.now()),this.log.push(t),this.logToConsole){var b;const Z=null===(b=t.JJ)||void 0===b?void 0:b.value;"object"===typeof Z&&Z.getClassName?g.c.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(Z.getClassName())}: ${Z.toString()}`):g.c.Log(`[FGLog] ${t.className}:${t.uniqueId.split("-")[0]} ${t.action} - ${JSON.stringify(t.JJ)}`)}}getItemsOfType(t){return this.log.filter((b=>b.action===t))}}class r{get enableLogging(){return this._enableLogging}set enableLogging(t){this._enableLogging!==t&&(this._enableLogging=t,this._enableLogging?(this.logger=new I,this.logger.logToConsole=!0):this.logger=null)}constructor(t){this.uniqueId=(0,h.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new S.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=t,this.assetsContext=t.assetsContext??t.PZ}hasVariable(t){return t in this._userVariables}setVariable(t,b){var Z;this._userVariables[t]=b,null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",JJ:{name:t,value:b}})}getAsset(t,b){return(0,Y.b)(this.assetsContext,t,b)}getVariable(t){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",JJ:{name:t,value:this._userVariables[t]}}),this._userVariables[t]}get userVariables(){return this._userVariables}et(){return this._configuration.PZ}_getUniqueIdPrefixedName(t,b){return`${t.uniqueId}_${b}`}_getGlobalContextVariable(t,b){var Z;return null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",JJ:{name:t,defaultValue:b,possibleValue:this._globalContextVariables[t]}}),this._hasGlobalContextVariable(t)?this._globalContextVariables[t]:b}_setGlobalContextVariable(t,b){var Z;null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",JJ:{name:t,value:b}}),this._globalContextVariables[t]=b}_deleteGlobalContextVariable(t){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",JJ:{name:t}}),delete this._globalContextVariables[t]}_hasGlobalContextVariable(t){return t in this._globalContextVariables}_setExecutionVariable(t,b,Z){this._executionVariables[this._getUniqueIdPrefixedName(t,b)]=Z}_getExecutionVariable(t,b,Z){return this._hasExecutionVariable(t,b)?this._executionVariables[this._getUniqueIdPrefixedName(t,b)]:Z}_deleteExecutionVariable(t,b){delete this._executionVariables[this._getUniqueIdPrefixedName(t,b)]}_hasExecutionVariable(t,b){return this._getUniqueIdPrefixedName(t,b)in this._executionVariables}_hasConnectionValue(t){return t.uniqueId in this._connectionValues}_setConnectionValue(t,b){var Z;this._connectionValues[t.uniqueId]=b,null===(Z=this.logger)||void 0===Z||Z.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",JJ:{connectionPointId:t.uniqueId,value:b}})}_setConnectionValueByKey(t,b){this._connectionValues[t]=b}_getConnectionValue(t){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",JJ:{connectionPointId:t.uniqueId,value:this._connectionValues[t.uniqueId]}}),this._connectionValues[t.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(t){this._pendingBlocks.includes(t)||(this._pendingBlocks.push(t),this._pendingBlocks.sort(((t,b)=>t.priority-b.priority)))}_removePendingBlock(t){const b=this._pendingBlocks.indexOf(t);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const t of this._pendingBlocks)t._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(t){var b;this.onNodeExecutedObservable.notifyObservers(t),null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:t.getClassName(),uniqueId:t.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(t){this._setGlobalContextVariable("timeSinceStart",t.timeSinceStart),this._setGlobalContextVariable("deltaTime",t.deltaTime);for(const Z of this._pendingBlocks){var b;null===(b=Z._executeOnTick)||void 0===b||b.call(Z,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.g;t.uniqueId=this.uniqueId,t._userVariables={};for(const J in this._userVariables)b(J,this._userVariables[J],t._userVariables);t._connectionValues={};for(const J in this._connectionValues)b(J,this._connectionValues[J],t._connectionValues);var Z;this.assetsContext!==this.et()&&(t._assetsContext={meshes:this.assetsContext.meshes.map((t=>t.id)),materials:this.assetsContext.materials.map((t=>t.id)),textures:this.assetsContext.textures.map((t=>t.name)),animations:this.assetsContext.animations.map((t=>t.name)),lights:this.assetsContext.lights.map((t=>t.id)),cameras:this.assetsContext.cameras.map((t=>t.id)),HM:null===(Z=this.assetsContext.HM)||void 0===Z?void 0:Z.map((t=>t.name)),skeletons:this.assetsContext.skeletons.map((t=>t.id)),Lr:this.assetsContext.Lr.map((t=>t.name)),geometries:this.assetsContext.geometries.map((t=>t.id)),multiMaterials:this.assetsContext.multiMaterials.map((t=>t.id)),transformNodes:this.assetsContext.transformNodes.map((t=>t.id))})}getClassName(){return"FlowGraphContext"}}(0,P.e)([(0,v.N)()],r.prototype,"uniqueId",void 0);var M=Z(14424),T=Z(13013);class a{constructor(t){this.onEventTriggeredObservable=new S.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=t,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.lb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const t=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",JJ:{timeSinceStart:this._startingTime,deltaTime:t}}),this._startingTime+=t})),this._meshPickedObserver=this._scene.onPointerObservable.add((t=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",JJ:t})}),T.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((t=>{const b=t.pointerId,Z=t.mesh,J=this._pointerUnderMeshState[b];!J&&Z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",JJ:{pointerId:b,mesh:Z}}):J&&!Z?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",JJ:{pointerId:b,mesh:J}}):J&&Z&&J!==Z&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",JJ:{pointerId:b,mesh:J,over:Z}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",JJ:{pointerId:b,mesh:Z,out:J}})),this._pointerUnderMeshState[b]=Z}),T.e.POINTERMOVE)}dispose(){var t,b,Z,J,S;null===(t=this._sceneDisposeObserver)||void 0===t||t.remove(),null===(b=this._sceneReadyObserver)||void 0===b||b.remove(),null===(Z=this._sceneOnBeforeRenderObserver)||void 0===Z||Z.remove(),null===(J=this._meshPickedObserver)||void 0===J||J.remove(),null===(S=this._meshUnderPointerObserver)||void 0===S||S.remove(),this.onEventTriggeredObservable.clear()}}var k,u=Z(14449);!function(t){t[t.Stopped=0]="Stopped",t[t.Started=1]="Started"}(k||(k={}));class l{get state(){return this._state}set state(t){this._state=t,this.onStateChangedObservable.notifyObservers(t)}constructor(t){this.onStateChangedObservable=new S.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=t.PZ,this._sceneEventCoordinator=new a(this._scene),this._coordinator=t.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((t=>{for(const b of this._executionContexts){const Z=this._getContextualOrder(t.type,b);for(const J of Z)if(!J._executeEvent(b,t.JJ))break}switch(t.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const b of this._executionContexts)b._notifyOnTick(t.JJ);break;case"SceneDispose":this.dispose()}}))}createContext(){const t=new r({PZ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(t),t}getContext(t){return this._executionContexts[t]}addEventBlock(t){if("PointerOver"!==t.type&&"PointerOut"!==t.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==t.type&&this._eventBlocks[t.type].push(t),1===this.state)for(const b of this._executionContexts)t._startPendingTasks(b);else this.onStateChangedObservable.addOnce((b=>{if(1===b)for(const Z of this._executionContexts)t._startPendingTasks(Z)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((t=>{1===t&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const t of this._executionContexts)for(const b in this._eventBlocks){const Z=this._getContextualOrder(b,t);for(const b of Z)b._startPendingTasks(t)}}_getContextualOrder(t,b){const Z=this._eventBlocks[t].sort(((t,b)=>b.initPriority-t.initPriority));if("MeshPick"===t){const t=[];for(const J of Z){const S=J.asset.getValue(b);let P=0;for(;P<Z.length;P++){const t=Z[P].asset.getValue(b);if(S&&t&&(0,u.h)(S,t))break}t.splice(P,0,J)}return t}return Z}dispose(){var t;if(0!==this.state){this.state=0;for(const t of this._executionContexts)t._clearPendingBlocks();this._executionContexts.length=0;for(const t in this._eventBlocks)this._eventBlocks[t].length=0;null===(t=this._eventObserver)||void 0===t||t.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(t){const b=[],Z=new Set;for(const J in this._eventBlocks)for(const t of this._eventBlocks[J])b.push(t),Z.add(t.uniqueId);for(;b.length>0;){const J=b.pop();t(J);for(const t of J.dataInputs)for(const J of t._connectedPoint)Z.has(J._ownerBlock.uniqueId)||(b.push(J._ownerBlock),Z.add(J._ownerBlock.uniqueId));if(J instanceof M.e)for(const t of J.signalOutputs)for(const J of t._connectedPoint)Z.has(J._ownerBlock.uniqueId)||(b.push(J._ownerBlock),Z.add(J._ownerBlock.uniqueId))}}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;t.allBlocks=[],this.visitAllBlocks((b=>{const Z={};b.serialize(Z),t.allBlocks.push(Z)})),t.executionContexts=[];for(const Z of this._executionContexts){const J={};Z.serialize(J,b),t.executionContexts.push(J)}}}class U{constructor(t){this.config=t,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.PZ.lb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.PZ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const t=this._executeOnNextFrame.slice(0);if(t.length)for(const b of t){this.notifyCustomEvent(b.id,b.data,!1);const t=this._executeOnNextFrame.findIndex((t=>t.uniqueId===b.uniqueId));-1!==t&&this._executeOnNextFrame.splice(t,1)}}));(U.SceneCoordinators.get(this.config.PZ)??[]).push(this)}createGraph(){const t=new l({PZ:this.config.PZ,coordinator:this});return this._flowGraphs.push(t),t}removeGraph(t){const b=this._flowGraphs.indexOf(t);-1!==b&&(t.dispose(),this._flowGraphs.splice(b,1))}start(){for(const t of this._flowGraphs)t.start()}dispose(){var t,b;for(const S of this._flowGraphs)S.dispose();this._flowGraphs.length=0,null===(t=this._disposeObserver)||void 0===t||t.remove(),null===(b=this._onBeforeRenderObserver)||void 0===b||b.remove();const Z=U.SceneCoordinators.get(this.config.PZ)??[],J=Z.indexOf(this);-1!==J&&Z.splice(J,1)}serialize(t,b){t._flowGraphs=[];for(const Z of this._flowGraphs){const J={};Z.serialize(J,b),t._flowGraphs.push(J)}t.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(t){let b=this._customEventsMap.get(t);return b||(b=new S.d,this._customEventsMap.set(t,b)),b}notifyCustomEvent(t,b){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:t,data:b,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(t)){const b=this._eventExecutionCounter.get(t);if(this._eventExecutionCounter.set(t,b+1),b>=U.MaxEventTypeExecutionPerFrame)return void(b===U.MaxEventTypeExecutionPerFrame&&g.c.Warn(`FlowGraphCoordinator: Too many executions of event "${t}".`))}else this._eventExecutionCounter.set(t,1);const Z=this._customEventsMap.get(t);Z&&Z.notifyObservers(b)}}U.MaxEventsPerType=30,U.MaxEventTypeExecutionPerFrame=30,U.SceneCoordinators=new Map},14452:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>S});var J=Z(14458);class S extends J.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(t){t._notifyExecuteNode(this),this.done._activateSignal(t)}}},14424:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>h});var J=Z(14432),S=Z(14441),P=Z(12688);class v extends S.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(t){super.connectTo(t),this._connectedPoint.sort(((t,b)=>b.priority-t.priority))}_activateSignal(t){var b;if(null===(b=t.logger)||void 0===b||b.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,JJ:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)t._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(t,this),t._increaseExecutionId();else for(const Z of this._connectedPoint)Z._activateSignal(t)}}(0,P.f)("FlowGraphSignalConnection",v);class h extends J.e{constructor(t){super(t),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(t){const b=new v(t,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(t){const b=new v(t,1,this);return this.signalOutputs.push(b),b}_unregisterSignalInput(t){const b=this.signalInputs.findIndex((b=>b.name===t));-1!==b&&(this.signalInputs[b].dispose(),this.signalInputs.splice(b,1))}_unregisterSignalOutput(t){const b=this.signalOutputs.findIndex((b=>b.name===t));-1!==b&&(this.signalOutputs[b].dispose(),this.signalOutputs.splice(b,1))}_reportError(t,b){this.error.JJ="string"===typeof b?new Error(b):b,this.error._activateSignal(t)}getSignalInput(t){return this.signalInputs.find((b=>b.name===t))}getSignalOutput(t){return this.signalOutputs.find((b=>b.name===t))}serialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(t),t.signalInputs=[],t.signalOutputs=[];for(const b of this.signalInputs){const Z={};b.serialize(Z),t.signalInputs.push(Z)}for(const b of this.signalOutputs){const Z={};b.serialize(Z),t.signalOutputs.push(Z)}}deserialize(t){for(let b=0;b<t.signalInputs.length;b++){const Z=this.getSignalInput(t.signalInputs[b].name);if(!Z)throw new Error("Could not find signal input with name "+t.signalInputs[b].name+" in block "+t.className);Z.deserialize(t.signalInputs[b])}for(let b=0;b<t.signalOutputs.length;b++){const Z=this.getSignalOutput(t.signalOutputs[b].name);if(!Z)throw new Error("Could not find signal output with name "+t.signalOutputs[b].name+" in block "+t.className);Z.deserialize(t.signalOutputs[b])}}getClassName(){return"FlowGraphExecutionBlock"}}},14464:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>S});var J=Z(14424);class S extends J.e{constructor(t){super(t),this.out=this._registerSignalOutput("out")}}},14405:(t,b,Z)=>{"use strict";Z.d(b,{A:()=>M,D:()=>T,F:()=>a,H:()=>p,K:()=>e,O:()=>O,S:()=>o,c:()=>Y,f:()=>r,j:()=>H,k:()=>k,n:()=>u,p:()=>l,q:()=>I,u:()=>c,x:()=>g});var J,S=Z(12735),P=Z(12775),v=Z(14397),h=Z(14414);!function(t){t.Any="any",t.String="string",t.Number="number",t.Boolean="boolean",t.Object="object",t.Integer="FlowGraphInteger",t.Vector2="Vector2",t.JZ="JZ",t.Vector4="Vector4",t.Quaternion="Quaternion",t.Matrix="Matrix",t.Matrix2D="Matrix2D",t.Matrix3D="Matrix3D",t.hZ="hZ",t.Fb="Fb"}(J||(J={}));class C{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=t,this.defaultValue=b,this.animationType=Z}serialize(t){t.typeName=this.typeName,t.defaultValue=this.defaultValue}}const Y=new C("any",void 0),g=new C("string",""),I=new C("number",0,0),r=new C("boolean",!1),M=new C("Vector2",S.Vector2.Zero(),5),T=new C("JZ",S.JZ.Zero(),1),a=new C("Vector4",S.Vector4.Zero()),k=new C("Matrix",S.Matrix.Identity(),3),u=new C("Matrix2D",new h.c),l=new C("Matrix3D",new h.g),U=new C("hZ",P.hZ.Black(),4),E=new C("Fb",new P.Fb(0,0,0,0),7),c=new C("Quaternion",S.Quaternion.Identity(),2);c.typeTransformer=t=>{if(t.getClassName){if("Vector4"===t.getClassName())return S.Quaternion.CZ(t.jb());if("JZ"===t.getClassName())return S.Quaternion.FromEulerVector(t);if("Matrix"===t.getClassName())return S.Quaternion.FromRotationMatrix(t)}return t};const H=new C("FlowGraphInteger",new v.b(0),0);function o(t){const b=t;switch(typeof t){case"string":return g;case"number":return I;case"boolean":return r;case"object":if(b.getClassName)switch(b.getClassName()){case"Vector2":return M;case"JZ":return T;case"Vector4":return a;case"Matrix":return k;case"hZ":return U;case"Fb":return E;case"Quaternion":return c;case"FlowGraphInteger":return H;case"Matrix2D":return u;case"Matrix3D":return l}return Y;default:return Y}}function O(t){switch(t){case"string":return g;case"number":return I;case"boolean":return r;case"Vector2":return M;case"JZ":return T;case"Vector4":return a;case"Matrix":return k;case"hZ":return U;case"Fb":return E;case"Quaternion":return c;case"FlowGraphInteger":return H;case"Matrix2D":return u;case"Matrix3D":return l;default:return Y}}function p(t){switch(t){case"number":default:return 0;case"Vector2":return 5;case"JZ":return 1;case"Matrix":return 3;case"hZ":return 4;case"Fb":return 7;case"Quaternion":return 2}}function e(t){switch(t){case 0:return I;case 5:return M;case 1:return T;case 3:return k;case 4:return U;case 7:return E;case 2:return c;default:return Y}}},14388:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>g,g:()=>Y,k:()=>I});var J=Z(12775),S=Z(12735),P=Z(14397),v=Z(14405),h=Z(14414);function C(t){return"Vector2"===t||"JZ"===t||"Vector4"===t||"Quaternion"===t||"hZ"===t||"Fb"===t}function Y(t,b,Z){var J;const S=(null===b||void 0===b||null===(J=b.getClassName)||void 0===J?void 0:J.call(b))??"";if(C(S)||function(t){return"Matrix"===t||"Matrix2D"===t||"Matrix3D"===t}(S))Z[t]={value:b.jb(),className:S};else if("FlowGraphInteger"===S)Z[t]={value:b.value,className:S};else if(S&&(b.id||b.name))Z[t]={id:b.id,name:b.name,className:S};else{if("object"===typeof b)throw new Error(`Could not serialize value ${b}`);Z[t]=b}}function g(t,b,Z,Y){const I=b[t];let r;const M=(null===I||void 0===I?void 0:I.type)??(null===I||void 0===I?void 0:I.className);if(function(t){return"Mesh"===t||"AbstractMesh"===t||"GroundMesh"===t||"InstanceMesh"===t||"LinesMesh"===t||"GoldbergMesh"===t||"GreasedLineMesh"===t||"TrailMesh"===t}(M)){let t=Y.meshes.filter((t=>I.id?t.id===I.id:t.name===I.name));0===t.length&&(t=Y.transformNodes.filter((t=>I.id?t.id===I.id:t.name===I.name))),r=I.uniqueId?t.find((t=>t.uniqueId===I.uniqueId)):t[0]}else if(C(M))r=function(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===t)return S.Vector2.CZ(b);if("JZ"===t)return Z&&(b[2]*=-1),S.JZ.CZ(b);if("Vector4"===t)return S.Vector4.CZ(b);if("Quaternion"===t)return Z&&(b[2]*=-1,b[3]*=-1),S.Quaternion.CZ(b);if("hZ"===t)return new J.hZ(b[0],b[1],b[2]);if("Fb"===t)return new J.Fb(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${t}`)}(M,I.value);else if(function(t){return"AnimationGroup"===t}(M)){const t=Y.animationGroups.filter((t=>t.name===I.name));r=1===t.length?t[0]:t.find((t=>t.uniqueId===I.uniqueId))}else r="Matrix"===M?S.Matrix.CZ(I.value):"Matrix2D"===M?new h.c(I.value):"Matrix3D"===M?new h.g(I.value):"FlowGraphInteger"===M?P.b.FromValue(I.value):"number"===M||"string"===M||"boolean"===M?I.value[0]:I&&void 0!==I.value?I.value:Array.isArray(I)?I.reduce(((t,b)=>b.eventData?(t[b.id]={type:(0,v.O)(b.type)},"undefined"!==typeof b.value&&(t[b.id].value=g("value",b,Z,Y)),t):t),{}):I;return r}function I(t){return"FlowGraphJsonPointerParserBlock"===t}},14449:(t,b,Z)=>{"use strict";function J(t,b){return!(!t.parent||t.parent!==b&&!J(t.parent,b))}function S(t){if(t.getClassName)return t.getClassName()}function P(t,b){return t===b&&("Vector2"===t||"JZ"===t||"Vector4"===t||"Quaternion"===t)}function v(t,b){return t===b&&("Matrix"===t||"Matrix2D"===t||"Matrix3D"===t)}function h(t,b){return"FlowGraphInteger"===t&&"FlowGraphInteger"===b}function C(t,b){const Z="number"===typeof t||"number"===typeof(null===t||void 0===t?void 0:t.value);return Z&&!b?!isNaN(Y(t)):Z}function Y(t){return"number"===typeof t?t:t.value}Z.d(b,{b:()=>h,c:()=>v,e:()=>P,g:()=>S,h:()=>J,j:()=>Y,n:()=>C})},13800:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{SceneInstrumentation:()=>P});var J=Z(12549),S=Z(12946);class P{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(t){t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.PZ.onBeforeActiveMeshesEvaluationObservable.add((()=>{J.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.PZ.onAfterActiveMeshesEvaluationObservable.add((()=>{J.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.PZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.PZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(t){t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.PZ.onBeforeRenderTargetsRenderObservable.add((()=>{J.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.PZ.onAfterRenderTargetsRenderObservable.add((()=>{J.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.PZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.PZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(t){t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.PZ.onBeforeParticlesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.PZ.onAfterParticlesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.PZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.PZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(t){t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,this.PZ.spriteManagers&&(t?(this._onBeforeSpritesRenderingObserver=this.PZ.onBeforeSpritesRenderingObservable.add((()=>{J.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.PZ.onAfterSpritesRenderingObservable.add((()=>{J.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.PZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.PZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(t){t!==this._capturePhysicsTime&&this.PZ.onBeforePhysicsObservable&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.PZ.onBeforePhysicsObservable.add((()=>{J.Tools.StartPerformanceCounter("Ch"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.PZ.onAfterPhysicsObservable.add((()=>{J.Tools.EndPerformanceCounter("Ch"),this._physicsTime.endMonitoring()}))):(this.PZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.PZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(t){t!==this._captureAnimationsTime&&(this._captureAnimationsTime=t,t?this._onAfterAnimationsObserver=this.PZ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.PZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(t){this._captureFrameTime=t}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(t){this._captureInterFrameTime=t}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(t){t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.PZ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),J.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.PZ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter("Main render")}))):(this.PZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.PZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(t){t!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=t,t?(this._onBeforeCameraRenderObserver=this.PZ.onBeforeCameraRenderObservable.add((t=>{this._cameraRenderTime.beginMonitoring(),J.Tools.StartPerformanceCounter(`Rendering camera ${t.name}`)})),this._onAfterCameraRenderObserver=this.PZ.onAfterCameraRenderObservable.add((t=>{this._cameraRenderTime.endMonitoring(!1),J.Tools.EndPerformanceCounter(`Rendering camera ${t.name}`)}))):(this.PZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.PZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.PZ.getEngine()._drawCalls}constructor(t){this.PZ=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new S.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new S.c,this._captureFrameTime=!1,this._frameTime=new S.c,this._captureRenderTime=!1,this._renderTime=new S.c,this._captureInterFrameTime=!1,this._interFrameTime=new S.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new S.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new S.c,this._capturePhysicsTime=!1,this._physicsTime=new S.c,this._captureAnimationsTime=!1,this._animationsTime=new S.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new S.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(J.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.PZ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=t.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(J.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ub(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ub(),this._captureParticlesRenderTime&&this._particlesRenderTime.ub(),this._captureSpritesRenderTime&&this._spritesRenderTime.ub(),this._captureRenderTime&&this._renderTime.ub(),this._captureCameraRenderTime&&this._cameraRenderTime.ub()}))}dispose(){this._disposed||(this.PZ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.PZ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.PZ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.PZ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.PZ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.PZ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.PZ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.PZ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.PZ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.PZ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.PZ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.PZ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.PZ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.PZ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.PZ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.PZ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.PZ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.PZ=null,this._disposed=!0)}}},14377:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>g});var J=Z(12721),S=Z(12726),P=Z(12735),v=Z(13155),h=Z(13272),C=Z(13338),Y=Z(12688);v.e.AddNodeConstructor("Light_Type_1",((t,b)=>()=>new g(t,P.JZ.Zero(),b)));class g extends C.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(t){this._shadowFrustumSize=t,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(t){this._shadowOrthoScale=t,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(t){this._orthoLeft=t}get orthoRight(){return this._orthoRight}set orthoRight(t){this._orthoRight=t}get orthoTop(){return this._orthoTop}set orthoTop(t){this._orthoTop=t}get orthoBottom(){return this._orthoBottom}set orthoBottom(t){this._orthoBottom=t}constructor(t,b,Z){super(t,Z),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"Ih"}getTypeID(){return h.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(t,b,Z){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(t):this._setDefaultAutoExtendShadowProjectionMatrix(t,b,Z)}_setDefaultFixedFrustumShadowProjectionMatrix(t){const b=this.et().activeCamera;b&&P.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.nb,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,t,this.et().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(t,b,Z){const J=this.et().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const t=P.JZ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let J=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let v=0;v<Z.length;v++){const h=Z[v];if(!h)continue;const C=h.getBoundingInfo().boundingBox;for(let Z=0;Z<C.vectorsWorld.length;Z++)P.JZ.TransformCoordinatesToRef(C.vectorsWorld[Z],b,t),t.x<this._orthoLeft&&(this._orthoLeft=t.x),t.y<this._orthoBottom&&(this._orthoBottom=t.y),t.x>this._orthoRight&&(this._orthoRight=t.x),t.y>this._orthoTop&&(this._orthoTop=t.y),this.autoCalcShadowZBounds&&(t.z<J&&(J=t.z),t.z>S&&(S=t.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=J,this._shadowMaxZ=S)}const S=this._orthoRight-this._orthoLeft,v=this._orthoTop-this._orthoBottom,h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===J||void 0===J?void 0:J.nb)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===J||void 0===J?void 0:J.maxZ)||1e4,Y=this.et().getEngine().Tb;P.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-S*this.shadowOrthoScale,this._orthoRight+S*this.shadowOrthoScale,this._orthoBottom-v*this.shadowOrthoScale,this._orthoTop+v*this.shadowOrthoScale,Y?C:h,Y?h:C,t,this.et().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(t,b){return this.computeTransformedInformation()?(t.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(t.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(t){const b=this._scene.getEngine();return!b.Tb&&b.isNDCHalfZRange?0:1}getDepthMaxZ(t){const b=this._scene.getEngine();return b.Tb&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(t,b){t["DIRLIGHT"+b]=!0}}(0,J.e)([(0,S.N)()],g.prototype,"shadowFrustumSize",null),(0,J.e)([(0,S.N)()],g.prototype,"shadowOrthoScale",null),(0,J.e)([(0,S.N)()],g.prototype,"autoUpdateExtends",void 0),(0,J.e)([(0,S.N)()],g.prototype,"autoCalcShadowZBounds",void 0),(0,J.e)([(0,S.N)("orthoLeft")],g.prototype,"_orthoLeft",void 0),(0,J.e)([(0,S.N)("orthoRight")],g.prototype,"_orthoRight",void 0),(0,J.e)([(0,S.N)("orthoTop")],g.prototype,"_orthoTop",void 0),(0,J.e)([(0,S.N)("orthoBottom")],g.prototype,"_orthoBottom",void 0),(0,Y.f)("BABYLON.DirectionalLight",g)},14912:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>g});var J=Z(12721),S=Z(12726),P=Z(12735),v=Z(12775),h=Z(13155),C=Z(13272),Y=Z(12688);h.e.AddNodeConstructor("Light_Type_3",((t,b)=>()=>new g(t,P.JZ.Zero(),b)));class g extends C.d{constructor(t,b,Z){super(t,Z),this.groundColor=new v.hZ(0,0,0),this.direction=b||P.JZ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Mh"}setDirectionToTarget(t){return this.direction=P.JZ.Normalize(t.SZ(P.JZ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(t,b){const Z=P.JZ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Z.x,Z.y,Z.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.xb),b),this}transferToNodeMaterialEffect(t,b){const Z=P.JZ.Normalize(this.direction);return t.setFloat3(b,Z.x,Z.y,Z.z),this}sb(){return this._worldMatrix||(this._worldMatrix=P.Matrix.Identity()),this._worldMatrix}getTypeID(){return C.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(t,b){t["HEMILIGHT"+b]=!0}}(0,J.e)([(0,S.k)()],g.prototype,"groundColor",void 0),(0,J.e)([(0,S.J)()],g.prototype,"direction",void 0),(0,Y.f)("BABYLON.HemisphericLight",g)},14342:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>I});var J=Z(12721),S=Z(12726),P=Z(12735),v=Z(13155),h=Z(13272),C=Z(13338),Y=Z(12716),g=Z(12688);v.e.AddNodeConstructor("Light_Type_2",((t,b)=>()=>new I(t,P.JZ.Zero(),P.JZ.Zero(),0,0,b)));class I extends C.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(t){this._iesProfileTexture!==t&&(this._iesProfileTexture=t,this._iesProfileTexture&&I._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(t){this._angle=t,this._cosHalfAngle=Math.cos(.5*t),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(t){this._innerAngle=t,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(t){this._shadowAngleScale=t,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(t){this._projectionTextureLightNear=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(t){this._projectionTextureLightFar=t,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(t){this._projectionTextureUpDirection=t,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(t){this._projectionTexture!==t&&(this._projectionTexture=t,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(I._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):I._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(t){return void 0!==t.onGeneratedObservable}static _IsTexture(t){return void 0!==t.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(t){this._projectionTextureProjectionLightMatrix=t,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(t,b,Z,J,S,v){super(t,v),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=P.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=P.JZ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=P.JZ.Zero(),this._projectionTextureViewLightMatrix=P.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=P.Matrix.Zero(),this._projectionTextureScalingMatrix=P.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=Z,this.angle=J,this.exponent=S}getClassName(){return"SpotLight"}getTypeID(){return h.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(t){super._setDirection(t),this._projectionTextureViewLightDirty=!0}_setPosition(t){super._setPosition(t),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(t,b,Z){const J=this.et().activeCamera;if(!J)return;this._shadowAngleScale=this._shadowAngleScale||1;const S=this._shadowAngleScale*this._angle,v=void 0!==this.shadowMinZ?this.shadowMinZ:J.nb,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,C=this.et().getEngine().Tb;P.Matrix.PerspectiveFovLHToRef(S,1,C?h:v,C?v:h,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),P.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const t=this.projectionTextureLightFar,b=this.projectionTextureLightNear,Z=t/(t-b),J=-Z*b,S=1/Math.tan(this._angle/2);P.Matrix.FromValuesToRef(S/1,0,0,0,0,S,0,0,0,0,Z,1,0,0,J,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof Y.c){const t=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;P.Matrix.FromValuesToRef(t,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(t,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),t.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),t.setTexture("projectionLightTexture"+b,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&t.setTexture("iesLightTexture"+b,this._iesProfileTexture),this}transferToEffect(t,b){let Z;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),Z=P.JZ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),Z=P.JZ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Z.x,Z.y,Z.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(t,b){let Z;return Z=this.computeTransformedInformation()?P.JZ.Normalize(this.transformedDirection):P.JZ.Normalize(this.direction),this.et().useRightHandedSystem?t.setFloat3(b,-Z.x,-Z.y,-Z.z):t.setFloat3(b,Z.x,Z.y,Z.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(t){const b=this._scene.getEngine(),Z=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.nb)??0;return b.Tb&&b.isNDCHalfZRange?Z:this._scene.getEngine().isNDCHalfZRange?0:Z}getDepthMaxZ(t){const b=this._scene.getEngine(),Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)??1e4;return b.Tb&&b.isNDCHalfZRange?0:Z}prepareLightSpecificDefines(t,b){t["SPOTLIGHT"+b]=!0,t["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady()),t["IESLIGHTTEXTURE"+b]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,J.e)([(0,S.N)()],I.prototype,"angle",null),(0,J.e)([(0,S.N)()],I.prototype,"innerAngle",null),(0,J.e)([(0,S.N)()],I.prototype,"shadowAngleScale",null),(0,J.e)([(0,S.N)()],I.prototype,"exponent",void 0),(0,J.e)([(0,S.N)()],I.prototype,"projectionTextureLightNear",null),(0,J.e)([(0,S.N)()],I.prototype,"projectionTextureLightFar",null),(0,J.e)([(0,S.N)()],I.prototype,"projectionTextureUpDirection",null),(0,J.e)([(0,S.C)("projectedLightTexture")],I.prototype,"_projectionTexture",void 0),(0,g.f)("BABYLON.SpotLight",I)},14070:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>v,h:()=>P,i:()=>h});const J={},S={};function P(t,b){J[t]=b}function v(t,b){S[t]=b}function h(t){return S[t]?S[t]:null}},13957:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>o,f:()=>q});var J,S=Z(12549),P=Z(12551),v=Z(12975),h=Z(12585),C=Z(12557),Y=Z(13197),g=Z(12593),I=Z(12600),r=Z(12693),M=Z(12623),T=Z(12577);!function(t){t[t.Clean=0]="Clean",t[t.Stop=1]="Stop",t[t.Sync=2]="Sync",t[t.NoSync=3]="NoSync"}(J||(J={}));const a=new P.d,k={};let u=!1;function l(){return k[".babylon"]}function U(t,b){const Z=k[t];return Z||(C.c.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),b?l():void 0)}function E(t,b,Z){let J="Unable to load from "+(t.rawData?"binary data":t.url);return b?J+=`: ${b}`:Z&&(J+=`: ${Z}`),J}async function c(t,b,Z,J,S,P,v,h,C){var Y;const I="data:"===(r=t.url).substring(0,5)?r.substring(5):null;var r;if(t.rawData&&!v)throw"When using ArrayBufferView to load data the file extension must be provided.";const u=I||v?"":function(t){const b=t.indexOf("?");-1!==b&&(t=t.substring(0,b));const Z=t.lastIndexOf(".");return t.substring(Z,t.length).toLowerCase()}(t.url);let E=v?U(v,!0):I?function(t){for(const b in k){const Z=k[b].plugin;if(Z.canDirectLoad&&Z.canDirectLoad(t))return k[b]}return l()}(t.url):U(u,!1);if(!E&&u){if(t.url&&!t.url.startsWith("blob:")){const b=await async function(t,b){const Z=b.method||"GET";return await new Promise(((J,S)=>{const P=new T.b;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const t={};if(b.responseHeaders)for(const Z of b.responseHeaders)t[Z]=P.getResponseHeader(Z)||"";J({response:P.response,headerValues:t})}else S(`Unable to fetch data from ${t}. Error code: ${P.status}`)})),P.open(Z,t),P.send()}))}(t.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Z=b.headerValues?b.headerValues["Content-Type"]:"";Z&&(E=function(t){for(const b in k){const Z=k[b];if(Z.mimeType===t)return Z}}(Z))}E||(E=l())}if(!E)throw new Error(`No plugin or fallback for ${v??t.url}`);if(!1===(null===C||void 0===C||null===(Y=C[E.plugin.name])||void 0===Y?void 0:Y.enabled))throw new Error(`The '${E.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(t.rawData&&!E.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(t=>{if(E.plugin.createPlugin){const b=E.plugin.createPlugin(C??{});return b instanceof Promise?(b.then(t).catch((t=>{S("Error instantiating plugin.",t)})),null):(t(b),b)}return t(E.plugin),E.plugin})((C=>{var Y;if(!C)throw`The loader plugin corresponding to the '${v}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(a.notifyObservers(C),I&&(C.canDirectLoad&&C.canDirectLoad(t.url)||!(0,g.l)(t.url))){if(C.directLoad){const t=C.directLoad(b,I);t instanceof Promise?t.then((t=>{Z(C,t)})).catch((t=>{S("Error in directLoad of _loadData: "+t,t)})):Z(C,t)}else Z(C,I);return}const r=E.isBinary,T=(t,J)=>{b.h?S("Scene has been disposed"):Z(C,t,J)};let k=null,u=!1;null===(Y=C.lb)||void 0===Y||Y.add((()=>{u=!0,k&&(k.abort(),k=null),P()}));const l=()=>{if(u)return;const Z=(t,b)=>{S(null===t||void 0===t?void 0:t.statusText,b)};if(!C.loadFile&&t.rawData)throw"Plugin does not support loading ArrayBufferView.";k=C.loadFile?C.loadFile(b,t.rawData||t.file||t.url,t.rootUrl,T,J,r,Z,h):b._loadFile(t.file||t.url,T,J,!0,r,Z)},U=b.getEngine();let c=U.enableOfflineSupport;if(c){let Z=!1;for(const J of b.disableOfflineSupportExceptionRules)if(J.test(t.url)){Z=!0;break}c=!Z}c&&M.e.OfflineProviderFactory?b.offlineProvider=M.e.OfflineProviderFactory(t.url,l,U.disableManifestCheck):l()}))}function H(t,b){let Z,J,P=null,v=null;if(b)if(b.name)Z=`file:${b.name}`,J=b.name,P=b;else if(ArrayBuffer.isView(b))Z="",J=(0,r.c)(),v=b;else if(b.startsWith("data:"))Z=b,J="";else if(t){const P=b;if("/"===P.substring(0,1))return S.Tools.Error("Wrong sceneFilename parameter"),null;Z=t+P,J=P}else Z=b,J=S.Tools.GetFilename(b),t=S.Tools.GetFolderPath(b);else Z=t,J=S.Tools.GetFilename(t),t=S.Tools.GetFolderPath(t);return{url:Z,rootUrl:t,name:J,file:P,rawData:v}}function o(t){if("string"===typeof t.extensions){const b=t.extensions;k[b.toLowerCase()]={plugin:t,isBinary:!1}}else{const b=t.extensions,Z=Object.keys(b);for(const J of Z)k[J.toLowerCase()]={plugin:t,isBinary:b[J].isBinary,mimeType:b[J].mimeType}}}async function O(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.e.LastCreatedScene,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!J)return C.c.Error("No scene available to import mesh to"),null;const M=H(b,Z);if(!M)return null;const T={};J.addPendingData(T);const a=()=>{J.removePendingData(T)},k=(t,b)=>{const Z=E(M,t,b);v?v(J,Z,new I.g(Z,I.f.SceneLoaderError,b)):C.c.Error(Z),a()},u=P?t=>{try{P(t)}catch(b){k("Error in onProgress callback: "+b,b)}}:void 0,l=(t,b,Z,P,v,h,C,Y)=>{if(J.importedMeshesFiles.push(M.url),S)try{S(t,b,Z,P,v,h,C,Y)}catch(g){k("Error in onSuccess callback: "+g,g)}J.removePendingData(T)};return await c(M,J,((b,Z,S)=>{if(b.rewriteRootURL&&(M.rootUrl=b.rewriteRootURL(M.rootUrl,S)),b.importMesh){const S=[],P=[],v=[];if(!b.importMesh(t,J,Z,M.rootUrl,S,P,v,k))return;J.loadingPluginName=b.name,l(S,P,v,[],[],[],[],[])}else{b.importMeshAsync(t,J,Z,M.rootUrl,u,M.name).then((t=>{J.loadingPluginName=b.name,l(t.meshes,t.Lr,t.skeletons,t.animationGroups,t.transformNodes,t.geometries,t.lights,t.spriteManagers)})).catch((t=>{k(t.message,t)}))}}),u,k,a,Y,g,r)}async function p(t,b,Z,J,S,P,v,h){return await new Promise(((C,Y)=>{try{O(t,b,Z,J,((t,b,Z,J,S,P,v,h)=>{C({meshes:t,Lr:b,skeletons:Z,animationGroups:J,transformNodes:S,geometries:P,lights:v,spriteManagers:h})}),S,((t,b,Z)=>{Y(Z||new Error(b))}),P,v,h).catch(Y)}catch(I){Y(I)}}))}async function e(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.e.LastCreatedEngine,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Z?await j(t,b,new v.d(Z),J,P,C,Y,g,I):S.Tools.Error("No engine available")}async function W(t,b,Z,J,S,P,v){return await new Promise(((h,C)=>{e(t,b,Z,(t=>{h(t)}),J,((t,b,Z)=>{C(Z||new Error(b))}),S,P,v)}))}async function j(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.e.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return C.c.Error("No scene available to append to"),null;const M=H(t,b);if(!M)return null;const T={};Z.addPendingData(T);const a=()=>{Z.removePendingData(T)};Y.d.ShowLoadingScreen&&!u&&(u=!0,Z.getEngine().displayLoadingUI(),Z.executeWhenReady((()=>{Z.getEngine().hideLoadingUI(),u=!1})));const k=(t,b)=>{const J=E(M,t,b);P?P(Z,J,new I.g(J,I.f.SceneLoaderError,b)):C.c.Error(J),a()},l=S?t=>{try{S(t)}catch(b){k("Error in onProgress callback",b)}}:void 0,U=()=>{if(J)try{J(Z)}catch(t){k("Error in onSuccess callback",t)}Z.removePendingData(T)};return await c(M,Z,((t,b)=>{if(t.load){if(!t.load(Z,b,M.rootUrl,k))return;Z.loadingPluginName=t.name,U()}else{t.loadAsync(Z,b,M.rootUrl,l,M.name).then((()=>{Z.loadingPluginName=t.name,U()})).catch((t=>{k(t.message,t)}))}}),l,k,a,v,g,r)}async function V(t,b,Z,J,S,P,v){return await new Promise(((h,C)=>{try{j(t,b,Z,(t=>{h(t)}),J,((t,b,Z)=>{C(Z||new Error(b))}),S,P,v).catch(C)}catch(I){C(I)}}))}async function n(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.e.LastCreatedScene,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Z)return C.c.Error("No scene available to load asset container to"),null;const r=H(t,b);if(!r)return null;const M={};Z.addPendingData(M);const T=()=>{Z.removePendingData(M)},a=(t,b)=>{const J=E(r,t,b);P?P(Z,J,new I.g(J,I.f.SceneLoaderError,b)):C.c.Error(J),T()},k=S?t=>{try{S(t)}catch(b){a("Error in onProgress callback",b)}}:void 0,u=t=>{if(J)try{J(t)}catch(b){a("Error in onSuccess callback",b)}Z.removePendingData(M)};return await c(r,Z,((t,b)=>{if(t.loadAssetContainer){const J=t.loadAssetContainer(Z,b,r.rootUrl,a);if(!J)return;J.populateRootNodes(),Z.loadingPluginName=t.name,u(J)}else if(t.loadAssetContainerAsync){t.loadAssetContainerAsync(Z,b,r.rootUrl,k,r.name).then((b=>{b.populateRootNodes(),Z.loadingPluginName=t.name,u(b)})).catch((t=>{a(t.message,t)}))}else a("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),k,a,T,v,Y,g)}async function y(t,b,Z,J,S,P,v){return await new Promise(((h,C)=>{try{n(t,b,Z,(t=>{h(t)}),J,((t,b,Z)=>{C(Z||new Error(b))}),S,P,v).catch(C)}catch(I){C(I)}}))}async function d(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.e.LastCreatedScene,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Z)return void C.c.Error("No scene available to load animations to");if(J){for(const J of Z.animatables)J.reset();Z.stopAllAnimations();const t=Z.animationGroups.slice();for(const Z of t)Z.dispose();const b=Z.getNodes();for(const Z of b)Z.animations&&(Z.animations=[])}else switch(S){case 0:const t=Z.animationGroups.slice();for(const b of t)b.dispose();break;case 1:for(const b of Z.animationGroups)b.stop();break;case 2:for(const b of Z.animationGroups)b.reset(),b.restart();break;case 3:break;default:return void C.c.Error("Unknown animation group loading mode value '"+S+"'")}const T=Z.animatables.length;await n(t,b,Z,(t=>{t.mergeAnimationsTo(Z,Z.animatables.slice(T),P),t.dispose(),Z.onAnimationFileImportedObservable.notifyObservers(Z),v&&v(Z)}),Y,g,I,r,M)}async function s(t,b,Z,J,S,P,v,h,C,Y){return await new Promise(((g,r)=>{try{d(t,b,Z,J,S,P,(t=>{g(t)}),v,((t,b,Z)=>{r(Z||new Error(b))}),h,C,Y).catch(r)}catch(I){r(I)}}))}class q{static get ForceFullSceneLoadingForIncremental(){return Y.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(t){Y.d.ForceFullSceneLoadingForIncremental=t}static get ShowLoadingScreen(){return Y.d.ShowLoadingScreen}static set ShowLoadingScreen(t){Y.d.ShowLoadingScreen=t}static get loggingLevel(){return Y.d.loggingLevel}static set loggingLevel(t){Y.d.loggingLevel=t}static get CleanBoneMatrixWeights(){return Y.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(t){Y.d.CleanBoneMatrixWeights=t}static GetDefaultPlugin(){return l()}static GetPluginForExtension(t){var b;return null===(b=U(t,!0))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(t){return function(t){return!!k[t]}(t)}static RegisterPlugin(t){o(t)}static ImportMesh(t,b,Z,J,S,P,v,C,Y){O(t,b,Z,J,S,P,v,C,Y).catch((t=>null===v||void 0===v?void 0:v(h.e.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportMeshAsync(t,b,Z,J,S,P,v){return await p(t,b,Z,J,S,P,v)}static Load(t,b,Z,J,S,P,v,C){e(t,b,Z,J,S,P,v,C).catch((t=>null===P||void 0===P?void 0:P(h.e.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAsync(t,b,Z,J,S,P){return await W(t,b,Z,J,S,P)}static Append(t,b,Z,J,S,P,v,C){j(t,b,Z,J,S,P,v,C).catch((t=>null===P||void 0===P?void 0:P(Z??h.e.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async AppendAsync(t,b,Z,J,S,P){return await V(t,b,Z,J,S,P)}static LoadAssetContainer(t,b,Z,J,S,P,v,C){n(t,b,Z,J,S,P,v,C).catch((t=>null===P||void 0===P?void 0:P(Z??h.e.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async LoadAssetContainerAsync(t,b,Z,J,S,P){return await y(t,b,Z,J,S,P)}static ImportAnimations(t,b,Z,J,S,P,v,C,Y,g,I){d(t,b,Z,J,S,P,v,C,Y,g,I).catch((t=>null===Y||void 0===Y?void 0:Y(Z??h.e.LastCreatedScene,null===t||void 0===t?void 0:t.message,t)))}static async ImportAnimationsAsync(t,b,Z,J,S,P,v,h,C,Y,g){return await s(t,b,Z,J,S,P,h,Y,g)}}q.NO_LOGGING=0,q.MINIMAL_LOGGING=1,q.SUMMARY_LOGGING=2,q.DETAILED_LOGGING=3,q.OnPluginActivatedObservable=a},14359:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>r});var J=Z(12721),S=Z(12726),P=Z(12549),v=Z(12735),h=Z(12748),C=Z(12716),Y=Z(12688),g=Z(12551),I=Z(12760);Z(14368);class r extends h.d{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const b=this.et();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(v.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,b,Z){let J="";for(const S of t)J+=S;return new r(J,b,null,Z,t)}static CreateFromPrefilteredData(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const P=new r(t,b,null,!1,null,null,null,void 0,!0,Z,J);return b.useDelayedTextureLoading=S,P}constructor(t,b){var Z;let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],M=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,u=arguments.length>13?arguments[13]:void 0,l=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new g.d,this.boundingBoxPosition=v.JZ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new v.Matrix,this._buffer=null,this.name=t,this.url=t,this._noMipmap=S,this.Vb=!1,this.isCube=!0,this._textureMatrix=v.Matrix.Identity(),this.coordinatesMode=C.c.CUBIC_MODE;let U=null,E=null;null===J||Array.isArray(J)?(this._noMipmap=S,this._format=I,this._createPolynomials=T,U=J,this._loaderOptions=u,this._useSRGBBuffer=l,this._lodScale=a,this._lodOffset=k):(U=J.extensions??null,this._noMipmap=J.noMipmap??!1,P=J.files??null,E=J.buffer??null,this._format=J.format??5,r=J.prefiltered??!1,M=J.forcedExtension??null,this._createPolynomials=J.createPolynomials??!1,this._lodScale=J.lodScale??.8,this._lodOffset=J.lodOffset??0,this._loaderOptions=J.loaderOptions,this._useSRGBBuffer=J.useSRGBBuffer,h=J.R??null,Y=J.onError??null),(t||P)&&this.updateURL(t,M,h,r,Y,U,null===(Z=this.et())||void 0===Z?void 0:Z.useDelayedTextureLoading,P,E)}getClassName(){return"CubeTexture"}updateURL(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=t),this.url=t,b&&(this._forcedExtension=b);const Y=t.lastIndexOf("."),g=b||(Y>-1?t.substring(Y).toLowerCase():""),I=0===g.indexOf(".dds"),r=0===g.indexOf(".env"),M=0===g.indexOf(".basis");if(r?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=J,J&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),h)this._files=h;else if(M||r||I||P||(P=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,P){for(let b=0;b<P.length;b++)this._files.push(t+P[b]);this._extensions=P}this._buffer=C,v?(this.delayLoadState=4,this._delayedOnLoad=Z,this._delayedOnError=S):this._loadTexture(Z,S)}delayLoad(t){4===this.delayLoadState&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){var b,Z;if(t.updateFlag===this._textureMatrix.updateFlag)return;t.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Z=this.et())||void 0===Z||Z.markAllMaterialsAsDirty(1,(t=>-1!==t.getActiveTextures().indexOf(this))));if(this._textureMatrix=t,null===(b=this.et())||void 0===b||!b.useRightHandedSystem)return;const J=v.TmpVectors.JZ[0],S=v.TmpVectors.Quaternion[0],P=v.TmpVectors.JZ[1];this._textureMatrix.decompose(J,S,P),S.z*=-1,S.w*=-1,v.Matrix.ComposeToRef(J,S,P,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var t;return null!==(t=this.et())&&void 0!==t&&t.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this.et(),J=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const S=()=>{var b;(this.onLoadObservable.notifyObservers(this),J)&&(J.dispose(),null===(b=this.et())||void 0===b||b.markAllMaterialsAsDirty(1));t&&t()},v=(t,Z)=>{this._loadingError=!0,this._errorObject={message:t,exception:Z},b&&b(t,Z),C.c.OnTextureLoadErrorObservable.notifyObservers(this)};var h;this._texture?this._texture.isReady?P.Tools.SetImmediate((()=>S())):this._texture.onLoadedObservable.add((()=>S())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Z,this._lodScale,this._lodOffset,t,v,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Z,this._files,this._noMipmap,t,v,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(h=this._texture)||void 0===h||h.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(t,b,Z){const J=I.d.Parse((()=>{let J=!1;return t.prefiltered&&(J=t.prefiltered),new r(Z+(t.url??t.name),b,t.extensions,!1,t.files||null,null,null,void 0,J,t.forcedExtension)}),t,b);if(t.boundingBoxPosition&&(J.boundingBoxPosition=v.JZ.CZ(t.boundingBoxPosition)),t.boundingBoxSize&&(J.boundingBoxSize=v.JZ.CZ(t.boundingBoxSize)),t.animations)for(let S=0;S<t.animations.length;S++){const b=t.animations[S],Z=(0,Y.d)("BABYLON.Animation");Z&&J.animations.push(Z.Parse(b))}return J}clone(){let t=0;const b=I.d.Clone((()=>{const b=new r(this.url,this.et()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=b.uniqueId,b}),this);return b.uniqueId=t,b}}(0,J.e)([(0,S.N)()],r.prototype,"url",void 0),(0,J.e)([(0,S.J)()],r.prototype,"boundingBoxPosition",void 0),(0,J.e)([(0,S.J)()],r.prototype,"boundingBoxSize",null),(0,J.e)([(0,S.N)("rotationY")],r.prototype,"rotationY",null),(0,J.e)([(0,S.N)("files")],r.prototype,"_files",void 0),(0,J.e)([(0,S.N)("forcedExtension")],r.prototype,"_forcedExtension",void 0),(0,J.e)([(0,S.N)("extensions")],r.prototype,"_extensions",void 0),(0,J.e)([(0,S.u)("textureMatrix")],r.prototype,"_textureMatrix",void 0),(0,J.e)([(0,S.u)("textureMatrixRefraction")],r.prototype,"_textureMatrixRefraction",void 0),C.c._CubeTextureParser=r.Parse,(0,Y.f)("BABYLON.CubeTexture",r)},14917:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>C});var J=Z(12557),S=Z(12716),P=Z(12702),v=Z(12866),h=Z(12663);v.ThinEngine.prototype.createDynamicTexture=function(t,b,Z,J){const S=new h.d(this,4);return S.baseWidth=t,S.baseHeight=b,Z&&(t=this.needPOTTextures?(0,P.h)(t,this._caps.maxTextureSize):t,b=this.needPOTTextures?(0,P.h)(b,this._caps.maxTextureSize):b),S.width=t,S.height=b,S.isReady=!1,S.generateMipMaps=Z,S.samplingMode=J,this.updateTextureSamplingMode(J,S),this._internalTexturesCache.push(S),S},v.ThinEngine.prototype.updateDynamicTexture=function(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!t)return;const v=this._gl,h=v.TEXTURE_2D,C=this._bindTextureDirectly(h,t,!0,P);this._unpackFlipY(void 0===Z?t.invertY:Z),J&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Y=this._getWebGLTextureType(t.type),g=this._getInternalFormat(S||t.format),I=this._getRGBABufferInternalSizedFormat(t.type,g);v.texImage2D(h,0,I,g,Y,b),t.generateMipMaps&&v.generateMipmap(h),C||this._bindTextureDirectly(h,null),J&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),S&&(t.format=S),t._dynamicTextureSource=b,t._premulAlpha=J,t.invertY=Z||!1,t.isReady=!0};class C extends S.c{constructor(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,h=arguments.length>6?arguments[6]:void 0;const C=!Z||Z._isScene;super(null,C?Z:null===Z||void 0===Z?void 0:Z.PZ,C?!J:Z,h,P,void 0,void 0,void 0,void 0,v),this.name=t,this.wrapU=S.c.CLAMP_ADDRESSMODE,this.wrapV=S.c.CLAMP_ADDRESSMODE,this._generateMipMaps=J;const Y=this._getEngine();if(!Y)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=Y.createDynamicTexture(this._canvas.width,this._canvas.height,J,P);else{this._canvas=Y.createCanvas(1,1),this._ownCanvas=!0;const t=b;t.width||0===t.width?this._texture=Y.createDynamicTexture(t.width,t.height,J,P):this._texture=Y.createDynamicTexture(b,b,J,P)}const g=this.getSize();this._canvas.width!==g.width&&(this._canvas.width=g.width),this._canvas.height!==g.height&&(this._canvas.height=g.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(t){this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this.samplingMode)}scale(t){const b=this.getSize();b.width*=t,b.height*=t,this._recreate(b)}scaleTo(t,b){const Z=this.getSize();Z.width=t,Z.height=b,this._recreate(Z)}getContext(){return this._context}clear(t){const b=this.getSize();t&&(this._context.fillStyle=t),this._context.clearRect(0,0,b.width,b.height)}update(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===t||t,b,this._format||void 0,void 0,Z)}drawText(t,b,Z,J,S,P,v){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(P&&(this._context.fillStyle=P,this._context.fillRect(0,0,C.width,C.height)),this._context.font=J,null===b||void 0===b){const Z=this._context.measureText(t);b=(C.width-Z.width)/2}if(null===Z||void 0===Z){const t=parseInt(J.replace(/\D/g,""));Z=C.height/2+t/3.65}this._context.fillStyle=S||"",this._context.fillText(t,b,Z),h&&this.update(v)}dispose(){var t,b;(super.dispose(),this._ownCanvas)&&(null===(t=this._canvas)||void 0===t||null===(b=t.remove)||void 0===b||b.call(t));this._canvas=null,this._context=null}clone(){const t=this.et();if(!t)return this;const b=this.getSize(),Z=new C(this.name,b,t,this._generateMipMaps);return Z.Vb=this.Vb,Z.level=this.level,Z.wrapU=this.wrapU,Z.wrapV=this.wrapV,Z}serialize(){const t=this.et();t&&!t.isReady()&&J.c.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return C._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(t){return void 0!==t.toDataURL}_rebuild(){this.update()}}},14269:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>S});var J=Z(12716);class S extends J.c{get depth(){return this._depth}constructor(t,b,Z,S,P,v){let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:J.c.TRILINEAR_SAMPLINGMODE,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,I=arguments.length>10?arguments[10]:void 0;super(null,v,!h,C),this.format=P,this._texture=v.getEngine().createRawTexture2DArray(t,b,Z,S,P,h,C,Y,null,g,I),this._depth=S,this.is2DArray=!0}update(t){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,t,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(t,b,Z,J,P){return new S(t,b,Z,J,5,P,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14088:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>h,c:()=>C,g:()=>P,k:()=>v});var J=Z(12745),S=Z(12735);function P(t,b){return`{X: ${t.x.toFixed(b)} Y: ${t.y.toFixed(b)}}`}function v(t,b){return`{X: ${t._x.toFixed(b)} Y: ${t._y.toFixed(b)} Z: ${t._z.toFixed(b)}}`}function h(t,b){return 2*Math.acos((0,J.Clamp)(S.Quaternion.Dot(t,b)))}function C(t,b){const Z=new S.Quaternion;return function(t,b,Z){const P=S.JZ.Cross(t,b),v=Math.acos((0,J.Clamp)(S.JZ.Dot(t,b),-1,1));S.Quaternion.RotationAxisToRef(P,v,Z)}(t,b,Z),Z}},13911:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>Y});var J=Z(12735),S=Z(12775),P=Z(13184),v=Z(13162),h=Z(12781);Z(13913);function C(t){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Z=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],P=[];let C=[];const Y=t.width||t.size||1,g=t.height||t.size||1,I=t.depth||t.size||1,r=t.wrap||!1;let M=void 0===t.topBaseAt?1:t.topBaseAt,T=void 0===t.bottomBaseAt?0:t.bottomBaseAt;M=(M+4)%4,T=(T+4)%4;let a=[2,0,3,1][M],k=[2,0,1,3][T],u=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(r){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],u=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let t=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Z=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const J=[17,18,19,16],S=[22,23,20,21];for(;a>0;)t.unshift(t.pop()),J.unshift(J.pop()),a--;for(;k>0;)Z.unshift(Z.pop()),S.unshift(S.pop()),k--;t=t.flat(),Z=Z.flat(),u=u.concat(t).concat(Z),b.push(J[0],J[2],J[3],J[0],J[1],J[2]),b.push(S[0],S[2],S[3],S[0],S[1],S[2])}const l=[Y/2,g/2,I/2];C=u.reduce(((t,b,Z)=>t.concat(b*l[Z%3])),[]);const U=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,E=t.faceUV||new Array(6),c=t.faceColors,H=[];for(let v=0;v<6;v++)void 0===E[v]&&(E[v]=new J.Vector4(0,0,1,1)),c&&void 0===c[v]&&(c[v]=new S.Fb(1,1,1,1));for(let J=0;J<6;J++)if(P.push(E[J].z,h.e?1-E[J].w:E[J].w),P.push(E[J].x,h.e?1-E[J].w:E[J].w),P.push(E[J].x,h.e?1-E[J].y:E[J].y),P.push(E[J].z,h.e?1-E[J].y:E[J].y),c)for(let t=0;t<4;t++)H.push(c[J].r,c[J].g,c[J].b,c[J].a);v.c._ComputeSides(U,C,b,Z,P,t.frontUVs,t.backUVs);const o=new v.c;if(o.indices=b,o.jt=C,o.Vt=Z,o.yt=P,c){const t=U===v.c.DOUBLESIDE?H.concat(H):H;o.nt=t}return o}function Y(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new P.b(t,Z);b.sideOrientation=P.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return C(b).st(J,b.updatable),J}v.c.CreateBox=C,P.b.CreateBox=function(t,b){return Y(t,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14077:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>h});var J=Z(13184),S=Z(13162),P=Z(12781);function v(t){const b=[],Z=[],J=[],v=[],h=t.radius||.5,C=t.tessellation||64,Y=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,g=0===t.sideOrientation?0:t.sideOrientation||S.c.DEFAULTSIDE;b.push(0,0,0),v.push(.5,.5);const I=2*Math.PI*Y,r=1===Y?I/C:I/(C-1);let M=0;for(let S=0;S<C;S++){const t=Math.cos(M),Z=Math.sin(M),J=(t+1)/2,S=(1-Z)/2;b.push(h*t,h*Z,0),v.push(J,P.e?1-S:S),M+=r}1===Y&&(b.push(b[3],b[4],b[5]),v.push(v[2],P.e?1-v[3]:v[3]));const T=b.length/3;for(let S=1;S<T-1;S++)Z.push(S+1,0,S);S.c.ComputeNormals(b,Z,J),S.c._ComputeSides(g,b,Z,J,v,t.frontUVs,t.backUVs);const a=new S.c;return a.indices=Z,a.jt=b,a.Vt=J,a.yt=v,a}function h(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new J.b(t,Z);b.sideOrientation=J.b._GetDefaultSideOrientation(b.sideOrientation),S._originalBuilderSideOrientation=b.sideOrientation;return v(b).st(S,b.updatable),S}S.c.CreateDisc=v,J.b.CreateDisc=function(t,b,Z){return h(t,{radius:b,tessellation:Z,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13913:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>k,b:()=>l,i:()=>u});var J=Z(12735),S=Z(12775),P=Z(13184),v=Z(13162),h=Z(12800);P.b._GroundMeshParser=(t,b)=>C.Parse(t,b);class C extends P.b{constructor(t,b){super(t,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);const Z=this;Z.createOrUpdateSubmeshesOctree&&Z.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(t,b){const Z=this.getWorldMatrix(),S=J.TmpVectors.Matrix[5];Z.invertToRef(S);const P=J.TmpVectors.JZ[8];if(J.JZ.TransformCoordinatesFromFloatsToRef(t,0,b,S,P),t=P.x,b=P.z,t<this._minX||t>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const v=this._getFacetAt(t,b),h=-(v.x*t+v.z*b+v.w)/v.y;return J.JZ.TransformCoordinatesFromFloatsToRef(0,h,0,Z,P),P.y}getNormalAtCoordinates(t,b){const Z=new J.JZ(0,1,0);return this.getNormalAtCoordinatesToRef(t,b,Z),Z}getNormalAtCoordinatesToRef(t,b,Z){const S=this.getWorldMatrix(),P=J.TmpVectors.Matrix[5];S.invertToRef(P);const v=J.TmpVectors.JZ[8];if(J.JZ.TransformCoordinatesFromFloatsToRef(t,0,b,P,v),t=v.x,b=v.z,t<this._minX||t>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(t,b);return J.JZ.TransformNormalFromFloatsToRef(h.x,h.y,h.z,S,Z),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(t,b){const Z=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),J=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),S=this._heightQuads[J*this._subdivisionsX+Z];let P;return P=b<S.slope.x*t+S.slope.y?S.facet1:S.facet2,P}_initHeightQuads(){const t=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=[];for(let Z=0;Z<b;Z++)for(let b=0;b<t;b++){const S={slope:J.Vector2.Zero(),facet1:new J.Vector4(0,0,0,0),facet2:new J.Vector4(0,0,0,0)};this._heightQuads[Z*t+b]=S}return this}_computeHeightQuads(){const t=this.getVerticesData(h.g.PositionKind);if(!t)return this;const b=J.TmpVectors.JZ[3],Z=J.TmpVectors.JZ[2],S=J.TmpVectors.JZ[1],P=J.TmpVectors.JZ[0],v=J.TmpVectors.JZ[4],C=J.TmpVectors.JZ[5],Y=J.TmpVectors.JZ[6],g=J.TmpVectors.JZ[7],I=J.TmpVectors.JZ[8];let r=0,M=0,T=0,a=0,k=0,u=0,l=0;const U=this._subdivisionsX,E=this._subdivisionsY;for(let h=0;h<E;h++)for(let E=0;E<U;E++){r=3*E,M=h*(U+1)*3,T=(h+1)*(U+1)*3,b.x=t[M+r],b.y=t[M+r+1],b.z=t[M+r+2],Z.x=t[M+r+3],Z.y=t[M+r+4],Z.z=t[M+r+5],S.x=t[T+r],S.y=t[T+r+1],S.z=t[T+r+2],P.x=t[T+r+3],P.y=t[T+r+4],P.z=t[T+r+5],a=(P.z-b.z)/(P.x-b.x),k=b.z-a*b.x,Z.subtractToRef(b,v),S.subtractToRef(b,C),P.subtractToRef(b,Y),J.JZ.CrossToRef(Y,C,g),J.JZ.CrossToRef(v,Y,I),g.normalize(),I.normalize(),u=-(g.x*b.x+g.y*b.y+g.z*b.z),l=-(I.x*Z.x+I.y*Z.y+I.z*Z.z);const c=this._heightQuads[h*U+E];c.slope.Ab(a,k),c.facet1.Ab(g.x,g.y,g.z,u),c.facet2.Ab(I.x,I.y,I.z,l)}return this}serialize(t){super.serialize(t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.nb=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height}static Parse(t,b){const Z=new C(t.name,b);return Z._subdivisionsX=t.subdivisionsX||1,Z._subdivisionsY=t.subdivisionsY||1,Z._minX=t.minX,Z._maxX=t.maxX,Z._minZ=t.nb,Z._maxZ=t.maxZ,Z._width=t.width,Z._height=t.height,Z}}var Y=Z(12549),g=Z(12585),I=Z(12737),r=Z(12781);function M(t){const b=[],Z=[],S=[],P=[];let h,C;const Y=t.width||t.size||1,g=t.height||t.size||1,I=0|(t.subdivisionsX||t.subdivisions||1),M=0|(t.subdivisionsY||t.subdivisions||1);for(h=0;h<=M;h++)for(C=0;C<=I;C++){const t=new J.JZ(C*Y/I-Y/2,0,(M-h)*g/M-g/2),b=new J.JZ(0,1,0);Z.push(t.x,t.y,t.z),S.push(b.x,b.y,b.z),P.push(C/I,r.e?h/M:1-h/M)}for(h=0;h<M;h++)for(C=0;C<I;C++)b.push(C+1+(h+1)*(I+1)),b.push(C+1+h*(I+1)),b.push(C+h*(I+1)),b.push(C+(h+1)*(I+1)),b.push(C+1+(h+1)*(I+1)),b.push(C+h*(I+1));const T=new v.c;return T.indices=b,T.jt=Z,T.Vt=S,T.yt=P,T}function T(t){const b=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,Z=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,S=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,P=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,h=t.subdivisions||{w:1,h:1},C=t.precision||{w:1,h:1},Y=[],g=[],I=[],r=[];let M,T,a,k;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const u=(S-b)/h.w,l=(P-Z)/h.h;function U(t,b,Z,S){const P=g.length/3,v=C.w+1;for(M=0;M<C.h;M++)for(T=0;T<C.w;T++){const t=[P+T+M*v,P+(T+1)+M*v,P+(T+1)+(M+1)*v,P+T+(M+1)*v];Y.push(t[1]),Y.push(t[2]),Y.push(t[3]),Y.push(t[0]),Y.push(t[1]),Y.push(t[3])}const h=J.JZ.Zero(),a=new J.JZ(0,1,0);for(M=0;M<=C.h;M++)for(h.z=M*(S-b)/C.h+b,T=0;T<=C.w;T++)h.x=T*(Z-t)/C.w+t,h.y=0,g.push(h.x,h.y,h.z),I.push(a.x,a.y,a.z),r.push(T/C.w,M/C.h)}for(a=0;a<h.h;a++)for(k=0;k<h.w;k++)U(b+k*u,Z+a*l,b+(k+1)*u,Z+(a+1)*l);const E=new v.c;return E.indices=Y,E.jt=g,E.Vt=I,E.yt=r,E}function a(t){const b=[],Z=[],P=[],h=[];let C,Y;const g=t.colorFilter||new S.hZ(.3,.59,.11),r=t.alphaFilter||0;let M=!1;if(t.minHeight>t.maxHeight){M=!0;const b=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=b}for(C=0;C<=t.subdivisions;C++)for(Y=0;Y<=t.subdivisions;Y++){const b=new J.JZ(Y*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-C)*t.height/t.subdivisions-t.height/2),S=4*(((b.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(b.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth);let v=t.buffer[S]/255,T=t.buffer[S+1]/255,a=t.buffer[S+2]/255;const k=t.buffer[S+3]/255;M&&(v=1-v,T=1-T,a=1-a);const u=v*g.r+T*g.g+a*g.b;b.y=k>=r?t.minHeight+(t.maxHeight-t.minHeight)*u:t.minHeight-I.e,t.heightBuffer&&(t.heightBuffer[C*(t.subdivisions+1)+Y]=b.y),Z.push(b.x,b.y,b.z),P.push(0,0,0),h.push(Y/t.subdivisions,1-C/t.subdivisions)}for(C=0;C<t.subdivisions;C++)for(Y=0;Y<t.subdivisions;Y++){const J=Y+1+(C+1)*(t.subdivisions+1),S=Y+1+C*(t.subdivisions+1),P=Y+C*(t.subdivisions+1),v=Y+(C+1)*(t.subdivisions+1),h=Z[3*J+1]>=t.minHeight,g=Z[3*S+1]>=t.minHeight,I=Z[3*P+1]>=t.minHeight;h&&g&&I&&(b.push(J),b.push(S),b.push(P));Z[3*v+1]>=t.minHeight&&h&&I&&(b.push(v),b.push(J),b.push(P))}v.c.ComputeNormals(Z,b,P);const T=new v.c;return T.indices=b,T.jt=Z,T.Vt=P,T.yt=h,T}function k(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Z=new C(t,arguments.length>2?arguments[2]:void 0);Z._setReady(!1),Z._subdivisionsX=b.subdivisionsX||b.subdivisions||1,Z._subdivisionsY=b.subdivisionsY||b.subdivisions||1,Z._width=b.width||1,Z._height=b.height||1,Z._maxX=Z._width/2,Z._maxZ=Z._height/2,Z._minX=-Z._maxX,Z._minZ=-Z._maxZ;return M(b).st(Z,b.updatable),Z._setReady(!0),Z}function u(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new P.b(t,Z);return T(b).st(J,b.updatable),J}function l(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const P=Z.width||10,v=Z.height||10,h=Z.subdivisions||1,I=Z.minHeight||0,r=Z.maxHeight||1,M=Z.colorFilter||new S.hZ(.3,.59,.11),T=Z.alphaFilter||0,k=Z.updatable,u=Z.onReady;J=J||g.e.LastCreatedScene;const l=new C(t,J);let U;l._subdivisionsX=h,l._subdivisionsY=h,l._width=P,l._height=v,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ,l._setReady(!1),Z.passHeightBufferInCallback&&(U=new Float32Array((h+1)*(h+1)));const E=(t,b,Z)=>{a({width:P,height:v,subdivisions:h,minHeight:I,maxHeight:r,colorFilter:M,buffer:t,bufferWidth:b,bufferHeight:Z,alphaFilter:T,heightBuffer:U}).st(l,k),u&&u(l,U),l._setReady(!0)};if("string"===typeof b){const t=t=>{var b;const Z=t.width,S=t.height;if(J.h)return;const P=null===(b=J)||void 0===b?void 0:b.getEngine().resizeImageBitmap(t,Z,S);E(P,Z,S)};Y.Tools.LoadImage(b,t,Z.onError?Z.onError:()=>{},J.offlineProvider)}else E(b.data,b.width,b.height);return l}v.c.CreateGround=M,v.c.CreateTiledGround=T,v.c.CreateGroundFromHeightMap=a,P.b.CreateGround=(t,b,Z,J,S,P)=>k(t,{width:b,height:Z,subdivisions:J,updatable:P},S),P.b.CreateTiledGround=(t,b,Z,J,S,P,v,h,C)=>u(t,{xmin:b,zmin:Z,xmax:J,zmax:S,subdivisions:P,precision:v,updatable:C},h),P.b.CreateGroundFromHeightMap=(t,b,Z,J,S,P,v,h,C,Y,g)=>l(t,b,{width:Z,height:J,subdivisions:S,minHeight:P,maxHeight:v,updatable:C,onReady:Y,alphaFilter:g},h)},14594:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>M,h:()=>I,l:()=>r});var J=Z(12735),S=Z(13184),P=Z(13162),v=Z(13279),h=Z(12800),C=Z(12557);function Y(t){const b=[],Z=[],J=t.lines,S=t.nt,v=[];let h=0;for(let P=0;P<J.length;P++){const t=J[P];for(let J=0;J<t.length;J++){const{x:C,y:Y,z:g}=t[J];if(Z.push(C,Y,g),S){const t=S[P],{r:b,g:Z,b:h,a:C}=t[J];v.push(b,Z,h,C)}J>0&&(b.push(h-1),b.push(h)),h++}}const C=new P.c;return C.indices=b,C.jt=Z,S&&(C.nt=v),C}function g(t){const b=t.dashSize||3,Z=t.gapSize||1,S=t.dashNb||200,v=t.points,h=[],C=[],Y=J.JZ.Zero();let g=0,I=0,r=0,M=0,T=0,a=0,k=0;for(k=0;k<v.length-1;k++)v[k+1].subtractToRef(v[k],Y),g+=Y.length();for(r=g/S,M=b*r/(b+Z),k=0;k<v.length-1;k++){v[k+1].subtractToRef(v[k],Y),I=Math.floor(Y.length()/r),Y.normalize();for(let t=0;t<I;t++)T=r*t,h.push(v[k].x+T*Y.x,v[k].y+T*Y.y,v[k].z+T*Y.z),h.push(v[k].x+(T+M)*Y.x,v[k].y+(T+M)*Y.y,v[k].z+(T+M)*Y.z),C.push(a,a+1),a+=2}const u=new P.c;return u.jt=h,u.indices=C,u}function I(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=b.instance,S=b.lines,P=b.nt;if(J){const t=J.getVerticesData(h.g.PositionKind);let b,Z;P&&(b=J.getVerticesData(h.g.ColorKind));let v=0,C=0;for(let J=0;J<S.length;J++){const h=S[J];for(let S=0;S<h.length;S++)t[v]=h[S].x,t[v+1]=h[S].y,t[v+2]=h[S].z,P&&b&&(Z=P[J],b[C]=Z[S].r,b[C+1]=Z[S].g,b[C+2]=Z[S].b,b[C+3]=Z[S].a,C+=4),v+=3}return J.updateVerticesData(h.g.PositionKind,t,!1,!1),P&&b&&J.updateVerticesData(h.g.ColorKind,b,!1,!1),J.refreshBoundingInfo(),J}const C=!!P,g=new v.b(t,Z,null,void 0,void 0,C,b.useVertexAlpha,b.material);return Y(b).st(g,b.updatable),g}function r(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=b.nt?[b.nt]:null;return I(t,{lines:[b.points],updatable:b.updatable,instance:b.instance,nt:J,useVertexAlpha:b.useVertexAlpha,material:b.material},Z)}function M(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=b.points,h=b.instance,Y=b.gapSize||1,I=b.dashSize||3;if(h){const t=t=>{const b=J.JZ.Zero(),Z=t.length/6;let S=0,v=0,C=0,Y=0,g=0,I=0,r=0,M=0;for(r=0;r<P.length-1;r++)P[r+1].subtractToRef(P[r],b),S+=b.length();C=S/Z;const T=h._creationDataStorage.dashSize;for(Y=T*C/(T+h._creationDataStorage.gapSize),r=0;r<P.length-1;r++)for(P[r+1].subtractToRef(P[r],b),v=Math.floor(b.length()/C),b.normalize(),M=0;M<v&&I<t.length;)g=C*M,t[I]=P[r].x+g*b.x,t[I+1]=P[r].y+g*b.y,t[I+2]=P[r].z+g*b.z,t[I+3]=P[r].x+(g+Y)*b.x,t[I+4]=P[r].y+(g+Y)*b.y,t[I+5]=P[r].z+(g+Y)*b.z,I+=6,M++;for(;I<t.length;)t[I]=P[r].x,t[I+1]=P[r].y,t[I+2]=P[r].z,I+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&C.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),h.updateMeshPositions(t,!1),h}const r=new v.b(t,Z,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return g(b).st(r,b.updatable),r._creationDataStorage=new S.d,r._creationDataStorage.dashSize=I,r._creationDataStorage.gapSize=Y,r}P.c.CreateLineSystem=Y,P.c.CreateDashedLines=g,S.b.iY=function(t,b){return r(t,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},S.b.CreateDashedLines=function(t,b,Z,J,S){return M(t,{points:b,dashSize:Z,gapSize:J,dashNb:S,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13965:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>h,c:()=>C});var J=Z(13184),S=Z(13162),P=Z(12781);function v(t){const b=[],Z=[],J=[],v=[],h=void 0!==t.width?t.width:void 0!==t.size?t.size:1,C=void 0!==t.height?t.height:void 0!==t.size?t.size:1,Y=0===t.sideOrientation?0:t.sideOrientation||S.c.DEFAULTSIDE,g=h/2,I=C/2;Z.push(-g,-I,0),J.push(0,0,-1),v.push(0,P.e?1:0),Z.push(g,-I,0),J.push(0,0,-1),v.push(1,P.e?1:0),Z.push(g,I,0),J.push(0,0,-1),v.push(1,P.e?0:1),Z.push(-g,I,0),J.push(0,0,-1),v.push(0,P.e?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),S.c._ComputeSides(Y,Z,b,J,v,t.frontUVs,t.backUVs);const r=new S.c;return r.indices=b,r.jt=Z,r.Vt=J,r.yt=v,r}function h(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new J.b(t,Z);b.sideOrientation=J.b._GetDefaultSideOrientation(b.sideOrientation),S._originalBuilderSideOrientation=b.sideOrientation;return v(b).st(S,b.updatable),b.sourcePlane&&(S.translate(b.sourcePlane.normal,-b.sourcePlane.d),S.setDirection(b.sourcePlane.normal.scale(-1))),S}const C={fY:h};S.c.fY=v,J.b.fY=(t,b,Z,J,S)=>h(t,{size:b,width:b,height:b,sideOrientation:S,updatable:J},Z)},14064:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>C});var J=Z(12735),S=Z(13184),P=Z(13162),v=Z(12781);function h(t){const b=0|(t.segments||32),Z=t.diameterX||t.diameter||1,S=t.diameterY||t.diameter||1,h=t.diameterZ||t.diameter||1,C=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,Y=t.slice&&t.slice<=0?1:t.slice||1,g=0===t.sideOrientation?0:t.sideOrientation||P.c.DEFAULTSIDE,I=!!t.dedupTopBottomIndices,r=new J.JZ(Z/2,S/2,h/2),M=2+b,T=2*M,a=[],k=[],u=[],l=[];for(let P=0;P<=M;P++){const t=P/M,b=t*Math.PI*Y;for(let Z=0;Z<=T;Z++){const S=Z/T,P=S*Math.PI*2*C,h=J.Matrix.RotationZ(-b),Y=J.Matrix.RotationY(P),g=J.JZ.TransformCoordinates(J.JZ.Up(),h),I=J.JZ.TransformCoordinates(g,Y),M=I.multiply(r),a=I.divide(r).normalize();k.push(M.x,M.y,M.z),u.push(a.x,a.y,a.z),l.push(S,v.e?1-t:t)}if(P>0){const t=k.length/3;for(let b=t-2*(T+1);b+T+2<t;b++)I?(P>1&&(a.push(b),a.push(b+1),a.push(b+T+1)),(P<M||Y<1)&&(a.push(b+T+1),a.push(b+1),a.push(b+T+2))):(a.push(b),a.push(b+1),a.push(b+T+1),a.push(b+T+1),a.push(b+1),a.push(b+T+2))}}P.c._ComputeSides(g,k,a,u,l,t.frontUVs,t.backUVs);const U=new P.c;return U.indices=a,U.jt=k,U.Vt=u,U.yt=l,U}function C(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return h(b).st(J,b.updatable),J}P.c.CreateSphere=h,S.b.CreateSphere=(t,b,Z,J,S,P)=>C(t,{segments:b,diameterX:Z,diameterY:Z,diameterZ:Z,sideOrientation:P,updatable:S},J)},14926:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>h});var J=Z(13304),S=Z(14375),P=Z(13324),v=Z(13162);class h{static get Configuration(){return{get decoder(){return S.c.DefaultConfiguration},set decoder(t){S.c.DefaultConfiguration=t}}}static set Configuration(t){S.c.DefaultConfiguration=t.decoder}static get DecoderAvailable(){return(0,J.j)(S.c.DefaultConfiguration)}static get Default(){return h._Default??(h._Default=new h),h._Default}static ResetDefault(t){h._Default&&(t||h._Default.dispose(),h._Default=null)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.DefaultNumWorkers;const b="number"===typeof t?{...S.c.DefaultConfiguration,numWorkers:t}:{...S.c.DefaultConfiguration,...t};this._decoder=new S.c(b)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(t,b,Z){return this._decoder.decodeMeshToMeshDataAsync(t,b,Z)}async decodeMeshToGeometryAsync(t,b,Z,J){return await this._decoder.decodeMeshToGeometryAsync(t,b,Z,J)}async _decodeMeshToGeometryForGltfAsync(t,b,Z,J,S,P){return await this._decoder._decodeMeshToGeometryForGltfAsync(t,b,Z,J,S,P)}async decodeMeshAsync(t,b){const Z=await this._decoder.decodeMeshToMeshDataAsync(t,b),J=new v.c;Z.indices&&(J.indices=Z.indices);for(const S of Z.attributes){const t=P.b.GetFloatData(S.data,S.size,P.b.GetDataType(S.data),S.byteOffset,S.byteStride,S.normalized,Z.totalVertices);J.set(t,S.kind)}return J}}h.DefaultNumWorkers=(0,J.g)(),h._Default=null},14375:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>Y});var J=Z(13304),S=Z(12549),P=Z(13195),v=Z(13324),h=Z(12557),C=Z(13315);class Y extends J.d{static get DefaultAvailable(){return(0,J.j)(Y.DefaultConfiguration)}static get Default(){return Y._Default??(Y._Default=new Y),Y._Default}static ResetDefault(t){Y._Default&&(t||Y._Default.dispose(),Y._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(t,b){return{module:await(b||DracoDecoderModule)({wasmBinary:t})}}_getWorkerContent(){return`${C.c}(${C.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.DefaultConfiguration)}decodeMeshToMeshDataAsync(t,b,Z){const J=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t.buffer,t.byteOffset,t.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async t=>await new Promise(((S,P)=>{t.push(((t,v)=>{let C=null;const Y=[],g=b=>{t.removeEventListener("error",g),t.removeEventListener("message",I),P(b),v()},I=b=>{const J=b.data;switch(J.id){case"indices":C=J.data;break;case"attribute":Y.push({kind:J.kind,data:J.data,size:J.size,byteOffset:J.byteOffset,byteStride:J.byteStride,normalized:(P=J.kind,r=J.normalized,Z&&void 0!==Z[P]?(r!==Z[P]&&h.c.Warn(`Normalized flag from Draco data (${r}) does not match normalized flag from glTF accessor (${Z[P]}). Using flag from glTF accessor.`),Z[P]):r)});break;case"decodeMeshDone":t.removeEventListener("error",g),t.removeEventListener("message",I),S({indices:C,attributes:Y,totalVertices:J.totalVertices}),v()}var P,r};t.addEventListener("error",g),t.addEventListener("message",I);const r=J.slice();t.postMessage({id:"decodeMesh",dataView:r,attributes:b},[r.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((t=>{let Z=null;const S=[],P=(0,C.c)(t.module,J,b,(t=>{Z=t}),((t,b,Z,J,P,v)=>{S.push({kind:t,data:b,size:Z,byteOffset:J,byteStride:P,normalized:v})}));return{indices:Z,attributes:S,totalVertices:P}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(t,b,Z,J){const S=await this.decodeMeshToMeshDataAsync(Z,J),h=new P.c(t,b);S.indices&&h.setIndices(S.indices);for(const P of S.attributes)h.setVerticesBuffer(new v.b(b.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),S.totalVertices);return h}async _decodeMeshToGeometryForGltfAsync(t,b,Z,J,S,h){const C=await this.decodeMeshToMeshDataAsync(Z,J,S),Y=new P.c(t,b);h&&(Y._boundingInfo=h,Y.useBoundingInfoFromGeometry=!0),C.indices&&Y.setIndices(C.indices);for(const P of C.attributes)Y.setVerticesBuffer(new v.b(b.getEngine(),P.data,P.kind,!1,void 0,P.byteStride,void 0,P.byteOffset,P.size,void 0,P.normalized,!0),C.totalVertices);return Y}}Y.DefaultConfiguration={wasmUrl:`${S.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${S.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${S.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},Y._Default=null},14591:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>ht});var J=Z(12735),S=Z(13184),P=Z(12800),v=Z(13162),h=Z(12781);function C(t){let b=t.pathArray;const Z=t.closeArray||!1,J=t.closePath||!1,S=t.invertUV||!1,C=Math.floor(b[0].length/2);let Y=t.offset||C;Y=Y>C?C:Math.floor(Y);const g=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,I=t.yt,r=t.nt,M=[],T=[],a=[],k=[],u=[],l=[],U=[],E=[];let c;const H=[],o=[];let O,p,e;if(b.length<2){const t=[],Z=[];for(p=0;p<b[0].length-Y;p++)t.push(b[0][p]),Z.push(b[0][p+Y]);b=[t,Z]}let W=0;const j=J?1:0,V=Z?1:0;let n,y,d,s,q,Q;for(c=b[0].length,O=0;O<b.length+V;O++){for(U[O]=0,u[O]=[0],n=O===b.length?b[0]:b[O],y=n.length,c=c<y?c:y,e=0;e<y;)M.push(n[e].x,n[e].y,n[e].z),e>0&&(d=n[e].SZ(n[e-1]).length(),s=d+U[O],u[O].push(s),U[O]=s),e++;J&&(e--,M.push(n[0].x,n[0].y,n[0].z),d=n[e].SZ(n[0]).length(),s=d+U[O],u[O].push(s),U[O]=s),H[O]=y+j,o[O]=W,W+=y+j}let N,A,K=null,L=null;for(p=0;p<c+j;p++)for(E[p]=0,l[p]=[0],O=0;O<b.length-1+V;O++)q=b[O],Q=O===b.length-1?b[0]:b[O+1],p===c?(K=q[0],L=Q[0]):(K=q[p],L=Q[p]),d=L.SZ(K).length(),s=d+E[p],l[p].push(s),E[p]=s;if(I)for(O=0;O<I.length;O++)k.push(I[O].x,h.e?1-I[O].y:I[O].y);else for(O=0;O<b.length+V;O++)for(p=0;p<c+j;p++)N=0!=U[O]?u[O][p]/U[O]:0,A=0!=E[p]?l[p][O]/E[p]:0,S?k.push(A,N):k.push(N,h.e?1-A:A);O=0;let F=0,B=H[O]-1,X=H[O+1]-1,x=B<X?B:X,i=o[1]-o[0];const z=H.length-1;for(;F<=x&&O<z;)T.push(F,F+i,F+1),T.push(F+i+1,F+1,F+i),F+=1,F===x&&(O++,i=o[O+1]-o[O],B=H[O]-1,X=H[O+1]-1,F=o[O],x=B<X?B+F:X+F);if(v.c.ComputeNormals(M,T,a),J){let t=0,Z=0;for(O=0;O<b.length;O++){t=3*o[O],Z=O+1<b.length?3*(o[O+1]-1):a.length-3,a[t]=.5*(a[t]+a[Z]),a[t+1]=.5*(a[t+1]+a[Z+1]),a[t+2]=.5*(a[t+2]+a[Z+2]);const J=Math.sqrt(a[t]*a[t]+a[t+1]*a[t+1]+a[t+2]*a[t+2]);a[t]/=J,a[t+1]/=J,a[t+2]/=J,a[Z]=a[t],a[Z+1]=a[t+1],a[Z+2]=a[t+2]}}if(Z){let t=3*o[0],Z=3*o[b.length];for(p=0;p<c+j;p++){a[t]=.5*(a[t]+a[Z]),a[t+1]=.5*(a[t+1]+a[Z+1]),a[t+2]=.5*(a[t+2]+a[Z+2]);const b=Math.sqrt(a[t]*a[t]+a[t+1]*a[t+1]+a[t+2]*a[t+2]);a[t]/=b,a[t+1]/=b,a[t+2]/=b,a[Z]=a[t],a[Z+1]=a[t+1],a[Z+2]=a[t+2],t+=3,Z+=3}}v.c._ComputeSides(g,M,T,a,k,t.frontUVs,t.backUVs);let D=null;if(r){D=new Float32Array(4*r.length);for(let t=0;t<r.length;t++)D[4*t]=r[t].r,D[4*t+1]=r[t].g,D[4*t+2]=r[t].b,D[4*t+3]=r[t].a}const f=new v.c,mt=new Float32Array(M),R=new Float32Array(a),w=new Float32Array(k);return f.indices=T,f.jt=mt,f.Vt=R,f.yt=w,D&&f.set(D,P.g.ColorKind),J&&(f._idx=o),f}function Y(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=b.pathArray,g=b.closeArray,I=b.closePath,r=S.b._GetDefaultSideOrientation(b.sideOrientation),M=b.instance,T=b.updatable;if(M){const t=J.TmpVectors.JZ[0].Lb(Number.MAX_VALUE),Z=J.TmpVectors.JZ[1].Lb(-Number.MAX_VALUE),C=b=>{let J=Y[0].length;const P=M;let v=0;const h=P._originalBuilderSideOrientation===S.b.DOUBLESIDE?2:1;for(let S=1;S<=h;++S)for(let h=0;h<Y.length;++h){const S=Y[h],C=S.length;J=J<C?J:C;for(let P=0;P<J;++P){const J=S[P];b[v]=J.x,b[v+1]=J.y,b[v+2]=J.z,t.minimizeInPlaceFromFloats(J.x,J.y,J.z),Z.maximizeInPlaceFromFloats(J.x,J.y,J.z),v+=3}if(P._creationDataStorage&&P._creationDataStorage.closePath){const t=S[0];b[v]=t.x,b[v+1]=t.y,b[v+2]=t.z,v+=3}}},g=M.getVerticesData(P.g.PositionKind);if(C(g),M.hasBoundingInfo?M.getBoundingInfo().reConstruct(t,Z,M._worldMatrix):M.buildBoundingInfo(t,Z,M._worldMatrix),M.updateVerticesData(P.g.PositionKind,g,!1,!1),b.nt){const t=M.getVerticesData(P.g.ColorKind);for(let Z=0,J=0;Z<b.nt.length;Z++,J+=4){const S=b.nt[Z];t[J]=S.r,t[J+1]=S.g,t[J+2]=S.b,t[J+3]=S.a}M.updateVerticesData(P.g.ColorKind,t,!1,!1)}if(b.yt){const t=M.getVerticesData(P.g.UVKind);for(let Z=0;Z<b.yt.length;Z++)t[2*Z]=b.yt[Z].x,t[2*Z+1]=h.e?1-b.yt[Z].y:b.yt[Z].y;M.updateVerticesData(P.g.UVKind,t,!1,!1)}if(!M.areNormalsFrozen||M.isFacetDataEnabled){const t=M.Qb(),b=M.getVerticesData(P.g.NormalKind),Z=M.isFacetDataEnabled?M.getFacetDataParameters():null;if(v.c.ComputeNormals(g,t,b,Z),M._creationDataStorage&&M._creationDataStorage.closePath){let t=0,Z=0;for(let J=0;J<Y.length;J++)t=3*M._creationDataStorage.idx[J],Z=J+1<Y.length?3*(M._creationDataStorage.idx[J+1]-1):b.length-3,b[t]=.5*(b[t]+b[Z]),b[t+1]=.5*(b[t+1]+b[Z+1]),b[t+2]=.5*(b[t+2]+b[Z+2]),b[Z]=b[t],b[Z+1]=b[t+1],b[Z+2]=b[t+2]}M.areNormalsFrozen||M.updateVerticesData(P.g.NormalKind,b,!1,!1)}return M}{const J=new S.b(t,Z);J._originalBuilderSideOrientation=r,J._creationDataStorage=new S.d;const P=C(b);return I&&(J._creationDataStorage.idx=P._idx),J._creationDataStorage.closePath=I,J._creationDataStorage.closeArray=g,P.st(J,T),J}}v.c.CreateRibbon=C,S.b.CreateRibbon=function(t,b){return Y(t,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var g=Z(14077),I=Z(13911),r=Z(12775);function M(t){const b=t.pattern||S.b.NO_FLIP,Z=t.tileWidth||t.tileSize||1,J=t.tileHeight||t.tileSize||1,P=t.alignHorizontal||0,h=t.alignVertical||0,C=t.width||t.size||1,Y=Math.floor(C/Z);let g=C-Y*Z;const I=t.height||t.size||1,r=Math.floor(I/J);let M=I-r*J;const T=Z*Y/2,a=J*r/2;let k=0,u=0,l=0,U=0,E=0,c=0;if(g>0||M>0){switch(l=-T,U=-a,E=T,c=a,P){case S.b.CENTER:g/=2,l-=g,E+=g;break;case S.b.LEFT:E+=g,k=-g/2;break;case S.b.RIGHT:l-=g,k=g/2}switch(h){case S.b.CENTER:M/=2,U-=M,c+=M;break;case S.b.BOTTOM:c+=M,u=-M/2;break;case S.b.TOP:U-=M,u=M/2}}const H=[],o=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],b!==S.b.ROTATE_TILE&&b!==S.b.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),b!==S.b.FLIP_TILE&&b!==S.b.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),b!==S.b.FLIP_N_ROTATE_TILE&&b!==S.b.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let p=[];const e=[],W=[];let j=0;for(let v=0;v<r;v++)for(let t=0;t<Y;t++)H.push(t*Z-T+k,v*J-a+u,0),H.push((t+1)*Z-T+k,v*J-a+u,0),H.push((t+1)*Z-T+k,(v+1)*J-a+u,0),H.push(t*Z-T+k,(v+1)*J-a+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),p=b===S.b.FLIP_TILE||b===S.b.ROTATE_TILE||b===S.b.FLIP_N_ROTATE_TILE?p.concat(O[(t%2+v%2)%2]):b===S.b.FLIP_ROW||b===S.b.ROTATE_ROW||b===S.b.FLIP_N_ROTATE_ROW?p.concat(O[v%2]):p.concat(O[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),j+=4;if(g>0||M>0){const t=M>0&&(h===S.b.CENTER||h===S.b.TOP),v=M>0&&(h===S.b.CENTER||h===S.b.BOTTOM),C=g>0&&(P===S.b.CENTER||P===S.b.RIGHT),I=g>0&&(P===S.b.CENTER||P===S.b.LEFT);let O,V,n,y,d=[];if(t&&C&&(H.push(l+k,U+u,0),H.push(-T+k,U+u,0),H.push(-T+k,U+M+u,0),H.push(l+k,U+M+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,O=1-g/Z,V=1-M/J,n=1,y=1,d=[O,V,n,V,n,y,O,y],b===S.b.ROTATE_ROW&&(d=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),b===S.b.FLIP_ROW&&(d=[1-O,V,1-n,V,1-n,y,1-O,y]),b===S.b.FLIP_N_ROTATE_ROW&&(d=[O,1-V,n,1-V,n,1-y,O,1-y]),p=p.concat(d),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t&&I&&(H.push(T+k,U+u,0),H.push(E+k,U+u,0),H.push(E+k,U+M+u,0),H.push(T+k,U+M+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,O=0,V=1-M/J,n=g/Z,y=1,d=[O,V,n,V,n,y,O,y],(b===S.b.ROTATE_ROW||b===S.b.ROTATE_TILE&&Y%2===0)&&(d=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),(b===S.b.FLIP_ROW||b===S.b.FLIP_TILE&&Y%2===0)&&(d=[1-O,V,1-n,V,1-n,y,1-O,y]),(b===S.b.FLIP_N_ROTATE_ROW||b===S.b.FLIP_N_ROTATE_TILE&&Y%2===0)&&(d=[O,1-V,n,1-V,n,1-y,O,1-y]),p=p.concat(d),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&C&&(H.push(l+k,a+u,0),H.push(-T+k,a+u,0),H.push(-T+k,c+u,0),H.push(l+k,c+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,O=1-g/Z,V=0,n=1,y=M/J,d=[O,V,n,V,n,y,O,y],(b===S.b.ROTATE_ROW&&r%2===1||b===S.b.ROTATE_TILE&&r%1===0)&&(d=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),(b===S.b.FLIP_ROW&&r%2===1||b===S.b.FLIP_TILE&&r%2===0)&&(d=[1-O,V,1-n,V,1-n,y,1-O,y]),(b===S.b.FLIP_N_ROTATE_ROW&&r%2===1||b===S.b.FLIP_N_ROTATE_TILE&&r%2===0)&&(d=[O,1-V,n,1-V,n,1-y,O,1-y]),p=p.concat(d),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&I&&(H.push(T+k,a+u,0),H.push(E+k,a+u,0),H.push(E+k,c+u,0),H.push(T+k,c+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,O=0,V=0,n=g/Z,y=M/J,d=[O,V,n,V,n,y,O,y],(b===S.b.ROTATE_ROW&&r%2===1||b===S.b.ROTATE_TILE&&(r+Y)%2===1)&&(d=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),(b===S.b.FLIP_ROW&&r%2===1||b===S.b.FLIP_TILE&&(r+Y)%2===1)&&(d=[1-O,V,1-n,V,1-n,y,1-O,y]),(b===S.b.FLIP_N_ROTATE_ROW&&r%2===1||b===S.b.FLIP_N_ROTATE_TILE&&(r+Y)%2===1)&&(d=[O,1-V,n,1-V,n,1-y,O,1-y]),p=p.concat(d),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),t){const t=[];O=0,V=1-M/J,n=1,y=1,t[0]=[O,V,n,V,n,y,O,y],t[1]=[O,V,n,V,n,y,O,y],b!==S.b.ROTATE_TILE&&b!==S.b.ROTATE_ROW||(t[1]=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),b!==S.b.FLIP_TILE&&b!==S.b.FLIP_ROW||(t[1]=[1-O,V,1-n,V,1-n,y,1-O,y]),b!==S.b.FLIP_N_ROTATE_TILE&&b!==S.b.FLIP_N_ROTATE_ROW||(t[1]=[O,1-V,n,1-V,n,1-y,O,1-y]);for(let J=0;J<Y;J++)H.push(J*Z-T+k,U+u,0),H.push((J+1)*Z-T+k,U+u,0),H.push((J+1)*Z-T+k,U+M+u,0),H.push(J*Z-T+k,U+M+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=b===S.b.FLIP_TILE||b===S.b.ROTATE_TILE||b===S.b.FLIP_N_ROTATE_TILE?p.concat(t[(J+1)%2]):b===S.b.FLIP_ROW||b===S.b.ROTATE_ROW||b===S.b.FLIP_N_ROTATE_ROW?p.concat(t[1]):p.concat(t[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const t=[];O=0,V=0,n=1,y=M/J,t[0]=[O,V,n,V,n,y,O,y],t[1]=[O,V,n,V,n,y,O,y],b!==S.b.ROTATE_TILE&&b!==S.b.ROTATE_ROW||(t[1]=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),b!==S.b.FLIP_TILE&&b!==S.b.FLIP_ROW||(t[1]=[1-O,V,1-n,V,1-n,y,1-O,y]),b!==S.b.FLIP_N_ROTATE_TILE&&b!==S.b.FLIP_N_ROTATE_ROW||(t[1]=[O,1-V,n,1-V,n,1-y,O,1-y]);for(let J=0;J<Y;J++)H.push(J*Z-T+k,c-M+u,0),H.push((J+1)*Z-T+k,c-M+u,0),H.push((J+1)*Z-T+k,c+u,0),H.push(J*Z-T+k,c+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=b===S.b.FLIP_TILE||b===S.b.ROTATE_TILE||b===S.b.FLIP_N_ROTATE_TILE?p.concat(t[(J+r)%2]):b===S.b.FLIP_ROW||b===S.b.ROTATE_ROW||b===S.b.FLIP_N_ROTATE_ROW?p.concat(t[r%2]):p.concat(t[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const t=[];O=1-g/Z,V=0,n=1,y=1,t[0]=[O,V,n,V,n,y,O,y],t[1]=[O,V,n,V,n,y,O,y],b!==S.b.ROTATE_TILE&&b!==S.b.ROTATE_ROW||(t[1]=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),b!==S.b.FLIP_TILE&&b!==S.b.FLIP_ROW||(t[1]=[1-O,V,1-n,V,1-n,y,1-O,y]),b!==S.b.FLIP_N_ROTATE_TILE&&b!==S.b.FLIP_N_ROTATE_ROW||(t[1]=[O,1-V,n,1-V,n,1-y,O,1-y]);for(let Z=0;Z<r;Z++)H.push(l+k,Z*J-a+u,0),H.push(l+g+k,Z*J-a+u,0),H.push(l+g+k,(Z+1)*J-a+u,0),H.push(l+k,(Z+1)*J-a+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=b===S.b.FLIP_TILE||b===S.b.ROTATE_TILE||b===S.b.FLIP_N_ROTATE_TILE?p.concat(t[(Z+1)%2]):b===S.b.FLIP_ROW||b===S.b.ROTATE_ROW||b===S.b.FLIP_N_ROTATE_ROW?p.concat(t[Z%2]):p.concat(t[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(I){const t=[];O=0,V=0,n=g/J,y=1,t[0]=[O,V,n,V,n,y,O,y],t[1]=[O,V,n,V,n,y,O,y],b!==S.b.ROTATE_TILE&&b!==S.b.ROTATE_ROW||(t[1]=[1-O,1-V,1-n,1-V,1-n,1-y,1-O,1-y]),b!==S.b.FLIP_TILE&&b!==S.b.FLIP_ROW||(t[1]=[1-O,V,1-n,V,1-n,y,1-O,y]),b!==S.b.FLIP_N_ROTATE_TILE&&b!==S.b.FLIP_N_ROTATE_ROW||(t[1]=[O,1-V,n,1-V,n,1-y,O,1-y]);for(let Z=0;Z<r;Z++)H.push(E-g+k,Z*J-a+u,0),H.push(E+k,Z*J-a+u,0),H.push(E+k,(Z+1)*J-a+u,0),H.push(E-g+k,(Z+1)*J-a+u,0),W.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=b===S.b.FLIP_TILE||b===S.b.ROTATE_TILE||b===S.b.FLIP_N_ROTATE_TILE?p.concat(t[(Z+Y)%2]):b===S.b.FLIP_ROW||b===S.b.ROTATE_ROW||b===S.b.FLIP_N_ROTATE_ROW?p.concat(t[Z%2]):p.concat(t[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),o.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const V=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE;v.c._ComputeSides(V,H,W,o,p,t.frontUVs,t.backUVs);const n=new v.c;n.indices=W,n.jt=H,n.Vt=o,n.yt=p;const y=V===v.c.DOUBLESIDE?e.concat(e):e;return n.nt=y,n}function T(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return M(b).st(J,b.updatable),J}function a(t){const b=t.faceUV||new Array(6),Z=t.faceColors,P=t.pattern||S.b.NO_FLIP,C=t.width||t.size||1,Y=t.height||t.size||1,g=t.depth||t.size||1,I=t.tileWidth||t.tileSize||1,T=t.tileHeight||t.tileSize||1,a=t.alignHorizontal||0,k=t.alignVertical||0,u=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE;for(let S=0;S<6;S++)void 0===b[S]&&(b[S]=new J.Vector4(0,0,1,1)),Z&&void 0===Z[S]&&(Z[S]=new r.Fb(1,1,1,1));const l=C/2,U=Y/2,E=g/2,c=[];for(let J=0;J<2;J++)c[J]=M({pattern:P,tileWidth:I,tileHeight:T,width:C,height:Y,alignVertical:k,alignHorizontal:a,sideOrientation:u});for(let J=2;J<4;J++)c[J]=M({pattern:P,tileWidth:I,tileHeight:T,width:g,height:Y,alignVertical:k,alignHorizontal:a,sideOrientation:u});let H=k;k===S.b.BOTTOM?H=S.b.TOP:k===S.b.TOP&&(H=S.b.BOTTOM);for(let J=4;J<6;J++)c[J]=M({pattern:P,tileWidth:I,tileHeight:T,width:C,height:g,alignVertical:H,alignHorizontal:a,sideOrientation:u});let o=[],O=[],p=[],e=[];const W=[],j=[],V=[],n=[];let y=0,d=0;for(let S=0;S<6;S++){const t=c[S].jt.length;j[S]=[],V[S]=[];for(let b=0;b<t/3;b++)j[S].push(new J.JZ(c[S].jt[3*b],c[S].jt[3*b+1],c[S].jt[3*b+2])),V[S].push(new J.JZ(c[S].Vt[3*b],c[S].Vt[3*b+1],c[S].Vt[3*b+2]));y=c[S].yt.length,n[S]=[];for(let Z=0;Z<y;Z+=2)n[S][Z]=b[S].x+(b[S].z-b[S].x)*c[S].yt[Z],n[S][Z+1]=b[S].y+(b[S].w-b[S].y)*c[S].yt[Z+1],h.e&&(n[S][Z+1]=1-n[S][Z+1]);if(p=p.concat(n[S]),e=e.concat(c[S].indices.map((t=>t+d))),d+=j[S].length,Z)for(let b=0;b<4;b++)W.push(Z[S].r,Z[S].g,Z[S].b,Z[S].a)}const s=new J.JZ(0,0,E),q=J.Matrix.RotationY(Math.PI);o=j[0].map((t=>J.JZ.TransformNormal(t,q).add(s))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]),O=V[0].map((t=>J.JZ.TransformNormal(t,q))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]),o=o.concat(j[1].map((t=>t.SZ(s))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),O=O.concat(V[1].map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const Q=new J.JZ(l,0,0),N=J.Matrix.RotationY(-Math.PI/2);o=o.concat(j[2].map((t=>J.JZ.TransformNormal(t,N).add(Q))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),O=O.concat(V[2].map((t=>J.JZ.TransformNormal(t,N))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const A=J.Matrix.RotationY(Math.PI/2);o=o.concat(j[3].map((t=>J.JZ.TransformNormal(t,A).SZ(Q))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),O=O.concat(V[3].map((t=>J.JZ.TransformNormal(t,A))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const K=new J.JZ(0,U,0),L=J.Matrix.RotationX(Math.PI/2);o=o.concat(j[4].map((t=>J.JZ.TransformNormal(t,L).add(K))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),O=O.concat(V[4].map((t=>J.JZ.TransformNormal(t,L))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[]));const F=J.Matrix.RotationX(-Math.PI/2);o=o.concat(j[5].map((t=>J.JZ.TransformNormal(t,F).SZ(K))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),O=O.concat(V[5].map((t=>J.JZ.TransformNormal(t,F))).map((t=>[t.x,t.y,t.z])).reduce(((t,b)=>t.concat(b)),[])),v.c._ComputeSides(u,o,e,O,p);const B=new v.c;if(B.indices=e,B.jt=o,B.Vt=O,B.yt=p,Z){const t=u===v.c.DOUBLESIDE?W.concat(W):W;B.nt=t}return B}function k(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return a(b).st(J,b.updatable),J}v.c.CreateTiledPlane=M;v.c.CreateTiledBox=a;var u=Z(14064),l=Z(12975),U=Z(12936);function E(t){const b=t.height||2;let Z=0===t.diameterTop?0:t.diameterTop||t.diameter||1,P=0===t.diameterBottom?0:t.diameterBottom||t.diameter||1;Z=Z||1e-5,P=P||1e-5;const C=0|(t.tessellation||24),Y=0|(t.subdivisions||1),g=!!t.hasRings,I=!!t.enclose,M=0===t.cap?0:t.cap||S.b.CAP_ALL,T=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,a=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,k=t.faceUV||new Array(3),u=t.faceColors,l=2+(1+(1!==T&&I?2:0))*(g?Y:1);let E;for(E=0;E<l;E++)u&&void 0===u[E]&&(u[E]=new r.Fb(1,1,1,1));for(E=0;E<l;E++)k&&void 0===k[E]&&(k[E]=new J.Vector4(0,0,1,1));const c=[],H=[],o=[],O=[],p=[],e=2*Math.PI*T/C;let W,j,V;const n=(P-Z)/2/b,y=J.JZ.Zero(),d=J.JZ.Zero(),s=J.JZ.Zero(),q=J.JZ.Zero(),Q=J.JZ.Zero(),N=U.e.Y;let A,K,L,F=1,B=1,X=0,x=0;for(A=0;A<=Y;A++)for(j=A/Y,V=(j*(Z-P)+P)/2,F=g&&0!==A&&A!==Y?2:1,L=0;L<F;L++){for(g&&(B+=L),I&&(B+=2*L),K=0;K<=C;K++)W=K*e,y.x=Math.cos(-W)*V,y.y=-b/2+j*b,y.z=Math.sin(-W)*V,0===Z&&A===Y?(d.x=o[o.length-3*(C+1)],d.y=o[o.length-3*(C+1)+1],d.z=o[o.length-3*(C+1)+2]):(d.x=y.x,d.z=y.z,d.y=Math.sqrt(d.x*d.x+d.z*d.z)*n,d.normalize()),0===K&&(s.S(y),q.S(d)),H.push(y.x,y.y,y.z),o.push(d.x,d.y,d.z),x=g?X!==B?k[B].y:k[B].w:k[B].y+(k[B].w-k[B].y)*j,O.push(k[B].x+(k[B].z-k[B].x)*K/C,h.e?1-x:x),u&&p.push(u[B].r,u[B].g,u[B].b,u[B].a);1!==T&&I&&(H.push(y.x,y.y,y.z),H.push(0,y.y,0),H.push(0,y.y,0),H.push(s.x,s.y,s.z),J.JZ.CrossToRef(N,d,Q),Q.normalize(),o.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),J.JZ.CrossToRef(q,N,Q),Q.normalize(),o.push(Q.x,Q.y,Q.z,Q.x,Q.y,Q.z),x=g?X!==B?k[B+1].y:k[B+1].w:k[B+1].y+(k[B+1].w-k[B+1].y)*j,O.push(k[B+1].x,h.e?1-x:x),O.push(k[B+1].z,h.e?1-x:x),x=g?X!==B?k[B+2].y:k[B+2].w:k[B+2].y+(k[B+2].w-k[B+2].y)*j,O.push(k[B+2].x,h.e?1-x:x),O.push(k[B+2].z,h.e?1-x:x),u&&(p.push(u[B+1].r,u[B+1].g,u[B+1].b,u[B+1].a),p.push(u[B+1].r,u[B+1].g,u[B+1].b,u[B+1].a),p.push(u[B+2].r,u[B+2].g,u[B+2].b,u[B+2].a),p.push(u[B+2].r,u[B+2].g,u[B+2].b,u[B+2].a))),X!==B&&(X=B)}const i=1!==T&&I?C+4:C;for(A=0,B=0;B<Y;B++){let t=0,b=0,Z=0,J=0;for(K=0;K<C;K++)t=A*(i+1)+K,b=(A+1)*(i+1)+K,Z=A*(i+1)+(K+1),J=(A+1)*(i+1)+(K+1),c.push(t,b,Z),c.push(J,Z,b);1!==T&&I&&(c.push(t+2,b+2,Z+2),c.push(J+2,Z+2,b+2),c.push(t+4,b+4,Z+4),c.push(J+4,Z+4,b+4)),A=g?A+2:A+1}const z=t=>{const S=t?Z/2:P/2;if(0===S)return;let v,Y,g;const I=t?k[l-1]:k[0];let r=null;u&&(r=t?u[l-1]:u[0]);const M=H.length/3,a=t?b/2:-b/2,U=new J.JZ(0,a,0);H.push(U.x,U.y,U.z),o.push(0,t?1:-1,0);const E=I.y+.5*(I.w-I.y);O.push(I.x+.5*(I.z-I.x),h.e?1-E:E),r&&p.push(r.r,r.g,r.b,r.a);const e=new J.Vector2(.5,.5);for(g=0;g<=C;g++){v=2*Math.PI*g*T/C;const b=Math.cos(-v),Z=Math.sin(-v);Y=new J.JZ(b*S,a,Z*S);const P=new J.Vector2(b*e.x+.5,Z*e.y+.5);H.push(Y.x,Y.y,Y.z),o.push(0,t?1:-1,0);const M=I.y+(I.w-I.y)*P.y;O.push(I.x+(I.z-I.x)*P.x,h.e?1-M:M),r&&p.push(r.r,r.g,r.b,r.a)}for(g=0;g<C;g++)t?(c.push(M),c.push(M+(g+2)),c.push(M+(g+1))):(c.push(M),c.push(M+(g+1)),c.push(M+(g+2)))};M!==S.b.CAP_START&&M!==S.b.CAP_ALL||z(!1),M!==S.b.CAP_END&&M!==S.b.CAP_ALL||z(!0),v.c._ComputeSides(a,H,c,o,O,t.frontUVs,t.backUVs);const D=new v.c;return D.indices=c,D.jt=H,D.Vt=o,D.yt=O,u&&(D.nt=p),D}function c(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return E(b).st(J,b.updatable),J}function H(t){const b=[],Z=[],S=[],P=[],C=t.diameter||1,Y=t.thickness||.5,g=0|(t.tessellation||16),I=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,r=g+1;for(let v=0;v<=g;v++){const t=v/g,I=v*Math.PI*2/g-Math.PI/2,M=J.Matrix.Translation(C/2,0,0).multiply(J.Matrix.RotationY(I));for(let C=0;C<=g;C++){const I=1-C/g,T=C*Math.PI*2/g+Math.PI,a=Math.cos(T),k=Math.sin(T);let u=new J.JZ(a,k,0),l=u.scale(Y/2);const U=new J.Vector2(t,I);l=J.JZ.TransformCoordinates(l,M),u=J.JZ.TransformNormal(u,M),Z.push(l.x,l.y,l.z),S.push(u.x,u.y,u.z),P.push(U.x,h.e?1-U.y:U.y);const E=(v+1)%r,c=(C+1)%r;b.push(v*r+C),b.push(v*r+c),b.push(E*r+C),b.push(v*r+c),b.push(E*r+c),b.push(E*r+C)}}v.c._ComputeSides(I,Z,b,S,P,t.frontUVs,t.backUVs);const M=new v.c;return M.indices=b,M.jt=Z,M.Vt=S,M.yt=P,M}function o(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return H(b).st(J,b.updatable),J}v.c.CreateCylinder=E,S.b.CreateCylinder=(t,b,Z,J,P,v,h,C,Y)=>{void 0!==h&&h instanceof l.d||(void 0!==h&&(Y=C||S.b.DEFAULTSIDE,C=h),h=v,v=1);return c(t,{height:b,diameterTop:Z,diameterBottom:J,tessellation:P,subdivisions:v,sideOrientation:Y,updatable:C},h)};function O(t){const b=[],Z=[],S=[],P=[],C=t.radius||2,Y=t.tube||.5,g=t.radialSegments||32,I=t.tubularSegments||32,r=t.p||2,M=t.q||3,T=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,a=t=>{const b=Math.cos(t),Z=Math.sin(t),S=M/r*t,P=Math.cos(S),v=C*(2+P)*.5*b,h=C*(2+P)*Z*.5,Y=C*Math.sin(S)*.5;return new J.JZ(v,h,Y)};let k,u;for(k=0;k<=g;k++){const t=k%g/g*2*r*Math.PI,b=a(t),S=a(t+.01),v=S.SZ(b);let C=S.add(b);const M=J.JZ.Cross(v,C);for(C=J.JZ.Cross(M,v),M.normalize(),C.normalize(),u=0;u<I;u++){const t=u%I/I*2*Math.PI,J=-Y*Math.cos(t),S=Y*Math.sin(t);Z.push(b.x+J*C.x+S*M.x),Z.push(b.y+J*C.y+S*M.y),Z.push(b.z+J*C.z+S*M.z),P.push(k/g),P.push(h.e?1-u/I:u/I)}}for(k=0;k<g;k++)for(u=0;u<I;u++){const t=(u+1)%I,Z=k*I+u,J=(k+1)*I+u,S=(k+1)*I+t,P=k*I+t;b.push(P),b.push(J),b.push(Z),b.push(P),b.push(S),b.push(J)}v.c.ComputeNormals(Z,b,S),v.c._ComputeSides(T,Z,b,S,P,t.frontUVs,t.backUVs);const l=new v.c;return l.indices=b,l.jt=Z,l.Vt=S,l.yt=P,l}function p(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2?arguments[2]:void 0;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return O(b).st(J,b.updatable),J}v.c.CreateTorus=H,S.b.CreateTorus=(t,b,Z,J,S,P,v)=>o(t,{diameter:b,thickness:Z,tessellation:J,sideOrientation:v,updatable:P},S);v.c.CreateTorusKnot=O,S.b.CreateTorusKnot=(t,b,Z,J,S,P,v,h,C,Y)=>p(t,{radius:b,tube:Z,radialSegments:J,tubularSegments:S,p:P,q:v,sideOrientation:Y,updatable:C},h);var e=Z(14594),W=Z(13292),j=Z(12944);function V(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=b.path,P=b.shape,v=b.scale||1,h=b.rotation||0,C=0===b.cap?0:b.cap||S.b.NO_CAP,Y=b.updatable,g=S.b._GetDefaultSideOrientation(b.sideOrientation),I=b.instance||null,r=b.invertUV||!1,M=b.closeShape||!1,T=b.closePath||!1,a=b.capFunction||null;return y(t,P,J,v,h,null,null,T,M,C,!1,Z,!!Y,g,I,r,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame,a)}function n(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=b.path,P=b.shape,v=b.scaleFunction||(()=>1),h=b.rotationFunction||(()=>0),C=b.closePath||b.ribbonCloseArray||!1,Y=b.closeShape||b.ribbonClosePath||!1,g=0===b.cap?0:b.cap||S.b.NO_CAP,I=b.updatable,r=b.firstNormal||null,M=b.adjustFrame||!1,T=S.b._GetDefaultSideOrientation(b.sideOrientation),a=b.instance,k=b.invertUV||!1,u=b.capFunction||null;return y(t,P,J,null,null,v,h,C,Y,g,!0,Z,!!I,T,a||null,k,b.frontUVs||null,b.backUVs||null,r,M,u||null)}function y(t,b,Z,P,v,h,C,g,I,r,M,T,a,k,u,l,U,E,c,H,o){const O=(t,b,Z,P,v,h,C,Y,g,I,r)=>{const M=Z.getTangents(),T=Z.getNormals(),a=Z.getBinormals(),k=Z.getDistances();if(r)for(let S=0;S<M.length;S++)if(0==M[S].x&&0==M[S].y&&0==M[S].z&&M[S].S(M[S-1]),0==T[S].x&&0==T[S].y&&0==T[S].z&&T[S].S(T[S-1]),0==a[S].x&&0==a[S].y&&0==a[S].z&&a[S].S(a[S-1]),S>0){let t=M[S-1];J.JZ.Dot(t,M[S])<0&&M[S].scaleInPlace(-1),t=T[S-1],J.JZ.Dot(t,T[S])<0&&T[S].scaleInPlace(-1),t=a[S-1],J.JZ.Dot(t,a[S])<0&&a[S].scaleInPlace(-1)}let u=0;const l=I&&Y?Y:()=>null!==h?h:0,U=I&&C?C:()=>null!==v?v:1;let E=g===S.b.NO_CAP||g===S.b.CAP_END?0:2;const c=J.TmpVectors.Matrix[0];for(let S=0;S<b.length;S++){const Z=[],v=l(S,k[S]),h=U(S,k[S]);J.Matrix.RotationAxisToRef(M[S],u,c);for(let P=0;P<t.length;P++){const v=M[S].scale(t[P].z).add(T[S].scale(t[P].x)).add(a[S].scale(t[P].y)),C=J.JZ.Zero();J.JZ.TransformCoordinatesToRef(v,c,C),C.scaleInPlace(h).addInPlace(b[S]),Z[P]=C}P[E]=Z,u+=v,E++}const H=o||(t=>{const b=Array(),Z=J.JZ.Zero();let S;for(S=0;S<t.length;S++)Z.addInPlace(t[S]);for(Z.scaleInPlace(1/t.length),S=0;S<t.length;S++)b.push(Z);return b});switch(g){case S.b.NO_CAP:break;case S.b.CAP_START:P[0]=H(P[2]),P[1]=P[2];break;case S.b.CAP_END:P[E]=P[E-1],P[E+1]=H(P[E-1]);break;case S.b.CAP_ALL:P[0]=H(P[2]),P[1]=P[2],P[E]=P[E-1],P[E+1]=H(P[E-1])}return P};let p,e;if(u){const t=u._creationDataStorage;return p=c?t.path3D.update(Z,c):t.path3D.update(Z),e=O(b,Z,t.path3D,t.pathArray,P,v,h,C,t.cap,M,H),u=Y("",{pathArray:e,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:u},T||void 0)}p=c?new j.h(Z,c):new j.h(Z);e=O(b,Z,p,new Array,P,v,h,C,r=r<0||r>3?0:r,M,H);const W=Y(t,{pathArray:e,closeArray:g,closePath:I,updatable:a,sideOrientation:k,invertUV:l,frontUVs:U||void 0,backUVs:E||void 0},T);return W._creationDataStorage.pathArray=e,W._creationDataStorage.path3D=p,W._creationDataStorage.cap=r,W}function d(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,v=void 0===b.closed||b.closed,h=b.shape,C=b.radius||1,g=b.tessellation||64,I=b.clip||0,r=b.updatable,M=S.b._GetDefaultSideOrientation(b.sideOrientation),T=b.cap||S.b.NO_CAP,a=2*Math.PI,k=[],u=b.invertUV||!1;let l=0,U=0;const E=a/g*P;let c,H;for(l=0;l<=g-I;l++){for(H=[],T!=S.b.CAP_START&&T!=S.b.CAP_ALL||(H.push(new J.JZ(0,h[0].y,0)),H.push(new J.JZ(Math.cos(l*E)*h[0].x*C,h[0].y,Math.sin(l*E)*h[0].x*C))),U=0;U<h.length;U++)c=new J.JZ(Math.cos(l*E)*h[U].x*C,h[U].y,Math.sin(l*E)*h[U].x*C),H.push(c);T!=S.b.CAP_END&&T!=S.b.CAP_ALL||(H.push(new J.JZ(Math.cos(l*E)*h[h.length-1].x*C,h[h.length-1].y,Math.sin(l*E)*h[h.length-1].x*C)),H.push(new J.JZ(0,h[h.length-1].y,0))),k.push(H)}return Y(t,{pathArray:k,closeArray:v,sideOrientation:M,updatable:r,invertUV:u,frontUVs:b.frontUVs,backUVs:b.backUVs},Z)}S.b.ExtrudeShape=function(t,b,Z,J,P,v){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;return V(t,{shape:b,path:Z,scale:J,rotation:P,cap:0===v?0:v||S.b.NO_CAP,sideOrientation:Y,instance:g,updatable:C},h)},S.b.ExtrudeShapeCustom=(t,b,Z,J,P,v,h,C,Y,g,I,r)=>n(t,{shape:b,path:Z,scaleFunction:J,rotationFunction:P,ribbonCloseArray:v,ribbonClosePath:h,cap:0===C?0:C||S.b.NO_CAP,sideOrientation:I,instance:r,updatable:g},Y);S.b.CreateLathe=(t,b,Z,J,S,P,v)=>d(t,{shape:b,radius:Z,tessellation:J,sideOrientation:v,updatable:P},S);var s=Z(13965),q=Z(13913);function Q(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=b.path;let v=b.instance,h=1;void 0!==b.radius?h=b.radius:v&&(h=v._creationDataStorage.radius);const C=b.tessellation||64,g=b.radiusFunction||null;let I=b.cap||S.b.NO_CAP;const r=b.invertUV||!1,M=b.updatable,T=S.b._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const a=(t,b,Z,P,v,h,C,Y)=>{const g=b.getTangents(),I=b.getNormals(),r=b.getDistances(),M=2*Math.PI/v*Y,T=h||(()=>P);let a,k,u,l;const U=J.TmpVectors.Matrix[0];let E=C===S.b.NO_CAP||C===S.b.CAP_END?0:2;for(let S=0;S<t.length;S++){k=T(S,r[S]),a=Array(),u=I[S];for(let b=0;b<v;b++)J.Matrix.RotationAxisToRef(g[S],M*b,U),l=a[b]?a[b]:J.JZ.Zero(),J.JZ.TransformCoordinatesToRef(u,U,l),l.scaleInPlace(k).addInPlace(t[S]),a[b]=l;Z[E]=a,E++}const c=(b,Z)=>{const J=Array();for(let S=0;S<b;S++)J.push(t[Z]);return J};switch(C){case S.b.NO_CAP:break;case S.b.CAP_START:Z[0]=c(v,0),Z[1]=Z[2].slice(0);break;case S.b.CAP_END:Z[E]=Z[E-1].slice(0),Z[E+1]=c(v,t.length-1);break;case S.b.CAP_ALL:Z[0]=c(v,0),Z[1]=Z[2].slice(0),Z[E]=Z[E-1].slice(0),Z[E+1]=c(v,t.length-1)}return Z};let k,u;if(v){const t=v._creationDataStorage,Z=b.arc||t.arc;return k=t.path3D.update(P),u=a(P,k,t.pathArray,h,t.tessellation,g,t.cap,Z),v=Y("",{pathArray:u,instance:v}),t.path3D=k,t.pathArray=u,t.arc=Z,t.radius=h,v}k=new j.h(P);I=I<0||I>3?0:I,u=a(P,k,new Array,h,C,g,I,b.arc);const l=Y(t,{pathArray:u,closePath:!0,closeArray:!1,updatable:M,sideOrientation:T,invertUV:r,frontUVs:b.frontUVs,backUVs:b.backUVs},Z);return l._creationDataStorage.pathArray=u,l._creationDataStorage.path3D=k,l._creationDataStorage.tessellation=C,l._creationDataStorage.cap=I,l._creationDataStorage.arc=b.arc,l._creationDataStorage.radius=h,l}function N(t){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Z=t.type&&(t.type<0||t.type>=b.length)?0:t.type||0,S=t.size,P=t.sizeX||S||1,C=t.sizeY||S||1,Y=t.sizeZ||S||1,g=t.custom||b[Z],I=g.face.length,M=t.faceUV||new Array(I),T=t.faceColors,a=void 0===t.flat||t.flat,k=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,u=[],l=[],U=[],E=[],c=[];let H=0,o=0;const O=[];let p,e,W,j,V,n,y=0,d=0;if(a)for(d=0;d<I;d++)T&&void 0===T[d]&&(T[d]=new r.Fb(1,1,1,1)),M&&void 0===M[d]&&(M[d]=new J.Vector4(0,0,1,1));if(a)for(d=0;d<I;d++){const t=g.face[d].length;for(W=2*Math.PI/t,j=.5*Math.tan(W/2),V=.5,y=0;y<t;y++)u.push(g.vertex[g.face[d][y]][0]*P,g.vertex[g.face[d][y]][1]*C,g.vertex[g.face[d][y]][2]*Y),O.push(H),H++,p=M[d].x+(M[d].z-M[d].x)*(.5+j),e=M[d].y+(M[d].w-M[d].y)*(V-.5),E.push(p,h.e?1-e:e),n=j*Math.cos(W)-V*Math.sin(W),V=j*Math.sin(W)+V*Math.cos(W),j=n,T&&c.push(T[d].r,T[d].g,T[d].b,T[d].a);for(y=0;y<t-2;y++)l.push(O[0+o],O[y+2+o],O[y+1+o]);o+=t}else{for(y=0;y<g.vertex.length;y++)u.push(g.vertex[y][0]*P,g.vertex[y][1]*C,g.vertex[y][2]*Y),E.push(0,h.e?1:0);for(d=0;d<I;d++)for(y=0;y<g.face[d].length-2;y++)l.push(g.face[d][0],g.face[d][y+2],g.face[d][y+1])}v.c.ComputeNormals(u,l,U),v.c._ComputeSides(k,u,l,U,E,t.frontUVs,t.backUVs);const s=new v.c;return s.jt=u,s.indices=l,s.Vt=U,s.yt=E,T&&a&&(s.nt=c),s}function A(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return N(b).st(J,b.updatable),J}S.b.CreateTube=(t,b,Z,J,S,P,v,h,C,Y)=>Q(t,{path:b,radius:Z,tessellation:J,radiusFunction:S,arc:1,cap:P,updatable:h,sideOrientation:C,instance:Y},v);function K(t){const b=t.sideOrientation||v.c.DEFAULTSIDE,Z=t.radius||1,S=void 0===t.flat||t.flat,P=0|(t.subdivisions||4),C=t.radiusX||Z,Y=t.radiusY||Z,g=t.radiusZ||Z,I=(1+Math.sqrt(5))/2,r=[-1,I,-0,1,I,0,-1,-I,0,1,-I,0,0,-1,-I,0,1,-I,0,-1,I,0,1,I,I,0,1,I,0,-1,-I,0,1,-I,0,-1],M=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],T=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],a=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],u=[],l=[],U=[],E=[];let c=0;const H=new Array(3),o=new Array(3);let O;for(O=0;O<3;O++)H[O]=J.JZ.Zero(),o[O]=J.Vector2.Zero();for(let v=0;v<20;v++){for(O=0;O<3;O++){const t=M[3*v+O];H[O].Ab(r[3*T[t]],r[3*T[t]+1],r[3*T[t]+2]),H[O].normalize(),o[O].Ab(.134765625*a[2*t]+.05859375+-.0390625*k[v],.2333984375*a[2*t+1]+.025390625+.01953125*k[v])}const t=(t,b,Z,v)=>{const I=J.JZ.Lerp(H[0],H[2],b/P),r=J.JZ.Lerp(H[1],H[2],b/P),M=P===b?H[2]:J.JZ.Lerp(I,r,t/(P-b));let T;if(M.normalize(),S){const t=J.JZ.Lerp(H[0],H[2],v/P),b=J.JZ.Lerp(H[1],H[2],v/P);T=J.JZ.Lerp(t,b,Z/(P-v))}else T=new J.JZ(M.x,M.y,M.z);T.x/=C,T.y/=Y,T.z/=g,T.normalize();const a=J.Vector2.Lerp(o[0],o[2],b/P),k=J.Vector2.Lerp(o[1],o[2],b/P),O=P===b?o[2]:J.Vector2.Lerp(a,k,t/(P-b));l.push(M.x*C,M.y*Y,M.z*g),U.push(T.x,T.y,T.z),E.push(O.x,h.e?1-O.y:O.y),u.push(c),c++};for(let b=0;b<P;b++)for(let Z=0;Z+b<P;Z++)t(Z,b,Z+1/3,b+1/3),t(Z+1,b,Z+1/3,b+1/3),t(Z,b+1,Z+1/3,b+1/3),Z+b+1<P&&(t(Z+1,b,Z+2/3,b+2/3),t(Z+1,b+1,Z+2/3,b+2/3),t(Z,b+1,Z+2/3,b+2/3))}v.c._ComputeSides(b,l,u,U,E,t.frontUVs,t.backUVs);const p=new v.c;return p.indices=u,p.jt=l,p.Vt=U,p.yt=E,p}function L(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const J=new S.b(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),J._originalBuilderSideOrientation=b.sideOrientation;return K(b).st(J,b.updatable),J}v.c.CreatePolyhedron=N,S.b.CreatePolyhedron=(t,b,Z)=>A(t,b,Z);v.c.CreateIcoSphere=K,S.b.CreateIcoSphere=(t,b,Z)=>L(t,b,Z);var F=Z(12745);const B=new J.JZ(1,0,0),X=new J.JZ(-1,0,0),x=new J.JZ(0,1,0),i=new J.JZ(0,-1,0),z=new J.JZ(0,0,1),D=new J.JZ(0,0,-1);class f{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.JZ.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.JZ.Up(),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.Vector2.Zero(),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=t,this.normal=b,this.uv=Z,this.vertexIdx=S,this.vertexIdxForBones=P,this.localPositionOverride=v,this.localNormalOverride=h,this.matrixIndicesOverride=C,this.matrixWeightsOverride=Y}clone(){var t,b,Z,J;return new f(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(t=this.localPositionOverride)||void 0===t?void 0:t.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(Z=this.matrixIndicesOverride)||void 0===Z?void 0:Z.slice(),null===(J=this.matrixWeightsOverride)||void 0===J?void 0:J.slice())}}function mt(t,b,Z){var C,Y,g,I,r;const M=!!b.skeleton,T=!(null===(C=b.morphTargetManager)||void 0===C||!C.numTargets),a=Z.localMode||M,k=b.Qb(),u=M||T?b.YC(!0,!0):b.getVerticesData(P.g.PositionKind),l=M||T?b.getNormalsData(!0,!0):b.getVerticesData(P.g.NormalKind),U=a?M?b.getVerticesData(P.g.PositionKind):u:null,E=a?M?b.getVerticesData(P.g.NormalKind):l:null,c=b.getVerticesData(P.g.UVKind),H=M?b.getVerticesData(P.g.MatricesIndicesKind):null,o=M?b.getVerticesData(P.g.MatricesWeightsKind):null,O=M?b.getVerticesData(P.g.MatricesIndicesExtraKind):null,p=M?b.getVerticesData(P.g.MatricesWeightsExtraKind):null,e=Z.position||J.JZ.Zero();let W=Z.normal||J.JZ.Up();const j=Z.size||J.JZ.One(),V=Z.angle||0;if(!W){const t=new J.JZ(0,0,1),Z=b.et().activeCamera,S=J.JZ.TransformCoordinates(t,Z.getWorldMatrix());W=Z.globalPosition.SZ(S)}const n=-Math.atan2(W.z,W.x)-Math.PI/2,y=Math.sqrt(W.x*W.x+W.z*W.z),d=Math.atan2(W.y,y),s=new v.c;s.indices=[],s.jt=[],s.Vt=[],s.yt=[],s.matricesIndices=M?[]:null,s.matricesWeights=M?[]:null,s.matricesIndicesExtra=O?[]:null,s.matricesWeightsExtra=p?[]:null;let q=0;const Q=(t,b)=>{const S=new f;if(!k||!u||!l)return S;const P=k[t];if(S.vertexIdx=3*P,S.vertexIdxForBones=4*P,S.position=new J.JZ(u[3*P],u[3*P+1],u[3*P+2]),J.JZ.TransformCoordinatesToRef(S.position,b,S.position),S.normal=new J.JZ(l[3*P],l[3*P+1],l[3*P+2]),J.JZ.TransformNormalToRef(S.normal,b,S.normal),Z.captureUVS&&c){const t=c[2*P+1];S.uv=new J.Vector2(c[2*P],h.e?1-t:t)}return S},N=[0,0,0,0],A=(t,b)=>{if(0===t.length)return t;const Z=.5*Math.abs(J.JZ.Dot(j,b)),S=(t,b,Z,J)=>{for(let S=0;S<J;++S)if(t[Z+S]===b)return Z+S;return-1},P=(t,P)=>{const v=J.JZ.GetClipFactor(t.position,P.position,b,Z);let h=N,C=N;if(H&&o){const b=t.matrixIndicesOverride?0:t.vertexIdxForBones,Z=t.matrixIndicesOverride??H,J=t.matrixWeightsOverride??o,Y=P.matrixIndicesOverride?0:P.vertexIdxForBones,g=P.matrixIndicesOverride??H,I=P.matrixWeightsOverride??o;h=[0,0,0,0],C=[0,0,0,0];let r=0;for(let t=0;t<4;++t)if(J[b+t]>0){const P=S(g,Z[b+t],Y,4);h[r]=Z[b+t],C[r]=(0,F.Lerp)(J[b+t],P>=0?I[P]:0,v),r++}for(let t=0;t<4&&r<4;++t){const J=g[Y+t];-1===S(Z,J,b,4)&&(h[r]=J,C[r]=(0,F.Lerp)(0,I[Y+t],v),r++)}const M=C[0]+C[1]+C[2]+C[3];C[0]/=M,C[1]/=M,C[2]/=M,C[3]/=M}const Y=t.localPositionOverride?t.localPositionOverride[0]:(null===U||void 0===U?void 0:U[t.vertexIdx])??0,g=t.localPositionOverride?t.localPositionOverride[1]:(null===U||void 0===U?void 0:U[t.vertexIdx+1])??0,I=t.localPositionOverride?t.localPositionOverride[2]:(null===U||void 0===U?void 0:U[t.vertexIdx+2])??0,r=P.localPositionOverride?P.localPositionOverride[0]:(null===U||void 0===U?void 0:U[P.vertexIdx])??0,M=P.localPositionOverride?P.localPositionOverride[1]:(null===U||void 0===U?void 0:U[P.vertexIdx+1])??0,T=P.localPositionOverride?P.localPositionOverride[2]:(null===U||void 0===U?void 0:U[P.vertexIdx+2])??0,a=t.localNormalOverride?t.localNormalOverride[0]:(null===E||void 0===E?void 0:E[t.vertexIdx])??0,k=t.localNormalOverride?t.localNormalOverride[1]:(null===E||void 0===E?void 0:E[t.vertexIdx+1])??0,u=t.localNormalOverride?t.localNormalOverride[2]:(null===E||void 0===E?void 0:E[t.vertexIdx+2])??0,l=a+((P.localNormalOverride?P.localNormalOverride[0]:(null===E||void 0===E?void 0:E[P.vertexIdx])??0)-a)*v,c=k+((P.localNormalOverride?P.localNormalOverride[1]:(null===E||void 0===E?void 0:E[P.vertexIdx+1])??0)-k)*v,O=u+((P.localNormalOverride?P.localNormalOverride[2]:(null===E||void 0===E?void 0:E[P.vertexIdx+2])??0)-u)*v,p=Math.sqrt(l*l+c*c+O*O);return new f(J.JZ.Lerp(t.position,P.position,v),J.JZ.Lerp(t.normal,P.normal,v).normalize(),J.Vector2.Lerp(t.uv,P.uv,v),-1,-1,U?[Y+(r-Y)*v,g+(M-g)*v,I+(T-I)*v]:null,E?[l/p,c/p,O/p]:null,h,C)};let v=null;t.length>3&&(v=[]);for(let h=0;h<t.length;h+=3){let S=0,C=null,Y=null,g=null,I=null;const r=J.JZ.Dot(t[h].position,b)-Z>0,M=J.JZ.Dot(t[h+1].position,b)-Z>0,T=J.JZ.Dot(t[h+2].position,b)-Z>0;switch(S=(r?1:0)+(M?1:0)+(T?1:0),S){case 0:t.length>3?(v.push(t[h]),v.push(t[h+1]),v.push(t[h+2])):v=t;break;case 1:if(v=v??new Array,r&&(C=t[h+1],Y=t[h+2],g=P(t[h],C),I=P(t[h],Y)),M){C=t[h],Y=t[h+2],g=P(t[h+1],C),I=P(t[h+1],Y),v.push(g),v.push(Y.clone()),v.push(C.clone()),v.push(Y.clone()),v.push(g.clone()),v.push(I);break}T&&(C=t[h],Y=t[h+1],g=P(t[h+2],C),I=P(t[h+2],Y)),C&&Y&&g&&I&&(v.push(C.clone()),v.push(Y.clone()),v.push(g),v.push(I),v.push(g.clone()),v.push(Y.clone()));break;case 2:v=v??new Array,r||(C=t[h].clone(),Y=P(C,t[h+1]),g=P(C,t[h+2]),v.push(C),v.push(Y),v.push(g)),M||(C=t[h+1].clone(),Y=P(C,t[h+2]),g=P(C,t[h]),v.push(C),v.push(Y),v.push(g)),T||(C=t[h+2].clone(),Y=P(C,t[h]),g=P(C,t[h+1]),v.push(C),v.push(Y),v.push(g))}}return v},K=b instanceof S.b?b:null,L=null===K||void 0===K?void 0:K._thinInstanceDataStorage.matrixData,mt=(null===K||void 0===K?void 0:K.Xb)||1,R=J.TmpVectors.Matrix[0];R.S(J.Matrix.IdentityReadOnly);for(let S=0;S<mt;++S){if(null!==K&&void 0!==K&&K.hasThinInstances&&L){const t=16*S;R.setRowFromFloats(0,L[t+0],L[t+1],L[t+2],L[t+3]),R.setRowFromFloats(1,L[t+4],L[t+5],L[t+6],L[t+7]),R.setRowFromFloats(2,L[t+8],L[t+9],L[t+10],L[t+11]),R.setRowFromFloats(3,L[t+12],L[t+13],L[t+14],L[t+15])}const t=J.Matrix.RotationYawPitchRoll(n,d,V).multiply(J.Matrix.Translation(e.x,e.y,e.z)),P=J.Matrix.Invert(t),v=b.getWorldMatrix(),C=R.multiply(v).multiply(P),Y=new Array(3);for(let b=0;b<k.length;b+=3){let t=Y;if(t[0]=Q(b,C),t[1]=Q(b+1,C),t[2]=Q(b+2,C),!(Z.cullBackFaces&&-t[0].normal.z<=0&&-t[1].normal.z<=0&&-t[2].normal.z<=0)&&(t=A(t,B),t&&(t=A(t,X),t&&(t=A(t,x),t&&(t=A(t,i),t&&(t=A(t,z),t&&(t=A(t,D),t)))))))for(let b=0;b<t.length;b++){const J=t[b];if(s.indices.push(q),a?(J.localPositionOverride?(s.jt[3*q]=J.localPositionOverride[0],s.jt[3*q+1]=J.localPositionOverride[1],s.jt[3*q+2]=J.localPositionOverride[2]):U&&(s.jt[3*q]=U[J.vertexIdx],s.jt[3*q+1]=U[J.vertexIdx+1],s.jt[3*q+2]=U[J.vertexIdx+2]),J.localNormalOverride?(s.Vt[3*q]=J.localNormalOverride[0],s.Vt[3*q+1]=J.localNormalOverride[1],s.Vt[3*q+2]=J.localNormalOverride[2]):E&&(s.Vt[3*q]=E[J.vertexIdx],s.Vt[3*q+1]=E[J.vertexIdx+1],s.Vt[3*q+2]=E[J.vertexIdx+2])):(J.position.toArray(s.jt,3*q),J.normal.toArray(s.Vt,3*q)),s.matricesIndices&&s.matricesWeights&&(J.matrixIndicesOverride?(s.matricesIndices[4*q]=J.matrixIndicesOverride[0],s.matricesIndices[4*q+1]=J.matrixIndicesOverride[1],s.matricesIndices[4*q+2]=J.matrixIndicesOverride[2],s.matricesIndices[4*q+3]=J.matrixIndicesOverride[3]):(H&&(s.matricesIndices[4*q]=H[J.vertexIdxForBones],s.matricesIndices[4*q+1]=H[J.vertexIdxForBones+1],s.matricesIndices[4*q+2]=H[J.vertexIdxForBones+2],s.matricesIndices[4*q+3]=H[J.vertexIdxForBones+3]),O&&s.matricesIndicesExtra&&(s.matricesIndicesExtra[4*q]=O[J.vertexIdxForBones],s.matricesIndicesExtra[4*q+1]=O[J.vertexIdxForBones+1],s.matricesIndicesExtra[4*q+2]=O[J.vertexIdxForBones+2],s.matricesIndicesExtra[4*q+3]=O[J.vertexIdxForBones+3])),J.matrixWeightsOverride?(s.matricesWeights[4*q]=J.matrixWeightsOverride[0],s.matricesWeights[4*q+1]=J.matrixWeightsOverride[1],s.matricesWeights[4*q+2]=J.matrixWeightsOverride[2],s.matricesWeights[4*q+3]=J.matrixWeightsOverride[3]):(o&&(s.matricesWeights[4*q]=o[J.vertexIdxForBones],s.matricesWeights[4*q+1]=o[J.vertexIdxForBones+1],s.matricesWeights[4*q+2]=o[J.vertexIdxForBones+2],s.matricesWeights[4*q+3]=o[J.vertexIdxForBones+3]),p&&s.matricesWeightsExtra&&(s.matricesWeightsExtra[4*q]=p[J.vertexIdxForBones],s.matricesWeightsExtra[4*q+1]=p[J.vertexIdxForBones+1],s.matricesWeightsExtra[4*q+2]=p[J.vertexIdxForBones+2],s.matricesWeightsExtra[4*q+3]=p[J.vertexIdxForBones+3]))),Z.captureUVS)J.uv.toArray(s.yt,2*q);else{s.yt.push(.5+J.position.x/j.x);const t=.5+J.position.y/j.y;s.yt.push(h.e?1-t:t)}q++}}}0===s.indices.length&&(s.indices=null),0===s.jt.length&&(s.jt=null),0===s.Vt.length&&(s.Vt=null),0===s.yt.length&&(s.yt=null),0===(null===(Y=s.matricesIndices)||void 0===Y?void 0:Y.length)&&(s.matricesIndices=null),0===(null===(g=s.matricesWeights)||void 0===g?void 0:g.length)&&(s.matricesWeights=null),0===(null===(I=s.matricesIndicesExtra)||void 0===I?void 0:I.length)&&(s.matricesIndicesExtra=null),0===(null===(r=s.matricesWeightsExtra)||void 0===r?void 0:r.length)&&(s.matricesWeightsExtra=null);const w=new S.b(t,b.et());return s.st(w),a?(w.skeleton=b.skeleton,w.parent=b):(w.position=e.clone(),w.rotation=new J.JZ(d,n,V)),w.sb(!0),w.refreshBoundingInfo(!0,!0),w}function R(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(t.subdivisions?t.subdivisions:2,1),Z=0|Math.max(t.tessellation?t.tessellation:16,3),S=Math.max(t.height?t.height:1,0),P=Math.max(t.radius?t.radius:.25,0),C=0|Math.max(t.capSubdivisions?t.capSubdivisions:6,1),Y=Z,g=b,I=Math.max(t.radiusTop?t.radiusTop:P,0),r=Math.max(t.radiusBottom?t.radiusBottom:P,0),M=S-(I+r),T=2*Math.PI,a=Math.max(t.topCapSubdivisions?t.topCapSubdivisions:C,1),k=Math.max(t.bottomCapSubdivisions?t.bottomCapSubdivisions:C,1),u=Math.acos((r-I)/S);let l=[];const U=[],E=[],c=[];let H=0;const o=[],O=.5*M,p=.5*Math.PI;let e,W;const j=J.JZ.Zero(),V=J.JZ.Zero(),n=Math.cos(u),y=Math.sin(u),d=new J.Vector2(I*y,O+I*n).SZ(new J.Vector2(r*y,r*n-O)).length(),s=I*u+d+r*(p-u);let q=0;for(W=0;W<=a;W++){const t=[],b=p-u*(W/a);q+=I*u/a;const Z=Math.cos(b),J=Math.sin(b),S=Z*I;for(e=0;e<=Y;e++){const b=e/Y,P=b*T+0,v=Math.sin(P),C=Math.cos(P);V.x=S*v,V.y=O+J*I,V.z=S*C,U.push(V.x,V.y,V.z),j.set(Z*v,J,Z*C),E.push(j.x,j.y,j.z),c.push(b,h.e?q/s:1-q/s),t.push(H),H++}o.push(t)}const Q=S-I-r+n*I-n*r,N=y*(r-I)/Q;for(W=1;W<=g;W++){const t=[];q+=d/g;const b=y*(W*(r-I)/g+I);for(e=0;e<=Y;e++){const Z=e/Y,J=Z*T+0,S=Math.sin(J),P=Math.cos(J);V.x=b*S,V.y=O+n*I-W*Q/g,V.z=b*P,U.push(V.x,V.y,V.z),j.set(S,N,P).normalize(),E.push(j.x,j.y,j.z),c.push(Z,h.e?q/s:1-q/s),t.push(H),H++}o.push(t)}for(W=1;W<=k;W++){const t=[],b=p-u-(Math.PI-u)*(W/k);q+=r*u/k;const Z=Math.cos(b),J=Math.sin(b),S=Z*r;for(e=0;e<=Y;e++){const b=e/Y,P=b*T+0,v=Math.sin(P),C=Math.cos(P);V.x=S*v,V.y=J*r-O,V.z=S*C,U.push(V.x,V.y,V.z),j.set(Z*v,J,Z*C),E.push(j.x,j.y,j.z),c.push(b,h.e?q/s:1-q/s),t.push(H),H++}o.push(t)}for(e=0;e<Y;e++)for(W=0;W<a+g+k;W++){const t=o[W][e],b=o[W+1][e],Z=o[W+1][e+1],J=o[W][e+1];l.push(t),l.push(b),l.push(J),l.push(b),l.push(Z),l.push(J)}if(l=l.reverse(),t.orientation&&!t.orientation.equals(J.JZ.Up())){const b=new J.Matrix;t.orientation.clone().scale(.5*Math.PI).cross(J.JZ.Up()).toQuaternion().toRotationMatrix(b);const Z=J.JZ.Zero();for(let t=0;t<U.length;t+=3)Z.set(U[t],U[t+1],U[t+2]),J.JZ.TransformCoordinatesToRef(Z.clone(),b,Z),U[t]=Z.x,U[t+1]=Z.y,U[t+2]=Z.z}const A=new v.c;return A.jt=U,A.Vt=E,A.yt=c,A.indices=l,A}function w(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:J.JZ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=new S.b(t,Z);return R(b).st(P,b.updatable),P}S.b.CreateDecal=(t,b,Z,J,S,P)=>mt(t,b,{position:Z,normal:J,size:S,angle:P});S.b.CreateCapsule=(t,b,Z)=>w(t,b,Z),v.c.CreateCapsule=R;var G=Z(12557),tt=Z(12737);class bt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=b,t!==Math.floor(t)&&(t=Math.floor(t),G.c.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),G.c.Warn("y is not an integer, floor(y) used"))}clone(){return new bt(this.x,this.y)}rotate60About(t){const b=this.x;return this.x=t.x+t.y-this.y,this.y=b+this.y-t.x,this}rotateNeg60About(t){const b=this.x;return this.x=b+this.y-t.y,this.y=t.x+t.y-b,this}rotate120(t,b){t!==Math.floor(t)&&(t=Math.floor(t),G.c.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),G.c.Warn("n not an integer only floor(n) used"));const Z=this.x;return this.x=t-Z-this.y,this.y=b+Z,this}rotateNeg120(t,b){t!==Math.floor(t)&&(t=Math.floor(t),G.c.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),G.c.Warn("n is not an integer,   floor(n) used"));const Z=this.x;return this.x=this.y-b,this.y=t+b-Z-this.y,this}toCartesianOrigin(t,b){const Z=J.JZ.Zero();return Z.x=t.x+2*this.x*b+this.y*b,Z.y=t.y+Math.sqrt(3)*this.y*b,Z}static Zero(){return new bt(0,0)}}class Zt{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Jt("icosahedron","Regular",[[0,tt.i,-1],[-tt.i,1,0],[-1,0,-tt.i],[1,0,-tt.i],[tt.i,1,0],[0,tt.i,1],[-1,0,tt.i],[-tt.i,-1,0],[0,-tt.i,-1],[tt.i,-1,0],[1,0,tt.i],[0,-tt.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let t=12;const b={},Z=this.m,J=this.n;let S,P,v,h,C,Y=Z,g=1,I=0;0!==J&&(Y=(0,F.HighestCommonFactor)(Z,J)),g=Z/Y,I=J/Y;const r=bt.Zero(),M=new bt(Z,J),T=new bt(-J,Z+J),a=bt.Zero(),k=bt.Zero(),u=bt.Zero();let l,U,E,c,H=[];const o=[],O=this.vertByDist,p=(Z,J,S,P)=>{l=Z+"|"+S,U=J+"|"+P,l in b||U in b?l in b&&!(U in b)?b[U]=b[l]:U in b&&!(l in b)&&(b[l]=b[U]):(b[l]=t,b[U]=t,t++),O[S][0]>2?o[b[l]]=[-O[S][0],O[S][1],b[l]]:o[b[l]]=[H[O[S][0]],O[S][1],b[l]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let e=0;e<20;e++){if(H=this.IDATA.face[e],v=H[2],h=H[1],C=H[0],E=r.x+"|"+r.y,l=e+"|"+E,l in b||(b[l]=v,o[v]=[H[O[E][0]],O[E][1]]),E=M.x+"|"+M.y,l=e+"|"+E,l in b||(b[l]=h,o[h]=[H[O[E][0]],O[E][1]]),E=T.x+"|"+T.y,l=e+"|"+E,l in b||(b[l]=C,o[C]=[H[O[E][0]],O[E][1]]),S=this.IDATA.edgematch[e][0],P=this.IDATA.edgematch[e][1],"B"===P)for(let t=1;t<Y;t++)k.x=Z-t*(g+I),k.y=J+t*g,u.x=-t*I,u.y=t*(g+I),E=k.x+"|"+k.y,c=u.x+"|"+u.y,p(e,S,E,c);if("O"===P)for(let t=1;t<Y;t++)u.x=-t*I,u.y=t*(g+I),a.x=t*g,a.y=t*I,E=u.x+"|"+u.y,c=a.x+"|"+a.y,p(e,S,E,c);if(S=this.IDATA.edgematch[e][2],P=this.IDATA.edgematch[e][3],P&&"A"===P)for(let t=1;t<Y;t++)a.x=t*g,a.y=t*I,k.x=Z-(Y-t)*(g+I),k.y=J+(Y-t)*g,E=a.x+"|"+a.y,c=k.x+"|"+k.y,p(e,S,E,c);for(let Z=0;Z<this.vertices.length;Z++)E=this.vertices[Z].x+"|"+this.vertices[Z].y,l=e+"|"+E,l in b||(b[l]=t++,O[E][0]>2?o[b[l]]=[-O[E][0],O[E][1],b[l]]:o[b[l]]=[H[O[E][0]],O[E][1],b[l]])}this.closestTo=o,this.vecToidx=b}calcCoeffs(){const t=this.m,b=this.n,Z=Math.sqrt(3)/3,J=t*t+b*b+t*b;this.coau=(t+b)/J,this.cobu=-b/J,this.coav=-Z*(t-b)/J,this.cobv=Z*(2*t+b)/J}createInnerFacets(){const t=this.m,b=this.n;for(let Z=0;Z<b+t+1;Z++)for(let t=this.min[Z];t<this.max[Z]+1;t++)t<this.max[Z]&&t<this.max[Z+1]+1&&this.innerFacets.push(["|"+t+"|"+Z,"|"+t+"|"+(Z+1),"|"+(t+1)+"|"+Z]),Z>0&&t<this.max[Z-1]&&t+1<this.max[Z]+1&&this.innerFacets.push(["|"+t+"|"+Z,"|"+(t+1)+"|"+Z,"|"+(t+1)+"|"+(Z-1)])}edgeVecsABOB(){const t=this.m,b=this.n,Z=new bt(-b,t+b);for(let J=1;J<t+b;J++){const t=new bt(this.min[J],J),b=new bt(this.min[J-1],J-1),S=new bt(this.min[J+1],J+1),P=t.clone(),v=b.clone(),h=S.clone();P.rotate60About(Z),v.rotate60About(Z),h.rotate60About(Z);const C=new bt(this.max[P.y],P.y),Y=new bt(this.max[P.y-1],P.y-1),g=new bt(this.max[P.y-1]-1,P.y-1);P.x===C.x&&P.y===C.y||(P.x!==Y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,Y,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,g,C])):P.y===h.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,b,Y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([t,Y,S])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([t,b,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([t,Y,C])))}}mapABOBtoOBOA(){const t=new bt(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Z=[];for(let J=0;J<3;J++)t.x=this.isoVecsABOB[b][J].x,t.y=this.isoVecsABOB[b][J].y,0===this.vertexTypes[b][J]&&t.rotateNeg120(this.m,this.n),Z.push(t.clone());this.isoVecsOBOA.push(Z)}}mapABOBtoBAOA(){const t=new bt(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Z=[];for(let J=0;J<3;J++)t.x=this.isoVecsABOB[b][J].x,t.y=this.isoVecsABOB[b][J].y,1===this.vertexTypes[b][J]&&t.rotate120(this.m,this.n),Z.push(t.clone());this.isoVecsBAOA.push(Z)}}MapToFace(t,b){const Z=this.IDATA.face[t],S=Z[2],P=Z[1],v=Z[0],h=J.JZ.CZ(this.IDATA.vertex[S]),C=J.JZ.CZ(this.IDATA.vertex[P]),Y=J.JZ.CZ(this.IDATA.vertex[v]),g=C.SZ(h),I=Y.SZ(h),r=g.scale(this.coau).add(I.scale(this.cobu)),M=g.scale(this.coav).add(I.scale(this.cobv)),T=[];let a,k=J.TmpVectors.JZ[0];for(let J=0;J<this.cartesian.length;J++)k=r.scale(this.cartesian[J].x).add(M.scale(this.cartesian[J].y)).add(h),T[J]=[k.x,k.y,k.z],a=t+"|"+this.vertices[J].x+"|"+this.vertices[J].y,b.vertex[this.vecToidx[a]]=[k.x,k.y,k.z]}build(t,b){const Z=[],J=bt.Zero(),S=new bt(t,b),P=new bt(-b,t+b);Z.push(J,S,P);for(let E=b;E<t+1;E++)for(let b=0;b<t+1-E;b++)Z.push(new bt(b,E));if(b>0){const J=(0,F.HighestCommonFactor)(t,b),S=t/J,P=b/J;for(let h=1;h<J;h++)Z.push(new bt(h*S,h*P)),Z.push(new bt(-h*P,h*(S+P))),Z.push(new bt(t-h*(S+P),b+h*S));const v=t/b;for(let h=1;h<b;h++)for(let J=0;J<h*v;J++)Z.push(new bt(J,h)),Z.push(new bt(J,h).rotate120(t,b)),Z.push(new bt(J,h).rotateNeg120(t,b))}Z.sort(((t,b)=>t.x-b.x)),Z.sort(((t,b)=>t.y-b.y));const v=new Array(t+b+1),h=new Array(t+b+1);for(let E=0;E<v.length;E++)v[E]=1/0,h[E]=-1/0;let C=0,Y=0;const g=Z.length;for(let E=0;E<g;E++)Y=Z[E].x,C=Z[E].y,v[C]=Math.min(Y,v[C]),h[C]=Math.max(Y,h[C]);const I=(Z,J)=>{const S=Z.clone();return"A"===J&&S.rotateNeg120(t,b),"B"===J&&S.rotate120(t,b),S.x<0?S.y:S.x+S.y},r=[],M=[],T=[],a=[],k={},u=[];let l=-1,U=-1;for(let E=0;E<g;E++)r[E]=Z[E].toCartesianOrigin(new bt(0,0),.5),M[E]=I(Z[E],"O"),T[E]=I(Z[E],"A"),a[E]=I(Z[E],"B"),M[E]===T[E]&&T[E]===a[E]?(l=3,U=M[E]):M[E]===T[E]?(l=4,U=M[E]):T[E]===a[E]?(l=5,U=T[E]):a[E]===M[E]&&(l=6,U=M[E]),M[E]<T[E]&&M[E]<a[E]&&(l=2,U=M[E]),T[E]<M[E]&&T[E]<a[E]&&(l=1,U=T[E]),a[E]<T[E]&&a[E]<M[E]&&(l=0,U=a[E]),u.push([l,U,Z[E].x,Z[E].y]);u.sort(((t,b)=>t[2]-b[2])),u.sort(((t,b)=>t[3]-b[3])),u.sort(((t,b)=>t[1]-b[1])),u.sort(((t,b)=>t[0]-b[0]));for(let E=0;E<u.length;E++)k[u[E][2]+"|"+u[E][3]]=[u[E][0],u[E][1],E];return this.m=t,this.n=b,this.vertices=Z,this.vertByDist=k,this.cartesian=r,this.min=v,this.max=h,this}}class Jt{constructor(t,b,Z,J){this.name=t,this.category=b,this.vertex=Z,this.face=J}}class St extends Jt{innerToData(t,b){for(let Z=0;Z<b.innerFacets.length;Z++)this.face.push(b.innerFacets[Z].map((Z=>b.vecToidx[t+Z])))}mapABOBtoDATA(t,b){const Z=b.IDATA.edgematch[t][0];for(let J=0;J<b.isoVecsABOB.length;J++){const S=[];for(let P=0;P<3;P++)0===b.vertexTypes[J][P]?S.push(t+"|"+b.isoVecsABOB[J][P].x+"|"+b.isoVecsABOB[J][P].y):S.push(Z+"|"+b.isoVecsABOB[J][P].x+"|"+b.isoVecsABOB[J][P].y);this.face.push([b.vecToidx[S[0]],b.vecToidx[S[1]],b.vecToidx[S[2]]])}}mapOBOAtoDATA(t,b){const Z=b.IDATA.edgematch[t][0];for(let J=0;J<b.isoVecsOBOA.length;J++){const S=[];for(let P=0;P<3;P++)1===b.vertexTypes[J][P]?S.push(t+"|"+b.isoVecsOBOA[J][P].x+"|"+b.isoVecsOBOA[J][P].y):S.push(Z+"|"+b.isoVecsOBOA[J][P].x+"|"+b.isoVecsOBOA[J][P].y);this.face.push([b.vecToidx[S[0]],b.vecToidx[S[1]],b.vecToidx[S[2]]])}}mapBAOAtoDATA(t,b){const Z=b.IDATA.edgematch[t][2];for(let J=0;J<b.isoVecsBAOA.length;J++){const S=[];for(let P=0;P<3;P++)1===b.vertexTypes[J][P]?S.push(t+"|"+b.isoVecsBAOA[J][P].x+"|"+b.isoVecsBAOA[J][P].y):S.push(Z+"|"+b.isoVecsBAOA[J][P].x+"|"+b.isoVecsBAOA[J][P].y);this.face.push([b.vecToidx[S[0]],b.vecToidx[S[1]],b.vecToidx[S[2]]])}}orderData(t){const b=[];for(let P=0;P<13;P++)b[P]=[];const Z=t.closestTo;for(let P=0;P<Z.length;P++)Z[P][0]>-1?Z[P][1]>0&&b[Z[P][0]].push([P,Z[P][1]]):b[12].push([P,Z[P][0]]);const J=[];for(let P=0;P<12;P++)J[P]=P;let S=12;for(let P=0;P<12;P++){b[P].sort(((t,b)=>t[1]-b[1]));for(let t=0;t<b[P].length;t++)J[b[P][t][0]]=S++}for(let P=0;P<b[12].length;P++)J[b[12][P][0]]=S++;for(let P=0;P<this.vertex.length;P++)this.vertex[P].push(J[P]);this.vertex.sort(((t,b)=>t[3]-b[3]));for(let P=0;P<this.vertex.length;P++)this.vertex[P].pop();for(let P=0;P<this.face.length;P++)for(let t=0;t<this.face[P].length;t++)this.face[P][t]=J[this.face[P][t]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(t,b){const Z=[],J=[];let S=b.pop();J.push(S);let P=this.face[S].indexOf(t);P=(P+2)%3;let v=this.face[S][P];Z.push(v);let h=0;for(;b.length>0;)S=b[h],this.face[S].indexOf(v)>-1?(P=(this.face[S].indexOf(v)+1)%3,v=this.face[S][P],Z.push(v),J.push(S),b.splice(h,1),h=0):h++;return this.adjacentFaces.push(Z),J}toGoldbergPolyhedronData(){const t=new Jt("GeoDual","Goldberg",[],[]);t.name="GD dual";const b=this.vertex.length,Z=new Array(b);for(let C=0;C<b;C++)Z[C]=[];for(let C=0;C<this.face.length;C++)for(let t=0;t<3;t++)Z[this.face[C][t]].push(C);let J=0,S=0,P=0,v=[],h=[];this.adjacentFaces=[];for(let C=0;C<Z.length;C++){t.face[C]=this.setOrder(C,Z[C].concat([]));for(const b of Z[C]){J=0,S=0,P=0,v=this.face[b];for(let t=0;t<3;t++)h=this.vertex[v[t]],J+=h[0],S+=h[1],P+=h[2];t.vertex[b]=[J/3,S/3,P/3]}}return t}static BuildGeodesicData(t){const b=new St("Geodesic-m-n","Geodesic",[[0,tt.i,-1],[-tt.i,1,0],[-1,0,-tt.i],[1,0,-tt.i],[tt.i,1,0],[0,tt.i,1],[-1,0,tt.i],[-tt.i,-1,0],[0,-tt.i,-1],[tt.i,-1,0],[1,0,tt.i],[0,-tt.i,1]],[]);t.setIndices(),t.calcCoeffs(),t.createInnerFacets(),t.edgeVecsABOB(),t.mapABOBtoOBOA(),t.mapABOBtoBAOA();for(let Z=0;Z<t.IDATA.face.length;Z++)t.MapToFace(Z,b),b.innerToData(Z,t),"B"===t.IDATA.edgematch[Z][1]&&b.mapABOBtoDATA(Z,t),"O"===t.IDATA.edgematch[Z][1]&&b.mapOBOAtoDATA(Z,t),"A"===t.IDATA.edgematch[Z][3]&&b.mapBAOAtoDATA(Z,t);b.orderData(t);return b.vertex=b.vertex.map((function(t){const b=t[0],Z=t[1],J=t[2],S=Math.sqrt(b*b+Z*Z+J*J);return t[0]*=1/S,t[1]*=1/S,t[2]*=1/S,t})),b}}S.b._GoldbergMeshParser=(t,b)=>Pt.Parse(t,b);class Pt extends S.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(t,b){return void 0===b?(t>this.goldbergData.nbUnsharedFaces-1&&(G.c.Warn("Maximum number of unshared faces used"),t=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+t):(t>11&&(G.c.Warn("Last pole used"),t=11),b>this.goldbergData.nbFacesAtPole-1&&(G.c.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+t*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(t){for(let Z=0;Z<t.length;Z++){const b=t[Z][0],J=t[Z][1],S=t[Z][2];for(let t=b;t<J+1;t++)this.goldbergData.faceColors[t]=S}const b=[];for(let Z=0;Z<12;Z++)for(let t=0;t<5;t++)b.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);for(let Z=12;Z<this.goldbergData.faceColors.length;Z++)for(let t=0;t<6;t++)b.push(this.goldbergData.faceColors[Z].r,this.goldbergData.faceColors[Z].g,this.goldbergData.faceColors[Z].b,this.goldbergData.faceColors[Z].a);return b}setGoldbergFaceColors(t){const b=this._changeGoldbergFaceColors(t);this.At(P.g.ColorKind,b)}updateGoldbergFaceColors(t){const b=this._changeGoldbergFaceColors(t);this.updateVerticesData(P.g.ColorKind,b)}_changeGoldbergFaceUVs(t){const b=this.getVerticesData(P.g.UVKind);for(let Z=0;Z<t.length;Z++){const J=t[Z][0],S=t[Z][1],P=t[Z][2],v=t[Z][3],h=t[Z][4],C=[],Y=[];let g,I;for(let t=0;t<5;t++)g=P.x+v*Math.cos(h+t*Math.PI/2.5),I=P.y+v*Math.sin(h+t*Math.PI/2.5),g<0&&(g=0),g>1&&(g=1),C.push(g,I);for(let t=0;t<6;t++)g=P.x+v*Math.cos(h+t*Math.PI/3),I=P.y+v*Math.sin(h+t*Math.PI/3),g<0&&(g=0),g>1&&(g=1),Y.push(g,I);for(let t=J;t<Math.min(12,S+1);t++)for(let Z=0;Z<5;Z++)b[10*t+2*Z]=C[2*Z],b[10*t+2*Z+1]=C[2*Z+1];for(let t=Math.max(12,J);t<S+1;t++)for(let Z=0;Z<6;Z++)b[12*t-24+2*Z]=Y[2*Z],b[12*t-23+2*Z]=Y[2*Z+1]}return b}setGoldbergFaceUVs(t){const b=this._changeGoldbergFaceUVs(t);this.At(P.g.UVKind,b)}updateGoldbergFaceUVs(t){const b=this._changeGoldbergFaceUVs(t);this.updateVerticesData(P.g.UVKind,b)}placeOnGoldbergFaceAt(t,b,Z){const S=J.JZ.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);t.rotation=S,t.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(Z.x)).add(this.goldbergData.faceYaxis[b].scale(Z.y)).add(this.goldbergData.faceZaxis[b].scale(Z.z))}serialize(t){super.serialize(t),t.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const t of this.goldbergData.faceColors)b.faceColors.push(t.jb())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const t of this.goldbergData.faceCenters)b.faceCenters.push(t.jb())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const t of this.goldbergData.faceZaxis)b.faceZaxis.push(t.jb())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const t of this.goldbergData.faceYaxis)b.faceYaxis.push(t.jb())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const t of this.goldbergData.faceXaxis)b.faceXaxis.push(t.jb())}t.goldbergData=b}static Parse(t,b){const Z=t.goldbergData;Z.faceColors=Z.faceColors.map((t=>r.Fb.CZ(t))),Z.faceCenters=Z.faceCenters.map((t=>J.JZ.CZ(t))),Z.faceZaxis=Z.faceZaxis.map((t=>J.JZ.CZ(t))),Z.faceXaxis=Z.faceXaxis.map((t=>J.JZ.CZ(t))),Z.faceYaxis=Z.faceYaxis.map((t=>J.JZ.CZ(t)));const S=new Pt(t.name,b);return S.goldbergData=Z,S}}var vt=Z(13287);const ht={CreateBox:I.c,CreateTiledBox:k,CreateSphere:u.d,CreateDisc:g.d,CreateIcoSphere:L,CreateRibbon:Y,CreateCylinder:c,CreateTorus:o,CreateTorusKnot:p,CreateLineSystem:e.h,iY:e.l,CreateDashedLines:e.e,ExtrudeShape:V,ExtrudeShapeCustom:n,CreateLathe:d,CreateTiledPlane:T,fY:s.b,CreateGround:q.e,CreateTiledGround:q.i,CreateGroundFromHeightMap:q.b,CreatePolygon:W.b,ExtrudePolygon:W.e,CreateTube:Q,CreatePolyhedron:A,CreateGeodesic:function(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=b.m||1;J!==Math.floor(J)&&(J=Math.floor(J),G.c.Warn("m not an integer only floor(m) used"));let S=b.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),G.c.Warn("n not an integer only floor(n) used")),S>J){const t=S;S=J,J=t,G.c.Warn("n > m therefore m and n swapped")}const P=new Zt;return P.build(J,S),A(t,{custom:St.BuildGeodesicData(P),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},Z)},CreateGoldberg:function(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const P=b.size,C=b.sizeX||P||1,Y=b.sizeY||P||1,g=b.sizeZ||P||1;let I=b.m||1;I!==Math.floor(I)&&(I=Math.floor(I),G.c.Warn("m not an integer only floor(m) used"));let M=b.n||0;if(M!==Math.floor(M)&&(M=Math.floor(M),G.c.Warn("n not an integer only floor(n) used")),M>I){const t=M;M=I,I=t,G.c.Warn("n > m therefore m and n swapped")}const T=new Zt;T.build(I,M);const a=St.BuildGeodesicData(T),k=a.toGoldbergPolyhedronData(),u=new Pt(t,Z);b.sideOrientation=S.b._GetDefaultSideOrientation(b.sideOrientation),u._originalBuilderSideOrientation=b.sideOrientation;(function(t,b){const Z=t.size,S=t.sizeX||Z||1,P=t.sizeY||Z||1,C=t.sizeZ||Z||1,Y=0===t.sideOrientation?0:t.sideOrientation||v.c.DEFAULTSIDE,g=[],I=[],r=[],M=[];let T=1/0,a=-1/0,k=1/0,u=-1/0;for(let J=0;J<b.vertex.length;J++)T=Math.min(T,b.vertex[J][0]*S),a=Math.max(a,b.vertex[J][0]*S),k=Math.min(k,b.vertex[J][1]*P),u=Math.max(u,b.vertex[J][1]*P);let l=0;for(let v=0;v<b.face.length;v++){const t=b.face[v],Z=J.JZ.CZ(b.vertex[t[0]]),Y=J.JZ.CZ(b.vertex[t[2]]),U=J.JZ.CZ(b.vertex[t[1]]),E=Y.SZ(Z),c=U.SZ(Z),H=J.JZ.Cross(c,E).normalize();for(let J=0;J<t.length;J++){r.push(H.x,H.y,H.z);const Z=b.vertex[t[J]];g.push(Z[0]*S,Z[1]*P,Z[2]*C);const v=(Z[1]*P-k)/(u-k);M.push((Z[0]*S-T)/(a-T),h.e?1-v:v)}for(let b=0;b<t.length-2;b++)I.push(l,l+b+2,l+b+1);l+=t.length}v.c._ComputeSides(Y,g,I,r,M);const U=new v.c;return U.jt=g,U.indices=I,U.Vt=r,U.yt=M,U})(b,k).st(u,b.updatable),u.goldbergData.nbSharedFaces=a.sharedNodes,u.goldbergData.nbUnsharedFaces=a.poleNodes,u.goldbergData.adjacentFaces=a.adjacentFaces,u.goldbergData.nbFaces=u.goldbergData.nbSharedFaces+u.goldbergData.nbUnsharedFaces,u.goldbergData.nbFacesAtPole=(u.goldbergData.nbUnsharedFaces-12)/12;for(let S=0;S<a.vertex.length;S++)u.goldbergData.faceCenters.push(J.JZ.CZ(a.vertex[S])),u.goldbergData.faceCenters[S].x*=C,u.goldbergData.faceCenters[S].y*=Y,u.goldbergData.faceCenters[S].z*=g,u.goldbergData.faceColors.push(new r.Fb(1,1,1,1));for(let S=0;S<k.face.length;S++){const t=k.face[S],b=J.JZ.CZ(k.vertex[t[0]]),Z=J.JZ.CZ(k.vertex[t[2]]),P=J.JZ.CZ(k.vertex[t[1]]),v=Z.SZ(b),h=P.SZ(b),C=J.JZ.Cross(h,v).normalize(),Y=J.JZ.Cross(h,C).normalize();u.goldbergData.faceXaxis.push(h.normalize()),u.goldbergData.faceYaxis.push(C),u.goldbergData.faceZaxis.push(Y)}return u},CreateDecal:mt,CreateCapsule:w,CreateText:vt.e}},13980:(t,b,Z)=>{"use strict";Z.d(b,{b:()=>hb});var J=Z(12735),S=Z(13121);class P extends S.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var v=Z(12775),h=(Z(12907),Z(12688));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this._targetStopDuration!==t&&(this._targetStopDuration=t)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){this._noiseTexture!==t&&(this._noiseTexture=t,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(t){this._isAnimationSheetEnabled!=t&&(this._isAnimationSheetEnabled=t,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(t){this._useLogarithmicDepth=t&&this.et().getEngine().getCaps().fragmentDepthSupported}et(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(t){switch(t){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:t=1;break;case C.BLENDMODE_ONEONE:t=6;break;case C.BLENDMODE_STANDARD:t=2;break;case C.BLENDMODE_MULTIPLY:t=4;break;case C.BLENDMODE_SUBTRACT:t=3}this._engine.setAlphaMode(t)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:J.JZ.Zero()}set direction1(t){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=t)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:J.JZ.Zero()}set direction2(t){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=t)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:J.JZ.Zero()}set minEmitBox(t){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=t)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:J.JZ.Zero()}set maxEmitBox(t){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=t)}get billboardMode(){return this._billboardMode}set billboardMode(t){this._billboardMode!==t&&(this._billboardMode=t,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(t){this._isBillboardBased!==t&&(this._isBillboardBased=t,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(t){this._attachImageProcessingConfiguration(t)}_attachImageProcessingConfiguration(t){t!==this._imageProcessingConfiguration&&(!t&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=t)}_reset(){}_removeGradientAndTexture(t,b,Z){if(!b)return this;let J=0;for(const S of b){if(S.gradient===t){b.splice(J,1);break}J++}return Z&&Z.dispose(),this}constructor(t){this.animations=[],this.renderingGroupId=0,this.hb=J.JZ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new J.JZ(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new J.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.BY=new J.JZ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=J.JZ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new v.Fb(1,1,1,1),this.color2=new v.Fb(1,1,1,1),this.colorDead=new v.Fb(0,0,0,1),this.textureMask=new v.Fb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new P,this.id=t,this.name=t}createPointEmitter(t,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new J.JZ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new J.JZ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new J.JZ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new J.JZ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new J.JZ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new J.JZ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(t,b,Z,J){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,h.f)("BABYLON.BaseParticleSystem",C);var Y=Z(12745),g=Z(12565);class I{constructor(){this.direction1=new J.JZ(0,1,0),this.direction2=new J.JZ(0,1,0),this.minEmitBox=new J.JZ(-.5,-.5,-.5),this.maxEmitBox=new J.JZ(.5,.5,.5)}startDirectionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),v=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),h=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);if(S)return b.x=P,b.y=v,void(b.z=h);J.JZ.TransformNormalFromFloatsToRef(P,v,h,t,b)}startPositionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),v=(0,Y.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),h=(0,Y.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(S)return b.x=P,b.y=v,void(b.z=h);J.JZ.TransformCoordinatesFromFloatsToRef(P,v,h,t,b)}clone(){const t=new I;return g.e.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2),t.setVector3("minEmitBox",this.minEmitBox),t.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3),t.addUniform("minEmitBox",3),t.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.jb(),t.direction2=this.direction2.jb(),t.minEmitBox=this.minEmitBox.jb(),t.maxEmitBox=this.maxEmitBox.jb(),t}parse(t){J.JZ.FromArrayToRef(t.direction1,0,this.direction1),J.JZ.FromArrayToRef(t.direction2,0,this.direction2),J.JZ.FromArrayToRef(t.minEmitBox,0,this.minEmitBox),J.JZ.FromArrayToRef(t.maxEmitBox,0,this.maxEmitBox)}}class r{get radius(){return this._radius}set radius(t){this._radius=t,this._buildHeight()}get angle(){return this._angle}set angle(t){this._angle=t,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Z,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=t}startDirectionFunction(t,b,Z,S){S?J.TmpVectors.JZ[0].S(Z.UC).normalize():Z.position.subtractToRef(t.getTranslation(),J.TmpVectors.JZ[0]).normalize();const P=(0,Y.RandomRange)(0,this.directionRandomizer),v=(0,Y.RandomRange)(0,this.directionRandomizer),h=(0,Y.RandomRange)(0,this.directionRandomizer);b.x=J.TmpVectors.JZ[0].x+P,b.y=J.TmpVectors.JZ[0].y+v,b.z=J.TmpVectors.JZ[0].z+h,b.normalize()}startPositionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(0,2*Math.PI);let v;this.emitFromSpawnPointOnly?v=1e-4:(v=(0,Y.RandomRange)(0,this.heightRange),v=1-v*v);let h=this._radius-(0,Y.RandomRange)(0,this._radius*this.radiusRange);h*=v;const C=h*Math.sin(P),g=h*Math.cos(P),I=v*this._height;if(S)return b.x=C,b.y=I,void(b.z=g);J.JZ.TransformCoordinatesFromFloatsToRef(C,I,g,t,b)}clone(){const t=new r(this._radius,this._angle,this.directionRandomizer);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat2("radius",this._radius,this.radiusRange),t.setFloat("coneAngle",this._angle),t.setFloat2("height",this._height,this.heightRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",2),t.addUniform("coneAngle",1),t.addUniform("height",2),t.addUniform("directionRandomizer",1)}getEffectDefines(){let t="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(t+="\n#define CONEEMITTERSPAWNPOINT"),t}getClassName(){return"ConeParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this._radius,t.angle=this._angle,t.directionRandomizer=this.directionRandomizer,t.radiusRange=this.radiusRange,t.heightRange=this.heightRange,t.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,t}parse(t){this.radius=t.radius,this.angle=t.angle,this.directionRandomizer=t.directionRandomizer,this.radiusRange=void 0!==t.radiusRange?t.radiusRange:1,this.heightRange=void 0!==t.radiusRange?t.heightRange:1,this.emitFromSpawnPointOnly=void 0!==t.emitFromSpawnPointOnly&&t.emitFromSpawnPointOnly}}class M extends r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0);super(t,b),this.direction1=Z,this.direction2=S}startDirectionFunction(t,b){const Z=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),S=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),P=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);J.JZ.TransformNormalFromFloatsToRef(Z,S,P,t,b)}clone(){const t=new M(this.radius,this.angle,this.direction1,this.direction2);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.jb(),t.direction2=this.direction2.jb(),t}parse(t){super.parse(t),this.direction1.S(t.direction1),this.direction2.S(t.direction2)}}class T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=t,this.height=b,this.radiusRange=Z,this.directionRandomizer=S,this._tempVector=J.JZ.Zero()}startDirectionFunction(t,b,Z,S,P){Z.position.subtractToRef(t.getTranslation(),this._tempVector),this._tempVector.normalize(),J.JZ.TransformNormalToRef(this._tempVector,P,this._tempVector);const v=(0,Y.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let h=Math.atan2(this._tempVector.x,this._tempVector.z);h+=(0,Y.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=v,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),S?b.S(this._tempVector):J.JZ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t,b)}startPositionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(-this.height/2,this.height/2),v=(0,Y.RandomRange)(0,2*Math.PI),h=(0,Y.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(h)*this.radius,g=C*Math.cos(v),I=C*Math.sin(v);S?b.Ab(g,P,I):J.JZ.TransformCoordinatesFromFloatsToRef(g,P,I,t,b)}clone(){const t=new T(this.radius,this.directionRandomizer);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.height=this.height,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.height=t.height,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class a extends T{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.JZ(0,1,0);super(t,b,Z),this.direction1=S,this.direction2=P}startDirectionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),v=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),h=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);S?b.Ab(P,v,h):J.JZ.TransformNormalFromFloatsToRef(P,v,h,t,b)}clone(){const t=new a(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("height",this.height),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("height",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.jb(),t.direction2=this.direction2.jb(),t}parse(t){super.parse(t),J.JZ.FromArrayToRef(t.direction1,0,this.direction1),J.JZ.FromArrayToRef(t.direction2,0,this.direction2)}}class k{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=b,this.directionRandomizer=Z}startDirectionFunction(t,b,Z,S){const P=Z.position.SZ(t.getTranslation()).normalize(),v=(0,Y.RandomRange)(0,this.directionRandomizer),h=(0,Y.RandomRange)(0,this.directionRandomizer),C=(0,Y.RandomRange)(0,this.directionRandomizer);P.x+=v,P.y+=h,P.z+=C,P.normalize(),S?b.S(P):J.JZ.TransformNormalFromFloatsToRef(P.x,P.y,P.z,t,b)}startPositionFunction(t,b,Z,S){const P=this.radius-(0,Y.RandomRange)(0,this.radius*this.radiusRange),v=(0,Y.RandomRange)(0,1),h=(0,Y.RandomRange)(0,2*Math.PI),C=Math.acos(2*v-1),g=P*Math.cos(h)*Math.sin(C),I=P*Math.cos(C),r=P*Math.sin(h)*Math.sin(C);S?b.Ab(g,Math.abs(I),r):J.JZ.TransformCoordinatesFromFloatsToRef(g,Math.abs(I),r,t,b)}clone(){const t=new k(this.radius,this.directionRandomizer);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class u{constructor(){this.direction1=new J.JZ(0,1,0),this.direction2=new J.JZ(0,1,0)}startDirectionFunction(t,b,Z,S){const P=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),v=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),h=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);S?b.Ab(P,v,h):J.JZ.TransformNormalFromFloatsToRef(P,v,h,t,b)}startPositionFunction(t,b,Z,S){S?b.Ab(0,0,0):J.JZ.TransformCoordinatesFromFloatsToRef(0,0,0,t,b)}clone(){const t=new u;return g.e.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.direction1=this.direction1.jb(),t.direction2=this.direction2.jb(),t}parse(t){J.JZ.FromArrayToRef(t.direction1,0,this.direction1),J.JZ.FromArrayToRef(t.direction2,0,this.direction2)}}class l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=t,this.radiusRange=b,this.directionRandomizer=Z}startDirectionFunction(t,b,Z,S){const P=Z.position.SZ(t.getTranslation()).normalize(),v=(0,Y.RandomRange)(0,this.directionRandomizer),h=(0,Y.RandomRange)(0,this.directionRandomizer),C=(0,Y.RandomRange)(0,this.directionRandomizer);P.x+=v,P.y+=h,P.z+=C,P.normalize(),S?b.S(P):J.JZ.TransformNormalFromFloatsToRef(P.x,P.y,P.z,t,b)}startPositionFunction(t,b,Z,S){const P=this.radius-(0,Y.RandomRange)(0,this.radius*this.radiusRange),v=(0,Y.RandomRange)(0,1),h=(0,Y.RandomRange)(0,2*Math.PI),C=Math.acos(2*v-1),g=P*Math.cos(h)*Math.sin(C),I=P*Math.cos(C),r=P*Math.sin(h)*Math.sin(C);S?b.Ab(g,I,r):J.JZ.TransformCoordinatesFromFloatsToRef(g,I,r,t,b)}clone(){const t=new l(this.radius,this.directionRandomizer);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.radius=this.radius,t.radiusRange=this.radiusRange,t.directionRandomizer=this.directionRandomizer,t}parse(t){this.radius=t.radius,this.radiusRange=t.radiusRange,this.directionRandomizer=t.directionRandomizer}}class U extends l{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.JZ(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0);super(t),this.direction1=b,this.direction2=Z}startDirectionFunction(t,b){const Z=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),S=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),P=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);J.JZ.TransformNormalFromFloatsToRef(Z,S,P,t,b)}clone(){const t=new U(this.radius,this.direction1,this.direction2);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setFloat("radius",this.radius),t.setFloat("radiusRange",this.radiusRange),t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("radius",1),t.addUniform("radiusRange",1),t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const t=super.serialize();return t.direction1=this.direction1.jb(),t.direction2=this.direction2.jb(),t}parse(t){super.parse(t),this.direction1.S(t.direction1),this.direction2.S(t.direction2)}}class E{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(t,b,Z,S){const P=J.TmpVectors.JZ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Z,P);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Z,P);const t=J.TmpVectors.JZ[1];P.subtractToRef(Z.position,t),t.scaleToRef(1/Z.lifeTime,P)}else P.set(0,0,0);S?b.S(P):J.JZ.TransformNormalToRef(P,t,b)}startPositionFunction(t,b,Z,S){const P=J.TmpVectors.JZ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Z,P):P.set(0,0,0),S?b.S(P):J.JZ.TransformCoordinatesToRef(P,t,b)}clone(){const t=new E;return g.e.DeepCopy(this,t),t}applyToShader(t){}buildUniformLayout(t){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const t={};return t.type=this.getClassName(),t.particlePositionGenerator=this.particlePositionGenerator,t.particleDestinationGenerator=this.particleDestinationGenerator,t}parse(t){t.particlePositionGenerator&&(this.particlePositionGenerator=t.particlePositionGenerator),t.particleDestinationGenerator&&(this.particleDestinationGenerator=t.particleDestinationGenerator)}}var c=Z(12800);class H{get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t,t?(this._indices=t.Qb(),this._positions=t.getVerticesData(c.g.PositionKind),this._normals=t.getVerticesData(c.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=J.JZ.Zero(),this._mesh=null,this.direction1=new J.JZ(0,1,0),this.direction2=new J.JZ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=t}startDirectionFunction(t,b,Z,S){if(this.useMeshNormalsForDirection&&this._normals)return void J.JZ.TransformNormalToRef(this._storedNormal,t,b);const P=(0,Y.RandomRange)(this.direction1.x,this.direction2.x),v=(0,Y.RandomRange)(this.direction1.y,this.direction2.y),h=(0,Y.RandomRange)(this.direction1.z,this.direction2.z);S?b.Ab(P,v,h):J.JZ.TransformNormalFromFloatsToRef(P,v,h,t,b)}startPositionFunction(t,b,Z,S){if(!this._indices||!this._positions)return;const P=3*(Math.random()*(this._indices.length/3)|0),v=Math.random(),h=Math.random()*(1-v),C=1-v-h,Y=this._indices[P],g=this._indices[P+1],I=this._indices[P+2],r=J.TmpVectors.JZ[0],M=J.TmpVectors.JZ[1],T=J.TmpVectors.JZ[2],a=J.TmpVectors.JZ[3];J.JZ.FromArrayToRef(this._positions,3*Y,r),J.JZ.FromArrayToRef(this._positions,3*g,M),J.JZ.FromArrayToRef(this._positions,3*I,T),a.x=v*r.x+h*M.x+C*T.x,a.y=v*r.y+h*M.y+C*T.y,a.z=v*r.z+h*M.z+C*T.z,S?b.Ab(a.x,a.y,a.z):J.JZ.TransformCoordinatesFromFloatsToRef(a.x,a.y,a.z,t,b),this.useMeshNormalsForDirection&&this._normals&&(J.JZ.FromArrayToRef(this._normals,3*Y,r),J.JZ.FromArrayToRef(this._normals,3*g,M),J.JZ.FromArrayToRef(this._normals,3*I,T),this._storedNormal.x=v*r.x+h*M.x+C*T.x,this._storedNormal.y=v*r.y+h*M.y+C*T.y,this._storedNormal.z=v*r.z+h*M.z+C*T.z)}clone(){const t=new H(this.mesh);return g.e.DeepCopy(this,t),t}applyToShader(t){t.setVector3("direction1",this.direction1),t.setVector3("direction2",this.direction2)}buildUniformLayout(t){t.addUniform("direction1",3),t.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var t;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.jb(),b.direction2=this.direction2.jb(),b.meshId=null===(t=this.mesh)||void 0===t?void 0:t.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(t,b){J.JZ.FromArrayToRef(t.direction1,0,this.direction1),J.JZ.FromArrayToRef(t.direction2,0,this.direction2),t.meshId&&b&&(this.mesh=b.getLastMeshById(t.meshId)),this.useMeshNormalsForDirection=t.useMeshNormalsForDirection}}class o{_isUbo(t){return void 0!==t.addUniform}constructor(t){this._isUbo(t)?(this.setMatrix3x3=t.updateMatrix3x3.bind(t),this.setMatrix2x2=t.updateMatrix2x2.bind(t),this.setFloat=t.updateFloat.bind(t),this.setFloat2=t.updateFloat2.bind(t),this.setFloat3=t.updateFloat3.bind(t),this.setFloat4=t.updateFloat4.bind(t),this.setFloatArray=t.updateFloatArray.bind(t),this.setArray=t.updateArray.bind(t),this.setIntArray=t.updateIntArray.bind(t),this.setMatrix=t.yb.bind(t),this.setMatrices=t.updateMatrices.bind(t),this.setVector3=t.updateVector3.bind(t),this.setVector4=t.updateVector4.bind(t),this.setColor3=t.updateColor3.bind(t),this.setColor4=t.updateColor4.bind(t),this.setDirectColor4=t.updateDirectColor4.bind(t),this.setInt=t.updateInt.bind(t),this.setInt2=t.updateInt2.bind(t),this.setInt3=t.updateInt3.bind(t),this.setInt4=t.updateInt4.bind(t)):(this.setMatrix3x3=t.setMatrix3x3.bind(t),this.setMatrix2x2=t.setMatrix2x2.bind(t),this.setFloat=t.setFloat.bind(t),this.setFloat2=t.setFloat2.bind(t),this.setFloat3=t.setFloat3.bind(t),this.setFloat4=t.setFloat4.bind(t),this.setFloatArray=t.setFloatArray.bind(t),this.setArray=t.setArray.bind(t),this.setIntArray=t.setIntArray.bind(t),this.setMatrix=t.setMatrix.bind(t),this.setMatrices=t.setMatrices.bind(t),this.setVector3=t.setVector3.bind(t),this.setVector4=t.setVector4.bind(t),this.setColor3=t.setColor3.bind(t),this.setColor4=t.setColor4.bind(t),this.setDirectColor4=t.setDirectColor4.bind(t),this.setInt=t.setInt.bind(t),this.setInt2=t.setInt2.bind(t),this.setInt3=t.setInt3.bind(t),this.setInt4=t.setInt4.bind(t))}}var O=Z(12636);const p="gpuUpdateParticlesPixelShader",e="#version 300 es\nvoid main() {discard;}\n";O.e.ShadersStore[p]||(O.e.ShadersStore[p]=e);const W="gpuUpdateParticlesVertexShader",j="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";O.e.ShadersStore[W]||(O.e.ShadersStore[W]=j);(0,h.f)("BABYLON.WebGL2ParticleSystem",class{constructor(t,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=t,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var t;return(null===(t=this._updateEffect)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof E&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=t,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new o(this._updateEffect)}createVertexBuffers(t,b){this._updateVAO.push(this._createUpdateVAO(t)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(t){return t}bindDrawBuffers(t,b,Z){Z?this._engine.bindBuffers(this._renderVertexBuffers,Z,b):this._engine.bindVertexArrayObject(this._renderVAO[t],null)}preUpdateParticleBuffer(){const t=this._engine;if(this._engine.enableEffect(this._updateEffect),!t.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(t,b,Z){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[t],null);const J=this._engine;J.bindTransformFeedbackBuffer(b.getBuffer()),J.setRasterizerState(!1),J.beginTransformFeedback(!0),J.drawArraysType(3,0,Z),J.endTransformFeedback(),J.setRasterizerState(!0),J.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let t=0;t<this._updateVAO.length;t++)this._engine.releaseVertexArrayObject(this._updateVAO[t]);this._updateVAO.length=0;for(let t=0;t<this._renderVAO.length;t++)this._engine.releaseVertexArrayObject(this._renderVAO[t]);this._renderVAO.length=0}_createUpdateVAO(t){const b={};b.position=t.createVertexBuffer("position",0,3);let Z=3;b.age=t.createVertexBuffer("age",Z,1),Z+=1,b.size=t.createVertexBuffer("size",Z,3),Z+=3,b.life=t.createVertexBuffer("life",Z,1),Z+=1,b.seed=t.createVertexBuffer("seed",Z,4),Z+=4,b.direction=t.createVertexBuffer("direction",Z,3),Z+=3,this._parent.particleEmitterType instanceof E&&(b.initialPosition=t.createVertexBuffer("initialPosition",Z,3),Z+=3),this._parent._colorGradientsTexture||(b.color=t.createVertexBuffer("color",Z,4),Z+=4),this._parent._isBillboardBased||(b.initialDirection=t.createVertexBuffer("initialDirection",Z,3),Z+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",Z,3),Z+=3,b.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",Z,3),Z+=3),this._parent._angularSpeedGradientsTexture?(b.angle=t.createVertexBuffer("angle",Z,1),Z+=1):(b.angle=t.createVertexBuffer("angle",Z,2),Z+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=t.createVertexBuffer("cellIndex",Z,1),Z+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=t.createVertexBuffer("cellStartOffset",Z,1),Z+=1));const J=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),J}});class V{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,J=arguments.length>3?arguments[3]:void 0;this._engine=t,this._label=J,this._engine._storageBuffers.push(this),this._create(b,Z)}_create(t,b){this._bufferSize=t,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(t,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(t,b,Z){this._buffer&&this._engine.updateStorageBuffer(this._buffer,t,b,Z)}async read(t,b,Z,J){return await this._engine.readFromStorageBuffer(this._buffer,t,b,Z,J)}dispose(){const t=this._engine._storageBuffers,b=t.indexOf(this);-1!==b&&(t[b]=t[t.length-1],t.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var n=Z(12721),y=Z(12726),d=Z(12760),s=Z(12716),q=Z(13026),Q=Z(12557),N=Z(12665),A=Z(12946);class K{constructor(){this._gpuTimeInFrameId=-1,this.counter=new A.c}_addDuration(t,b){t<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==t?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=t):this.counter.addCount(b,!1))}}var L=Z(12621);class F{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=t,this._engine=b,this.uniqueId=q.c.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new K),this._engine.getCaps().supportComputeShaders?J.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=Z,this._options={bindingsMapping:{},defines:[],...J}):Q.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):Q.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=this._bindings[t];this._bindings[t]={type:Z?0:4,object:b,indexInGroupEntries:null===J||void 0===J?void 0:J.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!J||J.object!==b||J.type!==this._bindings[t].type)}setStorageTexture(t,b){const Z=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==b),this._bindings[t]={type:1,object:b,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setExternalTexture(t,b){const Z=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==b),this._bindings[t]={type:6,object:b,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setVideoTexture(t,b){return!!b.externalTexture&&(this.setExternalTexture(t,b.externalTexture),!0)}setUniformBuffer(t,b){const Z=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==b),this._bindings[t]={type:F._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setStorageBuffer(t,b){const Z=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==b),this._bindings[t]={type:F._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}setTextureSampler(t,b){const Z=this._bindings[t];this._contextIsDirty||(this._contextIsDirty=!Z||!b.compareSampler(Z.object)),this._bindings[t]={type:5,object:b,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries}}isReady(){let t=this._effect;for(const S in this._bindings){const t=this._bindings[S],b=t.type,Z=t.object;switch(b){case 0:case 4:case 1:if(!Z.isReady())return!1;break;case 6:if(!Z.isReady())return!1;break}}const b=[],Z=this._shaderPath;if(this._options.defines)for(let S=0;S<this._options.defines.length;S++)b.push(this._options.defines[S]);const J=b.join("\n");return this._cachedDefines!==J&&(this._cachedDefines=J,t=this._engine.createComputeEffect(Z,{defines:J,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=t),!!t.isReady()}dispatch(t,b,Z){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,t,b,Z,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Z=F._BufferIsDataBuffer(t)?t:t.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Z,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const Z=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(Z.type){case 0:{const J=this._samplers[b],S=Z.object;var t;if(!J||!S._texture||!J.compareSampler(S._texture))this._samplers[b]=(new N.b).setParameters(S.wrapU,S.wrapV,S.wrapR,S.anisotropicFilteringLevel,S._texture.samplingMode,null===(t=S._texture)||void 0===t?void 0:t._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const t=Z.object;t.getBuffer()!==Z.buffer&&(Z.buffer=t.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((S=>{(0,L.f)((()=>this.dispatch(t,b,Z)),S,void 0,J)}))}serialize(){const t=d.d.Serialize(this);t.options=this._options,t.shaderPath=this._shaderPath,t.mM={},t.textures={};for(const b in this._bindings){const Z=this._bindings[b],J=Z.object;switch(Z.type){case 0:case 4:case 1:{const S=J.serialize();S&&(t.textures[b]=S,t.mM[b]={type:Z.type});break}}}return t}static Parse(t,b,Z){const J=d.d.Parse((()=>new F(t.name,b.getEngine(),t.shaderPath,t.options)),t,b,Z);for(const S in t.textures){const P=t.mM[S],v=s.c.Parse(t.textures[S],b,Z);0===P.type?J.setTexture(S,v):4===P.type?J.setTexture(S,v,!1):J.setStorageTexture(S,v)}return J}static _BufferIsDataBuffer(t){return void 0!==t.underlyingResource}}(0,n.e)([(0,y.N)()],F.prototype,"name",void 0),(0,n.e)([(0,y.N)()],F.prototype,"fastMode",void 0),(0,h.f)("BABYLON.ComputeShader",F);var B=Z(13e3);const X="gpuUpdateParticlesComputeShader",x="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";O.e.ShadersStoreWGSL[X]||(O.e.ShadersStoreWGSL[X]=x);(0,h.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(t,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=t,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var t;return(null===(t=this._updateComputeShader)||void 0===t?void 0:t.isReady())??!1}createUpdateBuffer(t){var b;const Z={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Z.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Z.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Z.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Z.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Z.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Z.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Z.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new F("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Z,defines:t.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new B.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new o(this._simParamsComputeShader)}createVertexBuffers(t,b){this._renderVertexBuffers.push(b)}createParticleBuffer(t){const b=new V(this._engine,4*t.length,11,"ComputeShaderParticleSystemBuffer");return b.update(t),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(t,b,Z){this._engine.bindBuffers(this._renderVertexBuffers[t],Z,b)}preUpdateParticleBuffer(){}updateParticleBuffer(t,b,Z){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[t]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^t]),this._updateComputeShader.dispatch(Math.ceil(Z/64))}releaseBuffers(){var t;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class i{constructor(t,b,Z){this.gradient=t,this.color1=b,this.color2=Z}getColorToRef(t){this.color2?v.Fb.LerpToRef(this.color1,this.color2,Math.random(),t):t.S(this.color1)}}class z{constructor(t,b){this.gradient=t,this.color=b}}class D{constructor(t,b,Z){this.gradient=t,this.factor1=b,this.factor2=Z}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class f{static GetCurrentGradient(t,b,Z){if(b[0].gradient>t)return void Z(b[0],b[0],1);for(let S=0;S<b.length-1;S++){const J=b[S],P=b[S+1];if(t>=J.gradient&&t<=P.gradient){return void Z(J,P,(t-J.gradient)/(P.gradient-J.gradient))}}const J=b.length-1;Z(b[J],b[J],1)}}var mt=Z(12551),R=Z(13208),w=Z(12585);class G{constructor(t){this.particleSystem=t,this.position=J.JZ.Zero(),this.direction=J.JZ.Zero(),this.color=new v.Fb(0,0,0,0),this.colorStep=new v.Fb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new J.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new v.Fb(0,0,0,0),this._currentColor2=new v.Fb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=G._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let t=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,t=this._randomCellOffset):t+=this._randomCellOffset);const Z=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let J;J=this._initialSpriteCellLoop?(0,Y.Clamp)(t*b%this.lifeTime/this.lifeTime):(0,Y.Clamp)(t*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+J*Z|0}_inheritParticleInfoToSubEmitter(t){if(t.particleSystem.hb.position){const b=t.particleSystem.hb;if(b.position.S(this.position),t.inheritDirection){const t=J.TmpVectors.JZ[0];this.direction.normalizeToRef(t),b.setDirection(t,0,Math.PI/2)}}else{t.particleSystem.hb.S(this.position)}this.direction.scaleToRef(t.inheritedVelocityAmount/2,J.TmpVectors.JZ[0]),t.particleSystem._inheritedVelocityOffset.S(J.TmpVectors.JZ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const t of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(t)}_reset(){this.age=0,this.id=G._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(t){t.position.S(this.position),this._initialDirection?t._initialDirection?t._initialDirection.S(this._initialDirection):t._initialDirection=this._initialDirection.clone():t._initialDirection=null,t.direction.S(this.direction),this.UC&&(t.UC?t.UC.S(this.UC):t.UC=this.UC.clone()),t.color.S(this.color),t.colorStep.S(this.colorStep),t.lifeTime=this.lifeTime,t.age=this.age,t._randomCellOffset=this._randomCellOffset,t.size=this.size,t.scale.S(this.scale),t.angle=this.angle,t.angularSpeed=this.angularSpeed,t.particleSystem=this.particleSystem,t.cellIndex=this.cellIndex,t.id=this.id,t._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(t._currentColorGradient=this._currentColorGradient,t._currentColor1.S(this._currentColor1),t._currentColor2.S(this._currentColor2)),this._currentSizeGradient&&(t._currentSizeGradient=this._currentSizeGradient,t._currentSize1=this._currentSize1,t._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(t._currentAngularSpeedGradient=this._currentAngularSpeedGradient,t._currentAngularSpeed1=this._currentAngularSpeed1,t._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(t._currentVelocityGradient=this._currentVelocityGradient,t._currentVelocity1=this._currentVelocity1,t._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(t._currentLimitVelocityGradient=this._currentLimitVelocityGradient,t._currentLimitVelocity1=this._currentLimitVelocity1,t._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(t._currentDragGradient=this._currentDragGradient,t._currentDrag1=this._currentDrag1,t._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(t._initialStartSpriteCellId=this._initialStartSpriteCellId,t._initialEndSpriteCellId=this._initialEndSpriteCellId,t._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(t.remapData&&this.remapData?t.remapData.S(this.remapData):t.remapData=new J.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.S(this._randomNoiseCoordinates1),t._randomNoiseCoordinates2.S(this._randomNoiseCoordinates2)):(t._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),t._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}G._Count=0;var tt=Z(12848),bt=(Z(12898),Z(13107)),Zt=Z(13098),Jt=Z(12993);function St(t,b){const Z=(0,Y.RandomRange)(0,1);v.Fb.LerpToRef(b.color1,b.color2,Z,t.color),b.colorDead.subtractToRef(t.color,b._colorDiff),b._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)}function Pt(t,b){t._currentColorGradient=b._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.S(t.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.S(t.color)}function vt(t,b){const Z=b._colorGradients;f.GetCurrentGradient(b._ratio,Z,((b,Z,J)=>{b!==t._currentColorGradient&&(t._currentColor1.S(t._currentColor2),Z.getColorToRef(t._currentColor2),t._currentColorGradient=b),v.Fb.LerpToRef(t._currentColor1,t._currentColor2,J,t.color)}))}function ht(t,b){t.colorStep.scaleToRef(b._scaledUpdateSpeed,b._scaledColorStep),t.color.addInPlace(b._scaledColorStep),t.color.a<0&&(t.color.a=0)}function Ct(t,b){f.GetCurrentGradient(b._ratio,b._angularSpeedGradients,((b,Z,J)=>{b!==t._currentAngularSpeedGradient&&(t._currentAngularSpeed1=t._currentAngularSpeed2,t._currentAngularSpeed2=Z.getFactor(),t._currentAngularSpeedGradient=b),t.angularSpeed=(0,Y.Lerp)(t._currentAngularSpeed1,t._currentAngularSpeed2,J)}))}function Yt(t,b){t.angle+=t.angularSpeed*b._scaledUpdateSpeed}function gt(t,b){b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,t.direction,t,b.isLocal,b._emitterInverseWorldMatrix)}function It(t,b){b.startDirectionFunction(b._emitterWorldMatrix,t.direction,t,b.isLocal)}function rt(t,b){t._currentVelocityGradient=b._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?t._currentVelocity2=b._velocityGradients[1].getFactor():t._currentVelocity2=t._currentVelocity1}function Mt(t,b){t._currentLimitVelocityGradient=b._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?t._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():t._currentLimitVelocity2=t._currentLimitVelocity1}function Tt(t,b){f.GetCurrentGradient(b._ratio,b._velocityGradients,((Z,J,S)=>{Z!==t._currentVelocityGradient&&(t._currentVelocity1=t._currentVelocity2,t._currentVelocity2=J.getFactor(),t._currentVelocityGradient=Z),b._directionScale*=(0,Y.Lerp)(t._currentVelocity1,t._currentVelocity2,S)}))}function at(t,b){f.GetCurrentGradient(b._ratio,b._limitVelocityGradients,((Z,J,S)=>{Z!==t._currentLimitVelocityGradient&&(t._currentLimitVelocity1=t._currentLimitVelocity2,t._currentLimitVelocity2=J.getFactor(),t._currentLimitVelocityGradient=Z);const P=(0,Y.Lerp)(t._currentLimitVelocity1,t._currentLimitVelocity2,S);t.direction.length()>P&&t.direction.scaleInPlace(b.limitVelocityDamping)}))}function kt(t,b){t.direction.scaleToRef(b._directionScale,b._scaledDirection)}function ut(t,b){b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,t.position,t,b.isLocal)}function lt(t,b){b.startPositionFunction(b._emitterWorldMatrix,t.position,t,b.isLocal)}function Ut(t,b){t.UC?t.UC.S(t.position):t.UC=t.position.clone(),J.JZ.TransformCoordinatesToRef(t.UC,b._emitterWorldMatrix,t.position)}function Et(t,b){b.isLocal&&t.UC?(t.UC.addInPlace(b._scaledDirection),J.JZ.TransformCoordinatesToRef(t.UC,b._emitterWorldMatrix,t.position)):t.position.addInPlace(b._scaledDirection)}function ct(t,b){t._currentDragGradient=b._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),b._dragGradients.length>1?t._currentDrag2=b._dragGradients[1].getFactor():t._currentDrag2=t._currentDrag1}function Ht(t,b){f.GetCurrentGradient(b._ratio,b._dragGradients,((Z,J,S)=>{Z!==t._currentDragGradient&&(t._currentDrag1=t._currentDrag2,t._currentDrag2=J.getFactor(),t._currentDragGradient=Z);const P=(0,Y.Lerp)(t._currentDrag1,t._currentDrag2,S);b._scaledDirection.scaleInPlace(1-P)}))}function ot(t,b){t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.Ab(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.Ab(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new J.JZ(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new J.JZ(Math.random(),Math.random(),Math.random()))}function Ot(t,b){const Z=b._noiseTextureData,S=b._noiseTextureSize;if(Z&&S&&t._randomNoiseCoordinates1){const P=b._fetchR(t._randomNoiseCoordinates1.x,t._randomNoiseCoordinates1.y,S.width,S.height,Z),v=b._fetchR(t._randomNoiseCoordinates1.z,t._randomNoiseCoordinates2.x,S.width,S.height,Z),h=b._fetchR(t._randomNoiseCoordinates2.y,t._randomNoiseCoordinates2.z,S.width,S.height,Z),C=J.TmpVectors.JZ[0],Y=J.TmpVectors.JZ[1];C.Ab((2*P-1)*b.noiseStrength.x,(2*v-1)*b.noiseStrength.y,(2*h-1)*b.noiseStrength.z),C.scaleToRef(b._tempScaledUpdateSpeed,Y),t.direction.addInPlace(Y)}}function pt(t,b){b.gravity.scaleToRef(b._tempScaledUpdateSpeed,b._scaledGravity),t.direction.addInPlace(b._scaledGravity)}function et(t,b){t.size=(0,Y.RandomRange)(b.minSize,b.maxSize),t.scale.Ab((0,Y.RandomRange)(b.minScaleX,b.maxScaleX),(0,Y.RandomRange)(b.minScaleY,b.maxScaleY))}function Wt(t,b){t._currentSizeGradient=b._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,b._sizeGradients.length>1?t._currentSize2=b._sizeGradients[1].getFactor():t._currentSize2=t._currentSize1,t.scale.Ab((0,Y.RandomRange)(b.minScaleX,b.maxScaleX),(0,Y.RandomRange)(b.minScaleY,b.maxScaleY))}function jt(t,b){const Z=b._actualFrame/b.targetStopDuration;f.GetCurrentGradient(Z,b._startSizeGradients,((Z,J,S)=>{Z!==b._currentStartSizeGradient&&(b._currentStartSize1=b._currentStartSize2,b._currentStartSize2=J.getFactor(),b._currentStartSizeGradient=Z);const P=(0,Y.Lerp)(b._currentStartSize1,b._currentStartSize2,S);t.scale.scaleInPlace(P)}))}function Vt(t,b){f.GetCurrentGradient(b._ratio,b._sizeGradients,((b,Z,J)=>{b!==t._currentSizeGradient&&(t._currentSize1=t._currentSize2,t._currentSize2=Z.getFactor(),t._currentSizeGradient=b),t.size=(0,Y.Lerp)(t._currentSize1,t._currentSize2,J)}))}function nt(t,b){t.remapData=new J.Vector4(0,1,0,1)}function yt(t,b){b._colorRemapGradients&&b._colorRemapGradients.length>0&&f.GetCurrentGradient(b._ratio,b._colorRemapGradients,((b,Z,J)=>{const S=(0,Y.Lerp)(b.factor1,Z.factor1,J),P=(0,Y.Lerp)(b.factor2,Z.factor2,J);t.remapData.x=S,t.remapData.y=P-S})),b._alphaRemapGradients&&b._alphaRemapGradients.length>0&&f.GetCurrentGradient(b._ratio,b._alphaRemapGradients,((b,Z,J)=>{const S=(0,Y.Lerp)(b.factor1,Z.factor1,J),P=(0,Y.Lerp)(b.factor2,Z.factor2,J);t.remapData.z=S,t.remapData.w=P-S}))}function dt(t,b){const Z=(0,Y.Clamp)(b._actualFrame/b.targetStopDuration);f.GetCurrentGradient(Z,b._lifeTimeGradients,((b,J)=>{const S=b,P=J,v=S.getFactor(),h=P.getFactor(),C=(Z-S.gradient)/(P.gradient-S.gradient);t.lifeTime=(0,Y.Lerp)(v,h,C)})),b._emitPower=(0,Y.RandomRange)(b.minEmitPower,b.maxEmitPower)}function st(t,b){t.lifeTime=(0,Y.RandomRange)(b.minLifeTime,b.maxLifeTime),b._emitPower=(0,Y.RandomRange)(b.minEmitPower,b.maxEmitPower)}function qt(t,b){0===b._emitPower?(t._initialDirection?t._initialDirection.S(t.direction):t._initialDirection=t.direction.clone(),t.direction.set(0,0,0)):(t._initialDirection=null,t.direction.scaleInPlace(b._emitPower)),t.direction.addInPlace(b._inheritedVelocityOffset)}function Qt(t,b){t.angularSpeed=(0,Y.RandomRange)(b.minAngularSpeed,b.maxAngularSpeed),t.angle=(0,Y.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function Nt(t,b){t._currentAngularSpeedGradient=b._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,b._angularSpeedGradients.length>1?t._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():t._currentAngularSpeed2=t._currentAngularSpeed1,t.angle=(0,Y.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function At(t,b){t._initialStartSpriteCellId=b.startSpriteCellID,t._initialEndSpriteCellId=b.endSpriteCellID,t._initialSpriteCellLoop=b.spriteCellLoop}function Kt(t,b){t.previousItem=b.previousItem,t.nextItem=b,b.previousItem&&(b.previousItem.nextItem=t),b.previousItem=t}function Lt(t,b){t.previousItem=b,t.nextItem=b.nextItem,b.nextItem&&(b.nextItem.previousItem=t),b.nextItem=t}function Ft(t,b){let Z=b;for(;Z.nextItem;)Z=Z.nextItem;t.previousItem=Z,t.nextItem=Z.nextItem,Z.nextItem=t}function Bt(t){t.previousItem&&(t.previousItem.nextItem=t.nextItem),t.nextItem&&(t.nextItem.previousItem=t.previousItem)}class Xt extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(t){this._startDirectionFunction!==t&&(this._startDirectionFunction=t,this._directionProcessing.process=t?It:gt)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(t){this._startPositionFunction!==t&&(this._startPositionFunction=t,this._positionCreation.process=t?lt:ut)}set onDispose(t){this._onDisposeObserver&&this.lb.remove(this._onDisposeObserver),this._onDisposeObserver=this.lb.add(t)}get h(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(t){this._useRampGradients!==t&&(this._useRampGradients=t,this._resetEffect(),t?(this._rampCreation={process:nt,previousItem:null,nextItem:null},Lt(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:yt,previousItem:null,nextItem:null},Lt(this._remapGradientProcessing,this._gravityProcessing)):(Bt(this._rampCreation),Bt(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(t){this._isLocal!==t&&(this._isLocal=t,t?(this._isLocalCreation={process:Ut,previousItem:null,nextItem:null},Lt(this._isLocalCreation,this._positionCreation)):Bt(this._isLocalCreation))}get particles(){return this.Br}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(t){this._animationSheetEnabled!==t&&(this._animationSheetEnabled=t,t?(this._sheetCreation={process:At,previousItem:null,nextItem:null},Lt(this._sheetCreation,this._colorCreation)):Bt(this._sheetCreation),this._reset())}getActiveCount(){return this.Br.length}getClassName(){return"Db"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var t;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[b])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new tt.e(this._engine),this._customWrappers[b].effect=t,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new mt.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(t){if(this.noiseTexture!==t){if(this._noiseTexture=t,!t)return Bt(this._noiseCreation),void Bt(this._noiseProcessing);this._noiseCreation={process:ot,previousItem:null,nextItem:null},Lt(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Ot,previousItem:null,nextItem:null},Lt(this._noiseProcessing,this._positionProcessing)}}constructor(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(t),this._emitterInverseWorldMatrix=J.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new J.JZ,this.lb=new mt.d,this.onStoppedObservable=new mt.d,this.onStartedObservable=new mt.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Br=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new v.Fb(0,0,0,0),this._colorDiff=new v.Fb(0,0,0,0),this._scaledDirection=J.JZ.Zero(),this._scaledGravity=J.JZ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=t=>{},this.recycleParticle=t=>{const b=this.Br.pop();b!==t&&b.copyTo(t),this._stockParticles.push(b)},this._createParticle=()=>{let t;return 0!==this._stockParticles.length?(t=this._stockParticles.pop(),t._reset()):t=new G(this),this._prepareParticle(t),t},this.paused=!1,this._shadersLoaded=!1,this._capacity=b,this._epsilon=h,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||w.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Lr.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:st,previousItem:null,nextItem:null},this._positionCreation={process:ut,previousItem:null,nextItem:null},Lt(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:gt,previousItem:null,nextItem:null},Lt(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:qt,previousItem:null,nextItem:null},Lt(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:et,previousItem:null,nextItem:null},Lt(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Qt,previousItem:null,nextItem:null},Lt(this._angleCreation,this._sizeCreation),this._colorCreation={process:St,previousItem:null,nextItem:null},Lt(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:ht,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Yt,previousItem:null,nextItem:null},Lt(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:kt,previousItem:null,nextItem:null},Lt(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Et,previousItem:null,nextItem:null},Lt(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:pt,previousItem:null,nextItem:null},Lt(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=P,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new I,this.updateFunction=t=>{var b;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((t=>{this._noiseTextureData=t})));const Z=t===this.Br;for(let J=0;J<t.length;J++){const b=t[J];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const S=b.age;if(b.age+=this._tempScaledUpdateSpeed,b.age>b.lifeTime){const t=b.age-S,Z=b.lifeTime-S;this._tempScaledUpdateSpeed=Z*this._tempScaledUpdateSpeed/t,b.age=b.lifeTime}this._ratio=b.age/b.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let P=this._updateQueueStart;for(;P;)P.process(b,this),P=P.nextItem;if(this._isAnimationSheetEnabled&&!C&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime){if(this._emitFromParticle(b),b._attachedSubEmitters){for(const t of b._attachedSubEmitters)t.particleSystem.disposeOnStop=!0,t.particleSystem.stop();b._attachedSubEmitters=null}this.recycleParticle(b),Z&&J--}else;}}}serialize(t){throw new Error("Method not implemented.")}clone(t,b){throw new Error("Method not implemented.")}_addFactorGradient(t,b,Z,J){const S=new D(b,Z,J);t.push(S),t.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0))}_removeFactorGradient(t,b){if(!t)return;let Z=0;for(const J of t){if(J.gradient===b){t.splice(Z,1);break}Z++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=dt:this._lifeTimeCreation.process=st}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:jt,previousItem:null,nextItem:null},Lt(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Bt(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(t){this.targetStopDuration!==t&&(this._targetStopDuration=t,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(t,b,Z){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,t,b,Z),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(t){return this._removeFactorGradient(this._lifeTimeGradients,t),this._syncLifeTimeCreation(),this}addSizeGradient(t,b,Z){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Wt,this._sizeGradientProcessing={process:Vt,previousItem:null,nextItem:null},Kt(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,t,b,Z),this}removeSizeGradient(t){var b;return this._removeFactorGradient(this._sizeGradients,t),0===(null===(b=this._sizeGradients)||void 0===b?void 0:b.length)&&(Bt(this._sizeGradientProcessing),this._sizeCreation.process=et),this}addColorRemapGradient(t,b,Z){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,t,b,Z),this}removeColorRemapGradient(t){return this._removeFactorGradient(this._colorRemapGradients,t),this}addAlphaRemapGradient(t,b,Z){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,t,b,Z),this}removeAlphaRemapGradient(t){return this._removeFactorGradient(this._alphaRemapGradients,t),this}addAngularSpeedGradient(t,b,Z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Nt,this._angularSpeedGradientProcessing={process:Ct,previousItem:null,nextItem:null},Kt(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,t,b,Z),this}removeAngularSpeedGradient(t){var b;return this._removeFactorGradient(this._angularSpeedGradients,t),0===(null===(b=this._angularSpeedGradients)||void 0===b?void 0:b.length)&&(this._angleCreation.process=Qt,Bt(this._angularSpeedGradientProcessing)),this}addVelocityGradient(t,b,Z){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:rt,previousItem:null,nextItem:null},Lt(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Tt,previousItem:null,nextItem:null},Kt(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,t,b,Z),this}removeVelocityGradient(t){var b;return this._removeFactorGradient(this._velocityGradients,t),0===(null===(b=this._velocityGradients)||void 0===b?void 0:b.length)&&(Bt(this._velocityCreation),Bt(this._velocityGradientProcessing)),this}addLimitVelocityGradient(t,b,Z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Mt,previousItem:null,nextItem:null},Lt(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:at,previousItem:null,nextItem:null},Lt(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,t,b,Z),this}removeLimitVelocityGradient(t){var b;return this._removeFactorGradient(this._limitVelocityGradients,t),0===(null===(b=this._limitVelocityGradients)||void 0===b?void 0:b.length)&&(Bt(this._limitVelocityCreation),Bt(this._limitVelocityGradientProcessing)),this}addDragGradient(t,b,Z){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:ct,previousItem:null,nextItem:null},Kt(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:Ht,previousItem:null,nextItem:null},Kt(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,t,b,Z),this}removeDragGradient(t){var b;return this._removeFactorGradient(this._dragGradients,t),0===(null===(b=this._dragGradients)||void 0===b?void 0:b.length)&&(Bt(this._dragCreation),Bt(this._dragGradientProcessing)),this}addEmitRateGradient(t,b,Z){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,t,b,Z),this}removeEmitRateGradient(t){return this._removeFactorGradient(this._emitRateGradients,t),this}addStartSizeGradient(t,b,Z){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,t,b,Z),this._syncStartSizeCreation(),this}removeStartSizeGradient(t){return this._removeFactorGradient(this._startSizeGradients,t),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const t=new Uint8Array(4*this._rawTextureWidth),b=v.TmpColors.hZ[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const J=Z/this._rawTextureWidth;f.GetCurrentGradient(J,this._rampGradients,((J,S,P)=>{v.hZ.LerpToRef(J.color,S.color,P,b),t[4*Z]=255*b.r,t[4*Z+1]=255*b.g,t[4*Z+2]=255*b.b,t[4*Z+3]=255}))}this._rampGradientsTexture=R.c.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(t,b){this._rampGradients||(this._rampGradients=[]);const Z=new z(t,b);return this._rampGradients.push(Z),this._syncRampGradientTexture(),this}removeRampGradient(t){return this._removeGradientAndTexture(t,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(t,b,Z){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=Pt,this._colorProcessing.process=vt);const J=new i(t,b,Z);return this._colorGradients.push(J),this._colorGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this}removeColorGradient(t){if(!this._colorGradients)return this;let b=0;for(const Z of this._colorGradients){if(Z.gradient===t){this._colorGradients.splice(b,1);break}b++}return 0===this._colorGradients.length&&(this._colorCreation.process=St,this._colorProcessing.process=ht),this}resetDrawCache(){if(this._drawWrappers){for(const t of this._drawWrappers)if(t)for(const b of t)null===b||void 0===b||b.dispose();this._drawWrappers=[]}}_fetchR(t,b,Z,J,S){return S[4*(((t=.5*Math.abs(t)+.5)*Z%Z|0)+((b=.5*Math.abs(b)+.5)*J%J|0)*Z)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const t=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new c.d(t,this._vertexData,!0,b);let Z=0;const J=this._vertexBuffer.createVertexBuffer(c.g.PositionKind,Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.g.PositionKind]=J,Z+=3;const S=this._vertexBuffer.createVertexBuffer(c.g.ColorKind,Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.g.ColorKind]=S,Z+=4;const P=this._vertexBuffer.createVertexBuffer("angle",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=P,Z+=1;const v=this._vertexBuffer.createVertexBuffer("size",Z,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,Z+=2,this._isAnimationSheetEnabled){const t=this._vertexBuffer.createVertexBuffer("cellIndex",Z,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=t,Z+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const t=this._vertexBuffer.createVertexBuffer("direction",Z,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=t,Z+=3}if(this._useRampGradients){const t=this._vertexBuffer.createVertexBuffer("remapData",Z,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=t,Z+=4}let h;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new c.d(t,b,!1,2),h=this._spriteBuffer.createVertexBuffer("offset",0,2)}else h=this._vertexBuffer.createVertexBuffer("offset",Z,2,this._vertexBufferSize,this._useInstancing),Z+=2;this._vertexBuffers.offset=h,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const t=[],b=[];let Z=0;for(let J=0;J<this._capacity;J++)t.push(Z),t.push(Z+1),t.push(Z+2),t.push(Z),t.push(Z+2),t.push(Z+3),b.push(Z,Z+1,Z+1,Z+2,Z+2,Z+3,Z+3,Z,Z,Z+3),Z+=4;this._indexBuffer=this._engine.createIndexBuffer(t),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(t)setTimeout((()=>{this.start(0)}),t);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.hb)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.hb.sb(!0);const t=this.noiseTexture;if(t&&t.onGeneratedObservable)t.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),t.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(t))}_postStop(t){}reset(){this._stockParticles.length=0,this.Br.length=0}_appendParticleVertex(t,b,Z,S){let P=t*this._vertexBufferSize;if(this._vertexData[P++]=b.position.x+this.BY.x,this._vertexData[P++]=b.position.y+this.BY.y,this._vertexData[P++]=b.position.z+this.BY.z,this._vertexData[P++]=b.color.r,this._vertexData[P++]=b.color.g,this._vertexData[P++]=b.color.b,this._vertexData[P++]=b.color.a,this._vertexData[P++]=b.angle,this._vertexData[P++]=b.scale.x*b.size,this._vertexData[P++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[P++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[P++]=b.direction.x,this._vertexData[P++]=b.direction.y,this._vertexData[P++]=b.direction.z);else if(b._initialDirection){let t=b._initialDirection;this.isLocal&&(J.JZ.TransformNormalToRef(t,this._emitterWorldMatrix,J.TmpVectors.JZ[0]),t=J.TmpVectors.JZ[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[P++]=t.x,this._vertexData[P++]=t.y,this._vertexData[P++]=t.z}else{let t=b.direction;this.isLocal&&(J.JZ.TransformNormalToRef(t,this._emitterWorldMatrix,J.TmpVectors.JZ[0]),t=J.TmpVectors.JZ[0]),0===t.x&&0===t.z&&(t.x=.001),this._vertexData[P++]=t.x,this._vertexData[P++]=t.y,this._vertexData[P++]=t.z}this._useRampGradients&&b.remapData&&(this._vertexData[P++]=b.remapData.x,this._vertexData[P++]=b.remapData.y,this._vertexData[P++]=b.remapData.z,this._vertexData[P++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Z?Z=this._epsilon:1===Z&&(Z=1-this._epsilon),0===S?S=this._epsilon:1===S&&(S=1-this._epsilon)),this._vertexData[P++]=Z,this._vertexData[P++]=S)}_prepareParticle(t){}_createNewOnes(t){let b;for(let Z=0;Z<t&&this.Br.length!==this._capacity;Z++){b=this._createParticle(),this.Br.push(b);let t=this._createQueueStart;for(;t;)t.process(b,this),t=t.nextItem;b._inheritParticleInfoToSubEmitters()}}_update(t){if(this._alive=this.Br.length>0,this.hb.position){const t=this.hb;this._emitterWorldMatrix=t.getWorldMatrix()}else{const t=this.hb;this._emitterWorldMatrix=J.Matrix.Translation(t.x,t.y,t.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Br),this._createNewOnes(t)}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=[c.g.PositionKind,c.g.ColorKind,"angle","offset","size"];return t&&J.push("cellIndex"),b||J.push("direction"),Z&&J.push("remapData"),J}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bt.c)(J),t&&J.push("particlesInfos"),b&&J.push("logarithmicDepthConstant"),Z&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bt.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&t.push("#define FOG")),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),b===C.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&t.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case 2:t.push("#define BILLBOARDY");break;case 8:case 9:t.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&t.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:t.push("#define BILLBOARDMODE_ALL")}Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,b,Z){b.push(...Xt._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),t.push(...Xt._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Jt.f)(t,this._imageProcessingConfigurationDefines),(0,Jt.b)(Z,this._imageProcessingConfigurationDefines))}_getWrapper(t){const b=this._getCustomDrawWrapper(t);if(null!==b&&void 0!==b&&b.effect)return b;const Z=[];this.fillDefines(Z,t);const J=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let S=this._drawWrappers[J];S||(S=this._drawWrappers[J]=[]);let P=S[t];P||(P=new tt.e(this._engine),P.drawContext&&(P.drawContext.useInstancing=this._useInstancing),S[t]=P);const v=Z.join("\n");if(P.defines!==v){const t=[],b=[],Z=[];this.fillUniformsAttributesAndSamplerNames(b,t,Z),P.setEffect(this._engine.createEffect("particles",t,b,Z,v,void 0,void 0,void 0,void 0,this._shaderLanguage),v)}return P}animate(){var t;let b,Z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Z&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Z?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let t=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;f.GetCurrentGradient(b,this._emitRateGradients,((b,Z,J)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Z.getFactor(),this._currentEmitRateGradient=b),t=(0,Y.Lerp)(this._currentEmitRate1,this._currentEmitRate2,J)}))}b=t*this._scaledUpdateSpeed|0,this._newPartsExcess+=t*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Z){let t=0;for(let b=0;b<this.Br.length;b++){const Z=this.Br[b];this._appendParticleVertices(t,Z),t+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Br.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(t,b){this._appendParticleVertex(t++,b,0,0),this._useInstancing||(this._appendParticleVertex(t++,b,1,0),this._appendParticleVertex(t++,b,1,1),this._appendParticleVertex(t++,b,0,1))}rebuild(){var t;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(t=this._spriteBuffer)||void 0===t||t._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Xt.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Z.bind(Z,14167)),Promise.resolve().then(Z.bind(Z,14121))])):await Promise.all([Promise.resolve().then(Z.bind(Z,14105)),Promise.resolve().then(Z.bind(Z,14095))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.hb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(t){const b=this._getWrapper(t),Z=b.effect,S=this._engine;S.enableEffect(b);const P=this.defaultViewMatrix??this._scene.getViewMatrix();if(Z.setTexture("diffuseSampler",this.particleTexture),Z.setMatrix("view",P),Z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();Z.setFloat3("particlesInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,this.spriteCellWidth/t.width)}if(Z.setVector2("translationPivot",this.translationPivot),Z.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;Z.setVector3("eyePosition",t.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Z.setTexture("rampSampler",this._rampGradientsTexture));const v=Z.defines;var h,C,Y,g,I,r;(this._scene&&((0,bt.f)(Z,this,this._scene),this.applyFog&&(0,Zt.g)(this._scene,void 0,Z)),v.indexOf("#define BILLBOARDMODE_ALL")>=0&&(P.invertToRef(J.TmpVectors.Matrix[0]),Z.setMatrix("invView",J.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?S.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Z):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Z)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?S.bindBuffers(this._vertexBuffers,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Z):S.bindBuffers(this._vertexBuffers,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null,Z);(this.useLogarithmicDepth&&this._scene&&(0,Zt.m)(v,Z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Z),this._setEngineBasedOnBlendMode(t),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Z),this._useInstancing)?null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?S.drawElementsType(6,0,10,this.Br.length):S.drawArraysType(7,0,4,this.Br.length):null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?S.drawElementsType(1,0,10*this.Br.length):S.drawElementsType(0,0,6*this.Br.length);return this.Br.length}render(){if(!this.isReady()||!this.Br.length)return 0;const t=this._engine;t.setState&&(t.setState(!1),this.forceDepthWrite&&t.setDepthWrite(!0));let b=0;return b=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,Z),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const t=this._scene.Lr.indexOf(this);t>-1&&this._scene.Lr.splice(t,1),this._scene._activeParticleSystems.dispose()}this.lb.notifyObservers(this),this.lb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Xt.ForceGLSL=!1;var xt,it=Z(12573);!function(t){t[t.ATTACHED=0]="ATTACHED",t[t.END=1]="END"}(xt||(xt={}));class zt{constructor(t){if(this.particleSystem=t,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!t.hb||!t.hb.dispose){const b=(0,h.d)("BABYLON.AbstractMesh");t.hb=new b("SubemitterSystemEmitter",t.et()),t._disposeEmitterOnDispose=!0}}clone(){let t=this.particleSystem.hb;if(t){if(t instanceof J.JZ)t=t.clone();else if(-1!==t.getClassName().indexOf("Mesh")){t=new((0,h.d)("BABYLON.Mesh"))("",t.et()),t.isVisible=!1}}else t=new J.JZ;const b=new zt(this.particleSystem.clone(this.particleSystem.name,t));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(t),b}static _ParseParticleSystem(t,b,Z){throw(0,it.b)("ParseParticle")}static Parse(t,b,Z){const J=t.particleSystem,S=new zt(zt._ParseParticleSystem(J,b,Z,!0));return S.type=t.type,S.inheritDirection=t.inheritDirection,S.inheritedVelocityAmount=t.inheritedVelocityAmount,S.particleSystem._isSubEmitter=!0,S}dispose(){this.particleSystem.dispose()}}var Dt=Z(12623);function ft(t,b){const Z=new u;return Z.direction1=t,Z.direction2=b,Z}function mb(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Rt(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function wt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.JZ(0,1,0),Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0);return new U(t,b,Z)}function Gt(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function tb(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0),P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.JZ(0,1,0);return new a(t,b,Z,S,P)}function bb(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new r(t,b)}function Zb(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0),S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0);return new M(t,b,Z,S)}const Jb=J.JZ.Zero(),Sb=J.JZ.Zero(),Pb=J.JZ.Zero();class vb{constructor(){this.strength=0,this.position=J.JZ.Zero()}_processParticle(t,b){this.position.subtractToRef(t.position,Jb);const Z=Jb.lengthSquared()+1;Jb.normalize().scaleToRef(this.strength/Z,Sb),Sb.scaleToRef(b._tempScaledUpdateSpeed,Pb),t.direction.addInPlace(Pb)}serialize(){return{position:this.position.jb(),strength:this.strength}}}class hb extends Xt{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=t=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);for(const Z of this._subEmitters[b])if(1===Z.type){const b=Z.clone();t._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(t,b){const Z=ft(t,b);return this.particleEmitterType=Z,Z}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t,this._flowMapUpdate&&(Bt(this._flowMapUpdate),this._flowMapUpdate=null),t&&(this._flowMapUpdate={process:t=>{var b;const Z=null===(b=this.et())||void 0===b?void 0:b.getTransformMatrix();this._flowMap._processParticle(t,this.flowMapStrength*this._tempScaledUpdateSpeed,Z)},previousItem:null,nextItem:null},Lt(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(t){this._attractors.push(t),1===this._attractors.length&&(this._attractorUpdate={process:t=>{for(const b of this._attractors)b._processParticle(t,this)},previousItem:null,nextItem:null},Lt(this._attractorUpdate,this._directionProcessing))}removeAttractor(t){const b=this._attractors.indexOf(t);-1!==b&&this._attractors.splice(b,1),0===this._attractors.length&&Bt(this._attractorUpdate)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(t)}createHemisphericEmitter(){const t=mb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.JZ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Gt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=Zb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,b,Z,J){const S=new I;return this.particleEmitterType=S,this.direction1=t,this.direction2=b,this.minEmitBox=Z,this.maxEmitBox=J,S}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const t of this.subEmitters)t instanceof hb?this._subEmitters.push([new zt(t)]):t instanceof zt?this._subEmitters.push([t]):t instanceof Array&&this._subEmitters.push(t)}_stopSubEmitters(){if(this.activeSubSystems){for(const t of this.activeSubSystems)t.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const t=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==t&&this._rootParticleSystem.activeSubSystems.splice(t,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(t){t&&this._stopSubEmitters()}_prepareParticle(t){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];t._attachedSubEmitters=[];for(const Z of b)if(0===Z.type){const b=Z.clone();t._attachedSubEmitters.push(b),b.particleSystem.start()}}}_onDispose(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),t&&this.particles)for(const Z of this.particles)if(Z._attachedSubEmitters)for(let t=Z._attachedSubEmitters.length-1;t>=0;t-=1)Z._attachedSubEmitters[t].dispose();if(b&&this.activeSubSystems)for(let Z=this.activeSubSystems.length-1;Z>=0;Z-=1)this.activeSubSystems[Z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let t=0;t<this._subEmitters.length;t++)for(const b of this._subEmitters[t])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.hb&&this.hb.dispose&&this.hb.dispose(!0)}static _Parse(t,b,Z,S){let P;P=Z instanceof Dt.e?null:Z;const C=(0,h.d)("BABYLON.Texture");if(C&&P&&(t.texture?b.particleTexture=C.Parse(t.texture,P,S):t.textureName&&(b.particleTexture=new C(S+t.textureName,P,!1,void 0===t.invertY||t.invertY),b.particleTexture.name=t.textureName)),t.emitterId||0===t.emitterId||void 0!==t.hb?t.emitterId&&P?b.hb=P.getLastMeshById(t.emitterId):b.hb=J.JZ.CZ(t.hb):b.hb=J.JZ.Zero(),b.isLocal=!!t.isLocal,void 0!==t.renderingGroupId&&(b.renderingGroupId=t.renderingGroupId),void 0!==t.isBillboardBased&&(b.isBillboardBased=t.isBillboardBased),void 0!==t.billboardMode&&(b.billboardMode=t.billboardMode),void 0!==t.useLogarithmicDepth&&(b.useLogarithmicDepth=t.useLogarithmicDepth),t.animations){for(let Z=0;Z<t.animations.length;Z++){const J=t.animations[Z],S=(0,h.d)("BABYLON.Animation");S&&b.animations.push(S.Parse(J))}b.beginAnimationOnStart=t.beginAnimationOnStart,b.beginAnimationFrom=t.beginAnimationFrom,b.beginAnimationTo=t.beginAnimationTo,b.beginAnimationLoop=t.beginAnimationLoop}if(t.autoAnimate&&P&&P.beginAnimation(b,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),b.startDelay=0|t.startDelay,b.minAngularSpeed=t.minAngularSpeed,b.maxAngularSpeed=t.maxAngularSpeed,b.minSize=t.minSize,b.maxSize=t.maxSize,t.minScaleX&&(b.minScaleX=t.minScaleX,b.maxScaleX=t.maxScaleX,b.minScaleY=t.minScaleY,b.maxScaleY=t.maxScaleY),void 0!==t.preWarmCycles&&(b.preWarmCycles=t.preWarmCycles,b.preWarmStepOffset=t.preWarmStepOffset),void 0!==t.minInitialRotation&&(b.minInitialRotation=t.minInitialRotation,b.maxInitialRotation=t.maxInitialRotation),b.minLifeTime=t.minLifeTime,b.maxLifeTime=t.maxLifeTime,b.minEmitPower=t.minEmitPower,b.maxEmitPower=t.maxEmitPower,b.emitRate=t.emitRate,b.gravity=J.JZ.CZ(t.gravity),t.noiseStrength&&(b.noiseStrength=J.JZ.CZ(t.noiseStrength)),b.color1=v.Fb.CZ(t.color1),b.color2=v.Fb.CZ(t.color2),b.colorDead=v.Fb.CZ(t.colorDead),b.updateSpeed=t.updateSpeed,b.targetStopDuration=t.targetStopDuration,b.blendMode=t.blendMode,t.colorGradients)for(const J of t.colorGradients)b.addColorGradient(J.gradient,v.Fb.CZ(J.color1),J.color2?v.Fb.CZ(J.color2):void 0);if(t.rampGradients){for(const Z of t.rampGradients)b.addRampGradient(Z.gradient,v.hZ.CZ(Z.color));b.useRampGradients=t.useRampGradients}if(t.colorRemapGradients)for(const J of t.colorRemapGradients)b.addColorRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.alphaRemapGradients)for(const J of t.alphaRemapGradients)b.addAlphaRemapGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.sizeGradients)for(const J of t.sizeGradients)b.addSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.angularSpeedGradients)for(const J of t.angularSpeedGradients)b.addAngularSpeedGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.velocityGradients)for(const J of t.velocityGradients)b.addVelocityGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.dragGradients)for(const J of t.dragGradients)b.addDragGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.emitRateGradients)for(const J of t.emitRateGradients)b.addEmitRateGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.startSizeGradients)for(const J of t.startSizeGradients)b.addStartSizeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.lifeTimeGradients)for(const J of t.lifeTimeGradients)b.addLifeTimeGradient(J.gradient,void 0!==J.factor1?J.factor1:J.factor,J.factor2);if(t.limitVelocityGradients){for(const Z of t.limitVelocityGradients)b.addLimitVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);b.limitVelocityDamping=t.limitVelocityDamping}if(t.noiseTexture&&P){const Z=(0,h.d)("BABYLON.ProceduralTexture");b.noiseTexture=Z.Parse(t.noiseTexture,P,S)}let Y;if(t.particleEmitterType){switch(t.particleEmitterType.type){case"SphereParticleEmitter":Y=new l;break;case"SphereDirectedParticleEmitter":Y=new U;break;case"ConeEmitter":case"ConeParticleEmitter":Y=new r;break;case"ConeDirectedParticleEmitter":Y=new M;break;case"CylinderParticleEmitter":Y=new T;break;case"CylinderDirectedParticleEmitter":Y=new a;break;case"HemisphericParticleEmitter":Y=new k;break;case"PointParticleEmitter":Y=new u;break;case"MeshParticleEmitter":Y=new H;break;case"CustomParticleEmitter":Y=new E;break;default:Y=new I}Y.parse(t.particleEmitterType,P)}else Y=new I,Y.parse(t,P);b.particleEmitterType=Y,b.startSpriteCellID=t.startSpriteCellID,b.endSpriteCellID=t.endSpriteCellID,b.spriteCellLoop=t.spriteCellLoop??!0,b.spriteCellWidth=t.spriteCellWidth,b.spriteCellHeight=t.spriteCellHeight,b.spriteCellChangeSpeed=t.spriteCellChangeSpeed,b.spriteRandomStartCell=t.spriteRandomStartCell,b.disposeOnStop=t.disposeOnStop??!1,b.manualEmitCount=t.manualEmitCount??-1}static Parse(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],P=arguments.length>4?arguments[4]:void 0;const h=t.name;let C,Y,g=null,I=null;if(b instanceof Dt.e?C=b:(Y=b,C=Y.getEngine()),t.customShader&&C.createEffectForParticles){I=t.customShader;const b=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"";g=C.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,b)}const r=new hb(h,P||t.gZ,b,g,t.isAnimationSheetEnabled);if(r.customShader=I,r._rootUrl=Z,t.id&&(r.id=t.id),t.subEmitters){r.subEmitters=[];for(const J of t.subEmitters){const t=[];for(const S of J)t.push(zt.Parse(S,b,Z));r.subEmitters.push(t)}}if(t.attractors)for(const v of t.attractors){const t=new vb;t.position=J.JZ.CZ(v.position),t.strength=v.strength,r.addAttractor(t)}return hb._Parse(t,r,b,Z),t.textureMask&&(r.textureMask=v.Fb.CZ(t.textureMask)),t.BY&&(r.BY=J.JZ.CZ(t.BY)),t.preventAutoStart&&(r.preventAutoStart=t.preventAutoStart),S||r.preventAutoStart||r.start(),r}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(hb._Serialize(b,this,t),b.textureMask=this.textureMask.jb(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.BY=this.BY.jb(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Z of this._subEmitters){const J=[];for(const b of Z)J.push(b.serialize(t));b.subEmitters.push(J)}}if(this._attractors&&this._attractors.length){b.attractors=[];for(const t of this._attractors)b.attractors.push(t.serialize())}return b}static _Serialize(t,b,Z){if(t.name=b.name,t.id=b.id,t.gZ=b.getCapacity(),t.disposeOnStop=b.disposeOnStop,t.manualEmitCount=b.manualEmitCount,b.hb.position){const Z=b.hb;t.emitterId=Z.id}else{const Z=b.hb;t.hb=Z.jb()}b.particleEmitterType&&(t.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(Z?t.texture=b.particleTexture.serialize():(t.textureName=b.particleTexture.name,t.invertY=!!b.particleTexture._invertY)),t.isLocal=b.isLocal,d.d.AppendSerializedAnimations(b,t),t.beginAnimationOnStart=b.beginAnimationOnStart,t.beginAnimationFrom=b.beginAnimationFrom,t.beginAnimationTo=b.beginAnimationTo,t.beginAnimationLoop=b.beginAnimationLoop,t.startDelay=b.startDelay,t.renderingGroupId=b.renderingGroupId,t.isBillboardBased=b.isBillboardBased,t.billboardMode=b.billboardMode,t.minAngularSpeed=b.minAngularSpeed,t.maxAngularSpeed=b.maxAngularSpeed,t.minSize=b.minSize,t.maxSize=b.maxSize,t.minScaleX=b.minScaleX,t.maxScaleX=b.maxScaleX,t.minScaleY=b.minScaleY,t.maxScaleY=b.maxScaleY,t.minEmitPower=b.minEmitPower,t.maxEmitPower=b.maxEmitPower,t.minLifeTime=b.minLifeTime,t.maxLifeTime=b.maxLifeTime,t.emitRate=b.emitRate,t.gravity=b.gravity.jb(),t.noiseStrength=b.noiseStrength.jb(),t.color1=b.color1.jb(),t.color2=b.color2.jb(),t.colorDead=b.colorDead.jb(),t.updateSpeed=b.updateSpeed,t.targetStopDuration=b.targetStopDuration,t.blendMode=b.blendMode,t.preWarmCycles=b.preWarmCycles,t.preWarmStepOffset=b.preWarmStepOffset,t.minInitialRotation=b.minInitialRotation,t.maxInitialRotation=b.maxInitialRotation,t.startSpriteCellID=b.startSpriteCellID,t.spriteCellLoop=b.spriteCellLoop,t.endSpriteCellID=b.endSpriteCellID,t.spriteCellChangeSpeed=b.spriteCellChangeSpeed,t.spriteCellWidth=b.spriteCellWidth,t.spriteCellHeight=b.spriteCellHeight,t.spriteRandomStartCell=b.spriteRandomStartCell,t.isAnimationSheetEnabled=b.isAnimationSheetEnabled,t.useLogarithmicDepth=b.useLogarithmicDepth;const J=b.getColorGradients();if(J){t.colorGradients=[];for(const b of J){const Z={gradient:b.gradient,color1:b.color1.jb()};b.color2?Z.color2=b.color2.jb():Z.color2=b.color1.jb(),t.colorGradients.push(Z)}}const S=b.getRampGradients();if(S){t.rampGradients=[];for(const b of S){const Z={gradient:b.gradient,color:b.color.jb()};t.rampGradients.push(Z)}t.useRampGradients=b.useRampGradients}const P=b.getColorRemapGradients();if(P){t.colorRemapGradients=[];for(const b of P){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.colorRemapGradients.push(Z)}}const v=b.getAlphaRemapGradients();if(v){t.alphaRemapGradients=[];for(const b of v){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.alphaRemapGradients.push(Z)}}const h=b.getSizeGradients();if(h){t.sizeGradients=[];for(const b of h){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.sizeGradients.push(Z)}}const C=b.getAngularSpeedGradients();if(C){t.angularSpeedGradients=[];for(const b of C){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.angularSpeedGradients.push(Z)}}const Y=b.getVelocityGradients();if(Y){t.velocityGradients=[];for(const b of Y){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.velocityGradients.push(Z)}}const g=b.getDragGradients();if(g){t.dragGradients=[];for(const b of g){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.dragGradients.push(Z)}}const I=b.getEmitRateGradients();if(I){t.emitRateGradients=[];for(const b of I){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.emitRateGradients.push(Z)}}const r=b.getStartSizeGradients();if(r){t.startSizeGradients=[];for(const b of r){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.startSizeGradients.push(Z)}}const M=b.getLifeTimeGradients();if(M){t.lifeTimeGradients=[];for(const b of M){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.lifeTimeGradients.push(Z)}}const T=b.getLimitVelocityGradients();if(T){t.limitVelocityGradients=[];for(const b of T){const Z={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Z.factor2=b.factor2:Z.factor2=b.factor1,t.limitVelocityGradients.push(Z)}t.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(t.noiseTexture=b.noiseTexture.serialize())}clone(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let S=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){S=this.customShader;const t=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"",b=P.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,t);J[0]?J[0].effect=b:this.setCustomEffect(b,0)}const v=this.serialize(Z),h=hb.Parse(v,this._scene||this._engine,this._rootUrl);return h.name=t,h.customShader=S,h._customWrappers=J,void 0===b&&(b=this.hb),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.hb=b,this.preventAutoStart||h.start(),h}}hb.BILLBOARDMODE_Y=2,hb.BILLBOARDMODE_ALL=7,hb.BILLBOARDMODE_STRETCHED=8,hb.BILLBOARDMODE_STRETCHED_LOCAL=9,zt._ParseParticleSystem=hb.Parse;var Cb=Z(12978),Yb=Z(12975),gb=Z(12860);gb.b.prototype.createTransformFeedback=function(){const t=this._gl.createTransformFeedback();if(!t)throw new Error("Unable to create Transform Feedback");return t},gb.b.prototype.deleteTransformFeedback=function(t){this._gl.deleteTransformFeedback(t)},gb.b.prototype.bindTransformFeedback=function(t){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,t)},gb.b.prototype.beginTransformFeedback=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(t?this._gl.POINTS:this._gl.TRIANGLES)},gb.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},gb.b.prototype.setTranformFeedbackVaryings=function(t,b){this._gl.transformFeedbackVaryings(t,b,this._gl.INTERLEAVED_ATTRIBS)},gb.b.prototype.bindTransformFeedbackBuffer=function(t){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t?t.underlyingResource:null)},gb.b.prototype.readTransformFeedbackBuffer=function(t){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,t)};const Ib="clipPlaneFragmentDeclaration2",rb="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";O.e.IncludesShadersStore[Ib]||(O.e.IncludesShadersStore[Ib]=rb);Z(13986),Z(13993),Z(13996),Z(14003),Z(14012),Z(14021),Z(14027),Z(14035);const Mb="gpuRenderParticlesPixelShader",Tb="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";O.e.ShadersStore[Mb]||(O.e.ShadersStore[Mb]=Tb);const ab="clipPlaneVertexDeclaration2",kb="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";O.e.IncludesShadersStore[ab]||(O.e.IncludesShadersStore[ab]=kb);Z(14042),Z(14051),Z(14055),Z(14059);const ub="gpuRenderParticlesVertexShader",lb="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";O.e.ShadersStore[ub]||(O.e.ShadersStore[ub]=lb);class Ub extends C{static get IsSupported(){if(!w.e.LastCreatedEngine)return!1;const t=w.e.LastCreatedEngine.getCaps();return t.supportTransformFeedbacks||t.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(t){this._maxActiveParticleCount=Math.min(t,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(t){this.maxActiveParticleCount=t}createPointEmitter(t,b){const Z=ft(t,b);return this.particleEmitterType=Z,Z}createHemisphericEmitter(){const t=mb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createSphereEmitter(){const t=Rt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=t,t}createDirectedSphereEmitter(){const t=wt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new J.JZ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createCylinderEmitter(){const t=Gt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=t,t}createDirectedCylinderEmitter(){const t=tb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createConeEmitter(){const t=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=t,t}createDirectedConeEmitter(){const t=Zb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new J.JZ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new J.JZ(0,1,0));return this.particleEmitterType=t,t}createBoxEmitter(t,b,Z,J){const S=new I;return this.particleEmitterType=S,this.direction1=t,this.direction2=b,this.minEmitBox=Z,this.maxEmitBox=J,S}get flowMap(){return this._flowMap}set flowMap(t){this._flowMap!==t&&(this._flowMap=t)}isReady(){if(!this.hb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==hb.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hb.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hb.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";t?setTimeout((()=>{this.start(0)}),t):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var t;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(t=this._customWrappers[b])||void 0===t?void 0:t.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[t]??this._customWrappers[0]}setCustomEffect(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new tt.e(this._engine),this._customWrappers[b].effect=t}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new mt.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(t,b,Z){return super._removeGradientAndTexture(t,b,Z),this._releaseBuffers(),this}addColorGradient(t,b){this._colorGradients||(this._colorGradients=[]);const Z=new i(t,b);return this._colorGradients.push(Z),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(t&&this._colorGradients.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(t){return this._removeGradientAndTexture(t,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var t;null===(t=this._drawWrappers[b].drawContext)||void 0===t||t.reset()}}_addFactorGradient(t,b,Z){const J=new D(b,Z);t.push(J),this._releaseBuffers()}addSizeGradient(t,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,t,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(t){return this._removeGradientAndTexture(t,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(t,b){if(!t)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&t.sort(((t,b)=>t.gradient<b.gradient?-1:t.gradient>b.gradient?1:0));const Z=this;Z[b]&&(Z[b].dispose(),Z[b]=null)}addAngularSpeedGradient(t,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,t,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(t){return this._removeGradientAndTexture(t,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(t,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,t,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(t){return this._removeGradientAndTexture(t,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(t,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,t,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(t){return this._removeGradientAndTexture(t,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(t,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,t,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(t){return this._removeGradientAndTexture(t,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(t){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(t),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.lb=new mt.d,this.onStoppedObservable=new mt.d,this.onStartedObservable=new mt.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Z&&"Scene"!==Z.getClassName()?(this._engine=Z,this.defaultProjectionMatrix=J.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Z||w.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Lr.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,h.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,h.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new tt.e(this._engine)},this._customWrappers[0].effect=S,this._drawWrappers={0:new tt.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const v={gZ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},C=b;isFinite(C)&&(v.gZ=C),this._capacity=v.gZ,this._maxActiveParticleCount=v.gZ,this._currentActiveCount=0,this._isAnimationSheetEnabled=P,this.particleEmitterType=new I;const Y=Math.min(this._engine.getCaps().maxTextureSize,v.randomTextureSize);let g=[];for(let J=0;J<Y;++J)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture=new R.c(new Float32Array(g),Y,1,5,Z,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,g=[];for(let J=0;J<Y;++J)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture2=new R.c(new Float32Array(g),Y,1,5,Z,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Y}_reset(){this._releaseBuffers()}_createVertexBuffers(t,b,Z){const J={};J.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let S=3;J.age=b.createVertexBuffer("age",S,1,this._attributesStrideSize,!0),S+=1,J.size=b.createVertexBuffer("size",S,3,this._attributesStrideSize,!0),S+=3,J.life=b.createVertexBuffer("life",S,1,this._attributesStrideSize,!0),S+=1,S+=4,this.billboardMode===hb.BILLBOARDMODE_STRETCHED&&(J.direction=b.createVertexBuffer("direction",S,3,this._attributesStrideSize,!0)),S+=3,this._platform.alignDataInBuffer&&(S+=1),this.particleEmitterType instanceof E&&(S+=3,this._platform.alignDataInBuffer&&(S+=1)),this._colorGradientsTexture||(J.color=b.createVertexBuffer("color",S,4,this._attributesStrideSize,!0),S+=4),this._isBillboardBased||(J.initialDirection=b.createVertexBuffer("initialDirection",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),this.noiseTexture&&(J.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1),J.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",S,3,this._attributesStrideSize,!0),S+=3,this._platform.alignDataInBuffer&&(S+=1)),J.angle=b.createVertexBuffer("angle",S,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?S++:S+=2,this._isAnimationSheetEnabled&&(J.cellIndex=b.createVertexBuffer("cellIndex",S,1,this._attributesStrideSize,!0),S+=1,this.spriteRandomStartCell&&(J.cellStartOffset=b.createVertexBuffer("cellStartOffset",S,1,this._attributesStrideSize,!0),S+=1)),J.offset=Z.createVertexBuffer("offset",0,2),J.uv=Z.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(J),this._platform.createVertexBuffers(t,J),this.resetDrawCache()}_initialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!t)return;const b=this._engine,Z=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof E&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const S=this.particleEmitterType instanceof E,P=J.TmpVectors.JZ[0];let v=0;for(let J=0;J<this._capacity;J++)if(Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),S?(this.particleEmitterType.particleDestinationGenerator(J,null,P),Z.push(P.x),Z.push(P.y),Z.push(P.z)):(Z.push(0),Z.push(0),Z.push(0)),this._platform.alignDataInBuffer&&Z.push(0),v+=16,S&&(this.particleEmitterType.particlePositionGenerator(J,null,P),Z.push(P.x),Z.push(P.y),Z.push(P.z),this._platform.alignDataInBuffer&&Z.push(0),v+=4),this._colorGradientsTexture||(Z.push(0),Z.push(0),Z.push(0),Z.push(0),v+=4),this.isBillboardBased||(Z.push(0),Z.push(0),Z.push(0),this._platform.alignDataInBuffer&&Z.push(0),v+=4),this.noiseTexture&&(Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),Z.push(Math.random()),Z.push(Math.random()),Z.push(Math.random()),this._platform.alignDataInBuffer&&Z.push(0),v+=8),Z.push(0),v+=1,this._angularSpeedGradientsTexture||(Z.push(0),v+=1),this._isAnimationSheetEnabled&&(Z.push(0),v+=1,this.spriteRandomStartCell&&(Z.push(0),v+=1)),this._platform.alignDataInBuffer){let t=3-(v+3&3);for(v+=t;t-- >0;)Z.push(0)}const h=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(Z),Y=this._platform.createParticleBuffer(Z);this._buffer0=new c.d(b,C,!1,this._attributesStrideSize),this._buffer1=new c.d(b,Y,!1,this._attributesStrideSize),this._spriteBuffer=new c.d(b,h,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let t=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(t+="\n#define BILLBOARD"),this._colorGradientsTexture&&(t+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(t+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(t+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(t+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(t+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(t+="\n#define DRAGGRADIENTS"),this._flowMap&&(t+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(t+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(t+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(t+="\n#define NOISE"),this.isLocal&&(t+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===t||(this._cachedUpdateDefines=t,this._updateBuffer=this._platform.createUpdateBuffer(t)),this._platform.isUpdateBufferReady()}_getWrapper(t){const b=this._getCustomDrawWrapper(t);if(null!==b&&void 0!==b&&b.effect)return b;const Z=[];this.fillDefines(Z,t);let J=this._drawWrappers[t];J||(J=new tt.e(this._engine),J.drawContext&&(J.drawContext.useInstancing=!0),this._drawWrappers[t]=J);const S=Z.join("\n");if(J.defines!==S){const t=[],b=[],Z=[];this.fillUniformsAttributesAndSamplerNames(b,t,Z),J.setEffect(this._engine.createEffect("gpuRenderParticles",t,b,Z,S),S)}return J}static _GetAttributeNamesOrOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=[c.g.PositionKind,"age","life","size","angle"];return t||S.push(c.g.ColorKind),b&&S.push("cellIndex"),Z||S.push("initialDirection"),J&&S.push("direction"),S.push("offset",c.g.UVKind),S}static _GetEffectCreationOptions(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=["emitterWM","BY","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bt.c)(J),t&&J.push("sheetInfos"),b&&J.push("logarithmicDepthConstant"),Z&&(J.push("vFogInfos"),J.push("vFogColor")),J}fillDefines(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bt.k)(this,this._scene,t),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Yb.d.FOGMODE_NONE&&t.push("#define FOG")),b===hb.BLENDMODE_MULTIPLY&&t.push("#define BLENDMULTIPLYMODE"),this.isLocal&&t.push("#define LOCAL"),this.useLogarithmicDepth&&t.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(t.push("#define BILLBOARD"),this.billboardMode){case hb.BILLBOARDMODE_Y:t.push("#define BILLBOARDY");break;case hb.BILLBOARDMODE_STRETCHED:t.push("#define BILLBOARDSTRETCHED");break;case hb.BILLBOARDMODE_ALL:t.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&t.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&t.push("#define ANIMATESHEET"),Z&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),t.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(t,b,Z){b.push(...Ub._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hb.BILLBOARDMODE_STRETCHED)),t.push(...Ub._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Z.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Cb.b.PrepareUniforms(t,this._imageProcessingConfigurationDefines),Cb.b.PrepareSamplers(Z,this._imageProcessingConfigurationDefines))}animate(){var t;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(t=this._scene)||void 0===t?void 0:t.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(t,b){const Z=this[b];if(!t||!t.length||Z)return;const J=new Float32Array(this._rawTextureWidth);for(let S=0;S<this._rawTextureWidth;S++){const b=S/this._rawTextureWidth;f.GetCurrentGradient(b,t,((t,b,Z)=>{J[S]=(0,Y.Lerp)(t.factor1,b.factor1,Z)}))}this[b]=R.c.CreateRTexture(J,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const t=new Uint8Array(4*this._rawTextureWidth),b=v.TmpColors.Fb[0];for(let Z=0;Z<this._rawTextureWidth;Z++){const J=Z/this._rawTextureWidth;f.GetCurrentGradient(J,this._colorGradients,((J,S,P)=>{v.Fb.LerpToRef(J.color1,S.color1,P,b),t[4*Z]=255*b.r,t[4*Z+1]=255*b.g,t[4*Z+2]=255*b.b,t[4*Z+3]=255*b.a}))}this._colorGradientsTexture=R.c.CreateRGBATexture(t,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(t,b){var Z,S,P,v;const h=this._getWrapper(t),C=h.effect;this._engine.enableEffect(h);const Y=(null===(Z=this._scene)||void 0===Z?void 0:Z.getViewMatrix())||J.Matrix.IdentityReadOnly;if(C.setMatrix("view",Y),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("BY",this.BY),this.isLocal&&C.setMatrix("emitterWM",b),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const t=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/t.width,this.spriteCellHeight/t.height,t.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const t=this._scene.activeCamera;C.setVector3("eyePosition",t.globalPosition)}const g=C.defines;if(this._scene&&((0,bt.f)(C,this,this._scene),this.applyFog&&(0,Zt.g)(this._scene,void 0,C)),g.indexOf("#define BILLBOARDMODE_ALL")>=0){const t=Y.clone();t.invert(),C.setMatrix("invView",t)}return this.useLogarithmicDepth&&this._scene&&(0,Zt.m)(g,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(t),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(v=this._scene)&&void 0!==v&&v.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(t){if(!this.hb||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!t)if(this.hb.position){t=this.hb.getWorldMatrix()}else{const b=this.hb;t=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(b.x,b.y,b.z,t)}const b=this._engine,Z=b.getDepthWrite();if(b.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const t=this.et();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",t.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",t),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const S=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=S,b.setDepthWrite(Z)}render(){let t,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const t=0|this._accumulatedCount;this._accumulatedCount-=t,this._currentActiveCount+=t}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.hb.position){t=this.hb.getWorldMatrix()}else{const b=this.hb;t=J.TmpVectors.Matrix[0],J.Matrix.TranslationToRef(b.x,b.y,b.z,t)}const S=this._engine;this.updateInAnimate||this._update(t);let P=0;return b||Z||(S.setState(!1),this.forceDepthWrite&&S.setDepthWrite(!0),P=this.blendMode===hb.BLENDMODE_MULTIPLYADD?this._render(hb.BLENDMODE_MULTIPLY,t)+this._render(hb.BLENDMODE_ADD,t):this._render(this.blendMode,t),this._engine.setAlphaMode(0)),P}rebuild(){const t=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(t,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,t()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const t=this._scene.Lr.indexOf(this);t>-1&&this._scene.Lr.splice(t,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const t=this._renderVertexBuffers[b];for(const b in t)t[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),t&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),t&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.lb.notifyObservers(this),this.lb.clear()}clone(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J={...this._customWrappers};let S=null;const P=this._engine;if(P.createEffectForParticles&&null!=this.customShader){S=this.customShader;const t=S.shaderOptions.defines.length>0?S.shaderOptions.defines.join("\n"):"";J[0]=P.createEffectForParticles(S.shaderPath.fragmentElement,S.shaderOptions.uniforms,S.shaderOptions.samplers,t,void 0,void 0,void 0,this)}const v=this.serialize(Z),h=Ub.Parse(v,this._scene||this._engine,this._rootUrl);return h.name=t,h.customShader=S,h._customWrappers=J,void 0===b&&(b=this.hb),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.hb=b,h}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return hb._Serialize(b,this,t),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0;const P=t.name;let v,h;b instanceof Dt.e?v=b:(h=b,v=h.getEngine());const C=new Ub(P,{gZ:S||t.gZ,randomTextureSize:t.randomTextureSize},b,null,t.isAnimationSheetEnabled);if(C._rootUrl=Z,t.customShader&&v.createEffectForParticles){const b=t.customShader,Z=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",J=v.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,Z,void 0,void 0,void 0,C);C.setCustomEffect(J,0),C.customShader=b}return t.id&&(C.id=t.id),t.activeParticleCount&&(C.activeParticleCount=t.activeParticleCount),hb._Parse(t,C,b,Z),t.preventAutoStart&&(C.preventAutoStart=t.preventAutoStart),J||C.preventAutoStart||C.start(),C}}var Eb=Z(12549),cb=Z(14064),Hb=Z(13113);class ob{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(t){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.hb=t;this._emitterNode=t}setEmitterAsSphere(t,b,Z){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:t,renderingGroupId:b};const J=(0,cb.d)("emitterSphere",{diameter:t.diameter,segments:t.segments},Z);J.renderingGroupId=b;const S=new Hb.vZ("emitterSphereMaterial",Z);S.emissiveColor=t.color,J.material=S;for(const P of this.systems)P.hb=J;this._emitterNode=J}start(t){for(const b of this.systems)t&&(b.hb=t),b.start()}dispose(){for(const t of this.systems)t.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const Z of this.systems)b.systems.push(Z.serialize(t));return this._emitterNode&&(b.hb=this._emitterCreationOptions),b}static Parse(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;const S=new ob,P=this.BaseAssetsUrl+"/textures/";b=b||w.e.LastCreatedScene;for(const v of t.systems)S.systems.push(Z?Ub.Parse(v,b,P,!0,J):hb.Parse(v,b,P,!0,J));if(t.hb){const Z=t.hb.options;if("Sphere"===t.hb.kind)S.setEmitterAsSphere({diameter:Z.diameter,segments:Z.segments,color:v.hZ.CZ(Z.color)},t.hb.renderingGroupId,b)}return S}}ob.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ob=Z(12577);class pb{static CreateDefault(t){let b,Z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,J=arguments.length>2?arguments[2]:void 0;b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ub("default system",{gZ:Z},J):new hb("default system",Z,J),b.hb=t;const S=Eb.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return b.particleTexture=new s.c(S,b.et()),b.createConeEmitter(.1,Math.PI/4),b.color1=new v.Fb(1,1,1,1),b.color2=new v.Fb(1,1,1,1),b.colorDead=new v.Fb(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;b||(b=w.e.LastCreatedScene);const S={};return b.addPendingData(S),new Promise(((P,v)=>{if(Z&&!Ub.IsSupported)return b.removePendingData(S),v("Particle system with GPU is not supported.");Eb.Tools.LoadFile(`${pb.BaseAssetsUrl}/systems/${t}.json`,(t=>{b.removePendingData(S);const v=JSON.parse(t.toString());return P(ob.Parse(v,b,Z,J))}),void 0,void 0,void 0,(()=>(b.removePendingData(S),v(`An error occurred with the creation of your particle system. Check if your type '${t}' exists.`))))}))}static ExportSet(t){const b=new ob;for(const Z of t)b.systems.push(Z);return b}static ParseFromFileAsync(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",P=arguments.length>5?arguments[5]:void 0;return new Promise(((v,h)=>{const C=new Ob.b;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const b=JSON.parse(C.responseText);let h;h=J?Ub.Parse(b,Z,S,!1,P):hb.Parse(b,Z,S,!1,P),t&&(h.name=t),v(h)}else h("Unable to load the particle system")})),C.open("GET",b),C.send()}))}static ParseFromSnippetAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",S=arguments.length>4?arguments[4]:void 0;if("_BLANK"===t){const t=this.CreateDefault(null);return t.start(),Promise.resolve(t)}return new Promise(((P,v)=>{const h=new Ob.b;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const v=JSON.parse(JSON.parse(h.responseText).jsonPayload),C=JSON.parse(v.particleSystem);let Y;Y=Z?Ub.Parse(C,b,J,!1,S):hb.Parse(C,b,J,!1,S),Y.snippetId=t,P(Y)}else v("Unable to load the snippet "+t)})),h.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),h.send()}))}}pb.BaseAssetsUrl=ob.BaseAssetsUrl,pb.SnippetUrl="https://snippet.babylonjs.com",pb.CreateFromSnippetAsync=pb.ParseFromSnippetAsync;var eb=Z(13184),Wb=Z(13009),jb=Z(14070);(0,jb.h)(Wb.d.NAME_PARTICLESYSTEM,((t,b,Z,J)=>{const S=(0,jb.i)(Wb.d.NAME_PARTICLESYSTEM);if(S&&void 0!==t.Lr&&null!==t.Lr)for(let P=0,v=t.Lr.length;P<v;P++){const v=t.Lr[P];Z.Lr.push(S(v,b,J))}})),(0,jb.d)(Wb.d.NAME_PARTICLESYSTEM,((t,b,Z)=>{if(t.activeParticleCount){return Ub.Parse(t,b,Z)}return hb.Parse(t,b,Z)})),Dt.e.prototype.createEffectForParticles=function(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",P=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>9?arguments[9]:void 0,I=[],r=[];const M=[];return C?C.fillUniformsAttributesAndSamplerNames(r,I,M):(I=hb._GetAttributeNamesOrOptions(),r=hb._GetEffectCreationOptions()),-1===S.indexOf(" BILLBOARD")&&(S+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===S.indexOf(" ANIMATESHEET")&&(S+="\n#define ANIMATESHEET\n"),-1===J.indexOf("diffuseSampler")&&J.push("diffuseSampler"),this.createEffect({vertex:g??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:t},I,r.concat(b),M.concat(J),S,P,v,h,void 0,Y,(async()=>{0===Y?await Promise.resolve().then(Z.bind(Z,14105)):await Promise.resolve().then(Z.bind(Z,14167))}))},eb.b.prototype.getEmittedParticleSystems=function(){const t=[];for(let b=0;b<this.et().Lr.length;b++){const Z=this.et().Lr[b];Z.hb===this&&t.push(Z)}return t},eb.b.prototype.getHierarchyEmittedParticleSystems=function(){const t=[],b=this.getDescendants();b.push(this);for(let Z=0;Z<this.et().Lr.length;Z++){const J=this.et().Lr[Z],S=J.hb;S.position&&-1!==b.indexOf(S)&&t.push(J)}return t};Z(13079),Z(13087),Z(13159);Z(13162),Z(14077),Z(12936),Z(13061),Z(13200);Z(12928);var Vb;Z(14083),Z(12748);!function(t){t[t.Color=2]="Color",t[t.UV=1]="UV",t[t.Random=0]="Random",t[t.Stated=3]="Stated"}(Vb||(Vb={}));var nb=Z(12964);const yb=new J.JZ(0,0,0),db=new J.JZ(0,0,0),sb=new J.JZ(0,0,0);class qb{constructor(t,b,Z){this.width=t,this.height=b,this.data=Z}processFlowable(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;if(!Z)return;Z instanceof J.Matrix?J.JZ.TransformCoordinatesToRef(t.position,Z,sb):(sb.x=Z.x,sb.y=Z.y,sb.z=Z.z);const S=.5*sb.x+.5,P=1-(.5*sb.y+.5),v=Math.floor(S*this.width),h=Math.floor(P*this.height);if(v<0||v>=this.width||h<0||h>=this.height)return;const C=4*(h*this.width+v),Y=this.data[C]/255*2-1,g=this.data[C+1]/255*2-1,I=this.data[C+2]/255*2-1,r=this.data[C+3]/255;yb.set(Y,g,I),yb.scaleToRef(b*r,db),t.direction.addInPlace(db)}_processParticle(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Z=arguments.length>2?arguments[2]:void 0;this.processFlowable(t,b,Z)}static async FromUrlAsync(t){return await new Promise(((b,Z)=>{const J=document.createElement("canvas"),S=J.getContext("2d");let P=null;const v=new Image;v.crossOrigin="anonymous",v.src=t,v.onerror=b=>{Z(new Error(`Failed to load image: ${t} : ${b}`))},v.onload=()=>{J.width=v.width,J.height=v.height,S.drawImage(v,0,0),P=S.getImageData(0,0,J.width,J.height),b(new qb(J.width,J.height,P.data))}}))}static async ExtractFromTextureAsync(t){return await new Promise(((b,Z)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{const Z=await this.ExtractFromTextureAsync(t);b(Z)}catch(J){Z(J)}}));const J=t.getSize();nb.j.GetTextureDataAsync(t,J.width,J.height).then((t=>{b(new qb(J.width,J.height,new Uint8ClampedArray(t)))})).catch(Z)}))}}var Qb,Nb,Ab,Kb,Lb,Fb,Bb,Xb,xb;!function(t){t[t.Int=1]="Int",t[t.Float=2]="Float",t[t.Vector2=4]="Vector2",t[t.JZ=8]="JZ",t[t.Matrix=16]="Matrix",t[t.Particle=32]="Particle",t[t.Texture=64]="Texture",t[t.Fb=128]="Fb",t[t.FloatGradient=256]="FloatGradient",t[t.Vector2Gradient=512]="Vector2Gradient",t[t.Vector3Gradient=1024]="Vector3Gradient",t[t.Color4Gradient=2048]="Color4Gradient",t[t.System=4096]="System",t[t.AutoDetect=8192]="AutoDetect",t[t.BasedOnInput=16384]="BasedOnInput",t[t.Undefined=32768]="Undefined",t[t.All=65535]="All"}(Qb||(Qb={})),function(t){t[t.Compatible=0]="Compatible",t[t.TypeIncompatible=1]="TypeIncompatible",t[t.HierarchyIssue=2]="HierarchyIssue"}(Nb||(Nb={})),function(t){t[t.Input=0]="Input",t[t.Output=1]="Output"}(Ab||(Ab={}));class ib{get direction(){return this._direction}get type(){if(this._type===Qb.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Qb.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(t){this._type=t}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((t=>t.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(t,b,Z){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Qb.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new mt.d,this.onDisconnectionObservable=new mt.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=b,this.name=t,this._direction=Z}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(t){var b;return this.isConnected?null!==(b=this._connectedPoint)&&void 0!==b&&b._storedFunction?this._connectedPoint._storedFunction(t):this._connectedPoint._storedValue:this.value}canConnectTo(t){return 0===this.checkCompatibilityState(t)}checkCompatibilityState(t){const b=this._ownerBlock,Z=t.ownerBlock;if(this.type!==t.type&&t.innerType!==Qb.AutoDetect)return t.acceptedConnectionPointTypes&&-1!==t.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(t.excludedConnectionPointTypes&&-1!==t.excludedConnectionPointTypes.indexOf(this.type))return 1;let J=Z,S=b;return 0===this.direction&&(J=b,S=Z),J.isAnAncestorOf(S)?2:0}connectTo(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(t))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${t.ownerBlock.name}".${t.name}`;return this._endpoints.push(t),t._connectedPoint=this,this.onConnectionObservable.notifyObservers(t),t.onConnectionObservable.notifyObservers(this),this}disconnectFrom(t){const b=this._endpoints.indexOf(t);return-1===b||(this._endpoints.splice(b,1),t._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(t),t.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(t){let b=1;for(;b<Qb.All;)t&b||this.excludedConnectionPointTypes.push(b),b<<=1}serialize(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b={};return b.name=this.name,b.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.jb?(b.valueType="BABYLON."+this.value.getClassName(),b.value=this.value.jb()):(b.valueType="number",b.value=this.value)),t&&this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name,b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),b}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class zb{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(t){this._name=t}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(t){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new mt.d,this.lb=new mt.d,this.onInputChangedObservable=new mt.d,this.visibleOnFrame=!1,this._name=t,this.uniqueId=q.c.UniqueId}_inputRename(t){return t}_outputRename(t){return t}isAnAncestorOf(t){for(const b of this._outputs)if(b.hasEndpoints)for(const Z of b.endpoints){if(Z.ownerBlock===t)return!0;if(Z.ownerBlock.isAnAncestorOf(t))return!0}return!1}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const b of this._outputs)if(b.hasEndpoints)for(const Z of b.endpoints)if(Z.ownerBlock.isAnAncestorOfType(t))return!0;return!1}getInputByName(t){const b=this._inputs.filter((b=>b.name===t));return b.length?b[0]:null}_linkConnectionTypes(t,b){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[b]._acceptedConnectionPointType=this._inputs[t]:(this._inputs[t]._linkedConnectionSource=this._inputs[b],this._inputs[t]._isMainLinkSource=!0),this._inputs[b]._linkedConnectionSource=this._inputs[t]}registerInput(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,P=arguments.length>5?arguments[5]:void 0;const v=new ib(t,this,0);return v.type=b,v.isOptional=Z,v.defaultValue=J,v.value=J,v.valueMin=S,v.valueMax=P,this._inputs.push(v),this.onInputChangedObservable.notifyObservers(v),this}registerOutput(t,b,Z){return(Z=Z??new ib(t,this,1)).type=b,this._outputs.push(Z),this}_build(t){}_customBuildStep(t){}build(t){if(this._buildId===t.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((t=>t.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=t.buildId;for(const b of this._inputs){if(!b.connectedPoint){b.isOptional||t.notConnectedNonOptionalInputs.push(b);continue}const Z=b.connectedPoint.ownerBlock;Z&&Z!==this&&!Z.isSystem&&Z.build(t)}return this._customBuildStep(t),t.verbose&&Q.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(t),this.onBuildObservable.notifyObservers(this),!1}serialize(){const t={};t.customType="BABYLON."+this.getClassName(),t.id=this.uniqueId,t.name=this.name,t.visibleOnFrame=this.visibleOnFrame,t.inputs=[],t.outputs=[];for(const b of this.inputs)t.inputs.push(b.serialize());for(const b of this.outputs)t.outputs.push(b.serialize(!1));return t}_deserialize(t){this._name=t.name,this.comments=t.comments,this.visibleOnFrame=!!t.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(t)}_deserializePortDisplayNamesAndExposedOnFrame(t){const b=t.inputs,Z=t.outputs;if(b)for(const J of b){const t=this.inputs.find((t=>t.name===J.name));if(!t)return;if(J.displayName&&(t.displayName=J.displayName),J.isExposedOnFrame&&(t.isExposedOnFrame=J.isExposedOnFrame,t.exposedPortPosition=J.exposedPortPosition),void 0!==J.value&&null!==J.value)if("number"===J.valueType)t.value=J.value;else{const b=(0,h.d)(J.valueType);b&&(t.value=b.CZ(J.value))}}if(Z)for(let J=0;J<Z.length;J++){const t=Z[J];t.displayName&&(this.outputs[J].displayName=t.displayName),t.isExposedOnFrame&&(this.outputs[J].isExposedOnFrame=t.isExposedOnFrame,this.outputs[J].exposedPortPosition=t.exposedPortPosition)}}clone(){const t=this.serialize(),b=(0,h.d)(t.customType);if(b){const Z=new b;return Z._deserialize(t),Z}return null}dispose(){this.lb.notifyObservers(this),this.lb.clear();for(const t of this.inputs)t.dispose();for(const t of this.outputs)t.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Db(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",J=arguments.length>3?arguments[3]:void 0;return(S,P)=>{let v=S._propStore;v||(v=[],S._propStore=v),v.push({propertyName:P,displayName:t,type:b,groupName:Z,options:J??{},className:S.getClassName()})}}(0,n.e)([(0,y.N)("comment")],zb.prototype,"comments",void 0),function(t){t[t.Boolean=0]="Boolean",t[t.Float=1]="Float",t[t.Int=2]="Int",t[t.Vector2=3]="Vector2",t[t.List=4]="List",t[t.Fb=5]="Fb",t[t.SamplingMode=6]="SamplingMode",t[t.TextureFormat=7]="TextureFormat",t[t.TextureType=8]="TextureType"}(Kb||(Kb={})),function(t){t[t.None=0]="None",t[t.Position=1]="Position",t[t.Direction=2]="Direction",t[t.Age=3]="Age",t[t.Lifetime=4]="Lifetime",t[t.Color=5]="Color",t[t.ScaledDirection=6]="ScaledDirection",t[t.Scale=7]="Scale",t[t.AgeGradient=8]="AgeGradient",t[t.Angle=9]="Angle",t[t.SpriteCellIndex=16]="SpriteCellIndex",t[t.SpriteCellStart=17]="SpriteCellStart",t[t.SpriteCellEnd=18]="SpriteCellEnd"}(Lb||(Lb={})),function(t){t[t.None=0]="None",t[t.Time=1]="Time",t[t.Delta=2]="Delta",t[t.Emitter=3]="Emitter"}(Fb||(Fb={}));class fb{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let t="";for(const b of this.notConnectedNonOptionalInputs)t+=`input ${b.name} from block ${b.ownerBlock.name}[${b.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(t)throw"Build of Node Particle System Set failed:\n"+t}adapt(t,b){const Z=t.getConnectedValue(this)||0;if(t.type===b)return Z;switch(b){case Qb.Vector2:return new J.Vector2(Z,Z);case Qb.JZ:return new J.JZ(Z,Z,Z);case Qb.Fb:return new v.Fb(Z,Z,Z,Z)}return null}getContextualValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case Lb.Position:return this.particleContext.position;case Lb.Direction:return this.particleContext.direction;case Lb.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Lb.Color:return this.particleContext.color;case Lb.Age:return this.particleContext.age;case Lb.Lifetime:return this.particleContext.lifeTime;case Lb.Angle:return this.particleContext.angle;case Lb.Scale:return this.particleContext.scale;case Lb.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Lb.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Lb.SpriteCellIndex:return this.particleContext.cellIndex;case Lb.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.hb.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.hb.absolutePosition:this.systemContext.hb:null}getSystemValue(t){if(!this.particleContext||!this.systemContext)return null;switch(t){case Fb.Time:return this.systemContext._actualFrame;case Fb.Delta:return this.systemContext._scaledUpdateSpeed;case Fb.Emitter:if(this.isEmitterTransformNode){return this.systemContext.hb.absolutePosition}return this.systemContext.hb}return null}}function mZ(t,b,Z){const J=new fb;J.PZ=b;const S=t.createSystem(J);return S.canStart=()=>!0,S.hb=Z.clone(),S.disposeOnStop=!0,S.start(),S}class Rb extends zb{constructor(t){super(t),this.blendMode=C.BLENDMODE_ONEONE,this.gZ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Qb.Particle),this.registerInput("texture",Qb.Texture),this.registerInput("onStart",Qb.System,!0),this.registerInput("onEnd",Qb.System,!0),this.registerOutput("system",Qb.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(t){t.gZ=this.gZ,t.buildId=this._buildId++,this.build(t);const b=this.particle.getConnectedValue(t);return b.particleTexture=this.texture.getConnectedValue(t),b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.name=this.name,b._nodeGenerated=!0,b._targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,this.system._storedValue=this,b.canStart=()=>!this.doNoStart,b.onStartedObservable.add((Z=>{const J=this.onStart.getConnectedValue(t);J&&Z.onStartedObservable.addOnce((()=>{t.systemContext=b;const Z=mZ(J,t.PZ,t.emitterPosition);this.lb.addOnce((()=>{Z.dispose()}))}));const S=this.onEnd.getConnectedValue(t);S&&Z.onStoppedObservable.addOnce((()=>{t.systemContext=b;const Z=mZ(S,t.PZ,t.emitterPosition);this.lb.addOnce((()=>{Z.dispose()}))}))})),this.lb.addOnce((()=>{b.dispose()})),b}serialize(){const t=super.serialize();return t.gZ=this.gZ,t.emitRate=this.emitRate,t.blendMode=this.blendMode,t.doNoStart=this.doNoStart,t.targetStopDuration=this.targetStopDuration,t.startDelay=this.startDelay,t}_deserialize(t){super._deserialize(t),this.gZ=t.gZ,this.emitRate=t.emitRate,this.doNoStart=!!t.doNoStart,void 0!==t.blendMode&&(this.blendMode=t.blendMode),void 0!==t.targetStopDuration&&(this.targetStopDuration=t.targetStopDuration),void 0!==t.startDelay&&(this.startDelay=t.startDelay)}}(0,n.e)([Db("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],Rb.prototype,"blendMode",void 0),(0,n.e)([Db("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Rb.prototype,"gZ",void 0),(0,n.e)([Db("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rb.prototype,"emitRate",void 0),(0,n.e)([Db("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rb.prototype,"targetStopDuration",void 0),(0,n.e)([Db("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Rb.prototype,"startDelay",void 0),(0,n.e)([Db("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Rb.prototype,"doNoStart",void 0),(0,h.f)("BABYLON.SystemBlock",Rb);class wb extends zb{get type(){if(this._type===Qb.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Qb.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Qb.Vector2,this._type;case"JZ":return this._type=Qb.JZ,this._type;case"Fb":return this._type=Qb.Fb,this._type;case"Matrix":return this._type=Qb.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Lb.None&&this._systemSource!==Fb.None}get systemSource(){return this._systemSource}set systemSource(t){if(this._systemSource=t,t!==Fb.None){switch(this._contextualSource=Lb.None,this._type=Qb.Float,t){case Fb.Time:case Fb.Delta:this._type=Qb.Float;break;case Fb.Emitter:this._type=Qb.JZ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Lb.None}get contextualValue(){return this._contextualSource}set contextualValue(t){if(this._contextualSource=t,t!==Lb.None){switch(this._systemSource=Fb.None,t){case Lb.Scale:this._type=Qb.Vector2;break;case Lb.Position:case Lb.Direction:case Lb.ScaledDirection:this._type=Qb.JZ;break;case Lb.Color:this._type=Qb.Fb;break;case Lb.Age:case Lb.Lifetime:case Lb.Angle:case Lb.AgeGradient:this._type=Qb.Float;break;case Lb.SpriteCellEnd:case Lb.SpriteCellStart:case Lb.SpriteCellIndex:this._type=Qb.Int}this.output&&(this.output.type=this._type)}}constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qb.AutoDetect;super(t),this._type=Qb.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new mt.d,this._systemSource=Fb.None,this._contextualSource=Lb.None,this._type=b,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",b)}get value(){return this._storedValue}set value(t){this.type===Qb.Float&&this.min!==this.max&&(t=Math.max(this.min,t),t=Math.min(this.max,t)),this._storedValue=t,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(t){this._valueCallback=t}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Qb.Int:case Qb.Float:this.value=0;break;case Qb.Vector2:this.value=J.Vector2.Zero();break;case Qb.JZ:this.value=J.JZ.Zero();break;case Qb.Fb:this.value=new v.Fb(1,1,1,1);break;case Qb.Matrix:this.value=J.Matrix.Identity()}}_build(t){super._build(t),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=t=>t.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=t=>t.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const t=super.serialize();return t.type=this.type,t.contextualValue=this.contextualValue,t.systemSource=this.systemSource,t.min=this.min,t.max=this.max,t.groupInInspector=this.groupInInspector,t.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.jb?(t.valueType="BABYLON."+this._storedValue.getClassName(),t.value=this._storedValue.jb()):(t.valueType="number",t.value=this._storedValue)),t}_deserialize(t){if(super._deserialize(t),this._type=t.type,this.contextualValue=t.contextualValue,this.systemSource=t.systemSource||Fb.None,this.min=t.min||0,this.max=t.max||0,this.groupInInspector=t.groupInInspector||"",void 0!==t.displayInInspector&&(this.displayInInspector=t.displayInInspector),t.valueType)if("number"===t.valueType)this._storedValue=t.value;else{const b=(0,h.d)(t.valueType);b&&(this._storedValue=b.CZ(t.value))}}}(0,h.f)("BABYLON.ParticleInputBlock",wb);class Gb extends zb{get url(){return this._url}set url(t){this._url!==t&&(this._cachedData=null,this._url=t,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(t){this._textureDataUrl!==t&&(this._cachedData=null,this._textureDataUrl=t,this._url="",this._sourceTexture=null)}set sourceTexture(t){this._sourceTexture!==t&&(this._cachedData=null,this._sourceTexture=t,this._url="",this._textureDataUrl="")}constructor(t){super(t),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Qb.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const t=this.texture._storedValue;return await new Promise(((b,Z)=>{if(!t.isReady())return void t.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),b(this._cachedData)}catch(t){Z(t)}}));const J=t.getSize();nb.j.GetTextureDataAsync(t,J.width,J.height).then((Z=>{this._cachedData={width:J.width,height:J.height,data:new Uint8ClampedArray(Z)},t.dispose(),b(this._cachedData)})).catch(Z)}))}_build(t){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new s.c(this._textureDataUrl,t.PZ):this.texture._storedValue=new s.c(this._url,t.PZ):this.texture._storedValue=null}serialize(){const t=super.serialize();return t.url=this.url,t.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(t.textureDataUrl=this.textureDataUrl),t}_deserialize(t){super._deserialize(t),this.url=t.url,this.serializedCachedData=!!t.serializedCachedData,t.textureDataUrl&&(this.textureDataUrl=t.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,h.f)("BABYLON.ParticleTextureSourceBlock",Gb);class tZ extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("position",Qb.JZ),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.position.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.position.S(this.position.getConnectedValue(t))},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}}(0,h.f)("BABYLON.UpdatePositionBlock",tZ),function(t){t[t.Add=0]="Add",t[t.Subtract=1]="Subtract",t[t.Multiply=2]="Multiply",t[t.Divide=3]="Divide",t[t.Max=4]="Max",t[t.Min=5]="Min"}(Bb||(Bb={}));class bZ extends zb{constructor(t){super(t),this.operation=Bb.Add,this.registerInput("left",Qb.AutoDetect),this.registerInput("right",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this.output._typeConnectionSource=this.left;const b=[Qb.Matrix,Qb.Particle,Qb.Texture,Qb.System,Qb.FloatGradient,Qb.Color4Gradient,Qb.Vector2Gradient,Qb.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...b),this.right.excludedConnectionPointTypes.push(...b),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(t){let b;const Z=this.left,S=this.right;if(!Z.isConnected||!S.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const P=Z.type===Qb.Float||Z.type===Qb.Int,h=S.type===Qb.Float||S.type===Qb.Int,C=P&&h;switch(this.operation){case Bb.Add:b=C?t=>Z.getConnectedValue(t)+S.getConnectedValue(t):P?t=>t.adapt(Z,S.type).add(S.getConnectedValue(t)):t=>Z.getConnectedValue(t).add(t.adapt(S,Z.type));break;case Bb.Subtract:b=C?t=>Z.getConnectedValue(t)-S.getConnectedValue(t):P?t=>t.adapt(Z,S.type).SZ(S.getConnectedValue(t)):t=>Z.getConnectedValue(t).SZ(t.adapt(S,Z.type));break;case Bb.Multiply:b=C?t=>Z.getConnectedValue(t)*S.getConnectedValue(t):P?t=>t.adapt(Z,S.type).multiply(S.getConnectedValue(t)):t=>Z.getConnectedValue(t).multiply(t.adapt(S,Z.type));break;case Bb.Divide:b=C?t=>Z.getConnectedValue(t)/S.getConnectedValue(t):P?t=>t.adapt(Z,S.type).divide(S.getConnectedValue(t)):t=>Z.getConnectedValue(t).divide(t.adapt(S,Z.type));break;case Bb.Min:if(C)b=t=>Math.min(Z.getConnectedValue(t),S.getConnectedValue(t));else{const[t,h]=P?[S,Z]:[Z,S];switch(t.type){case Qb.Vector2:b=b=>J.Vector2.Minimize(t.getConnectedValue(b),b.adapt(h,t.type));break;case Qb.JZ:b=b=>J.JZ.Minimize(t.getConnectedValue(b),b.adapt(h,t.type));break;case Qb.Fb:b=b=>{const Z=t.getConnectedValue(b),{r:J,g:S,b:P,a:C}=b.adapt(h,t.type);return new v.Fb(Math.min(Z.r,J),Math.min(Z.g,S),Math.min(Z.b,P),Math.min(Z.a,C))}}}break;case Bb.Max:if(!C){const[t,h]=P?[S,Z]:[Z,S];switch(t.type){case Qb.Vector2:b=b=>J.Vector2.Maximize(t.getConnectedValue(b),b.adapt(h,t.type));break;case Qb.JZ:b=b=>J.JZ.Maximize(t.getConnectedValue(b),b.adapt(h,t.type));break;case Qb.Fb:b=b=>{const Z=t.getConnectedValue(b),{r:J,g:S,b:P,a:C}=b.adapt(h,t.type);return new v.Fb(Math.max(Z.r,J),Math.min(Z.g,S),Math.min(Z.b,P),Math.min(Z.a,C))}}break}b=t=>Math.max(Z.getConnectedValue(t),S.getConnectedValue(t))}this.output._storedFunction=t=>Z.type===Qb.Int?0|b(t):b(t)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Qb.Int||this.left.type===Qb.Float&&this.right.type!==Qb.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[t,b]of[[this.left,this.right],[this.right,this.left]])t.acceptedConnectionPointTypes=[Qb.Int,Qb.Float],b.isConnected&&(t.acceptedConnectionPointTypes.push(b.type),b.type!==Qb.Int&&b.type!==Qb.Float||t.acceptedConnectionPointTypes.push(Qb.Vector2,Qb.JZ,Qb.Fb))}dispose(){super.dispose();for(const t of this._connectionObservers)t.remove();this._connectionObservers.length=0}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,n.e)([Db("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Bb.Add},{label:"Subtract",value:Bb.Subtract},{label:"Multiply",value:Bb.Multiply},{label:"Divide",value:Bb.Divide},{label:"Max",value:Bb.Max},{label:"Min",value:Bb.Min}]})],bZ.prototype,"operation",void 0),(0,h.f)("BABYLON.ParticleMathBlock",bZ);class ZZ extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("direction1",Qb.JZ,!0,new J.JZ(0,1,0)),this.registerInput("direction2",Qb.JZ,!0,new J.JZ(0,1,0)),this.registerInput("minEmitBox",Qb.JZ,!0,new J.JZ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Qb.JZ,!0,new J.JZ(.5,.5,.5)),this.registerOutput("output",Qb.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const b=this.particle.getConnectedValue(t);b._directionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.direction1.getConnectedValue(t),P=this.direction2.getConnectedValue(t),v=(0,Y.RandomRange)(S.x,P.x),h=(0,Y.RandomRange)(S.y,P.y),C=(0,Y.RandomRange)(S.z,P.z);t.isEmitterTransformNode?J.JZ.TransformNormalFromFloatsToRef(v,h,C,t.emitterWorldMatrix,Z.direction):Z.direction.Ab(v,h,C)},b._positionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.minEmitBox.getConnectedValue(t),P=this.maxEmitBox.getConnectedValue(t),v=(0,Y.RandomRange)(S.x,P.x),h=(0,Y.RandomRange)(S.y,P.y),C=(0,Y.RandomRange)(S.z,P.z);t.isEmitterTransformNode?J.JZ.TransformCoordinatesFromFloatsToRef(v,h,C,t.emitterWorldMatrix,Z.position):(Z.position.Ab(v,h,C),Z.position.addInPlace(t.emitterPosition))},this.output._storedValue=b}}(0,h.f)("BABYLON.BoxShapeBlock",ZZ);class JZ extends zb{constructor(t){super(t),this.registerInput("emitPower",Qb.Float,!0,1),this.registerInput("lifeTime",Qb.Float,!0,1),this.registerInput("color",Qb.Fb,!0,new v.Fb(1,1,1,1)),this.registerInput("scale",Qb.Vector2,!0,new J.Vector2(1,1)),this.registerInput("angle",Qb.Float,!0,0),this.registerOutput("particle",Qb.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(t){const b=new hb(this.name,t.gZ,t.PZ,null,!1,void 0,!0);b.particleEmitterType=new u,b._lifeTimeCreation.process=(b,Z)=>{t.particleContext=b,b.lifeTime=this.lifeTime.getConnectedValue(t),Z._emitPower=this.emitPower.getConnectedValue(t)},b._colorCreation.process=b=>{t.particleContext=b,b.color.S(this.color.getConnectedValue(t))},b._sizeCreation.process=b=>{t.particleContext=b,b.size=1,b.scale.S(this.scale.getConnectedValue(t))},b._angleCreation.process=b=>{t.particleContext=b,b.angle=this.angle.getConnectedValue(t)},this.particle._storedValue=b}}(0,h.f)("BABYLON.CreateParticleBlock",JZ);class SZ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const t=[];for(const b of this.attachedBlocks)b.isInput&&t.push(b);return t}constructor(t){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new mt.d,this.name=t}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(t)&&this.attachedBlocks.push(t);for(const Z of t.inputs){const J=Z.connectedPoint;if(J){const Z=J.ownerBlock;Z!==t&&this._initializeBlock(Z,b)}}}async buildAsync(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Z=>{const J=new ob;for(const t of this._systemBlocks)this._initializeBlock(t);for(const S of this.systemBlocks){const Z=new fb;Z.buildId=this._buildId++,Z.PZ=t,Z.verbose=b;const P=S.createSystem(Z);Z.emitErrors(),J.systems.push(P)}this.onBuildObservable.notifyObservers(this),Z(J)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const t=new Rb("Particle system"),b=new tZ("Update position");b.output.connectTo(t.particle);const Z=new wb("Position");Z.contextualValue=Lb.Position;const J=new wb("Scaled direction");J.contextualValue=Lb.ScaledDirection;const S=new bZ("Add");S.operation=Bb.Add,Z.output.connectTo(S.left),J.output.connectTo(S.right),S.output.connectTo(b.position);const P=new JZ("Create particle"),v=new ZZ("Box shape");P.particle.connectTo(v.particle),v.output.connectTo(b.particle);const h=new Gb("Texture");h.texture.connectTo(t.texture),h.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(t)}removeBlock(t){const b=this.attachedBlocks.indexOf(t);if(b>-1&&this.attachedBlocks.splice(b,1),t.isSystem){const b=this._systemBlocks.indexOf(t);b>-1&&this._systemBlocks.splice(b,1)}}parseSerializedObject(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b||this.clear();const Z={};for(const J of t.SI){const t=(0,h.d)(J.customType);if(t){const b=new t;b._deserialize(J),Z[J.id]=b,this.attachedBlocks.push(b),b.isSystem&&this._systemBlocks.push(b)}}for(const J of this.attachedBlocks)if(J.isTeleportOut){const t=J,b=t._tempEntryPointUniqueId;if(b){const J=Z[b];J&&J.attachToEndpoint(t)}}for(let J=0;J<t.SI.length;J++){const S=t.SI[J],P=Z[S.id];P&&(P.inputs.length&&S.inputs.some((t=>t.targetConnectionName))&&!b||this._restoreConnections(P,t,Z))}if(t.locations||t.editorData&&t.editorData.locations){const J=t.locations||t.editorData.locations;for(const t of J)Z[t.jS]&&(t.jS=Z[t.jS].uniqueId);b&&this.editorData&&this.editorData.locations&&J.concat(this.editorData.locations),t.locations?this.editorData={locations:J}:(this.editorData=t.editorData,this.editorData.locations=J);const S=[];for(const t in Z)S[t]=Z[t].uniqueId;this.editorData.map=S}this.comment=t.comment}_restoreConnections(t,b,Z){for(const J of t.outputs)for(const S of b.SI){const P=Z[S.id];if(P)for(const v of S.inputs)if(Z[v.targetBlockId]!==t||v.targetConnectionName!==J.name);else{const t=P.getInputByName(v.inputName);if(!t||t.isConnected)continue;J.connectTo(t,!0),this._restoreConnections(P,b,Z)}}}serialize(t){const b=t?{}:d.d.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));let Z=[];t?Z=t:b.customType="BABYLON.NodeParticleSystemSet",b.SI=[];for(const J of Z)b.SI.push(J.serialize());if(!t)for(const J of this.attachedBlocks)-1===Z.indexOf(J)&&b.SI.push(J.serialize());return b}dispose(){for(const t of this.attachedBlocks)t.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(t){const b=new SZ(t);return b.setToDefault(),b}static Parse(t){const b=d.d.Parse((()=>new SZ(t.name)),t,null);return b.parseSerializedObject(t),b}static ParseFromSnippetAsync(t,b){return"_BLANK"===t?Promise.resolve(SZ.CreateDefault("blank")):new Promise(((Z,J)=>{const S=new Ob.b;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const v=JSON.parse(JSON.parse(S.responseText).jsonPayload),h=JSON.parse(v.nodeParticle);b||(b=d.d.Parse((()=>new SZ(t)),h,null)),b.parseSerializedObject(h),b.snippetId=t;try{Z(b)}catch(P){J(P)}}else J("Unable to load the snippet "+t)})),S.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),S.send()}))}}SZ.EditorURL=`${Eb.Tools._DefaultCdnUrl}/v${Dt.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,SZ.SnippetUrl="https://snippet.babylonjs.com",(0,n.e)([(0,y.N)()],SZ.prototype,"name",void 0),(0,n.e)([(0,y.N)("comment")],SZ.prototype,"comment",void 0),function(t){t[t.None=0]="None",t[t.PerParticle=1]="PerParticle",t[t.PerSystem=2]="PerSystem"}(Xb||(Xb={}));class PZ extends zb{constructor(t){super(t),this._currentLockId=-2,this.lockMode=Xb.PerParticle,this.registerInput("min",Qb.AutoDetect,!0,0),this.registerInput("max",Qb.AutoDetect,!0,1),this.registerOutput("output",Qb.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Qb.Float|Qb.Int|Qb.Vector2|Qb.JZ|Qb.Fb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Qb.Float|Qb.Int|Qb.Vector2|Qb.JZ|Qb.Fb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Qb.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case Qb.AutoDetect:case Qb.Int:case Qb.Float:t=t=>{const b=this.min.getConnectedValue(t)||0,Z=this.max.getConnectedValue(t)||1;return b+Math.random()*(Z-b)};break;case Qb.Vector2:t=t=>{const b=this.min.getConnectedValue(t)||J.Vector2.Zero(),Z=this.max.getConnectedValue(t)||J.Vector2.One();return new J.Vector2(b.x+Math.random()*(Z.x-b.x),b.y+Math.random()*(Z.y-b.y))};break;case Qb.JZ:t=t=>{const b=this.min.getConnectedValue(t)||J.JZ.Zero(),Z=this.max.getConnectedValue(t)||J.JZ.One();return new J.JZ(b.x+Math.random()*(Z.x-b.x),b.y+Math.random()*(Z.y-b.y),b.z+Math.random()*(Z.z-b.z))};break;case Qb.Fb:t=t=>{const b=this.min.getConnectedValue(t)||new v.Fb(0,0,0,0),Z=this.max.getConnectedValue(t)||new v.Fb(1,1,1,1);return new v.Fb(b.x+Math.random()*(Z.x-b.x),b.y+Math.random()*(Z.y-b.y),b.z+Math.random()*(Z.z-b.z),b.w+Math.random()*(Z.w-b.w))}}this.output._storedFunction=b=>{var Z;let J=0;switch(this.lockMode){case Xb.PerParticle:J=(null===(Z=b.particleContext)||void 0===Z?void 0:Z.id)||-1;break;case Xb.PerSystem:J=b.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Xb.None&&(this._currentLockId=J),this.output._storedValue=t(b)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),this.lockMode=t.lockMode}}(0,n.e)([Db("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Xb.None},{label:"Per particle",value:Xb.PerParticle},{label:"Per system",value:Xb.PerSystem}]})],PZ.prototype,"lockMode",void 0),(0,h.f)("BABYLON.ParticleRandomBlock",PZ);class vZ extends zb{constructor(t){super(t),this._currentLockId=-2,this.lockMode=Xb.PerParticle,this.registerInput("min",Qb.AutoDetect),this.registerInput("max",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const b=[Qb.Matrix,Qb.Particle,Qb.Texture,Qb.System,Qb.FloatGradient,Qb.Color4Gradient,Qb.Vector2Gradient,Qb.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...b),this.max.excludedConnectionPointTypes.push(...b)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let t=null;switch(this._currentLockId=-2,this.min.type){case Qb.Float:case Qb.Int:t=t=>{const b=this.min.getConnectedValue(t),Z=this.max.getConnectedValue(t);return Math.random()*(Z-b)+b};break;case Qb.Vector2:t=t=>{const b=this.min.getConnectedValue(t),Z=this.max.getConnectedValue(t);return new J.Vector2(Math.random()*(Z.x-b.x)+b.x,Math.random()*(Z.y-b.y)+b.y)};break;case Qb.JZ:t=t=>{const b=this.min.getConnectedValue(t),Z=this.max.getConnectedValue(t);return new J.JZ(Math.random()*(Z.x-b.x)+b.x,Math.random()*(Z.y-b.y)+b.y,Math.random()*(Z.z-b.z)+b.z)};break;case Qb.Fb:t=t=>{const b=this.min.getConnectedValue(t),Z=this.max.getConnectedValue(t);return new v.Fb(Math.random()*(Z.r-b.r)+b.r,Math.random()*(Z.g-b.g)+b.g,Math.random()*(Z.b-b.b)+b.b,Math.random()*(Z.a-b.a)+b.a)}}this.output._storedFunction=b=>{var Z;let J=0;switch(this.lockMode){case Xb.PerParticle:J=(null===(Z=b.particleContext)||void 0===Z?void 0:Z.id)||-1;break;case Xb.PerSystem:J=b.buildId||0}return this._currentLockId!==J&&(this.lockMode!==Xb.None&&(this._currentLockId=J),this.output._storedValue=t(b)),this.output._storedValue}}serialize(){const t=super.serialize();return t.lockMode=this.lockMode,t}_deserialize(t){super._deserialize(t),void 0!==t.lockMode&&(this.lockMode=t.lockMode)}}(0,n.e)([Db("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Xb.None},{label:"Per particle",value:Xb.PerParticle},{label:"Per system",value:Xb.PerSystem}]})],vZ.prototype,"lockMode",void 0),(0,h.f)("BABYLON.RandomRangeBlock",vZ);(0,h.f)("BABYLON.ParticleLerpBlock",class extends zb{constructor(t){super(t),this.registerInput("left",Qb.AutoDetect),this.registerInput("right",Qb.AutoDetect),this.registerInput("gradient",Qb.Float,!0,0,0,1),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Qb.Float|Qb.Int|Qb.Vector2|Qb.JZ|Qb.Fb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=(t,b,Z)=>(1-t)*b+t*Z;this.output._storedFunction=b=>{const Z=this.left.getConnectedValue(b),S=this.right.getConnectedValue(b),P=this.gradient.getConnectedValue(b);switch(this.left.type){case Qb.Int:case Qb.Float:return t(P,Z,S);case Qb.Vector2:return new J.Vector2(t(P,Z.x,S.x),t(P,Z.y,S.y));case Qb.JZ:return new J.JZ(t(P,Z.x,S.x),t(P,Z.y,S.y),t(P,Z.z,S.z));case Qb.Fb:return new v.Fb(t(P,Z.r,S.r),t(P,Z.g,S.g),t(P,Z.b,S.b),t(P,Z.a,S.a))}return 0}}});(0,h.f)("BABYLON.UpdateDirectionBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("direction",Qb.JZ),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.direction.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.direction.S(this.direction.getConnectedValue(t))},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}});(0,h.f)("BABYLON.UpdateColorBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("color",Qb.Fb),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.color.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.color.S(this.color.getConnectedValue(t))},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}});(0,h.f)("BABYLON.UpdateScaleBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("scale",Qb.Vector2),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.scale.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.scale.S(this.scale.getConnectedValue(t))},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}});(0,h.f)("BABYLON.UpdateAngleBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("angle",Qb.Float),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.angle.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.angle=this.angle.getConnectedValue(t)},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}});(0,h.f)("BABYLON.BasicPositionUpdateBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(t){const b=this.particle.getConnectedValue(t),Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.direction.scaleToRef(b._directionScale,b._scaledDirection),Z.position.addInPlace(b._scaledDirection)},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z,this.output._storedValue=b}});(0,h.f)("BABYLON.BasicSpriteUpdateBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(t){const b=this.particle.getConnectedValue(t),Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.updateCellIndex()},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z,this.output._storedValue=b}});(0,h.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("cellIndex",Qb.Int),this.registerOutput("output",Qb.Particle),this.cellIndex.acceptedConnectionPointTypes=[Qb.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(t){const b=this.particle.getConnectedValue(t);if(this.output._storedValue=b,!this.cellIndex.isConnected)return;const Z={process:Z=>{t.particleContext=Z,t.systemContext=b,Z.cellIndex=Math.floor(this.cellIndex.getConnectedValue(t))},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z}});class hZ extends zb{constructor(t){super(t),this.strength=1,this.registerInput("particle",Qb.Particle),this.registerInput("flowMap",Qb.Texture),this.registerOutput("output",Qb.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(t){var b;const Z=this.particle.getConnectedValue(t),J=t.PZ;let S;(null===(b=this.flowMap.connectedPoint)||void 0===b?void 0:b.ownerBlock).extractTextureContentAsync().then((t=>{t&&(S=new qb(t.width,t.height,t.data))}));const P={process:t=>{const b=J.getTransformMatrix();S&&S._processParticle(t,this.strength*Z._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null};Z._updateQueueStart?Ft(P,Z._updateQueueStart):Z._updateQueueStart=P,this.output._storedValue=Z}serialize(){const t=super.serialize();return t.strength=this.strength,t}_deserialize(t){super._deserialize(t),this.strength=t.strength}}(0,n.e)([Db("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hZ.prototype,"strength",void 0),(0,h.f)("BABYLON.UpdateFlowMapBlock",hZ);(0,h.f)("BABYLON.SphereShapeBlock",class extends zb{constructor(t){super(t),this.registerInput("input",Qb.Particle),this.registerInput("radius",Qb.Float,!0,1),this.registerInput("radiusRange",Qb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Qb.Float,!0,0,0,1),this.registerOutput("output",Qb.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(t){const b=this.input.getConnectedValue(t);b._directionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.directionRandomizer.getConnectedValue(t),P=Z.position.SZ(t.emitterPosition).normalize(),v=(0,Y.RandomRange)(0,S),h=(0,Y.RandomRange)(0,S),C=(0,Y.RandomRange)(0,S);P.x+=v,P.y+=h,P.z+=C,P.normalize(),t.isEmitterTransformNode?J.JZ.TransformNormalFromFloatsToRef(v,h,C,t.emitterWorldMatrix,Z.direction):Z.direction.Ab(v,h,C)},b._positionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.radius.getConnectedValue(t),P=this.radiusRange.getConnectedValue(t),v=S-(0,Y.RandomRange)(0,S*P),h=(0,Y.RandomRange)(0,1),C=(0,Y.RandomRange)(0,2*Math.PI),g=Math.acos(2*h-1),I=v*Math.cos(C)*Math.sin(g),r=v*Math.cos(g),M=v*Math.sin(C)*Math.sin(g);t.isEmitterTransformNode?J.JZ.TransformCoordinatesFromFloatsToRef(I,r,M,t.emitterWorldMatrix,Z.position):(Z.position.Ab(I,r,M),Z.position.addInPlace(t.emitterPosition))},this.output._storedValue=b}});(0,h.f)("BABYLON.PointShapeBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("direction1",Qb.JZ,!0,new J.JZ(0,1,0)),this.registerInput("direction2",Qb.JZ,!0,new J.JZ(0,1,0)),this.registerOutput("output",Qb.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const b=this.particle.getConnectedValue(t);b._directionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.direction1.getConnectedValue(t),P=this.direction2.getConnectedValue(t),v=(0,Y.RandomRange)(S.x,P.x),h=(0,Y.RandomRange)(S.y,P.y),C=(0,Y.RandomRange)(S.z,P.z);t.isEmitterTransformNode?J.JZ.TransformNormalFromFloatsToRef(v,h,C,t.emitterWorldMatrix,Z.direction):Z.direction.Ab(v,h,C)},b._positionCreation.process=Z=>{t.systemContext=b,t.isEmitterTransformNode?J.JZ.TransformCoordinatesFromFloatsToRef(0,0,0,t.emitterWorldMatrix,Z.position):Z.position.S(t.emitterPosition)},this.output._storedValue=b}});(0,h.f)("BABYLON.CustomShapeBlock",class extends zb{constructor(t){super(t),this.registerInput("particle",Qb.Particle),this.registerInput("position",Qb.JZ,!0,new J.JZ(0,0,0)),this.registerInput("direction",Qb.JZ,!0,new J.JZ(0,1,0)),this.registerOutput("output",Qb.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){const b=this.particle.getConnectedValue(t);b._directionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.direction.getConnectedValue(t);t.isEmitterTransformNode?J.JZ.TransformNormalToRef(S,t.emitterWorldMatrix,Z.direction):Z.direction.S(S)},b._positionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.position.getConnectedValue(t);t.isEmitterTransformNode?J.JZ.TransformCoordinatesToRef(S,t.emitterWorldMatrix,Z.position):(Z.position.S(S),Z.position.addInPlace(t.emitterPosition))},this.output._storedValue=b}});(0,h.f)("BABYLON.CylinderShapeBlock",class extends zb{constructor(t){super(t),this._tempVector=J.JZ.Zero(),this.registerInput("particle",Qb.Particle),this.registerInput("radius",Qb.Float,!0,1),this.registerInput("height",Qb.Float,!0,1,0),this.registerInput("radiusRange",Qb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Qb.Float,!0,0,0,1),this.registerOutput("output",Qb.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(t){const b=this.particle.getConnectedValue(t);b._directionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.directionRandomizer.getConnectedValue(t);Z.position.subtractToRef(t.emitterPosition,this._tempVector),this._tempVector.normalize(),t.isEmitterTransformNode&&J.JZ.TransformNormalToRef(this._tempVector,t.emitterInverseWorldMatrix,this._tempVector);const P=(0,Y.RandomRange)(-S/2,S/2);let v=Math.atan2(this._tempVector.x,this._tempVector.z);v+=(0,Y.RandomRange)(-Math.PI/2,Math.PI/2)*S,this._tempVector.y=P,this._tempVector.x=Math.sin(v),this._tempVector.z=Math.cos(v),this._tempVector.normalize(),t.isEmitterTransformNode?J.JZ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,t.emitterWorldMatrix,Z.direction):Z.direction.S(this._tempVector)},b._positionCreation.process=Z=>{t.particleContext=Z,t.systemContext=b;const S=this.height.getConnectedValue(t),P=this.radiusRange.getConnectedValue(t),v=this.radius.getConnectedValue(t),h=(0,Y.RandomRange)(-S/2,S/2),C=(0,Y.RandomRange)(0,2*Math.PI),g=(0,Y.RandomRange)((1-P)*(1-P),1),I=Math.sqrt(g)*v,r=I*Math.cos(C),M=I*Math.sin(C);t.isEmitterTransformNode?J.JZ.TransformCoordinatesFromFloatsToRef(r,h,M,t.emitterWorldMatrix,Z.position):(Z.position.Ab(r,h,M),Z.position.addInPlace(t.emitterPosition))},this.output._storedValue=b}});class CZ extends zb{constructor(t){super(t),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Qb.Particle),this.registerOutput("output",Qb.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const b=this.particle.getConnectedValue(t);b._isAnimationSheetEnabled=!0,b.spriteCellWidth=this.width,b.spriteCellHeight=this.height,b.startSpriteCellID=this.start,b.endSpriteCellID=this.end,b.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=b}serialize(){const t=super.serialize();return t.width=this.width,t.height=this.height,t.start=this.start,t.end=this.end,t.randomStartCell=this.randomStartCell,t}_deserialize(t){super._deserialize(t),this.width=t.width,this.height=t.height,this.start=t.start,this.end=t.end,this.randomStartCell=t.randomStartCell}}(0,n.e)([Db("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CZ.prototype,"start",void 0),(0,n.e)([Db("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CZ.prototype,"end",void 0),(0,n.e)([Db("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CZ.prototype,"width",void 0),(0,n.e)([Db("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CZ.prototype,"height",void 0),(0,n.e)([Db("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CZ.prototype,"loop",void 0),(0,n.e)([Db("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],CZ.prototype,"randomStartCell",void 0),(0,h.f)("BABYLON.SetupSpriteSheetBlock",CZ);class YZ extends zb{constructor(t){super(t),this.reference=0,this.registerInput("value",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case Qb.Float:return Qb.FloatGradient;case Qb.Vector2:return Qb.Vector2Gradient;case Qb.JZ:return Qb.Vector3Gradient;case Qb.Fb:return Qb.Color4Gradient}return t},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Qb.Float|Qb.Vector2|Qb.JZ|Qb.Fb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=t=>null}serialize(){const t=super.serialize();return t.reference=this.reference,t}_deserialize(t){super._deserialize(t),this.reference=t.reference}}(0,n.e)([Db("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],YZ.prototype,"reference",void 0),(0,h.f)("BABYLON.ParticleGradientValueBlock",YZ);(0,h.f)("BABYLON.ParticleGradientBlock",class extends zb{constructor(t){super(t),this._entryCount=1,this.registerInput("gradient",Qb.Float,!0,1,0,1),this.registerInput("value0",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=t=>{switch(t){case Qb.FloatGradient:return Qb.Float;case Qb.Vector2Gradient:return Qb.Vector2;case Qb.Vector3Gradient:return Qb.JZ;case Qb.Color4Gradient:return Qb.Fb}return t},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Qb.FloatGradient|Qb.Vector2Gradient|Qb.Vector3Gradient|Qb.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(t){this._inputs[t].onConnectionObservable.add((()=>{this._entryCount>t||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Qb.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const t=[];for(let Z=1;Z<this._inputs.length;Z++){var b;if(this._inputs[Z].isConnected)t.push(null===(b=this._inputs[Z].connectedPoint)||void 0===b?void 0:b.ownerBlock)}t.sort(((t,b)=>t.reference-b.reference)),this.output._storedFunction=b=>{const Z=this.gradient.getConnectedValue(b);if(1===t.length)return t[0].value.getConnectedValue(b);let S=null;for(let P=t.length-1;P>=0;P--){const h=t[P];if(h.reference<=Z){const t=h.value.getConnectedValue(b);if(S){const P=S.value.getConnectedValue(b),C=S.reference,g=h.reference,I=Math.max(0,Math.min(1,(Z-g)/(C-g)));switch(this.output.type){case Qb.Float:return(0,Y.Lerp)(t,P,I);case Qb.Vector2:return J.Vector2.Lerp(t,P,I);case Qb.JZ:return J.JZ.Lerp(t,P,I);case Qb.Fb:return v.Fb.Lerp(t,P,I)}}return t}S=h}return 0}}});(0,h.f)("BABYLON.ParticleConverterBlock",class extends zb{constructor(t){super(t),this.registerInput("color ",Qb.Fb,!0),this.registerInput("xyz ",Qb.JZ,!0),this.registerInput("xy ",Qb.Vector2,!0),this.registerInput("zw ",Qb.Vector2,!0),this.registerInput("x ",Qb.Float,!0),this.registerInput("y ",Qb.Float,!0),this.registerInput("z ",Qb.Float,!0),this.registerInput("w ",Qb.Float,!0),this.registerOutput("color",Qb.Fb),this.registerOutput("xyz",Qb.JZ),this.registerOutput("xy",Qb.Vector2),this.registerOutput("zw",Qb.Vector2),this.registerOutput("x",Qb.Float),this.registerOutput("y",Qb.Float),this.registerOutput("z",Qb.Float),this.registerOutput("w",Qb.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(t){return"color "===t?"colorIn":"xyz "===t?"xyzIn":"xy "===t?"xyIn":"zw "===t?"zwIn":"x "===t?"xIn":"y "===t?"yIn":"z "===t?"zIn":"w "===t?"wIn":t}_outputRename(t){switch(t){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return t}}_build(t){super._build(t);const b=this.xIn,Z=this.yIn,S=this.zIn,P=this.wIn,h=this.xyIn,C=this.zwIn,Y=this.xyzIn,g=this.colorIn,I=this.colorOut,r=this.xyzOut,M=this.xyOut,T=this.zwOut,a=this.xOut,k=this.yOut,u=this.zOut,l=this.wOut,U=t=>{if(g.isConnected)return g.getConnectedValue(t);let J=0,I=0,r=0,M=0;if(b.isConnected&&(J=b.getConnectedValue(t)),Z.isConnected&&(I=Z.getConnectedValue(t)),S.isConnected&&(r=S.getConnectedValue(t)),P.isConnected&&(M=P.getConnectedValue(t)),h.isConnected){const b=h.getConnectedValue(t);b&&(J=b.x,I=b.y)}if(C.isConnected){const b=C.getConnectedValue(t);b&&(r=b.x,M=b.y)}if(Y.isConnected){const b=Y.getConnectedValue(t);b&&(J=b.x,I=b.y,r=b.z)}return new v.Fb(J,I,r,M)};I._storedFunction=t=>U(t),r._storedFunction=t=>{const b=U(t);return new J.JZ(b.r,b.g,b.b)},M._storedFunction=t=>{const b=U(t);return new J.Vector2(b.r,b.g)},T._storedFunction=t=>{const b=U(t);return new J.Vector2(b.b,b.a)},a._storedFunction=t=>U(t).r,k._storedFunction=t=>U(t).g,u._storedFunction=t=>U(t).b,l._storedFunction=t=>U(t).a}}),function(t){t[t.Cos=0]="Cos",t[t.Sin=1]="Sin",t[t.Abs=2]="Abs",t[t.Exp=3]="Exp",t[t.Exp2=4]="Exp2",t[t.Round=5]="Round",t[t.Floor=6]="Floor",t[t.Ceiling=7]="Ceiling",t[t.Sqrt=8]="Sqrt",t[t.Log=9]="Log",t[t.Tan=10]="Tan",t[t.ArcTan=11]="ArcTan",t[t.ArcCos=12]="ArcCos",t[t.ArcSin=13]="ArcSin",t[t.Sign=14]="Sign",t[t.Negate=15]="Negate",t[t.OneMinus=16]="OneMinus",t[t.Reciprocal=17]="Reciprocal",t[t.ToDegrees=18]="ToDegrees",t[t.ToRadians=19]="ToRadians",t[t.Fract=20]="Fract"}(xb||(xb={}));class gZ extends zb{constructor(t){super(t),this.operation=xb.Cos,this.registerInput("input",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Qb.Float|Qb.Int|Qb.Vector2|Qb.JZ|Qb.Fb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);let b=null;switch(this.operation){case xb.Cos:b=t=>Math.cos(t);break;case xb.Sin:b=t=>Math.sin(t);break;case xb.Abs:b=t=>Math.abs(t);break;case xb.Exp:b=t=>Math.exp(t);break;case xb.Exp2:b=t=>Math.pow(2,t);break;case xb.Round:b=t=>Math.round(t);break;case xb.Floor:b=t=>Math.floor(t);break;case xb.Ceiling:b=t=>Math.ceil(t);break;case xb.Sqrt:b=t=>Math.sqrt(t);break;case xb.Log:b=t=>Math.log(t);break;case xb.Tan:b=t=>Math.tan(t);break;case xb.ArcTan:b=t=>Math.atan(t);break;case xb.ArcCos:b=t=>Math.acos(t);break;case xb.ArcSin:b=t=>Math.asin(t);break;case xb.Sign:b=t=>Math.sign(t);break;case xb.Negate:b=t=>-t;break;case xb.OneMinus:b=t=>1-t;break;case xb.Reciprocal:b=t=>1/t;break;case xb.ToRadians:b=t=>t*Math.PI/180;break;case xb.ToDegrees:b=t=>180*t/Math.PI;break;case xb.Fract:b=t=>t>=0?t-Math.floor(t):t-Math.ceil(t)}if(!b)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Qb.Int:case Qb.Float:this.output._storedFunction=t=>{const Z=this.input.getConnectedValue(t);return b(Z)};break;case Qb.Vector2:this.output._storedFunction=t=>{const Z=this.input.getConnectedValue(t);return new J.Vector2(b(Z.x),b(Z.y))};break;case Qb.JZ:this.output._storedFunction=t=>{const Z=this.input.getConnectedValue(t);return new J.JZ(b(Z.x),b(Z.y),b(Z.z))};break;case Qb.Fb:this.output._storedFunction=t=>{const Z=this.input.getConnectedValue(t);return new v.Fb(b(Z.r),b(Z.g),b(Z.b),b(Z.a))}}return this}serialize(){const t=super.serialize();return t.operation=this.operation,t}_deserialize(t){super._deserialize(t),this.operation=t.operation}}(0,n.e)([Db("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:xb.Cos},{label:"Sin",value:xb.Sin},{label:"Abs",value:xb.Abs},{label:"Exp",value:xb.Exp},{label:"Exp2",value:xb.Exp2},{label:"Round",value:xb.Round},{label:"Floor",value:xb.Floor},{label:"Ceiling",value:xb.Ceiling},{label:"Sqrt",value:xb.Sqrt},{label:"Log",value:xb.Log},{label:"Tan",value:xb.Tan},{label:"ArcTan",value:xb.ArcTan},{label:"ArcCos",value:xb.ArcCos},{label:"ArcSin",value:xb.ArcSin},{label:"Sign",value:xb.Sign},{label:"Negate",value:xb.Negate},{label:"OneMinus",value:xb.OneMinus},{label:"Reciprocal",value:xb.Reciprocal},{label:"ToDegrees",value:xb.ToDegrees},{label:"ToRadians",value:xb.ToRadians},{label:"Fract",value:xb.Fract}]})],gZ.prototype,"operation",void 0),(0,h.f)("BABYLON.ParticleTrigonometryBlock",gZ);var IZ,rZ=Z(14088);class MZ extends zb{constructor(t){super(t),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Qb.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Qb.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Qb.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Qb.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Qb.System),this._inputs[0].excludedConnectionPointTypes.push(Qb.Particle),this._inputs[0].excludedConnectionPointTypes.push(Qb.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const b=t=>{const b=this.input.getConnectedValue(t);if(this.log.length>=this.stackSize)return b;if(null===b||void 0===b)return this.log.push(["null",""]),b;switch(this.input.type){case Qb.Vector2:this.log.push([(0,rZ.g)(b,4),b.toString()]);break;case Qb.JZ:this.log.push([(0,rZ.k)(b,4),b.toString()]);break;case Qb.Fb:this.log.push([`{R: ${b.r.toFixed(4)} G: ${b.g.toFixed(4)} B: ${b.b.toFixed(4)} A: ${b.a.toFixed(4)}}`,b.toString()]);break;default:this.log.push([b.toString(),b.toString()])}return b};this.output.isConnected?this.output._storedFunction=b:this.output._storedValue=b(t)}serialize(){const t=super.serialize();return t.stackSize=this.stackSize,t}_deserialize(t){super._deserialize(t),this.stackSize=t.stackSize}}(0,n.e)([Db("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],MZ.prototype,"stackSize",void 0),(0,h.f)("BABYLON.ParticleDebugBlock",MZ);(0,h.f)("BABYLON.ParticleElbowBlock",class extends zb{constructor(t){super(t),this.registerInput("input",Qb.AutoDetect),this.registerOutput("output",Qb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(t){super._build(t);const b=this._outputs[0],Z=this._inputs[0];b._storedFunction=t=>Z.getConnectedValue(t)}});(0,h.f)("BABYLON.ParticleTeleportInBlock",class extends zb{get endpoints(){return this._endpoints}constructor(t){super(t),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Qb.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(t){if(this.getClassName()===t)return!0;for(const b of this.endpoints)if(b.isAnAncestorOfType(t))return!0;return!1}isAnAncestorOf(t){for(const b of this.endpoints){if(b===t)return!0;if(b.isAnAncestorOf(t))return!0}return!1}attachToEndpoint(t){t.detach(),this._endpoints.push(t),t._entryPoint=this,t._outputs[0]._typeConnectionSource=this._inputs[0],t._tempEntryPointUniqueId=null,t.name="> "+this.name}detachFromEndpoint(t){const b=this._endpoints.indexOf(t);-1!==b&&(this._endpoints.splice(b,1),t._outputs[0]._typeConnectionSource=null,t._entryPoint=null)}_build(){for(const t of this._endpoints)t.output._storedFunction=t=>this.input.getConnectedValue(t)}});(0,h.f)("BABYLON.ParticleTeleportOutBlock",class extends zb{constructor(t){super(t),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Qb.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(t){this.entryPoint&&this.entryPoint.build(t)}clone(){const t=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(t),t}serialize(){var t;const b=super.serialize();return b.entryPoint=(null===(t=this.entryPoint)||void 0===t?void 0:t.uniqueId)??"",b}_deserialize(t){super._deserialize(t),this._tempEntryPointUniqueId=t.entryPoint}}),function(t){t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.LessThan=2]="LessThan",t[t.GreaterThan=3]="GreaterThan",t[t.LessOrEqual=4]="LessOrEqual",t[t.GreaterOrEqual=5]="GreaterOrEqual",t[t.Xor=6]="Xor",t[t.Or=7]="Or",t[t.And=8]="And"}(IZ||(IZ={}));class TZ extends zb{constructor(t){super(t),this.test=IZ.Equal,this.epsilon=0,this.registerInput("left",Qb.Float),this.registerInput("right",Qb.Float,!0,0),this.registerInput("ifTrue",Qb.AutoDetect,!0,1),this.registerInput("ifFalse",Qb.AutoDetect,!0,0),this.registerOutput("output",Qb.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Qb.Float,this._inputs[0].acceptedConnectionPointTypes.push(Qb.Int),this._inputs[1].acceptedConnectionPointTypes.push(Qb.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const t=t=>{const b=this.left.getConnectedValue(t),Z=this.right.getConnectedValue(t);let J=!1;switch(this.test){case IZ.Equal:J=(0,Y.WithinEpsilon)(b,Z,this.epsilon);break;case IZ.NotEqual:J=!(0,Y.WithinEpsilon)(b,Z,this.epsilon);break;case IZ.LessThan:J=b<Z+this.epsilon;break;case IZ.GreaterThan:J=b>Z-this.epsilon;break;case IZ.LessOrEqual:J=b<=Z+this.epsilon;break;case IZ.GreaterOrEqual:J=b>=Z-this.epsilon;break;case IZ.Xor:J=!!b&&!Z||!b&&!!Z;break;case IZ.Or:J=!!b||!!Z;break;case IZ.And:J=!!b&&!!Z}return J};this.output._storedFunction=b=>t(b)?this.ifTrue.getConnectedValue(b):this.ifFalse.getConnectedValue(b)}serialize(){const t=super.serialize();return t.test=this.test,t.epsilon=this.epsilon,t}_deserialize(t){super._deserialize(t),this.test=t.test,void 0!==t.epsilon&&(this.epsilon=t.epsilon)}}(0,n.e)([Db("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:IZ.Equal},{label:"NotEqual",value:IZ.NotEqual},{label:"LessThan",value:IZ.LessThan},{label:"GreaterThan",value:IZ.GreaterThan},{label:"LessOrEqual",value:IZ.LessOrEqual},{label:"GreaterOrEqual",value:IZ.GreaterOrEqual},{label:"Xor",value:IZ.Xor},{label:"Or",value:IZ.Or},{label:"And",value:IZ.And}]})],TZ.prototype,"test",void 0),(0,n.e)([Db("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],TZ.prototype,"epsilon",void 0),(0,h.f)("BABYLON.ParticleConditionBlock",TZ);class aZ extends zb{constructor(t){super(t),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Qb.Particle),this.registerInput("condition",Qb.Float,!0,0),this.registerInput("system",Qb.System),this.registerOutput("output",Qb.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(t){this._triggerCount=0;const b=this.input.getConnectedValue(t),Z={process:Z=>{if(t.particleContext=Z,t.systemContext=b,0!==this.condition.getConnectedValue(t)&&(0===this.limit||this._triggerCount<this.limit)){const J=(new Date).getTime();if(this._previousOne&&J-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=J;const S=this.system.getConnectedValue(t);if(S){const J=mZ(S,t.PZ,Z.position);J.lb.addOnce((()=>{this._triggerCount--})),b.lb.addOnce((()=>{J.dispose()}))}}},previousItem:null,nextItem:null};b._updateQueueStart?Ft(Z,b._updateQueueStart):b._updateQueueStart=Z,this.output._storedValue=b}serialize(){const t=super.serialize();return t.limit=this.limit,t.delay=this.delay,t}_deserialize(t){super._deserialize(t),void 0!==t.limit&&(this.limit=t.limit),void 0!==t.delay&&(this.delay=t.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,n.e)([Db("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aZ.prototype,"limit",void 0),(0,n.e)([Db("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],aZ.prototype,"delay",void 0),(0,h.f)("BABYLON.ParticleTriggerBlock",aZ);Z(14095),Z(14105),Z(14121),Z(14167)},14157:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneFragment",P="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14125:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneFragmentDeclaration",P="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14180:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneVertex",P="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14170:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneVertexDeclaration",P="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14162:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogFragment",P="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14154:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogFragmentDeclaration",P="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14189:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogVertex",P="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14172:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogVertexDeclaration",P="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14138:(t,b,Z)=>{"use strict";var J=Z(12636);const S="helperFunctions",P="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14133:(t,b,Z)=>{"use strict";var J=Z(12636);const S="imageProcessingDeclaration",P="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14147:(t,b,Z)=>{"use strict";var J=Z(12636);const S="imageProcessingFunctions",P="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14136:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthDeclaration",P="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14159:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthFragment",P="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14192:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthVertex",P="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";J.e.IncludesShadersStoreWGSL[S]||(J.e.IncludesShadersStoreWGSL[S]=P)},14121:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{particlesPixelShaderWGSL:()=>v});var J=Z(12636);Z(14125),Z(14133),Z(14136),Z(14138),Z(14147),Z(14154),Z(14157),Z(14159),Z(14162);const S="particlesPixelShader",P="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.e.ShadersStoreWGSL[S]||(J.e.ShadersStoreWGSL[S]=P);const v={name:S,shader:P}},14167:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{particlesVertexShaderWGSL:()=>v});var J=Z(12636);Z(14170),Z(14172),Z(14136),Z(14180),Z(14189),Z(14192);const S="particlesVertexShader",P="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.e.ShadersStoreWGSL[S]||(J.e.ShadersStoreWGSL[S]=P);const v={name:S,shader:P}},14021:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneFragment",P="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14101:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneFragmentDeclaration",P="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14051:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneVertex",P="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14112:(t,b,Z)=>{"use strict";var J=Z(12636);const S="clipPlaneVertexDeclaration",P="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14035:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogFragment",P="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14012:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogFragmentDeclaration",P="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14055:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogVertex",P="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14042:(t,b,Z)=>{"use strict";var J=Z(12636);const S="fogVertexDeclaration",P="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},13996:(t,b,Z)=>{"use strict";var J=Z(12636);const S="helperFunctions",P="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},13986:(t,b,Z)=>{"use strict";var J=Z(12636);const S="imageProcessingDeclaration",P="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14003:(t,b,Z)=>{"use strict";var J=Z(12636);const S="imageProcessingFunctions",P="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},13993:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthDeclaration",P="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14027:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthFragment",P="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14059:(t,b,Z)=>{"use strict";var J=Z(12636);const S="logDepthVertex",P="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";J.e.IncludesShadersStore[S]||(J.e.IncludesShadersStore[S]=P)},14095:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{particlesPixelShader:()=>v});var J=Z(12636);Z(14101),Z(13986),Z(13993),Z(13996),Z(14003),Z(14012),Z(14021),Z(14027),Z(14035);const S="particlesPixelShader",P="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";J.e.ShadersStore[S]||(J.e.ShadersStore[S]=P);const v={name:S,shader:P}},14105:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{particlesVertexShader:()=>v});var J=Z(12636);Z(14112),Z(14042),Z(13993),Z(14051),Z(14055),Z(14059);const S="particlesVertexShader",P="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";J.e.ShadersStore[S]||(J.e.ShadersStore[S]=P);const v={name:S,shader:P}},14469:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{FlowGraphGLTFDataProvider:()=>P});var J=Z(14432),S=Z(14405);class P extends J.e{constructor(t){var b,Z;super();const J=t.glTF,P=(null===(b=J.animations)||void 0===b?void 0:b.map((t=>t._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",S.c,P);const v=(null===(Z=J.nodes)||void 0===Z?void 0:Z.map((t=>t._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",S.c,v)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14335:(t,b,Z)=>{"use strict";Z.d(b,{c:()=>k,f:()=>T,j:()=>M,m:()=>a});var J=Z(12735),S=Z(13214),P=Z(12775),v=Z(14342);const h=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(t,b){this._gltf=t,this._infoTree=b}convert(t){let b,Z=this._gltf,J=this._infoTree;if(!t.startsWith("/"))throw new Error("Path must start with a /");const S=t.split("/");if(S.shift(),S[S.length-1].includes(".length")){const t=S[S.length-1].split(".");S.pop(),S.push(...t)}let P=!1;for(const C of S){const S="length"===C;if(S&&!J.__array__)throw new Error(`Path ${t} is invalid`);if(J.__ignoreObjectTree__&&(P=!0),J.__array__&&!S)J=J.__array__;else if(J=J[C],!J)throw new Error(`Path ${t} is invalid`);if(!P)if(void 0===Z){if(!h.find((b=>b.regex.test(t))))throw new Error(`Path ${t} is invalid`)}else if(!S){var v;Z=null===(v=Z)||void 0===v?void 0:v[C]}(J.__target__||S)&&(b=Z)}return{object:b,info:J}}}function Y(t,b,Z,J){const S=g(t,b);return J?S[Z][J]:S[Z]}function g(t,b,Z){var J,P;return null===(J=t._data)||void 0===J||null===(P=J[(null===Z||void 0===Z?void 0:Z.fillMode)??S.c.MATERIAL_TriangleFillMode])||void 0===P?void 0:P.babylonMaterial}function I(t,b){return{offset:{componentsCount:2,type:"Vector2",get:(Z,S,P)=>{const v=Y(Z,P,t,b);return new J.Vector2(null===v||void 0===v?void 0:v.uOffset,null===v||void 0===v?void 0:v.vOffset)},getTarget:g,set:(Z,J,S,P)=>{const v=Y(J,P,t,b);v.uOffset=Z.x,v.vOffset=Z.y},getPropertyName:[()=>`${t}${b?"."+b:""}.uOffset`,()=>`${t}${b?"."+b:""}.vOffset`]},rotation:{type:"number",get:(Z,J,S)=>{var P;return null===(P=Y(Z,S,t,b))||void 0===P?void 0:P.wAng},getTarget:g,set:(Z,J,S,P)=>Y(J,P,t,b).wAng=Z,getPropertyName:[()=>`${t}${b?"."+b:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Z,S,P)=>{const v=Y(Z,P,t,b);return new J.Vector2(null===v||void 0===v?void 0:v.uScale,null===v||void 0===v?void 0:v.vScale)},getTarget:g,set:(Z,J,S,P)=>{const v=Y(J,P,t,b);v.uScale=Z.x,v.vScale=Z.y},getPropertyName:[()=>`${t}${b?"."+b:""}.uScale`,()=>`${t}${b?"."+b:""}.vScale`]}}}const r={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:t=>{var b,Z;return new J.Vector2((null===(b=t._babylonCamera)||void 0===b?void 0:b.orthoLeft)??0,(null===(Z=t._babylonCamera)||void 0===Z?void 0:Z.orthoRight)??0)},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.orthoLeft=t.x,b._babylonCamera.orthoRight=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:t=>{var b,Z;return new J.Vector2((null===(b=t._babylonCamera)||void 0===b?void 0:b.orthoBottom)??0,(null===(Z=t._babylonCamera)||void 0===Z?void 0:Z.orthoTop)??0)},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.orthoBottom=t.x,b._babylonCamera.orthoTop=t.y)},getTarget:t=>t,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.maxZ},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.nb},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.nb=t)},getTarget:t=>t,getPropertyName:[()=>"nb"]}},perspective:{aspectRatio:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.getEngine().getAspectRatio(t._babylonCamera)},getTarget:t=>t,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.fov},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.fov=t)},getTarget:t=>t,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.maxZ},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=t)},getTarget:t=>t,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:t=>{var b;return null===(b=t._babylonCamera)||void 0===b?void 0:b.nb},set:(t,b)=>{b._babylonCamera&&(b._babylonCamera.nb=t)},getTarget:t=>t,getPropertyName:[()=>"nb"]}}}},nodes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"JZ",get:t=>{var b;return null===(b=t._babylonTransformNode)||void 0===b?void 0:b.position},set:(t,b)=>{var Z;return null===(Z=b._babylonTransformNode)||void 0===Z?void 0:Z.position.S(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:t=>{var b;return null===(b=t._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion},set:(t,b)=>{var Z,J;return null===(Z=b._babylonTransformNode)||void 0===Z||null===(J=Z.rotationQuaternion)||void 0===J?void 0:J.S(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"JZ",get:t=>{var b;return null===(b=t._babylonTransformNode)||void 0===b?void 0:b.Kb},set:(t,b)=>{var Z;return null===(Z=b._babylonTransformNode)||void 0===Z?void 0:Z.Kb.S(t)},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"Kb"]},weights:{length:{type:"number",get:t=>t._numMorphTargets,getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(t,b)=>{var Z,J;return void 0!==b?null===(Z=t._primitiveBabylonMeshes)||void 0===Z||null===(J=Z[0].morphTargetManager)||void 0===J?void 0:J.getTarget(b).influence:void 0},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(t,b)=>[0],getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:t=>{var b,Z,S;return J.Matrix.Compose(null===(b=t._babylonTransformNode)||void 0===b?void 0:b.Kb,null===(Z=t._babylonTransformNode)||void 0===Z?void 0:Z.rotationQuaternion,null===(S=t._babylonTransformNode)||void 0===S?void 0:S.position)},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:t=>{var b,Z,S,P;const v=J.Matrix.Identity();let h=t.parent;for(;h&&h.parent;)h=h.parent;const C=(null===(b=t._babylonTransformNode)||void 0===b?void 0:b.position._isDirty)||(null===(Z=t._babylonTransformNode)||void 0===Z||null===(S=Z.rotationQuaternion)||void 0===S?void 0:S._isDirty)||(null===(P=t._babylonTransformNode)||void 0===P?void 0:P.Kb._isDirty);if(h){var Y;const b=null===(Y=h._babylonTransformNode)||void 0===Y?void 0:Y.sb(!0).invert();var g,I;if(b)null===(g=t._babylonTransformNode)||void 0===g||null===(I=g.sb(C))||void 0===I||I.multiplyToRef(b,v)}else t._babylonTransformNode&&v.S(t._babylonTransformNode.sb(C));return v},getTarget:t=>t._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:t=>{var b,Z;return null===(b=t._babylonTransformNode)||void 0===b||null===(Z=b.getChildren((t=>t instanceof v.b),!0)[0])||void 0===Z?void 0:Z.xb},getTarget:t=>{var b;return null===(b=t._babylonTransformNode)||void 0===b?void 0:b.getChildren((t=>t instanceof v.b),!0)[0]},set:(t,b)=>{if(b._babylonTransformNode){const Z=b._babylonTransformNode.getChildren((t=>t instanceof v.b),!0)[0];Z&&(Z.xb=t)}}},color:{type:"hZ",get:t=>{var b,Z;return null===(b=t._babylonTransformNode)||void 0===b||null===(Z=b.getChildren((t=>t instanceof v.b),!0)[0])||void 0===Z?void 0:Z.ib},getTarget:t=>{var b;return null===(b=t._babylonTransformNode)||void 0===b?void 0:b.getChildren((t=>t instanceof v.b),!0)[0]},set:(t,b)=>{if(b._babylonTransformNode){const Z=b._babylonTransformNode.getChildren((t=>t instanceof v.b),!0)[0];Z&&(Z.ib=t)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"hZ",get:(t,b,Z)=>g(t,b,Z).emissiveColor,set:(t,b,Z,J)=>g(b,Z,J).emissiveColor.S(t),getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:I("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(t,b,Z)=>{var J;return null===(J=Y(t,Z,"bumpTexture"))||void 0===J?void 0:J.level},set:(t,b,Z,J)=>{const S=Y(b,J,"bumpTexture");S&&(S.level=t)},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:I("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(t,b,Z)=>g(t,b,Z).ambientTextureStrength,set:(t,b,Z,J)=>{const S=g(b,Z,J);S&&(S.ambientTextureStrength=t)},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:I("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Fb",get:(t,b,Z)=>{const J=g(t,b,Z);return P.Fb.FromColor3(J.albedoColor,J.alpha)},set:(t,b,Z,J)=>{const S=g(b,Z,J);S.albedoColor.set(t.r,t.g,t.b),S.alpha=t.a},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:I("albedoTexture")}},metallicFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).metallic,set:(t,b,Z,J)=>{const S=g(b,Z,J);S&&(S.metallic=t)},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).roughness,set:(t,b,Z,J)=>{const S=g(b,Z,J);S&&(S.roughness=t)},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:I("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(t,b,Z)=>g(t,b,Z).anisotropy.xb,set:(t,b,Z,J)=>{g(b,Z,J).anisotropy.xb=t},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(t,b,Z)=>g(t,b,Z).anisotropy.angle,set:(t,b,Z,J)=>{g(b,Z,J).anisotropy.angle=t},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:I("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).clearCoat.xb,set:(t,b,Z,J)=>{g(b,Z,J).clearCoat.xb=t},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).clearCoat.roughness,set:(t,b,Z,J)=>{g(b,Z,J).clearCoat.roughness=t},getTarget:(t,b,Z)=>g(t,b,Z),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:I("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(t,b,Z)=>{var J;return null===(J=g(t,b,Z).clearCoat.bumpTexture)||void 0===J?void 0:J.level},getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).clearCoat.bumpTexture.level=t},extensions:{KHR_texture_transform:I("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:I("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(t,b,Z)=>g(t,b,Z).subSurface.dispersion,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.dispersion=t}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(t,b,Z)=>g(t,b,Z).emissiveIntensity,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).emissiveIntensity=t}},KHR_materials_ior:{ior:{type:"number",get:(t,b,Z)=>g(t,b,Z).indexOfRefraction,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).indexOfRefraction=t}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).iridescence.xb,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).iridescence.xb=t},iridescenceIor:{type:"number",get:(t,b,Z)=>g(t,b,Z).iridescence.indexOfRefraction,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).iridescence.indexOfRefraction=t},iridescenceTexture:{extensions:{KHR_texture_transform:I("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(t,b,Z)=>g(t,b,Z).iridescence.maximumThickness,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).iridescence.maximumThickness=t},iridescenceThicknessMinimum:{type:"number",get:(t,b,Z)=>g(t,b,Z).iridescence.minimumThickness,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).iridescence.minimumThickness=t},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:I("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"hZ",get:(t,b,Z)=>g(t,b,Z).sheen.color,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).sheen.color.S(t)},sheenColorTexture:{extensions:{KHR_texture_transform:I("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).sheen.xb,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).sheen.xb=t},sheenRoughnessTexture:{extensions:{KHR_texture_transform:I("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).metallicF0Factor,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).metallicF0Factor=t,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"hZ",get:(t,b,Z)=>g(t,b,Z).metallicReflectanceColor,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).metallicReflectanceColor.S(t),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:I("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:I("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).subSurface.refractionIntensity,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.refractionIntensity=t,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).subSurface.translucencyIntensity,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.translucencyIntensity=t},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"hZ",get:(t,b,Z)=>g(t,b,Z).subSurface.translucencyColor,getTarget:g,set:(t,b,Z,J)=>{var S;return t&&(null===(S=g(b,Z,J).subSurface.translucencyColor)||void 0===S?void 0:S.S(t))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:I("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"hZ",get:(t,b,Z)=>g(t,b,Z).subSurface.tintColor,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.tintColor.S(t)},attenuationDistance:{type:"number",get:(t,b,Z)=>g(t,b,Z).subSurface.tintColorAtDistance,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.tintColorAtDistance=t},thicknessFactor:{type:"number",get:(t,b,Z)=>g(t,b,Z).subSurface.maximumThickness,getTarget:g,set:(t,b,Z,J)=>g(b,Z,J).subSurface.maximumThickness=t},thicknessTexture:{extensions:{KHR_texture_transform:I("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,color:{type:"hZ",get:t=>{var b;return null===(b=t._babylonLight)||void 0===b?void 0:b.ib},set:(t,b)=>{var Z;return null===(Z=b._babylonLight)||void 0===Z?void 0:Z.ib.S(t)},getTarget:t=>t._babylonLight,getPropertyName:[t=>"diffuse"]},xb:{type:"number",get:t=>{var b;return null===(b=t._babylonLight)||void 0===b?void 0:b.xb},set:(t,b)=>b._babylonLight?b._babylonLight.xb=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"intensity"]},range:{type:"number",get:t=>{var b;return null===(b=t._babylonLight)||void 0===b?void 0:b.range},set:(t,b)=>b._babylonLight?b._babylonLight.range=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"range"]},spot:{innerConeAngle:{type:"number",get:t=>{var b;return null===(b=t._babylonLight)||void 0===b?void 0:b.innerAngle},set:(t,b)=>b._babylonLight?b._babylonLight.innerAngle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"innerConeAngle"]},outerConeAngle:{type:"number",get:t=>{var b;return null===(b=t._babylonLight)||void 0===b?void 0:b.angle},set:(t,b)=>b._babylonLight?b._babylonLight.angle=t:void 0,getTarget:t=>t._babylonLight,getPropertyName:[t=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonLight)),getPropertyName:[t=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonTexture)),getPropertyName:[t=>"length"]},__array__:{__target__:!0,xb:{type:"number",get:t=>{var b;return null===(b=t._babylonTexture)||void 0===b?void 0:b.level},set:(t,b)=>{b._babylonTexture&&(b._babylonTexture.level=t)},getTarget:t=>t._babylonTexture},rotation:{type:"Quaternion",get:t=>{var b;return t._babylonTexture&&J.Quaternion.FromRotationMatrix(null===(b=t._babylonTexture)||void 0===b?void 0:b.getReflectionTextureMatrix())},set:(t,b)=>{var Z;b._babylonTexture&&(null!==(Z=b._babylonTexture.et())&&void 0!==Z&&Z.useRightHandedSystem||(t=J.Quaternion.Inverse(t)),J.Matrix.FromQuaternionToRef(t,b._babylonTexture.getReflectionTextureMatrix()))},getTarget:t=>t._babylonTexture}}}}},animations:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>t._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:t=>t.length,getTarget:t=>t.map((t=>{var b;return null===(b=t.primitives[0]._instanceData)||void 0===b?void 0:b.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function M(t){return new C(t,r)}function T(t){const b=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let Z=r;for(const J of b)J&&(Z=Z[J]);if(Z&&Z.type&&Z.get)return Z}function a(t,b){const Z=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let J=r;for(const S of Z)S&&(J=J[S]);J&&J.type&&J.get&&(J.interpolation=b)}function k(t,b){const Z=t.split("/").map((t=>t.replace(/{}/g,"__array__")));let J=r;for(const S of Z)if(S){if(!J[S]){if("?"===S){J.__ignoreObjectTree__=!0;continue}J[S]={},"__array__"===S&&(J[S].__target__=!0)}J=J[S]}Object.assign(J,b)}},14347:(t,b,Z)=>{"use strict";Z.r(b),Z.d(b,{AnimationPropertyInfo:()=>Y,TransformNodeAnimationPropertyInfo:()=>g,WeightAnimationPropertyInfo:()=>I,getQuaternion:()=>h,getVector3:()=>v,getWeights:()=>C});var J=Z(13261),S=Z(12735),P=Z(14335);function v(t,b,Z,J){return S.JZ.CZ(b,Z).scaleInPlace(J)}function h(t,b,Z,J){return S.Quaternion.CZ(b,Z).scaleInPlace(J)}function C(t,b,Z,J){const S=new Array(t._numMorphTargets);for(let P=0;P<S.length;P++)S[P]=b[Z++]*J;return S}class Y{constructor(t,b,Z,J){this.type=t,this.name=b,this.getValue=Z,this.getStride=J}_buildAnimation(t,b,Z){const S=new J.d(t,this.name,b,this.type);return S.setKeys(Z),S}}class g extends Y{buildAnimations(t,b,Z,J){const S=[];return S.push({babylonAnimatable:t._babylonTransformNode,babylonAnimation:this._buildAnimation(b,Z,J)}),S}}class I extends Y{buildAnimations(t,b,Z,S){const P=[];if(t._numMorphTargets)for(let v=0;v<t._numMorphTargets;v++){const h=new J.d(`${b}_${v}`,this.name,Z,this.type);if(h.setKeys(S.map((t=>({frame:t.frame,inTangent:t.inTangent?t.inTangent[v]:void 0,value:t.value[v],outTangent:t.outTangent?t.outTangent[v]:void 0,interpolation:t.interpolation})))),t._primitiveBabylonMeshes)for(const b of t._primitiveBabylonMeshes)if(b.morphTargetManager){const t=b.morphTargetManager.getTarget(v),Z=h.clone();t.animations.push(Z),P.push({babylonAnimatable:t,babylonAnimation:Z})}}return P}}(0,P.m)("/nodes/{}/translation",[new g(J.d.ANIMATIONTYPE_VECTOR3,"position",v,(()=>3))]),(0,P.m)("/nodes/{}/rotation",[new g(J.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",h,(()=>4))]),(0,P.m)("/nodes/{}/scale",[new g(J.d.ANIMATIONTYPE_VECTOR3,"Kb",v,(()=>3))]),(0,P.m)("/nodes/{}/weights",[new I(J.d.ANIMATIONTYPE_FLOAT,"influence",C,(t=>t._numMorphTargets))])},14301:(t,b,Z)=>{"use strict";class J{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((t,b)=>{this._resolve=t,this._reject=b}))}}var S=Z(12735),P=Z(12775),v=Z(12549),h=Z(13193),C=Z(14308),Y=Z(14319),g=Z(12551),I=Z(13208),r=Z(13261),M=Z(13263),T=Z(12585),a=Z(12557),k=Z(12565);class u{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(t){this._useTextureToStoreBoneMatrices=t,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(t){this._animationPropertiesOverride=t}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(t,b,Z){this.name=t,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=S.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new g.d,this.bones=[],this._scene=Z||T.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const J=this._scene.getEngine().getCaps();this._canUseTextureForBones=J.textureFloat&&J.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((t=>!t.getParent()))}getTransformMatrices(t){if(this.needInitialSkinMatrix){if(!t)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return t._bonesTransformMatrices||this.prepare(!0),t._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(t){return this.needInitialSkinMatrix&&t._transformMatrixTexture?t._transformMatrixTexture:this._transformMatrixTexture}et(){return this._scene}toString(t){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,t){b+=", Ranges: {";let t=!0;for(const Z in this._ranges)t&&(b+=", ",t=!1),b+=Z;b+="}"}return b}getBoneIndexByName(t){for(let b=0,Z=this.bones.length;b<Z;b++)if(this.bones[b].name===t)return b;return-1}createAnimationRange(t,b,Z){if(!this._ranges[t]){this._ranges[t]=new M.c(t,b,Z);for(let J=0,S=this.bones.length;J<S;J++)this.bones[J].animations[0]&&this.bones[J].animations[0].createRange(t,b,Z)}}deleteAnimationRange(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Z=0,J=this.bones.length;Z<J;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].deleteRange(t,b);this._ranges[t]=null}getAnimationRange(t){return this._ranges[t]||null}getAnimationRanges(){const t=[];let b;for(b in this._ranges)t.push(this._ranges[b]);return t}copyAnimationRange(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!t.getAnimationRange(b))return!1;let J=!0;const S=this._getHighestAnimationFrame()+1,P={},v=t.bones;let h,C;for(C=0,h=v.length;C<h;C++)P[v[C].name]=v[C];this.bones.length!==v.length&&(a.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${v.length}`),J=!1);const Y=Z&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(C=0,h=this.bones.length;C<h;C++){const t=this.bones[C].name,v=P[t];v?J=J&&this.bones[C].copyAnimationRange(v,b,S,Z,Y):(a.c.Warn("copyAnimationRange: not same rig, missing source bone "+t),J=!1)}const g=t.getAnimationRange(b);return g&&(this._ranges[b]=new M.c(b,g.from+S,g.to+S)),J}returnToRest(){for(const t of this.bones)-1!==t._index&&t.returnToRest()}_getHighestAnimationFrame(){let t=0;for(let b=0,Z=this.bones.length;b<Z;b++)if(this.bones[b].animations[0]){const Z=this.bones[b].animations[0].getHighestFrame();t<Z&&(t=Z)}return t}beginAnimation(t,b,Z,J){const S=this.getAnimationRange(t);return S?this._scene.beginAnimation(this,S.from,S.to,b,Z,J):null}static MakeAnimationAdditive(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Z=arguments.length>2?arguments[2]:void 0;const J=t.getAnimationRange(Z);if(!J)return null;const S=t._scene.getAllAnimatablesByTarget(t);let P=null;for(let h=0;h<S.length;h++){const t=S[h];if(t.fromFrame===(null===J||void 0===J?void 0:J.from)&&t.toFrame===(null===J||void 0===J?void 0:J.to)){P=t;break}}const v=t.getAnimatables();for(let h=0;h<v.length;h++){const t=v[h].animations;if(t)for(let J=0;J<t.length;J++)r.d.MakeAnimationAdditive(t[J],b,Z)}return P&&(P.isAdditive=!0),t}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(t){this._meshesWithPoseMatrix.push(t)}_unregisterMeshWithPoseMatrix(t){const b=this._meshesWithPoseMatrix.indexOf(t);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(t,b){this.onBeforeComputeObservable.notifyObservers(this);for(let Z=0;Z<this.bones.length;Z++){const J=this.bones[Z];J._childUpdateId++;const S=J.getParent();if(S?J.getLocalMatrix().multiplyToRef(S.getFinalMatrix(),J.getFinalMatrix()):b?J.getLocalMatrix().multiplyToRef(b,J.getFinalMatrix()):J.getFinalMatrix().S(J.getLocalMatrix()),-1!==J._index){const b=null===J._index?Z:J._index;J.getAbsoluteInverseBindMatrix().multiplyToArray(J.getFinalMatrix(),t,16*b)}}this._identity.copyToArray(t,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const t=this.et().getRenderId();if(this._currentRenderId===t)return;this._currentRenderId=t}if(this._numBonesWithLinkedTransformNode>0)for(const t of this.bones)if(t._linkedTransformNode){const b=t._linkedTransformNode;t.position=b.position,b.rotationQuaternion?t.rotationQuaternion=b.rotationQuaternion:t.rotation=b.rotation,t.Kb=b.Kb}if(this.needInitialSkinMatrix)for(const t of this._meshesWithPoseMatrix){const b=t.getPoseMatrix();let Z=this._isDirty;if(t._bonesTransformMatrices&&t._bonesTransformMatrices.length===16*(this.bones.length+1)||(t._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Z=!0),Z){if(this._synchronizedWithMesh!==t){this._synchronizedWithMesh=t;for(const t of this.bones)if(!t.getParent()){t.getBindMatrix().multiplyToRef(b,S.TmpVectors.Matrix[1]),t._updateAbsoluteBindMatrices(S.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);t._transformMatrixTexture&&t._transformMatrixTexture.getSize().width===b||(t._transformMatrixTexture&&t._transformMatrixTexture.dispose(),t._transformMatrixTexture=I.c.CreateRGBATexture(t._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(t._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&t._transformMatrixTexture&&t._transformMatrixTexture.update(t._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=I.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let t=0;t<this.bones.length;t++)this._animatables.push(this.bones[t])}return this._animatables}clone(t,b){const Z=new u(t,b||t,this._scene);Z.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let J=0;J<this.bones.length;J++){const t=this.bones[J];let b=null;const S=t.getParent();if(S){const t=this.bones.indexOf(S);b=Z.bones[t]}const P=new Y.c(t.name,Z,b,t.getBindMatrix().clone(),t.getRestMatrix().clone());P._index=t._index,t._linkedTransformNode&&P.linkTransformNode(t._linkedTransformNode),k.e.DeepCopy(t.animations,P.animations)}if(this._ranges){Z._ranges={};for(const t in this._ranges){const b=this._ranges[t];b&&(Z._ranges[t]=b.clone())}}return this._isDirty=!0,Z.prepare(!0),Z}enableBlending(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const b of this.bones)for(const Z of b.animations)Z.enableBlending=!0,Z.blendingSpeed=t}dispose(){if(this._meshesWithPoseMatrix.length=0,this.et().stopAnimation(this),this.et().removeSkeleton(this),this._parentContainer){const t=this._parentContainer.skeletons.indexOf(this);t>-1&&this._parentContainer.skeletons.splice(t,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.jb()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){var b;const J=this.bones[Z],S=J.getParent(),P={parentBoneIndex:S?this.bones.indexOf(S):-1,index:J.getIndex(),name:J.name,id:J.id,matrix:J.getBindMatrix().jb(),rest:J.getRestMatrix().jb(),linkedTransformNodeId:null===(b=J.getTransformNode())||void 0===b?void 0:b.id};t.bones.push(P),J.length&&(P.length=J.length),J.metadata&&(P.metadata=J.metadata),J.animations&&J.animations.length>0&&(P.animation=J.animations[0].serialize()),t.ranges=[];for(const b in this._ranges){const Z=this._ranges[b];if(!Z)continue;const J={};J.name=b,J.from=Z.from,J.to=Z.to,t.ranges.push(J)}}return t}static Parse(t,b){const Z=new u(t.name,t.id,b);let J;for(t.dimensionsAtRest&&(Z.dimensionsAtRest=S.JZ.CZ(t.dimensionsAtRest)),Z.needInitialSkinMatrix=t.needInitialSkinMatrix,J=0;J<t.bones.length;J++){const b=t.bones[J],P=t.bones[J].index;let v=null;b.parentBoneIndex>-1&&(v=Z.bones[b.parentBoneIndex]);const h=b.rest?S.Matrix.CZ(b.rest):null,C=new Y.c(b.name,Z,v,S.Matrix.CZ(b.matrix),h,null,P);void 0!==b.id&&null!==b.id&&(C.id=b.id),b.length&&(C.length=b.length),b.metadata&&(C.metadata=b.metadata),b.animation&&C.animations.push(r.d.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(Z._hasWaitingData=!0,C._waitingTransformNodeId=b.linkedTransformNodeId)}if(t.ranges)for(J=0;J<t.ranges.length;J++){const b=t.ranges[J];Z.createAnimationRange(b.name,b.from,b.to)}return Z}computeAbsoluteMatrices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||t)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(t)}getPoseMatrix(){let t=null;return this._meshesWithPoseMatrix.length>0&&(t=this._meshesWithPoseMatrix[0].getPoseMatrix()),t}sortBones(){const t=[],b=new Array(this.bones.length);for(let Z=0;Z<this.bones.length;Z++)this._sortBones(Z,t,b);this.bones=t}_sortBones(t,b,Z){if(Z[t])return;Z[t]=!0;const J=this.bones[t];if(!J)return;void 0===J._index&&(J._index=t);const S=J.getParent();S&&this._sortBones(this.bones.indexOf(S),b,Z),b.push(J)}setCurrentPoseAsRest(){for(const t of this.bones)t.setCurrentPoseAsRest()}}var l=Z(13052),U=Z(13225),E=Z(12716),c=Z(13152),H=Z(12800),o=Z(13195),O=Z(13159),p=Z(13184),e=Z(13270),W=Z(12826),j=Z(14269);class V{set areUpdatesFrozen(t){t?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new W.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,t||(t=T.e.LastCreatedScene),this._scene=t,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const t=this._scene.getEngine().getCaps();this._canUseTextureForTargets=t.canUseGLVertexID&&t.textureFloat&&t.maxVertexTextureImageUnits>0&&t.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return V.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?V.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(t){this._numMaxInfluencers!==t&&(this._numMaxInfluencers=t,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(t){this._useTextureToStoreTargets!==t&&(this._useTextureToStoreTargets=t,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var t;return V.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(t=this._scene)&&void 0!==t&&t.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(t){return this._activeTargets.data[t]}getTarget(t){return this._targets[t]}getTargetByName(t){for(const b of this._targets)if(b.name===t)return b;return null}addTarget(t){this._targets.push(t),this._targetInfluenceChangedObservers.push(t.onInfluenceChanged.add((t=>{this.areUpdatesFrozen&&t&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(t)}))),this._targetDataLayoutChangedObservers.push(t._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(t){const b=this._targets.indexOf(t);b>=0&&(this._targets.splice(b,1),t.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),t._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(t)}_bind(t){t.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),t.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),t.setTexture("morphTargets",this._targetStoreTexture),t.setInt("morphTargetCount",this.numInfluencers)}clone(){const t=new V(this._scene);for(const b of this._targets)t.addTarget(b.clone());return t.enablePositionMorphing=this.enablePositionMorphing,t.enableNormalMorphing=this.enableNormalMorphing,t.enableTangentMorphing=this.enableTangentMorphing,t.enableUVMorphing=this.enableUVMorphing,t.enableUV2Morphing=this.enableUV2Morphing,t.enableColorMorphing=this.enableColorMorphing,t}serialize(){const t={};t.id=this.uniqueId,t.targets=[];for(const b of this._targets)t.targets.push(b.serialize());return t}_syncActiveTargets(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const b=!!this._targetStoreTexture,Z=this.isUsingTextureForTargets;(this._mustSynchronize||b!==Z)&&(this._mustSynchronize=!1,this.synchronize());let J=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let S=-1;for(const P of this._targets)if(S++,0!==P.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=V.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(P),this._morphTargetTextureIndices[J]=S,this._tempInfluences[J++]=P.influence}this._morphTargetTextureIndices.length!==J&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,J)),this._influences&&this._influences.length===J||(this._influences=new Float32Array(J));for(let P=0;P<J;P++)this._influences[P]=this._tempInfluences[P];if(t&&this._scene)for(const P of this._scene.meshes)P.morphTargetManager===this&&(Z?P._markSubMeshesAsAttributesDirty():P._syncGeometryWithMorphTargetManager())}synchronize(){var t;if(!this._scene||this.areUpdatesFrozen)return;const b=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(t=this._targetStoreTexture)||void 0===t||t.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>b.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Z of this._targets){this._supportsPositions=this._supportsPositions&&Z.hasPositions,this._supportsNormals=this._supportsNormals&&Z.hasNormals,this._supportsTangents=this._supportsTangents&&Z.hasTangents,this._supportsUVs=this._supportsUVs&&Z.hasUVs,this._supportsUV2s=this._supportsUV2s&&Z.hasUV2s,this._supportsColors=this._supportsColors&&Z.hasColors;const t=Z.vertexCount;if(0===this._vertexCount)this._vertexCount=t;else if(this._vertexCount!==t)return void a.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Z.name}": ${t}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const t=b.getCaps().maxTextureSize;this._textureWidth>t&&(this._textureHeight=Math.ceil(this._textureWidth/t),this._textureWidth=t);const Z=this._targets.length,J=new Float32Array(Z*this._textureWidth*this._textureHeight*4);let S=0;for(let b=0;b<Z;b++){const t=this._targets[b],Z=t.getPositions(),P=t.getNormals(),v=t.getUVs(),h=t.getTangents(),C=t.getUV2s(),Y=t.getColors();S=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)this._supportsPositions&&Z&&(J[S]=Z[3*b],J[S+1]=Z[3*b+1],J[S+2]=Z[3*b+2],S+=4),this._supportsNormals&&P&&(J[S]=P[3*b],J[S+1]=P[3*b+1],J[S+2]=P[3*b+2],S+=4),this._supportsUVs&&v&&(J[S]=v[2*b],J[S+1]=v[2*b+1],S+=4),this._supportsTangents&&h&&(J[S]=h[3*b],J[S+1]=h[3*b+1],J[S+2]=h[3*b+2],S+=4),this._supportsUV2s&&C&&(J[S]=C[2*b],J[S+1]=C[2*b+1],S+=4),this._supportsColors&&Y&&(J[S]=Y[4*b],J[S+1]=Y[4*b+1],J[S+2]=Y[4*b+2],J[S+3]=Y[4*b+3],S+=4)}this._targetStoreTexture=j.b.CreateRGBATexture(J,this._textureWidth,this._textureHeight,Z,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Z of this._scene.meshes)Z.morphTargetManager===this&&Z._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const t=this._parentContainer.morphTargetManagers.indexOf(this);t>-1&&this._parentContainer.morphTargetManagers.splice(t,1),this._parentContainer=null}for(const t of this._targets)this._scene.stopAnimation(t)}}static Parse(t,b){const Z=new V(b);for(const J of t.targets)Z.addTarget(e.d.Parse(J,b));return Z}}V.EnableTextureStorage=!0,V.MaxActiveMorphTargetsInVertexAttributeMode=8,V.ConstantTargetCountForTextureMode=0;var n=Z(14324),y=Z(12593),d=Z(13079);const s=new Map,q=s;function Q(t,b,Z){N(t)&&a.c.Warn(`Extension with the name '${t}' already exists`),s.set(t,{isGLTFExtension:b,factory:Z})}function N(t){return s.delete(t)}var A=Z(14335),K=Z(13330),L=Z(12810);class F{static Get(t,b,Z){if(!b||void 0==Z||!b[Z])throw new Error(`${t}: Failed to find index (${Z})`);return b[Z]}static TryGet(t,b){return t&&void 0!=b&&t[b]?t[b]:null}static Assign(t){if(t)for(let b=0;b<t.length;b++)t[b].index=b}}function B(t){if(t.min&&t.max){const b=t.min,Z=t.max,J=S.TmpVectors.JZ[0].Ab(b[0],b[1],b[2]),P=S.TmpVectors.JZ[1].Ab(Z[0],Z[1],Z[2]);if(t.normalized&&5126!==t.componentType){let b=1;switch(t.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const Z=1/b;J.scaleInPlace(Z),P.scaleInPlace(Z)}return new d.d(J,P)}return null}class X{static RegisterExtension(t,b){Q(t,!1,b)}static UnregisterExtension(t){return N(t)}get pb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((t=>t.dispose&&t.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(t,b,Z,J,S,P){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=b,this._assetContainer=Z,this._loadData(J);let P=null;if(t){const b={};if(this._gltf.nodes)for(const t of this._gltf.nodes)t.name&&(b[t.name]=t.index);P=(t instanceof Array?t:[t]).map((t=>{const Z=b[t];if(void 0===Z)throw new Error(`Failed to find node '${t}'`);return Z}))}return await this._loadAsync(S,v,P,(()=>({meshes:this._getMeshes(),Lr:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=t,this._loadData(b),await this._loadAsync(Z,S,null,(()=>{}))}async _loadAsync(t,b,Z,J){return await Promise.resolve().then((async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&b?t:`${t}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const S=`${n.m[n.m.LOADING]} => ${n.m[n.m.READY]}`,P=`${n.m[n.m.LOADING]} => ${n.m[n.m.COMPLETE]}`;this._parent._startPerformanceCounter(S),this._parent._startPerformanceCounter(P),this._parent._setState(n.m.LOADING),this._extensionsOnLoading();const h=new Array;if(!this.parent.loadOnlyMaterials)if(Z)h.push(this.loadSceneAsync("/nodes",{nodes:Z,index:-1}));else if(void 0!=this._gltf.PZ||this._gltf.scenes&&this._gltf.scenes[0]){const t=F.Get("/scene",this._gltf.scenes,this._gltf.PZ||0);h.push(this.loadSceneAsync(`/scenes/${t.index}`,t))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let t=0;t<this._gltf.materials.length;++t){const b=this._gltf.materials[t],Z="/materials/"+t,J=l.c.TriangleFillMode;h.push(this._loadMaterialAsync(Z,b,null,J,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&h.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&h.push(this._compileShadowGeneratorsAsync());const C=Promise.all(h).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.uC(!0);for(const t of this._babylonScene.materials){const b=t;void 0!==b.maxSimultaneousLights&&(b.maxSimultaneousLights=Math.max(b.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(n.m.READY),this._skipStartAnimationStep||this._startAnimations(),J()}));return await C.then((t=>(this._parent._endPerformanceCounter(S),v.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(P),this._parent._setState(n.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(t=>{this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()}))})),t)))})).catch((t=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(t),this._parent.onErrorObservable.clear(),this.dispose()),t}))}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const Z=b[0];(Z.byteLength<t.bin.byteLength-3||Z.byteLength>t.bin.byteLength)&&a.c.Warn(`Binary buffer length (${Z.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else a.c.Warn("Unexpected BIN chunk")}}_setupData(){if(F.Assign(this._gltf.accessors),F.Assign(this._gltf.animations),F.Assign(this._gltf.buffers),F.Assign(this._gltf.bufferViews),F.Assign(this._gltf.cameras),F.Assign(this._gltf.images),F.Assign(this._gltf.materials),F.Assign(this._gltf.meshes),F.Assign(this._gltf.nodes),F.Assign(this._gltf.samplers),F.Assign(this._gltf.scenes),F.Assign(this._gltf.skins),F.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const Z of this._gltf.nodes)if(Z.children)for(const b of Z.children)t[b]=Z.index;const b=this._createRootNode();for(const Z of this._gltf.nodes){const J=t[Z.index];Z.parent=void 0===J?b:this._gltf.nodes[J]}}}async _loadExtensionsAsync(){const t=[];if(q.forEach(((b,Z)=>{var J;!1===(null===(J=this.parent.extensionOptions[Z])||void 0===J?void 0:J.enabled)?b.isGLTFExtension&&this.isExtensionUsed(Z)&&a.c.Warn(`Extension ${Z} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(Z)||t.push((async()=>{const t=await b.factory(this);return t.name!==Z&&a.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${t.name} !== ${Z}`),this._parent.onExtensionLoadedObservable.notifyObservers(t),t})())})),this._extensions.push(...await Promise.all(t)),this._extensions.sort(((t,b)=>(t.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Z of this._gltf.extensionsRequired){if(!this._extensions.some((t=>t.name===Z&&t.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[Z])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${Z} is disabled`);throw new Error(`Required extension ${Z} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new p.b("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.uC(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case n.i.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],X._LoadTransform(b,this._rootBabylonMesh));break;case n.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),b}loadSceneAsync(t,b){const Z=this._extensionsLoadSceneAsync(t,b);if(Z)return Z;const J=new Array;if(this.logOpen(`${t} ${b.name||""}`),b.nodes)for(const S of b.nodes){const b=F.Get(`${t}/nodes/${S}`,this._gltf.nodes,S);J.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(t=>{t.parent=this._rootBabylonMesh})))}for(const S of this._postSceneLoadActions)S();return J.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(J).then((()=>{}))}_forEachPrimitive(t,b){if(t._primitiveBabylonMeshes)for(const Z of t._primitiveBabylonMeshes)b(Z)}_getGeometries(){const t=[],b=this._gltf.nodes;if(b)for(const Z of b)this._forEachPrimitive(Z,(b=>{const Z=b.qb;Z&&-1===t.indexOf(Z)&&t.push(Z)}));return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof O.b&&t.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const Z of b)this._forEachPrimitive(Z,(b=>{t.push(b)}));return t}_getTransformNodes(){const t=[],b=this._gltf.nodes;if(b)for(const Z of b)Z._babylonTransformNode&&"Gb"===Z._babylonTransformNode.getClassName()&&t.push(Z._babylonTransformNode),Z._babylonTransformNodeForSkin&&t.push(Z._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],b=this._gltf.skins;if(b)for(const Z of b)Z._data&&t.push(Z._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],b=this._gltf.animations;if(b)for(const Z of b)Z._babylonAnimationGroup&&t.push(Z._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case n.g.NONE:break;case n.g.FIRST:{const t=this._getAnimationGroups();0!==t.length&&t[0].start(!0);break}case n.g.ALL:{const t=this._getAnimationGroups();for(const b of t)b.start(!0);break}default:return void a.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadNodeAsync(t,b,Z);if(J)return J;if(b._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const S=new Array;this.logOpen(`${t} ${b.name||""}`);const P=J=>{if(X.AddPointerMetadata(J,t),X._LoadTransform(b,J),void 0!=b.camera){const Z=F.Get(`${t}/camera`,this._gltf.cameras,b.camera);S.push(this.loadCameraAsync(`/cameras/${Z.index}`,Z,(t=>{t.parent=J,this._babylonScene.useRightHandedSystem||(J.Kb.x=-1)})))}if(b.children)for(const Z of b.children){const b=F.Get(`${t}/children/${Z}`,this._gltf.nodes,Z);S.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(t=>{t.parent=J})))}Z(J)},v=void 0!=b.mesh,h=this._parent.loadSkins&&void 0!=b.skin;if(!v||h){const t=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new c.e(t,this._babylonScene);Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=Z:b._babylonTransformNodeForSkin=Z,P(Z)}if(v)if(h){const Z=F.Get(`${t}/mesh`,this._gltf.meshes,b.mesh);S.push(this._loadMeshAsync(`/meshes/${Z.index}`,b,Z,(Z=>{const J=b._babylonTransformNodeForSkin;Z.metadata=(0,K.d)(J.metadata,Z.metadata||{});const P=F.Get(`${t}/skin`,this._gltf.skins,b.skin);S.push(this._loadSkinAsync(`/skins/${P.index}`,b,P,(t=>{this._forEachPrimitive(b,(b=>{b.skeleton=t})),this._postSceneLoadActions.push((()=>{if(void 0!=P.skeleton){const t=F.Get(`/skins/${P.index}/skeleton`,this._gltf.nodes,P.skeleton).parent;b.index===t.index?Z.parent=J.parent:Z.parent=t._babylonTransformNode}else Z.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:J,skinnedNode:Z})}))})))})))}else{const Z=F.Get(`${t}/mesh`,this._gltf.meshes,b.mesh);S.push(this._loadMeshAsync(`/meshes/${Z.index}`,b,Z,P))}return this.logClose(),Promise.all(S).then((()=>(this._forEachPrimitive(b,(t=>{const b=t;!b.isAnInstance&&b.qb&&b.qb.useBoundingInfoFromGeometry?t.Qt():t.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(t,b,Z,J){const S=Z.primitives;if(!S||!S.length)throw new Error(`${t}: Primitives are missing`);void 0==S[0].index&&F.Assign(S);const P=new Array;this.logOpen(`${t} ${Z.name||""}`);const v=b.name||`node${b.index}`;if(1===S.length){const J=Z.primitives[0];P.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${J.index}`,v,b,Z,J,(t=>{b._babylonTransformNode=t,b._primitiveBabylonMeshes=[t]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new c.e(v,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const J of S)P.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${J.index}`,`${v}_primitive${J.index}`,b,Z,J,(t=>{t.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(t)})))}return J(b._babylonTransformNode),this.logClose(),Promise.all(P).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(t,b,Z,J,S,P){const v=this._extensionsLoadMeshPrimitiveAsync(t,b,Z,J,S,P);if(v)return v;this.logOpen(`${t}`);const h=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Z.skin&&!J.primitives[0].targets;let C,Y;if(h&&S._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=S._instanceData.babylonSourceMesh.createInstance(b),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y=S._instanceData.promise;else{const P=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new p.b(b,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.sideOrientation=this._babylonScene.useRightHandedSystem?l.c.CounterClockWiseSideOrientation:l.c.ClockWiseSideOrientation,this._createMorphTargets(t,Z,J,S,v),P.push(this._loadVertexDataAsync(t,S,v).then((async b=>await this._loadMorphTargetsAsync(t,S,v,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.st(v),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const g=X._GetDrawMode(t,S.mode);if(void 0==S.material){let t=this._defaultBabylonMaterialData[g];t||(t=this._createDefaultMaterial("__GLTFLoader._default",g),this._parent.onMaterialLoadedObservable.notifyObservers(t),this._defaultBabylonMaterialData[g]=t),v.material=t}else if(!this.parent.skipMaterials){const b=F.Get(`${t}/material`,this._gltf.materials,S.material);P.push(this._loadMaterialAsync(`/materials/${b.index}`,b,v,g,(t=>{v.material=t})))}Y=Promise.all(P),h&&(S._instanceData={babylonSourceMesh:v,promise:Y}),C=v}return X.AddPointerMetadata(C,t),this._parent.onMeshLoadedObservable.notifyObservers(C),P(C),this.logClose(),Y.then((()=>C))}_loadVertexDataAsync(t,b,Z){const J=this._extensionsLoadVertexDataAsync(t,b,Z);if(J)return J;const S=b.attributes;if(!S)throw new Error(`${t}: Attributes are missing`);const P=new Array,v=new o.c(Z.name,this._babylonScene);if(void 0==b.indices)Z.isUnIndexed=!0;else{const Z=F.Get(`${t}/indices`,this._gltf.accessors,b.indices);P.push(this._loadIndicesAccessorAsync(`/accessors/${Z.index}`,Z).then((t=>{v.setIndices(t)})))}const h=(b,J,h)=>{if(void 0==S[b])return;Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(J)&&Z._delayInfo.push(J);const C=F.Get(`${t}/attributes/${b}`,this._gltf.accessors,S[b]);P.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,J).then((t=>{if(t.getKind()===H.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Z.skeleton){const t=B(C);t&&(v._boundingInfo=t,v.useBoundingInfoFromGeometry=!0)}v.setVerticesBuffer(t,C.count)}))),J==H.g.MatricesIndicesExtraKind&&(Z.numBoneInfluencers=8),h&&h(C)};return h("POSITION",H.g.PositionKind),h("NORMAL",H.g.NormalKind),h("TANGENT",H.g.TangentKind),h("TEXCOORD_0",H.g.UVKind),h("TEXCOORD_1",H.g.UV2Kind),h("TEXCOORD_2",H.g.UV3Kind),h("TEXCOORD_3",H.g.UV4Kind),h("TEXCOORD_4",H.g.UV5Kind),h("TEXCOORD_5",H.g.UV6Kind),h("JOINTS_0",H.g.MatricesIndicesKind),h("WEIGHTS_0",H.g.MatricesWeightsKind),h("JOINTS_1",H.g.MatricesIndicesExtraKind),h("WEIGHTS_1",H.g.MatricesWeightsExtraKind),h("COLOR_0",H.g.ColorKind,(t=>{"VEC4"===t.type&&(Z.hasVertexAlpha=!0)})),Promise.all(P).then((()=>v))}_createMorphTargets(t,b,Z,J,S){if(!J.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=J.targets.length;else if(J.targets.length!==b._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const P=Z.extras?Z.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,S.morphTargetManager=new V(this._babylonScene),S.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S.morphTargetManager.areUpdatesFrozen=!0;for(let v=0;v<J.targets.length;v++){const t=b.weights?b.weights[v]:Z.weights?Z.weights[v]:0,J=P?P[v]:`morphTarget${v}`;S.morphTargetManager.addTarget(new e.d(J,t,S.et()))}}_loadMorphTargetsAsync(t,b,Z,J){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const S=new Array,P=Z.morphTargetManager;for(let v=0;v<P.numTargets;v++){const Z=P.getTarget(v);S.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${v}`,J,b.targets[v],Z))}return Promise.all(S).then((()=>{P.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(t,b,Z,J){const S=new Array,P=(J,P,v)=>{if(void 0==Z[J])return;const h=b.getVertexBuffer(P);if(!h)return;const C=F.Get(`${t}/${J}`,this._gltf.accessors,Z[J]);S.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((t=>{v(h,t)})))};return P("POSITION",H.g.PositionKind,((t,b)=>{const Z=new Float32Array(b.length);t.forEach(b.length,((t,J)=>{Z[J]=b[J]+t})),J.setPositions(Z)})),P("NORMAL",H.g.NormalKind,((t,b)=>{const Z=new Float32Array(b.length);t.forEach(Z.length,((t,J)=>{Z[J]=b[J]+t})),J.setNormals(Z)})),P("TANGENT",H.g.TangentKind,((t,b)=>{const Z=new Float32Array(b.length/3*4);let S=0;t.forEach(b.length/3*4,((t,J)=>{(J+1)%4!==0&&(Z[S]=b[S]+t,S++)})),J.setTangents(Z)})),P("TEXCOORD_0",H.g.UVKind,((t,b)=>{const Z=new Float32Array(b.length);t.forEach(b.length,((t,J)=>{Z[J]=b[J]+t})),J.setUVs(Z)})),P("TEXCOORD_1",H.g.UV2Kind,((t,b)=>{const Z=new Float32Array(b.length);t.forEach(b.length,((t,J)=>{Z[J]=b[J]+t})),J.setUV2s(Z)})),P("COLOR_0",H.g.ColorKind,((b,Z)=>{let S=null;const P=b.getSize();if(3===P){S=new Float32Array(Z.length/3*4),b.forEach(Z.length,((t,b)=>{const J=Math.floor(b/3),P=b%3;S[4*J+P]=Z[3*J+P]+t}));for(let t=0;t<Z.length/3;++t)S[4*t+3]=1}else{if(4!==P)throw new Error(`${t}: Invalid number of components (${P}) for COLOR_0 attribute`);S=new Float32Array(Z.length),b.forEach(Z.length,((t,b)=>{S[b]=Z[b]+t}))}J.setColors(S)})),await Promise.all(S).then((()=>{}))}static _LoadTransform(t,b){if(void 0!=t.skin)return;let Z=S.JZ.Zero(),J=S.Quaternion.Identity(),P=S.JZ.One();if(t.matrix){S.Matrix.CZ(t.matrix).decompose(P,J,Z)}else t.translation&&(Z=S.JZ.CZ(t.translation)),t.rotation&&(J=S.Quaternion.CZ(t.rotation)),t.scale&&(P=S.JZ.CZ(t.scale));b.position=Z,b.rotationQuaternion=J,b.Kb=P}_loadSkinAsync(t,b,Z,J){if(!this._parent.loadSkins)return Promise.resolve();const S=this._extensionsLoadSkinAsync(t,b,Z);if(S)return S;if(Z._data)return J(Z._data.babylonSkeleton),Z._data.promise;const P=`skeleton${Z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new u(Z.name||P,P,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,Z,v);const h=this._loadSkinInverseBindMatricesDataAsync(t,Z).then((t=>{this._updateBoneMatrices(v,t)}));return Z._data={babylonSkeleton:v,promise:h},J(v),h}_loadBones(t,b,Z){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Z=this._findSkeletonRootNode(`${t}/joints`,b.joints);if(Z)if(void 0===b.skeleton)b.skeleton=Z.index;else{const J=(t,b)=>{for(;b.parent;b=b.parent)if(b.parent===t)return!0;return!1},S=F.Get(`${t}/skeleton`,this._gltf.nodes,b.skeleton);S===Z||J(S,Z)||(a.c.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=Z.index)}else a.c.Warn(`${t}: Failed to find common root`)}const J={};for(const S of b.joints){const P=F.Get(`${t}/joints/${S}`,this._gltf.nodes,S);this._loadBone(P,b,Z,J)}}_findSkeletonRootNode(t,b){if(0===b.length)return null;const Z={};for(const S of b){const b=[];let J=F.Get(`${t}/${S}`,this._gltf.nodes,S);for(;-1!==J.index;)b.unshift(J),J=J.parent;Z[S]=b}let J=null;for(let S=0;;++S){let t=Z[b[0]];if(S>=t.length)return J;const P=t[S];for(let v=1;v<b.length;++v)if(t=Z[b[v]],S>=t.length||P!==t[S])return J;J=P}}_loadBone(t,b,Z,J){t._isJoint=!0;let S=J[t.index];if(S)return S;let P=null;t.index!==b.skeleton&&(t.parent&&-1!==t.parent.index?P=this._loadBone(t.parent,b,Z,J):void 0!==b.skeleton&&a.c.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const v=b.joints.indexOf(t.index);return S=new Y.c(t.name||`joint${t.index}`,Z,P,this._getNodeMatrix(t),null,null,v),J[t.index]=S,this._postSceneLoadActions.push((()=>{S.linkTransformNode(t._babylonTransformNode)})),S}_loadSkinInverseBindMatricesDataAsync(t,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const Z=F.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z)}_updateBoneMatrices(t,b){for(const Z of t.bones){const t=S.Matrix.Identity(),J=Z._index;b&&-1!==J&&(S.Matrix.FromArrayToRef(b,16*J,t),t.invertToRef(t));const P=Z.getParent();P&&t.multiplyToRef(P.getAbsoluteInverseBindMatrix(),t),Z.yb(t,!1,!1),Z._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?S.Matrix.CZ(t.matrix):S.Matrix.Compose(t.scale?S.JZ.CZ(t.scale):S.JZ.One(),t.rotation?S.Quaternion.CZ(t.rotation):S.Quaternion.Identity(),t.translation?S.JZ.CZ(t.translation):S.JZ.Zero())}loadCameraAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadCameraAsync(t,b,Z);if(J)return J;const P=new Array;this.logOpen(`${t} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new C.e(b.name||`camera${b.index}`,S.JZ.Zero(),this._babylonScene,!1);switch(v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonCamera=v,v.setTarget(new S.JZ(0,0,-1)),b.type){case"perspective":{const Z=b.perspective;if(!Z)throw new Error(`${t}: Camera perspective properties are missing`);v.fov=Z.yfov,v.nb=Z.znear,v.maxZ=Z.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);v.mode=h.e.ORTHOGRAPHIC_CAMERA,v.orthoLeft=-b.orthographic.xmag,v.orthoRight=b.orthographic.xmag,v.orthoBottom=-b.orthographic.ymag,v.orthoTop=b.orthographic.ymag,v.nb=b.orthographic.znear,v.maxZ=b.orthographic.zfar;break;default:throw new Error(`${t}: Invalid camera type (${b.type})`)}return X.AddPointerMetadata(v,t),this._parent.onCameraLoadedObservable.notifyObservers(v),Z(v),this.logClose(),Promise.all(P).then((()=>v))}_loadAnimationsAsync(){const t=this._gltf.animations;if(!t)return Promise.resolve();const b=new Array;for(let Z=0;Z<t.length;Z++){const J=t[Z];b.push(this.loadAnimationAsync(`/animations/${J.index}`,J).then((t=>{0===t.targetedAnimations.length&&t.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(t,b){const J=this._extensionsLoadAnimationAsync(t,b);return J||Z.e(78).then(Z.bind(Z,15903)).then((Z=>{let{AnimationGroup:J}=Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const S=new J(b.name||`animation${b.index}`,this._babylonScene);S._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=S;const P=new Array;F.Assign(b.channels),F.Assign(b.samplers);for(const v of b.channels)P.push(this._loadAnimationChannelAsync(`${t}/channels/${v.index}`,t,b,v,((t,b)=>{t.animations=t.animations||[],t.animations.push(b),S.addTargetedAnimation(b,t)})));return Promise.all(P).then((()=>(S.normalize(0),S)))}))}async _loadAnimationChannelAsync(t,b,J,S,P){const v=this._extensionsLoadAnimationChannelAsync(t,b,J,S,P);if(v)return await v;if(void 0==S.target.node)return await Promise.resolve();const h=F.Get(`${t}/target/node`,this._gltf.nodes,S.target.node),C=S.target.path,Y="weights"===C;if(Y&&!h._numMorphTargets||!Y&&!h._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!Y&&!h._isJoint)return await Promise.resolve();let g;switch(await Promise.resolve().then(Z.bind(Z,14347)),C){case"translation":var I;g=null===(I=(0,A.f)("/nodes/{}/translation"))||void 0===I?void 0:I.interpolation;break;case"rotation":var r;g=null===(r=(0,A.f)("/nodes/{}/rotation"))||void 0===r?void 0:r.interpolation;break;case"scale":var M;g=null===(M=(0,A.f)("/nodes/{}/scale"))||void 0===M?void 0:M.interpolation;break;case"weights":var T;g=null===(T=(0,A.f)("/nodes/{}/weights"))||void 0===T?void 0:T.interpolation;break;default:throw new Error(`${t}/target/path: Invalid value (${S.target.path})`)}if(!g)throw new Error(`${t}/target/path: Could not find interpolation properties for target path (${S.target.path})`);const a={object:h,info:g};return await this._loadAnimationChannelFromTargetInfoAsync(t,b,J,S,a,P)}_loadAnimationChannelFromTargetInfoAsync(t,b,Z,J,S,P){const v=this.parent.targetFps,h=1/v,C=F.Get(`${t}/sampler`,Z.samplers,J.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${J.sampler}`,C).then((t=>{let b=0;const C=S.object,Y=S.info;for(const S of Y){const Y=S.getStride(C),g=t.input,I=t.output,r=new Array(g.length);let M=0;switch(t.interpolation){case"STEP":for(let t=0;t<g.length;t++){const b=S.getValue(C,I,M,1);M+=Y,r[t]={frame:g[t]*v,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let t=0;t<g.length;t++){const b=S.getValue(C,I,M,h);M+=Y;const Z=S.getValue(C,I,M,1);M+=Y;const J=S.getValue(C,I,M,h);M+=Y,r[t]={frame:g[t]*v,inTangent:b,value:Z,outTangent:J}}break;case"LINEAR":for(let t=0;t<g.length;t++){const b=S.getValue(C,I,M,1);M+=Y,r[t]={frame:g[t]*v,value:b}}}if(M>0){const t=`${Z.name||`animation${Z.index}`}_channel${J.index}_${b}`,h=S.buildAnimations(C,t,v,r);for(const Z of h)b++,P(Z.babylonAnimatable,Z.babylonAnimation)}}}))}_loadAnimationSamplerAsync(t,b){if(b._data)return b._data;const Z=b.interpolation||"LINEAR";switch(Z){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${b.interpolation})`)}const J=F.Get(`${t}/input`,this._gltf.accessors,b.input),S=F.Get(`${t}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${J.index}`,J),this._loadFloatAccessorAsync(`/accessors/${S.index}`,S)]).then((t=>{let[b,J]=t;return{input:b,interpolation:Z,output:J}})),b._data}loadBufferAsync(t,b,Z,J){const S=this._extensionsLoadBufferAsync(t,b,Z,J);if(S)return S;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${t}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+Z,J)}catch(S){throw new Error(`${t}: ${S.message}`)}}))}loadBufferViewAsync(t,b){const Z=this._extensionsLoadBufferViewAsync(t,b);if(Z)return Z;if(b._data)return b._data;const J=F.Get(`${t}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${J.index}`,J,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(t,b,Z){if(b._data)return b._data;const J=X._GetNumComponents(t,b.type),S=J*H.g.GetTypeByteLength(b.componentType),P=J*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new Z(P));else{const v=F.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((h=>{if(5126!==b.componentType||b.normalized||v.byteStride&&v.byteStride!==S){const t=new Z(P);return H.g.ForEach(h,b.byteOffset||0,v.byteStride||S,J,b.componentType,t.length,b.normalized||!1,((b,Z)=>{t[Z]=b})),t}return X._GetTypedArray(t,b.componentType,h,b.byteOffset,P)}))}if(b.sparse){const P=b.sparse;b._data=b._data.then((v=>{const h=v,C=F.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,P.indices.bufferView),Y=F.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,P.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)]).then((v=>{let[C,Y]=v;const g=X._GetTypedArray(`${t}/sparse/indices`,P.indices.componentType,C,P.indices.byteOffset,P.count),I=J*P.count;let r;if(5126!==b.componentType||b.normalized){const v=X._GetTypedArray(`${t}/sparse/values`,b.componentType,Y,P.values.byteOffset,I);r=new Z(I),H.g.ForEach(v,0,S,J,b.componentType,r.length,b.normalized||!1,((t,b)=>{r[b]=t}))}else r=X._GetTypedArray(`${t}/sparse/values`,b.componentType,Y,P.values.byteOffset,I);let M=0;for(let t=0;t<g.length;t++){let b=g[t]*J;for(let t=0;t<J;t++)h[b++]=r[M++]}return h}))}))}return b._data}_loadFloatAccessorAsync(t,b){return this._loadAccessorAsync(t,b,Float32Array)}_loadIndicesAccessorAsync(t,b){if("SCALAR"!==b.type)throw new Error(`${t}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${t}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const Z=X._GetTypedArrayConstructor(`${t}/componentType`,b.componentType);b._data=this._loadAccessorAsync(t,b,Z)}else{const Z=F.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Z=>X._GetTypedArray(t,b.componentType,Z,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const b=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then((t=>new H.d(b,t,!1))),t._babylonBuffer}_loadVertexAccessorAsync(t,b,Z){var J;if(null!==(J=b._babylonVertexBuffer)&&void 0!==J&&J[Z])return b._babylonVertexBuffer[Z];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const S=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[Z]=this._loadFloatAccessorAsync(t,b).then((t=>new H.g(S,t,Z,!1)));else{const J=F.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[Z]=this._loadVertexBufferViewAsync(J).then((P=>{const v=X._GetNumComponents(t,b.type);return new H.g(S,P,Z,!1,void 0,J.byteStride,void 0,b.byteOffset,v,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[Z]}_loadMaterialMetallicRoughnessPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return b&&(b.baseColorFactor?(Z.albedoColor=P.hZ.CZ(b.baseColorFactor),Z.alpha=b.baseColorFactor[3]):Z.albedoColor=P.hZ.White(),Z.metallic=void 0==b.metallicFactor?1:b.metallicFactor,Z.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&J.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,b.baseColorTexture,(t=>{t.name=`${Z.name} (Base Color)`,Z.albedoTexture=t}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(t=>{t.name=`${Z.name} (Metallic Roughness)`,Z.metallicTexture=t}))),Z.useMetallnessFromMetallicTextureBlue=!0,Z.useRoughnessFromMetallicTextureGreen=!0,Z.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(J).then((()=>{}))}_loadMaterialAsync(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const P=this._extensionsLoadMaterialAsync(t,b,Z,J,S);if(P)return P;b._data=b._data||{};let v=b._data[J];if(!v){this.logOpen(`${t} ${b.name||""}`);const Z=this.createMaterial(t,b,J);v={babylonMaterial:Z,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,b,Z)},b._data[J]=v,X.AddPointerMetadata(Z,t),this._parent.onMaterialLoadedObservable.notifyObservers(Z),this.logClose()}return Z&&(v.babylonMeshes.push(Z),Z.lb.addOnce((()=>{const t=v.babylonMeshes.indexOf(Z);-1!==t&&v.babylonMeshes.splice(t,1)}))),S(v.babylonMaterial),v.promise.then((()=>v.babylonMaterial))}_createDefaultMaterial(t,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Z=new U.b(t,this._babylonScene);return Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.fillMode=b,Z.enableSpecularAntiAliasing=!0,Z.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Z.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Z.transparencyMode=U.b.PBRMATERIAL_OPAQUE,Z.metallic=1,Z.roughness=1,Z}createMaterial(t,b,Z){const J=this._extensionsCreateMaterial(t,b,Z);if(J)return J;const S=b.name||`material${b.index}`;return this._createDefaultMaterial(S,Z)}loadMaterialPropertiesAsync(t,b,Z){const J=this._extensionsLoadMaterialPropertiesAsync(t,b,Z);if(J)return J;const S=new Array;return S.push(this.loadMaterialBasePropertiesAsync(t,b,Z)),b.pbrMetallicRoughness&&S.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,b.pbrMetallicRoughness,Z)),this.loadMaterialAlphaProperties(t,b,Z),Promise.all(S).then((()=>{}))}loadMaterialBasePropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.emissiveColor=b.emissiveFactor?P.hZ.CZ(b.emissiveFactor):new P.hZ(0,0,0),b.doubleSided&&(Z.Nb=!1,Z.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${t}/normalTexture`,b.normalTexture,(t=>{t.name=`${Z.name} (Normal)`,Z.bumpTexture=t}))),Z.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Z.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&Z.bumpTexture&&(Z.bumpTexture.level=b.normalTexture.scale),Z.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,J.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,b.occlusionTexture,(t=>{t.name=`${Z.name} (Occlusion)`,Z.ambientTexture=t}))),Z.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(Z.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&J.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,b.emissiveTexture,(t=>{t.name=`${Z.name} (Emissive)`,Z.emissiveTexture=t}))),Promise.all(J).then((()=>{}))}loadMaterialAlphaProperties(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":Z.transparencyMode=U.b.PBRMATERIAL_OPAQUE,Z.alpha=1;break;case"MASK":Z.transparencyMode=U.b.PBRMATERIAL_ALPHATEST,Z.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,Z.albedoTexture&&(Z.albedoTexture.Vb=!0);break;case"BLEND":Z.transparencyMode=U.b.PBRMATERIAL_ALPHABLEND,Z.albedoTexture&&(Z.albedoTexture.Vb=!0,Z.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${t}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureInfoAsync(t,b,Z);if(J)return J;if(this.logOpen(`${t}`),b.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${b.texCoord})`);const S=F.Get(`${t}/index`,this._gltf.textures,b.index);S._textureInfo=b;const P=this._loadTextureAsync(`/textures/${b.index}`,S,(J=>{J.coordinatesIndex=b.texCoord||0,X.AddPointerMetadata(J,t),this._parent.onTextureLoadedObservable.notifyObservers(J),Z(J)}));return this.logClose(),P}_loadTextureAsync(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const J=this._extensionsLoadTextureAsync(t,b,Z);if(J)return J;this.logOpen(`${t} ${b.name||""}`);const S=void 0==b.sampler?X.DefaultSampler:F.Get(`${t}/sampler`,this._gltf.samplers,b.sampler),P=F.Get(`${t}/source`,this._gltf.images,b.source),v=this._createTextureAsync(t,S,P,Z,void 0,!b._textureInfo.nonColorData);return this.logClose(),v}_createTextureAsync(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},P=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0;const h=this._loadSampler(`/samplers/${b.index}`,b),C=new Array,Y=new J;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g={noMipmap:h.noMipMaps,invertY:!1,samplingMode:h.samplingMode,R:()=>{this._disposed||Y.resolve()},onError:(b,Z)=>{this._disposed||Y.reject(new Error(`${t}: ${Z&&Z.message?Z.message:b||"Failed to load texture"}`))},mimeType:Z.mimeType??(0,y.i)(Z.uri??""),loaderOptions:P,useSRGBBuffer:!!v&&this._parent.useSRGBBuffers},I=new E.c(null,this._babylonScene,g);return I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(Y.promise),C.push(this.loadImageAsync(`/images/${Z.index}`,Z).then((t=>{const b=Z.uri||`${this._fileName}#image${Z.index}`,J=`data:${this._uniqueRootUrl}${b}`;I.updateURL(J,t);const S=I.getInternalTexture();S&&(S.label=Z.name)}))),I.wrapU=h.wrapU,I.wrapV=h.wrapV,S(I),this._parent.useGltfTextureNames&&(I.name=Z.name||Z.uri||`image${Z.index}`),Promise.all(C).then((()=>I))}_loadSampler(t,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:X._GetTextureSamplingMode(t,b),wrapU:X._GetTextureWrapMode(`${t}/wrapS`,b.wrapS),wrapV:X._GetTextureWrapMode(`${t}/wrapT`,b.wrapT)}),b._data}loadImageAsync(t,b){if(!b._data){if(this.logOpen(`${t} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${t}/uri`,b,b.uri);else{const Z=F.Get(`${t}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}this.logClose()}return b._data}loadUriAsync(t,b,Z){const J=this._extensionsLoadUriAsync(t,b,Z);if(J)return J;if(!X._ValidateUri(Z))throw new Error(`${t}: '${Z}' is invalid`);if((0,y.l)(Z)){const b=new Uint8Array((0,y.c)(Z));return this.log(`${t}: Decoded ${Z.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${t}: Loading ${Z}`),this._parent.preprocessUrlAsync(this._rootUrl+Z).then((b=>new Promise(((J,S)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${t}: Loaded ${Z} (${b.byteLength} bytes)`),J(new Uint8Array(b)))}),!0,(b=>{S(new y.n(`${t}: Failed to load '${Z}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(t,b){t.metadata=t.metadata||{};const Z=t._internalMetadata=t._internalMetadata||{},J=Z.pb=Z.pb||{};(J.pointers=J.pointers||[]).push(b)}static _GetTextureWrapMode(t,b){switch(b=void 0==b?10497:b){case 33071:return E.c.CLAMP_ADDRESSMODE;case 33648:return E.c.MIRROR_ADDRESSMODE;case 10497:return E.c.WRAP_ADDRESSMODE;default:return a.c.Warn(`${t}: Invalid value (${b})`),E.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,b){const Z=void 0==b.magFilter?9729:b.magFilter,J=void 0==b.minFilter?9987:b.minFilter;if(9729===Z)switch(J){case 9728:return E.c.LINEAR_NEAREST;case 9729:return E.c.LINEAR_LINEAR;case 9984:return E.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return E.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return E.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return E.c.LINEAR_LINEAR_MIPLINEAR;default:return a.c.Warn(`${t}/minFilter: Invalid value (${J})`),E.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Z&&a.c.Warn(`${t}/magFilter: Invalid value (${Z})`),J){case 9728:return E.c.NEAREST_NEAREST;case 9729:return E.c.NEAREST_LINEAR;case 9984:return E.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return E.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return E.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return E.c.NEAREST_LINEAR_MIPLINEAR;default:return a.c.Warn(`${t}/minFilter: Invalid value (${J})`),E.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,b){try{return(0,L.r)(b)}catch(Z){throw new Error(`${t}: ${Z.message}`)}}static _GetTypedArray(t,b,Z,J,S){const P=Z.buffer;J=Z.byteOffset+(J||0);const v=X._GetTypedArrayConstructor(`${t}/componentType`,b),h=H.g.GetTypeByteLength(b);return J%h!==0?(a.c.Warn(`${t}: Copying buffer as byte offset (${J}) is not a multiple of component type byte length (${h})`),new v(P.slice(J,J+S*h),0)):new v(P,J,S)}static _GetNumComponents(t,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${b})`)}static _ValidateUri(t){return v.Tools.IsBase64(t)||-1===t.indexOf("..")}static _GetDrawMode(t,b){switch(void 0==b&&(b=4),b){case 0:return l.c.PointListDrawMode;case 1:return l.c.LineListDrawMode;case 2:return l.c.LineLoopDrawMode;case 3:return l.c.LineStripDrawMode;case 4:return l.c.TriangleFillMode;case 5:return l.c.TriangleStripDrawMode;case 6:return l.c.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const Z in b._data){const J=b._data[Z];for(const b of J.babylonMeshes){b.sb(!0);const Z=J.babylonMaterial;t.push(Z.forceCompilationAsync(b)),t.push(Z.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(t.push(Z.forceCompilationAsync(b,{clipPlane:!0})),t.push(Z.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,b=this._babylonScene.lights;for(const Z of b){const b=Z.getShadowGenerator();b&&t.push(b.forceCompilationAsync())}return Promise.all(t).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(t){for(const b of this._extensions)b.enabled&&t(b)}_applyExtensions(t,b,Z){for(const J of this._extensions)if(J.enabled){const S=`${J.name}.${b}`,P=t;P._activeLoaderExtensionFunctions=P._activeLoaderExtensionFunctions||{};const v=P._activeLoaderExtensionFunctions;if(!v[S]){v[S]=!0;try{const t=Z(J);if(t)return t}finally{delete v[S]}}}return null}_extensionsOnLoading(){this._forEachExtensions((t=>t.onLoading&&t.onLoading()))}_extensionsOnReady(){this._forEachExtensions((t=>t.onReady&&t.onReady()))}_extensionsLoadSceneAsync(t,b){return this._applyExtensions(b,"loadScene",(Z=>Z.loadSceneAsync&&Z.loadSceneAsync(t,b)))}_extensionsLoadNodeAsync(t,b,Z){return this._applyExtensions(b,"loadNode",(J=>J.loadNodeAsync&&J.loadNodeAsync(t,b,Z)))}_extensionsLoadCameraAsync(t,b,Z){return this._applyExtensions(b,"loadCamera",(J=>J.loadCameraAsync&&J.loadCameraAsync(t,b,Z)))}_extensionsLoadVertexDataAsync(t,b,Z){return this._applyExtensions(b,"loadVertexData",(J=>J._loadVertexDataAsync&&J._loadVertexDataAsync(t,b,Z)))}_extensionsLoadMeshPrimitiveAsync(t,b,Z,J,S,P){return this._applyExtensions(S,"loadMeshPrimitive",(v=>v._loadMeshPrimitiveAsync&&v._loadMeshPrimitiveAsync(t,b,Z,J,S,P)))}_extensionsLoadMaterialAsync(t,b,Z,J,S){return this._applyExtensions(b,"loadMaterial",(P=>P._loadMaterialAsync&&P._loadMaterialAsync(t,b,Z,J,S)))}_extensionsCreateMaterial(t,b,Z){return this._applyExtensions(b,"createMaterial",(J=>J.createMaterial&&J.createMaterial(t,b,Z)))}_extensionsLoadMaterialPropertiesAsync(t,b,Z){return this._applyExtensions(b,"loadMaterialProperties",(J=>J.loadMaterialPropertiesAsync&&J.loadMaterialPropertiesAsync(t,b,Z)))}_extensionsLoadTextureInfoAsync(t,b,Z){return this._applyExtensions(b,"loadTextureInfo",(J=>J.loadTextureInfoAsync&&J.loadTextureInfoAsync(t,b,Z)))}_extensionsLoadTextureAsync(t,b,Z){return this._applyExtensions(b,"loadTexture",(J=>J._loadTextureAsync&&J._loadTextureAsync(t,b,Z)))}_extensionsLoadAnimationAsync(t,b){return this._applyExtensions(b,"loadAnimation",(Z=>Z.loadAnimationAsync&&Z.loadAnimationAsync(t,b)))}_extensionsLoadAnimationChannelAsync(t,b,Z,J,S){return this._applyExtensions(Z,"loadAnimationChannel",(P=>P._loadAnimationChannelAsync&&P._loadAnimationChannelAsync(t,b,Z,J,S)))}_extensionsLoadSkinAsync(t,b,Z){return this._applyExtensions(Z,"loadSkin",(J=>J._loadSkinAsync&&J._loadSkinAsync(t,b,Z)))}_extensionsLoadUriAsync(t,b,Z){return this._applyExtensions(b,"loadUri",(J=>J._loadUriAsync&&J._loadUriAsync(t,b,Z)))}_extensionsLoadBufferViewAsync(t,b){return this._applyExtensions(b,"loadBufferView",(Z=>Z.loadBufferViewAsync&&Z.loadBufferViewAsync(t,b)))}_extensionsLoadBufferAsync(t,b,Z,J){return this._applyExtensions(b,"loadBuffer",(S=>S.loadBufferAsync&&S.loadBufferAsync(t,b,Z,J)))}static LoadExtensionAsync(t,b,Z,J){if(!b.extensions)return null;const S=b.extensions[Z];return S?J(`${t}/extensions/${Z}`,S):null}static LoadExtraAsync(t,b,Z,J){if(!b.extras)return null;const S=b.extras[Z];return S?J(`${t}/extras/${Z}`,S):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(t)}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}X.DefaultSampler={index:-1},n.e._CreateGLTF2Loader=t=>new X(t);var x=Z(14347),i=Z(12923),z=Z(12760),D=Z(14355),f=Z(14359);class mt extends f.e{constructor(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",t),this._texture=t.getEngine().createRawCubeTexture(b,Z,J,S,P,v,h,C)}update(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,t,b,Z,J,S)}updateRGBDAsync(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,D.i)(this._texture,t,b,Z,J).then((()=>{}))}clone(){return z.d.Clone((()=>{const t=this.et(),b=this._texture,Z=new mt(t,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&Z.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),Z}),this)}}const R="EXT_lights_image_based";class w{constructor(t){this.name=R,this._loader=t,this.enabled=this._loader.isExtensionUsed(R)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.pb.extensions;if(t&&t[this.name]){const b=t[this.name];this._lights=b.lights}}loadSceneAsync(t,b){return X.LoadExtensionAsync(t,b,this.name,(async(Z,J)=>{this._loader._allMaterialsDirtyRequired=!0;const S=new Array;S.push(this._loader.loadSceneAsync(t,b)),this._loader.logOpen(`${Z}`);const P=F.Get(`${Z}/light`,this._lights,J.rb);return S.push(this._loadLightAsync(`/extensions/${this.name}/lights/${J.rb}`,P).then((t=>{this._loader.babylonScene.environmentTexture=t}))),this._loader.logClose(),await Promise.all(S).then((()=>{}))}))}_loadLightAsync(t,b){if(!b._loaded){const Z=new Array;this._loader.logOpen(`${t}`);const J=new Array(b.specularImages.length);for(let S=0;S<b.specularImages.length;S++){const P=b.specularImages[S];J[S]=new Array(P.length);for(let b=0;b<P.length;b++){const v=`${t}/specularImages/${S}/${b}`;this._loader.logOpen(`${v}`);const h=P[b],C=F.Get(v,this._loader.pb.images,h);Z.push(this._loader.loadImageAsync(`/images/${h}`,C).then((t=>{J[S][b]=t}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(Z).then((async()=>{const Z=new mt(this._loader.babylonScene,null,b.specularImageSize);if(Z.name=b.name||"environment",b._babylonTexture=Z,void 0!=b.xb&&(Z.level=b.xb),b.rotation){let t=S.Quaternion.CZ(b.rotation);this._loader.babylonScene.useRightHandedSystem||(t=S.Quaternion.Inverse(t)),S.Matrix.FromQuaternionToRef(t,Z.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${t}: Irradiance coefficients are missing`);const P=i.e.CZ(b.irradianceCoefficients);P.scaleInPlace(b.xb),P.convertIrradianceToLambertianRadiance();const v=i.f.FromHarmonics(P),h=(J.length-1)/Math.log2(b.specularImageSize);return await Z.updateRGBDAsync(J,v,h)}))}return b._loaded.then((()=>b._babylonTexture))}}N(R),Q(R,!0,(t=>new w(t)));Z(13301);const G="EXT_mesh_gpu_instancing";class tt{constructor(t){this.name=G,this._loader=t,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null}loadNodeAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(t,J)=>{this._loader._disableInstancedMesh++;const P=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,Z);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return await P;const v=new Array;let h=0;const C=b=>{if(void 0==J.attributes[b])return void v.push(Promise.resolve(null));const Z=F.Get(`${t}/attributes/${b}`,this._loader.pb.accessors,J.attributes[b]);if(v.push(this._loader._loadFloatAccessorAsync(`/accessors/${Z.bufferView}`,Z)),0===h)h=Z.count;else if(h!==Z.count)throw new Error(`${t}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await P.then((async t=>{const[Z,J,P]=await Promise.all(v),C=new Float32Array(16*h);S.TmpVectors.JZ[0].Ab(0,0,0),S.TmpVectors.Quaternion[0].Ab(0,0,0,1),S.TmpVectors.JZ[1].Ab(1,1,1);for(let b=0;b<h;++b)Z&&S.JZ.FromArrayToRef(Z,3*b,S.TmpVectors.JZ[0]),J&&S.Quaternion.FromArrayToRef(J,4*b,S.TmpVectors.Quaternion[0]),P&&S.JZ.FromArrayToRef(P,3*b,S.TmpVectors.JZ[1]),S.Matrix.ComposeToRef(S.TmpVectors.JZ[1],S.TmpVectors.Quaternion[0],S.TmpVectors.JZ[0],S.TmpVectors.Matrix[0]),S.TmpVectors.Matrix[0].copyToArray(C,16*b);for(const S of b._primitiveBabylonMeshes)S.vr("matrix",C,16,!0);return t}))}))}}N(G),Q(G,!0,(t=>new tt(t)));let bt=0,Zt=null;class Jt{static get Default(){return Jt._Default||(Jt._Default=new Jt),Jt._Default}constructor(){const t=Jt.Configuration.decoder;this._decoderModulePromise=v.Tools.LoadBabylonScriptAsync(t.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(t,b,Z,J,S){await this._decoderModulePromise,0===bt&&(MeshoptDecoder.useWorkers(1),bt=1);const P=await MeshoptDecoder.decodeGltfBufferAsync(b,Z,t,J,S);return null!==Zt&&clearTimeout(Zt),Zt=setTimeout((()=>{MeshoptDecoder.useWorkers(0),bt=0,Zt=null}),1e3),P}}Jt.Configuration={decoder:{url:`${v.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Jt._Default=null;const St="EXT_meshopt_compression";class Pt{constructor(t){this.name=St,this.enabled=t.isExtensionUsed(St),this._loader=t}dispose(){this._loader=null}loadBufferViewAsync(t,b){return X.LoadExtensionAsync(t,b,this.name,(async(Z,J)=>{const S=b;if(S._meshOptData)return await S._meshOptData;const P=F.Get(`${t}/buffer`,this._loader.pb.buffers,J.buffer);return S._meshOptData=this._loader.loadBufferAsync(`/buffers/${P.index}`,P,J.byteOffset||0,J.byteLength).then((async t=>await Jt.Default.decodeGltfBufferAsync(t,J.count,J.byteStride,J.mode,J.filter))),await S._meshOptData}))}}N(St),Q(St,!0,(t=>new Pt(t)));const vt="EXT_texture_webp";class ht{constructor(t){this.name=vt,this._loader=t,this.enabled=t.isExtensionUsed(vt)}dispose(){this._loader=null}_loadTextureAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=void 0==b.sampler?X.DefaultSampler:F.Get(`${t}/sampler`,this._loader.pb.samplers,b.sampler),v=F.Get(`${J}/source`,this._loader.pb.images,S.source);return await this._loader._createTextureAsync(t,P,v,(t=>{Z(t)}),void 0,!b._textureInfo.nonColorData)}))}}N(vt),Q(vt,!0,(t=>new ht(t)));const Ct="EXT_texture_avif";class Yt{constructor(t){this.name=Ct,this._loader=t,this.enabled=t.isExtensionUsed(Ct)}dispose(){this._loader=null}_loadTextureAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=void 0==b.sampler?X.DefaultSampler:F.Get(`${t}/sampler`,this._loader.pb.samplers,b.sampler),v=F.Get(`${J}/source`,this._loader.pb.images,S.source);return await this._loader._createTextureAsync(t,P,v,(t=>{Z(t)}),void 0,!b._textureInfo.nonColorData)}))}}N(Ct),Q(Ct,!0,(t=>new Yt(t)));var gt=Z(14342),It=Z(13272);const rt="EXT_lights_ies";class Mt{constructor(t){this.name=rt,this._loader=t,this.enabled=this._loader.isExtensionUsed(rt)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.pb.extensions;if(t&&t[this.name]){const b=t[this.name];this._lights=b.lights,F.Assign(this._lights)}}loadNodeAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,v)=>{let h,C;this._loader._allMaterialsDirtyRequired=!0;const Y=await this._loader.loadNodeAsync(t,b,(t=>{C=F.Get(J,this._lights,v.rb);const b=C.name||t.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h=new gt.b(b,S.JZ.Zero(),S.JZ.Backward(),0,1,this._loader.babylonScene),h.angle=Math.PI/2,h.innerAngle=0,h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=h,h.falloffType=It.d.FALLOFF_GLTF,h.ib=v.color?P.hZ.CZ(v.color):P.hZ.White(),h.xb=v.multiplier||1,h.range=Number.MAX_VALUE,h.parent=t,this._loader._babylonLights.push(h),X.AddPointerMetadata(h,J),Z(t)}));let g;if(C.uri)g=await this._loader.loadUriAsync(t,C,C.uri);else{const b=F.Get(`${t}/bufferView`,this._loader.pb.bufferViews,C.bufferView);g=await this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return h.iesProfileTexture=new E.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,g,!0,void 0,void 0,void 0,void 0,".ies"),Y}))}}N(rt),Q(rt,!0,(t=>new Mt(t)));var Tt=Z(14375);const at="KHR_draco_mesh_compression";class kt{constructor(t){this.name=at,this.useNormalizedFlagFromAccessor=!0,this._loader=t,this.enabled=Tt.c.DefaultAvailable&&this._loader.isExtensionUsed(at)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${t}: Unsupported mode ${b.mode}`);const P={},v={},h=(t,J)=>{const h=S.attributes[t];if(void 0!=h&&(Z._delayInfo=Z._delayInfo||[],-1===Z._delayInfo.indexOf(J)&&Z._delayInfo.push(J),P[J]=h,this.useNormalizedFlagFromAccessor)){const Z=F.TryGet(this._loader.pb.accessors,b.attributes[t]);Z&&(v[J]=Z.normalized||!1)}};h("POSITION",H.g.PositionKind),h("NORMAL",H.g.NormalKind),h("TANGENT",H.g.TangentKind),h("TEXCOORD_0",H.g.UVKind),h("TEXCOORD_1",H.g.UV2Kind),h("TEXCOORD_2",H.g.UV3Kind),h("TEXCOORD_3",H.g.UV4Kind),h("TEXCOORD_4",H.g.UV5Kind),h("TEXCOORD_5",H.g.UV6Kind),h("JOINTS_0",H.g.MatricesIndicesKind),h("WEIGHTS_0",H.g.MatricesWeightsKind),h("COLOR_0",H.g.ColorKind);const C=F.Get(J,this._loader.pb.bufferViews,S.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async J=>{const S=this.dracoDecoder||Tt.c.Default,h=F.TryGet(this._loader.pb.accessors,b.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||Z.skeleton||!h?null:B(h);return await S._decodeMeshToGeometryForGltfAsync(Z.name,this._loader.babylonScene,J,P,v,C).catch((b=>{throw new Error(`${t}: ${b.message}`)}))}))),await C._dracoBabylonGeometry}))}}N(at),Q(at,!0,(t=>new kt(t)));var ut=Z(14377),lt=Z(12721),Ut=Z(12726),Et=Z(13155),ct=Z(13338),Ht=Z(12688);Et.e.AddNodeConstructor("Light_Type_0",((t,b)=>()=>new ot(t,S.JZ.Zero(),b)));class ot extends ct.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(t){this._shadowAngle=t,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(t){const b=this.needCube();if(this._direction=t,this.needCube()!==b&&this._shadowGenerators){const t=this._shadowGenerators.values();for(let b=t.next();!0!==b.done;b=t.next()){b.value.recreateShadowMap()}}}constructor(t,b,Z){super(t,Z),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return It.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(t){if(this.direction)return super.getShadowDirection(t);switch(t){case 0:return new S.JZ(1,0,0);case 1:return new S.JZ(-1,0,0);case 2:return new S.JZ(0,-1,0);case 3:return new S.JZ(0,1,0);case 4:return new S.JZ(0,0,1);case 5:return new S.JZ(0,0,-1)}return S.JZ.Zero()}_setDefaultShadowProjectionMatrix(t,b,Z){const J=this.et().activeCamera;if(!J)return;const P=void 0!==this.shadowMinZ?this.shadowMinZ:J.nb,v=void 0!==this.shadowMaxZ?this.shadowMaxZ:J.maxZ,h=this.et().getEngine().Tb;S.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,h?v:P,h?P:v,t,!0,this._scene.getEngine().isNDCHalfZRange,void 0,h)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(t,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(t,b){return this.computeTransformedInformation()?t.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):t.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(t,b){t["POINTLIGHT"+b]=!0}}(0,lt.e)([(0,Ut.N)()],ot.prototype,"shadowAngle",null),(0,Ht.f)("BABYLON.PointLight",ot);const Ot="KHR_lights_punctual";class pt{constructor(t){this.name=Ot,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ot)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.pb.extensions;if(t&&t[this.name]){const b=t[this.name];this._lights=b.lights,F.Assign(this._lights)}}loadNodeAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,v)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(t,b,(t=>{let b;const h=F.Get(J,this._lights,v.rb),C=h.name||t.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h.type){case"directional":{const t=new ut.b(C,S.JZ.Backward(),this._loader.babylonScene);t.position.Lb(0),b=t;break}case"point":b=new ot(C,S.JZ.Zero(),this._loader.babylonScene);break;case"spot":{const t=new gt.b(C,S.JZ.Zero(),S.JZ.Backward(),0,1,this._loader.babylonScene);t.angle=2*(h.spot&&h.spot.outerConeAngle||Math.PI/4),t.innerAngle=2*(h.spot&&h.spot.innerConeAngle||0),b=t;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${J}: Invalid light type (${h.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,h._babylonLight=b,b.falloffType=It.d.FALLOFF_GLTF,b.ib=h.color?P.hZ.CZ(h.color):P.hZ.White(),b.xb=void 0==h.xb?1:h.xb,b.range=void 0==h.range?Number.MAX_VALUE:h.range,b.parent=t,this._loader._babylonLights.push(b),X.AddPointerMetadata(b,J),Z(t)})))))}}N(Ot),Q(Ot,!0,(t=>new pt(t)));const et="KHR_materials_pbrSpecularGlossiness";class Wt{constructor(t){this.name=et,this.order=200,this._loader=t,this.enabled=this._loader.isExtensionUsed(et)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialBasePropertiesAsync(t,b,Z)),P.push(this._loadSpecularGlossinessPropertiesAsync(J,S,Z)),this._loader.loadMaterialAlphaProperties(t,b,Z),await Promise.all(P).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.metallic=null,Z.roughness=null,b.diffuseFactor?(Z.albedoColor=P.hZ.CZ(b.diffuseFactor),Z.alpha=b.diffuseFactor[3]):Z.albedoColor=P.hZ.White(),Z.reflectivityColor=b.specularFactor?P.hZ.CZ(b.specularFactor):P.hZ.White(),Z.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTexture`,b.diffuseTexture,(t=>{t.name=`${Z.name} (Diffuse)`,Z.albedoTexture=t}))),b.specularGlossinessTexture&&(J.push(this._loader.loadTextureInfoAsync(`${t}/specularGlossinessTexture`,b.specularGlossinessTexture,(t=>{t.name=`${Z.name} (Specular Glossiness)`,Z.reflectivityTexture=t,Z.reflectivityTexture.Vb=!0}))),Z.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(J).then((()=>{}))}}N(et),Q(et,!0,(t=>new Wt(t)));const jt="KHR_materials_unlit";class Vt{constructor(t){this.name=jt,this.order=210,this._loader=t,this.enabled=this._loader.isExtensionUsed(jt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async()=>await this._loadUnlitPropertiesAsync(t,b,Z)))}_loadUnlitPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;Z.unlit=!0;const S=b.pbrMetallicRoughness;return S&&(S.baseColorFactor?(Z.albedoColor=P.hZ.CZ(S.baseColorFactor),Z.alpha=S.baseColorFactor[3]):Z.albedoColor=P.hZ.White(),S.baseColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/baseColorTexture`,S.baseColorTexture,(t=>{t.name=`${Z.name} (Base Color)`,Z.albedoTexture=t})))),b.doubleSided&&(Z.Nb=!1,Z.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(t,b,Z),Promise.all(J).then((()=>{}))}}N(jt),Q(jt,!0,(t=>new Vt(t)));const nt="KHR_materials_clearcoat";class yt{constructor(t){this.name=nt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadClearCoatPropertiesAsync(J,S,Z)),await Promise.all(P)}))}_loadClearCoatPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.clearCoat.isEnabled=!0,Z.clearCoat.useRoughnessFromMainTexture=!1,Z.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?Z.clearCoat.xb=b.clearcoatFactor:Z.clearCoat.xb=0,b.clearcoatTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatTexture`,b.clearcoatTexture,(t=>{t.name=`${Z.name} (ClearCoat)`,Z.clearCoat.texture=t}))),void 0!=b.clearcoatRoughnessFactor?Z.clearCoat.roughness=b.clearcoatRoughnessFactor:Z.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(t=>{t.name=`${Z.name} (ClearCoat Roughness)`,Z.clearCoat.textureRoughness=t})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${t}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(t=>{t.name=`${Z.name} (ClearCoat Normal)`,Z.clearCoat.bumpTexture=t}))),Z.invertNormalMapX=!Z.et().useRightHandedSystem,Z.invertNormalMapY=Z.et().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(Z.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(J).then((()=>{}))}}N(nt),Q(nt,!0,(t=>new yt(t)));const dt="KHR_materials_iridescence";class st{constructor(t){this.name=dt,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(dt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadIridescencePropertiesAsync(J,S,Z)),await Promise.all(P).then((()=>{}))}))}_loadIridescencePropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.iridescence.isEnabled=!0,Z.iridescence.xb=b.iridescenceFactor??0,Z.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,Z.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,Z.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceTexture`,b.iridescenceTexture,(t=>{t.name=`${Z.name} (Iridescence)`,Z.iridescence.texture=t}))),b.iridescenceThicknessTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(t=>{t.name=`${Z.name} (Iridescence Thickness)`,Z.iridescence.thicknessTexture=t}))),Promise.all(J).then((()=>{}))}}N(dt),Q(dt,!0,(t=>new st(t)));const qt="KHR_materials_anisotropy";class Qt{constructor(t){this.name=qt,this.order=195,this._loader=t,this.enabled=this._loader.isExtensionUsed(qt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadIridescencePropertiesAsync(J,S,Z)),await Promise.all(P)}))}async _loadIridescencePropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;Z.anisotropy.isEnabled=!0,Z.anisotropy.xb=b.anisotropyStrength??0,Z.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${t}/anisotropyTexture`,b.anisotropyTexture,(t=>{t.name=`${Z.name} (Anisotropy Intensity)`,Z.anisotropy.texture=t})))),await Promise.all(J)}}N(qt),Q(qt,!0,(t=>new Qt(t)));const Nt="KHR_materials_emissive_strength";class At{constructor(t){this.name=Nt,this.order=170,this._loader=t,this.enabled=this._loader.isExtensionUsed(Nt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>await this._loader.loadMaterialPropertiesAsync(t,b,Z).then((()=>{this._loadEmissiveProperties(J,S,Z)}))))}_loadEmissiveProperties(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);void 0!==b.emissiveStrength&&(Z.emissiveIntensity=b.emissiveStrength)}}N(Nt),Q(Nt,!0,(t=>new At(t)));const Kt="KHR_materials_sheen";class Lt{constructor(t){this.name=Kt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Kt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadSheenPropertiesAsync(J,S,Z)),await Promise.all(P).then((()=>{}))}))}_loadSheenPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.sheen.isEnabled=!0,Z.sheen.xb=1,void 0!=b.sheenColorFactor?Z.sheen.color=P.hZ.CZ(b.sheenColorFactor):Z.sheen.color=P.hZ.Black(),b.sheenColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/sheenColorTexture`,b.sheenColorTexture,(t=>{t.name=`${Z.name} (Sheen Color)`,Z.sheen.texture=t}))),void 0!==b.sheenRoughnessFactor?Z.sheen.roughness=b.sheenRoughnessFactor:Z.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${t}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(t=>{t.name=`${Z.name} (Sheen Roughness)`,Z.sheen.textureRoughness=t})))),Z.sheen.albedoScaling=!0,Z.sheen.useRoughnessFromMainTexture=!1,Promise.all(J).then((()=>{}))}}N(Kt),Q(Kt,!0,(t=>new Lt(t)));var Ft=Z(13214);const Bt="KHR_materials_specular";class Xt{constructor(t){this.name=Bt,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Bt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;if(P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadSpecularPropertiesAsync(J,S,Z)),S.extensions&&S.extensions.EXT_materials_specular_edge_color&&Z instanceof U.b){S.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Z.brdf.dielectricSpecularModel=Ft.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Z.brdf.conductorSpecularModel=Ft.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(P).then((()=>{}))}))}_loadSpecularPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return void 0!==b.specularFactor&&(Z.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(Z.metallicReflectanceColor=P.hZ.CZ(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,J.push(this._loader.loadTextureInfoAsync(`${t}/specularTexture`,b.specularTexture,(t=>{t.name=`${Z.name} (Specular)`,Z.metallicReflectanceTexture=t,Z.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/specularColorTexture`,b.specularColorTexture,(t=>{t.name=`${Z.name} (Specular Color)`,Z.reflectanceTexture=t}))),Promise.all(J).then((()=>{}))}}N(Bt),Q(Bt,!0,(t=>new Xt(t)));const xt="KHR_materials_ior";class it{constructor(t){this.name=xt,this.order=180,this._loader=t,this.enabled=this._loader.isExtensionUsed(xt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadIorPropertiesAsync(J,S,Z)),await Promise.all(P).then((()=>{}))}))}_loadIorPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);return void 0!==b.ior?Z.indexOfRefraction=b.ior:Z.indexOfRefraction=it._DEFAULT_IOR,Promise.resolve()}}it._DEFAULT_IOR=1.5,N(xt),Q(xt,!0,(t=>new it(t)));const zt="KHR_materials_variants";class Dt{constructor(t){this.name=zt,this._loader=t,this.enabled=this._loader.isExtensionUsed(zt)}dispose(){this._loader=null}static GetAvailableVariants(t){const b=this._GetExtensionMetadata(t);return b?Object.keys(b.variants):[]}getAvailableVariants(t){return Dt.GetAvailableVariants(t)}static SelectVariant(t,b){const Z=this._GetExtensionMetadata(t);if(!Z)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${zt} extension`);const J=t=>{const b=Z.variants[t];if(b)for(const Z of b)Z.mesh.material=Z.material};if(b instanceof Array)for(const S of b)J(S);else J(b);Z.lastSelected=b}selectVariant(t,b){Dt.SelectVariant(t,b)}static Reset(t){const b=this._GetExtensionMetadata(t);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${zt} extension`);for(const Z of b.original)Z.mesh.material=Z.material;b.lastSelected=null}reset(t){Dt.Reset(t)}static GetLastSelectedVariant(t){const b=this._GetExtensionMetadata(t);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${zt} extension`);return b.lastSelected}getLastSelectedVariant(t){return Dt.GetLastSelectedVariant(t)}static _GetExtensionMetadata(t){var b,Z;return(null===t||void 0===t||null===(b=t._internalMetadata)||void 0===b||null===(Z=b.pb)||void 0===Z?void 0:Z[zt])||null}onLoading(){const t=this._loader.pb.extensions;if(t&&t[this.name]){const b=t[this.name];this._variants=b.variants}}onReady(){const t=this._loader.rootBabylonMesh;if(t){var b;const Z=this._loader.parent.extensionOptions[zt];null!==Z&&void 0!==Z&&Z.defaultVariant&&Dt.SelectVariant(t,Z.defaultVariant),null===Z||void 0===Z||null===(b=Z.onLoaded)||void 0===b||b.call(Z,{get variants(){return Dt.GetAvailableVariants(t)},get selectedVariant(){const b=Dt.GetLastSelectedVariant(t);return b?Array.isArray(b)?b[0]:b:Dt.GetAvailableVariants(t)[0]},set selectedVariant(b){Dt.SelectVariant(t,b)}})}}_loadMeshPrimitiveAsync(t,b,Z,J,S,P){return X.LoadExtensionAsync(t,S,this.name,(async(v,h)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(t,b,Z,J,S,(b=>{if(P(b),b instanceof p.b){const Z=X._GetDrawMode(t,S.mode),J=this._loader.rootBabylonMesh,P=J?J._internalMetadata=J._internalMetadata||{}:{},Y=P.pb=P.pb||{},g=Y[zt]=Y[zt]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:b,material:b.material});for(let t=0;t<h.mappings.length;++t){const S=h.mappings[t],P=F.Get(`${v}/mappings/${t}/material`,this._loader.pb.materials,S.material);C.push(this._loader._loadMaterialAsync(`#/materials/${S.material}`,P,b,Z,(t=>{for(let Z=0;Z<S.variants.length;++Z){const P=S.variants[Z],v=F.Get(`/extensions/${zt}/variants/${P}`,this._variants,P);g.variants[v.name]=g.variants[v.name]||[],g.variants[v.name].push({mesh:b,material:t}),b.onClonedObservable.add((t=>{const Z=t;let S=null,P=Z;do{if(P=P.parent,!P)return;S=Dt._GetExtensionMetadata(P)}while(null===S);if(J&&S===Dt._GetExtensionMetadata(J)){P._internalMetadata={};for(const t in J._internalMetadata)P._internalMetadata[t]=J._internalMetadata[t];P._internalMetadata.pb=[];for(const t in J._internalMetadata.pb)P._internalMetadata.pb[t]=J._internalMetadata.pb[t];P._internalMetadata.pb[zt]={lastSelected:null,original:[],variants:{}};for(const t of S.original)P._internalMetadata.pb[zt].original.push({mesh:t.mesh,material:t.material});for(const t in S.variants)if(Object.prototype.hasOwnProperty.call(S.variants,t)){P._internalMetadata.pb[zt].variants[t]=[];for(const b of S.variants[t])P._internalMetadata.pb[zt].variants[t].push({mesh:b.mesh,material:b.material})}S=P._internalMetadata.pb[zt]}for(const J of S.original)J.mesh===b&&(J.mesh=Z);for(const J of S.variants[v.name])J.mesh===b&&(J.mesh=Z)}))}})))}}}))),await Promise.all(C).then((t=>{let[b]=t;return b}))}))}}N(zt),Q(zt,!0,(t=>new Dt(t)));var ft=Z(12784);class mb{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Ft.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(t,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...mb._GetDefaultOptions(),...t},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new g.d,this._scene.lb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(t){if(!Object.keys(t).filter((b=>this._options[b]!==t[b])).length)return;const b={...this._options,...t},Z=this._options;this._options=b,b.renderSize===Z.renderSize&&b.renderTargetTextureType===Z.renderTargetTextureType&&b.generateMipmaps===Z.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(t){return!!t&&!!(t instanceof U.b&&t.subSurface.isRefractionEnabled)}_addMesh(t){this._materialObservers[t.uniqueId]=t.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),v.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(t.material)?(t.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(t)&&this._transparentMeshesCache.push(t)):-1===this._opaqueMeshesCache.indexOf(t)&&this._opaqueMeshesCache.push(t)}))}_removeMesh(t){t.onMaterialChangedObservable.remove(this._materialObservers[t.uniqueId]),delete this._materialObservers[t.uniqueId];let b=this._transparentMeshesCache.indexOf(t);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(t),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(t){const b=this._transparentMeshesCache.indexOf(t),Z=this._opaqueMeshesCache.indexOf(t);this._shouldRenderAsTransmission(t.material)?(t.material instanceof U.b&&(t.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Z?(this._opaqueMeshesCache.splice(Z,1),this._transparentMeshesCache.push(t)):-1===b&&this._transparentMeshesCache.push(t)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(t)):-1===Z&&this._opaqueMeshesCache.push(t)}_isRenderTargetValid(){var t;return null!==(null===(t=this._opaqueRenderTarget)||void 0===t?void 0:t.getInternalTexture())}_setupRenderTargets(){var t;let b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ft.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(t=this._options.clearColor)||void 0===t?void 0:t.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((t=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.S(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b}));for(const Z of this._transparentMeshesCache)this._shouldRenderAsTransmission(Z.material)&&(Z.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Rt="KHR_materials_transmission";class wt{constructor(t){this.name=Rt,this.order=175,this._loader=t,this.enabled=this._loader.isExtensionUsed(Rt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadTransparentPropertiesAsync(J,b,Z,S)),await Promise.all(P).then((()=>{}))}))}_loadTransparentPropertiesAsync(t,b,Z,J){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const S=Z;if(S.subSurface.isRefractionEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.useAlbedoToTintRefraction=!0,void 0===J.transmissionFactor)return S.subSurface.refractionIntensity=0,S.subSurface.isRefractionEnabled=!1,Promise.resolve();{var P;S.subSurface.refractionIntensity=J.transmissionFactor;const t=S.et();if(S.subSurface.refractionIntensity&&!t._transmissionHelper)new mb({},S.et());else if(S.subSurface.refractionIntensity&&(null===(P=t._transmissionHelper)||void 0===P||!P._isRenderTargetValid())){var v;null===(v=t._transmissionHelper)||void 0===v||v._setupRenderTargets()}}return S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,J.transmissionTexture?(J.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/transmissionTexture`,J.transmissionTexture,void 0).then((t=>{t.name=`${Z.name} (Transmission)`,S.subSurface.refractionIntensityTexture=t,S.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(Rt),Q(Rt,!0,(t=>new wt(t)));const Gt="KHR_materials_diffuse_transmission";class tb{constructor(t){this.name=Gt,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(Gt),this.enabled&&(t.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadTranslucentPropertiesAsync(J,b,Z,S)),await Promise.all(P).then((()=>{}))}))}_loadTranslucentPropertiesAsync(t,b,Z,J){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const S=Z;if(S.subSurface.isTranslucencyEnabled=!0,S.subSurface.volumeIndexOfRefraction=1,S.subSurface.minimumThickness=0,S.subSurface.maximumThickness=0,S.subSurface.useAlbedoToTintTranslucency=!1,void 0===J.diffuseTransmissionFactor)return S.subSurface.translucencyIntensity=0,S.subSurface.isTranslucencyEnabled=!1,Promise.resolve();S.subSurface.translucencyIntensity=J.diffuseTransmissionFactor;const v=new Array;return S.subSurface.useGltfStyleTextures=!0,J.diffuseTransmissionTexture&&(J.diffuseTransmissionTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionTexture`,J.diffuseTransmissionTexture).then((t=>{t.name=`${Z.name} (Diffuse Transmission)`,S.subSurface.translucencyIntensityTexture=t})))),void 0!==J.diffuseTransmissionColorFactor?S.subSurface.translucencyColor=P.hZ.CZ(J.diffuseTransmissionColorFactor):S.subSurface.translucencyColor=P.hZ.White(),J.diffuseTransmissionColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${t}/diffuseTransmissionColorTexture`,J.diffuseTransmissionColorTexture).then((t=>{t.name=`${Z.name} (Diffuse Transmission Color)`,S.subSurface.translucencyColorTexture=t}))),Promise.all(v).then((()=>{}))}}N(Gt),Q(Gt,!0,(t=>new tb(t)));const bb="KHR_materials_volume";class Zb{constructor(t){this.name=bb,this.order=173,this._loader=t,this.enabled=this._loader.isExtensionUsed(bb),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadVolumePropertiesAsync(J,b,Z,S)),await Promise.all(P).then((()=>{}))}))}_loadVolumePropertiesAsync(t,b,Z,J){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);if(!Z.subSurface.isRefractionEnabled&&!Z.subSurface.isTranslucencyEnabled||!J.thicknessFactor)return Promise.resolve();Z.subSurface.volumeIndexOfRefraction=Z.indexOfRefraction;const S=void 0!==J.attenuationDistance?J.attenuationDistance:Number.MAX_VALUE;return Z.subSurface.tintColorAtDistance=S,void 0!==J.attenuationColor&&3==J.attenuationColor.length&&Z.subSurface.tintColor.Ab(J.attenuationColor[0],J.attenuationColor[1],J.attenuationColor[2]),Z.subSurface.minimumThickness=0,Z.subSurface.maximumThickness=J.thicknessFactor,Z.subSurface.useThicknessAsDepth=!0,J.thicknessTexture?(J.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${t}/thicknessTexture`,J.thicknessTexture).then((t=>{t.name=`${Z.name} (Thickness)`,Z.subSurface.thicknessTexture=t,Z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}N(bb),Q(bb,!0,(t=>new Zb(t)));const Jb="KHR_materials_dispersion";class Sb{constructor(t){this.name=Jb,this.order=174,this._loader=t,this.enabled=this._loader.isExtensionUsed(Jb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadDispersionPropertiesAsync(J,b,Z,S)),await Promise.all(P).then((()=>{}))}))}_loadDispersionPropertiesAsync(t,b,Z,J){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);return Z.subSurface.isRefractionEnabled&&J.dispersion?(Z.subSurface.isDispersionEnabled=!0,Z.subSurface.dispersion=J.dispersion,Promise.resolve()):Promise.resolve()}}N(Jb),Q(Jb,!0,(t=>new Sb(t)));const Pb="EXT_materials_diffuse_roughness";class vb{constructor(t){this.name=Pb,this.order=190,this._loader=t,this.enabled=this._loader.isExtensionUsed(Pb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=new Array;return P.push(this._loader.loadMaterialPropertiesAsync(t,b,Z)),P.push(this._loadDiffuseRoughnessPropertiesAsync(J,S,Z)),await Promise.all(P).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(t,b,Z){if(!(Z instanceof U.b))throw new Error(`${t}: Material type not supported`);const J=new Array;return Z.brdf.baseDiffuseModel=Ft.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=b.diffuseRoughnessFactor?Z.baseDiffuseRoughness=b.diffuseRoughnessFactor:Z.baseDiffuseRoughness=0,b.diffuseRoughnessTexture&&J.push(this._loader.loadTextureInfoAsync(`${t}/diffuseRoughnessTexture`,b.diffuseRoughnessTexture,(t=>{t.name=`${Z.name} (Diffuse Roughness)`,Z.baseDiffuseRoughnessTexture=t}))),Promise.all(J).then((()=>{}))}}N(Pb),Q(Pb,!0,(t=>new vb(t)));const hb="KHR_mesh_quantization";class Cb{constructor(t){this.name=hb,this.enabled=t.isExtensionUsed(hb)}dispose(){}}N(hb),Q(hb,!0,(t=>new Cb(t)));const Yb="KHR_texture_basisu";class gb{constructor(t){this.name=Yb,this._loader=t,this.enabled=t.isExtensionUsed(Yb)}dispose(){this._loader=null}_loadTextureAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>{const P=void 0==b.sampler?X.DefaultSampler:F.Get(`${t}/sampler`,this._loader.pb.samplers,b.sampler),v=F.Get(`${J}/source`,this._loader.pb.images,S.source);return await this._loader._createTextureAsync(t,P,v,(t=>{Z(t)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}N(Yb),Q(Yb,!0,(t=>new gb(t)));const Ib="KHR_texture_transform";class rb{constructor(t){this.name=Ib,this._loader=t,this.enabled=this._loader.isExtensionUsed(Ib)}dispose(){this._loader=null}loadTextureInfoAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(J,S)=>await this._loader.loadTextureInfoAsync(t,b,(t=>{if(!(t instanceof E.c))throw new Error(`${J}: Texture type not supported`);S.offset&&(t.uOffset=S.offset[0],t.vOffset=S.offset[1]),t.uRotationCenter=0,t.vRotationCenter=0,S.rotation&&(t.wAng=-S.rotation),S.scale&&(t.uScale=S.scale[0],t.vScale=S.scale[1]),void 0!=S.texCoord&&(t.coordinatesIndex=S.texCoord),Z(t)}))))}}N(Ib),Q(Ib,!0,(t=>new rb(t)));const Mb="KHR_xmp_json_ld";class Tb{constructor(t){this.name=Mb,this.order=100,this._loader=t,this.enabled=this._loader.isExtensionUsed(Mb)}dispose(){this._loader=null}onLoading(){var t,b,Z;if(null===this._loader.rootBabylonMesh)return;const J=null===(t=this._loader.pb.extensions)||void 0===t?void 0:t.KHR_xmp_json_ld,S=null===(b=this._loader.pb.asset)||void 0===b||null===(Z=b.extensions)||void 0===Z?void 0:Z.KHR_xmp_json_ld;if(J&&S){const t=+S.packet;J.packets&&t<J.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=J.packets[t])}}}function ab(t,b,Z,J){return P.hZ.CZ(b,Z).scale(J)}function kb(t,b,Z,J){return b[Z]*J}function ub(t,b,Z,J){return-b[Z]*J}function lb(t,b,Z,J){return b[Z+1]*J}function Ub(t,b,Z,J){return b[Z]*J*2}function Eb(t){return{scale:[new Hb(r.d.ANIMATIONTYPE_FLOAT,`${t}.uScale`,kb,(()=>2)),new Hb(r.d.ANIMATIONTYPE_FLOAT,`${t}.vScale`,lb,(()=>2))],offset:[new Hb(r.d.ANIMATIONTYPE_FLOAT,`${t}.uOffset`,kb,(()=>2)),new Hb(r.d.ANIMATIONTYPE_FLOAT,`${t}.vOffset`,lb,(()=>2))],rotation:[new Hb(r.d.ANIMATIONTYPE_FLOAT,`${t}.wAng`,ub,(()=>1))]}}N(Mb),Q(Mb,!0,(t=>new Tb(t)));class cb extends x.AnimationPropertyInfo{buildAnimations(t,b,Z,J){return[{babylonAnimatable:t._babylonCamera,babylonAnimation:this._buildAnimation(b,Z,J)}]}}class Hb extends x.AnimationPropertyInfo{buildAnimations(t,b,Z,J){const S=[];for(const P in t._data)S.push({babylonAnimatable:t._data[P].babylonMaterial,babylonAnimation:this._buildAnimation(b,Z,J)});return S}}class ob extends x.AnimationPropertyInfo{buildAnimations(t,b,Z,J){return[{babylonAnimatable:t._babylonLight,babylonAnimation:this._buildAnimation(b,Z,J)}]}}(0,A.m)("/cameras/{}/orthographic/xmag",[new cb(r.d.ANIMATIONTYPE_FLOAT,"orthoLeft",ub,(()=>1)),new cb(r.d.ANIMATIONTYPE_FLOAT,"orthoRight",lb,(()=>1))]),(0,A.m)("/cameras/{}/orthographic/ymag",[new cb(r.d.ANIMATIONTYPE_FLOAT,"orthoBottom",ub,(()=>1)),new cb(r.d.ANIMATIONTYPE_FLOAT,"orthoTop",lb,(()=>1))]),(0,A.m)("/cameras/{}/orthographic/zfar",[new cb(r.d.ANIMATIONTYPE_FLOAT,"maxZ",kb,(()=>1))]),(0,A.m)("/cameras/{}/orthographic/znear",[new cb(r.d.ANIMATIONTYPE_FLOAT,"nb",kb,(()=>1))]),(0,A.m)("/cameras/{}/perspective/yfov",[new cb(r.d.ANIMATIONTYPE_FLOAT,"fov",kb,(()=>1))]),(0,A.m)("/cameras/{}/perspective/zfar",[new cb(r.d.ANIMATIONTYPE_FLOAT,"maxZ",kb,(()=>1))]),(0,A.m)("/cameras/{}/perspective/znear",[new cb(r.d.ANIMATIONTYPE_FLOAT,"nb",kb,(()=>1))]),(0,A.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"albedoColor",ab,(()=>4)),new Hb(r.d.ANIMATIONTYPE_FLOAT,"alpha",(function(t,b,Z,J){return b[Z+3]*J}),(()=>4))]),(0,A.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"metallic",kb,(()=>1))]),(0,A.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"roughness",kb,(()=>1))]);const Ob=Eb("albedoTexture");(0,A.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ob.scale),(0,A.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ob.offset),(0,A.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ob.rotation);const pb=Eb("metallicTexture");(0,A.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",pb.scale),(0,A.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",pb.offset),(0,A.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",pb.rotation),(0,A.m)("/materials/{}/emissiveFactor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"emissiveColor",ab,(()=>3))]);const eb=Eb("bumpTexture");(0,A.m)("/materials/{}/normalTexture/scale",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",kb,(()=>1))]),(0,A.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",eb.scale),(0,A.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",eb.offset),(0,A.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",eb.rotation),(0,A.m)("/materials/{}/occlusionTexture/strength",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",kb,(()=>1))]);const Wb=Eb("ambientTexture");(0,A.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Wb.scale),(0,A.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Wb.offset),(0,A.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Wb.rotation);const jb=Eb("emissiveTexture");(0,A.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",jb.scale),(0,A.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",jb.offset),(0,A.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",jb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",kb,(()=>1))]);const Vb=Eb("anisotropy.texture");(0,A.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Vb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Vb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Vb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",kb,(()=>1))]);const nb=Eb("clearCoat.texture");(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",nb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",nb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",nb.rotation);const yb=Eb("clearCoat.bumpTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",yb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",yb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",yb.rotation);const db=Eb("clearCoat.textureRoughness");(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",db.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",db.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",db.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",kb,(()=>1))]);const sb=Eb("iridescence.texture");(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",sb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",sb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",sb.rotation);const qb=Eb("iridescence.thicknessTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",qb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",qb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",qb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"sheen.color",ab,(()=>3))]),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",kb,(()=>1))]);const Qb=Eb("sheen.texture");(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Qb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Qb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Qb.rotation);const Nb=Eb("sheen.textureRoughness");(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Nb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Nb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Nb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",ab,(()=>3))]);const Ab=Eb("metallicReflectanceTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Ab.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Ab.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Ab.rotation);const Kb=Eb("reflectanceTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Kb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Kb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Kb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",kb,(()=>1))]);const Lb=Eb("subSurface.refractionIntensityTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Lb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Lb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Lb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",ab,(()=>3))]),(0,A.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",kb,(()=>1))]),(0,A.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",kb,(()=>1))]);const Fb=Eb("subSurface.thicknessTexture");(0,A.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Fb.scale),(0,A.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Fb.offset),(0,A.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Fb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Hb(r.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",kb,(()=>1))]);const Bb=Eb("subSurface.translucencyIntensityTexture");(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Bb.scale),(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Bb.offset),(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Bb.rotation),(0,A.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Hb(r.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",ab,(()=>3))]);const Xb=Eb("subSurface.translucencyColorTexture");(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Xb.scale),(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Xb.offset),(0,A.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Xb.rotation),(0,A.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new ob(r.d.ANIMATIONTYPE_COLOR3,"diffuse",ab,(()=>3))]),(0,A.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new ob(r.d.ANIMATIONTYPE_FLOAT,"intensity",kb,(()=>1))]),(0,A.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new ob(r.d.ANIMATIONTYPE_FLOAT,"range",kb,(()=>1))]),(0,A.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new ob(r.d.ANIMATIONTYPE_FLOAT,"innerAngle",Ub,(()=>1))]),(0,A.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new ob(r.d.ANIMATIONTYPE_FLOAT,"angle",Ub,(()=>1))]),(0,A.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new ob(r.d.ANIMATIONTYPE_COLOR3,"diffuse",ab,(()=>3))]),(0,A.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new ob(r.d.ANIMATIONTYPE_FLOAT,"intensity",kb,(()=>1))]);const xb="KHR_animation_pointer";class ib{constructor(t){this.name=xb,this._loader=t,this._pathToObjectConverter=(0,A.j)(this._loader.pb)}get enabled(){return this._loader.isExtensionUsed(xb)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(t,b,Z,J,S){var P;const v=null===(P=J.target.extensions)||void 0===P?void 0:P.KHR_animation_pointer;if(!v||!this._pathToObjectConverter)return null;"pointer"!==J.target.path&&a.c.Warn(`${t}/target/path: Value (${J.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=J.target.node&&a.c.Warn(`${t}/target/node: Value (${J.target.node}) must not be present when using the ${this.name} extension`);const h=`${t}/extensions/${this.name}`,C=v.pointer;if(!C)throw new Error(`${h}: Pointer is missing`);try{const P=this._pathToObjectConverter.convert(C);if(!P.info.interpolation)throw new Error(`${h}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(t,b,Z,J,{object:P.object,info:P.info.interpolation},S)}catch(Y){return a.c.Warn(`${h}/pointer: Invalid pointer (${C}) skipped`),null}}}N(xb),Q(xb,!0,(t=>new ib(t)));class zb{constructor(t,b,Z){this.frame=t,this.action=b,this.onlyOnce=Z,this.isDone=!1}_clone(){return new zb(this.frame,this.action,this.onlyOnce)}}var Db=Z(12573),fb=Z(12623),mZ=Z(12621);class Rb{get loop(){return this._loop}set loop(t){t!==this._loop&&(this._loop=t,this.updateOptions({loop:t}))}get currentTime(){var t;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(t=fb.e.audioEngine)&&void 0!==t&&t.audioContext&&(this.isPlaying||this.isPaused)){const t=this.isPaused?0:fb.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+t}return 0}get spatialSound(){return this._spatialSound}set spatialSound(t){if(t==this._spatialSound)return;const b=this.isPlaying;this.pause(),t?(this._spatialSound=t,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(t,b,Z){var J;let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new g.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=S.JZ.Zero(),this._localDirection=new S.JZ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,Z=Z||T.e.LastCreatedScene)if(this._scene=Z,Rb._SceneComponentInitialization(Z),this._readyToPlayCallback=P,this._customAttenuationFunction=(t,b,Z,J,S)=>b<Z?t*(1-b/Z):0,h&&(this.autoplay=h.autoplay||!1,this._loop=h.loop||!1,void 0!==h.volume&&(this._volume=h.volume),this._spatialSound=h.spatialSound??!1,this.maxDistance=h.maxDistance??100,this.useCustomAttenuation=h.useCustomAttenuation??!1,this.rolloffFactor=h.rolloffFactor||1,this.refDistance=h.refDistance||1,this.distanceModel=h.distanceModel||"linear",this._playbackRate=h.playbackRate||1,this._streaming=h.streaming??!1,this._length=h.length,this._offset=h.offset),null!==(J=fb.e.audioEngine)&&void 0!==J&&J.canUseWebAudio&&fb.e.audioEngine.audioContext){this._soundGain=fb.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let t=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let Z=[],J=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=fb.e.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=fb.e.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(J=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":Z.push(b);case"Array":0===Z.length&&(Z=b);for(let t=0;t<Z.length;t++){const b=Z[t];if(J=h&&h.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&fb.e.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&fb.e.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),J){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,v.Tools.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(t=>{this._soundLoaded(t)}),void 0,!0,!0,(t=>{t&&a.c.Error("XHR "+t.status+" error on: "+b+"."),a.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:t=!1}t?J||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):a.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){a.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),fb.e.audioEngine&&!fb.e.audioEngine.WarnedWebAudioUnsupported&&(a.c.Error("Web Audio is not supported by your browser."),fb.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var t;null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(t){var b;null!==(b=fb.e.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=t,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(t){var b;null!==(b=fb.e.audioEngine)&&void 0!==b&&b.audioContext&&fb.e.audioEngine.audioContext.decodeAudioData(t,(t=>{this._audioBufferLoaded(t)}),(t=>{a.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+t)}))}setAudioBuffer(t){var b;null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)}updateOptions(t){t&&(this.loop=t.loop??this.loop,this.maxDistance=t.maxDistance??this.maxDistance,this.useCustomAttenuation=t.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=t.rolloffFactor??this.rolloffFactor,this.refDistance=t.refDistance??this.refDistance,this.distanceModel=t.distanceModel??this.distanceModel,this._playbackRate=t.playbackRate??this._playbackRate,this._length=t.length??void 0,this.spatialSound=t.spatialSound??this._spatialSound,this._setOffset(t.offset??void 0),this.setVolume(t.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var t;null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&fb.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??fb.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var t;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(t=this._soundPanner)||void 0===t||t.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var t;null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(t){var b;null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(t),this._isOutputConnected=!0)}setDirectionalCone(t,b,Z){b<t?a.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=b,this._coneOuterGain=Z,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!=this._coneInnerAngle){var b;if(this._coneOuterAngle<t)return void a.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!=this._coneOuterAngle){var b;if(t<this._coneInnerAngle)return void a.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t,null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(t){var b;t.equals(this._position)||(this._position.S(t),null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(t){var b;this._localDirection=t,null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const t=this._connectedTransformNode.getWorldMatrix(),b=S.JZ.TransformNormal(this._localDirection,t);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var t;if(null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const t=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.SZ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(t){this._customAttenuationFunction=t}play(t,b,Z){var J;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(J=fb.e.audioEngine)&&void 0!==J&&J.audioContext)try{var S,P;this._clearTimeoutsAndObservers();let J=t?(null===(S=fb.e.audioEngine)||void 0===S?void 0:S.audioContext.currentTime)+t:null===(P=fb.e.audioEngine)||void 0===P?void 0:P.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=fb.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const t=()=>{var Z;if(null!==(Z=fb.e.audioEngine)&&void 0!==Z&&Z.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const Z=this._htmlAudioElement.play();void 0!==Z&&Z.catch((()=>{var b,Z;(null===(b=fb.e.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Z=fb.e.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{t()})))}))}else{var J;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(J=fb.e.audioEngine)||void 0===J?void 0:J.onAudioUnlockedObservable.addOnce((()=>{t()}))}};t()}}else{var v;const S=()=>{var S;if(null!==(S=fb.e.audioEngine)&&void 0!==S&&S.audioContext){var P;if(Z=Z||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const t=this._soundSource;t.onended=()=>{t.disconnect()}}if(this._soundSource=null===(P=fb.e.audioEngine)||void 0===P?void 0:P.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var v;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==Z&&(this._soundSource.loopEnd=(0|b)+Z),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},J=t?(null===(v=fb.e.audioEngine)||void 0===v?void 0:v.audioContext.currentTime)+t:fb.e.audioEngine.audioContext.currentTime;const S=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(J,S,this.loop?void 0:Z)}}};"suspended"===(null===(v=fb.e.audioEngine)||void 0===v?void 0:v.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var t;"suspended"===(null===(t=fb.e.audioEngine)||void 0===t?void 0:t.audioContext.state)?(fb.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=fb.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{S()})))):S()}),500):S()}this._startTime=J,this.isPlaying=!0,this.isPaused=!1}catch(h){a.c.Error("Error while trying to play audio: "+this.name+", "+h.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(t){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Z;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Z=this._streamingSource)||void 0===Z||Z.disconnect();this.isPlaying=!1}else if(null!==(b=fb.e.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=t?fb.e.audioEngine.audioContext.currentTime+t:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(t=fb.e.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=fb.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(t,b){var Z;null!==(Z=fb.e.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&this._soundGain&&(b&&fb.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(fb.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,fb.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,fb.e.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=t),this._volume=t}setPlaybackRate(t){this._playbackRate=t,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(t){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=t,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=t=>this._onRegisterAfterWorldMatrixUpdate(t),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(t){var b;if(t.getBoundingInfo){const b=t.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(t.absolutePosition);null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const t=()=>{(0,mZ.f)((()=>this._isReadyToPlay),(()=>{Z._audioBuffer=this.getAudioBuffer(),Z._isReadyToPlay=!0,Z.autoplay&&Z.play(0,this._offset,this._length)}),void 0,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Z=new Rb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&Z.setAttenuationFunction(this._customAttenuationFunction),Z.setPosition(this._position),Z.setPlaybackRate(this._playbackRate),t(),Z}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const t={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(t.connectedMeshId=this._connectedTransformNode.id),t.position=this._position.jb(),t.refDistance=this.refDistance,t.distanceModel=this.distanceModel,t.isDirectional=this._isDirectional,t.localDirectionToMesh=this._localDirection.jb(),t.coneInnerAngle=this._coneInnerAngle,t.coneOuterAngle=this._coneOuterAngle,t.coneOuterGain=this._coneOuterGain),t}static Parse(t,b,Z,J){const P=t.name;let v;v=t.url?Z+t.url:Z+P;const h={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};let C;if(J){const t=()=>{(0,mZ.f)((()=>J._isReadyToPlay),(()=>{C._audioBuffer=J.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new Rb(P,new ArrayBuffer(0),b,null,h),t()}else C=new Rb(P,v,b,(()=>{b.removePendingData(C)}),h),b.addPendingData(C);if(t.position){const b=S.JZ.CZ(t.position);C.setPosition(b)}if(t.isDirectional&&(C.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){const b=S.JZ.CZ(t.localDirectionToMesh);C.setLocalDirectionToMesh(b)}if(t.connectedMeshId){const Z=b.getMeshById(t.connectedMeshId);Z&&C.attachToMesh(Z)}return t.metadata&&(C.metadata=t.metadata),C}_setOffset(t){this._offset!==t&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=t)}_clearTimeoutsAndObservers(){var t;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(t=fb.e.audioEngine)||void 0===t||t.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Rb._SceneComponentInitialization=t=>{throw(0,Db.b)("AudioSceneComponent")},(0,Ht.f)("BABYLON.Sound",Rb);class wb{constructor(t,b,Z){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==Z.length)throw new Error("Sounds length does not equal weights length");this.loop=t,this._weights=Z;let J=0;for(const P of Z)J+=P;const S=J>0?1/J:0;for(let P=0;P<this._weights.length;P++)this._weights[P]*=S;this._sounds=b;for(const P of this._sounds)P.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(t){if(t!==this._coneInnerAngle){if(this._coneOuterAngle<t)return void a.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t;for(const b of this._sounds)b.directionalConeInnerAngle=t}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(t){if(t!==this._coneOuterAngle){if(t<this._coneInnerAngle)return void a.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=t;for(const b of this._sounds)b.directionalConeOuterAngle=t}}get volume(){return this._volume}set volume(t){if(t!==this._volume)for(const b of this._sounds)b.setVolume(t)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(t){if(!this.isPaused){this.stop();const t=Math.random();let b=0;for(let Z=0;Z<this._weights.length;Z++)if(b+=this._weights[Z],t<=b){this._currentIndex=Z;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:t):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Gb{constructor(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(t=t||T.e.LastCreatedScene)&&(this._scene=t,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var t;null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio&&fb.e.audioEngine.audioContext&&(this._outputAudioNode=fb.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(fb.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(fb.e.audioEngine&&fb.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(t){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.removeSound(t):this._scene.soundTracks&&this._scene.soundTracks[t.soundTrackId].removeSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id}removeSound(t){const b=this.soundCollection.indexOf(t);-1!==b&&this.soundCollection.splice(b,1)}setVolume(t){var b;null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)}switchPanningModelToHRTF(){var t;if(null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var t;if(null!==(t=fb.e.audioEngine)&&void 0!==t&&t.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(t){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,null!==(b=fb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,fb.e.audioEngine.masterGain))}}var tZ=Z(13009),bZ=Z(12975),ZZ=Z(12555);fb.e.AudioEngineFactory=(t,b,Z)=>new JZ(t,b,Z);class JZ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new g.d,this.onAudioLockedObservable=new g.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ZZ.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const J=document.createElement("audio");this._hostElement=t,this._audioContext=b,this._audioDestination=Z;try{J&&J.canPlayType&&(J.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||J.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(S){}try{J&&J.canPlayType&&J.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(S){}}lock(){this._triggerSuspendedState()}unlock(){var t,b;if("running"===(null===(t=this._audioContext)||void 0===t?void 0:t.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{a.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var t;null===(t=this._audioContext)||void 0===t||t.addEventListener("statechange",(()=>{var t;this.unlocked&&"running"!==(null===(t=this._audioContext)||void 0===t?void 0:t.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var t;return null!==(t=this._audioContext)&&void 0!==t&&t.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(t){this.canUseWebAudio=!1,a.c.Error("Web Audio: "+t.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(t){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const t=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var t;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(t=this._audioContext)||void 0===t||t.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(t){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=t)}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var SZ=Z(12570);(0,Z(14070).h)(tZ.d.NAME_AUDIO,((t,b,Z,J)=>{let S,P=[];if(Z.HM=Z.HM||[],void 0!==t.HM&&null!==t.HM)for(let h=0,C=t.HM.length;h<C;h++){var v;const C=t.HM[h];null!==(v=fb.e.audioEngine)&&void 0!==v&&v.canUseWebAudio?(C.url||(C.url=C.name),P[C.url]?Z.HM.push(Rb.Parse(C,b,J,P[C.url])):(S=Rb.Parse(C,b,J),P[C.url]=S,Z.HM.push(S))):Z.HM.push(new Rb(C.name,null,b))}P=[]})),Object.defineProperty(bZ.d.prototype,"mainSoundTrack",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),this._mainSoundTrack||(this._mainSoundTrack=new Gb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),bZ.d.prototype.getSoundByName=function(t){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===t)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let Z=0;Z<this.soundTracks.length;Z++)for(b=0;b<this.soundTracks[Z].soundCollection.length;b++)if(this.soundTracks[Z].soundCollection[b].name===t)return this.soundTracks[Z].soundCollection[b];return null},Object.defineProperty(bZ.d.prototype,"audioEnabled",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),t.audioEnabled},set:function(t){let b=this._getComponent(tZ.d.NAME_AUDIO);b||(b=new PZ(this),this.Mb(b)),t?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(bZ.d.prototype,"headphone",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),t.headphone},set:function(t){let b=this._getComponent(tZ.d.NAME_AUDIO);b||(b=new PZ(this),this.Mb(b)),t?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(bZ.d.prototype,"audioListenerPositionProvider",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),t.audioListenerPositionProvider},set:function(t){let b=this._getComponent(tZ.d.NAME_AUDIO);if(b||(b=new PZ(this),this.Mb(b)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(bZ.d.prototype,"audioListenerRotationProvider",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),t.audioListenerRotationProvider},set:function(t){let b=this._getComponent(tZ.d.NAME_AUDIO);if(b||(b=new PZ(this),this.Mb(b)),t&&"function"!==typeof t)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=t},enumerable:!0,configurable:!0}),Object.defineProperty(bZ.d.prototype,"audioPositioningRefreshRate",{get:function(){let t=this._getComponent(tZ.d.NAME_AUDIO);return t||(t=new PZ(this),this.Mb(t)),t.audioPositioningRefreshRate},set:function(t){let b=this._getComponent(tZ.d.NAME_AUDIO);b||(b=new PZ(this),this.Mb(b)),b.audioPositioningRefreshRate=t},enumerable:!0,configurable:!0});class PZ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(t){this.name=tZ.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new S.JZ,this._cachedCameraPosition=new S.JZ,this._lastCheck=0,this._invertMatrixTemp=new S.Matrix,this._cameraDirectionTemp=new S.JZ,(t=t||T.e.LastCreatedScene)&&(this.PZ=t,t.soundTracks=[],t.HM=[])}register(){this.PZ._afterRenderStage.registerStep(tZ.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(t){if(t.HM=[],this.PZ.soundTracks)for(let b=0;b<this.PZ.soundTracks.length;b++){const Z=this.PZ.soundTracks[b];for(let b=0;b<Z.soundCollection.length;b++)t.HM.push(Z.soundCollection[b].serialize())}}addFromContainer(t){if(t.HM)for(const b of t.HM)b.play(),b.autoplay=!0,this.PZ.mainSoundTrack.addSound(b)}removeFromContainer(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.HM)for(const Z of t.HM)Z.stop(),Z.autoplay=!1,this.PZ.mainSoundTrack.removeSound(Z),b&&Z.dispose()}dispose(){const t=this.PZ;if(t._mainSoundTrack&&t.mainSoundTrack.dispose(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].dispose()}disableAudio(){const t=this.PZ;let b;for(this._audioEnabled=!1,fb.e.audioEngine&&fb.e.audioEngine.audioContext&&fb.e.audioEngine.audioContext.suspend(),b=0;b<t.mainSoundTrack.soundCollection.length;b++)t.mainSoundTrack.soundCollection[b].pause();if(t.soundTracks)for(b=0;b<t.soundTracks.length;b++)for(let Z=0;Z<t.soundTracks[b].soundCollection.length;Z++)t.soundTracks[b].soundCollection[Z].pause()}enableAudio(){const t=this.PZ;let b;for(this._audioEnabled=!0,fb.e.audioEngine&&fb.e.audioEngine.audioContext&&fb.e.audioEngine.audioContext.resume(),b=0;b<t.mainSoundTrack.soundCollection.length;b++)t.mainSoundTrack.soundCollection[b].isPaused&&t.mainSoundTrack.soundCollection[b].play();if(t.soundTracks)for(b=0;b<t.soundTracks.length;b++)for(let Z=0;Z<t.soundTracks[b].soundCollection.length;Z++)t.soundTracks[b].soundCollection[Z].isPaused&&t.soundTracks[b].soundCollection[Z].play()}switchAudioModeForHeadphones(){const t=this.PZ;if(this._headphone=!0,t.mainSoundTrack.switchPanningModelToHRTF(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const t=this.PZ;if(this._headphone=!1,t.mainSoundTrack.switchPanningModelToEqualPower(),t.soundTracks)for(let b=0;b<t.soundTracks.length;b++)t.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const t=SZ.e.Now;if(this._lastCheck&&t-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=t;const b=this.PZ;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const Z=fb.e.audioEngine;if(Z&&Z.audioContext){let t,J=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(J=b.activeCameras[0]),this.audioListenerPositionProvider){const t=this.audioListenerPositionProvider();Z.audioContext.listener.setPosition(t.x||0,t.y||0,t.z||0)}else J?this._cachedCameraPosition.equals(J.globalPosition)||(this._cachedCameraPosition.S(J.globalPosition),Z.audioContext.listener.setPosition(J.globalPosition.x,J.globalPosition.y,J.globalPosition.z)):Z.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const t=this.audioListenerRotationProvider();Z.audioContext.listener.setOrientation(t.x||0,t.y||0,t.z||0,0,1,0)}else J?(J.rigCameras&&J.rigCameras.length>0&&(J=J.rigCameras[0]),J.getViewMatrix().invertToRef(this._invertMatrixTemp),S.JZ.TransformNormalToRef(PZ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.S(this._cameraDirectionTemp),Z.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Z.audioContext.listener.setOrientation(0,0,0,0,1,0);for(t=0;t<b.mainSoundTrack.soundCollection.length;t++){const Z=b.mainSoundTrack.soundCollection[t];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}if(b.soundTracks)for(t=0;t<b.soundTracks.length;t++)for(let Z=0;Z<b.soundTracks[t].soundCollection.length;Z++){const J=b.soundTracks[t].soundCollection[Z];J.useCustomAttenuation&&J.updateDistanceFromListener()}}}}PZ._CameraDirection=new S.JZ(0,0,-1),Rb._SceneComponentInitialization=t=>{let b=t._getComponent(tZ.d.NAME_AUDIO);b||(b=new PZ(t),t.Mb(b))};const vZ="MSFT_audio_emitter";class hZ{constructor(t){this.name=vZ,this._loader=t,this.enabled=this._loader.isExtensionUsed(vZ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const t=this._loader.pb.extensions;if(t&&t[this.name]){const b=t[this.name];this._clips=b.clips,this._emitters=b.emitters,F.Assign(this._clips),F.Assign(this._emitters)}}loadSceneAsync(t,b){return X.LoadExtensionAsync(t,b,this.name,(async(Z,J)=>{const S=new Array;S.push(this._loader.loadSceneAsync(t,b));for(const t of J.emitters){const b=F.Get(`${Z}/emitters`,this._emitters,t);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${Z}: Direction or Distance properties are not allowed on emitters attached to a scene`);S.push(this._loadEmitterAsync(`${Z}/emitters/${b.index}`,b))}await Promise.all(S)}))}loadNodeAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(t,J)=>{const P=new Array,h=await this._loader.loadNodeAsync(t,b,(b=>{for(const Z of J.emitters){const J=F.Get(`${t}/emitters`,this._emitters,Z);P.push(this._loadEmitterAsync(`${t}/emitters/${J.index}`,J).then((()=>{for(const t of J._babylonSounds)t.attachToMesh(b),void 0==J.innerAngle&&void 0==J.outerAngle||(t.setLocalDirectionToMesh(S.JZ.Forward()),t.setDirectionalCone(2*v.Tools.ToDegrees(void 0==J.innerAngle?Math.PI:J.innerAngle),2*v.Tools.ToDegrees(void 0==J.outerAngle?Math.PI:J.outerAngle),0))})))}Z(b)}));return await Promise.all(P),h}))}loadAnimationAsync(t,b){return X.LoadExtensionAsync(t,b,this.name,(async(Z,J)=>{const S=await this._loader.loadAnimationAsync(t,b),P=new Array;F.Assign(J.events);for(const v of J.events)P.push(this._loadAnimationEventAsync(`${Z}/events/${v.index}`,t,b,v,S));return await Promise.all(P),S}))}_loadClipAsync(t,b){if(b._objectURL)return b._objectURL;let Z;if(b.uri)Z=this._loader.loadUriAsync(t,b,b.uri);else{const J=F.Get(`${t}/bufferView`,this._loader.pb.bufferViews,b.bufferView);Z=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J)}return b._objectURL=Z.then((t=>URL.createObjectURL(new Blob([t],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(t,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const t=new Array,Z=b.name||`emitter${b.index}`,J={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let P=0;P<b.clips.length;P++){const S=`/extensions/${this.name}/clips`,v=F.Get(S,this._clips,b.clips[P].clip);t.push(this._loadClipAsync(`${S}/${b.clips[P].clip}`,v).then((t=>{const S=b._babylonSounds[P]=new Rb(Z,t,this._loader.babylonScene,null,J);S.refDistance=b.refDistance||1,S.maxDistance=b.maxDistance||256,S.rolloffFactor=b.rolloffFactor||1,S.distanceModel=b.distanceModel||"exponential"})))}const S=Promise.all(t).then((()=>{const t=b.clips.map((t=>t.weight||1)),Z=new wb(b.loop||!1,b._babylonSounds,t);b.innerAngle&&(Z.directionalConeInnerAngle=2*v.Tools.ToDegrees(b.innerAngle)),b.outerAngle&&(Z.directionalConeOuterAngle=2*v.Tools.ToDegrees(b.outerAngle)),b.volume&&(Z.volume=b.volume),b._babylonData.sound=Z}));b._babylonData={loaded:S}}return b._babylonData.loaded}_getEventAction(t,b,Z,J,S){switch(Z){case"play":return t=>{const Z=(S||0)+(t-J);b.play(Z)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${t}: Unsupported action ${Z}`)}}_loadAnimationEventAsync(t,b,Z,J,S){if(0==S.targetedAnimations.length)return Promise.resolve();const P=S.targetedAnimations[0],v=J.hb,h=F.Get(`/extensions/${this.name}/emitters`,this._emitters,v);return this._loadEmitterAsync(t,h).then((()=>{const b=h._babylonData.sound;if(b){const Z=new zb(J.time,this._getEventAction(t,b,J.action,J.time,J.startOffset));P.animation.addEvent(Z),S.onAnimationGroupEndObservable.add((()=>{b.stop()})),S.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}N(vZ),Q(vZ,!0,(t=>new hZ(t)));const CZ="MSFT_lod";class YZ{constructor(t){var b;this.name=CZ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new g.d,this.onMaterialLODsLoadedObservable=new g.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=t,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[CZ])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(CZ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let t=0;t<this._nodePromiseLODs.length;t++){const b=Promise.all(this._nodePromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Node LOD ${t}`),this._loader.log(`Loaded node LOD ${t}`)),this.onNodeLODsLoadedObservable.notifyObservers(t),t!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${t+1}`),this._loadBufferLOD(this._nodeBufferLODs,t+1),this._nodeSignalLODs[t]&&this._nodeSignalLODs[t].resolve())}));this._loader._completePromises.push(b)}for(let t=0;t<this._materialPromiseLODs.length;t++){const b=Promise.all(this._materialPromiseLODs[t]).then((()=>{0!==t&&(this._loader.endPerformanceCounter(`Material LOD ${t}`),this._loader.log(`Loaded material LOD ${t}`)),this.onMaterialLODsLoadedObservable.notifyObservers(t),t!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${t+1}`),this._loadBufferLOD(this._materialBufferLODs,t+1),this._materialSignalLODs[t]&&this._materialSignalLODs[t].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(t,b){const Z=this._loader.loadSceneAsync(t,b);return this._loadBufferLOD(this._bufferLODs,0),Z}loadNodeAsync(t,b,Z){return X.LoadExtensionAsync(t,b,this.name,(async(t,S)=>{let P;const v=this._getLODs(t,b,this._loader.pb.nodes,S.ids);this._loader.logOpen(`${t}`);for(let b=0;b<v.length;b++){const t=v[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new J);const S=t=>{Z(t),t.uC(!1)},h=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,S).then((t=>{if(0!==b){const t=v[b-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.uC(!0),t}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?P=h:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(h))}return this._loader.logClose(),await P}))}_loadMaterialAsync(t,b,Z,J,S){return this._nodeIndexLOD?null:X.LoadExtensionAsync(t,b,this.name,(async(t,P)=>{let v;const h=this._getLODs(t,b,this._loader.pb.materials,P.ids);this._loader.logOpen(`${t}`);for(let b=0;b<h.length;b++){const t=h[b];0!==b&&(this._materialIndexLOD=b);const P=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,Z,J,(t=>{0===b&&S(t)})).then((t=>{if(0!==b){S(t);const Z=h[b-1]._data;Z[J]&&(this._disposeMaterials([Z[J].babylonMaterial]),delete Z[J])}return t}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?v=P:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(P))}return this._loader.logClose(),await v}))}_loadUriAsync(t,b,Z){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const S=this._nodeIndexLOD-1;return this._nodeSignalLODs[S]=this._nodeSignalLODs[S]||new J,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(t,b,Z)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const S=this._materialIndexLOD-1;return this._materialSignalLODs[S]=this._materialSignalLODs[S]||new J,this._materialSignalLODs[S].promise.then((async()=>await this._loader.loadUriAsync(t,b,Z)))}return null}loadBufferAsync(t,b,Z,S){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);const b=async(t,b)=>{const P=Z,v=P+S-1;let h=t[b];return h?(h.start=Math.min(h.start,P),h.end=Math.max(h.end,v)):(h={start:P,end:v,loaded:new J},t[b]=h),await h.loaded.promise.then((t=>new Uint8Array(t.buffer,t.byteOffset+Z-h.start,S)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(t,b){const Z=t[b];Z&&(this._loader.log(`Loading buffer range [${Z.start}-${Z.end}]`),this._loader.bin.readAsync(Z.start,Z.end-Z.start+1).then((t=>{Z.loaded.resolve(t)}),(t=>{Z.loaded.reject(t)})))}_getLODs(t,b,Z,J){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const S=[];for(let P=J.length-1;P>=0;P--)if(S.push(F.Get(`${t}/ids/${J[P]}`,Z,J[P])),S.length===this.maxLODsToLoad)return S;return S.push(b),S}_disposeTransformNode(t){const b=[],Z=t.material;Z&&b.push(Z);for(const S of t.getChildMeshes())S.material&&b.push(S.material);t.dispose();const J=b.filter((t=>this._loader.babylonScene.meshes.every((b=>b.material!=t))));this._disposeMaterials(J)}_disposeMaterials(t){const b={};for(const Z of t){for(const t of Z.getActiveTextures())b[t.uniqueId]=t;Z.dispose()}for(const Z in b)for(const t of this._loader.babylonScene.materials)t.hasTexture(b[Z])&&delete b[Z];for(const Z in b)b[Z].dispose()}}N(CZ),Q(CZ,!0,(t=>new YZ(t)));const gZ="MSFT_minecraftMesh";class IZ{constructor(t){this.name=gZ,this._loader=t,this.enabled=this._loader.isExtensionUsed(gZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtraAsync(t,b,this.name,(async(J,S)=>{if(S){if(!(Z instanceof U.b))throw new Error(`${J}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(t,b,Z);return Z.needAlphaBlending()&&(Z.forceDepthWrite=!0,Z.separateCullingPass=!0),Z.Nb=Z.forceDepthWrite,Z.twoSidedLighting=!0,await S}}))}}N(gZ),Q(gZ,!0,(t=>new IZ(t)));const rZ="MSFT_sRGBFactors";class MZ{constructor(t){this.name=rZ,this._loader=t,this.enabled=this._loader.isExtensionUsed(rZ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(t,b,Z){return X.LoadExtraAsync(t,b,this.name,(async(J,S)=>{if(S){if(!(Z instanceof U.b))throw new Error(`${J}: Material type not supported`);const S=this._loader.loadMaterialPropertiesAsync(t,b,Z),P=Z.et().getEngine().useExactSrgbConversions;return Z.albedoTexture||Z.albedoColor.toLinearSpaceToRef(Z.albedoColor,P),Z.reflectivityTexture||Z.reflectivityColor.toLinearSpaceToRef(Z.reflectivityColor,P),await S}}))}}N(rZ),Q(rZ,!0,(t=>new MZ(t)));var TZ=Z(14386);const aZ={};var kZ=Z(14452),uZ=Z(14424),lZ=Z(14388),UZ=Z(14405);function EZ(t,b){for(const Z of t)for(const t of Z.dataOutputs)if(t.uniqueId===b)return t;throw new Error("Could not find data out connection with unique id "+b)}function cZ(t,b){for(const Z of t)if(Z instanceof uZ.e)for(const t of Z.signalInputs)if(t.uniqueId===b)return t;throw new Error("Could not find signal in connection with unique id "+b)}async function HZ(t,b){const J=await Promise.all(t.allBlocks.map((async t=>{const b=function(t){switch(t){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Z.e(78),Z.e(79)]).then(Z.bind(Z,15906))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Z.e(80).then(Z.bind(Z,15909))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Z.e(81).then(Z.bind(Z,15915))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Z.e(82).then(Z.bind(Z,15921))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Z.e(83).then(Z.bind(Z,15926))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Z.e(84).then(Z.bind(Z,15928))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Z.e(85).then(Z.bind(Z,15933))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Z.e(86).then(Z.bind(Z,15940))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Z.e(87).then(Z.bind(Z,15944))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Z.e(95).then(Z.bind(Z,15980))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Z.e(96).then(Z.bind(Z,15989))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Z.e(97).then(Z.bind(Z,15996))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Z.e(98).then(Z.bind(Z,16004))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Z.e(99).then(Z.bind(Z,16011))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Z.e(100).then(Z.bind(Z,16019))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Z.e(101).then(Z.bind(Z,16028))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Z.e(102).then(Z.bind(Z,16037))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Z.e(103).then(Z.bind(Z,16039))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Z.e(104).then(Z.bind(Z,16042))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Z.e(105).then(Z.bind(Z,16050))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Z.e(106).then(Z.bind(Z,16058))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Z.e(107).then(Z.bind(Z,16066))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Z.e(108).then(Z.bind(Z,16070))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Z.e(109).then(Z.bind(Z,16072))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Z.e(110).then(Z.bind(Z,16081))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Z.e(111).then(Z.bind(Z,16090))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Z.e(112).then(Z.bind(Z,16096))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Z.e(113).then(Z.bind(Z,16104))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Z.e(92).then(Z.bind(Z,16110))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Z.e(114).then(Z.bind(Z,16114))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Z.e(115).then(Z.bind(Z,16118))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Z.e(116).then(Z.bind(Z,16120))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Z.e(93).then(Z.bind(Z,16126))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Z.e(88).then(Z.bind(Z,15947))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Z.e(94).then(Z.bind(Z,16130))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Z.e(89).then(Z.bind(Z,15970))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Z.e(90).then(Z.bind(Z,15974))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Z.e(91).then(Z.bind(Z,16135))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Z.e(117).then(Z.bind(Z,16140))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Z.e(118).then(Z.bind(Z,16145))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Z.e(119).then(Z.bind(Z,16148))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Z.e(120).then(Z.bind(Z,16150))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Z.e(121).then(Z.bind(Z,16153))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Z.e(122).then(Z.bind(Z,16162))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Z.e(123).then(Z.bind(Z,16164))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Z.e(124).then(Z.bind(Z,16172))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Z.e(125).then(Z.bind(Z,16180))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Z.e(126).then(Z.bind(Z,16182))).FlowGraphDataSwitchBlock;default:if(aZ[t])return aZ[t];throw new Error(`Unknown block name ${t}`)}}(t.className);return await b()})));return function(t,b,Z){const J=b.coordinator.createGraph(),S=[],P=b.valueParseFunction??lZ.c;for(let v=0;v<t.allBlocks.length;v++){const h=OZ(t.allBlocks[v],{PZ:b.coordinator.config.PZ,pathConverter:b.pathConverter,assetsContainer:b.coordinator.config.PZ,valueParseFunction:P},Z[v]);S.push(h),h instanceof kZ.d&&J.addEventBlock(h)}for(const v of S){for(const t of v.dataInputs)for(const b of t.connectedPointIds){const Z=EZ(S,b);t.connectTo(Z)}if(v instanceof uZ.e)for(const t of v.signalOutputs)for(const b of t.connectedPointIds){const Z=cZ(S,b);t.connectTo(Z)}}for(const v of t.executionContexts)oZ(v,{graph:J,valueParseFunction:P},t.rightHanded);return J}(t,b,J)}function oZ(t,b,Z){const J=b.graph.createContext();t.enableLogging&&(J.enableLogging=!0),J.treatDataAsRightHanded=Z||!1;const S=b.valueParseFunction??lZ.c;J.uniqueId=t.uniqueId;const P=J.et();if(t._assetsContext){var v,h,C,Y,g,I,r,M,T,a;const b=t._assetsContext,Z={meshes:null===(v=b.meshes)||void 0===v?void 0:v.map((t=>P.getMeshById(t))),lights:null===(h=b.lights)||void 0===h?void 0:h.map((t=>P.getLightByName(t))),cameras:null===(C=b.cameras)||void 0===C?void 0:C.map((t=>P.getCameraByName(t))),materials:null===(Y=b.materials)||void 0===Y?void 0:Y.map((t=>P.getMaterialById(t))),textures:null===(g=b.textures)||void 0===g?void 0:g.map((t=>P.getTextureByName(t))),animations:null===(I=b.animations)||void 0===I?void 0:I.map((t=>P.animations.find((b=>b.name===t)))),skeletons:null===(r=b.skeletons)||void 0===r?void 0:r.map((t=>P.getSkeletonByName(t))),Lr:null===(M=b.Lr)||void 0===M?void 0:M.map((t=>P.getParticleSystemById(t))),animationGroups:null===(T=b.animationGroups)||void 0===T?void 0:T.map((t=>P.getAnimationGroupByName(t))),transformNodes:null===(a=b.transformNodes)||void 0===a?void 0:a.map((t=>P.getTransformNodeById(t))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],HM:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};J.assetsContext=Z}for(const k in t._userVariables){const b=S(k,t._userVariables,J.assetsContext,P);J.userVariables[k]=b}for(const k in t._connectionValues){const b=S(k,t._connectionValues,J.assetsContext,P);J._setConnectionValueByKey(k,b)}return J}function OZ(t,b,Z){const J={},S=b.valueParseFunction??lZ.c;if(t.config)for(const v in t.config)J[v]=S(v,t.config,b.assetsContainer||b.PZ,b.PZ);if((0,lZ.k)(t.className)){if(!b.pathConverter)throw new Error("Path converter is required for this block");J.pathConverter=b.pathConverter}const P=new Z(J);P.uniqueId=t.uniqueId;for(let v=0;v<t.dataInputs.length;v++){const b=P.getDataInput(t.dataInputs[v].name);if(!b)throw new Error("Could not find data input with name "+t.dataInputs[v].name+" in block "+t.className);b.deserialize(t.dataInputs[v])}for(let v=0;v<t.dataOutputs.length;v++){const b=P.getDataOutput(t.dataOutputs[v].name);if(!b)throw new Error("Could not find data output with name "+t.dataOutputs[v].name+" in block "+t.className);b.deserialize(t.dataOutputs[v])}return P.metadata=t.metadata,P.deserialize&&P.deserialize(t),P}function pZ(t){const[b,Z]=t.split(":");return eZ({op:b,extension:Z})}function eZ(t){var b;let Z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const J=t.extension?null===(b=jZ[t.extension])||void 0===b?void 0:b[t.op]:VZ[t.op];if(!J&&(a.c.Warn(`No mapping found for operation ${t.op} and extension ${t.extension||"KHR_interactivity"}`),Z)){const b={},Z={flows:{}};if(t.inputValueSockets){b.values={};for(const Z in t.inputValueSockets)b.values[Z]={name:Z}}return t.outputValueSockets&&(Z.values={},Object.keys(t.outputValueSockets).forEach((t=>{Z.values[t]={name:t}}))),{SI:[],inputs:b,outputs:Z}}return J}function WZ(t,b,Z){jZ[b]||(jZ[b]={}),jZ[b][t]=Z}const jZ={BABYLON:{"flow/log":{SI:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},VZ={"event/onStart":{SI:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{SI:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{SI:["FlowGraphSendCustomEventBlock"],extraProcessor(t,b,Z,J,S){if("event/send"!==b.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const P=t.configuration.event.value[0];if("number"!==typeof P)throw new Error("Event id should be a number");const v=J.arrays.events[P],h=S[0];return h.config||(h.config={}),h.config.eventId=v.eventId,h.config.eventData=v.eventData,S}},"event/receive":{SI:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(t,b){var Z;if(!t.configuration)return a.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const J=t.configuration.event;if(!J)return a.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const S=J.value[0];if("number"!==typeof S)return a.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Z=b.events)||void 0===Z?void 0:Z[S])?{valid:!0}:(a.c.Error(`Event with id ${S} not found`),{valid:!1,error:`Event with id ${S} not found`})},extraProcessor(t,b,Z,J,S){if("event/receive"!==b.op||!t.configuration||1!==Object.keys(t.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const P=t.configuration.event.value[0];if("number"!==typeof P)throw new Error("Event id should be a number");const v=J.arrays.events[P],h=S[0];return h.config||(h.config={}),h.config.eventId=v.eventId,h.config.eventData=v.eventData,S}},"math/e":nZ("FlowGraphEBlock"),"math/pi":nZ("FlowGraphPIBlock"),"math/inf":nZ("FlowGraphInfBlock"),"math/nan":nZ("FlowGraphNaNBlock"),"math/abs":nZ("FlowGraphAbsBlock"),"math/sign":nZ("FlowGraphSignBlock"),"math/trunc":nZ("FlowGraphTruncBlock"),"math/floor":nZ("FlowGraphFloorBlock"),"math/ceil":nZ("FlowGraphCeilBlock"),"math/round":{SI:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S){var P;return(P=S[0]).config||(P.config={}),S[0].config.roundHalfAwayFromZero=!0,S}},"math/fract":nZ("FlowGraphFractBlock"),"math/neg":nZ("FlowGraphNegationBlock"),"math/add":nZ("FlowGraphAddBlock",["a","b"],!0),"math/sub":nZ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{SI:["FlowGraphMultiplyBlock"],extraProcessor(t,b,Z,J,S){var P;(P=S[0]).config||(P.config={}),S[0].config.useMatrixPerComponent=!0,S[0].config.preventIntegerFloatArithmetic=!0;let v=-1;return Object.keys(t.values||{}).find((b=>{var Z;return void 0!==(null===(Z=t.values)||void 0===Z?void 0:Z[b].type)&&(v=t.values[b].type,!0)})),-1!==v&&(S[0].config.type=J.arrays.types[v].flowGraphType),S},validation:t=>t.values?yZ(t):{valid:!0}},"math/div":nZ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":nZ("FlowGraphModuloBlock",["a","b"]),"math/min":nZ("FlowGraphMinBlock",["a","b"]),"math/max":nZ("FlowGraphMaxBlock",["a","b"]),"math/clamp":nZ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":nZ("FlowGraphSaturateBlock"),"math/mix":nZ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":nZ("FlowGraphEqualityBlock",["a","b"]),"math/lt":nZ("FlowGraphLessThanBlock",["a","b"]),"math/le":nZ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":nZ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":nZ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":nZ("FlowGraphIsNaNBlock"),"math/isinf":nZ("FlowGraphIsInfBlock"),"math/select":{SI:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{SI:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":nZ("FlowGraphSinBlock"),"math/cos":nZ("FlowGraphCosBlock"),"math/tan":nZ("FlowGraphTanBlock"),"math/asin":nZ("FlowGraphASinBlock"),"math/acos":nZ("FlowGraphACosBlock"),"math/atan":nZ("FlowGraphATanBlock"),"math/atan2":nZ("FlowGraphATan2Block",["a","b"]),"math/sinh":nZ("FlowGraphSinhBlock"),"math/cosh":nZ("FlowGraphCoshBlock"),"math/tanh":nZ("FlowGraphTanhBlock"),"math/asinh":nZ("FlowGraphASinhBlock"),"math/acosh":nZ("FlowGraphACoshBlock"),"math/atanh":nZ("FlowGraphATanhBlock"),"math/exp":nZ("FlowGraphExponentialBlock"),"math/log":nZ("FlowGraphLogBlock"),"math/log2":nZ("FlowGraphLog2Block"),"math/log10":nZ("FlowGraphLog10Block"),"math/sqrt":nZ("FlowGraphSquareRootBlock"),"math/cbrt":nZ("FlowGraphCubeRootBlock"),"math/pow":nZ("FlowGraphPowerBlock",["a","b"]),"math/length":nZ("FlowGraphLengthBlock"),"math/normalize":nZ("FlowGraphNormalizeBlock"),"math/dot":nZ("FlowGraphDotBlock",["a","b"]),"math/cross":nZ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":nZ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":nZ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{SI:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{SI:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{SI:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{SI:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{SI:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{SI:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{SI:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":nZ("FlowGraphTransposeBlock"),"math/determinant":nZ("FlowGraphDeterminantBlock"),"math/inverse":nZ("FlowGraphInvertMatrixBlock"),"math/matmul":nZ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{SI:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Kb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S,P){const v=S[0].dataInputs.find((t=>"rotationQuaternion"===t.name));if(!v)throw new Error("Rotation quaternion input not found");return P._connectionValues[v.uniqueId]&&(P._connectionValues[v.uniqueId].type="Quaternion"),S}},"math/matDecompose":{SI:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Kb"}}}},"math/quatConjugate":nZ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{SI:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S){var P;return(P=S[0]).config||(P.config={}),S[0].config.type="Quaternion",S}},"math/quatAngleBetween":nZ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{SI:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":nZ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":nZ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{SI:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S){var P;return(P=S[0]).config||(P.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract2x2":{SI:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{SI:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S){var P;return(P=S[0]).config||(P.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract3x3":{SI:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{SI:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S){var P;return(P=S[0]).config||(P.config={}),S[0].config.inputIsColumnMajor=!0,S}},"math/extract4x4":{SI:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{SI:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S,P){var v,h;(h=S[0]).config||(h.config={});const C=S[0].dataInputs[0];return S[0].config.valueType=(null===(v=P._connectionValues[C.uniqueId])||void 0===v?void 0:v.type)??"FlowGraphInteger",S}},"math/and":{SI:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S,P){var v,h,C;(C=S[0]).config||(C.config={});const Y=S[0].dataInputs[0],g=S[0].dataInputs[1];return S[0].config.valueType=(null===(v=P._connectionValues[Y.uniqueId])||void 0===v?void 0:v.type)??(null===(h=P._connectionValues[g.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",S}},"math/or":{SI:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S,P){var v,h,C;(C=S[0]).config||(C.config={});const Y=S[0].dataInputs[0],g=S[0].dataInputs[1];return S[0].config.valueType=(null===(v=P._connectionValues[Y.uniqueId])||void 0===v?void 0:v.type)??(null===(h=P._connectionValues[g.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",S}},"math/xor":{SI:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(t,b,Z,J,S,P){var v,h,C;(C=S[0]).config||(C.config={});const Y=S[0].dataInputs[0],g=S[0].dataInputs[1];return S[0].config.valueType=(null===(v=P._connectionValues[Y.uniqueId])||void 0===v?void 0:v.type)??(null===(h=P._connectionValues[g.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",S}},"math/asr":nZ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":nZ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":nZ("FlowGraphLeadingZerosBlock"),"math/ctz":nZ("FlowGraphTrailingZerosBlock"),"math/popcnt":nZ("FlowGraphOneBitsCounterBlock"),"math/rad":nZ("FlowGraphDegToRadBlock"),"math/deg":nZ("FlowGraphRadToDegBlock"),"type/boolToInt":nZ("FlowGraphBooleanToInt"),"type/boolToFloat":nZ("FlowGraphBooleanToFloat"),"type/intToBool":nZ("FlowGraphIntToBoolean"),"type/intToFloat":nZ("FlowGraphIntToFloat"),"type/floatToInt":nZ("FlowGraphFloatToInt"),"type/floatToBool":nZ("FlowGraphFloatToBoolean"),"flow/sequence":{SI:["FlowGraphSequenceBlock"],extraProcessor(t,b,Z,J,S){const P=S[0];return P.config||(P.config={}),P.config.outputSignalCount=Object.keys(t.flows||[]).length,P.signalOutputs.forEach(((t,b)=>{t.name="out_"+b})),S}},"flow/branch":{SI:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{SI:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(t){if(t.configuration&&t.configuration.cases){const b=t.configuration.cases.value;if(!b.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return a.c.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const Z=new Set(b);t.configuration.cases.value=Array.from(Z)}return{valid:!0}},extraProcessor(t,b,Z,J,S){if("flow/switch"!==b.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return S[0].signalOutputs.forEach((t=>{"default"!==t.name&&(t.name="out_"+t.name)})),S}},"flow/while":{SI:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{SI:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(t,b,Z,J,S){const P=S[0];return P.config||(P.config={}),P.config.incrementIndexWhenLoopDone=!0,S}},"flow/doN":{SI:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{SI:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(t,b,Z,J,S){if("flow/multiGate"!==b.op||!t.flows||0===Object.keys(t.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const P=S[0];return P.config||(P.config={}),P.config.outputSignalCount=Object.keys(t.flows).length,P.signalOutputs.forEach(((t,b)=>{t.name="out_"+b})),S}},"flow/waitAll":{SI:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(t){var b,Z;return"number"!==typeof(null===(b=t.configuration)||void 0===b||null===(Z=b.inputFlows)||void 0===Z?void 0:Z.value[0])&&(t.configuration=t.configuration||{inputFlows:{value:[0]}},t.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{SI:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{SI:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{SI:["FlowGraphCancelDelayBlock"]},"variable/get":{SI:["FlowGraphGetVariableBlock"],validation(t){var b,Z;return null!==(b=t.configuration)&&void 0!==b&&null!==(Z=b.variable)&&void 0!==Z&&Z.value?{valid:!0}:(a.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,b)=>[b.getVariableName(t[0])]}}},"variable/set":{SI:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(t,b)=>[b.getVariableName(t[0])]}}},"variable/setMultiple":{SI:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(t,b)=>[t[0].map((t=>b.getVariableName(t)))]}},extraProcessor:(t,b,Z,J,S)=>(S[0].dataInputs.forEach((t=>{t.name=J.getVariableName(+t.name)})),S)},"variable/interpolate":{SI:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(t,b)=>[b.getVariableName(t[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:t=>!0===t[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",vJ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",vJ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",vJ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",vJ:"FlowGraphPlayAnimationBlock"},out:{name:"out",vJ:"FlowGraphPlayAnimationBlock"},done:{name:"done",vJ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(t,b,Z,J,S){var P,v,h;const C=S[0],Y=null===(P=t.configuration)||void 0===P?void 0:P.variable.value[0];if("number"!==typeof Y)throw a.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const g=J.arrays.staticVariables[Y];"undefined"===typeof C.config.animationType.value&&(J.arrays.staticVariables,C.config.animationType.value=(0,UZ.H)(g.type));const I=S[4];return I.config||(I.config={}),(v=I.config).variable||(v.variable={}),I.config.variable.value=J.getVariableName(Y),(h=S[3]).config||(h.config={}),S}},"pointer/get":{SI:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",vJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",vJ:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,b,Z,J,S)=>(S.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),S)},"pointer/set":{SI:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",vJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",vJ:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,b,Z,J,S)=>(S.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className&&(t.config||(t.config={}),t.config.outputValue=!0)})),S)},"pointer/interpolate":{SI:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",vJ:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",vJ:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",vJ:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",vJ:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",vJ:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",vJ:"FlowGraphPlayAnimationBlock"},out:{name:"out",vJ:"FlowGraphPlayAnimationBlock"},done:{name:"done",vJ:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(t,b,Z,J,S)=>(S.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className?(b.config||(b.config={}),b.config.outputValue=!0):"FlowGraphInterpolationBlock"===b.className&&(b.config||(b.config={}),Object.keys(t.values||[]).forEach((Z=>{var S;const P=null===(S=t.values)||void 0===S?void 0:S[Z];if("value"===Z&&P){const t=P.type;void 0!==t&&(b.config.animationType=J.arrays.types[t].flowGraphType)}})))})),S)},"animation/start":{SI:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",vJ:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(t,b)=>[t[0]*b._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(t,b)=>[t[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){const h=S[S.length-1];return h.config||(h.config={}),h.config.glTF=v,S}},"animation/stop":{SI:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",vJ:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){const h=S[S.length-1];return h.config||(h.config={}),h.config.glTF=v,S}},"animation/stopAt":{SI:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",vJ:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(t,b)=>[t[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){const h=S[S.length-1];return h.config||(h.config={}),h.config.glTF=v,S}},"math/switch":{SI:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(t){if(t.configuration&&t.configuration.cases){const b=t.configuration.cases.value;if(!b.every((t=>"number"===typeof t&&/^-?\d+$/.test(t.toString()))))return a.c.Warn("Switch cases should be integers. Using empty array instead."),t.configuration.cases.value=[],{valid:!0};const Z=new Set(b);t.configuration.cases.value=Array.from(Z)}return{valid:!0}},extraProcessor(t,b,Z,J,S){const P=S[0];return P.dataInputs.forEach((t=>{"default"!==t.name&&"case"!==t.name&&(t.name="in_"+t.name)})),P.config||(P.config={}),P.config.treatCasesAsIntegers=!0,S}},"debug/log":{SI:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function nZ(t){let b=arguments.length>2?arguments[2]:void 0;return{SI:[t],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((t,b)=>(t[b]={name:b},t)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(t,Z,J,S,P){var v;if(b){(v=P[0]).config||(v.config={}),P[0].config.preventIntegerFloatArithmetic=!0;let b=-1;Object.keys(t.values||{}).find((Z=>{var J;return void 0!==(null===(J=t.values)||void 0===J?void 0:J[Z].type)&&(b=t.values[Z].type,!0)})),-1!==b&&(P[0].config.type=S.arrays.types[b].flowGraphType)}return P},validation:t=>b?yZ(t):{valid:!0}}}function yZ(t){if(t.values){const b=Object.keys(t.values).map((b=>t.values[b].type)).filter((t=>void 0!==t));if(!b.every((t=>t===b[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}VZ["math/compose"]=VZ["math/matCompose"],VZ["math/decompose"]=VZ["math/matDecompose"];var dZ=Z(12693);const sZ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"JZ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class qZ{constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=t,this._gltf=b,this._animationTargetFps=Z,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const t of this._interactivityGraph.types)this._types.push(sZ[t.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const t of this._interactivityGraph.declarations){const b=eZ(t);if(!b)throw a.c.Error(["No mapping found for declaration",t]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:b,fullOperationName:t.extension?t.op+":"+t.extension:t.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const t of this._interactivityGraph.variables){const b=this._parseVariable(t);this._staticVariables.push(b)}}_parseVariable(t,b){const Z=this._types[t.type];if(!Z)throw a.c.Error(["No type found for variable",t]),new Error("Error parsing variables");if(t.value&&t.value.length!==Z.length)throw a.c.Error(["Invalid value length for variable",t,Z]),new Error("Error parsing variables");const J=t.value||[];if(!J.length)switch(Z.flowGraphType){case"boolean":J.push(!1);break;case"FlowGraphInteger":J.push(0);break;case"number":J.push(NaN);break;case"Vector2":J.push(NaN,NaN);break;case"JZ":J.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":J.fill(NaN,0,4);break;case"Matrix":J.fill(NaN,0,16);break;case"Matrix3D":J.fill(NaN,0,9)}return"number"===Z.elementType&&"string"===typeof J[0]&&(J[0]=parseFloat(J[0])),{type:Z.flowGraphType,value:b?b(J,this):J}}_parseEvents(){if(this._interactivityGraph.events)for(const t of this._interactivityGraph.events){const b={eventId:t.id||"internalEvent_"+this._internalEventsCounter++};t.values&&(b.eventData=Object.keys(t.values).map((b=>{var Z;const J=null===(Z=t.values)||void 0===Z?void 0:Z[b];if(!J)throw a.c.Error(["No value found for event key",b]),new Error("Error parsing events");const S=this._types[J.type];if(!S)throw a.c.Error(["No type found for event value",J]),new Error("Error parsing events");const P="undefined"!==typeof J.value?this._parseVariable(J):void 0;return{id:b,type:S.flowGraphType,eventData:!0,value:P}}))),this._events.push(b)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const b of this._interactivityGraph.nodes){if("number"!==typeof b.declaration)throw a.c.Error(["No declaration found for node",b]),new Error("Error parsing nodes");const Z=this._mappings[b.declaration];if(!Z)throw a.c.Error(["No mapping found for node",b]),new Error("Error parsing nodes");if(Z.flowGraphMapping.validation){const J=Z.flowGraphMapping.validation(b,this._interactivityGraph,this._gltf);var t;if(!J.valid)throw new Error(`Error validating interactivity node ${null===(t=this._interactivityGraph.declarations)||void 0===t?void 0:t[b.declaration].op} - ${J.error}`)}const J=[];for(const t of Z.flowGraphMapping.SI){const S=this._getEmptyBlock(t,Z.fullOperationName);this._parseNodeConfiguration(b,S,Z.flowGraphMapping,t),J.push(S)}this._nodes.push({SI:J,fullOperationName:Z.fullOperationName})}}_getEmptyBlock(t,b){return{uniqueId:(0,dZ.c)(),className:t,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:b,metadata:{}}}_parseNodeConfiguration(t,b,Z,J){const S=b.config;if(t.configuration){const b=Object.keys(t.configuration);for(const h of b){var P,v;const b=null===(P=t.configuration)||void 0===P?void 0:P[h];if(!b)throw a.c.Error(["No value found for node configuration",h]),new Error("Error parsing node configuration");const C=null===(v=Z.configuration)||void 0===v?void 0:v[h];if(C&&C.vJ?C.vJ===J:0===Z.SI.indexOf(J)){const t=(null===C||void 0===C?void 0:C.name)||h;b&&"undefined"!==typeof b.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?b.value.length>=0?S[t]={value:1===b.value.length?b.value[0]:b.value}:a.c.Warn(["Invalid value for node configuration",b]):S[t]={value:C.defaultValue},C&&C.dataTransformer&&(S[t].value=C.dataTransformer([S[t].value],this)[0])}}}}_parseNodeConnections(t){for(let H=0;H<this._nodes.length;H++){var b;const o=null===(b=this._interactivityGraph.nodes)||void 0===b?void 0:b[H];if(!o)throw a.c.Error(["No node found for interactivity node",this._nodes[H]]),new Error("Error parsing node connections");const O=this._nodes[H],p=this._mappings[o.declaration];if(!p)throw a.c.Error(["No mapping found for node",o]),new Error("Error parsing node connections");const e=o.flows||{},W=Object.keys(e).sort();for(const t of W){var Z,J,S,P;const b=e[t],Y=null===(Z=p.flowGraphMapping.outputs)||void 0===Z||null===(J=Z.flows)||void 0===J?void 0:J[t],g=(null===Y||void 0===Y?void 0:Y.name)||t,I=this._createNewSocketConnection(g,!0);(Y&&Y.vJ&&O.SI.find((t=>t.className===Y.vJ))||O.SI[0]).signalOutputs.push(I);const r=b.node,M=this._nodes[r];if(!M)throw a.c.Error(["No node found for input node id",r]),new Error("Error parsing node connections");const T=pZ(M.fullOperationName);if(!T)throw a.c.Error(["No mapping found for input node",M]),new Error("Error parsing node connections");let k=null===(S=T.inputs)||void 0===S||null===(P=S.flows)||void 0===P?void 0:P[b.socket||"in"],u=!1;if(!k)for(const t in null===(v=T.inputs)||void 0===v?void 0:v.flows){var v,h,C;if(t.startsWith("[")&&t.endsWith("]"))u=!0,k=null===(h=T.inputs)||void 0===h||null===(C=h.flows)||void 0===C?void 0:C[t]}const l=k?u?k.name.replace("$1",b.socket||""):k.name:b.socket||"in",U=k&&k.vJ&&M.SI.find((t=>t.className===k.vJ))||M.SI[0];let E=U.signalInputs.find((t=>t.name===l));E||(E=this._createNewSocketConnection(l),U.signalInputs.push(E)),E.connectedPointIds.push(I.uniqueId),I.connectedPointIds.push(E.uniqueId)}const j=o.values||{},V=Object.keys(j);for(const b of V){var Y,g;const Z=j[b];let J=null===(Y=p.flowGraphMapping.inputs)||void 0===Y||null===(g=Y.values)||void 0===g?void 0:g[b],S=!1;if(!J)for(const t in null===(I=p.flowGraphMapping.inputs)||void 0===I?void 0:I.values){var I,r,M;if(t.startsWith("[")&&t.endsWith("]"))S=!0,J=null===(r=p.flowGraphMapping.inputs)||void 0===r||null===(M=r.values)||void 0===M?void 0:M[t]}const P=J?S?J.name.replace("$1",b):J.name:b,v=this._createNewSocketConnection(P);if((J&&J.vJ&&O.SI.find((t=>t.className===J.vJ))||O.SI[0]).dataInputs.push(v),void 0!==Z.value){const b=this._parseVariable(Z,J&&J.dataTransformer);t._connectionValues[v.uniqueId]=b}else{if("undefined"===typeof Z.node)throw a.c.Error(["Invalid value for value connection",Z]),new Error("Error parsing node connections");{var T,k,u;const t=Z.node,b=Z.socket||"value",J=this._nodes[t];if(!J)throw a.c.Error(["No node found for output socket reference",Z]),new Error("Error parsing node connections");const S=pZ(J.fullOperationName);if(!S)throw a.c.Error(["No mapping found for output socket reference",Z]),new Error("Error parsing node connections");let P=null===(T=S.outputs)||void 0===T||null===(k=T.values)||void 0===k?void 0:k[b],h=!1;if(!P)for(const Z in null===(l=S.outputs)||void 0===l?void 0:l.values){var l,U,E;if(Z.startsWith("[")&&Z.endsWith("]"))h=!0,P=null===(U=S.outputs)||void 0===U||null===(E=U.values)||void 0===E?void 0:E[Z]}const C=P?h?P.name.replace("$1",b):null===(u=P)||void 0===u?void 0:u.name:b,Y=P&&P.vJ&&J.SI.find((t=>t.className===P.vJ))||J.SI[0];let g=Y.dataOutputs.find((t=>t.name===C));g||(g=this._createNewSocketConnection(C,!0),Y.dataOutputs.push(g)),v.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(v.uniqueId)}}}if(p.flowGraphMapping.interBlockConnectors)for(const t of p.flowGraphMapping.interBlockConnectors){const b=t.input,Z=t.output,J=t.isVariable;this._connectFlowGraphNodes(b,Z,O.SI[t.inputBlockIndex],O.SI[t.outputBlockIndex],J)}if(p.flowGraphMapping.extraProcessor){var c;const b=null===(c=this._interactivityGraph.declarations)||void 0===c?void 0:c[o.declaration];if(!b)throw a.c.Error(["No declaration found for extra processor",o]),new Error("Error parsing node connections");O.SI=p.flowGraphMapping.extraProcessor(o,b,p.flowGraphMapping,this,O.SI,t,this._gltf)}}}_createNewSocketConnection(t,b){return{uniqueId:(0,dZ.c)(),name:t,_connectionType:b?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(t,b,Z,J,S){const P=S?Z.dataInputs:Z.signalInputs,v=S?J.dataOutputs:J.signalOutputs,h=P.find((b=>b.name===t))||this._createNewSocketConnection(t),C=v.find((t=>t.name===b))||this._createNewSocketConnection(b,!0);P.find((b=>b.name===t))||P.push(h),v.find((t=>t.name===b))||v.push(C),h.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(h.uniqueId)}getVariableName(t){return"staticVariable_"+t}serializeToFlowGraph(){const t={uniqueId:(0,dZ.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(t);for(let b=0;b<this._staticVariables.length;b++){const Z=this._staticVariables[b];t._userVariables[this.getVariableName(b)]=Z}return{rightHanded:!0,allBlocks:this._nodes.reduce(((t,b)=>t.concat(b.SI)),[]),executionContexts:[t]}}}const QZ="KHR_interactivity";class NZ{constructor(t){this._loader=t,this.name=QZ,this.enabled=this._loader.isExtensionUsed(QZ),this._pathConverter=(0,A.j)(this._loader.pb),t._skipStartAnimationStep=!0;const b=t.babylonScene;b&&function(t){(0,A.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!t.activeCamera)return new S.Quaternion(NaN,NaN,NaN,NaN);const b=S.Quaternion.FromRotationMatrix(t.activeCamera.getWorldMatrix()).normalize();return t.useRightHandedSystem||(b.w*=-1,b.x*=-1),b},type:"Quaternion",getTarget:()=>t.activeCamera}),(0,A.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!t.activeCamera)return new S.JZ(NaN,NaN,NaN);const b=t.activeCamera.getWorldMatrix().getTranslation();return t.useRightHandedSystem||(b.x*=-1),b},type:"JZ",getTarget:()=>t.activeCamera}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:t=>{var b;return(null===(b=t._babylonAnimationGroup)||void 0===b?void 0:b.isPlaying)??!1},type:"boolean",getTarget:t=>t._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:t=>{var b;return((null===(b=t._babylonAnimationGroup)||void 0===b?void 0:b.from)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:t=>{var b;return((null===(b=t._babylonAnimationGroup)||void 0===b?void 0:b.to)??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:t=>{var b;return((null===(b=t._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup}),(0,A.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:t=>{var b;return((null===(b=t._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:t=>t._babylonAnimationGroup})}(b)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var t;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,Z=null===(t=this._loader.pb.extensions)||void 0===t?void 0:t.KHR_interactivity;if(!Z)return;const J=new TZ.c({PZ:b});J.dispatchEventsSynchronously=!1;const S=Z.graphs.map((t=>new qZ(t,this._loader.pb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(S.map((async t=>await HZ(t,{coordinator:J,pathConverter:this._pathConverter})))),J.start()}}var AZ;AZ=async()=>(await Promise.resolve().then(Z.bind(Z,14469))).FlowGraphGLTFDataProvider,aZ[`${QZ}/${"FlowGraphGLTFDataProvider"}`]=AZ,N(QZ),Q(QZ,!0,(t=>new NZ(t)));const KZ="KHR_node_visibility";(0,A.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:t=>{const b=t._babylonTransformNode;return!b||void 0===b.isVisible||b.isVisible},set:(t,b)=>{var Z,J;null===(Z=b._primitiveBabylonMeshes)||void 0===Z||Z.forEach((t=>{t.inheritVisibility=!0})),b._babylonTransformNode&&(b._babylonTransformNode.isVisible=t),null===(J=b._primitiveBabylonMeshes)||void 0===J||J.forEach((b=>{b.isVisible=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class LZ{constructor(t){this.name=KZ,this._loader=t,this.enabled=t.isExtensionUsed(KZ)}async onReady(){var t;null===(t=this._loader.pb.nodes)||void 0===t||t.forEach((t=>{var b,Z,J,S;(null===(b=t._primitiveBabylonMeshes)||void 0===b||b.forEach((t=>{t.inheritVisibility=!0})),null!==(Z=t.extensions)&&void 0!==Z&&Z.KHR_node_visibility)&&(!1===(null===(J=t.extensions)||void 0===J?void 0:J.KHR_node_visibility.visible)&&(t._babylonTransformNode&&(t._babylonTransformNode.isVisible=!1),null===(S=t._primitiveBabylonMeshes)||void 0===S||S.forEach((t=>{t.isVisible=!1}))))}))}dispose(){this._loader=null}}N(KZ),Q(KZ,!0,(t=>new LZ(t)));const FZ="KHR_node_selectability";WZ("event/onSelect",FZ,{SI:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vJ:"FlowGraphGetVariableBlock",dataTransformer:t=>["pickedMesh_"+t[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",vJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){var h,C,Y,g,I,r;const M=S[S.length-1];M.config=M.config||{},M.config.glTF=v;const T=null===(h=t.configuration)||void 0===h||null===(C=h.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const a="pickedMesh_"+T;return S[1].config.variable=a,P._userVariables[a]={className:"Mesh",id:null===v||void 0===v||null===(Y=v.nodes)||void 0===Y||null===(g=Y[T]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===v||void 0===v||null===(I=v.nodes)||void 0===I||null===(r=I[T]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},S}}),(0,A.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:t=>{const b=t._babylonTransformNode;return!b||void 0===b.IY||b.IY},set:(t,b)=>{var Z;null===(Z=b._primitiveBabylonMeshes)||void 0===Z||Z.forEach((b=>{b.IY=t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"IY"],type:"boolean"});class BZ{constructor(t){this.name=FZ,this._loader=t,this.enabled=t.isExtensionUsed(FZ)}async onReady(){var t;null===(t=this._loader.pb.nodes)||void 0===t||t.forEach((t=>{var b,Z,J;null!==(b=t.extensions)&&void 0!==b&&b.KHR_node_selectability&&!1===(null===(Z=t.extensions)||void 0===Z?void 0:Z.KHR_node_selectability.selectable)&&(null===(J=t._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((t=>{t.IY=!1})))}))}dispose(){this._loader=null}}N(FZ),Q(FZ,!0,(t=>new BZ(t)));const XZ="KHR_node_hoverability",xZ="targetMeshPointerOver_";WZ("event/onHoverIn",XZ,{SI:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vJ:"FlowGraphGetVariableBlock",dataTransformer:t=>[xZ+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",vJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){var h,C,Y,g,I,r;const M=S[S.length-1];M.config=M.config||{},M.config.glTF=v;const T=null===(h=t.configuration)||void 0===h||null===(C=h.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const a=xZ+T;return S[1].config.variable=a,P._userVariables[a]={className:"Mesh",id:null===v||void 0===v||null===(Y=v.nodes)||void 0===Y||null===(g=Y[T]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===v||void 0===v||null===(I=v.nodes)||void 0===I||null===(r=I[T]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},S}});const iZ="targetMeshPointerOut_";WZ("event/onHoverOut",XZ,{SI:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",vJ:"FlowGraphGetVariableBlock",dataTransformer:t=>[iZ+t[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",vJ:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(t,b,Z,J,S,P,v){var h,C,Y,g,I,r;const M=S[S.length-1];M.config=M.config||{},M.config.glTF=v;const T=null===(h=t.configuration)||void 0===h||null===(C=h.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const a=iZ+T;return S[1].config.variable=a,P._userVariables[a]={className:"Mesh",id:null===v||void 0===v||null===(Y=v.nodes)||void 0===Y||null===(g=Y[T]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===v||void 0===v||null===(I=v.nodes)||void 0===I||null===(r=I[T]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},S}}),(0,A.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:t=>{const b=t._babylonTransformNode;return!b||void 0===b.pointerOverDisableMeshTesting||b.pointerOverDisableMeshTesting},set:(t,b)=>{var Z;null===(Z=b._primitiveBabylonMeshes)||void 0===Z||Z.forEach((b=>{b.pointerOverDisableMeshTesting=!t}))},getTarget:t=>t._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class zZ{constructor(t){this.name=XZ,this._loader=t,this.enabled=t.isExtensionUsed(XZ)}async onReady(){var t;null===(t=this._loader.pb.nodes)||void 0===t||t.forEach((t=>{var b,Z,J;null!==(b=t.extensions)&&void 0!==b&&b.KHR_node_hoverability&&!1===(null===(Z=t.extensions)||void 0===Z?void 0:Z.KHR_node_hoverability.hoverable)&&(null===(J=t._babylonTransformNode)||void 0===J||J.getChildMeshes().forEach((t=>{t.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}N(XZ),Q(XZ,!0,(t=>new zZ(t)));const DZ="ExtrasAsMetadata";class fZ{_assignExtras(t,b){if(b.extras&&Object.keys(b.extras).length>0){const Z=t.metadata=t.metadata||{};(Z.pb=Z.pb||{}).extras=b.extras}}constructor(t){this.name=DZ,this.enabled=!0,this._loader=t}dispose(){this._loader=null}loadNodeAsync(t,b,Z){return this._loader.loadNodeAsync(t,b,(t=>{this._assignExtras(t,b),Z(t)}))}loadCameraAsync(t,b,Z){return this._loader.loadCameraAsync(t,b,(t=>{this._assignExtras(t,b),Z(t)}))}createMaterial(t,b,Z){const J=this._loader.createMaterial(t,b,Z);return this._assignExtras(J,b),J}}N(DZ),Q(DZ,!1,(t=>new fZ(t)));Z(14469)},14324:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>y,g:()=>p,i:()=>O,m:()=>e});var J=Z(12551),S=Z(12549),P=Z(13957),v=Z(13184),h=Z(13152),C=Z(13159),Y=Z(12557),g=Z(12585),I=Z(13178),r=Z(13272),M=Z(13193),T=Z(12768);class a{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Lr=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.HM=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(t){this._environmentTexture=t}getNodes(){let t=[];t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes);for(const b of this.skeletons)t=t.concat(b.bones);return t}}class k extends a{}class u{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const t=this.rootNodes;for(const J of t)J.dispose();t.length=0;const b=this.skeletons;for(const J of b)J.dispose();b.length=0;const Z=this.animationGroups;for(const J of Z)J.dispose();Z.length=0}}class l extends a{constructor(t){super(),this._wasAddedToScene=!1,(t=t||g.e.LastCreatedScene)&&(this.PZ=t,this.proceduralTextures=[],t.lb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=t.getEngine().onContextRestoredObservable.add((()=>{for(const t of this.geometries)t._rebuild();for(const t of this.meshes)t._rebuild();for(const t of this.Lr)t.rebuild();for(const t of this.textures)t._rebuild()})))}_topologicalSort(t){const b=new Map;for(const v of t)b.set(v.uniqueId,v);const Z={dependsOn:new Map,dependedBy:new Map};for(const v of t){const t=v.uniqueId;Z.dependsOn.set(t,new Set),Z.dependedBy.set(t,new Set)}for(const v of t){const t=v.uniqueId,J=Z.dependsOn.get(t);if(v instanceof I.c){const S=v.sourceMesh;b.has(S.uniqueId)&&(J.add(S.uniqueId),Z.dependedBy.get(S.uniqueId).add(t))}const S=Z.dependedBy.get(t);for(const P of v.getDescendants()){const J=P.uniqueId;if(b.has(J)){S.add(J);Z.dependsOn.get(J).add(t)}}}const J=[],S=[];for(const v of t){const t=v.uniqueId;0===Z.dependsOn.get(t).size&&(S.push(v),b.delete(t))}const P=S;for(;P.length>0;){const t=P.shift();J.push(t);const S=Z.dependedBy.get(t.uniqueId);for(const J of Array.from(S.values())){const S=Z.dependsOn.get(J);S.delete(t.uniqueId),0===S.size&&b.get(J)&&(P.push(b.get(J)),b.delete(J))}}return b.size>0&&(Y.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((t=>{Y.c.Error(t.name)}))),J}_addNodeAndDescendantsToList(t,b,Z,J){if(Z&&(!J||J(Z))&&!b.has(Z.uniqueId)){t.push(Z),b.add(Z.uniqueId);for(const S of Z.getDescendants(!0))this._addNodeAndDescendantsToList(t,b,S,J)}}_isNodeInContainer(t){return t instanceof C.b&&-1!==this.meshes.indexOf(t)||(t instanceof h.e&&-1!==this.transformNodes.indexOf(t)||(t instanceof r.d&&-1!==this.lights.indexOf(t)||t instanceof M.e&&-1!==this.cameras.indexOf(t)))}_isValidHierarchy(){for(const t of this.meshes)if(t.parent&&!this._isNodeInContainer(t.parent))return Y.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.transformNodes)if(t.parent&&!this._isNodeInContainer(t.parent))return Y.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.lights)if(t.parent&&!this._isNodeInContainer(t.parent))return Y.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;for(const t of this.cameras)if(t.parent&&!this._isNodeInContainer(t.parent))return Y.c.Warn(`Node ${t.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(t){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Z=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const J={},P={},h=new u,C=[],Y=[],g={doNotInstantiate:!0,...Z},I=[],r=new Set;for(const S of this.transformNodes)null===S.parent&&this._addNodeAndDescendantsToList(I,r,S,g.predicate);for(const S of this.meshes)null===S.parent&&this._addNodeAndDescendantsToList(I,r,S,g.predicate);const M=this._topologicalSort(I),T=(Z,S)=>{if(((b,Z)=>{if(J[b.uniqueId]=Z.uniqueId,P[Z.uniqueId]=Z,t&&(Z.name=t(b.name)),Z instanceof v.b){const t=Z;if(t.morphTargetManager){const Z=b.morphTargetManager;t.morphTargetManager=Z.clone();for(let b=0;b<Z.numTargets;b++){const S=Z.getTarget(b),v=t.morphTargetManager.getTarget(b);J[S.uniqueId]=v.uniqueId,P[v.uniqueId]=v}}}})(Z,S),Z.parent){const t=J[Z.parent.uniqueId],b=P[t];S.parent=b||Z.parent}if(S.position&&Z.position&&S.position.S(Z.position),S.rotationQuaternion&&Z.rotationQuaternion&&S.rotationQuaternion.S(Z.rotationQuaternion),S.rotation&&Z.rotation&&S.rotation.S(Z.rotation),S.Kb&&Z.Kb&&S.Kb.S(Z.Kb),S.material){const v=S;if(v.material)if(b){const b=Z.material;if(-1===Y.indexOf(b)){let Z=b.clone(t?t(b.name):"Clone of "+b.name);if(Y.push(b),J[b.uniqueId]=Z.uniqueId,P[Z.uniqueId]=Z,"MultiMaterial"===b.getClassName()){const S=b;for(const b of S.Bb)b&&(Z=b.clone(t?t(b.name):"Clone of "+b.name),Y.push(b),J[b.uniqueId]=Z.uniqueId,P[Z.uniqueId]=Z);S.Bb=S.Bb.map((t=>t&&P[J[t.uniqueId]]))}}"InstancedMesh"!==v.getClassName()&&(v.material=P[J[b.uniqueId]])}else"MultiMaterial"===v.material.getClassName()?-1===this.PZ.multiMaterials.indexOf(v.material)&&this.PZ.addMultiMaterial(v.material):-1===this.PZ.materials.indexOf(v.material)&&this.PZ.addMaterial(v.material)}null===S.parent&&h.rootNodes.push(S)};for(const S of M)if("InstancedMesh"===S.getClassName()){const t=S,b=t.sourceMesh,Z=J[b.uniqueId];T(t,("number"===typeof Z?P[Z]:b).createInstance(t.name))}else{let t=!0;"Gb"===S.getClassName()||"Node"===S.getClassName()||S.skeleton||!S.getTotalVertices||0===S.getTotalVertices()?t=!1:g.doNotInstantiate&&(t="function"===typeof g.doNotInstantiate?!g.doNotInstantiate(S):!g.doNotInstantiate);const b=t?S.createInstance(`instance of ${S.name}`):S.clone(`Clone of ${S.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${S.name}`);T(S,b)}for(const S of this.skeletons){if(g.predicate&&!g.predicate(S))continue;const b=S.clone(t?t(S.name):"Clone of "+S.name);for(const t of this.meshes)if(t.skeleton===S&&!t.isAnInstance){const Z=P[J[t.uniqueId]];if(!Z||Z.isAnInstance)continue;if(Z.skeleton=b,-1!==C.indexOf(b))continue;C.push(b);for(const t of b.bones)t._linkedTransformNode&&(t._linkedTransformNode=P[J[t._linkedTransformNode.uniqueId]])}h.skeletons.push(b)}for(const S of this.animationGroups){if(g.predicate&&!g.predicate(S))continue;const b=S.clone(t?t(S.name):"Clone of "+S.name,(t=>P[J[t.uniqueId]]||t));h.animationGroups.push(b)}return h}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.PZ.environmentTexture=this.environmentTexture);for(const t of this.PZ._serializableComponents)t.addFromContainer(this);this.PZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];for(const Z of this.cameras)t&&!t(Z)||(this.PZ.addCamera(Z),b.push(Z));for(const Z of this.lights)t&&!t(Z)||(this.PZ.addLight(Z),b.push(Z));for(const Z of this.meshes)t&&!t(Z)||(this.PZ.Fg(Z),b.push(Z));for(const Z of this.skeletons)t&&!t(Z)||this.PZ.addSkeleton(Z);for(const Z of this.animations)t&&!t(Z)||this.PZ.addAnimation(Z);for(const Z of this.animationGroups)t&&!t(Z)||this.PZ.addAnimationGroup(Z);for(const Z of this.multiMaterials)t&&!t(Z)||this.PZ.addMultiMaterial(Z);for(const Z of this.materials)t&&!t(Z)||this.PZ.addMaterial(Z);for(const Z of this.morphTargetManagers)t&&!t(Z)||this.PZ.addMorphTargetManager(Z);for(const Z of this.geometries)t&&!t(Z)||this.PZ.addGeometry(Z);for(const Z of this.transformNodes)t&&!t(Z)||(this.PZ.addTransformNode(Z),b.push(Z));for(const Z of this.actionManagers)t&&!t(Z)||this.PZ.addActionManager(Z);for(const Z of this.textures)t&&!t(Z)||this.PZ.addTexture(Z);for(const Z of this.reflectionProbes)t&&!t(Z)||this.PZ.addReflectionProbe(Z);for(const Z of b)Z.parent&&-1===this.PZ.getNodes().indexOf(Z.parent)&&(Z.setParent?Z.setParent(null):Z.parent=null)}removeAllFromScene(){this._isValidHierarchy()||S.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.PZ.environmentTexture&&(this.PZ.environmentTexture=null);for(const t of this.PZ._serializableComponents)t.removeFromContainer(this)}removeFromScene(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const b of this.cameras)t&&!t(b)||this.PZ.removeCamera(b);for(const b of this.lights)t&&!t(b)||this.PZ.removeLight(b);for(const b of this.meshes)t&&!t(b)||this.PZ.Kg(b,!0);for(const b of this.skeletons)t&&!t(b)||this.PZ.removeSkeleton(b);for(const b of this.animations)t&&!t(b)||this.PZ.removeAnimation(b);for(const b of this.animationGroups)t&&!t(b)||this.PZ.removeAnimationGroup(b);for(const b of this.multiMaterials)t&&!t(b)||this.PZ.removeMultiMaterial(b);for(const b of this.materials)t&&!t(b)||this.PZ.removeMaterial(b);for(const b of this.morphTargetManagers)t&&!t(b)||this.PZ.removeMorphTargetManager(b);for(const b of this.geometries)t&&!t(b)||this.PZ.removeGeometry(b);for(const b of this.transformNodes)t&&!t(b)||this.PZ.removeTransformNode(b);for(const b of this.actionManagers)t&&!t(b)||this.PZ.removeActionManager(b);for(const b of this.textures)t&&!t(b)||this.PZ.removeTexture(b);for(const b of this.reflectionProbes)t&&!t(b)||this.PZ.removeReflectionProbe(b)}dispose(){const t=this.cameras.slice(0);for(const M of t)M.dispose();this.cameras.length=0;const b=this.lights.slice(0);for(const M of b)M.dispose();this.lights.length=0;const Z=this.meshes.slice(0);for(const M of Z)M.dispose();this.meshes.length=0;const J=this.skeletons.slice(0);for(const M of J)M.dispose();this.skeletons.length=0;const S=this.animationGroups.slice(0);for(const M of S)M.dispose();this.animationGroups.length=0;const P=this.multiMaterials.slice(0);for(const M of P)M.dispose();this.multiMaterials.length=0;const v=this.materials.slice(0);for(const M of v)M.dispose();this.materials.length=0;const h=this.geometries.slice(0);for(const M of h)M.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const M of C)M.dispose();this.transformNodes.length=0;const Y=this.actionManagers.slice(0);for(const M of Y)M.dispose();this.actionManagers.length=0;const g=this.textures.slice(0);for(const M of g)M.dispose();this.textures.length=0;const I=this.reflectionProbes.slice(0);for(const M of I)M.dispose();this.reflectionProbes.length=0;const r=this.morphTargetManagers.slice(0);for(const M of r)M.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const M of this.PZ._serializableComponents)M.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.PZ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(t,b,Z){if(t&&b)for(const J of t){let t=!0;if(Z)for(const b of Z)if(J===b){t=!1;break}t&&(b.push(J),J._parentContainer=this)}}moveAllFromScene(t){this._wasAddedToScene=!1,void 0===t&&(t=new k);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.PZ[b],this[b],t[b]));this.environmentTexture=this.PZ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const t=new v.b("assetContainerRootMesh",this.PZ);for(const b of this.meshes)b.parent||t.addChild(b);return this.meshes.unshift(t),t}mergeAnimationsTo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.e.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return Y.c.Error("No scene available to merge animations to"),[];const J=Z||(b=>{let Z=null;const J=b.animations.length?b.animations[0].targetProperty:"",S=b.name.split(".").join("").split("_primitive")[0];switch(J){case"position":case"rotationQuaternion":Z=t.getTransformNodeByName(b.name)||t.getTransformNodeByName(S);break;case"influence":Z=t.getMorphTargetByName(b.name)||t.getMorphTargetByName(S);break;default:Z=t.getNodeByName(b.name)||t.getNodeByName(S)}return Z}),S=this.getNodes();for(const h of S){const t=J(h);if(null!==t){for(const b of h.animations){const Z=t.animations.filter((t=>t.targetProperty===b.targetProperty));for(const b of Z){const Z=t.animations.indexOf(b,0);Z>-1&&t.animations.splice(Z,1)}}t.animations=t.animations.concat(h.animations)}}const P=[],v=this.animationGroups.slice();for(const h of v){P.push(h.clone(h.name,J));for(const t of h.animatables)t.stop()}for(const h of b){const b=J(h.target);b&&(t.beginAnimation(b,h.fromFrame,h.toFrame,h.loopAnimation,h.speedRatio,h.onAnimationEnd?h.onAnimationEnd:void 0,void 0,!0,void 0,h.onAnimationLoop?h.onAnimationLoop:void 0),t.stopAnimation(h.target))}return P}populateRootNodes(){this.rootNodes.length=0;for(const t of this.meshes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.transformNodes)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.lights)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t);for(const t of this.cameras)t.parent||-1!==this.rootNodes.indexOf(t)||this.rootNodes.push(t)}addAllAssetsToContainer(t){if(!t)return;const b=[],Z=new Set;for(b.push(t);b.length>0;){const t=b.pop();if(t instanceof v.b?(t.qb&&-1===this.geometries.indexOf(t.qb)&&this.geometries.push(t.qb),this.meshes.push(t)):t instanceof I.c?this.meshes.push(t):t instanceof h.e?this.transformNodes.push(t):t instanceof r.d?this.lights.push(t):t instanceof M.e&&this.cameras.push(t),t instanceof C.b){if(t.material&&-1===this.materials.indexOf(t.material)){this.materials.push(t.material);for(const b of t.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}t.skeleton&&-1===this.skeletons.indexOf(t.skeleton)&&this.skeletons.push(t.skeleton),t.morphTargetManager&&-1===this.morphTargetManagers.indexOf(t.morphTargetManager)&&this.morphTargetManagers.push(t.morphTargetManager)}for(const J of t.getChildren())Z.has(J)||b.push(J);Z.add(t)}this.populateRootNodes()}_getByTags(t,b,Z){if(void 0===b)return t;const J=[];for(const S in t){const P=t[S];T.b&&T.b.MatchesQuery(P,b)&&(!Z||Z(P))&&J.push(P)}return J}getMeshesByTags(t,b){return this._getByTags(this.meshes,t,b)}getCamerasByTags(t,b){return this._getByTags(this.cameras,t,b)}getLightsByTags(t,b){return this._getByTags(this.lights,t,b)}getMaterialsByTags(t,b){return this._getByTags(this.materials,t,b).concat(this._getByTags(this.multiMaterials,t,b))}getTransformNodesByTags(t,b){return this._getByTags(this.transformNodes,t,b)}}var U=Z(12608);class E{constructor(t){this.byteOffset=0,this.buffer=t}async loadAsync(t){const b=await this.buffer.readAsync(this.byteOffset,t);this._dataView=new DataView(b.buffer,b.byteOffset,b.byteLength),this._dataByteOffset=0}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,b}readString(t){return(0,U.e)(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}var c=Z(14326);const H="Z2xURg",o={name:"pb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:t=>-1!==t.indexOf("asset")&&-1!==t.indexOf("version")||t.startsWith("data:base64,"+H)||t.startsWith("data:;base64,"+H)||t.startsWith("data:application/octet-stream;base64,"+H)||t.startsWith("data:model/gltf-binary;base64,"+H)};var O,p,e,W=Z(12593),j=Z(12600);function V(t,b,Z){try{return Promise.resolve(new Uint8Array(t,b,Z))}catch(J){return Promise.reject(J)}}!function(t){t[t.AUTO=0]="AUTO",t[t.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(t){t[t.NONE=0]="NONE",t[t.FIRST=1]="FIRST",t[t.ALL=2]="ALL"}(p||(p={})),function(t){t[t.LOADING=0]="LOADING",t[t.READY=1]="READY",t[t.COMPLETE=2]="COMPLETE"}(e||(e={}));class n{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=t=>Promise.resolve(t),this.extensionOptions={}}S(t){t&&(this.onParsed=t.onParsed,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=t.loadSkins??this.loadSkins,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.createInstances=t.createInstances??this.createInstances,this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=t.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=t.customRootNode,this.onMeshLoaded=t.onMeshLoaded,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onCameraLoaded=t.onCameraLoaded,this.extensionOptions=t.extensionOptions??this.extensionOptions)}}class y extends n{constructor(t){super(),this.onParsedObservable=new J.d,this.onMeshLoadedObservable=new J.d,this.onSkinLoadedObservable=new J.d,this.onTextureLoadedObservable=new J.d,this.onMaterialLoadedObservable=new J.d,this.onCameraLoadedObservable=new J.d,this.onCompleteObservable=new J.d,this.onErrorObservable=new J.d,this.lb=new J.d,this.onExtensionLoadedObservable=new J.d,this.validate=!1,this.onValidatedObservable=new J.d,this._loader=null,this._state=null,this._requests=new Array,this.name=o.name,this.extensions=o.extensions,this.onLoaderStateChangedObservable=new J.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.S(t)}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>t(b.node,b.skinnedNode))))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.lb.remove(this._onDisposeObserver),this._onDisposeObserver=this.lb.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.lb.notifyObservers(void 0),this.lb.clear()}loadFile(t,b,Z,P,v,h,C,g){if(ArrayBuffer.isView(b))return this._loadBinary(t,b,Z,P,C,g),null;this._progressCallback=v;const I=b.name||S.Tools.GetFilename(b);if(h){if(this.useRangeRequests){this.validate&&Y.c.Warn("glTF validation is not supported when range requests are enabled");const Z={abort:()=>{},onCompleteObservable:new J.d},S={readAsync:(Z,J)=>new Promise(((S,P)=>{this._loadFile(t,b,(t=>{S(new Uint8Array(t))}),!0,(t=>{P(t)}),(t=>{t.setRequestHeader("Range",`bytes=${Z}-${Z+J-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new E(S)).then((t=>{Z.onCompleteObservable.notifyObservers(Z),P(t)}),C?t=>C(void 0,t):void 0),Z}return this._loadFile(t,b,(b=>{this._validate(t,new Uint8Array(b,0,b.byteLength),Z,I),this._unpackBinaryAsync(new E({readAsync:(t,Z)=>V(b,t,Z),byteLength:b.byteLength})).then((t=>{P(t)}),C?t=>C(void 0,t):void 0)}),!0,C)}return this._loadFile(t,b,(b=>{try{this._validate(t,b,Z,I),P({json:this._parseJson(b)})}catch{C&&C()}}),!1,C)}_loadBinary(t,b,Z,J,S,P){this._validate(t,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),Z,P),this._unpackBinaryAsync(new E({readAsync:(t,Z)=>function(t,b,Z){try{if(b<0||b>=t.byteLength)throw new RangeError("Offset is out of range.");if(b+Z>t.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(t.buffer,t.byteOffset+b,Z))}catch(J){return Promise.reject(J)}}(b,t,Z),byteLength:b.byteLength})).then((t=>{J(t)}),S?t=>S(void 0,t):void 0)}importMeshAsync(t,b,Z,J,S,P){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Z),this.onParsedObservable.clear(),this._log(`Loading ${P||""}`),this._loader=this._getLoader(Z),this._loader.importMeshAsync(t,b,null,Z,J,S,P))))}loadAsync(t,b,Z,J,S){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(t,b,Z,J,S))))}loadAssetContainerAsync(t,b,Z,J,S){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(b);const P=new l(t),v=[];this.onMaterialLoadedObservable.add((t=>{v.push(t)}));const h=[];this.onTextureLoadedObservable.add((t=>{h.push(t)}));const C=[];this.onCameraLoadedObservable.add((t=>{C.push(t)}));const Y=[];return this.onMeshLoadedObservable.add((t=>{t.morphTargetManager&&Y.push(t.morphTargetManager)})),this._loader.importMeshAsync(null,t,P,b,Z,J,S).then((t=>(Array.prototype.push.apply(P.geometries,t.geometries),Array.prototype.push.apply(P.meshes,t.meshes),Array.prototype.push.apply(P.Lr,t.Lr),Array.prototype.push.apply(P.skeletons,t.skeletons),Array.prototype.push.apply(P.animationGroups,t.animationGroups),Array.prototype.push.apply(P.materials,v),Array.prototype.push.apply(P.textures,h),Array.prototype.push.apply(P.lights,t.lights),Array.prototype.push.apply(P.transformNodes,t.transformNodes),Array.prototype.push.apply(P.cameras,C),Array.prototype.push.apply(P.morphTargetManagers,Y),P)))}))}canDirectLoad(t){return o.canDirectLoad(t)}directLoad(t,b){if(b.startsWith("base64,"+H)||b.startsWith(";base64,"+H)||b.startsWith("application/octet-stream;base64,"+H)||b.startsWith("model/gltf-binary;base64,"+H)){const Z=(0,W.c)(b);return this._validate(t,new Uint8Array(Z,0,Z.byteLength)),this._unpackBinaryAsync(new E({readAsync:(t,b)=>V(Z,t,b),byteLength:Z.byteLength}))}return this._validate(t,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(t){return new y(t[o.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((t,b)=>{this.onCompleteObservable.addOnce((()=>{t()})),this.onErrorObservable.addOnce((t=>{b(t)}))}))}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(e[this._state]))}_loadFile(t,b,Z,J,S,P){const v=t._loadFile(b,Z,(t=>{this._onProgress(t,v)}),!0,J,S,P);return v.onCompleteObservable.add((()=>{v._lengthComputable=!0,v._total=v._loaded})),this._requests.push(v),v}_onProgress(t,b){if(!this._progressCallback)return;b._lengthComputable=t.lengthComputable,b._loaded=t.loaded,b._total=t.total;let Z=!0,J=0,S=0;for(const P of this._requests){if(void 0===P._lengthComputable||void 0===P._loaded||void 0===P._total)return;Z=Z&&P._lengthComputable,J+=P._loaded,S+=P._total}this._progressCallback({lengthComputable:Z,loaded:J,total:Z?S:0})}_validate(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),c.d.ValidateAsync(b,Z,J,(b=>this.preprocessUrlAsync(Z+b).then((b=>t._loadFileAsync(b,void 0,!0,!0).then((t=>new Uint8Array(t,0,t.byteLength))))))).then((t=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(t),this.onValidatedObservable.clear()}),(t=>{this._endPerformanceCounter("Validate JSON"),S.Tools.Warn(`Failed to validate: ${t.message}`),this.onValidatedObservable.clear()})))}_getLoader(t){const b=t.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const Z=y._parseVersion(b.version);if(!Z)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const t=y._parseVersion(b.minVersion);if(!t)throw new Error("Invalid minimum version: "+b.minVersion);if(y._compareVersion(t,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const J={1:y._CreateGLTF1Loader,2:y._CreateGLTF2Loader}[Z.major];if(!J)throw new Error("Unsupported version: "+b.version);return J(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const b=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then((()=>{const b=t.readUint32();if(1179937895!==b)throw new j.g("Unexpected magic: "+b,j.f.GLTFLoaderUnexpectedMagicError);const Z=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Z}`);const J=t.readUint32();let S;switch(this.useRangeRequests||J===t.buffer.byteLength||Y.c.Warn(`Length in header does not match actual data length: ${J} != ${t.buffer.byteLength}`),Z){case 1:S=this._unpackBinaryV1Async(t,J);break;case 2:S=this._unpackBinaryV2Async(t,J);break;default:throw new Error("Unsupported version: "+Z)}return this._endPerformanceCounter("Unpack Binary"),S}))}_unpackBinaryV1Async(t,b){const Z=t.readUint32(),J=t.readUint32();if(0!==J)throw new Error(`Unexpected content format: ${J}`);const S=b-t.byteOffset,P={json:this._parseJson(t.readString(Z)),bin:null};if(0!==S){const b=t.byteOffset;P.bin={readAsync:(Z,J)=>t.buffer.readAsync(b+Z,J),byteLength:S}}return Promise.resolve(P)}_unpackBinaryV2Async(t,b){const Z=1313821514,J=5130562,S=t.readUint32();if(t.readUint32()!==Z)throw new Error("First chunk format is not JSON");return t.byteOffset+S===b?t.loadAsync(S).then((()=>({json:this._parseJson(t.readString(S)),bin:null}))):t.loadAsync(S+8).then((()=>{const P={json:this._parseJson(t.readString(S)),bin:null},v=()=>{const S=t.readUint32();switch(t.readUint32()){case Z:throw new Error("Unexpected JSON chunk");case J:{const b=t.byteOffset;P.bin={readAsync:(Z,J)=>t.buffer.readAsync(b+Z,J),byteLength:S},t.skipBytes(S);break}default:t.skipBytes(S)}return t.byteOffset!==b?t.loadAsync(8).then(v):Promise.resolve(P)};return v()}))}static _parseVersion(t){if("1.0"===t||"1.0.1"===t)return{major:1,minor:0};const b=(t+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(t,b){return t.major>b.major?1:t.major<b.major?-1:t.minor>b.minor?1:t.minor<b.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const b=y._logSpaces.substring(0,2*this._logIndentLevel);Y.c.Log(`${b}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){S.Tools.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){S.Tools.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}y.IncrementalLoading=!0,y.HomogeneousCoordinates=!1,y._logSpaces="                                ",(0,P.b)(new y)},14326:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>v});var J=Z(12549);function S(t,b,Z,J){const S={externalResourceFunction:J};return Z&&(S.uri="file:"===b?Z:b+Z),ArrayBuffer.isView(t)?GLTFValidator.validateBytes(t,S):GLTFValidator.validateString(t,S)}function P(){const t=[];onmessage=b=>{const Z=b.data;switch(Z.id){case"init":importScripts(Z.url);break;case"validate":S(Z.data,Z.rootUrl,Z.fileName,(b=>new Promise(((Z,J)=>{const S=t.length;t.push({resolve:Z,reject:J}),postMessage({id:"getExternalResource",index:S,uri:b})})))).then((t=>{postMessage({id:"validate.resolve",value:t})}),(t=>{postMessage({id:"validate.reject",reason:t})}));break;case"getExternalResource.resolve":t[Z.index].resolve(Z.value);break;case"getExternalResource.reject":t[Z.index].reject(Z.reason)}}}class v{static ValidateAsync(t,b,Z,v){return"function"===typeof Worker?new Promise(((h,C)=>{const Y=`${S}(${P})()`,g=URL.createObjectURL(new Blob([Y],{type:"application/javascript"})),I=new Worker(g),r=t=>{I.removeEventListener("error",r),I.removeEventListener("message",M),C(t)},M=t=>{const b=t.data;switch(b.id){case"getExternalResource":v(b.uri).then((t=>{I.postMessage({id:"getExternalResource.resolve",index:b.index,value:t},[t.buffer])}),(t=>{I.postMessage({id:"getExternalResource.reject",index:b.index,reason:t})}));break;case"validate.resolve":I.removeEventListener("error",r),I.removeEventListener("message",M),h(b.value),I.terminate();break;case"validate.reject":I.removeEventListener("error",r),I.removeEventListener("message",M),C(b.reason),I.terminate()}};if(I.addEventListener("error",r),I.addEventListener("message",M),I.postMessage({id:"init",url:J.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const J=t.slice();I.postMessage({id:"validate",data:J,rootUrl:b,fileName:Z},[J.buffer])}else I.postMessage({id:"validate",data:t,rootUrl:b,fileName:Z})})):(this._LoadScriptPromise||(this._LoadScriptPromise=J.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>S(t,b,Z,v))))}}v.Configuration={url:`${J.Tools._DefaultCdnUrl}/gltf_validator.js`}},14919:(t,b,Z)=>{"use strict";Z.d(b,{d:()=>o});var J=Z(12721),S=Z(12726),P=Z(12760),v=Z(12735),h=Z(13121),C=Z(13046),Y=Z(12800),g=Z(12975),I=Z(12688),r=Z(12636);Z(14101),Z(13993),Z(14012),Z(13996),Z(14021),Z(14027),Z(14035);const M="imageProcessingCompatibility",T="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";r.e.IncludesShadersStore[M]||(r.e.IncludesShadersStore[M]=T);const a="skyPixelShader",k="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";r.e.ShadersStore[a]||(r.e.ShadersStore[a]=k);Z(14112),Z(14042),Z(14051),Z(14059),Z(14055);const u="skyVertexShader",l="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";r.e.ShadersStore[u]||(r.e.ShadersStore[u]=l);var U=Z(13040),E=Z(13107),c=Z(13098);class H extends h.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class o extends C.b{constructor(t,b){super(t,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new v.JZ(0,100,0),this.useSunPosition=!1,this.cameraOffset=v.JZ.Zero(),this.up=v.JZ.Up(),this.dithering=!1,this._cameraPosition=v.JZ.Zero(),this._skyOrientation=new v.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(t,b){const Z=b._drawWrapper;if(this.isFrozen&&Z.effect&&Z._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new H);const J=b.materialDefines,S=this.et();if(this._isReadyForSubMesh(b))return!0;if((0,c.U)(t,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,J),(0,c.M)(t,J,!0,!1),J.IMAGEPROCESSINGPOSTPROCESS!==S.imageProcessingConfiguration.applyByPostProcess&&J.markAsMiscDirty(),J.DITHER!==this.dithering&&J.markAsMiscDirty(),J.isDirty){J.markAsProcessed(),S.resetCachedMaterial();const t=new U.b;J.FOG&&t.addFallback(1,"FOG"),J.IMAGEPROCESSINGPOSTPROCESS=S.imageProcessingConfiguration.applyByPostProcess,J.DITHER=this.dithering;const Z=[Y.g.PositionKind];J.VERTEXCOLOR&&Z.push(Y.g.ColorKind);const P="sky",v=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,E.c)(v);const h=J.toString();b.setEffect(S.getEngine().createEffect(P,Z,v,[],h,t,this.onCompiled,this.onError),J,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(J._renderId=S.getRenderId(),Z._wasPreviouslyReady=!0,!0)}bindForSubMesh(t,b,Z){const J=this.et(),S=Z.materialDefines;if(!S)return;const P=Z.effect;if(!P)return;this._activeEffect=P,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",J.getTransformMatrix()),this._mustRebind(J,P,Z)&&((0,E.f)(P,this,J),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,c.m)(S,P,J)),J.fogEnabled&&b.applyFog&&J.fogMode!==g.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",J.getViewMatrix()),(0,c.g)(J,b,this._activeEffect);const h=J.activeCamera;if(h){const t=h.getWorldMatrix();this._cameraPosition.x=t.m[12],this._cameraPosition.y=t.m[13],this._cameraPosition.z=t.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const t=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(t),this.sunPosition.y=this.distance*Math.sin(-t),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(t),v.Quaternion.FromUnitVectorsToRef(v.JZ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,Z)}getAnimatables(){return[]}dispose(t){super.dispose(t)}clone(t){return P.d.Clone((()=>new o(t,this.et())),this)}serialize(){const t=super.serialize();return t.customType="BABYLON.SkyMaterial",t}getClassName(){return"SkyMaterial"}static Parse(t,b,Z){return P.d.Parse((()=>new o(t.name,b)),t,b,Z)}}(0,J.e)([(0,S.N)()],o.prototype,"luminance",void 0),(0,J.e)([(0,S.N)()],o.prototype,"turbidity",void 0),(0,J.e)([(0,S.N)()],o.prototype,"rayleigh",void 0),(0,J.e)([(0,S.N)()],o.prototype,"mieCoefficient",void 0),(0,J.e)([(0,S.N)()],o.prototype,"mieDirectionalG",void 0),(0,J.e)([(0,S.N)()],o.prototype,"distance",void 0),(0,J.e)([(0,S.N)()],o.prototype,"inclination",void 0),(0,J.e)([(0,S.N)()],o.prototype,"azimuth",void 0),(0,J.e)([(0,S.J)()],o.prototype,"sunPosition",void 0),(0,J.e)([(0,S.N)()],o.prototype,"useSunPosition",void 0),(0,J.e)([(0,S.J)()],o.prototype,"cameraOffset",void 0),(0,J.e)([(0,S.J)()],o.prototype,"up",void 0),(0,J.e)([(0,S.N)()],o.prototype,"dithering",void 0),(0,I.f)("BABYLON.SkyMaterial",o)},13423:(t,b,Z)=>{"use strict";function J(t,b){b.headers=t.headers||{},b.statusMessage=t.statusText,b.statusCode=t.status,b.data=t.response}function S(t,b,Z){return new Promise((function(S,P){Z=Z||{};var v,h,C,Y=new XMLHttpRequest,g=Z.body,I=Z.headers||{};for(v in Z.timeout&&(Y.timeout=Z.timeout),Y.ontimeout=Y.onerror=function(t){t.timeout="timeout"==t.type,P(t)},Y.open(t,b.href||b),Y.onload=function(){for(C=Y.getAllResponseHeaders().trim().split(/[\r\n]+/),J(Y,Y);h=C.shift();)h=h.split(": "),Y.headers[h.shift().toLowerCase()]=h.join(": ");if((h=Y.headers["content-type"])&&~h.indexOf("application/json"))try{Y.data=JSON.parse(Y.data,Z.reviver)}catch(t){return J(Y,t),P(t)}(Y.status>=400?P:S)(Y)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(I["content-type"]="application/json",g=JSON.stringify(g)),Y.withCredentials=!!Z.withCredentials,I)Y.setRequestHeader(v,I[v]);Y.send(g)}))}Z.r(b),Z.d(b,{del:()=>C,get:()=>P,patch:()=>h,post:()=>v,put:()=>Y,send:()=>S});var P=S.bind(S,"GET"),v=S.bind(S,"POST"),h=S.bind(S,"PATCH"),C=S.bind(S,"DELETE"),Y=S.bind(S,"PUT")},15029:(t,b,Z)=>{"use strict";Z.d(b,{e:()=>I});const J=.5*(Math.sqrt(3)-1),S=(3-Math.sqrt(3))/6,P=1/3,v=1/6,h=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,Y=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),g=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const I=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof t?t:function(t){let b=0,Z=0,J=0,S=1;const P=function(){let t=4022871197;return function(b){b=b.toString();for(let Z=0;Z<b.length;Z++){t+=b.charCodeAt(Z);let J=.02519603282416938*t;t=J>>>0,J-=t,J*=t,t=J>>>0,J-=t,t+=4294967296*J}return 2.3283064365386963e-10*(t>>>0)}}();b=P(" "),Z=P(" "),J=P(" "),b-=P(t),b<0&&(b+=1);Z-=P(t),Z<0&&(Z+=1);J-=P(t),J<0&&(J+=1);return function(){const t=2091639*b+2.3283064365386963e-10*S;return b=Z,Z=J,J=t-(S=0|t)}}(t);this.p=function(t){const b=new Uint8Array(256);for(let Z=0;Z<256;Z++)b[Z]=Z;for(let Z=0;Z<255;Z++){const J=Z+~~(t()*(256-Z)),S=b[Z];b[Z]=b[J],b[J]=S}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Z=0;Z<512;Z++)this.perm[Z]=this.p[255&Z],this.permMod12[Z]=this.perm[Z]%12}noise2D(t,b){const Z=this.permMod12,P=this.perm;let v=0,h=0,C=0;const g=(t+b)*J,I=Math.floor(t+g),r=Math.floor(b+g),M=(I+r)*S,T=t-(I-M),a=b-(r-M);let k,u;T>a?(k=1,u=0):(k=0,u=1);const l=T-k+S,U=a-u+S,E=T-1+2*S,c=a-1+2*S,H=255&I,o=255&r;let O=.5-T*T-a*a;if(O>=0){const t=3*Z[H+P[o]];O*=O,v=O*O*(Y[t]*T+Y[t+1]*a)}let p=.5-l*l-U*U;if(p>=0){const t=3*Z[H+k+P[o+u]];p*=p,h=p*p*(Y[t]*l+Y[t+1]*U)}let e=.5-E*E-c*c;if(e>=0){const t=3*Z[H+1+P[o+1]];e*=e,C=e*e*(Y[t]*E+Y[t+1]*c)}return 70*(v+h+C)}noise3D(t,b,Z){const J=this.permMod12,S=this.perm;let h,C,g,I;const r=(t+b+Z)*P,M=Math.floor(t+r),T=Math.floor(b+r),a=Math.floor(Z+r),k=(M+T+a)*v,u=t-(M-k),l=b-(T-k),U=Z-(a-k);let E,c,H,o,O,p;u>=l?l>=U?(E=1,c=0,H=0,o=1,O=1,p=0):u>=U?(E=1,c=0,H=0,o=1,O=0,p=1):(E=0,c=0,H=1,o=1,O=0,p=1):l<U?(E=0,c=0,H=1,o=0,O=1,p=1):u<U?(E=0,c=1,H=0,o=0,O=1,p=1):(E=0,c=1,H=0,o=1,O=1,p=0);const e=u-E+v,W=l-c+v,j=U-H+v,V=u-o+2*v,n=l-O+2*v,y=U-p+2*v,d=u-1+.5,s=l-1+.5,q=U-1+.5,Q=255&M,N=255&T,A=255&a;let K=.6-u*u-l*l-U*U;if(K<0)h=0;else{const t=3*J[Q+S[N+S[A]]];K*=K,h=K*K*(Y[t]*u+Y[t+1]*l+Y[t+2]*U)}let L=.6-e*e-W*W-j*j;if(L<0)C=0;else{const t=3*J[Q+E+S[N+c+S[A+H]]];L*=L,C=L*L*(Y[t]*e+Y[t+1]*W+Y[t+2]*j)}let F=.6-V*V-n*n-y*y;if(F<0)g=0;else{const t=3*J[Q+o+S[N+O+S[A+p]]];F*=F,g=F*F*(Y[t]*V+Y[t+1]*n+Y[t+2]*y)}let B=.6-d*d-s*s-q*q;if(B<0)I=0;else{const t=3*J[Q+1+S[N+1+S[A+1]]];B*=B,I=B*B*(Y[t]*d+Y[t+1]*s+Y[t+2]*q)}return 32*(h+C+g+I)}noise4D(t,b,Z,J){const S=this.perm;let P,v,Y,I,r;const M=(t+b+Z+J)*h,T=Math.floor(t+M),a=Math.floor(b+M),k=Math.floor(Z+M),u=Math.floor(J+M),l=(T+a+k+u)*C,U=t-(T-l),E=b-(a-l),c=Z-(k-l),H=J-(u-l);let o=0,O=0,p=0,e=0;U>E?o++:O++,U>c?o++:p++,U>H?o++:e++,E>c?O++:p++,E>H?O++:e++,c>H?p++:e++;const W=o>=3?1:0,j=O>=3?1:0,V=p>=3?1:0,n=e>=3?1:0,y=o>=2?1:0,d=O>=2?1:0,s=p>=2?1:0,q=e>=2?1:0,Q=o>=1?1:0,N=O>=1?1:0,A=p>=1?1:0,K=e>=1?1:0,L=U-W+C,F=E-j+C,B=c-V+C,X=H-n+C,x=U-y+2*C,i=E-d+2*C,z=c-s+2*C,D=H-q+2*C,f=U-Q+3*C,mt=E-N+3*C,R=c-A+3*C,w=H-K+3*C,G=U-1+4*C,tt=E-1+4*C,bt=c-1+4*C,Zt=H-1+4*C,Jt=255&T,St=255&a,Pt=255&k,vt=255&u;let ht=.6-U*U-E*E-c*c-H*H;if(ht<0)P=0;else{const t=S[Jt+S[St+S[Pt+S[vt]]]]%32*4;ht*=ht,P=ht*ht*(g[t]*U+g[t+1]*E+g[t+2]*c+g[t+3]*H)}let Ct=.6-L*L-F*F-B*B-X*X;if(Ct<0)v=0;else{const t=S[Jt+W+S[St+j+S[Pt+V+S[vt+n]]]]%32*4;Ct*=Ct,v=Ct*Ct*(g[t]*L+g[t+1]*F+g[t+2]*B+g[t+3]*X)}let Yt=.6-x*x-i*i-z*z-D*D;if(Yt<0)Y=0;else{const t=S[Jt+y+S[St+d+S[Pt+s+S[vt+q]]]]%32*4;Yt*=Yt,Y=Yt*Yt*(g[t]*x+g[t+1]*i+g[t+2]*z+g[t+3]*D)}let gt=.6-f*f-mt*mt-R*R-w*w;if(gt<0)I=0;else{const t=S[Jt+Q+S[St+N+S[Pt+A+S[vt+K]]]]%32*4;gt*=gt,I=gt*gt*(g[t]*f+g[t+1]*mt+g[t+2]*R+g[t+3]*w)}let It=.6-G*G-tt*tt-bt*bt-Zt*Zt;if(It<0)r=0;else{const t=S[Jt+1+S[St+1+S[Pt+1+S[vt+1]]]]%32*4;It*=It,r=It*It*(g[t]*G+g[t+1]*tt+g[t+2]*bt+g[t+3]*Zt)}return 27*(P+v+Y+I+r)}}}}]);